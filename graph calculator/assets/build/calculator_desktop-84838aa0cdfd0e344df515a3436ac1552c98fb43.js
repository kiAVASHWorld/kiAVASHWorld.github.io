(() => {
  const __dcg_shared_module_source__ = "// shared.js\n  (() => {\n    const __dcg_chunk_exports__ = {};var AF=Object.create;var sx=Object.defineProperty;var _F=Object.getOwnPropertyDescriptor;var LF=Object.getOwnPropertyNames;var wF=Object.getPrototypeOf,FF=Object.prototype.hasOwnProperty;var _5=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,n)=>(typeof require!=\"undefined\"?require:t)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw Error('Dynamic require of \"'+e+'\" is not supported')});var L5=(e,t)=>()=>(e&&(t=e(e=0)),t);var w5=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ia=(e,t)=>{for(var n in t)sx(e,n,{get:t[n],enumerable:!0})},VF=(e,t,n,r)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let s of LF(t))!FF.call(e,s)&&s!==n&&sx(e,s,{get:()=>t[s],enumerable:!(r=_F(t,s))||r.enumerable});return e};var F5=(e,t,n)=>(n=e!=null?AF(wF(e)):{},VF(t||!e||!e.__esModule?sx(n,\"default\",{value:e,enumerable:!0}):n,e));var V5=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return n=>{for(var r=n.length,s=new Uint8Array((r-(n[r-1]==\"=\")-(n[r-2]==\"=\"))*3/4|0),i=0,o=0;i<r;){var a=e[n.charCodeAt(i++)],u=e[n.charCodeAt(i++)],c=e[n.charCodeAt(i++)],l=e[n.charCodeAt(i++)];s[o++]=a<<2|u>>4,s[o++]=u<<4|c>>2,s[o++]=c<<6|l}return s}})();var Z1=function(){{let e=function(){},t=[\"log\",\"info\",\"warn\",\"error\",\"assert\",\"dir\",\"clear\",\"profile\",\"profileEnd\",\"time\",\"timeEnd\",\"group\",\"groupCollapsed\",\"groupEnd\",\"trace\"],n={},r=function(s){typeof window!=\"undefined\"&&window.console&&window.console[s]?n[s]=function(){Function.prototype.apply.call(window.console[s],window.console,arguments)}:n[s]=e};return t.forEach(r),n}}(),G5=Z1,{log:k5,warn:H5,error:z5,assert:U5,dir:q5,clear:$5,profile:Y5,profileEnd:X5,time:Z5,timeEnd:W5,group:j5,groupCollapsed:J5,groupEnd:Q5,trace:K5}=Z1;var Oo={};ia(Oo,{DEFAULT_COMPLEX_EVALUATION_LABEL_OPTIONS:()=>yx,DEFAULT_EVALUATION_LABEL_OPTIONS:()=>CD,canDisplayAsFraction:()=>SD,complexNumberLabel:()=>Ic,complexPlainMathNumberLabel:()=>gx,formatSymbol:()=>X,identifierToHTML:()=>OV,identifierToLatex:()=>qr,latexToIdentifier:()=>no,numericLabel:()=>Zm,point:()=>PV,trimLatex:()=>oa,truncatedHTMLLabel:()=>vD,truncatedLatexLabel:()=>kl,truncatedPlainmathLabel:()=>Gl,value:()=>fx});function W1(e,t,n){if(e=_l(e),n>0){let r=_l(t);return e<r&&(e+=2*Math.PI),(e-r)/n}else{let r=_l(t+n);return e<r&&(e+=2*Math.PI),1+(e-r)/n}}function Bm(e,t,n){e=_l(e);let r=_l(t),s=_l(t+n);if(n<0){let i=r;r=s,s=i}return r<s?r<=e&&e<=s:r<=e||e<=s}function _l(e){let t=2*Math.PI;return(e%t+t)%t}function tY(e,t){if(!(isNaN(e)||isNaN(t)))return e>=0?Math.atan(t/e):Math.atan(t/e)+Math.PI}var Oi=Math.hypot;function Va(e,t){return e>0==t>0?e+.5*(t-e):.5*(e+t)}function GF(e,t,n,r,s,i){return e*r+t*s+n*i}function to(e,t,n,r,s,i,o,a,u){let c=Oi(o-r,a-s,u-i);return c===0?0:GF((e-r)/c,(t-s)/c,(n-i)/c,(o-r)/c,(a-s)/c,(u-i)/c)}function kF(e,t,n,r,s,i){let o=to(e,t,0,n,r,0,s,i,0);return o<=0?[n,r]:o>=1?[s,i]:[n+o*(s-n),r+o*(i-r)]}function HF(e,t,n,r,s,i,o,a,u){let c=to(e,t,n,r,s,i,o,a,u);return c<=0?[r,s,i]:c>=1?[o,a,u]:[r+c*(o-r),s+c*(a-s),i+c*(u-i)]}function rY(e,t,n,r,s,i,o,a){let u=to(e,t,0,n,r,0,s,i,0);return u<=0&&!o?[n,r]:u>=1&&!a?[s,i]:[n+u*(s-n),r+u*(i-r)]}function j1(e,t,n,r,s,i){let o=kF(e,t,n,r,s,i);return Oi(e-o[0],t-o[1])}function J1(e,t,n,r,s,i,o,a,u){let c=HF(e,t,n,r,s,i,o,a,u);return Oi(e-c[0],t-c[1],n-c[2])}function sY(e,t,n,r,s,i,o){let a=Math.atan2(t-r,e-n);if(Bm(a,i,o-i))return[s*Math.cos(a)+n,s*Math.sin(a)+r]}function si(e,t,n=1){if(e===t)return!0;if(!isFinite(e)||!isFinite(t))return!1;if(n>50)throw new Error(\"Within \"+(52-n)+\" bits isn't really approximate any more\");let r=Math.max(Math.max(Math.abs(e),Math.abs(t)),1),s=n===1?.5:Math.pow(.5,n);return r===r+s*Math.abs(t-e)}function iY(e){return Math.round(e-.5)+.5}function Ba(e,t=1e6){if(e===1/0)return{n:1/0,d:1};if(e===-1/0)return{n:-1/0,d:1};if(!isFinite(e))return{n:NaN,d:1};let n,r=0,s=1,i=1,o=0,a,u;for(;n=Math.floor(e),a=n*s+r,u=n*o+i,!(u>t||(r=s,i=o,s=a,o=u,e===n));)e=1/(e-n);return{n:s,d:o}}var Gm=typeof self==\"object\"&&self.self===self&&self||typeof global==\"object\"&&global.global===global&&global||Function(\"return this\")()||{},zm=Array.prototype,ax=Object.prototype,Q1=typeof Symbol!=\"undefined\"?Symbol.prototype:null,aY=zm.push,sD=zm.slice,km=ax.toString,zF=ax.hasOwnProperty,UF=Array.isArray,K1=Object.keys,eD=Object.create,iD=Gm.isNaN,qF=Gm.isFinite,ix=function(){};function Nr(e){if(e instanceof Nr)return e;if(!(this instanceof Nr))return new Nr(e);this._wrapped=e}var uY=Nr.VERSION=\"1.10.2\";function Um(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(r){return e.call(t,r)};case 3:return function(r,s,i){return e.call(t,r,s,i)};case 4:return function(r,s,i,o){return e.call(t,r,s,i,o)}}return function(){return e.apply(t,arguments)}}function oD(e,t,n){return e==null?bV:Ga(e)?Um(e,t,n):Bl(e)&&!Vl(e)?xV(e):bD(e)}Nr.iteratee=aD;function aD(e,t){return oD(e,t,1/0)}function vo(e,t,n){return Nr.iteratee!==aD?Nr.iteratee(e,t):oD(e,t,n)}function Ni(e,t){return t=t==null?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),s=0;s<n;s++)r[s]=arguments[s+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var i=Array(t+1);for(s=0;s<t;s++)i[s]=arguments[s];return i[t]=r,e.apply(this,i)}}function $F(e){if(!Bl(e))return{};if(eD)return eD(e);ix.prototype=e;var t=new ix;return ix.prototype=null,t}function uD(e){return function(t){return t==null?void 0:t[e]}}function wl(e,t){return e!=null&&zF.call(e,t)}function cD(e,t){for(var n=t.length,r=0;r<n;r++){if(e==null)return;e=e[t[r]]}return n?e:void 0}var YF=Math.pow(2,53)-1,du=uD(\"length\");function Ri(e){var t=du(e);return typeof t==\"number\"&&t>=0&&t<=YF}function Fl(e,t,n){t=Um(t,n);var r,s;if(Ri(e))for(r=0,s=e.length;r<s;r++)t(e[r],r,e);else{var i=gi(e);for(r=0,s=i.length;r<s;r++)t(e[i[r]],i[r],e)}return e}function qm(e,t,n){t=vo(t,n);for(var r=!Ri(e)&&gi(e),s=(r||e).length,i=Array(s),o=0;o<s;o++){var a=r?r[o]:o;i[o]=t(e[a],a,e)}return i}function lD(e){var t=function(n,r,s,i){var o=!Ri(n)&&gi(n),a=(o||n).length,u=e>0?0:a-1;for(i||(s=n[o?o[u]:u],u+=e);u>=0&&u<a;u+=e){var c=o?o[u]:u;s=r(s,n[c],c,n)}return s};return function(n,r,s,i){var o=arguments.length>=3;return t(n,Um(r,i,4),s,o)}}var cY=lD(1),lY=lD(-1);function XF(e,t,n){var r=[];return t=vo(t,n),Fl(e,function(s,i,o){t(s,i,o)&&r.push(s)}),r}function pY(e,t,n){t=vo(t,n);for(var r=!Ri(e)&&gi(e),s=(r||e).length,i=0;i<s;i++){var o=r?r[i]:i;if(!t(e[o],o,e))return!1}return!0}function dY(e,t,n){t=vo(t,n);for(var r=!Ri(e)&&gi(e),s=(r||e).length,i=0;i<s;i++){var o=r?r[i]:i;if(t(e[o],o,e))return!0}return!1}function Ll(e,t,n,r){return Ri(e)||(e=Ed(e)),(typeof n!=\"number\"||r)&&(n=0),eV(e,t,n)>=0}var fY=Ni(function(e,t,n){var r,s;return Ga(t)?s=t:Vl(t)&&(r=t.slice(0,-1),t=t[t.length-1]),qm(e,function(i){var o=s;if(!o){if(r&&r.length&&(i=cD(i,r)),i==null)return;o=i[t]}return o==null?o:o.apply(i,n)})});function pD(e,t){return qm(e,bD(t))}function ZF(e,t,n){var r=-1/0,s=-1/0,i,o;if(t==null||typeof t==\"number\"&&typeof e[0]!=\"object\"&&e!=null){e=Ri(e)?e:Ed(e);for(var a=0,u=e.length;a<u;a++)i=e[a],i!=null&&i>r&&(r=i)}else t=vo(t,n),Fl(e,function(c,l,p){o=t(c,l,p),(o>s||o===-1/0&&r===-1/0)&&(r=c,s=o)});return r}function mY(e,t,n){var r=1/0,s=1/0,i,o;if(t==null||typeof t==\"number\"&&typeof e[0]!=\"object\"&&e!=null){e=Ri(e)?e:Ed(e);for(var a=0,u=e.length;a<u;a++)i=e[a],i!=null&&i<r&&(r=i)}else t=vo(t,n),Fl(e,function(c,l,p){o=t(c,l,p),(o<s||o===1/0&&r===1/0)&&(r=c,s=o)});return r}function yY(e){return WF(e,1/0)}function WF(e,t,n){if(t==null||n)return Ri(e)||(e=Ed(e)),e[nD(e.length-1)];var r=Ri(e)?cV(e):Ed(e),s=du(r);t=Math.max(Math.min(t,s),0);for(var i=s-1,o=0;o<t;o++){var a=nD(o,i),u=r[o];r[o]=r[a],r[a]=u}return r.slice(0,t)}function gY(e,t,n){var r=0;return t=vo(t,n),pD(qm(e,function(s,i,o){return{value:s,index:r++,criteria:t(s,i,o)}}).sort(function(s,i){var o=s.criteria,a=i.criteria;if(o!==a){if(o>a||o===void 0)return 1;if(o<a||a===void 0)return-1}return s.index-i.index}),\"value\")}function $m(e,t){return function(n,r,s){var i=t?[[],[]]:{};return r=vo(r,s),Fl(n,function(o,a){var u=r(o,a,n);e(i,o,u)}),i}}var hY=$m(function(e,t,n){wl(e,n)?e[n].push(t):e[n]=[t]}),bY=$m(function(e,t,n){e[n]=t}),xY=$m(function(e,t,n){wl(e,n)?e[n]++:e[n]=1});function TY(e){return e==null?0:Ri(e)?e.length:gi(e).length}var IY=$m(function(e,t,n){e[n?0:1].push(t)},!0);function Tc(e,t,n,r){r=r||[];for(var s=r.length,i=0,o=du(e);i<o;i++){var a=e[i];if(Ri(a)&&(Vl(a)||Hm(a)))if(t)for(var u=0,c=a.length;u<c;)r[s++]=a[u++];else Tc(a,t,n,r),s=r.length;else n||(r[s++]=a)}return r}function PY(e,t){return Tc(e,t,!1)}var EY=Ni(function(e,t){return cx(e,t)});function ux(e,t,n,r){hV(t)||(r=n,n=t,t=!1),n!=null&&(n=vo(n,r));for(var s=[],i=[],o=0,a=du(e);o<a;o++){var u=e[o],c=n?n(u,o,e):u;t&&!n?((!o||i!==c)&&s.push(u),i=c):n?Ll(i,c)||(i.push(c),s.push(u)):Ll(s,u)||s.push(u)}return s}var MY=Ni(function(e){return ux(Tc(e,!0,!0))});var cx=Ni(function(e,t){return t=Tc(t,!0,!0),XF(e,function(n){return!Ll(t,n)})});function jF(e){for(var t=e&&ZF(e,du).length||0,n=Array(t),r=0;r<t;r++)n[r]=pD(e,r);return n}var CY=Ni(jF);function dD(e){return function(t,n,r){n=vo(n,r);for(var s=du(t),i=e>0?0:s-1;i>=0&&i<s;i+=e)if(n(t[i],i,t))return i;return-1}}var JF=dD(1),QF=dD(-1);function KF(e,t,n,r){n=vo(n,r,1);for(var s=n(t),i=0,o=du(e);i<o;){var a=Math.floor((i+o)/2);n(e[a])<s?i=a+1:o=a}return i}function fD(e,t,n){return function(r,s,i){var o=0,a=du(r);if(typeof i==\"number\")e>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;else if(n&&i&&a)return i=n(r,s),r[i]===s?i:-1;if(s!==s)return i=t(sD.call(r,o,a),gV),i>=0?i+o:-1;for(i=e>0?o:a-1;i>=0&&i<a;i+=e)if(r[i]===s)return i;return-1}}var eV=fD(1,JF,KF),DY=fD(-1,QF);function SY(e,t){if(t==null||t<1)return[];for(var n=[],r=0,s=e.length;r<s;)n.push(sD.call(e,r,r+=t));return n}function mD(e,t,n,r,s){if(!(r instanceof t))return e.apply(n,s);var i=$F(e.prototype),o=e.apply(i,s);return Bl(o)?o:i}var tV=Ni(function(e,t,n){if(!Ga(e))throw new TypeError(\"Bind must be called on a function\");var r=Ni(function(s){return mD(e,r,t,this,n.concat(s))});return r}),Ym=Ni(function(e,t){var n=Ym.placeholder,r=function(){for(var s=0,i=t.length,o=Array(i),a=0;a<i;a++)o[a]=t[a]===n?arguments[s++]:t[a];for(;s<arguments.length;)o.push(arguments[s++]);return mD(e,r,this,this,o)};return r});Ym.placeholder=Nr;var vY=Ni(function(e,t){t=Tc(t,!1,!1);var n=t.length;if(n<1)throw new Error(\"bindAll must be passed function names\");for(;n--;){var r=t[n];e[r]=tV(e[r],e)}});var yD=Ni(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),OY=Ym(yD,Nr,1);function NY(e,t,n){var r,s,i,o,a=0;n||(n={});var u=function(){a=n.leading===!1?0:rD(),r=null,o=e.apply(s,i),r||(s=i=null)},c=function(){var l=rD();!a&&n.leading===!1&&(a=l);var p=t-(l-a);return s=this,i=arguments,p<=0||p>t?(r&&(clearTimeout(r),r=null),a=l,o=e.apply(s,i),r||(s=i=null)):!r&&n.trailing!==!1&&(r=setTimeout(u,p)),o};return c.cancel=function(){clearTimeout(r),a=0,r=s=i=null},c}function RY(e,t,n){var r,s,i=function(a,u){r=null,u&&(s=e.apply(a,u))},o=Ni(function(a){if(r&&clearTimeout(r),n){var u=!r;r=setTimeout(i,t),u&&(s=e.apply(this,a))}else r=yD(i,t,this,a);return s});return o.cancel=function(){clearTimeout(r),r=null},o}function nV(e){return function(){return!e.apply(this,arguments)}}function rV(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var AY=Ym(rV,2),gD=!{toString:null}.propertyIsEnumerable(\"toString\"),tD=[\"valueOf\",\"isPrototypeOf\",\"toString\",\"propertyIsEnumerable\",\"hasOwnProperty\",\"toLocaleString\"];function hD(e,t){var n=tD.length,r=e.constructor,s=Ga(r)&&r.prototype||ax,i=\"constructor\";for(wl(e,i)&&!Ll(t,i)&&t.push(i);n--;)i=tD[n],i in e&&e[i]!==s[i]&&!Ll(t,i)&&t.push(i)}function gi(e){if(!Bl(e))return[];if(K1)return K1(e);var t=[];for(var n in e)wl(e,n)&&t.push(n);return gD&&hD(e,t),t}function lx(e){if(!Bl(e))return[];var t=[];for(var n in e)t.push(n);return gD&&hD(e,t),t}function Ed(e){for(var t=gi(e),n=t.length,r=Array(n),s=0;s<n;s++)r[s]=e[t[s]];return r}function sV(e){for(var t={},n=gi(e),r=0,s=n.length;r<s;r++)t[e[n[r]]]=n[r];return t}function px(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||n==null)return n;for(var s=1;s<r;s++)for(var i=arguments[s],o=e(i),a=o.length,u=0;u<a;u++){var c=o[u];(!t||n[c]===void 0)&&(n[c]=i[c])}return n}}var iV=px(lx),oV=px(gi);function aV(e,t,n){return t in n}var uV=Ni(function(e,t){var n={},r=t[0];if(e==null)return n;Ga(r)?(t.length>1&&(r=Um(r,t[1])),t=lx(e)):(r=aV,t=Tc(t,!1,!1),e=Object(e));for(var s=0,i=t.length;s<i;s++){var o=t[s],a=e[o];r(a,o,e)&&(n[o]=a)}return n}),_Y=Ni(function(e,t){var n=t[0],r;return Ga(n)?(n=nV(n),t.length>1&&(r=t[1])):(t=qm(Tc(t,!1,!1),String),n=function(s,i){return!Ll(t,i)}),uV(e,n,r)}),LY=px(lx,!0);function cV(e){return Bl(e)?Vl(e)?e.slice():iV({},e):e}function lV(e,t){var n=gi(t),r=n.length;if(e==null)return!r;for(var s=Object(e),i=0;i<r;i++){var o=n[i];if(t[o]!==s[o]||!(o in s))return!1}return!0}function ox(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return!1;if(e!==e)return t!==t;var s=typeof e;return s!==\"function\"&&s!==\"object\"&&typeof t!=\"object\"?!1:pV(e,t,n,r)}function pV(e,t,n,r){e instanceof Nr&&(e=e._wrapped),t instanceof Nr&&(t=t._wrapped);var s=km.call(e);if(s!==km.call(t))return!1;switch(s){case\"[object RegExp]\":case\"[object String]\":return\"\"+e==\"\"+t;case\"[object Number]\":return+e!=+e?+t!=+t:+e==0?1/+e===1/t:+e==+t;case\"[object Date]\":case\"[object Boolean]\":return+e==+t;case\"[object Symbol]\":return Q1.valueOf.call(e)===Q1.valueOf.call(t)}var i=s===\"[object Array]\";if(!i){if(typeof e!=\"object\"||typeof t!=\"object\")return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(Ga(o)&&o instanceof o&&Ga(a)&&a instanceof a)&&\"constructor\"in e&&\"constructor\"in t)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),i){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!ox(e[u],t[u],n,r))return!1}else{var c=gi(e),l;if(u=c.length,gi(t).length!==u)return!1;for(;u--;)if(l=c[u],!(wl(t,l)&&ox(e[l],t[l],n,r)))return!1}return n.pop(),r.pop(),!0}function ws(e,t){return ox(e,t)}function wY(e){return e==null?!0:Ri(e)&&(Vl(e)||dV(e)||Hm(e))?e.length===0:gi(e).length===0}function Ai(e){return function(t){return km.call(t)===\"[object \"+e+\"]\"}}var Vl=UF||Ai(\"Array\");function Bl(e){var t=typeof e;return t===\"function\"||t===\"object\"&&!!e}var Hm=Ai(\"Arguments\"),Ga=Ai(\"Function\"),dV=Ai(\"String\"),fV=Ai(\"Number\"),FY=Ai(\"Date\"),VY=Ai(\"RegExp\"),BY=Ai(\"Error\"),mV=Ai(\"Symbol\"),GY=Ai(\"Map\"),kY=Ai(\"WeakMap\"),HY=Ai(\"Set\"),zY=Ai(\"WeakSet\");(function(){Hm(arguments)||(Hm=function(e){return wl(e,\"callee\")})})();var yV=Gm.document&&Gm.document.childNodes;typeof/./!=\"function\"&&typeof Int8Array!=\"object\"&&typeof yV!=\"function\"&&(Ga=function(e){return typeof e==\"function\"||!1});function UY(e){return!mV(e)&&qF(e)&&!iD(parseFloat(e))}function gV(e){return fV(e)&&iD(e)}function hV(e){return e===!0||e===!1||km.call(e)===\"[object Boolean]\"}function bV(e){return e}function bD(e){return Vl(e)?function(t){return cD(t,e)}:uD(e)}function xV(e){return e=oV({},e),function(t){return lV(t,e)}}function nD(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}var rD=Date.now||function(){return new Date().getTime()},xD={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#x27;\",\"`\":\"&#x60;\"},TV=sV(xD);function TD(e){var t=function(i){return e[i]},n=\"(?:\"+gi(e).join(\"|\")+\")\",r=RegExp(n),s=RegExp(n,\"g\");return function(i){return i=i==null?\"\":\"\"+i,r.test(i)?i.replace(s,t):i}}var ID=TD(xD),qY=TD(TV);var IV=0;function $Y(e){var t=++IV+\"\";return e?e+t:t}var YY=Nr.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};function PD(e,t){return e._chain?Nr(t).chain():t}Fl([\"pop\",\"push\",\"reverse\",\"shift\",\"sort\",\"splice\",\"unshift\"],function(e){var t=zm[e];Nr.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e===\"shift\"||e===\"splice\")&&n.length===0&&delete n[0],PD(this,n)}});Fl([\"concat\",\"join\",\"slice\"],function(e){var t=zm[e];Nr.prototype[e]=function(){return PD(this,t.apply(this._wrapped,arguments))}});Nr.prototype.value=function(){return this._wrapped};Nr.prototype.valueOf=Nr.prototype.toJSON=Nr.prototype.value;Nr.prototype.toString=function(){return String(this._wrapped)};function fx(e,t=e,n=!1){if(isNaN(e)||!isFinite(e))return{string:\"undefined\",latex:\"undefined\",value:e};if(e===0)return{string:\"0\",latex:\"0\",value:e};Math.abs(e)>Math.abs(t)&&(t=e);let r=Ba(e/Math.PI,24),s,i,o,a,u,c,l=n?DV(t):CV(t);if(l&&si(r.n/r.d*Math.PI,e,3))return r.n===0?(s=\"0\",a=\"0\"):r.n===1?(s=\"\\u03C0\",a=\"\\\\pi\"):r.n===-1?(s=\"-\\u03C0\",a=\"-\\\\pi\"):(s=r.n.toString()+\"\\u03C0\",a=r.n.toString()+\"\\\\pi\"),r.d===1?(i=\"\",u=\"\"):(i=\"/\"+r.d.toString(),u=r.d.toString()),o=s+i,u===\"\"?c=a:a[0]===\"-\"?c=`-\\\\frac{${a.slice(1)}}{${u}}`:c=`\\\\frac{${a}}{${u}}`,{string:o,latex:c,value:r.n/r.d*Math.PI};if(l)return o=MV(ED(e.toFixed(dx(t)))),{string:o,latex:o,value:parseFloat(o)};{let p=mx(e.toExponential(dx(t/e))).split(\"e\"),f=p[0]===\"1\"&&n?\"10\":p[0]+\"\\xD710\",d=p[1].replace(\"+\",\"\");return o=mx(e.toExponential(dx(t/e))).replace(\"+\",\"\"),c=`${p[0]}\\\\times10^{${d}}`,{string:o,latex:c,mantissa:f,superscript:d,value:parseFloat(o)}}}function PV(e,t,n,r){let s=fx(e,t),i=fx(r(s.value),n);return[s,i]}var EV=/\\.?0+$/;function ED(e){return e.indexOf(\".\")===-1?e:e.replace(EV,\"\")}function mx(e){let t=/\\.?0+e/;return e.replace(t,\"e\")}function MV(e){return e===\"-0\"?\"0\":e}function CV(e){return e=Math.abs(e),1e-4<e&&e<1e7}function DV(e){return e=Math.abs(e),.001<e&&e<1e4}var SV=5,vV=5;function dx(e){return e=Math.abs(e),e=Math.max(e,1e-16),Math.max(SV,Math.floor(vV+1.5-Math.log10(e)))}var MD={zeroCutoff:0,smallCutoff:.001,bigCutoff:1e6,digits:10,displayAsFraction:!1,addEllipses:!1,alwaysEmitImaginary:!1,spaceConstrained:!1},CD={smallCutoff:1e-6,bigCutoff:1e9,digits:12},yx={...CD,smallCutoff:1e-4,bigCutoff:1e6,digits:9,scientificNotationDigits:4,spaceConstrained:!0};function DD(e){return 1e6/Math.sqrt(Math.abs(e))}function SD(e){let t=DD(e);if(t<1||t>1e12)return!1;let{n,d:r}=Ba(e,t);return r===1?!1:e===e+Math.pow(2,-3)*Math.abs(n/r-e)}function Zm(e,t){var g;let{zeroCutoff:n,smallCutoff:r,bigCutoff:s,digits:i,displayAsFraction:o,addEllipses:a,spaceConstrained:u}={...MD,...t},c=(g=t==null?void 0:t.scientificNotationDigits)!=null?g:i-2;if(isNaN(e)||!isFinite(e))return{type:\"undefined\"};if(e===0||Math.abs(e)<n)return{type:\"decimal\",value:\"0\"};let p=mx(e.toExponential(c)).match(/([\\d\\.\\-]+)e\\+?([\\d\\-]+)/);if(!p)return{type:\"undefined\"};let f=parseInt(p[2],10),d=f>=i;if(SD(e)&&o){let m=Ba(e,DD(e));return{type:\"fraction\",numerator:m.n.toString(),denominator:m.d.toString()}}else{if(Math.abs(e)>s||Math.abs(e)<r||d)return{type:\"scientific\",mantissa:p[1],exponent:p[2]};{let m=ED(e.toPrecision(u&&f<0?i+f:i));return e!==Number(m)&&a&&(m+=\"...\"),{type:\"decimal\",value:m}}}}function vD(e,t){let n=Zm(e,t);switch(n.type){case\"undefined\":return\"undefined\";case\"decimal\":return n.value;case\"scientific\":return n.mantissa+\"<span class='dcg-cross'>\\xD7</span>10<sup>\"+n.exponent+\"</sup>\";case\"fraction\":return n.denominator===\"1\"?n.numerator:`${n.numerator}/${n.denominator}`;default:return n}}function Gl(e,t){let n=Zm(e,t);switch(n.type){case\"undefined\":return\"undefined\";case\"decimal\":return n.value;case\"scientific\":return n.mantissa+\" * 10^\"+n.exponent;case\"fraction\":return n.denominator===\"1\"?n.numerator:`${n.numerator}/${n.denominator}`;default:return n}}function kl(e,t){let n=Zm(e,t);switch(n.type){case\"undefined\":return\"undefined\";case\"decimal\":return n.value;case\"scientific\":return n.mantissa+\"\\\\times10^{\"+n.exponent+\"}\";case\"fraction\":return n.denominator===\"1\"?n.numerator:n.numerator[0]===\"-\"?`-\\\\frac{${n.numerator.slice(1)}}{${n.denominator}}`:`\\\\frac{${n.numerator}}{${n.denominator}}`;default:return n}}function X(e){if(e.startsWith(\"_base_case\")){let[n,r,s]=e.split(\":\"),i=[];for(let o of s.split(\",\")){let a=parseFloat(o);isNaN(a)?i.push(X(o)):i.push(Gl(a))}return`${X(r)}(${i.join(\",\")})`}e=e.replace(\"\\\\\",\"\");let t={alpha:\"\\u03B1\",beta:\"\\u03B2\",gamma:\"\\u03B3\",delta:\"\\u03B4\",epsilon:\"\\u03F5\",varepsilon:\"\\u03B5\",zeta:\"\\u03B6\",eta:\"\\u03B7\",theta:\"\\u03B8\",vartheta:\"\\u03D1\",iota:\"\\u03B9\",kappa:\"\\u03BA\",varkappa:\"\\u03F0\",lambda:\"\\u03BB\",mu:\"\\u03BC\",xi:\"\\u03BE\",pi:\"\\u03C0\",varpi:\"\\u03D6\",rho:\"\\u03C1\",varrho:\"\\u03F1\",sigma:\"\\u03C3\",varsigma:\"\\u03C2\",tau:\"\\u03C4\",phi:\"\\u03D5\",varphi:\"\\u03C6\",chi:\"\\u03C7\",psi:\"\\u03C8\",omega:\"\\u03C9\",Gamma:\"\\u0393\",Delta:\"\\u0394\",Theta:\"\\u0398\",Lambda:\"\\u039B\",Xi:\"\\u039E\",Pi:\"\\u03A0\",Sigma:\"\\u03A3\",Phi:\"\\u03A6\",Psi:\"\\u03A8\",Omega:\"\\u03A9\",div:\"\\xF7\",cdot:\"\\u22C5\",times:\"\\xD7\",lt:\"<\",gt:\">\",le:\"\\u2264\",ge:\"\\u2265\",sim:\"\\u223C\",ldots:\"\\u2026\",prime:\"\\u2032\",approx:\"\\u2248\",to:\"\\u2192\",\"->\":\"\\u2192\",\"<=\":\"\\u2264\",\">=\":\"\\u2265\"};return t.hasOwnProperty(e)?t[e]:e}function qr(e){let t=e.match(/^\\$(\\d+)$/);if(t)return`\\\\token{${t[1]}}`;let n=e.split(\"_\"),r=\"\";return n[0].length>1&&(r+=\"\\\\\"),r+=n[0],n[1]&&(r+=\"_{\"+n[1]+\"}\"),r}function OV(e){if(!e)return\"\";let t=e.split(\"_\");t[0]=X(t[0]);let n=t.map(ID);return n[1]&&(n[1]=\"<sub>\"+n[1]+\"</sub>\"),n.join(\"\")}function no(e){let t=e.match(/\\\\token\\{(\\d+)\\}/);return t?`$${t[1]}`:(e=e.replace(/\\\\operatorname\\{(.*)\\}/,\"$1\"),e.replace(/[{}\\\\]/g,\"\"))}function oa(e){return e.replace(/^(\\\\ |\\s|\\\\space(?![a-zA-Z]))+/,\"\").replace(/(\\\\ |\\s|\\\\space(?![a-zA-Z]))+$/,\"\")}function Ic(e,t={},n=\"latex\"){let r={...MD,...t},{alwaysEmitImaginary:s}=r,i=n===\"latex\"?kl:vD,[o,a]=[e[0]!==0?i(e[0],r):void 0,e[1]!==0||s?i(Math.abs(e[1]),r):void 0];return o===\"undefined\"||a===\"undefined\"?\"undefined\":o&&a?`${o}${e[1]>=0?\"+\":\"-\"}${a!==\"1\"?`${a}`:\"\"}i`:a?`${e[1]>=0?\"\":\"-\"}${a!==\"1\"?`${a}`:\"\"}i`:o!=null?o:\"0\"}function gx(e,t={}){let[n,r]=[e[0]!==0?Gl(e[0],t):void 0,e[1]!==0?Gl(Math.abs(e[1]),t):void 0];if(n===\"undefined\"||r===\"undefined\")return\"undefined\";let s=r!=null&&r.includes(\" * \")||r!=null&&r.includes(\"/\")?\" \":\"\";return n&&r?`${n}${e[1]>0?\" + \":\" - \"}${r!==\"1\"?`${r}${s}`:\"\"}i`:r?`${e[1]>0?\"\":\"-\"}${r!==\"1\"?`${r}${s}`:\"\"}i`:n!=null?n:\"0\"}var Ht={};ia(Ht,{actionMergeFreeVariable:()=>OT,addArgumentsToDefinition:()=>Xd,addTypeError:()=>Fx,adjacentMixedNumber:()=>Ty,adjacentNumbers:()=>eI,andTypeError:()=>Xx,ansUndefined:()=>EP,assignmentsUnsupported:()=>ef,badEqualitySlice:()=>ca,badForInputListDependency:()=>OP,badForIntervalDependency:()=>NP,badImplicitCall:()=>xy,badIntegralBoundDependency:()=>xP,badLogExponent:()=>hI,badProductBoundDependency:()=>lP,badSampleSize:()=>IP,badSumBoundDependency:()=>cP,badSymbolContext:()=>Qd,badTrigExponent:()=>gI,badTupleDimensions:()=>KT,baseCaseCannotDependOnRecursiveParameter:()=>Ox,baseCaseTooComplicatedUsePiecewise:()=>Ld,baseCasesMustAllHaveSameReturnType:()=>_d,binaryOperatorMissingOperand:()=>qd,blankExpression:()=>Yd,boxplotBreadthInvalid:()=>kT,boxplotOffsetInvalid:()=>GT,cannotAssignColor:()=>HI,cannotRedefine:()=>Zl,cannotRestrict:()=>kI,cannotRestrictWithEquality:()=>zI,cannotSubscript:()=>EI,cantCombineSphericalAndCylindrical:()=>Oy,cdfMaxInvalid:()=>FI,cdfMaxLessThanMin:()=>VI,cdfMinInvalid:()=>wI,cdfRequiresArguments:()=>zT,cdfTooManyArguments:()=>UT,clickableObjectAlreadyAssigned:()=>WV,clickableObjectAssignmentNotDefined:()=>ZV,clickableObjectAssignmentNotIdentifier:()=>jV,clickableObjectInvalidExpression:()=>JV,colonMissingCondition:()=>TI,colorArity:()=>XT,combineTypeError:()=>yy,comparatorTypeError:()=>Yx,complexPlottedTableCell:()=>zV,complicatedDoubleInequality:()=>Ly,complicatedPolarImplicit:()=>WI,computedColumnHeader:()=>UP,constantUnsupported:()=>_c,coordinateAccessTypeError:()=>jx,customRegressionsUnsupported:()=>CP,cycle:()=>MI,deeplyNested:()=>_T,dependsOnDeletedGeoObject:()=>GP,derivativeMissingBody:()=>hP,derivativeTypeError:()=>dT,derivativeTypeErrorRespect:()=>fT,derivativeVariableTypeError:()=>mT,differentialWithSuperscript:()=>fP,distributionAsFunction:()=>Vy,divideTypeError:()=>Hx,domainMaxInvalid:()=>_I,domainMaxLessThanMin:()=>LI,domainMinInvalid:()=>AI,dotLHSConstantNumberError:()=>ly,dotLHSTypeError:()=>tT,dotRHSPropertyError:()=>nT,duplicateFunctionParameter:()=>II,duplicateUpdateRules:()=>CT,eachBaseCaseArgumentMustBeSimple:()=>ay,emptyParen:()=>$d,emptyPipe:()=>yI,emptyRadical:()=>dI,emptyRadicalIndex:()=>fI,emptySquareBracket:()=>mI,emptySubscript:()=>Ey,emptySuperscript:()=>aI,equationRequired:()=>wy,equationsUnsupported:()=>Ua,eventHandlerTypeError:()=>Gd,expectedArgumentToBeButFound:()=>Lx,exponentTypeError:()=>zx,featureUnavailable:()=>nf,fractionEmpty:()=>oI,fractionMissingDenominator:()=>iI,fractionMissingNumerator:()=>sI,fractionsUnavailable:()=>Uy,functionDefinitionsUnsupported:()=>tf,functionNameAsParameter:()=>PI,functionNotDefined:()=>Dy,functionOnlyWorksInComplexMode:()=>VD,functionRequiresNumberOfArguments:()=>_x,functionTypeError:()=>Hs,functionUnsupported:()=>Li,geometryLengthTypeError:()=>Kx,getLogInternalErrors:()=>GV,gpuLongProduct:()=>BT,gpuLongSum:()=>VT,gpuMaxListSize:()=>Oc,gpuUnsupportedFunction:()=>Xl,gpuUnsupportedIntegral:()=>FT,gpuVariableListLength:()=>mu,gpuVariableProduct:()=>hy,gpuVariableSum:()=>gy,heterogeneousList:()=>kd,identifierAsFunction:()=>Iy,identifierIsNotFunction:()=>Py,illegalBinWidth:()=>Jd,illegalDotCall:()=>Bd,implicitsDisabled:()=>ZI,incorrectProductLowerBound:()=>uP,incorrectSumLowerBound:()=>aP,indexTypeError:()=>Vd,inequalitiesDisabled:()=>Ry,inequalitiesUnsupported:()=>Lc,integralArgumentTypeError:()=>pT,integralLowerBoundTypeError:()=>cT,integralMissingBody:()=>gP,integralMissingBound:()=>pP,integralMissingDifferential:()=>dP,integralUpperBoundTypeError:()=>lT,internal:()=>z,invalidDependentFirstTableColumn:()=>UV,invalidDoubleEquality3d:()=>JI,invalidDoubleInequality3d:()=>jI,invalidDoubleInequalityVariables:()=>Ay,invalidFirstTableColumn:()=>eP,invalidFunctionName:()=>zy,invalidHalfEmptyRange:()=>sP,invalidImplicitVariables:()=>Ac,invalidImplicitVariables3d:()=>YI,invalidInequalityVariables:()=>$I,invalidIntervalComprehensionArity:()=>HP,invalidIntervalComprehensionParameter:()=>Jl,invalidIntervalComprehensionReturnType:()=>kP,invalidLHS:()=>UI,invalidNestedIntervalComprehension:()=>zP,invalidOperatorName:()=>cI,invalidRegressionParameter:()=>tP,invalidSubscript:()=>uI,invalidTableEntry:()=>Zd,invalidTableHeader:()=>KI,listComprehensionIncorrectInput:()=>vP,listComprehensionInputListTypeError:()=>SP,listTypeError:()=>vc,logScaleBoxPlot:()=>AT,logScaleDotPlot:()=>RT,logScaleHistogram:()=>NT,logScaleTypeError:()=>Yl,logbaseUnsupported:()=>MP,malformedList:()=>QT,malformedPoint:()=>JT,matrixAddDimensions:()=>KV,matrixAssignment:()=>QV,matrixElementTypeError:()=>sB,matrixFractionalPower:()=>nB,matrixInvalidVariable:()=>iB,matrixMultiplyDimensions:()=>tB,matrixPowerDimensions:()=>rB,matrixSubtractDimensions:()=>eB,maxListSize:()=>Hd,methodRequiresList:()=>so,mismatchedBraces:()=>bP,mismatchedDoubleInequality:()=>_y,mixedComparatorChain:()=>qx,mixedRestrictionEquation:()=>wT,multipleEqualityRestrictions:()=>LT,multiplyDefined:()=>Wl,multiplyTypeError:()=>Fd,multiplyTypeError2D:()=>Gx,multiplyTypeError3D:()=>kx,multiplyTypeErrorCross:()=>Bx,negativeTypeError:()=>Ux,nonArithmeticRange:()=>jd,nonListDoubleReducer:()=>Wd,nonListParameterizedReducer:()=>rP,nonSquareDeterminant:()=>qV,nonSquareInverse:()=>YV,nonSquareTrace:()=>$V,opaque:()=>wd,optimizationError:()=>nP,orTypeError:()=>Zx,parameterAlreadyDefined:()=>Sy,parenthesesUnavailable:()=>DP,pdfWrongArity:()=>HT,percentMissingOf:()=>TP,piecewiseBranchTypeError:()=>gT,piecewiseConditionTypeError:()=>fy,piecewiseMissingCondition:()=>bI,piecewisePartMissingCondition:()=>xI,pointTypeError:()=>Wx,pointsUnsupported:()=>Fc,polygonTwoNumbersError:()=>zd,polygonUnsupportedIn3d:()=>ky,primeVariableTypeError:()=>yT,primeWithoutParen:()=>Cy,primedFunctionArity:()=>Nc,productArgumentTypeError:()=>uT,productInfiniteBoundError:()=>dy,productLowerBoundTypeError:()=>oT,productMissingBody:()=>yP,productMissingBound:()=>oP,productUpperBoundTypeError:()=>aT,randomArity:()=>$T,randomFromBroadcastDistribution:()=>YT,recursionCyclicDependency:()=>Nx,recursionDoesNotTerminate:()=>Rx,recursionInRegression:()=>xT,recursiveDepthExceeded:()=>Ax,recursiveFunctionCannotDependOnFreeVariable:()=>vx,recursiveFunctionMissingBaseCase:()=>oy,recursiveFunctionMissingBaseCaseWithMetadata:()=>Sx,regressionTypeError:()=>PT,regressionsUnsupported:()=>wc,selfReferentialBaseCase:()=>CI,selfReferentialFunctions:()=>Rc,setLogInternalErrors:()=>Dx,shadowedIndex:()=>vy,shadowedIntegrationVariable:()=>By,shadowedListComprehensionInput:()=>qy,singleVariableImplicitEquationsDisabled:()=>XI,singularInverse:()=>XV,sliderLimitReferencesExport:()=>SI,sliderMaxInvalid:()=>OI,sliderMaxLessThanMin:()=>NI,sliderMinInvalid:()=>vI,sliderStepInvalid:()=>RI,substitutionAmbiguousComma:()=>yu,substitutionBodyAction:()=>aB,substitutionBodyDependsOnRegression:()=>FP,substitutionDuplicateSymbol:()=>VP,substitutionFunctionLHS:()=>af,substitutionIllegalLHS:()=>of,substitutionInvalidAssignments:()=>sf,substitutionLocalLHS:()=>wP,substitutionNested:()=>$y,substitutionRecursiveCallLHS:()=>BP,substitutionTypeError:()=>oB,substitutionUnsupportedInterval:()=>Yy,subtractTypeError:()=>Vx,sumArgumentTypeError:()=>iT,sumInfiniteBoundError:()=>py,sumLowerBoundTypeError:()=>rT,sumMissingBody:()=>mP,sumMissingBound:()=>iP,sumUpperBoundTypeError:()=>sT,superscriptWithPrime:()=>pI,tableEntryTypeError:()=>bT,tableHeaderTypeError:()=>hT,tableRegressionInvalidData:()=>IT,tableRegressionLogWithNegative:()=>HV,tableRegressionTypeError:()=>TT,tdistWrongArity:()=>qT,threeDLengthTypeError:()=>eT,tickerMinStepNonNegativeNumber:()=>DI,tokenWithSubscript:()=>tI,tooManyArguments:()=>by,tooManyVariables:()=>rn,transformationDefinitionTypeError:()=>Jx,transformationTypeError:()=>Qx,ttestListTooShort:()=>jl,unaryOperatorMissingLeft:()=>nI,unaryOperatorMissingRight:()=>rI,unexpectedEquality:()=>wx,unexpectedInequality:()=>cy,unexpectedPrime:()=>My,unexpectedSubscript:()=>lI,unexpectedSymbol:()=>ks,unexportableTableRegression:()=>qP,unplottableEqualityChain:()=>QI,unplottableLongInequalityChain:()=>$x,unplottablePolarFunction:()=>qI,unrecognizedSymbol:()=>uy,updateRuleFunctionLHS:()=>vT,updateRuleIllegalLHS:()=>ST,updateRuleLocalLHS:()=>my,updateRuleNonIdentifierLHS:()=>MT,updateRuleTypeError:()=>ET,updateRuleUndefinedLHS:()=>DT,useRForCylindricalCoordinates:()=>GI,useRhoForSphericalCoordinates:()=>BI,variableAsFunction:()=>Fy,variableLengthDistributionList:()=>rf,variableLengthIntegralDependsOnIntegrationVariable:()=>LP,variableLengthProductBodyDependsOnIndex:()=>_P,variableLengthSumBodyDependsOnIndex:()=>AP,variableLengthTopLevelList:()=>RP,variableSeed:()=>PP,variableUnsupported:()=>Hy,variablesUnsupported:()=>Kd,warnComplexImplicit:()=>Ny,writeIntegral:()=>Gy,wrongArity:()=>Ao,wrongArityLengthAsCount:()=>ZT,wrongDoubleReducerArity:()=>Ud,wrongParameterizedReducerArity:()=>WT,zeroArgReducer:()=>jT});function Md(e){return{__isLocalizableNumericValue:!0,value:e}}function WY(e){return e&&e.__isLocalizableNumericValue}function E(e,t){return{key:e,vars:t}}var ka=()=>({type:\"empty\"}),dr=()=>NV([-1/0,1/0]),aa=()=>bi([-1/0,1/0]),bi=e=>Wm(e,!0),NV=e=>Wm(e,!1),Wm=(e,t)=>isNaN(e[0])||isNaN(e[1])||e[1]<e[0]?ka():{type:\"interval\",bounds:e,tight:t};function Fs(e){return e.type===\"empty\"}function hi(e){return Fs(e)||e.tight}var Hl=(e,t)=>{if(t===0)return e>0?aa():ka();let n=-e/t,r=t<0?[-1/0,n]:[n,1/0];return bi(r)},Gn=(e,t)=>{if(Fs(e)||Fs(t))return ka();let n=[Math.max(e.bounds[0],t.bounds[0]),Math.min(e.bounds[1],t.bounds[1])],r=hi(e)&&hi(t);return Wm(n,r)},Dd=(e,t)=>{if(Fs(e))return t;if(Fs(t))return e;let n=[Math.min(e.bounds[0],t.bounds[0]),Math.max(e.bounds[1],t.bounds[1])],r;return!hi(e)&&!hi(t)?r=!1:hi(e)&&!hi(t)?r=e.bounds[0]<=t.bounds[0]&&e.bounds[1]>=t.bounds[1]:!hi(e)&&hi(t)?r=t.bounds[0]<=e.bounds[0]&&t.bounds[1]>=e.bounds[1]:r=e.bounds[0]<=t.bounds[1]&&t.bounds[0]<=e.bounds[1],Wm(n,r)},OD=(e,t,n)=>{if(Fs(e))return n;let r=Gn(e,t);return hi(e)?(e.bounds[0]>-1/0&&(r=Dd(r,Gn(bi([-1/0,e.bounds[0]]),n))),e.bounds[1]<1/0&&(r=Dd(r,Gn(bi([e.bounds[1],1/0]),n)))):r=Dd(r,Gn(n,dr())),r};function Vs(e,t,n){return{input:e,start:t,end:n}}function No(e,t){return Vs(e,t,t)}function Bs(e,t){if(e.input!==t.input)throw new Error(\"Programming Error: cannot form a span on different inputs\");return Vs(e.input,e.start,t.end)}function Yn(e){return e.input.slice(e.start,e.end)}var Ie={};ia(Ie,{Action:()=>ut,AngleMarker:()=>Le,Any:()=>Qt,Arc:()=>ie,Bool:()=>De,BroadcastableArg:()=>ey,Circle:()=>ce,Complex:()=>R,DirectedAngleMarker:()=>ye,Distribution:()=>Lt,EmptyList:()=>$e,ErrorType:()=>Ro,Line:()=>fe,ListArgType:()=>Km,ListOfAngleMarker:()=>On,ListOfAny:()=>pn,ListOfArc:()=>Fn,ListOfBool:()=>Xn,ListOfCircle:()=>Wn,ListOfColor:()=>rr,ListOfComplex:()=>Ue,ListOfDirectedAngleMarker:()=>Nn,ListOfDistribution:()=>Zn,ListOfLine:()=>jn,ListOfMapInterval2DComplex:()=>jr,ListOfMapInterval2DPoint:()=>Xr,ListOfMapInterval2DPoint3D:()=>Zr,ListOfMapIntervalComplex:()=>Wr,ListOfMapIntervalPoint:()=>$r,ListOfMapIntervalPoint3D:()=>Yr,ListOfNumber:()=>ne,ListOfNumberNC:()=>ro,ListOfPoint:()=>Pt,ListOfPoint3D:()=>fr,ListOfPolygon:()=>In,ListOfRay:()=>Vn,ListOfRestriction:()=>Gs,ListOfSegment:()=>xn,ListOfSegment3D:()=>mr,ListOfSphere3D:()=>Ar,ListOfTone:()=>cs,ListOfTransformation:()=>Rr,ListOfTriangle3D:()=>yr,ListOfVector:()=>Jn,ListOfVector3D:()=>gr,MapInterval2DComplex:()=>Mr,MapInterval2DPoint:()=>Pr,MapInterval2DPoint3D:()=>Er,MapIntervalComplex:()=>or,MapIntervalPoint:()=>sr,MapIntervalPoint3D:()=>ir,NoCoerceComplexToReal:()=>Od,Number:()=>I,NumberNC:()=>Te,Point:()=>N,Point3D:()=>H,Polygon:()=>xe,RGBColor:()=>Kt,Ray:()=>Ne,Restriction:()=>Gt,SeedType:()=>ft,Segment:()=>de,Segment3D:()=>wt,Sphere3D:()=>Hn,Tone:()=>Pn,Transformation:()=>Re,Triangle3D:()=>Rn,TupleTypeMap:()=>zl,UNKNOWN_RETURN_TYPE:()=>FV,Union:()=>Qn,Vector:()=>le,Vector3D:()=>ke,allListTypes:()=>ii,allTupleTypes:()=>hx,allValueTypes:()=>RV,angleTypes:()=>Tx,assertTypeIsOneOf:()=>za,broadcastArg:()=>oi,broadcastable:()=>Ae,commonCoerceableType:()=>fu,commonCoerceableTypeWithBroadcast:()=>Ha,elementType:()=>Ve,getAllowedTypesForArg:()=>Rd,hasListType:()=>wn,hasMapType:()=>Ix,isEligibleForBroadcast:()=>ty,isGeometryType:()=>Sd,isList:()=>j,isMapOrListOfMap:()=>ua,isMultipliableElementType:()=>bx,isOneOf:()=>vd,isSubType:()=>_i,isSubTypeOrCoercible:()=>kn,isSubTypeOrNonComplexCoercible:()=>Ec,isSummableElementType:()=>$l,isTypeOrListOfType:()=>se,isValidOnLogScales:()=>Ul,listArg:()=>Nd,listType:()=>vn,mapType:()=>Px,multipliableElementTypes:()=>Jm,prettyPrint:()=>oe,repr:()=>at,signature:()=>kt,straightTypes:()=>Qm,summableElementTypes:()=>ql,typeSatisfiesArgType:()=>ny,typeSatisfiesArgTypeUncoerced:()=>Mc,valueTypes:()=>RD,variadicMinCount:()=>_r,vectorTypes:()=>xx});function jm(e,t){return t?vn(e):e}function _i(e,t){return e===$e&&j(t)||t===pn&&j(e)||t===Qt&&!j(e)?!0:e===t}function kn(e,t){if(e===void 0)return!1;if(_i(e,t))return!0;j(e)&&j(t)&&t!==$e&&(e=Ve(e),t=Ve(t));let n=t;switch(e){case Le:case ye:case Gt:case I:case R:return n===I||n===R;default:return!1}}function Ec(e,t){return t===I&&e===R||t===ne&&e===Ue?!1:kn(e,t)}function fu(e,t){if(_i(e,t))return t;if(_i(t,e))return e;let n=j(e);if(n!=j(t))return;let r=jm(R,n);if(e===r&&kn(t,r))return r;if(t===r&&kn(e,r))return r;let s=jm(I,n);if(kn(e,s)&&kn(t,s)){let i=jm(Le,n),o=jm(ye,n);return e===i&&t===o||e===o&&t===i?void 0:s}}function Ha(e,t){return j(e)&&wn(t)?fu(e,vn(t)):wn(e)&&j(t)?fu(vn(e),t):fu(e,t)}var Qt=0,I=1,De=2,N=3,Lt=4,ut=5,pn=6,ne=7,Xn=8,Pt=9,Zn=10,$e=11,Ro=12,ft=13,Kt=14,rr=15,xe=16,In=17,de=18,xn=19,ce=20,Wn=21,ie=22,Fn=23,fe=24,jn=25,Ne=26,Vn=27,Le=28,On=29,ye=30,Nn=31,Re=32,Rr=33,le=34,Jn=35,Gt=36,Gs=37,R=38,Ue=39,Pn=50,cs=51,H=100,fr=101,wt=102,mr=103,Rn=104,yr=105,Hn=106,Ar=107,ke=108,gr=109,sr=200,ir=201,Pr=202,Er=203,$r=204,Yr=205,Xr=206,Zr=207,or=208,Mr=209,Wr=210,jr=211,RD={Any:Qt,Number:I,Bool:De,Complex:R,ListOfComplex:Ue,Point:N,Point3D:H,Distribution:Lt,Action:ut,ListOfAny:pn,ListOfNumber:ne,ListOfBool:Xn,ListOfPoint:Pt,ListOfPoint3D:fr,ListOfDistribution:Zn,EmptyList:$e,ErrorType:Ro,SeedType:ft,RGBColor:Kt,ListOfColor:rr,Polygon:xe,ListOfPolygon:In,Segment:de,ListOfSegment:xn,Circle:ce,ListOfCircle:Wn,Arc:ie,ListOfArc:Fn,Line:fe,ListOfLine:jn,Ray:Ne,ListOfRay:Vn,Vector:le,ListOfVector:Jn,Restriction:Gt,ListOfRestriction:Gs,AngleMarker:Le,ListOfAngleMarker:On,DirectedAngleMarker:ye,ListOfDirectedAngleMarker:Nn,Transformation:Re,ListOfTransformation:Rr,Segment3D:wt,ListOfSegment3D:mr,Triangle3D:Rn,ListOfTriangle3D:yr,Sphere3D:Hn,ListOfSphere3D:Ar,Vector3D:ke,ListOfVector3D:gr,Tone:Pn,ListOfTone:cs,MapIntervalPoint:sr,MapIntervalComplex:or,MapIntervalPoint3D:ir,MapInterval2ToPoint:Pr,MapInterval2ToComplex:Mr,MapInterval2DPoint3D:Er,ListOfMapIntervalPoint:$r,ListOfMapIntervalComplex:Wr,ListOfMapIntervalPoint3D:Yr,ListOfMapInterval2ToPoint:Xr,ListOfMapInterval2ToComplex:jr,ListOfMapInterval2DPoint3D:Zr},zl={[N]:[I,I],[H]:[I,I,I],[R]:[I,I]},Qn=class e{constructor(t,{coerceComplexToReal:n}){this.types=t;this.coerceComplexToReal=n}static of(t,n={coerceComplexToReal:!0}){return new e(t,n)}getTypes(){return this.types}},RV=Object.values(RD),AV=Object.keys(zl).map(parseFloat),hx=Qn.of(AV);function at(e){switch(e){case Qt:return\"Any\";case I:return\"Number\";case De:return\"Bool\";case R:return\"Complex\";case N:return\"Point\";case H:return\"Point3D\";case Lt:return\"Distribution\";case ut:return\"Action\";case pn:return\"ListOfAny\";case ne:return\"ListOfNumber\";case Xn:return\"ListOfBool\";case Ue:return\"ListOfComplex\";case Pt:return\"ListOfPoint\";case fr:return\"ListOfPoint3D\";case Zn:return\"ListOfDistribution\";case $e:return\"EmptyList\";case Ro:return\"ErrorType\";case ft:return\"SeedType\";case Kt:return\"RGBColor\";case rr:return\"ListOfColor\";case xe:return\"Polygon\";case In:return\"ListOfPolygon\";case de:return\"Segment\";case xn:return\"ListOfSegment\";case ce:return\"Circle\";case Wn:return\"ListOfCircle\";case ie:return\"Arc\";case Fn:return\"ListOfArc\";case fe:return\"Line\";case jn:return\"ListOfLine\";case Ne:return\"Ray\";case Vn:return\"ListOfRay\";case le:return\"Vector\";case Jn:return\"ListOfVector\";case Gt:return\"Restriction\";case Gs:return\"ListOfRestriction\";case Le:return\"Angle\";case On:return\"ListOfAngle\";case ye:return\"DirectedAngle\";case Nn:return\"ListOfDirectedAngle\";case Re:return\"Transformation\";case Rr:return\"ListOfTransformation\";case wt:return\"Segment3D\";case mr:return\"ListOfSegment3D\";case ke:return\"Vector3D\";case gr:return\"ListOfVector3D\";case Rn:return\"Triangle3D\";case yr:return\"ListOfTriangle3D\";case Hn:return\"Sphere3D\";case Ar:return\"ListOfSphere3D\";case Pn:return\"Tone\";case cs:return\"ListOfTone\";case sr:return\"MapIntervalPoint\";case or:return\"MapIntervalComplex\";case ir:return\"MapIntervalPoint3D\";case Pr:return\"MapInterval2ToPoint\";case Mr:return\"MapInterval2ToComplex\";case Er:return\"MapInterval2DPoint3D\";case $r:return\"ListOfMapIntervalPoint\";case Wr:return\"ListOfMapIntervalComplex\";case Yr:return\"ListOfMapIntervalPoint3D\";case Xr:return\"ListOfMapInterval2ToPoint\";case jr:return\"ListOfMapInterval2ToComplex\";case Zr:return\"ListOfMapInterval2DPoint3D\";default:let t=e;throw new Error(`Invalid type: ${t}`)}}function oe(e,t){var r;let n=(r=t==null?void 0:t.specifyPointDimensions)!=null?r:!1;switch(e){case Qt:return E(\"shared-calculator-label-value-type-any\");case I:return E(\"shared-calculator-label-value-type-number\");case De:return E(\"shared-calculator-label-value-type-bool\");case R:return E(\"shared-calculator-label-value-type-complex\");case N:return n?E(\"shared-calculator-label-value-type-point2d\"):E(\"shared-calculator-label-value-type-point\");case H:return E(\"shared-calculator-label-value-type-point3d\");case Lt:return E(\"shared-calculator-label-value-type-distribution\");case ut:return E(\"shared-calculator-label-value-type-action\");case pn:return E(\"shared-calculator-label-value-type-list-of-any\");case ne:return E(\"shared-calculator-label-value-type-list-of-numbers\");case Xn:return E(\"shared-calculator-label-value-type-list-of-bool\");case Ue:return E(\"shared-calculator-label-value-type-list-of-complex\");case Pt:return n?E(\"shared-calculator-label-value-type-list-of-2d-points\"):E(\"shared-calculator-label-value-type-list-of-points\");case fr:return E(\"shared-calculator-label-value-type-list-of-3d-points\");case Zn:return E(\"shared-calculator-label-value-type-list-of-distributions\");case $e:return E(\"shared-calculator-label-value-type-empty-list\");case Ro:return E(\"shared-calculator-label-value-type-error\");case ft:return E(\"shared-calculator-label-value-type-seed\");case Kt:return E(\"shared-calculator-label-value-type-color\");case rr:return E(\"shared-calculator-label-value-type-list-of-colors\");case xe:return E(\"shared-calculator-label-value-type-polygon\");case In:return E(\"shared-calculator-label-value-type-list-of-polygons\");case de:return E(\"shared-calculator-label-value-type-segment\");case xn:return E(\"shared-calculator-label-value-type-list-of-segments\");case ce:return E(\"shared-calculator-label-value-type-circle\");case Wn:return E(\"shared-calculator-label-value-type-list-of-circles\");case ie:return E(\"shared-calculator-label-value-type-arc\");case Fn:return E(\"shared-calculator-label-value-type-list-of-arcs\");case fe:return E(\"shared-calculator-label-value-type-line\");case jn:return E(\"shared-calculator-label-value-type-list-of-lines\");case Ne:return E(\"shared-calculator-label-value-type-ray\");case Vn:return E(\"shared-calculator-label-value-type-list-of-rays\");case le:return E(\"shared-calculator-label-value-type-vector\");case Jn:return E(\"shared-calculator-label-value-type-list-of-vectors\");case Gt:return E(\"shared-calculator-label-value-type-restriction\");case Gs:return E(\"shared-calculator-label-value-type-list-of-restrictions\");case Le:return E(\"shared-calculator-label-value-type-angle\");case On:return E(\"shared-calculator-label-value-type-list-of-angles\");case ye:return E(\"shared-calculator-label-value-type-directed-angle\");case Nn:return E(\"shared-calculator-label-value-type-list-of-directed-angles\");case Re:return E(\"shared-calculator-label-value-type-transformation\");case Rr:return E(\"shared-calculator-label-value-type-list-of-transformations\");case wt:return E(\"shared-calculator-label-value-type-segment3d\");case mr:return E(\"shared-calculator-label-value-type-list-of-segment3d\");case ke:return E(\"shared-calculator-label-value-type-vector3d\");case gr:return E(\"shared-calculator-label-value-type-list-of-vector3d\");case Rn:return E(\"shared-calculator-label-value-type-triangle3d\");case yr:return E(\"shared-calculator-label-value-type-list-of-triangle3d\");case Hn:return E(\"shared-calculator-label-value-type-sphere3d\");case Ar:return E(\"shared-calculator-label-value-type-list-of-sphere3d\");case Pn:return E(\"shared-calculator-label-value-type-tone\");case cs:return E(\"shared-calculator-label-value-type-list-of-tone\");case sr:case Pr:return E(\"shared-calculator-label-value-type-lambda-point\");case or:case Mr:return E(\"shared-calculator-label-value-type-lambda-complex\");case ir:case Er:return E(\"shared-calculator-label-value-type-lambda-point3d\");case $r:case Xr:return E(\"shared-calculator-label-value-type-list-of-lambda-point\");case Wr:case jr:return E(\"shared-calculator-label-value-type-list-of-lambda-complex\");case Yr:case Zr:return E(\"shared-calculator-label-value-type-list-of-lambda-point3d\");default:let s=e;throw new Error(`Invalid type: ${s}`)}}var _V=[pn,ne,Xn,Ue,Gs,Pt,fr,Zn,$e,rr,In,xn,Wn,Fn,jn,Vn,Jn,On,Nn,Rr,mr,gr,yr,Ar,cs,$r,Wr,Yr,Xr,jr,Zr],ii=Qn.of(_V,{coerceComplexToReal:!1}),eX={[pn]:Qt,[$e]:I,[ne]:I,[Xn]:De,[Ue]:R,[Gs]:Gt,[Pt]:N,[fr]:H,[Zn]:Lt,[rr]:Kt,[In]:xe,[xn]:de,[Wn]:ce,[Fn]:ie,[jn]:fe,[Vn]:Ne,[Jn]:le,[On]:Le,[Nn]:ye,[Rr]:Re,[mr]:wt,[gr]:ke,[yr]:Rn,[Ar]:Hn,[cs]:Pn,[$r]:sr,[Wr]:or,[Yr]:ir,[Xr]:Pr,[jr]:Mr,[Zr]:Er};function j(e){switch(e){case void 0:return!1;case pn:case ne:case Xn:case Ue:case Gs:case Pt:case fr:case Zn:case rr:case In:case xn:case Wn:case Fn:case jn:case Vn:case Jn:case On:case Nn:case Rr:case mr:case gr:case yr:case Ar:case cs:case $r:case Wr:case Yr:case Xr:case jr:case Zr:return!0;case $e:return!0;case Qt:case I:case De:case R:case Gt:case N:case H:case Lt:case Ro:case ft:case Kt:case ut:case xe:case de:case ce:case ie:case fe:case Ne:case le:case Le:case ye:case Re:case wt:case ke:case Rn:case Pn:case Hn:case sr:case or:case ir:case Pr:case Mr:case Er:return!1;default:throw new Error(`Invalid type: ${e}`)}}function Ve(e){switch(e){case $e:case ne:return I;case Xn:return De;case Ue:return R;case Gs:return Gt;case Pt:return N;case fr:return H;case Zn:return Lt;case rr:return Kt;case In:return xe;case mr:return wt;case gr:return ke;case yr:return Rn;case Ar:return Hn;case pn:return Qt;case xn:return de;case Wn:return ce;case Fn:return ie;case jn:return fe;case Vn:return Ne;case Jn:return le;case On:return Le;case Nn:return ye;case Rr:return Re;case cs:return Pn;case $r:return sr;case Wr:return or;case Yr:return ir;case Xr:return Pr;case jr:return Mr;case Zr:return Er;case Qt:case I:case De:case R:case N:case H:case Lt:case Ro:case ft:case Kt:case ut:case xe:case de:case ce:case ie:case fe:case Ne:case le:case Gt:case Le:case ye:case Re:case wt:case ke:case Rn:case Hn:case Pn:case sr:case or:case ir:case Pr:case Mr:case Er:throw new Error(\"Type \"+at(e)+\" does not implement elementType.\");default:let t=e;throw new Error(`Invalid type: ${t}`)}}function vn(e){switch(e){case Qt:return pn;case I:return ne;case De:return Xn;case R:return Ue;case Gt:return Gs;case N:return Pt;case H:return fr;case Lt:return Zn;case Kt:return rr;case xe:return In;case de:return xn;case ce:return Wn;case ie:return Fn;case fe:return jn;case Ne:return Vn;case le:return Jn;case Le:return On;case ye:return Nn;case Re:return Rr;case wt:return mr;case ke:return gr;case Rn:return yr;case Hn:return Ar;case Pn:return cs;case sr:return $r;case or:return Wr;case ir:return Yr;case Pr:return Xr;case Mr:return jr;case Er:return Zr;case $e:case ne:case Xn:case Ue:case Gs:case Pt:case fr:case Zn:case rr:case In:case xn:case Wn:case Fn:case jn:case Vn:case Jn:case On:case Nn:case Rr:case mr:case gr:case yr:case Ar:case pn:case cs:case Ro:case ft:case ut:case $r:case Wr:case Yr:case Xr:case jr:case Zr:throw new Error(\"Type \"+at(e)+\" does not implement listType.\");default:let t=e;throw new Error(`Invalid type: ${t}`)}}function wn(e){switch(e){case Qt:case I:case De:case R:case Gt:case N:case H:case Lt:case Kt:case xe:case de:case ce:case ie:case fe:case Ne:case le:case Le:case ye:case Re:case wt:case ke:case Rn:case Hn:case Pn:case sr:case or:case ir:case Pr:case Mr:case Er:return!0;case $e:case ne:case Xn:case Ue:case Gs:case Pt:case fr:case Zn:case rr:case In:case xn:case Wn:case Fn:case jn:case Vn:case Jn:case On:case Nn:case Rr:case mr:case gr:case yr:case Ar:case pn:case cs:case $r:case Wr:case Yr:case Xr:case jr:case Zr:case ft:case ut:case Ro:return!1;default:throw new Error(`Invalid type: ${e}`)}}function Sd(e){if(e===void 0)return!1;switch(e){case N:case xe:case de:case ce:case ie:case fe:case Ne:case le:case Le:case ye:case Re:return!0;default:return!1}}function Ul(e){switch(e){case I:case Qt:case De:case R:case Gt:case N:case Lt:case ut:case pn:case ne:case Xn:case Ue:case Gs:case Pt:case Zn:case $e:case Ro:case ft:case Kt:case rr:case Pn:case cs:return!0;case H:case fr:case wt:case mr:case ke:case gr:case Rn:case yr:case Hn:case Ar:case xe:case In:case de:case xn:case ce:case Wn:case ie:case Fn:case fe:case jn:case Ne:case Vn:case le:case Jn:case Le:case On:case ye:case Nn:case Re:case Rr:case sr:case or:case ir:case Pr:case Mr:case Er:case $r:case Wr:case Yr:case Xr:case jr:case Zr:return!1;default:let t=e;throw new Error(`Invalid type: ${t}`)}}function vd(e,t){for(let n of t)if(e===n)return!0;return!1}var ql=[I,R,N,H];function $l(e){return ql.includes(e)}var Jm=[I,R];function bx(e){return Jm.includes(e)}var Qm=Qn.of([fe,Ne,de,le]),xx=Qn.of([le,ke]),Tx=Qn.of([Le,ye]);function se(e,t){return e===void 0?!1:e===t?!0:j(e)?e===$e?!0:Ve(e)===t:!1}function ua(e){return vd(e,[sr,or,ir,Pr,Mr,Er,$r,Wr,Yr,Xr,jr,Zr])}var AD={[N]:sr,[R]:or,[H]:ir},LV={[N]:Pr,[R]:Mr,[H]:Er};function Ix(e){return AD[e]!==void 0}function Px(e,t){let n=t===1?AD[e]:LV[e];if(n===void 0)throw new Error(`Unexpected return type for map: ${at(e)}`);return n}function za(e,t){if(!vd(e,t))throw new Error(`Programming error: expected one of ${t.map(at)} but found ${e&&at(e)} instead.`)}var FV=Symbol(\"UNKNOWN_RETURN_TYPE\");function _D(e){return typeof e==\"object\"&&e.type===\"variadic\"}function _r(e,t){return{type:\"variadic\",initial:new Array(t).fill(e),rest:e}}var Ex=class{constructor(t,n){this.argTypes=t;this.productContext=n;this.minArity=this.argTypes.length,this.maxArity=this.argTypes.length}argTypeAtIndex(t){if(!(t>this.argTypes.length-1))return this.argTypes[t]}matches(t){return LD(this,t)}satisfiesPolicy(t){return t.is3dProduct()?this.productContext[\"3d\"]:t.isGeometryEnabled()?this.productContext.geometry:this.productContext.graphing}},Mx=class{constructor(t,n){this.productContext=n;this.maxArity=void 0;this.initial=t.initial,this.rest=t.rest,this.minArity=this.initial.length}argTypeAtIndex(t){return t<this.initial.length?this.initial[t]:this.rest}matches(t){return LD(this,t)}satisfiesPolicy(t){return t.is3dProduct()?this.productContext[\"3d\"]:t.isGeometryEnabled()?this.productContext.geometry:this.productContext.graphing}};function LD(e,t){return e.maxArity!==void 0&&e.maxArity<t.length?!1:!!t.every((n,r)=>{if(n===void 0)return!0;let s=e.argTypeAtIndex(r);return s===void 0?!1:ny(n,s)})}var Od=class{constructor(t){this.arg=t;this.coerceComplexToReal=!1}getTypes(){return typeof this.arg==\"number\"?[this.arg]:this.arg.getTypes()}},Te=new Od(I),ro=new Od(ne),Km=class{constructor(t){typeof t==\"number\"?(this.coerceComplexToReal=t===I,this.nodeTypes=[vn(t)]):(this.coerceComplexToReal=t.coerceComplexToReal,this.nodeTypes=t.getTypes().map(vn))}getTypes(){return this.nodeTypes}};function Nd(e){return new Km(e)}var ey=class{constructor(t){if(typeof t==\"number\")this.coerceComplexToReal=t===I,this.nodeTypes=[t,vn(t)];else{this.coerceComplexToReal=t.coerceComplexToReal,this.nodeTypes=[];for(let n of t.getTypes())this.nodeTypes.push(n,vn(n))}}getTypes(){return this.nodeTypes}};function ty(e){return typeof e==\"number\"?wn(e):e instanceof Qn?e.types.every(ty):!1}function oi(e){return new ey(e)}function kt(e,t={}){let n={geometry:!0,\"3d\":!0,graphing:!0,...t};return _D(e)?new Mx(e,n):new Ex(e,n)}function Ae(e,t={}){return _D(e)?kt({type:\"variadic\",initial:e.initial.map(oi),rest:oi(e.rest)},t):kt(e.map(oi),t)}function ny(e,t){if(typeof t==\"number\")return kn(e,t);{let n=t.getTypes();return t.coerceComplexToReal?n.some(r=>kn(e,r)):n.some(r=>Ec(e,r))}}function Mc(e,t){return typeof t==\"number\"?_i(e,t):t.getTypes().some(r=>_i(e,r))}function Rd(e,t){let n=new Set;for(let r of e){let s=r.argTypeAtIndex(t);if(s===void 0)continue;let i=VV(s);for(let o of i)n.add(o)}return[...n]}function VV(e){return typeof e==\"number\"?[e]:e.getTypes()}function BV(e){return!e||e[0].type===\"none\"&&e[1].type===\"none\"?\"NONE\":e[1].type===\"none\"?\"X\":e[0].type===\"none\"?\"Y\":\"XY\"}function wD(e,t){let n=BV(t);switch(e){case\"NONE\":return\"NONE\";case\"AUTO\":return n;case\"XY\":return n;case\"X\":return n===\"X\"||n===\"XY\"?\"X\":\"NONE\";case\"Y\":return n===\"Y\"||n===\"XY\"?\"Y\":\"NONE\";default:return\"NONE\"}}var Yt=class{constructor(){this.localFrameID=void 0;this._dependencies=[],this._optionalDependencies=[],this._updateSymbols=[],this._scope={definitions:[],dependencies:[],substitutionDependencies:[],scopes:[]},this._exports=[],this.metaData={extraDepNodes:[]},this.userData={}}getDefaultDragMode(t){return\"NONE\"}setInputSpan(t){this._inputSpan=t}getInputString(){return this._inputSpan===void 0?\"\":Yn(this._inputSpan)}getInputSpan(){return this._inputSpan}shouldExportAns(){return!1}getAnsVariable(){return this.shouldExportAns()&&this.userData&&this.userData.hasOwnProperty(\"index\")?[\"ans_\"+this.userData.index]:[]}addDependency(t){this._dependencies.indexOf(t)===-1&&this._dependencies.push(t),this._scope.dependencies.indexOf(t)===-1&&this._scope.dependencies.push(t)}addDependencies(t){for(let n=0;n<t.length;n++)this.addDependency(t[n])}addOptionalDependencies(t){for(let n=0;n<t.length;n++){let r=t[n];this._dependencies.indexOf(r)===-1&&this._dependencies.push(r),this._optionalDependencies.indexOf(r)===-1&&this._optionalDependencies.push(r)}}addUpdateSymbol(t){this._dependencies.indexOf(t)===-1&&this._dependencies.push(t),this._updateSymbols.indexOf(t)===-1&&this._updateSymbols.push(t)}addSubstitutionDependencies(t){for(let n=0;n<t.length;n++){let r=t[n];if(this._dependencies.indexOf(r)===-1)throw new Error(\"Programming error: substitution dependency \"+r+\" must also be registered as a regular dependency\");this._scope.substitutionDependencies.indexOf(r)===-1&&this._scope.substitutionDependencies.push(r)}}mergeDependencies(...t){for(let n=0;n<t.length;n++){let r=t[n];for(let s=0;s<r._dependencies.length;s++)this._dependencies.indexOf(r._dependencies[s])===-1&&this._dependencies.push(r._dependencies[s]);for(let s=0;s<r._updateSymbols.length;s++)this._updateSymbols.indexOf(r._updateSymbols[s])===-1&&this._updateSymbols.push(r._updateSymbols[s]);for(let s=0;s<r._scope.dependencies.length;s++)this._scope.dependencies.indexOf(r._scope.dependencies[s])===-1&&this._scope.dependencies.push(r._scope.dependencies[s]);for(let s=0;s<r._scope.substitutionDependencies.length;s++)this._scope.substitutionDependencies.indexOf(r._scope.substitutionDependencies[s])===-1&&this._scope.substitutionDependencies.push(r._scope.substitutionDependencies[s]);this.addOptionalDependencies(r.getOptionalDependencies()),Array.prototype.push.apply(this._scope.scopes,r._scope.scopes)}}mergeDependenciesInScope(t,n,r,s){let i=r.getScope(),o={kind:t,definitions:n,dependencies:i.dependencies,substitutionDependencies:i.substitutionDependencies,scopes:i.scopes,functionDefinitionSymbol:s==null?void 0:s.functionDefinitionSymbol};this._scope.scopes.push(o);for(let a=0;a<r._dependencies.length;a++){let u=r._dependencies[a];!n.includes(u)&&!this._dependencies.includes(u)&&this._dependencies.push(u)}for(let a=0;a<r._updateSymbols.length;a++)this._updateSymbols.indexOf(r._updateSymbols[a])===-1&&this._updateSymbols.push(r._updateSymbols[a]);this.addOptionalDependencies(r.getOptionalDependencies())}getDependencies(){return this._dependencies}graphmodeDependencies(t,n){return this.getDependencies()}getOptionalDependencies(){return this._optionalDependencies}getUpdateSymbols(){return this._updateSymbols}getScope(){return this._scope}dependsOn(t){return this._dependencies.indexOf(t)>-1}getExports(t){let n=this._exports||[];if(this.userData&&\"id\"in this.userData){let r=this.userData.id;n=n.concat([\"idref_\"+r])}return t.ansEnabled()&&(n=n.concat(this.getAnsVariable())),n}getLegalExports(t){return this.getExports(t).filter(n=>!t.assignmentForbidden(n))}exportsSymbol(t){return this._exports.indexOf(t)>-1}exportTo(t,n,r){let s=[],i=this.getLegalExports(t);for(let o=0;o<i.length;o++){let a=i[o];if(r[a])return s;r[a]=n.blocksExport?n:this,s.push(a)}return s}getOperator(){return this.operator||\"=\"}isInequality(){return!1}isShadeBetween(){return!1}getEvaluationInfo(){return!1}shouldPromoteToSlider(t){return!1}getSliderVariables(t,n,r){let s=t.sliderVariables(r!=null?r:n.getDependencies());return n.valueType===N||n.valueType===Pt||n.valueType===H||n.valueType===fr||n.valueType===R||n.valueType===Ue?t.is3dPolicy()?s.includes(\"t\")&&!s.includes(\"u\")&&!s.includes(\"v\")?s.filter(i=>i!=\"t\"):!s.includes(\"t\")&&(s.includes(\"u\")||s.includes(\"v\"))?s.filter(i=>i!=\"u\"&&i!=\"v\"):s:s.filter(i=>!t.validParametricVariable(i)):s}getCompiledDerivative(){let t=this.getDependencies();return this.takeDerivative(t[0]||\"x\").getCompiledFunction()}asValue(){}boundDomain(t){return dr()}getCursorContext(){}polynomialOrder(t){}getPolynomialCoefficients(t){}asTypedValue(){}asCompilerValue(){}substitute(t){}getExpressionType(t,n){}tableInfo(t,n){}analyze(t,n,r){throw z(`Node ${this.type} does not define analyze.`)}analyzeFourFunction(t,n,r){}analyzeScientific(t,n,r){}analyzeSingleExpressionScientific(t,n,r){}getGraphMode(t,n){}getMoveStrategy(t,n,r,s){}};var v=class extends Yt{constructor(n){super();this.isError=!0;this._msg=n,this.blocksExport=!0}evaluateOnce(n){return this._msg}getError(){return this._msg}setDependencies(n){return this.addDependencies(n),this}setActionValue(n){this.actionValue=n}allowExport(){return this.blocksExport=!1,this}setCursorContext(n){this.cursorContext=n}getCursorContext(){return this.cursorContext}};var Ad={real:!0,imag:!0,conj:!0,arg:!0},FD=Object.keys(Ad);var Cc=class{constructor(t){this.singleExpression=t.singleExpression}isGeometryEnabled(){return!1}is3dProduct(){return!1}is3dPolicy(){return!1}isComplexEnabled(){return!1}isRecursionEnabled(){return!1}polygonUnsupportedPreferTriangle(){return!1}areAllScalesLinear(){return!0}assignmentForbidden(t){return t.slice(0,3)!==\"ans\"}isValidSlider(t){return!1}sliderVariables(){return[]}graphingEnabled(){return!1}ansEnabled(){return!this.singleExpression}dimensionVarsEnabled(){return!1}disabledFeatures(){return[\"Sum\",\"Product\",\"Integral\",\"List\",\"Derivative\",\"Piecewise\",\"Restriction\",\"Norm\",\"Exponent\",\"PercentOf\",\"Substitution\"]}shouldIncludeFunctionParametersInRandomSeed(){return!0}};var iy=!1;function Dx(e){iy=e}function GV(){return iy}function kV(...e){iy&&console.error(...e)}function z(e){if(iy){let t=e instanceof Error?e:new Error(`${e}`);return kV(t.stack),new v(E(\"shared-calculator-error-internal-error\",{msg:t.message}))}return new v(E(\"shared-calculator-error-parse-error\"))}function oy(e){let t=e.length,n=e[0];return new v(E(\"shared-calculator-error-recursion-missing-base-case\",{count:Md(t),lastSymbol:X(n),symbols:e.slice(1).map(r=>X(r)).join(\"', '\")}))}function Sx(e,t){let n=oy(e);return n.recursionMetadata=t,n}function vx(e){return new v(E(\"shared-calculator-error-recursion-base-case-free-variable\",{freeVariable:X(e)}))}function Ox(e){return new v(E(\"shared-calculator-error-recursion-base-case-free-variable\",{freeVariable:X(e)}))}function _d({blockExport:e}){let t=new v(E(\"shared-calculator-error-recursion-base-case-same-type\"));return e||t.allowExport(),t}function Ld(){return new v(E(\"shared-calculator-error-recursion-base-case-too-complicated\"))}function ay(){return new v(E(\"shared-calculator-error-recursion-base-case-argument-non-number\"))}function Nx(){return new v(E(\"shared-calculator-error-recursion-does-not-terminate\"))}function Rx(){return new v(E(\"shared-calculator-error-recursion-does-not-terminate\"))}function Ax(){return new v(E(\"shared-calculator-error-recursion-depth-limit-exceeded\"))}function _x(e,t){return new v(E(\"shared-calculator-error-recursion-wrong-arity\",{fnSymbol:X(e),count:Md(t)}))}function Lx(e,t,n,{blockExport:r}){let s=new v(E(\"shared-calculator-error-recursion-argument-type\",{index:e+1,expectedType:t,foundType:n}));return r||s.allowExport(),s}function wd(){return new v(E(\"shared-calculator-error-parse-error\"))}function uy(e){return e=X(e),new v(E(\"shared-calculator-error-unrecognized-symbol\",{symbol:e}))}function cy(){return new v(E(\"shared-calculator-error-unexpected-inequality\"))}function wx(){return new v(E(\"shared-calculator-error-unexpected-equality\"))}function ks(e){return e=X(e),new v(E(\"shared-calculator-error-unexpected-symbol\",{symbol:e}))}function Fx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-add-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Vx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-subtract-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Fd(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-multiply-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Bx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-multiply-type-error-cross\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Gx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-multiply-type-error-2d\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function kx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-multiply-type-error-3d\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Hx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-divide-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function zx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-exponent-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Ux(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-negative-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function qx(){return new v(E(\"shared-calculator-error-mixed-comparator-chain\"))}function $x(){return new v(E(\"shared-calculator-error-unplottable-long-inequality-chain\"))}function Yx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-comparator-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Xx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-operator-type-error\",{symbol:\"and\",symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Zx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-operator-type-error\",{symbol:\"or\",symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function vc(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-list-type-error\",{symbol1:e[0]}));return t||n.allowExport(),n}function Wx(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-point-type-error\",{symbol1:e,symbol2:oe(N)}));return t||n.allowExport(),n}function Vd(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-index-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function jx(e,t,{blockExport:n}){let r=new v(E(\"shared-calculator-error-coordinate-access-type-error\",{coordinate:t,symbol:e[0]}));return n||r.allowExport(),r}function Hs(e,t,{blockExport:n}){let r;switch(t.length){case 1:r=new v(E(\"shared-calculator-error-function-type-error-1\",{fn:X(e),arg:t[0]}));break;case 2:r=new v(E(\"shared-calculator-error-function-type-error-2\",{fn:X(e),arg1:t[0],arg2:t[1]}));break;default:r=new v(E(\"shared-calculator-error-function-type-error-many\",{fn:X(e)}));break}return n||r.allowExport(),r}var Cx={translate:\"translation\",rotate:\"rotation\",dilate:\"dilation\",reflect:\"reflection\"};function Jx(e,t,n,{blockExport:r}){let s=[];if(n.maxArity===void 0)return Hs(e,t,{blockExport:r});for(let a=1;a<n.argTypes.length;a++){let u=n.argTypes[a];typeof u==\"number\"?s.push(oe(u)):s.push(oe(u.getTypes()[0]))}let i=\"\";switch(s.length){case 1:i=E(t.length>s.length?\"shared-calculator-error-transformation-definition-expected-types-use-fewer-1\":\"shared-calculator-error-transformation-definition-expected-types-1\",{arg:s[0]});break;case 2:i=E(t.length>s.length?\"shared-calculator-error-transformation-definition-expected-types-use-fewer-2\":\"shared-calculator-error-transformation-definition-expected-types-2\",{arg1:s[0],arg2:s[1]});break}let o;switch(t.length){case 1:o=new v(E(t.length<s.length?\"shared-calculator-error-transformation-definition-type-error-use-more-1\":\"shared-calculator-error-transformation-definition-type-error-1\",{fn:X(Cx[e]),arg:t[0],expectedTypeMessage:i}));break;case 2:o=new v(E(t.length<s.length?\"shared-calculator-error-transformation-definition-type-error-use-more-2\":\"shared-calculator-error-transformation-definition-type-error-2\",{fn:X(Cx[e]),arg1:t[0],arg2:t[1],expectedTypeMessage:i}));break;default:o=new v(E(\"shared-calculator-error-transformation-definition-type-error-many\",{fn:X(Cx[e])}));break}return r||o.allowExport(),o}function Qx(e,t,{blockExport:n}){let r;switch(t.length){case 1:r=new v(E(\"shared-calculator-error-transformation-type-error-1\",{fn:X(e),arg:t[0]}));break;case 2:r=new v(E(\"shared-calculator-error-transformation-type-error-2\",{fn:X(e),arg1:t[0],arg2:t[1]}));break;default:r=new v(E(\"shared-calculator-error-transformation-type-error-many\",{fn:X(e)}));break}return n||r.allowExport(),r}function Kx(e,t,{blockExport:n}){let r=X(e),s=X(\"count\"),i=new v(E(\"shared-calculator-error-geometry-length-type-error\",{fn:r,alternativeFn:s,arg:t}));return n||i.allowExport(),i}function eT(e,t,{blockExport:n}){let r=X(e),s=X(\"count\"),i=new v(E(\"shared-calculator-error-3d-length-type-error\",{fn:r,alternativeFn:s,arg:t}));return n||i.allowExport(),i}function Bd(e){return new v(E(\"shared-calculator-error-illegal-dot-call\",{symbol:X(e)}))}function tT(e,t,{blockExport:n}){let r=new v(E(\"shared-calculator-error-dot-lhs-type-error\",{symbol:X(e),type:t}));return n||r.allowExport(),r}function ly(){return new v(E(\"shared-calculator-error-dot-lhs-constant-number\"))}function nT(e){return new v(E(\"shared-calculator-error-dot-rhs-property-error\",{symbol:X(e)}))}function rT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-sum-lower-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function sT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-sum-upper-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function py(){return new v(E(\"shared-calculator-error-sum-infinite-bound-type-error\"))}function iT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-sum-argument-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function oT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-product-lower-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function aT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-product-upper-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function dy(){return new v(E(\"shared-calculator-error-product-infinite-bound-type-error\"))}function uT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-product-argument-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function cT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-integral-lower-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function lT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-integral-upper-bound-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function pT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-integral-argument-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function dT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-derivative-type-error\",{symbol:e[0]}));return t||n.allowExport(),n}function fT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-derivative-type-error-respect\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function mT(e,t,{blockExport:n}){let r=new v(E(\"shared-calculator-error-derivative-variable-type-error\",{symbol1:X(e),symbol2:t[0]}));return n||r.allowExport(),r}function yT(e,t,{blockExport:n}){let r=new v(E(\"shared-calculator-error-prime-variable-type-error\",{symbol1:X(e),symbol2:t[0]}));return n||r.allowExport(),r}function fy(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-piecewise-condition-type-error\",{symbol1:oe(De),symbol2:e[0]}));return t||n.allowExport(),n}function gT(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-piecewise-branch-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function hT(e){return new v(E(\"shared-calculator-error-table-header-type-error\",{symbol:e[0]}))}function bT(e){return new v(E(\"shared-calculator-error-table-entry-type-error\",{symbol:e[0]}))}function xT(){return new v(E(\"shared-calculator-error-regression-recursion\"))}function TT(e){return new v(E(\"shared-calculator-error-table-regression-type-error\",{symbol:e}))}function IT(){return new v(E(\"shared-calculator-error-table-regression-invalid-data\"))}function HV(){return new v(E(\"shared-calculator-error-table-regression-log-with-negative\"))}function PT(e){return new v(E(\"shared-calculator-error-regression-type-error\",{symbol1:e[0],symbol2:e[1]}))}function ET(e){return new v(E(\"shared-calculator-error-update-rule-type-error\",{symbol:e}))}function MT(){return new v(E(\"shared-calculator-error-update-rule-non-identifier-lhs\",{arrow:\"\\u2192\",example:\"a\"}))}function CT(e){return new v(E(\"shared-calculator-error-duplicate-update-rules\",{symbol:X(e)}))}function DT(e){return new v(E(\"shared-calculator-error-update-rule-undefined-lhs\",{symbol:X(e)}))}function ST(e){return new v(E(\"shared-calculator-error-update-rule-illegal-lhs\",{symbol:X(e)}))}function vT(e){return new v(E(\"shared-calculator-error-update-rule-function-lhs\",{symbol:X(e)}))}function my(e){return new v(E(\"shared-calculator-error-update-rule-local-lhs\",{symbol:X(e)}))}function OT(e){let t=e.filter(n=>n.scope===\"free\").map(n=>n.symbol);return new v(E(\"shared-calculator-error-action-merge-free-variable\",{symbol:X(t[0]||\"\")})).setDependencies(t).allowExport()}function Gd(e){return new v(E(\"shared-calculator-error-event-handler-type-error\",{example:\"a\\u2192a+1\"}))}function kd({blockExport:e}){let t=new v(E(\"shared-calculator-error-heterogeneous-list\"));return e||t.allowExport(),t}function yy(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-combine-type-error\",{symbol1:e[0],symbol2:e[1]}));return t||n.allowExport(),n}function Yl(e){return new v(E(\"shared-calculator-error-log-scale-type-error\",{symbol:e})).allowExport()}function NT(){return new v(E(\"shared-calculator-error-log-scale-histogram\"))}function RT(){return new v(E(\"shared-calculator-error-log-scale-dot-plot\"))}function AT(){return new v(E(\"shared-calculator-error-log-scale-box-plot\"))}function _T(){return new v(E(\"shared-calculator-error-deeply-nested\")).allowExport()}function LT(){return new v(E(\"shared-calculator-error-3d-multiple-equality-restrictions\")).allowExport()}function wT(){return new v(E(\"shared-calculator-error-3d-mixed-restriction-equation\")).allowExport()}function ca(){return new v(E(\"shared-calculator-error-3d-bad-equality-slice\")).allowExport()}function mu(e){return new v(E(\"shared-calculator-error-gpu-variable-list-length\",{symbol:X(e.filter(t=>t.symbol!==\"globalRandomSeed\")[0].symbol)}))}function gy(e){return new v(E(\"shared-calculator-error-gpu-variable-sum\",{symbol:X(e[0].symbol)}))}function hy(e){return new v(E(\"shared-calculator-error-gpu-variable-product\",{symbol:X(e[0].symbol)}))}function Xl(e){return new v(E(\"shared-calculator-error-gpu-function-unsupported\",{symbol:X(e)}))}function FT(){return new v(E(\"shared-calculator-error-gpu-integral-unsupported\"))}function VT(){return new v(E(\"shared-calculator-error-gpu-long-sum\",{maxTermCount:1e3.toLocaleString()}))}function BT(){return new v(E(\"shared-calculator-error-gpu-long-product\",{maxTermCount:1e3.toLocaleString()}))}function Oc(){return new v(E(\"shared-calculator-error-gpu-max-list-size\",{maxListSize:100 .toLocaleString()}))}function Hd(){return new v(E(\"shared-calculator-error-max-list-size\",{maxListSize:1e4.toLocaleString()})).allowExport()}function zd(){return new v(E(\"shared-calculator-error-two-numbers-error\"))}function GT(){return new v(E(\"shared-calculator-error-boxplot-offset-invalid\"))}function kT(){return new v(E(\"shared-calculator-error-boxplot-breadth-invalid\"))}function by(e,t){return new v(E(\"shared-calculator-error-too-many-arguments\",{symbol:e,max:t}))}function HT(){let e=E(\"shared-calculator-error-pdf-wrong-arity-recommendation\"),t=E(\"shared-calculator-error-pdf-wrong-arity\",{recommendation:e});return new v(t)}function zT(){let e=E(\"shared-calculator-error-cdf-wrong-arity-recommendation\"),t=E(\"shared-calculator-error-cdf-wrong-arity\",{recommendation:e});return new v(t)}function UT(){let e=E(\"shared-calculator-error-cdf-too-many-arguments-recommendation\"),t=E(\"shared-calculator-error-cdf-too-many-arguments\",{recommendation:e});return new v(t)}function qT(){return new v(E(\"shared-calculator-error-tdist-wrong-arity\"))}function $T(){return new v(E(\"shared-calculator-error-random-arity\"))}function YT(){return new v(E(\"shared-calculator-error-random-from-broadcast-distribution\"))}function XT(e){let t=e===\"rgb\"?[150,30,100]:[180,.5,.5],n=E(\"shared-calculator-error-color-arity-recommendation\",{recommendation:X(e)+\"(\"+t.join(\", \")+\")\"}),r=E(\"shared-calculator-error-color-arity\",{symbol:e,recommendation:n});return new v(r)}function Ao(e,t,n,r){e=X(e);let s,i;if(t===1)i=r.includeUsageExample?E(\"shared-calculator-error-wrong-arity-supplement\",{recommendation:r.usageExample||e+\"(x)\"}):\"\",n>1?s=E(\"shared-calculator-error-wrong-arity-single-arg-too-many\",{dependency:e,supplement:i}):s=E(\"shared-calculator-error-wrong-arity-single-arg-too-few\",{dependency:e,supplement:i});else{let o=[],a=r.usageExample;if(!a){for(let u=0;u<t;u++)o[u]=u+1;a=X(e)+\"(\"+o.join(\", \")+\")\"}i=r.includeUsageExample?E(\"shared-calculator-error-wrong-arity-supplement\",{recommendation:a}):\"\",s=E(\"shared-calculator-error-wrong-arity-many-arg\",{dependency:e,assignment_arity:t,supplement:i})}return new v(s)}function ZT(){let e=E(\"shared-calculator-error-wrong-arity-supplement\",{recommendation:\"length(x)\"}),t=E(\"shared-calculator-error-wrong-arity-single-arg-too-few\",{dependency:\"length\",supplement:e});return new v(t)}function WT(e){return new v(E(\"shared-calculator-error-wrong-two-arg-arity\",{symbol:X(e),recommendation:X(e)+\"([1,2,3], 1)\"}))}function Ud(e){return new v(E(\"shared-calculator-error-wrong-two-arg-arity\",{symbol:X(e),recommendation:X(e)+\"([1,2,3], [3,2,1])\"}))}function Nc(){return new v(E(\"shared-calculator-error-primed-function-arity\"))}function jT(e){return new v(E(\"shared-calculator-error-zero-arg-reducer\",{symbol:X(e)}))}function JT(){return new v(E(\"shared-calculator-error-malformed-point\"))}function QT(){return new v(E(\"shared-calculator-error-malformed-list\"))}function KT(e){return new v(E(\"shared-calculator-error-bad-tuple-dimensions\",{symbol:e}))}function xy(e){return e=X(e),new v(E(\"shared-calculator-error-bad-implicit-call\",{symbol:e}))}function eI(e,t){return new v(E(\"shared-calculator-error-adjacent-numbers\",{left:e,right:t}))}function Ty(e){return new v(E(\"shared-calculator-error-adjacent-mixed-number\",{mixedNumber:e}))}function tI(){return new v(E(\"shared-calculator-error-token-with-subscript\"))}function Iy(e){return e=X(e),new v(E(\"shared-calculator-error-identifier-as-function\",{symbol:e}))}function Py(e){return e=X(e),new v(E(\"shared-calculator-error-identifier-is-not-function\",{symbol:e}))}function qd(e){return e=X(e),e===\"%\"&&(e=\"% of\"),new v(E(\"shared-calculator-error-binary-operator-missing-operand\",{symbol:e}))}function nI(e){return e=X(e),new v(E(\"shared-calculator-error-unary-operator-missing-left\",{symbol:e}))}function rI(e){return e=X(e),new v(E(\"shared-calculator-error-unary-operator-missing-right\",{symbol:e}))}function sI(){return new v(E(\"shared-calculator-error-fraction-missing-numerator\"))}function iI(){return new v(E(\"shared-calculator-error-fraction-missing-denominator\"))}function oI(){return new v(E(\"shared-calculator-error-fraction-empty\"))}function Ey(){return new v(E(\"shared-calculator-error-empty-subscript\"))}function aI(){return new v(E(\"shared-calculator-error-empty-superscript\"))}function uI(e){return e=X(e),new v(E(\"shared-calculator-error-invalid-subscript\",{symbol:e}))}function cI(){return new v(E(\"shared-calculator-error-invalid-operator-name\"))}function lI(){return new v(E(\"shared-calculator-error-unexpected-subscript\"))}function pI(){return new v(E(\"shared-calculator-error-superscript-with-prime\"))}function My(){return new v(E(\"shared-calculator-error-unexpected-prime\"))}function Cy(){return new v(E(\"shared-calculator-error-prime-without-paren\"))}function dI(){return new v(E(\"shared-calculator-error-empty-radical\"))}function fI(){return new v(E(\"shared-calculator-error-empty-radical-index\"))}function $d(){return new v(E(\"shared-calculator-error-empty-paren\"))}function mI(){return new v(E(\"shared-calculator-error-empty-square-bracket\"))}function yI(){return new v(E(\"shared-calculator-error-empty-pipe\"))}function gI(e){let t=e+\"^2\",n=e+\"^-1\";return new v(E(\"shared-calculator-error-bad-trig-exponent\",{form1:t,form2:n}))}function hI(e){let t=e+\"^2\";return new v(E(\"shared-calculator-error-bad-log-exponent\",{form:t}))}function bI(){return new v(E(\"shared-calculator-error-piecewise-missing-condition\"))}function xI(){return new v(E(\"shared-calculator-error-piecewise-part-missing-condition\"))}function TI(){return new v(E(\"shared-calculator-error-colon-missing-condition\"))}function Yd(){let e=new v(E(\"shared-calculator-error-blank-expression\"));return e.silent=!0,e}function Dy(e){return e=X(e),new v(E(\"shared-calculator-error-function-not-defined\",{dependency:e}))}function Sy(e){return e=X(e),new v(E(\"shared-calculator-error-parameter-already-defined\",{dependency:e}))}function II(e){return e=X(e),new v(E(\"shared-calculator-error-duplicate-function-parameter\",{dependency:e}))}function PI(e){return e=X(e),new v(E(\"shared-calculator-error-function-name-as-parameter\",{dependency:e}))}function Zl(e,t){return e=X(e),t===void 0?new v(E(\"shared-calculator-error-cannot-redefine\",{symbol:e})):new v(E(\"shared-calculator-error-cannot-redefine-root\",{symbol:e,symbolRoot:t}))}function EI(e){return e=X(e),new v(E(\"shared-calculator-error-cannot-subscript\",{symbol:e}))}function Wl(e){return e=X(e),new v(E(\"shared-calculator-error-multiply-defined\",{dependency:e}))}function vy(e){return e=X(e),new v(E(\"shared-calculator-error-shadowed-index\",{symbol:e}))}function MI(e){e=e.map(X);let t=e.pop()||\"\",n=new v(E(\"shared-calculator-error-dependency-cycle\",{symbols:e.join(\"', '\"),lastSymbol:t}));return n.isCyclicDependencyError=!0,n}function Rc(e,t){let n=e.length,r=e[0];return t.suggestAlternativeFunctionName&&n==1?new v(E(\"shared-calculator-error-self-referential-suggest-alternative\",{symbol:X(r)})):new v(E(\"shared-calculator-error-self-referential-functions\",{symbols:e.slice(1).map(s=>X(s)).join(\"', '\"),lastSymbol:X(r),count:Md(n)}))}function CI(e){return new v(E(\"shared-calculator-error-self-referential-base-case\",{symbol:X(e)}))}function DI(){return new v(E(\"shared-calculator-error-ticker-min-step-nonnegative\"))}function SI(e){return new v(E(\"shared-calculator-error-slider-limit-references-export\",{symbol:X(e)}))}function vI(){return new v(E(\"shared-calculator-error-slider-min-invalid\"))}function OI(){return new v(E(\"shared-calculator-error-slider-max-invalid\"))}function NI(){return new v(E(\"shared-calculator-error-slider-max-less-than-min\"))}function RI(){return new v(E(\"shared-calculator-error-slider-step-invalid\"))}function AI(){return new v(E(\"shared-calculator-error-domain-min-invalid\"))}function _I(){return new v(E(\"shared-calculator-error-domain-max-invalid\"))}function LI(){return new v(E(\"shared-calculator-error-domain-max-less-than-min\"))}function wI(){return new v(E(\"shared-calculator-error-cdf-min-invalid\"))}function FI(){return new v(E(\"shared-calculator-error-cdf-max-invalid\"))}function VI(){return new v(E(\"shared-calculator-error-cdf-max-less-than-min\"))}function BI(){return new v(E(\"shared-calculator-error-use-rho-for-spherical-coordinates\"))}function GI(){return new v(E(\"shared-calculator-error-use-r-for-cylindrical-coordinates\"))}function Oy(){return new v(E(\"shared-calculator-error-cant-combine-spherical-and-cylindrical\"))}function rn(e){if(e=e.map(X),e.length===0)return new v(E(\"shared-calculator-error-too-many-variables-no-symbols\"));let t=e.pop()||\"\";return e.length>0?new v(E(\"shared-calculator-error-too-many-variables-many-symbols\",{variables:e.join(\"', '\"),lastVariable:t})):new v(E(\"shared-calculator-error-too-many-variables-one-symbol\",{variable:t}))}function kI(e){return new v(E(\"shared-calculator-error-cannot-restrict\",{variable:X(e)}))}function HI(e){return new v(E(\"shared-calculator-error-cannot-assign-color\",{variable:X(e)}))}function zI(e){return new v(E(\"shared-calculator-error-cannot-restrict-with-equality\",{variable:X(e)}))}function Xd(e,t,n){e=e.map(X),t=X(t),n=n.map(X);let r=t+\"(\"+n.join(\",\")+\",\"+e.join(\",\")+\")\",s=e.pop()||\"\",i={symbols:e.join(\"', '\"),lastSymbol:s,newSignature:r};return e.length?new v(E(\"shared-calculator-error-add-arguments-to-definition-many\",i)):new v(E(\"shared-calculator-error-add-arguments-to-definition-one\",i))}function UI(e){return e=X(e),new v(E(\"shared-calculator-error-invalid-lhs\",{symbol:e}))}function qI(){return new v(E(\"shared-calculator-error-unplottable-polar-function\"))}function $I(){return new v(E(\"shared-calculator-error-invalid-inequality-variables\"))}function Ac(){return new v(E(\"shared-calculator-error-invalid-implicit-variables\"))}function YI(){return new v(E(\"shared-calculator-error-invalid-implicit-variables-3d\"))}function XI(){return new v(E(\"shared-calculator-error-single-variable-implicit-equations-disabled\"))}function ZI(){return new v(E(\"shared-calculator-error-implicits-disabled\"))}function Ny(e){let t=new v(e===\"=\"?E(\"graphing-calculator-error-nan-blame-complex-coercion\"):E(\"shared-calculator-error-complex-operation-undefined\",{symbol:X(e)}));return t.warning=t.getError(),t.silent=!0,t}function zV(){return new v(E(\"shared-calculator-error-complex-table-point-coordinate\"))}function Ry(){return new v(E(\"shared-calculator-error-inequalities-disabled\"))}function WI(){return new v(E(\"shared-calculator-error-complicated-polar-implicit\"))}function jI(){return new v(E(\"shared-calculator-error-invalid-double-inequality-3d\"))}function JI(){return new v(E(\"shared-calculator-error-invalid-double-equality-3d\"))}function QI(){return new v(E(\"shared-calculator-error-unplottable-chained-equality\"))}function Ay(){return new v(E(\"shared-calculator-error-invalid-double-inequality-variables\"))}function _y(){return new v(E(\"shared-calculator-error-mismatched-double-inequality\",{example:\"1 < y < 2\"}))}function Ly(){return new v(E(\"shared-calculator-error-complicated-double-inequality\"))}function wy(e){return e?(e=X(e),new v(E(\"shared-calculator-error-equation-required-symbol\",{lhs:e+\"=\"}))):new v(E(\"shared-calculator-error-equation-required\"))}function Fy(e){return e=X(e),new v(E(\"shared-calculator-error-variable-as-function\",{dependency:e}))}function Vy(e){return e=X(e),new v(E(\"shared-calculator-error-distribution-as-function\",{symbol:e}))}function KI(e){return new v(E(\"shared-calculator-error-invalid-table-header\",{supplement:e}))}function Zd(e){return new v(E(\"shared-calculator-error-invalid-table-entry\",{supplement:e}))}function eP(){return new v(E(\"shared-calculator-error-invalid-first-table-column\",{most:\"'y', 'r',\",last:\"'\\u03B8'\"}))}function UV(){return new v(E(\"shared-calculator-error-invalid-dependent-first-table-column\"))}function tP(e){return new v(E(\"shared-calculator-error-invalid-regression-parameter\",{symbol:X(e)}))}function nP(){return new v(E(\"shared-calculator-error-optimization-error\"))}function Wd(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-non-list-double-reducer\",{symbol:X(e),recommendation:X(e)+\"([1,2,3], [3,2,1])\"}));return t||n.allowExport(),n}function rP(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-non-list-parameterized-reducer\",{symbol:X(e),recommendation:X(e)+\"([1,2,3], 1)\"}));return t||n.allowExport(),n}function so(e,{blockExport:t}){let n=new v(E(\"shared-calculator-error-method-requires-list\",{symbol:X(e),recommendation:X(e)+\"([1,2,3])\"}));return t||n.allowExport(),n}function jd(){return new v(E(\"shared-calculator-error-non-arithmetic-range\")).allowExport()}function sP(){return new v(E(\"shared-calculator-error-invalid-half-empty-range\"))}function iP(){return new v(E(\"shared-calculator-error-sum-missing-bound\"))}function oP(){return new v(E(\"shared-calculator-error-product-missing-bound\"))}function aP(){return new v(E(\"shared-calculator-error-incorrect-sum-lower-bound\"))}function uP(){return new v(E(\"shared-calculator-error-incorrect-product-lower-bound\"))}function cP(e){return new v(E(\"shared-calculator-error-bad-sum-bound-dependency\",{symbol:X(e)}))}function lP(e){return new v(E(\"shared-calculator-error-bad-product-bound-dependency\",{symbol:X(e)}))}function pP(){return new v(E(\"shared-calculator-error-integral-missing-bound\"))}function dP(){return new v(E(\"shared-calculator-error-integral-missing-differential\"))}function fP(){return new v(E(\"shared-calculator-error-differential-with-superscript\"))}function mP(){return new v(E(\"shared-calculator-error-sum-missing-body\"))}function yP(){return new v(E(\"shared-calculator-error-product-missing-body\"))}function gP(){return new v(E(\"shared-calculator-error-integral-missing-body\"))}function hP(){return new v(E(\"shared-calculator-error-derivative-missing-body\"))}function bP(e,t){return e=X(e),t=X(t),new v(E(\"shared-calculator-error-mismatched-braces\",{symbol1:e,symbol2:t}))}function By(e){return new v(E(\"shared-calculator-error-shadowed-integration-variable\",{symbol:X(e)}))}function xP(e){return new v(E(\"shared-calculator-error-bad-integral-bound-dependency\",{symbol:X(e)}))}function TP(){return new v(E(\"shared-calculator-error-percent-missing-of\"))}function Jd(e){return e=X(e),new v(E(\"shared-calculator-error-illegal-bin-width\",{symbol:e}))}function jl(e){return e=X(e),new v(E(\"shared-calculator-error-ttest-list-too-short\",{symbol:e}))}function IP(){return new v(E(\"shared-calculator-error-bad-sample-size\"))}function PP(e){return new v(E(\"shared-calculator-error-variable-seed\",{symbol:X(e[0].symbol)})).setDependencies(e.filter(t=>t.scope===\"free\").map(t=>t.symbol)).allowExport()}function Qd(e){return new v(E(\"shared-calculator-error-bad-symbol-context\",{symbol:X(e)}))}function Gy(){return new v(E(\"shared-calculator-error-write-integral\",{command:\"integral\",symbol:\"\\u222B\"}))}function EP(){return new v(E(\"shared-calculator-error-ans-undefined\"))}function Kd(e){return new v(E(\"shared-calculator-error-variables-unsupported\",{variable:X(e)}))}function ky(){return new v(E(\"shared-calculator-error-polygon-unsupported-in-3d\"))}function VD(e){return new v(E(\"shared-calculator-error-function-only-works-in-complex\",{symbol:X(e)}))}function Li(e,t){return t!=null&&t.is3dPolicy()&&e===\"polygon\"?ky():!!t&&!(t!=null&&t.isGeometryEnabled())&&!(t instanceof Cc)&&!t.isComplexEnabled()&&FD.indexOf(e)!==-1?VD(e):new v(E(\"shared-calculator-error-function-unsupported\",{symbol:X(e)}))}function MP(){return new v(E(\"shared-calculator-error-logbase-unsupported\"))}function _c(e){return new v(E(\"shared-calculator-error-constant-unsupported\",{symbol:X(e)}))}function Hy(e){return new v(E(\"shared-calculator-error-variable-unsupported\",{symbol:X(e)}))}function zy(e){return new v(E(\"shared-calculator-error-variable-invalid-function-name\",{symbol:X(e)}))}function ef(){return new v(E(\"shared-calculator-error-assignments-unsupported\"))}function tf(){return new v(E(\"shared-calculator-error-function-definition-unsupported\"))}function Ua(){return new v(E(\"shared-calculator-error-equations-unsupported\"))}function Lc(){return new v(E(\"shared-calculator-error-inequalities-unsupported\"))}function wc(){return new v(E(\"shared-calculator-error-regressions-unsupported\"))}function CP(){return new v(E(\"shared-calculator-error-custom-regressions-unsupported\"))}function Fc(){return new v(E(\"shared-calculator-error-points-unsupported\"))}function nf(){return new v(E(\"shared-calculator-error-feature-unavailable\"))}function Uy(){return new v(E(\"basic-calculator-error-fractions-unavailable\"))}function DP(){return new v(E(\"basic-calculator-error-parentheses-unavailable\"))}function qV(){return new v(E(\"shared-calculator-error-non-square-determinant\"))}function $V(){return new v(E(\"shared-calculator-error-non-square-trace\"))}function YV(){return new v(E(\"shared-calculator-error-non-square-inverse\"))}function XV(){return new v(E(\"shared-calculator-error-non-singular-inverse\"))}function ZV(e){return new v(E(\"shared-calculator-error-clickable-object-assignment-not-defined\",{symbol:e}))}function WV(e){return new v(E(\"shared-calculator-error-multiply-defined\",{dependency:e}))}function jV(){return new v(E(\"shared-calculator-error-clickable-object-assignment-not-identifier\"))}function JV(){return new v(E(\"shared-calculator-error-clickable-object-invalid-expression\"))}function QV(){return new v(E(\"shared-calculator-error-matrix-assignment\"))}function KV(){return new v(E(\"shared-calculator-error-matrix-add-dimensions\"))}function eB(){return new v(E(\"shared-calculator-error-matrix-subtract-dimensions\"))}function tB(){return new v(E(\"shared-calculator-error-matrix-multiply-dimensions\"))}function nB(){return new v(E(\"shared-calculator-error-matrix-fractional-power\"))}function rB(){return new v(E(\"shared-calculator-error-matrix-power-dimensions\"))}function sB(e){return new v(E(\"shared-calculator-error-matrix-element-type-error\",{arg:e[0]}))}function iB(e){return new v(E(\"shared-calculator-error-matrix-invalid-variable\",{symbol:X(e)}))}function SP(e,t,n,{blockExport:r}){let s=\"[1...10]\";n&&!/[\\\\]/.test(n)&&(s=`[${n}]`);let i=new v(E(\"shared-calculator-error-list-comprehension-input-type-error\",{identifier:e,actual:t,example:s}));return r||i.allowExport(),i}function vP(){return new v(E(\"shared-calculator-error-incorrect-list-comprehension-input\"))}function qy(e){return e=X(e),new v(E(\"shared-calculator-error-shadowed-list-comprehension-input\",{symbol:e}))}function OP(e){return e=X(e),new v(E(\"shared-calculator-error-bad-for-input-list-dependency\",{symbol:e}))}function NP(e){return e=X(e),new v(E(\"shared-calculator-error-bad-for-interval-dependency\",{symbol:e}))}function RP(e){let t=e.filter(n=>n.scope===\"free\").map(n=>n.symbol);return new v(E(\"shared-calculator-error-variable-length-top-level-list\",{symbol:X(t[0]||\"\")})).setDependencies(t).allowExport()}function rf(e){return new v(E(\"shared-calculator-error-variable-length-distribution-list\",{symbol:e[0].symbol})).setDependencies(e.filter(t=>t.scope===\"free\").map(t=>t.symbol))}function AP(e){return new v(E(\"shared-calculator-error-variable-length-sum-body-depends-on-index\",{symbol:e}))}function _P(e){return new v(E(\"shared-calculator-error-variable-length-product-body-depends-on-index\",{symbol:e}))}function LP(e){return new v(E(\"shared-calculator-error-variable-length-integral-depends-on-integration-var\",{symbol:e}))}function oB(e,t){return new v(E(\"shared-calculator-error-substitution-type-error\",{actual:oe(e),expected:oe(t)}))}function sf(){return new v(E(\"shared-calculator-error-substitution-invalid-assignments\"))}function wP(e){return new v(E(\"shared-calculator-error-substitution-local-lhs\",{symbol:X(e)}))}function of(e){return new v(E(\"shared-calculator-error-substitution-illegal-lhs\",{symbol:X(e)}))}function af(e){return new v(E(\"shared-calculator-error-substitution-function-lhs\",{symbol:X(e)}))}function FP(e,t,n){return new v(E(\"shared-calculator-error-substitution-body-regression-parameter-dependency\",{globalVariable:X(e),regressionParameter:X(t),operator:n}))}function aB(){return new v(E(\"shared-calculator-error-substitution-body-action\"))}function $y(){return new v(E(\"shared-calculator-error-substitution-nested\"))}function yu(e){return new v(E(\"shared-calculator-error-substitution-ambiguous-comma\",{operation:e}))}function VP(e){return new v(E(\"shared-calculator-error-substitution-duplicate-assignment\",{symbol:X(e)}))}function BP(e,t,n){return new v(E(\"shared-calculator-error-substitution-recursive-call-lhs\",{operator:e,globalVariable:X(t),fnSymbol:X(n)}))}function GP(){return new v(E(\"shared-calculator-error-depends-on-deleted-geo-object\"))}function kP(e){return new v(E(\"shared-calculator-error-invalid-interval-comprehension-return-type\",{type:oe(e)}))}function HP(e,t){return new v(E(\"shared-calculator-error-bad-interval-comprehension-arity\",{type:oe(e),count:Md(t)}))}function Jl(e){return new v(E(\"shared-calculator-error-invalid-interval-comprehension-invalid-bound\",{identifier:e}))}function zP(){return new v(E(\"shared-calculator-error-nested-interval-comprehension\"))}function Yy(){return new v(E(\"shared-calculator-error-substitution-unsupported-interval\"))}function UP(e){return new v(E(\"shared-calculator-error-table-regression-invalid-export-identifier\",{latex:\"`\"+e+\"`\"}))}function qP(e){return new v(e.length===1?E(\"graphing-calculator-error-table-regression-unexportable-reserved-variable-single\",{variable:\"`\"+e[0]+\"`\"}):E(\"graphing-calculator-error-table-regression-unexportable-reserved-variables-many\"))}function We(e){return Object.keys(e)}function Tn(e){return Object.create(e)}var BD=Symbol(\"DEPENDENCY_ORDER\");function GD(e){let t=e[BD];if(!t)throw z(\"Missing dependency order.\");return t}function $P(e,t){e[BD]=t}function gu(e){return typeof e!=\"object\"||!e?!1:e.type===\"Action\"}function bX(e){return j(e.valueType)}var Gi={};ia(Gi,{LruCache:()=>up,RECURSIVE_COMPUTATION_LIMIT:()=>JS,RECURSIVE_DEPTH_LIMIT:()=>Cf,RecursiveFunctionResult:()=>jS,SYMBOL_DIVERGES:()=>WS,TerminationStatus:()=>QS,_complexGCD:()=>i0,acosh:()=>YS,acot:()=>s3,acoth:()=>d3,acsc:()=>i3,acsch:()=>p3,addTangentAngle:()=>$2,addTangentArc:()=>q2,addTangentCircle:()=>U2,addTangentLine:()=>k2,addTangentPolygon:()=>B2,addTangentRay:()=>H2,addTangentSegment:()=>Ng,addTangentSegmentThreeD:()=>G2,addTangentTransformation:()=>Y2,addTangentVector:()=>z2,angleMarkerMultiplier:()=>S2,angleMarkerRawDelta:()=>D2,angleStart:()=>P2,angleVertex:()=>I2,anglebisector:()=>aG,arc:()=>h2,arcArcIntersection:()=>tG,arcCenter:()=>yp,arcCircleIntersection:()=>eG,arcFirstPoint:()=>b2,arcGlider:()=>Dv,arcLineIntersection:()=>Ov,arcMiddlePoint:()=>x2,arcOmega:()=>gp,arcThirdPoint:()=>T2,arg:()=>GG,argMax:()=>k3,argMin:()=>G3,asec:()=>o3,asech:()=>l3,asinh:()=>XS,atanh:()=>ZS,basePointFromVector:()=>c2,basePointFromVectorThreeD:()=>d2,bernoulliTable:()=>tv,binomSample:()=>C3,binomcdf:()=>S3,binompdf:()=>Cg,center:()=>y2,chooseNonIncidentPoint:()=>J2,circle:()=>m2,circleArcIntersection:()=>K2,circleCircleIntersection:()=>Ef,circleGlider:()=>Z2,circleLineIntersection:()=>JE,clamp:()=>hr,coerceComplexToReal:()=>s0,coerceRealToComplex:()=>rk,common_log:()=>KB,compareComplexLexicographic:()=>mv,complex:()=>zt,complexAcos:()=>Hv,complexAcosh:()=>Uv,complexAcot:()=>QG,complexAcoth:()=>tk,complexAcsc:()=>JG,complexAcsch:()=>ek,complexAsec:()=>jG,complexAsech:()=>KG,complexAsin:()=>r0,complexAsinh:()=>zv,complexAtan:()=>CE,complexAtanh:()=>xg,complexCeil:()=>sk,complexCommonLog:()=>e3,complexCos:()=>Vv,complexCosh:()=>kv,complexCot:()=>YG,complexCoth:()=>WG,complexCsc:()=>$G,complexCsch:()=>ZG,complexDivide:()=>Du,complexExp:()=>HG,complexFloor:()=>qv,complexFromPolarRounded:()=>Eu,complexGCD:()=>SE,complexLCM:()=>vE,complexListGCD:()=>YB,complexListLCM:()=>XB,complexLog:()=>ME,complexLogbase:()=>sv,complexMod:()=>ik,complexMultiplyPoints:()=>Av,complexPow:()=>UG,complexPowReal:()=>wv,complexReciprocal:()=>Is,complexRound:()=>ap,complexSec:()=>qG,complexSech:()=>XG,complexSin:()=>Fv,complexSinh:()=>Gv,complexSortPerm:()=>L3,complexSqrt:()=>Lv,complexTan:()=>Bv,complexTanh:()=>n0,composeTransformation:()=>bG,conj:()=>Zc,corr:()=>Og,cos:()=>Mn,cosh:()=>fp,cot:()=>r3,cotDerivative:()=>nv,coth:()=>c3,cov:()=>z3,covp:()=>bv,csc:()=>n3,csch:()=>u3,dilation:()=>yG,directedAngleMarker:()=>Mv,directedAngleStart:()=>M2,directedAngleVertex:()=>E2,directedCoterminalAngle:()=>Cv,distance:()=>pp,distanceThreeD:()=>Y3,elementsAt:()=>OG,erf:()=>N3,erfcx:()=>Za,executeRecursiveFunction:()=>HB,expm1:()=>LB,factorial:()=>ma,frequency:()=>AG,gcd:()=>lg,getArcDetails:()=>Rg,getBroadcastTargetElements:()=>BB,getRecursiveDepthLimit:()=>VB,handleRecursionLimitExceeded:()=>ev,hsv:()=>X3,hypot:()=>Ts,identity:()=>f2,imag:()=>BG,invBinom:()=>cv,invNorm:()=>BE,invPoisson:()=>uv,invT:()=>lv,invUniform:()=>A3,invertTransformation:()=>xG,isDegenerateArc:()=>YE,itscore:()=>dv,ittest:()=>kE,lcm:()=>xE,line:()=>i2,lineArcIntersection:()=>vv,lineCircleIntersection:()=>jE,lineGlider:()=>ZE,lineLineIntersection:()=>Sv,listGCD:()=>qB,listLCM:()=>$B,listLength:()=>_3,listMax:()=>Sg,listMin:()=>Dg,log:()=>QB,log1p:()=>mp,log_base:()=>dg,lowerQuantileIndex:()=>F3,lowerQuartileIndex:()=>B3,mad:()=>H3,mathVector:()=>Iv,mathVectorThreeD:()=>Pv,md5Spyable:()=>$S,mean:()=>ya,median:()=>gv,mod:()=>Yc,nCr:()=>Pu,nPr:()=>pg,normalSample:()=>E3,normalcdf:()=>I3,normalpdf:()=>_E,parallel:()=>iG,peelableCoerceComplexToReal:()=>nk,perpendicular:()=>oG,pointDet:()=>_v,pointDot:()=>uG,pointPerp:()=>cG,poissonSample:()=>D3,poissoncdf:()=>v3,poissonpdf:()=>lp,polyGamma:()=>rv,polygon:()=>Z3,polygonArea:()=>qE,polygonEdgeByParameter:()=>W2,polygonEdges:()=>K3,polygonGlider:()=>j2,polygonInteriorDirectedAngles:()=>s2,polygonInteriorUndirectedAngles:()=>r2,polygonPerimeter:()=>e2,pow:()=>FB,quad:()=>$3,quantile:()=>fv,quartile:()=>Xc,quartileIndex:()=>vg,radius:()=>g2,random:()=>wE,randomPerm:()=>FE,rank:()=>PE,rawTransform:()=>lG,rawTransformConj:()=>pG,ray:()=>o2,rayGlider:()=>EE,real:()=>VG,recursionCacheKey:()=>bE,recursionDiverges:()=>KS,recursionMissingCacheEntry:()=>kB,recursionSuccess:()=>GB,reflection:()=>hG,restriction:()=>wG,restrictionToBoolean:()=>FG,rgb:()=>xv,rotation:()=>gG,scaleTangentAngle:()=>V2,scaleTangentArc:()=>F2,scaleTangentCircle:()=>w2,scaleTangentLine:()=>_2,scaleTangentPolygon:()=>A2,scaleTangentRay:()=>L2,scaleTangentSegment:()=>XE,scaleTangentTransformation:()=>R2,sec:()=>t3,sech:()=>a3,segment:()=>$E,segmentGlider:()=>WE,segmentThreeD:()=>W3,segmentThreeDGlider:()=>X2,select:()=>vG,serializeNonNumericSeedPart:()=>LE,shuffle:()=>P3,sign:()=>NE,sin:()=>dn,sinh:()=>jc,sortPerm:()=>Jc,spearman:()=>U3,sphere:()=>J3,sqrtxsqm1:()=>UB,sqrtxsqp1:()=>zB,stats:()=>HE,stdev:()=>fg,stdevp:()=>q3,supplementAngle:()=>O2,tSample:()=>M3,tan:()=>AE,tanh:()=>OE,tcdf:()=>ug,testingOnlySetRecursiveDepthLimit:()=>RE,toFraction:()=>wB,tone:()=>RG,total:()=>m3,tpdf:()=>Mg,transformAngleMarker:()=>SG,transformArc:()=>CG,transformCircle:()=>MG,transformLine:()=>IG,transformPoint:()=>oo,transformPolygon:()=>DG,transformRay:()=>PG,transformScaleFactor:()=>fG,transformSegment:()=>t0,transformVector:()=>EG,transformWithoutTranslation:()=>dG,translation:()=>mG,triangle:()=>j3,tscore:()=>pv,ttest:()=>GE,undirectedAngleMarker:()=>C2,undirectedCoterminalAngle:()=>v2,uniformSample:()=>Mu,uniformcdf:()=>O3,uniformpdf:()=>VE,uniquePerm:()=>NG,upperQuantileIndex:()=>w3,upperQuartileIndex:()=>V3,validateRangeLength:()=>zE,validateSampleCount:()=>UE,variance:()=>hv,varp:()=>Df,vector:()=>a2,vectorDisplacementAsPoint:()=>u2,vectorThreeD:()=>l2,vectorThreeDDisplacementAsPoint:()=>p2,vertices:()=>Q3,volume:()=>_G});var kD=function(){\"use strict\";function e(g,m){let h=(g&65535)+(m&65535);return(g>>16)+(m>>16)+(h>>16)<<16|h&65535}function t(g,m){return g<<m|g>>>32-m}function n(g,m,h,b,x,T){return e(t(e(e(m,g),e(b,T)),x),h)}function r(g,m,h,b,x,T,D){return n(m&h|~m&b,g,m,x,T,D)}function s(g,m,h,b,x,T,D){return n(m&b|h&~b,g,m,x,T,D)}function i(g,m,h,b,x,T,D){return n(m^h^b,g,m,x,T,D)}function o(g,m,h,b,x,T,D){return n(h^(m|~b),g,m,x,T,D)}function a(g,m){g[m>>5]|=128<<m%32,g[(m+64>>>9<<4)+14]=m;let h,b,x,T,D,P=1732584193,C=-271733879,S=-1732584194,O=271733878;for(h=0;h<g.length;h+=16)b=P,x=C,T=S,D=O,P=r(P,C,S,O,g[h],7,-680876936),O=r(O,P,C,S,g[h+1],12,-389564586),S=r(S,O,P,C,g[h+2],17,606105819),C=r(C,S,O,P,g[h+3],22,-1044525330),P=r(P,C,S,O,g[h+4],7,-176418897),O=r(O,P,C,S,g[h+5],12,1200080426),S=r(S,O,P,C,g[h+6],17,-1473231341),C=r(C,S,O,P,g[h+7],22,-45705983),P=r(P,C,S,O,g[h+8],7,1770035416),O=r(O,P,C,S,g[h+9],12,-1958414417),S=r(S,O,P,C,g[h+10],17,-42063),C=r(C,S,O,P,g[h+11],22,-1990404162),P=r(P,C,S,O,g[h+12],7,1804603682),O=r(O,P,C,S,g[h+13],12,-40341101),S=r(S,O,P,C,g[h+14],17,-1502002290),C=r(C,S,O,P,g[h+15],22,1236535329),P=s(P,C,S,O,g[h+1],5,-165796510),O=s(O,P,C,S,g[h+6],9,-1069501632),S=s(S,O,P,C,g[h+11],14,643717713),C=s(C,S,O,P,g[h],20,-373897302),P=s(P,C,S,O,g[h+5],5,-701558691),O=s(O,P,C,S,g[h+10],9,38016083),S=s(S,O,P,C,g[h+15],14,-660478335),C=s(C,S,O,P,g[h+4],20,-405537848),P=s(P,C,S,O,g[h+9],5,568446438),O=s(O,P,C,S,g[h+14],9,-1019803690),S=s(S,O,P,C,g[h+3],14,-187363961),C=s(C,S,O,P,g[h+8],20,1163531501),P=s(P,C,S,O,g[h+13],5,-1444681467),O=s(O,P,C,S,g[h+2],9,-51403784),S=s(S,O,P,C,g[h+7],14,1735328473),C=s(C,S,O,P,g[h+12],20,-1926607734),P=i(P,C,S,O,g[h+5],4,-378558),O=i(O,P,C,S,g[h+8],11,-2022574463),S=i(S,O,P,C,g[h+11],16,1839030562),C=i(C,S,O,P,g[h+14],23,-35309556),P=i(P,C,S,O,g[h+1],4,-1530992060),O=i(O,P,C,S,g[h+4],11,1272893353),S=i(S,O,P,C,g[h+7],16,-155497632),C=i(C,S,O,P,g[h+10],23,-1094730640),P=i(P,C,S,O,g[h+13],4,681279174),O=i(O,P,C,S,g[h],11,-358537222),S=i(S,O,P,C,g[h+3],16,-722521979),C=i(C,S,O,P,g[h+6],23,76029189),P=i(P,C,S,O,g[h+9],4,-640364487),O=i(O,P,C,S,g[h+12],11,-421815835),S=i(S,O,P,C,g[h+15],16,530742520),C=i(C,S,O,P,g[h+2],23,-995338651),P=o(P,C,S,O,g[h],6,-198630844),O=o(O,P,C,S,g[h+7],10,1126891415),S=o(S,O,P,C,g[h+14],15,-1416354905),C=o(C,S,O,P,g[h+5],21,-57434055),P=o(P,C,S,O,g[h+12],6,1700485571),O=o(O,P,C,S,g[h+3],10,-1894986606),S=o(S,O,P,C,g[h+10],15,-1051523),C=o(C,S,O,P,g[h+1],21,-2054922799),P=o(P,C,S,O,g[h+8],6,1873313359),O=o(O,P,C,S,g[h+15],10,-30611744),S=o(S,O,P,C,g[h+6],15,-1560198380),C=o(C,S,O,P,g[h+13],21,1309151649),P=o(P,C,S,O,g[h+4],6,-145523070),O=o(O,P,C,S,g[h+11],10,-1120210379),S=o(S,O,P,C,g[h+2],15,718787259),C=o(C,S,O,P,g[h+9],21,-343485551),P=e(P,b),C=e(C,x),S=e(S,T),O=e(O,D);return[P,C,S,O]}function u(g){let m,h=\"\",b=g.length*32;for(m=0;m<b;m+=8)h+=String.fromCharCode(g[m>>5]>>>m%32&255);return h}function c(g){let m,h=[];for(h[(g.length>>2)-1]=void 0,m=0;m<h.length;m+=1)h[m]=0;let b=g.length*8;for(m=0;m<b;m+=8)h[m>>5]|=(g.charCodeAt(m/8)&255)<<m%32;return h}function l(g){return u(a(c(g),g.length*8))}function p(g){let m=\"0123456789abcdef\",h=\"\",b,x;for(x=0;x<g.length;x+=1)b=g.charCodeAt(x),h+=m.charAt(b>>>4&15)+m.charAt(b&15);return h}function f(g){return unescape(encodeURIComponent(g))}function d(g){return l(f(g))}function y(g){return p(d(g))}return y}();function wi(e,t,n){return e>0==t>0?n===1?t:e+n*(t-e):e*(1-n)+t*n}function ar(e,t,n){return[wi(e[0],t[0],n),wi(e[1],t[1],n)]}function Fi(e,t,n){return[wi(e[0],t[0],n),wi(e[1],t[1],n),wi(e[2],t[2],n)]}function uf(e,t){return[e[0]+t[0],e[1]+t[1]]}function HD(e,t){return[e[0]-t[0],e[1]-t[1]]}function YP(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function XP(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qa(e,t){return Ql(YP(e,t))}function Xy(e,t,n){return[wi(e[0],t[0],n[0]),wi(e[1],t[1],n[1])]}function zD(e,t){return[e[0]*t,e[1]*t]}function Ql(e){let[t,n,r]=e;return t*t+n*n+r*r}function Kl(e,t){let n=e[1]*t[2]-e[2]*t[1],r=e[2]*t[0]-e[0]*t[2],s=e[0]*t[1]-e[1]*t[0],i=Math.sqrt(n*n+r*r+s*s);return[n/i,r/i,s/i]}function ep(e,t,n){e=Math.fround(e),t=Math.fround(t),n=Math.fround(n);let r=Math.fround(e*e+t*t+n*n);return isFinite(r)&&r!=0}function la([e,t,n]){return isFinite(e)&&isFinite(t)&&isFinite(n)}function xi(e,t){let n;e>t&&(n=e,e=t,t=n);let r=e>0,s=t>0,i=Math.abs(e)>.01,o=Math.abs(t)>.01;if(i||o)return Va(e,t);if(e===0)return t*Math.abs(t);if(t===0)return e*Math.abs(e);if(r!==s)return 0;let a=r?Math.sqrt(e*t):-Math.sqrt(e*t);return a>=e&&t>=a?a:Va(e,t)}function QP(e,t,n,r,s){if(!(isNaN(t)||isNaN(r)||t<0==r<0))for(;;){let i=xi(e,n),o=s(i);if(!isFinite(o))return;if(i===e||i===n)return Math.abs(t)<=Math.abs(r)?[e,t]:[n,r];if(o===0)return lf(e,t,i,o,n,r,s);t<0!=o<0?(n=i,r=o):(e=i,t=o)}}function QD(e,t,n,r,s){if(!(ZP(t)||ZP(r))&&WP(t,r))for(;;){let i=xi(e,n),o=s(i);if(ZP(o))return;if(i===e||i===n)return i;if(WP(t,o))n=i,r=o;else if(WP(o,r))e=i,t=o;else return}}function ZP(e){for(let t of e)if(isNaN(t))return!0;return!1}function WP(e,t){for(let n=0;n<e.length;n++)if(!uB(e[n],t[n]))return!1;return!0}function uB(e,t){return e<=0&&t>=0||e>=0&&t<=0}function lf(e,t,n,r,s,i,o){let a;if(!isFinite(r))return;isFinite(t)||(a=xs(e,t,n,r,o),a!==void 0&&(e=a,t=o(e))),isFinite(i)||(a=xs(n,r,s,i,o),a!==void 0&&(s=a,i=o(a)));let u,c;t===r?u=[e,t]:u=UD(e,t,n,r,o,r),i===r?c=[s,i]:c=UD(n,r,s,i,o,r);let l;return u&&c&&(l=xi(u[0],c[0])),l!==void 0?[l,o(l)]:void 0}function xs(e,t,n,r,s){if(isFinite(t)!==isFinite(r))for(;;){let i=xi(e,n),o=s(i);if(i===e||i===n)return isFinite(t)?e:n;isFinite(o)!==isFinite(t)?(n=i,r=o):(e=i,t=o)}}function Zy(e,t,n,r,s){if(la(t)!==la(r))for(;;){let i=xi(e,n),o=s(i);if(i===e||i===n)return la(t)?e:n;la(o)!==la(t)?(n=i,r=o):(e=i,t=o)}}function UD(e,t,n,r,s,i){if(t===i!=(r===i))for(;;){let o=xi(e,n),a=s(o);if(o===e||o===n)return t===i?[e,t]:[n,r];a===i!=(t===i)?(n=o,r=a):(e=o,t=a)}}function KD(e,t,n,r,s,i,o){if(e<n&&n<s&&isFinite(t)&&isFinite(r)&&isFinite(i)&&t!==r&&r!==i&&r>t==r>i)for(;;){let a=xi(e,n),u=o(a),c=xi(n,s),l=o(c);if(!isFinite(u)||!isFinite(l))return;if(a===e||a===n||c===n||c===s)return u>r==r>t?[a,u]:l>r==r>t?[c,l]:[n,r];if(u===r||l===r)return lf(e,t,n,r,s,i,o);r>t&&u>t&&u>r||r<t&&u<t&&u<r?(s=n,i=r,n=a,r=u):r>t&&l>r&&l>i||r<t&&l<r&&l<i?(e=n,t=r,n=c,r=l):(e=a,t=u,s=c,i=l)}}function Vi([e,t],[n,r]){return(n-e)*(n-e)+(r-t)*(r-t)}function qD(e,t,n,r,s,i){let o=i(e),a=i(t),u=i(n),c=Vi(o,r),l=Vi(a,r),p=Vi(u,r);if(!(t<=e||n<=t)&&!(!isFinite(c)||!isFinite(l)||!isFinite(p))&&!(l>=c||l>=p))for(;;){if(Math.abs(u[0]-o[0])<s&&Math.abs(u[1]-o[1])<s)return[e,n];let f=xi(e,t),d=i(f),y=Vi(d,r),g=xi(t,n),m=i(g),h=Vi(m,r);if(!isFinite(y)||!isFinite(h))return;if(f===e||f===t||g===t||g===n)return y<l&&y<h?[f,f]:h<y&&h<l?[g,g]:[t,t];if((y===l||h===l)&&(t=.5*(f+t),a=i(t),l=Vi(a,r),y===l||h===l))return[e,n];y<l&&y<h?([n,t]=[t,f],[u,a]=[a,d],[p,l]=[l,y]):h<y&&h<l?([e,t]=[t,g],[o,a]=[a,m],[c,l]=[l,h]):([e,n]=[f,g],[o,u]=[d,m],[c,p]=[y,h])}}function $D(e,t,n){return t===void 0&&(t=-1/0),n===void 0&&(n=1/0),Math.min(n,Math.max(t,e))}function jP(e,t,n,r,s,i){let o;if(r!==void 0&&s!==void 0){let p=.5*(r+s);o=n+.01*(n<p?s-r:r-s)}else o=Math.abs(n)>1?n*1.00001:n+1e-5;let a=e(n),u=e(o),c=Vi(a,t),l=Vi(u,t);if(!(!isFinite(c)||!isFinite(l))){if(c===l)return[n,o];for(l>c&&([n,o]=[o,n],[a,u]=[u,a],[c,l]=[l,c]);isFinite(n)&&isFinite(o)&&n!==o;){if(s!==void 0&&o>s)return[s,s];if(r!==void 0&&o<r)return[r,r];let p=n+3*(o-n),f=e(p),d=Vi(f,t);if(!isFinite(d))return[n,o];if(d===l)return[n,o];if(d>l){let y=o>n?qD(n,o,p,t,i,e):qD(p,o,n,t,i,e);return y&&[$D(y[0],r,s),$D(y[1],r,s)]}[n,c,o,l]=[o,l,p,d]}return[n,o]}}function YD(e,t,n,r){return n?r?Math.min(Vi(e(r[0]),t),Vi(e(r[1]),t))<Math.min(Vi(e(n[0]),t),Vi(e(n[1]),t)):!1:!0}function EX(e,t,n,r,s,i){let o=jP(e,t,n,r,s,i);if(r!==void 0){let a=jP(e,t,r,r,s,i);YD(e,t,o,a)&&(o=a)}if(s!==void 0){let a=jP(e,t,s,r,s,i);YD(e,t,o,a)&&(o=a)}return o}function XD(e,t,n,r,s,i,o,a){let u=Math.abs(r-t),c=Math.abs(i-r),l=Math.abs(a-i);return u>c&&u>l?[e,n]:l>c&&l>u?[s,o]:[n,s]}function tp(e,t,n,r,s,i,o,a=0){if(!((n-e)*(s-n)<=0)&&!(!isFinite(e)||!isFinite(n)||!isFinite(s))&&!(!isFinite(t)||!isFinite(i))){if(!isFinite(r)){let u=xs(e,t,n,r,o),c=xs(n,r,s,i,o);return u===void 0||c===void 0?void 0:[u,c]}if(!(Math.abs(r-((s-n)*t+(n-e)*i)/(s-e))<a))for(;;){let u=xi(e,n),c=o(u),l=xi(n,s),p=o(l),f=Math.abs(c-Va(t,r)),d=Math.abs(r-Va(c,p)),y=Math.abs(p-Va(r,i));if(f<=a&&d<=a&&y<=a)return;if(!isFinite(c)){let g=xs(e,t,u,c,o),m=xs(u,c,s,i,o);return g===void 0||m===void 0?void 0:[g,m]}if(!isFinite(p)){let g=xs(e,t,l,p,o),m=xs(l,p,s,i,o);return g===void 0||m===void 0?void 0:[g,m]}if((u===e||u===n)&&(l===n||l===s))return Math.abs(r-t)>Math.abs(i-r)?[e,n]:[n,s];if(u===e||u===n)return XD(e,t,n,r,l,p,s,i);if(l===n||l===s)return XD(e,t,u,c,n,r,s,i);f>y&&f>=d?(s=n,i=r,n=u,r=c):y>f&&y>=d?(e=n,t=r,n=l,r=p):(e=u,t=c,s=l,i=p)}}}var $a=(Math.sqrt(5)-1)/2;function cf(e,t){return e>0==t>0?e+$a*(t-e):(1-$a)*e+$a*t}function hu(e,t){let n;e>t&&(n=e,e=t,t=n);let r=e>0,s=t>0,i=Math.abs(e)>.01,o=Math.abs(t)>.01;if(i||o)return cf(e,t);if(e===0)return t*Math.abs(t);if(t===0)return e*Math.abs(e);if(r!==s)return 0;let a=r?Math.sqrt(e*t):-Math.sqrt(e*t);return a>=e&&t>=a?a:cf(e,t)}function eS(e,t,n,r,s,i){if(!isFinite(e)||!isFinite(n)||!isFinite(t)||!isFinite(r))return;e>n&&([e,t,n,r]=[n,r,e,t]);let o=hu(e,n),a=s(o);if(Math.abs(a-cf(t,r))<=i)return;let u=hu(e,o),c=s(u);for(;;){let l=Math.abs(c-cf(t,a)),p=Math.abs(a-cf(r,c));if(l<=i&&p<=i)return;if(l>p){if(n=o,r=a,o=u,a=c,u=hu(e,o),c=s(u),u===e||u===o)return WD(e,t,o,a,n,r);if(!isFinite(c))return ZD(e,t,u,c,n,r,s)}else{if(e=u,t=c,u=o,c=a,o=hu(n,o),a=s(o),o===n||o===u)return WD(e,t,u,c,n,r);if(!isFinite(a))return ZD(e,t,o,a,n,r,s)}}}function ZD(e,t,n,r,s,i,o){let a=xs(e,t,n,r,o),u=xs(n,r,s,i,o);if(!(a===void 0||u===void 0))return[a,u]}function WD(e,t,n,r,s,i){return Math.abs(r-t)>Math.abs(i-r)?[e,n]:[n,s]}function JP(e,t,n){let r=e[0]*(1-$a)+t[0]*$a-n[0],s=e[1]*(1-$a)+t[1]*$a-n[1],i=e[2]*(1-$a)+t[2]*$a-n[2];return r*r+s*s+i*i}function Wy(e,t,n,r,s,i,o,a){if(!isFinite(e)||!isFinite(n)||!la(t)||!la(r))return;e>n&&([e,t,n,r]=[n,r,e,t]);let u=hu(e,n),c=s(u),l=i*i;if(JP(t,r,c)<=l)return;let p=hu(e,u),f=s(p);for(;;){let d=JP(t,c,f),y=JP(r,f,c);if(d<=l&&y<=l)return n-e<a?p:void 0;if(d>y){if(n=u,r=c,u=p,c=f,p=hu(e,u),f=s(p),p===e||u-p<=o)return JD(e,t,u,c,n,r);if(!la(f))return jD(e,t,p,f,n,r,s)}else{if(e=p,t=f,p=u,f=c,u=hu(n,u),c=s(u),u===n||u-p<=o)return JD(e,t,p,f,n,r);if(!la(c))return jD(e,t,u,c,n,r,s)}}}function jD(e,t,n,r,s,i,o){let a=Zy(e,t,n,r,o),u=Zy(n,r,s,i,o);if(!(a===void 0||u===void 0))return[a,u]}function JD(e,t,n,r,s,i){return qa(r,t)>qa(i,r)?[e,n]:[n,s]}var pf=class{constructor(t){this.comparator=t;this._data=[]}size(){return this._data.length}queue(t){let n=this._data.length;for(this._data.push(t);n>0;){let r=n-1>>>1;if(this.comparator(this._data[n],this._data[r])<0){let s=this._data[r];this._data[r]=this._data[n],this._data[n]=s,n=r}else break}}dequeue(){let t=this._data[0],n=this._data.pop();if(this._data.length>0&&n!==void 0){this._data[0]=n;let r=0,s=this._data.length-1;for(;;){let i=(r<<1)+1,o=i+1,a=r;if(i<=s&&this.comparator(this._data[i],this._data[a])<0&&(a=i),o<=s&&this.comparator(this._data[o],this._data[a])<0&&(a=o),a!==r){let u=this._data[a];this._data[a]=this._data[r],this._data[r]=u,r=a}else break}}return t}peek(){return this._data[0]}clear(){this._data.length=0}};function lB(e,t){let n=e.start[1]-e.end[1],r=e.end[0]-e.start[0],s=t.start[1]-t.end[1],i=t.end[0]-t.start[0],o=n*e.end[0]+r*e.end[1],a=s*t.end[0]+i*t.end[1],u=n*i-s*r;if(u!==0)return(n*a-s*o)/u}function pB(e,t,n){if(n.xSlope>=t.xSlope)return;if(t.scanlineX===n.scanlineX)return e;let r=t.start[1]>t.end[1]?t.start:t.end,s=n.start[1]>n.end[1]?n.start:n.end,i=r[1];if(s[1]<r[1]){if(i=s[1],KP(i,t)<s[0])return}else if(r[1]<s[1]){let a=KP(i,n);if(r[0]<a)return}else if(r[0]<s[0])return;let o=lB(t,n);if(o!==void 0)return Math.max(Math.min(o,i),e)}function KP(e,t){let n=t.end[0],r=t.start[0],s=t.end[1],i=t.start[1];if(s===e)return n;if(i===e)return r;{let o=(e-s)/(i-s),a=(1-o)*n+o*r;if(n<r){if(a<=n)return n;if(r<=a)return r}else{if(a<=r)return r;if(n<=a)return n}return a}}function eE(e){let t=0,n=0,r=!1,s=0;for(let{scanlineX:i,isClockwise:o}of e)o?s+=1:s-=1,s!==0&&!r?(r=!0,n=i):s===0&&r&&(r=!1,t+=i-n);return t}var df=class{constructor(t){this.scanlineY=-1/0;let n=1;this.activeEdges=[],this.events=new pf((r,s)=>r.y-s.y),this.scanlineY=-1/0,this.polygonLength=t.length-1;for(let r=t.length-1;r>=1;r--){let s=t[r],i=t[r-1],o={id:n++,index:r-1,end:s,start:i,scanlineX:0,xSlope:1/0,isClockwise:i[1]>s[1],skipIntersectionWith:{}};i[1]>s[1]?(this.events.queue({type:\"+\",y:s[1],edge:o}),this.events.queue({type:\"-\",y:i[1],edge:o}),o.xSlope=(i[0]-s[0])/(i[1]-s[1]),o.scanlineX=s[0]):s[1]>i[1]?(this.events.queue({type:\"+\",y:i[1],edge:o}),this.events.queue({type:\"-\",y:s[1],edge:o}),o.xSlope=(s[0]-i[0])/(s[1]-i[1]),o.scanlineX=i[0]):this.events.queue({type:\"h\",y:i[1],edge:o})}}nextScanline(){var i;let t,n=this.events.peek();if(!n)return;if(n.y<=this.scanlineY)throw new Error(\"Programming error: expected next event to begin a new scanline\");this.scanlineY=n.y,this.updateActiveEdgeScanlineIntersections();let r=eE(this.activeEdges),s=[];for(;t=this.events.dequeue();)if(t.type===\"x\"?this.swapActiveEdges(t):t.type===\"+\"?this.insertActiveEdge(t):t.type===\"-\"&&this.removeActiveEdge(t),s.push(t),((i=this.events.peek())==null?void 0:i.y)!==this.scanlineY)return{y:this.scanlineY,activeEdges:this.activeEdges,lengthBeforeProcessingEvents:r,events:s}}updateActiveEdgeScanlineIntersections(){let t=-1/0;for(let n of this.activeEdges){let r=KP(this.scanlineY,n);r<t?r=t:t=r,n.scanlineX=r}}insertActiveEdge(t){let n=this.activeEdges,r=t.edge,s=t.y,{xSlope:i,scanlineX:o}=r,a;for(a=0;a<n.length;a++){let u=n[a];if(o<u.scanlineX||o===u.scanlineX&&i<=u.xSlope)break}n.splice(a,0,r),this.checkIntersection(s,n[a-1],r),this.checkIntersection(s,r,n[a+1])}checkIntersection(t,n,r){if(!n||!r||n.index===(r.index+1)%this.polygonLength||r.index===(n.index+1)%this.polygonLength)return;if(n.id<r.id){if(n.skipIntersectionWith[r.id])return}else if(r.skipIntersectionWith[n.id])return;let s=pB(t,n,r);if(s===void 0)return;n.id<r.id?n.skipIntersectionWith[r.id]=!0:r.skipIntersectionWith[n.id]=!0;let i={type:\"x\",y:s,edge1:n,edge2:r};this.events.queue(i)}removeActiveEdge(t){let n=this.activeEdges,r=t.edge,s=t.y,i=n.indexOf(r);n.splice(i,1),this.checkIntersection(s,n[i-1],n[i])}swapActiveEdges(t){let n=this.activeEdges,r=t.edge1,s=t.edge2,i=t.y,o=n.indexOf(r),a=o+1;o===-1||n[a]!==s?r.id<s.id?delete r.skipIntersectionWith[s.id]:delete s.skipIntersectionWith[r.id]:(n[o]=s,n[a]=r,this.checkIntersection(i,n[o-1],s),this.checkIntersection(i,r,n[a+1]))}static debugEvent(t){let n=`y=${t.y} `;return n+=t.type===\"x\"?`[x ${t.edge1.index}/${t.edge2.index}]`:`[${t.type} ${t.edge.index}] (${t.edge.end})-(${t.edge.start})`,n}debugState(){return`y=${this.scanlineY}\n${this.activeEdges.map(t=>`[${t.index}] ${t.scanlineX}`)}`}};function dB(e){let t=e.slice(0,2),n=e.slice(-2);return t[0]!==n[0]||t[1]!==n[1]?[...e,...t]:e}function vX(e,t){if(!e)return!1;let n=dB(e),[r,s]=t,i=0;for(let o=n.length-1;o>=3;o-=2){let a=n[o-3],u=n[o-2],c=n[o-1],l=n[o];u>s!=l>s&&r<(c-a)*(s-u)/(l-u)+a&&(u>l?i+=1:u<l&&(i-=1))}return i!==0}function nS(e){if(e.length<4||e[0][0]!==e[e.length-1][0]||e[0][1]!==e[e.length-1][1])return 0;let t=new df(e),n,r=0,s;for(;s=t.nextScanline();){let i=s.lengthBeforeProcessingEvents;n&&(r+=.5*(s.y-n.y)*(i+n.length)),n={y:s.y,length:eE(s.activeEdges)}}return r}function rS(e){if(!e.length)return[];if(e[0][0]!==e[e.length-1][0]||e[0][1]!==e[e.length-1][1])throw new Error(\"Programming error: expected last point to be a duplicate of the first point.\");for(let f=0;f<e.length-1;f++)if(e[f][0]===e[f+1][0]&&e[f][1]===e[f+1][1])throw new Error(`Programming error: unexpected duplicate point at ${f+1}`);let t=new df(e),n=e.slice(0,-1).map(()=>0),r;for(;r=t.nextScanline();)for(let f of r.events){let d={};if(f.type===\"h\"){let y=f.edge;d[y.index]={xMin:Math.min(y.end[0],y.start[0]),xMax:Math.max(y.end[0],y.start[0]),dx:y.end[0]-y.start[0]}}else if(f.type===\"x\"){let y=f.edge1,g=f.edge2,m=tS([y.start,y.end],[g.start,g.end]),h=m>0?-1:m<0?1:0;n[y.index]+=h,n[g.index]-=h}for(let y of r.activeEdges){let g=y.end[1]-y.start[1];for(let m in d){let{xMin:h,xMax:b,dx:x}=d[m];if(h<y.scanlineX&&y.scanlineX<b){let T=x*g,D=T>0?-1:T<0?1:0;n[m]+=D,n[y.index]-=D}}}}let s=e.slice(0,-1).map(()=>0),i=e[0][1],o=0;for(let f=1;f<e.length;f++)e[f][1]<i&&(i=e[f][1],o=f);let a=e.length-1,u=o>0?o-1:a-1,c=(o+1)%a,p=tS([e[u],e[o]],[e[o],e[c]])>0?1:0;s[o]=p>0?-1:1;for(let f=0;f<a-1;f++){let d=(o+f)%a;p+=n[d],s[(d+1)%a]=p>0?-1:1}return s}function tS(e,t){let n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],s=t[1][0]-t[0][0],i=t[1][1]-t[0][1];return n*i-r*s}var fB=tp,jy=xs,mB=3.154019550531224,sS=Math.pow(2,-13),bu=sS*sS,iS=bu*bu,tE=bu,rE=32,_o=[],xu=[];function yB(e,t){for(let n=rE;n>0;n--){let r=mB/rE*n,s=Math.sinh(r),i=Math.cosh(Math.PI/2*s),o=1/(Math.exp(Math.PI/2*s)*i),a=Math.cosh(r)/(i*i);e.push(o),t.push(a)}}yB(_o,xu);var uS=0;for(let e=0;e<xu.length;e++)uS+=xu[e];var Jy=1/(1+2*uS);function zs(e,t,n){return .5*(t*(2-n)+e*n)}function gB(e,t,n){let r=.5*(t+n),s=fB(t,e(t),r,e(r),n,e(n),e);return s?.5*(s[0]+s[1]):r}function ff(e,t,n,r,s){return{x1:e,x2:t,value:n,error:r,minerror:s}}function oS(e,t,n){let r=Math.abs(e(zs(t,n,bu))),s=Math.abs(e(zs(t,n,2*bu))),i=Math.abs(e(zs(t,n,4*bu)));return r<bu||s<bu?!1:r>1.95*s&&s>1.95*i}function nE(e,t,n){let r=zs(n,t,_o[0]),s=zs(t,n,_o[0]),i=e(r),o=e(s),a=zs(t,n,1),u=e(a),c,l;if(isFinite(u)&&!isFinite(i)){if(c=jy(r,i,a,u,e),Math.abs((c-t)/(n-t))>tE)return ff(t,n,NaN,NaN,NaN);t=c,i=e(t)}if(isFinite(u)&&!isFinite(o)){if(l=jy(a,u,s,o,e),Math.abs((l-n)/(n-t))>tE)return ff(t,n,NaN,NaN,NaN);n=l,o=e(n)}if(isFinite(i)&&isFinite(o)&&!isFinite(u)){if(c=jy(r,i,a,u,e),l=jy(a,u,s,o,e),Math.abs((l-c)/(n-t))>tE)return ff(t,n,NaN,NaN,NaN);u=.5*(c+l)}if(oS(e,t,n)||oS(e,n,t))return ff(t,n,NaN,NaN,NaN);let p=u,f=0,d=0,y=0,g=0,m=0,h=0;for(let _=0;_<rE;_+=4)m=e(zs(t,n,_o[_])),h=e(zs(n,t,_o[_])),g=Math.max(g,Math.abs(m),Math.abs(h)),f+=xu[_]*(m+h),m=e(zs(t,n,_o[_+1])),h=e(zs(n,t,_o[_+1])),g=Math.max(g,Math.abs(m),Math.abs(h)),y+=xu[_+1]*(m+h),m=e(zs(t,n,_o[_+2])),h=e(zs(n,t,_o[_+2])),g=Math.max(g,Math.abs(m),Math.abs(h)),d+=xu[_+2]*(m+h),m=e(zs(t,n,_o[_+3])),h=e(zs(n,t,_o[_+3])),g=Math.max(g,Math.abs(m),Math.abs(h)),y+=xu[_+3]*(m+h);let b=p+f,x=b+d,T=x+y,D=Math.abs(d-b),P=Math.abs(y-x),C=Jy*(n-t)*T,S=Jy*Math.abs(n-t)*g*xu[0],O;return D===0?O=Jy*Math.abs(n-t)*P:O=Jy*Math.abs(n-t)*P*(P/D)*(P/D),O=Math.max(O,S),ff(t,n,C,O,S)}function aS(e){let t=-1/0,n=-1/0,r=-1,s=0;for(let i=0;i<e.length;i++){let o=e[i];s+=o.value,o.error>t&&(t=o.error,r=i),o.minerror>n&&(n=o.minerror)}return{maxerror:t,maxminerror:n,maxindex:r,totalvalue:s}}function mf(e,t,n,r=32){if(isNaN(t)||isNaN(n))return NaN;let s=1;if(t>n){let a=t;t=n,n=a,s=-1}if(t===1/0&&n===1/0)return NaN;if(t===-1/0&&n===-1/0)return NaN;if(t===-1/0&&n===1/0)return s*mf(a=>e(a/((1+a)*(1-a)))*(1+a*a)/((1+a)*(1+a)*(1-a)*(1-a)),-1,1,r);if(t===-1/0)return s*mf(a=>-e(n-a/(1-a))/((1-a)*(1-a)),1,0,r);if(n===1/0)return s*mf(a=>e(t+a/(1-a))/((1-a)*(1-a)),0,1,r);let i=[nE(e,t,n)],o=aS(i);for(let a=1;a<r&&!(Math.abs(o.maxerror/o.totalvalue)<=32*iS||o.maxerror<=32*iS||o.maxerror<=32*o.maxminerror||!isFinite(o.maxerror)||!isFinite(o.maxminerror));a++){let u=i[i.length-1];i[i.length-1]=i[o.maxindex],i[o.maxindex]=u;let c=i.pop(),l=gB(e,zs(c.x2,c.x1,.125),zs(c.x1,c.x2,.125));i.push(nE(e,c.x1,l)),i.push(nE(e,l,c.x2)),o=aS(i)}return!isFinite(o.maxerror)||!isFinite(o.maxminerror)?NaN:Math.abs(o.totalvalue)<=10*o.maxminerror?0:s*o.totalvalue}function Ya(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Tu(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function da(){}var Iu=.7,Gc=1/Iu,np=\"\\\\s*([+-]?\\\\d+)\\\\s*\",yf=\"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",pa=\"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",bB=/^#([0-9a-f]{3,8})$/,xB=new RegExp(`^rgb\\\\(${np},${np},${np}\\\\)$`),TB=new RegExp(`^rgb\\\\(${pa},${pa},${pa}\\\\)$`),IB=new RegExp(`^rgba\\\\(${np},${np},${np},${yf}\\\\)$`),PB=new RegExp(`^rgba\\\\(${pa},${pa},${pa},${yf}\\\\)$`),EB=new RegExp(`^hsl\\\\(${yf},${pa},${pa}\\\\)$`),MB=new RegExp(`^hsla\\\\(${yf},${pa},${pa},${yf}\\\\)$`),cS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ya(da,gf,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:lS,formatHex:lS,formatHex8:CB,formatHsl:DB,formatRgb:pS,toString:pS});function lS(){return this.rgb().formatHex()}function CB(){return this.rgb().formatHex8()}function DB(){return hS(this).formatHsl()}function pS(){return this.rgb().formatRgb()}function gf(e){var t,n;return e=(e+\"\").trim().toLowerCase(),(t=bB.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?dS(t):n===3?new Lr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Qy(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Qy(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=xB.exec(e))?new Lr(t[1],t[2],t[3],1):(t=TB.exec(e))?new Lr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=IB.exec(e))?Qy(t[1],t[2],t[3],t[4]):(t=PB.exec(e))?Qy(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=EB.exec(e))?yS(t[1],t[2]/100,t[3]/100,1):(t=MB.exec(e))?yS(t[1],t[2]/100,t[3]/100,t[4]):cS.hasOwnProperty(e)?dS(cS[e]):e===\"transparent\"?new Lr(NaN,NaN,NaN,0):null}function dS(e){return new Lr(e>>16&255,e>>8&255,e&255,1)}function Qy(e,t,n,r){return r<=0&&(e=t=n=NaN),new Lr(e,t,n,r)}function hf(e){return e instanceof da||(e=gf(e)),e?(e=e.rgb(),new Lr(e.r,e.g,e.b,e.opacity)):new Lr}function kc(e,t,n,r){return arguments.length===1?hf(e):new Lr(e,t,n,r==null?1:r)}function Lr(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Ya(Lr,kc,Tu(da,{brighter(e){return e=e==null?Gc:Math.pow(Gc,e),new Lr(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Iu:Math.pow(Iu,e),new Lr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Lr(Bc(this.r),Bc(this.g),Bc(this.b),eg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fS,formatHex:fS,formatHex8:SB,formatRgb:mS,toString:mS}));function fS(){return`#${Vc(this.r)}${Vc(this.g)}${Vc(this.b)}`}function SB(){return`#${Vc(this.r)}${Vc(this.g)}${Vc(this.b)}${Vc((isNaN(this.opacity)?1:this.opacity)*255)}`}function mS(){let e=eg(this.opacity);return`${e===1?\"rgb(\":\"rgba(\"}${Bc(this.r)}, ${Bc(this.g)}, ${Bc(this.b)}${e===1?\")\":`, ${e})`}`}function eg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Bc(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Vc(e){return e=Bc(e),(e<16?\"0\":\"\")+e.toString(16)}function yS(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Lo(e,t,n,r)}function hS(e){if(e instanceof Lo)return new Lo(e.h,e.s,e.l,e.opacity);if(e instanceof da||(e=gf(e)),!e)return new Lo;if(e instanceof Lo)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,s=Math.min(t,n,r),i=Math.max(t,n,r),o=NaN,a=i-s,u=(i+s)/2;return a?(t===i?o=(n-r)/a+(n<r)*6:n===i?o=(r-t)/a+2:o=(t-n)/a+4,a/=u<.5?i+s:2-i-s,o*=60):a=u>0&&u<1?0:o,new Lo(o,a,u,e.opacity)}function tg(e,t,n,r){return arguments.length===1?hS(e):new Lo(e,t,n,r==null?1:r)}function Lo(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Ya(Lo,tg,Tu(da,{brighter(e){return e=e==null?Gc:Math.pow(Gc,e),new Lo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Iu:Math.pow(Iu,e),new Lo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,s=2*n-r;return new Lr(sE(e>=240?e-240:e+120,s,r),sE(e,s,r),sE(e<120?e+240:e-120,s,r),this.opacity)},clamp(){return new Lo(gS(this.h),Ky(this.s),Ky(this.l),eg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=eg(this.opacity);return`${e===1?\"hsl(\":\"hsla(\"}${gS(this.h)}, ${Ky(this.s)*100}%, ${Ky(this.l)*100}%${e===1?\")\":`, ${e})`}`}}));function gS(e){return e=(e||0)%360,e<0?e+360:e}function Ky(e){return Math.max(0,Math.min(1,e||0))}function sE(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var ng=Math.PI/180,rg=180/Math.PI;var sg=18,bS=.96422,xS=1,TS=.82521,IS=4/29,rp=6/29,PS=3*rp*rp,vB=rp*rp*rp;function ES(e){if(e instanceof fa)return new fa(e.l,e.a,e.b,e.opacity);if(e instanceof Xa)return CS(e);e instanceof Lr||(e=hf(e));var t=uE(e.r),n=uE(e.g),r=uE(e.b),s=iE((.2225045*t+.7168786*n+.0606169*r)/xS),i,o;return t===n&&n===r?i=o=s:(i=iE((.4360747*t+.3850649*n+.1430804*r)/bS),o=iE((.0139322*t+.0971045*n+.7141733*r)/TS)),new fa(116*s-16,500*(i-s),200*(s-o),e.opacity)}function cE(e,t,n,r){return arguments.length===1?ES(e):new fa(e,t,n,r==null?1:r)}function fa(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}Ya(fa,cE,Tu(da,{brighter(e){return new fa(this.l+sg*(e==null?1:e),this.a,this.b,this.opacity)},darker(e){return new fa(this.l-sg*(e==null?1:e),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=bS*oE(t),e=xS*oE(e),n=TS*oE(n),new Lr(aE(3.1338561*t-1.6168667*e-.4906146*n),aE(-.9787684*t+1.9161415*e+.033454*n),aE(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function iE(e){return e>vB?Math.pow(e,1/3):e/PS+IS}function oE(e){return e>rp?e*e*e:PS*(e-IS)}function aE(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function uE(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function OB(e){if(e instanceof Xa)return new Xa(e.h,e.c,e.l,e.opacity);if(e instanceof fa||(e=ES(e)),e.a===0&&e.b===0)return new Xa(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*rg;return new Xa(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function MS(e,t,n,r){return arguments.length===1?OB(e):new Xa(e,t,n,r==null?1:r)}function Xa(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function CS(e){if(isNaN(e.h))return new fa(e.l,0,0,e.opacity);var t=e.h*ng;return new fa(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Ya(Xa,MS,Tu(da,{brighter(e){return new Xa(this.h,this.c,this.l+sg*(e==null?1:e),this.opacity)},darker(e){return new Xa(this.h,this.c,this.l-sg*(e==null?1:e),this.opacity)},rgb(){return CS(this).rgb()}}));var OS=-.14861,lE=1.78277,pE=-.29227,ig=-.90649,bf=1.97294,DS=bf*ig,SS=bf*lE,vS=lE*pE-ig*OS;function NB(e){if(e instanceof Hc)return new Hc(e.h,e.s,e.l,e.opacity);e instanceof Lr||(e=hf(e));var t=e.r/255,n=e.g/255,r=e.b/255,s=(vS*r+DS*t-SS*n)/(vS+DS-SS),i=r-s,o=(bf*(n-s)-pE*i)/ig,a=Math.sqrt(o*o+i*i)/(bf*s*(1-s)),u=a?Math.atan2(o,i)*rg-120:NaN;return new Hc(u<0?u+360:u,a,s,e.opacity)}function dE(e,t,n,r){return arguments.length===1?NB(e):new Hc(e,t,n,r==null?1:r)}function Hc(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Ya(Hc,dE,Tu(da,{brighter(e){return e=e==null?Gc:Math.pow(Gc,e),new Hc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Iu:Math.pow(Iu,e),new Hc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*ng,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),s=Math.sin(e);return new Lr(255*(t+n*(OS*r+lE*s)),255*(t+n*(pE*r+ig*s)),255*(t+n*(bf*r)),this.opacity)}}));function zc(e,t){if(!isFinite(e)||!isFinite(t))return NaN;if(e=Math.round(e),t=Math.round(t),e<0&&(e=-e),t<0&&(t=-t),t>e){let r=t;t=e,e=r}if(t===0)return e;let n=e%t;for(;n>0;)e=t,t=n,n=e%t;return t}function Uc(e,t){if(isNaN(e)&&t===0)return NaN;if(e>=0||t===Math.floor(t))return Math.pow(e,t);let n=Ba(t,100);return si(n.n/n.d,t,2)&&n.d%2===1?(n.n%2===0?1:-1)*Math.pow(-e,t):NaN}var fE=[De,Gt,I,R,N,H,wt,ke,Rn,Hn,ut,Kt,xe,de,ce,ie,fe,Ne,le,Le,ye,Re,Pn],AB=new Set(fE),xf=Qn.of(fE.filter(e=>wn(e))),Tf=Qn.of(fE.filter(e=>!wn(e)));function io(e){return AB.has(e)}function NS(e){return io(e)}function ls(e){return AS(e,NaN)}function RS(e){return AS(e,0)}function AS(e,t){switch(e){case I:return t;case N:return[t,t];case H:return[t,t,t];case wt:case ke:return[[t,t,t],[t,t,t]];case Rn:return[[t,t,t],[t,t,t],[t,t,t]];case Hn:return[[[t,t,t],[t,t,t],[t,t,t]],t];case Kt:return[t,t,t];case ut:return{type:\"Action\",updateRules:{}};case de:case Ne:case fe:return[[t,t],[t,t]];case le:return[[t,t],[t,t]];case ce:return[[t,t],t];case ie:return[[t,t],[t,t],[t,t]];case De:case Gt:return!1;case xe:return[];case Re:return[[t,t],[t,t],!1];case Le:case ye:return[[t,t],t,t,t];case Pn:return[t,t];case R:return[t,t];default:let n=e;throw new Error(`${n} does not have a ${t===0?\"zero\":\"NaN\"} type.`)}}function _S(e,t){return ws(ls(e),t)}var $S={spy:kD},{cosh:fp,sinh:jc,tanh:OE,acosh:YS,asinh:XS,atanh:ZS,expm1:LB,log1p:mp,sign:NE,hypot:Ts}=Math,wB=Ba,lg=zc,FB=Uc,WS=Symbol(\"DIVERGES\"),jS=(n=>(n[n.SUCCESS=0]=\"SUCCESS\",n[n.MISSING_CACHE_ENTRY=1]=\"MISSING_CACHE_ENTRY\",n))(jS||{}),Tg=class Tg{constructor(t=Tg.defaultLimit,n){this.limit=t;this.computeSize=n;this.currentSize=0;this.cache=new Map}get(t){let n=this.cache.get(t);return n&&(this.cache.delete(t),this.cache.set(t,n)),n==null?void 0:n.value}set(t,n){let r=this.computeSize?this.computeSize(n):1;if(this.currentSize+r>=this.limit){let s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,{size:r,value:n})}};Tg.defaultLimit=1e5;var up=Tg,Cf=1e4,JS=Cf*2;function VB(){return Cf}function RE(e){Cf=e}var QS=(n=>(n[n.DoesNotTerminate=0]=\"DoesNotTerminate\",n[n.DepthLimitExceeded=1]=\"DepthLimitExceeded\",n))(QS||{});function KS(e,t){if(io(t))return e.recursionTerminationStatus=0,ls(t);throw Rx()}function ev(e,t){if(io(t))return e.recursionTerminationStatus=1,ls(t);throw Ax()}var LS=new WeakMap;function BB(e){let t=LS.get(e);return t||(t=new Set(e),LS.set(e,t)),t}function bE(e){return`${e.fn}:${JSON.stringify(e.args)}`}function GB(e,t){return{status:0,result:[e,t]}}function kB(e){return{status:1,stackFrame:e}}function HB(e,t,n,r){let s=e.recursiveFunctionCache||new up,i=[];i.push(r);let o=0;for(;i.length>0;){if(i.length>Cf||o++>JS)return ev(e,n);let a=i.pop(),{fn:u,args:c}=a,l=t[u](s,...c);if(l===WS)return KS(e,n);if((l==null?void 0:l.status)===1)i.push({fn:u,args:c}),i.push(l.stackFrame);else{let p=bE(a);s.set(p,l.result)}}return s.get(bE(r))[0]}var zB=function(e){let t=e*e;return 1+t===1?1:1+t===t?Math.abs(e):Math.sqrt(t+1)},UB=function(e){let t=e*e;return t<1?NaN:t-1===t?Math.abs(e):Math.sqrt(t-1)};function hr(e,t,n){return Math.max(t,Math.min(n,e))}function Yc(e,t){let n=e%t;return e*t<0&&n!==0?n+t:n}function xE(e,t){if(e=Math.round(e),t=Math.round(t),!isFinite(e)||!isFinite(t))return NaN;if(e===0&&t===0)return 0;let n=lg(e,t);return Math.abs(e/n*t)}function qB(e){if(e.length===0)return NaN;if(e.length===1)return lg(e[0],0);let t=e[0];for(let n=1;n<e.length;n++)t=lg(t,e[n]);return t}function $B(e){if(e.length===0)return NaN;if(e.length===1)return xE(e[0],1);let t=e[0];for(let n=1;n<e.length;n++)t=xE(t,e[n]);return t}function YB(e){if(e.length===0)return[NaN,NaN];if(e.length===1)return SE(e[0],[0,0]);let t=e[0];for(let n=1;n<e.length;n++)t=SE(t,e[n]);return t}function XB(e){if(e.length===0)return[NaN,NaN];if(e.length===1)return vE(e[0],[1,0]);let t=e[0];for(let n=1;n<e.length;n++)t=vE(t,e[n]);return t}function Pu(e,t){if(isNaN(e))return e;if(isNaN(t))return t;if(!isFinite(e)&&!isFinite(t))return NaN;if(t===0||e===t)return 1;if(e===0)return Bi(t);let n=isFinite(e)&&e===Math.round(e),r=isFinite(t)&&t===Math.round(t);if(e<0&&t<0&&e-t<0)return n&&r?0:Bi(e-t)*Bi(t)/(Bi(e)*Pu(-e,-t));if(e<0&&t>0&&e-t<0)return n&&r?Math.pow(-1,t)*Pu(t-e-1,t):Bi(e-t)/Bi(e)*Pu(-(e-t),t);if(e<0&&t<0&&e-t>0)return n&&r?Math.pow(-1,e-t)*Pu(-t-1,e-t):Bi(t)/Bi(e)*Pu(-t,-e);if(e>0&&t<0&&e-t>0){let a=Math.abs(e)>Math.abs(t)?-t:e;return Bi(t)/Pu(e-t,a)}if(e>0&&t>0&&e-t<0)return Bi(e-t)/Pu(t,e);if(e<0||t<0||e-t<0||e<15&&t<15&&e-t<15)return pg(e,t)/ma(t);let s=Ti(e)-Ti(t)-Ti(e-t)-(e-t)*mp(-t/e),i=Math.sqrt(e/(2*Math.PI*t*(e-t)))*Math.pow(e/t,t)*Math.exp(s);return n&&r&&e>0&&t>0&&e-t>0?Math.round(i):i}function pg(e,t){if(isNaN(e))return e;if(isNaN(t))return t;if(!isFinite(e)&&!isFinite(t))return NaN;if(t===0)return 1;if(e===0)return 1/ma(-t);if(e===t)return ma(e);let n=isFinite(e)&&e===Math.round(e),r=isFinite(t)&&t===Math.round(t);if(e<0&&e-t<0)return n&&r?Math.pow(-1,t)*pg(t-e-1,t):Bi(e-t)/Bi(e)*pg(-(e-t),t);if(e<0||e-t<0||e<15&&e-t<15)return ma(e)/ma(e-t);let s=Ti(e)-Ti(e-t)-(e-t)*mp(-t/e),i=Math.sqrt(e/(e-t))*Ig(e,t)*Math.exp(s);return n&&r&&e>0&&t>0&&e-t>0?Math.round(i):i}function ma(e){if(e===-1/0)return NaN;let t=Math.round(e)===e;if(e<0)return t?1/0:1/(Bi(e)*wS(-e));let n=wS(e);return t?Math.round(n):n}function wS(e){return e>171?1/0:e<14?ZB(e):JB(e)}function ZB(e){let t=4.077131788261185,n=7.024675027156382,r=6.657107767450176,s=3.766266976716022,i=1.2792371666711133,o=.24304596436338005,a=.020049769312165774,u=4.154347453162709,c=7.270007565107539,l=6.97805297331391,p=3.989651532924167,f=1.367176195613119,d=.26175627691546965,y=.021742722739397567,g=1+e*(t+e*(n+e*(r+e*(s+e*(i+e*(o+e*a)))))),m=1+e*(u+e*(c+e*(l+e*(p+e*(f+e*(d+e*y)))))),h=e+1,b=1-(h-e);return Ig(h,e)*Math.sqrt(h+(2*e+1)*b)*(g/m)}var WB=Math.pow(2,27)+1;function jB(e){let t=WB*e;return t-(t-e)}var mE=.3678794428706169,yE=-16991745912462731e-25;function Ig(e,t){let n=jB(e),r=e-n,s=e*(mE+yE);if(s===0)return Math.pow(e/Math.E,t);let i=n*mE-s+n*yE+r*mE+r*yE;return Math.pow(s,t)*(1+t*(i/s))}function JB(e){return Ig(e,e)*Math.sqrt(2*Math.PI*e)*Math.exp(ov(e))}var tv=[1/6,-1/30,1/42,-1/30,5/66,-691/2730,7/6,-3617/510,43867/798,-174611/330,854513/138,-236364091/2730,8553103/6,-23749461029/870];function nv(e,t){if(e!==Math.floor(e))return NaN;if(e<0)return NaN;if(e===0)return 1/AE(t);let n=dn(t);if(e===1)return-1/(n*n);let r=Mn(t);if(e===2)return 2*r/(n*n*n);let s=[0,2],i=[];for(let a=3;a<=e;a++){i=[];for(let u=0;u<a;u++){let c=0,l=0;u>0&&(c=(a-u+1)*s[u-1]),u+2<a&&(l=(u+1)*s[u+1]),i.push(-(c+l))}s=i}let o=0;for(let a=e-1;a>=0;a--)o=i[a]+r*o;return o/Math.pow(n,e+1)}function rv(e,t){if(e<0)return NaN;if(e!==Math.floor(e))return NaN;let n=e%2===0?-1:1;if(t<0)return-n*rv(e,1-t)-Math.pow(Math.PI,e+1)*nv(e,Math.PI*t);let r=ma(e),s=0,i=Math.pow(t,-(e+1));for(;t<10;)s+=i,t++,i=Math.pow(t,-(e+1));s+=e===0?-Math.log(t):i*t/e,s+=.5*i;let o=tv,a=e+1,u=2,c=i*t*a/u,l=1/(t*t);for(let p=1;p<=14;p++)c*=l,s+=c*o[p-1],a++,u++,c*=a/u,a++,u++,c*=a/u;return r*n*s}function QB(e){let t=Math.log(e);return Math.exp(Math.round(t))===e?Math.round(t):t}function dg(e,t){if(t===0)return NaN;let n;return t===Math.E?n=Math.log(e):t===2&&Math.log2?n=Math.log2(e):t===10&&Math.log10?n=Math.log10(e):n=Math.log(e)/Math.log(t),Math.pow(t,Math.round(n))===e?Math.round(n):n}function KB(e){return dg(e,10)}function sv(e,t){let[n,r]=e,[s,i]=t;return i===0&&s===0?[NaN,NaN]:n===0&&r===0?[-1/0,0]:i===0&&r===0&&s>0?n>0?zt(dg(n,s),0):zt(dg(-n,s),Math.PI/Math.log(s)):Du(ME(e),ME(t))}function e3(e){return sv(e,[10,0])}var iv=1/Math.PI;function Pg(e){return e>1e12?!1:Math.round(iv*e)*Math.PI===e}function Eg(e){if(e>1e12)return!1;let t=Math.round(2*iv*e);return t%2===1&&t*Math.PI===2*e}function dn(e){return Pg(Math.abs(e))?0:Math.sin(e)}function Mn(e){return Eg(Math.abs(e))?0:Math.cos(e)}function AE(e){let t=Math.abs(e);return Pg(t)?0:Eg(t)?1/0:Math.tan(e)}function t3(e){return Eg(Math.abs(e))?1/0:1/Math.cos(e)}function n3(e){return Pg(Math.abs(e))?1/0:1/Math.sin(e)}function r3(e){let t=Math.abs(e);return Pg(t)?1/0:Eg(t)?0:1/Math.tan(e)}function s3(e){return e>0?Math.atan(1/e):Math.PI/2-Math.atan(e)}function i3(e){return Math.asin(1/e)}function o3(e){return Math.acos(1/e)}function a3(e){return 1/fp(e)}function u3(e){return 1/jc(e)}function c3(e){return 1/OE(e)}function l3(e){return YS(1/e)}function p3(e){return XS(1/e)}function d3(e){return ZS(1/e)}function f3(e){if(e===0||isNaN(e))return e;if(!isFinite(e))return NaN;if(e===Math.floor(e))return e>0?0:-0;let t=Math.round(2*e),n=-.5*t+e,r=t&2?-1:1,s=t&1?Math.cos(Math.PI*n):Math.sin(Math.PI*n);return r*s}function Bi(e){return e===1/0||e===-1/0?0:e===0?1:f3(e)/(Math.PI*e)}function ya(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}function m3(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function TE(e){return e>50?Math.exp(.5*((1-e)*mp(-1/(e-1))-1)+Ti(.5*(e-1))-Ti(.5*(e-2)))*Math.sqrt((1-1/e)/(2*Math.PI)):e/(e+1)*ma((e+1)/2)/(ma(e/2)*Math.sqrt(e*Math.PI))}function cp(e,t,n=e-t){if(Math.abs(n)<.1*(e+t)){let r=n/(e+t),s=n*n/(e+t),i=2*e*r;for(let o=1;o<10;o++){i*=r*r;let a=s+i/(2*o+1);if(a==s)return a;s=a}}return e*Math.log(e/t)+t-e}var y3=[0,.08106146679532726,.0413406959554093,.02767792568499834,.020790672103765093,.016644691189821193,.013876128823070748,.01189670994589177,.010411265261972096,.009255462182712733,.00833056343336287,.007573675487951841,.00694284010720953,.006408994188004207,.0059513701127588475,.005554733551962801];function Ti(e){return e>15?ov(e):e<0?NaN:e===Math.floor(e)?y3[e]:Math.log(ma(e)/(Ig(e,e)*Math.sqrt(2*Math.PI*e)))}function ov(e){let t=.08333333333333333,n=.002777777777777778,r=.0007936507936507937,s=.0005952380952380953,i=.0008417508417508417,o=e*e;return(t-(n-(r-(s-i/o)/o)/o)/o)/e}function Mg(e,t){return t<=0?NaN:TE(t)*Math.pow(1+e*e/t,-((t+1)/2))}function qc(e,t){if(t>0)return 1-qc(e,-t);if(t===-1/0)return 0;if(t===0)return .5;if(e>=40&&t>-1)return .5+TE(e)*g3(e,t);if(t/e<-1e3){let r=t*t;return TE(e)*Math.pow(e,.5*(e-1))*Math.pow(Math.abs(t),-e)*(1-e*e*(e+1)*(1/(2+e)+e*(e+3)/(4*(4+e)*r))/(2*r))}let n=Math.sqrt(t*t+e);return h3((t+n)/(2*n),e/2,e/2)}function g3(e,t){let n=t*t/e,r=t,s=r;for(let i=1;i<=15;i++)r*=-(2*i-1)/(2*i+1)*(.5*(e+1)+i-1)/i*n,s+=r;return s}function ug(e,t,n){return n<=0?NaN:e===-1/0?qc(n,t):e>0&&t>0?qc(n,-e)-qc(n,-t):qc(n,t)-qc(n,e)}function h3(e,t,n){if(e<0||e>1)throw new RangeError(\"First argument must be between 0 and 1.\");if(t===1&&n===1)return e;if(e===0)return 0;if(e===1)return 1;if(t===0)return 1;if(n===0)return 0;{let r=Ti(t+n)-Ti(t)-Ti(n)-cp(t,(t+n)*e)-cp(n,(t+n)*(1-e),(t+n)*e-t),s=Math.exp(r)*Math.sqrt(t*n/(2*Math.PI*(t+n)));return e<(t+1)/(t+n+2)?s*FS(e,t,n)/t:1-s*FS(1-e,n,t)/n}}function FS(e,t,n){let r=Math.pow(2,-52),s=1e-300,i=t+n,o=t+1,a=t-1,u=1,c=1-i*e/o;Math.abs(c)<s&&(c=s),c=1/c;let l=c;for(let p=1;p<=100;p++){let f=2*p,d=p*(n-p)*e/((a+f)*(t+f));c=1+d*c,Math.abs(c)<s&&(c=s),u=1+d/u,Math.abs(u)<s&&(u=s),c=1/c,l*=c*u,d=-(t+p)*(i+p)*e/((t+f)*(o+f)),c=1+d*c,Math.abs(c)<s&&(c=s),u=1+d/u,Math.abs(u)<s&&(u=s),c=1/c;let y=c*u;if(l*=y,Math.abs(y-1)<=r)return l}return l}function b3(e,t){let n=Math.pow(2,-52),r=1e-300,s=1,i=e,o=s/i,a=s/r,u=1/i,c=2,l=0,p=i,f=-(e-1),d=0;do f-=1,p+=1,u=u*f*t+p,u===0&&(u=r),a=p+f*t/a,a===0&&(a=r),u=1/u,l=a*u,o=o*l,d+=1,p+=1,u=u*d*t+p,u===0&&(u=r),a=p+d*t/a,a===0&&(a=r),u=1/u,l=a*u,o*=l,c+=2;while(c<100&&Math.abs(l-1)>n);return o}function x3(e,t){let n=Math.pow(2,-52),r=1e-300,s=1,i=t+1-e,o=s/i,a=s/r,u=1/i,c=2,l=0,p=i;do{let f=-(c-1)*(c-e-1);p+=2,u=u*f+p,u===0&&(u=r),a=p+f/a,a===0&&(a=r),u=1/u,l=a*u,o*=l,c+=1}while(c<100&&Math.abs(l-1)>n);return o}function T3(e,t){let n=t/e,r=NE(t-e)*Math.sqrt(2*cp(1,n)),s=[1,-.3333333333333333,.08333333333333333,-.014814814814814815,.0011574074074074073,.0003527336860670194,-.0001787551440329218,3919263178522438e-20,-2185448510679992e-21,-185406221071516e-20,8296711340953087e-22,-17665952736826078e-23,6707853543401498e-24,10261809784240309e-24,-4382036018453353e-24,914769958223679e-24,-25514193994946248e-27,-5830772132550426e-26,24361948020667415e-27,-50276692801141755e-28,11004392031956135e-29,3371763262400985e-28,-1392388722418162e-28,28534893807047445e-30,-5139111834242572e-31,-19752288294349442e-31,8099521156704561e-31],i=s.length-2,o=0,a=0,u=0,c=0;for(;i>=0;i--)u=(i+2)*o/e+s[i+1],c=r*c+u,o=a,a=u;if(c=e/(e+o)*c,t<e){let l=Math.exp(-.5*e*r*r)*(.5*Za(-r*Math.sqrt(e/2))-c/Math.sqrt(2*Math.PI*e));return isFinite(l)?1-l:1}else{let l=Math.exp(-.5*e*r*r)*(.5*Za(r*Math.sqrt(e/2))+c/Math.sqrt(2*Math.PI*e));return isFinite(l)?l:0}}function VS(e,t,n){return(e-t)/(Math.SQRT2*Math.abs(n))}function If(e){return e<0?.5*Math.exp(-e*e)*Za(-e):1-.5*Math.exp(-e*e)*Za(e)}function I3(e,t,n,r){let s=VS(t,n,r);if(e===-1/0)return If(s);let i=VS(e,n,r);return i>0&&s>0?If(-i)-If(-s):If(s)-If(i)}function _E(e,t,n){return 1/Math.sqrt(2*Math.PI*n*n)*Math.exp(-(e-t)*(e-t)/(2*n*n))}function LE(e,t){return`t${e}:${bg(t)}`}function wE(e){let t=$S.spy(e),n=parseInt(t.slice(0,8),16)&2097151,r=parseInt(t.slice(8,16),16);return(n*4294967296+r)/9007199254740992}function av(e,t){for(let n=t.length-1;n>0;n--){let r=e+\"::sc\"+n,s=Math.floor(wE(r)*(n+1)),i=t[n];t[n]=t[s],t[s]=i}}function P3(e,t){let n=t.slice();return av(e,n),n}function FE(e,t){let n=[];for(let r=0;r<t;r++)n.push(r);return av(e,n),n}function Mu(e,t,n){return wE(e)*(n-t)+t}function E3(e,t,n){let r=0,s,i,o,a;do s=e+\"::sc\"+r,r+=1,i=Mu(s,0,1)*2-1,s=e+\"::sc\"+r,r+=1,o=Mu(s,0,1)*2-1,a=i*i+o*o;while(a>=1||a===0);let u=Math.sqrt(-2*Math.log(a)/a);return t+n*i*u}function M3(e,t){if(t<=0)return NaN;let n=0,r,s,i,o;do r=e+\"::sc\"+n,n+=1,s=Mu(r,0,1)*2-1,r=e+\"::sc\"+n,n+=1,i=Mu(r,0,1)*2-1,o=s*s+i*i;while(o>1);let a=s*s/o,u=t*(Math.pow(o,-2/t)-1);return r=e+\"::sc\"+n,n+=1,(Mu(r,0,1)<.5?-1:1)*Math.sqrt(a*u)}function C3(e,t,n){return t=hr(Math.round(t),0,1/0),t===1/0?NaN:(n=hr(n,0,1),cv(Mu(e,0,1),t,n))}function D3(e,t){return t<0?NaN:uv(Mu(e,0,1),t)}function cg(e,t,n){return e>=t?1:e<0?0:e<Math.floor((t+1)*n)?BS(e,t,n):1-BS(t-e-1,t,1-n)}function BS(e,t,n){let r=(1-n)/n,s=Cg(e,t,n),i=s;for(;e>0&&(s*=e/(t-e+1)*r,i+s!==i);e--)i+=s;return i}function S3(e,t,n,r){return n=hr(Math.round(n),0,1/0),n===1/0?NaN:(r=hr(r,0,1),t<0?0:(e=Math.ceil(e),t=Math.floor(t),e===-1/0?cg(t,n,r):cg(t,n,r)-cg(e-1,n,r)))}function Cg(e,t,n){if(e=Math.round(e),t=hr(Math.round(t),0,1/0),t===1/0)return NaN;if(n=hr(n,0,1),e<0||e>t)return 0;if(n===0)return e===0?1:0;if(n===1)return e===t?1:0;if(e===0)return Math.exp(t*mp(-n));if(e===t)return Math.pow(n,t);let r=Ti(t)-Ti(e)-Ti(t-e)-cp(e,t*n)-cp(t-e,t*(1-n),t*n-e);return Math.exp(r)*Math.sqrt(t/(2*Math.PI*e*(t-e)))}function lp(e,t){return t<0?NaN:(e=Math.round(e),e<0?0:t===0?e===0?1:0:e===0?Math.exp(-t):Math.exp(-Ti(e)-cp(e,t))/Math.sqrt(2*Math.PI*e))}function Pf(e,t){if(isNaN(e)||isNaN(t))return NaN;if(e===1/0)return 1;if(e=Math.floor(e),e<0)return 0;if(t===0)return 1;if(e+1>12&&2.35*(e+1)>t&&.3*(e+1)<t)return T3(e+1,t);if(e+1>=t){let n=b3(e+1,t);return isFinite(n)?1-t*lp(e,t)*n:1}else{let n=x3(e+1,t);return isFinite(n)?t*lp(e,t)*n:0}}function v3(e,t,n){return n<0?NaN:(e=Math.ceil(e),t=Math.floor(t),t<0?0:e===-1/0?Pf(t,n):Pf(t,n)-Pf(e-1,n))}function VE(e,t,n){return n<=t?NaN:e<t||e>n?0:1/(n-t)}function GS(e,t,n){return n<=t?NaN:e<t?0:e>n?1:(e-t)/(n-t)}function O3(e,t,n,r){return GS(t,n,r)-GS(e,n,r)}function N3(e){let t=-e*e;return t<-750?e>=0?1:-1:e>=.065?1-Math.exp(t)*Za(e):e<=-.065?Math.exp(t)*Za(-e)-1:e*(1.1283791670955126+t*(.37612638903183754+t*(.11283791670955126+t*(.026866170645131252+t*.005223977625442188))))}function Za(e){let t=.9999999999999999,n=2.224574423459406,r=2.444115549920689,s=1.7057986861852539,i=.8257463703357973,o=.28647031042892007,a=.07124513844341643,u=.012296749268608364,c=.001347817214557592,l=7263959403471071e-20,p=1,f=3.352953590554884,d=5.227518529742423,y=5.003720878235473,g=3.266590890998987,m=1.5255421920765353,h=.5185887413188858,b=.12747319185915415,x=.02185979575963238,T=.0023889438122503674,D=.00012875032817508128;if(e<0)return e<-6.1?2*Math.exp(e*e):2*Math.exp(e*e)-Za(-e);if(e>50){let P=.5641895835477563,C=e*e;return e>5e7?P/e:P*(C*(C+4.5)+2)/(e*(C*(C+5)+3.75))}else{let P=t+e*(n+e*(r+e*(s+e*(i+e*(o+e*(a+e*(u+e*(c+e*l)))))))),C=p+e*(f+e*(d+e*(y+e*(g+e*(m+e*(h+e*(b+e*(x+e*(T+e*D)))))))));return P/C}}function BE(e){let t=-39.6968302866538,n=220.946098424521,r=-275.928510446969,s=138.357751867269,i=-30.6647980661472,o=2.50662827745924,a=-54.4760987982241,u=161.585836858041,c=-155.698979859887,l=66.8013118877197,p=-13.2806815528857,f=-.00778489400243029,d=-.322396458041136,y=-2.40075827716184,g=-2.54973253934373,m=4.37466414146497,h=2.93816398269878,b=.00778469570904146,x=.32246712907004,T=2.445134137143,D=3.75440866190742,P=.02425,C,S,O;return e>.5?-BE(1-e):e===.5?0:e<0?NaN:e===0?-1/0:(e<P?(C=Math.sqrt(-2*Math.log(e)),O=(((((f*C+d)*C+y)*C+g)*C+m)*C+h)/((((b*C+x)*C+T)*C+D)*C+1)):(C=e-.5,S=C*C,O=(((((t*S+n)*S+r)*S+s)*S+i)*S+o)*C/(((((a*S+u)*S+c)*S+l)*S+p)*S+1)),O-Math.sqrt(2*Math.PI)*(.5*Za(-O/Math.SQRT2)-Math.exp(.5*O*O)*e))}function uv(e,t){if(t<0||e<0||e>1)return NaN;if(t===0||e===0)return 0;if(e===1)return 1/0;let n=-1,r=Math.ceil(t);for(;Pf(r,t)<e;)r=2*r;let s=Math.floor(n+(r-n)/2);for(;n<s&&s<r;)Pf(s,t)<e?n=s:r=s,s=Math.floor(n+(r-n)/2);return r}function cv(e,t,n){if(t!==Math.round(t))return NaN;if(n<0||n>1)return NaN;if(e<0||e>1)return NaN;if(e===0)return 0;if(e===1)return t;if(t===0)return 0;if(n===1)return t;if(n===0)return 0;let r=-1,s=t,i=Math.floor(r+(s-r)/2);for(;r<i&&i<s;)cg(i,t,n)<e?r=i:s=i,i=Math.floor(r+(s-r)/2);return s}function lv(e,t){if(isNaN(t)||t<=0||e<0||e>1)return NaN;if(e===0)return-1/0;if(e===1)return 1/0;if(t===1||t===2||t===4)return gE(t,e);let n,r;if(e===.5)return 0;if(e>.5)n=t>1?BE(e):gE(1,e),r=t>1?gE(1,e):Math.pow(Mg(0,t)*Math.pow(t,(t-1)/2)/(1-e),1/t);else return-lv(1-e,t);return R3(t,e,n,r)}function gE(e,t){let n=4*t*(1-t);switch(e){case 1:return Math.tan(Math.PI*(t-.5));case 2:return 2*(t-.5)*Math.sqrt(2/n);case 4:let r=Math.cos(Math.acos(Math.sqrt(n))/3)/Math.sqrt(n);return NE(t-.5)*2*Math.sqrt(r-1);default:throw new Error(\"_invTSimple() must be called with 1, 2, or 4 df.\")}}function R3(e,t,n,r){if(!isFinite(n)||!isFinite(r))return NaN;let s=n,i=r;for(;;){let o=xi(s,i),a=qc(e,o);if(o===s||o===i)return a>t?s:i;a<t?s=o:i=o}}function A3(e,t,n){return e<0||e>1||n<=t?NaN:e===0?t:e===1?n:t+e*(n-t)}function pv(e,t){let n=fg(e);return(ya(e)-t)*Math.sqrt(e.length)/n}function dv(e,t){let n=e.length,r=ya(e),s=fg(e),i=t.length,o=ya(t),a=fg(t),u=Math.sqrt(((n-1)*s*s+(i-1)*a*a)/(n+i-2));return(r-o)/(u*Math.sqrt(1/n+1/i))}function op(e,t,n){return n<0?ug(-1/0,e,t):n>0?ug(-1/0,-e,t):2*ug(-1/0,-Math.abs(e),t)}function GE(e,t){arguments.length===1&&(t=0);let n=pv(e,t),r=e.length-1;return{lessThan:op(n,r,-1),greaterThan:op(n,r,1),notEqual:op(n,r,0)}}function kE(e,t){let n=dv(e,t),r=e.length+t.length-2;return{lessThan:op(n,r,-1),greaterThan:op(n,r,1),notEqual:op(n,r,0)}}function HE(e){return{min:Dg(e),q1:Xc(e,1),median:gv(e),q3:Xc(e,3),max:Sg(e)}}function _3(e){return e.length}function Dg(e){if(e.length<1)return NaN;let t=e[0];if(isNaN(t))return NaN;for(let n=1;n<e.length;n++){if(isNaN(e[n]))return NaN;e[n]<t&&(t=e[n])}return t}function Sg(e){if(e.length<1)return NaN;let t=e[0];if(isNaN(t))return NaN;for(let n=1;n<e.length;n++){if(isNaN(e[n]))return NaN;e[n]>=t&&(t=e[n])}return t}function fv(e,t){if(!isFinite(t)||t<0||t>1)return NaN;if(e.some(isNaN))return NaN;if(e.length===0)return NaN;let n=e.length,r=Jc(e),s=t*(n-1);return Math.floor(s)===s?e[r[s]]:(Math.ceil(s)-s)*e[r[Math.floor(s)]]+(s-Math.floor(s))*e[r[Math.ceil(s)]]}function Xc(e,t){if(!isFinite(t)||t<0||t>4)return NaN;if(e.some(isNaN))return NaN;let n=Jc(e),r=vg(e,t),s=Math.floor(r),i=Math.ceil(r);return(e[n[s]]+e[n[i]])/2}function IE(e,t){let n=e-t;return Number.isNaN(n)?+Number.isNaN(e)-+Number.isNaN(t):n}function mv(e,t){return IE(e[0],t[0])||IE(e[1],t[1])}function yv(e){let t=[];for(let n=0;n<e;n++)t.push(n);return t}function Jc(e){return yv(e.length).sort((t,n)=>IE(e[t],e[n]))}function L3(e){return yv(e.length).sort((t,n)=>mv(e[t],e[n]))}function vg(e,t){t=Math.round(t);let n=e.length,r=n%2===1,s;return n===1?0:(t===0&&(s=0),t===2&&(s=(n-1)/2),t===4&&(s=n-1),t===1&&(s=r?(n+1)/4-1:(n+2)/4-1),t===3&&(s=r?(3*n+3)/4-1:(3*n+2)/4-1),s===void 0?NaN:s)}function w3(e,t){return Jc(e)[Math.ceil(t*(e.length-1))]+1}function F3(e,t){return Jc(e)[Math.floor(t*(e.length-1))]+1}function V3(e,t){return Jc(e)[Math.ceil(vg(e,t))]+1}function B3(e,t){return Jc(e)[Math.floor(vg(e,t))]+1}function gv(e){return fv(e,.5)}function G3(e){if(e.length<1)return 0;let t=e[0];if(isNaN(t))return 0;let n=0;for(let r=1;r<e.length;r++){if(isNaN(e[r]))return 0;e[r]<t&&(n=r,t=e[r])}return n+1}function k3(e){if(e.length<1)return 0;let t=e[0];if(isNaN(t))return 0;let n=0;for(let r=1;r<e.length;r++)if(e[r]>=t){if(isNaN(e[r]))return 0;n=r,t=e[r]}return n+1}function Df(e){let t=ya(e),n=0;for(let r=0;r<e.length;r++){let s=e[r]-t;n+=s*s}return n/e.length}function H3(e){let t=ya(e),n=0;for(let r=0;r<e.length;r++)n+=Math.abs(e[r]-t);return n/e.length}function hv(e){let t=e.length;return Df(e)*t/(t-1)}function bv(e,t){let n=Math.min(e.length,t.length);e.length!==n&&(e=e.slice(0,n)),t.length!==n&&(t=t.slice(0,n));let r=ya(e),s=ya(t),i=0;for(let o=0;o<n;o++)i+=(e[o]-r)*(t[o]-s);return i/n}function z3(e,t){let n=Math.min(e.length,t.length);return bv(e,t)*n/(n-1)}function Og(e,t){let n=Math.min(e.length,t.length);e.length!==n&&(e=e.slice(0,n)),t.length!==n&&(t=t.slice(0,n));let r=ya(e),s=ya(t),i=0,o=0,a=0;for(let u=0;u<n;u++){let c=e[u]-r,l=t[u]-s;i+=c*c,o+=l*l,a+=c*l}return a/Math.sqrt(i*o)}function zE(e,t,n,r){let s=e[0];for(let o=2;o<e.length;o++){let a=V(Ps(ai(e[o],s),n));if(!si(a,o,10))return 0}let i=V(r);for(let o=0;o<t.length-1;o++){let a=V(Ps(ai(t[o],s),n));if(!si(a,i-t.length+o,10))return 0}return!isFinite(i)||i<e.length||i<t.length?0:i}function UE(e){return e<0||!isFinite(e)?0:e}function PE(e){let t=e.length;if(t===0)return[];let n=[],r=[];for(let a=0;a<t;a++)r.push([e[a],a]);r.sort((a,u)=>{let c=a[0],l=u[0];return c===1/0&&l===1/0||c===-1/0&&l===-1/0?0:c-l});let s=0,i=1,o=1;for(;s<t;){let a=s;for(;a<t-1&&r[a][0]===r[a+1][0];)a+=1;o=a-s+1;let u;for(a=0;a<o;a++)u=r[s+a][1],n[u]=isNaN(e[u])?NaN:i+.5*(o-1);i+=o,s+=o}return n}function U3(e,t){let n=Math.min(e.length,t.length);return e.length!==n&&(e=e.slice(0,n)),t.length!==n&&(t=t.slice(0,n)),Og(PE(e),PE(t))}function fg(e){return Math.sqrt(hv(e))}function q3(e){return Math.sqrt(Df(e))}var $3=mf;function pp(e,t){return Ts(t[0]-e[0],t[1]-e[1])}function Y3(e,t){return Ts(t[0]-e[0],Ts(t[1]-e[1],t[2]-e[2]))}function xv(e,t,n){return[hr(Math.round(e),0,255),hr(Math.round(t),0,255),hr(Math.round(n),0,255)]}function X3(e,t,n){isFinite(e)||(e=0),t=hr(t,0,1),n=hr(n,0,1);let r=n*(1-t/2);r===0||r===1?t=0:t=(n-r)/Math.min(r,1-r);let{r:s,g:i,b:o}=tg(e,t,r).rgb();return xv(s,i,o)}function Z3(e){return e}function W3(e,t){return[e,t]}function j3(e,t,n){return[e,t,n]}function J3(e,t){return[e,t]}function Q3(e){return e}function K3(e){let t=[];if(e.length===0)return[];for(let n=0;n<e.length-1;n++)t.push([e[n],e[n+1]]);return t.push([e[e.length-1],e[0]]),t}function qE(e){if(e.length==0)return 0;let t=[...e,e[0]];return nS(t)}function e2(e){let t=0;for(let n=0;n<e.length-1;n++){let[r,s]=e[n],[i,o]=e[n+1];t+=Oi(i-r,o-s)}if(e.length>1){let[n,r]=e[e.length-1],[s,i]=e[0];t+=Oi(s-n,i-r)}return t}function t2(e){let t=!1;for(let n=0;n<e.length;n++){let r=(n+1)%e.length;e[n][0]===e[r][0]&&e[n][1]===e[r][1]&&(t=!0)}return t?e.filter((n,r)=>{let s=e[r===0?e.length-1:r-1];return n[0]!==s[0]||n[1]!==s[1]}):e}function n2(e){let[t,n,r,s]=e;return[t,r>=0?n:n+r,r>=0?r:-r,s]}function Tv(e,t,n){if(e.length===0)return[];if(e=t2(e),e.length===0)return[];let r=rS([...e,e[0]]),s=[];for(let i=0;i<e.length;i++){let o=e[i>0?i-1:e.length-1],a=e[i],u=e[i<e.length-1?i+1:0],c=r[i]===1,l=N2(o,a,u,c?\"counterclockwise\":\"clockwise\",n);s.push(t?l:n2(l))}return s}function r2(e,t){return Tv(e,!1,t)}function s2(e,t){return Tv(e,!0,t)}function $E(e,t){return[e,t]}var i2=$E,o2=$E;function a2(e,t){let n=[t[0]-e[0],t[1]-e[1]],r=[e[0],e[1]];return Iv(n,r)}function Iv(e,t){return[e,t]}function u2(e){return e[0]}function c2(e){return e[1]}function l2(e,t){let n=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=[e[0],e[1],e[2]];return Pv(n,r)}function Pv(e,t){return[e,t]}function p2(e){return e[0]}function d2(e){return e[1]}function f2(e){return e}function m2(e,t){return[e,t]}function y2(e){return e[0]}function g2(e){return e[1]}function h2(e,t,n){return[e,t,n]}function yp([e,t,n]){let[r,s]=e,[i,o]=t,[a,u]=n,c=i*i+o*o,l=(r*r+s*s-c)/2,p=(c-a*a-u*u)/2,f=(r-i)*(o-u)-(i-a)*(s-o);f=1/f;let d=(l*(o-u)-p*(s-o))*f,y=((r-i)*p-(i-a)*l)*f;return[d,y]}function b2(e){return e[0]}function x2(e){return e[1]}function T2(e){return e[2]}function gp(e){let[[t,n],[r,s],[i,o]]=e,a=r-t,u=s-n,c=i-r,l=o-s;return 2*Math.atan2(a*l-c*u,a*c+u*l)}function YE(e){let t=Math.abs(gp(e));return t<1e-9||t>2*Math.PI-1e-9}function I2(e){return e[0]}function P2(e){return e[1]}function E2(e){return e[0]}function M2(e){return e[1]}function Ev(e){return Math.abs(e)===Math.PI?Math.PI:Yc(e+Math.PI,2*Math.PI)-Math.PI}function Mv(e,t,n,r){return[e,Ev(t),n,r]}function C2([e,t,n,r]){return[e,t,n,r]}function D2(e){return e[2]}function S2(e){return e[3]}function Cv(e){let[t,n,r,s]=e,i=Math.PI*2,o=r===0?i:r>0?r-i:r+i;return[t,n,o,s]}function v2(e){let[t,n,r,s]=Cv(e);return[t,n,r,s]}function O2(e){let[t,n,r,s]=e,i=r>=0?Math.PI-r:-Math.PI-r;return[t,Ev(n+r),i,s]}function N2(e,t,n,r,s){let i=e[0]-t[0],o=e[1]-t[1],a=n[0]-t[0],u=n[1]-t[1],c=Math.atan2(o,i),l=Math.atan2(i*u-o*a,i*a+o*u),p=2*Math.PI;return r===\"clockwise\"?l-=l<0?0:p:r===\"counterclockwise\"&&(l+=l<0?p:0),Mv(t,c,l,s)}function R2(e,t){let[[n,r],[s,i],o]=e;return[[n*t,r*t],[s*t,i*t],o]}function A2(e,t){let n=new Array(e.length);for(let r=0;r<n.length;r++){let s=e[r];n[r]=[s[0]*t,s[1]*t]}return n}function XE(e,t){let[[n,r],[s,i]]=e;return[[t*n,t*r],[t*s,t*i]]}var _2=XE,L2=XE;function w2(e,t){let[[n,r],s]=e;return[[t*n,t*r],t*s]}function F2(e,t){let[[n,r],[s,i],[o,a]]=e;return[[t*n,t*r],[t*s,t*i],[t*o,t*a]]}function V2(e,t){let[[n,r],s,i,o]=e;return[[t*n,t*r],t*s,t*i,o]}function B2(e,t){if(e.length!==t.length)throw new Error(\"Polygon tangent must be added to polygon of same length.\");let n=new Array(e.length);for(let r=0;r<n.length;r++){let s=e[r],i=t[r];n[r]=[s[0]+i[0],s[1]+i[1]]}return n}function Ng(e,t){let[[n,r],[s,i]]=e,[[o,a],[u,c]]=t;return[[n+o,r+a],[s+u,i+c]]}function G2(e,t){let[[n,r,s],[i,o,a]]=e,[[u,c,l],[p,f,d]]=t;return[[n+u,r+c,s+l],[i+p,o+f,a+d]]}var k2=Ng,H2=Ng,z2=Ng;function U2(e,t){let[[n,r],s]=e,[[i,o],a]=t;return[[n+i,r+o],s+a]}function q2(e,t){let[[n,r],[s,i],[o,a]]=e,[[u,c],[l,p],[f,d]]=t;return[[n+u,r+c],[s+l,i+p],[o+f,a+d]]}function $2(e,t){let[[n,r],s,i,o]=e,[[a,u],c,l]=t;return[[n+a,r+u],s+c,i+l,o]}function Y2(e,t){let[[n,r],[s,i],o]=e,[[a,u],[c,l]]=t;return[[n+a,r+u],[s+c,i+l],o]}function ZE(e,t){let[[n,r],[s,i]]=e;return[(1-t)*n+t*s,(1-t)*r+t*i]}function WE(e,t){return ZE(e,hr(t,0,1))}function X2(e,t){t=hr(t,0,1);let[[n,r,s],[i,o,a]]=e;return[(1-t)*n+t*i,(1-t)*r+t*o,(1-t)*s+t*a]}function EE(e,t){return ZE(e,hr(t,0,1/0))}function Z2(e,t){let[[n,r],s]=e,i=Math.min(1,Math.max(0,t));return[n+s*Math.cos(2*Math.PI*i),r+s*Math.sin(2*Math.PI*i)]}function Dv(e,t){let n=Rg(e);if(!n)return[NaN,NaN];if(n.type===\"segment\")return WE([e[0],e[2]],t);if(n.type===\"rays\")return t<=0?EE([n.start1,n.end1],-t):t>=1?EE([n.start2,n.end2],t-1):[NaN,NaN];t=Math.min(1,Math.max(0,t));let r=yp(e),s=gp(e),i=Math.atan2(e[0][1]-r[1],e[0][0]-r[0]),o=pp(r,e[0]),a=i+t*s;return[r[0]+o*Math.cos(a),r[1]+o*Math.sin(a)]}function W2(e,t){if(isNaN(t)||e.length===0)return[[NaN,NaN],[NaN,NaN]];if(t<0||t>=e.length)return[e[0],e[0]];let n=Math.floor(t);return[e[n],e[(n+1)%e.length]]}function j2(e,t){if(isNaN(t)||e.length===0)return[NaN,NaN];if(t<0||t>=e.length)return e[0];let n=Math.floor(t);return WE([e[n],e[(n+1)%e.length]],t-n)}function Rg(e){let[t,n,r]=e,[[s,i],[o,a],[u,c]]=[t,n,r];if(isNaN(s)||isNaN(i)||isNaN(o)||isNaN(a)||isNaN(u)||isNaN(c))return;let l=yp([t,n,r]),p=pp(l,t);if(isFinite(p)&&!YE([t,n,r])){let f=Math.atan2(t[1]-l[1],t[0]-l[0]),d=f+gp([t,n,r]);return{type:\"arc\",center:l,radius:p,startAngle:f,endAngle:d}}else{let f=to(o,a,0,s,i,0,u,c,0);return f<0||f>1?{type:\"rays\",start1:[s,i],end1:[s+(s-u),i+(i-c)],start2:[u,c],end2:[u+(u-s),c+(c-i)]}:{type:\"segment\",start:[s,i],end:[u,c]}}}function J2(e,t,n){let s=pp(e,t);if(s>1e-9)return t;let i=pp(e,n);return i>1e-9?n:isNaN(s)&&isNaN(i)?[NaN,NaN]:e}function Ef(e,t){let[[n,r],s]=e,[[i,o],a]=t,u=Ts(i-n,o-r),c=u*u,l=s*s,p=a*a,[f,d,y]=[u,s,a].sort((D,P)=>P-D),g=f+d+y,m=y-(f-d),h=y+(f-d),b=f+(d-y),x=.01,T;return m<0&&f+x*m===f||h<0&&f+x*h===f||b<0&&f+x*b===f?T=0:T=Math.sqrt(g*m*h*b)/4,[(i+n)/2+(i-n)*(l-p)/(2*c)+-2*(o-r)*T/c,(o+r)/2+(o-r)*(l-p)/(2*c)+2*(i-n)*T/c]}function mg(e,t,n){let[[r,s],i]=e,[[o,a],[u,c]]=t,l=o-r,p=u-r,f=a-s,d=c-s,y=u-o,g=c-a,m=y*y+g*g,h=Ts(y,g),b=l*d-p*f,x=i*h,T=x+b,D=x-b,P=.01,C;if(T<0&&x+P*T===x||D<0&&x+P*D===x?C=0:C=T*D,C<0)return[NaN,NaN];let S=Math.sqrt(C);return[r+(b*g+n*y*S)/m,s+(-b*y+n*g*S)/m]}function Q2(e,t){let[[n,r],[s,i]]=e,[[o,a],[u,c]]=t,l=i-r,p=n-s,f=c-a,d=o-u,y=l*n+p*r,g=f*o+d*a,m=l*d-f*p,h=m/(Ts(l,p)*Ts(f,d));return m===0||1+.1*h===1?[NaN,NaN]:[(d*y-p*g)/m,(l*g-f*y)/m]}function jE(e,t,n=0){let r=mg(t,e,-1);if(Cu(r,e,n,!0))return r;{let s=mg(t,e,1);return Cu(s,e,n,!0)?s:[NaN,NaN]}}function JE(e,t,n=0){let r=mg(e,t,1);if(Cu(r,t,n,!1))return r;{let s=mg(e,t,-1);return Cu(s,t,n,!1)?s:[NaN,NaN]}}function Sv(e,t,n=0){let r=Q2(e,t);return!Cu(r,e,n,!0)||!Cu(r,t,n,!1)?[NaN,NaN]:r}function K2(e,t,n=0){let r=Nv(t,e,n,-1);return dp(r,t,n,!1)?r:[NaN,NaN]}function vv(e,t,n=0){let r=Rv(t,e,n,-1);return!Cu(r,e,n,!0)||!dp(r,t,n,!1)?[NaN,NaN]:r}function eG(e,t,n=0){let r=Nv(e,t,n,1);return dp(r,e,n,!0)?r:[NaN,NaN]}function Ov(e,t,n=0){let r=Rv(e,t,n,1);return!dp(r,e,n,!0)||!Cu(r,t,n,!1)?[NaN,NaN]:r}function tG(e,t,n=0){let r=nG(e,t,n);return!dp(r,e,n,!0)||!dp(r,t,n,!1)?[NaN,NaN]:r}function nG(e,t,n){let r=gg(e);if(hg(r))return vv(r,t,n);let s=gg(t);return hg(s)?Ov(e,s,n):QE(()=>Ef(r,s),()=>Ef(s,r),i=>KE(-1,yg(e,i),yg(t,i)))}function Nv(e,t,n,r){let s=gg(e);return hg(s)?r>0?JE(t,s,n):jE(s,t,n):QE(()=>Ef(s,t),()=>Ef(t,s),i=>KE(r,yg(e,i),rG(t,i)))}function Rv(e,t,n,r){let s=gg(e);return hg(s)?Sv(s,t,n):QE(()=>JE(s,t,n),()=>jE(t,s,n),i=>KE(r,yg(e,i),sG(t)))}function QE(e,t,n){let r=e();if(n(r))return r;let s=t();return n(s)?s:[NaN,NaN]}function KE(e,t,n){return e*_v(t,n)>0}function yg(e,[t,n]){let[r,s]=yp(e);return gp(e)>0?[s-n,t-r]:[n-s,r-t]}function rG([[e,t]],[n,r]){return[t-r,n-e]}function sG([[e,t],[n,r]]){return[n-e,r-t]}function gg(e){let t=yp(e),n=pp(t,Dv(e,0));return isFinite(n)&&!YE(e)?[t,n]:[e[0],e[2]]}function hg(e){return Array.isArray(e[1])}function dp([e,t],n,r,s){let[i,o]=yp(n);return(s?(r&3)===0:(r&12)===0)||Bm(Math.atan2(t-o,e-i),Math.atan2(n[0][1]-o,n[0][0]-i),gp(n))}function Cu([e,t],[[n,r],[s,i]],o,a){let u=to(e,t,0,n,r,0,s,i,0),[c,l]=a?[(o&1)===0,(o&2)===0]:[(o&4)===0,(o&8)===0];return!isNaN(u)&&(u>=0||c)&&(u<=1||l)}function iG(e,t){let[[n,r],[s,i]]=e,[o,a]=t;return[[o,a],[o+(s-n),a+(i-r)]]}function oG(e,t){let[[n,r],[s,i]]=e,[o,a]=t;return[[o,a],[o+(i-r),a-(s-n)]]}function aG(e){let[t,n,r]=e,[s,i]=t,o=Mn(n+r/2),a=dn(n+r/2);return[[s,i],[s+o,i+a]]}function Av(e,t){let[n,r]=e,[s,i]=t;return[n*s-r*i,n*i+s*r]}function e0(e,t){let[n,r,s]=e,[i,o]=n,[a,u]=t;return s&&(u=-u),o===0?[i*a,i*u]:[i*a-o*u,i*u+a*o]}function _v(e,t){let[n,r]=e,[s,i]=t;return n*i-s*r}function uG(e,t){let[n,r]=e,[s,i]=t;return n*s+r*i}function cG(e){let[t,n]=e;return[-n,t]}function lG(e,t){return[e,t,!1]}function pG(e,t){return[e,t,!0]}function dG(e){return[e[0],[0,0],e[2]]}function fG(e){return e[0]}function mG(e){return[[1,0],e,!1]}function yG(e,t){let[n,r]=e;return[[t,0],[(1-t)*n,(1-t)*r],!1]}function gG(e,t){let[n,r]=e,s=Math.cos(t),i=Math.sin(t);return[[s,i],[n*(1-s)+r*i,r*(1-s)-n*i],!1]}function hG(e){let[[t,n],[r,s]]=e,i=r-t,o=s-n,a=i*i+o*o,u=(i*i-o*o)/a,c=2*i*o/a;return[[u,c],[(1-u)*t-c*n,(1+u)*n-c*t],!0]}function bG(e,t){let n=e[2],[r,s,i]=t;return[e0(e,r),oo(e,s),i!==n]}function xG(e){let[[t,n],[r,s],i]=e,o=t*t+n*n,a=t/o,u=-n/o,c=-(t/o*r+n/o*s),l=-(t/o*s-n/o*r);return i&&(u=-u,l=-l),[[a,u],[c,l],i]}function oo(e,t){let[n,r]=e0(e,t),[s,i]=e[1];return[n+s,r+i]}function TG(e,t){let[n,r,s]=e;return s?-t:t}function t0(e,t){let[n,r]=t;return[oo(e,n),oo(e,r)]}var IG=t0,PG=t0;function EG(e,t){let[n,r]=t;return[e0(e,n),oo(e,r)]}function MG(e,t){let[n,r]=t,[[s,i]]=e;return[oo(e,n),Ts(s,i)*r]}function CG(e,t){let[n,r,s]=t;return[oo(e,n),oo(e,r),oo(e,s)]}function DG(e,t){let n=[];for(let r of t)n.push(oo(e,r));return n}function SG(e,t){let[n,r,s]=t,i=oo(e,n),[o,a,u]=e,[c,l]=oo([o,[0,0],u],[Math.cos(r),Math.sin(r)]),p=Math.atan2(l,c),f=TG(e,s);return[i,p,f,t[3]]}function vG(e,t){let n=[];for(let r=0;r<Math.min(e.length,t.length);r++)t[r]&&n.push(e[r]);return n}function OG(e,t){let n=[];for(let r of t)n.push(e[r]);return n}function NG(e){let t=[],n={};for(let r=0;r<e.length;r++){let s=e[r],i=bg(s);n.hasOwnProperty(i)||(n[i]=!0,t.push(r))}return t}function RG(e,t){return[e,t]}function AG(e){return e[0]}function _G(e){return e[1]}function bg(e){if(Array.isArray(e))return`[${e.map(bg).join(\",\")}]`;switch(typeof e){case\"string\":return e;case\"boolean\":case\"number\":return e.toString();case\"object\":if(LG(e)){let n=[];for(let r of We(e.updateRules))n.push(`\"${r}\": ${bg(e.updateRules[r].value)}`);return`{${n.join(\",\")}}`}else return V(e).toString();default:return e}}function LG(e){return typeof e!=\"object\"||!e?!1:e.type===\"Action\"}function wG(e){return e}function FG(e){return e}function zt(e,t){return isNaN(e)||isNaN(t)?[NaN,NaN]:[e,t]}function Eu(e,t){return isNaN(e)||isNaN(t)?zt(NaN,NaN):e===0?zt(0,0):zt(e*Mn(t),e*dn(t))}function VG([e,t]){return e}function BG([e,t]){return t}function GG([e,t]){return Sf(t,e)}function Zc([e,t]){return[e,-t]}function Du(e,t){let[n,r]=t;return Math.abs(r)<=Math.abs(n)?HS(e,t):Zc(HS(kS(e),kS(t)))}function kS([e,t]){return[t,e]}function HS([e,t],[n,r]){let s=r/n,i=1/(n+r*s);return s===0?zt((e+r*(t/n))*i,(t-r*(e/n))*i):zt((e+t*s)*i,(t-e*s)*i)}function Lv([e,t]){return Wc(e,t)}function Wc(e,t){let n=Math.sqrt(.5*(Math.abs(e)+Ts(e,t)));return n===1/0&&(n=2*Math.sqrt(.5*(Math.abs(.25*e)+Ts(.25*e,.25*t)))),n===0||!isFinite(t)?zt(n,t):e>0?zt(n,.5*(t/n)):(t<0&&(n=-n),zt(.5*(t/n),n))}function Is(e){return Du(zt(1,0),e)}function Mf(e){return 0+e}function Sf(e,t){return Math.atan2(Mf(e),Mf(t))}function kG(e,t){let n=e*e+t*t;if(n===1/0)return Math.log(Math.hypot(.5*e,.5*t))+Math.LN2;if(n===0)return Math.log(Math.hypot(e,t));if(.5<n&&n<3){let r=Math.max(e,t),s=Math.min(e,t);return .5*Math.log1p((r+1)*(r-1)+s*s)}else return .5*Math.log(n)}function ME([e,t]){return zt(kG(e,t),Sf(t,e))}function HG([e,t]){let n=Math.exp(e);return t===0?zt(n,0):Eu(n,t)}function zG([e,t]){return zt((e+t)*(e-t),2*e*t)}function zS(e,t){t=t>>>0;let[n,r]=e,s=1,i=0;for(;t;){for(;!(t&1);){let u=(n+r)*(n-r),c=2*n*r;n=u,r=c,t=t>>>1}let o=n*s-r*i,a=n*i+s*r;s=o,i=a,t=t-1>>>0}return zt(s,i)}function UG(e,t){let[n,r]=t;if(r===0)return wv(e,n);let[s,i]=e;if(isNaN(s)||isNaN(i)||isNaN(n)||isNaN(r))return zt(NaN,NaN);let o=Ts(s,i),a=Sf(i,s),u=Math.pow(o,n)*Math.exp(-a*r),c=Math.log(o)*r+a*n;return isFinite(u)?Eu(u,c):Eu(Math.exp(n*Math.log(o)-a*r),c)}function wv(e,t){let[n,r]=e;if(isNaN(n)||isNaN(r)||isNaN(t))return zt(NaN,NaN);switch(t){case-1:return Is(e);case 0:return zt(1,0);case .5:return Lv(e);case 1:return e}return r===0?Number.isInteger(t)||n>=0?zt(Math.pow(n,t),0):Eu(Math.pow(-n,t),Math.PI*t):n===0?r>=0?Eu(Math.pow(r,t),.5*Math.PI*t):Eu(Math.pow(-r,t),-.5*Math.PI*t):t===2?zG(e):t===(t|0)?t<0?Is(zS(e,-t)):zS(e,t):Eu(Math.pow(Math.hypot(n,r),t),t*Sf(r,n))}function Fv([e,t]){return zt(dn(e)*fp(t),Mn(e)*jc(t))}function Vv([e,t]){return zt(Mn(e)*fp(t),-dn(e)*jc(t))}function Bv([e,t]){let[n,r]=n0([-t,e]);return[r,-n]}function Gv([e,t]){return zt(jc(e)*Mn(t),fp(e)*dn(t))}function kv([e,t]){return zt(fp(e)*Mn(t),jc(e)*dn(t))}function n0([e,t]){let n=AE(t),r=OE(e);if(!isFinite(n))return zt(1/r,1/n);let s=n*n,i=1+s,o=jc(e),a=o*o,u=r*r;return zt(i*r/(1+s*u),n/(1+i*a))}function qG(e){return Is(Vv(e))}function $G(e){return Is(Fv(e))}function YG(e){return Is(Bv(e))}function XG(e){return Is(kv(e))}function ZG(e){return Is(Gv(e))}function WG(e){return Is(n0(e))}function r0([e,t]){let n=Wc(1-e,-t),r=Wc(1+e,t);return zt(Math.atan(e/Mf($c(n,r)[0])),Math.asinh($c(Zc(n),r)[1]))}function Hv([e,t]){let n=Wc(1-e,-t),r=Wc(1+e,t);return zt(2*Math.atan(n[0]/Mf(r[0])),Math.asinh($c(Zc(r),n)[1]))}function CE([e,t]){let[n,r]=xg([-t,e]);return[r,-n]}function zv([e,t]){let[n,r]=r0([-t,e]);return[r,-n]}function Uv([e,t]){let n=Wc(e-1,t),r=Wc(e+1,t);return zt(Math.asinh($c(Zc(n),r)[0]),2*Math.atan(n[1]/Mf(r[0])))}function xg([e,t]){if(e<0){let[n,r]=qS(-e,-t);return[-n,-r]}else return qS(e,t)}var US=Math.sqrt(Number.MAX_VALUE)/4;function qS(e,t){if(e>US||Math.abs(t)>US)return zt(Is([e,t])[0],t<=0?-Math.PI/2:Math.PI/2);if(e===1){if(t===0)return zt(1/0,0);let n=Math.abs(t),r=Math.log(Math.sqrt(Math.sqrt(4+t*t))/Math.sqrt(n)),s=(Math.PI/2+Math.atan(n/2))/2;return t<0!=s<0&&(s=-s),zt(r,s)}else return zt(mp(4*e/((1-e)**2+t**2))/4,-Sf(-2*t,(1-e)*(1+e)-t**2)/2)}function jG(e){return Hv(Is(e))}function JG(e){return r0(Is(e))}function QG(e){if(e[0]>0)return CE(Is(e));let[t,n]=CE(e);return zt(Math.PI/2-t,-n)}function KG(e){let[t,n]=e;return t===0&&n===0?zt(1/0,0):Uv(Is(e))}function ek(e){let[t,n]=e;return t===0&&n===0?zt(1/0,0):zv(Is(e))}function tk(e){return e[0]>0?Zc(xg(Zc(Is(e)))):xg(Is(e))}function s0([e,t]){return t===0?e:NaN}function nk([e,t],n){var r,s;return t===0?((r=n.goodCoercionCount)!=null||(n.goodCoercionCount=0),n.goodCoercionCount++,e):(isNaN(t)||((s=n.badCoercionCount)!=null||(n.badCoercionCount=0),n.badCoercionCount++),NaN)}function rk(e){return isNaN(e)?[NaN,NaN]:[e,0]}function qv([e,t]){let n=Math.floor(e),r=Math.floor(t);if(!isFinite(n)||!isFinite(r))return[n,r];let s=e-n,i=t-r;return s+i<1?[n,r]:s>=i?[n+1,r]:[n,r+1]}function sk([e,t]){let n=qv([-e,-t]);return[-n[0],-n[1]]}function ap(e){return[Math.round(e[0]),Math.round(e[1])]}function ik(e,t){let[n,r]=e,[s,i]=t;if(!isFinite(n)||!isFinite(r)||isNaN(s)||isNaN(i))return[NaN,NaN];if(!isFinite(s)&&!isFinite(i))return e;if(s===1/0)return og(n,r,i);if(s===-1/0){let[f,d]=og(-n,-r,-i);return[-f,-d]}else if(i===1/0){let[f,d]=og(r,-n,-s);return[-d,f]}else if(i===-1/0){let[f,d]=og(-r,n,s);return[d,-f]}let o=DE(t),a=n*s+r*i,u=r*s-n*i,c=Yc(a,o),l=Yc(u,o);c+l<o||(c>=l?c-=o:l-=o);let p=Du([c,l],[s,-i]);return Number.isInteger(n)&&Number.isInteger(r)&&Number.isInteger(s)&&Number.isInteger(i)?[Math.round(p[0]),Math.round(p[1])]:p}function og(e,t,n){return e+t<0?e>=t?zt(e-n,1/0):zt(1/0,t+n):[e,t]}function DE([e,t]){return e*e+t*t}function SE(e,t){if(!isFinite(e[0])||!isFinite(e[1])||!isFinite(t[0])||!isFinite(t[1]))return[NaN,NaN];e=ap(e),t=ap(t);let n=i0(e,t);return $v(n)}function i0(e,t){let n=[1,0];for(e=[e[0],e[1]],t=[t[0],t[1]];;){let r=DE(e),s=DE(t);if(r===1||s===1)return n;if(r===0)return $c(t,n);if(s===0)return $c(e,n);if(r===s&&ak(e,t))return $c(e,n);switch(ag(e[0])<<3|ag(e[1])<<2|ag(t[0])<<1|ag(t[1])){case 0:sp(e),sp(t),ok(n);break;case 1:case 2:sp(e);break;case 4:case 8:sp(t);break;case 3:sp(e),ip(t),hE(n);break;case 12:ip(e),sp(t),hE(n);break;case 14:case 13:ip(e);break;case 7:case 11:ip(t);break;case 15:ip(e),ip(t),hE(n);break;case 5:case 10:e=[.5*(e[0]-t[0]),.5*(e[1]-t[1])],t=[e[0]+t[0],e[1]+t[1]];break;case 6:case 9:e=[.5*(e[0]+t[1]),.5*(e[1]-t[0])],t=[e[0]-t[1],e[1]+t[0]];break}}}function ok(e){e[0]*=2,e[1]*=2}function sp(e){e[0]*=.5,e[1]*=.5}function hE(e){let t=e[0]-e[1];e[1]=e[1]+e[0],e[0]=t}function ip(e){let t=.5*(e[0]+e[1]);e[1]=.5*(e[1]-e[0]),e[0]=t}function ag(e){return e%2==0?0:1}function $c(e,t){let[n,r]=e,[s,i]=t;return zt(n*s-r*i,n*i+s*r)}function ak(e,t){return e[0]==t[0]&&e[1]==t[1]||e[0]==-t[0]&&e[1]==-t[1]||e[0]==-t[1]&&e[1]==t[0]||e[0]==t[1]&&e[1]==-t[0]}function $v(e){let[t,n]=e;return t>=0&&n<0?[-n,t]:t<0&&n<=0?[-t,-n]:t<=0&&n>0?[n,-t]:e}function vE(e,t){if(!isFinite(e[0])||!isFinite(e[1])||!isFinite(t[0])||!isFinite(t[1]))return[NaN,NaN];if(e[0]===0&&e[1]===0||t[0]===0&&t[1]===0)return[0,0];if(!isFinite(e[0])||!isFinite(e[1])||!isFinite(t[0])||!isFinite(t[1]))return[NaN,NaN];e=ap(e),t=ap(t);let n=i0(e,t),r=ap(Du(e,n)),s=Av(r,t);return $v(s)}function hp(e,t){return{n:e,d:t}}function an(e){return typeof e==\"object\"&&typeof e.n==\"number\"&&typeof e.d==\"number\"}var vf=Math.pow(2,53)-1;function Qc(e){let t=e.match(/^(-)?(\\d*)?(?:\\.(\\d*))?$/);if(!t)return NaN;let n=t[1],r=t[2],s=t[3];if(!r&&!s)return NaN;let i=!!n;if(s){let o=s.replace(/0+$/,\"\"),a=o.length,u=Math.pow(10,a),c=parseInt(r||\"0\",10)*u+parseInt(o||\"0\",10);return c>vf||u>vf?parseFloat(e):Se(i?-c:c,u)}else{let o=parseInt(r,10);return o>vf?parseFloat(e):Se(i?-o:o,1)}}function V(e){return an(e)?e.n/e.d:+e}function Ii(e){return an(e)?!1:isNaN(e)}function Se(e,t){if(!isFinite(e)||!isFinite(t)||t===0||Math.floor(e)!==e||Math.floor(t)!==t||Math.abs(e)>vf||Math.abs(t)>vf)return e/t;t<0&&(e=-e,t=-t);let n=zc(e,t);return hp(e/n,t/n)}function Us(e){return an(e)?hp(-e.n,e.d):-e}function Yv(e){return an(e)?hp(Math.abs(e.n),Math.abs(e.d)):Math.abs(e)}function Xv(e){return an(e)?e.n===0?e.d/e.n:hp(e.n<0?-e.d:e.d,Math.abs(e.n)):1/e}function qs(e,t){if(!an(e)||!an(t))return V(e)+V(t);let n=zc(e.d,t.d);return Se(e.n*(t.d/n)+t.n*(e.d/n),e.d/n*t.d)}function wr(e,t){if(!an(e)||!an(t))return V(e)*V(t);let n=zc(e.n,t.d),r=zc(t.n,e.d);return Se(e.n/n*(t.n/r),e.d/r*(t.d/n))}function ai(e,t){return qs(e,Us(t))}function Ps(e,t){return!an(e)||!an(t)?V(e)/V(t):wr(e,Xv(t))}function uk(e,t){let n=e,r=t;if(t.n<0&&(r=Us(t),n=Xv(e)),!an(n)||!an(r))return Uc(V(e),V(t));if(e=n,t=r,t.d===1)return Se(Math.pow(e.n,t.n),Math.pow(e.d,t.n));let s=e.n<0;if(s&&t.d%2!==1)return NaN;let o=(s?-1:1)*Math.round(Math.pow(Math.abs(e.n),1/t.d)),a=Math.round(Math.pow(Math.abs(e.d),1/t.d));return Math.pow(o,t.d)!==e.n||Math.pow(a,t.d)!==e.d?Uc(V(e),V(t)):Se(Math.pow(o,t.n),Math.pow(a,t.n))}function Zv(e,t){if(!an(e)||!an(t))return Uc(V(e),V(t));let n=uk(e,t);return an(n)?n:Uc(V(e),V(t))}function Wv(e){if(!an(e))return Math.sqrt(e);let t=Math.round(Math.sqrt(e.n)),n=Math.round(Math.sqrt(e.d));return t*t!==e.n||n*n!==e.d?Math.sqrt(V(e)):Se(t,n)}function jv(e,t){if(!an(e)||!an(t)){let r=V(e),s=V(t);Yc(r,s)}let n=ai(e,wr(t,hp(Math.floor(V(Ps(e,t))),1)));return an(n)?n:Yc(V(e),V(t))}function Jv(e){let t=hp(0,1);for(let n of e)t=qs(t,n);return t}var Q=class extends Yt{constructor(t,n){if(!Array.isArray(t))throw new TypeError(\"Argument to expression constructor must be an Array.\");super(),this.args=t,(!n||!n.skipRegisterDependencies)&&this.registerDependencies()}shouldExportAns(){return!0}registerDependencies(){for(let t=0;t<this.args.length;t++)this.mergeDependencies(this.args[t])}copyWithArgs(t){throw new Error(`Programming Error: copyWithArgs not implemented for ${this.constructor.name}`)}};var Et=class extends Q{constructor(n){super([]);this.isConstant=!0;typeof n==\"number\"&&(n=Se(n,1)),this._constantValue=n}asValue(){let n=this._constantValue;return typeof n==\"boolean\"?n:V(n)}asCompilerValue(){return this._constantValue}scalarExprString(){return this.asValue()>0?String(this.asValue()):\"(\"+String(this.asValue())+\")\"}getEvaluationInfo(){return[{val:this.asValue()}]}isNaN(){let n=this.asValue();return typeof n==\"number\"&&isNaN(n)}};function c0(e){if(!an(e))throw new Error(\"Programming Error: numeric constants should be rational\");return{type:1,valueType:I,value:e}}var vu=c0(Se(0,1)),Kc=c0(Se(1,1)),Of=c0(Se(1,2));function pt(e){return e.map(t=>Ae(t))}function Su(e){return e.map(t=>kt(t))}function ee(e,t){var d,y,g,m,h;let n=t==null?void 0:t.defaultArguments,r=1/0,s=0,i=(d=n==null?void 0:n.length)!=null?d:0;for(let b of e){let x=b.minArity-i;x<r&&(r=x);let T=(y=b.maxArity)!=null?y:1/0;T>s&&(s=T)}let o=(g=t==null?void 0:t.fallthroughUnlessDistribution)!=null?g:!1,a=(m=t==null?void 0:t.allowDotCall)!=null?m:!1,u=(h=t==null?void 0:t.isSeeded)!=null?h:!1,c=t==null?void 0:t.minArityExampleArgs,l=t==null?void 0:t.maxArityExampleArgs,p=t==null?void 0:t.dotMinArityExampleArgs,f=t==null?void 0:t.dotMaxArityExampleArgs;return{minArity:r,getSignatures:b=>e.filter(x=>x.satisfiesPolicy(b)),maxArity:s,defaultArguments:n,fallthroughUnlessDistribution:o,minArityExampleArgs:c,maxArityExampleArgs:l,dotMinArityExampleArgs:p,dotMaxArityExampleArgs:f,allowDotCall:a,isSeeded:u}}function wo(){return ee(pt([{type:\"variadic\",initial:[],rest:Qt}]),{})}var Ag=Qn.of([de,ce,fe,Ne,ie]),o0=Qn.of([de,fe,Ne,le]),bp=Qn.of([N,de,ce,fe,Ne,le,ie,xe,Le,ye,Re]),a0=Qn.of([...ii.types.filter(e=>e!==Zn),Lt]),u0=Qn.of([Qt,pn],{coerceComplexToReal:!1});function el(e){return!!Fo[e]}function An(e){return[kt([Nd(e)]),kt([e]),Ae({type:\"variadic\",initial:[e,e],rest:e})]}function xp(e){return[kt([Nd(e),Nd(e)])]}var Fo={midpoint:ee([...pt([[N,N],[de]]),...pt([[H,H],[wt]])],{allowDotCall:!0}),segment:ee([Ae([N,N]),Ae([H,H])]),vector:ee([Ae([N,N]),Ae([H,H])]),sphere:ee([Ae([N,I]),Ae([H,I])]),distance:ee(pt([[N,N],[H,H]])),glider:ee(pt([[Qn.of([de,ce,fe,Ne,ie,xe]),I]])),circle:ee(pt([[N,de],[N,N],[N,I]]),{}),center:ee(pt([[ce],[ie]]),{allowDotCall:!0}),radius:ee(pt([[ce],[ie]]),{allowDotCall:!0}),intersection:ee(pt([[Ag,Ag]])),strictintersection:ee(pt([[Ag,Ag]])),parallel:ee(pt([[o0,N]])),perpendicular:ee(pt([[o0,N]])),anglebisector:ee(pt([[Tx]])),start:ee([Ae([le]),Ae([ke])],{allowDotCall:!0}),end:ee([Ae([le]),Ae([ke])],{allowDotCall:!0}),length:ee([kt([ii],{geometry:!1,\"3d\":!1}),Ae([wt]),Ae([ke]),Ae([de]),Ae([le]),Ae([ie]),kt({type:\"variadic\",initial:[Qt],rest:Qt},{geometry:!1,\"3d\":!1})],{allowDotCall:!0}),translate:ee(pt([[bp,le],[bp,N,N]])),dilate:ee(pt([[bp,N,I]])),rotate:ee(pt([[bp,N,I]])),reflect:ee(pt([[bp,o0]])),apply:ee(pt([[Re,bp]])),points:ee([]),lines:ee([]),circles:ee([]),arcs:ee([]),polygons:ee([]),rays:ee([]),vectors:ee([]),angle:ee(pt([[N,N,N]])),directedangle:ee(pt([[N,N,N]])),angles:ee(Su([[xe]]),{allowDotCall:!0}),directedangles:ee(Su([[xe]]),{allowDotCall:!0}),coterminal:ee(pt([[Le],[ye]])),round:ee([...pt([[Te],[Te,I]]),...pt([[R],[R,I]])]),mod:ee([...pt([[Te,Te]]),...pt([[R,R]])]),floor:ee([...pt([[Te]]),...pt([[R]])]),ceil:ee([...pt([[Te]]),...pt([[R]])]),abs:ee([...pt([[Te]]),...pt([[R]])]),sign:ee([Ae([Te]),Ae([R])]),real:ee([Ae([R])],{allowDotCall:!0}),imag:ee([Ae([R])],{allowDotCall:!0}),conj:ee([...pt([[Te]]),...pt([[R]])]),exp:ee([Ae([Te]),Ae([R])]),sin:ee([Ae([Te]),Ae([R])]),cos:ee([Ae([Te]),Ae([R])]),tan:ee([Ae([Te]),Ae([R])]),sinh:ee([Ae([Te]),Ae([R])]),cosh:ee([Ae([Te]),Ae([R])]),tanh:ee([Ae([Te]),Ae([R])]),sec:ee([Ae([Te]),Ae([R])]),csc:ee([Ae([Te]),Ae([R])]),cot:ee([Ae([Te]),Ae([R])]),sech:ee([Ae([Te]),Ae([R])]),csch:ee([Ae([Te]),Ae([R])]),coth:ee([Ae([Te]),Ae([R])]),arctan:ee([Ae([Te]),Ae([R]),...pt([[I,I]])]),arcsinh:ee([Ae([Te]),Ae([R])]),arccot:ee([Ae([Te]),Ae([R])]),arccsch:ee([Ae([Te]),Ae([R])]),nthroot:ee([...pt([[I,I]])]),complexNthRoot:ee([...pt([[R,R]])]),sort:ee(Su([[ro],[Ue],[ii,ro],[ii,Ue]]),{minArityExampleArgs:\"([3,2,1])\",maxArityExampleArgs:\"([1,2,3],[3,2,1])\",dotMaxArityExampleArgs:\"([3,4])\",allowDotCall:!0}),shuffle:ee(Su([[ft,ii],[ft,ii,I]]),{minArityExampleArgs:\"([1,2,3])\",maxArityExampleArgs:\"([1,2,3],2)\",dotMaxArityExampleArgs:\"(2)\",allowDotCall:!0,isSeeded:!0}),join:ee(Su([{type:\"variadic\",initial:[u0,u0],rest:u0}]),{minArityExampleArgs:\"([1,2],[3,4])\",dotMinArityExampleArgs:\"([3,4])\",allowDotCall:!0}),unique:ee(Su([[Qn.of(ii.types.filter(e=>e!==Zn&&e!==pn),{coerceComplexToReal:!1})]]),{minArityExampleArgs:\"([1,2,3])\",maxArityExampleArgs:\"([1,2,3])\",allowDotCall:!0}),normaldist:ee(pt([[I,I]]),{defaultArguments:[vu,Kc]}),tdist:ee(pt([[I]])),binomialdist:ee(pt([[I,I]]),{defaultArguments:[Of]}),poissondist:ee(pt([[I]])),uniformdist:ee(pt([[I,I]]),{defaultArguments:[vu,Kc]}),pdf:ee(pt([[Lt,I]]),{allowDotCall:!0}),cdf:ee(pt([[Lt,I],[Lt,I,I]]),{allowDotCall:!0}),median:ee([...pt([[Lt]]),...An(I)],{fallthroughUnlessDistribution:!0,allowDotCall:!0}),stdev:ee([...pt([[Lt]]),...An(Te),...An(R)],{fallthroughUnlessDistribution:!0,allowDotCall:!0}),stdevp:ee([...An(Te),...An(R)],{allowDotCall:!0}),var:ee([...pt([[Lt]]),...An(Te),...An(R)],{fallthroughUnlessDistribution:!0,allowDotCall:!0}),cov:ee([...xp(Te),...xp(R)]),covp:ee([...xp(Te),...xp(R)]),corr:ee([...xp(Te),...xp(R)]),quantile:ee([...pt([[Lt,I]]),kt([ne,oi(I)])],{fallthroughUnlessDistribution:!0,allowDotCall:!0,minArityExampleArgs:\"([1,2,3], 1)\",maxArityExampleArgs:\"([1,2,3], 1)\",dotMinArityExampleArgs:\"(x)\",dotMaxArityExampleArgs:\"(x)\"}),random:ee([kt([ft]),...Su([[ft,I],[ft,I,I],[ft,a0],[ft,a0,I],[ft,a0,I,I]])],{allowDotCall:!0,isSeeded:!0}),polygon:ee([kt([]),...An(N),...Su([[ne,ne],[I,ne],[ne,I]])]),total:ee([...An(Te),...An(R),...An(N),...An(H)],{allowDotCall:!0}),mean:ee([Ae([Lt]),...An(Te),...An(R),...An(N),...An(H)],{fallthroughUnlessDistribution:!0,allowDotCall:!0}),varp:ee([Ae([Lt]),...An(Te),...An(R)],{fallthroughUnlessDistribution:!0,allowDotCall:!0}),mad:ee([...An(Te),...An(R)]),lcm:ee([...An(Te),...An(R)],{allowDotCall:!0}),gcd:ee([...An(Te),...An(R)],{allowDotCall:!0}),min:ee([...An(I)],{allowDotCall:!0}),max:ee([...An(I)],{allowDotCall:!0}),histogram:wo(),dotplot:wo(),boxplot:wo(),ttest:wo(),ittest:wo(),stats:wo(),det:wo(),inv:wo(),transpose:wo(),rref:wo(),trace:wo()};function ck(e){switch(e){case\"default\":case\"trig\":case\"inverseTrig\":case\"trig2\":case\"never-broadcast\":return[I];case\"reducer\":return[ne];case\"doubleReducer\":return[ne,ne];case\"parameterizedReducer\":return[ne,I];case\"color\":return[I,I,I]}}function lk(e){switch(e){case\"default\":case\"trig\":case\"inverseTrig\":case\"trig2\":case\"doubleReducer\":case\"color\":case\"never-broadcast\":return!1;case\"reducer\":case\"parameterizedReducer\":return!0}}function pk(e,t,n){return e===\"reducer\"?1/0:t+n}function A(e,t,n){var d,y,g,m,h;n===void 0&&(n={});let r=(d=n.tag)!=null?d:\"default\",s=(y=n.argumentTypes)!=null?y:ck(r),i=n.defaultArguments?n.defaultArguments.length:0,o=s.length-i,a=pk(r,o,i),u=(g=n.allowDotCall)!=null?g:lk(r),c=(m=n.noPeel)!=null?m:!1,{defaultArguments:l,minArityExampleArgs:p,maxArityExampleArgs:f}=n;return{module:e,symbol:t,argumentTypes:s,defaultArguments:l,returnType:(h=n.returnType)!=null?h:I,tag:r,minArity:o,maxArity:a,allowDotCall:u,noPeel:c,minArityExampleArgs:p,maxArityExampleArgs:f}}function Ou(e){let t;return e in Bn&&(t=Bn[e].tag),t===\"trig\"||t===\"trig2\"||t===\"inverseTrig\"?!0:e===\"angle\"||e===\"angles\"||e===\"directedangle\"||e===\"directedangles\"||e===\"rotate\"}var Bn={sin:A(\"BuiltIn\",\"sin\",{tag:\"trig\"}),cos:A(\"BuiltIn\",\"cos\",{tag:\"trig\"}),tan:A(\"BuiltIn\",\"tan\",{tag:\"trig\"}),cot:A(\"BuiltIn\",\"cot\",{tag:\"trig\"}),sec:A(\"BuiltIn\",\"sec\",{tag:\"trig\"}),csc:A(\"BuiltIn\",\"csc\",{tag:\"trig\"}),arcsin:A(\"Math\",\"asin\",{tag:\"inverseTrig\"}),arccos:A(\"Math\",\"acos\",{tag:\"inverseTrig\"}),arctan:A(\"Math\",\"atan2\",{argumentTypes:[I,I],tag:\"inverseTrig\"}),arccot:A(\"BuiltIn\",\"acot\",{tag:\"inverseTrig\"}),arcsec:A(\"BuiltIn\",\"asec\",{tag:\"inverseTrig\"}),arccsc:A(\"BuiltIn\",\"acsc\",{tag:\"inverseTrig\"}),sinh:A(\"BuiltIn\",\"sinh\"),cosh:A(\"BuiltIn\",\"cosh\"),tanh:A(\"BuiltIn\",\"tanh\"),coth:A(\"BuiltIn\",\"coth\"),sech:A(\"BuiltIn\",\"sech\"),csch:A(\"BuiltIn\",\"csch\"),arcsinh:A(\"BuiltIn\",\"asinh\"),arccosh:A(\"BuiltIn\",\"acosh\"),arctanh:A(\"BuiltIn\",\"atanh\"),arccoth:A(\"BuiltIn\",\"acoth\"),arcsech:A(\"BuiltIn\",\"asech\"),arccsch:A(\"BuiltIn\",\"acsch\"),sqrt:A(\"Math\",\"sqrt\"),rtxsqpone:A(\"BuiltIn\",\"sqrtxsqp1\"),rtxsqmone:A(\"BuiltIn\",\"sqrtxsqm1\"),hypot:A(\"BuiltIn\",\"hypot\",{argumentTypes:[I,I]}),log:A(\"BuiltIn\",\"common_log\"),logbase:A(\"BuiltIn\",\"log_base\",{argumentTypes:[I,I]}),ln:A(\"BuiltIn\",\"log\"),exp:A(\"Math\",\"exp\"),floor:A(\"Math\",\"floor\"),complexFloor:A(\"BuiltIn\",\"complexFloor\",{argumentTypes:[R],returnType:R}),ceil:A(\"Math\",\"ceil\"),complexCeil:A(\"BuiltIn\",\"complexCeil\",{argumentTypes:[R],returnType:R}),round:A(\"Math\",\"round\"),complexRound:A(\"BuiltIn\",\"complexRound\",{argumentTypes:[R],returnType:R}),abs:A(\"Math\",\"abs\"),sign:A(\"BuiltIn\",\"sign\"),mod:A(\"BuiltIn\",\"mod\",{argumentTypes:[I,I]}),complexMod:A(\"BuiltIn\",\"complexMod\",{argumentTypes:[R,R],returnType:R}),nCr:A(\"BuiltIn\",\"nCr\",{argumentTypes:[I,I]}),nPr:A(\"BuiltIn\",\"nPr\",{argumentTypes:[I,I]}),factorial:A(\"BuiltIn\",\"factorial\"),polyGamma:A(\"BuiltIn\",\"polyGamma\",{argumentTypes:[I,I]}),lcm:A(\"BuiltIn\",\"listLCM\",{tag:\"reducer\"}),complexLCM:A(\"BuiltIn\",\"complexListLCM\",{argumentTypes:[Ue],returnType:R,tag:\"reducer\"}),gcd:A(\"BuiltIn\",\"listGCD\",{tag:\"reducer\"}),complexGCD:A(\"BuiltIn\",\"complexListGCD\",{argumentTypes:[Ue],returnType:R,tag:\"reducer\"}),distance:A(\"BuiltIn\",\"distance\",{argumentTypes:[N,N]}),polygon:A(\"BuiltIn\",\"polygon\",{tag:\"reducer\",argumentTypes:[Pt],returnType:xe}),area:A(\"BuiltIn\",\"polygonArea\",{argumentTypes:[xe]}),perimeter:A(\"BuiltIn\",\"polygonPerimeter\",{argumentTypes:[xe]}),pointDet:A(\"BuiltIn\",\"pointDet\",{argumentTypes:[N,N]}),pointDot:A(\"BuiltIn\",\"pointDot\",{argumentTypes:[N,N]}),pointPerp:A(\"BuiltIn\",\"pointPerp\",{argumentTypes:[N],returnType:N}),complexMultiplyPoints:A(\"BuiltIn\",\"complexMultiplyPoints\",{argumentTypes:[N,N],returnType:N}),segment:A(\"BuiltIn\",\"segment\",{argumentTypes:[N,N],returnType:de}),line:A(\"BuiltIn\",\"line\",{argumentTypes:[N,N],returnType:fe}),ray:A(\"BuiltIn\",\"ray\",{argumentTypes:[N,N],returnType:Ne}),vector:A(\"BuiltIn\",\"vector\",{argumentTypes:[N,N],returnType:le}),vectorThreeD:A(\"BuiltIn\",\"vectorThreeD\",{argumentTypes:[H,H],returnType:ke}),mathVector:A(\"BuiltIn\",\"mathVector\",{argumentTypes:[N,N],returnType:le}),mathVectorThreeD:A(\"BuiltIn\",\"mathVectorThreeD\",{argumentTypes:[H,H],returnType:ke}),vectorDisplacementAsPoint:A(\"BuiltIn\",\"vectorDisplacementAsPoint\",{argumentTypes:[le],returnType:N}),vectorThreeDDisplacementAsPoint:A(\"BuiltIn\",\"vectorThreeDDisplacementAsPoint\",{argumentTypes:[ke],returnType:H}),basePointFromVector:A(\"BuiltIn\",\"basePointFromVector\",{argumentTypes:[le],returnType:N}),basePointFromVectorThreeD:A(\"BuiltIn\",\"basePointFromVectorThreeD\",{argumentTypes:[ke],returnType:H}),circle:A(\"BuiltIn\",\"circle\",{argumentTypes:[N,I],returnType:ce}),center:A(\"BuiltIn\",\"center\",{argumentTypes:[ce],returnType:N,allowDotCall:!0}),radius:A(\"BuiltIn\",\"radius\",{argumentTypes:[ce],returnType:I,allowDotCall:!0}),arc:A(\"BuiltIn\",\"arc\",{argumentTypes:[N,N,N],returnType:ie}),arcCenter:A(\"BuiltIn\",\"arcCenter\",{argumentTypes:[ie],returnType:N}),arcFirstPoint:A(\"BuiltIn\",\"arcFirstPoint\",{argumentTypes:[ie],returnType:N}),arcMiddlePoint:A(\"BuiltIn\",\"arcMiddlePoint\",{argumentTypes:[ie],returnType:N}),arcThirdPoint:A(\"BuiltIn\",\"arcThirdPoint\",{argumentTypes:[ie],returnType:N}),arcOmega:A(\"BuiltIn\",\"arcOmega\",{argumentTypes:[ie],returnType:I}),undirectedAngleMarker:A(\"BuiltIn\",\"undirectedAngleMarker\",{argumentTypes:[ye],returnType:Le}),directedAngleMarker:A(\"BuiltIn\",\"directedAngleMarker\",{argumentTypes:[N,I,I,I],returnType:ye}),directedCoterminalAngle:A(\"BuiltIn\",\"directedCoterminalAngle\",{argumentTypes:[ye],returnType:ye}),undirectedCoterminalAngle:A(\"BuiltIn\",\"undirectedCoterminalAngle\",{argumentTypes:[Le],returnType:Le}),supplement:A(\"BuiltIn\",\"supplementAngle\",{argumentTypes:[ye],returnType:ye}),directedAngleMarkerRawDelta:A(\"BuiltIn\",\"angleMarkerRawDelta\",{argumentTypes:[ye],returnType:I}),undirectedAngleMarkerRawDelta:A(\"BuiltIn\",\"angleMarkerRawDelta\",{argumentTypes:[Le],returnType:I}),directedAngleMarkerMultiplier:A(\"BuiltIn\",\"angleMarkerMultiplier\",{argumentTypes:[ye],returnType:I}),undirectedAngleMarkerMultiplier:A(\"BuiltIn\",\"angleMarkerMultiplier\",{argumentTypes:[Le],returnType:I}),polygonInteriorUndirectedAngles:A(\"BuiltIn\",\"polygonInteriorUndirectedAngles\",{argumentTypes:[xe,I],returnType:On,allowDotCall:!0,tag:\"never-broadcast\"}),polygonInteriorDirectedAngles:A(\"BuiltIn\",\"polygonInteriorDirectedAngles\",{argumentTypes:[xe,I],returnType:Nn,allowDotCall:!0,tag:\"never-broadcast\"}),vertices:A(\"BuiltIn\",\"vertices\",{argumentTypes:[xe],returnType:Pt,allowDotCall:!0,tag:\"never-broadcast\"}),segments:A(\"BuiltIn\",\"polygonEdges\",{argumentTypes:[xe],returnType:xn,allowDotCall:!0,tag:\"never-broadcast\"}),scaleTangentTransformation:A(\"BuiltIn\",\"scaleTangentTransformation\",{argumentTypes:[Re,I],returnType:xe}),scaleTangentPolygon:A(\"BuiltIn\",\"scaleTangentPolygon\",{argumentTypes:[xe,I],returnType:xe}),scaleTangentSegment:A(\"BuiltIn\",\"scaleTangentSegment\",{argumentTypes:[de,I],returnType:de}),scaleTangentLine:A(\"BuiltIn\",\"scaleTangentLine\",{argumentTypes:[fe,I],returnType:fe}),scaleTangentRay:A(\"BuiltIn\",\"scaleTangentRay\",{argumentTypes:[Ne,I],returnType:Ne}),scaleTangentCircle:A(\"BuiltIn\",\"scaleTangentCircle\",{argumentTypes:[ce,I],returnType:ce}),scaleTangentArc:A(\"BuiltIn\",\"scaleTangentArc\",{argumentTypes:[ie,I],returnType:ce}),scaleTangentDirectedAngleMarker:A(\"BuiltIn\",\"scaleTangentAngle\",{argumentTypes:[ye,I],returnType:ye}),scaleTangentUndirectedAngleMarker:A(\"BuiltIn\",\"scaleTangentAngle\",{argumentTypes:[Le,I],returnType:Le}),addTangentPolygon:A(\"BuiltIn\",\"addTangentPolygon\",{argumentTypes:[xe,xe],returnType:xe}),addTangentSegment:A(\"BuiltIn\",\"addTangentSegment\",{argumentTypes:[de,de],returnType:de}),addTangentSegmentThreeD:A(\"BuiltIn\",\"addTangentSegmentThreeD\",{argumentTypes:[wt,wt],returnType:wt}),addTangentLine:A(\"BuiltIn\",\"addTangentLine\",{argumentTypes:[fe,fe],returnType:fe}),addTangentRay:A(\"BuiltIn\",\"addTangentRay\",{argumentTypes:[Ne,Ne],returnType:Ne}),addTangentVector:A(\"BuiltIn\",\"addTangentVector\",{argumentTypes:[le,le],returnType:le}),addTangentCircle:A(\"BuiltIn\",\"addTangentCircle\",{argumentTypes:[ce,ce],returnType:ce}),addTangentArc:A(\"BuiltIn\",\"addTangentArc\",{argumentTypes:[ie,ie],returnType:ie}),addTangentTransformation:A(\"BuiltIn\",\"addTangentTransformation\",{argumentTypes:[Re,Re],returnType:Re}),addTangentDirectedAngleMarker:A(\"BuiltIn\",\"addTangentAngle\",{argumentTypes:[ye,ye],returnType:ye}),addTangentUndirectedAngleMarker:A(\"BuiltIn\",\"addTangentAngle\",{argumentTypes:[Le,Le],returnType:Le}),segmentGlider:A(\"BuiltIn\",\"segmentGlider\",{argumentTypes:[de,I],returnType:N}),segmentThreeDGlider:A(\"BuiltIn\",\"segmentThreeDGlider\",{argumentTypes:[wt,I],returnType:H}),lineGlider:A(\"BuiltIn\",\"lineGlider\",{argumentTypes:[fe,I],returnType:N}),rayGlider:A(\"BuiltIn\",\"rayGlider\",{argumentTypes:[Ne,I],returnType:N}),circleGlider:A(\"BuiltIn\",\"circleGlider\",{argumentTypes:[ce,I],returnType:N}),arcGlider:A(\"BuiltIn\",\"arcGlider\",{argumentTypes:[ie,I],returnType:N}),polygonEdgeByParameter:A(\"BuiltIn\",\"polygonEdgeByParameter\",{argumentTypes:[xe,I],returnType:de}),polygonGlider:A(\"BuiltIn\",\"polygonGlider\",{argumentTypes:[xe,I],returnType:N}),chooseNonIncidentPoint:A(\"BuiltIn\",\"chooseNonIncidentPoint\",{argumentTypes:[N,N,N],returnType:N}),circleCircleIntersection:A(\"BuiltIn\",\"circleCircleIntersection\",{argumentTypes:[ce,ce,I],returnType:N}),circleArcIntersection:A(\"BuiltIn\",\"circleArcIntersection\",{argumentTypes:[ce,ie,I],returnType:N}),circleLineIntersection:A(\"BuiltIn\",\"circleLineIntersection\",{argumentTypes:[ce,fe,I],returnType:N}),arcCircleIntersection:A(\"BuiltIn\",\"arcCircleIntersection\",{argumentTypes:[ie,ce,I],returnType:N}),arcArcIntersection:A(\"BuiltIn\",\"arcArcIntersection\",{argumentTypes:[ie,ie,I],returnType:N}),arcLineIntersection:A(\"BuiltIn\",\"arcLineIntersection\",{argumentTypes:[ie,fe,I],returnType:N}),lineCircleIntersection:A(\"BuiltIn\",\"lineCircleIntersection\",{argumentTypes:[fe,ce,I],returnType:N}),lineArcIntersection:A(\"BuiltIn\",\"lineArcIntersection\",{argumentTypes:[fe,ie,I],returnType:N}),lineLineIntersection:A(\"BuiltIn\",\"lineLineIntersection\",{argumentTypes:[fe,fe,I],returnType:N}),lineFromSegment:A(\"BuiltIn\",\"identity\",{argumentTypes:[de],returnType:fe}),lineFromRay:A(\"BuiltIn\",\"identity\",{argumentTypes:[Ne],returnType:fe}),parallel:A(\"BuiltIn\",\"parallel\",{argumentTypes:[fe,N],returnType:fe}),perpendicular:A(\"BuiltIn\",\"perpendicular\",{argumentTypes:[fe,N],returnType:fe}),anglebisector:A(\"BuiltIn\",\"anglebisector\",{argumentTypes:[Le],returnType:Ne}),directedanglebisector:A(\"BuiltIn\",\"anglebisector\",{argumentTypes:[ye],returnType:Ne}),rawTransform:A(\"BuiltIn\",\"rawTransform\",{argumentTypes:[N,N],returnType:Re}),rawTransformConj:A(\"BuiltIn\",\"rawTransformConj\",{argumentTypes:[N,N],returnType:Re}),transformWithoutTranslation:A(\"BuiltIn\",\"transformWithoutTranslation\",{argumentTypes:[Re],returnType:Re}),transformScaleFactor:A(\"BuiltIn\",\"transformScaleFactor\",{argumentTypes:[Re],returnType:N}),translation:A(\"BuiltIn\",\"translation\",{argumentTypes:[N],returnType:Re}),dilation:A(\"BuiltIn\",\"dilation\",{argumentTypes:[N,I],returnType:Re}),rotation:A(\"BuiltIn\",\"rotation\",{tag:\"trig2\",argumentTypes:[N,I],returnType:Re}),reflection:A(\"BuiltIn\",\"reflection\",{argumentTypes:[fe],returnType:Re}),compose:A(\"BuiltIn\",\"composeTransformation\",{argumentTypes:[Re,Re],returnType:Re}),inverse:A(\"BuiltIn\",\"invertTransformation\",{argumentTypes:[Re],returnType:Re}),transformPoint:A(\"BuiltIn\",\"transformPoint\",{argumentTypes:[Re,N],returnType:N}),transformSegment:A(\"BuiltIn\",\"transformSegment\",{argumentTypes:[Re,de],returnType:de}),transformLine:A(\"BuiltIn\",\"transformLine\",{argumentTypes:[Re,fe],returnType:fe}),transformRay:A(\"BuiltIn\",\"transformRay\",{argumentTypes:[Re,Ne],returnType:Ne}),transformVector:A(\"BuiltIn\",\"transformVector\",{argumentTypes:[Re,le],returnType:le}),transformCircle:A(\"BuiltIn\",\"transformCircle\",{argumentTypes:[Re,ce],returnType:ce}),transformArc:A(\"BuiltIn\",\"transformArc\",{argumentTypes:[Re,ie],returnType:ie}),transformPolygon:A(\"BuiltIn\",\"transformPolygon\",{argumentTypes:[Re,xe],returnType:xe}),transformAngleMarker:A(\"BuiltIn\",\"transformAngleMarker\",{argumentTypes:[Re,Le],returnType:Le}),transformDirectedAngleMarker:A(\"BuiltIn\",\"transformAngleMarker\",{argumentTypes:[Re,ye],returnType:ye}),distanceThreeD:A(\"BuiltIn\",\"distanceThreeD\",{argumentTypes:[H,H]}),segmentThreeD:A(\"BuiltIn\",\"segmentThreeD\",{argumentTypes:[H,H],returnType:wt}),triangle:A(\"BuiltIn\",\"triangle\",{argumentTypes:[H,H,H],returnType:Rn}),sphere:A(\"BuiltIn\",\"sphere\",{argumentTypes:[H,I],returnType:Hn}),mean:A(\"BuiltIn\",\"mean\",{tag:\"reducer\"}),total:A(\"BuiltIn\",\"total\",{tag:\"reducer\"}),stdev:A(\"BuiltIn\",\"stdev\",{tag:\"reducer\"}),stdevp:A(\"BuiltIn\",\"stdevp\",{tag:\"reducer\"}),mad:A(\"BuiltIn\",\"mad\",{tag:\"reducer\"}),count:A(\"BuiltIn\",\"listLength\",{tag:\"reducer\",argumentTypes:[pn],noPeel:!0}),listMin:A(\"BuiltIn\",\"listMin\",{tag:\"reducer\"}),listMax:A(\"BuiltIn\",\"listMax\",{tag:\"reducer\"}),min:A(\"Math\",\"min\",{argumentTypes:[I,I],returnType:I}),max:A(\"Math\",\"max\",{argumentTypes:[I,I],returnType:I}),argmin:A(\"BuiltIn\",\"argMin\",{tag:\"reducer\",noPeel:!0}),argmax:A(\"BuiltIn\",\"argMax\",{tag:\"reducer\",noPeel:!0}),median:A(\"BuiltIn\",\"median\",{tag:\"reducer\"}),var:A(\"BuiltIn\",\"variance\",{tag:\"reducer\"}),varp:A(\"BuiltIn\",\"varp\",{tag:\"reducer\"}),cov:A(\"BuiltIn\",\"cov\",{tag:\"doubleReducer\"}),covp:A(\"BuiltIn\",\"covp\",{tag:\"doubleReducer\"}),corr:A(\"BuiltIn\",\"corr\",{tag:\"doubleReducer\"}),spearman:A(\"BuiltIn\",\"spearman\",{tag:\"doubleReducer\"}),quantile:A(\"BuiltIn\",\"quantile\",{tag:\"parameterizedReducer\"}),quartile:A(\"BuiltIn\",\"quartile\",{tag:\"parameterizedReducer\"}),upperQuantileIndex:A(\"BuiltIn\",\"upperQuantileIndex\",{tag:\"parameterizedReducer\"}),lowerQuantileIndex:A(\"BuiltIn\",\"lowerQuantileIndex\",{tag:\"parameterizedReducer\"}),quartileIndex:A(\"BuiltIn\",\"quartileIndex\",{tag:\"parameterizedReducer\"}),upperQuartileIndex:A(\"BuiltIn\",\"upperQuartileIndex\",{tag:\"parameterizedReducer\"}),lowerQuartileIndex:A(\"BuiltIn\",\"lowerQuartileIndex\",{tag:\"parameterizedReducer\"}),normalcdf:A(\"BuiltIn\",\"normalcdf\",{argumentTypes:[I,I,I,I],defaultArguments:[vu,Kc]}),normalpdf:A(\"BuiltIn\",\"normalpdf\",{argumentTypes:[I,I,I],defaultArguments:[vu,Kc]}),binomcdf:A(\"BuiltIn\",\"binomcdf\",{argumentTypes:[I,I,I,I],defaultArguments:[Of]}),binompdf:A(\"BuiltIn\",\"binompdf\",{argumentTypes:[I,I,I],defaultArguments:[Of]}),poissoncdf:A(\"BuiltIn\",\"poissoncdf\",{argumentTypes:[I,I,I]}),poissonpdf:A(\"BuiltIn\",\"poissonpdf\",{argumentTypes:[I,I,I]}),uniformcdf:A(\"BuiltIn\",\"uniformcdf\",{argumentTypes:[I,I,I,I],defaultArguments:[vu,Kc]}),uniformpdf:A(\"BuiltIn\",\"uniformpdf\",{argumentTypes:[I,I,I],defaultArguments:[vu,Kc]}),invT:A(\"BuiltIn\",\"invT\",{argumentTypes:[I,I]}),invPoisson:A(\"BuiltIn\",\"invPoisson\",{argumentTypes:[I,I]}),invBinom:A(\"BuiltIn\",\"invBinom\",{argumentTypes:[I,I,I]}),invUniform:A(\"BuiltIn\",\"invUniform\",{argumentTypes:[I,I,I]}),tpdf:A(\"BuiltIn\",\"tpdf\",{argumentTypes:[I,I]}),tcdf:A(\"BuiltIn\",\"tcdf\",{argumentTypes:[I,I,I]}),erf:A(\"BuiltIn\",\"erf\"),invNorm:A(\"BuiltIn\",\"invNorm\"),tscore:A(\"BuiltIn\",\"tscore\",{tag:\"parameterizedReducer\",defaultArguments:[vu]}),normalSample:A(\"BuiltIn\",\"normalSample\",{argumentTypes:[ft,I,I]}),uniformSample:A(\"BuiltIn\",\"uniformSample\",{argumentTypes:[ft,I,I]}),tSample:A(\"BuiltIn\",\"tSample\",{argumentTypes:[ft,I]}),poissonSample:A(\"BuiltIn\",\"poissonSample\",{argumentTypes:[ft,I]}),binomSample:A(\"BuiltIn\",\"binomSample\",{argumentTypes:[ft,I,I]}),rgb:A(\"BuiltIn\",\"rgb\",{returnType:Kt,tag:\"color\"}),hsv:A(\"BuiltIn\",\"hsv\",{returnType:Kt,tag:\"color\"}),tone:A(\"BuiltIn\",\"tone\",{argumentTypes:[I,I],returnType:Pn,defaultArguments:[Of],minArityExampleArgs:\"(440)\",maxArityExampleArgs:\"(440, 0.5)\"}),validateRangeLength:A(\"BuiltIn\",\"validateRangeLength\",{returnType:I,argumentTypes:[ne,ne,I,I],tag:\"never-broadcast\",noPeel:!0}),validateSampleCount:A(\"BuiltIn\",\"validateSampleCount\",{returnType:I,argumentTypes:[I]}),select:A(\"BuiltIn\",\"select\",{argumentTypes:[pn,Xn],returnType:e=>e[0],tag:\"never-broadcast\",noPeel:!0}),shuffle:A(\"BuiltIn\",\"shuffle\",{argumentTypes:[ft,pn],returnType:e=>e[1],tag:\"never-broadcast\"}),sortPerm:A(\"BuiltIn\",\"sortPerm\",{argumentTypes:[ne],returnType:ne,tag:\"never-broadcast\",noPeel:!0}),complexSortPerm:A(\"BuiltIn\",\"complexSortPerm\",{argumentTypes:[Ue],returnType:ne,tag:\"never-broadcast\",noPeel:!0}),elementsAt:A(\"BuiltIn\",\"elementsAt\",{argumentTypes:[pn,ne],returnType:e=>e[0],tag:\"never-broadcast\",noPeel:!0}),uniquePerm:A(\"BuiltIn\",\"uniquePerm\",{argumentTypes:[pn],returnType:ne,tag:\"never-broadcast\",noPeel:!0}),restriction:A(\"BuiltIn\",\"restriction\",{argumentTypes:[De],returnType:Gt}),restrictionToBoolean:A(\"BuiltIn\",\"restrictionToBoolean\",{argumentTypes:[Gt],returnType:De}),complex:A(\"BuiltIn\",\"complex\",{argumentTypes:[I,I],returnType:R}),arg:A(\"BuiltIn\",\"arg\",{argumentTypes:[R],returnType:I}),complexDivide:A(\"BuiltIn\",\"complexDivide\",{argumentTypes:[R,R],returnType:R}),peelableCoerceComplexToReal:A(\"BuiltIn\",\"coerceComplexToReal\",{argumentTypes:[R],returnType:I}),coerceComplexToReal:A(\"BuiltIn\",\"coerceComplexToReal\",{argumentTypes:[R],returnType:I}),coerceRealToComplex:A(\"BuiltIn\",\"coerceRealToComplex\",{argumentTypes:[I],returnType:R}),complexSqrt:A(\"BuiltIn\",\"complexSqrt\",{argumentTypes:[R],returnType:R}),complexLn:A(\"BuiltIn\",\"complexLog\",{argumentTypes:[R],returnType:R}),complexLogbase:A(\"BuiltIn\",\"complexLogbase\",{argumentTypes:[R,R],returnType:R}),complexLog:A(\"BuiltIn\",\"complexCommonLog\",{argumentTypes:[R],returnType:R}),complexExp:A(\"BuiltIn\",\"complexExp\",{argumentTypes:[R],returnType:R}),complexPow:A(\"BuiltIn\",\"complexPow\",{argumentTypes:[R,R],returnType:R}),complexSin:A(\"BuiltIn\",\"complexSin\",{argumentTypes:[R],returnType:R}),complexCos:A(\"BuiltIn\",\"complexCos\",{argumentTypes:[R],returnType:R}),complexTan:A(\"BuiltIn\",\"complexTan\",{argumentTypes:[R],returnType:R}),complexSinh:A(\"BuiltIn\",\"complexSinh\",{argumentTypes:[R],returnType:R}),complexCosh:A(\"BuiltIn\",\"complexCosh\",{argumentTypes:[R],returnType:R}),complexTanh:A(\"BuiltIn\",\"complexTanh\",{argumentTypes:[R],returnType:R}),complexSec:A(\"BuiltIn\",\"complexSec\",{argumentTypes:[R],returnType:R}),complexCsc:A(\"BuiltIn\",\"complexCsc\",{argumentTypes:[R],returnType:R}),complexCot:A(\"BuiltIn\",\"complexCot\",{argumentTypes:[R],returnType:R}),complexSech:A(\"BuiltIn\",\"complexSech\",{argumentTypes:[R],returnType:R}),complexCsch:A(\"BuiltIn\",\"complexCsch\",{argumentTypes:[R],returnType:R}),complexCoth:A(\"BuiltIn\",\"complexCoth\",{argumentTypes:[R],returnType:R}),complexArcsin:A(\"BuiltIn\",\"complexAsin\",{argumentTypes:[R],returnType:R}),complexArccos:A(\"BuiltIn\",\"complexAcos\",{argumentTypes:[R],returnType:R}),complexArctan:A(\"BuiltIn\",\"complexAtan\",{argumentTypes:[R],returnType:R}),complexArcsec:A(\"BuiltIn\",\"complexAsec\",{argumentTypes:[R],returnType:R}),complexArccsc:A(\"BuiltIn\",\"complexAcsc\",{argumentTypes:[R],returnType:R}),complexArccot:A(\"BuiltIn\",\"complexAcot\",{argumentTypes:[R],returnType:R}),complexArcsinh:A(\"BuiltIn\",\"complexAsinh\",{argumentTypes:[R],returnType:R}),complexArccosh:A(\"BuiltIn\",\"complexAcosh\",{argumentTypes:[R],returnType:R}),complexArctanh:A(\"BuiltIn\",\"complexAtanh\",{argumentTypes:[R],returnType:R}),complexArcsech:A(\"BuiltIn\",\"complexAsech\",{argumentTypes:[R],returnType:R}),complexArccsch:A(\"BuiltIn\",\"complexAcsch\",{argumentTypes:[R],returnType:R}),complexArccoth:A(\"BuiltIn\",\"complexAcoth\",{argumentTypes:[R],returnType:R}),angleVertex:A(\"BuiltIn\",\"angleVertex\",{argumentTypes:[Le],returnType:N}),angleStart:A(\"BuiltIn\",\"angleStart\",{argumentTypes:[Le],returnType:I}),directedAngleVertex:A(\"BuiltIn\",\"angleVertex\",{argumentTypes:[ye],returnType:N}),directedAngleStart:A(\"BuiltIn\",\"angleStart\",{argumentTypes:[ye],returnType:I})},Ip={sqrt:\"complexSqrt\",ln:\"complexLn\",log:\"complexLog\",logbase:\"complexLogbase\",exp:\"complexExp\",sin:\"complexSin\",cos:\"complexCos\",tan:\"complexTan\",sinh:\"complexSinh\",cosh:\"complexCosh\",tanh:\"complexTanh\",sec:\"complexSec\",csc:\"complexCsc\",cot:\"complexCot\",sech:\"complexSech\",csch:\"complexCsch\",coth:\"complexCoth\",arcsin:\"complexArcsin\",arccos:\"complexArccos\",arctan:\"complexArctan\",arcsec:\"complexArcsec\",arccsc:\"complexArccsc\",arccot:\"complexArccot\",arcsinh:\"complexArcsinh\",arccosh:\"complexArccosh\",arctanh:\"complexArctanh\",arcsech:\"complexArcsech\",arccsch:\"complexArccsch\",arccoth:\"complexArccoth\",floor:\"complexFloor\",ceil:\"complexCeil\",mod:\"complexMod\",nthroot:\"complexNthRoot\",sortPerm:\"complexSortPerm\"},dk={sqrt:!0,ln:!0,log:!0,logbase:!0,arcsin:!0,arccos:!0,arcsec:!0,arccsc:!0,arccosh:!0,arctanh:!0,arcsech:!0,arccoth:!0,nthroot:!0};function _g(e,t){return e.isComplexEnabled()&&t in dk?Ip[t]:t}function Tp(e){return!!Bn[e]}function Nf(e,t){let n=el(t)?Fo[t]:void 0;if(!n&&!Tp(t))return;let r=[];return n&&(r=[...n.getSignatures(e)]),Tp(t)&&!n&&r.push(...l0(t)),r}function l0(e){var s;let t=[],n=Bn[e],r=(s=n.returnType)!=null?s:I;switch(n.tag){case\"reducer\":{if(Array.isArray(n.argumentTypes)&&typeof n.argumentTypes[0]==\"number\"&&j(n.argumentTypes[0])&&typeof r==\"number\"&&wn(r)){let i=n.argumentTypes[0],o=Ve(i);t.push(...An(o))}else throw new Error(`Programming error: declared argumentTypes for built-in function ${e} is not consistent with \"reducer\"`);break}case\"parameterizedReducer\":{if(t.push(kt(n.argumentTypes)),Array.isArray(n.argumentTypes)&&n.argumentTypes.length===2){let i=n.argumentTypes[1];t.push(kt([n.argumentTypes[0],typeof i==\"number\"&&wn(i)?oi(i):i]))}break}case\"doubleReducer\":case\"never-broadcast\":{t.push(kt(n.argumentTypes));break}default:{t.push(kt(n.argumentTypes.map(i=>ty(i)?oi(i):i)));break}}return t}var we=class extends Q{constructor(t){super([]),this._symbol=no(t),this._errorSymbol=this._symbol,this.addDependency(this._symbol)}setInputSpan(t){super.setInputSpan(t),this._errorSymbol=no(this.getInputString())}getInputSpan(){return this._inputSpan===void 0?Vs(this._symbol,0,this._symbol.length):this._inputSpan}};var gn=class extends Q{constructor(t,n){super(n,{skipRegisterDependencies:!0}),typeof t==\"string\"&&(t=new we(t)),this._identifier=t,this._symbol=t._symbol,this._errorSymbol=t._errorSymbol===\"logbase\"?\"log\":t._errorSymbol,this.registerDependencies()}registerDependencies(){this.addDependency(this._symbol),super.registerDependencies(),Ou(this._symbol)&&this.addDependency(\"trigAngleMultiplier\")}};var ao=class extends Q{slot(t){return this.args[t]}};var p0={pi:new Et(Math.PI),tau:new Et(2*Math.PI),e:new Et(Math.E),trigAngleMultiplier:new Et(Se(1,1)),infty:new Et(1/0),identityTransformation:new gn(\"translation\",[new ao([new Et(0),new Et(0)])])};var Lg=class extends Yt{constructor(){super(...arguments);this.isFunction=!0}},tl,tt={};for(tl of We(p0))tt[tl]=p0[tl];for(tl of We(Bn))tt[tl]=new Lg;for(tl of We(Fo))tt[tl]=new Lg;var Jr={\"<\":{inclusive:!1,direction:-1},\"!=\":{inclusive:!1,direction:0},\">\":{inclusive:!1,direction:1},\"<=\":{inclusive:!0,direction:-1},\"=\":{inclusive:!0,direction:0},\">=\":{inclusive:!0,direction:1}};function nl(e,t){switch(t){case-1:return e?\"<=\":\"<\";case 0:return e?\"=\":\"!=\";case 1:return e?\">=\":\">\";default:throw\"Programming error.  Comparators must have a direction of -1, 0, or 1\"}}var Es=class extends Q{};var uo=class e extends Q{constructor(n,r){super(r);this.operator=n;this._difference=Jr[this.operator].direction===-1?new Es([r[1],r[0]]):new Es([r[0],r[1]])}static create(n){class r extends e{constructor(i){super(n,i)}}return r}asComparator(){return this}isInequality(){return Jr[this.operator].direction!==0}};var ps={\"<\":uo.create(\"<\"),\">\":uo.create(\">\"),\"<=\":uo.create(\"<=\"),\">=\":uo.create(\">=\"),\"=\":uo.create(\"=\")};var Nu=class extends Yt{constructor(t,n){super(),this.mergeDependencies(t,n),this._lhs=t,this._rhs=n,this._difference=new Es([this._lhs,this._rhs])}asComparator(){return new ps[\"=\"]([this._lhs,this._rhs])}};var Cr=class extends Yt{constructor(n,r,s,i){super();this.recursionInfo=i;this.externalBaseCases=[];this.isFunction=!0;this._symbol=n._symbol,this._argSymbols=r.map(o=>o._symbol);for(let o of this._argSymbols)if(o===this._symbol)throw PI(o);this._exports=[this._symbol],this._expression=s,this.mergeDependenciesInScope(this.type,[this._symbol].concat(this._argSymbols),this._expression,{functionDefinitionSymbol:this._symbol}),this.combinedDependencies=super.getDependencies()}getDependencies(){return this.combinedDependencies}setExternalBaseCases(n){this.externalBaseCases=[...n],this.combinedDependencies=[...super.getDependencies()];for(let r of n){let s=r.getRef();s&&this.combinedDependencies.push(s)}}getExternalBaseCases(){return this.externalBaseCases}getSliderVariables(n,r){let s=this._argSymbols;return super.getSliderVariables(n,r).filter(i=>s.indexOf(i)===-1)}asEquation(){let n=this._argSymbols.map(s=>new we(s)),r=new Nu(new gn(new we(this._symbol),n),this._expression);return r.userData=this.userData,r.metaData=this.metaData,r}};var Qr=class e extends Yt{constructor(n,r,s,i,o){super();this.specifiedArg=s;this.rhs=i;this.originalNode=o;if(this._symbol=n,this._argSymbols=r.map(a=>a._symbol),this._expression=i,this.userData=o.userData,this.metaData=o.metaData,this._inputSpan=o._inputSpan,this.mergeDependenciesInScope(\"FunctionDefinition\",this._argSymbols,this._expression,{functionDefinitionSymbol:this._symbol}),s.valid){let a=s.functionDefArgSymbols.slice();a[s.argIndex]=s.argValue.toString(),this.ref=`_base_case:${n}:${a.join(\",\")}`,this._exports=[this.ref]}else{let a=this._exports.find(u=>u.indexOf(\"idref\")!==-1);a&&(this.ref=a)}}static fromCallAssignment(n,r){let s=r._lhs;if(!(s instanceof gn))return;let i=n[s._symbol];if(!i||!(i instanceof Cr))return;if(s.args.length!==i._argSymbols.length)return new e(i._symbol,[],{valid:!1,error:_x(i._symbol,i._argSymbols.length)},r._rhs,r);let o,a=[];for(let u=0;u<s.args.length;u++){let c=s.args[u];if(c instanceof Et){if(o){o={valid:!1,error:Ld()};break}o={valid:!0,argIndex:u,functionDefArgSymbols:i._argSymbols,argValue:c.asValue(),argSymbol:i._argSymbols[u]}}else if(c instanceof we)if(c._symbol!==i._argSymbols[u]){o={valid:!1,error:ay()};break}else a.push(c);else{o={valid:!1,error:ay()};break}}if(o)return new e(i._symbol,a,o,r._rhs,r)}getRef(){return this.ref}getSliderVariables(n,r){let s=this._argSymbols;return super.getSliderVariables(n,r).filter(i=>s.indexOf(i)===-1)}};var Wa=class extends Yt{constructor(t,n,r,s,i){super(),this.parameters=t,this.residuals=n,this.statistics=r,this.model=s,this.isModelValid=i.isModelValid,this.residualVariable=i.residualVariable,this.residualSuggestionId=i.residualSuggestionId,this.shouldSuggestLogMode=i.shouldSuggestLogMode,this.isLinear=i.isLinear,this.parameterWarning=i.parameterWarning,this.displayPrecision=i.displayPrecision,this._exports=[this.residualVariable];for(let o of We(t))this._exports.push(o);this.mergeDependencies(s)}getCompiledFunction(){return this.model.getCompiledFunction.apply(this.model,arguments)}getCompiledDerivative(){return this.model.getCompiledDerivative.apply(this.model,arguments)}};function Rf(e){return e.type===\"FunctionDefinition\"}function Qv(e){return e.type===\"FunctionCall\"}function ki(e){return e.type===\"Identifier\"}function Hi(e){return e.type===\"Table\"}function Af(e){return e.type===\"Image\"}function Kr(e){return e.type===\"Error\"}function ui(e){return e.type===\"Regression\"}function ga(e){return e.type===\"TableColumn\"}function ha(e){return e.type===\"TableColumnValue\"}var Pp=class extends Yt{constructor(n,r){super();this.isRegression=!0;this.tableRegressionData=void 0;this._lhs=n,this.isLhsSimple=n instanceof we,this._logLhs=new gn(\"ln\",[n]),this._rhs=r,this._difference=new Es([n,r]),this._logDifference=new Es([new gn(\"ln\",[n]),new gn(\"ln\",[r])]),this.mergeDependencies(n,r)}getExportsFromConcrete(n,r){if(Kr(r))return[];let s=[];for(let i of We(r.parameters))n.assignmentForbidden(i)||s.push(i);return n.assignmentForbidden(r.residualVariable)||s.push(r.residualVariable),s}exportTo(n,r,s){if(r.isError)return[];if(!(r instanceof Wa))throw z(`Expected optimized regression but got ${r.type}.`);let i=[];for(let o of We(r.parameters))n.assignmentForbidden(o)||(i.push(o),s[o]=s[o]?Wl(o):r.parameters[o]);return n.assignmentForbidden(r.residualVariable)?[]:(s[r.residualVariable]=r.residuals,i.push(r.residualVariable),i)}getSliderVariables(){return[]}analyzeRegression(n,r,s,i,o){throw z(`Node ${this.type} does not define analyzeRegression.`)}};var co=class extends Yt{constructor(n,r,s,i){super();this.tableID=s;this.columnIndex=i;this.headerDependencies=new Set;this.cellDependencies=new Set;this.header=n,this.values=r,this.registerDependencies(),this._exports=this.computeExports(),this.localFrameID=s}registerDependencies(){this.mergeDependencies(this.header),this.mergeDependencies.apply(this,this.values);for(let n of this.header.getDependencies())this.headerDependencies.add(n);for(let n of this.header.getOptionalDependencies())this.headerDependencies.add(n);for(let n of this.values){for(let r of n.getDependencies())this.cellDependencies.add(r);for(let r of n.getOptionalDependencies())this.cellDependencies.add(r)}}computeExports(){return this.header instanceof we?[this.header._symbol]:[]}_exportSymbolsTo(n,r,s){if(n.length===0)return;let i=this.getExportValue(r,s);this.header instanceof we&&!this.isFreeVariable(s)&&(n=n.filter(o=>o!==this.header._symbol));for(let o of n)s.hasOwnProperty(o)||(s[o]=i)}getExportValue(n,r){return this.isFreeVariable(r)||n.blocksExport?n:this.header}isFreeVariable(n){return this.header instanceof we&&GD(n).definitionLevel[this.header._symbol]===1}exportTo(n,r,s){let i=this.getLegalExports(n);return this._exportSymbolsTo(i,r,s),i}exportToLocal(n,r,s){this._exportSymbolsTo(this.getExports(n),r,s)}};function mk(e){return e instanceof Qr?{type:2}:Rf(e)?{type:1,rhsDependencies:e._expression.getDependencies(),fnSymbol:e._symbol}:{type:0}}function yk(e,t,n,r){var s;if(t instanceof Pp){let i=r==null?void 0:r.get(n);if(i)return{exports:i,dependencies:{type:\"simple\",localFrameID:void 0,dependencies:[]}}}if(t instanceof co){let i=t.header instanceof we?t.header._symbol:void 0;return{exports:t.getLegalExports(e),dependencies:{type:\"table-column\",localFrameID:t.localFrameID,headerIdent:i,headerDependencies:t.headerDependencies,cellDependencies:t.cellDependencies}}}return{exports:t.getLegalExports(e),dependencies:{type:\"simple\",localFrameID:ui(t)?(s=t.tableRegressionData)==null?void 0:s.tableId:t.localFrameID,dependencies:t.getDependencies()}}}function gk(e,t){if(t.localFrameID!==void 0)return{frameID:t.localFrameID,exports:t.getExports(e)}}function _f(e,t,n,r){let s=hk(e,t,r),i=xk(s);return Ik(e,s,i,n)}function hk(e,t,n){let r={};for(let s of Object.keys(t)){let i=t[s],{exports:o,dependencies:a}=yk(e,i,s,n),u=gk(e,i);r[s]={meta:mk(i),exports:o,dependencies:a,local:u}}return r}function d0(e,t,n){var r,s,i,o;(s=(r=e.assignments)[t])!=null||(r[t]=[]),e.assignments[t].push(n),e.assignments[t].length>1&&(e.multiplyDefined[t]=!0),(o=(i=e.exports)[n])!=null||(i[n]=[]),e.exports[n].push(t)}function bk(e,t){let n=e.get(t),r=n!=null?n:{assignments:{},multiplyDefined:{},exports:{}};return n||e.set(t,r),r}function xk(e){let t=new Map,n={},r={assignments:{},exports:{},multiplyDefined:{}};for(let s of We(e)){let i=e[s];if(i.local===void 0)for(let o of i.exports)tt[o]||(n[o]=0,d0(r,o,s))}for(let s of We(e)){let i=e[s];if(i.local===void 0)continue;for(let a of i.exports)tt[a]||n[a]!==0&&(n[a]=1,d0(r,a,s));let o=bk(t,i.local.frameID);for(let a of i.local.exports)tt[a]||n[a]!==0&&(n[a]=1,d0(o,a,s))}return{exports:r.exports,assignments:r.assignments,definitionLevel:n,multiplyDefined:r.multiplyDefined,localAssignments:t}}function Tk(e,t,n){var r,s;if(t!==void 0){let i=(r=e.localAssignments.get(t))==null?void 0:r.assignments[n];if(i)return i}return(s=e.assignments[n])!=null?s:[]}function Kv(e,t){var n;return(n=e.multiplyDefined[t])!=null?n:!1}function Ik(e,t,n,r){let s=[],i=new Set,o={},a=new Set,u={},c=0,l=[],p=[];for(let g of r)u.hasOwnProperty(g)||f(g);function f(g){u[g]=u[g]||{};let m=u[g],h;m.id=g,m.index=c,m.lowlink=c,l.push(m),m.instack=!0,c++;let b=t[g],x;b.dependencies.type===\"simple\"?x=b.dependencies.dependencies:!b.dependencies.headerIdent||n.definitionLevel[b.dependencies.headerIdent]===0?x=b.dependencies.headerDependencies:x=b.dependencies.cellDependencies;for(let T of x){let D=b.dependencies.localFrameID,P=Tk(n,D,T);for(let C of P)u.hasOwnProperty(C)?(h=u[C],h.instack&&(m.lowlink=Math.min(m.lowlink,h.index))):(f(C),h=u[C],m.lowlink=Math.min(m.lowlink,h.lowlink))}if(m.lowlink===m.index)if(h=l.pop(),h.instack=!1,h===m)d(m.id);else{let T=[h.id];for(;h=l.pop(),h.instack=!1,T.push(h.id),h!==m;);y(T)}}function d(g){p.push(g);let m=t[g];if(m.meta.type===1){let h=m.meta.fnSymbol;!e.assignmentForbidden(h)&&m.meta.rhsDependencies.includes(h)&&!Kv(n,h)&&(o[g]=[g],a.add(h))}}function y(g){var T;let m=[],h=!0,b=[],x=new Set;for(let D=g.length-1;D>=0;D--){let P=g[D],C=t[P];for(let S of C.exports)m.push({symbol:S,localFrameID:(T=C.local)==null?void 0:T.frameID});x.add(P),p.push(P),C.meta.type===1&&!Kv(n,C.meta.fnSymbol)?b.push(P):h=!1,C.meta.type===2&&i.add(P)}if(h){for(let D of[...x])o[D]=b;for(let{symbol:D}of m)a.add(D)}s.push(m)}return{resolved:p,exports:n.exports,assignments:n.assignments,definitionLevel:n.definitionLevel,multiplyDefined:n.multiplyDefined,cycles:s,recursiveFunctionGroups:o,recursiveFunctionSymbols:a,recursiveFunctionBaseCasesWithCycles:i,localDependencyOrder:n.localAssignments}}function eO(e){let t=function(...r){return new e(...r)};t.prototype=e.prototype;let n=Object.getOwnPropertyNames(e);for(let r of n){let s=e[r];if(typeof s==\"function\")try{t[r]=s}catch(i){}}return t}var Ep=class extends Q{};var Fg=class extends we{};var ja=class extends Yt{constructor(t,n){super(),t instanceof we?this._symbol=t._symbol:this._symbol=t,this.mergeDependencies(n),this._expression=n,this._exports=this.computeExports()}shouldExportAns(){return!0}computeExports(){let t=this._symbol,n=this.getDependencies();for(let r=0;r<n.length;r++)if(n[r]===t)return[];return[t]}isEquation(t,n){let r=this._symbol,s=r===\"x\"||r===\"y\",i=r===\"r\"||r===\"z\",o=r===\"rho\",a=n.getDependencies(),u=this.graphmodeDependencies(t,n);return o||i||s&&a.includes(\"z\")?u.includes(r):a.includes(r)}asEquation(){let t=new Nu(new we(this._symbol),this._expression);return t.userData=this.userData,t.metaData=this.metaData,t}shouldPromoteToSlider(t){if(!this._expression.isConstant||this._expression.is_mixed_number)return!1;let n=this._expression.asValue();return typeof n!=\"number\"||!isFinite(n)?!1:t.isValidSlider(this._symbol)}};var Mp=class extends Q{constructor(t){super(t),this._symbol=t[0]._symbol,this._lhs=t[0],this._rhs=t[1]}};var Ru=class extends Q{};var Cp=class extends Q{constructor(t){super(t),this._symbol=\"boxplot\"}};var Fr=class extends Q{};function Pk(e,t){let n=Jr[e[0]].direction===-1?new Es([t[1],t[0]]):new Es([t[0],t[1]]);switch(e.length){case 0:throw new Error(\"Programming Error: ComparatorChain must have at least one comparator\");case 1:return n;case 2:return new Fr([new ps[e[1]](t.slice(1)),n,new Et(NaN)]);default:return new Fr([new Au(e.slice(1),t.slice(1)),n,new Et(NaN)])}}var Au=class extends Q{constructor(n,r){super(r);this.symbols=n;if(n.length<1)throw\"Programming Error: ComparatorChain must have at least one comparator.\";if(r.length!==n.length+1)throw\"Programming Error: ComparatorChain must have one more arg than symbols\";if(n.includes(\"=\")&&!n.every(s=>s===\"=\"))throw qx();this._difference=Pk(n,r)}isInequality(){return!this.symbols.includes(\"=\")}};var rl=class extends Q{constructor(n){let r=n.map(s=>new we(\"\\\\idref_{\"+s+\"}\"));super(r);this.constructedObjectIds=n;this._exports.push(\"construction\")}};var Dp=class extends Q{};var sl=class extends Q{constructor(t,n){super(n),t instanceof we?this._symbol=t._symbol:this._symbol=new we(t)._symbol,this.addDependency(this._symbol)}};var Sp=class extends Q{};var Ms=class extends Q{registerDependencies(){if(super.registerDependencies(),this.args[1].type===\"Identifier\"){let t=this.args[1]._symbol;Ou(t)&&this.addDependency(\"trigAngleMultiplier\")}}};var _u=class extends Q{};var vp=class extends Q{constructor(t){super(t),this._symbol=\"dotplot\"}};var Vg=class extends Yt{constructor(t){super();let[n,r,s,i,o]=t;this.args=t,this._symbol=s._symbol,this._operators=[r,i],this._expressions=[n,o];let a=nl(Jr[r].inclusive&&Jr[t[3]].inclusive,Jr[t[1]].direction);this._indicator=new ps[a]([t[0],t[4]]),this.addDependency(this._symbol),this.mergeDependencies(this._expressions[0],this._expressions[1])}isInequality(){return!0}isShadeBetween(){return!0}};var Lu=class extends Q{};var il=class extends Q{constructor(t,n){super(n),this.seed=n[0],this.userSeed=n[1],this.tag=t}asValue(){return this.seed.asValue()+\"::\"+this.tag+this.userSeed.asValue()}};var wu=class extends Q{registerDependencies(){if(super.registerDependencies(),this.args[0].type===\"Identifier\"){let t=this.args[0]._symbol;Ou(t)&&this.addDependency(\"trigAngleMultiplier\")}}};var Fu=class extends Q{registerDependencies(){if(this.addDependency(\"factorial\"),super.registerDependencies(),this.args[0].type===\"Identifier\"){let t=this.args[0]._symbol;Ou(t)&&this.addDependency(\"trigAngleMultiplier\")}}};var Op=class extends Q{constructor(t){super(t),this._symbol=\"histogram\"}};var Bg=class extends Yt{constructor(n,r){super();this.isImage=!0;this.center=n.center,this.radianAngle=n.radianAngle,this.width=n.width,this.height=n.height,this.opacity=n.opacity,this.moveStrategy=r,this.mergeDependencies(this.center,this.radianAngle,this.width,this.height,this.opacity)}};var Np=class extends Q{constructor(t){super(t),this._symbol=\"ittest\"}};var Rp=class extends Q{constructor(t){super(t,{skipRegisterDependencies:!0}),this._differential=t[0],this.registerDependencies()}registerDependencies(){for(let t=1;t<=3;t++)this.mergeDependenciesInScope(this.type,[this._differential._symbol],this.args[t])}};function hn(e,t){let n=e.getInstruction(t);switch(n.type){case 1:return Vo(n.value);default:throw new Error(`Unexpected opcode ${n.type}.`)}}function Vo(e){if(Array.isArray(e))return e.map(Vo);switch(typeof e){case\"boolean\":case\"number\":case\"string\":return e;case\"object\":if(gu(e)){let t={};for(let n of We(e.updateRules)){let r=e.updateRules[n];t[n]={value:Vo(r.value),valueType:r.valueType}}return{type:\"Action\",updateRules:t}}else return V(e);default:throw new Error(\"Unexpected value: \"+e)}}function ge(e){return e.type<=4}function tO(e){return!ge(e)}function es(e){switch(e.type){case 21:case 23:case 19:case 50:case 53:return!0;default:return!1}}function ds(e){switch(e.type){case 20:case 22:case 24:case 51:case 54:return!0;default:return!1}}function Gg(e){switch(e.type){case 20:case 22:case 24:case 51:return!0;default:return!1}}function Vr(e,t){let n=new Array(t);for(let s=0;s<t;s++)n[s]=!1;n[t]=!0;let r=t;for(;r>0;){r=0;for(let s=t;s>=0;s--){if(!n[s])continue;let i=e.getInstruction(s);if(!ge(i))for(let o of e.getDirectDependencies(i))o>s&&!n[o]&&o>r&&(r=o),n[o]=!0}}return n}function nO(e,t){let n=new Array(t);for(let s=0;s<t;s++)n[s]=!1;n[t]=!0;let r=t;for(;r>0;){r=0;for(let s=t;s>=0;s--){if(!n[s])continue;let i=e.getInstruction(s);if(!ge(i))if(i.type===33)n[i.args[1]]=!0,n[i.args[2]]=!0;else for(let o of e.getDirectDependencies(i))o>s&&!n[o]&&(r=o),n[o]=!0}}return n}function fs(e,t){var s;let n=[],r=[];for(let i=0;i<t;i++)r.push(!1);r.push(!0);for(let i=t;i>=0;i--){if(!r[i])continue;let o=e.getInstruction(i);if(o.type===2)n.push({symbol:e.argNames[i],scope:\"free\"});else if(es(o))switch(o.type){case 21:n.push({symbol:o.callData.indexSymbol,scope:\"integral\"});break;case 19:n.push({symbol:o.callData.indexSymbol,scope:o.callData.type});break;case 23:if(((s=o.context)==null?void 0:s.type)===\"list-comprehension\")for(let u of o.context.callData.inputListSymbols)n.push({symbol:u,scope:\"comprehension\"});break;case 50:for(let u of o.callData.parameterSymbols)n.push({symbol:u,scope:\"map\"});break;case 53:{let u=e.getInstruction(o.args[0]);for(let c of u.parameterSymbols)n.push({symbol:c,scope:\"recursive-function\"});break}default:let a=o;throw new Error(`Programming Error: unexpected loop instruction ${a.type}`)}else o.type===3&&o.symbol&&n.push({symbol:o.symbol,scope:\"symbolic-var\"});if(!ge(o))for(let a of e.getDirectDependencies(o))r[a]=!0}return n.reverse()}function Vu(e,t){return ol(e,[t],0,e.instructionsLength()-1)}function ol(e,t,n,r){let s=[];for(let o=n;o<=r;o++)s[o]=!1;for(let o of t)s[o]=!0;let i=Math.min(...t);for(let o=0;o<=1;o++){let a=!1;for(let u=i+1;u<e.instructionsLength();u++){let c=e.getInstruction(u);if(ge(c)||s[u])continue;let l=!1;for(let p of e.getDirectDependencies(c))if(s[p]){l=!0;break}if(s[u]=l,l&&c.type===20&&!s[c.args[0]]){let p=c.args[0],f=c.args.length-1;for(let d=0;d<f;d++){let y=c.args[1+d],g=p+1+d;s[y]&&(s[g]=!0,a=!0)}}}if(!a)break}return s}function rO(e){if(e.isConstant())return;let t=[];for(let i=0;i<e.getReturnIndex();i++)e.getInstruction(i).type===44&&t.push(i);if(t.length===0)return;let n=Vr(e,e.getReturnIndex()),r=[];for(let i=0;i<e.argNames.length;i++)n[i]&&r.push(i);let s=ol(e,r,0,e.getReturnIndex());for(let i of t)if(n[i]&&s[i])throw PP(fs(e,i))}function ms(e){if(!Bo(e))throw new Error(\"Programming error: expected an array but found \"+typeof e)}function Bo(e){return Array.isArray(e)}function sO(e){if(Bo(e))for(let{compiled:t}of e)t&&f0(t)}function $Z(e){if(Bo(e))for(let{compiled:t}of e)t&&Mk(t)}function f0(e){delete e.fn}function Mk(e){e.fn=Lf(e.args,e.source,e.constants,e.executionMetadata)}function Lf(e,t,n,r){let i=`var fn = (function(${e.join(\",\")}){\"use strict\"; ${t}});\nfn.__meta = __meta;\nreturn fn;\n`;return new Function(\"BuiltIn\",\"ErrorMsg\",\"_C\",\"__meta\",i)(Gi,Ht,n,r)}function oO(e,t,n){let r=\"\",s=(e.instructionsLength()-1).toString().length,i=0,o=!1,a=Vr(e,t);for(let u=0;u<e.instructionsLength();u++){let c=e.getInstruction(u),l=n.comments[u]||\"\";if(ds(c)&&(i-=1),!a[u]&&!n.printUnreferencedInstructions||c.type===0)o||(r+=`${iO(u,s)}: ${g0(2*i)}...\n`),o=!0;else{o=!1;let p=`${iO(u,s)}: ${g0(2*i)}${al(e,u)}`;l&&(p+=\" \".repeat(Math.max(0,36-p.length)),p+=`\t# ${l}`),r+=p+`\n`}es(c)&&(i+=1)}return r}function al(e,t){let n=e.getInstruction(t);switch(n.type){case 0:return ts(n.type);case 2:return`${ts(n.type)} ${at(n.valueType)} ${e.argNames[t]}`;case 3:return`${ts(n.type)} ${at(n.valueType)}`;case 1:return`${ts(n.type)} ${at(n.valueType)} ${y0(n.value)}`;case 37:case 42:return`${ts(n.type)} ${at(n.valueType)} ${n.symbol} ${n.args.join(\" \")}`;case 44:return`${ts(n.type)} ${at(n.valueType)} ${n.tag} ${n.args.join(\" \")}`;case 48:return`${ts(n.type)} ${at(n.valueType)} ${n.args.join(\" \")}`;case 16:return`${ts(n.type)} ${at(n.valueType)} (${n.index}) ${n.args.join(\" \")}`;case 50:return`${ts(n.type)} ${at(n.valueType)} ${n.args.join(\" \")} (${n.callData.parameterSymbols.join(\",\")})`;case 4:{let s=n.signature.argTypes.map(i=>at(i)).join(\", \");return`${ts(n.type)} ${at(n.valueType)} ${n.symbol}(${s}) [group ${n.recursionGroup.join(\" \")}]`}case 8:case 9:case 10:case 11:case 13:case 12:case 14:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 32:case 31:case 33:case 38:case 39:case 40:case 41:case 47:case 49:case 51:case 53:case 54:case 55:case 15:return`${ts(n.type)} ${at(n.valueType)} ${n.args.join(\" \")}`;default:let r=n;throw new Error(`Unexpected opcode ${r.type}`)}}function ts(e){switch(e){case 0:return\"Noop\";case 1:return\"Constant\";case 8:return\"Add\";case 9:return\"Subtract\";case 10:return\"Multiply\";case 11:return\"Divide\";case 12:return\"Exponent\";case 13:return\"RawExponent\";case 14:return\"Negative\";case 19:return\"BeginLoop\";case 20:return\"EndLoop\";case 21:return\"BeginIntegral\";case 22:return\"EndIntegral\";case 23:return\"BeginBroadcast\";case 24:return\"EndBroadcast\";case 25:return\"Equal\";case 26:return\"Less\";case 27:return\"Greater\";case 28:return\"LessEqual\";case 29:return\"GreaterEqual\";case 31:return\"Or\";case 32:return\"And\";case 33:return\"Piecewise\";case 38:return\"List\";case 39:return\"ListAccess\";case 40:return\"DeferredListAccess\";case 41:return\"InboundsListAccess\";case 37:return\"NativeFunction\";case 42:return\"Distribution\";case 2:return\"LoadArg\";case 47:return\"BlockVar\";case 48:return\"BroadcastResult\";case 3:return\"SymbolicVar\";case 44:return\"ExtendSeed\";case 49:return\"Action\";case 50:return\"BeginMap\";case 51:return\"EndMap\";case 4:return\"FunctionHeader\";case 53:return\"BeginFunction\";case 54:return\"EndFunction\";case 55:return\"FunctionCall\";case 15:return\"Tuple\";case 16:return\"Slot\";default:let t=e;throw new Error(`Unexpected opcode ${t.type}`)}}function y0(e){if(Array.isArray(e))return`[${e.map(y0).join(\",\")}]`;switch(typeof e){case\"string\":return e;case\"boolean\":case\"number\":return e.toString();case\"object\":if(gu(e)){let t=[];for(let n of We(e.updateRules))t.push(`\"${n}\": ${y0(e.updateRules[n].value)}`);return`{${t.join(\", \")}}`}else return`${e.n}/${e.d}`;default:throw new Error(\"Unexpected value: \"+e)}}function iO(e,t){let n=e.toString();return g0(t-n.length)+n}function g0(e){let t=\"\";for(let n=0;n<e;n++)t+=\" \";return t}function fn(e){return`_${e}`}function Ap(e){return`_${e}_thunk_computed`}function _p(e){return`_${e}_thunk_function`}function kg(e){return`_${e}_next`}function aO(e){return`_${e}_next1`}function h0(e,t){return`_${e}_${t}`}function b0(e){return`_${e}_inner`}function uO(e){return`_${e}_cache`}function cO(e){return`_${e}_key`}function Hg(e){return`_${e}_computationMetrics`}function lO(e){return`_${e}_out`}function pO(e){return`_${e}_computationMetrics`}function dO(e){return`_${e}_cacheEntry`}function fO(e){return`_${e}_args`}function wf(e,t){return`_${e}_prev_${t}`}function mO(e){return`_${e}_computationDepth`}function yO(e){return`_${e}_computationCount`}function Je(e){return e.type===1}function gO(e){if(!Je(e))throw new Error(`Programming error: expected constant instruction but found ${ts(e.type)} instead.`)}var T0=class{constructor(t,n){this.chunk=t;this.recursiveFunctionGroup=n;this.referencesFrom={};this.referencesTo={};this.baseCases={};for(let c of Object.values(n))this.referencesFrom[c]=[],this.referencesTo[c]=[],this.baseCases[c]=[];let{dependsOnRecursiveCall:r,iterationParameterIndex:s,recursiveReferences:i}=vk(this.chunk,this.recursiveFunctionGroup);for(let c of i)this.referencesFrom[c.from].push(c),this.referencesTo[c.to].push(c);this.iterationParameterIndex=s;let{baseCases:o,isEveryBranchRecursiveOrBaseCase:a,isUnconditionallyRecursive:u}=Sk(t,n,r,s);this.isEveryBranchRecursiveOrBaseCase=a,this.isUnconditionallyRecursive=u;for(let c of o)this.baseCases[c.fn].push(c)}hasRecursiveReferences(){for(let t of Object.values(this.referencesFrom))if(t.length>0)return!0;return!1}getBaseCasesForFunction(t){return this.baseCases[t]}getReferencesFrom(t){return this.referencesFrom[t]}getReferencesTo(t){return this.referencesTo[t]}getAllReferences(){let t=[];for(let n of Object.values(this.referencesFrom))t.push(...n);return t}};function Dk(e,t,n){if(t===void 0)return;let r=e.getInstruction(n),s=e.getInstruction(r.args[0]);if(s.type!==25)return;let[i,o]=s.args,a;if(i===t)a=o;else if(o===t)a=i;else return;let u=e.getInstruction(a);if(Je(u)&&u.valueType===I)return u.value}function Sk(e,t,n,r){let s=[],i=!0,o=!0;for(let a in t){let u=t[a],l=e.getInstruction(u).endIndex,f=e.getInstruction(l).args[0],d=r!==void 0?f+r+1:void 0,y={[l]:!0};for(let g=l;g>f;g--){if(!y[g])continue;let m=e.getInstruction(g);if(!ge(m)){if(m.type===33){let h=m.args[1],b=m.args[2];if(!n[h]||!n[b]){i=!1;let T=Dk(e,d,g);T!==void 0&&!n[h]?s.push({fn:u,argValue:T}):o=!1}}for(let h of m.args)y[h]=!0}}}return s.sort((a,u)=>V(a.argValue)-V(u.argValue)),{baseCases:s,isUnconditionallyRecursive:i,isEveryBranchRecursiveOrBaseCase:o}}var x0=Symbol(\"NON_ITERATIVE\");function vk(e,t){let n=new Set(Object.values(t)),r={},s=[],i;for(let o in t){let a=t[o],c=e.getInstruction(a).endIndex,p=e.getInstruction(c).args[0],f=Vr(e,c);for(let d=p;d<c;d++){let y=e.getInstruction(d);if(!ge(y)&&f[d]){if(y.type===55&&n.has(y.args[0])){r[d]=!0;let g=I0(e,p,y);g?(g.iterationParameterIndex!==void 0&&(i!==void 0&&i!==g.iterationParameterIndex?i=x0:i=g.iterationParameterIndex),s.push(g.ref)):i=x0}for(let g of e.getDirectDependencies(y))if(r[g]){r[d]=!0;break}}}}return i===void 0&&Object.values(t).every(o=>e.getInstruction(o).signature.argTypes.length===1)&&(i=0),{dependsOnRecursiveCall:r,iterationParameterIndex:i===x0?void 0:i,recursiveReferences:s}}function I0(e,t,n){let r=e.getInstruction(t),s,i;for(let o=1;o<n.args.length;o++){let a=n.args[o],u=e.getInstruction(a),c,l;if(u.type===9&&s===void 0){let d=e.getInstruction(u.args[1]);if(!(d.type===1&&d.valueType===I))return;l=V(d.value),c=u.args[0]}else l=0,c=a;let p=e.getInstruction(c);if(!(p.type===47&&p.args[0]===t&&o===c-t)||l!==Math.floor(l)||l<0)return;if(s===void 0)i=l,l!==0&&(s=o-1);else if(l!==0)return}if(i!==void 0)return{ref:{from:r.args[0],to:n.args[0],iterationParameterOffset:i},iterationParameterIndex:s}}function hO(e,t){var c,l;let n=new T0(e,t),r={};for(let p in n.recursiveFunctionGroup){let f=n.recursiveFunctionGroup[p],d=n.getBaseCasesForFunction(f);if(d.length===0)continue;let y=V(d[0].argValue),g=1;for(;g<d.length&&V(d[g].argValue)===V(d[g-1].argValue)+1;)g++;let m=d.slice(g).map(h=>V(h.argValue));r[p]={min:y,consecutiveCount:g,additional:m}}let s={},i=-1/0,o=1/0;if(n.iterationParameterIndex!==void 0&&n.isEveryBranchRecursiveOrBaseCase){let p=new Map;for(let f of Object.values(n.recursiveFunctionGroup)){let d=e.getInstruction(f).symbol,y=-1/0;for(let g of n.getReferencesTo(f))y=Math.max(y,g.iterationParameterOffset);if(isFinite(y)&&(s[d]=y),y>0){let g=r[e.getInstruction(f).symbol],m=(c=g==null?void 0:g.min)!=null?c:-1/0;p.set(f,{min:m+y,max:m+((l=g==null?void 0:g.consecutiveCount)!=null?l:0)})}}for(let{min:f,max:d}of p.values())i=Math.max(i,f),o=Math.min(o,d)}let a={};for(let p in n.recursiveFunctionGroup){let f=n.recursiveFunctionGroup[p],d=e.getInstruction(f);a[p]=d.parameterSymbols}let u={};for(let p in n.recursiveFunctionGroup){let f=n.recursiveFunctionGroup[p],d=e.getInstruction(f);u[p]=d.signature.argTypes.map((y,g)=>g===n.iterationParameterIndex&&n.isEveryBranchRecursiveOrBaseCase&&!n.isUnconditionallyRecursive?1:0)}if(n.iterationParameterIndex!==void 0&&isFinite(i)&&i<=o){let p=Ok(n);return{canIterate:!0,parameterSymbols:a,baseCaseInfo:r,maxRecursiveCallOffsets:s,iterationParameterIndex:n.iterationParameterIndex,domainInfo:u,loopStart:i,order:p}}else return{canIterate:!1,parameterSymbols:a,baseCaseInfo:r,maxRecursiveCallOffsets:s,iterationParameterIndex:n.iterationParameterIndex,domainInfo:u}}function Ok(e){if(e.iterationParameterIndex===void 0)throw z(\"Programming error: no recursive parameter\");let n=Object.values(e.recursiveFunctionGroup),r=new Map,s=new Map,i=u=>{let c=new Set;for(let l of e.getReferencesTo(u))l.iterationParameterOffset===0&&c.add(l.from);return[...c]};n.forEach(u=>{let c=i(u);r.set(u,c);for(let l of c)s.set(l,(s.get(l)||0)+1);s.has(u)||s.set(u,0)});let o=[];s.forEach((u,c)=>{u===0&&o.push(c)});let a=[];for(;o.length>0;){let u=o.shift();a.push(u),(r.get(u)||[]).forEach(l=>{let p=l,f=s.get(p)-1;s.set(p,f),f===0&&o.push(p)})}if(a.length!==n.length)throw Nx();return a}function zg(e,t){let n;for(let o=t,a=0;o>0;o--){let u=e.getInstruction(o);if(u.type===53&&a===0){n=o;break}u.type===54&&a++,u.type===53&&a--}if(n===void 0)return!1;let r=e.getInstruction(t),s=e.getInstruction(r.args[0]),i=e.getInstruction(n).args[0];return s.recursionGroup.includes(i)}function Ug(e){for(let t=0;t<e.argCoeffs.length;t++)if(V(e.argCoeffs[t])!==0)return!1;return!0}var qg=Se(0,1),bO=Se(1,1);function $g(e){if(e.op===\"&&\")return{op:\"||\",values:e.values.map($g)};if(e.op===\"||\")return{op:\"&&\",values:e.values.map($g)};switch(e.condition){case\">0\":return{op:\"comparator\",value:Cs._neg(e.value),condition:\">=0\"};case\">=0\":return{op:\"comparator\",value:Cs._neg(e.value),condition:\">0\"};case\"=0\":return{op:\"comparator\",value:e.value,condition:\"!=0\"};case\"!=0\":return{op:\"comparator\",value:e.value,condition:\"=0\"}}}function P0(e,t){let n=[];return e.op===\"&&\"?n.push(...e.values):n.push(e),t.op===\"&&\"?n.push(...t.values):n.push(t),{op:\"&&\",values:n}}var Cs;(c=>{function e(l,p){if(!(l===void 0||p===void 0))return t(l,p)}c.add=e;function t(l,p){let f=[];for(let d=0;d<l.argCoeffs.length;d++)f.push(qs(l.argCoeffs[d],p.argCoeffs[d]));return{argCoeffs:f,constantCoeff:qs(l.constantCoeff,p.constantCoeff)}}c._add=t;function n(l,p){if(!(l===void 0||p===void 0))return r(l,p)}c.sub=n;function r(l,p){let f=[];for(let d=0;d<l.argCoeffs.length;d++)f.push(ai(l.argCoeffs[d],p.argCoeffs[d]));return{argCoeffs:f,constantCoeff:ai(l.constantCoeff,p.constantCoeff)}}c._sub=r;function s(l){if(l!==void 0)return i(l)}c.neg=s;function i(l){let p=[];for(let f=0;f<l.argCoeffs.length;f++)p.push(Us(l.argCoeffs[f]));return{argCoeffs:p,constantCoeff:Us(l.constantCoeff)}}c._neg=i;function o(l,p){if(l===void 0||p===void 0)return;let f=Ug(l),d=Ug(p);if(!f&&!d)return;d||([l,p]=[p,l]);let y=[];for(let g=0;g<l.argCoeffs.length;g++)y.push(wr(l.argCoeffs[g],p.constantCoeff));return{argCoeffs:y,constantCoeff:wr(l.constantCoeff,p.constantCoeff)}}c.mul=o;function a(l,p){if(l===void 0||p===void 0||!Ug(p))return;let d=[];for(let y=0;y<l.argCoeffs.length;y++)d.push(Ps(l.argCoeffs[y],p.constantCoeff));return{argCoeffs:d,constantCoeff:Ps(l.constantCoeff,p.constantCoeff)}}c.div=a;function u(l,p){if(!(l===void 0||p===void 0||!Ug(p)))return V(p.constantCoeff)===0?{argCoeffs:new Array(l.argCoeffs.length).fill(qg),constantCoeff:bO}:V(p.constantCoeff)===1?l:void 0}c.pow=u})(Cs||(Cs={}));var Yg=class{constructor(t,n,r,s){this.chunk=t;this.coefficientTable=[];this.conditionTable=[];this.ZERO_COEFFS=new Array(n.length).fill(qg),this.mask=ol(t,n,r,s);for(let i=0;i<n.length;i++){let o=[];for(let a=0;a<n.length;a++)o.push(i===a?bO:qg);this.coefficientTable[n[i]]={argCoeffs:o,constantCoeff:qg}}}coeffs(t){let n=this.coefficientTable[t];if(n!==void 0)return n;let r,s=this.chunk.getInstruction(t);return s.type===1&&s.valueType===I?r={argCoeffs:this.ZERO_COEFFS,constantCoeff:s.value}:this.mask[t]?r=this._coeffs(t):r=void 0,this.coefficientTable[t]=r,r}_coeffs(t){let n=this.chunk.getInstruction(t);switch(n.type){case 8:{let[s,i]=n.args;return Cs.add(this.coeffs(s),this.coeffs(i))}case 9:{let[s,i]=n.args;return Cs.sub(this.coeffs(s),this.coeffs(i))}case 14:{let s=n.args[0];return Cs.neg(this.coeffs(s))}case 10:{let[s,i]=n.args;return Cs.mul(this.coeffs(s),this.coeffs(i))}case 11:{let[s,i]=n.args;return Cs.div(this.coeffs(s),this.coeffs(i))}case 12:case 13:{let[s,i]=n.args;return Cs.pow(this.coeffs(s),this.coeffs(i))}case 26:case 28:case 27:case 29:case 33:case 0:case 23:case 2:case 1:case 25:case 32:case 31:case 15:case 16:case 38:case 39:case 40:case 41:case 37:case 42:case 21:case 22:case 19:case 20:case 24:case 48:case 47:case 3:case 44:case 49:case 50:case 51:case 4:case 53:case 54:case 55:return;default:let r=n;throw new Error(`Unexpected opcode ${r.type}`)}}condition(t){let n=this.conditionTable[t];if(n!==void 0)return n;let r;return this.mask[t]?r=this._condition(t):r=void 0,this.conditionTable[t]=r,r}_condition(t){let n=this.chunk.getInstruction(t);switch(n.type){case 26:{let[s,i]=n.args,o=Cs.sub(this.coeffs(i),this.coeffs(s));return o===void 0?void 0:{op:\"comparator\",value:o,condition:\">0\"}}case 28:{let[s,i]=n.args,o=Cs.sub(this.coeffs(i),this.coeffs(s));return o===void 0?void 0:{op:\"comparator\",value:o,condition:\">=0\"}}case 27:{let[s,i]=n.args,o=Cs.sub(this.coeffs(s),this.coeffs(i));return o===void 0?void 0:{op:\"comparator\",value:o,condition:\">0\"}}case 29:{let[s,i]=n.args,o=Cs.sub(this.coeffs(s),this.coeffs(i));return o===void 0?void 0:{op:\"comparator\",value:o,condition:\">=0\"}}case 25:{let[s,i]=n.args,o=Cs.sub(this.coeffs(s),this.coeffs(i));return o===void 0?void 0:{op:\"comparator\",value:o,condition:\"=0\"}}case 32:{let s=n.args.map(i=>this.condition(i));return s.some(i=>i===void 0)?void 0:{op:\"&&\",values:s}}case 31:{let s=n.args.map(i=>this.condition(i));return s.some(i=>i===void 0)?void 0:{op:\"||\",values:s}}case 8:case 9:case 14:case 10:case 11:case 12:case 13:case 33:case 0:case 23:case 2:case 1:case 15:case 16:case 38:case 39:case 40:case 41:case 37:case 42:case 21:case 22:case 19:case 20:case 24:case 48:case 47:case 3:case 44:case 49:case 50:case 51:case 4:case 53:case 54:case 55:return;default:let r=n;throw new Error(`Unexpected opcode ${r.type}`)}}};function TO(e,t,n,r){let s=t.reachConditions[n];if(s!==void 0)return IO(e,t,r,s)}function IO(e,t,n,r){let s=t.argBlockvars;if(r.op===\"||\"||r.op===\"&&\"){let i=[];for(let o of r.values){let a=IO(e,t,n,o);if(a===void 0)return;i.push(a)}return i.length===0?r.op===\"&&\"?\"true\":\"false\":`(${i.join(r.op)})`}switch(r.condition){case\">0\":case\">=0\":{let o=`(${xO(e,r.value,s)}${r.condition})`,a=E0(e,r.value,s,n);return`(${o}&&${a})`}case\"!=0\":{let i=xO(e,r.value,s),o=`(${i}>0)`,a=E0(e,r.value,s,n),u=`(${i}<0)`,c=E0(e,Cs._neg(r.value),s,n);return`((${o}&&${a})||(${u}&&${c}))`}case\"=0\":return}}function E0(e,t,n,r){let s=[];for(let i=0;i<n.length;i++){let o=V(t.argCoeffs[i]),a=e.referenceArg(n[i]),u=e.referenceArg(r[i]);o>0?s.push(`${u}>=${a}`):o<0&&s.push(`${u}<=${a}`)}return s.length===0?!0:`(${s.join(\"&&\")})`}function xO(e,t,n){let r=\"\";for(let s=0;s<n.length;s++){let i=e.printValue(t.argCoeffs[s],I),o=e.referenceArg(n[s]);r+=`${i}*${o}+`}return r+=e.printValue(t.constantCoeff,I),`(${r})`}var Jt;(r=>(r.Noop=0,r.Inline=1,r.Block=2))(Jt||(Jt={}));function M0(e){switch(e.type){case Jt.Noop:return\"\";case Jt.Inline:return e.source+`;\n`;case Jt.Block:return e.source}}function PO(e,t,n){if(e.glsl)throw z(\"GLSL function not implemented\");let{chunk:r,referenced:s}=e,i=t.args[0],o=r.getInstruction(i),a=o.signature.argTypes;if(e.isTailFunction[i])return{type:Jt.Noop,nextIdx:o.endIndex+1};e.enterFunction(t,n,0);let u=\"\";for(let c=0;c<a.length;c++){let l=n+c+1;s[l]&&(u+=`${fn(l)}=${h0(i,c)};\n`)}return{type:Jt.Block,source:Nk(e,t,n,u),nextIdx:n+1}}function Nk(e,t,n,r){let{chunk:s}=e,i=t.args[0],o=s.getInstruction(i),a=o.signature.argTypes,u=\"\";for(let d=0;d<a.length;d++)d>0&&(u+=\",\"),u+=h0(i,d);let c=b0(i),l=uO(i),p=cO(i),f=Hg(i);return`\n    const ${p}=${a.length===1&&o.signature.argTypes[0]===I?\"({fn, args}) => `${fn}:${args[0]}`\":\"({fn, args}) => `${fn}:${JSON.stringify(args)}`\"};\n\n    const ${c}=((${l}, ${u}) => {\n      ${Lp(e,n+1,o.endIndex-1)}\n      const ${f} = {depth: 0, count: 0};\n      const cache = ${l};\n      ${r}\n    `}function EO(e,t,n){let r=n+1,s=t.args[0],o=e.chunk.getInstruction(s).args[0];if(e.isTailFunction[o])throw z(\"Unexpected tail recursive function\");let a=Rk(e,t),{referenced:u}=e;return u[n]&&(a+=`${fn(n)}=${e.referenceArg(t.args[0])};\n`),e.exitFunction(),{type:Jt.Block,source:a,nextIdx:r}}function Rk(e,t){let n=t.args[0],r=e.chunk.getInstruction(n),s=r.args[0],i=lO(s),o=Hg(s),a=r.valueType;return`\n${o}.count++;\n${o}.depth++;\nlet ${i};\nif ((${o}.depth > BuiltIn.RECURSIVE_DEPTH_LIMIT) || (${o}.count > BuiltIn.RECURSIVE_COMPUTATION_LIMIT)) {\n  ${i}=BuiltIn.handleRecursionLimitExceeded(__meta, ${a});\n} else {\n  ${i}=${e.referenceArg(t.args[1])};\n}\nreturn BuiltIn.recursionSuccess(${i},${o});\n});\n`}function Ff(e,t){return`{ fn: ${e}, args: ${t} }`}function MO(e,t,n){let r=n+1,{chunk:s}=e,i=t.args[0],o=s.getInstruction(i),u=s.getInstruction(o.endIndex).args[0],c=t.args.slice(1).map(m=>e.referenceArg(m)),l=fn(n),p=fO(n),f=pO(n),d=dO(n),y=s.getInstruction(u),g=s.getInstruction(y.args[0]);if(zg(s,n)){if(e.recursiveFunctionInfo.length<1)throw z(\"Expected recursive function info\");let m=e.recursiveFunctionInfo[e.recursiveFunctionInfo.length-1],h=\"\",b=TO(e,m,n,t.args.slice(1));if(e.isTailFunction[i]){let P=y.valueType;b&&(h=`\nif (${b}) {\n            return BuiltIn.recursionDiverges(__meta, ${P});\n          }`);let C=g.signature.argTypes,S=h+`\n`;S+=\"looping=true\";for(let O=0;O<C.length;O++){let _=kg(u+O+1);S+=`,\n${_}=${c[O]}`}return h?{type:Jt.Block,source:S+`;\n`,nextIdx:r}:{type:Jt.Inline,source:S,nextIdx:r}}else if(m.executionMode===1){let P=s.getInstruction(s.getInstruction(m.fn).endIndex),C=I0(s,P.args[0],t);if(!C)throw z(\"Expected valid iteration reference\");let S=wf(C.ref.to,C.ref.iterationParameterOffset);return{type:Jt.Inline,source:`${l}=${S}`,nextIdx:r}}b&&(h=`\nif (${b}) {\n          return BuiltIn.SYMBOL_DIVERGES;\n        }`);let x=Hg(m.fn),T=Ff(i,p),D=`\n      const ${p} = ([${c.join(\",\")}]);\n      ${h}\n      const ${d} = cache.get(BuiltIn.recursionCacheKey(${T}));\n      if (${d} === undefined) {\n        return BuiltIn.recursionMissingCacheEntry(${T});\n      }\n      ${l} = ${d}[0];\n      const ${f} = ${d}[1];\n      if (${f}.count > ${x}.count) {\n        ${x}.count = ${f}.count;\n      }\n      if (${f}.depth > ${x}.depth) {\n        ${x}.depth = ${f}.depth;\n      }\n    `;return{type:Jt.Block,source:D,nextIdx:r}}else{let m=`{${g.recursionGroup.map(T=>`${T}: ${b0(T)}`).join(\",\")}}`,h=e.chunk.getRecursionStructure(y.args[0]);if(e.isTailFunction[i])return Ak(e,t,n);if(h.canIterate)return _k(e,t,n,h,{innerFunctionsMap:m});let b=Ff(i,`[${c.join(\",\")}]`),x=`${l}=BuiltIn.executeRecursiveFunction(\n      __meta,\n      ${m},\n      ${y.valueType},\n      ${b}\n    )`;return{type:Jt.Inline,source:x,nextIdx:r}}}var CO=Symbol(\"UPDATED_IN_BODY\");function DO(e){let t=\"\";for(let n of e){let r=\"declare\"in n?`let ${n.declare}`:fn(n.reference),s=n.initializeRHS;t+=`${r}=${s};\n`}return t}function SO(e){let t=\"\",n=\"\";for(let r of e){let s=\"declare\"in r?r.declare:fn(r.reference);r.updateRHS!==CO&&(t&&(t+=\",\",n+=\",\"),t+=`${s}`,n+=`${r.updateRHS}`)}return`[${t}]=[${n}]`}function Ak(e,t,n){let r=t.args[0],s=e.chunk.getInstruction(r),i=e.chunk.getInstruction(s.endIndex),o=i.args[0],a=e.chunk.getInstruction(o),u=a.valueType,c=fn(n),l=[];e.enterFunction(a,o,2);let p=Xg(e,o,s.endIndex).source;e.exitFunction();let f=mO(n),d=yO(n);l.push({declare:f,initializeRHS:\"0\",updateRHS:`${f}+1`},{declare:d,initializeRHS:\"0\",updateRHS:`${d}+1`});for(let g=1;g<t.args.length;g++){let m=o+g;if(!e.referenced[m])continue;let h=kg(m);l.push({reference:m,initializeRHS:e.referenceArg(t.args[g]),updateRHS:h},{declare:h,initializeRHS:void 0,updateRHS:CO})}let y=`${c}=(() => {\n    ${Lp(e,o+1,s.endIndex-1)}\n\n    let looping = true;\n    ${DO(l)}\n    while (looping) {\n      looping = false;\n\n      ${p}\n\n      if (looping) {\n        ${SO(l)}\n      }\n\n      if ((${f} > BuiltIn.RECURSIVE_DEPTH_LIMIT) || (${d} > BuiltIn.RECURSIVE_COMPUTATION_LIMIT)) {\n        return BuiltIn.handleRecursionLimitExceeded(__meta, ${u});\n      };\n    }\n\n    return ${e.referenceArg(i.args[1])}\n  })()`;return{type:Jt.Inline,source:y,nextIdx:n+1}}function _k(e,t,n,r,s){let i=t.args[0],o=e.chunk.getInstruction(i),a=e.chunk.getInstruction(o.endIndex),u=a.args[0],c=fn(n),l=[],p=\"\",f,{iterationParameterIndex:d,loopStart:y,order:g}=r,m=r.maxRecursiveCallOffsets,h=u+d+1,b=fn(h),x=t.args[d+1],T=`(${y})`,D=e.chunk.getInstruction(x),P=(D.type===39||D.type===41)&&e.chunk.getInstruction(D.args[1]).type===23?D.args[0]:void 0,C=`(${e.referenceArg(x)})-${T}`,S,O;if(P!==void 0){let U=e.referenceArg(P);S=`BuiltIn.listMax(\n      (${U}).filter(\n        x => isFinite(x) &&\n        Math.floor(x - ${T}) === (x - ${T})\n      )\n    )`,O=`BuiltIn.getBroadcastTargetElements(${U}).has(${b})`}else S=`(${e.referenceArg(x)})`,O=\"false\";l.push({reference:h,initializeRHS:`(${T})`,updateRHS:`${b}+1`}),f=\"\";for(let U of g){let G=e.chunk.getInstruction(U),Z=G.endIndex,F=e.chunk.getInstruction(Z),Y=F.args[0],re=e.chunk.getInstruction(Y);for(let he=1;he<t.args.length;he++){let K=Y+he;if(!e.referenced[K])continue;let Oe=fn(K);he===d+1?f+=`${Oe}=${e.referenceArg(h)};\n`:p+=`${Oe}=${e.referenceArg(t.args[he])};\n`}p+=Lp(e,Y+1,G.endIndex-1);let Ee=m[G.symbol];if(Ee!==void 0)for(let he=1;he<=Ee;he++){let K=wf(U,he),Oe=he===1?e.referenceArg(F.args[1]):wf(U,he-1),te=t.args.slice(1).map((J,W)=>W===d?y-he:e.referenceArg(J)),Ze=Ff(U,`[${te.join(\",\")}]`),dt=`BuiltIn.executeRecursiveFunction(\n            __meta,\n            ${s.innerFunctionsMap},\n            ${re.valueType},\n            ${Ze}\n          )`,me=`(\n          broadcastOutputMap\n            ? (broadcastOutputMap[BuiltIn.recursionCacheKey(${Ze})] = ${dt})\n            : ${dt}\n        )`;l.push({declare:K,initializeRHS:me,updateRHS:Oe})}e.enterFunction(re,Y,1),f+=Xg(e,Y,G.endIndex).source,e.exitFunction(),f+=`const ${wf(U,0)}=${e.referenceArg(F.args[1])};\n`}let _=t.args.slice(1).map(U=>e.referenceArg(U)),L=t.args.slice(1).map((U,G)=>G===d?b:e.referenceArg(U)),w=`${c}=(() => {\n    ${p}\n    const broadcastOutputMap = ${P!==void 0?\"__meta.iterativeRecursionOutputs\":\"undefined\"};\n\n    ${DO(l)}\n\n    const outerStackFrame = ${Ff(i,`[${_.join(\",\")}]`)};\n\n    if (broadcastOutputMap) {\n        const cacheEntry = broadcastOutputMap[BuiltIn.recursionCacheKey(outerStackFrame)];\n        if (cacheEntry !== undefined) {\n          return cacheEntry;\n        }\n      }\n\n\n    const targetLoopSteps = ${C}\n    if (targetLoopSteps < 0 || Math.floor(targetLoopSteps) !== targetLoopSteps) {\n      return BuiltIn.executeRecursiveFunction(\n        __meta,\n        ${s.innerFunctionsMap},\n        ${o.valueType},\n        outerStackFrame\n      );\n    }\n\n    const loopEnd = ${S};\n\n    let result;\n    while (true) {\n      ${f}\n\n      result = ${e.referenceArg(a.args[1])};\n\n      if (broadcastOutputMap && ${O}) {\n        const key = BuiltIn.recursionCacheKey(${Ff(i,`[${L.join(\",\")}]`)});\n        broadcastOutputMap[key] = result;\n      }\n\n      if (${b} < loopEnd) {\n        ${SO(l)}\n      } else {\n        break;\n      }\n    }\n\n    ${P===void 0?\"return result;\":`const cached = broadcastOutputMap[BuiltIn.recursionCacheKey(outerStackFrame)];\n          if (cached === undefined) {\n            return BuiltIn.recursionDiverges(__meta, ${o.valueType});\n          }\n          return cached;\n          `}\n  })()`;return{type:Jt.Inline,source:w,nextIdx:n+1}}function Zg(e){let{chunk:t}=e,n=Lp(e,t.argNames.length,t.instructionsLength()-1),r=0;for(;r<t.instructionsLength();){let s=t.getInstruction(r),i=C0(e,s,r);n+=M0(i),r=i.nextIdx}return n+=`return ${e.referenceArg(t.getReturnIndex())};`,n}function Lk(e,t){let{chunk:n}=e,r=[],s=e.thunkName(t),i=e.thunkEnd(s),o=Ap(s),a=_p(s),u=\"\",c=!1,l=!1;e.wantToInlineThunk(s)||(l=!0);let p=t;for(;p<=i;){let f=n.getInstruction(p),d=p===t?vO(e,f,p):C0(e,f,p);switch(d.type){case Jt.Noop:break;case Jt.Inline:c&&(u+=`,\n`),u+=d.source,c=!0;break;case Jt.Block:c&&(u+=`;\n`),c=!1,u+=d.source,l=!0;break}r.push(u),p=d.nextIdx}if(u===\"\"&&(u=\"0\",l=!1),l){let f=`${o}=false;${a}=()=>{\n${o}=true;\n\n      ${u}${c?\";\":\"\"}\n    };\n`;return{type:Jt.Block,source:f,nextIdx:p}}else return e.inlineThunk(s,u),{type:Jt.Noop,nextIdx:p}}function C0(e,t,n){return e.isThunkBegin(n)?Lk(e,n):vO(e,t,n)}function vO(e,t,n){let r=n+1;if(!e.referenced[n])return{type:Jt.Noop,nextIdx:r};switch(t.type){case 0:case 47:case 48:case 22:case 49:case 4:return{type:Jt.Noop,nextIdx:r};case 21:if(e.glsl)throw FT();return Fk(e,t,n);case 2:return e.inlineSource(n,e.chunk.argNames[n]),{type:Jt.Noop,nextIdx:r};case 23:return{type:Jt.Block,source:Vk(e,t,n),nextIdx:r};case 24:return{type:Jt.Block,source:Bk(e,t,n),nextIdx:r};case 19:return{type:Jt.Block,source:Gk(e,t,n),nextIdx:r};case 20:return{type:Jt.Block,source:kk(e,t,n),nextIdx:r};case 50:return{type:Jt.Block,source:Hk(e,t,n),nextIdx:r};case 51:return{type:Jt.Block,source:zk(e,t,n),nextIdx:r};case 53:return PO(e,t,n);case 54:return EO(e,t,n);case 33:{let s=e.referenceArg(t.args[0]),i=e.referencePiecewiseBranch(t.args[1]),o=e.referencePiecewiseBranch(t.args[2]);if(!(i.thunkDependencies.some(p=>e.isEarlyReturningThunk(p))||o.thunkDependencies.some(p=>e.isEarlyReturningThunk(p)))){let p=e.emitTernary(s,i.expression,o.expression,t);return e.shouldInline(n)?(e.inlineSource(n,`(${p})`),{type:Jt.Noop,nextIdx:r}):{type:Jt.Inline,source:`${fn(n)}=${p}`,nextIdx:r}}let u=fn(n),c=p=>{if(p.length===0)return\"\";let f=\"\";for(let d of p){let y=e.inlinedThunks[d];if(y!==void 0){let g=`(${y},void 0)`;f!==\"\"?f=`(${f}||${g})`:f=g}else{let g=Ap(d),m=_p(d);f!==\"\"&&(f+=\"||\"),f+=`(${g} ? undefined : ${m}())`}}return f=\"const earlyReturn =\"+f,f+=`;\nif (earlyReturn !== undefined) return earlyReturn;\n`,f},l=`if (${s}) {\n          ${c(i.thunkDependencies)}${u} = ${i.rawExpression};\n        } else {\n          ${c(o.thunkDependencies)}${u} = ${o.rawExpression};\n        }`;return{type:Jt.Block,source:l,nextIdx:r}}case 55:return MO(e,t,n);default:{let s=Uk(e,t,n);return e.shouldInline(n)?(e.inlineSource(n,`(${s})`),{type:Jt.Noop,nextIdx:r}):{type:Jt.Inline,source:`${fn(n)}=${s}`,nextIdx:r}}}}function Xg(e,t,n){let{chunk:r,referenced:s}=e,i=\"\",o=t+1;for(;o<n;){if(!s[o]){o=o+1;continue}let a=r.getInstruction(o),u=C0(e,a,o);i+=M0(u),o=u.nextIdx}return{type:Jt.Block,source:i,nextIdx:o}}function wk(e,t,n){let{endIndex:r}=t,{chunk:s}=e,i=`function(${fn(n)}) {\n`,o=n+1,a=r-1;i+=Lp(e,o,a),i+=Xg(e,n,r).source;let u=s.getInstruction(r);return i+=`return ${e.referenceArg(u.args[1])};\n}`,i}function Fk(e,t,n){let r=\"BuiltIn.quad(\";r+=wk(e,t,n),r+=`,${e.referenceArg(t.args[0])},${e.referenceArg(t.args[1])})`;let{endIndex:s}=t,i=s+1;return e.shouldInline(i)?(e.inlineSource(i,r),{type:Jt.Noop,nextIdx:t.endIndex}):{type:Jt.Inline,source:`${fn(s+1)}=${r}`,nextIdx:t.endIndex}}function Lp(e,t,n){let{chunk:r,referenced:s}=e,i=\"\",o=!1;for(let a=t;a<=n;a++){if(!e.glsl&&e.isThunkBegin(a)){let c=e.thunkName(a);i+=`${o?\",\":\"var \"}${Ap(c)}`,i+=`,${_p(c)}`,o=!0}let u=r.getInstruction(a);if(!(u.type===0||u.type===24||u.type===20||!s[a])){if(u.type===21){let{endIndex:c}=u;a=c,e.shouldInline(c+1)&&a++;continue}if(!e.shouldInline(a)&&(i+=e.emitVarDeclaration(a,o),o=!0,u.type===53)){let{endIndex:c}=u;a=c-1;continue}}}return o&&(i+=`;\n`),i}function Vk(e,t,n){let{glsl:r,chunk:s,referenced:i}=e,o=fn(n),a=s.getInstruction(t.endIndex),u=e.referenceArg(t.args[0]),c=\"\";for(let p=1;p<a.args.length;p++){let f=t.endIndex+p;if(!i[f]||s.getInstruction(f).type!==48)continue;let y=fn(f);r||(c+=`${y}=[];\n`)}return r||(c+=`if(${u}>${1e4}) throw ErrorMsg.maxListSize();\n`),c+=`for(${o}=1${r?\".0\":\"\"};${o}<=${u};${o}++){\n`,c}function Bk(e,t,n){let{glsl:r,chunk:s,referenced:i}=e,o=\"\";for(let a=1;a<t.args.length;a++){let u=n+a;if(u>=s.instructionsLength()||!i[u]||s.getInstruction(u).type!==48)continue;let c=fn(n+a),l=e.referenceArg(t.args[a]);if(r){let p=e.referenceArg(t.args[0]);o+=`${c}[int(${p})-1]=${l};\n`}else o+=`${c}.push(${l});\n`}return o+=`}\n`,o}function Gk(e,t,n){let{chunk:r,referenced:s}=e,i=fn(n);e.beforeBeginLoop(t);let o=`${e.referenceArg(t.args[0])}`,a=`${e.referenceArg(t.args[1])}`,u=`if(${o}>${a}){\n`;for(let c=2;c<t.args.length;c++){let l=t.endIndex+c-1;if(l>=r.instructionsLength()||!s[l]||r.getInstruction(l).type!==47)continue;let p=fn(l);u+=`${p}=${e.referenceArg(t.args[c])};\n`}u+=e.checkFiniteBounds(t,o,a),u+=`}else{\n`;for(let c=2;c<t.args.length;c++){let l=n+c-1;if(!s[l]||r.getInstruction(l).type!==47)continue;let p=fn(l);u+=`${p}=${e.referenceArg(t.args[c])};\n`}return u+=`${i}=${o};\n`,u+=\"while (true) {\",u}function kk(e,t,n){let{chunk:r,referenced:s}=e,i=r.getInstruction(t.args[0]),o=`${e.referenceArg(i.args[1])}`,a=fn(t.args[0]),u=`${a}++;`;u+=`if (${a}<=${o}) {\n`;let c=new Map,l=[];for(let p=1;p<t.args.length;p++){let f=t.args[0]+p;if(!s[f]||r.getInstruction(f).type!==47)continue;let d=t.args[p];c.set(f,e.referenceArg(d)),l[d]=e.isDirectlyReferencedByName(d)}for(let[p,f]of c.entries())if(l[p]){let d=aO(p);u+=e.emitImmediateAssignment(p,d,f),c.set(p,d)}for(let[p,f]of c.entries())u+=`${fn(p)}=${f};\n`;u+=`} else {\n`;for(let p=1;p<t.args.length;p++){let f=n+p;if(f>=r.instructionsLength()||!s[f]||r.getInstruction(f).type!==47)continue;let d=fn(f);u+=`${d}=${e.referenceArg(t.args[p])};\n`}return u+=`break;\n`,u+=`}\n}\n`,u+=`}\n`,u}function Hk(e,t,n){let{glsl:r}=e;if(r)throw z(\"GLSL map not implemented yet\");let s=fn(t.endIndex+1),i=[];for(let a=0;a<t.callData.parameterSymbols.length;a++){let u=fn(n+a+1);i.push(u)}let o=i.join(\",\");return`${s}=(${o}) => {\n`}function zk(e,t,n){let r=`return ${e.referenceArg(t.args[1])}`;return r+=`}\n`,r}function Uk(e,t,n){switch(t.type){case 1:return e.emitConstant(t);case 8:case 9:case 10:case 11:case 12:case 13:case 25:case 26:case 27:case 28:case 29:case 31:case 32:return e.emitBinary(t,e.referenceArg(t.args[0]),e.referenceArg(t.args[1]));case 14:{let s=e.referenceArg(t.args[0]);return e.emitNeg(s)}case 15:{let s=t.valueType;switch(s){case N:case R:return e.emitVec2(e.referenceArg(t.args[0]),e.referenceArg(t.args[1]));case H:return e.emitVec3(e.referenceArg(t.args[0]),e.referenceArg(t.args[1]),e.referenceArg(t.args[2]));default:let i=s;throw new Error(`Unexpected tuple type ${i}`)}}case 16:{let s=e.chunk.getInstruction(t.args[0]).valueType;switch(s){case N:case H:case R:return e.emitVecAccess(e.referenceArg(t.args[0]),t.index);default:let i=s;throw new Error(`Unexpected tuple type ${i}`)}}case 38:return e.emitList(t.args.map(s=>e.referenceArg(s)),t);case 40:case 42:case 3:throw new Error(`Programming Error: expect ${ts(t.type)} to be removed before emitting code.`);case 39:{let s=t.valueType;return e.emitListAccess(e.referenceArg(t.args[0]),e.referenceArg(t.args[1]),e.printValue(ls(s),s),t)}case 41:return e.emitInboundsListAccess(e.referenceArg(t.args[0]),e.referenceArg(t.args[1]));case 37:{let s=t.args.map(i=>e.referenceArg(i));return!e.glsl&&(n===e.chunk.getReturnIndex()&&t.symbol===\"coerceComplexToReal\"||t.symbol===\"peelableCoerceComplexToReal\")?`BuiltIn.peelableCoerceComplexToReal(${s.join(\",\")},__meta)`:e.emitNativeFunction(s,t)}case 44:return e.emitExtendSeed(e.referenceArg(t.args[0]),e.chunk.getInstruction(t.args[1]).valueType,e.referenceArg(t.args[1]),t.tag);case 2:case 0:case 21:case 22:case 19:case 20:case 23:case 24:case 47:case 48:case 49:case 50:case 51:case 53:case 54:case 33:case 55:case 4:throw new Error(`Unexpected opcode ${t.type}`);default:let r=t;throw new Error(`Unexpected opcode ${r.type}`)}}function OO(e,t,n,r){let s=e.getInstruction(n.args[0]);if(s.recursionGroup.length>1)return[];let i=s.endIndex,o=e.getInstruction(i),a=new Yg(e,r,t,i),u=[];for(let l=1;l<o.args.length;l++)u[o.args[l]]={op:\"&&\",values:[]};for(let l=i-1;l>t;l--){let p=u[l];if(p===void 0)continue;let f=e.getInstruction(l);if(!ge(f))if(f.type===33){u[f.args[0]]=p;let d=a.condition(f.args[0]);d!==void 0&&(u[f.args[1]]=P0(p,d),u[f.args[2]]=P0(p,$g(d)))}else for(let d of f.args)u[d]=p}let c=[];e:for(let l=i-1;l>=t;l--){let p=e.getInstruction(l);if(p.type!==55)continue;let f=e.getInstruction(p.args[0]);if(l>f.endIndex)continue;let d=p.args.slice(1);if(d.length!==f.signature.argTypes.length)throw new Error(\"Programming error: Non-matching arg length\");let y=u[l];if(y!==void 0){if(y.op===\"&&\"&&y.values.length===0)throw new Error(\"Programming error: Recursive call unconditionally executed\");for(let g=0;g<d.length;g++){if(e.getInstruction(d[g]).valueType!==I)continue e;let m=a.coeffs(d[g]);if(m===void 0||!qk(m,g)||V(m.argCoeffs[g])<-1)continue e}c[l]=y}}return c}function qk(e,t){for(let n=0;n<e.argCoeffs.length;n++)if(n!==t&&V(e.argCoeffs[n])!==0)return!1;return!0}function NO(e,t){let n=e.getReturnIndex(),r=new Array(n),s=new Array(n).fill(!1);for(let o=0;o<=n;o++){let a=e.getInstruction(o);es(a)||ds(a)||a.type===48||a.type===47&&e.getInstruction(a.args[0]).type!==22||a.type===0||a.type===55?r[o]=2:r[o]=0}r[n]===0&&(r[n]=1,s[n]=!0);let i=0;for(let o=n;o>=0;o--){if(!t[o])continue;let a=e.getInstruction(o);if(a.type===54?i++:a.type===53&&i--,ge(a))continue;if(a.type===19||a.type===20||a.type===24||a.type===54||a.type===39||a.type===55)for(let c of a.args){let l=e.getInstruction(c);r[c]===0&&l.type===1&&l.valueType===I?(r[c]=1,s[c]=!0):(r[c]=2,s[c]=!1)}else{for(let c of a.args)switch(r[c]){case 0:r[c]=1,s[c]=!0;break;case 1:case 2:r[c]=2,s[c]=!1;break}i>0&&a.type===33&&(r[o]=2,s[o]=!1)}}return s}function RO(e,t){if(t.recursionGroup.length>1)return!1;let n=t.endIndex,r=e.getInstruction(n);if(r.type!==54)throw new Error(\"Programming Error: end of BeginFunction is not EndFunction\");let[s,...i]=r.args;if(i.length!==1)return!1;let o=e.getInstruction(s);if(o.type!==53)throw new Error(\"Programming Error: start of EndFunction is not BeginFunction\");let a=o.args[0],u={};u[i[0]]=!0;for(let c=n-1;c>=s;c--){let l=e.getInstruction(c);switch(l.type){case 55:if(!u[c])return!1;if(l.args[0]!==a)throw new Error(\"recursionGroup.length == 1 contradicted\");break;case 33:u[c]&&(u[l.args[1]]=!0,u[l.args[2]]=!0);break;default:break}}return!0}function $k(e,t){if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}var Wg=class{constructor(t,n,r){this.chunk=t;this.referenced=n;this.shouldInline=r;this.thunkSets=[];this.thunkStarts=[];this.thunkEnds=[];this._isThunkEnd=[];this.piecewiseReferencedCount=[];this.dependencyThunkNames=[];this.parentFunctionStart=[];let s=t.getReturnIndex();for(let a=0;a<=t.instructionsLength();a++)this.thunkSets[a]=new Set;let i=t.argNames.length,o=[];for(let a=i;a<=t.getReturnIndex();a++){let u=t.getInstruction(a);this.parentFunctionStart[a]=o[o.length-1],u.type===53?o.push(a):u.type===54&&o.pop()}this.markThunkSets(i,s,[s],\"always\"),this.markThunks(i,s)}isThunkBegin(t){return this.thunkStarts[t]===t}isThunkEnd(t){return!!this._isThunkEnd[t]}containingThunkName(t){return this.thunkStarts[t]}thunkEnd(t){return this.thunkEnds[t]}isEarlyReturningThunk(t){let n=this.parentFunctionStart[t];return this.isThunkBegin(t)&&n!==void 0}dependencyThunkNamesForPiecewiseBranch(t){return this.dependencyThunkNames[t]}wantToInlineThunk(t){let n=this.thunkSets[t];if(n!==\"always\"&&n.size===1){for(let r of n)if(this.piecewiseReferencedCount[r]!==1)return!1;return!0}return!1}printChunkWithThunkInfo(){for(let t=0;t<=this.chunk.getReturnIndex();t++){let n=this.thunkSets[t],r=n===\"always\"?\"always\":`{${[...n].sort().join(\",\")}}`;if(this.isThunkBegin(t)&&(r+=\" beginThunk\"),this.isThunkEnd(t))r+=\" endThunk\";else{let s=this.containingThunkName(t);s!==void 0&&(r+=` start:${s}`)}this.shouldInline[t]&&(r+=\"\t[inline]\"),this.chunk.comments[t]=r}return this.chunk.print(this.chunk.getReturnIndex())}markThunkSets(t,n,r,s){let{chunk:i,referenced:o,thunkSets:a,piecewiseReferencedCount:u}=this;for(let l of r)a[l]=\"always\";function c(l,p){let f=a[l];if(f!==\"always\"){if(p===\"always\"){a[l]=p;return}for(let d of p)f.add(d)}}for(let l=n;l>=t;l--){if(!o[l])continue;let p=i.getInstruction(l);if(ge(p))continue;let f=a[l];if(ds(p)){let d=p.args[0];this.markThunkSets(d+1,l-1,p.args.slice(1),f),l=d+1;continue}for(let d=0;d<p.args.length;d++){let y=p.args[d];if(y<t)c(y,s);else if(d>0&&p.type===33){let g=a[y];g!==\"always\"&&g.add(y);let m=u[y];u[y]=(m!=null?m:0)+1}else c(y,f)}}}markThunks(t,n){var a,u;let{chunk:r,thunkSets:s}=this,i,o;for(let c=t;c<=n;c=o){let l=r.getInstruction(c),p=Yk(this.chunk,l),f,d;if(p){let y=c+1,g=p.innerEndIndex-1;this.markThunks(y,g),d=s[p.innerEndIndex],o=p.outerEndIndex+1,f=this.thunkDecision(i,c,this.referenced[p.innerEndIndex],l.type===21&&this.shouldInline[p.outerEndIndex],d)}else d=s[c],o=c+1,f=this.thunkDecision(i,c,this.referenced[c],this.shouldInline[c],d);if(i!==void 0&&f.shouldEndThunk&&(this.markEndThunk(c-1,i),i=void 0),f.shouldStartThunk&&d!==\"always\"){for(let y of d)(u=(a=this.dependencyThunkNames)[y])!=null||(a[y]=[]),this.dependencyThunkNames[y].push(c);i={start:c,set:d}}if(i!==void 0&&(this.thunkStarts[c]=i.start,p))for(let y=p.innerEndIndex;y<=p.outerEndIndex;y++)this.thunkStarts[y]=i.start}i!==void 0&&this.markEndThunk(n,i)}thunkDecision(t,n,r,s,i){let o=this.chunk.getInstruction(n);if(o.type===33&&(s=!1),s||!r)return{shouldEndThunk:!1,shouldStartThunk:!1};if(i===\"always\")return{shouldEndThunk:t!==void 0,shouldStartThunk:!1};let a=o.type===1||o.type===47,u=i.size>0&&!a,c=t!==void 0&&!$k(i,t.set);return{shouldEndThunk:c,shouldStartThunk:(c||t===void 0)&&u}}markEndThunk(t,n){let{referenced:r}=this;for(;t>=0&&!r[t];)t--;this._isThunkEnd[t]=!0,this.thunkEnds[n.start]=t}};function Yk(e,t){if(es(t)){let n=t.endIndex,r=e.getInstruction(n);if(r===void 0)return;if(Gg(r))return{outerEndIndex:n+r.args.length-1,innerEndIndex:n};if(r.type===54)return{outerEndIndex:n,innerEndIndex:n}}}var wp=class{constructor(t,n){this.chunk=t;this.glsl=n;this.inlinedSource=[];this.inlinedThunks=[];this.recursiveFunctionInfo=[];this.isTailFunction=[];let r=t.getReturnIndex();this.referenced=Vr(t,r),this._shouldInline=NO(t,this.referenced),!this.glsl&&t.computeNeedsThunking()&&(this.thunks=new Wg(t,this.referenced,this._shouldInline));for(let s=0;s<=r;s++){let i=t.getInstruction(s);if(i.type===4){if(!this.referenced[s])continue;this.isTailFunction[s]=RO(t,i),i.recursionGroup=i.recursionGroup.filter(o=>this.referenced[o])}}}isThunkBegin(t){return!!this.thunks&&this.thunks.isThunkBegin(t)}isThunkEnd(t){return!!this.thunks&&this.thunks.isThunkEnd(t)}isEarlyReturningThunk(t){return!!this.thunks&&this.thunks.isEarlyReturningThunk(t)&&this.inlinedThunks[t]===void 0}thunkName(t){var n;return(n=this.thunks)==null?void 0:n.containingThunkName(t)}thunkEnd(t){return this.thunks.thunkEnd(t)}shouldInline(t){return this._shouldInline[t]}inlineSource(t,n){this.inlinedSource[t]=n}wantToInlineThunk(t){return!!this.thunks&&this.thunks.wantToInlineThunk(t)}inlineThunk(t,n){this.inlinedThunks[t]=n}referenceArg(t){let n=this.inlinedSource[t];return n!==void 0?n:fn(t)}isDirectlyReferencedByName(t){return this.inlinedSource[t]===void 0}referencePiecewiseBranch(t){var o;let n=this.referenceArg(t),r=(o=this.thunks)==null?void 0:o.dependencyThunkNamesForPiecewiseBranch(t);if(!r||r.length===0)return{expression:n,rawExpression:n,thunkDependencies:[]};let s=[],i=\"\";for(let a of r){let u=this.inlinedThunks[a];if(u!==void 0)i&&(i+=\",\"),i+=u;else{let c=Ap(a),l=_p(a),p=`${c}||${l}()`;i&&(i+=\",\"),i+=`${p}`}s.push(a)}return{expression:\"(\"+i+\",\"+n+\")\",rawExpression:n,thunkDependencies:s}}enterFunction(t,n,r){let s=t.args[0],i=this.chunk.getInstruction(s),o=[];for(let u=0;u<i.signature.argTypes.length;u++)o.push(n+u+1);let a=OO(this.chunk,n,t,o);this.recursiveFunctionInfo.push({fn:s,argBlockvars:o,reachConditions:a,returnType:t.valueType,executionMode:r})}exitFunction(){this.recursiveFunctionInfo.pop()}};function jg(e){let t=new D0(e),n=Zg(t);return t.finish(n)}var D0=class extends wp{constructor(n){super(n,!1);this.constants=[]}finish(n){return{source:n,constants:this.constants}}printValue(n){return AO(n)}beforeBeginLoop(){}checkFiniteBounds(n,r,s){let i=`}else if(!isFinite(${s}-${r})){\n`;for(let o=2;o<n.args.length;o++){let a=n.endIndex+o-1;if(a>=this.chunk.instructionsLength()||!this.referenced[a])continue;let u=this.chunk.getInstruction(a);if(u.type!==47)continue;let c=fn(a);io(u.valueType)?i+=`${c}=${this.printValue(ls(u.valueType))};\n`:i+=`throw new Error('Cannot set ${c} of type ${at(u.valueType)} to NaN value');\n`}return i}emitConstant(n){return n.valueType===I||n.valueType===De||n.valueType===N||n.valueType===H?this.printValue(n.value):(this.constants.push(Vo(n.value)),`_C[${this.constants.length-1}]`)}emitNeg(n){return`-${n}`}emitTernary(n,r,s){return`${n}?${r}:${s}`}emitVec2(n,r){return`[${n},${r}]`}emitVec3(n,r,s){return`[${n},${r},${s}]`}emitVecAccess(n,r){return`${n}[${r}]`}emitBinary(n,r,s){switch(n.type){case 8:return`${r}+${s}`;case 9:return`${r}-${s}`;case 10:return`${r}*${s}`;case 11:return`${r}/${s}`;case 12:return`BuiltIn.pow(${r},${s})`;case 13:return`Math.pow(${r},${s})`;case 25:return`${r}===${s}`;case 26:return`${r}<${s}`;case 28:return`${r}<=${s}`;case 27:return`${r}>${s}`;case 29:return`${r}>=${s}`;case 31:return`${r}||${s}`;case 32:return`${r}&&${s}`;default:throw new Error(\"Programming Error: invalid binary opcode.\")}}emitList(n){return`[${n.join(\",\")}]`}emitListAccess(n,r,s){let i=`${n}.length`,o=`Math.floor(${r})`;return`(${o}>=1&&${o}<=${i})?${n}[${o}-1]:${s}`}emitInboundsListAccess(n,r){return`${n}[${r}-1]`}emitNativeFunction(n,r){let s=Bn[r.symbol];return`${s.module}.${s.symbol}(${n.join(\",\")})`}emitExtendSeed(n,r,s,i){let o=r===I?s:`BuiltIn.serializeNonNumericSeedPart(${r},${s})`;return`${n}+'::${i}'+${o}`}emitVarDeclaration(n,r){let s=r?\",\":\"var \";return s+=fn(n),s}emitImmediateAssignment(n,r,s){return`var ${r}=${s};`}emitFunctionCall(n,r,s,i){return`${n}(${r}, ${s}, ${i.join(\",\")})`}};function AO(e){if(Array.isArray(e))return`[${e.map(AO).join(\",\")}]`;switch(typeof e){case\"boolean\":case\"number\":return e.toString();case\"string\":return`${JSON.stringify(e)}`;case\"object\":if(gu(e))throw new Error(\"Action values cannot be compiled\");return V(e).toString();default:throw new Error(\"Unexpected value: \"+e)}}function Jg(e){let t=e.getInstruction(e.getReturnIndex());if(t.type!==47)throw new Error(`Expected BlockVar, got ${t.type}`);let n=e.getInstruction(t.args[0]);if(n.type!==51)throw new Error(`Expected EndMap, got ${n.type}`);let r=j(t.valueType)?Ve(t.valueType):t.valueType,s=e.getInstruction(n.args[0]);if(s.type!==50)throw new Error(`Expected BeginMap, got ${s.type}`);let i=[];for(let p of s.args){let f=e.getInstruction(p);if(!Je(f)||f.valueType!==I)throw z(\"Programming error: interval bounds must be constant numbers\");i.push(V(f.value))}let o,a;r===sr||r===or||r===ir?(o=[\"t\"],a={type:\"1d\",min:i[0],max:i[1]}):(o=[\"u\",\"v\"],a={type:\"2d\",uMin:i[0],uMax:i[1],vMin:i[2],vMax:i[3]});let u=jg(e),c=`\n  const mapFn = (function() {\n    \"use strict\";\n    ${u.source}\n  })();\n  return mapFn(${o.join(\",\")});\n`,l={};return{args:o,source:c,constants:u.constants,executionMetadata:l,fn:Lf(o,c,u.constants,l),domain:a}}function Xk(e){for(let t=0;t<this.length;t++)e(this.elementAt(t),t)}function Zk(e){let t=[];for(let n=0;n<this.length;n++)t.push(e(this.elementAt(n),n));return t}var on=class e extends Yt{constructor(n){super();this.isError=!1;this.eachElement=Xk;this.mapElements=Zk;if(n.getError())throw new Error(\"Programming error: IRExpression should not be constructed with an error chunk\");if(this.warning=n.getWarning(),this._chunk=n,this.valueType=n.getReturnType(),this.addDependencies(n.getLiveArgNames()),this.isList=j(this.valueType),this.isList&&(this.length=this._chunk.getConstantListLength(),this.length===void 0))throw RP(n.getListLengthDependencies());rO(n);let r=n.isConstant();this.isConstant=r&&(this.valueType===I||this.valueType===De),this.isTypedConstant=r,this.isEmptyAction=r&&this.valueType===ut&&Object.keys(n.asValue().updateRules).length===0}shouldExportAns(){return!0}getCompiledFunction(n){return ua(this.valueType)?Jg(this._chunk):this._chunk.getCompiledFunction(n)}getRestrictedFunctionForGLSL(n,r){return this._chunk.getRestrictedFunctionForGLSL(n,r)}polynomialOrder(n){return this._chunk.polynomialOrder(n,{allowRestriction:!0,allowClosedBlockReferences:!1})}getPolynomialCoefficients(n){let r=this._chunk.getPolynomialCoefficients(n),s=r.chunk,i=r.coefficients,o=[];for(let a=0;a<i.length;a++){let u=s.copy();u.setReturnIndex(i[a]),u.fuseBroadcast(),o.push(new e(u))}return o}takeDerivative(n){let r=this._chunk.copy().takeDerivative(n).fuseBroadcast();return new e(r)}gradient(n){let r=this._chunk.copy().gradient(n).fuseBroadcast();return new e(r)}toImplicitBool(){let n=this._chunk.copy();return n.GreaterEqual([n.getReturnIndex(),n.Constant(0)]),n.fuseBroadcast(),new e(n)}interpretWithParameters(n){let r,s=this._chunk.argNames;if(n.length===s.length)r=n;else{r=[];let i=this.getDependencies();for(let o=0,a=0;o<s.length;o++)i[a]===s[o]?(r.push(n[a]),a+=1):r.push(void 0)}return this._chunk.interpretWithParameters(r)}substituteConstantArguments(n){return new e(this._chunk.substituteConstantArguments(n))}boundDomain(n){return this._chunk.boundDomain(n)}asValue(){if(this._chunk.isConstant())return this._chunk.asValue();if(this.isList){let n=[],r=Vo(ls(Ve(this.valueType)));for(let s=0;s<this.length;s++)n.push(r);return n}else return Vo(ls(this.valueType))}asTypedValue(){return{valueType:this.valueType,value:this.asValue()}}asCompilerValue(){return this._chunk.asCompilerValue()}isNaN(){return typeof this.asValue()==\"number\"&&isNaN(this.asValue())}getEvaluationInfo(){return this._chunk.isConstant()&&this.getDependencies().length===0&&(se(this.valueType,I)||se(this.valueType,De)||se(this.valueType,R))?[{val:this.asValue()}]:!1}findLinearSubset(n){return this._chunk.findLinearSubset(n)}deriveRegressionRestrictions(){let n=this._chunk.deriveRegressionRestrictions();return n===this._chunk?this:new e(n)}getCursorContext(){return this._chunk.getCursorContext()}getRecursiveFunctionMetadata(){let n=this._chunk.getInstruction(this._chunk.getReturnIndex());if(n.type===55)return this._chunk.getRecursiveFunctionMetadata(n.args[0])}coerceToNumericIfPossible(){if(se(this.valueType,Le)||se(this.valueType,ye)||se(this.valueType,R)){let n=this._chunk.copy(),r=n.getReturnIndex();return n.coerceToNumericIfPossible()===r?this:new e(n)}else return this}slot(n){let r=this._chunk.copy();return r.setReturnIndex(r.Slot(n,[r.getReturnIndex()])),new e(r)}};function Wk(e){let t=1/0;for(let n=0;n<e.length;n++)(e[n].isList||e[n].isBroadcast)&&(t=Math.min(t,e[n].length));return t}var Vf=class Vf extends Q{constructor(n){super(n);this.isList=!0;this.length=n.length}asValue(){let n=[];for(let r=0;r<this.args.length;r++)n.push(this.args[r].asValue());return n}asCompilerValue(){let n=[];for(let r=0;r<this.args.length;r++)n.push(this.args[r].asCompilerValue());return n}getEvaluationInfo(){if(this.args.every(n=>n.isConstant))return[{val:this.args.map(n=>n.asValue())}]}};Vf.eachArgs=function(n,r){let s=Wk(n);if(!isFinite(s)){r(n);return}for(let i=0;i<s;i++){let o=[];for(let a=0;a<n.length;a++)o.push(n[a].isList||j(n[a].valueType)?n[a].elementAt(i):n[a]);r(o,i)}},Vf.wrap=function(n){return n.isList||j(n.valueType)?n:new Vf([n])};var lo=Vf;var Go=class extends Q{constructor(t){super(t),this.list=t[0],this.index=t[1]}};var Ja=class extends Q{constructor(n,r,s,i,o=[]){super([n,r].concat(s),{skipRegisterDependencies:!0});this.shouldCoerceToList=i;this.parameters=o;this._index=n,this._body=r,this._inputLists=s,this.registerDependencies()}registerDependencies(){let n=[];for(let i of this._inputLists){let o=i._symbol;n.push(o)}for(let i of this.parameters){let o=i.identifier._symbol;n.push(o)}this.addOptionalDependencies(n);let s=[this._index._symbol,...n];for(let i of this._inputLists)this.mergeDependenciesInScope(this.type,s,i.args[1]);for(let i of this.parameters)this.mergeDependenciesInScope(this.type,s,i.bounds[0]),this.mergeDependenciesInScope(this.type,s,i.bounds[1]);this.mergeDependenciesInScope(this.type,s,this._body)}};var Qg=class extends Et{constructor(){super(...arguments);this.is_mixed_number=!0}};var Kg=class extends ao{constructor(n,r,s){super(n);this.isTypedConstant=!0;this.isMovablePoint=!0;this.moveStrategy=r,this.defaultDragMode=s,this.valueType=N}asValue(){return[+this.args[0].asValue(),+this.args[1].asValue()]}asTypedValue(){return{valueType:this.valueType,value:this.asValue()}}asCompilerValue(){return[this.args[0].asCompilerValue(),this.args[1].asCompilerValue()]}};var Fp=class extends Q{};var Vp=class extends Q{};var Bp=class extends Q{};var Gp=class extends Q{};var kp=class extends Q{};var ul=class extends Q{constructor(t,n){super(n),this.order=t}};var Bu=class extends Q{constructor(t){super(t,{skipRegisterDependencies:!0}),this._index=t[0],this.registerDependencies()}registerDependencies(){for(let t=1;t<=3;t++)this.mergeDependenciesInScope(this.type,[this._index._symbol],this.args[t])}};var Hp=class extends Bu{constructor(){super(...arguments);this.in_place_operator=\"*=\";this.starting_value=1}evaluateConstant(n){let r=1+Math.round(n[1])-Math.round(n[0]);return r<=0?this.starting_value:Math.pow(n[2],r)}update(n,r){return n*r}};var zp=class extends Q{constructor(t){super(t),this.beginning=t[0],this.end=t[1]}isHalfEmpty(){return this.end&&this.end.args&&this.end.args.length===0}};var eh=class extends Lu{};var cl=class extends Q{constructor(n){let r=new Et(n);super([r]);this.value=n;this._constantNode=r}asValue(){return this._constantNode.asValue()}asCompilerValue(){return this._constantNode.asCompilerValue()}};var Up=class extends Q{};var ll=class extends Q{constructor(n){typeof n!=\"string\"&&(n=\"\"+n);super([]);this.isString=!0;this._stringValue=n}asValue(){return this._stringValue}};var Gu=class extends gn{constructor(t,n){super(t,n),this.seed=n[0]}};var th=class extends ja{constructor(n,r){super(new we(n._symbol),n._expression);this.isSlider=!0;this.setInputSpan(n._inputSpan),this.sliderAssignment=n,this.sliderMin=r.sliderMin,this.sliderMax=r.sliderMax,this.sliderSoftMin=r.sliderSoftMin,this.sliderSoftMax=r.sliderSoftMax,this.sliderStep=r.sliderStep,this.sliderIsPlayingOnce=r.sliderIsPlayingOnce,this.sliderMin&&this.mergeDependencies(this.sliderMin),this.sliderMax&&this.mergeDependencies(this.sliderMax),this.sliderStep&&this.mergeDependencies(this.sliderStep)}shouldPromoteToSlider(n){return!1}asAssignment(){return new ja(this._symbol,this._expression)}};var nh=class extends Yt{constructor(t,n,r,s){super(),this._symbol=t,this._expression=n,this.otherVariableSolutionData=r,this.mergeDependencies(n),this.branchMultiplier=s}};var qp=class extends Q{constructor(t){super(t),this._symbol=\"stats\"}};var xa=class extends Q{constructor(t,n){super([t].concat(n),{skipRegisterDependencies:!0}),this._body=t,this._assignments=n,this.registerDependencies()}registerDependencies(){let t=[];for(let n=0;n<this._assignments.length;n++){let r=this._assignments[n],s=r._lhs,i=r._rhs;if(ki(s)){let o=r._symbol;t.push(o),this.mergeDependencies(i)}else if(Qv(s))this.mergeDependencies(r);else throw new Error(`Unexpected LHS in assignment expression: ${s.type}`);this.addSubstitutionDependencies(i.getDependencies())}this.addOptionalDependencies(t),this.mergeDependenciesInScope(this.type,t,this._body)}};var $p=class extends Bu{constructor(){super(...arguments);this.in_place_operator=\"+=\";this.starting_value=0}evaluateConstant(n){let r=1+Math.round(n[1])-Math.round(n[0]);return r<=0?this.starting_value:r*n[2]}update(n,r){return n+r}};var Yp=class extends Yt{constructor(n,r,s,i){super();this.calcColumns=r;this.regression=s;this.exportPenalty=1;this.isTable=!0;this.columns=n,this.mergeDependencies.apply(this,n),this.localFrameID=i}getExports(){return[]}getColumnIdsForGraphing(){return this.columns.map(n=>n.userData.id)}getColumnStatementIds(){return this.calcColumns.map(n=>n.userData.id)}getRegressionId(){var n;return(n=this.regression)==null?void 0:n.userData.id}};var rh=class extends Yt{constructor(t){super(),this.handler=t.handler,this.minStep=t.minStep,this.mergeDependencies(this.handler),this.mergeDependencies(this.minStep)}};var Xp=class extends Q{constructor(t){super(t),this._symbol=\"ttest\"}};var Zp=class extends Q{constructor(t){super(t,{skipRegisterDependencies:!0}),this._symbol=t[0]._symbol,this._expression=t[1],this.registerDependencies()}registerDependencies(){this.addUpdateSymbol(this._symbol),this.mergeDependencies(this._expression)}};var ku=class extends Yt{constructor(t,n){super(),this._symbol=t._symbol,this.mergeDependencies(t,n),this._lhs=t,this._rhs=n}asComparator(){return new ps[\"=\"]([this._lhs,this._rhs])}};var br=\"i\",ko=class extends Q{constructor(){super([])}};var pl=class extends Q{constructor(n,r,s){super(n);this.isTypedConstant=!0;this.isMovablePoint=!0;this.moveStrategy=r,this.defaultDragMode=s,this.valueType=R}asValue(){return[+this.args[0].asValue(),+this.args[1].asValue()]}asTypedValue(){return{valueType:this.valueType,value:this.asValue()}}asCompilerValue(){return[this.args[0].asCompilerValue(),this.args[1].asCompilerValue()]}getEvaluationInfo(){return[{val:this.asValue()}]}};var Ho=class extends Q{constructor(t,n){super(n),this.symbol=t}};function lt(e,t){switch(e){case I:case De:return new M.Constant(t);case ft:return new M.Seed(t);case R:return new M.Add([lt(I,t[0]),new M.Multiply([lt(I,t[1]),new M.ImaginaryUnit])]);case N:return new M.ParenSeq([lt(I,t[0]),lt(I,t[1])]);case H:return new M.ParenSeq([lt(I,t[0]),lt(I,t[1]),lt(I,t[2])]);case wt:return new M.FunctionCall(\"segment\",[lt(H,t[0]),lt(H,t[1])]);case ke:return new M.FunctionCall(\"vector\",[lt(H,t[0]),lt(H,t[1])]);case Rn:return new M.FunctionCall(\"triangle\",[lt(H,t[0]),lt(H,t[1]),lt(H,t[2])]);case Hn:return new M.FunctionCall(\"sphere\",[lt(H,t[0]),lt(I,t[1])]);case Kt:return new M.FunctionCall(\"rgb\",[lt(I,t[0]),lt(I,t[1]),lt(I,t[2])]);case xe:return new M.FunctionCall(\"polygon\",[lt(Pt,t)]);case de:return new M.FunctionCall(\"segment\",[lt(N,t[0]),lt(N,t[1])]);case fe:return new M.FunctionCall(\"line\",[lt(N,t[0]),lt(N,t[1])]);case Ne:return new M.FunctionCall(\"ray\",[lt(N,t[0]),lt(N,t[1])]);case le:return new M.FunctionCall(\"mathVector\",[lt(N,t[0]),lt(N,t[1])]);case ce:return new M.FunctionCall(\"circle\",[lt(N,t[0]),lt(I,t[1])]);case ie:return new M.FunctionCall(\"arc\",[lt(N,t[0]),lt(N,t[1]),lt(N,t[2])]);case Le:return new M.FunctionCall(\"angle\",[lt(N,t[0]),lt(I,t[1]),lt(I,t[2])]);case ye:return new M.FunctionCall(\"directedangle\",[lt(N,t[0]),lt(I,t[1]),lt(I,t[2])]);case $e:case ne:case Xn:case Ue:case Pt:case rr:case In:case xn:case jn:case Vn:case Jn:case On:case Nn:case Wn:case Fn:case fr:case mr:case gr:case yr:case Ar:case cs:{let r=[],s=Ve(e);for(let i of t)r.push(lt(s,i));return new M.List(r)}case Qt:case Lt:case pn:case Zn:case ut:case Re:case Rr:case Ro:case sr:case or:case ir:case Pr:case Mr:case Er:case $r:case Wr:case Yr:case Xr:case jr:case Zr:case Gt:case Gs:throw new Error(`Programming error: cannot create parse node from valueType: ${at(e)}`);case Pn:return new M.FunctionCall(\"tone\",[lt(I,t[0]),lt(I,t[1])]);default:let n=e;throw new Error(`Programming error: unexpected valueType: ${at(n)}`)}}function jk(e){if(!e.isTypedConstant)return new Et(NaN);let t=e.asTypedValue();return t?lt(t.valueType,t.value):new Et(NaN)}function Jk(e){if(!e.isTypedConstant)return NaN;let t=e.asTypedValue();if(!t)return NaN;switch(t.valueType){case I:return t.value;case R:return t.value;default:throw z(`Unexpected type ${at(t.valueType)} in column.`)}}var dl=class extends lo{constructor(n,r){super(n.map(jk));this.rawArgs=n;this.headerSymbol=r;this.isIndependent=r!==void 0}asValueMixed(){return this.rawArgs.map(Jk)}};function ae(e,t){let n=eO(e);return n.prototype.type=t,n}var Qk={Base:ae(Yt,\"Base\"),Expression:ae(Q,\"Expression\"),Error:ae(v,\"Error\"),Constant:ae(Et,\"Constant\"),MixedNumber:ae(Qg,\"MixedNumber\"),Identifier:ae(we,\"Identifier\"),Ans:ae(Fg,\"Ans\"),ImaginaryUnit:ae(ko,\"ImaginaryUnit\"),List:ae(lo,\"List\"),TableColumnValue:ae(dl,\"TableColumnValue\"),Range:ae(zp,\"Range\"),ListAccess:ae(Go,\"ListAccess\"),DotAccess:ae(Ms,\"DotAccess\"),Construction:ae(rl,\"Construction\"),ParenSeq:ae(ao,\"ParenSeq\"),MovableComplexNumber:ae(pl,\"MovableComplexNumber\"),MovablePoint:ae(Kg,\"MovablePoint\"),NamedCoordinateAccess:ae(Ho,\"NamedCoordinateAccess\"),BareSeq:ae(Ru,\"BareSeq\"),Norm:ae(Bp,\"Norm\"),BaseComparator:ae(uo,\"BaseComparator\"),ComparatorChain:ae(Au,\"ComparatorChain\"),DoubleInequality:ae(Vg,\"DoubleInequality\"),RepeatedOperator:ae(Bu,\"RepeatedOperator\"),Sum:ae($p,\"Sum\"),Product:ae(Hp,\"Product\"),Integral:ae(Rp,\"Integral\"),AssignmentExpression:ae(Mp,\"AssignmentExpression\"),ListComprehension:ae(Ja,\"ListComprehension\"),FunctionCall:ae(gn,\"FunctionCall\"),RecursiveFunctionBaseCase:ae(Qr,\"RecursiveFunctionBaseCase\"),SeededFunctionCall:ae(Gu,\"SeededFunctionCall\"),FunctionExponent:ae(wu,\"FunctionExponent\"),FunctionFactorial:ae(Fu,\"FunctionFactorial\"),Prime:ae(ul,\"Prime\"),Piecewise:ae(Fr,\"Piecewise\"),Restriction:ae(Up,\"Restriction\"),Derivative:ae(sl,\"Derivative\"),UpdateRule:ae(Zp,\"UpdateRule\"),Substitution:ae(xa,\"Substitution\"),Histogram:ae(Op,\"Histogram\"),DotPlot:ae(vp,\"DotPlot\"),BoxPlot:ae(Cp,\"BoxPlot\"),TTest:ae(Xp,\"TTest\"),IndependentTTest:ae(Np,\"IndependentTTest\"),Stats:ae(qp,\"Stats\"),Assignment:ae(ja,\"Assignment\"),FunctionDefinition:ae(Cr,\"FunctionDefinition\"),CallAssignment:ae(ku,\"CallAssignment\"),Equation:ae(Nu,\"Equation\"),Regression:ae(Pp,\"Regression\"),Image:ae(Bg,\"Image\"),Ticker:ae(rh,\"Ticker\"),Slider:ae(th,\"Slider\"),RegressionParameter:ae(cl,\"RegressionParameter\"),Table:ae(Yp,\"Table\"),TableColumn:ae(co,\"TableColumn\"),SolvedEquation:ae(nh,\"SolvedEquation\"),OptimizedRegression:ae(Wa,\"OptimizedRegression\"),Seed:ae(ll,\"Seed\"),ExtendSeed:ae(il,\"ExtendSeed\"),IRExpression:ae(on,\"IRExpression\"),Add:ae(Ep,\"Add\"),Subtract:ae(Es,\"Subtract\"),Multiply:ae(Fp,\"Multiply\"),DotMultiply:ae(_u,\"DotMultiply\"),CrossMultiply:ae(Dp,\"CrossMultiply\"),Divide:ae(Sp,\"Divide\"),Exponent:ae(Lu,\"Exponent\"),Negative:ae(Vp,\"Negative\"),Or:ae(Gp,\"Or\"),PercentOf:ae(kp,\"PercentOf\"),RawExponent:ae(eh,\"RawExponent\"),Comparator:{\"<\":ae(ps[\"<\"],\"Comparator['<']\"),\">\":ae(ps[\">\"],\"Comparator['>']\"),\"<=\":ae(ps[\"<=\"],\"Comparator['<=']\"),\">=\":ae(ps[\">=\"],\"Comparator['>=']\"),\"=\":ae(ps[\"=\"],\"Comparator['=']\")}},M=Qk;var F1={};ia(F1,{parse:()=>Mi,setInput:()=>$A});var Dr={xmin:-5,xmax:5,ymin:-5,ymax:5,zmin:-5,zmax:5};function S0(e,t){let n=Math.round(1e6*e)/1e6;return Math.abs(n-e)<t?n:e}function $j(e){let t=!0,n=!0,r=!0;return e.hardMin!==void 0&&e.target<e.hardMin&&(t=!1),e.hardMax!==void 0&&e.target>e.hardMax&&(n=!1),e.step&&sh({target:e.target,step:e.step,hardMin:t?e.hardMin:void 0,hardMax:n?e.hardMax:void 0})!==e.target&&(r=!1),{min:t,max:n,step:r}}function sh(e){let{target:t,hardMin:n,hardMax:r,step:s}=e,i=1e-10;if(n!==void 0&&r!==void 0&&(i=Math.min(i,Math.abs(r-n)/1e3)),s&&(i=Math.min(i,s/10)),n!==void 0&&(n=S0(n,i)),r!==void 0&&(r=S0(r,i)),e.forceSliderToMax&&r!==void 0&&(t=r),n>r||t<=n)return n;if(t>=r)return r;if(s){let a=n!==void 0?n:0,u=Math.round((t-a)/s);t=s*u+a}let o=S0(t,i);return(s||n===o||r===o)&&(t=o),t<=n?n:t>=r?r:t}function _O(e){let{storedMax:t,sliderValue:n,hardMin:r,step:s}=e,i=e.is3d?Dr.xmax:10;if(t>i&&(i=t),n>i&&(i=n),r>i&&(i=r),s){let o=sh({target:i,hardMin:r,hardMax:void 0,step:s});o>=i?i=o:i=o+s}return i}var Qa={coerceToNumber:\"all\"};M.Base.prototype.tryGetConcreteTree=function(e,t,n={}){let r;try{r=this.getConcreteTree(e,t,n)}catch(s){s instanceof M.Base?r=s:r=z(s)}return r};M.Base.prototype.getConcreteTree=function(e,t,n={}){let r=this.buildIRExpression(e,t,{coerceToNumber:n.coerceToNumber});if(r.isError)throw r;return r};M.DoubleInequality.prototype.getConcreteTree=function(e,t){return new this.constructor([new M.Piecewise([this._indicator,this._expressions[0],new Et(NaN)]).getConcreteTree(e,t),this._operators[0],new we(this._symbol),this._operators[1],new M.Piecewise([this._indicator,this._expressions[1],new Et(NaN)]).getConcreteTree(e,t)])};M.Error.prototype.getConcreteTree=function(e,t){return this};function Bf(e,t){return e.isError?e:t.indexOf(e.valueType)===-1?wd():e}M.Image.prototype.getConcreteTree=function(e,t){let n=this.center.tryGetConcreteTree(e,t),r=this.radianAngle.tryGetConcreteTree(e,t,Qa),s=this.width.tryGetConcreteTree(e,t,Qa),i=this.height.tryGetConcreteTree(e,t,Qa),o=this.opacity.tryGetConcreteTree(e,t,Qa),a=[N,Pt,$e],u=[I,ne,$e];return n=Bf(n,a),r=Bf(r,u),s=Bf(s,u),i=Bf(i,u),o=Bf(o,u),new M.Image({center:n,radianAngle:r,width:s,height:i,opacity:o},this.moveStrategy)};M.Ticker.prototype.getConcreteTree=function(e,t){let n=this.handler.tryGetConcreteTree(e,t);!n.isError&&n.valueType!==ut&&(n=Gd(oe(n.valueType)));let r=n.getDependencies().filter(s=>!(e.graphingEnabled()&&e.validActionVariable(s)));return r.length&&(n=rn(e.sliderVariables(r)).setDependencies(r)),new M.Ticker({handler:n,minStep:this.minStep.tryGetConcreteTree(e,t,Qa)})};function v0(e,t,n){if(!t){n.valids[e]=!0;return}let r=t.getDependencies();if(t.isError)n.errors[e]=!0;else if(r.length>0){n.errors[e]=!0;for(let s=0;s<r.length;s++)r[s]===n.exportedSymbol?n.errors.cycle=!0:n.missingVars.push(r[s])}else n.values[e]=+t.asValue();n.valids[e]=isFinite(n.values[e]),n.valids[e]||(n.values[e]=void 0)}function ih(e){return e&&e.valueType===ne&&e.length===1&&e.args?e.args[0]:e}M.Slider.prototype.getConcreteTree=function(e,t){let n=this._expression.getConcreteTree(e,t),r=ih(this.sliderMin&&this.sliderMin.tryGetConcreteTree(e,t,Qa)),s=ih(this.sliderMax&&this.sliderMax.tryGetConcreteTree(e,t,Qa)),i=ih(this.sliderStep&&this.sliderStep.tryGetConcreteTree(e,t,Qa)),o={exportedSymbol:this._symbol,errors:{},values:{},valids:{},missingVars:[],errMsg:void 0};if(v0(\"min\",r,o),v0(\"max\",s,o),v0(\"step\",i,o),i&&o.valids.step&&(o.values.step===0?delete o.values.step:o.values.step=Math.abs(o.values.step)),o.errors.cycle?n=SI(o.exportedSymbol):(o.errors.min||!o.valids.min?o.errMsg=vI():o.errors.max||!o.valids.max?o.errMsg=OI():(o.errors.step||!o.valids.step)&&(o.errMsg=RI()),o.values.min>o.values.max&&(o.valids.min=!1,o.valids.max=!1,o.errMsg||(o.errMsg=NI()))),n.isConstant){let u=t.initialEvaluation&&t.initialEvaluation.asValue()&&this.sliderIsPlayingOnce,c=o.values.max,l=+n.asValue(),p=o.values.min,f=o.values.step;if(u&&!isFinite(c)){let m=ih(this.sliderSoftMax&&this.sliderSoftMax.tryGetConcreteTree(e,t,Qa));m&&(c=_O({storedMax:+m.asValue(),sliderValue:l,step:f,hardMin:p,is3d:e.is3dProduct()}))}let d=sh({target:l,hardMin:p,hardMax:c,step:f,forceSliderToMax:!!u}),y=Qc(d.toString()),g=isFinite(V(y))?y:d;n=new Et(g).getConcreteTree(e,t)}return n.sliderInfo=o,n};function LO(e,t){if(!t[this._symbol])throw Li(this._symbol,e);let n=this.args.map(r=>r.getConcreteTree(e,t));if(n.length>0){if(n.length===1&&n.push(new M.Constant(1).getConcreteTree(e,t)),n[1].getDependencies().length)throw Jd(this._symbol).setDependencies(n[1].getDependencies());if(n[1].valueType!==I)throw Jd(this._symbol);let r=n[1].asValue();if(!isFinite(r)||r<=0)throw Jd(this._symbol)}return this.typeCheck(e,n),new this.constructor(n)}M.Histogram.prototype.getConcreteTree=LO;M.DotPlot.prototype.getConcreteTree=LO;M.BoxPlot.prototype.getConcreteTree=function(e,t){if(!t[this._symbol])throw Li(this._symbol,e);let n=this.args.map(r=>r.getConcreteTree(e,t));return this.typeCheck(e,n),n.length===1&&(n[0].valueType===ne||n[0].valueType===$e)?new this.constructor(n):z(\"Failed to copmile BoxPlot\")};function O0(e,t){if(!t[this._symbol])throw Li(this._symbol,e);let n=this.args.map(r=>r.getConcreteTree(e,t));return this.typeCheck(e,n),new this.constructor(n)}M.TTest.prototype.getConcreteTree=O0;M.IndependentTTest.prototype.getConcreteTree=O0;M.Stats.prototype.getConcreteTree=O0;M.Table.prototype.getConcreteTree=function(e,t){let n=[];for(let i of this.columns){let o=ga(i)&&ki(i.header)?t[i.header._symbol]:void 0;o&&ha(o)?n.push(o):n.push(i.tryGetConcreteTree(e,t))}let r=1;for(let i of n)i.isList&&(r=Math.max(i.length,r));let s=[];for(let i of n)s.push(eH(i,r));return new M.Table(s,this.calcColumns,this.regression,this.localFrameID)};function eH(e,t){if(Kr(e))return e;if(ha(e))return e;if(e.isList){let n;if(e instanceof lo)n=e.mapElements(r=>r);else if(e instanceof on)n=e.mapElements(r=>r);else return z(`Unexpected parse node type ${e.type} with isList: true`);return new M.TableColumnValue(n,void 0)}else if(e.isTypedConstant){let n=[];for(let r=0;r<t;r++)n.push(e);return new dl(n,void 0)}else return z(`Invalid column: expected an error, constant, or list but got:\n ${e.repr(\"\",1)}`)}M.TableColumn.prototype.getConcreteTree=function(e,t){var r;let n=this.header.tableError();if(n)return KI(n);if(this.header instanceof M.Identifier){let s=t[this.header._symbol];if(s&&t.hasOwnProperty(this.header._symbol)&&Kr(s))return s}if(this.isFreeVariable(t)){if(this.columnIndex===0){let i=this.header._symbol;if(!e.validFirstColumnVariable(i))return eP()}let s=[];for(let i=0;i<this.values.length;i++){if(this.values[i].tableError()){s.push(Zd(this.values[i].tableError()));continue}let o=this.values[i].tryGetConcreteTree(e,t);o.isError?s.push(o):o.tableError()?s.push(Zd(o.tableError())):o.valueType===I||o.valueType===R?s.push(o):s.push(bT([oe(o.valueType)]))}for(let i=0;i<s.length;i++){if(s[i].isError)continue;let o=this.values[i]&&this.values[i].tableError();if(o){s[i]=Zd(o);continue}let a=s[i].getDependencies();a.length&&(s[i]=rn(a).setDependencies(a))}return new dl(s,this.header._symbol)}else{let s=this.header.getConcreteTree(e,t,{coerceToNumber:\"all-except-complex\"});return!s.isError&&s.valueType!==I&&s.valueType!==ne&&s.valueType!==R&&s.valueType!==Ue&&s.valueType!==$e?hT([oe((r=s.valueType)!=null?r:Qt)]):s.getDependencies().length>0?rn(s.getDependencies()).setDependencies(s.getDependencies()):s}};var Ka;function wO(e){Ka=e}function FO(){Ka&&(Ka.cacheHits+=1)}function VO(){Ka&&(Ka.cacheMisses+=1)}function BO(){Ka&&(Ka.cacheWrites+=1)}function GO(){Ka&&(Ka.cacheReads+=1)}var kO={segment:!0,ray:!0,vector:!0,line:!0,circle:!0,arc:!0,polygon:!0,glider:!0,midpoint:!0,intersection:!0,strictintersection:!0,perpendicular:!0,parallel:!0,translate:!0,rotate:!0,dilate:!0,reflect:!0,apply:!0,segments:!0,vertices:!0,angle:!0,angles:!0,directedangle:!0,directedangles:!0,clockwise:!0,counterclockwise:!0,reflex:!0,start:!0,end:!0,anglebisector:!0};function zo(e){switch(e.type){case\"simple\":return;case\"list-access\":return e.listIndex;case\"polygon-edge\":return zo(e.polygon);case\"arbitrary-expression\":return;default:throw new Error(`Unexpected parent type: ${e.type}`)}}function Ta(e){switch(e.type){case\"simple\":case\"list-access\":return e.identifier;case\"polygon-edge\":return Ta(e.polygon);default:throw new Error(`Unexpected parent type: ${e.type}`)}}var Wp={simple:e=>({type:\"simple\",identifier:e}),listAccess:(e,t)=>({type:\"list-access\",identifier:e,listIndex:t}),polygonEdge:(e,t)=>({type:\"polygon-edge\",polygon:{type:\"simple\",identifier:e},edgeIndex:t}),polygonListItemEdge:(e,t)=>({type:\"polygon-edge\",polygon:{type:\"list-access\",identifier:e,listIndex:t.listIndex},edgeIndex:t.edgeIndex}),arbitraryExpression:e=>({type:\"arbitrary-expression\",latex:e.getInputString()})};function tH(e){return e!==void 0&&e in kO}function Gf(e){return tH(e)?e===\"rotate\"||e===\"dilate\"||e===\"translate\"||e===\"reflect\"?!0:!1:!1}function oh(e){if(e instanceof Go&&e.list instanceof we&&e.index instanceof Et)return Wp.listAccess(e.list._symbol,e.index.asValue());if(e instanceof Go&&e.list instanceof Ms&&e.index instanceof Et){let t=e.list.args[0],n=e.list.args[1];if(t instanceof we&&n instanceof we&&n._symbol===\"segments\")return Wp.polygonEdge(t._symbol,e.index.asValue());if(t instanceof Go&&t.list instanceof we&&t.index instanceof Et)return Wp.polygonListItemEdge(t.list._symbol,{listIndex:t.index.asValue(),edgeIndex:e.index.asValue()})}return e.type===\"Identifier\"?Wp.simple(e._symbol):Wp.arbitraryExpression(e)}function ah(e){let t={},n=e;if((n instanceof ja||n instanceof Cr)&&(t.identifier=n._symbol,n=n._expression),n instanceof Go&&n.index instanceof Et&&(t.listAccess=n.index.asValue(),n=n.list),n instanceof gn){let r=n._symbol,s=n.args[0]instanceof we?n.args[0]._symbol:void 0;if(Gf(r)&&e instanceof Cr&&s&&e._argSymbols.some(i=>i===s))t.tree={symbol:r,parents:n.args.slice(1).map(oh)};else if(kO[r])t.tree={symbol:r,parents:n.args.map(oh)};else{let i=Wp.simple(n._symbol);t.tree={symbol:\"apply\",parents:[i,...n.args.map(oh)]}}}else if(n instanceof Ms){let r=n.args.map(oh);r.length===2&&r[1]&&r[1].type===\"simple\"&&r[1].identifier===\"segments\"?t.tree={symbol:\"segments\",parents:[r[0]]}:r.length===2&&r[1]&&r[1].type===\"simple\"&&r[1].identifier===\"start\"?t.tree={symbol:\"start\",parents:[r[0]]}:r.length===2&&r[1]&&r[1].type===\"simple\"&&r[1].identifier===\"end\"&&(t.tree={symbol:\"end\",parents:[r[0]]})}return t}function UO(e,t,n,r,s){let i=se(n,ce)||se(n,ie),o=se(s,ce)||se(s,ie);if(!i&&!o)return;let a=zO(e,t,n),u=zO(e,r,s),c=a.filter(l=>{let p=Ta(l);return p?u.some(f=>ws(l,f))&&!!e.lookup(p):!1});for(let l of a)HO(e,l,r)&&c.every(p=>!ws(l,p))&&c.push(l);for(let l of u)HO(e,l,t)&&c.every(p=>!ws(l,p))&&c.push(l);if(c.length===1)return c[0]}function HO(e,t,n){let r=Ta(t),s=r!==void 0?e.lookup(r):void 0,i=s&&e.getGeometryTree(s);return((i==null?void 0:i.symbol)===\"glider\"||(i==null?void 0:i.symbol)===\"intersection\"||(i==null?void 0:i.symbol)===\"strictintersection\"||(i==null?void 0:i.symbol)===\"midpoint\")&&(i==null?void 0:i.parents.some(o=>{if(o.type===\"arbitrary-expression\")return!1;let a=Ta(o);return a&&e.resolvesTo(a,n)&&(zo(t)===void 0||zo(o)===void 0||zo(o)===zo(t))}))}function zO(e,t,n){var i;let r=[],s=((i=e.getGeometryTree(t))==null?void 0:i.parents)||[];for(let o=0;o<s.length;o++){let a=s[o];if(se(n,ce)&&o===0||a.type===\"arbitrary-expression\"||a.type===\"polygon-edge\")continue;let u=Ta(a);if(!u)continue;let c=e.lookup(u);c&&e.isPointOrListOfPoints(c)&&r.push(a)}return r}function jp(e){if(e.length===0)return $e;if(e.includes(R))return Ue;let t=e[0];if(t!==I&&kn(t,I))for(let n of e){let r=fu(t,n);r!==void 0&&(t=r)}return wn(t)?vn(t):pn}function qO(e){let t=[];for(let n of e)n!==$e&&(j(n)?t.push(Ve(n)):t.push(n));return jp(t)}function uh(e,t){if(j(e)){let n=Ve(e);for(let r=0;r<t.length;r++)if(Br(n,t[r]))return!0;return!1}return Br(e,t)}function Br(e,t){switch(e){case I:return Ii(t);case Gt:return t;case R:case N:{let[n,r]=t;return Ii(n)||Ii(r)}case H:{let[n,r,s]=t;return Ii(n)||Ii(r)||Ii(s)}case Kt:{let[n,r,s]=t;return Ii(n)||Ii(r)||Ii(s)}case xe:{for(let n of t)if(Br(N,n))return!0;return!1}case Hn:{let[n,r]=t;return Br(H,n)||Br(I,r)}case Rn:{let[n,r,s]=t;return Br(H,n)||Br(H,r)||Br(H,s)}case wt:case ke:{let[n,r]=t;return Br(H,n)||Br(H,r)}case de:case fe:case Ne:case le:{let[n,r]=t;return Br(N,n)||Br(N,r)}case ce:{let[n,r]=t;return Br(N,n)||Br(I,r)}case ie:{let[n,r,s]=t;return Br(N,n)||Br(N,r)||Br(N,s)}case Le:case ye:{let[n,r,s]=t;return Br(N,n)||Br(I,r)||Br(I,s)}case ut:return Object.keys(t.updateRules).length===0;case De:case Lt:case ft:case Re:case sr:case or:case ir:case Pr:case Mr:case Er:return!1;case Pn:{let[n,r]=t;return Ii(n)||Ii(r)}default:throw new Error(\"Type cannot contain a NaN value: \"+oe(e)+\".\")}}function po(e,t){return e.pushLeafInstruction(t)}function _n(e,t,n){switch(t.type){case 8:return e.Add(n);case 9:return e.Subtract(n);case 10:return e.Multiply(n);case 11:return e.Divide(n);case 12:return e.Exponent(n);case 13:return e.RawExponent(n);case 14:return e.Negative(n);case 25:return e.Equal(n);case 26:return e.Less(n);case 27:return e.Greater(n);case 28:return e.LessEqual(n);case 29:return e.GreaterEqual(n);case 31:return e.Or(n);case 32:return e.And(n);case 33:return e.Piecewise(n);case 47:return e.BlockVar(t.valueType,n);case 48:return e.BroadcastResult(t.valueType,n);case 15:return e.TupleOfType(t.valueType,n);case 16:return e.Slot(t.index,n);case 37:return e.NativeFunction(t.symbol,n);case 42:return e.Distribution(t.symbol,n);case 21:return e.BeginIntegral(t.callData,n);case 22:return e.EndIntegral(n);case 23:return e.BeginBroadcast(n,t.context);case 24:return e.EndBroadcast(n);case 19:return e.BeginLoop(t.callData,n);case 20:return e.EndLoop(n);case 38:return e.List(n);case 39:return e.ListAccess(n);case 40:return e.DeferredListAccess(n);case 41:return e.InboundsListAccess(n);case 44:return e.ExtendSeed(t.tag,n);case 49:return e.Action(t.symbols,n);case 50:return e.BeginMap(t.callData,n);case 51:return e.EndMap(n);case 53:return e.BeginFunction(n);case 54:return e.EndFunction(n);case 55:return e.FunctionCall(n);default:let r=t;throw new Error(`Unexpected opcode ${r.type}`)}}function $O(e,t,n){let r=e.argNames.indexOf(t);if(r===-1)return 0;let s=ns(e,r,n);return ln(s,e.getReturnIndex())}function ns(e,t,{allowRestriction:n,allowClosedBlockReferences:r}){return{chunk:e,argIndex:t,orderTable:[],mask:Vu(e,t),allowRestriction:n,allowClosedBlockReferences:r}}function ln(e,t){let n=e.orderTable[t];if(n!==void 0)return n;let r=nH(e,t);return e.orderTable[t]=r,r}function nH(e,t){let{chunk:n,mask:r,argIndex:s,allowRestriction:i,allowClosedBlockReferences:o}=e;if(!o&&n.isInClosedBlock(t))return 1/0;if(t===s)return 1;if(!r[t])return 0;let a=n.getInstruction(t);if(es(a)||ds(a))return 1/0;switch(a.type){case 8:case 9:case 26:case 28:case 27:case 29:{let[c,l]=a.args;return Math.max(ln(e,c),ln(e,l))}case 10:{let[c,l]=a.args;return ln(e,c)+ln(e,l)}case 14:return ln(e,a.args[0]);case 11:{let[c,l]=a.args;return ln(e,l)>0?1/0:ln(e,c)}case 12:case 13:{let[c,l]=a.args,p=n.getInstruction(l);if(ln(e,c)===0&&ln(e,l)===0)return 0;if(p.type===1){let f=V(p.value);return f===Math.round(f)&&f>0?ln(e,c)*f:1/0}else return 1/0}case 33:{let c=n.getInstruction(a.args[2]);return i&&c.type===1&&isNaN(V(c.value))?ln(e,a.args[1]):1/0}case 16:case 37:case 2:case 0:case 1:case 25:case 32:case 31:case 15:case 38:case 39:case 40:case 41:case 42:case 48:case 47:case 3:case 44:case 49:case 4:case 55:return 1/0;default:let u=a;throw new Error(`Unexpected opcode ${u.type}`)}}function YO(e,t){let n=e.argNames.indexOf(t),r=e.getReturnIndex(),s=fo(ns(e,n,{allowRestriction:!0,allowClosedBlockReferences:!1}),r);if(ln(s.orderCtx,r)>2)throw new Error(\"Programming Error: cannot compute polynomial coefficients for polynomials of order greater than 2\");let i=Kn(s,r),o=!1;for(let a=0;a<e.instructionsLength();a++)e.getInstruction(a).type===33&&s.mask[a]&&(o=!0);return{chunk:s.newChunk,coefficients:i,mappedArgIndex:s.valueMap[n],mappedReturnIndex:s.valueMap[r],isRestrictedPolynomial:o}}function fo(e,t){let{chunk:n,argIndex:r}=e,s=Vr(n,t);if(n.isInClosedBlock(r))throw new Error(\"Programming Error: cannot find polynomial coefficients of an instruction in a closed block\");let i,o;r>=0&&r<n.argNames.length?(i=n.argNames.slice(),o=n.argTypes.slice(),i.splice(r,1),o.splice(r,1)):(i=n.argNames,o=n.argTypes);let a=new Ia({argNames:i,argTypes:o}),u=[];for(let d=0;d<n.instructionsLength();d++){if(!s[d])continue;let y=n.getInstruction(d);if(y.type===2)d<r||r<0?u[d]=d:d===r?u[d]=a.SymbolicVar(n.argTypes[d]):u[d]=d-1;else if(ge(y))u[d]=po(a,y);else{let g=[];for(let m of y.args)g.push(u[m]);u[d]=_n(a,y,g)}}let c=[],l=a.Constant(0),p=a.Constant(1),f=a.Constant(NaN);return{chunk:n,newChunk:a,orderCtx:e,coefficientTable:c,mask:e.mask,valueMap:u,argIndex:r,zero:l,one:p,nan:f}}function Kn(e,t){let{newChunk:n,orderCtx:r,coefficientTable:s,mask:i,valueMap:o,argIndex:a,zero:u,one:c,nan:l}=e,p=s[t];if(p!==void 0)return p;let f;for(i[t]?t===a?f=[u,c]:ln(r,t)>2?f=[l]:f=rH(e,t):f=[o[t]];f.length>1;){let d=n.getInstruction(f[f.length-1]);if(d.type===1&&V(d.value)===0)f.pop();else break}if(f.length===0)throw new Error(\"Programming Error: coefficients cannot be empty\");return s[t]=f,f}function rH(e,t){let n=e.chunk.getInstruction(t),{newChunk:r}=e;switch(n.type){case 8:{let[i,o]=n.args,a=Kn(e,i),u=Kn(e,o),c=a.length-1,l=u.length-1,p=[];for(let f=0;f<=Math.max(c,l);f++)c>=f&&l>=f?p.push(r.Add([a[f],u[f]])):p.push(c>l?a[f]:u[f]);return p}case 9:case 26:case 28:case 27:case 29:{let[i,o]=n.args;(n.type===26||n.type==28)&&([i,o]=[o,i]);let a=Kn(e,i),u=Kn(e,o),c=a.length-1,l=u.length-1,p=[];for(let f=0;f<=Math.max(c,l);f++)c>=f&&l>=f?p.push(r.Subtract([a[f],u[f]])):p.push(c>l?a[f]:r.Negative([u[f]]));return p}case 14:{let i=n.args[0],o=Kn(e,i),a=[];for(let u=0;u<o.length;u++)a.push(r.Negative([o[u]]));return a}case 10:{let[i,o]=n.args,a=Kn(e,i),u=Kn(e,o),c=a.length-1,l=u.length-1,p=[];for(let f=0;f<=c;f++)for(let d=0;d<=l;d++){if(f+d>2)continue;let y=r.Multiply([a[f],u[d]]),g=p[f+d];g===void 0?p[f+d]=y:p[f+d]=r.Add([g,y])}return p}case 11:{let[i,o]=n.args,a=Kn(e,i),u=Kn(e,o),c=[];for(let l=0;l<a.length;l++)c.push(r.Divide([a[l],u[0]]));return c}case 12:case 13:{let[i,o]=n.args,a=Kn(e,i),u=Kn(e,o);if(a.length-1===0)return[r.RawExponent([a[0],u[0]])];let l=r.getInstruction(u[0]);switch(V(l.value)){case 0:return[r.Constant(1)];case 1:return a;case 2:return[r.Multiply([a[0],a[0]]),r.Multiply([r.Constant(2),r.Multiply([a[0],a[1]])]),r.Multiply([a[1],a[1]])]}}case 33:return Kn(e,n.args[1]);case 37:case 16:case 0:case 23:case 2:case 1:case 25:case 32:case 31:case 15:case 38:case 39:case 40:case 41:case 42:case 21:case 22:case 19:case 20:case 24:case 48:case 47:case 3:case 44:case 49:case 50:case 51:case 4:case 53:case 54:case 55:throw new Error(`Cannot find polynomial coefficients of opcode ${n.type} that depends on symbol.`);default:let s=n;throw new Error(`Unexpected opcode ${s.type}`)}}function XO(e,t,n){let r=e.argNames.indexOf(t);if(r===-1){let o=e.getInstruction(n);return o.type===1?R0(o.valueType,o.value):dr()}let s=ns(e,r,{allowRestriction:!0,allowClosedBlockReferences:!1}),i=sH(s,n);return Ds(i,n)}function sH(e,t){let{chunk:n,mask:r}=e;return{chunk:n,mask:r,orderCtx:e,domainTable:[],index:t}}function Ds(e,t){let{domainTable:n}=e,r=n[t];if(r!==void 0)return r;let s=iH(e,t);return n[t]=s,s}function iH(e,t){let{chunk:n,mask:r,orderCtx:s}=e,i=n.getInstruction(t);switch(i.type){case 1:return R0(i.valueType,i.value);case 3:case 2:return i.valueType===I?aa():dr();case 0:return dr();case 31:return Dd(Ds(e,i.args[0]),Ds(e,i.args[1]));case 32:case 8:case 9:case 10:return Gn(Ds(e,i.args[0]),Ds(e,i.args[1]));case 11:{let o=Gn(Ds(e,i.args[0]),Ds(e,i.args[1])),a=n.getInstruction(i.args[1]);return a.type===1&&a.valueType===I&&V(a.value)!==0?o:Gn(dr(),o)}case 14:return Ds(e,i.args[0]);case 15:{let o=i.valueType;switch(o){case N:case H:return oH(e,i.args);case R:return N0(e,i.args);default:let a=o;throw new Error(`Unexpected tuple type ${a}`)}}case 12:case 13:case 47:case 48:case 16:case 42:case 21:case 22:case 23:case 24:case 19:case 20:case 39:case 40:case 41:case 44:case 50:case 51:case 54:case 55:return N0(e,i.args);case 4:case 53:return dr();case 49:return dr();case 38:return i.args.length===1?Ds(e,i.args[0]):dr();case 25:return dr();case 33:return OD(Ds(e,i.args[0]),Ds(e,i.args[1]),Ds(e,i.args[2]));case 26:case 27:case 28:case 29:{if(!r[t])return aa();let o=Gn(Ds(e,i.args[0]),Ds(e,i.args[1]));if(ln(s,t)>1)return Gn(dr(),o);let a=e.coefficientCtx;a===void 0&&(a=fo(s,e.index),e.coefficientCtx=a);let u=a.newChunk,c=Kn(a,t),[l,p]=c;if(!Je(u.getInstruction(l)))return Gn(dr(),o);let f=hn(u,l);if(isNaN(f))return ka();if(p===void 0)return i.type===28||i.type===29?f>=0?o:ka():f>0?o:ka();{let d=hn(u,p);return Gn(o,Hl(f,d))}}case 37:switch(i.symbol){case\"restriction\":case\"restrictionToBoolean\":return Ds(e,i.args[0]);case\"count\":return aa();default:return Bn[i.symbol].noPeel?dr():N0(e,i.args)}}}function oH(e,t){let n=aa();for(let r of t)n=Gn(n,Ds(e,r));return n}function N0(e,t){let n=dr();for(let r of t)n=Gn(n,Ds(e,r));return n}function R0(e,t){if(j(e))return t.length===1?R0(Ve(e),t[0]):dr();switch(e){case I:case N:case H:return uh(e,t)?ka():aa();case De:return t?aa():ka();default:return dr()}}var kf=[oi(I),oi(I)],A0=[...Pi([[Te,Te],[R,R],[N,I],[I,N],[I,le],[I,ke],[le,I],[ke,I],[H,I],[I,H],[Gt,xf],[xf,Gt]]),kt([Gt,Tf]),kt([Tf,Gt])],_0={Negative:Pi([[Te],[R],[N],[le],[ke],[H]]),Add:Pi([[Te,Te],[R,R],[N,N],[le,le],[ke,ke],[H,H]]),Subtract:Pi([[Te,Te],[R,R],[N,N],[le,le],[ke,ke],[H,H]]),Multiply:A0,DotMultiply:[...Pi([[le,le],[ke,ke],[H,H]]),...A0],CrossMultiply:[...Pi([[ke,ke],[H,H]]),...Pi([[Te,Te],[R,R],[N,I],[I,N],[le,I],[I,le],[ke,I],[I,ke],[Gt,xf],[xf,Gt]]),kt([Gt,Tf]),kt([Tf,Gt])],Divide:Pi([[Te,Te],[R,R],[N,I],[le,I],[ke,I],[H,I]]),Exponent:Pi([[Te,Te],[R,R]]),\"Comparator['=']\":[kt(kf)],\"Comparator['>']\":[kt(kf)],\"Comparator['<']\":[kt(kf)],\"Comparator['>=']\":[kt(kf)],\"Comparator['<=']\":[kt(kf)],ComparatorChain:Pi([{type:\"variadic\",initial:[I,I],rest:I}]),PercentOf:A0,Norm:Pi([[I],[N],[H],[le],[ke]]),ListAccess:[kt([ii,oi(Qn.of([De,I]))])],Integral:Pi([[I,I,Qn.of(ql,{coerceComplexToReal:!1})]])};function Pi(e){return e.map(t=>Ae(t))}function ch(e,t,n){if(t instanceof lo){let r=n.filter(i=>i!==void 0);if(r.length===0)return;let s=jp(r);return j(s)&&s!==pn?Hu([kt({type:\"variadic\",initial:[],rest:Ve(s)})],n):[]}else if(t instanceof gn||t instanceof Gu||t instanceof Ms){let r=t instanceof Ms?t.args[1]._symbol:t._symbol;if(!r)return;let s=Nf(e,r);return s?Hu(s,n):void 0}else if(t instanceof Fr){let[r,s,i]=n,o=s!==void 0&&i!==void 0?Ha(s,i):void 0;!o&&i===I&&t.args[2]instanceof Et&&t.args[2].isNaN()&&(i=void 0);let a;if(o!==void 0)a=o;else if(s!==void 0)a=s;else if(i!==void 0)a=i;else return;j(a)&&(a=Ve(a));let u=wn(a)?oi(a):a;return Hu([kt([oi(De),u,u])],[n[0],s,i])}else if(e.is3dProduct()&&t instanceof _u){let r=[..._0.DotMultiply,Ae([N,N])];return Hu(r,n)}else if(t instanceof ao){let r=[kt({type:\"variadic\",initial:[ut],rest:ut}),Ae([I,I])];return e.is3dProduct()&&r.push(Ae([I,I,I])),Hu(r,n)}else if(t instanceof Ru){let r=[kt({type:\"variadic\",initial:[ut],rest:ut})],s=n.filter(i=>i!==void 0&&i!==I);if(s.length>0){let i=jp(s);j(i)&&i!==pn&&r.push(kt({type:\"variadic\",initial:[],rest:Ve(i)}))}return Hu(r,n)}else if(t instanceof Ho){let r=t.symbol,s;switch(r){case\"x\":case\"y\":s=Pi([[N],[H]]);break;case\"z\":{s=Pi([[H]]);break}default:{let i=r;throw new Error(`Programming Error: unexpected named coordinate: '${i}'.`)}}return Hu(s,n)}else if(t.type in _0&&n.some(r=>r!==void 0)){let r=_0[t.type];return r?Hu(r,n):void 0}}function Hu(e,t){return e.filter(n=>n.matches(t))}function WO(e,t,n,r){if(!JO(e,n,r))return;let s=t.type;switch(s){case\"Comparator['>']\":case\"Comparator['<']\":case\"Comparator['>=']\":case\"Comparator['<=']\":{e.setWarning(E(\"shared-calculator-error-complex-operation-undefined\",{symbol:X(t.operator)}));break}case\"ComparatorChain\":{let[i]=t.symbols;if(i===void 0||i===\"=\")break;e.setWarning(E(\"shared-calculator-error-complex-operation-undefined\",{symbol:X(i)}));break}case\"ParenSeq\":e.setWarning(E(\"shared-calculator-error-complex-point-coordinate\"));break;case\"Integral\":switch(QO(e,n,r)){case 0:e.setWarning(E(\"shared-calculator-error-integral-lower-bound-type-error\",{symbol:oe(e.getInstruction(n[0]).valueType)}));break;case 1:e.setWarning(E(\"shared-calculator-error-integral-upper-bound-type-error\",{symbol:oe(e.getInstruction(n[1]).valueType)}));break;default:break}break;case\"ListAccess\":e.setWarning(E(\"shared-calculator-error-complex-list-access\"));break;case\"CrossMultiply\":case\"DotMultiply\":case\"Multiply\":case\"PercentOf\":if(n.length!==2)break;e.setWarning(E(\"shared-calculator-error-multiply-type-error\",ZO(e,n)));break;case\"Divide\":if(n.length!==2)break;e.setWarning(E(\"shared-calculator-error-divide-type-error\",ZO(e,n)));break;case\"Sum\":case\"Product\":case\"Range\":break;case\"DotAccess\":case\"FunctionCall\":case\"SeededFunctionCall\":break;case\"Comparator['=']\":case\"Add\":case\"Subtract\":case\"Exponent\":case\"Negative\":case\"Or\":case\"Piecewise\":case\"Restriction\":case\"List\":case\"TableColumnValue\":case\"Norm\":case\"BareSeq\":case\"NamedCoordinateAccess\":case\"Ans\":case\"Constant\":case\"ImaginaryUnit\":case\"Assignment\":case\"RecursiveFunctionBaseCase\":case\"MixedNumber\":case\"Identifier\":case\"Construction\":case\"ListComprehension\":case\"FunctionExponent\":case\"FunctionFactorial\":case\"Prime\":case\"Derivative\":case\"UpdateRule\":case\"Substitution\":case\"FunctionDefinition\":case\"Slider\":case\"RegressionParameter\":case\"Seed\":case\"ExtendSeed\":break;default:}}function jO(e,t,n,r,s){if(t===\"sort\"){let i;if(r.length===1)i=r[0];else if(r.length===2)i=r[1];else return;KO(e.getInstruction(i))&&e.setWarning(E(\"shared-calculator-error-complex-sort\",{symbol:X(n)}));return}if(JO(e,r,s))switch(t){case\"factorial\":case\"erf\":case\"nCr\":case\"nPr\":e.setWarning(E(\"shared-calculator-error-complex-operation-unimplemented\",{symbol:X(n)}));break;case\"round\":e.setWarning(E(\"shared-calculator-error-complex-round\",{symbol:X(n)}));break;default:e.setWarning(E(\"shared-calculator-error-complex-operation-undefined\",{symbol:X(n)}));break}}function JO(e,t,n){return QO(e,t,n)!==-1}function QO(e,t,n){if(n.length===0)return-1;let r=n[0];for(let s=0;s<t.length;s++){let i=t[s],o=r.argTypeAtIndex(s);if(!(o===I||o===ne||typeof o==\"object\"&&o.coerceComplexToReal))continue;let u=e.getInstruction(i);if(KO(u))return s}return-1}function KO(e){if(e.type!==1)return!1;switch(e.valueType){case R:return V(e.value[1])!==0;case Ue:return e.value.some(t=>V(t[1])!==0);default:return!1}}function ZO(e,t){let n=e.getInstruction(t[0]),r=e.getInstruction(t[1]);return{symbol1:oe(n.valueType),symbol2:oe(r.valueType)}}function tN(e,t,n,r,s,i){var b,x,T,D;if(n=_g(t,n),!el(n)&&!Tp(n)||Gf(n))return;let o,a=!1,u=!1,c=0,l=[],p=[],f=s.map(P=>e.getInstruction(P).valueType),d=el(n)?Fo[n]:void 0;if(d&&(a=d.isSeeded,o=void 0,l.push(...d.getSignatures(t)),c=(x=(b=d.defaultArguments)==null?void 0:b.length)!=null?x:0,p=lh(l,f,c),u=d.allowDotCall),p.length===0&&(d!=null&&d.fallthroughUnlessDistribution)&&f.length>0&&se(f[0],Lt))l=l.filter(P=>{let C=P.argTypeAtIndex(0);return C===void 0?!1:Mc(Lt,C)}),p=[];else if(Tp(n)&&p.length===0){let P=Bn[n];o=P.tag,l.push(...l0(n)),c=(D=(T=P.defaultArguments)==null?void 0:T.length)!=null?D:0,p=lh(l,f,c),u=u||P.allowDotCall}let y=Math.min(...l.map(P=>P.minArity)),g=Math.max(...l.map(P=>{var C;return(C=P.maxArity)!=null?C:1/0})),m=s,h=s;if(a&&(h=m=s.slice(1),y-=1,g-=1),i){if(!u)throw Bd(r);let P=e.getInstruction(m[0]).valueType;if(!j(P)&&P!==wt&&P!==ke&&P!==Lt&&P!==Pn&&(P===N||!Sd(P))&&n!==\"real\"&&n!==\"imag\")throw tT(r,oe(P),{blockExport:e.areAllArgsConstant([m[0]])});r=\".\"+r,h=m.slice(1),y-=1,g-=1}if((t.isGeometryEnabled()||t.is3dPolicy())&&n===\"length\"&&h.length===1&&j(e.getInstruction(h[0]).valueType)){let P=t.is3dPolicy()?eT:Kx;if(p.length===0)throw P(r,Pa(e,h)[0],{blockExport:e.areAllArgsConstant(h)});if(h.length===1&&e.getInstruction(h[0]).valueType===$e)throw P(r,Pa(e,h)[0],{blockExport:e.areAllArgsConstant(h)})}if(p.length>0){jO(e,n,r,s,p);return}throw L0(e,{symbol:n,errorSymbol:r,providedArgs:h,argsWithoutSeed:m,isDotCall:i,minArity:y,maxArity:g,defaultArgumentCount:c,builtInTag:o,signatures:l})}function L0(e,{symbol:t,errorSymbol:n,providedArgs:r,argsWithoutSeed:s,isDotCall:i,minArity:o,maxArity:a,defaultArgumentCount:u,builtInTag:c,signatures:l}){if(c===\"doubleReducer\"&&r.length===2){if(!j(e.getInstruction(r[0]).valueType)||!j(e.getInstruction(r[1]).valueType))throw Wd(t,{blockExport:e.areAllArgsConstant(r)})}else if(c===\"parameterizedReducer\"&&!i&&r.length===2&&!j(e.getInstruction(r[0]).valueType))throw rP(t,{blockExport:e.areAllArgsConstant([r[0]])});if(t===\"logbase\"&&r.length!==2)return Ao(\"log\",1,r.length-1,{includeUsageExample:!0});if(t===\"random\")return $T();if(r.length<o||r.length>a){let{dotMinArityExampleArgs:g,dotMaxArityExampleArgs:m,minArityExampleArgs:h,maxArityExampleArgs:b}=aH(t),x,T;if(r.length<o?(T=o-u,i&&g?x=n+g:h&&(x=n+h)):(T=a,i&&m?x=n+m:b&&(x=n+b)),i&&(c===\"parameterizedReducer\"||t===\"pdf\"||t===\"cdf\"))return Ao(n,T,r.length,{includeUsageExample:!0,usageExample:x});if(c===\"reducer\"&&r.length===0)return jT(n);if(c===\"doubleReducer\")return Ud(n);if(c===\"parameterizedReducer\")return WT(n);if(c===\"color\")return XT(n);if(el(t))switch(t){case\"pdf\":return HT();case\"cdf\":return r.length<o?zT():UT();case\"tdist\":return qT();case\"length\":case\"round\":case\"floor\":case\"ceil\":case\"abs\":case\"sign\":case\"mod\":case\"gcd\":case\"lcm\":case\"min\":case\"max\":case\"midpoint\":case\"segment\":case\"vector\":case\"sphere\":case\"distance\":case\"circle\":case\"center\":case\"radius\":case\"glider\":case\"intersection\":case\"strictintersection\":case\"parallel\":case\"perpendicular\":case\"anglebisector\":case\"start\":case\"end\":case\"angle\":case\"directedangle\":case\"angles\":case\"directedangles\":case\"apply\":case\"translate\":case\"reflect\":case\"dilate\":case\"rotate\":case\"normaldist\":case\"poissondist\":case\"binomialdist\":case\"uniformdist\":case\"total\":case\"mean\":case\"median\":case\"stdev\":case\"stdevp\":case\"var\":case\"varp\":case\"covp\":case\"cov\":case\"corr\":case\"mad\":case\"quantile\":case\"sort\":case\"shuffle\":case\"join\":case\"unique\":case\"polygon\":case\"coterminal\":case\"real\":case\"imag\":case\"conj\":case\"exp\":case\"sin\":case\"cos\":case\"tan\":case\"sinh\":case\"cosh\":case\"tanh\":case\"sec\":case\"csc\":case\"cot\":case\"sech\":case\"csch\":case\"coth\":case\"arccot\":case\"arcsinh\":case\"arccsch\":case\"arctan\":case\"nthroot\":case\"complexNthRoot\":return eN(n,T,l,r.map(P=>e.getInstruction(P).valueType),x);case\"points\":case\"lines\":case\"circles\":case\"polygons\":case\"rays\":case\"vectors\":case\"arcs\":throw ks(n);case\"histogram\":case\"dotplot\":case\"boxplot\":case\"ttest\":case\"ittest\":case\"stats\":case\"det\":case\"inv\":case\"transpose\":case\"rref\":case\"trace\":throw z(`Unexpected arity error for ${t}`);default:let D=t;throw new Error(`Unexpected compiler function ${D}`)}return eN(n,T,l,r.map(D=>e.getInstruction(D).valueType),x)}if(t===\"polygon\"&&r.length===2&&e.getInstruction(r[0]).valueType===I&&e.getInstruction(r[1]).valueType===I)return zd();let p=[],f=[];for(let g=0;g<s.length;g++){let m=s[g],h=c!==void 0&&c!==\"doubleReducer\"&&c!==\"never-broadcast\"&&!(c===\"parameterizedReducer\"&&g===0)&&t!==\"polygon\",b=e.getInstruction(m).valueType;j(b)&&h&&(b=Ve(b)),p.push(b),f.push(oe(b))}let d=e.areAllArgsConstant(s),y=nN(t);if(y&&!rN(t,l,p)){let g=new v(y);return d?g:g.allowExport()}return Hs(n,f,{blockExport:d})}function eN(e,t,n,r,s){let i=nN(e);return i&&!rN(e,n,r)?new v(i):Ao(e,t,r.length,{includeUsageExample:!i,usageExample:s})}function aH(e){return el(e)?Fo[e]:Tp(e)?Bn[e]:{}}function lh(e,t,n){return e.filter(r=>r.matches(t)&&t.length+n>=r.minArity)}function nN(e){switch(e){case\"midpoint\":return E(\"shared-calculator-error-required-arguments-midpoint\");case\"intersection\":return E(\"shared-calculator-error-required-arguments-intersection\");case\"segment\":case\"line\":case\"ray\":case\"distance\":return E(\"shared-calculator-error-required-arguments-points\",{symbol:e,count:2});case\"parallel\":case\"perpendicular\":return E(\"shared-calculator-error-required-arguments-perpendicular\",{symbol:e});case\"circle\":return E(\"shared-calculator-error-required-arguments-circle\");case\"arc\":case\"angle\":case\"directedangle\":return E(\"shared-calculator-error-required-arguments-points\",{symbol:e,count:3});case\"triangle\":return E(\"shared-calculator-error-required-arguments-triangle\");case\"polygon\":return E(\"shared-calculator-error-required-arguments-polygon\");case\"glider\":return E(\"shared-calculator-error-required-arguments-glider\");case\"vector\":return E(\"shared-calculator-error-required-arguments-vector\");case\"length\":return E(\"shared-calculator-error-required-arguments-length\");case\"area\":case\"perimeter\":case\"vertices\":case\"angles\":case\"directedangles\":case\"segments\":return E(\"shared-calculator-error-required-arguments-area\",{symbol:e});case\"radius\":case\"center\":return E(\"shared-calculator-error-required-arguments-radius\",{symbol:e});case\"anglebisector\":case\"coterminal\":return E(\"shared-calculator-error-required-arguments-coterminal\",{symbol:e});case\"supplement\":return E(\"shared-calculator-error-required-arguments-supplement\");case\"start\":case\"end\":return E(\"shared-calculator-error-required-arguments-start\",{symbol:e});case\"dilate\":case\"rotate\":return E(\"shared-calculator-error-required-arguments-dilate\",{symbol:e});case\"reflect\":return E(\"shared-calculator-error-required-arguments-reflect\");case\"translate\":return E(\"shared-calculator-error-required-arguments-translate\");case\"sphere\":return E(\"shared-calculator-error-required-arguments-sphere\")}}function rN(e,t,n){return e===\"polygon\"&&(t=t.filter(s=>s.maxArity!==1)),t.some(s=>s.maxArity===0||n.length<s.minArity?!1:n.every((i,o)=>{let a=s.argTypeAtIndex(o);return a===void 0?!0:ny(i,a)}))}function Pa(e,t){let n=[];for(let r of t)n.push(oe(e.getInstruction(r).valueType));return n}function zu(e,t){let n=[];for(let r of t){let s=e.getInstruction(r).valueType,i=j(s)?Ve(s):s;n.push(oe(i))}return n}function gt(e,t,n){return se(e.getInstruction(t).valueType,n)}function Uo(e,t,n,r){var l,p;let s=n.type;if(s===\"FunctionCall\"||s===\"SeededFunctionCall\"||s===\"DotAccess\"){let f,d;if(n instanceof Ms&&(n.args[1]instanceof we||n.args[1]instanceof gn))f=n.args[1]._symbol,d=(l=n.args[1]._errorSymbol)!=null?l:f;else if(n instanceof gn||n instanceof Gu)f=n._symbol,d=(p=n._errorSymbol)!=null?p:f;else return;if(f===\"polygon\"&&t.polygonUnsupportedPreferTriangle())throw ky();if(f===\"length\"&&!t.isGeometryEnabled()&&!t.is3dPolicy()&&r.length===0)throw ZT();tN(e,t,f,d,r,n instanceof Ms);return}let i=r.map(f=>e.getInstruction(f).valueType),o=ch(t,n,i);if(!o)return;let a=Math.min(...o.map(f=>f.minArity));if(o.length>0&&r.length>=a){WO(e,n,r,o);return}let u=uH(s,i,{specifyPointDimensions:n instanceof Ho&&n.symbol===\"z\"}),c=e.areAllArgsConstant(r);switch(s){case\"Add\":throw Fx(u,{blockExport:c});case\"Subtract\":throw Vx(u,{blockExport:c});case\"CrossMultiply\":throw t.is3dProduct()&&i.length===2&&(se(i[0],N)&&se(i[1],N)||se(i[0],I)&&se(i[1],H)||se(i[0],H)&&se(i[1],I))?Bx(u,{blockExport:c}):Fd(u,{blockExport:c});case\"DotMultiply\":throw Fd(u,{blockExport:c});case\"Multiply\":{if(t.is3dProduct()&&i.length===2){if(se(i[0],H)&&se(i[1],H))throw kx(u,{blockExport:c});if(se(i[0],N)&&se(i[1],N))throw Gx(u,{blockExport:c})}throw Fd(u,{blockExport:c})}case\"Divide\":throw Hx(u,{blockExport:c});case\"Exponent\":throw zx(u,{blockExport:c});case\"Negative\":throw Ux(u,{blockExport:c});case\"Comparator['=']\":case\"Comparator['>']\":case\"Comparator['<']\":case\"Comparator['>=']\":case\"Comparator['<=']\":case\"ComparatorChain\":throw Yx(u,{blockExport:c});case\"Or\":throw Zx(u,{blockExport:c});case\"Piecewise\":throw se(i[0],De)?gT([oe(e.getInstruction(r[1]).valueType),oe(e.getInstruction(r[2]).valueType)],{blockExport:e.areAllArgsConstant([r[1],r[2]])}):fy(u,{blockExport:e.areAllArgsConstant([r[0]])});case\"Restriction\":throw fy(u,{blockExport:c});case\"List\":case\"TableColumnValue\":{sN(e,r);break}case\"ListAccess\":throw Vd(u,{blockExport:c});case\"Norm\":throw Hs(\"abs\",u,{blockExport:c});case\"ParenSeq\":{let f=i.indexOf(ut)!==-1,d=i.some(g=>g!==ut);if(f&&d)throw yy([oe(i[0]),oe(i[1])],{blockExport:c});if(i.length!==2&&(!t.is3dProduct()||i.length!==3)){let g=t.is3dPolicy()?3:2;throw KT(g)}let y=i.find(g=>!se(g,I));throw y!==void 0?Wx(oe(y),{blockExport:c}):z(\"Unexpected error type checking ParenSeq\")}case\"BareSeq\":{if(i.length===0)throw $d();if(i.length===1)throw z(\"Length-1 BareSeq is impossible\");let f=i[0],d=i.find(y=>y!==f);if(d)throw yy([oe(f),oe(d)],{blockExport:c});if(f===I)throw r.length===2?JT():QT();sN(e,r);break}case\"NamedCoordinateAccess\":throw jx(u,\".\"+n.symbol,{blockExport:c});case\"Integral\":{let[f,d,y]=i,g=j(f)?Ve(f):f,m=j(d)?Ve(d):d;throw kn(g,I)?kn(m,I)?pT([oe(y)],{blockExport:c}):lT([oe(d)],{blockExport:c}):cT([oe(f)],{blockExport:c})}case\"Ans\":case\"Constant\":case\"ImaginaryUnit\":case\"Assignment\":case\"RecursiveFunctionBaseCase\":case\"MixedNumber\":case\"Identifier\":case\"Construction\":case\"Range\":case\"Sum\":case\"Product\":case\"ListComprehension\":case\"FunctionExponent\":case\"FunctionFactorial\":case\"Prime\":case\"Derivative\":case\"UpdateRule\":case\"Substitution\":case\"FunctionDefinition\":case\"Slider\":case\"RegressionParameter\":case\"Seed\":case\"ExtendSeed\":case\"PercentOf\":return;default:{let f=s;throw new Error(`Unexpected node type: ${f}`)}}}function sN(e,t){if(t.length===0)return;let n=e.getInstruction(t[0]).valueType;if(!wn(n))throw vc([oe(n)],{blockExport:Je(e.getInstruction(t[0]))});let r=e.areAllArgsConstant(t);for(let s of t){let i=e.getInstruction(s).valueType;if(!wn(i))throw vc([oe(i)],{blockExport:r});if(i!==n)throw kd({blockExport:r})}}function uH(e,t,n){switch(e){case\"Add\":case\"Subtract\":case\"Multiply\":case\"Divide\":case\"Exponent\":case\"Negative\":case\"Comparator['<']\":case\"Comparator['>']\":case\"Comparator['=']\":case\"Comparator['<=']\":case\"Comparator['>=']\":case\"NamedCoordinateAccess\":return t.map(r=>oe(r,n));case\"ComparatorChain\":{for(let r=0;r<t.length;r++)if(!kn(t[r],I)&&!kn(t[r],ne))return r===0?[oe(t[r]),oe(t[r+1])]:[oe(t[r-1]),oe(t[r])];return t.map(r=>oe(r))}case\"ListAccess\":case\"Constant\":case\"ImaginaryUnit\":case\"MixedNumber\":case\"Identifier\":case\"Ans\":case\"List\":case\"TableColumnValue\":case\"Range\":case\"Construction\":case\"ParenSeq\":case\"BareSeq\":case\"Norm\":case\"Sum\":case\"Product\":case\"Integral\":case\"ListComprehension\":case\"FunctionExponent\":case\"FunctionFactorial\":case\"Prime\":case\"Piecewise\":case\"Restriction\":case\"Derivative\":case\"UpdateRule\":case\"Substitution\":case\"Assignment\":case\"RecursiveFunctionBaseCase\":case\"FunctionDefinition\":case\"Slider\":case\"RegressionParameter\":case\"Seed\":case\"ExtendSeed\":case\"DotMultiply\":case\"CrossMultiply\":case\"Or\":case\"PercentOf\":return t.map(r=>oe(r));default:{let r=e;throw new Error(`Unexpected node type: ${r}`)}}}function iN(e,t){let n=e.getInstruction(t);if(ge(n))return;let r=kt(w0(e,n).expectedTypes);if(n.type===49){for(let u of n.args){let c=e.getInstruction(u).valueType;if(!se(c,I)&&!se(c,R)&&!se(c,N)&&!se(c,H)&&!se(c,Kt)&&!se(c,xe)&&!se(c,de)&&!se(c,fe)&&!se(c,Ne)&&!se(c,le)&&!se(c,ce)&&!se(c,ie)&&!se(c,Le)&&!se(c,Pn)&&!se(c,ye))throw ET(oe(c))}let a={};for(let u of n.symbols){if(a[u])throw CT(u);a[u]=!0}return}let s=[];for(let a=0;a<n.args.length;a++){let u=e.getInstruction(n.args[a]).valueType,c=r.argTypeAtIndex(a);(c===void 0||!Mc(u,c))&&s.push(n.args[a])}if(s.length===0)return;let i=Pa(e,n.args),o=e.areAllArgsConstant(n.args);switch(n.type){case 32:throw Xx(i,{blockExport:o});case 22:case 21:case 44:case 31:case 15:case 16:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 25:case 26:case 27:case 28:case 29:case 38:case 39:case 40:case 41:case 37:case 42:case 33:case 48:case 47:case 23:case 24:case 19:case 20:case 50:case 51:case 53:case 54:case 55:throw z(`Invalid argument types for opcode ${n.type}`);default:{let a=n;throw new Error(`Unexpected opcode: ${a.type}`)}}}function w0(e,t,n=!1){switch(t.type){case 8:case 9:case 10:case 11:return n&&t.args.length>0&&e.getInstruction(t.args[0]).valueType===N?{expectedTypes:[N,N]}:{expectedTypes:[I,I]};case 12:case 13:case 25:case 26:case 27:case 28:case 29:return{expectedTypes:[I,I]};case 14:return{expectedTypes:[I]};case 31:return{expectedTypes:[De,De]};case 32:return{expectedTypes:[De,De]};case 33:return{expectedTypes:[De,t.valueType,t.valueType]};case 15:return{expectedTypes:zl[t.valueType]};case 21:return{expectedTypes:[I,I]};case 22:{let r=e.getInstruction(t.args[1]).valueType;return $l(r)?{expectedTypes:[I,r]}:{expectedTypes:[I,I]}}case 38:{let r=t.valueType,s=Ve(r);return{expectedTypes:{type:\"variadic\",initial:[],rest:s}}}case 39:case 40:case 41:return{expectedTypes:[pn,I]};case 37:{let r=t.symbol,s=Bn[r],i=s.argumentTypes;return s.tag===\"reducer\"&&!cH(e,t.args)&&Array.isArray(i)&&typeof i[0]==\"number\"&&j(i[0])?{isReducerWithNoListArgs:!0,expectedTypes:{type:\"variadic\",initial:[],rest:Ve(i[0])}}:{expectedTypes:i}}case 44:{let r=e.getInstruction(t.args[1]).valueType;return{expectedTypes:[ft,r]}}case 47:return{expectedTypes:t.args.map(r=>e.getInstruction(r).valueType)};case 23:return{expectedTypes:[I]};case 19:return{expectedTypes:t.args.map(r=>{let s=e.getInstruction(r).valueType;return s===De||(t.callData.type===\"sum\"?$l(s):bx(s))?s:I})};case 50:{let r=t.callData.parameterSymbols.length,s=[];for(let i=0;i<r;i++)s.push(I,I);return{expectedTypes:s}}case 24:case 20:case 51:{let r=[I];for(let s=1;s<t.args.length;s++)r.push(e.getInstruction(t.args[s]).valueType);return{expectedTypes:r}}case 42:return{expectedTypes:t.args.map(()=>I)};case 48:case 49:return{expectedTypes:t.args.map(r=>e.getInstruction(r).valueType)};case 53:return{expectedTypes:[t.valueType]};case 54:return{expectedTypes:t.args.map(r=>e.getInstruction(r).valueType)};case 55:return{expectedTypes:t.args.map(r=>e.getInstruction(r).valueType)};case 16:return{expectedTypes:[hx]};default:{let r=t;throw new Error(`Unexpected opcode: ${r.type}`)}}}function cH(e,t){for(let n of t)if(j(e.getInstruction(n).valueType))return!0;return!1}function oN(e){let t=e.getReturnIndex(),n=e.getInstruction(t);if(ge(n))return t;let r=w0(e,n),s=kt(r.expectedTypes),i=F0(e,n.args,[s]);if(r.isReducerWithNoListArgs){let o=pH(e,i.didCoerce?i.args:n.args),a=vn(r.expectedTypes.rest);if(_i(o,a)){i.didCoerce?e.replaceInstructionWithNoop(t):e.popInstruction();let u=e.List(n.args);return e.copyInstructionWithArgs(n,[u])}}else i.didCoerce&&(e.replaceInstructionWithNoop(t),e.copyInstructionWithArgs(n,i.args));return e.getReturnIndex()}function F0(e,t,n){let r=!1,s=[];for(let i=0;i<t.length;i++){let o=Rd(n,i),a=t[i],u=e.getInstruction(a).valueType,c=a;o.every(l=>!_i(u,l))&&(se(o[0],I)?c=zi(e,a):se(o[0],R)&&(c=lH(e,a))),c!==a&&(r=!0),s.push(c)}return r?{didCoerce:r,args:s}:{didCoerce:!1}}function zi(e,t,n={}){var s;let r=e.getInstruction(t);return r.valueType===$e?t:se(r.valueType,Le)?uN(e,t):se(r.valueType,ye)?aN(e,t):se(r.valueType,Gt)?e.Piecewise([e.NativeFunction(\"restrictionToBoolean\",[t]),e.Constant(1),e.Constant(NaN)]):se(r.valueType,R)?(s=n.peelableCoerce)!=null&&s?e.NativeFunction(\"peelableCoerceComplexToReal\",[t]):e.NativeFunction(\"coerceComplexToReal\",[t]):t}function fl(e,t){let n=e.getInstruction(t);return n.valueType===$e||se(n.valueType,R)?t:zi(e,t)}function lH(e,t){let n=e.getInstruction(t);if(n.valueType===$e)return t;if(se(n.valueType,I))return e.NativeFunction(\"coerceRealToComplex\",[t]);if(se(n.valueType,R))return t;if(kn(n.valueType,I)||kn(n.valueType,ne)){let r=zi(e,t);return e.NativeFunction(\"coerceRealToComplex\",[r])}return t}function pH(e,t){let n=e.getInstruction(t[0]).valueType;if(!wn(n))return pn;for(let r of t)if(e.getInstruction(r).valueType!==n)return pn;return vn(n)}function ph(e,t,n){let r=e.getInstruction(n);if(!ge(r)){for(let o of r.args)if(!Je(e.getInstruction(o)))return!0}if(t<n)return!Je(e.getInstruction(t));let s=[!0];for(let o=n+1;o<=t;o++)s.push(!1);let i=[t];for(;i.length;){let o=i.pop();if(s[o-n])continue;s[o-n]=!0;let a=e.getInstruction(o);if(!ge(a))for(let u of a.args){let c=e.getInstruction(u);if(u<n){let l=e.getInstruction(u);if(l.type===4)continue;if(!Je(l))return!0}else{if(e.getInstruction(u).type===50)return!0;if(c.type===3)return!0;s[u-n]||i.push(u)}}}return!1}function qo(e,t,n){let r=qn(e,t);if(r===void 0)throw new Error(`${n}\nNon-constant instruction: \"${al(e,ur(e,t))}\"`);return r}function qn(e,t){let n=ml(e,t,void 0,void 0);if(!(n<0))return n}function ml(e,t,n,r){var a;let s=n&&n[t];if(s)return s;let i=e.getInstruction(t),o;switch(i.type){case 38:o=i.args.length;break;case 1:o=i.value.length;break;case 48:{o=(a=i.constantLength)!=null?a:-1;break}}return o===void 0&&(n=n||{},o=dH(e,i,n,r||new Set)),n&&(n[t]=o),o}function dH(e,t,n,r){switch(t.type){case 33:{let s=ml(e,t.args[1],n,r),i=ml(e,t.args[2],n,r);return s===i?s:-1}case 37:switch(t.symbol){case\"elementsAt\":return ml(e,t.args[1],n,r);case\"sortPerm\":case\"complexSortPerm\":return ml(e,t.args[0],n,r);case\"shuffle\":return ml(e,t.args[1],n,r);default:return-1}case 55:{if(r&&r.has(t.args[0]))return-1;r.add(t.args[0]);let s=e.dereferenceFunctionHeader(t.args[0]);if(s!==void 0){let i=e.getInstruction(s);return ml(e,i.args[1],n,r)}return-1}default:{if(j(t.valueType))return-1;throw new Error(`Programming Error: cannot find the list length of ${ts(t.type)} ${oe(t.valueType)}.`)}}}function ur(e,t){let n=e.getInstruction(t);if(!j(n.valueType))throw new Error(`Programming Error: cannot find the list length of ${e.printInstruction(t)}`);switch(n.type){case 38:return e.Constant(n.args.length);case 1:return e.Constant(n.value.length);case 48:{let r=e.getInstruction(n.args[0]);return e.getInstruction(r.args[0]).args[0]}case 37:switch(n.symbol){case\"elementsAt\":return ur(e,n.args[1]);case\"sortPerm\":case\"complexSortPerm\":return ur(e,n.args[0]);case\"shuffle\":return ur(e,n.args[1])}}return e.NativeFunction(\"count\",[t])}function Jp(e,t){let n=[];for(let o of t)j(e.getInstruction(o).valueType)&&n.push(o);if(n.length===0)return;if(n.length===1)return ur(e,n[0]);let r=[];for(let o of n)r.push(qn(e,o));let s,i=1/0;for(let o=0;o<r.length;o++){let a=n[o],u=r[o];if(u===void 0)return e.NativeFunction(\"listMin\",[e.List(n.map(c=>ur(e,c)))]);u<i&&(s=a,i=u)}return s!==void 0?ur(e,s):e.Constant(i)}function Hf(e,t,n){let r=e.getInstruction(t);if(j(r.valueType)){let s=qn(e,t);if(n=Math.floor(n),isNaN(n)||n<0||s!==void 0&&n>=s){let i=Ve(r.valueType);return e.NanOfType(i)}return r.type===38?r.args[n]:r.type===1&&j(r.valueType)?e.ConstantOfType(Ve(r.valueType),r.value[n]):s!==void 0?e.InboundsListAccess([t,e.Constant(n+1)]):e.ListAccess([t,e.Constant(n+1)])}else throw new Error(`Cannot access elements of ${oe(r.valueType)}`)}function dh(e,t,n){let r=e.getInstruction(t);if(n.length===0)return e.ConstantOfType(r.valueType,[]);if(r.type===1&&j(r.valueType)){let s=[],i=Ve(r.valueType);for(let o of n){let a=Math.floor(o);isNaN(a)||a<0||a>=qo(e,t,\"Programming error: expected Constant list instruction to have constant length.\")?s.push(ls(i)):s.push(r.value[a])}return e.ConstantOfType(r.valueType,s)}else if(r.type===38){let s=[];for(let i of n){let o=Math.floor(i);if(isNaN(o)||o<0||o>=qo(e,t,\"Programming error: expected List instruction to have constant length.\")){let a=Ve(r.valueType);s.push(e.NanOfType(a))}else s.push(r.args[o])}return e.List(s)}else{let s=[],i=!0,o=qn(e,t);for(let u of n){let c=Math.floor(u);s.push(e.Constant(c+1)),(isNaN(c)||c<0||o===void 0||c>=o)&&(i=!1)}let a=[t,e.List(s)];return i?e.InboundsListAccess(a):e.ListAccess(a)}}function Gr(e,t){let n=e.getInstruction(t);if(n.type!==48)return t;let r=n.args[0],s=e.getInstruction(r),i=s.args[0],o=!1;for(let u=i+1;u<r;u++){let c=e.getInstruction(u);if(c.type===40&&c.args[1]===i){o=!0;break}}if(!o)return t;let a=[];for(let u=i;u<=r+s.args.length-1;u++){let c=e.getInstruction(u);if(ge(c))a.push(e.copyInstruction(c));else{let l=[];for(let p of c.args)l.push(p>=i?a[p-i]:p);c.type===40?a.push(e.InboundsListAccess(l)):a.push(e.copyInstructionWithArgs(c,l))}}return e.getReturnIndex()}function V0(e,t){return!an(e)&&isNaN(e)||!an(t)&&isNaN(t)?[NaN,NaN]:[e,t]}function fh(e){return zt(V(e[0]),V(e[1]))}function cN([e,t]){return an(e)&&an(t)}function lN(e,t){if(!cN(e)||!cN(t))return Du(fh(e),fh(t));let[n,r]=e,[s,i]=t,o=qs(wr(s,s),wr(i,i)),a=qs(wr(n,s),wr(r,i)),u=ai(wr(r,s),wr(n,i)),c=Ps(a,o),l=Ps(u,o);return!an(c)||!an(l)?Du(fh(e),fh(t)):V0(c,l)}function B0(e,t,n){let r;return mh(t)?r=k0(t,n):r=dN(t,n),e.ConstantOfType(t,r)}function G0(e){return mh(e)||pN(e)}function mh(e){switch(e){case $e:case ne:case Xn:case Ue:case Gs:case Pt:case xn:case Wn:case Fn:case Vn:case Jn:case jn:case In:case On:case Nn:case fr:case gr:case yr:case Ar:case mr:case rr:case cs:case Rr:return!0;default:return!1}}function pN(e){switch(e){case I:case De:case R:case Gt:case N:case de:case ce:case ie:case Ne:case le:case fe:case xe:case Le:case ye:case H:case ke:case Rn:case Hn:case wt:case Kt:case Pn:case Re:case ut:case ft:return!0;default:return!1}}function k0(e,t){if(e===$e)return[];let n=Ve(e);if(!pN(n))throw new Error(`Programming error: unexpected element type ${at(n)} for list type ${at(e)}.`);let r=[];for(let s=0;s<t.length;s++){let i=dN(n,t[s]);r.push(i)}return r}function dN(e,t){if(e===I)return Se(t,1);if(e===N||e===R){let[n,r]=t;return[Se(n,1),Se(r,1)]}else if(e===H){let[n,r,s]=t;return[Se(n,1),Se(r,1),Se(s,1)]}else return t}function H0(e,t){return qs(e,t)}function z0(e,t){return ai(e,t)}function U0(e,t){return wr(e,t)}function q0(e,t){return Ps(e,t)}function zf(e,t){return V(e)===Math.E?Math.exp(V(t)):Zv(e,t)}var mH=zf;function $0(e){return Us(e)}function yH(e,t){return t[e]}function Y0(e,t){return V(e)===V(t)}function X0(e,t){return V(e)<V(t)}function Z0(e,t){return V(e)>V(t)}function W0(e,t){return V(e)<=V(t)}function j0(e,t){return V(e)>=V(t)}function mN(e,t){return e||t}function yN(e,t){return e&&t}function gH(e,t,n){let r=Math.floor(V(n))-1;return!isFinite(r)||r<0||r>=t.length?ls(e):t[r]}function J0(e,t,n,r){an(r)&&(r=V(r));let s=n===I||n===ft?r:LE(n,r);return`${t}::${e}${s}`}function Q0(e,t){switch(e){case\"mod\":return jv(t[0],t[1]);case\"abs\":return Yv(t[0]);case\"sqrt\":return Wv(t[0]);case\"total\":return Jv(t[0]);case\"count\":return t[0].length;case\"validateRangeLength\":{let n=t[0],r=t[1],s=t[2],i=t[3],o=zE(n,r,s,i);if(o===0)throw jd();return o}case\"validateSampleCount\":{let n=Vo(t[0]),r=UE(n);if(r===0&&n!==0)throw IP();return r}case\"select\":case\"elementsAt\":case\"uniquePerm\":{let n=Bn[e];return Gi[n.symbol].apply(null,t)}case\"complex\":return V0(t[0],t[1]);case\"complexDivide\":return lN(t[0],t[1]);default:{let n=Bn[e];return(n.module===\"Math\"?Math:Gi)[n.symbol].apply(null,Vo(t))}}}function gN(e,t){let n=Array(t+1);return St(e,t,n)}function hN(e,t,n){let r=Array(t+1);for(let s=0;s<n.length;s++)r[s]=n[s];return St(e,t,r)}function bN(e,t,n){if(t.constantLength)return t.constantLength;let r=t.args[0],i=e.getInstruction(r).args[0],o=e.getInstruction(i);return V(St(e,o.args[0],n))}function xN(e,t,n,r){let s=e.getInstruction(t),i=bN(e,s,r);if(!isFinite(n)||n<0||n>=i)return ls(Ve(s.valueType));let o=s.args[0],a=t-o,u=e.getInstruction(o),c=u.args[0],l=u.args[a];r[c]=n+1;let p=St(e,l,r);for(let f=c;f<=o;f++)r[f]=void 0;return p}function hH(e,t,n){let r=e.getInstruction(t),s=r.args[0],i=e.getInstruction(s).args[0];if(xH(e,i+1,s-1)&&mh(r.valueType)){let u=e.copy(),c=Qp(u);return k0(r.valueType,c)}let o=bN(e,r,n),a=[];for(let u=o-1;u>=0;u--)a[u]=xN(e,t,u,n);return a}function TN(e,t,n){let r=St(e,t.args[1],n),s=t.args[0],i=e.getInstruction(s);if(i.type===48)return xN(e,s,V(r)-1,n);if(i.type===33){let o=St(e,i.args[0],n);return TN(e,{...t,args:[o?i.args[1]:i.args[2],t.args[1]]},n)}else{let o=St(e,t.args[0],n);return gH(t.valueType,o,r)}}function St(e,t,n){let r=n[t];if(r!==void 0)return r;let s=bH(e,t,n);return typeof s==\"number\"&&s===Math.floor(s)&&(s=Se(s,1)),n[t]=s,s}function bH(e,t,n){let r=e.getInstruction(t);switch(r.type){case 1:return r.value;case 8:return H0(St(e,r.args[0],n),St(e,r.args[1],n));case 9:return z0(St(e,r.args[0],n),St(e,r.args[1],n));case 10:return U0(St(e,r.args[0],n),St(e,r.args[1],n));case 11:return q0(St(e,r.args[0],n),St(e,r.args[1],n));case 12:return zf(St(e,r.args[0],n),St(e,r.args[1],n));case 13:return mH(St(e,r.args[0],n),St(e,r.args[1],n));case 14:return $0(St(e,r.args[0],n));case 15:return r.args.map(i=>St(e,i,n));case 16:return yH(r.index,St(e,r.args[0],n));case 25:return Y0(St(e,r.args[0],n),St(e,r.args[1],n));case 26:return X0(St(e,r.args[0],n),St(e,r.args[1],n));case 27:return Z0(St(e,r.args[0],n),St(e,r.args[1],n));case 28:return W0(St(e,r.args[0],n),St(e,r.args[1],n));case 29:return j0(St(e,r.args[0],n),St(e,r.args[1],n));case 31:return St(e,r.args[0],n)||St(e,r.args[1],n);case 32:return St(e,r.args[0],n)&&St(e,r.args[1],n);case 44:return J0(r.tag,St(e,r.args[0],n),e.getInstruction(r.args[1]).valueType,St(e,r.args[1],n));case 33:return St(e,r.args[0],n)?St(e,r.args[1],n):St(e,r.args[2],n);case 37:{let i=[];for(let o of r.args)i.push(St(e,o,n));return Q0(r.symbol,i)}case 38:{let i=[];for(let o of r.args)i.push(St(e,o,n));return i}case 39:case 40:case 41:return TN(e,r,n);case 48:return hH(e,t,n);case 47:{let i=r.args[0],o=t-i,u=e.getInstruction(i).args[o],c=fN(e,{endIndex:i,returnIndex:u,resultIndex:t},n);return Qp(c)}case 55:{let i=r.args[0],a=e.getInstruction(i).endIndex,c=e.getInstruction(a).args[0],l=fN(e,{endIndex:a,returnIndex:c,resultIndex:t},n);return Qp(l)}case 19:case 20:case 21:case 22:case 23:case 24:case 42:case 0:case 2:case 3:case 49:case 50:case 51:case 4:case 53:case 54:throw new Error(`Programming Error: cannot interpret opcode ${r.type}`);default:let s=r;throw new Error(`Programming Error: unexpected opcode ${s.type}`)}}function fN(e,t,n){let r=t.endIndex,s=t.returnIndex,i=t.resultIndex,o=e.getInstruction(r).args[0],a=[];a[s]=!0;let u=s;e.getInstruction(i).type===55&&(a[i]=!0,u=i);for(let d=u;d>=o;d--){if(!a[d])continue;let y=e.getInstruction(d);if(!ge(y))for(let g of y.args)g<o||g>r?St(e,g,n):a[g]=!0}let l=e.copy();l.unsafelyTruncate(o);for(let d=0;d<o;d++){let y=n[d],g=e.getInstruction(d);if(y!==void 0){let m=g.valueType;l.replaceInstructionWithConstant(d,{type:1,valueType:m,value:y})}}l.reopenAllBlocks();let p=[];for(let d=o;d<i;d++){let y=e.getInstruction(d);if(ge(y))p.push(l.copyInstruction(y));else{let g=[];for(let m of y.args)g.push(m<o?m:p[m-o]);y.type===40?p.push(l.InboundsListAccess(g)):p.push(l.copyInstructionWithArgs(y,g))}}l.Noop();let f=e.getInstruction(i);if(f.type===47)l.replaceInstructionWithBlockVarOrFunctionCall(l.getReturnIndex(),{type:47,valueType:f.valueType,args:[r<o?r:p[r-o]]});else if(f.type===55)l.replaceInstructionWithBlockVarOrFunctionCall(l.getReturnIndex(),{type:55,valueType:f.valueType,args:f.args.map(d=>d<o?d:p[d-o])});else throw new Error(`Programming error: unexpected opcode ${ts(f.type)}`);return l}function xH(e,t,n){let r=[];for(let i=0;i<=t;i++)r.push(!1);let s=[];for(let i=t+1;i<=n;i++)s.push(i);for(;s.length;){let i=s.pop();if(r[i])continue;r[i]=!0;let o=e.getInstruction(i);if(o.type===55)return!0;if(!ge(o))for(let a of o.args)r[a]||s.push(a)}return!1}function Qp(e){let t=e.getCompiledFunction();return t.executionMetadata.recursiveFunctionCache=new up,t.executionMetadata.iterativeRecursionOutputs={},t.fn()}function PN(e){if(e.instructionsLength()-1!==e.getReturnIndex())throw new Error(\"Programming Error: only the final instruction in a chunk can be constant collapsed\");let t=e.getInstruction(e.getReturnIndex());if(ge(t))return e.getReturnIndex();switch(t.type){case 8:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.Constant(H0(r.value,s.value))):r.type===1&&V(r.value)===0?(e.popInstruction(),t.args[1]):s.type===1&&V(s.value)===0?(e.popInstruction(),t.args[0]):e.getReturnIndex()}case 9:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.Constant(z0(r.value,s.value))):r.type===1&&V(r.value)===0?(e.popInstruction(),e.Negative([t.args[1]])):s.type===1&&V(s.value)===0?(e.popInstruction(),t.args[0]):e.getReturnIndex()}case 10:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.Constant(U0(r.value,s.value))):r.type===1&&V(r.value)===1?(e.popInstruction(),t.args[1]):s.type===1&&V(s.value)===1?(e.popInstruction(),t.args[0]):e.getReturnIndex()}case 11:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.Constant(q0(r.value,s.value))):s.type===1&&V(s.value)===1?(e.popInstruction(),t.args[0]):e.getReturnIndex()}case 12:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);if(r.type===1&&s.type===1)return e.popInstruction(),e.Constant(zf(r.value,s.value));if(r.type===1&&r.valueType===I){let i=V(r.value);if(i===Math.E)return e.popInstruction(),e.NativeFunction(\"exp\",[t.args[1]]);if(i>0)return e.popInstruction(),e.RawExponent(t.args)}if(s.type===1&&s.valueType===I){let i=V(s.value);if(i===1)return e.popInstruction(),t.args[0];if(i===Math.floor(i))return e.popInstruction(),e.RawExponent(t.args);if(an(s.value)){let{n:o,d:a}=s.value;if(a%2===1){e.popInstruction();let u=e.RawExponent([e.NativeFunction(\"abs\",[t.args[0]]),t.args[1]]);return o%2===0?u:e.Multiply([e.NativeFunction(\"sign\",[t.args[0]]),u])}}}return e.getReturnIndex()}case 13:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.Constant(zf(r.value,s.value))):s.type===1&&V(s.value)===1?(e.popInstruction(),t.args[0]):e.getReturnIndex()}case 14:{let r=e.getInstruction(t.args[0]);return r.type===1?(e.popInstruction(),e.Constant($0(r.value))):e.getReturnIndex()}case 25:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,Y0(r.value,s.value))):e.getReturnIndex()}case 26:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,X0(r.value,s.value))):e.getReturnIndex()}case 27:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,Z0(r.value,s.value))):e.getReturnIndex()}case 28:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,W0(r.value,s.value))):e.getReturnIndex()}case 29:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,j0(r.value,s.value))):e.getReturnIndex()}case 31:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,mN(r.value,s.value))):r.type===1?(e.popInstruction(),r.value?t.args[0]:t.args[1]):s.type===1?(e.popInstruction(),s.value?t.args[1]:t.args[0]):e.getReturnIndex()}case 32:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return r.type===1&&s.type===1?(e.popInstruction(),e.ConstantOfType(De,yN(r.value,s.value))):r.type===1?(e.popInstruction(),r.value?t.args[1]:t.args[0]):s.type===1?(e.popInstruction(),s.value?t.args[0]:t.args[1]):e.getReturnIndex()}case 33:{let r=e.getInstruction(t.args[0]);return r.type===1?(e.popInstruction(),r.value?t.args[1]:t.args[2]):e.getReturnIndex()}case 16:{let r=e.getInstruction(t.args[0]),s=t.index;return r.type===15?(e.popInstruction(),r.args[s]):r.type===1?(e.popInstruction(),e.ConstantOfType(t.valueType,r.value[s])):e.getReturnIndex()}case 38:case 15:{if(IN(e,t.args)){e.popInstruction();let r=[];for(let s of t.args)r.push(e.getInstruction(s).value);return e.ConstantOfType(t.valueType,r)}return e.getReturnIndex()}case 39:case 41:{let r=t.args[0],s=e.getInstruction(r),i=e.getInstruction(t.args[1]),o=qn(e,r);if(o===0)return e.popInstruction(),e.NanOfType(t.valueType);if(s.type===33&&i.type===1){let a=t.type===39?e.ListAccess([s.args[1],t.args[1]]):e.InboundsListAccess([s.args[1],t.args[1]]),u=t.type===39?e.ListAccess([s.args[2],t.args[1]]):e.InboundsListAccess([s.args[2],t.args[1]]);return e.Piecewise([s.args[0],a,u])}if(s.type===48){e.popInstruction();let a=s.args[0],u=r-a,c=e.getInstruction(a),l=c.args[0],p,f;if(t.type===41)p=t.args[1];else if(i.type===1&&i.valueType===I&&o!==void 0){let y=V(i.value),g=Math.floor(y);if(g<1||g>o)return e.NanOfType(t.valueType);p=y===g?t.args[1]:e.Constant(g)}else{let y=e.Constant(1),m=e.getInstruction(l).args[0],h=e.NativeFunction(\"floor\",[t.args[1]]),b=e.GreaterEqual([h,y]),x=e.LessEqual([h,m]);p=e.Piecewise([b,e.Piecewise([x,h,m]),y]),f={one:y,lengthIndex:m,roundedIndex:h,greaterEqualIndex:b,lessEqualIndex:x}}if(c.args[u]<l)return c.args[u];let d=[p];for(let y=l+1;y<=c.args[u];y++){let g=e.getInstruction(y);if(ge(g))d.push(e.copyInstruction(g));else{let m=[];for(let h of g.args)m.push(h>=l?d[h-l]:h);g.type===40?d.push(e.InboundsListAccess(m)):d.push(e.copyInstructionWithArgs(g,m))}}if(f){let{greaterEqualIndex:y,lessEqualIndex:g,lengthIndex:m,one:h}=f,b=Ve(s.valueType),x=e.NanOfType(b),T=d[d.length-1],D=e.And([e.And([y,g]),e.GreaterEqual([m,h])]);return e.Piecewise([D,T,x])}else return d[d.length-1]}else if(i.type===1&&i.valueType===I)if(s.type===38){e.popInstruction();let a=Math.floor(V(i.value))-1;return isNaN(a)||a<0||a>=s.args.length?e.NanOfType(t.valueType):s.args[a]}else if(s.type===1){e.popInstruction();let a=Math.floor(V(i.value))-1;return isNaN(a)||a<0||a>=s.value.length?e.NanOfType(t.valueType):e.ConstantOfType(Ve(s.valueType),s.value[a])}else return e.getReturnIndex();else return e.getReturnIndex()}case 47:{let r=e.getInstruction(t.args[0]);if(!ds(r)||ph(e,e.getReturnIndex(),r.args[0]))return e.getReturnIndex();if(G0(t.valueType)){let s=e.copy(),i=Qp(s);return e.popInstruction(),B0(e,t.valueType,i)}else throw new Error(`Constant collapsing a block with return type ${oe(t.valueType)} is not implemented.`)}case 55:{let r=e.dereferenceFunctionHeader(t.args[0]);if(r===void 0||!IN(e,t.args.slice(1))||ph(e,r,t.args[0]))return e.getReturnIndex();if(G0(t.valueType)){let s=e.copy(),i=Qp(s);return e.popInstruction(),B0(e,t.valueType,i)}else throw new Error(`Constant collapsing a function call with return type ${oe(t.valueType)} is not implemented.`)}case 37:{let r=IH(e,t.args);if(r!==void 0)return e.popInstruction(),e.ConstantOfType(t.valueType,Q0(t.symbol,r));switch(t.symbol){case\"complexPow\":{let s=e.getInstruction(t.args[1]);if(s.type===1&&s.valueType===R){let[i,o]=s.value;if(V(i)===1&&V(o)===0)return e.popInstruction(),t.args[0]}return e.getReturnIndex()}case\"count\":{let s=qn(e,t.args[0]);return s!==void 0?(e.popInstruction(),e.Constant(s)):e.getReturnIndex()}case\"select\":{let s=qn(e,t.args[0]);if(s!==void 0&&Je(e.getInstruction(t.args[1]))){e.popInstruction();let i=hn(e,t.args[1]),o=[];for(let a=0;a<Math.min(s,i.length);a++)i[a]&&o.push(a);return dh(e,t.args[0],o)}else return e.getReturnIndex()}case\"shuffle\":{let s=t.args[0],i=t.args[1],o=qn(e,i);if(o!==void 0&&Je(e.getInstruction(s))){e.popInstruction();let a=FE(hn(e,s),o);return dh(e,i,a)}else return e.getReturnIndex()}case\"elementsAt\":{let s=t.args[0],i=t.args[1];if(Je(e.getInstruction(i))){e.popInstruction();let o=hn(e,i);return dh(e,s,o)}return e.getReturnIndex()}case\"restrictionToBoolean\":{let s=e.getInstruction(t.args[0]);return Je(s)?(e.popInstruction(),e.ConstantOfType(De,s.value)):s.type===37&&s.symbol===\"restriction\"?(e.popInstruction(),s.args[0]):e.getReturnIndex()}default:return e.getReturnIndex()}}case 44:{let r=e.getInstruction(t.args[0]),s=e.getInstruction(t.args[1]);return Je(r)&&Je(s)?e.ConstantOfType(ft,J0(t.tag,hn(e,t.args[0]),s.valueType,hn(e,t.args[1]))):e.getReturnIndex()}case 48:{let r=e.getReturnIndex(),s=qn(e,r);if(s!==void 0&&s===0)return e.popInstruction(),e.ConstantOfType(t.valueType,[]);let i=t.args[0],o=e.getInstruction(i),a=o.args[0],u=r-i,c=o.args[u];if(!ph(e,c,a)){if(t.valueType===Zn){if(s==null)throw rf(fs(e,r));let f=[];for(let d=0;d<s;d++){let y=e.InboundsListAccess([r,e.Constant(d+1)]);f.push(y)}return e.List(f)}let p=gN(e,r);e.popInstruction(),e.ConstantOfType(t.valueType,p)}return r}case 49:{for(let s of t.args)if(!Je(e.getInstruction(s)))return e.getReturnIndex();e.popInstruction();let r={};for(let s=0;s<t.symbols.length;s++){let i=t.symbols[s],o=e.getInstruction(t.args[s]);if(o.type===48&&(o=e.getInstruction(Gr(e,t.args[s]))),o.type!==1)throw new Error(\"Expected instruction to be constant\");let{valueType:a,value:u}=o;uh(a,u)||(r[i]={value:u,valueType:a})}return e.ConstantOfType(ut,{type:\"Action\",updateRules:r})}case 20:case 22:case 23:case 24:case 40:case 42:case 21:case 19:case 50:case 51:case 53:case 54:return e.getReturnIndex();default:let n=t;throw new Error(`Unexpected opcode ${n.type}`)}}function IN(e,t){for(let n of t){let r=e.getInstruction(n);if(!Je(r))return!1}return!0}function IH(e,t){let n=[];for(let r of t){let s=e.getInstruction(r);if(Je(s))n.push(s.value);else return}return n}function EN(e){if(e.instructionsLength()-1!==e.getReturnIndex())throw new Error(\"Programming Error: only the final instruction in a chunk can be converted to broadcast\");let t=e.getInstruction(e.getReturnIndex());if(ge(t))return e.getReturnIndex();switch(t.type){case 8:case 9:case 10:case 11:case 12:case 13:case 25:case 26:case 27:case 28:case 29:case 31:case 32:case 15:case 14:case 33:case 16:return yl(e,t);case 42:return Gr(e,yl(e,t));case 37:{let r=Bn[t.symbol];switch(r.tag){case\"default\":case\"trig\":case\"trig2\":case\"inverseTrig\":case\"color\":return yl(e,t);case\"never-broadcast\":{let s=[],i=!1;for(let o of t.args){let a=Gr(e,o);a!==o?(i=!0,s.push(a)):s.push(o)}return i?e.copyInstructionWithArgs(t,s):e.getReturnIndex()}case\"reducer\":if(PH(e,t.args))if(t.args.length===1){let s=t.args[0],i=Gr(e,s);return i!==s?e.copyInstructionWithArgs(t,[i]):e.getReturnIndex()}else return yl(e,t);else return e.getReturnIndex();case\"doubleReducer\":{if(t.args.length!==2)throw new Error(\"Programming error: double reducers must have two arguments\");let s=Gr(e,t.args[0]),i=Gr(e,t.args[1]);return s!==t.args[0]||i!==t.args[1]?e.copyInstructionWithArgs(t,[s,i]):e.getReturnIndex()}case\"parameterizedReducer\":{if(t.args.length!==2)throw new Error(\"Programming error: double reducers must have two arguments\");let s=Gr(e,t.args[0]);return s===t.args[0]?yl(e,t,[!1,!0]):e.copyInstructionWithArgs(t,[s,t.args[1]])}default:{let s=r.tag;throw new Error(`Programming Error: unexpected tag ${s}`)}}}case 39:case 40:case 41:return yl(e,t,[!1,!0]);case 55:{let s=e.getInstruction(t.args[0]).signature.argTypes.map(a=>!j(a)),i=[t.args[0]],o=!1;for(let a=1;a<t.args.length;a++){let u=t.args[a],c=Gr(e,u);c!==u?(o=!0,i.push(c)):i.push(u)}return o?e.copyInstructionWithArgs(t,i):yl(e,t,[!1,...s])}case 21:case 22:case 19:case 20:case 50:case 51:return e.getReturnIndex();case 38:case 47:case 23:case 24:case 48:case 44:case 49:case 53:case 54:return e.getReturnIndex();default:let n=t;throw new Error(`Unexpected opcode ${n.type}`)}}function PH(e,t){for(let n of t)if(j(e.getInstruction(n).valueType))return!0;return!1}function yl(e,t,n){let r=t.args,s=!1,i=[];for(let d=0;d<r.length;d++){if(n&&!n[d])continue;let y=r[d],g=e.getInstruction(y).valueType;j(g)&&i.indexOf(y)===-1&&i.push(y),g===$e&&(s=!0)}if(i.length===0)return e.getReturnIndex();if(t.type===33&&i.indexOf(t.args[0])==-1&&i.indexOf(t.args[1])>=0&&i.indexOf(t.args[2])>=0){let d=Gr(e,t.args[1]),y=Gr(e,t.args[2]);return d!==t.args[1]||y!==t.args[2]?_n(e,t,[t.args[0],d,y]):e.getReturnIndex()}e.popInstruction();let o=Jp(e,i);if(o===void 0)throw new Error(\"Programming Error: expected minListLength to be defined for \"+i.length+\" lists\");let a=o;if(Je(e.getInstruction(a))&&hn(e,a)===0&&s)return e.ConstantOfType($e,[]);let u=e.BeginBroadcast([a],{type:\"implicit\"}),c=[];for(let d of i)c.push(Ea(e,d,u));let l=[];for(let d=0;d<r.length;d++){let y=r[d];if(n&&!n[d])l.push(y);else{let g=i.indexOf(y);l.push(g===-1?y:c[g])}}let p=e.copyInstructionWithArgs(t,l),f=e.EndBroadcast([u,p]);return e.BroadcastResult(vn(e.getInstruction(p).valueType),[f])}function Ea(e,t,n){return e.getInstruction(t).type==48?e.DeferredListAccess([t,n]):e.InboundsListAccess([t,n])}function CN(e){let t=e.getReturnIndex(),n=Vr(e,t),r=e.getInstruction(t);if(r.type!==48)return e;let s=r.args[0],i=t-s,o=e.getInstruction(s),a=o.args[0],u=o.args[i],c=[],l=[];c.push(a);let p=qo(e,e.getReturnIndex(),\"Programming error: cannot optimize regression on non-constant-length list\");l.push({range:p-1,length:p});let f=!1,d=!1;for(let C=a+1;C<=u;C++){if(!n[C])continue;let S=e.getInstruction(C);if(es(S)||ds(S))return e;if(S.type===39||S.type===41||S.type===40){if(S.args[1]!==a)continue;let O=S.args[0];if(e.getInstruction(O).valueType!==ne||!Je(e.getInstruction(O)))continue;let _=hn(e,O),L=CH(_);if(!isFinite(L.range))continue;c.push(C),l.push(L)}else MN(S)?f=!0:(S.type===12||S.type===13)&&(d=!0)}if(c.length===0||!d&&!f)return e;let y=[],g=[];for(let C=0;C<e.argNames.length;C++)g.push(C),y.push(aa());let m=[],h=[];for(let C=0;C<=u;C++)m.push(K0(e,g,m,C)),h.push(K0(e,c,h,C));for(let C=0;C<=u;C++){if(!n[C])continue;let S=e.getInstruction(C);if(S.type===33){let O=m[C];for(let _=0;_<O.length;_++)if(O[_])return e}else if(S.type===12||S.type===13){let O=!1,_=!1;for(let K=0;K<c.length;K++)h[S.args[0]][K]&&(O=!0),h[S.args[1]][K]&&(_=!0);if(O||!_)continue;let L=m[S.args[0]],w=0,U;for(let K=0;K<L.length;K++)L[K]&&(U=K,w+=1);if(w!==1||U===void 0)continue;let G=g[U],Z=ns(e.copy().reopenFinalBlock(),G,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(Z,S.args[0])!==1)continue;let F=fo(Z,S.args[0]),[Y,re]=Kn(F,S.args[0]);if(re===void 0)continue;let Ee=hn(F.newChunk,re),he=hn(F.newChunk,Y);y[U]=Gn(y[U],Hl(he,Ee))}}if(f){let C=e.copy().reopenFinalBlock();for(let S=0;S<c.length;S++){let O=ns(C,c[S],{allowRestriction:!1,allowClosedBlockReferences:!1}),_=fo(O,u);for(let L=a+1;L<=u;L++){if(!n[L])continue;let w=C.getInstruction(L);if(MN(w)){let U=w.args[0];if(ln(O,U)!==1)continue;let G=Kn(_,U)[1];if(G===void 0)continue;let Z=MH(_.newChunk,G),F,Y=0;for(let me=0;me<Z.length;me++)Z[me]&&(F=me,Y+=1);if(Y!==1||F===void 0)continue;let re=ns(_.newChunk,F,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(re,G)!==1)continue;let Ee=fo(re,G),[he,K]=Kn(Ee,G);if(K===void 0||!Je(Ee.newChunk.getInstruction(he))||!Je(Ee.newChunk.getInstruction(K)))continue;let Oe=hn(Ee.newChunk,he),te=hn(Ee.newChunk,K),Ze=SH(l[S]),dt=DH(l[S]);if(!isFinite(Ze)||Ze<=0||!isFinite(dt)||dt<0||Ze<=dt)continue;y[F]=Gn(y[F],Gn(Hl(-dt+Oe,te),Hl(Ze-Oe,-te)))}}}}let b=!1;for(let C of y){if(Fs(C)||!hi(C))return e;(C.bounds[0]!==-1/0||C.bounds[1]!==1/0)&&(b=!0)}if(!b)return e;let x=e.copy(),T=x.Constant(1),D=x.Constant(NaN),P=t;for(let C=0;C<x.argNames.length;C++)P=EH(x,y[C],P,C,T,D);return x.fuseBroadcast(),x}function EH(e,t,n,r,s,i){if(Fs(t)||!hi(t)||t.bounds[0]===-1/0&&t.bounds[1]===1/0)return n;let o=e.And([e.LessEqual([e.Constant(t.bounds[0]),r]),e.LessEqual([r,e.Constant(t.bounds[1])])]);return e.Multiply([n,e.Piecewise([o,s,i])])}function MH(e,t){let n=[];for(let s=0;s<e.argNames.length;s++)n.push(s);let r=[];for(let s=0;s<=t;s++)r.push(K0(e,n,r,s));return r[t]}function MN(e){return e.type===37&&(e.symbol===\"sin\"||e.symbol===\"cos\")}function CH(e){let t=1/0,n=-1/0,r=e.length;for(let s of e)t=Math.min(t,s),n=Math.max(n,s);return{range:n-t,length:r}}function DH({range:e}){return 1e-5/e}function SH({range:e,length:t}){let n=e/Math.min(t-1,31);return Math.PI/n}function K0(e,t,n,r){let s=e.getInstruction(r),i=vH(t.length);for(let o=0;o<t.length;o++)if(t[o]===r)return i[o]=!0,i;if(ge(s))return i;for(let o of s.args){let a=n[o];for(let u=0;u<a.length;u++)i[u]=i[u]||a[u]}return i}function vH(e){let t=[];for(let n=0;n<e;n++)t.push(!1);return t}var RN=tM({sin:Dn(\"isinf(x) || isnan(x) ? NaN : dcg_isPiMultiple(abs(x)) ? 0.0 : sin(x)\"),cos:Dn(\"isinf(x) || isnan(x) ? NaN : dcg_isOddHalfPiMultiple(abs(x)) ? 0.0 : cos(x)\"),tan:ci(pe`float a=abs(x);\n    return isinf(x) || isnan(x) ? NaN\n      : dcg_isPiMultiple(a) ? 0.0\n      : dcg_isOddHalfPiMultiple(a) ? Infinity\n      : tan(x);`),cot:ci(pe`float a=abs(x);\n      return isinf(x) || isnan(x) ? NaN\n        : a < 0.03 ? 1.0/x - x/3.0\n        : dcg_isPiMultiple(a) ? Infinity\n        : dcg_isOddHalfPiMultiple(a) ? 0.0\n        : 1.0 / tan(x);`),sec:Dn(\"isinf(x) || isnan(x) ? NaN : dcg_isOddHalfPiMultiple(abs(x)) ? Infinity: 1.0 / cos(x)\"),csc:ci(pe`float a=abs(x);\n      return isinf(x) || isnan(x) ? NaN\n        : a < 0.03 ? 1.0/x + x/6.0\n        : dcg_isPiMultiple(a) ? Infinity\n        : 1.0 / sin(x);`),arcsin:ci(pe`if (isinf(x) || isnan(x)) { return NaN; }\n    if (x == 1.0) { return dcg_PI/2.0; }\n    if (x == -1.0) { return -dcg_PI/2.0; }\n    if (x > 1.0 || x < -1.0) return NaN;\n    float y0 = asin(x);\n    return y0 + (x - sin(y0)) / cos(y0);`),arccos:ci(pe`if (isinf(x) || isnan(x)) { return NaN; }\n    if (x == 1.0) { return 0.0; }\n    if (x == -1.0) { return dcg_PI; }\n    if (x > 1.0 || x < -1.0) return NaN;\n    float y0 = acos(x);\n    return y0 + (cos(y0) - x) / sin(y0);`),arctan:Uf(pe`isnan(x) || isnan(y) ? NaN\n      : isinf(x) && isinf(y) ?\n        (y > 0.0 ? 0.25 : 0.75) * sign(x) * dcg_PI\n      : x == 0.0 && y == 0.0 ? y\n      : atan(x, y)\n    `),arccot:Dn(\"isnan(x) ? NaN : dcg_PI/2.0 - atan(x)\"),arcsec:Dn(\"isnan(x) ? NaN : dcg_arccos(1.0/x)\"),arccsc:Dn(\"isnan(x) ? NaN : dcg_arcsin(1.0/x)\"),sinh:Dn(\"isinf(x) ? x : isnan(x) ? NaN : sinh(x)\"),cosh:Dn(\"isinf(x) ? Infinity : isnan(x) ? NaN : cosh(x)\"),tanh:Dn(\"abs(x) > 10.0 ? sign(x) : isnan(x) ? NaN : tanh(x)\"),coth:Dn(\"abs(x) > 10.0 ? sign(x) : isnan(x) ? NaN : x == 0.0 ? Infinity : abs(x) < 0.03 ? 1.0/x + x/3.0 : 1.0/tanh(x)\"),sech:Dn(\"isinf(x) ? 0.0 : isnan(x) ? NaN : 1.0/cosh(x)\"),csch:Dn(\"isinf(x) ? 0.0 : isnan(x) ? NaN : x == 0.0 ? Infinity : abs(x) < 0.03 ? 1.0/x - x/6.0 : 1.0/sinh(x)\"),arcsinh:ci(pe`float a=abs(x);\n      return isnan(x) ? NaN : sign(x) * (\n        1.0 + x * x == 1.0\n          ? dcg_log1p(a)\n          : log(a + dcg_rtxsqpone(a))\n      );`),arccosh:Dn(\"x < 1.0 || isnan(x) ? NaN : log(x + dcg_rtxsqmone(x))\"),arctanh:ci(pe`if (isnan(x) || abs(x) > 1.0) { return NaN; }\n      if (x == 1.0) { return Infinity; }\n      if (x == -1.0) { return -Infinity; }\n      float y0 = 0.5*(dcg_log1p(x) - dcg_log1p(-x));\n      float c = cosh(y0);\n      return y0 + (x - tanh(y0)) * c * c;`),arccoth:Dn(\"isnan(x) ? NaN : abs(x) >= 1.0 ? dcg_arctanh(1.0/x) : NaN\"),arcsech:Dn(\"isnan(x) ? NaN : 0.0 < x && x <= 1.0 ? dcg_arccosh(1.0/x) : x == 0.0 ? Infinity : NaN\"),arccsch:Dn(\"isinf(x) ? 0.0 : isnan(x) ? NaN : dcg_arcsinh(1.0/x)\"),sinpiSeries:ci(pe`float xsq = x*x;\n    return x*(dcg_PI-xsq*(5.167708-xsq*(2.549761-xsq*0.5890122)));`),sinpi:ci(pe`if (isnan(x) || isinf(x)) { return NaN; }\n    if (x==0.0) { return x; }\n    if (x == floor(x)) { return x > 0.0 ? 0.0 : -0.0; }\n    int i = int(dcg_round(2.0*x));\n    float t = -0.5 * float(i) + x;\n    float s = bool(i & 2) ? -1.0 : 1.0;\n    float y = bool(i & 1) ? cos(dcg_PI * t) : dcg_sinpiSeries(t);\n    return s*y;`),sincpi:Dn(\"isnan(x) ? NaN : isinf(x) ? 0.0 : x == 0.0 ? 1.0 : dcg_sinpi(x)/(dcg_PI*x);\"),sqrt:Dn(\"isnan(x) ? NaN : x >= 0.0 ? sqrt(x) : NaN\"),rtxsqpone:Dn(\"dcg_hypot(x, 1.0)\"),rtxsqmone:ci(\"float t = x*x; return isnan(x) || t < 1.0 ? NaN : t - 1.0 == t ? abs(x) : sqrt(t - 1.0);\"),hypot:AN(pe`if (isnan(x) || isnan(y)) return NaN;\n      if (isinf(x) || isinf(y)) return Infinity;\n      x = abs(x);\n      y = abs(y);\n      float m = max(x,y);\n      x /= m;\n      y /= m;\n      return m == 0.0 ? 0.0 : sqrt(x*x + y*y) * m;`),min:Uf(pe`isnan(x) || isnan(y) ? NaN : min(x, y)`),max:Uf(pe`isnan(x) || isnan(y) ? NaN : max(x, y)`),log:Dn(\"isnan(x) ? NaN : x > 0.0 ? log(x)*0.4342944819 : x == 0.0 ? -Infinity : NaN\"),logbase:Uf(pe`isnan(x) || isnan(y) ? NaN\n      : y == 1.0 ?\n        (\n          x > 1.0 ? Infinity\n          : x == 1.0 ? NaN\n          : x < 0.0 ? NaN\n          : -Infinity\n        )\n      : y > 0.0 ?\n        (\n          x > 0.0 ? log(x)/log(y)\n          : x == 0.0 && !isinf(y) ? -Infinity\n          : NaN\n        )\n      : NaN`),ln:Dn(\"isnan(x) ? NaN : x > 0.0 ? log(x) : x == 0.0 ? -Infinity : NaN\"),exp:Dn(\"isnan(x) ? NaN : exp(x)\"),floor:Dn(\"isnan(x) ? NaN : floor(x)\"),ceil:Dn(\"isnan(x) ? NaN : ceil(x)\"),round:Dn(\"isinf(x) || isnan(x) ? x : floor(0.5 + x)\"),abs:Dn(\"isnan(x) ? NaN : abs(x)\"),sign:Dn(\"isnan(x) ? NaN : sign(x)\"),mod:Uf(\"isinf(x) || isinf(y) || isnan(x) || isnan(y) || y == 0.0 ? NaN : mod(x, y)\"),stirlingPrefactor:kr(\"float\",\"float x, float y\",pe`if (isnan(x) || isnan(y)) { return NaN; }\n    return pow(x/exp(1.0), y);`),stirlerrSeries:ci(pe`float S0 = 0.083333336;\n    float S1 = 0.0027777778;\n    float S2 = 0.0007936508;\n    float nn = x*x;\n    return (S0-(S1-S2/nn)/nn)/x;`),factorialAsymptotic:Dn(\"dcg_stirlingPrefactor(x,x)*sqrt(2.0*dcg_PI*x)*exp(dcg_stirlerrSeries(x))\"),factorialMinimax:ci(pe`float n1 = 2.1618295;\n    float n2 = 1.5849807;\n    float n3 = 0.4026814;\n    float d1 = 2.2390451;\n    float d2 = 1.6824219;\n    float d3 = 0.43668285;\n\n    float n = 1.0 + x*(n1 + x*(n2 + x*n3));\n    float d = 1.0 + x*(d1 + x*(d2 + x*d3));\n    float xp1 = x+1.0;\n\n    return dcg_stirlingPrefactor(xp1,x)*sqrt(xp1)*(n/d);\n    `),factorialPositive:Dn(pe`(x>33.0)?Infinity:(x>8.0)?dcg_factorialAsymptotic(x):dcg_factorialMinimax(x);`),factorial:ci(pe`if (isnan(x) || (isinf(x) && x < 0.0)) { return NaN; }\n    bool isInteger = x == floor(x);\n    if (x < 0.0) {\n      if (isInteger) return Infinity;\n      return 1.0 / (dcg_sincpi(x) * dcg_factorialPositive(-x));\n    }\n    float approx = dcg_factorialPositive(x);\n    return isInteger ? dcg_round(approx) : approx;`),distance:kr(\"float\",\"vec2 a, vec2 b\",pe`\n      if (any(isnan(a)) || any(isnan(b))) return NaN;\n      vec2 d = a-b;\n      return dcg_hypot(d.x, d.y);`),distanceThreeD:kr(\"float\",\"vec3 a, vec3 b\",pe`\n      if (any(isnan(a)) || any(isnan(b))) return NaN;\n      vec3 d = a-b;\n      return dcg_hypot(dcg_hypot(d.x, d.y), d.z);`),hsv:kr(\"vec3\",\"float h, float s, float v\",pe`if (isnan(h) || isnan(s) || isnan(v)) {discard;}\n      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      if (isinf(h)) h = 0.0;\n      vec3 p = abs(fract(h / 360.0 + K.xyz) * 6.0 - K.www);\n      return vec3(clamp(v, 0.0, 1.0) * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), clamp(s, 0.0, 1.0)));`),rgb:kr(\"vec3\",\"float r, float g, float b\",pe`if (isnan(r) || isnan(g) || isnan(b)) {discard;}\n    return clamp(vec3(r,g,b),0.0,255.0)/255.0;`),erf:ci(pe`if (isnan(x)) return NaN;\n      float t = abs(x);\n      float n = x*x;\n      float r = -n;\n      return sign(x) * (\n        r < -750.0\n          ? 1.0\n          : t >= 0.065\n          ? 1.0 - exp(r) * (\n            t > 50000000.0\n              ? r / t\n              : t > 50.0\n              ? (r * (n * (n + 4.5) + 2.0)) / (t * (n * (n + 5.0) + 3.75))\n              : ((0.9999999999999999+t*(2.224574423459406+t*(2.444115549920689+\n                t*(1.7057986861852539+t*(0.8257463703357973+\n                  t*(0.28647031042892007+t*(0.07124513844341643+\n                    t*(0.012296749268608364+t*(0.001347817214557592+\n                      0.00007263959403471071*t))))))))\n                )/(1.0+t*(3.352953590554884+t*(5.227518529742423+\n                  t*(5.003720878235473+t*(3.266590890998987+\n                    t*(1.5255421920765353+t*(0.5185887413188858+\n                      t*(0.12747319185915415+t*(0.02185979575963238+\n                        t*(0.0023889438122503674+0.00012875032817508128*t\n                ))))))))))\n              )\n          )\n          : t*(1.1283791670955126+r*(0.37612638903183754+\n              r*(0.11283791670955126+r*(0.026866170645131252+\n                0.005223977625442188*r))))\n      );`),restriction:kr(\"bool\",\"bool x\",\"return x;\"),restrictionToBoolean:kr(\"bool\",\"bool x\",\"return x;\"),complex:kr(\"vec2\",\"float u, float v\",pe`if (isnan(u) || isnan(v)) { return vec2(NaN, NaN); }\n    return vec2(u,v);`),real:kr(\"float\",\"vec2 c\",\"return c.x;\"),imag:kr(\"float\",\"vec2 c\",\"return c.y;\"),arg:kr(\"float\",\"vec2 c\",\"return dcg_arctan(c.y,c.x);\"),peelableCoerceComplexToReal:kr(\"float\",\"vec2 a\",\"return a.y == 0.0 ? a.x : NaN;\"),coerceComplexToReal:kr(\"float\",\"vec2 a\",\"return a.y == 0.0 ? a.x : NaN;\"),coerceRealToComplex:kr(\"vec2\",\"float x\",\"return isnan(x) ? vec2(NaN, NaN) : vec2(x, 0);\"),complexSqrt:$s(pe`float u = z.x; float v = z.y;\n    float r = sqrt(0.5 * (abs(u) + dcg_hypot(u, v)));\n    if (r == 0.0 || isnan(v) || isinf(v)) return dcg_complex(r, v);\n    if (u > 0.0) return dcg_complex(r, 0.5 * (v / r));\n    if (v < 0.0) r = -r;\n    return dcg_complex(0.5 * (v / r), r);`),complexDivide:kr(\"vec2\",\"vec2 a, vec2 b\",pe`float u1 = a.x; float v1 = a.y;\n      float u2 = b.x; float v2 = b.y;\n      if (isnan(u1) || isnan(v1) || isnan(u2) || isnan(v2)) return vec2(NaN, NaN);\n      if (isinf(u1) || isinf(v1)) return vec2(NaN, NaN);\n      if (u2 == 0.0 && v2 == 0.0) return vec2(NaN, NaN);\n      if (isinf(u2) || isinf(v2)) return vec2(0.0, 0.0);\n      if (abs(v2) <= abs(u2)) {\n        return dcg_subComplexDivide(a, b);\n      } else {\n        return dcg_conj(dcg_subComplexDivide(a.yx, b.yx));\n      }`),complexLn:$s(pe`float u = z.x; float v = z.y;\n      return dcg_complex(dcg_ln(dcg_hypot(u,v)), dcg_arctan(v,u));`),complexExp:$s(pe`float u = z.x; float v = z.y;\n      if (isnan(u)) return vec2(NaN, NaN);\n      float r = exp(u);\n      return v == 0.0 ? vec2(r, 0.0) : dcg_complexFromPolarRounded(r, v);`),complexPow:kr(\"vec2\",\"vec2 z1, vec2 z2\",pe`float u2 = z2.x; float v2 = z2.y;\n      float u1 = z1.x; float v1 = z1.y;\n      if (isnan(u1) || isnan(v1) || isnan(u2) || isnan(v2))\n        return vec2(NaN, NaN);\n      float r1 = dcg_hypot(u1, v1);\n      float theta1 = dcg_arctan(v1, u1);\n      float rOut = pow(r1, u2) * exp(-theta1 * v2);\n      float thetaOut = log(r1) * v2 + theta1 * u2;\n      if (!isinf(rOut)) {\n        return dcg_complexFromPolarRounded(rOut, thetaOut);\n      } else {\n        return dcg_complexFromPolarRounded(\n          exp(u2 * log(r1) - theta1 * v2),\n          thetaOut\n        );\n      }\n      `),complexSin:$s(pe`float u = z.x; float v = z.y;\n      return dcg_complex(dcg_sin(u) * dcg_cosh(v), dcg_cos(u) * dcg_sinh(v));`),complexCos:$s(pe`float u = z.x; float v = z.y;\n      return dcg_complex(dcg_cos(u) * dcg_cosh(v), -dcg_sin(u) * dcg_sinh(v));`),complexSinh:$s(pe`float u = z.x; float v = z.y;\n      return dcg_complex(dcg_sinh(u) * dcg_cos(v), dcg_cosh(u) * dcg_sin(v));`),complexCosh:$s(pe`float u = z.x; float v = z.y;\n      return dcg_complex(dcg_cosh(u) * dcg_cos(v), dcg_sinh(u) * dcg_sin(v));`),complexTanh:$s(pe`float u = z.x; float v = z.y;\n      float tanv = dcg_tan(v); float tanhu = dcg_tanh(u);\n      if (isnan(tanv) || isnan(tanhu)) return vec2(NaN, NaN);\n      if (isinf(tanv)) return vec2(1.0 / tanhu, 0.0);\n\n      float tanv2 = tanv * tanv;\n      float secv2 = 1.0 + tanv2;\n      float sinhu = dcg_sinh(u);\n      float sinhu2 = sinhu * sinhu;\n      float tanhu2 = tanhu * tanhu;\n      return dcg_complex(\n        (secv2 * tanhu) / (1.0 + tanv2 * tanhu2),\n        tanv / (1.0 + secv2 * sinhu2)\n      );`),complexTan:$s(pe`float u = z.x; float v = z.y;\n      vec2 t = dcg_complexTanh(vec2(-v, u));\n      return vec2(t.y, -t.x);`),complexSec:$s(\"return dcg_complexReciprocal(dcg_complexCos(z));\"),complexCsc:$s(\"return dcg_complexReciprocal(dcg_complexSin(z));\"),complexCot:$s(\"return dcg_complexReciprocal(dcg_complexTan(z));\"),complexSech:$s(\"return dcg_complexReciprocal(dcg_complexCosh(z));\"),complexCsch:$s(\"return dcg_complexReciprocal(dcg_complexSinh(z));\"),complexCoth:$s(\"return dcg_complexReciprocal(dcg_complexTanh(z));\"),complexLogbase:kr(\"vec2\",\"vec2 z, vec2 base\",pe`\n      float u = z.x; float v = z.y;\n      float bu = base.x; float bv = base.y;\n      if (any(isnan(z)) || any(isnan(base))) return vec2(NaN, NaN);\n      if (bv == 0.0 && bu == 0.0) return vec2(NaN, NaN);\n      if (u == 0.0 && v == 0.0) return vec2(-Infinity, 0);${\"\"}\n      return dcg_complexDivide(dcg_complexLn(z), dcg_complexLn(base));`),complexLog:$s(\"return dcg_complexLogbase(z, vec2(10.0,0.0));\")});function kr(e,t,n){return{type:\"scalar\",value:`${e} dcg_[[name_here]](${t}){ ${n} }`}}function ci(e){return kr(\"float\",\"float x\",e)}function Dn(e){return ci(`return ${e};`)}function AN(e){return kr(\"float\",\"float x, float y\",e)}function Uf(e){return AN(`return ${e};`)}function $s(e){return kr(\"vec2\",\"vec2 z\",e)}function Ys(e,{inType:t,outType:n,deps:r}={}){let s=t!=null?t:o=>`float[${o}]`,i=n!=null?n:()=>\"float\";return{type:\"reducer\",value:o=>`${i(o)} dcg_[[name_here]](${s(o)} L) { ${e(o)} }`,deps:r!=null?r:[]}}function eM(e){return{type:\"double-reducer\",value:(t,n)=>{let r=Math.min(t,n),s=e(r);return`float dcg_[[name_here]](float[${t}] X, float[${n}] Y) { ${s} }`}}}var OH=tM({lcm:Ys(e=>pe`float g = abs(dcg_round(L[0]));\n      if (isnan(g) || isinf(g)) return NaN;\n      for (int i=1; i<${e}; i++) {\n        float v = abs(dcg_round(L[i]));\n        if (isnan(v) || isinf(v)) return NaN;\n        if (g != 0.0)\n          g *= dcg_round(v / dcg_gcd2(g, v));\n      }\n      return g;`),gcd:Ys(e=>pe`float g = abs(dcg_round(L[0]));\n      if (isnan(g) || isinf(g)) return NaN;\n      for (int i=1; i<${e}; i++) {\n        float x = L[i];\n        if (isnan(x) || isinf(x)) return NaN;\n        g = dcg_gcd2(g, abs(dcg_round(x)));\n      }\n      return g;`),mean:Ys(e=>pe`float tot = 0.0;\n      for (int i=0; i<${e}; i++) {\n        float x = L[i];\n        if (isnan(x) || (isinf(x) && x == -tot)) return NaN;\n        tot += x;\n      }\n      return tot / ${e}.0;`),total:Ys(e=>pe`float tot = 0.0;\n      for (int i=0; i<${e}; i++) {\n        float x = L[i];\n        if (isnan(x) || (isinf(x) && x == -tot)) return NaN;\n        tot += x;\n      }\n      return tot;`),stdev:Ys(e=>SN(e,e-1),{deps:[\"mean\"]}),stdevp:Ys(e=>SN(e,e),{deps:[\"mean\"]}),mad:Ys(e=>pe`float mean = dcg_mean(L);\n      if (isnan(mean) || isinf(mean)) return NaN;\n      float tot = 0.0;\n      for (int i=0; i<${e}; i++) {\n        tot += abs(L[i] - mean);\n      }\n      return tot / ${e}.0;`,{deps:[\"mean\"]}),listMin:Ys(e=>vN(e,\"min\")),listMax:Ys(e=>vN(e,\"max\")),argmin:Ys(e=>ON(e,\"<\")),argmax:Ys(e=>ON(e,\">=\")),median:Ys(e=>e%2===1?`return L[int(dcg_sortPerm(L)[${(e-1)/2}])];`:pe`float[${e}] perm = dcg_sortPerm(L);\n          return 0.5*(L[int(perm[${e/2}])]+L[int(perm[${e/2-1}])]);`,{deps:[\"sortPerm\"]}),varp:Ys(e=>DN(e,e),{deps:[\"mean\"]}),var:Ys(e=>DN(e,e-1),{deps:[\"mean\"]}),sortPerm:Ys(e=>{if(e>100)throw Oc();return pe`float[${e}] permFloat;\n        float lastMin = -Infinity;\n        int lastIndex = -1;\n        for (int i=0; i<${e}; i++) {\n          float currMin = NaN;\n          int currIndex = ${e};\n          int j;\n          for (j=0; j<${e}; j++) {\n            float e = L[j];\n            float cmpLast = dcg_compareAscendingNaNLast(e, lastMin);\n            float cmpCurr = dcg_compareAscendingNaNLast(currMin, e);\n            if (\n              (cmpLast > 0.0 || (cmpLast == 0.0 && j > lastIndex))\n              && (cmpCurr > 0.0 || (cmpCurr == 0.0 && j < currIndex))\n            ) {\n              currMin = e;\n              currIndex = j;\n            }\n          }\n          permFloat[i] = float(currIndex);\n          lastMin = currMin;\n          lastIndex = currIndex;\n        }\n        return permFloat;`},{outType:e=>`float[${e}]`}),complexSortPerm:Ys(e=>{if(e>100)throw Oc();return pe`float[${e}] permFloat;\n      vec2 lastMin = vec2(-Infinity,-Infinity);\n      int lastIndex = -1;\n      for (int i=0; i<${e}; i++) {\n        vec2 currMin = vec2(NaN,NaN);\n        int currIndex = ${e};\n        int j;\n        for (j=0; j<${e}; j++) {\n          vec2 e = L[j];\n          float cmpLast = dcg_compareComplexLexicographic(e, lastMin);\n          float cmpCurr = dcg_compareComplexLexicographic(currMin, e);\n          if (\n            (cmpLast > 0.0 || (cmpLast == 0.0 && j > lastIndex))\n            && (cmpCurr > 0.0 || (cmpCurr == 0.0 && j < currIndex))\n          ) {\n            currMin = e;\n            currIndex = j;\n          }\n        }\n        permFloat[i] = float(currIndex);\n        lastMin = currMin;\n        lastIndex = currIndex;\n      }\n      return permFloat;`},{inType:e=>`vec2[${e}]`,outType:e=>`float[${e}]`})});function DN(e,t){return t===0?\"return NaN;\":pe`float mean = dcg_mean(L);\n    if (isnan(mean) || isinf(mean)) return NaN;\n    float tot = 0.0;\n    for (int i=0; i<${e}; i++) {\n      float delta = L[i] - mean;\n      tot += delta * delta;\n    }\n    return tot / ${t}.0;`}function SN(e,t){return t===0?\"return NaN;\":pe`float mean = dcg_mean(L);\n    if (isnan(mean) || isinf(mean)) return NaN;\n    float tot = 0.0;\n    for (int i=0; i<${e}; i++) {\n      tot = dcg_hypot(tot, L[i] - mean);\n    }\n    return tot / ${nM(Math.sqrt(t))};`}function vN(e,t){return pe`float m = L[0];\n    if (isnan(m)) return NaN;\n    for (int i=1; i<${e}; i++) {\n      float x = L[i];\n      if (isnan(x)) return NaN;\n      m = ${t}(m, x);\n    }\n    return m;`}function ON(e,t){return pe`if (isnan(L[0])) return 0.0;\n    int arg = 0;\n    float best = L[0];\n    for (int i=1; i<${e}; i++) {\n      float e = L[i];\n      if (isnan(e)) return 0.0;\n      if (e ${t} best) {\n        arg = i;\n        best = e;\n      }\n    }\n    return float(arg + 1);`}var NH=tM({cov:eM(e=>NN(e,e-1)),covp:eM(e=>NN(e,e)),corr:eM(e=>pe`${_N(e)}\n      float t1 = 0.0;\n      float t2 = 0.0;\n      float tc = 0.0;\n      for (int i=0; i<${e}; i++) {\n        float d1 = X[i] - m1;\n        float d2 = Y[i] - m2;\n        t1 = dcg_hypot(t1, d1);\n        t2 = dcg_hypot(t2, d2);\n        tc += d1 * d2;\n      }\n      return tc / (t1 * t2);`)}),RH={type:\"elementsAt\",value:(e,t)=>`${e}[${t}] dcg_elementsAt(${e}[${t}] X, float[${t}] Y) {\n      ${e}[${t}] outList;\n      for (int i=0; i<${t}; i++) {\n        outList[i] = X[int(Y[i])];\n      }\n      return outList;\n    }`},AH={...RN,...OH,...NH,elementsAt:RH},yh=AH;function _H(e,t){switch(e.type){case\"scalar\":return e.value.replace(\"[[name_here]]\",t);case\"reducer\":{let n=e.value;return r=>n(r).replace(\"[[name_here]]\",t)}case\"double-reducer\":{let n=e.value;return(r,s)=>n(r,s).replace(\"[[name_here]]\",t)}default:return e.value}}function tM(e){for(let[t,n]of Object.entries(e))n.type!==\"omitted\"&&(n.value=_H(n,t));return e}function NN(e,t){return pe`${_N(e)}\n    float tot = 0.0;\n    for (int i=0; i<${e}; i++) {\n      tot += (X[i] - m1) * (Y[i] - m2);\n    }\n    return tot / ${t}.0;`}function _N(e){return pe`float m1 = 0.0;\n    for (int i=0; i<${e}; i++) {\n      float x = X[i];\n      if (isnan(x) || isinf(x)) return NaN;\n      m1 += x;\n    }\n    m1 /= ${e}.0;\n    float m2 = 0.0;\n    for (int i=0; i<${e}; i++) {\n      float y = Y[i];\n      if (isnan(y) || isinf(y)) return NaN;\n      m2 += y;\n    }\n    m2 /= ${e}.0;`}var LH=[pe`float dcg_rawpow(float x, float y) {\n    if (isnan(x) || isnan(y)) return NaN;\n    if (y==0.0) return 1.0;\n    if (isinf(y)) {${\"\"}\n      float a = abs(x);\n      if (a == 1.0) return NaN;\n      if (y > 0.0) {\n        return a > 1.0 ? Infinity : 0.0;\n      } else {\n        return a < 1.0 ? Infinity : 0.0;\n      }\n    }\n    if (x > 0.0) return pow(x, y);\n    else if (x == 0.0) {\n      if (y > 0.0) return 0.0;\n      else if (y == 0.0) return 1.0;\n      else return Infinity;\n    } else {\n      float m = mod(y, 2.0);\n      if (m == 1.0) return -pow(-x, y);\n      else return pow(-x, y);\n    }\n  }`,pe`float dcg_pow(float x, float y) {\n    if (isnan(x) || isnan(y)) return NaN;\n    if (y==0.0) return 1.0;\n    if (isinf(y)) {\n      float a = abs(x);\n      if (a == 1.0) return NaN;\n      if (y > 0.0) {\n        return a > 1.0 ? Infinity : 0.0;\n      } else {\n        return a < 1.0 ? Infinity : 0.0;\n      }\n    }\n    if (x > 0.0) return pow(x,y);\n    else if (x == 0.0) {\n      if (y > 0.0) return 0.0;\n      if (y == 0.0) return 1.0;\n      if (y < 0.0) return Infinity;\n    } else {\n      float m = mod(y, 2.0);\n      if (m == 0.0) return pow(-x, y);\n      else if (m == 1.0) return -pow(-x, y);\n      else {${\"\"}\n        vec2 a0 = vec2(0.0, 1.0);\n        vec2 a1 = vec2(1.0, 0.0);\n        float approx = y;\n        for (int i=0; i<12; i+=1) {\n          float whole = floor(approx);\n          vec2 a = whole * a1 + a0;\n          if (a.y > 100.0) break;\n          a0 = a1; a1 = a;\n          if (approx == whole) break;\n          approx = 1.0 / (approx - whole);\n        }${\"\"}\n        float r = a1.x / a1.y;\n        float m = max(max(abs(y), abs(r)), 1.0);\n        if (abs(mod(a1.y, 2.0) - 1.0) < 0.01 && abs((r - y)/y) < 0.00001) {\n          return (mod(a1.x, 2.0) == 0.0 ? 1.0 : -1.0) * pow(-x, y);\n        } else {\n          return NaN;\n        }\n      }\n    }\n  }`,pe`float dcg_add(float x, float y) {\n    return isnan(x) || isnan(y) ? NaN\n      : isinf(x) && isinf(y) && x != y ? NaN\n      : x + y;\n  }`,pe`float dcg_sub(float x, float y) {\n    return isnan(x) || isnan(y) ? NaN\n      : isinf(x) && isinf(y) && x != -y ? NaN\n      : x - y;\n  }`,pe`float dcg_mul(float x, float y) {\n    return isnan(x) || isnan(y) ? NaN\n      : isinf(x) && y == 0.0 ? NaN\n      : x == 0.0 && isinf(y) ? NaN\n      : x * y;\n  }`,pe`float dcg_div(float x, float y) {\n    return isnan(x) || isnan(y) ? NaN\n      : isinf(x) && isinf(y) ? NaN\n      : x == 0.0 && y == 0.0 ? NaN\n      : x / y;\n  }`,pe`float dcg_neg(float x) {\n    return isnan(x) ? NaN : -x;\n  }`,pe`bool dcg_equal(float x, float y) {\n    return isnan(x) || isnan(y) ? false : x == y;\n  }`,pe`bool dcg_less(float x, float y) {\n    return isnan(x) || isnan(y) ? false : x < y;\n  }`,pe`bool dcg_lessEqual(float x, float y) {\n    return isnan(x) || isnan(y) ? false : x <= y;\n  }`,pe`bool dcg_greater(float x, float y) {\n    return isnan(x) || isnan(y) ? false : x > y;\n  }`,pe`bool dcg_greaterEqual(float x, float y) {\n    return isnan(x) || isnan(y) ? false : x >= y;\n  }`,pe`float dcg_gcd2(float u, float v) {\n    for (int i=0; i<95; i++) {\n      if (v == 0.0) break;\n      u = mod(u, v);\n      if (u == 0.0) break;\n      v = mod(v, u);\n    }\n    return u+v;\n  }`,pe`float dcg_log1p(float x) {\n    return x - 0.5 * x * x == x ? x : log(1.0 + x);\n  }`,pe`bool dcg_isPiMultiple(float absx) {\n    if (absx > 1.0e5) return false;\n    return floor(0.5 + dcg_PI_INV * absx) * dcg_PI == absx;\n  }`,pe`bool dcg_isOddHalfPiMultiple(float absx) {\n    if (absx > 1.0e5) return false;\n    float n = floor(0.5 + 2.0 * dcg_PI_INV * absx);\n    return mod(n, 2.0) == 1.0 && n * dcg_PI == 2.0 * absx;\n  }`,\"vec2 dcg_conj(vec2 a) { return vec2(a.x, -a.y); }\",pe`vec2 dcg_subComplexDivide(vec2 a, vec2 b) {\n    float u1 = a.x; float v1 = a.y;\n    float u2 = b.x; float v2 = b.y;\n    float r = v2 / u2;\n    float t = 1.0 / (u2 + v2 * r);\n    if (r == 0.0) {\n      return dcg_complex((u1 + v2 * (v1 / u2)) * t, (v1 - v2 * (u1 / u2)) * t);\n    } else {\n      return dcg_complex((u1 + v1 * r) * t, (v1 - u1 * r) * t);\n    }\n  }`,pe`vec2 dcg_complexFromPolarRounded(float r, float theta) {\n    if (isnan(r) || isnan(theta)) return vec2(NaN, NaN);\n    if (r == 0.0) return vec2(0.0, 0.0);\n    return dcg_complex(r * dcg_cos(theta), r * dcg_sin(theta));\n  }`,pe`vec2 dcg_complexReciprocal(vec2 z) {\n    return dcg_complexDivide(vec2(1.0,0.0), z);\n  }`,pe`float dcg_compareAscendingNaNLast(float x, float y) {\n    float diff = dcg_sub(x,y);\n    return !isnan(diff) ? diff : float(isnan(x)) - float(isnan(y));\n  }`,pe`float dcg_compareComplexLexicographic(vec2 x, vec2 y) {\n    float realComparison = dcg_compareAscendingNaNLast(x.x, y.x);\n    return realComparison != 0.0 ? realComparison : dcg_compareAscendingNaNLast(x.y, y.y);\n  }`].join(`\n`),wH=`\n  float dcg_round(float x);\n  float dcg_hypot(float x, float y);\n  float dcg_rtxsqpone(float x);\n  float dcg_rtxsqmone(float x);\n  float dcg_cos(float x);\n  float dcg_sin(float x);\n  float dcg_tan(float x);\n  float dcg_tanh(float x);\n  vec2 dcg_complex(float u, float v);\n  vec2 dcg_complexDivide(vec2 a, vec2 b);\n`,FH=Object.values(RN).map(e=>e.value).join(`\n`),oK=pe`uniform float NaN;\n    uniform float Infinity;\n    #define dcg_PI 3.141592653589793\n    #define dcg_PI_INV 0.3183098861837907\n    ${wH}\\n\n    ${LH}\\n\n    ${FH}`;function pe(e,...t){let n=e[0];for(let r=0;r<t.length;r++)n+=t[r],n+=e[r+1];return VH(n)}function VH(e){let t=e.split(`\n`);if(/^\\s/.test(t[0][0]))throw new Error(\"Programming error: Expected un-indented first line\");if(t.length<=1)return e;let n=Math.min(...t.slice(1).map(r=>r.match(/^\\s*/)[0].length));return t[0]+`\n`+t.slice(1).map(r=>r.slice(n)).join(`\n`)}function Ma(e,t){let n=new rM(e,t),r=Zg(n);return n.finish(r)}var rM=class extends wp{constructor(n,r){super(n,!0);this.maxUniforms=r;this.glsl=!0;this.shaderUniforms=[];this.definitions={}}finish(n){return{source:n,shaderFunctions:BH(this.chunk,this.definitions),shaderUniforms:this.shaderUniforms}}printValue(n,r){if(Array.isArray(n)){if(n.length>100)throw Oc();let s=j(r),i=s?Ve(r):r,o=n.map(c=>this.printValue(c,i)).join(\",\"),a=qf(r),u=LN({type:a,arity:n.length});return this.definitions[u]=!0,(s?\"buildList\":a)+\"(\"+o+\")\"}switch(typeof n){case\"boolean\":return n.toString();case\"number\":return this.printFloatOrUniformGLSL(n);case\"string\":throw Xl(\"random\");case\"object\":if(gu(n))throw new Error(\"Action values cannot be compiled\");return this.printFloatOrUniformGLSL(V(n));default:throw new Error(\"Unexpected value: \"+n)}}printFloatOrUniformGLSL(n){if(this.shaderUniforms.length>=this.maxUniforms)return nM(n);{let s=\"_DCG_SC_\"+this.shaderUniforms.length;return this.shaderUniforms.push(n),s}}beforeBeginLoop(n){let r=this.chunk.getInstruction(n.args[0]),s=this.chunk.getInstruction(n.args[1]),i=n.callData.type===\"sum\";if(r.type!==1){let u=fs(this.chunk,n.args[0]);throw i?gy(u):hy(u)}if(s.type!==1){let u=fs(this.chunk,n.args[1]);throw i?gy(u):hy(u)}if(r.valueType!==I||s.valueType!==I)throw new Error(\"Programming error: non-number in summation bounds\");let o=V(r.value),a=V(s.value);if(!isFinite(a-o)||a-o>=1e3)throw i?VT():BT()}checkFiniteBounds(){return\"\"}emitConstant(n){return this.printValue(n.value,n.valueType)}emitNeg(n){return`dcg_neg(${n})`}emitTernary(n,r,s,i){return j(i.valueType)?`dcg_ternary(${n},${r},${s})`:`${n}?${r}:${s}`}emitVec2(n,r){return`vec2(${n},${r})`}emitVec3(n,r,s){return`vec3(${n},${r},${s})`}emitVecAccess(n,r){return`${n}.${r===0?\"x\":r===1?\"y\":\"z\"}`}emitBinary(n,r,s){switch(n.type){case 8:return`dcg_add(${r},${s})`;case 9:return`dcg_sub(${r},${s})`;case 10:return`dcg_mul(${r},${s})`;case 11:return`dcg_div(${r},${s})`;case 12:return`dcg_pow(${r},${s})`;case 13:return`dcg_rawpow(${r},${s})`;case 25:return`dcg_equal(${r},${s})`;case 26:return`dcg_less(${r},${s})`;case 28:return`dcg_lessEqual(${r},${s})`;case 27:return`dcg_greater(${r},${s})`;case 29:return`dcg_greaterEqual(${r},${s})`;case 31:return`${r}||${s}`;case 32:return`${r}&&${s}`;default:throw new Error(\"Programming Error: invalid binary opcode.\")}}emitList(n,r){let s=LN({type:qf(r.valueType),arity:r.args.length});return this.definitions[s]=!0,`buildList(${n.join(\",\")})`}emitListAccess(n,r,s,i){let o=qn(this.chunk,i.args[0]);if(o===void 0)throw mu(fs(this.chunk,i.args[0]));let a=`int(${r})`;return`(${a}>=1&&${a}<=${o})?${n}[${a}-1]:${s}`}emitInboundsListAccess(n,r){return`${n}[int(${r})-1]`}emitNativeFunction(n,r){if(!yh[r.symbol])throw Xl(r.symbol);return`dcg_${r.symbol}(${n.join(\",\")})`}emitExtendSeed(){throw Xl(\"random\")}emitVarDeclaration(n,r){let s=r?\";\":\"\";return s+=sM(this.chunk,n)+\" \"+fn(n),s}emitImmediateAssignment(n,r,s){return`${sM(this.chunk,n)} ${r}=${s};`}emitFunctionCall(){throw Xl(\"recursion\")}};function hK(...e){return Object.keys(Object.assign({},...e)).join(`\n`)}function LN(e){let{type:t,arity:n}=e,r=t+\"[\"+n+\"]\",s=r+\" buildList(\";for(let i=0;i<n-1;i++)s+=`${t} _${i}, `;s+=`${t} _${n-1}) {\n`,s+=r+` a;\n`;for(let i=0;i<n;i++)s+=`a[${i}] = _${i};\n`;return s+=`return a;\n}\n`,s}function BH(e,t){let n=e.argNames.length,r=e.instructionsLength()-1;for(let s=n;s<=r;s++){let i=e.getInstruction(s);if(i.type===33){if(j(i.valueType)){let o=sM(e,s),a=`${o} dcg_ternary(bool x, ${o} y, ${o} z) { if (x) return y; return z; }`;t[a]=!0}}else if(i.type===37){let o=yh[i.symbol];if((o==null?void 0:o.type)===\"reducer\"){let a=i.args[0],u=qn(e,a);if(u===void 0)throw mu(fs(e,a));for(let c of o.deps)t[yh[c].value(u)]=!0;t[o.value(u)]=!0}else if((o==null?void 0:o.type)===\"double-reducer\"){let a=i.args[0],u=i.args[1],c=qn(e,a),l=qn(e,u);if(c===void 0)throw mu(fs(e,a));if(l===void 0)throw mu(fs(e,u));t[o.value(c,l)]=!0}else if((o==null?void 0:o.type)===\"elementsAt\"){let a=qf(Ve(i.valueType)),u=i.args[1],c=qn(e,u);if(c===void 0)throw mu(fs(e,u));t[o.value(a,c)]=!0}}}return t}function nM(e){let t=e.toString();return/^-?\\d+$/.test(t)?t+\".0\":t}function qf(e){switch(j(e)?Ve(e):e){case De:return\"bool\";case I:return\"float\";case N:case R:return\"vec2\";case Kt:case H:return\"vec3\";default:throw new Error(\"Unexpected type: \"+at(e))}}function sM(e,t){let n=e.getInstruction(t);if(j(n.valueType)){let r=qn(e,t);if(r===void 0)throw mu(fs(e,t));if(r>100)throw Oc();return`${qf(n.valueType)}[${r}]`}else return qf(n.valueType)}function bK(e){let t={},n=\"\";if(e)for(let r=0;r<e.length;r++){let s=\"_DCG_SC_\"+r;t[s]={value:e[r]},n+=\"uniform float \"+s+`;\n`}return{uniforms:t,declarations:n}}function wN(e){let t=[],n=[];for(let r=0;r<e.argNames.length;r++){let s=[],i=[];for(let o=0;o<e.argNames.length;o++)s.push(e.argTypes[o]===I),i.push(r===o);n.push(i),t.push(s)}for(let r=e.argNames.length;r<=e.getReturnIndex();r++)n.push(GH(e,n,r)),t.push(kH(e,n,t,r));return t[e.getReturnIndex()]}function GH(e,t,n){let r=e.getInstruction(n),s=zH(e.argNames.length);if(ge(r))return s;for(let i of r.args){let o=t[i];for(let a=0;a<o.length;a++)s[a]=s[a]||o[a]}return s}function kH(e,t,n,r){let s=e.getInstruction(r);if(ge(s))return iM(e.argNames.length);switch(s.type){case 8:case 9:case 14:case 15:case 16:case 38:{let o=iM(e.argNames.length);for(let a=0;a<s.args.length;a++){let u=n[s.args[a]];for(let c=0;c<u.length;c++)o[c]=o[c]&&u[c]}return o}case 11:{let o=[],a=n[s.args[0]],u=t[s.args[1]];for(let c=0;c<a.length;c++)o.push(a[c]&&!u[c]);return o}case 10:{let o=n[s.args[0]].slice(),a=n[s.args[1]].slice(),u=t[s.args[0]],c=t[s.args[1]],l=0,p=0;for(let f=0;f<o.length;f++){let d=o[f]&&!c[f],y=a[f]&&!u[f];o[f]=d,a[f]=y,d&&(l+=1),y&&(p+=1)}return l>=p?o:a}case 33:{let o=t[s.args[0]],a=n[s.args[1]],u=n[s.args[2]],c=[];for(let l=0;l<o.length;l++)c.push(!o[l]&&a[l]&&u[l]);return c}case 39:case 40:case 41:{let o=n[s.args[0]],a=t[s.args[1]],u=[];for(let c=0;c<a.length;c++)u.push(o[c]&&!a[c]);return u}case 48:{let o=s.args[0],a=e.getInstruction(o),u=r-o;return n[a.args[u]]}case 37:return HH(e,s,t,n,r);case 12:case 13:case 26:case 28:case 27:case 29:case 25:case 32:case 31:case 42:case 21:case 22:case 19:case 20:case 23:case 24:case 47:case 44:case 49:case 50:case 51:case 53:case 54:case 55:{let o=t[r],a=[];for(let u of o)a.push(!u);return a}default:let i=s;throw new Error(`Unexpected opcode ${i.type}`)}}function HH(e,t,n,r,s){switch(t.symbol){case\"complex\":{let i=iM(e.argNames.length);for(let o=0;o<t.args.length;o++){let a=r[t.args[o]];for(let u=0;u<a.length;u++)i[u]=i[u]&&a[u]}return i}default:{let i=n[s],o=[];for(let a of i)o.push(!a);return o}}}function zH(e){let t=[];for(let n=0;n<e;n++)t.push(!1);return t}function iM(e){let t=[];for(let n=0;n<e;n++)t.push(!0);return t}function Sn(e,t,n){switch(t){case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 21:case 19:case 23:case 50:return I;case 25:case 26:case 27:case 28:case 29:case 31:case 32:return De;case 33:{let s=e.getInstruction(n[1]).valueType,i=e.getInstruction(n[2]).valueType,o=Ha(s,i);return o===void 0?s:o}case 38:return jp(n.map(s=>e.getInstruction(s).valueType));case 39:case 40:case 41:{let s=e.getInstruction(n[0]).valueType;return j(s)?Ve(s):Qt}case 44:return ft;case 49:return ut;case 55:return e.getInstruction(n[0]).valueType;case 1:case 2:case 37:case 42:case 47:case 48:case 3:case 0:case 24:case 22:case 20:case 51:case 4:case 53:case 54:case 15:case 16:return Qt;default:let r=t;throw new Error(`Unexpected opcode ${r}`)}}function FN(e){if(e.instructionsLength()-1!==e.getReturnIndex())throw new Error(\"Programming Error: only the final instruction in a chunk can be lifted to numbers\");let t=e.getInstruction(e.getReturnIndex());if(ge(t))return e.getReturnIndex();switch(t.type){case 8:let[n,r]=t.args;return cr(e,n)&&cr(e,r)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Add([e.Slot(0,[n]),e.Slot(0,[r])]),e.Add([e.Slot(1,[n]),e.Slot(1,[r])])])):cr(e,n)&&rs(e,r)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Add([e.Slot(0,[n]),r]),e.Slot(1,[n])])):rs(e,n)&&cr(e,r)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Add([n,e.Slot(0,[r])]),e.Slot(1,[r])])):Uu(e,n)&&Uu(e,r)?(e.popInstruction(),e.TupleOfType(N,[e.Add([e.Slot(0,[n]),e.Slot(0,[r])]),e.Add([e.Slot(1,[n]),e.Slot(1,[r])])])):qu(e,n)&&qu(e,r)?(e.popInstruction(),e.TupleOfType(H,[e.Add([e.Slot(0,[n]),e.Slot(0,[r])]),e.Add([e.Slot(1,[n]),e.Slot(1,[r])]),e.Add([e.Slot(2,[n]),e.Slot(2,[r])])])):eu(e,t.args)?(e.popInstruction(),$u(e,[e.Add([Ss(e,n),Ss(e,r)]),$o(e,t.args[0])])):e.getReturnIndex();case 9:{let[i,o]=t.args;return cr(e,i)&&cr(e,o)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Subtract([e.Slot(0,[i]),e.Slot(0,[o])]),e.Subtract([e.Slot(1,[i]),e.Slot(1,[o])])])):cr(e,i)&&rs(e,o)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Subtract([e.Slot(0,[i]),o]),e.Slot(1,[i])])):rs(e,i)&&cr(e,o)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Subtract([i,e.Slot(0,[o])]),e.Negative([e.Slot(1,[o])])])):Uu(e,i)&&Uu(e,o)?(e.popInstruction(),e.TupleOfType(N,[e.Subtract([e.Slot(0,[i]),e.Slot(0,[o])]),e.Subtract([e.Slot(1,[i]),e.Slot(1,[o])])])):qu(e,i)&&qu(e,o)?(e.popInstruction(),e.TupleOfType(H,[e.Subtract([e.Slot(0,[i]),e.Slot(0,[o])]),e.Subtract([e.Slot(1,[i]),e.Slot(1,[o])]),e.Subtract([e.Slot(2,[i]),e.Slot(2,[o])])])):eu(e,t.args)?(e.popInstruction(),$u(e,[e.Subtract([Ss(e,i),Ss(e,o)]),$o(e,i)])):e.getReturnIndex()}case 14:{let[i]=t.args;return cr(e,i)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Negative([e.Slot(0,[i])]),e.Negative([e.Slot(1,[i])])])):Uu(e,i)?(e.popInstruction(),e.TupleOfType(N,[e.Negative([e.Slot(0,[i])]),e.Negative([e.Slot(1,[i])])])):qu(e,i)?(e.popInstruction(),e.TupleOfType(H,[e.Negative([e.Slot(0,[i])]),e.Negative([e.Slot(1,[i])]),e.Negative([e.Slot(2,[i])])])):eu(e,t.args)?(e.popInstruction(),$u(e,[e.Negative([Ss(e,i)]),$o(e,i)])):e.getReturnIndex()}case 10:{let[i,o]=t.args;if(cr(e,i)&&cr(e,o)){e.popInstruction();let a=e.Slot(0,[i]),u=e.Slot(1,[i]),c=e.Slot(0,[o]),l=e.Slot(1,[o]);return e.NativeFunction(\"complex\",[e.Subtract([e.Multiply([a,c]),e.Multiply([u,l])]),e.Add([e.Multiply([a,l]),e.Multiply([c,u])])])}else{if(cr(e,i)&&rs(e,o))return e.popInstruction(),e.NativeFunction(\"complex\",[e.Multiply([e.Slot(0,[i]),o]),e.Multiply([e.Slot(1,[i]),o])]);if(rs(e,i)&&cr(e,o))return e.popInstruction(),e.NativeFunction(\"complex\",[e.Multiply([i,e.Slot(0,[o])]),e.Multiply([i,e.Slot(1,[o])])]);if($f(e,i)&&$f(e,o))return e.popInstruction(),e.NativeFunction(\"restriction\",[e.And([e.NativeFunction(\"restrictionToBoolean\",[i]),e.NativeFunction(\"restrictionToBoolean\",[o])])]);if($f(e,i)||$f(e,o)){let a,u;$f(e,i)?(a=i,u=o):(a=o,u=i);let c=e.getInstruction(u).valueType;return io(c)?(e.popInstruction(),e.Piecewise([e.NativeFunction(\"restrictionToBoolean\",[a]),u,e.NanOfType(c)])):e.getReturnIndex()}else return Uu(e,i)&&rs(e,o)?(e.popInstruction(),e.TupleOfType(N,[e.Multiply([e.Slot(0,[i]),o]),e.Multiply([e.Slot(1,[i]),o])])):rs(e,i)&&Uu(e,o)?(e.popInstruction(),e.TupleOfType(N,[e.Multiply([i,e.Slot(0,[o])]),e.Multiply([i,e.Slot(1,[o])])])):eu(e,[i])&&rs(e,o)?(e.popInstruction(),$u(e,[e.Multiply([Ss(e,i),o]),$o(e,i)])):rs(e,i)&&eu(e,[o])?(e.popInstruction(),$u(e,[e.Multiply([i,Ss(e,o)]),$o(e,o)])):qu(e,i)&&rs(e,o)?(e.popInstruction(),e.TupleOfType(H,[e.Multiply([e.Slot(0,[i]),o]),e.Multiply([e.Slot(1,[i]),o]),e.Multiply([e.Slot(2,[i]),o])])):rs(e,i)&&qu(e,o)?(e.popInstruction(),e.TupleOfType(H,[e.Multiply([i,e.Slot(0,[o])]),e.Multiply([i,e.Slot(1,[o])]),e.Multiply([i,e.Slot(2,[o])])])):e.getReturnIndex()}}case 11:{let[i,o]=t.args;return cr(e,i)&&cr(e,o)?(e.popInstruction(),e.NativeFunction(\"complexDivide\",[i,o])):cr(e,i)&&rs(e,o)?(e.popInstruction(),e.NativeFunction(\"complex\",[e.Divide([e.Slot(0,[i]),o]),e.Divide([e.Slot(1,[i]),o])])):rs(e,i)&&cr(e,o)?(e.popInstruction(),e.NativeFunction(\"complexDivide\",[e.NativeFunction(\"complex\",[i,e.Constant(0)]),o])):Uu(e,i)&&rs(e,o)?(e.popInstruction(),e.TupleOfType(N,[e.Divide([e.Slot(0,[i]),o]),e.Divide([e.Slot(1,[i]),o])])):eu(e,[i])&&rs(e,o)?(e.popInstruction(),$u(e,[e.Divide([Ss(e,i),o]),$o(e,i)])):qu(e,i)&&rs(e,o)?(e.popInstruction(),e.TupleOfType(H,[e.Divide([e.Slot(0,[i]),o]),e.Divide([e.Slot(1,[i]),o]),e.Divide([e.Slot(2,[i]),o])])):e.getReturnIndex()}case 25:{let[i,o]=t.args;if(cr(e,i)&&cr(e,o)){e.popInstruction();let a=e.Slot(0,[i]),u=e.Slot(0,[o]),c=e.Slot(1,[i]),l=e.Slot(1,[o]);return e.And([e.Equal([a,u]),e.Equal([c,l])])}else if(rs(e,i)&&cr(e,o)){e.popInstruction();let a=i,u=e.Slot(0,[o]),c=e.Constant(0),l=e.Slot(1,[o]);return e.And([e.Equal([a,u]),e.Equal([c,l])])}else if(cr(e,i)&&rs(e,o)){e.popInstruction();let a=e.Slot(0,[i]),u=o,c=e.Slot(1,[i]),l=e.Constant(0);return e.And([e.Equal([a,u]),e.Equal([c,l])])}else return e.getReturnIndex()}case 28:case 29:{let[i,o]=t.args;if(cr(e,i)&&cr(e,o)){e.popInstruction();let a=t.type===28?e.Less(t.args):e.Greater(t.args);return e.Or([a,e.Equal(t.args)])}else return e.getReturnIndex()}case 12:case 13:case 26:case 27:case 32:case 31:case 15:case 33:case 16:case 37:case 42:case 39:case 40:case 41:case 21:case 22:case 19:case 20:case 38:case 47:case 23:case 24:case 48:case 44:case 49:case 50:case 51:case 53:case 54:case 55:return e.getReturnIndex();default:let s=t;throw new Error(`Unexpected opcode ${s.type}`)}}function Uu(e,t){return e.getInstruction(t).valueType===N}function qu(e,t){return e.getInstruction(t).valueType===H}function rs(e,t){return e.getInstruction(t).valueType===I}function cr(e,t){return e.getInstruction(t).valueType===R}function $f(e,t){return e.getInstruction(t).valueType===Gt}function eu(e,t){return t.every(n=>gt(e,n,le))||t.every(n=>gt(e,n,ke))}function $u(e,t){return Ui(e,t,\"mathVector\",Yf(\"mathVector\",\"mathVectorThreeD\"))}function $o(e,t){return Ui(e,[t],\"start\",[{match:[le],build:()=>e.NativeFunction(\"basePointFromVector\",[t])},{match:[ke],build:()=>e.NativeFunction(\"basePointFromVectorThreeD\",[t])}])}function Ss(e,t){return Ui(e,[t],\"displacement\",[{match:[le],build:()=>e.NativeFunction(\"vectorDisplacementAsPoint\",[t])},{match:[ke],build:()=>e.NativeFunction(\"vectorThreeDDisplacementAsPoint\",[t])}])}function Yf(e,t){return[{match:[N,N],build:(n,r)=>n.NativeFunction(e,r)},{match:[H,H],build:(n,r)=>n.NativeFunction(t,r)}]}function Yu(e,t){if(t.type!==33)return!1;let n=e.getInstruction(t.args[2]);return n.type===1&&io(n.valueType)&&_S(n.valueType,n.value)||Yu(e,n)&&VN(e,t.args[1])&&VN(e,n.args[1])}function oM(e,t){let n=[];for(;t.type===33;)n.push(t.args[0]),t=e.getInstruction(t.args[2]);return n}function*gh(e,t){let n=e.getInstruction(t);n.type!==32?yield t:(yield*gh(e,n.args[0]),yield*gh(e,n.args[1]))}function BN(e,t){return e.getInstruction(t).type===25}function GN(e,t){let n=e.getInstruction(t);if(n.type!==25)return;let r=n.args[0],s=n.args[1],i=e.getInstruction(r),o=e.getInstruction(s),a=(o.type===41||o.type===40)&&Je(e.getInstruction(o.args[0]));return i.type===2&&(Je(o)||a)&&se(o.valueType,I)?{type:\"constant\",variable:e.argNames[r],index:s}:se(i.valueType,I)&&se(o.valueType,I)?{type:\"implicit\",index:e.Subtract([r,s])}:void 0}function VN(e,t){let n=e.getInstruction(t);return n.type===1&&n.valueType===I&&V(n.value)===1}var uM=class{constructor(t,n,r,s){this.openChunk=t;this.returnIndex=n;this.restrictionIndex=r;this.slices=s}getSliceVariablesOrImplicit(){return this.slices.map(t=>t.type===\"constant\"?t.variable:\"_implicit\")}getPeeledSlices(){let t=[];for(let n of this.slices)if(n.type===\"constant\"){let r=this.openChunk.getInstruction(n.index);if(Je(r)&&r.valueType===I)t.push({type:\"constant\",variable:n.variable,value:V(r.value)});else if(!(Je(r)&&r.valueType===ne))throw ca()}else if(this.openChunk.getInstruction(n.index).valueType===I){let s=this.openChunk.copy();s.setReturnIndex(n.index),s.fuseBroadcast(),t.push({type:\"implicit\",sliceChunk:s})}else throw ca();return t}getValueAndRestrictionChunk(){let t=this.getPeeledSlices(),n=this.openChunk.copy();n.setReturnIndex(this.returnIndex),n.fuseBroadcast();let r;return this.restrictionIndex!==void 0&&(r=this.openChunk.copy(),r.setReturnIndex(this.restrictionIndex),r.fuseBroadcast()),{valueChunk:n,restrictionChunk:r,slices:t}}getSlicesAndRestrictionChunk(){let t=this.getPeeledSlices(),n=this.openChunk.copy(),r=n.GreaterEqual([this.returnIndex,n.Constant(0)]);return this.restrictionIndex!==void 0&&(r=n.And([r,this.restrictionIndex])),n.setReturnIndex(r),n.fuseBroadcast(),{restrictionChunk:n,slices:t}}},hh=class{constructor(t,n,r){this.chunk=t;this.slices=[];this.oldIPtoNewIP=[];this.oldIPToRestriction=[];var s,i;this.produceNumbers=(s=r==null?void 0:r.produceNumbers)!=null?s:!1,this.allowSlices=(i=r==null?void 0:r.allowSlices)!=null?i:!1,this.newChunk=new Ia({argNames:t.argNames,argTypes:t.argTypes}),this.startTrue=this.produceNumbers?this.newChunk.Constant(1/0):this.newChunk.ConstantOfType(De,!0),this.peelable=$H(t),XH(t,this.peelable,n)}selectRestriction(){return!0}},cM=class extends hh{constructor(n,r,s){super(n,r,s);this.currSelectIndex=0;this.selectIndex=s.selectIndex}selectRestriction(){let n=this.selectIndex===this.currSelectIndex;return this.currSelectIndex++,this.produceNumbers?n:!n}};function tu(e,t,n){let r=new hh(e,t,n);lM(r,0,e.instructionsLength()-1);let s=r.oldIPToRestriction[e.getReturnIndex()];return new uM(r.newChunk,r.oldIPtoNewIP[e.getReturnIndex()],r.startTrue===s?void 0:s,r.slices)}function*kN(e,t,n){var s,i;let r=aM(e,n,{produceNumbers:!1,selectIndex:0});if(r===void 0||r.count<=1){yield{value:t,restriction:void 0};return}for(let o=0;o<r.count;o++){let a=(s=aM(e,n,{produceNumbers:!0,selectIndex:o}))==null?void 0:s.chunk,u=o===0?r.chunk:(i=aM(e,n,{produceNumbers:!1,selectIndex:o}))==null?void 0:i.chunk;if(!a||!u)throw new Error(\"Programming Error: selectIndex gave invalid chunk.\");yield{value:a,restriction:u}}}function aM(e,t,n){let r=new cM(e,t,n);lM(r,0,e.instructionsLength()-1);let s=r.oldIPToRestriction[e.getReturnIndex()];if(r.currSelectIndex===0)return;let i=r.oldIPtoNewIP[e.getReturnIndex()],o=r.newChunk.getInstruction(i);if(o.type!==29)throw new Error(\"Programming Error: Expected GreaterEqual.\");let a=r.produceNumbers?r.newChunk.Subtract([o.args[0],o.args[1]]):i;return r.selectRestriction()&&(s=bh(r,[s,a])),r.newChunk.setReturnIndex(s),{chunk:r.newChunk,count:r.currSelectIndex}}function lM(e,t,n){let{chunk:r,newChunk:s,peelable:i,oldIPtoNewIP:o,oldIPToRestriction:a}=e;for(let u=t;u<=n;u++){let c=r.getInstruction(u);if(i[u]&&(c.type===19||c.type===23))u=qH(e,u);else if(c.type===2)o[u]=u,a[u]=e.startTrue;else if(ge(c))o[u]=s.copyInstruction(c),a[u]=e.startTrue;else if(i[u]&&Yu(r,c)){o[u]=o[c.args[1]];let l=c.args.map(p=>a[p]);for(let p of ZH(e,c))e.selectRestriction()&&l.push(p);a[u]=bh(e,l)}else o[u]=s.copyInstructionWithArgs(c,c.args.map(l=>o[l])),a[u]=bh(e,c.args.map(l=>a[l]))}}function bh(e,t){let r=[...new Set(t)].filter(s=>!HN(e,s));return r.length?xh(e,r).reduce((s,i)=>e.produceNumbers?e.newChunk.NativeFunction(\"listMin\",[s,i]):e.newChunk.And([s,i])):e.startTrue}function UH(e,t){let n=[...new Set(t)];return n.some(r=>!HN(e,r))?xh(e,n).reduce((r,s)=>e.produceNumbers?e.newChunk.NativeFunction(\"listMax\",[r,s]):e.newChunk.Or([r,s])):e.startTrue}function xh(e,t){if(!e.produceNumbers)return t;let n=e.newChunk;return t.map(r=>{let s=n.getInstruction(r);if(s.valueType!==De)return r;switch(s.type){case 27:case 29:return n.Subtract([s.args[0],s.args[1]]);case 26:case 28:return n.Subtract([s.args[1],s.args[0]]);case 25:throw z(\"convertBoolsToNums on an equality.\");case 32:return n.NativeFunction(\"listMin\",xh(e,s.args));case 31:return n.NativeFunction(\"listMax\",xh(e,s.args));case 1:return n.Constant(s.value?1/0:-1/0);default:throw z(\"convertBoolsToNums on a non-opcode condition.\")}})}function HN({newChunk:e},t){let n=e.getInstruction(t);return n.type===1&&(n.valueType===I&&n.value===1/0||n.valueType===De&&n.value)}function qH(e,t){let{chunk:n,newChunk:r,oldIPtoNewIP:s,oldIPToRestriction:i,startTrue:o}=e,a=n.getInstruction(t),u=a.endIndex,c=n.getInstruction(u),l,p;if(a.type===23)s[t]=r.copyInstructionWithArgs(a,[s[a.args[0]]]),i[t]=o,p=t+1;else{let g=a.args.map(m=>s[m]);g.push(o),s[t]=r.copyInstructionWithArgs(a,g),i[t]=o;for(let m=2;m<a.args.length;m++){let h=t+m-1;s[h]=r.copyInstructionWithArgs(n.getInstruction(h),[s[t]]),i[h]=o}l=r.BlockVar(e.produceNumbers?I:De,[s[t]]),p=t+a.args.length-1}lM(e,p,u-1);let f=c.args.map(g=>s[g]),d=e.slices.filter(g=>p<=g.index&&g.index<u),y=l;if(a.type===19){if(l===void 0)throw new Error(\"Expected restrictionAccumVar to be defined\");y=bh(e,[l,i[c.args[1]]]),f.push(y)}else{f.push(i[c.args[1]]);for(let g of d)f.push(g.index)}s[u]=r.copyInstructionWithArgs(c,f),i[u]=o;for(let g=1;g<c.args.length;g++)s[u+g]=r.copyInstructionWithArgs(n.getInstruction(u+g),[s[u]]);if(a.type===23){let g=r.BroadcastResult(e.produceNumbers?ne:Xn,[s[u]]);for(let m of d)m.index=r.BroadcastResult(ne,[s[u]]);for(let m=1;m<c.args.length;m++)i[u+m]=g}else{let g=r.BlockVar(e.produceNumbers?I:De,[s[u]]);l===y&&(g=o);for(let m=1;m<c.args.length;m++)i[u+m]=g}return u+c.args.length-1}function $H(e){let t=[];for(let r=0;r<e.instructionsLength();r++)t.push(!1);t[e.getReturnIndex()]=!0;let n=e.instructionsLength()-1;for(let r=n;r>=0;r--){if(!t[r])continue;let s=e.getInstruction(r);if(!ge(s))for(let i of YH(e,s))t[i]=!0}return t}function YH(e,t){switch(t.type){case 14:case 8:case 9:case 26:case 28:case 27:case 29:case 10:case 11:case 12:case 13:case 25:case 32:case 15:case 38:case 47:case 19:case 39:case 40:case 41:case 23:case 24:case 48:case 50:return t.args;case 33:return Yu(e,t)?oM(e,t).concat([t.args[1]]):[];case 37:{let r=Bn[t.symbol];return r.noPeel?[]:r.tag===\"reducer\"||r.tag===\"doubleReducer\"||r.tag===\"never-broadcast\"||r.tag===\"parameterizedReducer\"?t.args.filter(s=>e.getInstruction(s).type!==48):t.args}case 20:return t.args.slice(1);case 51:return[t.args[1]];case 31:return[];case 16:case 42:case 21:case 22:case 44:case 49:case 53:case 54:case 55:return[];default:let n=t;throw new Error(`Unexpected opcode ${n.type}`)}}function XH(e,t,n){let r=[];for(let s=0;s<e.argNames.length;s++){let i=e.argNames[s];n.indexOf(i)<0&&r.push(s)}for(let s of r){let i=Vu(e,s);for(let o=0;o<e.instructionsLength();o++)t[s]&&(t[s]=!i[o])}}function ZH(e,t){let n=oM(e.chunk,t).map(r=>e.oldIPtoNewIP[r]);if(e.allowSlices&&n.length===1){let r=GN(e.newChunk,n[0]);if(r)return e.slices.push(r),[]}if(n.some(r=>BN(e.newChunk,r)))throw ca();if(n.length===1){let r=n[0];return[...gh(e.newChunk,r)]}return[UH(e,n)]}function zN(e,t){let n=[],r=[],s=[];for(let o=0;o<e.argNames.length;o++)t.hasOwnProperty(e.argNames[o])||(n.push(e.argNames[o]),r.push(e.argTypes[o]));let i=new Ia({argNames:n,argTypes:r});for(let o=0,a=0;o<e.argNames.length;o++)t.hasOwnProperty(e.argNames[o])?s[o]=i.ConstantOfType(e.argTypes[o],t[e.argNames[o]]):(s[o]=a,a+=1);for(let o=e.argNames.length;o<e.instructionsLength();o++){let a=e.getInstruction(o);if(ge(a))s.push(po(i,a));else{let u=[];for(let c of a.args)u.push(s[c]);s.push(_n(i,a,u))}}return i}function li(e){let t=e;if(t&&typeof t.toJSON==\"function\"&&(t=t.toJSON()),!t||typeof t!=\"object\")return t;if(Array.isArray(t))return t.map(li);let n={};for(let r in t)t.hasOwnProperty(r)&&(n[r]=li(t[r]));return n}var Th=class e{constructor(){this.maps={real:{},complexOne:{},complexI:{}}}clone(){let t=new e;return t.maps=li(this.maps),t}pruneIP(t){for(let n of Object.values(this.maps))delete n[t]}truncate(t){for(let n of Object.values(this.maps))for(let r in n){let s=+r;s>=t?delete n[s]:WH(n[s],t)}}getMapEntry(t,n,r){let s=this.maps[n],i=s[r];if(i)return i;let o={maxValidReference:t.instructionsLength()-1,map:[]};return s[r]=o,o}_cachedDerivativesForTests(){let t=[];for(let[n,r]of Object.entries(this.maps))for(let s in r)t.push(`${s} ${n}`);return t.sort(),t}};function WH(e,t){e.map.length=Math.min(e.map.length,t),e.maxValidReference=Math.min(e.maxValidReference,t-1)}var jH={\"+\":!0,\"-\":!0,\"*\":!0,\"\\\\cdot\":!0,\"\\\\times\":!0,\"/\":!0,\"!\":!0,\"(\":!0,\")\":!0,\"\\\\{\":!0,\"\\\\}\":!0,\"(|\":!0,\"|)\":!0,\"[\":!0,\"]\":!0,\",\":!0,\"...\":!0,\":\":!0,\"=\":!0,\">\":!0,\"<\":!0,\">=\":!0,\"<=\":!0,\"->\":!0,\"~\":!0,\"%\":!0,\".\":!0,for:!0,with:!0,Letter:!0,Decimal:!0,Cmd:!0,TokenNode:!0,Differential:!0,End:!0,Trig:!0,Ln:!0,Log:!0,Int:!0,Sum:!0,Prod:!0,Err:!0};function $K(e){let t=nu[e];if(!t)return!0;switch(t){case\"Ln\":case\"Log\":case\"for\":case\"with\":case\"Trig\":return!0;default:return!1}}var nu={\"\\\\lt\":\"<\",\"\\\\gt\":\">\",\"\\\\le\":\"<=\",\"\\\\ge\":\">=\",\"\\\\leq\":\"<=\",\"\\\\geq\":\">=\",\"\\\\ldots\":\"...\",\"\\\\sim\":\"~\",\"\\\\to\":\"->\",\"\\\\cdot\":\"\\\\cdot\",\"\\\\times\":\"\\\\times\",\"\\\\div\":\"/\",\"\\\\ln\":\"Ln\",\"\\\\log\":\"Log\",\"\\\\int\":\"Int\",\"\\\\sum\":\"Sum\",\"\\\\prod\":\"Prod\",\"\\\\backslash\":\"Err\",\"\\\\for\":\"for\",\"\\\\with\":\"with\"},JH=[\"sin\",\"cos\",\"tan\",\"cot\",\"sec\",\"csc\"];for(let e of JH)nu[\"\\\\\"+e]=\"Trig\",nu[\"\\\\\"+e+\"h\"]=\"Trig\",nu[\"\\\\arc\"+e]=\"Trig\",nu[\"\\\\arc\"+e+\"h\"]=\"Trig\",nu[\"\\\\ar\"+e+\"h\"]=\"Trig\";function YK(e){return e===\"\\\\log\"||e===\"\\\\prod\"||e===\"\\\\sum\"||e===\"\\\\int\"}var pM={\"+\":\"+\",\"-\":\"-\",\"*\":\"*\",\"/\":\"/\",\"!\":\"!\",\"(\":\"(\",\")\":\")\",\"[\":\"[\",\"]\":\"]\",\",\":\",\",\"...\":\"...\",\":\":\":\",\"=\":\"=\",\">=\":\">=\",\"<=\":\"<=\",\">\":\">\",\"<\":\"<\",\"~\":\"~\",\".\":\".\"},UN={\"\\\\{\":\"\\\\{\",\"\\\\}\":\"\\\\}\",\"\\\\%\":\"%\"},qN={\"|\":\"(|\",\"\\\\{\":\"\\\\{\",\"[\":\"[\",\"(\":\"(\"},$N={\"|\":\"|)\",\"\\\\}\":\"\\\\}\",\"]\":\"]\",\")\":\")\"},YN=Object.keys(jH);function XN(e){return 48<=e&&e<=57}function QH(e){return 97<=e&&e<=122}function KH(e){return 65<=e&&e<=90}function Ih(e){return QH(e)||KH(e)}function Ph(e){return e===92}function dM(e){return e===39}function ZN(e){if(9<=e&&e<=13||8192<=e&&e<=8202)return!0;switch(e){case 32:case 160:case 5760:case 8232:case 8233:case 8239:case 8287:case 12288:case 65279:return!0;default:return!1}}var ez={mcd:\"gcd\",gcf:\"gcd\",mcm:\"lcm\",signum:\"sign\",sgn:\"sign\",stdDevP:\"stdevp\",stddevp:\"stdevp\",stdDev:\"stdev\",stddev:\"stdev\",variance:\"var\",TTest:\"ttest\",TScore:\"tscore\",IndependentTTest:\"ittest\",iTTest:\"ittest\",inverseCdf:\"quantile\",inversecdf:\"quantile\",arsinh:\"arcsinh\",arcosh:\"arccosh\",artanh:\"arctanh\",arcsch:\"arccsch\",arsech:\"arcsech\",arcoth:\"arccoth\"};function WN(e){let t=0;for(;Ph(e.charCodeAt(t));)t+=1;return t>0&&(e=e.slice(t)),ez[e]||e}function jN(e,t,n){return{type:\"Comparator\",span:e,symbol:t,args:n}}function JN(e,t,n){if(t.length<1)throw\"Programming Error: ComparatorChain must have at least one comparator.\";if(n.length!==t.length+1)throw\"Programming Error: ComparatorChain must have one more arg than symbols\";return{type:\"ComparatorChain\",span:e,args:n,symbols:t}}function QN(e,t){return{type:\"Tilde\",span:e,args:t}}function KN(e,t){return{type:\"Pos\",span:e,args:t}}function eR(e,t){return{type:\"Neg\",span:e,args:t}}function tR(e,t){return{type:\"Add\",span:e,args:t}}function nR(e,t){return{type:\"Sub\",span:e,args:t}}function rR(e,t){return{type:\"Mul\",span:e,args:t}}function sR(e,t){return{type:\"DotMul\",span:e,args:t}}function iR(e,t){return{type:\"CrossMul\",span:e,args:t}}function oR(e,t){return{type:\"Div\",span:e,args:t}}function aR(e,t){return{type:\"Bang\",span:e,args:t}}function Xf(e,t){return{type:\"Call\",span:e,args:t}}function fM(e,t){return{type:\"ImplicitCall\",span:e,args:t}}function uR(e,t){return{type:\"Index\",span:e,args:t}}function mM(e,t){return{type:\"Paren\",span:e,args:t}}function yM(e,t){return{type:\"List\",span:e,args:t}}function cR(e,t){return{type:\"Pipes\",span:e,args:t}}function gM(e,t){return{type:\"Subscript\",span:e,args:t}}function Eh(e,t){return{type:\"Superscript\",span:e,args:t}}function Zf(e,t,n){return{type:\"Prime\",span:e,nprimes:t,args:n}}function Mh(e,t){return{type:\"Seq\",span:e,args:t}}function lR(e,t){return{type:\"Sqrt\",span:e,args:t}}function pR(e,t){return{type:\"Nthroot\",span:e,args:t}}function dR(e,t){return{type:\"Frac\",span:e,args:t}}function fR(e,t){return{type:\"Derivative\",span:e,args:t}}function mR(e,t){return{type:\"Integral\",span:e,args:t}}function yR(e,t){return{type:\"EmptyIntegral\",span:e,args:t}}function gR(e,t){return{type:\"Sum\",span:e,args:t}}function hR(e,t){return{type:\"Product\",span:e,args:t}}function bR(e,t){return{type:\"Piecewise\",span:e,args:t}}function xR(e){return{type:\"EmptyPiecewise\",span:e}}function TR(e){return{type:\"EmptyRangeEnd\",span:e}}function IR(e,t){return{type:\"Colon\",span:e,args:t}}function hM(e,t){return{type:\"Ellipsis\",span:e,args:t}}function PR(e,t){return{type:\"For\",span:e,args:t}}function ER(e,t){return{type:\"With\",span:e,args:t}}function MR(e,t){return{type:\"Dot\",span:e,args:t}}function CR(e,t){return{type:\"PercentOf\",span:e,args:t}}function DR(e,t){return{type:\"RightArrow\",span:e,args:t}}function bM(e,t){return{type:\"Juxt\",span:e,args:t}}function SR(e,t){return{type:\"Letter\",span:e,val:t}}function Ch(e,t){return{type:\"Decimal\",span:e,val:t}}function gl(e,t){return{type:\"Cmd\",span:e,val:WN(t)}}function vR(e,t){return{type:\"Alphanumeric\",span:e,val:t}}function OR(e,t,n,r){return{type:\"MixedNumber\",span:e,whole:t,num:n,den:r}}function lr(e){if(e.type===\"Subscript\"){if(e.args[1].type!==\"Alphanumeric\")return!1;e=e.args[0]}switch(e.type){case\"Cmd\":return!0;case\"Letter\":return!0;default:return!1}}function NR(e){return e.type!==\"Superscript\"?!1:lr(e.args[0])}function RR(e,t){if(e.type!==\"Letter\"||e.val!==\"d\"||t.type!==\"Juxt\")return!1;let[n,r]=t.args;return n.type!==\"Letter\"||n.val!==\"d\"?!1:lr(r)}function Sr(e){return e.type===\"Seq\"?e.args:[e]}function AR(e,t,n,r,s,i,o,a){return{opts:e,input:t,prevSpan:n,startIndex:r,endIndex:s,token:i,mode:o,parent:a}}function Pe(e,t){return Bs(e.token.span,t.prevSpan)}function er(e,t){return Bs(e,t.prevSpan)}function TM(e){return No(e.token.span.input,e.token.span.start)}function nz(e,t){return{type:\"Differential\",span:e,val:t}}function vs(e,t,n){return{type:e,span:t,val:n}}function ru(e,t){let n=No(e.span.input,e.span.start);return IM(t,e,0,n,void 0,void 0)}function IM(e,t,n,r,s,i){let o=t.args;if(n>o.length&&i)return _R(i,r);n=Wf(o,n);let{token:a,endIndex:u}=LR(t,n,s);if(a.type===\"End\"&&i){let c=i.input.args[i.startIndex];if(c.type===\"LeftRight\"){let l=c.right,p=$N[l.val]||\"Err\",f=vs(p,l.span,l.val);return AR(e,t,r,n,u,f,s,i)}}else a.type===\"Int\"?s=rz(s):a.type===\"Differential\"&&(s=sz(s));return AR(e,t,r,n,u,a,s,i)}function Xe(e){let t=e.input.args[e.startIndex],n=e.token.span;return t&&t.type===\"LeftRight\"?IM(e.opts,t.arg,0,n,e.mode,e):_R(e,n)}function _R(e,t){let{input:n,endIndex:r,mode:s,parent:i}=e;return IM(e.opts,n,r+1,t,s,i)}function ss(e){return e.token}function rz(e){return{type:\"integral\",parent:e}}function sz(e){if(!e||e.type!==\"integral\")throw new Error(\"Programming Error: expected lexer to be in integral mode.\");return e.parent}function Hr(e,t){return ss(e).type===t}function vh(e){return e.startIndex>=e.input.args.length}function PM(e,t){return t.token.span.start>e.token.span.start}function xr(e,t){return{token:t,endIndex:e}}function LR(e,t,n){let r=e.args;if(t>=r.length){let i=No(e.span.input,e.span.end);return xr(t,vs(\"End\",i,\"\"))}let s=e.args[t];switch(s.type){case\"Sqrt\":case\"Frac\":case\"SupSub\":return xr(t,s);case\"Letter\":{if(!n||n.type!==\"integral\"||s.val!=\"d\")return xr(t,s);let{endIndex:c,token:l}=LR(e,t+1,n);if(l.type===\"Letter\"||l.type===\"Cmd\"){let p=nz(Bs(s.span,l.span),l.val);return xr(c,p)}else return xr(t,s)}case\"LeftRight\":{let c=s.left,l=qN[c.val]||\"Err\",p=Bs(s.span,c.span);return xr(t,vs(l,p,c.val))}case\"OperatorName\":let i=[];for(let c of s.arg.args){if(c.type!==\"Letter\")return xr(t,vs(\"Err\",s.span,Yn(s.arg.span)));i.push(c.val)}let o=\"\\\\\"+i.join(\"\"),a=nu[o]||\"Cmd\";return xr(t,vs(a,s.span,o));case\"TokenNode\":{let c=\"$\";if(s.arg.args.length===0)return xr(t,vs(\"Err\",s.span,Yn(s.arg.span)));for(let l of s.arg.args){if(l.type!==\"Digit\")return xr(t,vs(\"Err\",s.span,Yn(s.arg.span)));c+=l.val}return xr(t,vs(\"TokenNode\",s.span,c))}case\"Cmd\":{let c=nu[s.val]||\"Cmd\";return xr(t,vs(c,s.span,s.val))}case\"EscapedSymbol\":{let c=UN[s.val]||\"Err\";return xr(t,vs(c,s.span,s.val))}case\"Symbol\":return iz(e,t,s);case\"Digit\":return wR(e,t);default:throw`Unexpected atom ${s.type}.`}}function iz(e,t,n){switch(n.val){case\".\":return oz(e,t);case\"-\":{let s=e.args[t+1];if(s&&Dh(s,\">\")){let i=vs(\"->\",Bs(n.span,s.span),\"->\");return xr(t+1,i)}break}case\"<\":{let s=e.args[t+1];if(s&&Dh(s,\"=\")){let i=vs(\"<=\",Bs(n.span,s.span),\"<=\");return xr(t+1,i)}break}case\">\":{let s=e.args[t+1];if(s&&Dh(s,\"=\")){let i=vs(\">=\",Bs(n.span,s.span),\">=\");return xr(t+1,i)}break}}let r=pM[n.val]||\"Err\";return xr(t,vs(r,n.span,n.val))}function oz(e,t){let n=e.args[t];if(n.type!==\"Symbol\"||n.val!==\".\")throw new Error(\"Programming Error: expected '.'\");if(t+2<e.args.length&&Sh(e.args[t+1])&&Sh(e.args[t+2])){let i=Bs(n.span,e.args[t+2].span);return xr(t+2,vs(\"...\",i,Yn(i)))}let r=Wf(e.args,t+1);if(r<e.args.length&&e.args[r].type===\"Digit\")return wR(e,t);let s=pM[n.val]||\"Err\";return xr(t,vs(s,n.span,n.val))}function wR(e,t){let n=az(e,t);if(n)return n;let r=e.args,s=e.args[t].span,i=[],o=!1,a=!1;for(;t<r.length;t++){let c=Wf(r,t);if(c>=r.length)break;let l=r[c];if(l.type===\"Digit\")t=c,o=!0,i.push(l.val);else if(!a&&Sh(l)){if(c+1<r.length&&Sh(e.args[c+1]))break;t=c,a=!0,i.push(\".\")}else break}if(!o)throw new Error(\"Programming Error: decimals must have at least one digit.\");let u=Bs(s,e.args[t-1].span);return xr(t-1,vs(\"Decimal\",u,i.join(\"\")))}function az(e,t){let n=e.args,r=n[t].span,s=[];for(;t<n.length;t++){let c=Wf(n,t);if(c>=n.length)break;let l=n[c];if(l.type!==\"Digit\")break;t=c,s.push(l.val)}if(t=Wf(n,t),t>=n.length)return;let i=n[t];if(i.type!==\"Frac\")return;let o=[],a=[];for(let c of i.num.args)if(!xM(c)){if(c.type!==\"Digit\")return;o.push(c.val)}for(let c of i.den.args)if(!xM(c)){if(c.type!==\"Digit\")return;a.push(c.val)}let u=Bs(r,i.span);return xr(t,OR(u,s.join(\"\"),o.join(\"\"),a.join(\"\")))}function xM(e){switch(e.type){case\"Sqrt\":case\"Frac\":case\"SupSub\":case\"LeftRight\":case\"OperatorName\":case\"TokenNode\":case\"Symbol\":case\"Letter\":case\"Digit\":return!1;case\"Cmd\":return e.val===\"\\\\space\";case\"EscapedSymbol\":return e.val===\"\\\\ \"||e.val===\"\\\\:\"||e.val===\"\\\\,\"||e.val===\"\\\\;\";default:throw`Unexpected atom ${e.type}.`}}function Wf(e,t){for(;t<e.length&&xM(e[t]);)t+=1;return t}function Sh(e){return Dh(e,\".\")}function Dh(e,t){return e.type===\"Symbol\"&&e.val===t}var Kp={},uz=[\"sin\",\"cos\",\"tan\",\"cot\",\"sec\",\"csc\",\"sinh\",\"cosh\",\"tanh\",\"coth\",\"sech\",\"csch\"];uz.forEach(e=>{Kp[e]=\"arc\"+e,Kp[\"arc\"+e]=e});var cz=0;function zR(e,t){return lz(e,t)}function It(e,t){let n=[];for(let r=0;r<t.length;r++)n.push(mn(e,t[r]));return n}function FR(e,t,n){let r=e.nodes,[s,i]=It(e,t);if(Rh(n)){let o=No(n.span.input,n.span.end),a=e.setInput(XR(e),o);i=e.setInput(r.SeededFunctionCall(i,[a]),n.span)}return[s,i]}function lz(e,t){return e.setInput(pz(e,t),t.span)}function UR(e){if(e.type!==\"Call\")return;let[t,n]=e.args,r=Sr(n);if(lr(t)&&r.every(lr))return{base:t,args:r}}function qR(e){return UR(e)!==void 0}function CM(e){return lr(e)}function pz(e,t){let n=e.nodes;switch(t.type){case\"Comparator\":if(t.symbol===\"=\"){let[r,s]=t.args,i=UR(r);if(i){let{base:o,args:a}=i,u=It(e,a),c=e;if(e.includeFunctionParametersInRandomSeed)for(let p of u)c=Qf(c,{prefix:\"fc\",expr:p});let l=mn(c,s);return n.FunctionDefinition(mn(e,o),u,l)}else{if(r.type===\"Call\"&&lr(r.args[0]))return n.CallAssignment(mn(e,r),mn(e,s));if(CM(r)){let o;return s.type===\"For\"?o=e.setInput(Oh(e,s,{parentIsList:!1}),s.span):o=mn(e,s),n.Assignment(mn(e,r),o)}}return n.Equation(mn(e,r),mn(e,s))}else return Ca(e,t);case\"Tilde\":{let[r,s]=It(e,t.args);return n.Regression(r,s)}case\"ComparatorChain\":{if(!e.specializeDoubleInequalities||t.symbols.length!==2)return Ca(e,t);let[r,s,i]=t.args,[o,a]=t.symbols;return!lr(s)||t.symbols.includes(\"=\")?Ca(e,t):n.DoubleInequality([mn(e,r),o,mn(e,s),a,mn(e,i)])}case\"Call\":{let[r,s]=t.args;if(r.type===\"Cmd\")switch(r.val){case\"histogram\":return n.Histogram(It(e,Sr(s)));case\"dotplot\":return n.DotPlot(It(e,Sr(s)));case\"boxplot\":return n.BoxPlot(It(e,Sr(s)));case\"ttest\":return n.TTest(It(e,Sr(s)));case\"ittest\":return n.IndependentTTest(It(e,Sr(s)));case\"stats\":return n.Stats(It(e,Sr(s)));default:return jf(e,t)}return jf(e,t)}case\"For\":return Oh(e,t,{parentIsList:!1});default:return jf(e,t)}}function $R(e){if(e.type!==\"Paren\")return!1;let[t]=e.args;return t.type!==\"Seq\"?!1:t.args.length===2||t.args.length===3}function VR(e,t,n,r){let s=dz(e,n,r);if(s!==void 0)return e.setInput(s,Bs(t.args[0].span,r.span))}function dz(e,t,n){let r=e.nodes;if(n.type===\"Letter\")switch(n.val){case\"x\":case\"y\":case\"z\":return r.NamedCoordinateAccess(n.val,[t])}else if(n.type===\"Cmd\")switch(n.val){case\"real\":case\"imag\":throw nT(n.val)}}function mn(e,t){return e.setInput(jf(e,t),t.span)}function jf(e,t){let n=e.nodes;switch(t.type){case\"Pos\":return mn(e,t.args[0]);case\"Neg\":let r=-1,s=t.args[0];for(;;)if(s.type===\"Pos\"||s.type===\"Paren\"&&!$R(s))s=s.args[0];else if(s.type===\"Neg\")s=s.args[0],r*=-1;else break;switch(s.type){case\"Decimal\":{let o=kR(s);return n.Constant(r===-1?Us(o):o)}case\"MixedNumber\":{let o=HR(s);return n.MixedNumber(r===-1?Us(o):o)}default:return r===-1?n.Negative([mn(e,s)]):mn(e,s)}case\"Add\":return n.Add(It(e,t.args));case\"Sub\":return n.Subtract(It(e,t.args));case\"Mul\":return n.Multiply(It(e,t.args));case\"DotMul\":return n.DotMultiply(It(e,t.args));case\"CrossMul\":return n.CrossMultiply(It(e,t.args));case\"Div\":return n.Divide(It(e,t.args));case\"Bang\":{let[o]=t.args;return o.type===\"Call\"&&lr(o.args[0])&&!Rh(o.args[0])&&Sr(o.args[1]).length===1?n.FunctionFactorial(It(e,o.args)):n.FunctionCall(\"\\\\factorial\",It(e,t.args))}case\"PercentOf\":return n.PercentOf(It(e,t.args));case\"Call\":return BR(e,t);case\"ImplicitCall\":return bz(t),BR(e,t);case\"Dot\":{let o=t.args[1],[a,u]=FR(e,t.args,o);if(o.type===\"Letter\")switch(o.val){case\"x\":case\"y\":case\"z\":return n.NamedCoordinateAccess(o.val,[a]);default:break}else if(o.type===\"Call\"){let c=o.args[0],l=VR(e,t,a,c);if(l!==void 0)return n.Multiply([l,mn(e,o.args[1])])}return n.DotAccess([a,u])}case\"Prime\":{let[o]=t.args;if(o.type===\"Call\"){let[a,u]=o.args,c=Sr(u).length;if(a.type===\"Cmd\"&&a.val===\"logbase\"){if(c!==2)throw Nc()}else if(c!==1)throw Nc();return n.Prime(t.nprimes,It(e,t.args))}else throw o.type===\"ImplicitCall\"?Cy():My()}case\"Index\":{let[o,a]=t.args;if(a.type===\"Seq\")return n.ListAccess([mn(e,o),e.setInput(n.List(It(e,a.args)),void 0)]);if(a.type===\"Ellipsis\"){let[u,c]=a.args;return n.ListAccess([mn(e,o),e.setInput(n.Range([e.setInput(n.List(It(e,Sr(u))),void 0),e.setInput(n.List(c.type===\"EmptyRangeEnd\"?[]:It(e,Sr(c))),void 0)]),void 0)])}return Jf(a)?n.ListAccess([mn(e,o),e.setInput(Ca(e,a),void 0)]):n.ListAccess(It(e,t.args))}case\"Paren\":{let[o]=t.args;if(o.type===\"Seq\"){if(o.args.length===0)throw $d();return n.ParenSeq(It(e,o.args))}else return mn(e,o)}case\"List\":{if(t.args.length===0)return n.List([]);let o=t.args[0];if(o.type===\"Ellipsis\"){let[a,u]=o.args;return n.Range([e.setInput(n.List(It(e,Sr(a))),void 0),e.setInput(n.List(It(e,Sr(u))),void 0)])}else if(o.type===\"For\")return Oh(e,o,{parentIsList:!0});return n.List(It(e,Sr(o)))}case\"Pipes\":{let[o]=t.args;return n.Norm([mn(e,o)])}case\"Subscript\":{let[o,a]=t.args;if(a.val.length===0)throw Ey();let u;switch(o.type){case\"Letter\":u=o.val;break;case\"Cmd\":u=o.val;break;default:throw lI()}if(u===\"ans\")throw ks(\"ans\");return n.Identifier(`${u}_${a.val}`)}case\"Superscript\":{let[o,a]=t.args;if(o.type===\"Call\"&&o.args[1].type!==\"Seq\"&&!Rh(o.args[0])&&!xz(o))return n.FunctionExponent(It(e,[o.args[0],o.args[1],a]));if(o.type===\"Dot\"){let u=o.args[1],[c,l]=FR(e,o.args,u),p=mn(e,a);if(u.type===\"Letter\")switch(u.val){case\"x\":case\"y\":case\"z\":return n.Exponent([e.setInput(n.NamedCoordinateAccess(u.val,[c]),o.span),p]);default:break}else if(u.type===\"Call\"){let f=u.args[0],d=VR(e,o,c,f);if(d!==void 0)return n.Multiply([d,e.setInput(n.Exponent([mn(e,u.args[1]),p]),Vs(t.span.input,u.args[0].span.end,a.span.end))])}return n.Exponent([e.setInput(n.DotAccess([c,l]),o.span),p])}else return n.Exponent(It(e,t.args))}case\"Sqrt\":return n.FunctionCall(\"sqrt\",It(e,t.args));case\"Nthroot\":return n.FunctionCall(\"nthroot\",It(e,[t.args[1],t.args[0]]));case\"Frac\":return n.Divide(It(e,t.args));case\"Derivative\":{let o=It(e,t.args);if(!lr(t.args[0]))throw z(`Expected identifier in derivative, but found ${t.args[0].type}`);return n.Derivative(o[0],[o[1]])}case\"Integral\":{let[o,a,u,c]=t.args,l=It(e,[o,a,u,c]);return n.Integral(l)}case\"EmptyIntegral\":{let[o,a,u]=It(e,t.args),c=e.setInput(n.Constant(Se(1,1)),void 0);return n.Integral([o,a,u,c])}case\"Sum\":{let[o,a,u]=t.args;if(a.type!==\"Comparator\"||!ed(a))throw aP();let c=It(e,[a.args[0],a.args[1],u]),l=mn(Qf(e,{prefix:\"ro\",expr:c[0]}),o);return n.Sum(c.concat(l))}case\"Product\":{let[o,a,u]=t.args;if(a.type!==\"Comparator\"||!ed(a))throw uP();let c=It(e,[a.args[0],a.args[1],u]),l=mn(Qf(e,{prefix:\"ro\",expr:c[0]}),o);return n.Product(c.concat(l))}case\"Juxt\":{if(e.writeIntegral){let[u,c]=t.args;if(c.type===\"Letter\"&&c.val===\"t\"&&u.type===\"Juxt\"&&([u,c]=u.args,c.type===\"Letter\"&&c.val===\"n\")){if(u.type===\"Juxt\"){if([u,c]=u.args,c.type===\"Letter\"&&c.val===\"i\")throw Gy()}else if(u.type===\"Letter\"&&u.val===\"i\")throw Gy()}}let[o,a]=t.args;if(o.type===\"MixedNumber\"&&!(lr(a)||a.type===\"Piecewise\"||a.type===\"Call\"||a.type===\"Paren\"))throw Ty(Nh(o));if(a.type===\"MixedNumber\")throw Ty(Nh(a));return n.Multiply(It(e,t.args))}case\"Letter\":return n.Identifier(t.val);case\"Cmd\":{let o=t.val;switch(o){case\"ans\":{if(e.currentIndex===void 0)throw Qd(\"ans\");return n.Ans(`ans_{${e.currentIndex-1}}`)}case\"approx\":throw uy(o);case\"dt\":{if(!e.allowDt)throw Qd(o);return n.Identifier(o)}case\"index\":{if(!e.allowIndex)throw Qd(o);return n.Identifier(o)}default:return n.Identifier(o)}}case\"With\":{if(e.isSubstitutionRHS)throw $y();let[o,a]=t.args,u={...e,isSubstitutionRHS:!0};return n.Substitution(mn(u,o),yz(u,a))}case\"Decimal\":return n.Constant(kR(t));case\"MixedNumber\":return n.MixedNumber(HR(t));case\"Piecewise\":return hz(e,t);case\"RightArrow\":return gz(e,t);case\"Seq\":return n.BareSeq(It(e,t.args));case\"EmptyPiecewise\":return n.Restriction([e.setInput(n.Constant(!0),No(t.span.input,t.span.start))]);case\"Comparator\":throw t.symbol===\"=\"?ks(\"=\"):cy();case\"ComparatorChain\":throw t.symbols.includes(\"=\")?wx():cy();case\"Tilde\":throw ks(\"~\");case\"Colon\":throw ks(\":\");case\"Ellipsis\":throw ks(\"...\");case\"For\":return Oh(e,t,{parentIsList:!1});case\"EmptyRangeEnd\":throw sP();case\"Err\":throw Tz(t.error);default:throw`Unexpected surface node ${t.type}.`}}function EM(e){return Kp.hasOwnProperty(e)}function YR(e){return e===\"ln\"||e===\"log\"||e===\"logbase\"}function fz(e){return e.type===\"Decimal\"&&e.val===\"2\"}function mz(e){return e.type!==\"Neg\"?!1:(e=e.args[0],e.type===\"Decimal\"&&e.val===\"1\")}function BR(e,t){let n=e.nodes,[r,s]=t.args,i=mn(e,r),o=Sr(s),a=It(e,o);if(Rh(r)){let u=No(s.span.input,s.span.start),c=e.setInput(XR(e),u);return n.SeededFunctionCall(i,[c].concat(a))}if(lr(r))return n.FunctionCall(i,a);if(r.type===\"Superscript\"){let[u,c]=r.args;if(u.type===\"Cmd\"){let l=u.val;if(EM(l)||YR(l)){if(fz(c))return n.Exponent([e.setInput(n.FunctionCall(l,a),void 0),mn(e,c)]);if(mz(c)&&Kp[l]!==void 0)return n.FunctionCall(Kp[l],a);throw EM(l)?gI(l):hI(l===\"logbase\"?\"log\":l)}}}return n.Multiply([i,mn(e,s)])}function Oh(e,t,{parentIsList:n}){let r=e.nodes,[s,i]=t.args,o=e.setInput(r.Identifier(`_comprehensionIndex_${cz++}`),void 0);if(s.type===\"For\")throw yu(\"for\");let a=mn(Qf(e,{prefix:\"li\",expr:o}),s),u=[];if(i.type===\"Seq\"){let p=!1,f=!1,d=!1;for(let y=0;y<i.args.length;y++){let g=i.args[y];ed(g)||e.allowIntervalComprehensions&&g.type===\"ComparatorChain\"?p=!0:f=!0,g.type===\"Cmd\"&&g.val===\"cursor\"&&(d=!0)}if(p&&f){let y=yu(\"for\");throw d&&y.setCursorContext({type:\"for-assignment-lhs\",allowedTypes:[N]}),y}}let c=[];for(let p of Sr(i))if(e.allowIntervalComprehensions&&p.type===\"ComparatorChain\"){let f=MM(p),{min:d,identifier:y,max:g,open:m}=f;c.push({identifier:mn(e,y),bounds:[mn(e,d),mn(e,g)],open:m})}else if(p.type===\"Comparator\"&&ed(p)){let f=e.setInput(r.AssignmentExpression(It(e,p.args)),p.span);u.push(f)}else{if(p.type===\"Comparator\")throw Jl(\"a\");{let f=vP();throw p.type===\"Cmd\"&&p.val===\"cursor\"&&f.setCursorContext({type:\"for-assignment-lhs\",allowedTypes:[N]}),f}}let l=n;return r.ListComprehension(o,a,u,l,c)}function yz(e,t){let n=e.nodes;if(t.type===\"Seq\"){let i=!1,o=!1,a=!1;for(let u=0;u<t.args.length;u++){let c=t.args[u];if(c.type===\"With\")throw yu(\"with\");if(ed(c)||GR(c))i=!0;else if(e.allowIntervalComprehensions&&c.type===\"ComparatorChain\")try{MM(c),o=!0}catch(l){a=!0}else a=!0}if((i||o)&&a)throw yu(\"with\");if(o)throw Yy()}if(e.allowIntervalComprehensions&&t.type===\"ComparatorChain\"){let i;try{MM(t),i=!0}catch(o){i=!1}if(i)throw Yy()}if(t.type===\"With\")throw $y();let r=Sr(t),s=[];for(let i of r){if(i.type!=\"Comparator\"||!ed(i)&&!GR(i))throw sf();let o=e.setInput(n.AssignmentExpression(It(e,i.args)),i.span);s.push(o)}return s}function GR(e){if(e.type!==\"Comparator\"||e.symbol!==\"=\")return!1;let t=e.args[0];if(t.type!==\"Call\")return!1;let[n]=t.args;return!!lr(n)}function MM(e){if(e.symbols.length!==2)throw Jl(\"a\");let[t,n,r]=e.args,[s,i]=e.symbols;if(!lr(n))throw Jl(\"a\");if(s!==\"<\"&&s!==\"<=\"||i!==\"<\"&&i!==\"<=\"||e.symbols.includes(\"=\"))throw Jl(Yn(n.span));return{min:t,identifier:n,max:r,open:[s===\"<\",i===\"<\"]}}function gz(e,t){let n=e.nodes;if(!lr(t.args[0]))throw MT();return e=Qf(e,{prefix:\"ec\",expr:e.setInput(n.Identifier(\"globalEventCount\"),void 0)}),n.UpdateRule(It(e,t.args))}function hz(e,t){let n=e.nodes,[r]=t.args,s=Sr(r);if(s.length===1&&Jf(s[0])){let f=s[0];return n.Restriction([e.setInput(Ca(e,f),f.span)])}if(s.length>1&&s.every(Jf)){let f=e.setInput(Ca(e,s[0]),s[0].span);for(let d=1;d<s.length;d++){let y=e.setInput(Ca(e,s[d]),s[d].span);f=e.setInput(n.Or([f,y]),Bs(s[0].span,s[d].span))}return n.Restriction([f])}let i,o=[];e:for(i=0;i<s.length;i++){let f=s[i];switch(f.type){case\"Colon\":{let[d,y]=f.args;if(!Jf(d))throw TI();if(y.type===\"With\"&&y.args[1].type===\"Seq\")throw yu(\"with\");o.push({condition:e.setInput(Ca(e,d),d.span),if_expr:mn(e,y)});break}case\"Comparator\":case\"ComparatorChain\":o.push({condition:e.setInput(Ca(e,f),f.span),if_expr:e.setInput(n.Constant(Se(1,1)),Vs(\"1\",0,1))});break;case\"For\":throw yu(\"for\");default:break e}}if(i===0)throw bI();if(i<s.length-1)throw xI();let a,u;i===s.length-1?(a=jf(e,s[i]),u=s[i]):a=n.Constant(NaN);let c=a,l=u==null?void 0:u.span,p;for(;o.length;)p=o.pop(),c=n.Piecewise([p.condition,p.if_expr,e.setInput(c,l)]),l=void 0;return c}function Jf(e){return e.type===\"Comparator\"||e.type===\"ComparatorChain\"}function Ca(e,t){let n=e.nodes;switch(t.type){case\"Comparator\":return n.Comparator[t.symbol](It(e,t.args));case\"ComparatorChain\":return n.ComparatorChain(t.symbols,It(e,t.args));default:throw z(`Unexpected type for condition: ${t.type}`)}}function bz(e){let[t,n]=e.args;if(t.type===\"Superscript\"&&(t=t.args[0]),t.type===\"Cmd\"&&t.val===\"logbase\"&&n.type===\"Seq\"&&n.args.length===2){if(!Yo(n.args[0]))throw xy(\"log\")}else if(!Yo(n))throw t.type===\"Cmd\"?xy(t.val):z(`Unexpected type for args of implicit call: ${n.type}`)}function kR(e){return Qc(e.val)}function HR(e){let t=Qc(e.whole),n=Qc(e.num),r=Qc(e.den);return qs(t,Ps(n,r))}function xz(e){if(e.type!==\"Call\")return!1;let t=e.args[0];for(;t.type===\"Superscript\"||t.type===\"Subscript\"||t.type===\"Prime\";)t=t.args[0];return t.type!==\"Cmd\"?!1:EM(t.val)||YR(t.val)}function ed(e){return e.type===\"Comparator\"&&e.symbol===\"=\"&&lr(e.args[0])}function Tz(e){switch(e.type){case\"UnexpectedParseError\":case\"MissingBound\":case\"EmptyGroup\":case\"UnexpectedDifferential\":case\"UnexpectedEnd\":return z(`Unexpected error type: ${e.type}`);case\"InvalidOperatorName\":return cI();case\"UnexpectedCloseDelimiter\":case\"MissingCloseDelimiter\":return bP(e.open,e.close);case\"UnrecognizedSymbol\":return e.val===\".\"?ks(e.val):uy(e.val);case\"EmptyInput\":return Yd();case\"BinaryOperatorMissingRight\":case\"BinaryOperatorMissingLeft\":return qd(e.val===\"%\"?\"% of\":e.val);case\"UnaryOperatorMissingLeft\":return nI(e.val);case\"UnaryOperatorMissingRight\":return rI(e.val);case\"UnexpectedSubscript\":return EI(e.base);case\"PercentMissingOf\":return TP();case\"SumMissingBound\":return iP();case\"ProductMissingBound\":return oP();case\"IntegralMissingBound\":return pP();case\"SumMissingBody\":return mP();case\"ProductMissingBody\":return yP();case\"IntegralMissingBody\":return gP();case\"DerivativeMissingBody\":return hP();case\"IntegralMissingDifferential\":return dP();case\"DifferentialWithSuperscript\":return fP();case\"FractionMissingNumerator\":return sI();case\"FractionMissingDenominator\":return iI();case\"FractionEmpty\":return oI();case\"EmptySuperscript\":return aI();case\"EmptySubscript\":return Ey();case\"InvalidSubscript\":return uI(e.val);case\"SuperscriptWithPrime\":return pI();case\"PrimeWithoutParen\":return Cy();case\"UnexpectedPrime\":return My();case\"EmptyRadical\":return dI();case\"EmptyRadicalIndex\":return fI();case\"EmptySquareBracket\":return mI();case\"EmptyPipe\":return yI();case\"FunctionMissingArgument\":return Ao(e.val,1,0,{includeUsageExample:!0});case\"AdjacentNumbers\":return eI(Nh(e.args[0]),Nh(e.args[1]));case\"TokenWithSubscript\":return tI();case\"UnexpectedFor\":return ks(\"for\");default:throw`Unexpected surface node ${e.type}.`}}function Nh(e){switch(e.type){case\"Decimal\":return e.val;case\"MixedNumber\":return`${e.whole} ${e.num}/${e.den}`;default:let t=e;throw new Error(`Unexpected node type ${t.type}`)}}function Yo(e){switch(e.type){case\"Letter\":case\"Decimal\":case\"MixedNumber\":case\"Cmd\":case\"EmptyPiecewise\":return!0;case\"Neg\":{let n=e.args[0];for(;;)if(n.type===\"Pos\"||n.type===\"Paren\"&&!$R(n))n=n.args[0];else if(n.type===\"Neg\")n=n.args[0];else break;return n.type===\"Decimal\"||n.type===\"MixedNumber\"}case\"Pos\":return Yo(e.args[0]);case\"Paren\":return Yo(e.args[0]);case\"Juxt\":case\"Mul\":case\"DotMul\":case\"CrossMul\":case\"Div\":return Yo(e.args[0])&&Yo(e.args[1]);case\"Subscript\":return Yo(e.args[0]);case\"Superscript\":case\"Frac\":case\"Add\":case\"Sub\":return Yo(e.args[0])&&Yo(e.args[1]);case\"Piecewise\":{let[n]=e.args;return Jf(n)}case\"Call\":{let[n,r]=e.args;return lr(n)||NR(n)?!1:Yo(n)&&Yo(r)}case\"Derivative\":case\"Sqrt\":case\"Nthroot\":case\"Pipes\":case\"Bang\":return!1;case\"Comparator\":case\"ComparatorChain\":case\"Tilde\":case\"ImplicitCall\":case\"Index\":case\"List\":case\"Seq\":case\"Integral\":case\"EmptyIntegral\":case\"Sum\":case\"Product\":case\"Colon\":case\"Ellipsis\":case\"For\":case\"With\":case\"Dot\":case\"PercentOf\":case\"Prime\":case\"EmptyRangeEnd\":case\"RightArrow\":return!1;default:throw`Unexpected surface node ${e.type}.`}}function Rh(e){return e.type!==\"Cmd\"?!1:e.val===\"random\"||e.val===\"shuffle\"}function XR(e){let t=e.nodes.ExtendSeed(\"\",[e.setInput(e.nodes.Identifier(\"globalRandomSeed\"),void 0),e.setInput(e.nodes.Seed(e.nextSeed()),void 0)]);if(!e.seedExtensions)return t;for(let{prefix:n,expr:r}of e.seedExtensions)t=e.nodes.ExtendSeed(n,[e.setInput(t,void 0),r]);return t}function Qf(e,t){let n=e.seedExtensions||[];return{...e,seedExtensions:n.concat(t)}}function td(e){return{type:\"initial\",tokenType:e}}function Kf(e){return{type:\"l\",tokenType:e}}function em(e){return{type:\"r\",tokenType:e}}function nn(e){return{type:\"la\",tokenType:e}}function nd(e){return{type:\"ra\",tokenType:e}}function ZR(e,t){for(let n of YN)if(t[n]===void 0)throw new Error(`Programming Error: token ${n} must be a assigned a ${e} precedence`)}function hl(e,t,n,r){if(t[n]!==void 0)throw new Error(`Programming Error: duplicate ${e} entry for token ${n}.`);t[n]=r}function WR(e){let t={},n={},r={};for(let a=0;a<e.length;a++){let u=e[a];for(let{type:c,tokenType:l}of u)switch(c){case\"initial\":hl(\"initial\",t,l,a);break;case\"l\":hl(\"left\",n,l,a);break;case\"r\":hl(\"right\",r,l,a);break;case\"la\":hl(\"left\",n,l,a),hl(\"right\",r,l,a);break;case\"ra\":hl(\"left\",n,l,a),hl(\"right\",r,l,a-1);break}}ZR(\"left\",n),ZR(\"right\",r);function s(a){return r[a]}function i(a){return n[a]}function o(a){let u=t[a];return u===void 0?s(a):u}return{rightPrec:s,leftPrec:i,initialPrec:o}}function Be(e,t){return{type:\"Err\",span:e,error:t}}function DM(){return{type:\"UnexpectedParseError\"}}function jR(){return{type:\"EmptyInput\"}}function JR(){return{type:\"EmptyGroup\"}}function SM(){return{type:\"EmptySubscript\"}}function QR(){return{type:\"EmptySuperscript\"}}function vM(){return{type:\"EmptyRadical\"}}function KR(){return{type:\"EmptySquareBracket\"}}function eA(){return{type:\"EmptyPipe\"}}function tA(){return{type:\"EmptyRadicalIndex\"}}function OM(){return{type:\"UnexpectedEnd\"}}function bl(e){return{type:\"BinaryOperatorMissingRight\",val:e}}function nA(e){return{type:\"BinaryOperatorMissingLeft\",val:e}}function NM(e){return{type:\"UnaryOperatorMissingRight\",val:e}}function RM(e){return{type:\"UnaryOperatorMissingLeft\",val:e}}function rA(e,t){return{type:\"MissingCloseDelimiter\",open:e,close:t}}function tm(e,t){return{type:\"UnexpectedCloseDelimiter\",open:e,close:t}}function sA(){return{type:\"UnexpectedDifferential\"}}function iA(e){return{type:\"UnrecognizedSymbol\",val:e}}function oA(e){return{type:\"InvalidSubscript\",val:e}}function aA(e){return{type:\"UnexpectedSubscript\",base:e}}function AM(e){return{type:\"FunctionMissingArgument\",val:e}}function uA(){return{type:\"PercentMissingOf\"}}function _M(){return{type:\"PrimeWithoutParen\"}}function cA(){return{type:\"SuperscriptWithPrime\"}}function Ah(){return{type:\"UnexpectedPrime\"}}function lA(){return{type:\"SumMissingBound\"}}function pA(){return{type:\"ProductMissingBound\"}}function LM(){return{type:\"MissingBound\"}}function dA(){return{type:\"IntegralMissingBound\"}}function fA(){return{type:\"SumMissingBody\"}}function mA(){return{type:\"ProductMissingBody\"}}function yA(){return{type:\"IntegralMissingBody\"}}function gA(){return{type:\"DerivativeMissingBody\"}}function hA(){return{type:\"IntegralMissingDifferential\"}}function bA(){return{type:\"DifferentialWithSuperscript\"}}function xA(){return{type:\"FractionMissingNumerator\"}}function TA(){return{type:\"FractionMissingDenominator\"}}function IA(){return{type:\"FractionEmpty\"}}function wM(e){return{type:\"AdjacentNumbers\",args:e}}function PA(){return{type:\"UnexpectedFor\"}}function EA(){return{type:\"TokenWithSubscript\"}}var Pz=[[td(\"(\"),nn(\")\"),td(\"\\\\{\"),nn(\"\\\\}\"),em(\"[\"),nn(\"]\"),td(\"(|\"),nn(\"|)\"),nn(\"Differential\"),nn(\"End\")],[nn(\"for\")],[em(\"with\")],[nd(\"...\")],[nn(\",\")],[nd(\":\")],[em(\"->\")],[Kf(\"with\")],[nn(\"=\"),nn(\">\"),nn(\"<\"),nn(\">=\"),nn(\"<=\"),nn(\"~\")],[Kf(\"->\")],[nn(\"+\"),nn(\"-\")],[nn(\"*\"),nn(\"\\\\cdot\"),nn(\"\\\\times\"),nn(\"/\"),nn(\"Decimal\"),nn(\"MixedNumber\"),nn(\"Letter\"),nn(\"Cmd\"),nn(\"TokenNode\"),nn(\"%\"),em(\"(\"),nn(\"\\\\{\"),nn(\"(|\"),nn(\"Frac\"),nn(\"Sqrt\"),nn(\"Trig\"),nn(\"Ln\"),nn(\"Log\"),nd(\"Int\"),nd(\"Sum\"),nd(\"Prod\")],[td(\"+\"),td(\"-\")],[nn(\"!\")],[nn(\"SupSub\")],[Kf(\"[\"),nn(\".\")],[Kf(\"(\")],[nn(\"Err\")]],{leftPrec:_h,rightPrec:MA,initialPrec:vA}=WR(Pz),CA={trailingComma:!1};function OA(e,t){let n=t?{...CA,...t}:CA,r=ru(e,n),s=Ez(r);return s.type===\"Err\"&&s.error.type===\"EmptyGroup\"?Be(s.span,jR()):s}function Ez(e){return Xu(e,{isToplevel:!0})}function Xu(e,{isToplevel:t}={isToplevel:!1}){if(vh(e))return Be(Pe(e,e),JR());let{state:n,tree:r}=pr(e,0,{isToplevel:t});return r.type!==\"Err\"&&!vh(n)?VM(n).tree:r}function k(e,t){return{state:e,tree:t}}function pr(e,t,{isToplevel:n}={isToplevel:!1}){let r=e,s;if({state:r,tree:s}=Mz(r),s.type===\"Err\")return k(r,s);if(!PM(e,r))throw new Error(\"Programming Error: parseInitial did not advance state.\");for(;!vh(r);){let i;if(Hr(r,\"(\")&&!Sz(s)?i=MA(\"(\"):i=_h(ss(r).type),t>=i)break;let o=r,a=Cz(r,s,n)?_h(\"for\")-1:MA(ss(r).type);if({state:r,tree:s}=Dz(r,s,a),s.type===\"Err\")return k(r,s);if(!PM(o,r))throw new Error(\"Programming Error: parseSuccessor did not advance state.\")}return k(r,s)}function Ei(e){return e.type===\"UnexpectedDifferential\"||e.type===\"UnexpectedCloseDelimiter\"||e.type===\"UnexpectedEnd\"||e.type===\"BinaryOperatorMissingLeft\"}function Mz(e){let t=e,n=ss(e),r=vA(n.type),s;switch(n.type){case\"+\":{if(e=Xe(e),{state:e,tree:s}=pr(e,r),s.type===\"Err\"){if(!Ei(s.error))return k(e,s);let o=Pe(t,e),a=Be(o,NM(n.val));return k(e,a)}return k(e,KN(Pe(t,e),[s]))}case\"-\":if(e=Xe(e),{state:e,tree:s}=pr(e,r),s.type===\"Err\"){if(!Ei(s.error))return k(e,s);let o=Pe(t,e),a=Be(o,NM(n.val));return k(e,a)}else return k(e,eR(Pe(t,e),[s]));case\"(\":return nm(e);case\"\\\\{\":return e=Xe(e),Hr(e,\"\\\\}\")?(e=Xe(e),k(e,xR(Pe(t,e)))):({state:e,tree:s}=pr(e,r),{state:e,tree:s}=rm(t,e,s,\"\\\\{\",\"\\\\}\"),s.type===\"Err\"?k(e,s):k(e,bR(Pe(t,e),[s])));case\"[\":return e=Xe(e),Hr(e,\"]\")?(e=Xe(e),k(e,yM(Pe(t,e),[]))):({state:e,tree:s}=pr(e,r),{state:e,tree:s}=rm(t,e,s,\"[\",\"]\"),s.type===\"Err\"?k(e,s):k(e,yM(Pe(t,e),[s])));case\"(|\":{if(e=Xe(e),Hr(e,\"|)\")){e=Xe(e);let o=Pe(t,e);return k(e,Be(o,eA()))}return{state:e,tree:s}=pr(e,r),{state:e,tree:s}=rm(t,e,s,\"(|\",\"|)\"),s.type===\"Err\"?k(e,s):k(e,cR(Pe(t,e),[s]))}case\"Frac\":{if(e.opts.disallowFrac)throw Uy();e=Xe(e);let o=Xu(ru(n.num,e.opts)),a=Xu(ru(n.den,e.opts));if(o.type===\"Err\"&&o.error.type===\"EmptyGroup\"&&a.type===\"Err\"&&a.error.type===\"EmptyGroup\"){let u=Pe(t,e),c=Be(u,IA());return k(e,c)}if(o.type===\"Err\"&&o.error.type===\"EmptyGroup\"){let u=Pe(t,e),c=Be(u,xA());return k(e,c)}if(a.type===\"Err\"&&a.error.type===\"EmptyGroup\"){let u=Pe(t,e),c=Be(u,TA());return k(e,c)}if(o.type===\"Err\")return k(e,o);if(a.type===\"Err\")return k(e,a);if(RR(o,a)&&a.type===\"Juxt\"){let u=a.args[1],c;if({state:e,tree:c}=pr(e,_h(\"*\")-1),c.type===\"Err\"){if(Ei(c.error)){let l=Pe(t,e);return k(e,Be(l,gA()))}return k(e,c)}return k(e,fR(Pe(t,e),[u,c]))}return k(e,dR(Pe(t,e),[o,a]))}case\"Sqrt\":if(e=Xe(e),n.optArg){let o=Xu(ru(n.optArg,e.opts));if(o.type===\"Err\")return o.error.type===\"EmptyGroup\"?k(e,Be(o.span,tA())):k(e,o);let a=Xu(ru(n.arg,e.opts));return a.type===\"Err\"?a.error.type===\"EmptyGroup\"?k(e,Be(a.span,vM())):k(e,a):k(e,pR(Pe(t,e),[o,a]))}else{let o=Xu(ru(n.arg,e.opts));return o.type===\"Err\"?o.error.type===\"EmptyGroup\"?k(e,Be(o.span,vM())):k(e,o):k(e,lR(Pe(t,e),[o]))}case\"Trig\":case\"Ln\":{e=Xe(e);let o=gl(Pe(t,e),n.val),a=0,u=ss(e);if(u.type===\"SupSub\"){if(e=Xe(e),u.sub){let p=Pe(t,e),f=Be(p,aA(o.val));return k(e,f)}let l=Lh(u,e.opts);if(l){if(l.type===\"Err\")return k(e,l);o=Eh(Pe(t,e),[o,l])}a=u.nprimes}let c=Hr(e,\"(\");if(c){if({state:e,tree:s}=nm(e),s.type===\"Err\")return k(e,s);s=Xf(Pe(t,e),[o,s.args[0]])}else{if({state:e,tree:s}=pr(e,r-1),s.type===\"Err\")return Ei(s.error)?k(e,Be(Pe(t,e),AM(n.val))):k(e,s);s=fM(Pe(t,e),[o,s])}if(a>0){let l=Pe(t,e);if(!c){let p=Be(l,_M());return k(e,p)}s=Zf(l,a,[s])}return k(e,s)}case\"Log\":{e=Xe(e);let o=Pe(t,e),a=gl(o,n.val),u=0,c,l,p=ss(e);if(p.type===\"SupSub\"&&(e=Xe(e),c=NA(p,e.opts),l=Lh(p,e.opts),u=p.nprimes),c&&c.type===\"Err\")return k(e,c);if(l&&l.type===\"Err\")return k(e,l);let f=Hr(e,\"(\");if(f){if({state:e,tree:s}=nm(e),s.type===\"Err\")return k(e,s);s=s.args[0]}else if({state:e,tree:s}=pr(e,r-1),s.type===\"Err\")return Ei(s.error)?k(e,Be(Pe(t,e),AM(n.val))):k(e,s);let d=c?gl(o,\"\\\\logbase\"):a,y=c?Mh(Pe(t,e),Sr(s).concat(c)):s;if(l&&(d=Eh(Pe(t,e),[d,l])),f?s=Xf(Pe(t,e),[d,y]):s=fM(Pe(t,e),[d,y]),u>0){let g=Pe(t,e);if(!f){let m=Be(g,_M());return k(e,m)}s=Zf(g,u,[s])}return k(e,s)}case\"Int\":{e=Xe(e);let o=ss(e);e=Xe(e);let a=FM(o,t,e);if(a.type===\"Err\")return a.error.type===\"MissingBound\"?k(e,Be(a.span,dA())):k(e,a);let{sup:u,sub:c}=a,l;if(Hr(e,\"Differential\"))return{state:e,tree:l}=SA(e),l.type===\"Err\"?k(e,l):k(e,yR(Pe(t,e),[l,c,u]));if({state:e,tree:s}=pr(e,r),s.type===\"Err\")return Ei(s.error)?k(e,Be(s.span,yA())):k(e,s);let p=s;return Hr(e,\"Differential\")?({state:e,tree:l}=SA(e),l.type===\"Err\"?k(e,l):k(e,mR(Pe(t,e),[l,c,u,p]))):k(e,Be(Pe(t,e),hA()))}case\"Sum\":{e=Xe(e);let o=ss(e);e=Xe(e);let a=FM(o,t,e);if(a.type===\"Err\")return a.error.type===\"MissingBound\"?k(e,Be(a.span,lA())):k(e,a);let{sup:u,sub:c}=a;return{state:e,tree:s}=pr(e,r),s.type===\"Err\"?Ei(s.error)?k(e,Be(s.span,fA())):k(e,s):k(e,gR(Pe(t,e),[s,c,u]))}case\"Prod\":{e=Xe(e);let o=ss(e);e=Xe(e);let a=FM(o,t,e);if(a.type===\"Err\")return a.error.type===\"MissingBound\"?k(e,Be(a.span,pA())):k(e,a);let{sup:u,sub:c}=a;return{state:e,tree:s}=pr(e,r),s.type===\"Err\"?Ei(s.error)?k(e,Be(s.span,mA())):k(e,s):k(e,hR(Pe(t,e),[s,c,u]))}case\"Cmd\":return e=Xe(e),s=gl(Pe(t,e),n.val),k(e,s);case\"TokenNode\":{e=Xe(e);let o=ss(e);return o.type===\"SupSub\"&&o.sub?(e=Xe(e),k(e,Be(Pe(t,e),EA()))):(s=gl(Pe(t,e),n.val),k(e,s))}case\"Letter\":return e=Xe(e),s=SR(Pe(t,e),n.val),k(e,s);case\"Decimal\":{e=Xe(e);let o=Ch(Pe(t,e),n.val),a=e.token;if(a.type===\"Decimal\"||a.type===\"MixedNumber\"){let u=e;e=Xe(e);let c=Pe(t,e),l=a.type===\"MixedNumber\"?a:Ch(Pe(u,e),a.val);return k(e,Be(c,wM([o,l])))}if(n.val.endsWith(\".\")&&a.type===\"Cmd\"&&(a.val===\"\\\\real\"||a.val===\"\\\\imag\"))throw ly();return k(e,o)}case\"MixedNumber\":{if(e.opts.disallowFrac)throw Uy();e=Xe(e);let o=e.token;if(o.type===\"Decimal\"||o.type===\"MixedNumber\"){let a=e;e=Xe(e);let u=Pe(t,e),c=o.type===\"MixedNumber\"?o:Ch(Pe(a,e),o.val);return k(e,Be(u,wM([n,c])))}return k(e,n)}case\"*\":case\"\\\\cdot\":case\"\\\\times\":case\"/\":case\",\":case\"=\":case\">\":case\"<\":case\">=\":case\"<=\":case\"->\":case\"~\":case\":\":case\"...\":case\"%\":case\".\":{e=Xe(e);let o=Pe(t,e),a=Be(o,nA(n.val));return k(e,a)}case\"for\":{e=Xe(e);let o=Pe(t,e),a=Be(o,PA());return k(e,a)}case\"with\":{e=Xe(e);let o=Pe(t,e),a=Be(o,DM());return k(e,a)}case\"!\":{e=Xe(e);let o=Pe(t,e),a=Be(o,RM(n.val));return k(e,a)}case\"SupSub\":{e=Xe(e);let o=\"supsub\";n.sub?o=\"subscript\":n.sup?o=\"superscript\":n.nprimes>0&&(o=\"prime\");let a=Pe(t,e),u=Be(a,RM(o));return k(e,u)}case\")\":case\"\\\\}\":case\"]\":case\"|)\":case\"Differential\":return VM(e);case\"Err\":{e=Xe(e);let o=Pe(t,e),a=Be(o,iA(n.val));return k(e,a)}case\"End\":{let o=Pe(t,e),a=Be(o,OM());return k(e,a)}default:throw`Unexpected token type ${n.type}.`}}function Cz(e,t,n){return Hr(e,\"=\")&&n&&(qR(t)||CM(t))}function Dz(e,t,n){let r=ss(e),s;switch(r.type){case\"+\":case\"-\":case\"*\":case\"\\\\cdot\":case\"\\\\times\":case\"/\":case\"~\":case\":\":case\".\":case\"->\":case\"for\":{if(e=Xe(e),{state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let o=er(t.span,e),a=Be(o,bl(r.val));return k(e,a)}else return k(e,s);return k(e,DA(r.type,er(t.span,e),[t,s]))}case\"with\":{if(e=Xe(e),{state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let o=er(t.span,e),a=Be(o,bl(r.val));return k(e,a)}else return k(e,s);return k(e,DA(r.type,er(t.span,e),[t,s]))}case\"%\":{e=Xe(e);let o=ss(e);if(o.type!==\"Cmd\"||o.val!==\"of\"&&o.val!==\"\\\\of\"){let a=Be(r.span,uA());return k(e,a)}if(e=Xe(e),{state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let a=er(t.span,e),u=Be(a,bl(r.val));return k(e,u)}else return k(e,s);return k(e,CR(er(t.span,e),[t,s]))}case\"=\":case\">=\":case\"<=\":case\">\":case\"<\":{let o=[t],a=[];for(;;){let c=ss(e).type;if(c!==\"=\"&&c!==\">=\"&&c!==\"<=\"&&c!==\">\"&&c!==\"<\")break;if(a.push(c),e=Xe(e),{state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let l=er(t.span,e),p=Be(l,bl(r.val));return k(e,p)}else return k(e,s);o.push(s)}let u=o[o.length-1];return u.type===\"Comparator\"?(o.pop(),Array.prototype.push.apply(o,u.args),a.push(u.symbol)):u.type===\"ComparatorChain\"&&(o.pop(),Array.prototype.push.apply(o,u.args),Array.prototype.push.apply(a,u.symbols)),o.length===2?k(e,jN(er(t.span,e),a[0],o)):k(e,JN(er(t.span,e),a,o))}case\"!\":return e=Xe(e),k(e,aR(er(t.span,e),[t]));case\"[\":{let o=e;if(e=Xe(e),Hr(e,\"]\")){e=Xe(e);let a=Pe(o,e);return k(e,Be(a,KR()))}return{state:e,tree:s}=pr(e,n),{state:e,tree:s}=rm(o,e,s,\"[\",\"]\"),s.type===\"Err\"?k(e,s):k(e,uR(er(t.span,e),[t,s]))}case\"Sqrt\":case\"Frac\":case\"Letter\":case\"Cmd\":case\"TokenNode\":case\"Trig\":case\"Ln\":case\"Log\":case\"Sum\":case\"Int\":case\"Prod\":case\"Decimal\":case\"MixedNumber\":case\"\\\\{\":case\"(|\":return{state:e,tree:s}=pr(e,n),s.type===\"Err\"?k(e,s):k(e,bM(er(t.span,e),[t,s]));case\"(\":if(lr(t)){if({state:e,tree:s}=nm(e),s.type===\"Err\")return k(e,s);let o=er(t.span,e);return k(e,Xf(o,[t,s.args[0]]))}else if(t.type===\"Prime\"&&lr(t.args[0])){if({state:e,tree:s}=nm(e),s.type===\"Err\")return k(e,s);let o=er(t.span,e);return k(e,Zf(o,t.nprimes,[Xf(o,[t.args[0],s.args[0]])]))}else return{state:e,tree:s}=pr(e,n),s.type===\"Err\"?k(e,s):k(e,bM(er(t.span,e),[t,s]));case\"SupSub\":{e=Xe(e);let o=RA(r),a=Lh(r,e.opts);if(o&&o.type===\"Err\")return k(e,o);if(a&&a.type===\"Err\")return k(e,a);if(o&&(t=gM(er(t.span,e),[t,o])),a&&(t=Eh(er(t.span,e),[t,a])),r.nprimes>0){let u=er(t.span,e);if(!lr(t)){let c=Be(u,Ah());return k(e,c)}t=Zf(u,r.nprimes,[t])}return k(e,t)}case\",\":{let o=[t];for(;Hr(e,\",\")&&(e=Xe(e),!(Hr(e,\"...\")||e.opts.trailingComma&&vz(e)));){if({state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let a=er(t.span,e),u=Be(a,bl(r.val));return k(e,u)}else return k(e,s);o.push(s)}return k(e,Mh(er(t.span,e),o))}case\"...\":{if(e=Xe(e),Hr(e,\",\")&&(e=Xe(e)),n>=_h(ss(e).type))return k(e,hM(er(t.span,e),[t,TR(TM(e))]));if({state:e,tree:s}=pr(e,n),s.type===\"Err\")if(Ei(s.error)){let o=er(t.span,e),a=Be(o,bl(r.val));return k(e,a)}else return k(e,s);return k(e,hM(er(t.span,e),[t,s]))}case\"]\":case\")\":case\"\\\\}\":case\"|)\":case\"Differential\":return VM(e);case\"Err\":return pr(e,n);case\"End\":{let o=Pe(e,e),a=Be(o,OM());return k(e,a)}default:throw`Unexpected token type ${r.type}.`}}function Sz(e){return!!(lr(e)||e.type===\"Prime\"&&lr(e.args[0]))}function DA(e,t,n){switch(e){case\"+\":return tR(t,n);case\"-\":return nR(t,n);case\"*\":return rR(t,n);case\"\\\\cdot\":return sR(t,n);case\"\\\\times\":return iR(t,n);case\"/\":return oR(t,n);case\"~\":return QN(t,n);case\":\":return IR(t,n);case\".\":switch(n[0].type){case\"Decimal\":case\"MixedNumber\":throw ly();default:return MR(t,n)}case\"->\":return DR(t,n);case\"for\":return PR(t,n);case\"with\":return ER(t,n);default:throw`Unexpected token type ${e}.`}}function NA(e,t){if(!e.sub)return;let n=e.sub,r=Xu(ru(n,t));return r.type===\"Err\"&&r.error.type===\"EmptyGroup\"?Be(r.span,SM()):r}function RA(e){if(!e.sub)return;let t=e.sub;if(t.args.length===0)return Be(t.span,SM());let n=[];for(let r of t.args)if(r.type===\"Digit\"||r.type===\"Letter\")n.push(r.val);else{let s=r.span;return Be(s,oA(Yn(s)))}return vR(t.span,n.join(\"\"))}function Lh(e,t){if(!e.sup)return;let n=Xu(ru(e.sup,t));return n.type===\"Err\"?n.error.type===\"EmptyGroup\"?Be(n.span,QR()):n:e.nprimes>0?Be(e.span,cA()):n}function FM(e,t,n){if(e.type!==\"SupSub\"){let i=Pe(t,n);return Be(i,LM())}if(e.nprimes>0){let i=Pe(t,n);return Be(i,Ah())}let r=NA(e,n.opts),s=Lh(e,n.opts);if(!r||r.type===\"Err\"&&r.error.type===\"EmptySubscript\"||!s||s.type===\"Err\"&&s.error.type===\"EmptySuperscript\"){let i=Pe(t,n);return Be(i,LM())}return r.type===\"Err\"?r:s.type===\"Err\"?s:{type:\"Bounds\",sup:s,sub:r}}function nm(e){if(e.opts.disableParentheses)throw DP();let t=e,n=ss(e),r=vA(n.type);if(Hr(e,\"(\"))e=Xe(e);else throw new Error(\"Programming Error: expected '(' at start of parseParen.\");if(Hr(e,\")\")){let i=Mh(TM(e),[]);e=Xe(e);let o=Pe(t,e);return k(e,mM(o,[i]))}let s;return{state:e,tree:s}=pr(e,r),{state:e,tree:s}=rm(t,e,s,\"(\",\")\"),s.type===\"Err\"?k(e,s):k(e,mM(Pe(t,e),[s]))}function SA(e){let t=e,n=ss(e);if(n.type!==\"Differential\")throw new Error(\"Programming Error: expected differential\");e=Xe(e);let r=gl(n.span,n.val),s=ss(e);if(s.type===\"SupSub\"){e=Xe(e);let i=Pe(t,e),o=RA(s);if(o){if(o.type===\"Err\")return k(e,o);r=gM(i,[r,o])}if(s.sup)return k(e,Be(i,bA()));if(s.nprimes>0)return k(e,Be(i,Ah()))}return k(e,r)}function rm(e,t,n,r,s){if(n.type===\"Err\"&&n.error.type!==\"UnexpectedEnd\")return k(t,n);if(n.type===\"Err\"||!Hr(t,s)){let i=Pe(e,t),o=Be(i,rA(r,s));return k(t,o)}return t=Xe(t),k(t,n)}function VM(e){let t=e;switch(ss(e).type){case\")\":{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,tm(\"(\",\")\")))}case\"]\":{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,tm(\"[\",\"]\")))}case\"\\\\}\":{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,tm(\"\\\\{\",\"\\\\}\")))}case\"|)\":{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,tm(\"|\",\"|\")))}case\"Differential\":{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,sA()))}default:{e=Xe(e);let r=Pe(t,e);return k(e,Be(r,DM()))}}}function vz(e){return Hr(e,\")\")||Hr(e,\"]\")||Hr(e,\"\\\\}\")}function Zu(e,t){return Bs(e.token.span,t.prevSpan)}function Da(e,t,n){return{type:e,span:t,val:n}}function Oz(e,t,n,r){return{input:e,prevSpan:t,pos:n,token:r}}function AA(e){return _A(e,0,No(e,0))}function _A(e,t,n){for(;ZN(e.charCodeAt(t));)t+=1;let r=Rz(e,t);return Oz(e,n,t,r)}function mo(e){return _A(e.input,e.token.span.end,e.token.span)}function Xo(e){return e.token}function Zo(e,t){if(Xo(e).type!==t)throw`Parse Error: expected ${t}.`;return mo(e)}function BM(e,t){return Xo(e).type===t}function wh(e){return e.pos>=e.input.length}var Nz={\"[\":\"[\",\"]\":\"]\",\"{\":\"{\",\"}\":\"}\",\"^\":\"^\",_:\"_\"};function Rz(e,t){let n=t;if(t>=e.length)return Da(\"End\",No(e,t),\"\");let r=e.charCodeAt(t);if(XN(r)){let s=Vs(e,n,t+1);return Da(\"Digit\",s,e.charAt(n))}else if(Ih(r)){let s=Vs(e,n,t+1);return Da(\"Letter\",s,e.charAt(n))}else if(Ph(r))if(t+=1,Ih(e.charCodeAt(t))){for(;Ih(e.charCodeAt(t));)t+=1;let s=Vs(e,n,t),i=Yn(s);return Da(i===\"\\\\left\"?\"Left\":i===\"\\\\right\"?\"Right\":\"Cmd\",s,i)}else{t+=1;let s=Vs(e,n,t),i=Yn(s);return Da(\"EscapedSymbol\",s,i)}else if(dM(r)){for(t+=1;dM(e.charCodeAt(t));)t+=1;if(e.charAt(t)===\"^\"){t+=1;let s=Vs(e,n,t),i=Yn(s);return Da(\"Primes^\",s,i)}else{let s=Vs(e,n,t),i=Yn(s);return Da(\"Primes\",s,i)}}else{let s=Vs(e,n,t+1),i=e.charAt(n),o=Nz[i]||\"Symbol\";return Da(o,s,i)}}function GM(e,t){return{type:\"Group\",span:e,args:t}}function LA(e,t,n){return{type:\"Sqrt\",span:e,optArg:t,arg:n}}function wA(e,t,n){return{type:\"Frac\",span:e,num:t,den:n}}function FA(e,t,n,r){return{type:\"SupSub\",span:e,sup:t,sub:n,nprimes:r}}function VA(e,t,n,r){return{type:\"LeftRight\",span:e,left:t,right:n,arg:r}}function BA(e,t){return{type:\"OperatorName\",span:e,arg:t}}function GA(e,t){return{type:\"TokenNode\",span:e,arg:t}}function kA(e,t){return{type:\"Symbol\",span:e,val:t}}var kM={type:\"primitive\",errorName:\"^\"},HA={type:\"primitive\",errorName:\"_\"},_z={\"\\\\frac\":{type:\"macro\",errorName:\"\\\\frac\",expandsToSingleAtom:!0},\"\\\\operatorname\":{type:\"macro\",errorName:\"\\\\operatorname\",expandsToSingleAtom:!1},\"\\\\token\":{type:\"macro\",errorName:\"\\\\token\",expandsToSingleAtom:!1}};function zA(e){let t=Xo(e);if(t.type===\"Cmd\")return t.val===\"\\\\sqrt\"?BM(mo(e),\"[\")?{type:\"macro\",errorName:\"\\\\sqrt[*]\",expandsToSingleAtom:!1}:{type:\"primitive\",errorName:\"\\\\sqrt\"}:_z[t.val];if(t.type===\"^\"||t.type===\"Primes^\")return kM;if(t.type===\"_\")return HA}function UA(e){let{state:t,tree:n}=Fh(AA(e),!1);if(!wh(t))throw`Parse error: unexpected ${Yn(Xo(t).span)}.`;return n}function qi(e,t){return{state:e,tree:t}}function Fh(e,t){let n=e,r=[];e:for(;!wh(e);){let i=Xo(e);switch(i.type){case\"Cmd\":case\"EscapedSymbol\":case\"Letter\":case\"Digit\":case\"Symbol\":case\"[\":case\"{\":case\"^\":case\"_\":case\"Primes\":case\"Primes^\":case\"Left\":case\"]\":{if(i.type===\"]\"&&t)break e;let a;if({state:e,tree:a}=qA(e),a.type===\"Group\")for(let u of a.args)r.push(u);else r.push(a);break}case\"}\":case\"Right\":case\"End\":break e;default:throw`Unexpected token type ${i.type}.`}}let s=Zu(n,e);return qi(e,GM(s,r))}function qA(e){let t=Xo(e);switch(t.type){case\"EscapedSymbol\":case\"Letter\":case\"Digit\":case\"Symbol\":return e=mo(e),qi(e,t);case\"[\":case\"]\":return e=mo(e),qi(e,kA(t.span,t.val));case\"{\":{e=mo(e);let r;return{state:e,tree:r}=Fh(e,!1),e=Zo(e,\"}\"),qi(e,r)}case\"^\":case\"_\":case\"Primes\":case\"Primes^\":return kz(e);case\"Left\":return Gz(e);case\"Cmd\":return Lz(e);case\"}\":case\"Right\":throw`Parse Error: unexpected ${t.val}.`;case\"End\":throw\"Parse Error: unexpected end.\";default:throw`Unexpected token type ${t.type}.`}}function Lz(e){let t=zA(e),n=Xo(e);if(!t)return e=Zo(e,\"Cmd\"),qi(e,n);switch(n.val){case\"\\\\operatorname\":return wz(e,t);case\"\\\\token\":return Fz(e,t);case\"\\\\sqrt\":return Vz(e,t);case\"\\\\frac\":return Bz(e,t);default:throw new Error(`Unexpected command ${n.val}.`)}}function wz(e,t){let n=e;e=Zo(e,\"Cmd\");let r;({state:e,tree:r}=Wu(e,t));let s=Zu(n,e);return qi(e,BA(s,r))}function Fz(e,t){let n=e;e=Zo(e,\"Cmd\");let r;({state:e,tree:r}=Wu(e,t));let s=Zu(n,e);return qi(e,GA(s,r))}function Vz(e,t){let n=e;e=Zo(e,\"Cmd\");let r;BM(e,\"[\")&&({state:e,tree:r}=Hz(e));let s;({state:e,tree:s}=Wu(e,t));let i=Zu(n,e);return qi(e,LA(i,r,s))}function Bz(e,t){let n=e;e=Zo(e,\"Cmd\");let r;({state:e,tree:r}=Wu(e,t));let s;({state:e,tree:s}=Wu(e,t));let i=Zu(n,e);return qi(e,wA(i,r,s))}function Gz(e){let t=e;e=Zo(e,\"Left\");let n=Xo(e);e=mo(e);let r;({state:e,tree:r}=Fh(e,!1)),e=Zo(e,\"Right\");let s=Xo(e);e=mo(e);let i=Zu(t,e);return qi(e,VA(i,n,s,r))}function kz(e){let t=e,n,r,s=0;e:for(;!wh(e);){let o=Xo(e);switch(o.type){case\"^\":if(e=mo(e),n)throw\"Parse Error: double superscript.\";({state:e,tree:n}=Wu(e,kM));break;case\"_\":if(e=mo(e),r)throw\"Parse Error: double subscript.\";({state:e,tree:r}=Wu(e,HA));break;case\"Primes\":if(e=mo(e),s>0)throw\"Parse Error: double primes.\";s=o.val.length;break;case\"Primes^\":if(e=mo(e),s>0)throw\"Parse Error: double primes.\";if(n)throw\"Parse Error: double superscript\";s=o.val.length-1,{state:e,tree:n}=Wu(e,kM);break;default:break e}}let i=Zu(t,e);return qi(e,FA(i,n,r,s))}function Wu(e,t){let n,r=zA(e);if(r&&(t.type!==\"primitive\"||!(r.type===\"macro\"&&r.expandsToSingleAtom)))throw`Parse Error: can't use ${r.errorName} as argument of ${t.errorName}. Use {}.`;return{state:e,tree:n}=qA(e),n.type!==\"Group\"&&(n=GM(n.span,[n])),qi(e,n)}function Hz(e){e=Zo(e,\"[\");let t;return{state:e,tree:t}=Fh(e,!0),e=Zo(e,\"]\"),qi(e,t)}function zz(){throw nf()}function $A(e,t){return t&&!e._inputSpan&&e.setInputSpan(t),e}function Mi(e,t={}){var l;let n=typeof e;if(n!==\"string\")throw new Error(`Type Error: parse can only be called with strings, got ${JSON.stringify(e)} of type ${n}`);let r=M;if(t.disabledFeatures){r=Object.create(r);for(let p of t.disabledFeatures){if(!r[p])throw new Error(`Programming Error: ${p} cannot be disabled because it is not a parsenode.`);r[p]=zz}}let s=t.seedPrefix===void 0?\"\":t.seedPrefix,i=0,o=()=>{let p=`${s}::vc${i}`;return i+=1,p},a={nodes:r,currentIndex:t.index,setInput:$A,nextSeed:o,allowDt:!!t.allowDt,allowIndex:!!t.allowIndex,writeIntegral:!!t.writeIntegral,allowIntervalComprehensions:!!t.allowIntervalComprehensions,specializeDoubleInequalities:!!t.specializeDoubleInequalities,includeFunctionParametersInRandomSeed:(l=t.includeFunctionParametersInRandomSeed)!=null?l:!0},u={};t.trailingComma!==void 0&&(u.trailingComma=t.trailingComma),t.disallowFrac&&(u.disallowFrac=!0),t.disableParentheses&&(u.disableParentheses=!0);function c(p){return p.parseOptions=t,p}if(e===\"\")return c(Yd());try{let p=UA(e),f=OA(p,u),d=zR(a,f);return d.parseOptions=t,d}catch(p){let f;return p instanceof M.Error?f=p:typeof p==\"string\"?f=new M.Error(p):f=z(p),c(f)}}var qz=[\"Sum\",\"Product\",\"Integral\",\"List\",\"Derivative\",\"Piecewise\",\"Restriction\",\"Norm\",\"Exponent\",\"PercentOf\",\"FunctionDefinition\",\"UpdateRule\",\"Substitution\",\"ListComprehension\"],$z={isGeometryEnabled(){return!1},is3dProduct(){return!1},is3dPolicy(){return!1},polygonUnsupportedPreferTriangle(){return!1},areAllScalesLinear(){return!0},assignmentForbidden(e){return!0},graphingEnabled(){return!1},isValidSlider(e){return!1},sliderVariables(e){return[]},ansEnabled(){return!1},disabledFeatures(){return qz},dimensionVarsEnabled(){return!1},shouldIncludeFunctionParametersInRandomSeed(){return!0},isComplexEnabled(){return!1},isRecursionEnabled(){return!1}},YA={...$z,isGeometryEnabled(){return!0},is3dProduct(){return!0},is3dPolicy(){return!0},isComplexEnabled(){return!1}};var rd=class e{constructor(t,n,r,s,i){this.frame=t;this.dynamic=n;this.lexical=r;this.maxBindingIndex=s;this.compiledGlobalCache=i}static empty(t){return new e(t,{},{},-1,{maxIndex:-1,entries:{}})}resolve(t){if(this.lexical[t])return this.lexical[t];if(this.dynamic[t])return this.dynamic[t];if(this.compiledGlobalCache.entries[t])return this.compiledGlobalCache.entries[t]}getSymbol(t){let n=this.resolve(t);if(n)switch(n.type){case\"lexical\":case\"dynamic\":case\"free\":return n.value;case\"global\":return n.value;case\"error\":throw n.error;default:throw new Error(\"Unexpected symbolMap entry type: \"+n.type)}}getMaxIndex(){return Math.max(this.maxBindingIndex,this.compiledGlobalCache.maxIndex)}getParseNode(t){let n=this.resolve(t);if(n)switch(n.type){case\"global\":case\"lexical\":case\"dynamic\":return n.node;case\"error\":case\"free\":return;default:throw new Error(\"Unexpected symbolMap entry type: \"+n.type)}}addLexicalBinding(t,n,r){this.addScopeEntry(t,{type:\"lexical\",value:n,node:r})}addDynamicBinding(t,n,r){this.addScopeEntry(t,{type:\"dynamic\",value:n,node:r})}cacheGlobal(t,n,r){this.compiledGlobalCache.entries[t]={type:\"global\",value:n,node:r},this.compiledGlobalCache.maxIndex=Math.max(this.compiledGlobalCache.maxIndex,n)}setFreeVariable(t,n){this.addScopeEntry(t,{type:\"free\",value:n})}setErrorIfAccessed(t,n){this.addScopeEntry(t,{type:\"error\",error:n})}addScopeEntry(t,n){var o;let r=this.lexical,s=this.dynamic,i;switch(n.type){case\"lexical\":{r[t]=n,this.frame[t]===void 0&&((o=this.dynamic[t])==null?void 0:o.type)!==\"dynamic\"?(s[t]=n,i=!0):i=!1;break}case\"dynamic\":{s[t]=n,r[t]={type:\"lexical\",value:n.value,node:n.node},i=!0;break}case\"error\":{s[t]=n,i=!0;break}case\"free\":{s[t]=n,i=!0;break}default:throw new Error(\"Unexpected symbolMap entry type: \"+n.type)}n.type!==\"error\"&&(this.maxBindingIndex=Math.max(this.maxBindingIndex,n.value)),i&&(this.compiledGlobalCache={maxIndex:-1,entries:{}})}isLocal(t){let n=this.resolve(t);return(n==null?void 0:n.type)===\"lexical\"||(n==null?void 0:n.type)===\"dynamic\"}isGlobal(t){return this.frame[t]!==void 0&&!this.isLocal(t)}isError(t){var r;let n=this.resolve(t);return n?n.type===\"error\":(r=this.frame[t])==null?void 0:r.isError}isDefined(t){return this.isLocal(t)||this.isGlobal(t)}getVisibleGlobalDefinition(t){let n=this.resolve(t);if(!n)return XA(this.frame[t]);switch(n.type){case\"lexical\":case\"dynamic\":case\"free\":return;case\"global\":return XA(this.frame[t]);case\"error\":throw n.error;default:throw new Error(\"Unexpected symbolMap entry type: \"+n.type)}}childScope(){return new e(this.frame,Tn(this.dynamic),Tn(this.lexical),this.maxBindingIndex,this.compiledGlobalCache)}childScopeWithChildGlobalCache(){return new e(this.frame,Tn(this.dynamic),Tn(this.lexical),this.maxBindingIndex,{maxIndex:this.compiledGlobalCache.maxIndex,entries:Tn(this.compiledGlobalCache.entries)})}newLexicalScope(){return new e(this.frame,Tn(this.dynamic),{},this.maxBindingIndex,this.compiledGlobalCache)}};function XA(e){if(e!=null&&e.isError)throw e;return e}function su(e,t,n,r){return ju({chunk:e,argMap:[t],start:n,unpatchedHeaderMap:new Map,processedHeaders:new Set},r)}function Yz(e,t){let{chunk:n}=e,r=n.getInstruction(t),s=[];for(let i of r.recursionGroup){let o=e.unpatchedHeaderMap.get(i);if(o===void 0)throw new Error(\"Programming Error: `substitute` did not include all headers in a recursion group.\");s.push(o)}for(let i of r.recursionGroup)e.unpatchedHeaderMap.delete(i);for(let i of s)n.getInstruction(i).recursionGroup=s}function ju(e,t){let{chunk:n,argMap:r,start:s}=e;if(t<s)return t;let i=r[t-s];if(i!==void 0)return i;let o=Xz(e,t);e.argMap[t-s]=o;let a=n.getInstruction(t);if(a.type===4){let u=o;e.unpatchedHeaderMap.set(t,u),e.processedHeaders.add(t);for(let c of a.recursionGroup)e.processedHeaders.has(c)||ju(e,c);return ju(e,a.endIndex),u}if(es(a))switch(a.type){case 23:case 21:case 50:break;case 19:{let c=a.args.length-2;for(let l=0;l<c;l++)ju(e,t+1+l);break}case 53:{let l=n.getInstruction(a.args[0]).signature.argTypes.length;for(let p=0;p<l;p++)ju(e,t+1+p);break}default:let u=a;throw new Error(`Programming Error. Unexpected OpCode: ${u.type}`)}else if(Gg(a)){let u=a.args.length-1;for(let c=0;c<u;c++)ju(e,t+1+c)}return o}function Xz(e,t){let{chunk:n,start:r}=e,s=n.getInstruction(t);if(ds(s)){let a=s.args[0];for(let u=a;u<=t;u++){let c=n.getInstruction(u);if(!ge(c))for(let l of c.args)l<a&&ju(e,l)}}if(s.type===4)return n.FunctionHeader(s.symbol,s.valueType,s.signature,s.parameterSymbols);if(ge(s))return po(n,s);let i=[];for(let a of s.args)i.push(ju(e,a));let o=e.argMap[t-r];if(o!==void 0)return o;if(s.type===55&&!zg(n,t)){let a=s.args[0];e.unpatchedHeaderMap.has(a)&&Yz(e,a)}return _n(n,s,i)}function Bh(e,t,n,r){let s=fl(e,t),i=e.Constant(0);if(t<n)return i;let o=e.Constant(1),a=e.Constant(NaN),u=Vu(e,n),c=nO(e,s),l=e.derivativeMaps.getMapEntry(e,r,n),{map:p,maxValidReference:f}=l;for(let h=0;h<p.length;h++){let b=p[h];b!==void 0&&b>f&&(p[h]=void 0)}let d=[],y=!1;for(let h=0;h<n;h++)d[h]=h,p[h]=i;let g=Vr(e,s);return Gh({chunk:e,derivativeVarIndex:n,forwardSeed:r,forwardMask:u,backwardMask:c,referenced:g,valueMap:d,derivativeMap:p,mustCopy:y,ZERO:i,ONE:o,NAN:a},n,s),l.maxValidReference=e.instructionsLength()-1,p[s]}function Gh(e,t,n){let{chunk:r,valueMap:s,derivativeMap:i,backwardMask:o}=e;for(let a=t;a<=n;a++){let u=i[a];if(u!==void 0)if(r.getInstruction(u).type===0)i[a]=void 0;else{s[a]=Vh(e,a);continue}if(!o[a]){s[a]=Vh(e,a);continue}let c=r.getInstruction(a);if(es(c)&&c.endIndex!==-1)switch(c.type){case 21:{a=Zz(e,a);continue}case 19:case 23:{a=Jz(e,a);continue}case 53:{a=Kz(e,a);continue}}s[a]=Vh(e,a),i[a]=eU(e,a)}return n}function Zz(e,t){let{chunk:n,forwardMask:r,valueMap:s,derivativeMap:i,ZERO:o}=e,a=n.getInstruction(t),u=a.endIndex,c=n.getInstruction(u),l=o;if(r[a.args[1]]){let p=s[a.args[1]];l=n.Add([l,n.Multiply([i[a.args[1]],su(n,p,t,c.args[1])])])}if(r[a.args[0]]){let p=s[a.args[0]];l=n.Subtract([l,n.Multiply([i[a.args[0]],su(n,p,t,c.args[1])])])}if(Wz(n,t,r)){let p=s.slice();p[t]=_n(n,a,[p[a.args[0]],p[a.args[1]]]),i[t]=o,Gh({...e,valueMap:p,mustCopy:!0},t+1,u-1);let f=_n(n,c,[p[c.args[0]],i[c.args[1]]]);i[u]=f,l=n.Add([l,_n(n,n.getInstruction(u+1),[f])])}else for(let p=t;p<=u;p++)i[p]=o;if(jz(n,t,s)){let p={...e,mustCopy:!0};for(let f=t;f<=u+1;f++)s[f]=Vh(p,f)}else for(let p=t;p<=u+1;p++)s[p]=p;return i[u+1]=l,u+c.args.length-1}function Wz(e,t,n){let r=e.getInstruction(t),s=e.getInstruction(r.endIndex);if(s.args[1]<t+1)return n[s.args[1]];for(let i=t+1;i<=s.args[1];i++){let o=e.getInstruction(i);if(!ge(o)){for(let a of o.args)if(a<t&&n[a])return!0}}return!1}function jz(e,t,n){let r=e.getInstruction(t);for(let s=t;s<=r.endIndex;s++){let i=e.getInstruction(s);if(!ge(i)){for(let o of i.args)if(n[o]!==o)return!0}}return!1}function Jz(e,t){let{chunk:n,derivativeMap:r,valueMap:s,ZERO:i}=e,o=n.getInstruction(t),a=o.endIndex,u=n.getInstruction(a),c;if(o.type===23)s[t]=_n(n,o,[s[o.args[0]]]),r[t]=i,c=t+1;else{let p=[];p.push(s[o.args[0]],s[o.args[1]]);for(let f=2;f<o.args.length;f++)p.push(s[o.args[f]],r[o.args[f]]);s[t]=_n(n,o,p),r[t]=i;for(let f=2;f<o.args.length;f++)s[t+f-1]=_n(n,n.getInstruction(t+f-1),[s[t]]),r[t+f-1]=_n(n,n.getInstruction(t+f-1),[s[t]]);c=t+o.args.length-1}Gh({...e,mustCopy:!0},c,a-1);let l=[];l.push(s[u.args[0]]);for(let p=1;p<u.args.length;p++)l.push(s[u.args[p]],r[u.args[p]]);s[a]=_n(n,u,l),r[a]=i;for(let p=1;p<u.args.length;p++)s[a+p]=_n(n,n.getInstruction(a+p),[s[a]]),r[a+p]=_n(n,n.getInstruction(a+p),[s[a]]);return a+u.args.length-1}function Vh(e,t){let{chunk:n,valueMap:r,mustCopy:s,referenced:i}=e;if(!i[t])return t;let o=n.getInstruction(t);if(ge(o))return s?po(n,o):t;{let a=[],u=!1;for(let c of o.args)a.push(r[c]),r[c]!==c&&(u=!0);return u||s?_n(n,o,a):t}}function Qz(e,t){let{chunk:n,derivativeMap:r}=e,s=n.getInstruction(t),i=[],o=s.recursionGroup;for(let a of o){let u=n.getInstruction(a),c={argTypes:[]};for(let p of u.signature.argTypes)c.argTypes.push(p,p);let l=r[a];l||(l=n.FunctionHeader(u.symbol+`_\\u2202${e.derivativeVarIndex}`,u.valueType,c,u.parameterSymbols),i.push(l)),e.derivativeMap[a]=l}for(let a of i){let u=n.getInstruction(a);u.recursionGroup=i}return e.derivativeMap[t]}function Kz(e,t){let{chunk:n,valueMap:r,derivativeMap:s}=e,o=n.getInstruction(t).args[0],a=n.getInstruction(o),u=a.endIndex,l=n.getInstruction(u).args[1],p=s[o],f=n.BeginFunction([p]);s[t]=f;let d=a.signature.argTypes,y=[];for(let x=0;x<d.length;x++){let T=d[x],D=t+x+1;y.push(D);let P=n.BlockVar(T,[f]),C=n.BlockVar(T,[f]);r[D]=P,s[D]=C}let g=t+d.length+1,m=u-1,h=ol(n,y,g,m),b=r.slice();return b[o]=o,Gh({...e,valueMap:b,mustCopy:!0,forwardMask:h},g,m),n.EndFunction([f,s[l]]),u}function eU(e,t){let{chunk:n,derivativeVarIndex:r,forwardSeed:s,forwardMask:i,valueMap:o,derivativeMap:a,ZERO:u,ONE:c,NAN:l}=e,p=n.getInstruction(t);if(t===r){let d;switch(s){case\"real\":d=c;break;case\"complexOne\":d=n.NativeFunction(\"complex\",[c,u]);break;case\"complexI\":d=n.NativeFunction(\"complex\",[u,c]);break}if(j(p.valueType)){let y=ur(n,t),g=n.BeginBroadcast([y]),m=n.EndBroadcast([g,d]);return n.BroadcastResult(p.valueType,[m])}else return d}if(es(p)||ds(p)||p.type===47||p.type===48||p.type===25||p.type===27||p.type===26||p.type===29||p.type===28||p.type===32||p.type===31||p.type===42||p.type===44||p.type===49||p.valueType===ft)return u;if(p.type===4)return Qz(e,t);if(!i[t]||ge(p))return p.valueType!==I?nU(n,[o[t],u]):p.type!==1||isFinite(V(p.value))?u:l;if(p.type===38||p.type===15){let d=[];for(let y of p.args)d.push(a[y]);return _n(n,p,d)}if(p.type===33)return _n(n,p,[o[p.args[0]],a[p.args[1]],a[p.args[2]]]);if(p.type===55){let y=[a[p.args[0]]];for(let g of p.args.slice(1)){y.push(o[g]);let m=a[g];if(m===u){let h=n.getInstruction(g).valueType;NS(h)&&(m=n.ZeroOfType(h))}y.push(m)}return n.FunctionCall(y)}let f=u;for(let d=0;d<p.args.length;d++){if(!i[p.args[d]])continue;let y=a[p.args[d]];if(y===u)continue;let g=tU(e,o[t],d,y);g!==u&&(f=f===u?g:rU(n,[g,f]))}return f}function tU(e,t,n,r){let{chunk:s,ZERO:i,ONE:o,NAN:a}=e,u=s.getInstruction(t);switch(u.type){case 8:return r;case 9:switch(n){case 0:return r;default:return s.Negative([r])}case 10:switch(n){case 0:return s.Multiply([r,u.args[1]]);default:return s.Multiply([u.args[0],r])}case 11:switch(n){case 0:return s.Divide([r,u.args[1]]);default:return s.Multiply([u.args[0],s.Divide([s.Negative([r]),s.Multiply([u.args[1],u.args[1]])])])}case 14:return s.Negative([r]);case 12:case 13:switch(n){case 0:return s.Multiply([s.Multiply([u.args[1],s.Exponent([u.args[0],s.Subtract([u.args[1],o])])]),r]);default:return s.Multiply([s.Piecewise([s.Equal([u.args[0],i]),s.Piecewise([s.GreaterEqual([u.args[1],i]),i,a]),s.Multiply([s.NativeFunction(\"ln\",[u.args[0]]),t])]),r])}case 37:return sU(s,t,WA[u.symbol][n],r);case 39:case 40:case 41:switch(n){case 0:return _n(s,u,[r,u.args[1]]);default:return i}case 16:return _n(s,u,[r]);default:{let c=u;throw new Error(`Unimplemented derivative for opcode ${c.type}`)}}}function nU(e,t){switch(e.getInstruction(t[0]).valueType){case de:return e.NativeFunction(\"scaleTangentSegment\",t);case fe:return e.NativeFunction(\"scaleTangentLine\",t);case Ne:return e.NativeFunction(\"scaleTangentRay\",t);case ce:return e.NativeFunction(\"scaleTangentCircle\",t);case ie:return e.NativeFunction(\"scaleTangentArc\",t);case Le:return e.NativeFunction(\"scaleTangentUndirectedAngleMarker\",t);case ye:return e.NativeFunction(\"scaleTangentDirectedAngleMarker\",t);case xe:return e.NativeFunction(\"scaleTangentPolygon\",t);case Re:return e.NativeFunction(\"scaleTangentTransformation\",t);default:return e.Multiply(t)}}function rU(e,t){switch(e.getInstruction(t[0]).valueType){case de:return e.NativeFunction(\"addTangentSegment\",t);case wt:return e.NativeFunction(\"addTangentSegmentThreeD\",t);case fe:return e.NativeFunction(\"addTangentLine\",t);case Ne:return e.NativeFunction(\"addTangentRay\",t);case le:return e.NativeFunction(\"addTangentVector\",t);case ce:return e.NativeFunction(\"addTangentCircle\",t);case ie:return e.NativeFunction(\"addTangentArc\",t);case Le:return e.NativeFunction(\"addTangentUndirectedAngleMarker\",t);case ye:return e.NativeFunction(\"addTangentDirectedAngleMarker\",t);case xe:return e.NativeFunction(\"addTangentPolygon\",t);case Re:return e.NativeFunction(\"addTangentTransformation\",t);default:return e.Add(t)}}function sU(e,t,n,r){let s=rd.empty(tt),o=e.getInstruction(t).args;for(let a=0;a<o.length;a++){let u=iU[a];s.addLexicalBinding(u,o[a])}return s.addLexicalBinding(\"x_1\",r),s.addLexicalBinding(\"q\",t),Fe(HM(YA,e,s,sm.root,void 0,void 0),n)}var iU=[\"x\",\"y\",\"z\",\"u\"],ZA={exp:[\"q*x_1\"],complexExp:[\"q*x_1\"],ln:[\"\\\\{x >= 0: x_1/x \\\\}\"],complexLn:[\"x_1/x\"],log:[\"\\\\{x >= 0: x_1/(x*\\\\ln(10)) \\\\}\"],complexLog:[\"x_1/(x*\\\\ln(10))\"],sqrt:[\"x_1/(2*q)\"],complexSqrt:[\"x_1/(2*q)\"],complexPow:[\"y*\\\\complexPow(x,y-1)*x_1\",\"q*\\\\complexLn(x)*x_1\"],rtxsqpone:[\"x*x_1/q\"],rtxsqmone:[\"x*x_1/q\"],sin:[\"\\\\cos(x)*x_1\"],complexSin:[\"\\\\cos(x)*x_1\"],cos:[\"-\\\\sin(x)*x_1\"],complexCos:[\"-\\\\sin(x)*x_1\"],tan:[\"(1+q^2)*x_1\"],complexTan:[\"(s*s)*x_1 \\\\with s=\\\\sec(x)\"],arcsin:[\"x_1/\\\\sqrt{1 - x^2}\"],complexArcsin:[\"x_1/(\\\\complexSqrt(1+x)\\\\complexSqrt(1-x))\"],arccos:[\"-x_1/\\\\sqrt{1 - x^2}\"],complexArccos:[\"-x_1/(\\\\complexSqrt(1+x)\\\\complexSqrt(1-x))\"],sinh:[\"\\\\cosh(x)*x_1\"],complexSinh:[\"\\\\cosh(x)*x_1\"],cosh:[\"\\\\sinh(x)*x_1\"],complexCosh:[\"\\\\sinh(x)*x_1\"],tanh:[\"(\\\\sech(x))^2*x_1\"],complexTanh:[\"(s*s)*x_1 \\\\with s=\\\\sech(x)\"],arcsinh:[\"x_1/\\\\rtxsqpone(x)\"],complexArcsinh:[\"x_1/(\\\\complexSqrt(1+\\\\complex(0,1)x)\\\\complexSqrt(1-\\\\complex(0,1)x))\"],arccosh:[\"\\\\{ x > 0: x_1/\\\\rtxsqmone(x) \\\\}\"],complexArccosh:[\"x_1/(\\\\complexSqrt(x+1)\\\\complexSqrt(x-1))\"],arctanh:[\"\\\\{ \\\\abs(x) < 1: x_1/(1 - x^2) \\\\}\"],complexArctanh:[\"x_1/((1+x)(1-x))\"],csc:[\"-\\\\cot(x)*q*x_1\"],complexCsc:[\"-\\\\cot(x)*q*x_1\"],sec:[\"\\\\tan(x)*q*x_1\"],complexSec:[\"\\\\tan(x)*q*x_1\"],cot:[\"-(1+q^2)*x_1\"],complexCot:[\"-(c*c)*x_1 \\\\with c=\\\\csc(x)\"],arccsc:[\"-x_1/(\\\\abs(x)*\\\\rtxsqmone(x))\"],complexArccsc:[\"-x_1/((x\\\\complexSqrt(1-1/x))(x\\\\complexSqrt(1+1/x)))\"],arcsec:[\"x_1/(\\\\abs(x)*\\\\rtxsqmone(x))\"],complexArcsec:[\"x_1/((x\\\\complexSqrt(1-1/x))(x\\\\complexSqrt(1+1/x)))\"],arccot:[\"-x_1/(1+x^2)\"],complexArccot:[\"-x_1/((x+\\\\complex(0,1))(x-\\\\complex(0,1)))\"],csch:[\"-\\\\coth(x)*q*x_1\"],complexCsch:[\"-\\\\coth(x)*q*x_1\"],sech:[\"-\\\\tanh(x)*q*x_1\"],complexSech:[\"-\\\\tanh(x)*q*x_1\"],coth:[\"-(\\\\csch(x))^2*x_1\"],complexCoth:[\"-(c*c)*x_1 \\\\with c=\\\\csch(x)\"],arccsch:[\"-x_1/(\\\\abs(x)*\\\\rtxsqpone(x))\"],complexArccsch:[\"-x_1/((x\\\\complexSqrt(1+\\\\complex(0,1)/x))(x\\\\complexSqrt(1-\\\\complex(0,1)/x)))\"],arcsech:[\"\\\\{ x >= 0: -x_1/(x*\\\\sqrt{1 - x^2}) \\\\}\"],complexArcsech:[\"-x_1/((x\\\\complexSqrt((1-x)/(1+x)))(1+x))\"],arccoth:[\"\\\\{ \\\\abs(x) > 1 : x_1/(1 - x^2) \\\\}\"],complexArccoth:[\"x_1/((1+x)(1-x))\"],factorial:[\"q*\\\\polyGamma(0, x + 1)*x_1\"],floor:[\"\\\\{ q=x: 0/0, 0*x_1 \\\\}\"],complexFloor:[\"\\\\{ \\\\real(d) + \\\\imag(d) = 0: 0/0, \\\\imag(d) - \\\\real(d) = 1: 0/0, 0*x_1 \\\\} \\\\with d = x - q\"],ceil:[\"\\\\{ q=x: 0/0, 0*x_1 \\\\}\"],complexCeil:[\"\\\\{ \\\\real(d) + \\\\imag(d) = 0: 0/0, \\\\imag(d) - \\\\real(d) = -1: 0/0, 0*x_1 \\\\} \\\\with d = x - q\"],round:[\"\\\\{ \\\\abs(\\\\mod(x, 1) - 0.5) > 0: 0*x_1 \\\\}\"],complexRound:[\"\\\\{ \\\\real(q) - \\\\real(x) = 0.5: 0/0, \\\\imag(q) - \\\\imag(x) = 0.5: 0/0, 0*x_1 \\\\}\"],abs:[\"\\\\{ x=0: 0/0, \\\\sign(x)*x_1 \\\\}\"],sign:[\"\\\\{ x=0: 0/0, 0*x_1 \\\\}\"],distance:[\"-((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/q\",\"((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/q\"],distanceThreeD:[\"-((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y+(y.z-x.z)*x_1.z)/q\",\"((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y+(y.z-x.z)*x_1.z)/q\"],segmentThreeD:[\"\\\\segmentThreeD(x_1,(0,0,0))\",\"\\\\segmentThreeD((0,0,0),x_1)\"],vectorThreeD:[\"\\\\vectorThreeD(x_1,(0,0,0))\",\"\\\\vectorThreeD((0,0,0),x_1)\"],triangle:[\"\\\\triangle(x_1,(0,0,0),(0,0,0))\",\"\\\\triangle((0,0,0),x_1,(0,0,0))\",\"\\\\triangle((0,0,0),(0,0,0),x_1)\"],sphere:[\"\\\\sphere(x_1,0)\",\"\\\\sphere((0,0,0),x_1)\"],pointDet:[\"\\\\pointDet(x_1,y)\",\"\\\\pointDet(x,x_1)\"],pointDot:[\"\\\\pointDot(x_1,y)\",\"\\\\pointDot(x,x_1)\"],pointPerp:[\"\\\\pointPerp(x_1)\"],complexMultiplyPoints:[\"\\\\complexMultiplyPoints(x_1,y)\",\"\\\\complexMultiplyPoints(x,x_1)\"],segment:[\"\\\\segment(x_1,(0,0))\",\"\\\\segment((0,0),x_1)\"],line:[\"\\\\line(x_1,(0,0))\",\"\\\\line((0,0),x_1)\"],ray:[\"\\\\ray(x_1,(0,0))\",\"\\\\ray((0,0),x_1)\"],vector:[\"\\\\vector(x_1, (0,0))\",\"\\\\vector((0,0), x_1)\"],mathVector:[\"\\\\mathVector(x_1,(0,0))\",\"\\\\mathVector((0,0),x_1)\"],mathVectorThreeD:[\"\\\\mathVectorThreeD(x_1,(0,0,0))\",\"\\\\mathVectorThreeD((0,0,0),x_1)\"],rawTransform:[\"\\\\rawTransform(x_1,(0,0))\",\"\\\\rawTransform((0,0),x_1)\"],rawTransformConj:[\"\\\\rawTransformConj(x_1,(0,0))\",\"\\\\rawTransformConj((0,0),x_1)\"],transformWithoutTranslation:[\"\\\\transformWithoutTranslation(x_1)\"],transformScaleFactor:[\"\\\\transformScaleFactor(x_1)\"],vectorDisplacementAsPoint:[\"\\\\vectorDisplacementAsPoint(x_1)\"],vectorThreeDDisplacementAsPoint:[\"\\\\vectorThreeDDisplacementAsPoint(x_1)\"],basePointFromVector:[\"\\\\basePointFromVector(x_1)\"],basePointFromVectorThreeD:[\"\\\\basePointFromVectorThreeD(x_1)\"],circle:[\"\\\\circle(x_1,0)\",\"\\\\circle((0,0),x_1)\"],arc:[\"\\\\arc(x_1,(0,0),(0,0))\",\"\\\\arc((0,0),x_1,(0,0))\",\"\\\\arc((0,0),(0,0),x_1)\"],arcCenter:[\"(\\\\pointDot(q-p1,p1_1)\\\\pointPerp(v_2)+\\\\pointDot(q-p2,p2_1)\\\\pointPerp(v_3)+\\\\pointDot(q-p3,p3_1)\\\\pointPerp(v_1))/\\\\pointDet(v_2,v_1) \\\\with v_1=p2-p1,v_2=p3-p2,v_3=p1-p3\".replace(/p1_1/g,\"\\\\arcFirstPoint(x_1)\").replace(/p2_1/g,\"\\\\arcMiddlePoint(x_1)\").replace(/p3_1/g,\"\\\\arcThirdPoint(x_1)\").replace(/p1/g,\"\\\\arcFirstPoint(x)\").replace(/p2/g,\"\\\\arcMiddlePoint(x)\").replace(/p3/g,\"\\\\arcThirdPoint(x)\")],arcFirstPoint:[\"\\\\arcFirstPoint(x_1)\"],arcMiddlePoint:[\"\\\\arcMiddlePoint(x_1)\"],arcThirdPoint:[\"\\\\arcThirdPoint(x_1)\"],arcOmega:[\"2 * (X_1*Y/(Y*Y+X*X) - Y_1*X/(Y*Y+X*X))\".replace(/X_1/g,\"((v1x * v2y_1 + v1x_1 * v2y) - (v2x_1 * v1y + v2x * v1y_1))\").replace(/Y_1/g,\"((v1x * v2x_1 + v1x_1 * v2x) + (v1y_1 * v2y + v1y * v2y_1))\").replace(/X/g,\"(v1x * v2y - v2x * v1y)\").replace(/Y/g,\"(v1x * v2x + v1y * v2y)\").replace(/v1x_1/g,\"(\\\\arcMiddlePoint(x_1) - \\\\arcFirstPoint(x_1)).x\").replace(/v2x_1/g,\"(\\\\arcThirdPoint(x_1) - \\\\arcMiddlePoint(x_1)).x\").replace(/v1y_1/g,\"(\\\\arcMiddlePoint(x_1) - \\\\arcFirstPoint(x_1)).y\").replace(/v2y_1/g,\"(\\\\arcThirdPoint(x_1) - \\\\arcMiddlePoint(x_1)).y\").replace(/v1x/g,\"(\\\\arcMiddlePoint(x) - \\\\arcFirstPoint(x)).x\").replace(/v2x/g,\"(\\\\arcThirdPoint(x) - \\\\arcMiddlePoint(x)).x\").replace(/v1y/g,\"(\\\\arcMiddlePoint(x) - \\\\arcFirstPoint(x)).y\").replace(/v2y/g,\"(\\\\arcThirdPoint(x) - \\\\arcMiddlePoint(x)).y\")],center:[\"\\\\center(x_1)\"],radius:[\"\\\\radius(x_1)\"],undirectedAngleMarker:[\"\\\\undirectedAngleMarker(x_1)\"],directedAngleMarker:[\"\\\\directedAngleMarker(x_1,0,0,0)\",\"\\\\directedAngleMarker((0,0),x_1,0,0)\",\"\\\\directedAngleMarker((0,0),0,x_1,0)\",\"\\\\directedAngleMarker((0,0),0,0,x_1)\"],directedCoterminalAngle:[\"\\\\directedAngleMarker((0,0),0,\\\\directedAngleMarkerRawDelta(x_1),0)\"],undirectedCoterminalAngle:[\"\\\\undirectedAngleMarker(\\\\directedAngleMarker((0,0),0,\\\\undirectedAngleMarkerRawDelta(x_1),0))\"],supplement:[\"\\\\directedAngleMarker((0,0),0,-\\\\directedAngleMarkerRawDelta(x_1),0)\"],directedAngleMarkerMultiplier:[\"\\\\directedAngleMarkerMultiplier(x_1)\"],undirectedAngleMarkerMultiplier:[\"\\\\undirectedAngleMarkerMultiplier(x_1)\"],directedAngleMarkerRawDelta:[\"\\\\directedAngleMarkerRawDelta(x_1)\"],undirectedAngleMarkerRawDelta:[\"\\\\undirectedAngleMarkerRawDelta(x_1)\"],polygonInteriorUndirectedAngles:[\"\\\\polygonInteriorUndirectedAngles(x_1)\"],polygonInteriorDirectedAngles:[\"\\\\polygonInteriorDirectedAngles(x_1)\"],lineFromSegment:[\"\\\\lineFromSegment(x_1)\"],lineFromRay:[\"\\\\lineFromRay(x_1)\"],segmentGlider:[\"\\\\segmentGlider(x_1,y)\",\"\\\\{0<y<1:(\\\\segmentGlider(x,1)-\\\\segmentGlider(x,0))*x_1,(0,0)\\\\}\"],segmentThreeDGlider:[\"\\\\segmentThreeDGlider(x_1,y)\",\"\\\\{0<y<1:(\\\\segmentThreeDGlider(x,1)-\\\\segmentThreeDGlider(x,0))*x_1,(0,0,0)\\\\}\"],rayGlider:[\"\\\\rayGlider(x_1,y)\",\"\\\\{0<y:(\\\\rayGlider(x,1)-\\\\rayGlider(x,0))*x_1,(0,0)\\\\}\"],lineGlider:[\"\\\\lineGlider(x_1,y)\",\"(\\\\lineGlider(x,1)-\\\\lineGlider(x,0))*x_1\"],circleGlider:[\"\\\\circleGlider(x_1,y)\",\"\\\\{0<y<1:2*\\\\pi*\\\\pointPerp(q-\\\\center(x))*x_1,(0,0)\\\\}\"],arcGlider:[\"(0/0,0/0)\",\"(0/0,0/0)\"],polygonEdgeByParameter:[\"\\\\polygonEdgeByParameter(x_1,y)\",\"\\\\{\\\\floor(y)=y:\\\\segment((0/0,0/0),(0/0,0/0)),\\\\segment((0,0),(0,0))\\\\}\"],polygonGlider:[\"\\\\polygonGlider(x_1,y)\",\"\\\\{y<0:(0,0),y>x.\\\\vertices.\\\\count:(0,0),\\\\floor(y)=y:(0/0,0/0),(x_1*(\\\\segmentGlider(s,1)-\\\\segmentGlider(s,0))\\\\with s=\\\\polygonEdgeByParameter(x,y))\\\\}\"],chooseNonIncidentPoint:[\"(0/0,0/0)\"],circleCircleIntersection:[\"(\\\\radius(x)*\\\\radius(x_1)+\\\\pointDot(\\\\center(x_1),(q-\\\\center(x))))/\\\\pointDot(\\\\pointPerp(q-\\\\center(y)),q-\\\\center(x))*\\\\pointPerp(q-\\\\center(y))\",\"(\\\\radius(y)*\\\\radius(x_1)+\\\\pointDot(\\\\center(x_1),(q-\\\\center(y))))/\\\\pointDot(\\\\pointPerp(q-\\\\center(x)),q-\\\\center(y))*\\\\pointPerp(q-\\\\center(x))\"],circleArcIntersection:[\"(0/0,0/0)\"],circleLineIntersection:[\"(\\\\radius(x)*\\\\radius(x_1)+\\\\pointDot(\\\\center(x_1),(q-\\\\center(x))))/\\\\pointDot((\\\\lineGlider(y,1)-\\\\lineGlider(y,0)),q-\\\\center(x))*(\\\\lineGlider(y,1)-\\\\lineGlider(y,0))\",\"(\\\\pointDet(\\\\lineGlider(x_1,0),\\\\lineGlider(y,1))+\\\\pointDet(\\\\lineGlider(y,0),\\\\lineGlider(x_1,1))-\\\\pointDet(q,\\\\lineGlider(x_1,1)-\\\\lineGlider(x_1,0)))/(\\\\pointDet(\\\\pointPerp(q-\\\\center(x)),\\\\lineGlider(y,1)-\\\\lineGlider(y,0)))*(\\\\pointPerp(q-\\\\center(x)))\"],arcCircleIntersection:[\"(0/0,0/0)\"],arcArcIntersection:[\"(0/0,0/0)\"],arcLineIntersection:[\"(0/0,0/0)\"],lineCircleIntersection:[\"(\\\\pointDet(\\\\lineGlider(x_1,0),\\\\lineGlider(x,1))+\\\\pointDet(\\\\lineGlider(x,0),\\\\lineGlider(x_1,1))-\\\\pointDet(q,\\\\lineGlider(x_1,1)-\\\\lineGlider(x_1,0)))/(\\\\pointDet(\\\\pointPerp(q-\\\\center(y)),\\\\lineGlider(x,1)-\\\\lineGlider(x,0)))*(\\\\pointPerp(q-\\\\center(y)))\",\"(\\\\radius(y)*\\\\radius(x_1)+\\\\pointDot(\\\\center(x_1),(q-\\\\center(y))))/\\\\pointDot((\\\\lineGlider(x,1)-\\\\lineGlider(x,0)),q-\\\\center(y))*(\\\\lineGlider(x,1)-\\\\lineGlider(x,0))\"],lineArcIntersection:[\"(0/0,0/0)\"],lineLineIntersection:[\"(\\\\pointDet(\\\\lineGlider(x_1,0),\\\\lineGlider(x,1))+\\\\pointDet(\\\\lineGlider(x,0),\\\\lineGlider(x_1,1))-\\\\pointDet(q,\\\\lineGlider(x_1,1)-\\\\lineGlider(x_1,0)))/(\\\\pointDet(\\\\lineGlider(y,1)-\\\\lineGlider(y,0),\\\\lineGlider(x,1)-\\\\lineGlider(x,0)))*(\\\\lineGlider(y,1)-\\\\lineGlider(y,0))\",\"(\\\\pointDet(\\\\lineGlider(x_1,0),\\\\lineGlider(y,1))+\\\\pointDet(\\\\lineGlider(y,0),\\\\lineGlider(x_1,1))-\\\\pointDet(q,\\\\lineGlider(x_1,1)-\\\\lineGlider(x_1,0)))/(\\\\pointDet(\\\\lineGlider(x,1)-\\\\lineGlider(x,0),\\\\lineGlider(y,1)-\\\\lineGlider(y,0)))*(\\\\lineGlider(x,1)-\\\\lineGlider(x,0))\"],parallel:[\"\\\\parallel(x_1,(0,0))\",\"\\\\parallel(\\\\line((0,0),(0,0)),x_1)\"],perpendicular:[\"\\\\perpendicular(x_1,(0,0))\",\"\\\\perpendicular(\\\\line((0,0),(0,0)),x_1)\"],angleVertex:[\"\\\\angleVertex(x_1)\"],angleStart:[\"\\\\angleStart(x_1)\"],directedAngleVertex:[\"\\\\directedAngleVertex(x_1)\"],directedAngleStart:[\"\\\\directedAngleStart(x_1)\"],anglebisector:[\"\\\\ray(\\\\angleVertex(x_1),\\\\angleVertex(x_1) + \\\\pointPerp( \\\\rayGlider(q,1) - \\\\angleVertex(x) ) * (s_1 + d_1 / 2)) \\\\with s_1 = \\\\angleStart(x_1), d_1 = \\\\undirectedAngleMarkerRawDelta(x_1)\"],directedanglebisector:[\"\\\\ray(\\\\directedAngleVertex(x_1),\\\\directedAngleVertex(x_1) + \\\\pointPerp( \\\\rayGlider(q,1) - \\\\directedAngleVertex(x) ) * (s_1 + d_1 / 2)) \\\\with s_1 = \\\\directedAngleStart(x_1), d_1 = \\\\directedAngleMarkerRawDelta(x_1)\"],scaleTangentTransformation:[\"\\\\scaleTangentTransformation(x_1, y)\",\"\\\\scaleTangentTransformation(x, x_1)\"],scaleTangentPolygon:[\"\\\\scaleTangentPolygon(x_1, y)\",\"\\\\scaleTangentPolygon(x, x_1)\"],scaleTangentSegment:[\"\\\\scaleTangentSegment(x_1, y)\",\"\\\\scaleTangentSegment(x, x_1)\"],scaleTangentLine:[\"\\\\scaleTangentLine(x_1, y)\",\"\\\\scaleTangentLine(x, x_1)\"],scaleTangentRay:[\"\\\\scaleTangentRay(x_1, y)\",\"\\\\scaleTangentRay(x, x_1)\"],scaleTangentCircle:[\"\\\\scaleTangentCircle(x_1, y)\",\"\\\\scaleTangentCircle(x, x_1)\"],scaleTangentArc:[\"\\\\scaleTangentArc(x_1, y)\",\"\\\\scaleTangentArc(x, x_1)\"],scaleTangentDirectedAngleMarker:[\"\\\\scaleTangentDirectedAngleMarker(x_1, y)\",\"\\\\scaleTangentDirectedAngleMarker(x, x_1)\"],scaleTangentUndirectedAngleMarker:[\"\\\\scaleTangentUndirectedAngleMarker(x_1, y)\",\"\\\\scaleTangentUndirectedAngleMarker(x, x_1)\"],addTangentPolygon:[\"x_1\",\"x_1\"],addTangentSegment:[\"x_1\",\"x_1\"],addTangentSegmentThreeD:[\"x_1\",\"x_1\"],addTangentLine:[\"x_1\",\"x_1\"],addTangentRay:[\"x_1\",\"x_1\"],addTangentVector:[\"x_1\",\"x_1\"],addTangentCircle:[\"x_1\",\"x_1\"],addTangentArc:[\"x_1\",\"x_1\"],addTangentDirectedAngleMarker:[\"x_1\",\"x_1\"],addTangentUndirectedAngleMarker:[\"x_1\",\"x_1\"],addTangentTransformation:[\"x_1\",\"x_1\"],translation:[\"\\\\rawTransform((0,0),x_1)\"],dilation:[\"\\\\rawTransform((0,0),(1-y)x_1)\",\"\\\\rawTransform((x_1,0),-x*x_1)\"],reflection:[\"\\\\rawTransformConj(a_1,p1_1-\\\\complexMultiplyPoints(a_1,(p1.x,-p1.y))-\\\\complexMultiplyPoints(qa,(p1_1.x,-p1_1.y)))\\\\with a_1=\\\\pointPerp(qa)*(\\\\pointDet(v,v_1)*2/(v.x^2+v.y^2))\".replace(/p1_1/g,\"\\\\glider(x_1,0)\").replace(/p1/g,\"\\\\glider(x,0)\").replace(/v_1/g,\"(\\\\glider(x_1,1)-\\\\glider(x_1,0))\").replace(/v/g,\"(\\\\glider(x,1)-\\\\glider(x,0))\").replace(/qa/g,\"\\\\transformScaleFactor(q)\")],rotation:[\"\\\\rawTransform((0,0),\\\\complexMultiplyPoints(p,x_1))\\\\with p=(1,0)-(\\\\cos(y),\\\\sin(y))\",\"\\\\rawTransform(p,\\\\complexMultiplyPoints(-p,x))\\\\with p=(-x_1*\\\\sin(y),x_1*\\\\cos(y))\"],compose:[\"\\\\reflection(\\\\line((0/0,0/0),(0/0,0/0)))\",\"\\\\reflection(\\\\line((0/0,0/0),(0/0,0/0)))\"],inverse:[\"\\\\reflection(\\\\line((0/0,0/0),(0/0,0/0)))\"],transformPoint:[\"\\\\transformPoint(x_1,y)\",\"\\\\transformPoint(\\\\transformWithoutTranslation(x),x_1)\"],transformSegment:[\"\\\\transformSegment(x_1,y)\",\"\\\\transformSegment(\\\\transformWithoutTranslation(x),x_1)\"],transformVector:[\"\\\\transformVector(x_1,y)\",\"\\\\transformVector(\\\\transformWithoutTranslation(x),x_1)\"],transformLine:[\"\\\\transformLine(x_1,y)\",\"\\\\transformLine(\\\\transformWithoutTranslation(x),x_1)\"],transformRay:[\"\\\\transformRay(x_1,y)\",\"\\\\transformRay(\\\\transformWithoutTranslation(x),x_1)\"],transformCircle:[\"\\\\circle(\\\\transformPoint(x_1,y.\\\\center), y.\\\\radius * \\\\pointDot(a_1,a) / \\\\hypot(a.x,a.y))\\\\with a=\\\\transformScaleFactor(x),a_1=\\\\transformScaleFactor(x_1)\",\"\\\\transformCircle(\\\\transformWithoutTranslation(x),x_1)\"],transformArc:[\"\\\\transformArc(x_1,y)\",\"\\\\transformArc(\\\\transformWithoutTranslation(x),x_1)\"],transformPolygon:[\"\\\\transformPolygon(x_1,y)\",\"\\\\transformPolygon(\\\\transformWithoutTranslation(x),x_1)\"],transformAngleMarker:[\"\\\\angle((1,0),(0,0),(1,0))\",\"\\\\transformAngleMarker(\\\\transformWithoutTranslation(x),x_1)\"],transformDirectedAngleMarker:[\"\\\\directedangle((1,0),(0,0),(1,0))\",\"\\\\transformDirectedAngleMarker(\\\\transformWithoutTranslation(x),x_1)\"],mean:[\"\\\\mean(x_1)\"],total:[\"\\\\total(x_1)\"],count:[\"0\"],var:[\"2*\\\\cov(x, x_1)\"],varp:[\"2*\\\\cov(x, x_1)*(\\\\count(x)-1)/\\\\count(x)\"],stdev:[\"\\\\cov(x, x_1)/q\"],stdevp:[\"\\\\covp(x, x_1)/q\"],mad:[\"\\\\mean(\\\\sign(x-\\\\mean(x))*(x_1 - \\\\mean(x_1)))\"],listMin:[\"x_1[\\\\argmin(x)]\"],listMax:[\"x_1[\\\\argmax(x)]\"],min:[\"\\\\{x>y:0,x_1\\\\}\",\"\\\\{x<=y:0,x_1\\\\}\"],max:[\"\\\\{x<y:0,x_1\\\\}\",\"\\\\{x>=y:0,x_1\\\\}\"],median:[\"0.5*(x_1[\\\\lowerQuantileIndex(x, 0.5)] + x_1[\\\\upperQuantileIndex(x, 0.5)])\"],argmin:[\"0/0\"],argmax:[\"0/0\"],gcd:[\"0/0\"],complexGCD:[\"0/0\"],lcm:[\"0/0\"],complexLCM:[\"0/0\"],erf:[\"\\\\frac{2x_1}{\\\\sqrt{\\\\pi }}\\\\exp(-x^2)\"],invNorm:[\"\\\\frac{x_1}{\\\\pdf(\\\\normaldist(0,1),q)}\"],logbase:[\"\\\\{x > 0: \\\\frac{x_1}{x*\\\\ln(y)} \\\\}\",\"\\\\frac{-q*x_1}{y*\\\\ln(y)}\"],complexLogbase:[\"\\\\frac{x_1}{x*\\\\complexLn(y)}\",\"\\\\frac{-q*x_1}{y*\\\\complexLn(y)}\"],hypot:[\"x_1*x/q\",\"x_1*y/q\"],polyGamma:[\"0/0\",\"\\\\polyGamma(1 + x, y)*x_1\"],mod:[\"\\\\{ q=0: 0/0, x_1 \\\\}\",\"\\\\{ \\\\mod(x/y, 1) > 0: -\\\\floor(x/y)*x_1 \\\\}\"],complexMod:[\"\\\\{ q=0: 0/0, x_1 \\\\}\",\"\\\\{ \\\\round(r)=r: 0/0, -\\\\floor(x/y)*x_1 \\\\} \\\\with r=\\\\round(x/y)\"],cov:[\"\\\\cov(x_1, y)\",\"\\\\cov(x, x_1)\"],covp:[\"\\\\covp(x_1, y)\",\"\\\\covp(x, x_1)\"],corr:[\"(\\\\cov(x_1, y) - (\\\\cov(x, y)*\\\\cov(x, x_1)/\\\\var(x)))/(\\\\stdevp(x)\\\\stdevp(y))\",\"(\\\\cov(x, x_1) - (\\\\cov(x, y)*\\\\cov(y, x_1)/\\\\var(y)))/(\\\\stdevp(x)\\\\stdevp(y))\"],spearman:[\"0/0\",\"0/0\"],quantile:[\"\\\\{ \\\\floor(y*(\\\\count(x)-1)) = y*(\\\\count(x)-1) :   x_1[\\\\upperQuantileIndex(x, y)],  (\\\\ceil(y*(\\\\count(x)-1)) - y*(\\\\count(x)-1))*x_1[\\\\lowerQuantileIndex(x, y)] +   (y*(\\\\count(x)-1) - \\\\floor(y*(\\\\count(x)-1)))*x_1[\\\\upperQuantileIndex(x, y)]\\\\}\",\"\\\\{ \\\\floor(y*(\\\\count(x)-1)) < y*(\\\\count(x)-1) :   (\\\\count(x)-1)*(x[\\\\upperQuantileIndex(x, y)] - x[\\\\lowerQuantileIndex(x, y)])*x_1\\\\}\"],quartile:[\"0.5*(x_1[\\\\lowerQuartileIndex(x, y)] + x_1[\\\\upperQuartileIndex(x, y)])\",\"0/0\"],tscore:[\"\\\\frac{\\\\sqrt{\\\\count(x)}(\\\\stdev(x)*\\\\mean(x_1)-(\\\\mean(x)-y)*\\\\frac{\\\\cov(x,x_1)}{\\\\stdev(x)})}{\\\\stdev(x)^2}\",\"-x_1*\\\\sqrt{\\\\count(x)}/\\\\stdev(x)\"],quartileIndex:[\"0/0\",\"0/0\"],upperQuartileIndex:[\"0/0\",\"0/0\"],lowerQuartileIndex:[\"0/0\",\"0/0\"],upperQuantileIndex:[\"0/0\",\"0/0\"],lowerQuantileIndex:[\"0/0\",\"0/0\"],nCr:[\"q*(\\\\polyGamma(0, 1 + x) - \\\\polyGamma(0, 1 + x - y))\",\"q*(\\\\polyGamma(0, 1 + x - y) - \\\\polyGamma(0, 1 + y))\"],nPr:[\"q*(\\\\polyGamma(0, 1 + x) - \\\\polyGamma(0, 1 + x - y))\",\"q*\\\\polyGamma(0, 1 + x - y)\"],arctan:[\"x_1*y/(y^2+x^2)\",\"-x_1*x/(y^2+x^2)\"],complexArctan:[\"x_1/((x+\\\\complex(0,1))(x-\\\\complex(0,1)))\"],poissonpdf:[\"0/0\",\"x_1\\\\frac{\\\\exp(-y)(\\\\floor(x)-y)y^{(\\\\floor(x)-1)}}{(\\\\floor(x))!}\"],invPoisson:[\"0/0\",\"0/0\"],tpdf:[\"x_1*q*\\\\frac{-(y+1)*x}{y+x^2}\",\"x_1*\\\\frac{1}{2}q*(  \\\\frac{x^2-1}{y + x^2} + \\\\ln(\\\\frac{y}{y + x^2}) +   \\\\polyGamma(0, \\\\frac{1+y}{2}) - \\\\polyGamma(0, y/2))\"],invT:[\"x_1/\\\\pdf(\\\\tdist(y),q)\",\"0/0\"],tcdf:[\"-x_1*\\\\pdf(\\\\tdist(z),x)\",\"x_1*\\\\pdf(\\\\tdist(z),y)\",\"0/0\"],poissoncdf:[\"0/0\",\"0/0\",\"x_1\\\\sum _{n=\\\\max(0,\\\\floor(\\\\min(x,y)))}^{\\\\floor(\\\\max(x,y))}\\\\frac{\\\\exp(-z)(n-z)z^{(n-1)}}{n!}\"],normalpdf:[\"-x_1*\\\\frac{x-y}{z^2} q\",\"x_1*\\\\frac{x-y}{z^2} q\",\"x_1*(\\\\frac{(x-y-z)*(x-y+z)}{z^3}) q\"],binompdf:[\"0/0\",\"0/0\",\"\\\\{0<=z<=1: x_1*q*(\\\\frac{\\\\round(x)}{z}-\\\\frac{\\\\round(y)-\\\\round(x)}{1-z}), 0 \\\\}\"],invBinom:[\"0/0\",\"0/0\",\"0/0\"],uniformpdf:[\"0\",\"\\\\{y<=x: \\\\frac{x_1}{(z-y)^2}, 0\\\\}\",\"\\\\{z>=x: -\\\\frac{x_1}{(z-y)^2}, 0\\\\}\"],invUniform:[\"\\\\{y<=x<=z: x_1*(z-y), 0\\\\}\",\"\\\\{y<=x<=z: x_1*(1-x), 0\\\\}\",\"\\\\{y<=x<=z: x_1*x, 0\\\\}\"],normalcdf:[\"-x_1\\\\pdf(\\\\normaldist(z,u), x)\",\"x_1\\\\pdf(\\\\normaldist(z,u), y)\",\"-x_1*(\\\\pdf(\\\\normaldist(z,u), y) - \\\\pdf(\\\\normaldist(z,u), x))\",\"x_1*(  \\\\{\\\\abs(y)=1/0:0,\\\\frac{z-y}{u}\\\\pdf(\\\\normaldist(z,u),y)\\\\} -   \\\\{\\\\abs(x)=1/0:0,\\\\frac{z-x}{u}\\\\pdf(\\\\normaldist(z,u),x)\\\\})\"],binomcdf:[\"0/0\",\"0/0\",\"0/0\",\"\\\\{0<=u<=1: x_1*\\\\sum _{n=\\\\max(0,\\\\round(\\\\min(x,y)))}^{\\\\round(\\\\max(x,y))}(  \\\\pdf(\\\\binomialdist(z,u),n)*(\\\\frac{n}{u}-\\\\frac{\\\\round(z)-n}{1-u})), 0 \\\\}\"],uniformcdf:[\"\\\\{z>u: 0/0, -x_1\\\\pdf(\\\\uniformdist(z,u), x)\\\\}\",\"\\\\{z>u: 0/0, x_1\\\\pdf(\\\\uniformdist(z,u), y)\\\\}\",\"\\\\{z>u: 0/0, x_1*(\\\\frac{\\\\{z<x<u:u-x,0\\\\} + \\\\{z<y<u:y-u,0\\\\}}{(u-z)^2})\\\\}\",\"\\\\{z>u: 0/0, x_1*(\\\\frac{\\\\{z<x<u:x-z,0\\\\} + \\\\{z<y<u:z-y,0\\\\}}{(u-z)^2})\\\\}\"],normalSample:[\"0/0\",\"0/0\",\"0/0\"],uniformSample:[\"0/0\",\"0/0\",\"0/0\"],tSample:[\"0/0\",\"0/0\"],poissonSample:[\"0/0\",\"0/0\"],binomSample:[\"0/0\",\"0/0\",\"0/0\"],rgb:[\"0/0\",\"0/0\",\"0/0\"],hsv:[\"0/0\",\"0/0\",\"0/0\"],polygon:[\"\\\\polygon(x_1)\"],area:[\"0/0\"],perimeter:[\"0/0\"],vertices:[\"\\\\vertices(x_1)\"],segments:[\"\\\\segments(x_1)\"],validateRangeLength:[\"0\",\"0\",\"0\",\"\\\\{q \\\\ge 1: x_1, 0\\\\}\"],validateSampleCount:[\"\\\\{x<0:0,1\\\\}*x_1\"],select:[\"\\\\select(x_1, y)\",\"0*q\"],shuffle:[\"0*y\",\"\\\\shuffle(x, x_1)\"],sortPerm:[\"0*x\"],complexSortPerm:[\"0*x\"],elementsAt:[\"\\\\elementsAt(x_1, y)\",\"0*q\"],uniquePerm:[\"0*q\"],tone:[\"\\\\tone(x_1,0)\",\"\\\\tone(0,x_1)\"],restriction:[\"0\"],restrictionToBoolean:[\"0\"],complex:[\"\\\\complex(x_1,0)\",\"\\\\complex(0,x_1)\"],arg:[\"\\\\imag(x_1/x)\"],complexDivide:[\"x_1/y\",\"-(q/y)x_1\"],coerceComplexToReal:[\"\\\\coerceComplexToReal(x_1)\"],peelableCoerceComplexToReal:[\"\\\\peelableCoerceComplexToReal(x_1)\"],coerceRealToComplex:[\"\\\\coerceRealToComplex(x_1)\"]},WA={};for(let e in ZA){let t=e,n=ZA[t],r=[];for(let s=0;s<n.length;s++){let i=n[s];r.push(Mi(i,{}))}WA[t]=r}function im(e){return se(e,I)?\"number\":se(e,R)?\"complex\":void 0}function kh(e,t,n,r){let s=e.getInstruction(n).valueType;if(im(s)!==r)throw z(`Incorrect derivative strategy '${r}' for type ${s}.`);let i=e.getInstruction(t).valueType;if(!oU(i,r)){let o=e.areAllArgsConstant([t]);throw r===\"number\"?dT([oe(i)],{blockExport:o}):fT([oe(i),oe(s)],{blockExport:o})}switch(r){case\"number\":return Bh(e,t,n,\"real\");case\"complex\":let o=Bh(e,t,n,\"complexOne\"),a=Bh(e,t,n,\"complexI\");return e.Multiply([e.Constant(Se(1,2)),e.Subtract([o,e.Multiply([e.ImaginaryUnit(),a])])]);default:throw z(`Invalid derivative strategy '${r}'.`)}}function oU(e,t){switch(t){case\"number\":return kn(e,R)||kn(e,Ue)||se(e,N)||se(e,H);case\"complex\":return kn(e,R)||kn(e,Ue);default:throw z(`Invalid derivative strategy '${t}'.`)}}function zM(e,t,n){let r=e.getInstruction(n).valueType,s=im(r);if(!s)throw z(`chunk.derivative called on non-number ${at(r)}.`);return kh(e,t,n,s)}function jA(e){let t=[];t.push(\"digraph {\");for(let n=0;n<e.instructionsLength();n++)e.getInstruction(n).type!==0&&t.push(`${n} [label=\"${n}: ${al(e,n)}\"];`);for(let n=0;n<e.instructionsLength();n++){let r=e.getInstruction(n);if(tO(r))for(let s of r.args)t.push(`${n} -> ${s};`)}return t.push(\"}\"),t.join(`\n`)}var Ia=class e{constructor(t){this.derivativeMaps=new Th;if(this.instructions=[],this.blockMask=[],this.comments=[],t.argNames.length!==t.argTypes.length)throw new Error(\"Programming Error: length of argNames must match length of argTypes\");this.argNames=t.argNames,this.argTypes=t.argTypes;for(let n=0;n<this.argTypes.length;n++){let r=this.argTypes[n];this.LoadArg(r)}this.returnIndex=this.Constant(NaN)}computeNeedsThunking(){for(let t=this.returnIndex;t>=0;t--)if(this.instructions[t].type===55)return!0;return!1}setError(t){this.error=t}getError(){return this.error}setWarning(t){this.warning===void 0&&(this.warning=t)}restoreWarning(t){this.warning=t}getWarning(){return this.warning}getReturnIndex(){return this.returnIndex}setReturnIndex(t){if(!(0<=t&&t<this.instructions.length))throw new Error(`Programming Error: out of bounds return index ${t}`);this.returnIndex=t}addComments(t){for(let n in t){let r=this.comments[n]||\"\";this.comments[n]=r+t[n]}return this}instructionsLength(){return this.instructions.length}getInstruction(t){return this.instructions[t]}popInstruction(){this.unsafelyTruncate(this.instructions.length-1)}unsafelyTruncate(t){this.instructions.length=Math.min(t,this.instructions.length),this.blockMask.length=Math.min(t,this.blockMask.length),this.comments.length=Math.min(t,this.comments.length),this.derivativeMaps.truncate(t),this.setReturnIndex(this.instructions.length-1)}dereferenceFunctionHeader(t){let n=this.getInstruction(t);return n.endIndex===-1?void 0:n.endIndex}getDirectDependencies(t){if(t.type===55){let n=t.args,r=this.dereferenceFunctionHeader(n[0]);if(r!==void 0)return n.concat(r)}return t.args}getRecursionStructure(t){let n=this.getInstruction(t);if(n.endIndex===-1)throw z(\"Programming error: cannot get recursion structure before function is closed\");if(!n.__cachedRecursionStructure){let r={};for(let s of n.recursionGroup){let i=this.getInstruction(s);r[i.symbol]=s}n.__cachedRecursionStructure=hO(this,r)}return n.__cachedRecursionStructure}getRecursiveFunctionMetadata(t){let n=this.getRecursionStructure(t),r=this.getInstruction(t);return{type:n.canIterate?\"iterative\":\"general\",recursionGroup:r.recursionGroup.map(s=>this.getInstruction(s).symbol),returnType:r.valueType,signature:r.signature,recursiveStructure:n}}pushInstructionChecked(t){if(this.instructions.length>=32768)throw _T();this.instructions.push(t),this.setReturnIndex(this.instructions.length-1)}pushLeafInstruction(t){return this.pushInstructionChecked(t),this.getReturnIndex()}pushInstruction(t){return this.checkInstructionArguments(t),this.pushInstructionChecked(t),this.setReturnIndex(EN(this)),this.setReturnIndex(FN(this)),this.setReturnIndex(oN(this)),iN(this,this.getReturnIndex()),this.returnIndex===this.instructions.length-1&&this.setReturnIndex(PN(this)),this.getReturnIndex()}checkInstructionArguments(t){for(let n of t.args)if(this.blockMask[n])throw new Error(\"Programming Error: cannot reference an instruction in a closed block\")}markClosedBlock(t,n){for(let r=t;r<n;r++)this.blockMask[r]=!0}LoadArg(t){return this.pushLeafInstruction({type:2,valueType:t})}BlockVar(t,n){return this.pushInstruction({type:47,valueType:t,args:n})}SymbolicVar(t,n){return this.pushLeafInstruction({type:3,valueType:t,symbol:n})}BroadcastResult(t,n){let r=n[0],i=this.instructions[r].args[0],a=this.getInstruction(i).args[0],u=this.getInstruction(a);return this.pushInstruction({type:48,valueType:t,args:n,constantLength:Je(u)?hn(this,a):void 0})}Constant(t){return this.ConstantOfType(I,t)}ConstantOfType(t,n){if(typeof n==\"number\"&&(n=Se(n,1)),j(t)&&n.length>1e4)throw Hd();return this.pushLeafInstruction({type:1,valueType:t,value:n})}TupleOfType(t,n){return this.pushInstruction({type:15,valueType:t,args:n})}Slot(t,n){let r=16,s=this.getInstruction(n[0]).valueType,i=zl[s],o=i?i[t]:Qt;if(o===void 0)throw z(`Invalid slot index: ${t} for ${at(s)}.`);return this.pushInstruction({type:r,valueType:o,args:n,index:t})}ImaginaryUnit(){return this.ConstantOfType(R,[Se(0,1),Se(1,1)])}NanOfType(t){if(t===Lt){let n=this.Constant(NaN);return this.Distribution(\"uniformdist\",[n,n])}else return this.ConstantOfType(t,ls(t))}ZeroOfType(t){return this.ConstantOfType(t,RS(t))}Add(t){let n=8,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Subtract(t){let n=9,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Multiply(t){let n=10,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Divide(t){let n=11,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Exponent(t){let n=12,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}RawExponent(t){let n=13,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Negative(t){let n=14,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Equal(t){let n=25,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Less(t){let n=26,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Greater(t){let n=27,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}LessEqual(t){let n=28,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}GreaterEqual(t){let n=29,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Comparator(t,n){switch(t){case\"=\":return this.Equal(n);case\">\":return this.Greater(n);case\"<\":return this.Less(n);case\"<=\":return this.LessEqual(n);case\">=\":return this.GreaterEqual(n);default:{let r=t;throw new Error(`Unexpected comparator symbol: ${r}`)}}}Or(t){let n=31,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}And(t){let n=32,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}Piecewise(t){let n=33,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}List(t){let n=38,r=Sn(this,n,t);if(t.length>1e4)throw Hd();return this.pushInstruction({type:n,valueType:r,args:t})}ListAccess(t){let n=39,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}DeferredListAccess(t){let n=40,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}InboundsListAccess(t){let n=41,r=Sn(this,n,t);return this.pushInstruction({type:n,valueType:r,args:t})}NativeFunction(t,n){let r=37,s=Bn[t].returnType,i=typeof s==\"function\"?s(n.map(o=>this.getInstruction(o).valueType)):s;return this.pushInstruction({type:r,valueType:i,args:n,symbol:t})}Distribution(t,n){let r=42,s=Lt;return this.pushInstruction({type:r,valueType:s,args:n,symbol:t})}BeginIntegral(t,n){let r=21,s=Sn(this,r,[]);return this.pushInstruction({type:r,valueType:s,args:n,endIndex:-1,callData:t})}EndIntegral(t){let n=22,r=Sn(this,n,t),s=t[0],i=this.getInstruction(s);this.instructions[s]={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),callData:i.callData};let o=this.pushInstruction({type:n,valueType:r,args:t});return this.markClosedBlock(s,o),o}BeginBroadcast(t,n){let r=23,s=Sn(this,r,[]),i=this.getInstruction(t[0]);if(Je(i)&&hn(this,t[0])>1e4)throw Hd();return this.pushInstruction({type:r,valueType:s,endIndex:-1,args:t,context:n})}EndBroadcast(t){let n=24,r=Sn(this,n,t),s=t[0],i=this.getInstruction(s),o={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),context:i.context};this.instructions[s]=o;let a=this.pushInstruction({type:n,valueType:r,args:t});return this.markClosedBlock(s,a),a}BeginLoop(t,n){let r=19,s=Sn(this,r,n);return this.pushInstruction({type:r,valueType:s,args:n,endIndex:-1,callData:t})}EndLoop(t){let n=20,r=Sn(this,n,t),s=t[0],i=this.getInstruction(s);this.instructions[s]={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),callData:i.callData};let o=this.pushInstruction({type:n,valueType:r,args:t});return this.markClosedBlock(s,o),o}BeginMap(t,n){let r=50,s=Sn(this,r,n);return this.pushInstruction({type:r,valueType:s,args:n,endIndex:-1,callData:t})}EndMap(t){let n=51,r=Sn(this,n,t),s=t[0],i=this.getInstruction(s);this.instructions[s]={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),callData:i.callData};let o=this.pushInstruction({type:n,valueType:r,args:t});return this.markClosedBlock(s,o),o}FunctionHeader(t,n,r,s){let i=4;return this.pushLeafInstruction({type:i,valueType:n,endIndex:-1,symbol:t,signature:r,parameterSymbols:s,recursionGroup:[]})}BeginFunction(t){let n=53,r=this.getInstruction(t[0]);return this.pushInstruction({type:n,valueType:r.valueType,endIndex:-1,args:t})}EndFunction(t){let n=54,r=t[0],s=this.getInstruction(r);this.instructions[r]={type:s.type,valueType:s.valueType,args:s.args,endIndex:this.instructionsLength()};let i=s.args[0],o=this.getInstruction(s.args[0]);this.instructions[i]={type:o.type,valueType:o.valueType,endIndex:this.instructionsLength(),symbol:o.symbol,signature:o.signature,parameterSymbols:o.parameterSymbols,recursionGroup:o.recursionGroup};let a=this.pushInstruction({type:n,valueType:Qt,args:t});return this.markClosedBlock(r,a),a}FunctionCall(t){let n=55;return this.pushInstruction({type:n,valueType:Sn(this,n,t),args:t})}ExtendSeed(t,n){let r=44,s=ft;return this.pushInstruction({type:r,valueType:s,args:n,tag:t})}Noop(){let t=0,n=Qt;return this.pushLeafInstruction({type:t,valueType:n})}Action(t,n){return this.pushInstruction({type:49,valueType:ut,args:n,symbols:t})}replaceInstructionWithConstant(t,n){this.instructions[t]=n,this.blockMask[t]=void 0}replaceInstructionWithBlockVarOrFunctionCall(t,n){this.instructions[t]=n}reopenFinalBlock(){let t=this.getInstruction(this.getReturnIndex());if(t.type!==48)return this;let n=t.args[0],s=this.getInstruction(n).args[0];for(let i=s;i<n;i++)this.blockMask[i]=void 0;return this.unsafelyTruncate(n),this}reopenAllBlocks(){this.blockMask=[]}isInClosedBlock(t){return!!this.blockMask[t]}copy(){let t=new e({argNames:this.argNames,argTypes:this.argTypes});return t.instructions=this.instructions.slice(),t.blockMask=this.blockMask.slice(),t.comments=this.comments.slice(),t.derivativeMaps=this.derivativeMaps.clone(),t.warning=this.warning,t.setReturnIndex(this.getReturnIndex()),t}fuseBroadcast(){return this.setReturnIndex(Gr(this,this.getReturnIndex())),this}copyInstruction(t){return po(this,t)}copyInstructionWithArgs(t,n){return _n(this,t,n)}replaceInstructionWithNoop(t){this.instructions[t]={type:0,valueType:Qt}}getReturnType(){return this.instructions[this.getReturnIndex()].valueType}isConstant(){return Je(this.instructions[this.getReturnIndex()])}areAllArgsConstant(t){for(let n of t)if(!Je(this.instructions[n]))return!1;return!0}asValue(){return hn(this,this.getReturnIndex())}asCompilerValue(){let t=this.instructions[this.getReturnIndex()];switch(t.type){case 1:return t.value;default:throw new Error(`Unexpected opcode ${t.type}.`)}}getConstantListLength(){return qn(this,this.getReturnIndex())}getListLengthDependencies(){let t=this.copy(),n=ur(t,t.getReturnIndex());return fs(t,n)}elementAt(t){let n=this.copy(),r=n.getReturnIndex();return n.setReturnIndex(Hf(n,r,t)),n}substituteConstantArguments(t){return zN(this,t)}interpretWithParameters(t){return hN(this,this.getReturnIndex(),t)}getCompiledFunction(t){let n;if(t){n=t.slice();for(let o of this.argNames)n.indexOf(o)===-1&&n.push(o)}else n=this.argNames;let{source:r,constants:s}=jg(this),i={};return{args:n,source:r,constants:s,executionMetadata:i,fn:Lf(n,r,s,i)}}getRestrictedFunctionForGLSL(t,n){let r=tu(this,t,{allowSlices:!0}),{restrictionChunk:s,valueChunk:i}=r.getValueAndRestrictionChunk(),o;if(s!==void 0)try{o=Ma(s,n)}catch(a){s=void 0}return o===void 0&&r.getSliceVariablesOrImplicit().length==0?{concrete:new on(this),restriction:void 0,restrictionExpr:void 0}:{concrete:new on(i),restriction:o,restrictionExpr:s&&new on(s)}}polynomialOrder(t,n){return $O(this,t,n)}getPolynomialCoefficients(t){return YO(this,t)}takeDerivative(t){let n=this.argNames.indexOf(t);return n===-1?this.setReturnIndex(this.ZeroOfType(this.getReturnType())):this.setReturnIndex(zM(this,this.getReturnIndex(),n)),this}gradient(t){let n=[],r=this.getReturnIndex();for(let s of t){let i=this.argNames.indexOf(s);i===-1?n.push(this.Constant(0)):n.push(zM(this,r,i))}return this.List(n),this}deriveRegressionRestrictions(){return CN(this)}boundDomain(t){return XO(this,t,this.getReturnIndex())}findLinearSubset(t){let n=wN(this),r=[];for(let s of t){let i=this.argNames.indexOf(s);if(i===-1)throw new Error(\"Programming Error: findLinearSubset called with a non-dependency\");r.push(n[i])}return r}isLinearIn(t){let n=this.argNames.filter(r=>t.includes(r));return n.length===0?!1:this.findLinearSubset(n).every(Boolean)}isImplicitPlane(){let t=n=>n===\"x\"||n===\"y\"||n===\"z\";return this.isLinearIn([\"x\",\"y\",\"z\"])&&this.argNames.every(t)}print(t,n=this.comments){let r;return t===void 0?(t=this.instructionsLength()-1,r={printUnreferencedInstructions:!0,comments:n}):r={printUnreferencedInstructions:!1,comments:n},oO(this,t,r)}printInstruction(t){return al(this,t)}toDot(){return jA(this)}getLiveArgNames(){let t=Vr(this,this.getReturnIndex()),n=[];for(let r=0;r<this.argNames.length;r++)t[r]&&n.push(this.argNames[r]);return n}getCursorContext(){return this.cursorContext}setCursorContext(t){this.cursorContext=t}coerceToNumericIfPossible(){return zi(this,this.getReturnIndex())}coerceNonComplexToNumberIfPossible(){return fl(this,this.getReturnIndex())}};function xl(e,t){return UM(e,t).freeDependencies}function UM(e,t){let n={};if(t.type===\"FunctionDefinition\"||t.type===\"RecursiveFunctionBaseCase\"){let{freeDependencies:r,updateSymbols:s}=Hh(e,t._expression,n),i=r.filter(o=>o!==t._symbol);if(t instanceof Cr||t instanceof Qr)for(let o of t._argSymbols)i.includes(o)||i.push(o);return{freeDependencies:i,updateSymbols:s}}return Hh(e,t,n)}function JA(e,t,n){let r=[],s=[],i=[];for(let o of t.scopes){let a=JA(e,o,n);for(let u of a.freeDependencies)r.indexOf(u)===-1&&t.definitions.indexOf(u)===-1&&r.push(u);for(let u of a.updateSymbols)s.indexOf(u)===-1&&s.push(u)}for(let o of t.dependencies){if(t.definitions.indexOf(o)!==-1)continue;let a=aU(e,o,n),u=t.substitutionDependencies.indexOf(o)!==-1;for(let c of a.freeDependencies)r.indexOf(c)===-1&&t.definitions.indexOf(c)===-1&&r.push(c),u&&i.indexOf(c)===-1&&t.definitions.indexOf(c)===-1&&i.push(c);for(let c of a.updateSymbols)s.indexOf(c)===-1&&s.push(c)}return{freeDependencies:r,updateSymbols:s}}function Hh(e,t,n){if(t.type===\"Slider\"||t.type===\"Assignment\")return Hh(e,t._expression,n);{let{freeDependencies:r,updateSymbols:s}=JA(e,t.getScope(),n),i=t.getUpdateSymbols();if(i.length>0){s=s.slice();for(let o of i)s.indexOf(o)===-1&&s.push(o)}return{freeDependencies:r,updateSymbols:s}}}function aU(e,t,n){if(n[t])return n[t];let r=uU(e,t,n);return n[t]=r,r}function uU(e,t,n){if(tt[t])return{freeDependencies:[],updateSymbols:[]};let r=e[t];return r?(n[t]={freeDependencies:[],updateSymbols:[]},Hh(e,r,n)):{freeDependencies:[t],updateSymbols:[]}}function QA(e,t){let n={},r=t.getDependencies().slice();for(;r.length;){let s=r.pop();if(n.hasOwnProperty(s))continue;if(e.isLocal(s)||e.isError(s))return;let i=e.getVisibleGlobalDefinition(s);n[s]=i,i&&i.getDependencies&&Array.prototype.push.apply(r,i.getDependencies())}return Object.entries(n)}function KA(e,t,n){e_(e,t,n,{})}function e_(e,t,n,r){let s={};for(let i of n.definitions){if(s[i])switch(n.kind){case\"Sum\":case\"Product\":case\"Integral\":throw z(new Error(`${n.kind} scope is not expected to define multiple symbols`));case\"FunctionDefinition\":throw II(i);case\"ListComprehension\":throw qy(i);case\"Substitution\":throw VP(i);default:let o=n.kind;throw z(new Error(`Unexpected scope kind ${o}`))}s[i]=!0}for(let i of n.definitions){let o=t[i];if(o){if(e.assignmentForbidden(i))switch(n.kind){case\"Sum\":case\"Product\":throw vy(i);case\"Integral\":throw By(i);case\"FunctionDefinition\":throw Sy(i);case\"Substitution\":case\"ListComprehension\":throw of(i);default:let a=n.kind;throw z(new Error(`Unexpected scope kind ${a}`))}if((n.kind===\"ListComprehension\"||n.kind===\"Substitution\")&&o.type===\"FunctionDefinition\")throw af(i)}if(r[i])switch(n.kind){case\"Sum\":case\"Product\":throw vy(i);case\"Integral\":throw By(i);case\"FunctionDefinition\":throw Sy(i);case\"ListComprehension\":throw qy(i);case\"Substitution\":throw wP(i);default:let a=n.kind;throw z(new Error(`Unexpected scope kind ${a}`))}}r=Tn(r);for(let i of n.definitions)r[i]=!0;for(let i of n.scopes)e_(e,t,i,r)}var Sa={normaldist:{pdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"normalpdf\",n.concat(r.args))},cdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"normalcdf\",n.concat(r.args))},mean:function(e,t,n){return e.getInstruction(t).args[0]},median:function(e,t,n){return Sa.normaldist.mean(e,t,n)},stdev:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"abs\",[r.args[1]])},var:function(e,t,n){let r=e.getInstruction(t);return e.Multiply([r.args[1],r.args[1]])},quantile:function(e,t,n){let r=e.getInstruction(t);return e.Add([e.Multiply([e.NativeFunction(\"invNorm\",n),e.NativeFunction(\"abs\",[r.args[1]])]),r.args[0]])},random:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"normalSample\",[n[0],r.args[0],r.args[1]])}},tdist:{pdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"tpdf\",n.concat(r.args))},cdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"tcdf\",n.concat(r.args))},mean:function(e,t,n){return e.Constant(0)},median:function(e,t,n){return e.Constant(0)},stdev:function(e,t,n){return e.NativeFunction(\"sqrt\",[Sa.tdist.var(e,t,n)])},var:function(e,t,n){let r=e.getInstruction(t),s=e.Constant(2),i=r.args[0];return e.Piecewise([e.GreaterEqual([i,s]),e.Divide([i,e.Subtract([i,s])]),e.Constant(NaN)])},quantile:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invT\",[n[0],r.args[0]])},random:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"tSample\",[n[0],r.args[0]])}},poissondist:{pdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"poissonpdf\",n.concat(r.args))},cdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"poissoncdf\",n.concat(r.args))},mean:function(e,t,n){return e.getInstruction(t).args[0]},median:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invPoisson\",[e.Constant(.5),r.args[0]])},stdev:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"sqrt\",[r.args[0]])},var:function(e,t,n){return Sa.poissondist.mean(e,t,n)},quantile:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invPoisson\",[n[0],r.args[0]])},random:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"poissonSample\",[n[0],r.args[0]])}},binomialdist:{pdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"binompdf\",n.concat(r.args))},cdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"binomcdf\",n.concat(r.args))},mean:function(e,t,n){let r=e.getInstruction(t);return e.Multiply([r.args[0],r.args[1]])},median:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invBinom\",[e.Constant(.5),r.args[0],r.args[1]])},stdev:function(e,t,n){return e.NativeFunction(\"sqrt\",[Sa.binomialdist.var(e,t,n)])},var:function(e,t,n){let r=e.getInstruction(t),[s,i]=r.args;return e.Multiply([s,e.Multiply([i,e.Subtract([e.Constant(1),i])])])},quantile:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invBinom\",[n[0],r.args[0],r.args[1]])},random:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"binomSample\",[n[0],r.args[0],r.args[1]])}},uniformdist:{pdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"uniformpdf\",n.concat(r.args))},cdf:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"uniformcdf\",n.concat(r.args))},mean:function(e,t,n){let r=e.getInstruction(t);return e.Divide([e.Add([r.args[0],r.args[1]]),e.Constant(2)])},median:function(e,t,n){return Sa.uniformdist.mean(e,t,n)},stdev:function(e,t,n){return e.NativeFunction(\"sqrt\",[Sa.uniformdist.var(e,t,n)])},var:function(e,t,n){let r=e.getInstruction(t),s=e.Subtract([r.args[1],r.args[0]]);return e.Divide([e.Multiply([s,s]),e.Constant(12)])},quantile:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"invUniform\",[n[0],r.args[0],r.args[1]])},random:function(e,t,n){let r=e.getInstruction(t);return e.NativeFunction(\"uniformSample\",[n[0],r.args[0],r.args[1]])}}};function t_(e,t,n){let r=n[0],s=e.Constant(0),i=e.Constant(1);if(qn(e,t)===0)return e.Constant(NaN);let a=ur(e,t);return e.InboundsListAccess([t,e.Add([e.NativeFunction(\"floor\",[e.Multiply([e.NativeFunction(\"uniformSample\",[r,s,i]),a])]),i])])}function n_(e,t,n){switch(t){case R:return e.NativeFunction(\"complex\",n);case N:case H:return e.TupleOfType(t,n);default:throw z(`Type ${at(t)} is not a supported aggregate type for building.`)}}function om(e){if(!e)return;let{latex:t,latexSelection:n}=e;if(t===void 0||n===void 0)return;let{start:r,end:s}=n;return{input:t,start:r,end:s}}function qM(e,t,n){if(!t)return;let r=$M(t,n._expression);r===\"start-to-end\"?e.setCursorContext({type:n.type===\"Assignment\"?\"assignment-rhs\":\"function-definition-body\",allowedTypes:[Qt]}):r===\"empty-list\"&&e.setCursorContext({type:\"expression-arguments\",expressionType:\"List\",argIndex:0,argCount:0,isLastValidArg:!1,positionWithinArg:\"start-to-end\",allowedTypesForInsertedArg:[Qt]})}function r_(e,t,n){if(t){let r=$M(t,n.args[1]);r===\"start-to-end\"?e.setCursorContext({type:\"for-assignment-rhs\",allowedTypes:[de,ce,ie,fe,Ne,xe,...ii.types]}):r===\"empty-list\"&&e.setCursorContext({type:\"for-assignment-rhs\",allowedTypes:[Qt]})}}function sd(e,t,n,r,s){let i=cU(e,t,n,r,s);i&&e.setCursorContext(i)}function $M(e,t){let n=t.getInputSpan();return n?e.start===n.start&&e.end===n.end?\"start-to-end\":e.start===e.end&&e.start===n.end?\"end\":e.start===e.end&&e.start===n.start?\"start\":e.start===e.end&&t.type===\"List\"&&t.args.length===0?\"empty-list\":\"not-aligned\":\"not-aligned\"}function YM(e,t){if(!e)return;let n=!1;t instanceof Ms&&t.args[1]instanceof gn&&(n=!0,t=t.args[1]);let r=t.args;if(r){if(r.length===0){let s=t.getInputSpan();if(!s)return;let i=Yn(s),o=-1;return t.type===\"List\"?o=i.indexOf(\"[\"):(t.type===\"FunctionCall\"||t.type===\"SeededFunctionCall\")&&(o=i.indexOf(\"(\")),o<0?void 0:e.start===s.start+o+1?{argIndex:0,positionWithinArg:\"start-to-end\",isDotCall:n}:void 0}for(let s=0;s<r.length;s++){let i=r[s],o=i.getInputSpan();if((o==null?void 0:o.input)!==e.input)continue;if(e.start<o.start)break;let a=$M(e,i);if(a!==\"not-aligned\")return{argIndex:s,positionWithinArg:a,isDotCall:n}}}}function cU(e,t,n,r,s){if(!n||!r.args)return;let i=YM(n,r);if(i===void 0)return;i.isDotCall&&(r=r.args[1]);let o=i.positionWithinArg===\"end\"?i.argIndex+1:i.argIndex;i.isDotCall&&(o+=1);let a;i.positionWithinArg===\"empty-list\"||i.positionWithinArg===\"start-to-end\"?a=[...s.slice(0,o),void 0,...s.slice(o+1)]:r instanceof Fr?a=o===1?[s[0],void 0,s[1]]:[s[0],s[1],void 0]:a=[...s.slice(0,o),void 0,...s.slice(o)],a=a.map(p=>{if(!(p===void 0||e.getInstruction(p).type===2))return p});let u=[];for(let p of a)u.push(p===void 0?void 0:e.getInstruction(p).valueType);let c=ch(t,r,u),l=c&&Rd(c,o);if(i.positionWithinArg===\"empty-list\"){let p=l==null?void 0:l.filter(j).map(Ve);return(p==null?void 0:p.length)===0?void 0:{type:\"expression-arguments\",expressionType:\"List\",argIndex:0,argCount:0,isLastValidArg:!1,positionWithinArg:\"start-to-end\",allowedTypesForInsertedArg:p!=null?p:[Qt]}}else{if((l==null?void 0:l.length)===0)return;let p=!1;if(c){let y=0;for(let g of c){let m=g.maxArity!==void 0?g.maxArity-1:1/0;y=Math.max(y,m)}p=i.positionWithinArg===\"end\"&&i.argIndex===y-1||i.positionWithinArg===\"start-to-end\"&&i.argIndex===y}let f=r.args.length;if(r instanceof Fr&&r.args.length===3){let y=r.args[2];y instanceof Et&&y.isNaN()&&(f=2)}let d={type:\"expression-arguments\",expressionType:r.type,argIndex:i.argIndex,argCount:f,isLastValidArg:p,positionWithinArg:i.positionWithinArg,allowedTypesForInsertedArg:l!=null?l:[Qt]};if(r instanceof gn&&(d.functionSymbol=r._symbol,d.isDotCall=i.isDotCall,r instanceof gn&&r._symbol===\"polygon\")){let y=r.args.filter(g=>!(g instanceof we&&g._symbol===\"cursor\"));if(y.length>0){let g=y[0].getInputSpan(),m=y[y.length-1].getInputSpan();d.polygonVertices=g&&m?{firstLatex:Yn(g),lastLatex:Yn(m)}:void 0}}return d}}function am(e,t,n){if(t===n)return!0;if(t<n)return!1;let r=[!0];for(let i=n+1;i<=t;i++)r.push(!1);let s=[t];for(;s.length;){let i=s.pop();if(r[i-n])continue;r[i-n]=!0;let o=e.getInstruction(i);if(!ge(o))for(let a of e.getDirectDependencies(o)){if(a===n)return!0;a<n||r[a-n]||s.push(a)}}return!1}function s_(e,t,n){return zh(e,r=>{var p,f;let{chunk:s}=r,i=[],o=[];for(let d=0;d<n.length;d++){let y=s.getInstruction(n[d]).valueType;j(y)?(i.push(2),o.push(s.SymbolicVar(y,t._argSymbols[d]))):(i.push(0),o.push(n[d]))}if(i.every(d=>d===0))return i;let a=Uh(r,t,o),u=Math.min(...o),c=Vr(s,a),l=[];for(let d=0;d<o.length;d++)l[o[d]]=new Set([d]);for(let d=u;d<=a;d++){if(!c[d])continue;let y=s.getInstruction(d);if(!ge(y)){if(y.type===39||y.type===40||y.type===41){let g=y.args[0],m=y.args[1],h=s.getInstruction(m);if(h.type===23){let b=h.endIndex,x=(p=l[b])!=null?p:new Set;for(let T of l[g]||[])x.add(T);l[b]=x;continue}}if(y.type===48)l[d]=l[y.args[0]];else if(y.type===37&&y.symbol===\"count\"&&y.args.length===1)l[d]=l[y.args[0]];else if(!(y.type===23&&((f=y.context)==null?void 0:f.type)===\"implicit\")){if(!(y.type===44&&y.tag===\"fc\"))for(let g of y.args){let m=l[g]||[];for(let h of m)i[h]=1}}}}return i})}function lU(e,t,n){let r=rd.empty(t);for(let s=0;s<e.argNames.length;s++){let i=e.argNames[s];n.includes(i)?r.addLexicalBinding(i,s):r.setFreeVariable(i,s)}return r}var id=class id{constructor(t,n,r,s,i){if(this.kind=t,this.substitutedGlobals={...n==null?void 0:n.substitutedGlobals},this.functionBodySubstitutions={...n==null?void 0:n.functionBodySubstitutions},t&&r&&i){let o=i.filter(a=>r.isGlobal(a));for(let a of o)this.substitutedGlobals[a]||(this.substitutedGlobals[a]=t);if(s&&o.length>0){let a=this.recursionGroupKey(s.fnSymbols);this.functionBodySubstitutions[a]||(this.functionBodySubstitutions[a]={operator:t,substitutedGlobals:o})}}}recursionGroupKey(t){return[...t].sort().join(\",\")}getFunctionBodySubstitution(t){let n=this.recursionGroupKey(t);return this.functionBodySubstitutions[n]}allowsRegressionParameterDependency(){if(!this.kind)return!0;for(let t in this.substitutedGlobals)return!1;return!0}getRegressionDependencyError(t){if(this.allowsRegressionParameterDependency())return;let[n,r]=Object.entries(this.substitutedGlobals)[0];return FP(n,t,r)}getKind(){return this.kind}getSubstitutedGlobals(){return this.substitutedGlobals}with(t,n,r){return new id(\"with\",this,t,n,r)}for(t,n,r){return new id(\"for\",this,t,n,r)}};id.root=new id;var sm=id,WM=class{constructor(t,n){this.definitions=t;this.baseCases=n;this.type=\"type-inference\";this.argTypes={};this.returnTypes={};this.baseCaseTypes={};this.firstValidBaseCaseIdentifiers={};this.stack=[];this.isUnconditionallyRecursive=!1;this.fnSymbols=Object.keys(t)}registerFunctionCall(t,n){this.argTypes[t]||(this.argTypes[t]=n)}};function HM(e,t,n,r,s,i){return{policy:e,chunk:t,scope:n,substitutionContext:r,recursiveFunctionContext:s,selection:i}}function Ci(e,t){return{...e,scope:t}}function zh(e,t){let{chunk:n,scope:r}=e,s=n.instructionsLength(),i=r.childScopeWithChildGlobalCache(),o=Ci(e,i),a=t(o);return n.unsafelyTruncate(s),a}function jh(e){let{policy:t,frame:n,argNames:r,argTypes:s,selection:i,locals:o}=e,a=new Ia({argNames:r,argTypes:s}),u=lU(a,n,o);return HM(t,a,u,sm.root,void 0,i)}function od(e,t){let{policy:n,frame:r,argNames:s,argTypes:i}=e,o=om(t.userData),a=UM(r,t),{freeDependencies:u,updateSymbols:c}=a;if(s||(s=u),!i){i=[];for(let f=0;f<s.length;f++)i.push(I)}let l;t.type===\"FunctionDefinition\"||t.type===\"RecursiveFunctionBaseCase\"?l=t._argSymbols:l=[];let p=jh({policy:n,frame:r,argNames:s,argTypes:i,selection:o,locals:l});try{KA(n,r,t.getScope()),Fe(p,t),e.coerceToNumber===\"all\"||se(p.chunk.getReturnType(),Gt)?p.chunk.coerceToNumericIfPossible():e.coerceToNumber===\"all-except-complex\"&&p.chunk.coerceNonComplexToNumberIfPossible(),e.wrapInList&&!j(p.chunk.getReturnType())&&p.chunk.List([p.chunk.getReturnIndex()]),p.chunk.fuseBroadcast(),pU(p,t,c)}catch(f){let d=f instanceof v?f:z(f);d.setCursorContext(p.chunk.getCursorContext()),p.chunk.setError(d)}return p.chunk}function pU(e,t,n){let{chunk:r,scope:s}=e;if(t.type===\"FunctionDefinition\"){for(let o of n)if(t._argSymbols.indexOf(o)!==-1||t._symbol===o)throw my(o)}let i=[];for(let o of n)s.isDefined(o)||i.push(o);if(i.length){let o=JM(e,i[0]).setDependencies(r.argNames.concat(i));throw r.isConstant()&&r.getReturnType()===ut&&o.setActionValue(r.asValue()),o}}function Fe(e,t){let n;if(GO(),mU(e,t))FO(),n=e.chunk.copyInstruction(t.__IRCache.instruction);else{VO();let r=e.chunk.instructionsLength();n=yU(e,t),n=dU(e,r,n),fU(e,t,n)}return e.chunk.setReturnIndex(n),n}function dU(e,t,n){let{chunk:r,scope:s}=e;if(n<=t)return n;let i=r.getInstruction(n);return Je(i)?(r.unsafelyTruncate(Math.max(t,s.getMaxIndex()+1)),po(r,i)):n}function fU(e,t,n){let{chunk:r,scope:s}=e,i=r.getInstruction(n);if(!Je(i))return;let o=QA(s,t);o&&(BO(),t.__IRCache={keys:o,instruction:i})}function mU(e,t){let{scope:n,substitutionContext:r}=e;if(!t.__IRCache)return!1;let s=t.__IRCache.keys;for(let[i,o]of s){if(n.isLocal(i)||n.isError(i))return!1;let a=n.getVisibleGlobalDefinition(i);if(a!==o||a&&a.type===\"RegressionParameter\"&&!r.allowsRegressionParameterDependency())return!1}return!0}function yU(e,t){var u,c,l,p;let{policy:n,chunk:r,scope:s,substitutionContext:i,selection:o}=e,a=t.type;switch(a){case\"Constant\":{let d=t._constantValue,y=typeof d==\"boolean\"?De:I;return r.ConstantOfType(y,d)}case\"RegressionParameter\":return r.Constant(t._constantNode._constantValue);case\"MixedNumber\":return r.Constant(t._constantValue);case\"ImaginaryUnit\":return r.ImaginaryUnit();case\"Negative\":return r.Negative(qh(e,t,t.args));case\"Add\":return r.Add(yo(e,t,t.args));case\"Subtract\":return r.Subtract(yo(e,t,t.args));case\"Multiply\":return r.Multiply(yo(e,t,t.args));case\"DotMultiply\":{let[d,y]=yo(e,t,t.args);return(c=(u=a_(e,d,y))!=null?u:eu(r,[d,y])?a_(e,Ss(r,d),Ss(r,y),{forcePermitted:!0}):void 0)!=null?c:r.Multiply([d,y])}case\"CrossMultiply\":{let[d,y]=yo(e,t,t.args);return e.policy.is3dPolicy()?gt(r,d,ke)&&gt(r,y,ke)?$u(r,[u_(e,Ss(r,d),Ss(r,y)),$o(r,d)]):gt(r,d,H)&&gt(r,y,H)?u_(e,d,y):r.Multiply([d,y]):r.Multiply([d,y])}case\"Divide\":return r.Divide(yo(e,t,t.args));case\"Exponent\":{let d=yo(e,t,t.args);if(n.isComplexEnabled()){let y=t.args[1];if(RU(y)){let g=r.getInstruction(d[0]).valueType;if(Ec(g,I)||Ec(g,ne))return r.Exponent(d)}return r.NativeFunction(\"complexPow\",d)}else return r.Exponent(d)}case\"Comparator['=']\":case\"Comparator['>']\":case\"Comparator['<']\":case\"Comparator['>=']\":case\"Comparator['<=']\":return r.Comparator(t.operator,yo(e,t,t.args));case\"ComparatorChain\":{let d=Ju(e,t,t.args),y=r.Comparator(t.symbols[0],[d[0],d[1]]);for(let g=1;g<t.symbols.length;g++)y=r.And([y,r.Comparator(t.symbols[g],[d[g],d[g+1]])]);return y}case\"Or\":return r.Or(yo(e,t,t.args));case\"PercentOf\":return r.Divide([r.Multiply(yo(e,t,t.args)),r.Constant(100)]);case\"ParenSeq\":return IU(e,t);case\"BareSeq\":return PU(e,t);case\"NamedCoordinateAccess\":{let[d]=qh(e,t,t.args),y=t.symbol;switch(y){case\"x\":return r.Slot(0,[d]);case\"y\":return r.Slot(1,[d]);case\"z\":return r.Slot(2,[d]);default:{let g=y;throw new Error(`Programming Error: unexpected named coordinate: '${g}'.`)}}}case\"Norm\":{let d=qh(e,t,t.args)[0];return gt(r,d,R)?Yh(r,d):(p=(l=jM(e,d))!=null?l:eu(r,[d])?jM(e,Ss(r,d)):void 0)!=null?p:r.NativeFunction(\"abs\",[d])}case\"UpdateRule\":{let d=t._symbol;if(s.isLocal(d))throw JM(e,d);let y=s.getVisibleGlobalDefinition(d);if(y!==void 0&&y.type!==\"Assignment\"&&y.type!==\"Slider\")throw JM(e,d);let g=Fe(e,t.args[1]);return r.Action([d],[g])}case\"List\":case\"TableColumnValue\":{if(t.getDependencies().length>0)return ms(t.args),r.List(Ju(e,t,t.args));if(t.args.length===0)return sd(r,n,o,t,[]),r.ConstantOfType($e,[]);{let d=r.instructionsLength(),y=[],g,m;ms(t.args);let h=!0;for(let x of t.args){let T=Fe(e,x),D=r.getInstruction(T);if(g===void 0){if(g=D.valueType,!wn(g))throw vc([oe(g)],{blockExport:h});m=vn(g)}else if(D.valueType!==g){if(fu(g,D.valueType)!==void 0)return r.unsafelyTruncate(d),r.List(Ju(e,t,t.args));throw kd({blockExport:h})}if(D.type!==1)throw new Error(\"Programming error: expected list with no dependencies to constant collapse.\");y.push(D.value),r.unsafelyTruncate(d)}let b=YM(e.selection,t);if(e.selection&&b!==void 0&&m!==void 0&&b.positionWithinArg!==\"empty-list\"){let x=Ve(m);r.setCursorContext({type:\"expression-arguments\",expressionType:\"List\",argIndex:b.argIndex,argCount:t.args.length,isLastValidArg:!1,positionWithinArg:b.positionWithinArg,allowedTypesForInsertedArg:[x]})}return r.ConstantOfType(m,y)}}case\"ListAccess\":{let d=Fe(e,t.args[0]),y=r.getInstruction(d);if(t.args[1].type===\"Range\"&&t.args[1].args[1].length===0){if(!j(y.valueType))throw Vd([oe(y.valueType),oe(I)],{blockExport:Je(y)});let g=ur(r,d),m=QM(e,Fe(e,t.args[1].args[0]),r.List([g]),{stepMustBePositive:!0});return r.ListAccess([d,m])}else{let g=Fe(e,t.args[1]),m=r.getInstruction(g);if(Uo(r,n,t,[d,g]),m.valueType===Xn)return r.NativeFunction(\"select\",[d,g]);if(m.valueType===De&&j(y.valueType)){let h=r.ConstantOfType(y.valueType,[]);return r.Piecewise([g,d,h])}return r.ListAccess([d,g])}}case\"Range\":{let[d,y]=yo(e,t,t.args);return QM(e,d,y,{stepMustBePositive:!1})}case\"ListComprehension\":return MU(e,t);case\"Piecewise\":{let d=Fe(e,t.args[0]),y=r.getInstruction(d),g=y.type===1&&y.value===!1,m=y.type===1&&y.value===!0,h;h=r.getWarning();let b=Fe(e,t.args[1]);g&&r.restoreWarning(h),h=r.getWarning();let x=Fe(e,t.args[2]);m&&r.restoreWarning(h);let T=[d,b,x];sd(e.chunk,e.policy,e.selection,t,T),Uo(e.chunk,e.policy,t,T);let D=r.getInstruction(T[1]),P=r.getInstruction(T[2]),C=_i(D.valueType,P.valueType)||_i(P.valueType,D.valueType);if(y.type===1&&y.valueType===De&&C){let _=T[y.value?1:2],L=r.getInstruction(_),w=D.valueType!==$e?D.valueType:P.valueType;return L.valueType===$e&&w!==$e?r.ConstantOfType(w,[]):_}let S=D.valueType,O=j(S)?Ve(S):S;if(!C&&Je(P)&&P.valueType===I&&Ii(P.value)&&io(O)){if(se(D.valueType,Gt))return r.NativeFunction(\"restriction\",[r.And([T[0],r.NativeFunction(\"restrictionToBoolean\",[T[1]])])]);let _=r.NanOfType(O);T=[T[0],T[1],_]}return r.Piecewise(T)}case\"Restriction\":return r.NativeFunction(\"restriction\",qh(e,t,t.args));case\"Ans\":case\"Identifier\":{let d=t._symbol,y=t._errorSymbol;if(t.type===\"Ans\"&&r.argNames.indexOf(d)!==-1)throw EP();let g=s.getSymbol(d);if(g!==void 0)return g;let m=s.getVisibleGlobalDefinition(d);if(m===void 0)throw tt[d]?tt[d].isFunction?Li(y,e.policy):_c(y):e.recursiveFunctionContext&&e.recursiveFunctionContext.fnSymbols.includes(d)?Iy(d):new Error(`Programming Error: reached undefined symbol ${d}`);if(s.isLocal(d)||m.isFunction)throw Iy(y);if(m.type===\"RegressionParameter\"){let b=i.getRegressionDependencyError(y);if(b)throw b}let h;if(m instanceof Qr)h=Fe(e,m);else{let b=s.newLexicalScope(),x=Ci(e,b);h=Fe(x,m)}return s.cacheGlobal(d,h,m),h}case\"FunctionCall\":case\"SeededFunctionCall\":{ms(t.args);let d=Ju(e,t,t.args);return ms(d),$h(e,t._symbol,t._errorSymbol,d,t.args)}case\"Substitution\":return vU(e,t);case\"FunctionExponent\":{let d=t.args[0]._symbol,y=s.getVisibleGlobalDefinition(d),g=s.getSymbol(d),m=g!==void 0?r.getInstruction(g):void 0;return s.isLocal(d)&&(m==null?void 0:m.type)===4||y!=null&&y.isFunction?Fe(e,new M.Exponent([new M.FunctionCall(d,[t.args[1]]),t.args[2]])):Fe(e,new M.Multiply([t.args[0],new M.Exponent([t.args[1],t.args[2]])]))}case\"FunctionFactorial\":{let d=t.args[0]._symbol,y=s.getVisibleGlobalDefinition(d),g=s.getSymbol(d),m=g!==void 0?r.getInstruction(g):void 0;return s.isLocal(d)&&(m==null?void 0:m.type)===4||y!=null&&y.isFunction?Fe(e,new M.FunctionCall(\"\\\\factorial\",[new M.FunctionCall(d,[t.args[1]])])):Fe(e,new M.Multiply([t.args[0],new M.FunctionCall(\"\\\\factorial\",[t.args[1]])]))}case\"DotAccess\":{let d=t.args[0],y=t.args[1],g=s.getVisibleGlobalDefinition(y._symbol);if(d.type===\"Identifier\"&&d._symbol===\"construction\")return OU(e,y);if((y.type===\"Identifier\"||y.type===\"FunctionCall\")&&(g!=null&&g.isFunction)){let m=y._symbol,h=y._errorSymbol;if(Rf(g))throw Bd(h);let b=y.type===\"Identifier\"?[d]:[d].concat(y.args),x=Ju(e,t,b);return $h(e,m,h,x,b)}else if(y.type===\"SeededFunctionCall\"){let m=y._symbol,h=y._errorSymbol,b=[y.seed,d].concat(y.args.slice(1)),x=Ju(e,t,b);return $h(e,m,h,x,b)}else throw ks(\".\")}case\"Seed\":return r.ConstantOfType(ft,t._stringValue);case\"ExtendSeed\":return r.ExtendSeed(t.tag,yo(e,t,t.args));case\"Integral\":{let d=t._differential._symbol,y=s.childScope();y.setErrorIfAccessed(d,xP(d));let g=Ci(e,y),m=Fe(g,t.args[1]),h=Fe(g,t.args[2]),b=r.getInstruction(m),x=r.getInstruction(h),T=r.SymbolicVar(I,d),D=s.childScope();D.addLexicalBinding(d,T);let P=Fe(Ci(e,D),t.args[3]);if(Uo(r,n,t,[m,h,P]),!am(r,P,T))return r.Multiply([P,r.Subtract([h,m])]);let C=Jp(r,[m,h,P]);if(C!==void 0&&am(r,C,T))throw LP(d);let S=C!==void 0?r.BeginBroadcast([C]):void 0,O=m;S!==void 0&&j(b.valueType)&&(O=Ea(r,m,S));let _=h;S!==void 0&&j(x.valueType)&&(_=Ea(r,h,S));let L=r.getInstruction(P).valueType,w=j(L)?Ve(L):L,U;if($l(w)&&w!==I){let G=[],Z=w===R||w===N?2:3;for(let F=0;F<Z;F++){let Y=r.BeginIntegral({indexSymbol:d},[O,_]),re=su(r,Y,T,P),Ee=r.getInstruction(re);S!==void 0&&j(Ee.valueType)&&(re=Ea(r,re,S)),re=r.Slot(F,[re]);let he=r.EndIntegral([Y,re]);G.push(r.BlockVar(I,[he]))}U=n_(r,w,G)}else{let G=r.BeginIntegral({indexSymbol:d},[O,_]),Z=su(r,G,T,P),F=r.getInstruction(Z);S!==void 0&&j(F.valueType)&&(Z=Ea(r,Z,S));let Y=r.EndIntegral([G,Z]);U=r.BlockVar(I,[Y])}if(S!==void 0){let G=r.EndBroadcast([S,U]);return r.BroadcastResult(vn(w),[G])}else return U}case\"Sum\":case\"Product\":{let d=t._index._symbol,y=t.type===\"Sum\",g=s.childScope();g.setErrorIfAccessed(d,y?cP(d):lP(d));let m=Ci(e,g),h=Fe(m,t.args[1]);h=zi(m.chunk,h);let b=Fe(m,t.args[2]);if(b=zi(m.chunk,b),!gt(r,h,I)){let me=zu(r,[h]),J=r.areAllArgsConstant([h]);throw y?rT(me,{blockExport:J}):oT(me,{blockExport:J})}if(!gt(r,b,I)){let me=zu(r,[b]),J=r.areAllArgsConstant([b]);throw y?sT(me,{blockExport:J}):aT(me,{blockExport:J})}let x=r.NativeFunction(\"round\",[h]),T=r.NativeFunction(\"round\",[b]),D=r.getInstruction(x),P=r.getInstruction(T);if(D.type===1&&D.valueType===I&&!isFinite(V(D.value)))throw y?py():dy();if(P.type===1&&P.valueType===I&&!isFinite(V(P.value)))throw y?py():dy();let C=r.SymbolicVar(I,d),S=s.childScope();S.addLexicalBinding(d,C);let O=Fe(Ci(e,S),t.args[3]),_=r.getInstruction(O).valueType,L=j(_)?Ve(_):_,U=(t.type===\"Sum\"?ql:Jm).find(me=>Ec(L,me));if(U===void 0){let me=zu(r,[O]),J=r.areAllArgsConstant([O]);throw y?iT(me,{blockExport:J}):uT(me,{blockExport:J})}if(!am(r,O,C)){let me=r.Add([r.Subtract([T,x]),r.Constant(1)]);me=r.NativeFunction(\"listMax\",[me,r.Constant(0)]);let J=y?r.Multiply([O,me]):U===R?r.NativeFunction(\"complexPow\",[O,me]):r.RawExponent([O,me]);return r.Piecewise([r.Less([me,r.Constant(1/0)]),J,r.NanOfType(U)])}let G=Jp(r,[x,T,O]);if(G!==void 0&&am(r,G,C))throw y?AP(d):_P(d);let Z=G!==void 0?r.BeginBroadcast([G]):void 0,F=x;Z!==void 0&&j(D.valueType)&&(F=Ea(r,x,Z));let Y=T;Z!=null&&j(P.valueType)&&(Y=Ea(r,T,Z));let re=y?r.ZeroOfType(U):U===R?r.NativeFunction(\"complex\",[r.Constant(1),r.Constant(0)]):r.Constant(1),Ee=r.BeginLoop({type:y?\"sum\":\"product\",indexSymbol:d},[F,Y,re]),he=r.BlockVar(U,[Ee]),K=su(r,Ee,C,O),Oe=r.getInstruction(K);Z!==void 0&&j(Oe.valueType)&&(K=Ea(r,K,Z));let te=y?r.Add([he,K]):r.Multiply([he,K]),Ze=r.EndLoop([Ee,te]),dt=r.BlockVar(U,[Ze]);if(Z!==void 0){let me=r.EndBroadcast([Z,dt]);return r.BroadcastResult(vn(U),[me])}else return dt}case\"Derivative\":{let d=t._symbol,y=Fe(e,new M.Identifier(d)),g=fl(r,y),m=r.getInstruction(g),h=im(m.valueType);if(!h)throw mT(d,zu(r,[g]),{blockExport:Je(m)});let b,x,T=!1;if((m.type===2||m.type===3)&&m.valueType===I)b=e,x=g;else{let S=s.childScope();x=r.SymbolicVar(m.valueType),S.addDynamicBinding(d,x),T=!0,b=Ci(e,S)}let D=1;for(;t.args[0].type===\"Derivative\"&&t.args[0]._symbol===t._symbol;)D+=1,t=t.args[0];let C=Gr(r,Fe(b,t.args[0]));for(let S=0;S<D;S++)C=kh(r,C,x,h);return x===g?C:(T&&r.derivativeMaps.pruneIP(x),su(r,g,x,C))}case\"Prime\":{let d=t.args[0];if(s.isLocal(d._symbol))throw Py(d._symbol);let y=s.getVisibleGlobalDefinition(d._symbol);if(!y)throw Dy(d._symbol);if(!y.isFunction)throw Py(d._symbol);let g=Fe(e,d.args[0]),m=fl(r,g),h=r.getInstruction(m),b=im(h.valueType);if(!b)throw yT(d._symbol,zu(r,[m]),{blockExport:Je(h)});let x=!1,T;(h.type===2||h.type===3)&&h.valueType===I?T=m:(T=r.SymbolicVar(h.valueType),x=!0);let D,P;if(d._symbol===\"logbase\"){if(d.args.length!==2)throw Nc();D=[T,Fe(e,d.args[1])],P=[d.args[0],d.args[1]]}else{if(d.args.length!==1)throw Nc();D=[T],P=[d.args[0]]}let S=Gr(r,$h(e,d._symbol,d._errorSymbol,D,P));for(let O=0;O<t.order;O++)S=kh(r,S,T,b);return T===m?S:(x&&r.derivativeMaps.pruneIP(T),su(r,m,T,S))}case\"Slider\":return e.chunk.Constant(t.getConcreteTree(n,s.frame).asCompilerValue());case\"Assignment\":return qM(r,e.selection,t),Fe(e,t._expression);case\"FunctionDefinition\":{let d=t;if(qM(r,e.selection,d),d.recursionInfo)return P_(e,d,d.recursionInfo);{let y=e.policy.isRecursionEnabled()&&e.policy.assignmentForbidden(d._symbol),g=s.childScope();return g.setErrorIfAccessed(d._symbol,Rc([d._symbol],{suggestAlternativeFunctionName:y})),Fe(Ci(e,g),t._expression)}}case\"RecursiveFunctionBaseCase\":{let d=s.childScope(),y=t;return d.setErrorIfAccessed(y._symbol,CI(y._symbol)),Fe(Ci(e,d),t._expression)}case\"Construction\":throw ks(\"construction\");default:let f=a;throw new Error(`Programming error, unimplemented node type ${f}`)}}function qh(e,t,n){let r=[Fe(e,n[0])];return sd(e.chunk,e.policy,e.selection,t,r),Uo(e.chunk,e.policy,t,r),r}function yo(e,t,n){let r=[Fe(e,n[0]),Fe(e,n[1])];return sd(e.chunk,e.policy,e.selection,t,r),Uo(e.chunk,e.policy,t,r),r}function Yh(e,t){return e.NativeFunction(\"hypot\",[e.Slot(0,[t]),e.Slot(1,[t])])}function m_(e,t){return gt(e,t,I)?t:e.Slot(0,[t])}function y_(e,t){return gt(e,t,I)?e.Constant(0):e.Slot(1,[t])}function g_(e,t){return gt(e,t,I)?t:e.NativeFunction(\"complex\",[e.Slot(0,[t]),e.Negative([e.Slot(1,[t])])])}function Tl(e,t){return h_(e,t,\"mean\")}function h_(e,t,n){return Ui(e,t,n,[{match:_r(Te,0),build:()=>e.NativeFunction(n,t)},{match:_r(R,1),build:()=>e.NativeFunction(\"complex\",[e.NativeFunction(n,t.map(r=>m_(e,r))),e.NativeFunction(n,t.map(r=>y_(e,r)))])},{match:_r(N,1),build:()=>{let r=s=>e.NativeFunction(n,t.map(i=>e.Slot(s,[i])));return e.TupleOfType(N,[r(0),r(1)])}},{match:_r(H,1),build:()=>{let r=s=>e.NativeFunction(n,t.map(i=>e.Slot(s,[i])));return e.TupleOfType(H,[r(0),r(1),r(2)])}}])}function um(e,t){return Ui(e,t,\"varp\",[{match:_r(Te,0),build:()=>e.NativeFunction(\"varp\",t)},{match:_r(R,1),build:()=>{let n=Tl(e,t);return Tl(e,t.map(r=>gU(e,e.Subtract([r,n]))))}}])}function i_(e,t){return Xh(e,t)?cm(e,t,\"var\"):Ui(e,t,\"var\",[{match:_r(Te,1),build:()=>e.NativeFunction(\"var\",t)},{match:_r(R,1),build:()=>{let n=e.NativeFunction(\"count\",t);return e.Divide([e.Multiply([um(e,t),n]),e.Subtract([n,e.Constant(1)])])}}])}function o_(e,t,n){let r=e.BeginBroadcast([n]),s=e.InboundsListAccess([t,r]),i=e.EndBroadcast([r,s]);return e.BroadcastResult(vn(e.getInstruction(s).valueType),[i])}function XM(e,t){return Ui(e,t,\"covp\",[{match:[ro,ro],noBroadcast:!0,build:()=>e.NativeFunction(\"covp\",t)},{match:[Ue,Ue],noBroadcast:!0,build:()=>{let n=e.NativeFunction(\"listMin\",[ur(e,t[0]),ur(e,t[1])]),r=o_(e,t[0],n),s=o_(e,t[1],n),i=Tl(e,[r]),o=Tl(e,[s]);return Tl(e,[e.Multiply([e.Subtract([r,i]),g_(e,e.Subtract([s,o]))])])}}])}function gU(e,t){return e.Add([e.Multiply([e.Slot(0,[t]),e.Slot(0,[t])]),e.Multiply([e.Slot(1,[t]),e.Slot(1,[t])])])}function jM(e,t){let n=e.chunk;return gt(n,t,H)?n.NativeFunction(\"hypot\",[n.Slot(0,[t]),n.NativeFunction(\"hypot\",[n.Slot(1,[t]),n.Slot(2,[t])])]):gt(n,t,N)?n.NativeFunction(\"hypot\",[n.Slot(0,[t]),n.Slot(1,[t])]):void 0}function a_(e,t,n,{forcePermitted:r}={forcePermitted:!1}){let s=e.chunk;return(r||e.policy.is3dProduct())&&gt(s,t,N)&&gt(s,n,N)?s.Add([s.Multiply([s.Slot(0,[t]),s.Slot(0,[n])]),s.Multiply([s.Slot(1,[t]),s.Slot(1,[n])])]):(r||e.policy.is3dProduct())&&gt(s,t,H)&&gt(s,n,H)?s.Add([s.Add([s.Multiply([s.Slot(0,[t]),s.Slot(0,[n])]),s.Multiply([s.Slot(1,[t]),s.Slot(1,[n])])]),s.Multiply([s.Slot(2,[t]),s.Slot(2,[n])])]):void 0}function u_(e,t,n){let r=e.chunk,s=r.Slot(0,[t]),i=r.Slot(1,[t]),o=r.Slot(2,[t]),a=r.Slot(0,[n]),u=r.Slot(1,[n]),c=r.Slot(2,[n]);return r.TupleOfType(H,[r.Subtract([r.Multiply([i,c]),r.Multiply([o,u])]),r.Subtract([r.Multiply([o,a]),r.Multiply([s,c])]),r.Subtract([r.Multiply([s,u]),r.Multiply([i,a])])])}function Ju(e,t,n){let r=[];for(let s of n)r.push(Fe(e,s));return sd(e.chunk,e.policy,e.selection,t,r),Uo(e.chunk,e.policy,t,r),r}function $h(e,t,n,r,s){var f;let{chunk:i,scope:o,recursiveFunctionContext:a,substitutionContext:u,policy:c}=e;if(t=_g(c,t),a&&a.type===\"type-inference\"&&a.definitions[t]){let d=u.getFunctionBodySubstitution(a.fnSymbols);if(d&&d.substitutedGlobals.length>0)throw BP(d.operator,d.substitutedGlobals[0],t);a.registerFunctionCall(t,r.map(m=>i.getInstruction(m).valueType));let y=a.definitions[t];if(y instanceof v)throw y;let g=M_(e,a,y,r);return i.SymbolicVar(g.returnType)}let l=o.getSymbol(t);if(l!==void 0){let d=i.getInstruction(l);if(d.type===4){if(d.signature.argTypes.length!==r.length)throw Ao(t,d.signature.argTypes.length,r.length,{includeUsageExample:!0});for(let y=0;y<r.length;y++){let g=i.getInstruction(r[y]).valueType,m=d.signature.argTypes[y];if(!se(g,m))throw Lx(y,at(m),at(g),{blockExport:Je(i.getInstruction(r[y]))})}return i.FunctionCall([l,...r])}else if(se(d.valueType,Re))return Wh(e.chunk,[l,...r],n,!0);if(r.length>=1)return f_(e,t,s,r);throw d.type===2?Dy(n):d.valueType===Lt?Vy(n):Fy(n)}let p=o.getVisibleGlobalDefinition(t);if(p===void 0||!p.isFunction){if((f=tt[t])!=null&&f.isFunction)throw t===\"logbase\"&&o.isGlobal(\"ln\")&&o.isGlobal(\"log\")?MP():Li(n,e.policy);if(p){let d=Fe(e,p);if(i.getInstruction(d).valueType===Lt)throw Vy(n);if(se(i.getInstruction(d).valueType,Re))return Wh(e.chunk,[d,...r],n,!0)}if(r.length>=1)return f_(e,t,s,r);throw p?Fy(n):new Error(`Programming Error: reached undefined symbol ${t}`)}if(Rf(p)){if(r.length!==p._argSymbols.length)throw Ao(n,p._argSymbols.length,r.length,{includeUsageExample:!0});if(p.getDependencies().includes(\"globalRandomSeed\")&&c.shouldIncludeFunctionParametersInRandomSeed()){let d=s_(e,p,r),y=r.filter((g,m)=>d[m]===2);if(y.length>0){let g=Jp(i,y);if(g===void 0)throw z(\"Programming error: expected list length to be defined\");let m=i.BeginBroadcast([g]),h=[];for(let D=0;D<r.length;D++)d[D]===2?h.push(Ea(i,r[D],m)):h.push(r[D]);let b=Uh(e,p,h,s),x=i.EndBroadcast([m,b]),T=i.getInstruction(b).valueType;if(wn(T))return i.BroadcastResult(vn(T),[x])}}return Uh(e,p,r,s)}else{if(Fo.hasOwnProperty(t))return xU(e,t,n,r,s);if(Bn.hasOwnProperty(t))return pi(e,t,r);throw Li(n,e.policy)}}function Uh(e,t,n,r){let{scope:s}=e,i=s.newLexicalScope().childScope();for(let a=0;a<t._argSymbols.length;a++)i.addLexicalBinding(t._argSymbols[a],n[a],r&&r[a]);let o=Ci(e,i);return t.recursionInfo?P_(o,t,t.recursionInfo):Fe(o,t._expression)}function hU(e,t){let n=$o(e,t),r=e.Add([n,Ss(e,t)]);return e.NativeFunction(\"segment\",[n,r])}function pi(e,t,n){let{chunk:r}=e,s=Bn[t],i=n.length,{minArity:o,maxArity:a}=s;if(i>a||i<o)throw z(\"Unexpected arity mismatch\");let u=b_(r,n,s);switch(s.tag){case\"default\":case\"reducer\":case\"doubleReducer\":case\"parameterizedReducer\":case\"color\":case\"never-broadcast\":return r.NativeFunction(t,u);case\"trig\":{let c=Fe(e,new M.Identifier(\"trigAngleMultiplier\")),l=r.Multiply([u[0],c]);return r.NativeFunction(t,[l])}case\"trig2\":{let c=Fe(e,new M.Identifier(\"trigAngleMultiplier\")),l=r.Multiply([u[1],c]);return r.NativeFunction(t,[u[0],l])}case\"inverseTrig\":{let c=Fe(e,new M.Identifier(\"trigAngleMultiplier\")),l=r.NativeFunction(t,u);return r.Divide([l,c])}default:{let c=s.tag;throw new Error(`Programming Error: unexpected tag ${c}`)}}}function b_(e,t,{minArity:n,defaultArguments:r}){if(!r||!(t.length-n<r.length))return t;let s=t.slice();for(;s.length-n<r.length;)s.push(e.copyInstruction(r[s.length-n]));return s}function bU(e,t,n){let r=[n.noBroadcast?kt(n.match):Ae(n.match)];return lh(r,t.map(s=>e.getInstruction(s).valueType),0).length>0}function Ui(e,t,n,r){let s=r.find(i=>bU(e,t,i));if(!s){if(typeof n==\"string\")throw Hs(n,Pa(e,t),{blockExport:e.areAllArgsConstant(t)});return n(e,t)}return s.build(e,t)}function c_(e,t){if(t.length!==2)throw z(\"Can only take the midpoint of two points\");let n=e.Constant(Se(1,2));return e.Multiply([n,e.Add(t)])}function xU(e,t,n,r,s){var y,g;let{chunk:i,policy:o}=e,a=Fo[t],{minArity:u,maxArity:c}=a,l=r.length;if(l<u||l>c)throw Gf(t)?L0(i,{symbol:t,errorSymbol:n,argsWithoutSeed:r,signatures:a.getSignatures(o),minArity:u,providedArgs:r,builtInTag:void 0,defaultArgumentCount:(g=(y=a.defaultArguments)==null?void 0:y.length)!=null?g:0,isDotCall:!1,maxArity:c}):new Error(\"Programming Error: unexpected arity mismatch\");let p;if(t===\"cdf\")l===2?p=[r[0],i.Constant(-1/0),r[1]]:p=r;else if(t===\"random\")if(l===1||l<4&&!j(i.getInstruction(r[1]).valueType)&&i.getInstruction(r[1]).valueType!==Lt){let m=i.Distribution(\"uniformdist\",[i.Constant(0),i.Constant(1)]);p=[r[0],m].concat(r.slice(1))}else p=r;else p=b_(i,r,a);let f=Nf(o,t);if(t===\"join\"){let m=[];for(let b of p)m.push(i.getInstruction(b).valueType);let h=qO(m);f=[kt({type:\"variadic\",initial:[h,h],rest:h})]}if(f){let m=F0(i,p,f);m.didCoerce&&(p=m.args)}function d(m,h=n){return Ui(i,p,h,m)}switch(t){case\"length\":if(o.isGeometryEnabled()||o.is3dPolicy()){let m=p[0];return d([{match:[wt],build:()=>{let h=i.Constant(0),b=i.Constant(1);return i.NativeFunction(\"distanceThreeD\",[i.NativeFunction(\"segmentThreeDGlider\",[m,h]),i.NativeFunction(\"segmentThreeDGlider\",[m,b])])}},{match:[de],build:()=>{let h=i.Constant(0),b=i.Constant(1);return i.NativeFunction(\"distance\",[i.NativeFunction(\"segmentGlider\",[m,h]),i.NativeFunction(\"segmentGlider\",[m,b])])}},{match:[ie],build:()=>{let h=i.NativeFunction(\"abs\",[i.NativeFunction(\"arcOmega\",[p[0]])]),{radius:b,startPoint:x}=CU(i,p[0]),T=i.NativeFunction(\"arcThirdPoint\",[p[0]]);return i.Piecewise([i.Equal([h,i.Constant(0)]),i.NativeFunction(\"distance\",[x,T]),i.Multiply([b,h])])}},{match:[xx],build:()=>jM(e,Ss(i,m))}])}else return i.NativeFunction(\"count\",p);case\"round\":return d([{match:[Te],build:()=>i.NativeFunction(\"round\",p)},{match:[Te,I],build:()=>{let m=i.NativeFunction(\"round\",[p[1]]),h=i.RawExponent([i.Constant(10),m]);return i.Divide([i.NativeFunction(\"round\",[i.Multiply([p[0],h])]),h])}},{match:[R],build:()=>i.NativeFunction(\"complexRound\",p)},{match:[R,I],build:()=>{let m=i.NativeFunction(\"round\",[p[1]]),h=i.RawExponent([i.Constant(10),m]);return i.Divide([i.NativeFunction(\"complexRound\",[i.Multiply([p[0],h])]),h])}}]);case\"abs\":return d([{match:[Te],build:()=>i.NativeFunction(t,p)},{match:[R],build:()=>Yh(i,p[0])}]);case\"real\":return m_(i,p[0]);case\"imag\":return y_(i,p[0]);case\"conj\":return g_(i,p[0]);case\"exp\":case\"sin\":case\"cos\":case\"tan\":case\"sinh\":case\"cosh\":case\"tanh\":case\"sec\":case\"csc\":case\"cot\":case\"sech\":case\"csch\":case\"coth\":case\"arccot\":case\"arcsinh\":case\"arccsch\":case\"floor\":case\"ceil\":return d([{match:[Te],build:()=>pi(e,t,p)},{match:[R],build:()=>pi(e,Ip[t],p)}]);case\"arctan\":return d([{match:[Te],build:()=>pi(e,t,p.concat(i.Constant(1)))},{match:[I,I],build:()=>pi(e,t,p)},{match:[R],build:()=>pi(e,Ip[t],p)}]);case\"mod\":return d([{match:[Te,Te],build:()=>pi(e,t,p)},{match:[R,R],build:()=>pi(e,Ip[t],p)}]);case\"nthroot\":return i.Exponent([p[0],i.Divide([i.Constant(1),p[1]])]);case\"complexNthRoot\":return i.NativeFunction(\"complexPow\",[p[0],i.Divide([i.Constant(1),p[1]])]);case\"sign\":return d([{match:[Te],build:()=>pi(e,t,p)},{match:[R],build:()=>{let m=p[0];return i.Piecewise([i.Equal([m,i.ZeroOfType(R)]),m,i.Divide([m,Yh(i,m)])])}}]);case\"midpoint\":return d([{match:[de],build:()=>{let m=i.Constant(Se(1,2));return i.NativeFunction(\"segmentGlider\",[p[0],m])}},{match:[wt],build:()=>{let m=i.Constant(Se(1,2));return i.NativeFunction(\"segmentThreeDGlider\",[p[0],m])}},{match:[N,N],build:c_},{match:[H,H],build:c_}]);case\"circle\":return d([{match:[N,de],build:()=>{let m=i.Constant(0),h=i.Constant(1);return i.NativeFunction(\"circle\",[p[0],i.NativeFunction(\"distance\",[i.NativeFunction(\"segmentGlider\",[p[1],m]),i.NativeFunction(\"segmentGlider\",[p[1],h])])])}},{match:[N,N],build:()=>i.NativeFunction(\"circle\",[p[0],i.NativeFunction(\"distance\",p)])},{match:[N,I],build:()=>i.NativeFunction(\"circle\",p)}]);case\"segment\":return d(Yf(\"segment\",\"segmentThreeD\"));case\"vector\":return d(Yf(\"vector\",\"vectorThreeD\"));case\"sphere\":return d([{match:[H,I],build:(m,h)=>m.NativeFunction(\"sphere\",h)},{match:[N,I],build:(m,h)=>m.NativeFunction(\"sphere\",[m.TupleOfType(H,[m.Slot(0,[h[0]]),m.Slot(1,[h[0]]),m.Constant(0)]),h[1]])}]);case\"distance\":return d(Yf(\"distance\",\"distanceThreeD\"));case\"center\":return d([{match:[ce],build:()=>i.NativeFunction(\"center\",[p[0]])},{match:[ie],build:()=>i.NativeFunction(\"arcCenter\",[p[0]])}]);case\"radius\":return d([{match:[ce],build:()=>i.NativeFunction(\"radius\",[p[0]])},{match:[ie],build:()=>i.NativeFunction(\"distance\",[i.NativeFunction(\"arcFirstPoint\",[p[0]]),i.NativeFunction(\"arcCenter\",[p[0]])])}]);case\"glider\":return x_(e.chunk,p);case\"intersection\":case\"strictintersection\":{let m=0;t===\"strictintersection\"&&((gt(i,p[0],de)||gt(i,p[0],ie))&&(m+=3),(gt(i,p[1],de)||gt(i,p[1],ie))&&(m+=12),gt(i,p[0],Ne)&&(m+=1),gt(i,p[1],Ne)&&(m+=4));let h=SU(e,s,p),b=h&&Ta(h);if(!h||!b)return ZM(i,p,m);let x=Fe(e,new M.Identifier(b)),T=zo(h);return T!==void 0&&(x=i.ListAccess([x,i.Constant(T)])),i.NativeFunction(\"chooseNonIncidentPoint\",[x,ZM(i,[p[0],p[1]],m),ZM(i,[p[1],p[0]],m<<2&12|m>>2&3)])}case\"parallel\":case\"perpendicular\":return d([{match:[Qm,N],build:()=>{let h=[Zh(i,p[0]),p[1]];return i.NativeFunction(t,h)}}]);case\"anglebisector\":return d([{match:[Le],build:()=>i.NativeFunction(\"anglebisector\",p)},{match:[ye],build:()=>i.NativeFunction(\"directedanglebisector\",p)}]);case\"start\":return $o(i,p[0]);case\"end\":return i.Add([$o(i,p[0]),Ss(i,p[0])]);case\"translate\":case\"reflect\":case\"rotate\":case\"dilate\":return DU(e,t,p);case\"apply\":return Wh(i,p,n,!1);case\"normaldist\":case\"tdist\":case\"poissondist\":case\"binomialdist\":case\"uniformdist\":return i.Distribution(t,p);case\"median\":case\"quantile\":return Xh(i,r)?cm(i,p,t):pi(e,t,r);case\"stdev\":return Xh(i,r)?cm(i,p,t):d([{match:_r(Te,1),build:()=>pi(e,t,r)},{match:_r(R,1),build:()=>i.NativeFunction(\"sqrt\",[i_(i,p)])}]);case\"stdevp\":return d([{match:_r(Te,1),build:()=>pi(e,t,r)},{match:_r(R,1),build:()=>i.NativeFunction(\"sqrt\",[um(i,p)])}]);case\"var\":return i_(i,p);case\"cov\":return d([{match:[ro,ro],noBroadcast:!0,build:()=>pi(e,t,r)},{match:[Ue,Ue],noBroadcast:!0,build:()=>{let m=i.NativeFunction(\"listMin\",[ur(i,p[0]),ur(i,p[1])]);return i.Divide([i.Multiply([XM(i,p),m]),i.Subtract([m,i.Constant(1)])])}}]);case\"corr\":return d([{match:[ro,ro],noBroadcast:!0,build:()=>pi(e,t,r)},{match:[Ue,Ue],noBroadcast:!0,build:()=>i.Divide([XM(i,p),i.NativeFunction(\"sqrt\",[i.Multiply([um(i,[p[0]]),um(i,[p[1]])])])])}]);case\"mad\":return d([{match:_r(Te,1),build:()=>pi(e,t,r)},{match:_r(R,1),build:()=>{let m=Tl(i,p);return Tl(i,p.map(h=>Yh(i,i.Subtract([h,m]))))}}]);case\"pdf\":case\"cdf\":return cm(i,p,t);case\"varp\":return um(i,p);case\"covp\":return XM(i,p);case\"total\":case\"mean\":return t===\"mean\"&&Xh(i,r)?cm(i,p,t):h_(i,p,t);case\"lcm\":case\"gcd\":return d([{match:_r(Te,1),build:()=>i.NativeFunction(t,p)},{match:_r(R,1),build:()=>{let m;switch(t){case\"lcm\":m=\"complexLCM\";break;case\"gcd\":m=\"complexGCD\";break}return i.NativeFunction(m,p)}}]);case\"min\":return d([{match:[I,I],build:()=>i.NativeFunction(\"min\",p)},{match:_r(I,0),build:()=>i.NativeFunction(\"listMin\",p)}]);case\"max\":return d([{match:[I,I],build:()=>i.NativeFunction(\"max\",p)},{match:_r(I,0),build:()=>i.NativeFunction(\"listMax\",p)}]);case\"random\":{let m=p[0],h=p[1],b=i.getInstruction(p[0]),x=i.getInstruction(h);if(b.valueType!==ft)throw z(`Unexpected value type for seed arg: ${b.valueType}`);if(x.valueType===Zn)throw YT();let T;if(j(x.valueType))T=t_;else{if(x.type!==42||x.valueType!==Lt)throw z('Expected distribution argument to \"random\"');T=Sa[x.symbol][t]}if(p.length>2){let D=p[2],P=i.getInstruction(D);if(P.valueType!==I)throw z(`Expected numSamples argument to random() to be a number but got ${P.valueType}`);if(p.length===4){if(i.getInstruction(p[3]).valueType!==I)throw z(`Expected userSeed argument to random() to be a number but got ${P.valueType}`);m=i.ExtendSeed(\"us\",[m,p[3]])}let C=i.Constant(1),S=i.NativeFunction(\"round\",[i.NativeFunction(\"validateSampleCount\",[D])]),O=i.BeginBroadcast([S]);m=i.ExtendSeed(\"lc\",[m,i.Subtract([O,C])]);let _=T(i,h,[m]),L=i.EndBroadcast([O,_]);return i.BroadcastResult(vn(i.getInstruction(_).valueType),[L])}return T(i,h,[m])}case\"shuffle\":{let m=p[0],h=p[1],b=p[2];if(!j(i.getInstruction(h).valueType)||b!==void 0&&i.getInstruction(b).valueType!==I)throw z(`Unexpected args for \"${t}\"`);return b!==void 0&&(m=i.ExtendSeed(\"us\",[m,b])),i.NativeFunction(\"shuffle\",[m,h])}case\"sort\":return d([{match:[ne],noBroadcast:!0,build:()=>l_(e,p[0],p[0])},{match:[ii,ne],noBroadcast:!0,build:()=>l_(e,p[0],p[1])}]);case\"join\":{let m=[],h=!0;for(let w of p){let U=i.getInstruction(w);Je(U)||(h=!1);let G=U.valueType;if(G!==$e)if(j(G))m.push({isList:!0,index:w,elementType:Ve(G)});else if(wn(G))m.push({isList:!1,index:w,elementType:G});else throw Hs(n,Pa(i,r),{blockExport:i.areAllArgsConstant(p)})}if(m.length===0)return i.ConstantOfType($e,[]);for(let w of m)if(w.elementType!==m[0].elementType)throw Hs(n,Pa(i,r),{blockExport:i.areAllArgsConstant(p)});if(h){let w=[];for(let U of m){let G=i.getInstruction(Gr(i,U.index));gO(G),U.isList?w.push(...G.value):w.push(G.value)}return i.ConstantOfType(vn(m[0].elementType),w)}let b=i.Constant(0),x=i.Constant(1),T={};for(let w of m)w.isList&&T[w.index]===void 0&&(T[w.index]=ur(i,w.index));let D=i.NativeFunction(\"total\",m.map(w=>w.isList?T[w.index]:x)),P=i.BeginBroadcast([D]),C=b,S=[],O=[];for(let w of m){let U=w.isList?i.ListAccess([w.index,i.Subtract([P,C])]):w.index;if(O.push(U),w!==m[m.length-1]){let G=w.isList?T[w.index]:x;C=i.Add([C,G]),S.push(i.LessEqual([P,C]))}}let _=O[O.length-1];for(let w=O.length-2;w>=0;w--)_=i.Piecewise([S[w],O[w],_]);let L=i.EndBroadcast([P,_]);return i.BroadcastResult(vn(m[0].elementType),[L])}case\"unique\":{let m=p[0],h=i.getInstruction(m);if(!j(h.valueType)||h.valueType===Zn)throw z(`Unexpected types for ${t}`);return i.NativeFunction(\"elementsAt\",[m,i.NativeFunction(\"uniquePerm\",[m])])}case\"polygon\":return d([{match:[],build:()=>{let m=i.ConstantOfType(Pt,[]);return i.NativeFunction(\"polygon\",[m])}},{match:[I,I],noBroadcast:!0,build:()=>{throw zd()}},{match:[I,I],build:()=>{let m=i.TupleOfType(N,p);return i.NativeFunction(\"polygon\",[m])}},{match:{type:\"variadic\",initial:[],rest:N},build:()=>i.NativeFunction(\"polygon\",p)}]);case\"directedangle\":return p_(e,p,n);case\"angle\":return i.NativeFunction(\"undirectedAngleMarker\",[p_(e,p,n)]);case\"angles\":return i.NativeFunction(\"polygonInteriorUndirectedAngles\",[p[0],Fe(e,new M.Identifier(\"trigAngleMultiplier\"))]);case\"directedangles\":return i.NativeFunction(\"polygonInteriorDirectedAngles\",[p[0],Fe(e,new M.Identifier(\"trigAngleMultiplier\"))]);case\"coterminal\":{if(gt(i,p[0],ye))return i.NativeFunction(\"directedCoterminalAngle\",p);if(gt(i,p[0],Le))return i.NativeFunction(\"undirectedCoterminalAngle\",p);throw z(`Unexpected types for ${t}`)}case\"histogram\":case\"dotplot\":case\"boxplot\":case\"ttest\":case\"ittest\":case\"stats\":case\"det\":case\"inv\":case\"transpose\":case\"rref\":case\"trace\":case\"points\":case\"lines\":case\"circles\":case\"polygons\":case\"rays\":case\"arcs\":case\"vectors\":throw ks(n);default:{let m=t;throw new Error(`Programming Error: unexpected compiler function ${m}`)}}}function x_(e,t){return Ui(e,t,\"glider\",[{match:[de,I],build:()=>e.NativeFunction(\"segmentGlider\",t)},{match:[fe,I],build:()=>e.NativeFunction(\"lineGlider\",t)},{match:[Ne,I],build:()=>e.NativeFunction(\"rayGlider\",t)},{match:[ce,I],build:()=>e.NativeFunction(\"circleGlider\",t)},{match:[ie,I],build:()=>e.NativeFunction(\"arcGlider\",t)},{match:[xe,I],build:()=>e.NativeFunction(\"polygonGlider\",t)}])}function l_(e,t,n){let{chunk:r}=e;if(qn(r,n)===0)return n;let i=r.NativeFunction(\"listMin\",[ur(r,t),ur(r,n)]);return n=r.ListAccess([n,QM(e,r.List([r.Constant(1)]),r.List([i]),{stepMustBePositive:!0})]),r.NativeFunction(\"elementsAt\",[t,TU(e,[n])])}function TU(e,t){let{chunk:n}=e,r=\"sortPerm\";return Ui(n,t,\"sort\",[{match:[ro],build:()=>n.NativeFunction(r,t),noBroadcast:!0},{match:[Ue],build:()=>n.NativeFunction(Ip[r],t),noBroadcast:!0}])}function cm(e,t,n){let r=t[0],s=e.getInstruction(r);if(!se(s.valueType,Lt))throw z(`Unexpected args for \"${n}\"`);let i=t.slice(1);for(let o of i)if(!se(e.getInstruction(o).valueType,I))throw z(`Unexpected args for \"${n}\"`);if(j(s.valueType)){let o=[],a=1/0;for(let c of t){let l=Gr(e,c);o.push(l);let p=e.getInstruction(l);if(j(p.valueType)){let f=qn(e,l);if(f===void 0)throw rf(fs(e,l));a=Math.min(a,f)}}let u=[];for(let c=0;c<a;c++){let l=Hf(e,o[0],c),p=e.getInstruction(l);if(p.type!==42)throw z(`Unexpected opcode for distribution arg: ${p.type}`);let f=[];for(let d of o.slice(1))j(e.getInstruction(d).valueType)?f.push(Hf(e,d,c)):f.push(d);u.push(Sa[p.symbol][n](e,l,f))}return e.List(u)}else{if(s.type!==42)throw z(`Unexpected opcode for distribution arg: ${s.type}`);return Sa[s.symbol][n](e,r,i)}}function Xh(e,t){return t.length!==0&&e.getInstruction(t[0]).valueType!==$e&&se(e.getInstruction(t[0]).valueType,Lt)}function IU(e,t){ms(t.args);let n=Ju(e,t,t.args);return T_(e,n)}function T_(e,t){let{chunk:n}=e,r=!1,s=!1;for(let i=0;i<t.length;i++){let a=n.getInstruction(t[i]).valueType;r=r||a===ut,s=s||a!==ut}if(r&&s)throw z(\"Unexpected mix of actions and non-actions\");if(r)return I_(e,t);if(t.length===2)return n.TupleOfType(N,t);if(t.length==3)return n.TupleOfType(H,t);throw z(`Unexpected tuple dimensions: ${t.length}`)}function PU(e,t){let{chunk:n}=e;ms(t.args);let r=Ju(e,t,t.args);if(r.length<1)throw z(\"Empty bare sequence\");let s=n.getInstruction(r[0]).valueType;if(s===I)throw z(\"Ambiguous bare sequence\");return s===ut?I_(e,r):n.List(r)}function I_(e,t){let{chunk:n}=e,r=[],s=[];for(let i of t){let o=n.getInstruction(i);switch(o.type){case 49:{Array.prototype.push.apply(r,o.symbols),Array.prototype.push.apply(s,o.args);break}case 1:{let u=o.value.updateRules;for(let c of We(u)){let l=u[c];r.push(c),s.push(n.ConstantOfType(l.valueType,l.value))}break}default:{let a=fs(n,i);throw a.length>0?OT(a):z(`Unexpected opcode for action: ${o.type}`)}}}return n.Action(r,s)}function JM(e,t){let{scope:n,policy:r}=e;if(n.isLocal(t))return my(t);let s=n.getVisibleGlobalDefinition(t);return r.assignmentForbidden(t)?ST(t):s&&s.type===\"FunctionDefinition\"?vT(t):DT(t).allowExport()}function EU(e,t){switch(e.getInstruction(t).valueType){case de:case ce:case ie:return[e.Constant(0),e.Constant(1)];case fe:return[e.Constant(-1/0),e.Constant(1/0)];case Ne:return[e.Constant(0),e.Constant(1/0)];case xe:return[e.Constant(0),e.NativeFunction(\"count\",[e.NativeFunction(\"vertices\",[t])])];default:return}}function MU(e,t){let{policy:n,chunk:r,scope:s,selection:i}=e;if(!(t instanceof Ja))throw new Error(\"Programming error: expected a ListComprehension node but got \"+t.type);let o=t._body,a=[],u=[],c=r.Constant(1),l=s.childScope();ms(t._inputLists);for(let{_symbol:b}of t._inputLists){let x=b;l.setErrorIfAccessed(x,OP(x))}for(let b of t.parameters){let x=b.identifier._symbol;l.setErrorIfAccessed(x,NP(x))}let p=Ci(e,l);for(let b=t._inputLists.length-1;b>=0;b--){let x=t._inputLists[b],T=x._symbol,D=Fe(p,x.args[1]);r_(r,i,x);let P=r.getInstruction(D);if(!j(P.valueType)){let S=EU(r,D);if(S){a.push({symbol:T,object:D,gliderBounds:S});continue}let O;if(wn(P.valueType)){let _=x.args[1].getInputSpan();_&&(O=Yn(_))}throw SP(T,oe(P.valueType),O,{blockExport:Je(P)})}let C=ur(r,D);u.push({symbol:T,assignedList:D,lengthIndex:C}),c=r.Multiply([c,C])}let f=s.childScope(),d=[],y;if(u.length>0){let b=r.Constant(1);y=r.BeginBroadcast([c],{type:\"list-comprehension\",callData:{inputListSymbols:u.map(T=>T.symbol)}}),f.addLexicalBinding(t._index._symbol,y);let x=b;for(let T=u.length-1;T>=0;T--){let{symbol:D,assignedList:P,lengthIndex:C}=u[T],S;if(u.length===1)S=y;else{let O=r.NativeFunction(\"floor\",[r.Divide([r.Subtract([y,b]),x])]);S=r.Add([r.NativeFunction(\"mod\",[O,C]),b]),T>0&&(x=r.Multiply([x,C]))}f.addDynamicBinding(D,r.ListAccess([P,S])),d.push(D)}}let g;if(t.parameters.length>0||a.length>0){let b=[],x=[];for(let T of t.parameters)b.push(T.identifier._symbol),x.push(Fe(p,T.bounds[0]),Fe(p,T.bounds[1]));for(let T of a)b.push(T.symbol),x.push(T.gliderBounds[0],T.gliderBounds[1]);g=r.BeginMap({parameterSymbols:b},x);for(let T=0;T<t.parameters.length+a.length;T++)r.BlockVar(I,[g]);for(let T=0;T<t.parameters.length;T++){let D=t.parameters[T].identifier._symbol,C=g+T+1;f.addDynamicBinding(D,C),d.push(D)}for(let T=0;T<a.length;T++){let D=a[T].symbol,P=g+t.parameters.length+T+1;f.addDynamicBinding(D,x_(r,[a[T].object,P])),d.push(D)}}let h=Fe({...Ci(e,f),substitutionContext:e.substitutionContext.for(s,e.recursiveFunctionContext,d)},o);if(g!==void 0){let b=r.EndMap([g,h]),x=r.getInstruction(h).valueType;if(ua(x))throw zP();if(!Ix(x))throw kP(x);let T=n.is3dPolicy()?2:1;if(t.parameters.length+a.length>T)throw HP(x,t.parameters.length);let D=Px(x,t.parameters.length+a.length);h=r.BlockVar(D,[b])}if(y!==void 0){let b=r.getInstruction(h);if(!wn(b.valueType))throw vc([oe(b.valueType)],{blockExport:Je(b)});let x=r.EndBroadcast([y,h]);h=r.BroadcastResult(vn(b.valueType),[x])}else t.shouldCoerceToList&&(h=r.List([h]));return h}function QM(e,t,n,r){let{stepMustBePositive:s}=r,{chunk:i}=e;t=zi(i,t),n=zi(i,n);let o=i.getInstruction(t),a=i.getInstruction(n),u=qo(i,t,\"Programming error: expected range start list to have constant length.\"),c=qo(i,n,\"Programming error: expected range start list to have constant length.\");if(o.valueType!==ne||a.valueType!==ne)throw jd();let l=i.Constant(1),p=i.Constant(0),f=i.ListAccess([t,l]),d=i.ListAccess([t,i.Constant(2)]),y=i.ListAccess([n,i.Constant(c)]),g=i.Subtract([y,f]),m=u>1?i.Subtract([d,f]):i.Piecewise([i.GreaterEqual([g,p]),l,i.Constant(-1)]),h=i.Add([l,i.NativeFunction(\"round\",[i.Divide([g,m])])]),b=i.NativeFunction(\"validateRangeLength\",[t,n,m,h]);s&&(b=i.Piecewise([i.GreaterEqual([m,p]),b,p]));let x=i.BeginBroadcast([b]),T=i.Add([f,i.Multiply([m,i.Subtract([x,l])])]),D=i.EndBroadcast([x,T]);return i.addComments({[f]:\"start\",[d]:\"second\",[y]:\"last\",[h]:\"proposedLength\",[m]:\"step\",[T]:\"body\"}),i.BroadcastResult(vn(i.getInstruction(T).valueType),[D])}function Zh(e,t){return gt(e,t,de)?e.NativeFunction(\"lineFromSegment\",[t]):gt(e,t,le)?e.NativeFunction(\"lineFromSegment\",[hU(e,t)]):gt(e,t,Ne)?e.NativeFunction(\"lineFromRay\",[t]):t}function CU(e,t){let n=e.NativeFunction(\"arcCenter\",[t]),r=e.NativeFunction(\"arcFirstPoint\",[t]),s=e.NativeFunction(\"distance\",[n,r]);return{center:n,radius:s,startPoint:r}}function p_(e,t,n){let{chunk:r}=e;if(t.length===3&&gt(r,t[0],N)&&gt(r,t[1],N)&&gt(r,t[2],N)){let s=t[0],i=t[1],o=t[2],a=r.Subtract([s,i]),u=r.Subtract([o,i]),c=r.Slot(0,[a]),l=r.Slot(1,[a]),p=r.Slot(0,[u]),f=r.Slot(1,[u]),d=r.NativeFunction(\"arctan\",[l,c]),y=r.Subtract([r.Multiply([c,f]),r.Multiply([l,p])]),g=r.Add([r.Multiply([c,p]),r.Multiply([l,f])]),m=r.NativeFunction(\"arctan\",[y,g]),h=r.NativeFunction(\"abs\",[m]),b=r.Constant(Math.PI),x=r.Constant(Math.PI*2);m=r.Piecewise([r.Equal([h,b]),b,r.Piecewise([r.Less([h,b]),m,r.Multiply([r.Multiply([r.NativeFunction(\"sign\",[m]),r.Constant(-1)]),r.Subtract([x,h])])])]);let T=r.NativeFunction(\"directedAngleMarker\",[i,d,m,Fe(e,new M.Identifier(\"trigAngleMultiplier\"))]),D=r.Constant(0),P=r.And([r.Equal([y,D]),r.Equal([g,D])]);return r.Piecewise([P,r.NanOfType(ye),T])}else throw z(`Unexpected types for ${n}`)}function aN(e,t){return e.Divide([e.NativeFunction(\"directedAngleMarkerRawDelta\",[t]),e.NativeFunction(\"directedAngleMarkerMultiplier\",[t])])}function uN(e,t){return e.NativeFunction(\"abs\",[e.Divide([e.NativeFunction(\"undirectedAngleMarkerRawDelta\",[t]),e.NativeFunction(\"undirectedAngleMarkerMultiplier\",[t])])])}function DU(e,t,n){let{chunk:r,policy:s}=e,i=n.slice(1),o=Nf(s,t);if(!o)throw new Error(`Unexpected transformation type: ${t}`);let a=o.map(p=>{let f=0;for(let d=1;d<n.length;d++){let y=r.getInstruction(n[d]).valueType,g=p.argTypeAtIndex(d);g&&Mc(y,g)&&f++}return{signature:p,matchedArgsCount:f,signatureArgsCount:p.maxArity===void 0?p.initial.length+1:p.argTypes.length-1,providedArgsCount:n.length-1}}).sort((p,f)=>f.matchedArgsCount!==p.matchedArgsCount?f.matchedArgsCount-p.matchedArgsCount:p.signatureArgsCount-f.signatureArgsCount),u;switch(t){case\"translate\":{u=[{match:[le],build:()=>r.NativeFunction(\"translation\",[r.NativeFunction(\"vectorDisplacementAsPoint\",i)])},{match:[N,N],build:()=>r.NativeFunction(\"translation\",[r.Subtract([i[1],i[0]])])}];break}case\"reflect\":{u=[{match:[Qm],build:()=>{let p=Zh(r,i[0]);return r.NativeFunction(\"reflection\",[p])}}];break}case\"rotate\":{u=[{match:[N,I],build:()=>{let p=Fe(e,new M.Identifier(\"trigAngleMultiplier\"));return r.NativeFunction(\"rotation\",[i[0],r.Multiply([i[1],p])])}}];break}case\"dilate\":{u=[{match:[N,I],build:()=>r.NativeFunction(\"dilation\",i)}];break}default:{let p=t;throw new Error(`Programming error: exhaustive check failed: ${p}`)}}let c=r.areAllArgsConstant(i),l=Ui(r,i,()=>{throw Jx(t,Pa(r,i),a[0].signature,{blockExport:c})},u);return Wh(r,[l,n[0]],t,!0)}function Wh(e,t,n,r){let s=[[Re,\"compose\"],[N,\"transformPoint\"],[de,\"transformSegment\"],[fe,\"transformLine\"],[Ne,\"transformRay\"],[le,\"transformVector\"],[ce,\"transformCircle\"],[ie,\"transformArc\"],[xe,\"transformPolygon\"],[Le,\"transformAngleMarker\"],[ye,\"transformDirectedAngleMarker\"]].map(([o,a])=>({match:[Re,o],build:(u,c)=>u.NativeFunction(a,c)}));function i(){if(r){let o=t.slice(1);throw Qx(n,zu(e,o),{blockExport:e.areAllArgsConstant(o)})}else throw Hs(n,zu(e,t),{blockExport:e.areAllArgsConstant(t)})}return Ui(e,t,i,s)}function ZM(e,t,n){let r=Zh(e,t[0]),s=Zh(e,t[1]),i=[r,s,e.ConstantOfType(I,n)];if(gt(e,r,ce)){if(gt(e,s,ce))return e.NativeFunction(\"circleCircleIntersection\",i);if(gt(e,s,ie))return e.NativeFunction(\"circleArcIntersection\",i);if(gt(e,s,fe))return e.NativeFunction(\"circleLineIntersection\",i)}if(gt(e,r,ie)){if(gt(e,s,ce))return e.NativeFunction(\"arcCircleIntersection\",i);if(gt(e,s,ie))return e.NativeFunction(\"arcArcIntersection\",i);if(gt(e,s,fe))return e.NativeFunction(\"arcLineIntersection\",i)}if(gt(e,r,fe)){if(gt(e,s,ce))return e.NativeFunction(\"lineCircleIntersection\",i);if(gt(e,s,ie))return e.NativeFunction(\"lineArcIntersection\",i);if(gt(e,s,fe))return e.NativeFunction(\"lineLineIntersection\",i)}throw z(\"Invalid intersection types\")}function SU(e,[t,n],[r,s]){let{chunk:i,scope:o}=e,a=i.getInstruction(r).valueType,u=i.getInstruction(s).valueType,c=f=>{var d;return(d=o.getParseNode(f))!=null?d:o.getVisibleGlobalDefinition(f)},l=ki(t)?c(t._symbol):t,p=ki(n)?c(n._symbol):n;if(!(!l||!p))return UO({getGeometryTree:f=>ah(f).tree,lookup:c,isPointOrListOfPoints:f=>{if(f.isFunction)return!1;let d=Fe(e,f);return se(i.getInstruction(d).valueType,N)},resolvesTo:(f,d)=>o.getVisibleGlobalDefinition(f)===d},l,a,p,u)}function vU(e,t){let{policy:n,scope:r}=e,s=t._body,i=r.childScope(),o=[];for(let u=0;u<t._assignments.length;u++){let c=t._assignments[u]._lhs,l;if(c instanceof we)l=c._symbol;else throw sf();let p=t._assignments[u].args[1],f=r.getVisibleGlobalDefinition(l);if(f){if(f.type===\"FunctionDefinition\")throw af(l);if(n.assignmentForbidden(l))throw of(l)}let d=Fe(e,p);i.addDynamicBinding(l,d,p),o.push(l)}return Fe({...Ci(e,i),substitutionContext:e.substitutionContext.with(r,e.recursiveFunctionContext,o)},s)}var d_={points:Pt,lines:jn,segments:xn,polygons:In,circles:Wn,arcs:Fn,angles:On,directedangles:Nn,rays:Vn,vectors:Jn};function OU(e,t){let{chunk:n,scope:r}=e,s=r.getVisibleGlobalDefinition(\"construction\");if(!s)throw z(\"Expected 'construction' to be defined in the frame\");if(s.type!==\"Construction\"||!(s instanceof Q))throw z(`Expected construction node but found ${s.type}}`);if(!ki(t))throw z(`Expected identifier but found ${t.type}`);let i=t._symbol;if(!(i in d_))throw ks(\"construction\");let o=d_[i];if(s.args.length===0)return n.ConstantOfType(o,[]);let a=Ve(o),u=[];for(let c of s.args)try{let l=Fe(e,c);n.getInstruction(l).valueType===a&&u.push(l)}catch(l){if(l instanceof M.Base)continue;throw l}return n.List(u)}function lm(e,t){let n=e.args,r=e instanceof gn?e._symbol:e instanceof Fu||e instanceof wu?e.args[0]._symbol:void 0;if(r&&t.definitions[r])return!1;if(e instanceof Fr){let a=[lm(e.args[0],t)||new Et(!0)],u=lm(e.args[1],t),c=lm(e.args[2],t);return u&&a.push(u),c&&a.push(c),a.length===1?!1:(a.length===2&&a.push(a[1]),new Fr(a))}let s=[],i=!1;for(let o of n){let a=lm(o,t);if(a===!1){i=!0;continue}s.push(a)}return i?!1:e.copyWithArgs(s)}function P_(e,t,n){let{chunk:r,scope:s}=e,i={},o=We(n.definitions);for(let y of o){let g=n.definitions[y];if(g instanceof v)throw g;i[y]=g}let a=t._argSymbols.map(y=>Fe(e,new we(y))),u=new WM(i,n.baseCases);try{M_(e,u,t,a)}catch(y){throw u.isUnconditionallyRecursive&&y instanceof v&&!y.blocksExport?o.length>1||E_(t,t._expression)?Rc(o,{suggestAlternativeFunctionName:!1}):oy(o):y}let c={},l={},p={},f=s.childScope();for(let y of o){let g=u.returnTypes[y];if(g===void 0)throw z(`Could not infer the return type for recursive function ${y}.`);let m=u.argTypes[y];if(m===void 0)throw z(`Could not infer the argument types for recursive function ${y}.`);l[y]={argTypes:m},c[y]=g,p[y]=r.FunctionHeader(y,g,l[y],i[y]._argSymbols),f.addLexicalBinding(y,p[y])}let d=[];for(let y of o)d.push(p[y]);for(let y of d)r.getInstruction(y).recursionGroup=d;for(let y of o){let g=f.childScope(),m=i[y],h=p[y],b=r.BeginFunction([h]);for(let D=0;D<m._argSymbols.length;D++){let P=m._argSymbols[D],C=r.BlockVar(l[y].argTypes[D],[b]);g.addLexicalBinding(P,C)}let x={...Ci(e,g),recursiveFunctionContext:{type:\"compile-general\",fnSymbols:o}},T=C_(x,m,n.baseCases,Fe(x,m._expression));if(r.getInstruction(T).valueType!==c[y])throw Hs(y,Pa(r,a),{blockExport:r.areAllArgsConstant(a)});T=Gr(r,T),r.EndFunction([b,T])}if(u.isUnconditionallyRecursive){let y=r.getRecursiveFunctionMetadata(p[t._symbol]),g=y==null?void 0:y.recursiveStructure;throw g!=null&&g.canIterate?new Error(\"Programming error: expected canIterate==false for unconditionally recursive function.\"):g!=null&&g.maxRecursiveCallOffsets&&o.every(m=>g.maxRecursiveCallOffsets[m]===0)?Rc(o,{suggestAlternativeFunctionName:!1}):Sx(o,{type:\"missing-non-recursive-branch\",recursionGroup:o,recursiveStructure:g})}return r.FunctionCall([p[t._symbol],...a])}function E_(e,t){return t instanceof gn&&t._symbol===e._symbol?t.args.every((n,r)=>n instanceof we&&n._symbol===e._argSymbols[r]):t.args.every(n=>E_(e,n))}function M_(e,t,n,r){let{chunk:s}=e,i=t.returnTypes[n._symbol],o=t.argTypes[n._symbol];if(i!==void 0&&o!==void 0)return{returnType:i,argTypes:o};let a=n._argSymbols.length,u=r.length;if(a!==u)throw Ao(n._symbol,a,u,{includeUsageExample:!0});let c=r.map(d=>s.getInstruction(d).valueType),l=`${n._symbol}:${c.join(\",\")}:${Object.keys(t.returnTypes).join(\",\")}`;if(t.stack.includes(l))return t.isUnconditionallyRecursive=!0,{returnType:I,argTypes:c};t.stack.push(l);let p=s.getReturnIndex(),f;return zh(e,d=>{var D;let y=lm(n._expression,t),g=n._symbol,m=(D=t.baseCases[g])!=null?D:[],h={...d,recursiveFunctionContext:t},b=h.scope,x=[];for(let P=0;P<n._argSymbols.length;P++){let C=n._argSymbols[P],S=s.SymbolicVar(c[P]);x.push(S),b.addLexicalBinding(C,S)}if(!t.baseCaseTypes.hasOwnProperty(g)){let P,C,S,O=!0;for(let _ of m){let L=_.getRef();if(!_.specifiedArg.valid||!L)continue;let w=new we(L),U=Fe(h,w);S||(S=w);let G=s.getInstruction(U),Z=G.valueType;if(Je(G)||(O=!1),P===void 0)P=_.specifiedArg.argIndex;else if(P!==_.specifiedArg.argIndex)throw Ld();let F=C;if(F===void 0)C=Z;else{let Y=Ha(F,Z);if(Y===void 0)throw _d({blockExport:O});C=Y}}t.baseCaseTypes[g]=C,t.firstValidBaseCaseIdentifiers[g]=S}let T=t.firstValidBaseCaseIdentifiers[g];if(y||T){let P=C_(h,n,t.baseCases,Fe(h,y||T)),{someArgBroadcasts:C,inferredArgTypes:S}=NU(s,x,p,P);if(c=S,f=s.getInstruction(P).valueType,C){if(!j(f))throw z(`TODO: expected a list type but found ${at(f)}`);f=Ve(f)}let O=t.returnTypes[n._symbol];if(O!==void 0&&f!==O)throw _d({blockExport:!1});t.argTypes[n._symbol]=S,t.returnTypes[n._symbol]=f}}),zh(e,d=>{let y={...d,recursiveFunctionContext:t},g=y.scope;for(let x=0;x<n._argSymbols.length;x++){let T=n._argSymbols[x],D=s.SymbolicVar(c[x]);g.addLexicalBinding(T,D)}let m=Fe(y,n._expression);t.stack.pop();let h=s.getInstruction(m).valueType,b=f===void 0?h:Ha(f,h);if(b===void 0)throw z(`Mismatched return types: ${f&&at(f)} vs ${at(h)}`);return t.returnTypes[n._symbol]=b,{returnType:b,argTypes:c}})}function NU(e,t,n,r){let s=[],u=[];for(let p=0;p<r-n;p++)u.push(0);if(e.getInstruction(r).type===48){u.push(1);for(let p=r;p>=0;p--){let f=u[p-n];if(f===0)continue;let d=e.getInstruction(p);if(!ge(d)){if(d.type===24?s.push(p):d.type===23&&s.pop(),(d.type===48||d.type===24)&&(u[d.args[0]-n]|=f),d.type===39||d.type===41||d.type===40)for(let y of s){let m=e.getInstruction(y).args[0];if(d.args[1]===m){u[d.args[0]-n]|=f;break}}if(s.length>0){let y=s[s.length-1],m=e.getInstruction(y).args[0];for(let h of d.args)h>=m&&(u[h-n]|=f);d.type===33&&d.args[0]>=m&&(u[d.args[0]-n]|=2)}}}}let c=[],l=!1;for(let p=0;p<t.length;p++){let f=t[p],d=e.getInstruction(f).valueType;if(u[f-n]&2){if(!j(d))throw z(`Expected list type but found ${at(d)}`);l=!0,c.push(Ve(d))}else c.push(d)}return{inferredArgTypes:c,someArgBroadcasts:l}}function C_(e,t,n,r){let{chunk:s}=e,i=!0,o=n[t._symbol];for(let a of o){let u=a.specifiedArg;if(!u.valid)continue;let c=t._argSymbols[u.argIndex],l=Fe(e,new we(c)),p=s.Equal([l,s.Constant(u.argValue)]),f=Fe(e,a),d=s.getInstruction(f);Je(d)||(i=!1);let y=s.getInstruction(f).valueType,g=s.getInstruction(r).valueType;if(Ha(y,g)===void 0)throw _d({blockExport:i});r=s.Piecewise([p,f,r])}return r}function RU(e){return e.type===\"Constant\"&&Number.isInteger(e.asValue())}function f_(e,t,n,r){var f;let{policy:s,chunk:i,scope:o}=e,a=new M.Identifier(t),u,c;r.length===1?(u=n[0],c=r[0]):(u=new M.ParenSeq(n),Uo(i,s,u,r),c=T_(e,r));let p=[(f=o.getSymbol(t))!=null?f:Fe(e,a),c];return Uo(i,s,new M.Multiply([a,u]),p),i.Multiply(p)}Yt.prototype.buildIRExpression=function(e,t,n){var s;let r=od({policy:e,frame:t,wrapInList:n&&n.wrapInList,coerceToNumber:n&&n.coerceToNumber},this);return e.isGeometryEnabled()&&r.argNames.some(i=>i[0]===\"$\")?GP():(s=r.getError())!=null?s:new on(r)};v.prototype.buildIRExpression=function(e,t,n){return this};var D_=vd;function KM(e){let t=[];for(let n=0;n<e.length;n++)t.push(oe(e[n].valueType));return t}var Di=!0;function S_(e,t){let n=t.length,r=t[0];if(n<2)throw so(this._symbol,{blockExport:Di});if(!D_(r.valueType,[ne,$e]))throw so(this._symbol,{blockExport:Di});if(n>2)throw by(this._symbol,2)}M.Histogram.prototype.typeCheck=S_;M.DotPlot.prototype.typeCheck=S_;M.BoxPlot.prototype.typeCheck=function(e,t){let n=t.length,r=t[0];if(n===0)throw so(this._symbol,{blockExport:Di});if(!D_(r.valueType,[ne,$e]))throw so(this._symbol,{blockExport:Di});if(n>1)throw so(this._symbol,{blockExport:Di})};M.TTest.prototype.typeCheck=function(e,t){let n=this._symbol;if(t.length===0)throw so(n,{blockExport:Di});if(t[0].valueType===$e)throw jl(n);if(t[0].valueType!==ne)throw so(n,{blockExport:Di});if(t.length>2)throw by(n,2);if(t[0].length<2)throw jl(n);if(t[1]&&t[1].valueType!==I)throw Hs(n,KM(t),{blockExport:Di})};M.IndependentTTest.prototype.typeCheck=function(e,t){let n=this._symbol;if(t.length!==2)throw Ud(n);if(!j(t[0].valueType)||!j(t[1].valueType))throw Wd(n,{blockExport:Di});if(t[0].valueType===$e||t[1].valueType===$e)throw jl(\"ittest\");if(t[0].valueType!==ne||t[1].valueType!==ne)throw Hs(n,KM(t),{blockExport:Di});if(t[0].length<2||t[1].length<2)throw jl(\"ittest\")},M.Stats.prototype.typeCheck=function(e,t){let n=t.length,r=t[0];if(n===0)throw so(this._symbol,{blockExport:Di});if(r.valueType===$e)throw Hs(this._symbol,KM(t),{blockExport:Di});if(r.valueType!==ne)throw so(this._symbol,{blockExport:Di});if(n>1)throw so(this._symbol,{blockExport:Di})};var iu=function(e,t,n){n=n||0;let r=Array(n+1).join(\"  \"),s=r+\"  \";return`[\n`+s+e.map(i=>i.repr(t,n+1)).join(`,\n`+s)+`\n`+r+\"]\"},Tr=function(e,t){return t=t||\"\",\"\"+t+e};M.Expression.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+iu(this.args,e,t)+\")\"};M.IRExpression.prototype.repr=function(e,t){t=t||0;let n=Array(t+1).join(\"  \"),r=n+\"  \",s=this._chunk.print().split(`\n`);return s.pop(),Tr(this.type,e)+\"(`\\n\"+r+s.join(`\n`+r)+`\n`+n+\"`)\"};M.DoubleInequality.prototype.repr=function(e,t){t=t||0;let n=Array(t+1).join(\"  \"),r=n+\"  \";return Tr(this.type,e)+`([\n`+r+this.args[0].repr(e,t+1)+`,\n`+r+\"'\"+this.args[1]+`',\n`+r+this.args[2].repr(e,t+1)+`,\n`+r+\"'\"+this.args[3]+`',\n`+r+this.args[4].repr(e,t+1)+`\n`+n+\"])\"};M.ComparatorChain.prototype.repr=function(e,t){return t=t||0,Tr(this.type,e)+\"([\"+this.symbols.map(n=>`'${n}'`).join(\",\")+`],\n`+iu(this.args,e,t)+\")\"};M.Identifier.prototype.repr=function(e){return Tr(this.type,e)+\"('\"+this._symbol+\"')\"};M.Constant.prototype.repr=function(e){return Tr(this.type,e)+\"(\"+this.asValue()+\")\"};M.ExtendSeed.prototype.repr=function(e,t){return Tr(this.type,e)+\"('\"+this.tag+\"', \"+iu(this.args,e,t)+\")\"};M.Seed.prototype.repr=function(e){return Tr(this.type,e)+\"(\"+this.asValue()+\")\"};M.FunctionCall.prototype.repr=function(e,t){return Tr(this.type,e)+\"('\"+this._symbol+\"', \"+iu(this.args,e,t)+\")\"};M.RecursiveFunctionBaseCase.prototype.repr=function(e,t){return this.originalNode.repr(e,t)};M.Assignment.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+new M.Identifier(this._symbol).repr(e,t)+\", \"+this._expression.repr(e,t)+\")\"};M.Regression.prototype.repr=M.Equation.prototype.repr=M.CallAssignment.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+this._lhs.repr(e,t)+\", \"+this._rhs.repr(e,t)+\")\"};M.FunctionDefinition.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+new M.Identifier(this._symbol).repr(e,t)+\", \"+iu(this._argSymbols.map(n=>new M.Identifier(n)),e,t)+\", \"+this._expression.repr(e,t)+\")\"};M.Error.prototype.repr=function(e,t){return Tr(this.type,e)+\"('\"+this._msg+\"')\"};M.Derivative.prototype.repr=function(e,t){return Tr(this.type,e)+\"('\"+this._symbol+\"', \"+iu(this.args,e,t)+\")\"};M.SolvedEquation.prototype.repr=function(e,t){return Tr(this.type,e)+\"('\"+this._symbol+\"', \"+this._expression.repr(e,t)+\")\"};M.OptimizedRegression.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+JSON.stringify(this.parameters)+\", \"+JSON.stringify(this.residuals)+\", \"+JSON.stringify(this.statistics)+\", \"+this.model.repr(e,t+1)+\", \"+JSON.stringify({isModelValid:this.isModelValid,residualVariable:this.residualVariable,residualSuggestionId:this.residualSuggestionId,shouldSuggestLogMode:this.shouldSuggestLogMode,isLinear:this.isLinear,parameterWarning:this.parameterWarning})+\")\"};M.Table.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+iu(this.columns,e,t)+\", \"+this.localFrameID+\")\"};M.TableColumn.prototype.repr=function(e,t){return Tr(this.type,e)+\"(\"+this.header.repr(e,t)+\", \"+this.length+\", \"+iu(this.values,e,t)+\", \"+this.localFrameID+\", \"+this.columnIndex+\")\"};M.TableColumnValue.prototype.repr=function(e,t){return\"TableColumnValue(\"+iu(this.rawArgs,e,t)+\", \"+this.headerSymbol+\")\"};M.Image.prototype.repr=function(e,t){let n=Array(t+1).join(\"  \"),r=n+\"  \";return Tr(this.type,e)+`({\n`+r+\"center: \"+this.center.repr(e,t+1)+`,\n`+r+\"radianAngle: \"+this.radianAngle.repr(e,t+1)+`,\n`+r+\"width: \"+this.width.repr(e,t+1)+`,\n`+r+\"height: \"+this.height.repr(e,t+1)+`},\n`+r+\"opacity: \"+this.opacity.repr(e,t+1)+`,\n`+r+JSON.stringify(this.moveStrategy)+`\n`+n+\"})\"};M.Ticker.prototype.repr=function(e,t){let n=Array(t+1).join(\"  \"),r=n+\"  \";return Tr(this.type,e)+`({\n`+r+\"handler: \"+this.handler.repr(e,t+1)+`,\n`+r+\"minStep: \"+this.minStep.repr(e,t+1)+`\n`+n+\"})\"};M.Slider.prototype.repr=function(e,t){let n=Array(t+1).join(\"  \"),r=n+\"  \";return Tr(this.type,e)+`({\n`+r+\"sliderAssignment: \"+this.sliderAssignment.repr(e,t+1)+`,\n`+r+\"sliderMin: \"+(this.sliderMin&&this.sliderMin.repr(e,t+1))+`,\n`+r+\"sliderMax: \"+(this.sliderMax&&this.sliderMax.repr(e,t+1))+`,\n`+r+\"sliderStep: \"+(this.sliderStep&&this.sliderStep.repr(e,t+1))+`},\n`+n+\")\"};M.ImaginaryUnit.prototype.repr=function(e){return Tr(this.type,e)+\"()\"};var Jh=function(e,t){return e.map(n=>n.substitute(t))};M.Identifier.prototype.substitute=function(e){return e[this._symbol]?e[this._symbol]:this};M.FunctionCall.prototype.substitute=function(e){let t=e[this._symbol];if(t){if(t.type===\"Identifier\")return new M.FunctionCall(t,Jh(this.args,e));if(t.type===\"Constant\")return new M.Multiply([t,this.args.length===1?this.args[0].substitute(e):new M.Constant(NaN)])}return M.Expression.prototype.substitute.call(this,e)};M.Constant.prototype.substitute=function(e){return this};M.Expression.prototype.substitute=function(e){return this.copyWithArgs(Jh(this.args,e))};M.Derivative.prototype.substitute=function(e){let t=e[this._symbol];if(t){if(t.type===\"Identifier\")return new M.Derivative(t,Jh(this.args,e));throw new Error(\"Cannot substitute for a derivative variable with a non-Identifier\")}return new M.Derivative(this._symbol,Jh(this.args,e))};M.Expression.prototype.simpleFunctionExpression=function(){return this};M.Assignment.prototype.simpleFunctionExpression=function(){return this._expression};M.FunctionDefinition.prototype.simpleFunctionExpression=function(){return this._expression};M.RecursiveFunctionBaseCase.prototype.simpleFunctionExpression=function(){return this._expression};M.Equation.prototype.simpleFunctionExpression=M.CallAssignment.prototype.simpleFunctionExpression=function(){return this.asComparator().simpleFunctionExpression()};var Qh={normaldist:{type:\"distribution\",symbol:\"normaldist\",params:[\"mean\",\"stdev\"],defaults:[\"0\",\"1\"],discrete:!1},tdist:{type:\"distribution\",symbol:\"tdist\",params:[\"dof\"],defaults:[void 0],discrete:!1},binomialdist:{type:\"distribution\",symbol:\"binomialdist\",params:[\"trials\",\"probsuccess\"],defaults:[void 0,\"0.5\"],discrete:!0},poissondist:{type:\"distribution\",symbol:\"poissondist\",params:[\"mean\"],defaults:[void 0],discrete:!0},uniformdist:{type:\"distribution\",symbol:\"uniformdist\",params:[\"min\",\"max\"],defaults:[\"0\",\"1\"],discrete:!1}},AU={Histogram:{type:\"visualization\",symbol:\"histogram\",params:[\"data\",\"binwidth\"],defaults:[void 0,\"1\"]},DotPlot:{type:\"visualization\",symbol:\"dotplot\",params:[\"data\",\"binwidth\"],defaults:[void 0,\"1\"]},BoxPlot:{type:\"visualization\",symbol:\"boxplot\",params:[\"data\"],defaults:[void 0]}};function v_(e){let t=Mi(e,{trailingComma:!0});return ou(t)}function ou(e){let t=e,n=AU[t.type];if(!n)switch(t.type===\"Assignment\"&&(t=t._expression),t.type){case\"FunctionCall\":{n=Qh[t._symbol];break}default:return}if(!n)return;let r={},s=n.params,i=t.args;for(let o=0;o<s.length;o++){let a=i[o];r[s[o]]=a&&a.getInputString()||\"\"}return{...n,span:t.getInputSpan(),values:r}}var LU={X_OR_Y:{points:!1,lines:!0,fill:!1},SINGLE_POINT:{points:!0,lines:!1,fill:!1},POINT_LIST:{points:!0,lines:!1,fill:!1},PARAMETRIC:{points:!1,lines:!0,fill:!1},POLAR:{points:!1,lines:!0,fill:!1},IMPLICIT:{points:!1,lines:!0,fill:!1},POLYGON:{points:!1,lines:!0,fill:!0},HISTOGRAM:{points:!1,lines:!0,fill:!0},DOTPLOT:{points:!0,lines:!1,fill:!1},BOXPLOT:{points:!1,lines:!0,fill:!1},TTEST:{points:!1,lines:!1,fill:!1},STATS:{points:!1,lines:!1,fill:!1},VECTOR2D:{points:!1,lines:!0,fill:!1},POINT3D:{points:!0,lines:!1,fill:!1},POINT3D_LIST:{points:!0,lines:!1,fill:!1},CURVE3D_xyz_t:{points:!1,lines:!0,fill:!1},SLICE:{points:!1,lines:!0,fill:!1},SLICE_r\\u03B8z_at_z:{points:!1,lines:!0,fill:!1},SLICE_zr\\u03B8_at_r:{points:!1,lines:!0,fill:!1},SLICE_zr\\u03B8_at_\\u03B8:{points:!1,lines:!0,fill:!1},SLICE_zr\\u03B8_at_xyz:{points:!1,lines:!0,fill:!1},SLICE_r\\u03B8\\u03C6_at_\\u03B8:{points:!1,lines:!0,fill:!1},SLICE_r\\u03B8\\u03C6_at_\\u03C6:{points:!1,lines:!0,fill:!1},SLICE_r\\u03B8\\u03C6_at_xyz:{points:!1,lines:!0,fill:!1},SLICE_xyz_uv:{points:!1,lines:!0,fill:!1},SEGMENT3D:{points:!1,lines:!0,fill:!1},VECTOR3D:{points:!1,lines:!0,fill:!1},SPHERE3D:{points:!1,lines:!0,fill:!1},SURFACE_xyz_uv:{points:!1,lines:!0,fill:!1},SURFACE_z_r\\u03B8:{points:!1,lines:!0,fill:!1},SURFACE_r_\\u03B8z:{points:!1,lines:!0,fill:!1},SURFACE_r_\\u03B8\\u03C6:{points:!1,lines:!0,fill:!1},SURFACE_r_\\u03B8z_AMBIGUOUS:{points:!1,lines:!0,fill:!1},SURFACE:{points:!1,lines:!0,fill:!1},TRIANGLE3D:{points:!1,lines:!0,fill:!1},SURFACE_AMBIGUOUS:{points:!1,lines:!0,fill:!1},SURFACE_CONSTANT_AMBIGUOUS:{points:!1,lines:!0,fill:!1},IMPLICIT_SURFACE:{points:!1,lines:!0,fill:!1},IMPLICIT_SURFACE_AMBIGUOUS:{points:!1,lines:!0,fill:!1}};function eC(e,t,n){var s,i,o,a,u,c;if(e===void 0)return{points:!1,lines:!1,fill:!1};let r=LU[e];switch(e){case\"SINGLE_POINT\":return{points:!0,lines:!1,fill:!1};case\"POINT_LIST\":case\"POINT3D_LIST\":case\"DOTPLOT\":return{points:(s=t.points)!=null?s:r.points,lines:(i=t.lines)!=null?i:r.lines,fill:!1};case\"POINT3D\":return{points:(o=t.points)!=null?o:r.points,lines:!1,fill:!1};case\"PARAMETRIC\":case\"POLYGON\":case\"X_OR_Y\":case\"VECTOR2D\":case\"POLAR\":case\"IMPLICIT\":case\"HISTOGRAM\":case\"BOXPLOT\":case\"TTEST\":case\"STATS\":case\"CURVE3D_xyz_t\":return{points:!1,lines:(a=t.lines)!=null?a:r.lines,fill:(u=t.fill)!=null?u:r.fill};case\"TRIANGLE3D\":case\"SPHERE3D\":case\"SURFACE\":case\"SURFACE_r_\\u03B8z\":case\"SURFACE_z_r\\u03B8\":case\"SURFACE_r_\\u03B8\\u03C6\":case\"SURFACE_xyz_uv\":case\"IMPLICIT_SURFACE\":case\"SURFACE_AMBIGUOUS\":case\"SURFACE_CONSTANT_AMBIGUOUS\":case\"SURFACE_r_\\u03B8z_AMBIGUOUS\":case\"IMPLICIT_SURFACE_AMBIGUOUS\":case\"SEGMENT3D\":case\"VECTOR3D\":case\"SLICE\":case\"SLICE_r\\u03B8z_at_z\":case\"SLICE_zr\\u03B8_at_r\":case\"SLICE_zr\\u03B8_at_\\u03B8\":case\"SLICE_zr\\u03B8_at_xyz\":case\"SLICE_r\\u03B8\\u03C6_at_\\u03B8\":case\"SLICE_r\\u03B8\\u03C6_at_\\u03C6\":case\"SLICE_r\\u03B8\\u03C6_at_xyz\":case\"SLICE_xyz_uv\":return{points:!1,lines:(c=t.lines)!=null?c:r.lines,fill:!1};default:n&&n(e);let l=e;return eC(e,t)||l}}function tC(e){if(e===void 0)return!1;switch(e){case\"SINGLE_POINT\":case\"POINT_LIST\":case\"PARAMETRIC\":case\"POLYGON\":case\"X_OR_Y\":case\"VECTOR2D\":case\"POLAR\":case\"IMPLICIT\":case\"SURFACE\":case\"SURFACE_AMBIGUOUS\":case\"SURFACE_CONSTANT_AMBIGUOUS\":case\"SURFACE_r_\\u03B8z\":case\"SURFACE_r_\\u03B8z_AMBIGUOUS\":case\"SURFACE_z_r\\u03B8\":case\"SURFACE_r_\\u03B8\\u03C6\":case\"SURFACE_xyz_uv\":case\"IMPLICIT_SURFACE\":case\"IMPLICIT_SURFACE_AMBIGUOUS\":case\"CURVE3D_xyz_t\":case\"SLICE\":case\"SLICE_r\\u03B8z_at_z\":case\"SLICE_zr\\u03B8_at_r\":case\"SLICE_zr\\u03B8_at_\\u03B8\":case\"SLICE_zr\\u03B8_at_xyz\":case\"SLICE_r\\u03B8\\u03C6_at_\\u03B8\":case\"SLICE_r\\u03B8\\u03C6_at_\\u03C6\":case\"SLICE_r\\u03B8\\u03C6_at_xyz\":case\"SLICE_xyz_uv\":case\"SEGMENT3D\":case\"VECTOR3D\":case\"SPHERE3D\":case\"POINT3D\":case\"POINT3D_LIST\":case\"TRIANGLE3D\":return!0;case\"HISTOGRAM\":case\"BOXPLOT\":case\"DOTPLOT\":case\"TTEST\":case\"STATS\":return!1;default:return e}}function O_(e){return e===\"SURFACE_r_\\u03B8\\u03C6\"||e===\"SLICE_r\\u03B8\\u03C6_at_\\u03B8\"||e===\"SLICE_r\\u03B8\\u03C6_at_\\u03C6\"||e===\"SLICE_r\\u03B8\\u03C6_at_xyz\"}function N_(e){return e===\"SURFACE_z_r\\u03B8\"||e===\"SLICE_zr\\u03B8_at_r\"||e===\"SLICE_zr\\u03B8_at_\\u03B8\"||e===\"SLICE_zr\\u03B8_at_xyz\"}function R_(e){return e===\"SURFACE_r_\\u03B8z\"||e===\"SURFACE_r_\\u03B8z_AMBIGUOUS\"||e===\"SLICE_r\\u03B8z_at_z\"}var B=function(){};B.version=\"1.2.6\";B._myIndexOf=function(t){var n=this.length,r;for(r=0;r<n;++r)if(this[r]===t)return r;return-1};B.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:B._myIndexOf;B.precision=4;B.largeArray=50;B.compile=function(){var e=Array.prototype.slice.call(arguments),t=e.pop();return t=\"return function (\"+e.join(\",\")+\") {\"+t+\"}\",new Function([\"numeric\"],t)(B)};B._dim=function(t){for(var n=[];typeof t==\"object\";)n.push(t.length),t=t[0];return n};B.dim=function(t){var n,r;return typeof t==\"object\"?(n=t[0],typeof n==\"object\"?(r=n[0],typeof r==\"object\"?B._dim(t):[t.length,n.length]):[t.length]):[]};B.mapreduce=function(t,n){return B.compile(\"x\",\"accum\",\"_s\",\"_k\",'if(typeof accum === \"undefined\") accum = '+n+`;\nif(typeof x === \"number\") { var xi = x; `+t+`; return accum; }\nif(typeof _s === \"undefined\") _s = numeric.dim(x);\nif(typeof _k === \"undefined\") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    `+t+`;\n    xi = x[i-1];\n    `+t+`;\n}\nif(i === 0) {\n    xi = x[i];\n    `+t+`\n}\nreturn accum;`)};B.mapreduce2=function(t,n){return B.compile(\"x\",`var n = x.length;\nvar i,xi;\n`+n+`\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    `+t+`\n}\nreturn accum;`)};B.rep=function(t,n,r){typeof r==\"undefined\"&&(r=0);var s=t[r],i=Array(s),o;if(r===t.length-1){for(o=s-2;o>=0;o-=2)i[o+1]=n,i[o]=n;return o===-1&&(i[0]=n),i}for(o=s-1;o>=0;o--)i[o]=B.rep(t,n,r+1);return i};B.dotMMsmall=function(t,n){var r,s,i,o,a,u,c,l,p,f,d,y,g,m;for(o=t.length,a=n.length,u=n[0].length,c=Array(o),r=o-1;r>=0;r--){for(l=Array(u),p=t[r],i=u-1;i>=0;i--){for(f=p[a-1]*n[a-1][i],s=a-2;s>=1;s-=2)d=s-1,f+=p[s]*n[s][i]+p[d]*n[d][i];s===0&&(f+=p[0]*n[0][i]),l[i]=f}c[r]=l}return c};B._getCol=function(t,n,r){var s=t.length,i;for(i=s-1;i>0;--i)r[i]=t[i][n],--i,r[i]=t[i][n];i===0&&(r[0]=t[0][n])};B.dotMMbig=function(t,n){var r=B._getCol,s=n.length,i=Array(s),o=t.length,a=n[0].length,u=new Array(o),c,l=B.dotVV,p,f,d,y;for(--s,--o,p=o;p!==-1;--p)u[p]=Array(a);for(--a,p=a;p!==-1;--p)for(r(n,p,i),f=o;f!==-1;--f)y=0,c=t[f],u[f][p]=l(c,i);return u};B.dotMV=function(t,n){var r=t.length,s=n.length,i,o=Array(r),a=B.dotVV;for(i=r-1;i>=0;i--)o[i]=a(t[i],n);return o};B.dotVM=function(t,n){var r,s,i,o,a,u,c,l,p,f,d,y,g,m,h,b,x,T,D;for(o=t.length,a=n[0].length,c=Array(a),i=a-1;i>=0;i--){for(f=t[o-1]*n[o-1][i],s=o-2;s>=1;s-=2)d=s-1,f+=t[s]*n[s][i]+t[d]*n[d][i];s===0&&(f+=t[0]*n[0][i]),c[i]=f}return c};B.dotVV=function(t,n){var r,s=t.length,i,o=t[s-1]*n[s-1];for(r=s-2;r>=1;r-=2)i=r-1,o+=t[r]*n[r]+t[i]*n[i];return r===0&&(o+=t[0]*n[0]),o};B.dot=function(t,n){var r=B.dim;switch(r(t).length*1e3+r(n).length){case 2002:return n.length<10?B.dotMMsmall(t,n):B.dotMMbig(t,n);case 2001:return B.dotMV(t,n);case 1002:return B.dotVM(t,n);case 1001:return B.dotVV(t,n);case 1e3:return B.mulVS(t,n);case 1:return B.mulSV(t,n);case 0:return t*n;default:throw new Error(\"numeric.dot only works on vectors and matrices\")}};B.diag=function(t){var n,r,s,i=t.length,o=Array(i),a;for(n=i-1;n>=0;n--){for(a=Array(i),r=n+2,s=i-1;s>=r;s-=2)a[s]=0,a[s-1]=0;for(s>n&&(a[s]=0),a[n]=t[n],s=n-1;s>=1;s-=2)a[s]=0,a[s-1]=0;s===0&&(a[0]=0),o[n]=a}return o};B.getDiag=function(e){var t=Math.min(e.length,e[0].length),n,r=Array(t);for(n=t-1;n>=1;--n)r[n]=e[n][n],--n,r[n]=e[n][n];return n===0&&(r[0]=e[0][0]),r};B.identity=function(t){return B.diag(B.rep([t],1))};B.pointwise=function(t,n,r){typeof r==\"undefined\"&&(r=\"\");var s=[],i,o=/\\[i\\]$/,a,u=\"\",c=!1;for(i=0;i<t.length;i++)o.test(t[i])?(a=t[i].substring(0,t[i].length-3),u=a):a=t[i],a===\"ret\"&&(c=!0),s.push(a);return s[t.length]=\"_s\",s[t.length+1]=\"_k\",s[t.length+2]='if(typeof _s === \"undefined\") _s = numeric.dim('+u+`);\nif(typeof _k === \"undefined\") _k = 0;\nvar _n = _s[_k];\nvar i`+(c?\"\":\", ret = Array(_n)\")+`;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee(`+t.join(\",\")+`,_s,_k+1);\n    return ret;\n}\n`+r+`\nfor(i=_n-1;i!==-1;--i) {\n    `+n+`\n}\nreturn ret;`,B.compile.apply(null,s)};B.pointwise2=function(t,n,r){typeof r==\"undefined\"&&(r=\"\");var s=[],i,o=/\\[i\\]$/,a,u=\"\",c=!1;for(i=0;i<t.length;i++)o.test(t[i])?(a=t[i].substring(0,t[i].length-3),u=a):a=t[i],a===\"ret\"&&(c=!0),s.push(a);return s[t.length]=\"var _n = \"+u+`.length;\nvar i`+(c?\"\":\", ret = Array(_n)\")+`;\n`+r+`\nfor(i=_n-1;i!==-1;--i) {\n`+n+`\n}\nreturn ret;`,B.compile.apply(null,s)};B._biforeach=function e(t,n,r,s,i){if(s===r.length-1){i(t,n);return}var o,a=r[s];for(o=a-1;o>=0;o--)e(typeof t==\"object\"?t[o]:t,typeof n==\"object\"?n[o]:n,r,s+1,i)};B._biforeach2=function e(t,n,r,s,i){if(s===r.length-1)return i(t,n);var o,a=r[s],u=Array(a);for(o=a-1;o>=0;--o)u[o]=e(typeof t==\"object\"?t[o]:t,typeof n==\"object\"?n[o]:n,r,s+1,i);return u};B._foreach=function e(t,n,r,s){if(r===n.length-1){s(t);return}var i,o=n[r];for(i=o-1;i>=0;i--)e(t[i],n,r+1,s)};B._foreach2=function e(t,n,r,s){if(r===n.length-1)return s(t);var i,o=n[r],a=Array(o);for(i=o-1;i>=0;i--)a[i]=e(t[i],n,r+1,s);return a};B.ops2={add:\"+\",sub:\"-\",mul:\"*\",div:\"/\",mod:\"%\",and:\"&&\",or:\"||\",eq:\"===\",neq:\"!==\",lt:\"<\",gt:\">\",leq:\"<=\",geq:\">=\",band:\"&\",bor:\"|\",bxor:\"^\",lshift:\"<<\",rshift:\">>\",rrshift:\">>>\"};B.opseq={addeq:\"+=\",subeq:\"-=\",muleq:\"*=\",diveq:\"/=\",modeq:\"%=\",lshifteq:\"<<=\",rshifteq:\">>=\",rrshifteq:\">>>=\",bandeq:\"&=\",boreq:\"|=\",bxoreq:\"^=\"};B.mathfuns=[\"abs\",\"acos\",\"asin\",\"atan\",\"ceil\",\"cos\",\"exp\",\"floor\",\"log\",\"round\",\"sin\",\"sqrt\",\"tan\",\"isNaN\",\"isFinite\"];B.mathfuns2=[\"atan2\",\"pow\",\"max\",\"min\"];B.ops1={neg:\"-\",not:\"!\",bnot:\"~\",clone:\"\"};B.mapreducers={any:[\"if(xi) return true;\",\"var accum = false;\"],all:[\"if(!xi) return false;\",\"var accum = true;\"],sum:[\"accum += xi;\",\"var accum = 0;\"],prod:[\"accum *= xi;\",\"var accum = 1;\"],norm2Squared:[\"accum += xi*xi;\",\"var accum = 0;\"],norminf:[\"accum = max(accum,abs(xi));\",\"var accum = 0, max = Math.max, abs = Math.abs;\"],norm1:[\"accum += abs(xi);\",\"var accum = 0, abs = Math.abs;\"],sup:[\"accum = max(accum,xi);\",\"var accum = -Infinity, max = Math.max;\"],inf:[\"accum = min(accum,xi);\",\"var accum = Infinity, min = Math.min;\"]};(function(){var e,t;for(e=0;e<B.mathfuns2.length;++e)t=B.mathfuns2[e],B.ops2[t]=t;for(e in B.ops2)if(B.ops2.hasOwnProperty(e)){t=B.ops2[e];var n,r,s=\"\";B.myIndexOf.call(B.mathfuns2,e)!==-1?(s=\"var \"+t+\" = Math.\"+t+`;\n`,n=function(i,o,a){return i+\" = \"+t+\"(\"+o+\",\"+a+\")\"},r=function(i,o){return i+\" = \"+t+\"(\"+i+\",\"+o+\")\"}):(n=function(i,o,a){return i+\" = \"+o+\" \"+t+\" \"+a},B.opseq.hasOwnProperty(e+\"eq\")?r=function(i,o){return i+\" \"+t+\"= \"+o}:r=function(i,o){return i+\" = \"+i+\" \"+t+\" \"+o}),B[e+\"VV\"]=B.pointwise2([\"x[i]\",\"y[i]\"],n(\"ret[i]\",\"x[i]\",\"y[i]\"),s),B[e+\"SV\"]=B.pointwise2([\"x\",\"y[i]\"],n(\"ret[i]\",\"x\",\"y[i]\"),s),B[e+\"VS\"]=B.pointwise2([\"x[i]\",\"y\"],n(\"ret[i]\",\"x[i]\",\"y\"),s),B[e]=B.compile(`var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric.`+e+\"VV, VS = numeric.\"+e+\"VS, SV = numeric.\"+e+`SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === \"object\") {\n      if(typeof y === \"object\") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === \"object\") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else `+r(\"x\",\"y\")+`\n}\nreturn x;\n`),B[t]=B[e],B[e+\"eqV\"]=B.pointwise2([\"ret[i]\",\"x[i]\"],r(\"ret[i]\",\"x[i]\"),s),B[e+\"eqS\"]=B.pointwise2([\"ret[i]\",\"x\"],r(\"ret[i]\",\"x\"),s),B[e+\"eq\"]=B.compile(`var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric.`+e+\"eqV, S = numeric.\"+e+`eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === \"object\") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n`)}for(e=0;e<B.mathfuns2.length;++e)t=B.mathfuns2[e],delete B.ops2[t];for(e=0;e<B.mathfuns.length;++e)t=B.mathfuns[e],B.ops1[t]=t;for(e in B.ops1)B.ops1.hasOwnProperty(e)&&(s=\"\",t=B.ops1[e],B.myIndexOf.call(B.mathfuns,e)!==-1&&Math.hasOwnProperty(t)&&(s=\"var \"+t+\" = Math.\"+t+`;\n`),B[e+\"eqV\"]=B.pointwise2([\"ret[i]\"],\"ret[i] = \"+t+\"(ret[i]);\",s),B[e+\"eq\"]=B.compile(\"x\",'if(typeof x !== \"object\") return '+t+`x\nvar i;\nvar V = numeric.`+e+`eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n`),B[e+\"V\"]=B.pointwise2([\"x[i]\"],\"ret[i] = \"+t+\"(x[i]);\",s),B[e]=B.compile(\"x\",'if(typeof x !== \"object\") return '+t+`(x)\nvar i;\nvar V = numeric.`+e+`V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n`));for(e=0;e<B.mathfuns.length;++e)t=B.mathfuns[e],delete B.ops1[t];for(e in B.mapreducers)B.mapreducers.hasOwnProperty(e)&&(t=B.mapreducers[e],B[e+\"V\"]=B.mapreduce2(t[0],t[1]),B[e]=B.compile(\"x\",\"s\",\"k\",t[1]+`if(typeof x !== \"object\") {    xi = x;\n`+t[0]+`\n    return accum;\n}if(typeof s === \"undefined\") s = numeric.dim(x);\nif(typeof k === \"undefined\") k = 0;\nif(k === s.length-1) return numeric.`+e+`V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n`+t[0]+`\n}\nreturn accum;\n`))})();B.inv=function(g){var n=B.dim(g),r=Math.abs,s=n[0],i=n[1],o=B.clone(g),a,u,c=B.identity(s),l,p,f,d,y,g;for(d=0;d<i;++d){var m=-1,h=-1;for(f=d;f!==s;++f)y=r(o[f][d]),y>h&&(m=f,h=y);for(u=o[m],o[m]=o[d],o[d]=u,p=c[m],c[m]=c[d],c[d]=p,g=u[d],y=d;y!==i;++y)u[y]/=g;for(y=i-1;y!==-1;--y)p[y]/=g;for(f=s-1;f!==-1;--f)if(f!==d){for(a=o[f],l=c[f],g=a[d],y=d+1;y!==i;++y)a[y]-=u[y]*g;for(y=i-1;y>0;--y)l[y]-=p[y]*g,--y,l[y]-=p[y]*g;y===0&&(l[0]-=p[0]*g)}}return c};B.det=function(t){var n=B.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error(\"numeric: det() only works on square matrices\");var r=n[0],s=1,i,o,a,u=B.clone(t),c,l,p,f,d,y,g;for(o=0;o<r-1;o++){for(a=o,i=o+1;i<r;i++)Math.abs(u[i][o])>Math.abs(u[a][o])&&(a=i);for(a!==o&&(f=u[a],u[a]=u[o],u[o]=f,s*=-1),c=u[o],i=o+1;i<r;i++){for(l=u[i],p=l[o]/c[o],a=o+1;a<r-1;a+=2)d=a+1,l[a]-=c[a]*p,l[d]-=c[d]*p;a!==r&&(l[a]-=c[a]*p)}if(c[o]===0)return 0;s*=c[o]}return s*u[o][o]};B.transpose=function(t){var n,r,s=t.length,i=t[0].length,o=Array(i),a,u,c;for(r=0;r<i;r++)o[r]=Array(s);for(n=s-1;n>=1;n-=2){for(u=t[n],a=t[n-1],r=i-1;r>=1;--r)c=o[r],c[n]=u[r],c[n-1]=a[r],--r,c=o[r],c[n]=u[r],c[n-1]=a[r];r===0&&(c=o[0],c[n]=u[0],c[n-1]=a[0])}if(n===0){for(a=t[0],r=i-1;r>=1;--r)o[r][0]=a[r],--r,o[r][0]=a[r];r===0&&(o[0][0]=a[0])}return o};B.negtranspose=function(t){var n,r,s=t.length,i=t[0].length,o=Array(i),a,u,c;for(r=0;r<i;r++)o[r]=Array(s);for(n=s-1;n>=1;n-=2){for(u=t[n],a=t[n-1],r=i-1;r>=1;--r)c=o[r],c[n]=-u[r],c[n-1]=-a[r],--r,c=o[r],c[n]=-u[r],c[n-1]=-a[r];r===0&&(c=o[0],c[n]=-u[0],c[n-1]=-a[0])}if(n===0){for(a=t[0],r=i-1;r>=1;--r)o[r][0]=-a[r],--r,o[r][0]=-a[r];r===0&&(o[0][0]=-a[0])}return o};B.norm2=function(t){return Math.sqrt(B.norm2Squared(t))};B.linspace=function(t,n,r){if(typeof r==\"undefined\"&&(r=Math.max(Math.round(n-t)+1,1)),r<2)return r===1?[t]:[];var s,i=Array(r);for(r--,s=r;s>=0;s--)i[s]=(s*n+(r-s)*t)/r;return i};B.getBlock=function(t,n,r){var s=B.dim(t);function i(o,a){var u,c=n[a],l=r[a]-c,p=Array(l);if(a===s.length-1){for(u=l;u>=0;u--)p[u]=o[u+c];return p}for(u=l;u>=0;u--)p[u]=i(o[u+c],a+1);return p}return i(t,0)};B.setBlock=function(t,n,r,s){var i=B.dim(t);function o(a,u,c){var l,p=n[c],f=r[c]-p;if(c===i.length-1)for(l=f;l>=0;l--)a[l+p]=u[l];for(l=f;l>=0;l--)o(a[l+p],u[l],c+1)}return o(t,s,0),t};B.getRange=function(t,n,r){var s=n.length,i=r.length,o,a,u=Array(s),c,l;for(o=s-1;o!==-1;--o)for(u[o]=Array(i),c=u[o],l=t[n[o]],a=i-1;a!==-1;--a)c[a]=l[r[a]];return u};B.blockMatrix=function(t){var n=B.dim(t);if(n.length<4)return B.blockMatrix([t]);var r=n[0],s=n[1],i,o,a,u,c;for(i=0,o=0,a=0;a<r;++a)i+=t[a][0].length;for(u=0;u<s;++u)o+=t[0][u][0].length;var l=Array(i);for(a=0;a<i;++a)l[a]=Array(o);var p=0,f,d,y,g,m;for(a=0;a<r;++a){for(f=o,u=s-1;u!==-1;--u)for(c=t[a][u],f-=c[0].length,y=c.length-1;y!==-1;--y)for(m=c[y],d=l[p+y],g=m.length-1;g!==-1;--g)d[f+g]=m[g];p+=t[a][0].length}return l};B.tensor=function(t,n){if(typeof t==\"number\"||typeof n==\"number\")return B.mul(t,n);var r=B.dim(t),s=B.dim(n);if(r.length!==1||s.length!==1)throw new Error(\"numeric: tensor product is only defined for vectors\");var i=r[0],o=s[0],a=Array(i),u,c,l,p;for(c=i-1;c>=0;c--){for(u=Array(o),p=t[c],l=o-1;l>=3;--l)u[l]=p*n[l],--l,u[l]=p*n[l],--l,u[l]=p*n[l],--l,u[l]=p*n[l];for(;l>=0;)u[l]=p*n[l],--l;a[c]=u}return a};B.epsilon=2220446049250313e-31;B.LU=function(e,t){t=t||!1;var n=Math.abs,r,s,i,o,a,u,c,l,p,f=e.length,d=f-1,y=new Array(f);for(t||(e=B.clone(e)),i=0;i<f;++i){for(c=i,u=e[i],p=n(u[i]),s=i+1;s<f;++s)o=n(e[s][i]),p<o&&(p=o,c=s);for(y[i]=c,c!=i&&(e[i]=e[c],e[c]=u,u=e[i]),a=u[i],r=i+1;r<f;++r)e[r][i]/=a;for(r=i+1;r<f;++r){for(l=e[r],s=i+1;s<d;++s)l[s]-=l[i]*u[s],++s,l[s]-=l[i]*u[s];s===d&&(l[s]-=l[i]*u[s])}}return{LU:e,P:y}};B.LUsolve=function(t,n){var r,s,i=t.LU,o=i.length,a=B.clone(n),u=t.P,c,l,p,f;for(r=o-1;r!==-1;--r)a[r]=n[r];for(r=0;r<o;++r)for(c=u[r],u[r]!==r&&(f=a[r],a[r]=a[c],a[c]=f),l=i[r],s=0;s<r;++s)a[r]-=a[s]*l[s];for(r=o-1;r>=0;--r){for(l=i[r],s=r+1;s<o;++s)a[r]-=a[s]*l[s];a[r]/=l[r]}return a};B.solve=function(t,n,r){return B.LUsolve(B.LU(t,r),n)};var Un=B;var wU=Math.pow(2,-52);function eb(e){for(let t of e)for(let n of t)if(!an(n))return!1;return!0}function FU(e){let t=[];for(let n of e)t.push(n.slice());return t}function __(e){let{numRows:t,numCols:n}=Kh(e),r=[];for(let s=0;s<n;s++)r.push([]);for(let s=0;s<t;s++)for(let i=0;i<n;i++)r[i].push(e[s][i]);return r}function Kh(e){let t=e.length,n=t>0?e[0].length:0;return{numRows:t,numCols:n}}function VU(){throw new Error(\"Matrix dimension mismatch\")}function nC(e,t){let n=Kh(e),r=Kh(t);n.numCols!==r.numRows&&VU();let s=[];for(let i=0;i<n.numRows;i++){let o=[];for(let a=0;a<r.numCols;a++){let u=Se(0,1);for(let c=0;c<e[i].length;c++)u=qs(u,wr(e[i][c],t[c][a]));o.push(u)}s.push(o)}return s}function L_(e){let t=FU(e);return GU(t),t}function BU(e){let t=0;for(let n of e)for(let r of n){let s=Math.abs(V(r));if(!isFinite(s))return NaN;s>t&&(t=s)}return t}function A_(e){for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++)e[t][n]=NaN}function GU(e){let{numRows:t,numCols:n}=Kh(e),r=BU(e);if(!isFinite(r))return A_(e),{determinant:NaN,rank:0};let s=Math.max(t,n)*r*wU,i=Se(1,1),o=0,a=0;for(;o<t&&a<n;){let u=o,c=Math.abs(V(e[o][a]));for(let p=o+1;p<t;p++){let f=Math.abs(V(e[p][a]));(!isFinite(f)||f>c)&&(c=f,u=p)}if(!isFinite(c))return A_(e),{determinant:NaN,rank:0};if(c===0){i=Se(0,1),a+=1;continue}if(!an(e[u][a])&&c<s){for(let p=o;p<t;p++)e[o][p]=0;i=0,a+=1;continue}if(u!==o){i=Us(i);let p=e[o];e[o]=e[u],e[u]=p}for(let p=0;p<t;p++){if(p===o)continue;let f=Ps(e[p][a],e[o][a]);e[p][a]=Se(0,1);for(let d=a+1;d<n;d++)e[p][d]=ai(e[p][d],wr(f,e[o][d]))}let l=e[o][a];i=wr(i,l),e[o][a]=Se(1,1);for(let p=a+1;p<n;p++)e[o][p]=Ps(e[o][p],l);o+=1,a+=1}return{rank:o,determinant:o===t&&o===n?i:Se(0,1)}}function HU(e,t){let n=e.length,r=t.length,s=0,i=0;for(let a=r-n;a<r;a++)s+=e[a+n-r]*t[a],i+=e[a+n-r]*e[a+n-r];let o=s/i;for(let a=r-n;a<r;a++)t[a]=2*o*e[a+n-r]-t[a]}function zU(e,t,n){let r=e.length,s=t.length,i=0,o=0;for(let u=s-r;u<s;u++)i+=e[u+r-s]*t[u][n],o+=e[u+r-s]*e[u+r-s];let a=i/o;for(let u=s-r;u<s;u++)t[u][n]=2*a*e[u+r-s]-t[u][n]}function UU(e,t,n,r){let s=Array(e.length-t);if(s.length===1)return s[0]=1,s;if(r===0){s[0]=1;for(let o=1;o<s.length;o++)s[o]=0;return s}let i=e[t][n]<0?-1:1;s[0]=e[t][n]+i*Math.sqrt(r);for(let o=t+1;o<e.length;o++)s[o-t]=e[o][n];return s}function qU(e,t,n){let r=0;for(;t<e.length;t++)r+=e[t][n]*e[t][n];return r}function tb(e,t){if(!t||!t.mutateInput){let i=e;e=Array(e.length);for(let o=0;o<i.length;o++)e[o]=i[o].slice()}let n=Math.min(e.length,e[0].length),r=Array(n),s=[];for(let i=0;i<n;i++){let o=-1/0,a=i;for(let c=i;c<e[i].length;c++){let l=qU(e,i,c);l>o&&(o=l,a=c)}if(r[i]=a,a!==i)for(let c=0;c<e.length;c++){let l=e[c][a];e[c][a]=e[c][i],e[c][i]=l}let u=UU(e,i,i,o);for(let c=i;c<e[i].length;c++)zU(u,e,c);s.push(u)}return{reflectors:s,r:e,p:r}}function w_(e,t,n){let{reflectors:r,r:s,p:i}=e,o=t.slice();for(let c=0;c<r.length;c++)HU(r[c],o);for(let c=r.length;c<s[0].length;c++)o[c]=0;o.length=s[0].length;let a=Math.pow(2,-52),u=n.regularize?a*Math.abs(s[0][0])*Math.max(s.length,s[0].length):0;for(let c=r.length-1;c>=0;c--){let l=s[c];if(Math.abs(l[c])<=u)o[c]=0;else{for(let p=c+1;p<r.length;p++)o[c]-=o[p]*l[p];o[c]/=l[c]}}for(let c=i.length-1;c>=0;c--)if(i[c]!==c){let l=o[c];o[c]=o[i[c]],o[i[c]]=l}return o}function $U(e,t,n){let r=Array(e.r[0].length);for(let i=0;i<r.length;i++)r[i]=Array(t[0].length);let s=Array(t.length);for(let i=0;i<t[0].length;i++){for(let a=0;a<t.length;a++)s[a]=t[a][i];let o=w_(e,s,n);for(let a=0;a<o.length;a++)r[a][i]=o[a]}return r}function Il(e,t,n){return Array.isArray(t[0])?$U(e,t,n):w_(e,t,n)}function YU(e){let t=e.r,n=Math.min(t.length,t[0].length),r=t[0][0],s=t[n-1][n-1];return r===0?1/0:Math.abs(r/s)}function F_(e){let t=Math.pow(2,-52);return Math.max(e.r.length,e.r[0].length)*t*YU(e)<1}function rb(e,t){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function pm(e,t){let n=Qu(e,t),r=0;for(let s of n){let i=s;r+=i*i}return r/n.length}function Qu(e,t){return e.apply(void 0,t)}function nb(e,t){let n=[];for(let r of e){let s=r.apply(void 0,t);n.push(s)}return n}function V_(e,t){let n=[];for(let r=0;r<e.length;r++)t[r]&&n.push(e[r]);return n}function rC(e,t,n){let r=[];for(let s=0,i=0;s<e.length;s++){let o=0;n[s]&&(o=t[i],i+=1),r.push(e[s]+o)}return r}function oC(e,t){let n=t.solution.map(u=>Math.abs(u)<1e-6?0:u),r=t.solution.map(()=>0),s=pm(e,n),i=Qu(e,n),o=Qu(e,r),a=0;for(let u=0;u<i.length;u++){let c=o[u]*1e-15;a+=Math.abs(i[u]*c)+c*c}return a/=i.length,isFinite(a)||(a=0),isFinite(t.MSE)&&!isFinite(s)?t:s<=t.MSE+a?{solution:n,MSE:s}:t}function aC(e,t){if(!eb(t)||!eb([e]))return;let n=__(t),r=nC([e],n)[0],s=nC(t,n);for(let c=0;c<r.length;c++)s[c].push(Us(r[c]));let i=L_(s);if(!eb(i))return;let o=[],a=r.length,u=0;for(let c of i)for(;u<a;)if(V(c[u])===1){o.push(c[c.length-1]),u++;break}else o.push(Se(0,1)),u++;for(;u<a;)o.push(Se(0,1)),u++;return o}function uC(e,t){let n=rb(0,t.length),r=nb(t,n),s=tb(Un.transpose(r),{mutateInput:!0});for(let u=0;u<2;u++){let c=Qu(e,n),l=Un.neg(Il(s,c,{regularize:!1}));n=Un.add(n,l)}let i=pm(e,n);if(F_(s))return{solution:n,MSE:i};let o=rb(0,t.length);for(let u=0;u<2;u++){let c=Qu(e,o),l=Un.neg(Il(s,c,{regularize:!0}));o=Un.add(o,l)}let a=pm(e,o);return .999*a<=i?{solution:o,MSE:a}:{solution:n,MSE:i}}function sC(e,t,n,r){let s=r.maxIterations,i=r.linearSubset||rb(!1,n.length),o=Un.not(i),a=V_(t,i),u=V_(t,o),c=2,l=.1,p=n,f=0,d=.001,y;if(a.length>0){let h=Un.transpose(nb(a,p)),b=tb(h);y={Jv:h,F:b};let x=Qu(e,p),T=Un.neg(Il(b,x,{regularize:!0}));p=rC(p,T,i)}let g=!1,m=pm(e,p);for(;f<s&&!g&&isFinite(m);){let h=Qu(e,p),b=nb(u,p),x=Un.transpose(b),T,D;if(y){let{F:S,Jv:O}=y;T=Un.dot(b,Un.sub(h,Un.dot(O,Il(S,h,{regularize:!0})))),D=Un.dot(b,Un.sub(x,Un.dot(O,Il(S,x,{regularize:!0}))))}else T=Un.dot(b,h),D=Un.dot(b,x);let P=p,C=!1;for(;f<s&&!g&&!C;){f+=1;let S=Un.add(D,Un.diag(rb(d,u.length))),O=Un.neg(Un.solve(S,T,!0));P=rC(p,O,o),g=Un.all(Un.eq(P,p));let _;if(y){let w=Un.transpose(nb(a,P)),U=tb(w);_={Jv:w,F:U};let G=Qu(e,P),Z=Un.neg(Il(U,G,{regularize:!0}));P=rC(P,Z,i)}let L=pm(e,P);C=L<m,C?(p=P,m=L,y=_,d*=l):(d=Math.max(d,1e-64),d*=c)}}return{solution:p,MSE:m}}var iC=[18.9,.105,.0113,.089,4.414,.373,.06,.149,1.84,9.26,5,.7,.2,1.13,2.61,1,.007,30,120,1500,4e-4,7.23,-1,-.0081,-.03,-28.6,-1.71,-.4,-6.94,-.777,-500];function XU(e){let t=e*503%iC.length;return iC[t]}function ZU(e){let t=[];for(let n=0;n<iC.length;n++){let r=[];for(let s=0;s<e;s++)n===0&&e!==1?r[s]=0:n===1&&e!==1?r[s]=1:r[s]=XU(n*e+s);t.push(r)}return t}function B_(e,t,n,r,s){let i=[];for(let a of n)i.push({soln:sC(e,t,a,s),initialGuess:a});i.sort((a,u)=>isNaN(a.soln.MSE)?1:isNaN(u.soln.MSE)?-1:a.soln.MSE-u.soln.MSE);let o=[];for(let a=0;a<r;a++)o.push(i[a].initialGuess);return o}function WU(e,t,n,r){if(!t||Fs(t))return e;let s=t.bounds;return s[0]===-1/0&&s[1]===1/0?e:s[0]===-1/0?s[1]-Math.exp(-e):s[1]===1/0?s[0]+Math.exp(e):n/(r-1)*s[1]+(r-1-n)/(r-1)*s[0]}var G_=[3,5,7,11,13,17,19];function jU(e,t){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=[];for(let o=0;o<s.length;o++){let a=G_[o%G_.length]*r%e.length;i.push(WU(s[o],t[o],a,e.length))}n.push(i)}return n}function k_(e,t,n){n||(n={});let{linearSubset:r,bounds:s,preferredInitialGuess:i}=n,o=ZU(t.length);s&&(o=jU(o,s));let a=B_(e,t,o,5,{maxIterations:3,linearSubset:r}),u=B_(e,t,a,1,{maxIterations:60,linearSubset:r}),c=sC(e,t,u[0],{maxIterations:250,linearSubset:r});if(!i)return c;let l=sC(e,t,i,{maxIterations:100,linearSubset:r});return isFinite(l.MSE)&&(l.MSE<c.MSE||si(l.MSE,c.MSE,8))?l:c}function cC(e){return{chunk:e,isLazy:!0}}function H_(e){return e.slice()}function ib(e){if(!e.isLazy)return e;let t=e.chunk.copy();return t.reopenFinalBlock(),{chunk:t,forwardParameterMap:H_,reverseParameterMap:H_,isLazy:!1,valueMap:nq(e.chunk.instructionsLength()),replacementMask:ad(e.chunk.argNames.length)}}function z_(e){let{chunk:t,forwardParameterMap:n,reverseParameterMap:r,isLazy:s,valueMap:i,replacementMask:o,didShiftScale:a}=e;return{chunk:t.copy(),forwardParameterMap:n,reverseParameterMap:r,isLazy:s,valueMap:i.slice(),replacementMask:o.slice(),didShiftScale:a}}function JU(e){let t=1/0,n=-1/0,r=e.length;for(let s of e)t=Math.min(t,s),n=Math.max(n,s);return{min:t,max:n,length:r}}function $_(e){let t=e.getInstruction(e.getReturnIndex());if(t.type!==48)return;let n=t.args[0],r=e.getReturnIndex()-n,s=e.getInstruction(n);if(s.args.length!==2)return;let i=s.args[0],o=s.args[r],a=[],u=[];a.push(i),u.push({min:1,max:qo(e,e.getReturnIndex(),\"Programming error: cannot optimize regression on non-constant-length list\"),length:qo(e,e.getReturnIndex(),\"Programming error: cannot optimize regression on non-constant-length list\")});let c=!1,l=!1;for(let m=i+1;m<=o;m++){let h=e.getInstruction(m);if(h.type===39||h.type===41||h.type===40){if(h.args[1]!==i)continue;let b=h.args[0];if(e.getInstruction(b).valueType!==ne||!Je(e.getInstruction(b)))continue;let x=hn(e,b),T=JU(x);if(!isFinite(T.min)||!isFinite(T.max))continue;a.push(m),u.push(T)}else if(h.type===37)h.symbol===\"exp\"?l=!0:q_(h)&&(c=!0);else if(h.type===12||h.type===13)l=!0;else if(es(h)||ds(h))return}if(a.length===0||!l&&!c)return;let p=[];for(let m=0;m<=o;m++){let h=a.indexOf(m);if(h!==-1){let b=ad(a.length);b[h]=!0,p.push(b)}else p.push(sb(e,p,a.length,m))}let f=[];for(let m=0;m<=e.getReturnIndex();m++)if(e.getInstruction(m).type===2){let b=ad(e.argNames.length);b[m]=!0,f.push(b)}else f.push(sb(e,f,e.argNames.length,m));let d={listAccessDependencyTable:p,listAccesses:a,listStatisticsTable:u},y;for(let m=i+1;m<=e.getReturnIndex();m++){let h=e.getInstruction(m);switch(h.type){case 37:{if(h.symbol===\"exp\"){let Z=h.args[0],F=lC(d,Z);if(F===void 0){au(e,f,y,m);break}let{listStatistics:Y,listAccessIndex:re}=F,Ee=dm(cC(e),m,Z,re,Y);Ee?y=[Ee]:au(e,f,y,m)}break}case 12:case 13:{let[Z,F]=h.args,Y=lC(d,F);if(Y===void 0||U_(d,Z)){au(e,f,y,m);break}let{listStatistics:re,listAccessIndex:Ee}=Y,he=KU(cC(e),m,Ee,re);he?y=[he]:au(e,f,y,m);break}case 10:if(y&&y.length>1){au(e,f,y,m);break}let b=y&&y.length>0?y[0]:cC(e),[x,T]=h.args,D=b.isLazy?x:b.valueMap[x],P=b.isLazy?T:b.valueMap[T],C=b.chunk.getInstruction(D),S=b.chunk.getInstruction(P),O,_,L;if(C.type===37)O=x,L=C,_=T;else if(S.type===37)O=T,L=S,_=x;else{au(e,f,y,m);break}let w=lC(d,O);if(w===void 0||U_(d,_)){au(e,f,y,m);break}let{listAccessIndex:U,listStatistics:G}=w;if(L.symbol===\"exp\"){let Z=eq(b,m,_,O,U,G);if(Z){y=Z;break}}else if(q_(L)){let Z=QU(b,m,_,O,U);if(Z){y=[Z];break}}au(e,f,y,m);break;default:{au(e,f,y,m);break}}}if(y===void 0||y.length===0)return;let g=[];for(let m of y)g.push({chunk:m.chunk,forwardParameterMap:m.forwardParameterMap,reverseParameterMap:m.reverseParameterMap});return g}function au(e,t,n,r){if(n===void 0)return;let s=e.getInstruction(r);if(ge(s))for(let i of n)i.valueMap[r]=r;else for(let i of n){let{chunk:o,valueMap:a}=i,u=[],c=0;for(let l of s.args){if(a[l]!==l){if(c+=1,c>1){n.length=0;return}}else{let p=t[l];for(let f=0;f<p.length;f++)if(p[f]&&i.replacementMask[f]){n.length=0;return}}u.push(a[l])}a[r]=c>0?_n(o,s,u):r}}function lC(e,t){let{listAccessDependencyTable:n,listAccesses:r,listStatisticsTable:s}=e,i,o=n[t];for(let a=0;a<o.length;a++)if(o[a]){if(i)return;i={listAccessIndex:r[a],listStatistics:s[a]}}return i}function U_(e,t){let{listAccessDependencyTable:n}=e,r=n[t];for(let s of r)if(s)return!0;return!1}function pC(e,t){let n=[];for(let i=0;i<=t;i++)if(e.getInstruction(i).type===2){let a=ad(e.argNames.length);a[i]=!0,n.push(a)}else n.push(sb(e,n,e.argNames.length,i));let r,s=n[t];for(let i=0;i<s.length;i++)if(s[i]){if(r!==void 0)return;r=i}return r}function QU(e,t,n,r,s){let i=e.chunk,o=pC(i,n);if(o===void 0)return;let a=dC(e,n,o);if(a===void 0)return;let u=i.getInstruction(r),c=u.args[0];if(a=Y_(a,c,s),a===void 0)return;let{chunk:l,valueMap:p}=a,f=l.getInstruction(p[c]);if(f.type!==8)return;let d=f.args[1],y=l.getInstruction(f.args[0]);if(y.type!==10)return;let[g,m]=y.args,h=o,b=d,x=g,T=m,D=l.Multiply([x,T]),P=l.NativeFunction(\"cos\",[D]),C=l.NativeFunction(\"sin\",[D]),S=u.symbol===\"sin\"?l.Add([l.Multiply([h,C]),l.Multiply([b,P])]):l.Subtract([l.Multiply([h,P]),l.Multiply([b,C])]);p[t]=S;function O(w){let U=a.forwardParameterMap(w),G=U[o],Z=U[d],F=G*Math.cos(Z),Y=G*Math.sin(Z);return U[o]=F,U[d]=Y,U}function _(w){let U=w.slice(),G=w[o],Z=w[d],F=Ts(G,Z),Y=Math.atan2(Z,G);return U[o]=F,U[d]=Y,a.reverseParameterMap(U)}let L=a.replacementMask.slice();return L[o]=!0,L[g]=!0,L[d]=!0,{chunk:l,forwardParameterMap:O,reverseParameterMap:_,valueMap:p,replacementMask:L,isLazy:!1}}function KU(e,t,n,r){let s=e.chunk,i=s.getInstruction(t),[o,a]=i.args,u=s.getInstruction(o);if(u.type===1&&u.valueType===I&&V(u.value)>0){let b=ib(e),{chunk:x,valueMap:T}=b,D=x.Multiply([x.NativeFunction(\"ln\",[T[o]]),T[a]]);return T[a]=D,T[t]=x.NativeFunction(\"exp\",[D]),dm(b,t,a,n,r)||b}let c=pC(s,o);if(c===void 0)return;let l=dC(e,o,c);if(l===void 0)return;let{chunk:p,valueMap:f}=l,d=p.Multiply([f[o],f[a]]);f[a]=d,f[t]=p.NativeFunction(\"exp\",[d]);function y(b){let x=l.forwardParameterMap(b),T=x[c],D=Math.log(T);return x[c]=D,x}function g(b){let x=b.slice(),T=x[c],D=Math.exp(T);return x[c]=D,l.reverseParameterMap(x)}let m=l.replacementMask.slice();m[c]=!0;let h={chunk:p,forwardParameterMap:y,reverseParameterMap:g,isLazy:!1,valueMap:f,replacementMask:m};return dm(h,t,a,n,r)||h}function eq(e,t,n,r,s,i){if(!e.isLazy&&e.didShiftScale)return;let o=e.isLazy?e:z_(e),a=e.chunk,u=pC(a,n);if(u===void 0)return;let c=dC(e,n,u);if(c===void 0)return;let{chunk:l,valueMap:p}=c,f=l.getInstruction(p[r]).args[0],d=l.Add([f,p[n]]);p[n]=d,p[t]=l.NativeFunction(\"exp\",[d]);function y(P){let C=c.forwardParameterMap(P),S=C[u],O=Math.log(S);return C[u]=O,C}function g(P){let C=P.slice(),S=C[u],O=Math.exp(S);return C[u]=O,c.reverseParameterMap(C)}function m(P){let C=c.forwardParameterMap(P),S=C[u],O=Math.log(-S);return C[u]=O,C}function h(P){let C=P.slice(),S=C[u],O=-Math.exp(S);return C[u]=O,c.reverseParameterMap(C)}let b=c.replacementMask.slice();b[u]=!0;let x=ib(o);x.valueMap[t]=x.chunk.Multiply([x.valueMap[n],x.valueMap[r]]);let T={chunk:l,forwardParameterMap:y,reverseParameterMap:g,isLazy:!1,valueMap:p,replacementMask:b},D=z_(T);return D.forwardParameterMap=m,D.reverseParameterMap=h,T=dm(T,t,n,s,i)||T,D=dm(D,t,n,s,i)||D,D.valueMap[t]=D.chunk.Negative([D.valueMap[t]]),[x,T,D]}function dm(e,t,n,r,s){let i=tq(e,n,r,s);if(i!==void 0)return i.valueMap[t]=i.chunk.NativeFunction(\"exp\",[i.valueMap[n]]),i}function tq(e,t,n,r){let s=Y_(e,t,n);if(s===void 0)return;let{chunk:i,valueMap:o}=s,a=i.getInstruction(o[t]);if(a.type!==8)return;let u=a.args[1],c=i.getInstruction(a.args[0]);if(c.type!==10)return;let[l,p]=c.args,{min:f,max:d}=r,y=d-f,g=.5*(d+f),m=i.Divide([i.Subtract([p,i.Constant(g)]),i.Constant(y)]),h=i.Add([i.Multiply([l,m]),u]);o[t]=h;function b(T){let D=s.forwardParameterMap(T),P=D[l],C=D[u],S=P*y,O=C+g*P;return D[l]=S,D[u]=O,D}function x(T){let D=T.slice(),P=T[l],C=T[u],S=P/y,O=C-S*g;return D[l]=S,D[u]=O,s.reverseParameterMap(D)}return{chunk:i,forwardParameterMap:b,reverseParameterMap:x,isLazy:!1,valueMap:o,replacementMask:s.replacementMask,didShiftScale:!0}}function dC(e,t,n){let r=e.chunk,s=ns(r,n,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(s,t)!==1)return;let i=fo(s,t),[o,a]=Kn(i,t);if(a===void 0)return;let u=i.newChunk.getInstruction(o);if(u.type!==1||u.valueType!==I)return;let c=i.newChunk.getInstruction(a);if(c.type!==1||c.valueType!==I)return;let l=ib(e),{chunk:p,valueMap:f}=l,d=V(u.value),y=V(c.value);f[t]=n;function g(b){let x=l.forwardParameterMap(b),T=x[n],D=d+y*T;return x[n]=D,x}function m(b){let x=b.slice(),D=(x[n]-d)/y;return x[n]=D,l.reverseParameterMap(x)}let h=l.replacementMask.slice();return h[n]=!0,{chunk:p,forwardParameterMap:g,reverseParameterMap:m,isLazy:!1,valueMap:f,replacementMask:h}}function Y_(e,t,n){let r=e.chunk,s=e.isLazy?t:e.valueMap[t],i=ns(r,n,{allowRestriction:!1,allowClosedBlockReferences:!0});if(ln(i,s)!==1)return;e.isLazy&&(i=ns(r.copy().reopenFinalBlock(),n,{allowRestriction:!1,allowClosedBlockReferences:!1}));let o=fo(i,s),[a,u]=Kn(o,s);if(u===void 0)return;let c=o.newChunk,l=Math.max(u,a),p=[];for(let K=0;K<=l;K++)if(c.getInstruction(K).type===2){let te=ad(c.argNames.length);te[K]=!0,p.push(te)}else p.push(sb(c,p,c.argNames.length,K));let f,d;for(let K=0;K<r.argNames.length;K++)if(p[u][K])if(f===void 0)f=K;else return;else if(p[a][K])if(d===void 0)d=K;else return;if(f===void 0||d===void 0)return;let y=ns(c,f,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(y,u)!==1)return;let g=ns(c,d,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(g,a)!==1)return;let m=fo(y,u),h=fo(g,a),[b,x]=Kn(m,u),T=m.newChunk.getInstruction(b);if(T.type!==1||T.valueType!==I)return;let D=m.newChunk.getInstruction(x);if(D.type!==1||D.valueType!==I)return;let P=ib(e),{chunk:C,valueMap:S}=P,O=C.Add([C.Multiply([f,n]),d]);S[t]=O;let _=c.copy();_.List([u,a]);let L=_.getCompiledFunction().fn;function w(K){let Oe=P.forwardParameterMap(K),[te,Ze]=L.apply(null,Oe);return Oe[f]=te,Oe[d]=Ze,Oe}let U=V(T.value),G=V(D.value),[Z,F]=Kn(h,a),Y=h.newChunk.copy();Y.List([Z,F]);let re=Y.getCompiledFunction().fn;function Ee(K){let Oe=K.slice(),te=K[f],Ze=K[d],dt=(te-U)/G,me=K.slice();me[f]=dt,me.splice(d,1);let[J,W]=re.apply(null,me),Ge=(Ze-J)/W;return Oe[f]=dt,Oe[d]=Ge,P.reverseParameterMap(Oe)}let he=P.replacementMask.slice();return he[f]=!0,he[d]=!0,{chunk:C,forwardParameterMap:w,reverseParameterMap:Ee,isLazy:!1,valueMap:S,replacementMask:he}}function sb(e,t,n,r){let s=e.getInstruction(r),i=ad(n);if(ge(s))return i;for(let o of s.args){let a=t[o];for(let u=0;u<a.length;u++)i[u]=i[u]||a[u]}return i}function ad(e){let t=[];for(let n=0;n<e;n++)t.push(!1);return t}function nq(e){let t=[];for(let n=0;n<e;n++)t.push(n);return t}function q_(e){return e.type===37&&(e.symbol===\"sin\"||e.symbol===\"cos\")}function iL(e,t){try{return iq(e,t)}catch(n){return n instanceof M.Error?n:z(n)}}var ud={coerceToNumber:\"all-except-complex\"},fC={...ud,wrapInList:!0};function X_(e){return e===I||e===ne||e===R||e===Ue}function rq(e){return!!e.tableRegressionData}function sq(e,t){return e===$e||t===$e?!1:X_(e)&&X_(t)}function iq(e,t){let{policy:n,frame:r,exportFrame:s,lastExportFrame:i,tableStatements:o}=e,a=t._lhs.buildIRExpression(n,r,ud),u=t._rhs.buildIRExpression(n,r,ud);if(a.isError)throw a;if(u.isError)throw u;if(!sq(a.valueType,u.valueType))throw PT([oe(a.valueType),oe(u.valueType)]);let c=t._difference.buildIRExpression(n,r,fC);if(c.isError)throw c;let l=c.valueType;for(let S of c.getDependencies())if(!n.validRegressionParameter(S))throw tP(S);let f=!rq(t)?W_(c.getDependencies(),t.userData.regressionParameters,i):W_(c.getDependencies(),{},{}),{parameters:d,residuals:y,isLinear:g,parameterWarning:m,displayPrecision:h}=sL(f,c,a),b={policy:n,frame:r},x=Z_(b,t,d),T=is.NONE;l===ne&&(T=dq(t,a,x));let D;if(t.userData.isLogModeRegression&&(T===is.LOGLIN||T===is.LOGLOG)){let S=t._logDifference.buildIRExpression(n,r,fC);if(S.isError)throw S;let O=t._logLhs.buildIRExpression(n,r,fC);if(O.isError)throw O;({parameters:d,isLinear:g,parameterWarning:m,displayPrecision:h}=sL(f,S,a)),x=Z_(b,t,d),y=tL(b,t._difference,d);let _=tL(b,t._logDifference,d);D=K_(t,O,x,_,t.userData.isLogModeRegression,T,l)}else D=K_(t,a,x,y,t.userData.isLogModeRegression,T,l);let P=oq(t,s),C=pq(t,P,o,y);return t.userData.residualVariable=qr(P),new M.OptimizedRegression(d,lt(l,y),D,x.substituted,{isModelValid:!!x.uniqueRHSNumberList,residualVariable:P,residualSuggestionId:C,shouldSuggestLogMode:T!==is.NONE,isLinear:g,displayPrecision:h,parameterWarning:m})}function oq(e,t){if(e.userData&&e.userData.residualVariable){let i=no(e.userData.residualVariable);if(!t[i])return i}let n=e.getDependencies().filter(i=>i[0]!==\"_\"&&!i.startsWith(\"regressionparameter_\")&&!i.startsWith(\"idref_\")),r;for(let i of n){let o=i.match(/_(.*)/);if(o&&(r=\"e_\"+o[1],!t[r]))return r}let s=1;for(;;){if(r=\"e_\"+s,!t[r])return r;s++}}function Z_({policy:e,frame:t},n,r){let s=n._rhs.getDependencies(),i,o;for(let p of s){if(r.hasOwnProperty(p))continue;let f=t[p];if(!f||f.isFunction||(f.type===\"Assignment\"&&(f=f._expression),!f.buildIRExpression))continue;let d=f.buildIRExpression(e,t,ud);if(!d.isError&&kn(d.valueType,ne)){if(i!==void 0){i=void 0,o=void 0;break}d.getDependencies().length===0&&(i=p,o=d)}}let a=Tn(t);i!==void 0&&(a[i]=void 0);let u=n._rhs.buildIRExpression(e,a,ud),c=Tn(a);for(let p of We(r))c[p]=r[p];let l=n._rhs.buildIRExpression(e,c,ud);return{node:u,substituted:l,uniqueRHSNumberList:o}}function W_(e,t,n){let r=[];if(t||(t={}),n||(n={}),!e.every(s=>s in n||s in t))return e.map(s=>1);for(let s of e){let i=qr(s),o=n[s];o&&isFinite(o.asValue())?r.push(+o.asValue()):t.hasOwnProperty(i)&&isFinite(+t[i])?r.push(+t[i]):r.push(1)}return r}function yC(e,t){switch(t){case ne:return e;case Ue:return function(...r){let s=e.apply(void 0,r);return aq(s)};default:throw z(\"Regression with invalid value type.\")}}function j_(e,t){switch(t){case ne:return e;case Ue:return uq(e);default:throw z(\"Regression with invalid value type.\")}}function aq(e){let t=[];for(let[n,r]of e)t.push(n,r);return t}function uq(e){let t=[];for(let[n,r]of e)t.push(n,r);return t}function J_(e,t){let n=t.getDependencies(),r=t.getCompiledFunction(n).fn,s=t.valueType,i=yC(r,s);if(n.length){let o=t.findLinearSubset(n),a=o.every(c=>c),u=[];for(let c of n){let l=t.takeDerivative(c).getCompiledFunction(n).fn;u.push(yC(l,s))}if(a){let c=n.map(()=>Se(0,1)),l=t.interpretWithParameters(c),p=j_(l,s),f=[];for(let m of n){let h=t.takeDerivative(m).interpretWithParameters(c);f.push(j_(h,s))}let d=aC(p,f);if(d){let m=t.interpretWithParameters(d);return{solution:d,residuals:m,MSE:ob(m,s),isLinear:a}}let{solution:y,MSE:g}=oC(i,uC(i,u));return{solution:y,residuals:r.apply(void 0,y),MSE:nL(g,s),isLinear:a}}else{let c=[];for(let d of n)c.push(t.boundDomain(d));let l={linearSubset:o,bounds:c,preferredInitialGuess:e},{solution:p,MSE:f}=oC(i,k_(i,u,l));return{solution:p,residuals:r.apply(void 0,p),MSE:nL(f,s),isLinear:a}}}else return{solution:[],residuals:t.interpretWithParameters([]),MSE:oL(r,[],s),isLinear:!0}}function Q_(e,t){let n={},r=t.getDependencies();for(let s=0;s<r.length;s++){let i=new M.RegressionParameter(e[s]);n[r[s]]=i}return n}function K_(e,t,n,r,s,i,o){let a=ob(r,o);if(!isFinite(a))throw nP();if(t.getDependencies().length>0)return{RMSE:Math.sqrt(a)};let u=fq(t.asValue(),t.valueType);if(t.getDependencies().length||!isFinite(u)||u<=0||!e.isLhsSimple)return{RMSE:Math.sqrt(a)};{let c=1-a/u,l=cq(t,n,s,i,a);return l!==void 0?{r:l,rsquared:l*l}:{Rsquared:c}}}function eL(e){if(!e.isTypedConstant)return NaN;let t={valueType:e.valueType,value:e.asCompilerValue()},{value:n,valueType:r}=t;switch(r){case I:return n;case R:return V(n[1])===0?n[0]:NaN;default:return NaN}}function cq(e,t,n,r,s){if(!t.uniqueRHSNumberList)return;let i=[],o=[],a=n&&(r===is.LINLOG||r===is.LOGLOG);M.List.eachArgs([t.uniqueRHSNumberList,e],l=>{let p=eL(l[0]),f=eL(l[1]);i.push(a?Math.log(V(p)):p),o.push(f)});let u=Og(i.map(V),o.map(V));if(!isFinite(u))return;let c=lq(i,o);if(si(c.MSE,s,8))return u}function lq(e,t){let n=t,r=[e.map(a=>Us(a)),e.map(()=>Se(-1,1))],s=aC(n,r);if(s){let[a,u]=s,c=[];for(let l=0;l<t.length;l++)c.push(ai(t[l],qs(wr(a,e[l]),u)));return{solution:s,MSE:ob(c,ne)}}function i(a,u){let c=[];for(let l=0;l<e.length;l++)c.push(V(t[l])-(a*V(e[l])+u));return c}return uC(i,[function(){return e.map(a=>-V(a))},function(){return e.map(()=>-1)}])}function pq(e,t,n,r){var a,u;let s=e._rhs.getDependencies(),i;(a=e.tableRegressionData)!=null&&a.tableId&&(i=(u=e.tableRegressionData)==null?void 0:u.tableId);for(let c in n){let l=n[c];if(l.columns.length===0)continue;let p=l.columns[0];i===void 0&&ga(p)&&ki(p.header)&&s.includes(p.header._symbol)&&(i=c);for(let f=1;f<l.columns.length;f++)if(l.columns[f].getDependencies().includes(t))return}if(!r.some(c=>Array.isArray(c)&&V(c[1])!==0))return i}function mC(e,t){let n=e.length,r=e[0],s=t[0],i=e[n-1],o=t[n-1];if(!isFinite(r)||!isFinite(i)||!isFinite(s)||!isFinite(o)||o-s===0)return!1;let a=i-r;if(a===0)return!1;for(let u=1;u<n-1;u++){let c=e[u],l=t[u],p=(o*(c-r)+s*(i-c))/a;if(!si(l,p,5))return!1}return!0}var is={NONE:0,LOGLIN:1,LOGLOG:2,LINLOG:3};function dq(e,t,n){if(!e.isLhsSimple||!n.uniqueRHSNumberList||se(t.valueType,R))return is.NONE;let r=n.substituted;if(r.isError||r.valueType!==I)return is.NONE;let s=r.getDependencies();if(s.length!==1||isFinite(n.node.polynomialOrder(s[0])))return is.NONE;let i=r.getCompiledFunction(s).fn,o=n.uniqueRHSNumberList;if(r.valueType!==I)return is.NONE;let a=o.mapElements(f=>+f.asValue());if(a.length<3)return is.NONE;a.sort((f,d)=>f-d);let u=a.map(i),c=u.map(Math.log),l=a.map(Math.log),p=!0;return M.List.wrap(t).eachElement(f=>{isFinite(Math.log(+f.asValue()))||(p=!1)}),mC(a,c)&&p?is.LOGLIN:mC(l,c)&&p?is.LOGLOG:mC(l,u)?is.LINLOG:is.NONE}function tL({policy:e,frame:t},n,r){let s=Tn(t);for(let a of We(r))s[a]=r[a];let i=od({policy:e,frame:s,wrapInList:!0},n),o=i.getError();if(o)throw o;return i.asCompilerValue()}function ob(e,t){switch(t){case ne:{let n=0;for(let r of e){let s=V(r);n+=s*s}return n/e.length}case Ue:{let n=0;for(let[r,s]of e){let i=V(r);n+=i*i;let o=V(s);n+=o*o}return n/e.length}default:throw z(\"Regression with invalid value type.\")}}function fq(e,t){switch(t){case I:case R:return 0;case ne:return Df(e);case Ue:{let n=e,r=0,s=0;for(let[u,c]of n)r+=u,s+=c;let i=r/n.length,o=s/n.length,a=0;for(let[u,c]of n){let l=V(u)-i;a+=l*l;let p=V(c)-o;a+=p*p}return a/n.length}default:throw z(\"Regression with invalid value type.\")}}function oL(e,t,n){let r=e.apply(void 0,t);return ob(r,n)}function nL(e,t){switch(t){case ne:return e;case Ue:return e*Math.SQRT2;default:throw z(\"Regression with invalid value type.\")}}function rL(e,t,n,r){let s=5;if(!r)return s;let i=t.apply(void 0,e);for(let o=4;o<15;o++){let a=e.map(l=>parseFloat(l.toPrecision(o))),u=t.apply(void 0,a),c=0;for(let l=0;l<i.length;l++){let p=Math.abs(i[l]-u[l]);p>c&&(c=p)}if(c<n){s=o;break}}return s}function mq(e){let t=0;if(j(e==null?void 0:e.valueType)){let n=e.asValue(),r=Sg(n),s=Dg(n);t=(s<0&&0<r?r-s:Math.max(Math.abs(s),Math.abs(r)))/500}return t}function sL(e,t,n){let r,s,i=t._chunk;i&&(s=$_(i));let o=j(n==null?void 0:n.valueType),a=mq(n);if(!s||s.length===0){t=t.deriveRegressionRestrictions(),r=J_(e,t);let T=t.getCompiledFunction(t.getDependencies()).fn,D=rL(r.solution.map(P=>V(P)),T,a,o);return{parameters:Q_(r.solution,t),displayPrecision:D,residuals:r.residuals,isLinear:r.isLinear,parameterWarning:!1}}let u=t.getDependencies(),c=t.valueType,l=t.getCompiledFunction(u).fn,p=yC(l,c),f=1/0,d={},y,g=!1,m=1/0,h=5;for(let T of s){let D=new on(T.chunk);if(D=D.deriveRegressionRestrictions(),r=J_(T.forwardParameterMap(e),D),r.MSE<f){let P=T.reverseParameterMap(r.solution.map(S=>V(S))),C=oL(l,P,c);if(d&&(!isFinite(C)||C>=f)){isFinite(C)||(g=!0,r.MSE<m&&(m=r.MSE));continue}f=r.MSE,d=Q_(P,t),y=p.apply(void 0,P),h=rL(P,p,a,o)}}let b=Object.keys(d).length,x=o?n.asValue().length:1;return{parameters:d,displayPrecision:h,residuals:y,isLinear:!1,parameterWarning:g&&m<f&&x>b}}var Si={pointsOfInterest:!0,plotSingleVariableImplicitEquations:!0,plotImplicits:!0,plotInequalities:!0,sliders:!0};function aL(e,t){let{mappedArgIndex:n,mappedReturnIndex:r,solutionIndex:s}=t,i=[],o=Vu(e,n),a=gq(e,o,r),u=s,c=e.NanOfType(e.getReturnType());for(let l=0;l<=r;l++){let p=e.getInstruction(l);if(l===n){i.push(s);continue}if(!o[l]&&!e.isInClosedBlock(l)){i.push(l);continue}if(ge(p))i.push(e.copyInstruction(p));else{let f=yq(i,p.args);i.push(e.copyInstructionWithArgs(p,f)),p.type===33&&a[l]&&(u=e.Piecewise([f[0],u,c]))}}return u}function yq(e,t){let n=[];for(let r of t)n.push(e[r]);return n}function gq(e,t,n){let r=[];for(let s=0;s<n;s++)r.push(!1);r[n]=t[n];for(let s=n;s>=0;s--){if(!r[s]||!t[s])continue;let i=e.getInstruction(s);if(i.type===33)r[i.args[1]]=!0;else if(!ge(i))for(let o of i.args)r[o]=!0}return r}function uL(e,t){try{return hq(e,t)}catch(n){return n instanceof M.Base?n:z(n)}}function gC(e,t){try{let n=new on(t),r=xl({},n),s=[];for(let o=0;o<r.length;o++)s.push(I);let i=jh({policy:e,frame:{},argNames:r,argTypes:s,selection:void 0,locals:[]});return i.chunk=t,t.fuseBroadcast(),cL({policy:e,ctx:i,isInequality:!1,allowSolvingIn3D:!0},t)}catch(n){return n instanceof M.Base?n:z(n)}}function ab(e,t){let n=e.getInstruction(t);if(n.type!==1)return!1;switch(n.valueType){case R:return Number.isNaN(n.value[0]);case I:return Number.isNaN(n.value);default:throw z(\"Unexpected type in isConstantNaN: \"+at(n.valueType))}}function hq({policy:e,frame:t},n){let r=!1,s=[];if(n instanceof ku){let b=n._lhs,x=b._symbol;if(!t[x]&&!e.assignmentForbidden(x)&&(r=!0,s=b._dependencies,b.args.length>1)){let D=n._dependencies.filter(C=>!s.includes(C)),P=rn([x]).setDependencies(D);throw P.silent=!0,P}}let i=n.asComparator(),o=xl(t,i),a=[];for(let b=0;b<o.length;b++)a.push(I);let u=jh({policy:e,frame:t,argNames:o,argTypes:a,selection:void 0,locals:[]}),{chunk:c}=u,l=i.getOperator(),p=l!==\"=\",f=Fe(u,i.args[0]),d=zi(c,f,{peelableCoerce:!0});if(d!==f&&!ab(c,f)&&ab(c,d))throw Ny(l);let y=Fe(u,i.args[1]),g=zi(c,y,{peelableCoerce:!0});if(g!==y&&!ab(c,y)&&ab(c,g))throw Ny(l);try{Uo(c,e,i,[d,g])}catch(b){throw b instanceof v&&r&&(b.silent=!0),b}switch(l){case\"<\":c.Less([d,g]);break;case\">\":c.Greater([d,g]);break;case\"<=\":c.LessEqual([d,g]);break;case\">=\":c.GreaterEqual([d,g]);break;case\"=\":c.Equal([d,g]);break}if(c.fuseBroadcast(),c.isConstant())return new on(c);let h=c.getInstruction(d).type!==2||xl(t,i.args[1]).indexOf(c.argNames[d])!==-1;if(!Si.plotImplicits&&h)throw ZI();return Jr[l].direction===-1?c.Subtract([g,d]):c.Subtract([d,g]),c.fuseBroadcast(),cL({policy:e,ctx:u,isInequality:p,allowSolvingIn3D:!1,maybeBaseCase:r,callParameters:s},c)}function cL({policy:e,ctx:t,isInequality:n,allowSolvingIn3D:r,maybeBaseCase:s,callParameters:i},o){let a=o.getLiveArgNames();if(a.length===0)throw z(`Unexpected: non-constant node with dependencies: ${a}`);if(a.length===1&&!n&&!Si.plotSingleVariableImplicitEquations)return XI();let u=g=>g===\"x\"||g===\"y\"||g===\"z\";if(e.is3dPolicy()?!a.every(u):a.length>2){let g=e.sliderVariables(a);if(s){let m=i?a.filter(b=>!i.includes(b)):a,h=rn(g).setDependencies(m);return h.silent=!0,h}else return rn(g).setDependencies(a)}if(n&&!e.validInequalityVariables(a))return $I().setDependencies(a);let{localFrames:c,effectiveOrder:l,variableOfInterest:p}=bq(t,n);if(e.complicatedPolarImplicit(p,l))return WI().setDependencies(a);if(!e.validImplicitVariables(a)){let g=Ac();return s&&(g.silent=!0),g}if(e.is3dPolicy()&&r&&l!==1)return ca();if(l>2||e.is3dPolicy()&&!r)return new on(o);let f=[],d=[],y=1;for(let g=0;g<c.length;g++){let m=c[g],h=xq(m,n);y=h.length;for(let x of h){let T=m.chunk.copy();if(T.setReturnIndex(x),m.isRestrictedPolynomial){let{mappedArgIndex:D,mappedReturnIndex:P}=m;T.setReturnIndex(aL(T,{mappedArgIndex:D,mappedReturnIndex:P,solutionIndex:T.getReturnIndex()}))}T.fuseBroadcast(),f.push(new on(T))}let b=!1;for(let x of m.coefficients){let T=m.chunk.getInstruction(x);T.type===1&&T.value!==0&&(b=!0)}if(o.argNames.length!==2||b)d.push(void 0);else{let x=m.chunk.copy(),T=m.coefficients.slice();x.List(T);let D=j(o.getReturnType())?o.elementAt(g):o.copy(),C=D.argNames.indexOf(p)===0?1:0,S=D.getReturnIndex();D.Add([C,D.Multiply([D.Constant(0),S])]),d.push({coefficients:x,restriction:D})}}return new M.SolvedEquation(p,new M.List(f),d,y)}function bq(e,t){let n=e.chunk,r=e.policy,s=n.argNames,i=j(n.getReturnType()),o=[];e:for(let a=0;a<s.length;a++){let u=s[a],c=s.length>1&&!r.validSolvedVariable(u);o[a]={localFrames:[],effectiveOrder:0,variableOfInterest:u};let l=!t;if(c){o[a].effectiveOrder=1/0;continue}let p=i?n.getConstantListLength():1;if(p==null)throw new Error(\"Programming error: cannot solve a variable-length list expression\");for(let f=0;f<p;f++){let d=i?n.elementAt(f):n;if(d.polynomialOrder(u,{allowRestriction:l,allowClosedBlockReferences:!1})>2){o[a].effectiveOrder=1/0;continue e}let g=d.getPolynomialCoefficients(u);o[a].localFrames.push(g),o[a].effectiveOrder=Math.max(o[a].effectiveOrder,g.coefficients.length-1)}}if(s.length===1)return o[0];if(s.length===2&&!s.includes(\"z\"))return s[0]===\"y\"&&(o=[o[1],o[0]]),o[0].effectiveOrder===0?o[1]:o[1].effectiveOrder===0?o[0]:o[o[0].effectiveOrder<o[1].effectiveOrder?0:1];{let a=o.filter(c=>c.effectiveOrder===1);if(a.length>0)return a[0];let u=o.filter(c=>c.effectiveOrder===2);return u.length>0?u[0]:o[0]}}function xq(e,t){return t?Iq(e):Tq(e)}function Tq({chunk:e,coefficients:t}){let[n,r,s]=t,i=e.Constant(Se(0,1)),o=e.Constant(NaN);if(s===void 0){r===void 0&&(r=i);let a=e.Negative([e.Divide([n,r])]),u=e.Equal([r,i]);return[e.Piecewise([u,o,a])]}else{let a=e.Constant(Se(2,1)),u=e.Multiply([a,s]),c=e.Negative([e.Divide([r,u])]),l=e.Divide([n,s]),p=e.Subtract([e.Multiply([c,c]),l]),f=e.Equal([s,i]),d=e.Equal([p,i]),y=e.getInstruction(p);if(y.type===1&&V(y.value)===0)return[e.Piecewise([f,o,c])];{let g=e.NativeFunction(\"sqrt\",[p]),m=e.Greater([r,i]),h=e.Less([r,i]),b=e.Greater([c,i]),x=e.Piecewise([b,e.Add([c,g]),e.Subtract([c,g])]),T=e.Piecewise([d,x,e.Divide([l,x])]),D=e.Negative([e.Divide([n,r])]);return[e.Piecewise([f,e.Piecewise([h,D,o]),x]),e.Piecewise([f,e.Piecewise([m,D,o]),T])]}}}function Iq({chunk:e,coefficients:t}){let[n,r,s]=t,i=e.Constant(Se(0,1));s===void 0&&(s=i),r===void 0&&(r=i),n===void 0&&(n=i);let o=e.Constant(Se(2,1)),a=e.Constant(NaN),u=e.Constant(Se(1e305,1)),c=e.Negative([u]),l=e.Multiply([o,s]),p=e.Negative([e.Divide([r,l])]),f=e.Divide([n,s]),d=e.Subtract([e.Multiply([p,p]),f]),y=e.NativeFunction(\"sqrt\",[d]),g=e.Negative([e.Divide([n,r])]),m=e.Equal([s,i]),h=e.Equal([d,i]),b=e.Greater([s,i]),x=e.Equal([r,i]),T=e.Greater([r,i]),D=e.Less([r,i]),P=e.Greater([p,i]),C=e.Greater([n,i]),S=e.Less([d,i]),O=e.Piecewise([P,e.Add([p,y]),e.Subtract([p,y])]),_=e.Piecewise([h,O,e.Divide([f,O])]),L=e.Piecewise([P,_,O]),w=e.Piecewise([P,O,_]);return[e.Piecewise([m,e.Piecewise([D,g,a]),e.Piecewise([b,L,a])]),e.Piecewise([m,e.Piecewise([x,e.Piecewise([C,c,a]),a]),e.Piecewise([b,e.Piecewise([S,c,a]),L])]),e.Piecewise([m,e.Piecewise([x,e.Piecewise([C,u,a]),a]),e.Piecewise([b,e.Piecewise([S,u,a]),w])]),e.Piecewise([m,e.Piecewise([T,g,a]),e.Piecewise([b,w,a])])]}function va(e){return e>=100}function lL(e,t){switch(e){case 106:return 200;case 107:return 201;case 108:return 202;case 103:return 214;case 130:return 215;case 112:return 209;case 113:return 210;case 110:switch(t){case\"z\":return 206;case\"theta\":return 205;case\"x\":case\"y\":case\"r\":case\"_implicit\":return 211;default:return 10}case 109:switch(t){case\"r\":return 203;case\"theta\":return 204;case\"x\":case\"y\":case\"z\":case\"_implicit\":return 213;default:return 10}case 111:switch(t){case\"theta\":return 207;case\"phi\":return 208;case\"x\":case\"y\":case\"z\":case\"rho\":case\"_implicit\":return 212;default:return 10}default:return 10}}function hC(e){switch(e){case 123:case 122:case 121:case 120:case 124:case 126:case 127:return!0;default:return!1}}function uu(e){return e===26||e===4}function Hre(e){return uu(e)||e===3||e===25}function pL(e){let t=[];for(let r=0;r<e.instructionsLength();r++)t.push(!1);let n=[];t[e.getReturnIndex()]=!0;for(let r=e.instructionsLength()-1;r>=0;r--){if(!t[r])continue;let s=e.getInstruction(r);if(s.type===2&&n.push(e.argNames[r]),ge(s))continue;let i=Yu(e,s)?[s.args[1]]:s.args;for(let o of i)t[o]=!0}return n}var Pq=e=>{let t=[],n=[],r=e.length;for(let s=0;s<r;s++)t.push(e[s][0]),n.push(e[s][1]);return{defined:{x:t,y:n}}},go=Pq;var{sin:Eq,cos:Mq}=Math,st=class e{constructor(t=0,n=0,r=0){this.x=t;this.y=n;this.z=r}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}set(t,n,r){return this.x=t,this.y=n,this.z=r,this}clone(){return new e(this.x,this.y,this.z)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}isZero(){return this.x===0&&this.y===0&&this.z===0}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}multiply(t){return this.x*=t,this.y*=t,this.z*=t,this}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return this.multiply(1/this.magnitude()),this}cross(t){return this.crossVectors(this,t)}crossVectors(t,n){let r=t.x,s=t.y,i=t.z,o=n.x,a=n.y,u=n.z;return this.x=s*u-i*a,this.y=i*o-r*u,this.z=r*a-s*o,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateAroundAxis(t,n){let r=Cq(t,n);return new e(r[0]*this.x+r[1]*this.y+r[2]*this.z,r[3]*this.x+r[4]*this.y+r[5]*this.z,r[6]*this.x+r[7]*this.y+r[8]*this.z)}};function Cq(e,t){let n=e.x,r=e.y,s=e.z,i=Eq(t),o=Mq(t),a=1-o;return[a*n*n+o,a*n*r+i*s,a*n*s-i*r,a*r*n-i*s,a*r*r+o,a*r*s+i*n,a*s*n+i*r,a*s*r-i*n,a*s*s+o]}function cd(e,t,n,r,s,i,o){let[a,u,c]=[new st,new st,new st],[l,p,f]=[new st,new st,new st],[d,y]=[new st,new st];for(let g=0;g<e.length/3;g++){let m=e[3*g],h=e[3*g+1],b=e[3*g+2];a.set(t[3*m],t[3*m+1],t[3*m+2]),u.set(t[3*h],t[3*h+1],t[3*h+2]),c.set(t[3*b],t[3*b+1],t[3*b+2]),l.set(n[3*m],n[3*m+1],n[3*m+2]),p.set(n[3*h],n[3*h+1],n[3*h+2]),f.set(n[3*b],n[3*b+1],n[3*b+2]),d.subVectors(c,a),y.subVectors(a,u);let x=d.cross(y).normalize();if(!(l.dot(x)>o&&p.dot(x)>o&&f.dot(x)>o)||l.dot(p)<0||l.dot(f)<0||p.dot(f)<0){let D=t.length/3;e[3*g]=D,e[3*g+1]=D+1,e[3*g+2]=D+2,t.push(a.x,a.y,a.z),t.push(u.x,u.y,u.z),t.push(c.x,c.y,c.z),n.push(x.x,x.y,x.z),n.push(x.x,x.y,x.z),n.push(x.x,x.y,x.z),r.push(r[2*m],r[2*m+1]),r.push(r[2*h],r[2*h+1]),r.push(r[2*b],r[2*b+1]);let P=s;if(s>0){for(let C=0;C<P;C++)i.push(i[P*m+C]);for(let C=0;C<P;C++)i.push(i[P*h+C]);for(let C=0;C<P;C++)i.push(i[P*b+C])}}}}function cb(e){let{triangles:t,normalDirHints:n}=e.triangulate(),{extraAttrCount:r}=e,s=e.getVertexCount(),i=new Array(s),o=new Array(s*3),a=[],u=!1,c=new Array(s*3),l=new Array(s*2),p=new Array(s*r),f=[],d=0;function y(m){let h=e.getVertex(m);if(!h)return null;let b=n[m],x=b?e.hintedNormal(m,b):e.getNormal(m);x?(c[3*d]=x[0],c[3*d+1]=x[1],c[3*d+2]=x[2]):(a[d]=!0,u=!0,c[3*d]=0,c[3*d+1]=0,c[3*d+2]=0),o[3*d]=h[0],o[3*d+1]=h[1],o[3*d+2]=h[2];let T=e.getUV(m);if(l[2*d]=T[0],l[2*d+1]=T[1],r>0)for(let D=0;D<r;D++)p[r*d+D]=e.getExtraAttr(m,D);return d++}function g(m){let h=i[m];return h===void 0?i[m]=y(m):h}for(let m=0;m<t.length;m+=3){let h=t[m],b=t[m+1],x=t[m+2],T=g(h),D=g(b),P=g(x);if(T===null||D===null||P===null)continue;f.push(T,D,P);let C=a[T],S=a[D],O=a[P];if(C||S||O){let _=o,L=c,w=new st(_[3*T],_[3*T+1],_[3*T+2]),U=new st(_[3*D],_[3*D+1],_[3*D+2]),G=new st(_[3*P],_[3*P+1],_[3*P+2]),Z=new st().subVectors(G,w),F=new st().subVectors(w,U),Y=Z.cross(F);if(!Y.isFinite())continue;C&&(L[3*T+0]+=Y.x,L[3*T+1]+=Y.y,L[3*T+2]+=Y.z),S&&(L[3*D+0]+=Y.x,L[3*D+1]+=Y.y,L[3*D+2]+=Y.z),O&&(L[3*P+0]+=Y.x,L[3*P+1]+=Y.y,L[3*P+2]+=Y.z)}}if(o.length=d*3,c.length=d*3,l.length=d*2,u)for(let m=0;m<d;m++){if(!a[m])continue;let h=c[3*m],b=c[3*m+1],x=c[3*m+2],T=Math.sqrt(h*h+b*b+x*x);c[3*m]=h/T,c[3*m+1]=b/T,c[3*m+2]=x/T}return cd(f,o,c,l,r,p,0),{positions:o,normals:c,faces:f,uvs:l,resolved:!0,extraAttrs:p}}var TC=class{constructor({resolution:t,uRange:n,vRange:r,du:s,dv:i,extraAttrCount:o}){this.normalDirHints=[];this.isVertexAtCreaseCache=[];this.triangles=[];this.edgeVertices=new Map;this.edgeNormalVertices=new Map;this.finiteVertices=new Map;this.resolution=t,this.uRange=n,this.vRange=r,this.du=s,this.dv=i,this.extraAttrCount=o,this.duSquared=s*s,this.dvSquared=i*i}addVertex(t){return this.normalDirHints.push(void 0),this.isVertexAtCreaseCache.push(void 0),this._addVertex(t)}jumpAlongEdge(t,n){let r=0;if(t>n){let u=t;t=n,n=u,r=1}let s=n*n+t,i=this.edgeVertices.get(s);if(i===null)return;if(i!==void 0)return[i[r],i[1-r]];let o=this.findJumpBetweenTwoSamples(t,n);if(o===void 0){this.edgeVertices.set(s,null);return}let a=[this.addVertex(o[0]),this.addVertex(o[1])];return this.edgeVertices.set(s,a),[a[r],a[1-r]]}edgeNormalFeature(t,n){let r=0;if(t>n){let u=t;t=n,n=u,r=1}let s=n*n+t,i=this.edgeNormalVertices.get(s);if(i!==void 0)return this.flipEdgeNormalFeature(i,r);let o=this.findCreaseBetweenTwoSamples(t,n),a=o===null?null:o.type===\"high-curvature\"?{type:\"high-curvature\",pos:this.addVertex(o.pos)}:{type:\"crease\",left:this.addVertex(o.left),right:this.addVertex(o.right)};return this.edgeNormalVertices.set(s,a),this.flipEdgeNormalFeature(a,r)}flipEdgeNormalFeature(t,n){return(t==null?void 0:t.type)===\"crease\"?{type:\"crease\",left:n===0?t.left:t.right,right:n===0?t.right:t.left}:t}findCreaseBetweenTwoSamples(t,n){let i=this.getUV(t),o=this.getUV(n),a=this.getNormal(t),u=this.getNormal(n),c=b=>{var T;let x=ar(i,o,b);return(T=this.fn(x).normal)!=null?T:[NaN,NaN,NaN]};if(!a||!u)return null;let l=o[0]-i[0],p=o[1]-i[1],f=this.du,d=this.dv,y=(Math.abs(f*l)+Math.abs(d*p))/(l*l+p*p),g=Wy(0,a,1,u,c,.01,2*y,.9);if(g===void 0)return null;if(typeof g==\"number\")return g<y||g>1-y?null:{type:\"high-curvature\",pos:this.fn(ar(i,o,g))};let m=g[0],h=g[1];return m<y||h>1-y?null:(m-=y,h+=y,m<=1e-8&&(m=1e-8),h>=1-1e-8&&(h=1-1e-8),{type:\"crease\",left:this.fn(ar(i,o,m)),right:this.fn(ar(i,o,h))})}isVertexAtCrease(t){let n=this.isVertexAtCreaseCache[t];if(n!==void 0)return n;let r=this._isVertexAtCrease(t);return this.isVertexAtCreaseCache[t]=r,r}finiteAlongEdge(t,n){if(t>n){let a=t;t=n,n=a}let r=n*n+t,s=this.finiteVertices.get(r);if(s!==void 0)return s;let i=this.findFiniteBetweenTwoSamples(t,n);if(i===void 0)return;let o=this.addVertex(i);return this.finiteVertices.set(r,o),o}pushTriangle(t,n,r){this.isDegenerate(t,n,r)||this.triangles.push(t,n,r)}getTriangles(){return this.triangles}},Dq=1e-4,Sq=.99,pd=.9999;function bC(e,t){return!e||!t?!0:e[0]*t[0]+e[1]*t[1]+e[2]*t[2]<Sq}var IC=class extends TC{hintVec(t,n){let r=this.getUV(t),s=this.getUV(n);return zD(HD(s,r),Dq)}hintNormal1(t,n,r){let s=this.hintVec(t,n),i=this.hintVec(t,r);this.normalDirHints[t]=[s,i]}hintNormals2(t,n){let r=this.hintVec(t,n),s=xC(r);this.normalDirHints[t]=[ub(r),s],this.normalDirHints[n]=[s,ub(s)]}hintNormals2Finite(t,n){let r=this.hintVec(t,n),s=ub(r);this.normalDirHints[t]=this.normalDirHints[n]=[s,xC(s)]}hintNormalFirstBad(t,n){let r=this.hintVec(t,n);this.normalDirHints[t]=[ub(r),xC(r)]}hintNormalSecondBad(t,n){let r=this.hintVec(n,t);this.normalDirHints[n]=[Oq(r),vq(r)]}},PC=class extends IC{oneJump(t,n,r,s){let i=s[0],o=s[1];this.pushTriangle(i,r,t),this.pushTriangle(o,n,r),this.hintNormalFirstBad(i,r),this.hintNormalSecondBad(r,o)}oneJumpOneExtra(t,n,r,s,i){let o=s[0],a=s[1];this.pushTriangle(o,r,t),this.pushTriangle(o,i,r),this.pushTriangle(a,n,i),this.hintNormalFirstBad(o,r),this.hintNormalSecondBad(r,a)}oneJumpOneExtra2(t,n,r,s,i){let o=s[0],a=s[1];this.pushTriangle(a,n,r),this.pushTriangle(a,r,i),this.pushTriangle(o,i,t),this.hintNormalFirstBad(o,r),this.hintNormalSecondBad(r,a)}oneJumpTwoExtra(t,n,r,s,i,o){let a=s[0],u=s[1];this.pushTriangle(a,o,t),this.pushTriangle(a,i,o),this.pushTriangle(i,r,o),this.pushTriangle(u,n,i)}twoJumps(t,n,r,s,i){let o=s[0],a=s[1],u=i[0],c=i[1];this.pushTriangle(o,r,t),this.pushTriangle(o,c,r),this.pushTriangle(a,n,u),this.hintNormals2(o,c),this.hintNormals2(u,a)}twoJumpsOneExtraPoint(t,n,r,s,i,o){let a=s[0],u=s[1],c=i[0],l=i[1];this.pushTriangle(a,o,t),this.pushTriangle(a,l,o),this.pushTriangle(l,r,o),this.pushTriangle(u,n,c),this.hintNormals2(a,l),this.hintNormals2(c,u)}oneExtraPoint(t,n,r,s){this.pushTriangle(s,r,t),this.pushTriangle(s,n,r)}oneExtraPointOneVertexCrease(t,n,r,s){let i=this.copyVertex(r);this.pushTriangle(s,i,t),this.pushTriangle(s,n,i),this.hintNormal1(i,t,n)}twoExtraPoints(t,n,r,s,i){this.pushTriangle(s,r,t),this.pushTriangle(s,i,r),this.pushTriangle(s,n,i)}threeExtraPoints(t,n,r,s,i,o){this.pushTriangle(s,o,t),this.pushTriangle(s,i,o),this.pushTriangle(s,n,i),this.pushTriangle(i,r,o)}oneEdgeJumpOneVertexCrease(t,n,r,s){let i=s[0],o=s[1],a=this.copyVertex(r),u=this.copyVertex(r);this.pushTriangle(i,a,t),this.pushTriangle(o,n,u),this.hintNormals2(u,o),this.hintNormals2(i,a)}threeVertexCrease(t,n,r){let s=this.copyVertex(t),i=this.copyVertex(n),o=this.copyVertex(r);this.pushTriangle(s,i,o),this.hintNormals2(s,i),this.hintNormalFirstBad(o,s)}twoVertexCrease(t,n,r){let s=this.copyVertex(t),i=this.copyVertex(n);this.pushTriangle(s,i,r),this.hintNormals2(s,i)}oneVertexCrease(t,n,r){let s=this.copyVertex(t);this.pushTriangle(s,n,r),this.hintNormal1(s,n,r)}pushTrianglesBasedOnJumps(t,n,r){let s=this.jumpAlongEdge(t,n),i=this.jumpAlongEdge(n,r),o=this.jumpAlongEdge(r,t);if(s&&i&&o){let m=this.getUV(t),h=this.getUV(n),b=this.getUV(r),x=this.addVertex(this.fn(ar(m,ar(h,b,.5),1e-4))),T=this.addVertex(this.fn(ar(h,ar(b,m,.5),1e-4))),D=this.addVertex(this.fn(ar(b,ar(m,h,.5),1e-4))),P=this.jumpAlongEdge(x,T),C=this.jumpAlongEdge(T,D),S=this.jumpAlongEdge(D,x);if(P&&C&&S)return;t=x,n=T,r=D,s=P,i=C,o=S}let a=this.getNormal(t),u=this.getNormal(n),c=this.getNormal(r),l=this.isVertexAtCrease(t),p=this.isVertexAtCrease(n),f=this.isVertexAtCrease(r),d,y,g;if(!l&&!p&&!s&&bC(a,u)){let m=this.edgeNormalFeature(t,n);m!==null&&(m.type===\"high-curvature\"?d=m.pos:s=[m.left,m.right])}if(!p&&!f&&!i&&bC(u,c)){let m=this.edgeNormalFeature(n,r);m!==null&&(m.type===\"high-curvature\"?y=m.pos:i=[m.left,m.right])}if(!f&&!l&&!o&&bC(c,a)){let m=this.edgeNormalFeature(r,t);m!==null&&(m.type===\"high-curvature\"?g=m.pos:o=[m.left,m.right])}s&&i?g?this.twoJumpsOneExtraPoint(t,n,r,s,i,g):this.twoJumps(t,n,r,s,i):i&&o?d?this.twoJumpsOneExtraPoint(n,r,t,i,o,d):this.twoJumps(n,r,t,i,o):o&&s?y?this.twoJumpsOneExtraPoint(r,t,n,o,s,y):this.twoJumps(r,t,n,o,s):s?f?this.oneEdgeJumpOneVertexCrease(t,n,r,s):y&&g?this.oneJumpTwoExtra(t,n,r,s,y,g):y?this.oneJumpOneExtra(t,n,r,s,y):g?this.oneJumpOneExtra2(t,n,r,s,g):this.oneJump(t,n,r,s):i?l?this.oneEdgeJumpOneVertexCrease(n,r,t,i):g&&d?this.oneJumpTwoExtra(n,r,t,i,g,d):g?this.oneJumpOneExtra(n,r,t,i,g):d?this.oneJumpOneExtra2(n,r,t,i,d):this.oneJump(n,r,t,i):o?p?this.oneEdgeJumpOneVertexCrease(r,t,n,o):d&&y?this.oneJumpTwoExtra(r,t,n,o,d,y):d?this.oneJumpOneExtra(r,t,n,o,d):y?this.oneJumpOneExtra2(r,t,n,o,y):this.oneJump(r,t,n,o):l&&p&&f?this.threeVertexCrease(t,n,r):l&&p?this.twoVertexCrease(t,n,r):p&&f?this.twoVertexCrease(n,r,t):f&&l?this.twoVertexCrease(r,t,n):l?y?this.oneExtraPointOneVertexCrease(n,r,t,y):this.oneVertexCrease(t,n,r):p?g?this.oneExtraPointOneVertexCrease(r,t,n,g):this.oneVertexCrease(n,r,t):f?d?this.oneExtraPointOneVertexCrease(t,n,r,d):this.oneVertexCrease(r,t,n):d&&y&&g?this.threeExtraPoints(t,n,r,d,y,g):d&&y?this.twoExtraPoints(t,n,r,d,y):y&&g?this.twoExtraPoints(n,r,t,y,g):g&&d?this.twoExtraPoints(r,t,n,g,d):d?this.oneExtraPoint(t,n,r,d):y?this.oneExtraPoint(n,r,t,y):g?this.oneExtraPoint(r,t,n,g):this.pushTriangle(t,n,r)}oneNonFinite(t,n,r){let s=this.finiteAlongEdge(n,r),i=this.finiteAlongEdge(t,r);i!==void 0&&s!==void 0&&(this.pushTrianglesBasedOnJumps(s,t,n),this.pushTrianglesBasedOnJumps(s,i,t),this.hintNormals2Finite(s,i))}twoNonFinite(t,n,r){let s=this.finiteAlongEdge(t,n),i=this.finiteAlongEdge(t,r);s!==void 0&&i!==void 0&&(this.pushTrianglesBasedOnJumps(t,s,i),this.hintNormals2Finite(s,i))}pushTriangles(t,n,r){let s=this.allowVertex(t),i=this.allowVertex(n),o=this.allowVertex(r);s&&i&&o?this.pushTrianglesBasedOnJumps(t,n,r):s&&i?this.oneNonFinite(t,n,r):i&&o?this.oneNonFinite(n,r,t):o&&s?this.oneNonFinite(r,t,n):s?this.twoNonFinite(t,n,r):i?this.twoNonFinite(n,r,t):o&&this.twoNonFinite(r,t,n)}},ld=class extends PC{triangulate(){let t=this.resolution,{uRange:n,vRange:r,fn:s}=this,i=[n.min,r.min],o=[n.max,r.max],a=t-1,u=new Array(t*t);u[0]=this.addVertex(s(i));for(let c=1;c<=a;c++)u[c]=this.addVertex(s(Xy(i,o,[c/a,0]))),u[t*c]=this.addVertex(s(Xy(i,o,[0,c/a])));for(let c=1;c<=a;c++)for(let l=1;l<=a;l++){let p=u[(l-1)*t+(c-1)],f=u[l*t+(c-1)],d=u[(l-1)*t+c],y=this.addVertex(s(Xy(i,o,[c/a,l/a])));u[l*t+c]=y,(c+l)%2===0?(this.pushTriangles(p,y,f),this.pushTriangles(p,d,y)):(this.pushTriangles(p,d,f),this.pushTriangles(d,y,f))}return{triangles:this.getTriangles(),normalDirHints:this.normalDirHints}}};function vq(e){let t=e[0]*Math.SQRT1_2,n=e[1]*Math.SQRT1_2;return[t+n,n-t]}function ub(e){let t=e[0]*Math.SQRT1_2,n=e[1]*Math.SQRT1_2;return[t-n,t+n]}function Oq(e){return[e[1],-e[0]]}function xC(e){return[-e[1],e[0]]}var qe=class{constructor(t,n){this.min=t;this.max=n}get width(){return this.max-this.min}};var EC=class extends ld{constructor(n,r,s,i,o,a=[0,1,2]){let u=r.width/1e8,c=s.width/1e8;super({resolution:o,uRange:r,vRange:s,du:u,dv:c,extraAttrCount:0});this.vertices=[];this.fn=n=>{let r=this._fn(n),s=this.tangentInForcedDf(n,[this.du,0],r),i=this.tangentInForcedDf(n,[0,this.dv],r),o=Kl([this.du,0,s],[0,this.dv,i]);return{uv:n,f:r,normal:[o[this.perm0],o[this.perm1],o[this.perm2]],dfEast:s,dfNorth:i}};this._fn=l=>n(l[0],l[1]),this.paddedOutputDomain=new qe(i.min-5*i.width,i.max+5*i.width),this.jumpTolerance=i.width/1e3,this.perm0=a[0],this.perm1=a[1],this.perm2=a[2]}getVertexCount(){return this.vertices.length}getUV(n){return this.vertices[n].uv}getNormal(n){return this.vertices[n].normal}_addVertex(n){return this.vertices.push(n)-1}copyVertex(n){return this.addVertex(this.vertices[n])}getF(n){return this.vertices[n].f}getDfNorth(n){return this.vertices[n].dfNorth}getDfEast(n){return this.vertices[n].dfEast}tangentInForcedDf(n,r,s){let i=uf(n,r);return this._fn(i)-s}tangentInForced(n,r,s){let i=uf(n,r);return[r[0],r[1],this._fn(i)-s]}getExtraAttr(){throw new Error(\"Unexpected getExtraAttr call in explicit-surface.ts\")}_isVertexAtCrease(n){let r=this.getUV(n),s=this.getDfEast(n),i=this.getDfNorth(n),o=this.getF(n),a=this.tangentInForcedDf(r,[-this.du,0],o);if((-this.duSquared+a*s)/Math.sqrt((this.duSquared+a*a)*(this.duSquared+s*s))>-pd)return!0;let l=this.tangentInForcedDf(r,[0,-this.dv],o);return(-this.dvSquared+i*l)/Math.sqrt((this.dvSquared+i*i)*(this.dvSquared+l*l))>-pd}hintedNormal(n,r){let s=this.getUV(n),i=this.getF(n),o=Kl(this.tangentInForced(s,r[0],i),this.tangentInForced(s,r[1],i));return ep(...o)?[o[this.perm0],o[this.perm1],o[this.perm2]]:this.getNormal(n)}getVertex(n){if(!this.allowVertex(n))return;let r=this.getF(n),s=this.getUV(n);return[this.perm0===2?r:s[this.perm0],this.perm1===2?r:s[this.perm1],this.perm2===2?r:s[this.perm2]]}findJumpBetweenTwoSamples(n,r){let s=this.getUV(n),i=this.getF(n),o=0,a=this.getUV(r),u=this.getF(r),c=1,l=f=>this._fn(ar(s,a,f));if(!isFinite(i)||!isFinite(u))return;let p=eS(o,i,c,u,l,this.jumpTolerance);if(p)return[this.fn(ar(s,a,wi(p[0],0,1e-5))),this.fn(ar(s,a,wi(p[1],1,1e-5)))]}findFiniteBetweenTwoSamples(n,r){let s=this.getUV(n),i=this.getF(n),o=this.getUV(r),a=this.getF(r),u=p=>{let f=this._fn(p);return f<this.paddedOutputDomain.min||f>this.paddedOutputDomain.max?NaN:f},c=p=>u(ar(s,o,p)),l=xs(0,this.paddedOutputDomain.min<i&&i<this.paddedOutputDomain.max?i:NaN,1,this.paddedOutputDomain.min<a&&a<this.paddedOutputDomain.max?a:NaN,c);if(l!==void 0)return this.fn(ar(s,o,l))}allowVertex(n){let r=this.getF(n);return this.paddedOutputDomain.min<r&&r<this.paddedOutputDomain.max}isDegenerate(n,r,s){let i=this.getUV(n),o=this.getUV(r),a=this.getUV(s),u=this.uRange.width*1e-6,c=this.vRange.width*1e-6;return Math.abs(i[0]-o[0])<u&&Math.abs(i[1]-o[1])<c||Math.abs(o[0]-a[0])<u&&Math.abs(o[1]-a[1])<c||Math.abs(a[0]-i[0])<u&&Math.abs(a[1]-i[1])<c}};function lb(e,t,n,r,s,i=[0,1,2]){let o=new EC(e,t,n,r,s,i);return cb(o)}var $i=class{constructor(t){this.xtolerance=t.xtolerance||t.tolerance||0,this.ytolerance=t.ytolerance||t.tolerance||0,this.ztolerance=t.ztolerance||t.tolerance||0,this.map=t.map,this.segments=[],this.segment=[],this.pivotPoint=void 0,this.pendingPoint=void 0}colinear(t,n,r){let s=this.map(t),i=this.map(n),o=this.map(r),a=to(o[0],o[1],o[2]||0,s[0],s[1],s[2]||0,i[0],i[1],i[2]||0);if(a<1)return!1;let u=[s[0]+a*(i[0]-s[0]),s[1]+a*(i[1]-s[1]),s.length===3?s[2]+a*(i[2]-s[2]):0];return Math.abs(o[0]-u[0])<=this.xtolerance&&Math.abs(o[1]-u[1])<=this.ytolerance&&(s.length===2||Math.abs(o[2]-u[2])<=this.ztolerance)}addPoint(t){if(this.dimensions=t.length,this.xtolerance<0&&this.ytolerance<0&&(this.dimensions===2||this.ztolerance<0)){this.segment.push.apply(this.segment,t);return}if(!this.segment.length){this.segment.push.apply(this.segment,t);return}let n=this.dimensions===2?[this.segment[this.segment.length-2],this.segment[this.segment.length-1]]:[this.segment[this.segment.length-3],this.segment[this.segment.length-2],this.segment[this.segment.length-1]];if(!(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2])){if(!this.pivotPoint||!this.pendingPoint){this.pivotPoint=t,this.pendingPoint=t;return}(!this.colinear(n,this.pivotPoint,t)||Oi(n[0]-t[0],n[1]-t[1],(n[2]||0)-(t[2]||0))<Oi(n[0]-this.pendingPoint[0],n[1]-this.pendingPoint[1],(n[2]||0)-(this.pendingPoint[2]||0)))&&(this.flushPending(),this.pivotPoint=t),this.pendingPoint=t}}flushPending(){this.pendingPoint&&(this.segment.push.apply(this.segment,this.pendingPoint),this.pivotPoint=void 0,this.pendingPoint=void 0)}breakSegment(){this.flushPending(),this.segment.length>(this.dimensions||2)&&this.segments.push(this.segment),this.segment=[]}getSegments(){return this.breakSegment(),this.segments}finish(){return{segments:this.getSegments(),resolved:!0}}};var fL=5,Nq=Math.pow(2,14),{abs:ho}=Math;function gm(e,t){let n=Rq(e,t);return{segments:n.contours.strokeSegments,fillSegments:n.contours.fillSegments,resolved:n.quadTree.resolved}}function Rq(e,t){let n=Math.pow(2,-fL),r=dL(t,n),s=dL(t,2*n),i=Aq(e,r,s),o=Gq(i.root,e,r),a=qq(o,e,r);return{paddedDomain:r,rootDomain:s,quadTree:i,triangles:o,contours:a}}function fd(e,t,n){return{x:e,y:t,z:n}}function Ku(e,t,n){return{x:e,y:t,isZero:n}}function pb(e,t,n){return{vertices:[e,t,n],visited:!1,next:void 0}}function dL(e,t){let{mathToPixels:n}=e,r=n.interpolateX(e.xmin,e.xmax,-t),s=n.interpolateX(e.xmax,e.xmin,-t),i=n.interpolateY(e.ymin,e.ymax,-t),o=n.interpolateY(e.ymax,e.ymin,-t);return{...e,xmin:r,ymin:i,xmax:s,ymax:o}}function fm(e,t){return{depth:e,vertices:t,children:void 0,center:void 0}}function MC(e,t,n){e.center=mL(e.vertices[0],e.vertices[1],e.vertices[2],e.vertices[3],t,n)}function Aq(e,t,n){let r=_q(e,n),s=[],i=[];i.push(r);let o=1,a=!0;e:for(;i.length;){let u=s;s=i,i=u;let c;for(;c=s.pop();)if(wq(c,e,t)){if(Lq(c,e,t),!c.children){a=!1;break e}if(i.push(c.children[0]),i.push(c.children[1]),i.push(c.children[2]),i.push(c.children[3]),o+=3,o>=Nq){a=!1;break e}}else MC(c,e,t)}for(let u=0;u<s.length;u++)MC(s[u],e,t);for(let u=0;u<i.length;u++)MC(i[u],e,t);return{root:r,resolved:a}}function _q(e,t){let n=t.xmin,r=t.xmax,s=t.ymin,i=t.ymax;return fm(0,[dd(n,i,e),dd(r,i,e),dd(r,s,e),dd(n,s,e)])}function Lq(e,t,n){let r=e.depth+1,s=e.vertices[0],i=e.vertices[1],o=e.vertices[2],a=e.vertices[3],u=Os(s,i,t,n),c=Os(i,o,t,n),l=Os(o,a,t,n),p=Os(a,s,t,n),f=Os(s,o,t,n);e.children=[fm(r,[s,u,f,p]),fm(r,[u,i,c,f]),fm(r,[f,c,o,l]),fm(r,[p,f,l,a])]}function wq(e,t,n){if(e.depth<fL)return!0;if(Vq(e,n)||Fq(e,n))return!1;let r=e.vertices[0],s=e.vertices[1],i=e.vertices[2],o=e.vertices[3];if(isNaN(r.z)&&isNaN(s.z)&&isNaN(i.z)&&isNaN(o.z))return!1;if(isNaN(r.z)||isNaN(s.z)||isNaN(i.z)||isNaN(o.z))return!0;let a=mL(r,s,i,o,t,n),u=Na(r,s,t,n),c=Na(s,i,t,n),l=Na(i,o,t,n),p=Na(o,r,t,n);return tc(r,u,t,n)||tc(s,u,t,n)||tc(s,c,t,n)||tc(i,c,t,n)||tc(i,l,t,n)||tc(o,l,t,n)||tc(o,p,t,n)||tc(r,p,t,n)||ec(r,u,a,t,n)||ec(u,s,a,t,n)||ec(s,c,a,t,n)||ec(c,i,a,t,n)||ec(i,l,a,t,n)||ec(l,o,a,t,n)||ec(o,p,a,t,n)||ec(p,r,a,t,n)}function ec(e,t,n,r,s){if(e.z>0==t.z>0&&t.z>0==n.z>0)return!1;let i=0;isFinite(e.z)&&(i=Math.max(i,Math.abs(e.z))),isFinite(t.z)&&(i=Math.max(i,Math.abs(t.z))),isFinite(n.z)&&(i=Math.max(i,Math.abs(n.z)));let o=32*Number.EPSILON*i,a,u,c,l;if(e.z>0==t.z>0){if(a=Os(e,t,r,s),a.z>0!=e.z>0)return!0;u=Oa(e,n,r,s,o),c=Oa(t,n,r,s,o),l=Oa(a,n,r,s,o)}else if(t.z>0==n.z>0){if(a=Os(t,n,r,s),a.z>0!=t.z>0)return!0;u=Oa(t,e,r,s,o),c=Oa(n,e,r,s,o),l=Oa(a,e,r,s,o)}else{if(a=Os(n,e,r,s),a.z>0!=n.z>0)return!0;u=Oa(n,t,r,s,o),c=Oa(e,t,r,s,o),l=Oa(a,t,r,s,o)}let{mathToPixels:p,map3d:f}=s;if(f){let d=f(l.x,l.y),y=f(u.x,u.y),g=f(c.x,c.y);return J1(d[0],d[1],d[2],y[0],y[1],y[2],g[0],g[1],g[2])>s.tolerance}else{let[d,y]=p.mapCoordinatePair([l.x,l.y]),[g,m]=p.mapCoordinatePair([u.x,u.y]),[h,b]=p.mapCoordinatePair([c.x,c.y]);return j1(d,y,g,m,h,b)>s.tolerance}}function tc(e,t,n,r){if(isNaN(e.z)&&isNaN(t.z))return!1;if(isNaN(e.z)||isNaN(t.z))return e.z>0||t.z>0;let i=4*Os(e,t,n,r).z-t.z-3*e.z,o=1e-4,a=(n((1-o)*e.x+o*t.x,(1-o)*e.y+o*t.y)-e.z)/o,u=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.abs(i-a)>.125*u}function Fq(e,t){let{mathToPixels:n,map3d:r,tolerance:s}=t;if(r)return!1;{let[i,o]=n.mapCoordinatePair([e.vertices[1].x,e.vertices[1].y]),[a,u]=n.mapCoordinatePair([e.vertices[0].x,e.vertices[0].y]),[c,l]=n.mapCoordinatePair([e.vertices[3].x,e.vertices[3].y]);if(ho(i-a)<10*s||ho(u-l)<10*s)return!0}return!1}function Vq(e,t){return e.vertices[0].x<t.xmin||e.vertices[0].y>t.ymax||e.vertices[2].x>t.xmax||e.vertices[2].y<t.ymin}function md(e,t){return e.x<t.xmin||e.x>t.xmax||e.y<t.ymin||e.y>t.ymax}function dd(e,t,n){return fd(e,t,n(e,t))}function Os(e,t,n,r){let{mathToPixels:s}=r;return dd(s.interpolateX(e.x,t.x,.5),s.interpolateY(e.y,t.y,.5),n)}function Na(e,t,n,r){if(md(e,r)||md(t,r))return Os(e,t,n,r);if(isNaN(e.z)||isNaN(t.z))return Bq(e,t,n,r);if(e.z>0!=t.z>0)return Os(e,t,n,r);let s=.01,i=n((1-s)*e.x+s*t.x,(1-s)*e.y+s*t.y)-e.z,o=t.z-n(s*e.x+(1-s)*t.x,s*e.y+(1-s)*t.y);return isNaN(i)||isNaN(o)||i>0==o>0?Os(e,t,n,r):yL(fd(e.x,e.y,i),fd(t.x,t.y,o),n,r)}function mL(e,t,n,r,s,i){let o=Na(e,n,s,i);return e.z>0==n.z>0&&o.z>0!=e.z>0||(o=Na(t,r,s,i),t.z>0==r.z>0&&o.z>0!=t.z>0)?o:Os(e,n,s,i)}function yL(e,t,n,r){if(isNaN(e.z))return t;if(isNaN(t.z))return e;if(!isFinite(e.z)&&!isFinite(t.z))return Os(e,t,n,r);if(isFinite(e.z))if(isFinite(t.z)){let s=1-e.z/t.z,i=1-t.z/e.z;return dd(e.x/s+t.x/i,e.y/s+t.y/i,n)}else return e;else return t}function Oa(e,t,n,r,s){let{mathToPixels:i,map3d:o}=r,a=e.x,u=t.x,c=e.y,l=t.y,p=e.z,f=t.z;if(md(e,r)||md(t,r)){let d=Os(e,t,n,r);return Ku(d.x,d.y,!1)}if(o){let[d,y,g]=o(a,c),[m,h,b]=o(u,l);for(;ho(d-m)>r.tolerance||ho(y-h)>r.tolerance||ho(g-b)>r.tolerance;){let x=.5*(a+u),T=.5*(c+l),D=n(x,T);if(D>0==p>0?(a=x,c=T,p=D):(u=x,l=T,f=D),(x===a||x===u)&&(T===c||T===l))break;[d,y,g]=o(a,c),[m,h,b]=o(u,l)}}else{let[d,y]=i.mapCoordinatePair([a,c]),[g,m]=i.mapCoordinatePair([u,l]);for(;ho(d-g)>r.tolerance||ho(y-m)>r.tolerance;){let h=.5*(a+u),b=.5*(c+l),x=n(h,b);x>0==p>0?(a=h,c=b,p=x):(u=h,l=b,f=x),[d,y]=i.mapCoordinatePair([a,c]),[g,m]=i.mapCoordinatePair([u,l])}}if(isNaN(p))return Ku(u,l,!1);if(isNaN(f))return Ku(a,c,!1);{let d=Math.abs(p),y=Math.abs(f);if(d<s&&y>100*s)return 1/d>=y?Ku(a,c,!0):Ku(u,l,!1);if(y<s&&d>100*s)return 1/y>=d?Ku(u,l,!0):Ku(a,c,!1);let g=yL(fd(a,c,p),fd(u,l,f),n,r),m=p===0||f===0||g.z===0||g.z>=p==f>=g.z&&Math.abs(g.z)<1e250;return Ku(g.x,g.y,m)}}function Bq(e,t,n,r){let{mathToPixels:s,map3d:i}=r;if(isNaN(e.z)===isNaN(t.z))return Os(e,t,n,r);if(isNaN(e.z)){let p=e;e=t,t=p}let o=e.x,a=t.x,u=e.y,c=t.y,l=e.z;if(i){let[p,f,d]=i(o,u),[y,g,m]=i(a,c);for(;ho(p-y)>r.tolerance||ho(f-g)>r.tolerance||ho(d-m)>r.tolerance||isNaN(p)||isNaN(y);){let h=.5*(o+a),b=.5*(u+c),x=n(h,b);if(isNaN(x)===isNaN(l)?(o=h,u=b,l=x):(a=h,c=b),(h===o||h===a)&&(b===u||b===c))break;[p,f,d]=i(o,u),[y,g,m]=i(a,c)}}else{let[p,f]=s.mapCoordinatePair([o,u]),[d,y]=s.mapCoordinatePair([a,c]);for(;ho(p-d)>r.tolerance||ho(f-y)>r.tolerance;){let g=.5*(o+a),m=.5*(u+c),h=n(g,m);isNaN(h)===isNaN(l)?(o=g,u=m,l=h):(a=g,c=m),[p,f]=s.mapCoordinatePair([o,u]),[d,y]=s.mapCoordinatePair([a,c])}}return fd(o,u,l)}function Gq(e,t,n){let r={triangles:[],edgeCache:{},domain:n,fn:t};return mm(e,r),r.triangles}function mm(e,t){e.children&&(mm(e.children[0],t),mm(e.children[1],t),mm(e.children[2],t),mm(e.children[3],t),nc(e.children[0],e.children[1],t),nc(e.children[3],e.children[2],t),rc(e.children[1],e.children[2],t),rc(e.children[0],e.children[3],t))}function nc(e,t,n){e.children&&t.children?(nc(e.children[1],t.children[0],n),nc(e.children[2],t.children[3],n)):e.children?(nc(e.children[1],t,n),nc(e.children[2],t,n)):t.children?(nc(e,t.children[0],n),nc(e,t.children[3],n)):kq(e,t,n)}function rc(e,t,n){e.children&&t.children?(rc(e.children[2],t.children[1],n),rc(e.children[3],t.children[0],n)):e.children?(rc(e.children[2],t,n),rc(e.children[3],t,n)):t.children?(rc(e,t.children[1],n),rc(e,t.children[0],n)):Hq(e,t,n)}function kq(e,t,n){if(!e.center||!t.center)return;let r,s;e.depth>=t.depth?(r=Na(e.vertices[1],e.vertices[2],n.fn,n.domain),s=mb(e.vertices[1],t.center,e.vertices[2],e.center,r)):(r=Na(t.vertices[0],t.vertices[3],n.fn,n.domain),s=mb(t.vertices[0],t.center,t.vertices[3],e.center,r)),gL(s,n.edgeCache,n.domain);for(let i=0;i<4;i++)n.triangles.push(s[i])}function Hq(e,t,n){if(!e.center||!t.center)return;let r,s;e.depth>=t.depth?(r=Na(e.vertices[3],e.vertices[2],n.fn,n.domain),s=mb(e.vertices[2],t.center,e.vertices[3],e.center,r)):(r=Na(t.vertices[1],t.vertices[0],n.fn,n.domain),s=mb(t.vertices[1],t.center,t.vertices[0],e.center,r)),gL(s,n.edgeCache,n.domain);for(let i=0;i<4;i++)n.triangles.push(s[i])}function mb(e,t,n,r,s){return[pb(e,s,t),pb(t,s,n),pb(n,s,r),pb(r,s,e)]}function ym(e,t,n){return e.z>0&&!md(e,n)&&(!(t.z>0)||md(t,n))}function db(e,t){return\"\"+e.x+\",\"+e.y+\",\"+t.x+\",\"+t.y}function gL(e,t,n){fb(e[0],e[1],e[2],db(e[1].vertices[2],e[1].vertices[0]),t,n),fb(e[1],e[2],e[3],db(e[2].vertices[0],e[2].vertices[2]),t,n),fb(e[2],e[3],e[0],db(e[3].vertices[2],e[3].vertices[0]),t,n),fb(e[3],e[0],e[1],db(e[0].vertices[0],e[0].vertices[2]),t,n)}function fb(e,t,n,r,s,i){let o=t.vertices[0],a=t.vertices[1],u=t.vertices[2];ym(a,u,i)&&(t.next=n),ym(o,a,i)&&(t.next=e),ym(u,o,i)&&Uq(t,r,s),ym(o,u,i)&&zq(t,r,s)}function zq(e,t,n){n[t]?n[t].next=e:n[t]=e}function Uq(e,t,n){n[t]?e.next=n[t]:n[t]=e}function qq(e,t,n){let{tolerance:r,mathToPixels:s,map3d:i}=n,o;if(i){let a={tolerance:r,map:u=>i(u[0],u[1])};o={fillAccumulator:new $i(a),strokeAccumulator:new $i(a),fn:t,domain:n}}else{let a={tolerance:r,map:u=>s.mapCoordinatePair(u)};o={fillAccumulator:new $i(a),strokeAccumulator:new $i(a),fn:t,domain:n}}for(let a=0;a<e.length;a++){let u=e[a];u.next&&!u.visited&&$q(u,o)}return{strokeSegments:o.strokeAccumulator.finish().segments,fillSegments:o.fillAccumulator.finish().segments}}function $q(e,t){for(;;){let n=e.vertices[0],r=e.vertices[1],s=e.vertices[2],i=0;isFinite(n.z)&&(i=Math.max(i,Math.abs(n.z))),isFinite(r.z)&&(i=Math.max(i,Math.abs(r.z))),isFinite(s.z)&&(i=Math.max(i,Math.abs(s.z)));let o=32*Number.EPSILON*i;if(CC(n,r,t,o),CC(r,s,t,o),CC(s,n,t,o),e.visited||!e.next)break;e.visited=!0,e=e.next}t.strokeAccumulator.breakSegment(),t.fillAccumulator.breakSegment()}function CC(e,t,n,r){if(ym(e,t,n.domain)){let s=Oa(e,t,n.fn,n.domain,r);n.fillAccumulator.addPoint([s.x,s.y]),s.isZero?n.strokeAccumulator.addPoint([s.x,s.y]):n.strokeAccumulator.breakSegment()}}function DC(e,t){return{type:\"linear\",s:e,t}}function hL(e,t){return{type:\"logarithmic\",s:e,t}}function bL(e,t){return{type:\"exponential\",s:e,t}}function SC(){return DC(1,0)}function Yq([e,t],[n,r]){let s=(r-n)/(t-e),i=(n+r)/2-s*(t+e)/2;return DC(s,i)}function Xq([e,t],[n,r]){let s=(r-n)/(Math.log(t)-Math.log(e)),i=(Math.log(t)*n-Math.log(e)*r)/(Math.log(t)-Math.log(e));return hL(s,i)}function Zq([e,t],[n,r]){let s=(Math.log(r)-Math.log(n))/(t-e),i=(t*Math.log(n)-e*Math.log(r))/(t-e);return bL(s,i)}function vC(e,t,n){switch(e){case\"linear\":return Yq(t,n);case\"logarithmic\":return Xq(t,n);case\"exponential\":return Zq(t,n);default:{let r=e;throw new Error(\"Unexpected scale type: \"+r)}}}function OC({type:e,s:t,t:n},r){switch(e){case\"linear\":return t*r+n;case\"logarithmic\":return t*Math.log(r)+n;case\"exponential\":return Math.exp(t*r+n);default:let s=e;throw new Error(\"Unexpected scale type: \"+s)}}function NC(e,t,n,r){switch(e){case\"linear\":return Wq(t,n,r);case\"logarithmic\":return Math.pow(t,1-r)*Math.pow(n,r);case\"exponential\":return r===0?t:r===1?n:Math.log((1-r)*Math.exp(t)+r*Math.exp(n));default:let s=e;throw new Error(\"Unexpected scale type: \"+s)}}function Wq(e,t,n){return(1-n)*e+n*t}function RC({type:e,s:t,t:n}){switch(e){case\"linear\":return DC(1/t,-n/t);case\"logarithmic\":return bL(1/t,-n/t);case\"exponential\":return hL(1/t,-n/t);default:let r=e;throw new Error(\"Unexpected scale type: \"+r)}}function AC(e){switch(e){case\"linear\":return\"linear\";case\"logarithmic\":return\"exponential\";case\"exponential\":return\"logarithmic\";default:let t=e;throw new Error(\"Unexpected scale type: \"+t)}}function yb({width:e,height:t}){return{left:0,right:e,top:0,bottom:t}}function gb({xmin:e,xmax:t,ymin:n,ymax:r}){return{left:e,right:t,bottom:n,top:r}}var sc=class e{constructor(t,n){this.xScale=t,this.yScale=n}static fromRects(t,n,{xAxisScale:r,yAxisScale:s}){return new e(vC(r,[t.left,t.right],[n.left,n.right]),vC(s,[t.bottom,t.top],[n.bottom,n.top]))}static fromRectsInverse(t,n,{xAxisScale:r,yAxisScale:s}){return e.fromRects(n,t,{xAxisScale:AC(r),yAxisScale:AC(s)})}inverse(){return new e(RC(this.xScale),RC(this.yScale))}mapX(t){return OC(this.xScale,t)}mapY(t){return OC(this.yScale,t)}mapPoint({x:t,y:n}){return{x:this.mapX(t),y:this.mapY(n)}}mapCoordinatePair([t,n]){return[this.mapX(t),this.mapY(n)]}mapRect({top:t,bottom:n,left:r,right:s}){return{left:this.mapX(r),right:this.mapX(s),bottom:this.mapY(n),top:this.mapY(t)}}interpolateX(t,n,r){return NC(this.xScale.type,t,n,r)}interpolateY(t,n,r){return NC(this.yScale.type,t,n,r)}dangerouslyGetXScaleFactor(){if(this.xScale.type!==\"linear\")throw new Error(`Cannot get scale factor a '${this.xScale.type}' scale`);return this.xScale.s}dangerouslyGetYScaleFactor(){if(this.yScale.type!==\"linear\")throw new Error(`Cannot get scale factor a '${this.yScale.type}' scale`);return this.yScale.s}};function hb(e,t,n,r){let s=[],i=[],o=[],a=[],{xmin:u,xmax:c,ymin:l,ymax:p,zmin:f,zmax:d}=n,y,g,m;switch(r){case\"z\":y={xmin:u,xmax:c,ymin:l,ymax:p},g=(T,D)=>[T[D],T[D+1],f,T[D],T[D+1],d],m=(T,D)=>e(T,D,0);break;case\"y\":y={xmin:u,xmax:c,ymin:f,ymax:d},g=(T,D)=>[T[D],l,T[D+1],T[D],p,T[D+1]],m=(T,D)=>e(T,0,D);break;case\"x\":y={xmin:f,xmax:d,ymin:l,ymax:p},g=(T,D)=>[u,T[D+1],T[D],c,T[D+1],T[D]],m=(T,D)=>e(0,D,T);break}let h=yb({width:500,height:500}),b={...y,mathToPixels:sc.fromRects(gb(y),h,{xAxisScale:\"linear\",yAxisScale:\"linear\"}),tolerance:bo},x=gm(m,b);for(let T of x.segments)for(let D=0;D<T.length/2;D++){let[P,C,S,O,_,L]=g(T,2*D);if(s.push(P,C,S,O,_,L),o.push(P,C,O,_),t){let w=t(P,C,S),U=t(O,_,L);i.push(w[0],w[1],w[2]),i.push(U[0],U[1],U[2])}else i.push(0,0,0),i.push(0,0,0);if(D>0){let w=s.length/3-4;a.push(w,w+1,w+2),a.push(w+2,w+1,w+3)}}return cd(a,s,i,o,0,[],.7),{positions:s,normals:i,faces:a,uvs:o,resolved:x.resolved,extraAttrs:[]}}var bb=[[1,2,4,21,20,18],[0,1,3,20,19,18],[2,6,7,25,21,18],[5,6,8,25,22,18],[5,9,11,23,22,18],[0,9,10,23,19,18],[10,12,14,24,23,19],[3,12,13,24,20,19],[4,13,15,24,21,20],[15,7,16,25,24,21],[11,17,14,24,23,22],[17,8,16,25,24,22]],zr=[0,1,0,2,0,3,1,2,2,3,0,4,0,7,3,7,4,7,0,5,1,5,4,5,1,6,2,6,5,6,3,6,6,7,4,6,0,8,1,8,2,8,3,8,4,8,5,8,6,8,7,8],TL=[[0,2,3,8],[0,1,2,8],[0,3,7,8],[0,4,7,8],[0,4,5,8],[0,1,5,8],[1,5,6,8],[1,2,6,8],[2,3,6,8],[3,6,7,8],[4,5,6,8],[4,6,7,8]],IL=[[0,0,0],[0,1,0],[1,1,0],[1,0,0],[0,0,1],[0,1,1],[1,1,1],[1,0,1],[.5,.5,.5]],_C=[[1,2,4],[4,20,21],[2,18,21],[1,18,20],[0,1,3],[3,19,20],[0,18,19],[2,6,7],[7,21,25],[6,18,25],[5,6,8],[8,22,25],[5,18,22],[5,9,11],[11,22,23],[9,18,23],[0,9,10],[10,19,23],[10,12,14],[14,23,24],[12,19,24],[3,12,13],[13,20,24],[4,13,15],[15,21,24],[15,7,16],[16,24,25],[11,17,14],[17,22,24],[17,8,16]],LC=[];for(let e=0;e<30;e++){let t=_C[e],n=new Set;for(let r of t)n.add(zr[r*2]),n.add(zr[r*2+1]);LC[e]=[...n]}var PL=[[0,3,2,1],[4,6,3,5],[7,2,9,8],[10,12,9,11],[13,12,15,14],[16,6,15,17],[18,17,20,19],[21,5,20,22],[23,1,22,24],[25,24,8,26],[27,14,28,19],[29,28,11,26]],Jq=1<<31,Qq=1<<30,xL=1<<24,Pl=1<<24,Yi=1<<24,xo=65536,To=256,Io=1;function EL(e,t,n){return n*xo+t*To+e*Io}var Kq={0:0*xL,1:To,2:Io+To,3:Io,4:xo,5:To+xo,6:Io+To+xo,7:Io+xo,8:8*xL};function ML(e,t){return Jq+e+Kq[t]}var e8={3:2*Yi+To,4:0*Yi+Io,7:5*Yi+Io,8:2*Yi+xo,10:5*Yi+To,11:0*Yi+xo,12:6*Yi+To,13:5*Yi+Io+To,14:2*Yi+To+xo,15:9*Yi+Io,16:0*Yi+Io+xo,17:1*Yi+xo};function hm(e,t){var n;return Qq+e+((n=e8[t])!=null?n:Yi*t)}var t8={18:10*Pl+To,21:7*Pl+To,23:16*Pl+Io,25:13*Pl+Io,27:4*Pl+xo,29:0*Pl+xo};function wC(e,t){var n;return e+((n=t8[t])!=null?n:Pl*t)}var yd=class{constructor(t,n,r,s,i){this.PAConstructor=t;this.x=n;this.y=r;this.z=s;this.gridsize=i;this.i=0;this.j=0;this.k=0;this.cubeVertex=new Array(9);this.cubeVertexValue=new this.PAConstructor(9);if(i>250)throw new Error(\"Programming Error: resolution should be clamped well below 250.\");this.size=new st(this.x.width/i,this.y.width/i,this.z.width/i)}loopOverUnitCubes(t){let n=this.gridsize,r=n+1,s=new xb(this.x.min,this.y.min,this.z.min,this.size.x,this.size.y,this.size.z,n+1,n+1,n+1),i=new xb(this.x.min+this.size.x/2,this.y.min+this.size.y/2,this.z.min+this.size.z/2,this.size.x,this.size.y,this.size.z,n,n,n),o=s.setupArray(this.PAConstructor),a=s.setupArray(this.PAConstructor),u=i.setupArray(this.PAConstructor);this.evaluateArray(a,s,0);for(let c=0;c<n;c++){this.k=c,[o,a]=[a,o],this.evaluateArray(a,s,c+1),this.evaluateArray(u,i,c);for(let l=0;l<n;l++){this.j=l;for(let p=0;p<n;p++){this.i=p;let f=l*r+p;this.cubeVertexValue.setFrom(0,o,f),this.cubeVertexValue.setFrom(1,o,f+r),this.cubeVertexValue.setFrom(2,o,f+r+1),this.cubeVertexValue.setFrom(3,o,f+1),this.cubeVertexValue.setFrom(4,a,f),this.cubeVertexValue.setFrom(5,a,f+r),this.cubeVertexValue.setFrom(6,a,f+r+1),this.cubeVertexValue.setFrom(7,a,f+1),this.cubeVertexValue.setFrom(8,u,l*n+p),t()}}}}evaluateArray(t,n,r){let s=n.z0+r*n.dz;for(let i=0;i<n.numX;i++)for(let o=0;o<n.numY;o++){let a=n.x0+i*n.dx,u=n.y0+o*n.dy;this.setAt(t,o*n.numX+i,a,u,s)}}setVertexPositions(){for(let t=0;t<9;t++){let n=IL[t];this.cubeVertex[t]=[this.x.min+(this.i+n[0])*this.size.x,this.y.min+(this.j+n[1])*this.size.y,this.z.min+(this.k+n[2])*this.size.z]}}},xb=class{constructor(t,n,r,s,i,o,a,u,c){this.x0=t;this.y0=n;this.z0=r;this.dx=s;this.dy=i;this.dz=o;this.numX=a;this.numY=u;this.numZ=c}setupArray(t){return new t(this.numX*this.numY)}};var Tb=class{constructor(t){this.length=t;this.n=1;this.buffer=new Float64Array(t)}set(t,n){this.buffer[t]=n}get(t){return this.buffer[t]}setFrom(t,n,r){if(n.n!==this.n)throw new Error(\"Programming Error: Mismatched dimensions\");this.set(t,n.get(r))}},Ib=class{constructor(t){this.length=t;this.n=2;this.buffer=new Float64Array(t*2)}set(t,n,r){this.buffer[t*2]=n,this.buffer[t*2+1]=r}getX(t){return this.buffer[t*2]}getY(t){return this.buffer[t*2+1]}setFrom(t,n,r){if(n.n!==this.n)throw new Error(\"Programming Error: Mismatched dimensions\");this.set(t,n.getX(r),n.getY(r))}};function bm(e,t,n,r,s,i=100){if(isFinite(r)||([r,s]=[s,r],[t,n]=[n,t]),isFinite(s))return FC(e,t,n,r,s,i);for(;;){let o=Fi(t,n,.5),a=e(...o);if(a===0)return o;if(!isFinite(a))n=o,s=a;else if(r<0==a<0)t=o,r=a;else return n=o,s=a,FC(e,t,n,r,s,i);if(i*=.5,i<1)return}}function CL(e,t,n,r,s,i=100){if(isFinite(r)||([r,s]=[s,r],[t,n]=[n,t]),!isFinite(s))for(;;){let o=Fi(t,n,.5),a=e(...o);if(a===0)return{posNeg:o};if(!isFinite(a))n=o,s=a;else if(r<0==a<0)t=o,r=a;else if(r>0){n=o,s=a;break}else return{posNeg:VC(e,o,t,a,r,i),posNaN:n8(e,o,n,i)};if(i*=.5,i<1){let u=Fi(t,n,.5);return r>0?{posNaN:u}:{}}}return{posNeg:FC(e,t,n,r,s,i)}}function FC(e,t,n,r,s,i){return r>0?VC(e,t,n,r,s,i):VC(e,n,t,s,r,i)}function VC(e,t,n,r,s,i){let o=r-s;for(;;){let a=Fi(t,n,.5),u=e(...a);if(u<0)n=a,s=u;else if(u>0)t=a,r=u;else return u===0?a:void 0;if(i*=.5,i<1){if(r-s<.1*o)return Fi(t,n,.5);if(i<1e-6)return}}}function n8(e,t,n,r){for(;;){let s=Fi(t,n,.5),i=e(...s);if(!isFinite(i))n=s;else if(i>=0)t=s;else return;if(r*=.5,r<1)return Fi(t,n,.5)}}var Tm=50;function El(e){return e!==void 0&&e!==0}function r8(e){return El(e.posNeg)||El(e.posNaN)}var xm={};function BC(e=xm,t=xm,n=xm){return{edge0:e,edge1:t,edge2:n}}function DL(e,t,n,r,{isInequality:s}){return new GC(e,t,new qe(n.xmin,n.xmax),new qe(n.ymin,n.ymax),new qe(n.zmin,n.zmax),r,{isInequality:s}).fullLoopOverUnitCubes()}var GC=class extends yd{constructor(n,r,s,i,o,a,{isInequality:u}){super(Tb,s,i,o,a);this.f=n;this.gradient=r;this.cubeEdge=new Array(26);this.face=BC();this.cubeHasCrossing=!1;this.allNormalsFromGradient=!0;this.normalFromGradient=[];this.edgesMaybeCross=0;this.positions=[];this.uvs=[];this.normals=[];this.triangles=[];this.isInequality=u,this.sheet=Array((a+1)*(a+1)),this.strip=Array(a+1);for(let c=0;c<(a+1)*(a+1);c++)this.sheet[c]=BC();for(let c=0;c<a+1;c++)this.strip[c]=BC()}setAt(n,r,s,i,o){let a=this.f(s,i,o);n.set(r,a)}fullLoopOverUnitCubes(){this.positions=[],this.normals=[],this.triangles=[],this.loopOverUnitCubes(this.onEachCube.bind(this));let{uvs:n,positions:r,normals:s}=this;if(!this.allNormalsFromGradient)for(let i=0;i<s.length/3;i++){if(this.normalFromGradient[i])continue;let o=s[3*i],a=s[3*i+1],u=s[3*i+2],c=Math.sqrt(o*o+a*a+u*u);s[3*i]=o/c,s[3*i+1]=a/c,s[3*i+2]=u/c}return cd(this.triangles,this.positions,s,n,0,[],.7),{positions:r,normals:s,faces:this.triangles,uvs:n,resolved:!0,extraAttrs:[]}}onEachCube(){this.edgesMaybeCross=0,this.cubeHasCrossing=!1;for(let n=0;n<26;n++){let r=this.cubeVertexValue.get(zr[n*2]),s=this.cubeVertexValue.get(zr[n*2+1]);(r===0||s===0)&&(this.cubeHasCrossing=!0),!(r>0&&s>0||r<0&&s<0)&&(isFinite(r)||isFinite(s))&&(this.edgesMaybeCross|=1<<n)}this.edgesMaybeCross&&(this.setVertexPositions(),this.setEdges()),this.saveEdges(),this.cubeHasCrossing&&this.generateTriangles()}setEdges(){let{i:n,j:r,k:s,gridsize:i}=this,o=this.sheet[(n+0)*(i+1)+r+0],a=this.sheet[(n+1)*(i+1)+r+0],u=this.sheet[(n+0)*(i+1)+r+1],c=0;s>0&&(this.cubeEdge[0]=o.edge0,this.cubeEdge[1]=o.edge1,this.cubeEdge[2]=o.edge2,this.cubeEdge[3]=u.edge2,this.cubeEdge[4]=a.edge0,c|=31),r>0&&(this.cubeEdge[5]=this.strip[n].edge0,this.cubeEdge[6]=this.strip[n].edge1,this.cubeEdge[7]=this.strip[n+1].edge0,this.cubeEdge[8]=this.strip[n].edge2,c|=480,s==0&&(this.cubeEdge[2]=o.edge2,c|=4)),n>0&&(this.cubeEdge[9]=this.face.edge0,this.cubeEdge[10]=this.face.edge1,this.cubeEdge[11]=this.face.edge2,c|=3584,s==0&&(this.cubeEdge[0]=o.edge0,c|=1),r==0&&(this.cubeEdge[5]=this.strip[n].edge0,c|=32));for(let l=0;l<26;l++){if(~this.edgesMaybeCross>>l&1){this.cubeEdge[l]=xm;continue}if(c>>l&1){!this.cubeHasCrossing&&(this.cubeEdge[l].posNeg||this.cubeEdge[l].posNaN)&&(this.cubeHasCrossing=!0);continue}let p=this.findSurfaceCrossingEDI(zr[l*2],zr[l*2+1]);this.cubeEdge[l]=p,r8(p)&&(this.cubeHasCrossing=!0)}}saveEdges(){let{i:n,j:r,k:s,gridsize:i}=this;s<i-1&&(this.sheet[(n+0)*(i+1)+r+0].edge0=this.cubeEdge[11],this.sheet[(n+0)*(i+1)+r+0].edge1=this.cubeEdge[17],this.sheet[(n+0)*(i+1)+r+0].edge2=this.cubeEdge[8]),r<i-1&&(this.strip[n].edge0=this.cubeEdge[10],this.strip[n].edge1=this.cubeEdge[12],this.strip[n].edge2=this.cubeEdge[14]),n<i-1&&(this.face.edge0=this.cubeEdge[15],this.face.edge1=this.cubeEdge[13],this.face.edge2=this.cubeEdge[16]),s==0&&(this.sheet[(n+0)*(i+1)+r+1].edge2=this.cubeEdge[3],this.sheet[(n+1)*(i+1)+r+0].edge0=this.cubeEdge[4]),r==0&&(this.strip[n+1].edge0=this.cubeEdge[7]),r==i-1&&(this.sheet[n*(i+1)+i].edge2=this.cubeEdge[14]),n==i-1&&(this.sheet[(i+0)*(i+1)+r].edge0=this.cubeEdge[16],this.strip[i].edge0=this.cubeEdge[13])}findSurfaceCrossingEDI(n,r){let s=this.cubeVertexValue.get(n),i=this.cubeVertexValue.get(r);if(s===0||i===0)return xm;let o=this.cubeVertex[n],a=this.cubeVertex[r];if(this.isInequality){let{posNeg:u,posNaN:c}=CL(this.f,o,a,s,i);return{posNeg:u!==void 0?this.pushPositionWithGradient(...u):void 0,posNaN:c!==void 0?this.pushPositionNoGradient(...c):void 0}}else{let u=bm(this.f,o,a,s,i);return{posNeg:u!==void 0?this.pushPositionWithGradient(...u):void 0}}}pushPositionWithGradient(n,r,s){if(!(isFinite(n)&&isFinite(r)&&isFinite(s)))return 0;let[i,o,a]=this.computeGradient(n,r,s),u=Math.sqrt(i*i+o*o+a*a);return i/=-u,o/=-u,a/=-u,ep(i,o,a)?(this.normalFromGradient.push(!0),this._pushPositionAndNormal(n,r,s,i,o,a)):this.pushPositionNoGradient(n,r,s)}pushPositionNoGradient(n,r,s){return isFinite(n)&&isFinite(r)&&isFinite(s)?(this.allNormalsFromGradient=!1,this.normalFromGradient.push(!1),this._pushPositionAndNormal(n,r,s,0,0,0)):0}_pushPositionAndNormal(n,r,s,i,o,a){return this.positions.push(n,r,s),this.uvs.push((n-this.x.min)/this.x.width,(r-this.y.min)/this.y.width),this.normals.push(i,o,a),this.positions.length/3}computeGradient(n,r,s){let i=NaN,o=NaN,a=NaN;if(this.gradient&&([i,o,a]=this.gradient(n,r,s),isFinite(i)&&isFinite(o)&&isFinite(a)))return[i,o,a];let u=.001*Math.min(this.size.x,this.size.y,this.size.z),c=this.f(n,r,s);if(isFinite(i)||(i=(this.f(n+u,r,s)-c)/u),isFinite(i)||(i=(c-this.f(n-u,r,s))/u),isFinite(o)||(o=(this.f(n,r+u,s)-c)/u),isFinite(o)||(o=(c-this.f(n,r-u,s))/u),isFinite(a)||(a=(this.f(n,r,s+u)-c)/u),isFinite(a)||(a=(c-this.f(n,r,s-u))/u),isFinite(i)&&isFinite(o)&&isFinite(a))return[i,o,a];let l=NaN,p=NaN,f=NaN,d=NaN,y=NaN,g=NaN,m=u/2;return(!isFinite(i)||!isFinite(o))&&(l=(this.f(n+m,r+m,s)-c)/u,isFinite(l)||(l=(c-this.f(n-m,r-m,s))/u),p=(this.f(n+m,r-m,s)-c)/u,isFinite(p)||(p=(c-this.f(n-m,r+m,s))/u),isFinite(l)&&isFinite(p)&&(isFinite(i)||(i=l+p),isFinite(o)||(o=l-p))),(!isFinite(o)||!isFinite(a))&&(f=(this.f(n,r+m,s+m)-c)/u,isFinite(f)||(f=(c-this.f(n,r-m,s-m))/u),d=(this.f(n,r+m,s-m)-c)/u,isFinite(d)||(d=(c-this.f(n,r-m,s+m))/u),isFinite(f)&&isFinite(d)&&(isFinite(o)||(o=f+d),isFinite(a)||(a=f-d))),(!isFinite(a)||!isFinite(i))&&(y=(this.f(n+m,r,s+m)-c)/u,isFinite(y)||(y=(c-this.f(n-m,r,s-m))/u),g=(this.f(n-m,r,s+m)-c)/u,isFinite(g)||(g=(c-this.f(n+m,r,s-m))/u),isFinite(y)&&isFinite(g)&&(isFinite(i)||(i=y-g),isFinite(a)||(a=y+g))),[i,o,a]}generateTriangles(){for(let n=0;n<12;n++){let r=bb[n],s=[],i=0,o=TL[n],a=0,u=o[0],c=Math.abs(this.cubeVertexValue.get(u));c>a&&isFinite(c)&&(a=c);let l=o[1],p=Math.abs(this.cubeVertexValue.get(l));p>a&&isFinite(p)&&(a=p);let f=o[2],d=Math.abs(this.cubeVertexValue.get(f));d>a&&isFinite(d)&&(a=d);let y=o[3],g=Math.abs(this.cubeVertexValue.get(y));g>a&&isFinite(g)&&(a=g);let m=a*Number.EPSILON*32;if(c<=m){i|=35;let b=this.pushPositionWithGradient(...this.cubeVertex[u]);b!==void 0&&s.push(b)}if(p<=m){i|=21;let b=this.pushPositionWithGradient(...this.cubeVertex[l]);b!==void 0&&s.push(b)}if(d<=m){i|=14;let b=this.pushPositionWithGradient(...this.cubeVertex[f]);b!==void 0&&s.push(b)}if(g<=m){i|=56;let b=this.pushPositionWithGradient(...this.cubeVertex[y]);b!==void 0&&s.push(b)}if(s.length===4)continue;let h;for(let b=0;b<4;b++){let x=o[b];if(this.cubeVertexValue.get(x)>m){h=this.cubeVertex[x];break}}if(h===void 0&&this.isInequality)for(let b=0;b<6;b++){if(i>>b&1)continue;let{posNeg:x,posNaN:T}=this.cubeEdge[r[b]];if(El(x)&&El(T)){h=Fi(this.positions.slice((x-1)*3,x*3),this.positions.slice((T-1)*3,T*3),.5);break}}if(h===void 0)for(let b=0;b<4;b++){let x=o[b];if(!isFinite(this.cubeVertexValue.get(x))){h=this.cubeVertex[x];break}}if(h===void 0&&i&&s.length>0){let b;for(let x=0;x<4;x++){let T=o[x];if(this.cubeVertexValue.get(T)<-m){b=this.cubeVertex[T];break}}if(b){let x=s[0],T=this.positions.slice((x-1)*3,x*3);h=Fi(b,T,2)}}if(h!==void 0){if(this.isInequality){let b=[],x=[],T=!1;for(let D=0;D<6;D++){if(i>>D&1)continue;let{posNeg:P,posNaN:C}=this.cubeEdge[r[D]],S=El(P),O=El(C);S&&b.push(P),O&&x.push(C),S&&O&&(T=!0)}if(T){b.push(...s),this.pushTriangleFromCorners(x,h),this.pushTriangleFromCorners(b,h);continue}}for(let b=0;b<6;b++){if(i>>b&1)continue;let{posNeg:x,posNaN:T}=this.cubeEdge[r[b]],D=x||T;El(D)&&s.push(D)}this.pushTriangleFromCorners(s,h)}}}pushTriangleFromCorners(n,r){if(n.length>=3){let s=n[0]-1,i=n[1]-1,o=n[2]-1;this.pushTriangle(s,i,o,r)}if(n.length==4){let s=n[0]-1,i=n[2]-1,o=n[3]-1;this.pushTriangle(s,i,o,r)}}pushTriangle(n,r,s,i){this.allNormalsFromGradient||this.fixBadNormals(n,r,s,i),this.checkWindingOrder(n,r,s)&&([r,s]=[s,r]),this.triangles.push(n,r,s)}fixBadNormals(n,r,s,i){let o=!this.normalFromGradient[n],a=!this.normalFromGradient[r],u=!this.normalFromGradient[s];if(!(o||a||u))return;let c=this.positions,l=this.normals,p=new st(c[3*n],c[3*n+1],c[3*n+2]),f=new st(c[3*r],c[3*r+1],c[3*r+2]),d=new st(c[3*s],c[3*s+1],c[3*s+2]),y=new st().subVectors(d,p),g=new st().subVectors(p,f),m=y.cross(g),h=new st().subVectors(p,new st(...i));m.dot(h)<0&&m.multiply(-1),m.isFinite()&&(o&&(l[3*n+0]+=m.x,l[3*n+1]+=m.y,l[3*n+2]+=m.z),a&&(l[3*r+0]+=m.x,l[3*r+1]+=m.y,l[3*r+2]+=m.z),u&&(l[3*s+0]+=m.x,l[3*s+1]+=m.y,l[3*s+2]+=m.z))}checkWindingOrder(n,r,s){let i=this.positions,o=this.normals,a=i[3*s]-i[3*n],u=i[3*s+1]-i[3*n+1],c=i[3*s+2]-i[3*n+2],l=i[3*n]-i[3*r],p=i[3*n+1]-i[3*r+1],f=i[3*n+2]-i[3*r+2],d=u*f-c*p,y=c*l-a*f,g=a*p-u*l,m=o[3*n],h=o[3*n+1],b=o[3*n+2];return d*m+y*h+g*b<0}};var{floor:s8}=Math;function kC(e){let t=[];for(let n of e)t.push(...n),t.push(NaN,NaN,NaN);return t}function Ml(e,t,n,r){(n===void 0||isNaN(n))&&(n=zC(t.min,t.max)),n=hr(s8(n),2,2e3);let{xmin:s,xmax:i,ymin:o,ymax:a,zmin:u,zmax:c}=r.viewport;u!=null||(u=Dr.zmin),c!=null||(c=Dr.zmax);let l=Pb(e,{min:t.min,max:t.max,nInitialSamples:n,xtolerance:(i-s)/1e3,ytolerance:(a-o)/1e3,ztolerance:(c-u)/1e3,map:p=>p});return kC(l.segments)}function HC(e,t,n,r){let s=r.degreeMode?Math.PI/180:1;return Ml(i=>{let o=e(i),a=o[0],u=o[1],c=o[2];return[a*Mn(u*s),a*dn(u*s),c]},t,n,r)}function SL(e,t,n,r){let s=r.degreeMode?Math.PI/180:1;return Ml(i=>{let o=e(i),a=o[0],u=o[1],c=o[2];return[a*dn(c*s)*Mn(u*s),a*dn(c*s)*dn(u*s),a*Mn(c*s)]},t,n,r)}function AL(e,t,n,r){let s=i8(e,t,n,r);return kC(s)}function i8(e,t,n,r){return new YC(e,t,new qe(n.xmin,n.xmax),new qe(n.ymin,n.ymax),new qe(n.zmin,n.zmax),r).run()}var o8={},YC=class extends yd{constructor(n,r,s,i,o,a){super(Ib,s,i,o,a);this.f=n;this.g=r;this.vertexFGZs={};this.vertexZeroF={};this.vertexZeroG={};this.threshF=0;this.threshG=0;this.cubeID=0;this.edgesMaybeCrossF=0;this.edgesMaybeCrossG=0;this.tetEdgeCrossings=new Array(26);this.edgeFGZs=new Array(26);this.edgeCrossings=new Map;this.allFGZs=new Map}setAt(n,r,s,i,o){let a=this.f(s,i,o),u=this.g(s,i,o);n.set(r,a,u)}run(){return this.loopOverUnitCubes(this.onEachCube.bind(this)),this.traceCurves()}onEachCube(){this.cubeID=EL(this.i,this.j,this.k),this.pruneEdges(),this.edgesMaybeCrossF&&this.edgesMaybeCrossG&&(this.setVertexPositions(),this.setVertexZeros(),this.setEdgeCrossings(),this.insertCurveSegmentsFromCube())}pruneEdges(){this.edgesMaybeCrossF=0,this.edgesMaybeCrossG=0;for(let n=0;n<26;n++){let r=zr[n*2],s=zr[n*2+1],i=this.cubeVertexValue.getX(r),o=this.cubeVertexValue.getY(r),a=this.cubeVertexValue.getX(s),u=this.cubeVertexValue.getY(s);!(i>0&&a>0||i<0&&a<0)&&(isFinite(i)||isFinite(a))&&(this.edgesMaybeCrossF|=1<<n),!(o>0&&u>0||o<0&&u<0)&&(isFinite(o)||isFinite(u))&&(this.edgesMaybeCrossG|=1<<n)}}setVertexZeros(){let n=0,r=0;for(let o=0;o<9;o++){let a=this.cubeVertexValue.getX(o),u=this.cubeVertexValue.getY(o),c=Math.abs(a),l=Math.abs(u);c>n&&isFinite(c)&&(n=c),l>r&&isFinite(c)&&(r=l)}let s=this.threshF=n*Number.EPSILON*32,i=this.threshG=r*Number.EPSILON*32;for(let o=0;o<9;o++){let a=this.cubeVertexValue.getX(o),u=this.cubeVertexValue.getY(o),c=Math.abs(a),l=Math.abs(u);if(this.vertexZeroF[o]=c<=s,this.vertexZeroG[o]=l<=i,c<=s&&l<=i){let p=this.cubeVertex[o],f=this.createFGZ(ML(this.cubeID,o),p);this.vertexFGZs[o]=f}else this.vertexFGZs[o]=void 0}}getEdgeCrossings(n){let r=this.edgesMaybeCrossF>>n&1,s=this.edgesMaybeCrossG>>n&1;if(!r&&!s)return o8;let i=hm(this.cubeID,n),o=this.edgeCrossings.get(i);if(o!==void 0)return o;let a=this.getEdgeCrossingsUncached(n,r,s);return this.edgeCrossings.set(i,a),a}getEdgeCrossingsUncached(n,r,s){let i=zr[n*2],o=zr[n*2+1],a=this.cubeVertexValue.getX(i),u=this.cubeVertexValue.getY(i),c=this.cubeVertexValue.getX(o),l=this.cubeVertexValue.getY(o),p=this.cubeVertex[i],f=this.cubeVertex[o],d=!r||a===0||c===0?void 0:bm(this.f,p,f,a,c),y=!s||u===0||l===0?void 0:bm(this.g,p,f,u,l),g=this.threshF;!d&&y&&Math.abs(a)<=g&&Math.abs(c)<=g&&Math.abs(this.f(y[0],y[1],y[2]))<=g&&(d=y);let m=this.threshG;return!y&&d&&Math.abs(u)<=m&&Math.abs(l)<=m&&Math.abs(this.g(d[0],d[1],d[2]))<=m&&(y=d),{f:d,g:y}}getTriangleCrossing(n){let r=wC(this.cubeID,n),s=this.allFGZs.get(r);if(s!==void 0)return s;let i=this.getTriangleCrossingUncached(n);return this.allFGZs.set(r,i),i}createFGZ(n,r){let s=this.allFGZs.get(n);if(s)return s;let i={id:n,pos:r,connections:[],visited:!1};return this.allFGZs.set(n,i),i}getTriangleCrossingUncached(n){let r=[],s=[],i=LC[n];for(let a=0;a<3;a++){let u=i[a];if(this.vertexFGZs[u])return null;this.vertexZeroF[u]&&r.push(this.cubeVertex[u]),this.vertexZeroG[u]&&s.push(this.cubeVertex[u])}let o=_C[n];for(let a=0;a<3;a++){let u=o[a],c=this.tetEdgeCrossings[u];if(this.edgeFGZs[u]||!c)continue;let l=c.f,p=c.g,f=zr[2*u],d=zr[2*u+1];l&&!this.vertexZeroF[f]&&!this.vertexZeroF[d]&&r.push(l),p&&!this.vertexZeroG[f]&&!this.vertexZeroG[d]&&s.push(p)}if(r.length===2&&s.length===2){let a=a8(r[0],r[1],s[0],s[1]);return a?{id:wC(this.cubeID,n),pos:a,connections:[],visited:!1}:null}else return null}setEdgeCrossings(){for(let n=0;n<26;n++){let r=this.getEdgeCrossings(n),s=r.f,i=r.g,o=zr[n*2],a=zr[n*2+1];if(this.vertexFGZs[o]||this.vertexFGZs[a])this.tetEdgeCrossings[n]=void 0,this.edgeFGZs[n]=void 0;else if(s&&this.vertexZeroG[o]&&this.vertexZeroG[a]){let u=this.createFGZ(hm(this.cubeID,n),s);this.edgeFGZs[n]=u,this.tetEdgeCrossings[n]=void 0}else if(i&&this.vertexZeroF[o]&&this.vertexZeroF[a]){let u=this.createFGZ(hm(this.cubeID,n),i);this.edgeFGZs[n]=u,this.tetEdgeCrossings[n]=void 0}else if(s&&i&&qa(s,i)<1e-8){let u=this.createFGZ(hm(this.cubeID,n),s);this.edgeFGZs[n]=u,this.tetEdgeCrossings[n]=void 0}else this.edgeFGZs[n]=void 0,this.tetEdgeCrossings[n]=r}}insertCurveSegmentsFromCube(){for(let n=0;n<12;n++)this.insertCurveSegmentsFromTetrahedron(n)}insertCurveSegmentsFromTetrahedron(n){let r=[],s=PL[n];for(let l=0;l<4;l++){let p=this.getTriangleCrossing(s[l]);p&&r.push(p)}let i=[],o=bb[n];for(let l=0;l<6;l++){let p=this.edgeFGZs[o[l]];p&&i.push(p)}let a=[],u=[zr[o[0]*2],zr[o[0]*2+1],zr[o[3]*2],zr[o[3]*2+1]];for(let l of u){let p=this.vertexFGZs[l];p&&a.push(p)}let c=[...a,...i,...r];switch(c.length){case 0:case 1:break;case 2:this.connectCrossings(c[0],c[1]);break;case 3:r.length===2&&this.connectCrossings(r[0],r[1]);break;case 4:r.length===4&&(this.connectCrossings(r[0],r[1]),this.connectCrossings(r[2],r[3]));break;default:throw new Error(\"Programming error: 5 is impossible.\")}}connectCrossings(n,r){n.connections.some(s=>s.id===r.id)||r.connections.some(s=>s.id===n.id)||n.connections.length>=2||r.connections.length>=2||(n.connections.push(r),r.connections.push(n))}traceCurves(){let n={xtolerance:this.size.x*.1,ytolerance:this.size.y*.1,ztolerance:this.size.z*.1,map:s=>s},r=new $i(n);for(let s of this.allFGZs.values())s&&!s.visited&&s.connections.length===1&&this.traceCurve(r,s);for(let s of this.allFGZs.values())s&&!s.visited&&this.traceCurve(r,s);return r.finish().segments}traceCurve(n,r){let s=r;for(;;){n.addPoint(r.pos),r.visited=!0;let i;for(let o of r.connections)o.visited||(i=o);if(!i)break;r=i}s.connections.length===2&&n.addPoint(s.pos),n.breakSegment()}},[Eb,vL,UC]=[new st,new st,new st],OL=new st,[qC,$C,NL]=[new st,new st,new st],[Mb,RL,Cb]=[new st,new st,new st];function a8(e,t,n,r){Eb.set(e[0],e[1],e[2]),vL.set(t[0],t[1],t[2]),UC.set(n[0],n[1],n[2]),OL.set(r[0],r[1],r[2]),qC.subVectors(vL,Eb),$C.subVectors(OL,UC),NL.subVectors(UC,Eb),Mb.crossVectors(qC,$C),RL.crossVectors(NL,$C);let s=Mb.dot(RL)/Mb.dot(Mb);return 0<=s&&s<=1?(Cb.addVectors(Eb,qC.multiply(s)),[Cb.x,Cb.y,Cb.z]):null}var _L=80;var XC=class extends ld{constructor(n,r,s,i,o,a){let u=s.width/1e8,c=i.width/1e8;super({resolution:o,uRange:s,vRange:i,du:u,dv:c,extraAttrCount:a});this.vertices=[];this.fn=n=>{let r=this._fn(n),s=this.tangentInForced(n,[this.du,0],r),i=this.tangentInForced(n,[0,this.dv],r),o=Kl(s,i);return{uv:n,f:r,normal:o,dfEast:s,dfNorth:i}};this._fn=l=>n(l[0],l[1]),this.xmin=r.xmin*6-r.xmax*5,this.xmax=r.xmax*6-r.xmin*5,this.ymin=r.ymin*6-r.ymax*5,this.ymax=r.ymax*6-r.ymin*5,this.zmin=r.zmin*6-r.zmax*5,this.zmax=r.zmax*6-r.zmin*5,this.distThresh=((r.xmax-r.xmin)*1e-6)**2}getVertexCount(){return this.vertices.length}getUV(n){return this.vertices[n].uv}getNormal(n){return this.vertices[n].normal}_addVertex(n){return this.vertices.push(n)-1}copyVertex(n){return this.addVertex(this.vertices[n])}getF(n){return this.vertices[n].f}getDfNorth(n){return this.vertices[n].dfNorth}getDfEast(n){return this.vertices[n].dfEast}insidePaddedDomain(n){return this.zmin<=n[2]&&n[2]<=this.zmax&&this.ymin<=n[1]&&n[1]<=this.ymax&&this.xmin<=n[0]&&n[0]<=this.xmax}tangentInForced(n,r,s){let i=uf(n,r);return YP(this._fn(i),s)}_isVertexAtCrease(n){let r=this.getUV(n),s=this.getDfEast(n),i=this.getDfNorth(n),o=this.getF(n),a=this.tangentInForced(r,[-this.du,0],o);if(XP(a,s)/Math.sqrt(Ql(a)*Ql(s))>-pd)return!0;let c=this.tangentInForced(r,[0,-this.dv],o);return XP(i,c)/Math.sqrt(Ql(i)*Ql(c))>-pd}hintedNormal(n,r){let s=this.getUV(n),i=this.getF(n),o=Kl(this.tangentInForced(s,r[0],i),this.tangentInForced(s,r[1],i));return ep(...o)?o:this.getNormal(n)}getVertex(n){if(this.allowVertex(n))return this.getF(n)}getExtraAttr(n,r){return this.vertices[n].f[3+r]}findJumpBetweenTwoSamples(n,r){let s=this.getUV(n),i=this.getF(n),o=0,a=this.getUV(r),u=this.getF(r),c=1,l=d=>this._fn(ar(s,a,d));if(!isFinite(i[0])||!isFinite(i[1])||!isFinite(i[2])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(u[2]))return;let f=Wy(o,i,c,u,l,(this.xmax-this.xmin)*1e-6,0,0);if(f)return[this.fn(ar(s,a,wi(f[0],0,1e-5))),this.fn(ar(s,a,wi(f[1],1,1e-5)))]}clip(n){return this.insidePaddedDomain(n)?n:[NaN,NaN,NaN]}findFiniteBetweenTwoSamples(n,r){let s=this.getUV(n),i=this.getF(n),o=this.getUV(r),a=this.getF(r),u=l=>this.clip(this._fn(ar(s,o,l))),c=Zy(0,this.clip(i),1,this.clip(a),u);if(c!==void 0)return this.fn(ar(s,o,c))}allowVertex(n){return this.insidePaddedDomain(this.getF(n))}isDegenerate(n,r,s){let i=this.getF(n),o=this.getF(r);if(qa(i,o)<this.distThresh)return!0;let a=this.getF(s);return qa(o,a)<this.distThresh||qa(i,a)<this.distThresh}};function Im(e,t,n,r,s,i){let o=new XC(e,t,n,r,s,i);return cb(o)}function Pm(e,t){let n={};for(let r in t)t.hasOwnProperty(r)&&(ws(e[r],t[r])||(n[r]=t[r]));return n}function Db(e,t){let n,r={};for(let s in t)t.hasOwnProperty(s)&&(ws(e[s],t[s])||(r[s]=t[s],n=r));return n}function Jse(e,t){t||(t={});let n={};for(let r in e)e.hasOwnProperty(r)&&!t.hasOwnProperty(r)&&(n[r]=li(e[r]));for(let r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}var u8=(r=>(r.NONE=\"NONE\",r.POSITIVE=\"POSITIVE\",r.BOTH=\"BOTH\",r))(u8||{});function eie(e){switch(e){case\"LOOP_FORWARD\":return\"dcg-icon-arrow-one-way\";case\"LOOP_FORWARD_REVERSE\":return\"dcg-icon-arrow-two-way\";case\"PLAY_ONCE\":return\"dcg-icon-arrow-once\";case\"PLAY_INDEFINITELY\":return\"dcg-icon-arrow-infinite\"}}function sie({from:e,to:t,props:n}){for(let r in n)n[r]&&e.hasOwnProperty(r)&&(t[r]=li(e[r]))}function iie(e,t){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function wL(e,t){let n={};for(let r in t)t.hasOwnProperty(r)&&(n[r]=e[r]);return n}function oie(e){let t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=!0);return t}var FL={collapsed:!1,hidden:!1,secret:!1,inFrontOfEverything:!1,readonly:!1,title:\"\"};function uie(e){return{...FL,...e}}function cie(e){return Pm(FL,e)}var VL=\"**dcg_geo_folder**\";var ZC={show:!1,min:\"\",max:\"\"},WC={breadth:\"\",axisOffset:\"\",alignedAxis:\"x\",showBoxplotOutliers:!0,binAlignment:\"center\",dotplotXMode:\"exact\",histogramMode:\"\"},jC={enabled:!1,latex:\"\"};var kL=4e3,Sb={polarDomain:{min:\"\",max:\"\"},parametricDomain:{min:\"\",max:\"\"},parametricDomain3Du:{min:\"\",max:\"\"},parametricDomain3Dv:{min:\"\",max:\"\"},parametricDomain3Dr:{min:\"\",max:\"\"},parametricDomain3Dphi:{min:\"\",max:\"\"},cdf:ZC,colorLatex:\"\",description:\"\",fillOpacity:\"\",surfaceOpacity:\"\",lineOpacity:\"\",pointOpacity:\"\",pointSize:\"\",movablePointSize:\"\",lineWidth:\"\",resolution:\"\",labelAngle:\"\",vizProps:WC,clickableInfo:jC},HL={folderId:\"\",latex:\"\",color:\"\",showLabel:!1,showAngleLabel:!0,label:\"\",hidden:!1,secret:!1,readonly:!1,disableGraphInteractions:!1,dragMode:\"AUTO\",labelSize:\"\",labelOrientation:\"default\",suppressTextOutline:!1,interactiveLabel:!1,editableLabelMode:\"NONE\",residualVariable:\"\",isLogModeRegression:!1,pointStyle:\"POINT\",lineStyle:\"SOLID\",arrowMode:\"DEFAULT\",regressionParameters:{},displayEvaluationAsFraction:!1,slider:{},strictIntersection:!1,extendTo3D:!1,...Sb,points:void 0,lines:void 0,fill:void 0},zL={hardMin:!1,hardMax:!1,animationPeriod:kL,loopMode:\"LOOP_FORWARD_REVERSE\",playDirection:1,isPlaying:!1,min:\"-10\",max:\"10\",step:\"\"},UL={hardMin:!1,hardMax:!1,animationPeriod:kL,loopMode:\"LOOP_FORWARD_REVERSE\",playDirection:1,isPlaying:!1,min:`${Dr.xmin}`,max:`${Dr.xmax}`,step:\"\"};function Pie(e,t){return{...HL,isLogModeRegression:t.defaultLogModeRegressions,...e,slider:{...t.is3d?UL:zL,...e.slider},cdf:{...ZC,...e.cdf},vizProps:{...WC,...e.vizProps},clickableInfo:{...jC,...e.clickableInfo}}}function Eie(e,t){let n=Pm(HL,{...e,slider:Pm(t.is3d?UL:zL,e.slider)}),r=Db(ZC,e.cdf);r===void 0?delete n.cdf:n.cdf=r;let s=Db(WC,e.vizProps);s===void 0?delete n.vizProps:n.vizProps=s;let i=Db(jC,e.clickableInfo);return i===void 0?delete n.clickableInfo:n.clickableInfo=i,n}function c8(e){return wL(e,Sb)}function Mie(e,t){for(let n in Sb)if(Sb.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}function Cie(e){return{type:\"statement\",id:e.id,latex:e.latex,label:e.label,color:e.color,fill:e.fill,points:e.points,lines:e.lines,extendTo3D:e.extendTo3D,pointStyle:e.pointStyle,lineStyle:e.lineStyle,arrowMode:e.arrowMode,dragMode:e.dragMode,labelSize:e.labelSize,labelOrientation:e.labelOrientation,suppressTextOutline:e.suppressTextOutline,interactiveLabel:e.interactiveLabel,editableLabelMode:e.editableLabelMode,residualVariable:e.residualVariable,regressionParameters:e.regressionParameters,isLogModeRegression:e.isLogModeRegression,showLabel:e.showLabel,showAngleLabel:e.showAngleLabel,shouldGraph:!e.hidden,slider:{min:e.slider.hardMin?e.slider.min:\"\",max:e.slider.hardMax?e.slider.max:\"\",softMin:e.slider.hardMin?\"\":e.slider.min,softMax:e.slider.hardMax?\"\":e.slider.max,step:e.slider.step,isPlayingOnce:e.slider.isPlaying&&e.slider.loopMode===\"PLAY_ONCE\"},strictIntersection:e.strictIntersection,isInConstructionsFolder:e.folderId===VL,...c8(e)}}var y8={};ia(y8,{LinearToSRGB:()=>f8,SRGBToLinear:()=>vb,colorString:()=>qL,colors:()=>Cl,colors3d:()=>m8,convertColorStringToLinearRGB:()=>QC,getDisplayColor:()=>Ra,invertColor:()=>p8,isValidHexColor:()=>Ob,mutateOpacity:()=>d8,normalizeColor:()=>JC,parseHex:()=>$L,shadeColor:()=>l8});function JC(e){return Ob(e)?(e.match(/^#([A-Fa-f0-9]{3})$/g)&&(e=\"#\"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.toLowerCase()):e}function Ob(e){return typeof e==\"string\"&&(e.match(/^#([A-Fa-f0-9]{3})$/g)||e.match(/^#([A-Fa-f0-9]{6})$/g))}function l8(e,t){if(e=JC(e),!Ob(e))return e;t>1&&(t=1),t<-1&&(t=-1);let n=parseInt(e.slice(1),16),r=t<0?0:255,s=t<0?t*-1:t,i=n>>16,o=n>>8&255,a=n&255;return qL(Math.round((r-i)*s)+i,Math.round((r-o)*s)+o,Math.round((r-a)*s)+a)}function qL(e,t,n){return\"#\"+(16777216+Math.round(e)*65536+Math.round(t)*256+Math.round(n)).toString(16).slice(1)}function p8(e){if(e=JC(e),!Ob(e))return e;let t=\"0123456789abcdef\";return\"#\"+e.slice(1).split(\"\").map(n=>t[15-t.indexOf(n)]).join(\"\")}function $L(e){e=e.replace(/#/,\"\");let t,n,r;return e.length===3?(t=parseInt(e.slice(0,1)+e.slice(0,1),16),n=parseInt(e.slice(1,2)+e.slice(1,2),16),r=parseInt(e.slice(2,3)+e.slice(2,3),16)):e.length===6?(t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),r=parseInt(e.slice(4,6),16)):(t=0,n=0,r=0),{r:t,g:n,b:r}}function d8(e,t){let n=/(rgba\\([\\d]+\\,\\ ?[\\d]+\\,\\ ?[\\d]+\\,\\ ?)[\\d.]+(\\))/;return e.match(n)?e.replace(n,`$1${t}$2`):e}function Ra(e,t){if(t&&t.colorLatexValue){let n=t.colorLatexValue;return Array.isArray(n)?n[0]:n}return e.color}function vb(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function f8(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}function QC(e){let t=$L(e);return[vb(t.r/255),vb(t.g/255),vb(t.b/255)]}var Cl={RED:\"#c74440\",BLUE:\"#2d70b3\",GREEN:\"#388c46\",PURPLE:\"#6042a6\",ORANGE:\"#fa7e19\",BLACK:\"#000000\",GRAY:\"#aaaaaa\",FOCUS_OUTLINE:\"#6a93d2\"},m8={RED:Cl.RED,BLUE:Cl.BLUE,GREEN:Cl.GREEN,ORANGE:Cl.ORANGE,PURPLE:Cl.PURPLE,GRAY:Cl.GRAY};var g8=(e,t)=>{let n=e.segments[0],r=t.segments[0],s=[[...n,...r]];return{...e,segments:s}};function h8(e){let{viewState:t,graphInfo:n,compiled:r,derivative:s,bounds:i}=e,o=li(n),a=Gn(n.domainBound,bi(i));if(!Fs(a))return o.domainBound=a,o.lineStyle=\"SOLID\",cu({graphInfo:o,viewState:t,compiled:r,derivative:s})}function ic(e){let{viewState:t,graphInfo:n,compiled:r,bounds:s,included:i,showPoint:o}=e,a=li(n),u=Gn(n.domainBound,bi(s));if(!Fs(u))return a.domainBound=u,a.pointStyle=i?\"POINT\":\"OPEN\",Nb({graphInfo:a,viewState:t,compiled:r,showPoint:o,maxOverride:void 0})}function YL(e){let{viewState:t,graphInfo:n,compiled:r,bounds:s,maxOverride:i,showPoint:o}=e,[a,u]=s,c=[],l;a=Math.ceil(a),u=Math.floor(u);let p=i!==void 0?i:1/0;if(a===-1/0&&u>=p)l=ic({bounds:[a,p],included:!0,viewState:t,graphInfo:n,compiled:r,showPoint:o}),c.push(l);else if(a===-1/0&&u<1/0)l=ic({bounds:[a,u],included:!0,viewState:t,graphInfo:n,compiled:r,showPoint:o}),c.push(l),c.push(ic({bounds:[u+1,p],included:!1,viewState:t,graphInfo:n,compiled:r,showPoint:o}));else if(a>-1/0&&u>=p)l=ic({bounds:[a,p],included:!0,viewState:t,graphInfo:n,compiled:r,showPoint:o}),c.push(ic({bounds:[-1/0,a-1],included:!1,viewState:t,graphInfo:n,compiled:r,showPoint:o})),c.push(l);else{l=ic({bounds:[a,u],included:!0,viewState:t,graphInfo:n,compiled:r,showPoint:o});let f=ic({bounds:[-1/0,a-1],included:!1,viewState:t,graphInfo:n,compiled:r,showPoint:o}),d=ic({bounds:[u+1,p],included:!1,viewState:t,graphInfo:n,compiled:r,showPoint:o});c.push(l);let y;f&&d&&(y=g8(f,d),c.push(y))}return{cdfTopBranch:l,topBranches:c}}var XL=e=>{let{viewState:t,graphInfo:n,compiled:r,derivative:s,bounds:i}=e,[o,a]=i,u=h8({bounds:[o,a],viewState:t,graphInfo:n,compiled:r,derivative:s}),c=[cu({viewState:t,graphInfo:n,compiled:r,derivative:s})];return{cdfTopBranch:u,topBranches:c}};var Em=class{constructor(t){this.parentType=t;this.count=0;this.intersections=[]}addPoint(t){this.intersections.push(t),this.count+=1}addPoints(t){this.intersections.push(...t),this.count+=t.length}addIntersection(t,n){n.valueType===N?this.addPoint(n.value):this.addPoints(n.value)}getPoints(){return this.intersections}},gd=class{constructor(t){this.parentType=t;this.count=0;this.intersectionsByIndex=new Map;if(t===xn)this.scalarType=de;else if(t===Vn)this.scalarType=Ne;else if(t===Fn)this.scalarType=ie;else throw new Error(`Expected ListOfSegment or ListOfArc but got ${at(t)}`)}getListItemIntersections(t){let n=this.intersectionsByIndex.get(t);return n||(n=new Em(this.scalarType),this.intersectionsByIndex.set(t,n)),n}addIntersection(t,n){let r=zo(t);if(r!==void 0){let s=r-1,i=this.getListItemIntersections(s);n.valueType===Pt?i.addPoints(n.value):i.addPoint(n.value),this.count+=1}else{za(n.valueType,[Pt]);for(let s=0;s<n.value.length;s++)this.getListItemIntersections(s).addPoint(n.value[s]);this.count+=n.value.length}}},KC=class{constructor(){this.parentType=xe;this.count=0;this.intersectionsByEdgeIndex=new Map}getEdgeIntersections(t){let n=this.intersectionsByEdgeIndex.get(t);return n||(n=new Em(de),this.intersectionsByEdgeIndex.set(t,n)),n}addPoint(t,n){this.getEdgeIntersections(t).addPoint(n),this.count+=1}addIntersection(t,n){if(t.type!==\"polygon-edge\")throw new Error(`Expected a polygon edge parent ref type but got ${t.type}`);let r=t.edgeIndex-1,s=this.getEdgeIntersections(r);n.valueType===Pt?(s.addPoints(n.value),this.count+=n.value.length):(s.addPoint(n.value),this.count+=1)}},e1=class{constructor(){this.parentType=In;this.count=0;this.intersectionsByEdgeIndex=new Map}getEdgeIntersections(t){let n=this.intersectionsByEdgeIndex.get(t);return n||(n=new gd(xn),this.intersectionsByEdgeIndex.set(t,n)),n}addIntersection(t,n){if(t.type!==\"polygon-edge\")throw new Error(`Expected a polygon edge parent ref type but got ${t.type}`);let r=t.edgeIndex-1,s=this.getEdgeIntersections(r),i=zo(t);if(i!==void 0){let o=i-1;n.valueType===Pt?s.getListItemIntersections(o).addPoints(n.value):s.getListItemIntersections(o).addPoint(n.value),this.count+=1}else{za(n.valueType,[Pt]);for(let o=0;o<n.value.length;o++)s.getListItemIntersections(o).addPoint(n.value[o]);this.count+=n.value.length}}},hd=class{constructor(){this.data={}}getChildIntersections(t){return this.data[t]}addChildIntersection(t,n){za(n==null?void 0:n.valueType,[N,Pt]);let r;if(t.valueType==In)r=this.data[t.id]||new e1;else if(t.valueType===xn||t.valueType===Vn||t.valueType===Fn)r=this.data[t.id]||new gd(t.valueType);else if(t.valueType===xe)r=this.data[t.id]||new KC;else if(t.valueType===de||t.valueType===Ne||t.valueType===ie)r=this.data[t.id]||new Em(t.valueType);else return;this.data[t.id]=r,r.addIntersection(t.ref,n)}static compareIntersectionCounts({prevChildIntersections:t,nextChildIntersections:n}){var i,o;let r={},s=new Set([...Object.keys(t.data),...Object.keys(n.data)]);for(let a of s){let u=((i=t.data[a])==null?void 0:i.count)||0,c=((o=n.data[a])==null?void 0:o.count)||0;r[a]={prev:u,next:c}}return r}};function Aie(e){return 2*b8(e*.5)}function b8(e){return e<=8?3*e:e>=16?2*e:e+16}function JL(e=void 0){let{xmin:t,xmax:n,ymin:r,ymax:s,zmin:i,zmax:o}=e!=null?e:new Ab,a=[t,r,o,t,s,o,n,s,o,n,r,o,t,r,i,t,s,i,n,s,i,n,r,i,t,r,i,t,r,o,t,s,o,t,s,i,n,r,i,n,r,o,n,s,o,n,s,i,n,r,i,n,r,o,t,r,o,t,r,i,n,s,i,n,s,o,t,s,o,t,s,i],u=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],c=[0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,1,0,1],l=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{positions:new Float32Array(a),normals:new Float32Array(u),faces:new Uint16Array(l),uvs:new Float32Array(c)}}var{abs:oc,min:t1,max:n1}=Math;function r1(e,t){let{xmin:n,xmax:r,ymin:s,ymax:i,zmin:o,zmax:a}=t,u=[[n,s,a],[n,i,a],[r,i,a],[r,s,a],[n,s,o],[n,i,o],[r,i,o],[r,s,o]],c=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],l=[];for(let[S,O]of c){let _=u[S],L=u[O],w=e(..._),U=e(...L),G=w/(w-U);0<=G&&G<=1&&l.push(Fi(_,L,G))}if(l.length<3)return;let p=t1(...l.map(S=>S[0])),f=n1(...l.map(S=>S[0])),d=t1(...l.map(S=>S[1])),y=n1(...l.map(S=>S[1])),g=t1(...l.map(S=>S[2])),m=n1(...l.map(S=>S[2])),h=e(n,s,o),b=(e(r,s,o)-h)/(r-n),x=(e(n,i,o)-h)/(i-s),T=(e(n,s,a)-h)/(a-o),D,P,C;return oc(T)>=oc(b)&&oc(T)>=oc(x)?(D=(S,O)=>[S,O,o-(h+b*(S-n)+x*(O-s))/T],P=new qe(p,f),C=new qe(d,y)):oc(x)>=oc(T)&&oc(x)>=oc(b)?(D=(S,O)=>[S,s-(h+b*(S-n)+T*(O-o))/x,O],P=new qe(p,f),C=new qe(g,m)):(D=(S,O)=>[n-(h+x*(S-s)+T*(O-o))/b,S,O],P=new qe(d,y),C=new qe(g,m)),{explicitPlane:D,u:P,v:C}}function _b(e,t){let n=[],r=[],s=[],i=[],o=r1(e,t);if(o){let{explicitPlane:a,u,v:c}=o;n.push(...a(u.min,c.min),...a(u.max,c.min),...a(u.min,c.max),...a(u.max,c.max));let l=new st(n[0],n[1],n[2]),p=new st(n[3],n[4],n[5]),f=new st(n[6],n[7],n[8]),d=new st().subVectors(f,l),y=new st().subVectors(l,p),g=d.cross(y).normalize();r.push(g.x,g.y,g.z,g.x,g.y,g.z,g.x,g.y,g.z,g.x,g.y,g.z),s.push(0,0,0,1,1,0,1,1),i.push(0,1,2,3,2,1)}return{positions:n,normals:r,faces:i,uvs:s,resolved:!0,extraAttrs:[]}}function s1(e,t){let n;switch(t){case\"solvedEquation\":n=2;break;case\"baseComparator\":n=4;break;default:n=1;break}return Math.floor(e/n)}var T8=!1,ac=200,Fb=M.List;function Ir(){return{}}function Dl(e,t,n){let r=1/0;for(let i of t){let o=e[i];Array.isArray(o)&&o.length<r&&(r=o.length)}let s=1;return n===\"solvedEquation\"?s=2:n===\"baseComparator\"&&(s=4),s*r}function Aa(e,t,n){return Array.isArray(e)?e[s1(t,n)]:e}function I8(e,t){let n=t.viewport.xmax-t.viewport.xmin,r=t.viewport.ymax-t.viewport.ymin,s=Oi(n,r),i=Oi(30,30),o=Math.round(2-Math.log(s/i)/Math.LN10);if(o<=0)return Math.round(e)+\"\";{let a=Math.pow(10,o);return Math.round(e*a)/a+\"\"}}function P8(e,t){let n=t.viewport.xmax-t.viewport.xmin,r=t.viewport.ymax-t.viewport.ymin,s=n*r,i=30*30,o=Math.round(2-Math.log(s/i)/Math.LN10);if(o<=0)return Math.round(e)+\"\";{let a=Math.pow(10,o);return Math.round(e*a)/a+\"\"}}function E8(e,t){return t.degreeMode?Math.round(e/(Math.PI/180)*10)/10+\"\\xB0\":Math.round(e*100)/100+\"\"}function uc(e,t,n){let r=s1(t,n),s=e.userData.lineStyle,i=Aa(e.metaData.computedLineWidth,t,n),o=Aa(e.metaData.computedLineOpacity,t,n),a=Aa(e.metaData.computedFillOpacity,t,n),u=Aa(e.metaData.computedSurfaceOpacity,t,n),c=e.metaData.colorLatexValue?Aa(e.metaData.colorLatexValue,t,n):e.userData.color,l=Aa(e.metaData.computedResolution,t,n);return{listIndex:r,style:s,lineWidth:i,lineOpacity:o,fillOpacity:a,surfaceOpacity:u,color:c,resolution:l}}M.Base.prototype._graph=M8;function M8(e,t,n,r,s,i){var d,y,g;if(t instanceof M.SolvedEquation){let m=this._graph(e,t._expression,n,r,s,t.branchMultiplier===2?\"solvedEquation\":void 0),h=uw(this,t,n,e);return h&&(m||(m=[]),Array.prototype.push.apply(m,h)),m}function o(m){let h=m.editableLabelMode;return h===\"TEXT\"||h===\"MATH\"}function a(m,h){return\"colorLatex\"in m&&A8(m.colorLatex)?m.colorLatex:h}let u=t.getExpressionType(r.graphMode,t.valueType),c=eC(u,{points:this.userData.points,lines:this.userData.lines,fill:this.userData.fill}),l={lineOpacity:\"computedLineOpacity\",lineWidth:\"computedLineWidth\",color:\"colorLatexValue\",fillOpacity:\"fillOpacity\",surfaceOpacity:\"surfaceOpacity\",resolution:\"resolution\"},p=(m,h)=>{let b=Dl(this.metaData,Object.keys(m).map(T=>l[T]),i),x=[];return Fb.wrap(t).eachElement((T,D)=>{if(D>=b)return;let P=this.getGraphInfo(e,T);P.graphMode=r.graphMode;let C=uc(this,D,i);P.listIndex=C.listIndex,P.style=C.style,\"lineWidth\"in m&&(P.lineWidth=C.lineWidth),\"lineOpacity\"in m&&(P.lineOpacity=C.lineOpacity),\"fillOpacity\"in m&&(P.fillOpacity=C.fillOpacity),\"surfaceOpacity\"in m&&(P.surfaceOpacity=C.surfaceOpacity),\"color\"in m&&(P.color=a(this.userData,C.color)),\"resolution\"in m&&(P.resolution=C.resolution),x.push(...h(T,P))}),x},f=r.graphMode;switch(f){case 26:case 4:{let{points:b,droppedIndices:x}=Mm([t.asValue()]),T=this.userData.shouldGraph&&c.points,D=this.userData.showLabel&&!T;if(T)return[{segments:[b],graphMode:f,droppedIndices:x,color:Ra(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,pointSize:this.metaData.computedMovablePointSize,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:o(this.userData),labels:this.computedLabels||[],poi:go(b),movablePointInfo:[]}];if(D){let P;switch(f){case 4:P=3;break;case 26:P=25;break;default:let C=f;throw new Error(`Unexpected graphMode: ${C}`)}return[{segments:[b],graphMode:P,color:Ra(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,nakedLabel:!0,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:o(this.userData),labels:this.computedLabels||[],poi:go(b),showPoint:!1}]}else return[]}case 25:case 3:{let b=[],x=this.userData.shouldGraph&&c.points,T=this.userData.shouldGraph&&c.lines,D=[\"colorLatexValue\"];x&&D.push(\"computedPointOpacity\",\"computedPointSize\"),(this.userData.showLabel||x)&&D.push(\"computedLabelSize\",\"computedLabelAngle\");let P=Dl(this.metaData,D,i),C=Fb.wrap(t).asValue();ms(C),C.length>P&&(C.length=P);let S=this.userData.showLabel&&!x&&!T,O=Mm(C);if(this.userData.showLabel||x){let _={segments:[O.points],graphMode:f,droppedIndices:O.droppedIndices,color:this.metaData.colorLatexValue||this.userData.color,style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,showPoint:x,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointSize:this.metaData.computedPointSize,pointOpacity:this.metaData.computedPointOpacity,suppressTextOutline:this.userData.suppressTextOutline,interactiveLabel:!!this.userData.interactiveLabel,editableLabel:o(this.userData),nakedLabel:S,labels:this.computedLabels||[],poi:go(C)};e.is3dPolicy()?b.push(...O8(_)):b.push(_)}if(T){let _=this.metaData.computedLineWidth,L={segments:rw(C),graphMode:5,color:Ra(this.userData,this.metaData),style:this.userData.lineStyle,lineWidth:_,lineOpacity:this.metaData.computedLineOpacity,poi:Ir()};b.push(KL(e,L,n,_))}return b}case 114:{let b=[],x=this.userData.shouldGraph&&c.points,T=this.userData.shouldGraph&&c.lines,D=[\"colorLatexValue\"];x&&D.push(\"computedPointOpacity\",\"computedPointSize\");let P=Fb.wrap(t).asValue();ms(P);let C=Dl(this.metaData,D,i),S=Math.min(P.length,C);if(x)for(let O=0;O<S;O++){let{color:_}=uc(this,O,i),L=Aa(this.metaData.computedPointSize,O,i);b.push({graphMode:114,position:P[O],radius:.02*L,guid:Ns(),color:_})}if(T){let O=Aa(this.metaData.computedLineWidth,0,i),{color:_}=uc(this,0,i);b.push({graphMode:100,points:Cm(P,n.viewport,O),thickness:O,guid:Ns(),color:_})}return b}case 117:{let b=this.metaData.colorLatexValue?!Array.isArray(this.metaData.colorLatexValue):!0,x=this.metaData.computedSurfaceOpacity,T=[],D=[],P=[],C=[],S=[],[O,_,L]=[new st,new st,new st],[w,U,G]=[new st,new st,new st],Z=(Y,re,Ee,he,K,Oe,te,Ze,dt)=>{if(w.set(Y,re,Ee),U.set(he,K,Oe),G.set(te,Ze,dt),!w.isFinite()||!U.isFinite()||!G.isFinite())return;let me=T.length/3;T.push(w.x,w.y,w.z,U.x,U.y,U.z,G.x,G.y,G.z),O.subVectors(w,G),_.subVectors(U,w),L.crossVectors(O,_),D.push(L.x,L.y,L.z,L.x,L.y,L.z,L.x,L.y,L.z),P.push(me,me+1,me+2),C.push(0,0,0,1,1,0)},F=()=>{let Y={guid:Ns(),resolved:!0,positions:new Float32Array(T),normals:new Float32Array(D),faces:new Uint32Array(P),uvs:new Float32Array(C),extraAttrs:new Float32Array([])};return S.length&&(Y.colors=new Float32Array(S)),Y};if(t.valueType===yr&&!Array.isArray(x)){let Y=this.metaData.computedSurfaceOpacity,re=\"\";if(b){let Ee=(d=this.metaData.colorLatexValue)!=null?d:this.userData.color;re=a(this.userData,Ee)}return p({color:!0},(Ee,he)=>{if(Ee.valueType===Rn){let[[K,Oe,te],[Ze,dt,me],[J,W,Ge]]=Ee.asValue();if(Z(K,Oe,te,Ze,dt,me,J,W,Ge),!b){let[be,ue,_e]=QC(he.color);S.push(be,ue,_e,be,ue,_e,be,ue,_e)}}return[]}),[{meshData:F(),color:re,surfaceOpacity:Y!=null?Y:1,graphMode:117}]}return p({color:!0,surfaceOpacity:!0},(Y,re)=>{var W;let[[Ee,he,K],[Oe,te,Ze],[dt,me,J]]=Y.asValue();return T=[],D=[],P=[],C=[],Z(Ee,he,K,Oe,te,Ze,dt,me,J),[{meshData:F(),color:a(this.userData,re.color),surfaceOpacity:(W=re.surfaceOpacity)!=null?W:1,graphMode:117}]})}case 119:{let b=this.metaData.colorLatexValue?!Array.isArray(this.metaData.colorLatexValue):!0;if(t.valueType===mr&&b&&!Array.isArray(this.metaData.computedLineWidth)){let x=(y=this.metaData.colorLatexValue)!=null?y:this.userData.color,T=this.metaData.computedLineWidth,D=[];return p({color:!0},P=>{if(P.valueType===wt){let[[C,S,O],[_,L,w]]=P.asValue();D.push(C,S,O,_,L,w,NaN,NaN,NaN)}return[]}),[{graphMode:119,guid:Ns(),points:D,color:x,thickness:T!=null?T:1}]}return p({color:!0,lineWidth:!0},(x,T)=>{let{lineWidth:D,color:P}=T,C=x.asValue(),[[S,O,_],[L,w,U]]=C;return sw(S,O,_,L,w,U)?[]:[{graphMode:119,guid:Ns(),points:[S,O,_,L,w,U],color:P,thickness:D}]})}case 129:let m=this.metaData.colorLatexValue?!Array.isArray(this.metaData.colorLatexValue):!0;if(t.valueType===gr&&m&&!Array.isArray(this.metaData.computedLineWidth)){let b=(g=this.metaData.colorLatexValue)!=null?g:this.userData.color,x=this.metaData.computedLineWidth,T=[];return p({color:!0},D=>{if(D.valueType===ke){let[[P,C,S],[O,_,L]]=D.asValue();T.push(O,_,L,P+O,C+_,S+L)}return[]}),[{graphMode:129,guid:Ns(),points:T,color:b,thickness:x!=null?x:1}]}return p({color:!0,lineWidth:!0},(b,x)=>{let{lineWidth:T,color:D}=x,P=b.asValue(),[[C,S,O],[_,L,w]]=P;return sw(C,S,O,_,L,w)?[]:[{graphMode:129,guid:Ns(),points:[_,L,w,C+_,S+L,O+w],color:D,thickness:T}]});case 118:return p({color:!0,resolution:!0,surfaceOpacity:!0},(b,x)=>{let{color:T,surfaceOpacity:D}=x,P=b.asValue(),[[C,S,O],_]=P,L=Math.abs(_);return isNaN(C)||isNaN(S)||isNaN(O)||isNaN(_)?[]:[{graphMode:118,position:[C,S,O],radius:[L,L,L],guid:Ns(),color:T,surfaceOpacity:D!=null?D:1}]});case 5:case 100:{let b=this.userData,x=this.metaData,T=[],D=p({color:!0,lineOpacity:!0,lineWidth:!0,resolution:!0},(C,S)=>{var _;let O=C.getDependencies();if(O.length===0&&!ua(C.valueType)){let{points:L,droppedIndices:w}=Mm([C.asValue()]);return[{segments:[L],graphMode:3,droppedIndices:w,color:Ra(b,x),style:b.lineStyle,showPoint:!1,poi:go(L)}]}else{let L=C.getCompiledFunction(O);S.domain=(_=L.domain)!=null?_:{type:\"1d\",min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax};let w=cu({viewState:n,graphInfo:S,compiled:L});return[KL(e,w,n,S.lineWidth)]}}),P=[];for(let C of D)C&&P.push(C);if(c.fill)if(P.forEach((C,S)=>{let{color:O,fillOpacity:_,listIndex:L}=uc(this,S,i);T.push({segments:C.segments,color:O,fillOpacity:_,listIndex:L,graphMode:7,poi:Ir()})}),c.lines)P=P.concat(T);else return T;return P}case 20:return p({lineOpacity:!0,lineWidth:!0,color:!0},(b,x)=>{let[[T,D],P]=b.asValue();return isNaN(T)||isNaN(D)||isNaN(P)?[]:[{segments:[[T,D,P]],resolved:!0,graphMode:x.graphMode,color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:x.operator,poi:Ir()}]});case 21:return p({color:!0,lineWidth:!0,lineOpacity:!0},(b,x)=>{let T=Rg(b.asValue());if(!T)return[];let D=[];return T.type===\"arc\"?D.push({graphMode:f,segments:[[T.center[0],T.center[1],T.radius,T.startAngle,T.endAngle]],color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()}):T.type===\"rays\"?D.push({graphMode:19,segments:[[T.start1[0],T.start1[1],T.end1[0],T.end1[1]]],color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()},{graphMode:19,segments:[[T.start2[0],T.start2[1],T.end2[0],T.end2[1]]],color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()}):D.push({graphMode:17,segments:[[T.start[0],T.start[1],T.end[0],T.end[1]]],color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()}),[...D,...o1(D,s)]});case 17:case 18:case 19:return p({color:!0,lineWidth:!0,lineOpacity:!0},(b,x)=>{let[[T,D],[P,C]]=b.asValue();if(isNaN(T)||isNaN(D)||isNaN(P)||isNaN(C))return[];let S=[],O={segments:[[T,D,P,C]],resolved:!0,graphMode:x.graphMode,color:x.color,style:x.lineStyle,arrowMode:x.arrowMode,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()};if(S.push(ew(e,O,n)),S.push(...o1([O],s)),this.userData.showLabel&&r.graphMode===17){let _=x.listIndex,L=this.computedLabels&&this.computedLabels[_||0];S.push({graphMode:22,objectType:17,segments:[[T,D,P,C]],color:x.color,listIndex:_,showLabel:!0,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,labels:L?[L]:[I8(Oi(P-T,C-D),n)]})}return S});case 24:return p({lineOpacity:!0,lineWidth:!0,color:!0},(b,x)=>{let[T,D]=b.asValue(),[[P,C],[S,O]]=[D,[D[0]+T[0],D[1]+T[1]]];if(isNaN(S)||isNaN(O)||isNaN(P)||isNaN(C))return[];let _={segments:[[P,C,S,O]],resolved:!0,graphMode:x.graphMode,color:x.color,style:x.lineStyle,arrowMode:x.arrowMode,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:x.listIndex,operator:r.operator,poi:Ir()};return[ew(e,_,n)]});case 23:return p({lineOpacity:!0,lineWidth:!0,color:!0},(b,x)=>{let{value:T,valueType:D}=b.asTypedValue(),[[P,C],S,O]=T;if(isNaN(P)||isNaN(C)||isNaN(S)||isNaN(O))return[];let _=x.listIndex,L=D===ye,w=L?O:Math.abs(O),U=[];if(U.push({graphMode:23,segments:[[P,C,S,O,L?1:0]],color:x.color,style:x.lineStyle,lineWidth:x.lineWidth,lineOpacity:x.lineOpacity,listIndex:_,operator:r.operator,poi:Ir()}),this.userData.showAngleLabel){let G=this.computedLabels&&this.computedLabels[_||0];U.push({graphMode:22,objectType:23,segments:[[P,C,S,O]],color:x.color,listIndex:_,showLabel:!0,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,labels:G?[G]:[E8(w,n)]})}return U});case 1:case 2:case 8:case 112:case 126:case 113:case 127:case 6:case 130:case 103:case 106:case 107:case 108:case 109:case 110:case 111:case 120:case 121:case 122:case 123:case 124:{let b=t.valueType===I;return p({lineOpacity:!0,lineWidth:!0,resolution:!0,fillOpacity:!0,surfaceOpacity:!0,color:!0},(x,T)=>{var F,Y,re,Ee,he,K,Oe,te,Ze,dt,me;(r.graphMode===6||r.graphMode===110||r.graphMode===124)&&(T.domain={type:\"1d\",min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax,isExplicit:this.metaData.isExplicitDomain});let D=(F=vi[r.graphMode])!=null?F:[],P=x.getCompiledFunction(D);(r.graphMode==130||r.graphMode==103||r.graphMode==111||r.graphMode==109)&&(T.domain=(Y=P.domain)!=null?Y:{type:\"2d\",uMin:this.metaData.evaluatedDomain3DMin1,uMax:this.metaData.evaluatedDomain3DMax1,vMin:this.metaData.evaluatedDomain3DMin2,vMax:this.metaData.evaluatedDomain3DMax2});let C=[],S;try{S=x.getCompiledDerivative()}catch(J){}let O=S8(this,x,P,n,T,S,b);if(O)return O;let _=hC(T.graphMode),L=(re=this.userData.extendTo3D)!=null?re:!1,w=_&&!L,U=!e.is3dPolicy()||w,G=(Ee=this.userData.lines)!=null?Ee:U,Z=(he=this.userData.lines)!=null?he:!w;if(T.graphMode===127&&!L&&((K=this.userData.lines)==null||K)){let J=(Oe=vi[T.graphMode])!=null?Oe:[],W=x._chunk.copy();W.GreaterEqual([W.getReturnIndex(),W.Constant(0)]);let Ge=x.getCompiledFunction(J),be=0,ue=n.viewport,At=_b((_t,bc,xc)=>xc-be,ue);return[{meshData:Wi(At),color:T.color,surfaceOpacity:(te=T.surfaceOpacity)!=null?te:1,uvArgs:(Ze=vi[T.graphMode])!=null?Ze:[],extraMeshArgs:(dt=Ol[T.graphMode])!=null?dt:[],graphMode:106,compiled:Ge,restrictionShader:Ma(W,ac)}]}if(_&&(this.userData.lines===!0?(G=w,Z=!w):this.userData.lines===!1&&(G=!1,Z=!1)),Z&&va(T.graphMode)){let J=zb(T.graphMode);if(T.graphMode===113||T.graphMode===127){let{positions:W,normals:Ge,faces:be,uvs:ue}=JL(),_e={guid:Ns(),isDomainCube:!0,resolved:!0,positions:W,normals:Ge,faces:be,uvs:ue,extraAttrs:new Float32Array([])},At=x.toImplicitBool();C.push({meshData:_e,graphMode:113,color:T.color,surfaceOpacity:1,uvArgs:[],extraMeshArgs:[],compiled:P,restrictionShader:Ma(At._chunk,ac)});let ze=kN(At._chunk,x._chunk,J);for(let Ce of ze){let _t=QL(T,{concrete:new on(Ce.value),restriction:Ce.restriction&&Ma(Ce.restriction,ac)},n);C.push(_t)}}else{let W=x.getRestrictedFunctionForGLSL(J,ac),Ge=QL(T,W,n);C.push(Ge)}}if(G&&C8(this,T),!va(T.graphMode)){let J=cu({viewState:n,graphInfo:T,compiled:P,derivative:S}),W=cw(ou(this),x);if(W&&(J.boundingBox=W),e.is3dPolicy()&&G&&l1(J.graphMode)){let Ge=(me=T.lineWidth)!=null?me:1;C.push(kb(J,n,Ge))}else if(J.fillSegments){let{fillSegments:Ge,...be}=J;G||(be.lineWidth=0),C.push(be)}else G||(J.lineWidth=0),(G||!va(r.graphMode))&&C.push(J);T.graphMode===8&&T.operator!==\"=\"&&C.push({graphMode:7,segments:J.fillSegments,poi:Ir(),listIndex:T.listIndex,color:T.color,fillOpacity:T.fillOpacity})}return C})}case 200:case 201:case 202:case 206:case 205:case 211:case 203:case 204:case 213:case 207:case 208:case 212:case 214:case 215:case 209:return p({color:!0,lineWidth:!0,lineOpacity:!0,resolution:!0},(b,x)=>{var re;let T=(re=vi[f])!=null?re:[],D=b.getCompiledFunction(T).domain;switch(f){case 206:case 211:x.domain={type:\"1d\",min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax,isExplicit:this.metaData.isExplicitDomain};break;case 203:case 204:case 213:case 207:case 208:case 212:case 214:case 215:x.domain=D!=null?D:{type:\"2d\",uMin:this.metaData.evaluatedDomain3DMin1,uMax:this.metaData.evaluatedDomain3DMax1,vMin:this.metaData.evaluatedDomain3DMin2,vMax:this.metaData.evaluatedDomain3DMax2};break}let P={allowSlices:!0},C=tu(b._chunk,T,P),{valueChunk:S,slices:O}=C.getValueAndRestrictionChunk(),_=S.getInstruction(S.getReturnIndex()).valueType,L=ua(_)?Jg(S):S.getCompiledFunction(T),w=O[0],U=w.type===\"implicit\",G=U?NaN:w.value,Z=U?\"_implicit\":w.variable,F,Y=Ee=>cu({viewState:n,graphInfo:{...x,slice_coordinate:Z,slice_value:G,slice_function:Ee},compiled:L});if(U){let Ee=[\"x\",\"y\",\"z\"],he=[\"x\",\"y\",\"z\",\"r\",\"theta\"],K=[\"x\",\"y\",\"z\",\"rho\",\"theta\",\"phi\"],Oe=[\"x\",\"y\",\"z\",\"u\",\"v\"],te=w.sliceChunk;switch(f){case 200:case 201:case 202:F=te.getCompiledFunction(Ee);break;case 211:case 213:F=te.getCompiledFunction(he);break;case 212:F=te.getCompiledFunction(K);break;case 215:case 214:F=te.getCompiledFunction(Oe);break;case 209:{let Ze=(J,W)=>{let Ge=W.getCompiledFunction(Ee),be=J._symbol,ue=J._expression.args,_e=[];for(let At of ue){if(!(At instanceof on))throw z(\"Programming Error: bad type\");if(be===\"x\")L=At._chunk.getCompiledFunction([\"y\",\"z\"]),x.graphMode=201;else if(be===\"y\")L=At._chunk.getCompiledFunction([\"x\",\"z\"]),x.graphMode=202;else if(be===\"z\")L=At._chunk.getCompiledFunction([\"x\",\"y\"]),x.graphMode=200;else throw z(\"Programming Error: bad lhs\");_e.push(Y(Ge))}return _e},dt=(J,W)=>{let Ge=n.viewport,be=W.getCompiledFunction(Ee),ue=J.getCompiledFunction(Ee).fn,_e=r1(ue,Ge);if(_e){let{explicitPlane:At,u:ze,v:Ce}=_e;return x.graphMode=214,L={args:[\"u\",\"v\"],source:\"\",constants:[],fn:At,executionMetadata:{}},x.domain={type:\"2d\",uMin:ze.min,uMax:ze.max,vMin:Ce.min,vMax:Ce.max},[Y(be)]}else return[]};if(te.isImplicitPlane())return dt(te,S);if(S.isImplicitPlane())return dt(S,te);let me=gC(e,S);return me instanceof M.SolvedEquation&&!me.isError?Ze(me,te):(me=gC(e,te),me instanceof M.SolvedEquation&&!me.isError?Ze(me,S):[Y(te.getCompiledFunction(Ee))])}}}return[Y(F)]});case 210:return p({color:!0,surfaceOpacity:!0,resolution:!0},(b,x)=>{var Y,re,Ee,he,K,Oe,te,Ze;let T=(Y=vi[f])!=null?Y:[],D={allowSlices:!0},P=tu(b._chunk,T,D),{restrictionChunk:C,slices:S}=P.getSlicesAndRestrictionChunk(),O=C.getCompiledFunction(T);if(S[0].type===\"implicit\"){let dt=S[0].sliceChunk,me;try{me=dt.copy().gradient([\"x\",\"y\",\"z\"]).getCompiledFunction([\"x\",\"y\",\"z\"]).fn}catch(be){}let J=(re=x.resolution)!=null?re:NaN;return isNaN(J)&&(J=Tm),J=hr(J,0,100),[{meshData:d1(dt.getCompiledFunction(T),void 0,me,n.viewport,J,{isInequality:!1}),color:x.color,surfaceOpacity:(Ee=x.surfaceOpacity)!=null?Ee:1,uvArgs:(he=vi[x.graphMode])!=null?he:[],extraMeshArgs:(K=Ol[x.graphMode])!=null?K:[],graphMode:f,compiled:O,restrictionShader:Ma(C,ac)}]}let _=S[0].value,L=S[0].variable,w=n.viewport,U;switch(L){case\"x\":U=(dt,me,J)=>dt-_;break;case\"y\":U=(dt,me,J)=>me-_;break;case\"z\":U=(dt,me,J)=>J-_;break;default:return[]}let G=_b(U,w);return[{meshData:Wi(G),color:x.color,surfaceOpacity:(Oe=x.surfaceOpacity)!=null?Oe:1,uvArgs:(te=vi[x.graphMode])!=null?te:[],extraMeshArgs:(Ze=Ol[x.graphMode])!=null?Ze:[],graphMode:f,compiled:O,restrictionShader:Ma(C,ac)}]});case 16:{let b=[],x=this.userData.lines===void 0?!0:this.userData.lines,T=this.userData.fill===void 0?!0:this.userData.fill;if(!T&&!x)return b;let D=Dl(this.metaData,[\"computedLineOpacity\",\"computedLineWidth\",\"colorLatexValue\",\"fillOpacity\"],i),P=t.asValue();j(t.valueType)||(P=[P]);for(let C=0;C<P.length;C++){if(C>D-1)continue;let S=P[C];if(!S.length)continue;let O=this.getGraphInfo(e,t),{listIndex:_,lineWidth:L,lineOpacity:w,fillOpacity:U,color:G}=uc(this,C,i);!this.userData.shouldOmitLastPolygonSegment&&S.length>2&&(S=[...S,S[0]]),ms(S);let Z=rw(S);if(Z.length){if(T&&S.length>2&&b.push({segments:Z,graphMode:7,poi:Ir(),color:G,fillOpacity:U,style:O.style,listIndex:_}),x&&(b.push({segments:Z,graphMode:5,poi:Ir(),color:G,style:this.userData.lineStyle,lineWidth:L,lineOpacity:w,listIndex:_}),s))for(let F=0;F<S.length-1;F++){za(s.parentType,[xe,In]);let Y=s.getEdgeIntersections(F);if(!Y)continue;let[re,Ee]=S[F],[he,K]=S[F+1];b.push(...o1([{segments:[[re,Ee,he,K]],resolved:!0,graphMode:17,color:G,style:this.userData.lineStyle,arrowMode:O.arrowMode,lineWidth:L,lineOpacity:w,listIndex:_,poi:Ir()}],Y))}if(T8&&this.userData.showLabel){let F=this.computedLabels&&this.computedLabels[_||0];b.push({graphMode:22,objectType:16,segments:Z,color:G,listIndex:_,showLabel:!0,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,labels:F?[F]:[P8(qE(S),n)]})}}}return b}case 7:case 11:case 10:case 15:case 22:case 128:return!1;default:let h=f;throw new Error(`Unexpected graphMode: ${h}`)}}function QL(e,t,n){var c,l,p;let r=(c=vi[e.graphMode])!=null?c:[],s=t.concrete.getCompiledFunction(r),i,o,a=!1;if(e.graphMode===112||e.graphMode===126||e.graphMode===113){e.operator!==\"=\"&&(a=!0);try{i=t.concrete.gradient([\"x\",\"y\",\"z\"])._chunk,o=i.getCompiledFunction([\"x\",\"y\",\"z\"]).fn}catch(f){}}if(e.graphMode===112&&o&&i){let f=D8(s.fn,o,i,n.viewport);if(f)return{graphMode:118,position:f.center,radius:f.radii,guid:Ns(),color:e.color,restrictionShader:t.restriction,surfaceOpacity:(l=e.surfaceOpacity)!=null?l:1}}let u=e.graphMode;if((u===112||u===113||u===127||u===106||u===107||u===108)&&t.concrete._chunk.isLinearIn([\"x\",\"y\",\"z\"])||u===106&&t.concrete._chunk.isConstant()){let f=n.viewport,d;switch(u){case 106:d=(m,h,b)=>b-s.fn(m,h);break;case 107:d=(m,h,b)=>m-s.fn(h,b);break;case 108:d=(m,h,b)=>h-s.fn(m,b);break;case 112:case 113:case 127:d=s.fn;break}let y=Wi(_b(d,f)),g=u===113||u===127;return u===127&&(u=113),{meshData:y,color:e.color,surfaceOpacity:g?1:(p=e.surfaceOpacity)!=null?p:1,uvArgs:[],extraMeshArgs:[],graphMode:u,compiled:s,restrictionShader:t.restriction}}return cu({viewState:n,graphInfo:e,compiled:s,restrictionShader3d:t.restriction,isImplicit3dInequality:a,gradient:o,dependencies:t.concrete._dependencies})}function C8(e,t){var r,s,i;if(hC(t.graphMode))switch(t.graphMode){case 121:case 123:{t.graphMode=2,t.willConvertTo3D=!0,(r=t.lineWidth)!=null||(t.lineWidth=1);break}case 120:case 122:{t.graphMode=1,t.willConvertTo3D=!0,(s=t.lineWidth)!=null||(t.lineWidth=1);break}case 124:let{min:o,max:a}=((i=t.domain)==null?void 0:i.type)===\"1d\"?t.domain:{min:0,max:2*Math.PI};t.graphMode=6,t.domain={type:\"1d\",min:o,max:a,isExplicit:e.metaData.isExplicitDomain};break;case 126:t.graphMode=8;break}}function D8(e,t,n,r){if(r.zmin===void 0||r.zmax===void 0)return;let s=n.argNames.indexOf(\"x\"),i=n.argNames.indexOf(\"y\"),o=n.argNames.indexOf(\"z\");if(s===-1||i===-1||o===-1)return;let a=n.getInstruction(n.getReturnIndex());if(a.type!==38||a.args.length!==3)return;let[u,c,l]=a.args,p=ns(n,s,{allowRestriction:!1,allowClosedBlockReferences:!1}),f=ns(n,i,{allowRestriction:!1,allowClosedBlockReferences:!1}),d=ns(n,o,{allowRestriction:!1,allowClosedBlockReferences:!1});if(ln(p,u)!==1||ln(f,c)!==1||ln(d,l)!==1||ln(f,u)!==0||ln(d,u)!==0||ln(p,c)!==0||ln(d,c)!==0||ln(p,l)!==0||ln(f,l)!==0)return;let{xmin:y,ymin:g,zmin:m,xmax:h,ymax:b,zmax:x}=r,T=t(y,g,m),D=t(h,b,x),P=.5*(D[0]-T[0])/(h-y),C=.5*(D[1]-T[1])/(b-g),S=.5*(D[2]-T[2])/(x-m),O=(y*D[0]-h*T[0])/(D[0]-T[0]),_=(g*D[1]-b*T[1])/(D[1]-T[1]),L=(m*D[2]-x*T[2])/(D[2]-T[2]),w=-e(O,_,L),U=Math.sqrt(w/P),G=Math.sqrt(w/C),Z=Math.sqrt(w/S);if(!(!isFinite(O)||!isFinite(_)||!isFinite(L)||!isFinite(U)||!isFinite(G)||!isFinite(Z)||U===0||G===0||Z===0))return{center:[O,_,L],radii:[U,G,Z]}}function S8(e,t,n,r,s,i,o){let a=e.metaData.evaluatedCDFMin,u=e.metaData.evaluatedCDFMax,c=ou(e),l=cw(c,t),p=c&&c.discrete;if(a!==void 0&&u!==void 0&&!isNaN(a)&&!isNaN(u)&&o){let f=[];if(p){let d={viewState:r,graphInfo:s,compiled:n,bounds:[a,u],maxOverride:tw(c,t),showPoint:e.userData.shouldGraph},y=YL(d),g=y.cdfTopBranch,m=y.topBranches;if(m.forEach(h=>{!h||!l||(h.boundingBox=l)}),m.every(h=>h!==void 0)&&(f=m,g&&g.segments[0].length)){let h=[];g.segments[0].forEach(b=>{!isNaN(b[0])&&!isNaN(b[1])&&h.push([b[0],0,b[0],b[1]])}),f.push({graphMode:5,segments:h,boundingBox:l,poi:Ir(),color:s.color})}}else{let y=XL({viewState:r,graphInfo:s,compiled:n,derivative:i,bounds:[a,u]}),g=y.cdfTopBranch,m=y.topBranches;if(m.forEach(h=>{!h||!l||(h.boundingBox=l)}),f=m,g&&g.segments.length){let h,b;for(let x=0;x<g.segments.length;x++){let T=g.segments[x];if(T.length>=4){h=T[0];break}}for(let x=g.segments.length-1;x>=0;x--){let T=g.segments[x];if(T.length>=4){b=T[T.length-2];break}}if(h!==void 0&&b!==void 0&&isFinite(h)&&isFinite(b)){let x=Hb(g.segments,[[h,0,b,0]],g.graphMode);f.push({graphMode:7,segments:x,poi:Ir(),color:s.color})}}}return f}else if(p){let f=Nb({viewState:r,graphInfo:s,compiled:n,showPoint:e.userData.shouldGraph,maxOverride:tw(c,t)});return l&&(f.boundingBox=l),[f]}else return}function iw(e){return v8(e)||l1(e)||ow(e)}function v8(e){return e===3}function i1(e,t){let n=t!=null?t:{};if(!Array.isArray(e))return()=>e;let r=Object.keys(n).length===0?e:e.filter((s,i)=>!n[i]);return s=>r[s]}function O8(e){var i,o;let t=e.droppedIndices,n=i1((i=e.pointSize)!=null?i:1,t),r=i1(e.color,t),s=i1((o=e.pointOpacity)!=null?o:1,t);return e.segments[0].map(([a,u],c)=>({graphMode:114,position:[a,u,0],radius:.02*n(c),guid:Ns(),color:r(c),fillOpacity:s(c)}))}function KL(e,t,n,r){return e.is3dPolicy()&&l1(t.graphMode)?kb(t,n,r!=null?r:1):t}function l1(e){switch(e){case 1:case 2:case 6:case 8:case 5:return!0;default:return!1}}function kb(e,t,n,r=0){var o;let s=aw(e,t,r),i=Cm(s,t.viewport,n);return{graphMode:128,guid:Ns(),points:i,resolved:e.resolved,color:e.color,compiled:e.compiled,thickness:(o=e.lineWidth)!=null?o:1}}function ew(e,t,n){return e.is3dPolicy()&&ow(t.graphMode)?N8(t,n):t}function ow(e){switch(e){case 17:case 24:return!0;default:return!1}}function N8(e,t){var r;let n=aw(e,t);return{graphMode:e.graphMode===17?119:e.graphMode===24?129:128,guid:Ns(),points:R8(n),color:e.color,thickness:(r=e.lineWidth)!=null?r:1}}function R8(e){let t=[];for(let[n,r,s]of e)t.push(n,r,s);return t}function aw(e,t,n=0){function r(i,o){if(e.graphMode===1)return[o,i];if(e.graphMode===6){let a=t.degreeMode?i*Math.PI/180:i;return[o*Math.cos(a),o*Math.sin(a)]}else return[i,o]}let s=[];for(let i=0;i<e.segments.length;i++){let o=e.segments[i];for(let a=0;a<o.length/2;a++){let[u,c]=r(o[2*a],o[2*a+1]);s.push([u,c,n])}i<e.segments.length-1&&s.push([NaN,NaN,0])}return s}function Cm(e,t,n){if(t.zmin===void 0||t.zmax===void 0)return[];let{xmin:r,xmax:s,ymin:i,ymax:o,zmin:a,zmax:u}=t,c=s-r,l=o-i,p=u-a,f=n/200,d=[],y=1e-4;for(let h=0;h<e.length;h++){let b=e[h];if(isFinite(b[0])&&isFinite(b[1])&&isFinite(b[2])){let x=d[d.length-1];x!==void 0&&Math.abs(b[0]-x[0])<y*c&&Math.abs(b[1]-x[1])<y*l&&Math.abs(b[2]-x[2])<y*p||d.push(b)}else d.push(void 0)}let g=[],m=d.length;for(let h=0;h<m;h++){let b=d[h];if(!b){g.push(NaN,NaN,NaN);continue}let[x,T,D]=b,P=d[h-1],C=d[h+1];if(P&&C){let[S,O,_]=P,[L,w,U]=C,G=(x-S)/c,Z=(L-x)/c,F=(T-O)/l,Y=(w-T)/l,re=(D-_)/p,Ee=(U-D)/p,he=Ts(G,F,re),K=Ts(Z,Y,Ee);if((Z*G+Y*F+Ee*re)/(he*K)<.7&&he>f&&K>f){let te=.5*(f/he),Ze=.5*(f/K),dt=Po(S,x,1-te),me=Po(O,T,1-te),J=Po(_,D,1-te),W=Po(x,L,Ze),Ge=Po(T,w,Ze),be=Po(D,U,Ze);g.push(dt,me,J),g.push(Po(dt,x,.5),Po(me,T,.5),Po(J,D,.5)),g.push(x,T,D),g.push(Po(x,W,.5),Po(T,Ge,.5),Po(D,be,.5)),g.push(W,Ge,be)}else g.push(x,T,D)}else g.push(x,T,D)}return g}function Po(e,t,n){return(1-n)*e+n*t}function A8(e){return e.startsWith(\"shader:\")}function wb(e,t,n){return{resolved:!0,graphMode:t,segments:n,operator:e.operator,poi:Ir(),color:e.color,style:\"DASHED\",lineWidth:1,lineOpacity:.5,isIntersectionExtension:!0}}function o1(e,t){if(!t)return[];let n=[];for(let r of e){let s=t;if(\"listIndex\"in r&&r.listIndex!==void 0&&t instanceof gd&&(s=t.getListItemIntersections(r.listIndex)),r.graphMode===17||r.graphMode===19){za(s.parentType,[de,Ne]);let i=s.getPoints();if(!i)continue;let o=0,a,u=1,c,[l,p,f,d]=r.segments[0];for(let y=0;y<i.length;y++){let[g,m]=i[y],h=to(g,m,0,l,p,0,f,d,0);h<o&&(o=h,a=y),r.graphMode===17&&h>u&&(u=h,c=y)}a!==void 0&&n.push(wb(r,17,[[l,p,i[a][0],i[a][1]]])),c!==void 0&&n.push(wb(r,17,[[f,d,i[c][0],i[c][1]]]))}else if(r.graphMode===21){za(s.parentType,[ie]);let i=s.getPoints();if(!i)continue;let[o,a,u,c,l]=r.segments[0],p=l-c+(l<c?1:-1)*2*Math.PI,f=[];for(let d of i){let[y,g]=d,m=Math.atan2(g-a,y-o),h=W1(m,c,p);0<h&&h<1&&f.push(h)}if(f.length){f.push(0,1),f.sort();let d=0,y=0;for(let h=0;h<f.length-1;h++){let b=f[h+1]-f[h];(d===void 0||b>d)&&(d=b,y=h)}let g=f[y],m=f[y+1];g>0&&n.push(wb(r,21,[[o,a,u,c,c+g*p]])),m<1&&n.push(wb(r,21,[[o,a,u,l,l-(1-m)*p]]))}}}return n}function _8(){throw new Error(\"Programming error: this function is not expected to be called\")}function uw(e,t,n,r){let s=[];for(let i=0;i<t.otherVariableSolutionData.length;i++){let o=t.otherVariableSolutionData[i];if(!o)continue;let{coefficients:a,restriction:u}=o,c=a.argNames[0];if(c!==\"x\"&&c!==\"y\")continue;let l=a.getCompiledFunction().fn,p,f;c===\"y\"?(p=1,f=2):(p=2,f=1);let d=void 0,{listIndex:y,style:g,lineWidth:m,lineOpacity:h,color:b}=uc(e,i,d),x=Td(n,{graphMode:p,domainBound:dr(),lineWidth:m,operator:\"=\"},_8);if(!x)continue;let T=dw(l,x);for(let D of T){let P=new on(u.substituteConstantArguments({[c]:D})),C=e.getGraphInfo(r,P);C={...C,graphMode:f,lineWidth:m};let O=e._graph(r,P,n,C,void 0,t.branchMultiplier===2?\"solvedEquation\":void 0);if(Bo(O))for(let _ of O)s.push({..._,listIndex:y,style:g,lineWidth:m,lineOpacity:h,color:b})}}return s.length>0?s:!1}M.Base.prototype.tryGraph=function(e,t,n,r){var s,i,o;try{let a=this.graph(e,t,n,r);if(Array.isArray(a))for(let u of a){if(!(\"compiled\"in u))continue;let c=(s=u.compiled)==null?void 0:s.executionMetadata;c&&(c.recursionTerminationStatus&&(u.recursionTerminationStatus=c.recursionTerminationStatus),((i=c.badCoercionCount)!=null?i:0)>=1&&((o=c.goodCoercionCount)!=null?o:0)<=2&&(u.nanBlame=\"ComplexCoercion\"))}return a}catch(a){let u=a instanceof M.Error?a.getError():z(a).getError();return[pw(u)]}};M.Base.prototype.graph=function(e,t,n,r){let s=this.getGraphInfo(e,t);return this._graph(e,t,n,s,r)};M.BaseComparator.prototype.graph=function(e,t,n){let r=this.getGraphInfo(e,t),s=r.graphMode,i=\"baseComparator\",o=this.userData.lines===void 0?!0:this.userData.lines;if(s===8||s===112||s===113||s===127||s===210)return this._graph(e,t,n,r);if(s===10||!(t instanceof M.SolvedEquation))return!1;let a=this.getOperator(),u=[],c=[],l=!0;t._expression.eachElement(m=>{u.push(m.getCompiledFunction());try{c.push(m.getCompiledDerivative())}catch(h){l=!1}}),l||(c=void 0);let p=[],f=[-1,0,0,1],d=Dl(this.metaData,[\"computedLineWidth\",\"computedLineOpacity\",\"computedFillOpacity\",\"colorLatexValue\"],i),y=Math.min(u.length,d);for(let m=0;m<y;m++){let h=this.getGraphInfo(e,t._expression.args[m]);h.graphMode=s;let{listIndex:b,style:x,color:T,lineWidth:D,lineOpacity:P,fillOpacity:C}=uc(this,m,i);h.listIndex=b,h.style=x,h.color=T,r.graphMode===6&&(h.domain={type:\"1d\",min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax,isExplicit:this.metaData.isExplicitDomain});let S=cu({viewState:n,graphInfo:h,compiled:u[m],derivative:c?c[m]:void 0});S.lineWidth=D,S.lineOpacity=P,S.fillOpacity=C,S.operator=nl(Jr[a].inclusive,f[m%4]),o||(S.lineWidth=0),p.push(S)}for(let m=0;m<y;m+=4){let h=Hb(p[m+1].segments,p[m+2].segments,s);p.push({graphMode:7,listIndex:p[m].listIndex,segments:h,poi:Ir(),fillOpacity:p[m].fillOpacity,color:p[m].color})}let g=uw(this,t,n,e);if(g){for(let m of g)m.operator=nl(Jr[a].inclusive,0);Array.prototype.push.apply(p,g)}return p};M.DoubleInequality.prototype.graph=function(e,t,n){let r=this.getGraphInfo(e,t);if(r.graphMode===10)return!1;let s=[],i=nl(Jr[this._operators[0]].inclusive,0),o=nl(Jr[this._operators[1]].inclusive,0),a=this.userData,u=this.metaData,c=a.lines===void 0?!0:a.lines,l=[\"colorLatexValue\",\"computedFillOpacity\"];c&&l.push(\"computedLineWidth\",\"computedLineOpacity\");let p=Dl(u,l),f=t._expressions;return ms(f),Fb.eachArgs(f,(d,y)=>{let g=y;if(g>=p)return;d[0].userData=d[1].userData=a,d[0].metaData=d[1].metaData=u;let m=void 0,{color:h,lineWidth:b,lineOpacity:x,fillOpacity:T}=uc(this,g,m),D=this._graph(e,d[0],n,r)[0];D.listIndex=g,D.operator=i,D.color=h,D.lineWidth=b,D.lineOpacity=x,s.push(D);let P=this._graph(e,d[1],n,r)[0];P.listIndex=g,P.operator=o,P.color=h,P.lineWidth=b,P.lineOpacity=x,s.push(P);let C=D.segments,S=P.segments;ms(C),ms(S);let O=Hb(C,S,D.graphMode);c||(D.lineWidth=0,P.lineWidth=0),s.push({graphMode:7,listIndex:D.listIndex,segments:O,lineOpacity:x,fillOpacity:T,poi:Ir(),color:h})}),s};M.Regression.prototype.graph=function(e,t,n){var i;let r=this.getGraphInfo(e,t),s=this._graph(e,t.model,n,r);if(Array.isArray(s))for(let o of s)(i=this.tableRegressionData)!=null&&i.tableId&&(o.tableId=this.tableRegressionData.tableId);return s};function p1(e,t){let n=1/0,r=-1/0,s=1/0,i=-1/0;for(let o of t)for(let a=0;a<o.length;a+=2){let u=o[a],c=o[a+1];u<n&&(n=u),u>r&&(r=u),c<s&&(s=c),c>i&&(i=c)}if(isFinite(n)&&isFinite(s))return{type:e,xmin:n,ymin:s,xmax:r,ymax:i}}function cw(e,t){if(!e||!(t instanceof on))return;let n=t._chunk,r=n.getInstruction(n.getReturnIndex());if(r.type!==37)return;let s=e.discrete?\"discreteDistribution\":\"continuousDistribution\";if(e.symbol===\"binomialdist\"&&r.symbol===\"binompdf\"){let i=hn(n,r.args[1]),o=hn(n,r.args[2]),a=Cg(o*i,i,o);return{type:s,xmin:0,xmax:i,ymin:0,ymax:a}}if(e.symbol===\"poissondist\"&&r.symbol===\"poissonpdf\"){let i=hn(n,r.args[1]),o=Math.max(lp(Math.floor(i),i),lp(Math.ceil(i),i));return{type:s,xmin:0,xmax:2.5*i,ymin:0,ymax:o}}if(e.symbol===\"normaldist\"&&r.symbol===\"normalpdf\"){let i=hn(n,r.args[1]),o=hn(n,r.args[2]),a=_E(i,i,o);return{type:s,xmin:i-2*Math.abs(o),xmax:i+2*Math.abs(o),ymin:0,ymax:a}}if(e.symbol===\"uniformdist\"&&r.symbol===\"uniformpdf\"){let i=hn(n,r.args[1]),o=hn(n,r.args[2]),a=(i+o)/2,u=o-i,c=VE(a,i,o);return{type:s,xmin:i-u/3,xmax:o+u/3,ymin:0,ymax:c}}if(e.symbol===\"tdist\"&&r.symbol===\"tpdf\"){let i=hn(n,r.args[1]),o=Mg(0,i);return{type:s,xmin:-3,xmax:3,ymin:0,ymax:o}}}function tw(e,t){if(e===void 0||e.symbol!==\"binomialdist\"||!(t instanceof on))return;let n=t._chunk,r=n.getInstruction(n.getReturnIndex());if(r.type===37&&r.symbol===\"binompdf\")return hn(n,r.args[1])}function lw(e,t,n){let r={};n-=.5*t;for(let s=e.length-1;s>=0;s--){let i=e[s],o=Math.floor((i-n)/t);r[o]?r[o].data.push(i):r[o]={id:o,data:[i],min:o*t+n,max:o*t+n+t,center:o*t+n+t/2}}return r}M.Histogram.prototype.graph=function(e,t,n){let r=this.getGraphInfo(e,t),s=t.args[0].asValue(),i=t.args[1].asValue(),o=this.userData.vizProps&&this.userData.vizProps.binAlignment===\"left\"?i/2:0;ms(s);let a=lw(s,i,o),u=1;this.userData.vizProps&&this.userData.vizProps.histogramMode===\"density\"?u=1/(s.length*i):this.userData.vizProps&&this.userData.vizProps.histogramMode===\"relative\"&&(u=1/s.length);let c=[],l=[];for(let f in a){let d=a[f],y=d.data.length;l.push([d.min,0*u,d.min,y*u,d.max,y*u,d.max,0*u]);let g=0;a[d.id+1]&&(g=a[d.id+1].data.length);let m=[d.min,0*u,d.min,y*u,d.max,y*u];g<y&&m.push(d.max,g*u),c.push(m)}let p=p1(\"histogram\",l);return p&&i&&(p.binWidth=i),[{segments:l,graphMode:7,boundingBox:p,poi:Ir(),color:r.color,fillOpacity:.4},{segments:c,graphMode:2,poi:{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}},color:r.color}]};M.DotPlot.prototype.graph=function(e,t,n){let r=this.getGraphInfo(e,t),s=t.args[1].asValue(),i=this.userData.vizProps&&this.userData.vizProps.binAlignment===\"left\"?s/2:0,o=t.args[0].asValue();ms(o);let a=lw(o,s,i),u=!1,c,l=[];for(let m in a){let h=a[m];for(let b=h.data.length-1;b>=0;b--)h.center!==h.data[b]&&(u=!0)}if(this.userData.vizProps&&this.userData.vizProps.dotplotXMode===\"exact\")for(let m in a){c=a[m].data,c.reverse();for(let b=0;b<c.length;b++)l.push([c[b],b+1])}else for(let m in a){let h=a[m];c=h.data;for(let b=0;b<c.length;b++)l.push([h.center,b+1])}let p=p1(\"dotplot\",l);p&&s&&(p.ymin=0,p.xmin-=.5*s,p.xmax+=.5*s,p.binWidth=s);let{computedPointOpacity:f,computedPointSize:d}=this.metaData,y=Aa(f,0),g=this.userData.pointSize?Aa(d,0):14;return[{segments:[l],graphMode:3,boundingBox:p,poi:go(l),color:r.color,style:this.userData.pointStyle,pointSize:g,pointOpacity:y,showPoint:!0,needsDotplotXMode:u}]};M.BoxPlot.prototype.graph=function(e,t,n){let r=this.getGraphInfo(e,t),s=this.metaData.evaluatedAxisOffset,i=this.metaData.evaluatedBreadth,o=t.args[0].asValue();if(ms(o),isNaN(i)||isNaN(s))return!1;let a=Math.min.apply(null,o),u=Math.max.apply(null,o),c=Xc(o,1),l=Xc(o,2),p=Xc(o,3),f=s,d=f-i/2,y=f+i/2,g=i/10,m=[];if(this.userData.vizProps.showBoxplotOutliers){let x=p-c,T=c-1.5*x,D=p+1.5*x;a=1/0,u=-1/0,o.forEach(P=>{T<=P&&P<a&&(a=P),u<P&&P<=D&&(u=P),(P<T||P>D)&&m.push([P,f])})}let h=[[c,d,p,d,p,y,c,y,c,d],[l,d,l,y],[c,f,a,f],[p,f,u,f],[a,f-g,a,f+g],[u,f-g,u,f+g]];if(this.userData.vizProps&&this.userData.vizProps.alignedAxis===\"y\"){for(let x of h)for(let T=0;T<x.length;T+=2){let D=x[T];x[T]=x[T+1],x[T+1]=D}for(let x of m){let T=x[0];x[0]=x[1],x[1]=T}}let b=[{segments:h,graphMode:5,boundingBox:p1(\"boxplot\",h.concat(m)),poi:Ir(),color:r.color}];return m.length&&b.push({segments:[m],graphMode:3,color:r.color,style:\"OPEN\",showPoint:!0,poi:go(m)}),b};function L8(e){return Array.prototype.concat.apply([],e)}M.Table.prototype.isValueDraggable=function(e,t,n){if(!e.columns[t].isIndependent)return!1;let s=this.calcColumns[t].values,i=s&&s[n],o=i&&i.asValue();return!!(typeof o==\"number\"&&isFinite(o)&&i.getDependencies().length===0)};function nw(e){let t=[];for(let n of e)typeof n==\"number\"?t.push(n):t.push(s0(n));return t}M.Table.prototype.graph=function(e,t,n){let r={},s=t.columns[0];if(s.isError)return r;let i=nw(s.asValueMixed());for(let o=1;o<this.columns.length;o++){let a=t.columns[o];if(a.isError)continue;let u=nw(a.asValueMixed()),c=this.columns[o].header.userData,l=this.columns[o].header.metaData;if(c.hidden)continue;let p=Dl(l,[\"colorLatexValue\",\"computedPointSize\",\"computedPointOpacity\"]),f=c.dragMode,d=f===\"X\"||f===\"XY\",y=f===\"Y\"||f===\"XY\",g=!!c.points,m=!!c.lines,h=[],b=[],x=[],T=[],D=[],P=[],C=1/0,S=-1/0,O=1/0,_=-1/0,L={};for(let G=0;G<i.length;G++){let Z=i[G],F=u[G];if(!isFinite(Z)||!isFinite(F)){L[G]=!0,m&&(P.length>1&&D.push(P),P=[]);continue}if(g){if(G>=p)continue;let Y=d&&this.isValueDraggable(t,0,G),re=y&&this.isValueDraggable(t,o,G);Y||re?(x.push([Z,F]),T.push({index:G,dragX:Y,dragY:re})):b.push([Z,F])}m&&P.push([Z,F]),Z<C&&(C=Z),Z>S&&(S=Z),F<O&&(O=F),F>_&&(_=F)}let w=this.columns[o],U={type:\"table\",symbol:\"header\"in w?w.header._symbol:void 0,xmin:C,xmax:S,ymin:O,ymax:_};x.length&&h.push({graphMode:4,segments:[x],color:l.colorLatexValue||c.color,tableId:c.tableId,poi:go(x),movablePointInfo:T,boundingBox:U,pointOpacity:l.computedPointOpacity,pointSize:l.computedMovablePointSize}),b.length&&h.push({segments:[b],droppedIndices:L,graphMode:3,showPoint:!0,poi:go(b),color:l.colorLatexValue||c.color,pointSize:l.computedPointSize,pointOpacity:l.computedPointOpacity,style:c.pointStyle,tableId:c.tableId,boundingBox:U}),(D.length||P.length)&&(D.push(P),h.push({segments:D.map(L8),graphMode:5,poi:Ir(),color:Ra(c,l),style:c.lineStyle,lineWidth:Array.isArray(l.computedLineWidth)?l.computedLineWidth[0]:l.computedLineWidth,lineOpacity:Array.isArray(l.computedLineOpacity)?l.computedLineOpacity[0]:l.computedLineOpacity,tableId:c.tableId,boundingBox:U})),h.length&&(r[c.id]=h)}return r};function w8(e,t,n){return e?t===0&&n===0?e[2].type!==\"none\"||e[3].type!==\"none\":t!==0&&n!==0?e[0].type!==\"none\"&&e[1].type!==\"none\":t!==0?e[0].type!==\"none\":n!==0?e[1].type!==\"none\":!1:!1}M.Image.prototype.graph=function(e,t,n){let r=[];if(t.center.valueType!==N||t.center.getDependencies().length!==0||!t.radianAngle.isConstant||!t.width.isConstant||!t.height.isConstant||!t.opacity.isConstant)return r;let s=[],i=[],o=t.width.asValue()/2,a=t.height.asValue()/2,u=t.radianAngle.asValue();for(let c=-1;c<=1;c++)for(let l=-1;l<=1;l++){let[p,f]=t.center.asValue(),d=[p+c*o*Math.cos(u)+l*a*Math.sin(u),f-c*o*Math.sin(u)+l*a*Math.cos(u)];w8(t.moveStrategy,c,l)&&(s.push(d),i.push([c,l]))}return r.push({segments:[s],scaleFactors:[i],graphMode:4,color:Ra(this.userData,this.metaData),style:this.userData.style,poi:go(s),movablePointInfo:[],pointOpacity:1}),r};function rw(e){let t=[],n=[];for(let[r,s]of e)!isNaN(r)&&!isNaN(s)?t.push(r,s):(t.length>=4&&n.push(t),t=[]);return t.length>=4&&n.push(t),n}function sw(...e){return e.some(t=>isNaN(t))}function f1(e){return Math.abs(e)<5e-8}var Dm=class extends $i{constructor(t,n,r){let{tolerance:s,mathToPixels:i}=t;super({tolerance:s,map:o=>i.mapCoordinatePair(o)}),this.fn=n,this.mappedFn=o=>i.mapY(n(o)),this.derivative=r,this.poiData={zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}},this.zeroBuffer=[],this.extremumBuffer=[]}getPOI(){return Si.pointsOfInterest?(this.poiData.intercept=this.findIntercept(this.fn),this.poiData):{zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}}}addPoint(t){this.segment.length===0&&f1(t[1])&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.updateZeroBuffer(t),this.updateExtremumBuffer(t),super.addPoint(t)}updateZeroBuffer(t){let[n,r]=this.map?this.map(t):t;if(!isFinite(n)||!isFinite(r)){this.zeroBuffer.length=0;return}switch(this.zeroBuffer.length){case 0:{if(f1(t[1]))return;this.zeroBuffer.push(t);return}case 1:if(t[1]===0){this.zeroBuffer.push(t);return}else if(t[1]>0!=this.zeroBuffer[0][1]>0){let s=QP(this.zeroBuffer[0][0],this.zeroBuffer[0][1],t[0],t[1],this.fn);s&&(this.poiData.zeros.x.push(s[0]),this.poiData.zeros.y.push(s[1])),this.zeroBuffer.length=0,this.zeroBuffer.push(t);return}else{this.zeroBuffer.length=0,this.zeroBuffer.push(t);return}case 2:{if(t[1]===0)return;if(t[1]>0!=this.zeroBuffer[0][1]>0){let s=lf(this.zeroBuffer[0][0],this.zeroBuffer[0][1],this.zeroBuffer[1][0],this.zeroBuffer[1][1],t[0],t[1],this.fn);s&&(this.poiData.zeros.x.push(s[0]),this.poiData.zeros.y.push(s[1])),this.zeroBuffer.length=0,this.zeroBuffer.push(t);return}else{this.zeroBuffer.length=0,this.zeroBuffer.push(t);return}}}}updateExtremumBuffer(t){let[n,r]=this.map?this.map(t):t;if(!isFinite(n)||!isFinite(r)){this.extremumBuffer.length=0;return}switch(this.extremumBuffer.length){case 0:{this.extremumBuffer.push(t);return}case 1:{t[1]===this.extremumBuffer[0][1]&&(this.extremumBuffer.length=0),this.extremumBuffer.push(t);return}case 2:if(t[1]===this.extremumBuffer[1][1]){this.extremumBuffer.push(t);return}else if(t[1]>this.extremumBuffer[1][1]!=this.extremumBuffer[1][1]>this.extremumBuffer[0][1]){let s=this.bisectExtremumUsingDerivative(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],t[0],t[1]);s&&(this.poiData.extrema.x.push(s[0]),this.poiData.extrema.y.push(s[1]),!tp(this.extremumBuffer[0][0],this.mappedFn(this.extremumBuffer[0][0]),s[0],this.mappedFn(s[0]),t[0],this.mappedFn(t[0]),this.mappedFn,this.ytolerance)&&s[0]>this.segment[this.segment.length-2]&&(this.pendingPoint=s)),this.extremumBuffer.shift(),this.extremumBuffer.push(t);return}else{this.extremumBuffer.shift(),this.extremumBuffer.push(t);return}case 3:{if(t[1]===this.extremumBuffer[1][1])return;if(t[1]>this.extremumBuffer[1][1]!=this.extremumBuffer[1][1]>this.extremumBuffer[0][1]){let s,i=.5*(this.extremumBuffer[1][0]+this.extremumBuffer[2][0]),o=this.fn(i);o===this.extremumBuffer[1][1]?s=lf(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],t[0],t[1],this.fn):s=this.bisectExtremumUsingDerivative(this.extremumBuffer[1][0],this.extremumBuffer[1][1],i,o,this.extremumBuffer[2][0],this.extremumBuffer[2][1]),s&&(this.poiData.extrema.x.push(s[0]),this.poiData.extrema.y.push(s[1])),this.extremumBuffer.shift(),this.extremumBuffer.shift(),this.extremumBuffer.push(t);return}else{this.extremumBuffer.shift(),this.extremumBuffer.shift(),this.extremumBuffer.push(t);return}}}}bisectExtremumUsingDerivative(t,n,r,s,i,o){let a;if(this.derivative){let u=this.derivative(t),c=this.derivative(i);if(!isNaN(u)&&!isNaN(c)&&(s>n&&u>0&&c<0||s<n&&u<0&&c>0)){let l=QP(t,u,i,c,this.derivative);l&&(a=[l[0],this.fn(l[0])])}}return a||(a=KD(t,n,r,s,i,o,this.fn)),a}breakSegment(){this.zeroBuffer.length=0,this.extremumBuffer.length=0,this.flushPending(),this.segment.length>2&&(this.segments.push(this.segment),f1(this.segment[this.segment.length-1])&&(this.poiData.zeros.x.push(this.segment[this.segment.length-2]),this.poiData.zeros.y.push(this.segment[this.segment.length-1]))),this.segment=[]}findIntercept(t){if(!t)return{x:[],y:[]};let n=t(0);return isFinite(n)?{x:[0],y:[t(0)]}:{x:[],y:[]}}finish(){return{segments:this.getSegments(),resolved:!0,poi:this.getPOI()}}};var{floor:fw}=Math,mw=1e4,Ub=5,yw=(e,t,n)=>({x:e,y:t,z:n}),gw=(e,t,n)=>({x:n,y:e,z:t}),hw=(e,t,n)=>({x:e,y:n,z:t}),Ab=class{constructor(){this.xmin=Dr.xmin;this.xmax=Dr.xmax;this.ymin=Dr.ymin;this.ymax=Dr.ymax;this.zmin=Dr.zmin;this.zmax=Dr.zmax}},F8=0;function Ns(){return\"result_\"+F8++}var bw;(n=>(n.None=void 0,n.ComplexCoercion=\"ComplexCoercion\"))(bw||(bw={}));function V8(){return{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}}}function pw(e){return{graphMode:15,error:e,segments:[]}}function y1(e,t){let n=e[0]+t.min*e[1],r=e[0]+t.max*e[1],s={zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}};if(!isFinite(n)||!isFinite(r))return{segments:[],poi:s,resolved:!0};let i=[[t.min,n,t.max,r]],o=-e[0]/e[1];return!isNaN(o)&&o>=t.min&&o<=t.max&&(s.zeros.x.push(o),s.zeros.y.push(0)),0>=t.min&&0<=t.max&&(s.intercept.x.push(0),s.intercept.y.push(e[0])),{segments:i,poi:s,resolved:!0}}function B8(e,t){let n=y1(e[0],t),r=y1(e[1],t);return n.segments.length&&r.segments.length&&n.segments[0].length===4&&r.segments[0].length===4?{segments:[[n.segments[0][1],r.segments[0][1],n.segments[0][3],r.segments[0][3]]],resolved:!0}:{segments:[],resolved:!0}}function G8(e,t){let n=e(t);return{segments:[[...n,...n]],resolved:!0}}function xw(e,t,n){let{mappedFn:r,jumpTolerance:s,screen:i}=n,[o,a]=e,[u,c]=t,l=Va(o,u),p=r(l),f=i.height;if(!(a<0&&c<0&&(a>=p||c>=p))&&!(a>f&&c>f&&(a<=p||c<=p)))return tp(o,a,l,p,u,c,r,s)}var m1=(e,t,n)=>{let{fn:r,mappedFn:s,jumpTolerance:i,accumulator:o}=n;if(!isFinite(i)||i<=0)return;let a=xw(e,t,n);if(!a)return;let u=(t[0]-e[0])/10,c=[-u,u],l;for(let p=0;p<c.length;p++){let f=e[0]+c[p],d=s(f);isFinite(d)||([f,d]=e,f=e[0],d=e[1]);let y=t[0]+c[p],g=s(y);if(isFinite(g)?l=y:[y,g]=t,xw([f,d],[y,g],n)){let[m,h]=a;o.addPoint([m,r(m)]),o.breakSegment(),o.addPoint([h,r(h)]);return}}return l},g1=class{constructor(t,n,r){let s=i=>n.mathToPixels.mapY(t(i));this.derivative=r,this.accumulator=new Dm(n,t,r),this.fn=t,this.mathToPixels=n.mathToPixels,this.mappedFn=s,this.jumpTolerance=n.tolerance||0,this.screen=n.screen}};function Tw(e,t,n,r){let s=n,i=e(s),o=t.mapY(i);return r>0&&!isFinite(o)&&(s=n+r,i=e(s),o=t.mapY(i)),r>0&&!isFinite(o)&&(s=n-r,i=e(s),o=t.mapY(i)),[s,i,o]}function h1(e,t,n){let r=new g1(e,t,n),{mathToPixels:s,mappedFn:i}=r,o=t.nInitialSamples,[a,u,c]=Tw(e,s,t.min,0);isFinite(c)&&r.accumulator.addPoint([a,u]);for(let l=1;l<o;l++){let p=s.interpolateX(t.min,t.max,l/(o-1)),f=l===o-1?0:Math.abs(a-p)/10,[d,y,g]=Tw(e,s,p,f);if(isFinite(g)&&isFinite(c)){let m=m1([a,c],[d,g],r);m!==void 0&&(d=m,y=e(d),g=s.mapY(y)),r.accumulator.addPoint([d,y])}else if(isFinite(g)&&!isFinite(c)){let m=xs(a,c,d,g,i);if(m!==void 0){m!==d&&r.accumulator.addPoint([m,e(m)]);let h=m1([m,i(m)],[d,g],r);h!==void 0&&(d=h,y=e(d),g=s.mapY(y)),r.accumulator.addPoint([d,y])}}else if(!isFinite(g)&&isFinite(c)){let m=xs(a,c,d,g,i);if(m!==void 0){let h=m1([a,c],[m,i(m)],r);h!==void 0&&(m=h),m!==a&&r.accumulator.addPoint([m,e(m)]),r.accumulator.breakSegment()}}a=d,u=y,c=g}return r.accumulator.finish()}function k8(e){let{fn:t,min:n,max:r}=e,s=Math.floor(n),i=Math.ceil(r),o=!0;i-s+1>mw&&(i=s+(mw-1),o=!1);let a=[];for(let u=s;u<=i;u++){let c=t(u);!isFinite(u)||!isFinite(c)||a.push([u,c])}return{segments:a,resolved:o}}function H8(e,t,n,r){let s=t.min,i=t.max-t.min,o=t.rtoleranceMath,a=Math.floor(i/(Math.PI/n)),u,c,l;function p(f,d){let y=d%2===0?1:-1;if(!r&&y===-1)return!1;let g=d*(Math.PI/n),m=[s,s+1,s+2,s+3],h=!1;for(let b=0,x=m.length;b<x;b++){let T=f(m[b]),D=f(m[b]+g);if(isFinite(T)&&isFinite(D)&&(h=!0),isFinite(T)!==isFinite(D)||Math.abs(T-y*D)>o)return!1}return!!h}for(u=1;u<=a;u++)if(p(e,u)){for(l=u,c=2;c*u<=a;c++)p(e,c*u)||(l=void 0);if(l)break}return l?l*(Math.PI/n):null}function Ew(e){return[e[1]*Math.cos(e[0]),e[1]*Math.sin(e[0])]}function Pb(e,t){if(t.max<t.min)return{segments:[],resolved:!0};if(t.parameterTransform){let p=t.parameterTransform,f=e;e=d=>f(p(d))}let{xtolerance:n,ytolerance:r,ztolerance:s,map:i}=t,o=new $i({xtolerance:n,ytolerance:r,ztolerance:s,map:i}),a=10,u=t.min,c=e(u);isFinite(c[0])&&isFinite(c[1])&&o.addPoint(c);let l=t.nInitialSamples;for(let p=1;p<l;p++){let f=p/(l-1),d=(1-f)*t.min+f*t.max,y=e(d);Sm(e,u,c,d,y,a,o,t.screen),u=d,c=y}return o.finish()}function z8(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Sm(e,t,n,r,s,i,o,a){if(r===t)return;let{xtolerance:u,ytolerance:c,ztolerance:l,map:p}=o,f=Va(t,r),d=e(f),y=p(n),g=p(s),m=p(d),h=isFinite(y[0])&&isFinite(y[1])&&(y.length===2||isFinite(y[2])),b=isFinite(g[0])&&isFinite(g[1])&&(g.length===2||isFinite(g[2])),x=isFinite(m[0])&&isFinite(m[1])&&(m.length===2||isFinite(m[2]));if(i===0||f===t||f===r){o.breakSegment(),b&&o.addPoint(s);return}if(!(!h&&!b)){if(h!==b){let T=t,D=r,P=n,C=s;for(;t!==f&&f!==r;)x==h?(t=f,n=d,y=m,h=x):(r=f,s=d,g=m,b=x),f=t+(r-t)/2,d=e(f),m=p(d),x=isFinite(m[0])&&isFinite(m[1])&&(m.length===2||isFinite(m[2]));h?(Sm(e,T,P,t,n,i-1,o,a),o.breakSegment()):(o.breakSegment(),o.addPoint(s),Sm(e,r,s,D,C,i-1,o,a));return}if(h&&x&&b){let T=z8(y,g),D=to(m[0],m[1],m[2]||0,y[0],y[1],y[2]||0,g[0],g[1],g[2]||0),P=D>.2&&D<.8&&Math.abs(m[0]-(y[0]+D*(g[0]-y[0])))<=u&&Math.abs(m[1]-(y[1]+D*(g[1]-y[1])))<=c&&(y.length===2||Math.abs(m[2]-(y[2]+D*(g[2]-y[2])))<=l);if(T||P||a&&U8(y,m,g,a)){o.addPoint(s);return}}Sm(e,t,n,f,d,i-1,o,a),Sm(e,f,d,r,s,i-1,o,a)}}function U8(e,t,n,{width:r,height:s}){return e[0]<0&&n[0]<0&&(e[0]>=t[0]||n[0]>=t[0])||e[0]>r&&n[0]>r&&(e[0]<=t[0]||n[0]<=t[0])||e[1]<0&&n[1]<0&&(e[1]>=t[1]||n[1]>=t[1])||e[1]>s&&n[1]>s&&(e[1]<=t[1]||n[1]<=t[1])}function q8(){return Wi({positions:[],normals:[],faces:[],uvs:[],resolved:!0,extraAttrs:[]})}function d1(e,t,n,r,s,{isInequality:i}){let o=e.fn,a;return t&&!t.includes(\"z\")?a=hb(o,n,r,\"z\"):t&&!t.includes(\"x\")?a=hb(o,n,r,\"x\"):t&&!t.includes(\"y\")?a=hb(o,n,r,\"y\"):a=DL(o,n,r,s,{isInequality:i}),Wi(a)}function Iw(e,t,n,r,s){let i=Im(e,t,n,r,s,0);return Wi(i)}function $8(e,t,n){let r=e.fn,s=lb((i,o)=>r(i,o),new qe(t.xmin,t.xmax),new qe(t.ymin,t.ymax),new qe(t.zmin,t.zmax),n);return Wi(s)}function Y8(e,t,n){let r=e.fn,s=lb((i,o)=>r(i,o),new qe(t.ymin,t.ymax),new qe(t.zmin,t.zmax),new qe(t.xmin,t.xmax),n,[2,0,1]);return Wi(s)}function X8(e,t,n){let r=e.fn,s=lb((i,o)=>r(o,i),new qe(t.zmin,t.zmax),new qe(t.xmin,t.xmax),new qe(t.ymin,t.ymax),n,[1,2,0]);return Wi(s)}function Z8(e,t,n,r,s,i){let o=i?Math.PI/180:1,a=e.fn,u=Im((c,l)=>[c*Mn(l*o),c*dn(l*o),a(c,l)],t,n,r,s,0);return Wi(u)}function W8(e,t,n,r,s,i){let o=i?Math.PI/180:1,a=e.fn,u=Im((c,l)=>{let p=a(c,l);return[p*Mn(c*o),p*dn(c*o),l,p]},t,n,r,s,1);return Wi(u)}function j8(e,t,n,r,s,i){let o=i?Math.PI/180:1,a=e.fn,u=Im((c,l)=>{let p=a(c,l);return[p*dn(l*o)*Mn(c*o),p*dn(l*o)*dn(c*o),p*Mn(l*o),p]},t,n,r,s,1);return Wi(u)}function Wi(e){let{positions:t,normals:n,faces:r,uvs:s,extraAttrs:i,resolved:o}=e;return{guid:Ns(),positions:new Float32Array(t),normals:new Float32Array(n),faces:new Uint32Array(r),uvs:new Float32Array(s),resolved:o,extraAttrs:new Float32Array(i)}}function Pw(e){for(let t of e)if(t!==0)return!1;return!0}function dw(e,t){let{min:n,max:r,mathToPixels:s,nInitialSamples:i}=t,o=s.interpolateX(n,r,0),a=e(o),u=Pw(a),c=!1,l=[];for(let p=1;p<i;p++){let f=s.interpolateX(n,r,p/(i-1)),d=e(f),y=Pw(d);if(u){o=f,a=d,y||(u=!1);continue}if(y){c?(u=!0,c=!1):c=!0;continue}let g=QD(o,a,f,d,e);g!==void 0&&l.push(g),o=f,a=d}return l}function Mw(e){if(!e)return!1;let t=e.viewport.xmin,n=e.viewport.xmax,r=e.viewport.ymin,s=e.viewport.ymax;return!(!isFinite(t)||!isFinite(n)||n<=t||!isFinite(r)||!isFinite(s)||s<=r||!isFinite(e.screen.width)||e.screen.width<=0||!isFinite(e.screen.height)||e.screen.height<=0)}function zC(e,t){let n=t-e;return 1+Math.ceil(n/(n/1e3))}var bo=.001,fc=new sc(SC(),SC());function Td(e,t,n){var L,w,U,G,Z,F,Y,re,Ee;let{viewport:r,screen:s,xAxisScale:i,yAxisScale:o,degreeMode:a}=e,u=a?Math.PI/180:1,c=e.viewport.xmin,l=e.viewport.xmax,p=e.viewport.ymin,f=e.viewport.ymax,d=(L=e.viewport.zmin)!=null?L:Dr.zmin,y=(w=e.viewport.zmax)!=null?w:Dr.zmax,g=((U=t.domain)==null?void 0:U.type)===\"2d\",{uMin:m,uMax:h,vMin:b,vMax:x}=((G=t.domain)==null?void 0:G.type)===\"2d\"?t.domain:{uMin:0,uMax:1,vMin:0,vMax:1},T=t.lineWidth;if(t.willConvertTo3D||T>3){let he=t.willConvertTo3D?200:e.screen.width,K=T*(l-c)/he,Oe=t.willConvertTo3D?200:e.screen.height,te=T*(f-p)/Oe;c-=K,l+=K,p-=te,f+=te}let P=1/4,C=t.domainBound,S,O=sc.fromRects(gb(r),yb(s),{xAxisScale:i,yAxisScale:o}),_={xmin:c,xmax:l,ymin:p,ymax:f,zmin:d,zmax:y};switch(t.graphMode){case 1:switch(S=Gn(bi([p,f]),C),S.type){case\"empty\":return!1;case\"interval\":p=S.bounds[0],f=S.bounds[1]}let he=Math.max(Ub,1+Math.ceil(Math.abs(O.mapY(f)-O.mapY(p))/P)),K=new sc(O.yScale,O.xScale);return{min:p,max:f,tolerance:P,nInitialSamples:he,mathToPixels:K,screen:{width:s.height,height:s.width}};case 2:{switch(S=Gn(bi([c,l]),C),S.type){case\"empty\":return!1;case\"interval\":c=S.bounds[0],l=S.bounds[1]}let Oe=Math.max(Ub,1+Math.ceil(Math.abs(O.mapX(l)-O.mapX(c))/P));return{min:c,max:l,tolerance:P,nInitialSamples:Oe,mathToPixels:O,screen:s}}case 6:{let Oe=e.degreeMode?Math.PI/180:1;if(((Z=t.domain)==null?void 0:Z.type)!==\"1d\")throw new Error(\"Expected polar graph to have domain\");let{min:te,max:Ze}=t.domain;switch(S=Gn(bi([te,Ze]),C),S.type){case\"empty\":return!1;case\"interval\":te=S.bounds[0],Ze=S.bounds[1]}let dt=Math.max(Ub,1+Math.min(Math.ceil(Oe*Math.abs(Ze-te)/(2*Math.PI)*1e3),12e3)),me=Math.abs(O.mapX(l)-O.mapX(c)),J=Math.abs(O.mapY(f)-O.mapY(p)),W=Math.hypot(me,J),be=Math.hypot(l-c,f-p)/W,ue={min:te,max:Ze,screen:s,nInitialSamples:dt,xtolerance:P,ytolerance:P,rtoleranceMath:be,map:([_e,At])=>O.mapCoordinatePair(Ew([_e,At]))};if(!t.domain.isExplicit){let _e=H8(n,ue,Oe,t.operator===\"=\");_e&&(ue.max=ue.min+_e,ue.nInitialSamples=Math.max(Ub,1+Math.min(Math.ceil(Oe*Math.abs(ue.max-ue.min)/(2*Math.PI)*1e3),12e3)))}return ue}case 5:case 100:{let Oe={min:0,max:1},{min:te,max:Ze}=((F=t.domain)==null?void 0:F.type)===\"1d\"?t.domain:Oe;switch(S=Gn(bi([te,Ze]),C),S.type){case\"empty\":return!1;case\"interval\":te=S.bounds[0],Ze=S.bounds[1]}let dt;return(!isFinite(te)||!isFinite(Ze))&&(dt=Cw,te=qb(te),Ze=qb(Ze)),{min:te,max:Ze,screen:s,nInitialSamples:zC(te,Ze),xtolerance:P,ytolerance:P,ztolerance:P,parameterTransform:dt,map:([me,J])=>O.mapCoordinatePair([me,J])}}case 8:return{xmin:c,xmax:l,ymin:p,ymax:f,mathToPixels:O,tolerance:P};case 106:return{..._,u:new qe(c,l),v:new qe(p,f)};case 120:case 122:case 107:return{..._,u:new qe(p,f),v:new qe(d,y)};case 121:case 123:case 108:return{..._,u:new qe(c,l),v:new qe(d,y)};case 109:return{..._,u:new qe(m,g?h:Dr.xmax),v:new qe(b,g?x:2*Math.PI)};case 124:case 110:{let{min:Oe,max:te}=((Y=t.domain)==null?void 0:Y.type)===\"1d\"?t.domain:{min:0,max:2*Math.PI};return{..._,u:new qe(Oe,te),v:new qe(d,y)}}case 211:{let{min:Oe,max:te}=((re=t.domain)==null?void 0:re.type)===\"1d\"?t.domain:{min:0,max:2*Math.PI/u};return{...{xmin:Oe,xmax:te,ymin:d,ymax:y},u:new qe(Oe,te),v:new qe(d,y),mathToPixels:fc,tolerance:bo}}case 212:{let Oe=g?h:2*Math.PI/u,te=g?x:Math.PI/u;return{...{xmin:m,xmax:Oe,ymin:b,ymax:te},u:new qe(m,Oe),v:new qe(b,te),mathToPixels:fc,tolerance:bo}}case 215:case 214:return{...{xmin:m,xmax:h,ymin:b,ymax:x},u:new qe(m,h),v:new qe(b,b),mathToPixels:fc,tolerance:bo};case 213:{let Oe=g?h:Dr.xmax,te=g?x:2*Math.PI/u;return{...{xmin:m,xmax:Oe,ymin:b,ymax:te},u:new qe(m,Oe),v:new qe(b,te),mathToPixels:fc,tolerance:bo}}case 111:return{..._,u:new qe(m,g?h:2*Math.PI/u),v:new qe(b,g?x:Math.PI/u)};case 117:case 118:case 119:case 129:case 130:case 103:case 112:case 126:case 113:case 127:case 210:case 114:return{..._,u:new qe(m,h),v:new qe(b,x)};case 200:case 201:case 202:case 206:case 205:case 203:case 204:case 207:case 208:{if(t.graphMode===200&&(t.slice_coordinate===\"z\"||t.slice_coordinate===\"_implicit\"))return{xmin:c,xmax:l,ymin:p,ymax:f,mathToPixels:O,tolerance:bo};if(t.graphMode===201&&(t.slice_coordinate===\"x\"||t.slice_coordinate===\"_implicit\"))return{...{xmin:p,xmax:f,ymin:d,ymax:y},mathToPixels:fc,tolerance:bo};if(t.graphMode===202&&(t.slice_coordinate===\"y\"||t.slice_coordinate===\"_implicit\"))return{...{xmin:c,xmax:l,ymin:d,ymax:y},mathToPixels:fc,tolerance:bo};let{min:Oe,max:te}=((Ee=t.domain)==null?void 0:Ee.type)===\"1d\"?t.domain:{min:0,max:2*Math.PI};return{x:new qe(c,l),y:new qe(p,f),z:new qe(d,y),t:new qe(Oe,te),u:new qe(m,h),v:new qe(b,x)}}case 209:return t.slice_coordinate===\"z\"?{xmin:c,xmax:l,ymin:p,ymax:f,mathToPixels:O,tolerance:bo}:t.slice_coordinate===\"x\"?{...{xmin:p,xmax:f,ymin:d,ymax:y},mathToPixels:fc,tolerance:bo}:t.slice_coordinate===\"y\"?{...{xmin:c,xmax:l,ymin:d,ymax:y},mathToPixels:fc,tolerance:bo}:t.slice_coordinate===\"_implicit\"?{..._,u:new qe(c,l),v:new qe(p,f)}:!1;default:return!1}}function Cw(e){return Math.sinh(10*e)/(1-e*e)}function qb(e){if(e===1/0)return 1;if(e===-1/0)return-1;let t=Math.asinh(e);return 2*t/(10+Math.sqrt(100+4*t*t))}function Nb(e){let{viewState:t,graphInfo:n,compiled:r,maxOverride:s,showPoint:i}=e,o=r.fn,a=Td(t,n,o),u;if(!a)u={segments:[],resolved:!0};else{let{min:p,max:f}=a;u=k8({fn:o,min:Math.max(p,0),max:s!==void 0?Math.min(s,f):f})}let{points:c,droppedIndices:l}=Mm(u.segments);return{segments:[c],droppedIndices:l,graphMode:3,color:n.color,style:n.pointStyle,poi:go(u.segments),resolved:u.resolved,showPoint:i}}function J8(e){switch(e){case 120:case 122:return 107;case 121:case 123:return 108;case 124:return 110;case 126:return 112;case 127:return 113;default:return e}}function cu(e){var g,m,h,b,x,T,D,P,C;let{viewState:t,graphInfo:n,compiled:r,derivative:s}=e,i=r.fn,{degreeMode:o}=t,a=o?Math.PI/180:1,u=Td(t,n,i),c,l,p,f=J8(n.graphMode),d=t.xAxisScale===\"linear\"&&t.yAxisScale===\"linear\";if(!u)c={segments:[],resolved:!0};else{switch(f){case 1:case 2:let S=s?s.fn:void 0;c=n.isLinear&&d&&Bo(n.linearCoefficients)?y1(n.linearCoefficients,u):h1(i,u,S);break;case 6:c=Pb(G=>[G,i(G)],u);break;case 8:c=gm(i,u);break;case 5:u.max===u.min?c=G8(i,u.min):c=n.isLinear&&d&&Bo(n.linearCoefficients)?B8(n.linearCoefficients,u):Pb(i,u);break;case 100:let O=r.fn,{min:_,max:L}=((g=n.domain)==null?void 0:g.type)===\"1d\"?n.domain:{min:0,max:1};if(!isFinite(_)||!isFinite(L)){_=qb(_),L=qb(L);let G=O;O=Z=>G(Cw(Z))}let w=new qe(_,L),U=Ml(O,w,n.resolution,t);return{graphMode:100,guid:Ns(),points:U,color:n.color,thickness:n.lineWidth};case 112:case 113:case 130:case 103:case 106:case 107:case 108:case 109:case 110:case 111:{let G=u,{u:Z,v:F}=G,Y=f===112||f===113,re=n.graphMode===122||n.graphMode===123,Ee=Y?Tm:re?2:_L,{resolution:he}=n,K=he===void 0||isNaN(he)?Ee:hr(fw(he),2,100),Oe=bi([Z.min,Z.max]).type!==\"empty\"&&bi([F.min,F.max]).type!==\"empty\",te;switch(Oe&&f){case 103:{let me=r.fn;te=Iw(me,G,Z,F,K);break}case 130:{te=Iw((J,W)=>{let[Ge,be]=r.fn(J,W);return[Ge,be,0]},G,Z,F,K);break}case 106:te=$8(r,G,K);break;case 107:te=Y8(r,G,K);break;case 108:te=X8(r,G,K);break;case 109:te=Z8(r,G,Z,F,K,o);break;case 110:te=W8(r,G,Z,F,K,o);break;case 111:te=j8(r,G,Z,F,K,o);break;case 112:case 113:te=d1(r,e.dependencies,e.gradient,u,K,{isInequality:(m=e.isImplicit3dInequality)!=null?m:!1});break;case!1:te=q8();break}let Ze=n.graphMode===113||n.graphMode===127;return{meshData:te,resolved:te.resolved,color:n.color,surfaceOpacity:Ze?1:(h=n.surfaceOpacity)!=null?h:1,uvArgs:(b=vi[n.graphMode])!=null?b:[],extraMeshArgs:(x=Ol[n.graphMode])!=null?x:[],graphMode:f,compiled:r,restrictionShader:e.restrictionShader3d}}case 200:case 201:case 202:case 211:case 206:case 205:case 203:case 204:case 213:case 207:case 208:case 212:case 214:case 215:case 209:{let G=(J,W,Ge)=>{let be=(Fm,Vm)=>{let Al=Ge(Fm,Vm);return isNaN(Al[0])||isNaN(Al[1])||isNaN(Al[2])?NaN:J(Fm,Vm)},ue=t.viewport,{xmin:_e,xmax:At,ymin:ze,ymax:Ce,zmin:_t,zmax:bc}=ue,xc=(_e+At)/2,nx=(ze+Ce)/2,rx=(_t+bc)/2,OF=At-_e,NF=Ce-ze,RF=bc-_t,$1=gm(be,{...W,map3d:(Fm,Vm)=>{let[Al,Y1,X1]=Ge(Fm,Vm);return isNaN(Al)||isNaN(Y1)||isNaN(X1)?[NaN,NaN,NaN]:[(Al-xc)/OF,(Y1-nx)/NF,(X1-rx)/RF]}});return{segments:$1.segments,resolved:$1.resolved,graphMode:8,color:n.color,lineWidth:n.lineWidth,lineOpacity:n.lineOpacity,listIndex:n.listIndex,operator:n.operator,compiled:r,poi:{}}},Z=r.fn,F=(T=n.slice_value)!=null?T:0,Y=(D=n.slice_coordinate)!=null?D:\"\",re=u,Ee,he,K,Oe=!0,te=(J,W)=>{let be=G(J,u,(ze,Ce)=>{let{x:_t,y:bc,z:xc}=W(ze,Ce,J(ze,Ce));return[_t,bc,xc]}),ue=n.lineWidth,_e=kb(be,t,ue,F),At=_e.points;for(let ze=0;ze<At.length/3;ze++){let Ce=At[3*ze],_t=At[3*ze+1],bc=At[3*ze+2],{x:xc,y:nx,z:rx}=W(Ce,_t,bc);At[3*ze]=xc,At[3*ze+1]=nx,At[3*ze+2]=rx}return _e},Ze=(J,W)=>{let Ge=[];for(let _e=0;_e<J.segments.length;_e++){let At=J.segments[_e];for(let ze=0;ze<At.length/2;ze++){let Ce=At[2*ze],_t=At[2*ze+1];Ge.push(W(Ce,_t))}_e<J.segments.length-1&&Ge.push([NaN,NaN,0])}let be=n.lineWidth,ue=t.viewport;return Cm(Ge,ue,be)},dt=u,me=(J,W)=>{var be;let Ge=G(J,dt,W);return Oe=(be=Ge.resolved)!=null?be:!0,Ze(Ge,W)};switch(f){case 200:{if(Y===\"z\")return te((W,Ge)=>Z(W,Ge)-F,yw);if(Y===\"_implicit\"){let W=n.slice_function.fn;K=me((ue,_e)=>W(ue,_e,Z(ue,_e)),(ue,_e)=>[ue,_e,Z(ue,_e)]);break}let J=Y===\"x\";Ee=J?re.y:re.x,he=J?W=>[F,W,Z(F,W)]:W=>[W,F,Z(W,F)],K=Ml(he,Ee,n.resolution,t);break}case 201:{if(Y===\"x\")return te((W,Ge)=>Z(W,Ge)-F,gw);if(Y===\"_implicit\"){let W=n.slice_function.fn;K=me((ue,_e)=>W(Z(ue,_e),ue,_e),(ue,_e)=>[Z(ue,_e),ue,_e]);break}let J=Y===\"y\";Ee=J?re.z:re.y,he=J?W=>[Z(F,W),F,W]:W=>[Z(W,F),W,F],K=Ml(he,Ee,n.resolution,t);break}case 202:{if(Y===\"y\")return te((W,Ge)=>Z(W,Ge)-F,hw);if(Y===\"_implicit\"){let W=n.slice_function.fn;K=me((ue,_e)=>W(ue,Z(ue,_e),_e),(ue,_e)=>[ue,Z(ue,_e),_e]);break}let J=Y===\"x\";Ee=J?re.z:re.x,he=J?W=>[F,Z(F,W),W]:W=>[W,Z(W,F),F],K=Ml(he,Ee,n.resolution,t);break}case 209:{let J=r.fn;if(Y===\"x\")return te((W,Ge)=>J(F,W,Ge),gw);if(Y===\"y\")return te((W,Ge)=>J(W,F,Ge),hw);if(Y===\"z\")return te((W,Ge)=>J(W,Ge,F),yw);if(Y===\"_implicit\"){let{resolution:W}=n,Ge=W===void 0||isNaN(W)?Tm:hr(fw(W),2,100);K=AL(r.fn,n.slice_function.fn,u,Ge);let be=t.viewport,ue=[];for(let _e=0;_e<K.length/3;_e++)ue.push([K[3*_e],K[3*_e+1],K[3*_e+2]]);K=Cm(ue,be,n.lineWidth);break}else throw new Error(\"Programming Error: unexpected slice coordinate\")}case 206:case 205:{let J=Y===\"z\";Ee=J?re.t:re.z,he=J?W=>[Z(W,F),W,F]:W=>[Z(F,W),F,W],K=HC(he,Ee,n.resolution,t);break}case 211:{let J=r.fn,W;switch(Y){case\"x\":W=(ze,Ce)=>J(ze,Ce)*Mn(ze*a)-F;break;case\"y\":W=(ze,Ce)=>J(ze,Ce)*dn(ze*a)-F;break;case\"r\":W=(ze,Ce)=>J(ze,Ce)-F;break;case\"_implicit\":let At=n.slice_function.fn;W=(ze,Ce)=>At(J(ze,Ce)*Mn(ze*a),J(ze,Ce)*dn(ze*a),Ce,J(ze,Ce),ze);break;default:throw new Error(\"Programming Error: bad slice\")}let Ge=Y===\"x\",be=Y===\"y\",ue=(At,ze)=>[Ge?F:J(At,ze)*Mn(At*a),be?F:J(At,ze)*dn(At*a),ze],_e=G(W,dt,ue);K=Ze(_e,ue),Oe=(P=_e.resolved)!=null?P:!0;break}case 213:{let J=Y===\"x\",W=Y===\"y\",Ge=Y===\"z\",be=r.fn,ue;switch(Y){case\"x\":ue=(Ce,_t)=>Ce*Mn(_t*a)-F;break;case\"y\":ue=(Ce,_t)=>Ce*dn(_t*a)-F;break;case\"z\":ue=(Ce,_t)=>be(Ce,_t)-F;break;case\"_implicit\":let ze=n.slice_function.fn;ue=(Ce,_t)=>ze(Ce*Mn(_t*a),Ce*dn(_t*a),be(Ce,_t),Ce,_t);break;default:throw new Error(\"Programming Error: bad slice\")}let _e=(ze,Ce)=>[J?F:ze*Mn(Ce*a),W?F:ze*dn(Ce*a),Ge?F:be(ze,Ce)],At=G(ue,dt,_e);K=Ze(At,_e);break}case 212:{let J=Y===\"x\",W=Y===\"y\",Ge=Y===\"z\",be=r.fn,ue;switch(Y){case\"x\":ue=(Ce,_t)=>be(Ce,_t)*dn(_t*a)*Mn(Ce*a)-F;break;case\"y\":ue=(Ce,_t)=>be(Ce,_t)*dn(_t*a)*dn(Ce*a)-F;break;case\"z\":ue=(Ce,_t)=>be(Ce,_t)*Mn(_t*a)-F;break;case\"rho\":ue=(Ce,_t)=>be(Ce,_t)-F;break;case\"_implicit\":let ze=n.slice_function.fn;ue=(Ce,_t)=>ze(be(Ce,_t)*dn(_t*a)*dn(Ce*a),be(Ce,_t)*dn(_t*a)*Mn(Ce*a),be(Ce,_t)*Mn(_t*a),be(Ce,_t),Ce,_t);break;default:throw new Error(\"Programming Error: bad slice\")}let _e=(ze,Ce)=>[J?F:be(ze,Ce)*dn(Ce*a)*Mn(ze*a),W?F:be(ze,Ce)*dn(Ce*a)*dn(ze*a),Ge?F:be(ze,Ce)*Mn(Ce*a)],At=G(ue,dt,_e);K=Ze(At,_e),Oe=(C=At.resolved)!=null?C:!0;break}case 215:case 214:{let J=f===214?r.fn:(Ge,be)=>{let[ue,_e]=r.fn(Ge,be);return[ue,_e,0]},W;switch(Y){case\"x\":W=(be,ue)=>J(be,ue)[0]-F;break;case\"y\":W=(be,ue)=>J(be,ue)[1]-F;break;case\"z\":W=(be,ue)=>J(be,ue)[2]-F;break;case\"u\":W=(be,ue)=>be-F;break;case\"v\":W=(be,ue)=>ue-F;break;case\"_implicit\":let Ge=n.slice_function.fn;W=(be,ue)=>{let[_e,At,ze]=J(be,ue);return Ge(_e,At,ze,be,ue)};break;default:throw new Error(\"Programming Error: bad slice\")}K=me(W,J);break}case 203:case 204:{let J=Y===\"r\";Ee=J?re.v:re.u,he=J?W=>[F,W,Z(F,W)]:W=>[W,F,Z(W,F)],K=HC(he,Ee,n.resolution,t);break}case 207:case 208:{let J=Y===\"theta\";Ee=J?re.v:re.u,he=J?W=>[Z(F,W),F,W]:W=>[Z(W,F),W,F],K=SL(he,Ee,n.resolution,t);break}}return{graphMode:100,guid:Ns(),points:K,resolved:Oe,color:n.color,thickness:n.lineWidth}}default:throw new Error(\"Programming Error: unexpected graphmode \"+f)}p=c.poi}if((!p||p.zeros.x.length+p.extrema.x.length+p.intercept.x.length>250)&&(p=V8()),f===1)for(let S in p){if(!p.hasOwnProperty(S))continue;let O=S;l=p[O].y,p[O].y=p[O].x,p[O].x=l}let y={segments:c.segments,resolved:c.resolved,graphMode:f,color:n.color,style:n.lineStyle,lineWidth:n.lineWidth,lineOpacity:n.lineOpacity,listIndex:n.listIndex,operator:n.operator,poi:p,compiled:r};if(f===6){let S=u;y.sampledDomain={min:S.min,max:S.max}}return c.fillSegments&&(y.fillSegments=c.fillSegments),y}function Q8(e,t,n){let r,s,i,o,a=[],u=null;switch(n){case 6:u=Ew;break;case 1:u=function(c){return[c[1],c[0]]};break}for(r=0;r<e.length;r++)for(o=e[r],s=0;s<o.length;s+=2)i=[o[s],o[s+1]],u&&(i=u(i)),a.push(i[0],i[1]);for(r=t.length-1;r>=0;r--)for(o=t[r],s=o.length-2;s>=0;s-=2)i=[o[s],o[s+1]],u&&(i=u(i)),a.push(i[0],i[1]);return a}function Hb(e,t,n){let r=l=>l[l.length-2],s=[],i=0,o=0,a=[],u=[],c=-1/0;for(;;){for(;o<e.length&&!(e[o].length>=2);)o+=1;for(;i<t.length&&!(t[i].length>=2);)i+=1;(o>=e.length||e[o][0]>c)&&(i>=t.length||t[i][0]>c)&&(a.length>0&&u.length>0&&s.push(Q8(a,u,n)),a=[],u=[],c=Math.max(c,o<e.length?r(e[o]):1/0),c=Math.max(c,i<t.length?r(t[i]):1/0));let l=!1;if(o<e.length&&e[o][0]<=c&&(c=Math.max(c,r(e[o])),a.push(e[o]),o+=1,l=!0),i<t.length&&t[i][0]<=c&&(c=Math.max(c,r(t[i])),u.push(t[i]),i+=1,l=!0),!l)break}return s}function Mm(e){let t=[],n={};for(let r=0;r<e.length;r++){let s=e[r],[i,o]=s;!isNaN(i)&&!isNaN(o)?t.push(s):n[r]=!0}return{points:t,droppedIndices:n}}var vi={[8]:[\"x\",\"y\"],[106]:[\"x\",\"y\"],[120]:[\"y\",\"z\"],[122]:[\"y\",\"z\"],[107]:[\"y\",\"z\"],[121]:[\"x\",\"z\"],[123]:[\"x\",\"z\"],[108]:[\"x\",\"z\"],[109]:[\"r\",\"theta\"],[124]:[\"theta\",\"z\"],[110]:[\"theta\",\"z\"],[111]:[\"theta\",\"phi\"],[130]:[\"u\",\"v\"],[103]:[\"u\",\"v\"],[126]:[\"x\",\"y\"],[112]:[\"x\",\"y\",\"z\"],[113]:[\"x\",\"y\",\"z\"],[127]:[\"x\",\"y\"],[201]:[\"y\",\"z\"],[202]:[\"x\",\"z\"],[200]:[\"x\",\"y\"],[206]:[\"theta\",\"z\"],[205]:[\"theta\",\"z\"],[211]:[\"theta\",\"z\"],[203]:[\"r\",\"theta\"],[204]:[\"r\",\"theta\"],[213]:[\"r\",\"theta\"],[207]:[\"theta\",\"phi\"],[208]:[\"theta\",\"phi\"],[212]:[\"theta\",\"phi\"],[214]:[\"u\",\"v\"],[215]:[\"u\",\"v\"],[209]:[\"x\",\"y\",\"z\"],[210]:[\"x\",\"y\",\"z\"]},Ol={[110]:[\"r\"],[111]:[\"rho\"]};function Voe(e){return e.graphMode===3||e.graphMode===25||uu(e.graphMode)}function Boe(e){return uu(e.graphMode)}var Id=class{constructor({enableGeometry:t,enable3d:n,scales:r,includeFunctionParametersInRandomSeed:s,isComplexEnabled:i,customRegressions:o,isRecursionEnabled:a}){this._isGeometry=!1;this._is3dProduct=!1;this._isGeometry=t,this._is3dProduct=n,this._scales=r,this._includeFunctionParametersInRandomSeed=s,this._isComplexEnabled=!!i,this._customRegressions=o,this._isRecursionEnabled=!!a}isGeometryEnabled(){return this._isGeometry}is3dProduct(){return this._is3dProduct}is3dPolicy(){return!1}isComplexEnabled(){return this._isComplexEnabled}isRecursionEnabled(){return this._isRecursionEnabled}polygonUnsupportedPreferTriangle(){return!1}areAllScalesLinear(){return this._scales?this._scales.xAxisScale===\"linear\"&&this._scales.yAxisScale===\"linear\":!0}assignmentForbidden(t){return t===\"x\"||t===\"y\"||t===\"theta\"||t===\"index\"||t===\"dt\"||t.slice(0,3)===\"tmp\"||tt.hasOwnProperty(t)||this.isComplexEnabled()&&t===br}isValidSlider(t){return t===\"x\"||t===\"y\"?!0:!(t.slice(0,3)===\"ans\"||t.slice(0,6)===\"idref_\"||this.assignmentForbidden(t))}sliderVariables(t){return t.indexOf(\"theta\")!==-1&&(t=t.filter(n=>n!==\"r\")),t.filter(n=>!(this.assignmentForbidden(n)||n.slice(0,3)===\"ans\"||n.slice(0,6)===\"idref_\"||n[0]===\"_\"||this.isGeometryEnabled()&&n[0]===\"$\"))}tooManySliderVariables(t,n,r){return r?t.length>=1:t.length>=2&&n.length>=1}graphingEnabled(){return!0}ansEnabled(){return!1}dimensionVarsEnabled(){return!0}validRegressionParameter(t){return t!==\"x\"&&t!==\"y\"}validLHS(t){return t!==\"theta\"&&t.slice(0,6)!==\"idref_\"}unplottablePolarFunction(t,n){return t!==\"theta\"?!1:n.indexOf(\"r\")!==-1}validDoubleInequalitySymbol(t){return t===\"x\"||t===\"y\"}validDoubleInequalityVariables(t){return t.length>2?!1:t.every(this.validDoubleInequalitySymbol)}validExpressionVariables(t){return t.length===1&&t[0]===\"x\"}validSolvedVariable(t){return t===\"x\"||t===\"y\"||t===\"r\"}validImplicitVariables(t){switch(t.length){case 0:return!0;case 1:return t[0]===\"x\"||t[0]===\"y\"||t[0]===\"r\";case 2:return t[0]===\"x\"&&t[1]===\"y\"||t[0]===\"y\"&&t[1]===\"x\"||t[0]===\"r\"&&t[1]===\"theta\"||t[0]===\"theta\"&&t[1]===\"r\";default:return!1}}graphableListVariables(t,n){return t===\"x\"||t===\"y\"||t===\"r\"||n===\"x\"||n===\"y\"}validParametricVariable(t){return t===\"t\"}validParametricVariables(t){return t.length===1&&this.validParametricVariable(t[0])}validInequalityVariables(t){switch(t.length){case 1:return t[0]===\"x\"||t[0]===\"y\"||t[0]===\"r\";case 2:return this.validImplicitVariables(t);default:return!1}}validFirstColumnVariable(t){return t!==\"y\"&&t!==\"r\"&&t!==\"theta\"&&!t.match(/y_(\\d+)/)}validActionVariable(t){return t===\"dt\"||t===\"index\"}complicatedPolarImplicit(t,n){return t===\"theta\"||t===\"r\"&&n!==1}graphMode(t,n,r){if(n.length===0)return t===\"x\"?1:t===\"r\"?6:t===\"y\"?2:10;let s=n[0];return s===\"y\"?1:t===\"x\"?1:t===\"r\"&&s===\"theta\"?6:this.isComplexEnabled()&&t!==\"y\"&&s!==\"x\"?10:2}functionDefinitionGraphMode(t,n){return this.graphMode(t,n)}tableableAsConstant(t){return!(t===\"x\"||t===\"r\"||t===\"theta\")}implicitIndependent(t){return\"x\"}implicitDependency(t){return t.length!==1?\"y\":t[0]===\"y\"?\"x\":t[0]===\"theta\"?\"r\":\"y\"}disabledFeatures(){return[]}shouldIncludeFunctionParametersInRandomSeed(){return this._includeFunctionParametersInRandomSeed}isCustomRegressionSupported(){return this._customRegressions}},$b=class{constructor({beta3d:t,includeFunctionParametersInRandomSeed:n,isComplexEnabled:r,customRegressions:s,isRecursionEnabled:i}){this._isBeta3d=!1;this._isBeta3d=t,this.policy2d=new Id({enableGeometry:!1,enable3d:!0,scales:{xAxisScale:\"linear\",yAxisScale:\"linear\"},includeFunctionParametersInRandomSeed:n,isComplexEnabled:r,customRegressions:s,isRecursionEnabled:i})}isGeometryEnabled(){return!1}is3dProduct(){return!0}is3dPolicy(){return!0}isBeta3d(){return this._isBeta3d}isComplexEnabled(){return this.policy2d.isComplexEnabled()}isRecursionEnabled(){return this.policy2d.isRecursionEnabled()}polygonUnsupportedPreferTriangle(){return!0}areAllScalesLinear(){return!0}graphingEnabled(){return!0}ansEnabled(){return!1}dimensionVarsEnabled(){return!1}validInequalityVariables(t){return this.validImplicitVariables(t)}validFirstColumnVariable(t){return this.policy2d.validFirstColumnVariable(t)}validActionVariable(t){return this.policy2d.validActionVariable(t)}tableableAsConstant(t){return this.policy2d.tableableAsConstant(t)}implicitIndependent(t){return this.policy2d.implicitIndependent(t)}validRegressionParameter(t){return this.policy2d.validRegressionParameter(t)}assignmentForbidden(t){return t===\"x\"||t===\"y\"||t===\"z\"||t===\"r\"||t===\"rho\"||t===\"theta\"||t===\"phi\"||this.policy2d.assignmentForbidden(t)}sliderVariables(t){return t.filter(n=>!(this.assignmentForbidden(n)||n.slice(0,3)===\"ans\"||n.slice(0,6)===\"idref_\"||n[0]===\"_\"))}tooManySliderVariables(t,n,r){return r?this.isBeta3d()?n.length>=1:t.length>=1:n.length>=1}isValidSlider(t){return!(t.slice(0,3)===\"ans\"||t.slice(0,6)===\"idref_\"||this.assignmentForbidden(t))}validLHS(t){return t!==\"phi\"&&this.policy2d.validLHS(t)}unplottablePolarFunction(t,n){return!1}complicatedPolarImplicit(t,n){return!1}validDoubleInequalitySymbol(t){return vm(t)}validDoubleInequalityVariables(t){return t.every(vm)}validExpressionVariables(t){return t.length===2&&t.every(n=>n==\"x\"||n==\"y\")}validSolvedVariable(t){return vm(t)||t===\"r\"||t===\"rho\"}validImplicitVariables(t){return t.every(vm)}graphableListVariables(t,n){return t===\"x\"||t===\"y\"||t===\"z\"||t===\"r\"||t===\"rho\"||n===\"x\"||n===\"y\"}validParametricVariable(t){return t===\"t\"||t===\"u\"||t===\"v\"}validParametricVariables(t){return t.length===1&&this.validParametricVariable(t[0])||t.length===2&&t.every(b1)}functionDefinitionGraphMode(t,n){if(n.length===1)switch(n[0]){case\"x\":return 121;case\"y\":return 120;default:return 10}else if(n.length===2&&n.every(r=>r==\"x\"||r==\"y\"))return 106;return 10}graphMode(t,n,r){if(r!=null||(r=n),n.length===0)switch(t){case\"z\":return r.some(s=>s===\"r\"||s===\"theta\")?109:106;case\"y\":return r.includes(\"z\")?108:123;case\"x\":return r.includes(\"z\")?107:122;case\"r\":return r.indexOf(\"r\")>-1?10:Dw(r);case\"rho\":return 111;default:return 10}switch(t){case\"z\":return n.every(s=>s==\"x\"||s==\"y\")?106:n.every(s=>s==\"r\"||s==\"theta\")?109:10;case\"y\":return n.every(s=>s==\"x\")?r.some(s=>s===\"z\")?108:121:n.every(s=>s==\"x\"||s==\"z\")?108:10;case\"x\":return n.every(s=>s==\"y\")?r.some(s=>s===\"z\")?107:120:n.every(s=>s==\"y\"||s==\"z\")?107:10;case\"r\":return n.every(s=>s==\"theta\")?Dw(r):n.every(s=>s==\"theta\"||s==\"z\")?110:10;case\"rho\":return n.every(s=>s==\"theta\"||s==\"phi\")?111:10;default:return 10}}implicitDependency(t){if(t.length!==2)return\"z\";let n=t[0]<t[1]?t[0]+t[1]:t[1]+t[0];return n===\"xy\"?\"z\":n===\"xz\"?\"y\":n===\"yz\"?\"x\":\"z\"}disabledFeatures(){return[]}shouldIncludeFunctionParametersInRandomSeed(){return this.policy2d.shouldIncludeFunctionParametersInRandomSeed()}isCustomRegressionSupported(){return this.policy2d.isCustomRegressionSupported()}},vm=e=>e===\"x\"||e===\"y\"||e===\"z\",b1=e=>e===\"u\"||e===\"v\";function Dw(e){return e.some(n=>vm(n)||n===\"r\")?110:124}M.Base.prototype.getGraphMode=function(e,t){return 10};M.Base.prototype.graphmodeDependencies=Do;function Do(e,t){let n=t.getDependencies();if(e.is3dProduct()&&t instanceof on){let r=new Set(pL(t._chunk));return n.filter(s=>r.has(s))}else return n}function K8(e,t){let n;return e&&e.hasOwnProperty(\"dragMode\")?e.dragMode===\"AUTO\"?n=t.defaultDragMode:n=e.dragMode:n=t.defaultDragMode,wD(n,t.moveStrategy)}function Sw(e,t){let n=e.is3dPolicy();if(t.isMovablePoint&&!n&&K8(this.userData,t)!==\"NONE\")return t.valueType===R?26:4;let r=Do(e,t);switch(t.valueType){case fr:case H:if(n){if(r.length===0)return 114;if(e.validParametricVariables(r))return r.length==1?100:La(103,t)}return 10;case R:case Ue:case N:case Pt:{let s=se(t.valueType,R);return r.length===0?s?25:3:n&&e.validParametricVariables(r)?r.length===1?5:r.every(b1)?La(130,t):10:e.validParametricVariables(r)?5:10}case I:case ne:return!e.is3dPolicy()&&r.length===1?2:n&&r.length===2&&r.indexOf(\"x\")>-1&&r.indexOf(\"y\")>-1?La(106,t):10}if(r.length>0)return 10;switch(t.valueType){case or:case Wr:return 5;case sr:case $r:return 5;case ir:case Yr:return n?100:10;case Mr:case jr:return n?La(130,t):10;case Pr:case Xr:return n?La(130,t):10;case Er:case Zr:return n?La(103,t):10;case wt:case mr:return n?119:10;case ke:case gr:return n?129:10;case Rn:case yr:return n?117:10;case Hn:case Ar:return n?118:10;case xe:case In:return 16;case ce:case Wn:return 20;case ie:case Fn:return 21;case de:case xn:return 17;case fe:case jn:return 18;case Ne:case Vn:return 19;case le:case Jn:return this instanceof we&&this.getDependencies().length===1?10:24;case Le:case On:case ye:case Nn:return 23;default:return 10}}M.Expression.prototype.getGraphMode=Sw;function vw(e,t){let n=t._expression.getDependencies();if(n.length>1)return 10;if(t._expression.isList&&t._expression.length===0)return 10;let r=t._symbol,s=t.getDependencies();return e.graphMode(r,n,s)}M.Equation.prototype.getGraphMode=M.CallAssignment.prototype.getGraphMode=M.BaseComparator.prototype.getGraphMode=M.ComparatorChain.prototype.getGraphMode=function(e,t){if(t.isError)return 10;let n=Do(e,t),r=t.getDependencies();if(e.is3dPolicy()){let s=10;return n.length>0&&(r.includes(\"z\")?s=this.isInequality()?113:112:s=this.isInequality()?127:126),La(s,t)}return t.isConstant?10:t instanceof M.SolvedEquation?vw(e,t):n.length===1||n.length===2?8:10};function x1(e){var t;return e===106||e===200||e===107||e===201||e===108||e===202?[\"x\",\"y\",\"z\",\"_implicit\"]:e===110||e===211?[\"x\",\"y\",\"z\",\"r\",\"theta\",\"_implicit\"]:e===111||e===212?[\"x\",\"y\",\"z\",\"rho\",\"theta\",\"phi\",\"_implicit\"]:e===109||e===213?[\"x\",\"y\",\"z\",\"r\",\"theta\",\"_implicit\"]:e===103||e===214||e===130||e===215?[\"x\",\"y\",\"z\",\"u\",\"v\",\"_implicit\"]:e===113||e===210||e===112||e===209?[\"x\",\"y\",\"z\",\"_implicit\"]:(t=vi[e])!=null?t:[]}function La(e,t){let n=x1(e),r=t._chunk;try{let i=tu(r,n,{allowSlices:!0}).getSliceVariablesOrImplicit();if(i.length!==1)return e;let o=i[0];return n.indexOf(o)<0?10:lL(e,o)}catch(s){return 10}}M.DoubleInequality.prototype.getGraphMode=function(e,t){let n=t.getDependencies();return e.graphMode(t._symbol,[],n)};M.Assignment.prototype.getGraphMode=function(e,t){if(t instanceof M.SolvedEquation)return vw(e,t);if(this.isEquation(e,t))return this.asEquation().getGraphMode(e,t);let n=Do(e,t),r=this._symbol,s=t.getDependencies();switch(t.valueType){case I:case ne:case $e:switch(n.length){case 0:{let o=e.graphMode(r,[],s);return e.is3dPolicy()?La(o,t):o}case 1:if(t.valueType===ne&&!e.graphableListVariables(r,n[0]))return 10;if(this.isSlider)return 10;let i=e.graphMode(r,n,s);return e.is3dPolicy()?La(i,t):i;default:return e.is3dPolicy()?La(e.graphMode(r,n,s),t):10}case H:if(e.assignmentForbidden(r)||n.length>0&&!e.validParametricVariables(n))return 10;switch(n.length){case 0:return 114;case 1:return 100;case 2:return 103;default:return 10}default:return Sw.call(this,e,t)}};M.FunctionDefinition.prototype.getGraphMode=function(e,t){let n=e.is3dPolicy();if(this._argSymbols.length!==1&&!n)return 10;if(this.recursionInfo){let i=t instanceof on?t.getRecursiveFunctionMetadata():void 0;if((i==null?void 0:i.type)===\"missing-non-recursive-branch\")return 10;if((i==null?void 0:i.recursiveStructure.domainInfo[this._symbol][0])===1)return 10}let r=e.functionDefinitionGraphMode(this._symbol,this._argSymbols),s=Do(e,t);switch(t.valueType){case I:case ne:if(n)return r;switch(s.length){case 0:return r;case 1:return s[0]!==this._argSymbols[0]?10:r;default:return 10}break;default:return 10}};M.Regression.prototype.getGraphMode=function(e,t){return this.isLhsSimple?t.isModelValid?t.model.getDependencies().length!==1?10:2:10:10};function T1(e,t){return t.isError?10:11}M.Histogram.prototype.getGraphMode=T1;M.DotPlot.prototype.getGraphMode=T1;M.BoxPlot.prototype.getGraphMode=T1;M.Image.prototype.getGraphMode=function(e,t){return this.userData.showPoints?this.center.isError||this.radianAngle.isError||this.width.isError||this.height.isError||this.opacity.isError?10:3:10};function Ow(e){let t=0,n=0,r=[],s=Vr(e,e.getReturnIndex());for(let i=0;i<e.instructionsLength();i++){if(!s[i])continue;let o=e.getInstruction(i);o.type===25?r[i]=1:o.type===31||o.type===32?r[i]=r[o.args[0]]+r[o.args[1]]:r[i]=0,Yu(e,o)&&(t+=1,n+=r[o.args[0]])}return{numRestrictions:t,numEqualityRestrictions:n}}function Pd(e,t,n){try{return e$(e,t,n)}catch(r){return r instanceof v?r:z(r)}}function e$(e,t,n){var l,p;if(!e.is3dProduct()||n.isError)return n;if(!(n instanceof on))return z(\"Expected peel error to be checked on an IRExpression\");function r(f,d){let y=d.filter(g=>f.indexOf(g)<0);if(y.length)return kI(y[0]).allowExport().setDependencies(y)}function s(){let f=zb(o),d=t$(e,n);return r(f,d)}function i(){let f=Nw(o),d=n$(e,n,o);return r(f,d)}let o=t.getGraphMode(e,n),a=n._chunk,{numRestrictions:u,numEqualityRestrictions:c}=Ow(a);if(c!==0)if(c===1){if(u!==c&&!t.isInequality())return wT();let y=tu(a,[],{allowSlices:!0}).getSliceVariablesOrImplicit();if(y.length!==1)return ca();let g=x1(o),m=y[0];if(g.indexOf(m)<0)return m===\"_implicit\"?ca().allowExport():zI(m).allowExport().setDependencies([m])}else return LT();return(p=(l=s())!=null?l:i())!=null?p:n}function t$(e,t){let n=Do(e,t);return t.getDependencies().filter(s=>n.indexOf(s)<0)}function n$(e,t,n){let r=Do(e,t),s=new Set;if(t instanceof on){let o=t.getRestrictedFunctionForGLSL(zb(n),ac).concrete;for(let a of o.getDependencies())r.indexOf(a)>-1||s.add(a)}return[...s]}function zb(e){var n;if(!va(e))return[];let t=r$(e)?[\"x\",\"y\",\"z\"]:[];return e===211&&t.push(\"r\"),e===212&&t.push(\"rho\"),t.push(...(n=Ol[e])!=null?n:[]),t.push(...Nw(e).filter(r=>t.indexOf(r)<0)),t}function r$(e){return s$(e)||e==200||e==201||e==202||e==211||e==212||e==213||e==214||e==215}function s$(e){if(!va(e))return!1;switch(e){case 106:case 107:case 108:case 110:case 111:case 109:case 122:case 123:case 112:case 113:case 127:case 130:case 103:case 210:return!0;case 124:case 120:case 121:case 126:case 114:case 117:case 118:case 119:case 129:case 128:case 100:case 200:case 201:case 202:case 206:case 205:case 211:case 203:case 204:case 213:case 207:case 208:case 212:case 214:case 215:case 209:return!1;default:return!1}}function Nw(e){var t;return va(e)?(t=vi[e])!=null?t:[]:[]}function wa(e){if(typeof e==\"string\")return e;if(e===void 0)return\"\";if(isNaN(e))return\"\\\\frac{0}{0}\";if(e===1/0)return\"\\\\infty\";if(e===-1/0)return\"-\\\\infty\";let t=e+\"\";return t=t.replace(/^1e\\+?([-\\d]+)/,\"10^{$1}\"),t=t.replace(/([-\\d\\.]+)e\\+?([-\\d]+)/,\"$1\\\\cdot 10^{$2}\"),t}function i$(e){let t=e+\"\";if(/\\d+\\.?\\d*e[\\+\\-]*\\d+/i.test(t)){let n=\"0\",r=String(t).toLowerCase().split(\"e\"),s=parseFloat(r[0]),i=parseInt(r[1],10),o=Math.abs(i),a=Math.abs(s).toString().split(\".\");if(i<0)t=\"0.\"+new Array(o).join(n)+a.join(\"\");else{let u=a[1];u&&(o=o-u.length),t=a.join(\"\")+new Array(o+1).join(n)}s<0&&(t=\"-\"+t)}return t}function pae(e,t=2){let n=i$(e),r=n.indexOf(\".\");if(r===-1)return n;let s,i;for(i=r+1;i<n.length;i++)if(s){if(n[i]!==s)break}else if(n[i]===\"0\"||n[i]===\"9\")s=n[i];else break;return n.substr(0,Math.max(r+5,i+t))}function Ln(e,t){if(j(e)){let n=[];for(let r=0;r<t.length;r++)n.push(Ln(Ve(e),t[r]));return`\\\\left[${n.join(\",\")}\\\\right]`}switch(e){case I:return wa(t);case R:return Ic(t);case N:{let[i,o]=t;return`\\\\left(${wa(i)},${wa(o)}\\\\right)`}case H:{let[i,o,a]=t;return`\\\\left(${wa(i)},${wa(o)},${wa(a)}\\\\right)`}case Kt:return\"\\\\operatorname{rgb}\\\\left(\"+[Ln(I,t[0]),Ln(I,t[1]),Ln(I,t[2])].join(\",\")+\"\\\\right)\";case xe:{let i=[];for(let o of t)i.push(Ln(N,o));return\"\\\\operatorname{polygon}\\\\left(\"+i.join(\",\")+\"\\\\right)\"}case de:return\"\\\\operatorname{segment}\\\\left(\"+[Ln(N,t[0]),Ln(N,t[1])].join(\",\")+\"\\\\right)\";case fe:return\"\\\\operatorname{line}\\\\left(\"+[Ln(N,t[0]),Ln(N,t[1])].join(\",\")+\"\\\\right)\";case Ne:return\"\\\\operatorname{ray}\\\\left(\"+[Ln(N,t[0]),Ln(N,t[1])].join(\",\")+\"\\\\right)\";case le:let n=t[0],r=t[1],s=[r[0]+n[0],r[1]+n[1]];return`\\\\operatorname{vector}\\\\left(${Ln(N,r)},${Ln(N,s)}\\\\right)`;case ce:return\"\\\\operatorname{circle}\\\\left(\"+[Ln(N,t[0]),Ln(I,t[1])].join(\",\")+\"\\\\right)\";case ie:return\"\\\\operatorname{arc}\\\\left(\"+[Ln(N,t[0]),Ln(N,t[1]),Ln(N,t[2])].join(\",\")+\"\\\\right)\";case Le:return\"\\\\operatorname{angle}\\\\left(\"+[Ln(N,t[0]),Ln(I,t[1]),Ln(I,t[2])].join(\",\")+\"\\\\right)\";case ye:return\"\\\\operatorname{directedangle}\\\\left(\"+[Ln(N,t[0]),Ln(I,t[1]),Ln(I,t[2])].join(\",\")+\"\\\\right)\";case Pn:return`\\\\operatorname{tone}\\\\left(${Ln(I,t[0])},${Ln(I,t[1])}\\\\right)`;default:throw new Error(\"Cannot serialize a value of type \"+oe(e)+\".\")}}function I1(e){let t={};for(let n of We(e.updateRules))t[n]=P1(e,n);return t}function P1(e,t){let{valueType:n,value:r}=e.updateRules[t];return`${qr(t)}=${Ln(n,r)}`}function Aw(e){return e instanceof M.Constant||e instanceof M.ParenSeq&&e.args.length===1&&e.args[0]instanceof M.Constant}function Rw(e){return!!(e instanceof M.Identifier&&e._symbol===br||(e instanceof M.Multiply||e instanceof M.CrossMultiply||e instanceof M.DotMultiply)&&e.args.length===2&&e.args.some(t=>t instanceof M.Identifier&&t._symbol===br)&&e.args.some(t=>Aw(t))||e instanceof M.Negative&&e.args[0]instanceof M.Identifier&&e.args[0]._symbol===br||e instanceof M.FunctionCall&&e._symbol===br&&e.args.length===1&&e.args[0]instanceof M.Constant)}function Nm(e){return!!(Rw(e)||(e instanceof M.Add||e instanceof M.Subtract)&&e.args.some(t=>Rw(t))&&e.args.some(t=>Aw(t))||e instanceof M.Assignment&&Nm(e._expression))}function E1(e){let t;for(let n=0;n<e.length;n++)if(e[n].dependsOn(br)){if(t!==void 0)return;t=n}return t}function Om(e,t){var n;if(t.dependsOn(br))switch(t.type){case\"Identifier\":return M.Constant(1);case\"Negative\":{let r=Om(e,t.args[0]);return r===void 0?void 0:t.copyWithArgs([r])}case\"Multiply\":case\"DotMultiply\":case\"CrossMultiply\":switch(E1(t.args)){case 0:{let s=Om(e,t.args[0]);return s===void 0?void 0:t.copyWithArgs([s,t.args[1]])}case 1:{let s=Om(e,t.args[1]);return s===void 0?void 0:t.copyWithArgs([t.args[0],s])}default:return}case\"Divide\":{if(E1(t.args)!==0)return;let s=Om(e,t.args[0]);return s===void 0?void 0:t.copyWithArgs([s,t.args[1]])}case\"FunctionCall\":return t._symbol===br&&t.args.length===1&&!t.args[0].dependsOn(br)?t.args[0]:t.args.length===1&&t.args[0].type===\"Identifier\"&&t.args[0]._symbol===br&&t._symbol!==void 0&&!((n=e[t._symbol])!=null&&n.isFunction)?M.Identifier(t._symbol):void 0;default:return}}function Yb(e,t){if(t.dependsOn(br))switch(t.type){case\"Add\":case\"Subtract\":switch(E1(t.args)){case 0:{let r=Yb(e,t.args[0]);return r===void 0?void 0:[t.copyWithArgs([r[0],t.args[1]]),r[1]]}case 1:{let r=Yb(e,t.args[1]);return r===void 0?void 0:[t.copyWithArgs([t.args[0],r[0]]),t.type===\"Subtract\"?M.Negative([r[1]]):r[1]]}default:return}default:{let n=Om(e,t);return n===void 0?void 0:[M.Constant(0),n]}}}function o$(e){return e.isError?e.getError():e.valueType===R?e.asValue():+e.asValue()}function a$(e,t,n,r){let s=[],i=!1;for(let o=0;o<n.columns.length;o++){let a=r.columns[o],u=n.columns[o],c=a.isError?[]:a.rawArgs.map(o$),l=Kr(a)?a.isCyclicDependencyError&&ga(u)&&u.isFreeVariable(t):ha(a)&&a.isIndependent,p=o>=1&&!r.columns[0].isError&&!a.isError&&!u.header.userData.hidden;p&&(i=!0);let f={computed:!l,values:c,plotted:p};a.isError&&(f.error=a.getError()),s.push(f)}return s[0].plotted=i,{column_data:s}}function u$(e,t,n){let r={variables:[],errorMap:{},dimensions:{}};if(e.areAllScalesLinear()||(r.errorMap.scale=!0),n.center.isError&&(r.errorMap.center=!0),n.radianAngle.isError&&(r.errorMap.angle=!0),n.width.isError&&(r.errorMap.width=!0),n.height.isError&&(r.errorMap.height=!0),n.opacity.isError&&(r.errorMap.opacity=!0),Object.keys(r.errorMap).length>0)return r.variables=t.getSliderVariables(e,n),r;r.dimensions.x=[],r.dimensions.y=[],r.dimensions.radianAngle=[],r.dimensions.width=[],r.dimensions.height=[],r.dimensions.opacity=[];let s=[n.center,n.radianAngle,n.width,n.height,n.opacity];return s.some(o=>o&&o.valueType&&j(o.valueType))&&(r.is_concrete_list=!0),M.List.eachArgs(s,o=>{let a=o[0].asValue(),u=+o[1].asValue(),c=Math.atan2(Math.sin(u),Math.cos(u));r.dimensions.x.push(+a[0]),r.dimensions.y.push(+a[1]),r.dimensions.radianAngle.push(c),r.dimensions.width.push(+o[2].asValue()),r.dimensions.height.push(+o[3].asValue()),r.dimensions.opacity.push(Math.max(0,Math.min(1,+o[4].asValue())))}),(e.graphingEnabled()?t.getGraphMode(e,n):10)!==10&&(r.is_graphable=!0),n.moveStrategy&&(r.move_strategy=n.moveStrategy),t.center&&(t.center.type===\"Identifier\"?(r.center_reference_id=t.center.referencedStatementId,r.center_reference_symbol=t.center._symbol):t.center.type===\"ParenSeq\"&&n.center.valueType===N&&(r.center_is_point_literal=!0)),r}function c$(e,t,n){let r=n.handler,s=n.minStep,i={},o={};for(let p of r.getDependencies())e.validActionVariable(p)||(i[p]=!0);for(let p of s.getDependencies())o[p]=!0;let a;if(Kr(s))a={status:\"error\",error:s.getError()};else{let p=s.asValue();typeof p==\"number\"&&!isNaN(p)&&p>=0?a={status:\"valid\",value:p}:a={status:\"error\",error:DI().getError()}}let u=Object.keys(i);u.length>0&&(r=rn(u).setDependencies(r.getDependencies()));let c;r.isError&&!C1(e,r)?c={status:\"error\",error:r.getError()}:r.isEmptyAction?c={status:\"empty\"}:c={status:\"maybe-valid\"};let l={handler:c,minStep:a,variables:[]};return mc(l,e,{...i,...o}),l}function l$(){return{operator:\"=\",variables:[]}}function Lw(e,t,n,r){if(Hi(n))return a$(e,t,n,r);if(Af(n))return u$(e,n,r);let s=l$();if(n instanceof M.Ticker)return e.graphingEnabled()?c$(e,n,r):(s.error=z(\"Ticker without graphing\").getError(),s);if(e.is3dProduct()){let c=e,l=n.getGraphMode(c,r);if((l===100||l===5)&&r.getDependencies().length===1){let p=r.getDependencies()[0];(p===\"u\"||p===\"v\"||p===\"t\")&&(s.internal_domain_dependency=p)}}let i=om(n.userData);if(i){let c=r.getCursorContext();if(c)s.cursor_context={...c,selection:i};else if(Kr(r)){let l=d$(e,t,n);l&&(s.cursor_context={...l,selection:i})}}if((n instanceof M.FunctionDefinition||n instanceof M.Assignment||n instanceof M.RecursiveFunctionBaseCase)&&(n._symbol.startsWith(\"_\")||(s.defined_name=n._symbol)),n instanceof Cr&&r instanceof on?s.recursion=r.getRecursiveFunctionMetadata():n instanceof Cr&&r instanceof v&&r.recursionMetadata&&(s.recursion=r.recursionMetadata),n instanceof Qr&&(s.recursion_base_case={symbol:n._symbol,argValue:n.specifiedArg.valid?n.specifiedArg.argValue:void 0}),r.warning!==void 0&&(s.warning=r.warning),r.isError&&!((n instanceof M.FunctionDefinition||n instanceof M.RecursiveFunctionBaseCase)&&!r.blocksExport)&&!r.silent){s.error=r.getError(),s.variables=n.getSliderVariables(e,r),s.is_single_identifier=n instanceof M.Identifier,r.actionValue&&(s.action_value=I1(r.actionValue));let c=_w(e,t,n,r);return c&&(s.geometry=c),s}if(r.valueType===Kt&&r.getDependencies().length===0){let c=r.asValue();s.rgb_value=kc(c[0],c[1],c[2]).formatHex()}r.valueType===ut&&r.getDependencies().length===0&&(s.action_value=I1(r.asValue())),r.moveStrategy&&(s.move_strategy=r.moveStrategy,s.default_drag_mode=r.defaultDragMode),n.isInequality()&&(s.is_inequality=!0),s.operator=n.getOperator(),r instanceof M.SolvedEquation?r._expression.asValue()!==!0&&r._expression.asValue()!==!1&&(s.assignment=r._symbol):n instanceof M.Assignment&&(n._symbol.startsWith(\"_\")||(s.assignment=n._symbol)),n instanceof M.FunctionDefinition&&(s.function_definition=n._symbol);let o=e.graphingEnabled()?n.getGraphMode(e,r):10;if(e.graphingEnabled()&&e.is3dPolicy()&&(!va(o)&&!iw(o)&&(o=10),r instanceof M.OptimizedRegression&&(o=10)),o!==10&&(s.is_graphable=!0,s.expression_type=n.getExpressionType(o,r.valueType),e.is3dPolicy()&&(s.expression_type===\"SINGLE_POINT\"?s.expression_type=\"POINT3D\":s.expression_type===\"POINT_LIST\"&&(s.expression_type=\"POINT3D_LIST\")),r.valueType&&ua(r.valueType)&&(s.map_type=r.valueType),r.isShadeBetween()&&(s.is_shade_between=!0),s.expression_type!==\"POINT3D\"&&s.expression_type!==\"POINT3D_LIST\")){let c=n.tableInfo(e,r);c&&(s.is_tableable=!0,s.table_info=c)}if(r.valueType!==void 0&&j(r.valueType)&&(s.is_concrete_list=!0,r.valueType===rr&&r.getDependencies().length===0)){let c=r.asValue();c&&(s.rgb_value=c.map(l=>kc(l[0],l[1],l[2]).formatHex()))}if(s.variables=s.is_graphable?[]:n.getSliderVariables(e,r),s.is_single_identifier=n instanceof M.Identifier,r.isTypedConstant){let c=r.asTypedValue();s.typed_constant_value=c,p$(c==null?void 0:c.valueType)&&(s.geometry=_w(e,t,n,r))}if(r.getEvaluationInfo()&&s.operator===\"=\"&&!n.isConstant&&!n.isFunction&&!(n instanceof M.RecursiveFunctionBaseCase)&&r.valueType!==De&&r.valueType!==Xn&&!(n instanceof M.Equation)&&!(n instanceof M.ComparatorChain)&&!(e.isComplexEnabled()&&Nm(n))&&(s.is_evaluable=!0),r instanceof M.OptimizedRegression){let c=r,l={};for(let p of We(c.parameters))c.parameters.hasOwnProperty(p)&&(l[qr(p)]=+c.parameters[p].asValue());s.is_regression=!0,s.regression={parameters:l,displayPrecision:c.displayPrecision,residualVariable:qr(c.residualVariable),residualSuggestionId:c.residualSuggestionId,shouldSuggestLogMode:c.shouldSuggestLogMode,isLinear:c.isLinear,statistics:c.statistics,parameterWarning:c.parameterWarning}}let u=ou(n);return u&&u.discrete&&(s.is_discrete_distribution=!0),s}function p$(e){switch(e){case N:case Pt:case fe:case jn:case de:case xn:case Ne:case Vn:case le:case Jn:case ce:case Wn:case ie:case Fn:case xe:case In:case Le:case On:case ye:case Nn:case Re:case Rr:return!0;default:return!1}}function _w(e,t,n,r){let s={};r.valueType!==void 0&&(s.valueType=r.valueType),s.valueType&&se(s.valueType,N)&&e.graphingEnabled()&&uu(n.getGraphMode(e,r))&&(s.isMovablePoint=!0);let{identifier:i,listAccess:o,tree:a}=ah(n);if(i&&(s.identifier=i),o&&(s.listAccess=o),a&&(s.call=a,r.valueType&&se(r.valueType,Re)&&n instanceof Cr)){let c=n._expression;s.transformation_preview_info={type:a.symbol,args:c.args.slice(1).map(l=>l.tryGetConcreteTree(e,t).asTypedValue())}}let u=r.moveStrategy&&r.moveStrategy[0];if(u&&\"initialValue\"in u&&u.initialValue!==void 0&&(s.gliderParameter=u.initialValue),Object.keys(s).length>0){let c=n.getLegalExports(e);return{parentDependencies:n.getDependencies().filter(p=>!tt[p]&&!c.includes(p)),...s}}}function d$(e,t,n){let r=om(n.userData);if(!r)return;let{input:s,start:i,end:o}=r;if(s.trim()===\"\")return{type:\"empty\",allowedTypes:[Qt]};let a=\"\\\\cursor\",u=s.slice(0,i)+a+\" \"+s.slice(o),c={start:i,end:i+a.length},l=Mi(u,{...n.parseOptions});return l.userData={...n.userData,latex:u,latexSelection:c},l.isError?l.getCursorContext():od({policy:e,frame:t},l).getCursorContext()}function mc(e,t,n){let r=e.variables;if(r&&r.length){let s={};for(let i of r)s[i]=!0;for(let i of We(n))s[i]=!0;n=s}e.variables=t.sliderVariables(We(n))}function C1(e,t){if(t.blocksExport)return!1;let n=t.getDependencies();if(n.length===0)return!1;for(let r of n)if(!e.validActionVariable(r))return!1;return!0}var q=class{constructor(t,n,r,s){this.policy=t,this.rawTree=r,this.concreteTree=s,this.evaluationState=Lw(t,n,r,s)}graph(t,n){return this.rawTree.tryGraph(this.policy,this.concreteTree,t,n)}getGraphMode(){return this.policy.graphingEnabled()?this.rawTree.getGraphMode(this.policy,this.concreteTree):10}getGraphInfo(){return this.rawTree.getGraphInfo(this.policy,this.concreteTree)}shouldIntersect(){if(!this.evaluationState.is_graphable||!this.rawTree.userData.shouldGraph||!Si.pointsOfInterest)return!1;let t=this.getGraphMode();return t===1||t===2}};var ww=new M.Constant(Se(0,1));M.Assignment.prototype.getMoveStrategy=function(e,t,n,r){return this._expression.getMoveStrategy(e,t,n,r)};function f$(e){return{type:\"updateSliderNonlinear\",id:e.id,initialValue:e.initialValue,min:e.min,max:e.max,compiled:e.compiled,isComplex:e.isComplex}}function m$(e){return{type:\"updateGliderParameter\",span:e.span,movesOn:e.movesOn}}function y$(e){return{type:\"updateSliderForGlider\",id:e.sliderId,movesOn:e.movesOn,min:e.min,max:e.max}}function Fw(e,t,n,r,s,i){let o=t.getDependencies();for(let a of o)if(s[a])return;for(let a=o.length-1;a>=0;a--){let u=o[a];if(i[u])continue;let c=r[u];if(c===void 0)continue;let l=n[u];if(l.order!==1)continue;let f=l.tree.getPolynomialCoefficients(u),d=f[1]||ww,y=f[0]||ww;if(!y.isConstant||!d.isConstant||!isFinite(y.asValue())||!isFinite(d.asValue())||d.asValue()===0)continue;let g=[-y.asValue()/d.asValue(),1/d.asValue()];return{symbol:u,id:c,coefficients:g}}}function g$(e,t){for(let n in t)if(t[n].evaluationState.assignment===e)return n}function h$(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;return t}function D1(e,t){let n=h$(e),r={};for(let s in t){let i=t[s].evaluationState.assignment;t[s].evaluationState.is_slidable&&n[i]&&(r[i]=s)}return r}function Vw(e,t,n,r){let s=[];for(let i=0;i<n.length;i++){let o=n[i],a={};s.push(a);for(let u=0;u<r.length;u++){let c=r[u],l=Tn(t);l[c]=void 0;let p=o.tryGetConcreteTree(e,l);if(p.isError){a[c]={tree:p,order:1/0};continue}else a[c]={tree:p,order:p.polynomialOrder(c)}}}return s}function Bw(e,t,n){for(let r=0;r<e.length;r++){let s=e[r];t[s].order!==0&&(n[s]=!0)}}M.ParenSeq.prototype.getMoveStrategy=function(e,t,n,r){return Gw(this,e,t,n,r)};function Gw(e,t,n,r,s){var h;let i=r.valueType===R;if(r.valueType!==N&&!i||r.getDependencies().length!==0)return;if(i&&Nm(e)){let b=e.getInputSpan();return b?[{type:\"updateCoordinate\",inputSpan:b},{type:\"updateCoordinate\",inputSpan:b}]:void 0}let o=e.getDependencies(),a=D1(o,s),u=We(a),c;i?c=Yb(n,e):c=e.args;let l=[{type:\"none\"},{type:\"none\"}];if(c){let b=Vw(t,n,c,u),x={},T={};for(let D=0;D<2;D++){let P=c[D],C=e.args[D];if(C.isConstant&&!i){let O=C.getInputSpan();l[D]=O?{type:\"updateCoordinate\",inputSpan:O}:{type:\"none\"};continue}let S=Fw(t,P,b[D],a,x,T);S&&(l[D]={type:\"updateSlider\",id:S.id,coefficients:S.coefficients},x[S.symbol]=!0,Bw(u,b[D],T)),l[D]||(l[D]={type:\"none\"})}i&&(l[0].type===\"updateSlider\"&&l[1].type===\"none\"?c[1].tryGetConcreteTree(t,n).valueType!==I&&(l[0]={type:\"none\"}):l[0].type===\"none\"&&l[1].type===\"updateSlider\"&&c[0].tryGetConcreteTree(t,n).valueType!==I&&(l[1]={type:\"none\"}))}let[p,f]=l,d;if(p.type===\"none\"&&f.type===\"none\"&&u.length===1&&(d=u[0]),!d)return p.type!==\"none\"||f.type!==\"none\"?l:void 0;let y=a[d],g;try{let b=Tn(n);b[d]=void 0,g=e.getConcreteTree(t,b).getCompiledFunction()}catch(b){return}f0(g);let m=s[y].evaluationState;return[f$({id:y,initialValue:(h=m.typed_constant_value)==null?void 0:h.value,min:m.slider_min_number,max:m.slider_max_number,compiled:g,isComplex:i}),{type:\"none\"}]}function b$(e,t,n,r,s){if(!r.isTypedConstant||r.valueType!==N)return;let i,o,a;switch(e.args[1].type){case\"Constant\":{if(typeof e.args[1].asValue()!=\"number\"||(i=e.args[0].getConcreteTree(t,n),!i.isTypedConstant))return;a=i.asTypedValue();let c=e.args[1].getInputSpan();return[c?m$({span:c,movesOn:a}):{type:\"none\"},{type:\"none\"}]}case\"Identifier\":{let u=e.args[1]._symbol,l=D1([u],s)[u];if(l===void 0)return;let p=s[l].evaluationState,f=Tn(n);return f[u]=void 0,i=e.args[0].getConcreteTree(t,f),i.isTypedConstant?(a=i.asTypedValue(),o={min:p.slider_min_number,max:p.slider_max_number},[y$({min:o.min,max:o.max,movesOn:a,sliderId:l}),{type:\"none\"}]):void 0}default:return}}function kw(e,t,n,r,s){if(r.valueType===R)return Gw(e,t,n,r,s)}M.Expression.prototype.getMoveStrategy=function(e,t,n,r){return kw(this,e,t,n,r)};M.FunctionCall.prototype.getMoveStrategy=function(e,t,n,r){return this._symbol==\"glider\"?b$(this,e,t,n,r):kw(this,e,t,n,r)};M.Image.prototype.getMoveStrategy=function(e,t,n,r){if(n.center.valueType!==N||n.center.getDependencies().length!==0||!n.width.isConstant||!n.height.isConstant||!n.radianAngle.isConstant||!n.opacity.isConstant)return;let s=this.getDependencies(),i=D1(s,r),o=We(i),a=[this.width,this.height];this.center.type===\"ParenSeq\"?a.push(this.center.args[0],this.center.args[1]):this.center.type===\"Identifier\"&&(this.center.referencedStatementId=g$(this.center._symbol,r));let u={},c={},l=Vw(e,t,a,o),p=[],f=[2,3,0,1];for(let d=0;d<f.length;d++){let y=f[d],g=a[y];if(!g){p[y]={type:\"none\"};continue}if(g.isConstant){let h=g.getInputSpan();p[y]=h?{type:\"updateCoordinate\",inputSpan:h}:{type:\"none\"};continue}let m=Fw(e,g,l[y],i,u,c);m&&(p[y]={type:\"updateSlider\",id:m.id,coefficients:m.coefficients},u[m.symbol]=!0,Bw(o,l[y],c)),p[y]||(p[y]={type:\"none\"})}if(!(p[0].type===\"none\"&&p[1].type===\"none\"&&p[2].type===\"none\"&&p[3].type===\"none\"))return p};var S1=e=>e==null?void 0:e.some(t=>\"isComplex\"in t&&t.isComplex);M.Base.prototype.analyze=function(e,t){return hs(this)?bs(e,t,this):new q(e,t,this,this.tryGetConcreteTree(e,t))};function Xb(e,t,n,r){if(r.isError)return new q(e,t,n,r);if(!e.areAllScalesLinear()&&!Ul(r.valueType)){let u=Yl(oe(r.valueType));return u.setCursorContext(r.getCursorContext()),new q(e,t,n,u)}let s=Do(e,r),i=r.getDependencies(),o,a=se(r.valueType,R)&&s.some(u=>e.validParametricVariable(u));switch(r instanceof M.IRExpression&&i.length>0&&!a&&(r=r.coerceToNumericIfPossible()),r.valueType){case Lt:case Zn:case $e:{o=r;break}case Kt:case rr:case de:case xn:case ce:case Wn:case ie:case Fn:case fe:case jn:case Ne:case Vn:case le:case Jn:case Le:case On:case ye:case Nn:case Re:case Rr:case ut:case xe:case In:case wt:case mr:case ke:case gr:case Rn:case yr:case Hn:case Ar:case Pn:case cs:s.length?o=rn(n.getSliderVariables(e,r)).setDependencies(s):o=r;break;case N:case H:case Pt:case fr:case R:case Ue:if(s.length)if(e.validParametricVariables(s))o=r;else{let u=n.getSliderVariables(e,r);o=rn(u).setDependencies(u)}else o=r;break;case sr:case or:case Pr:case Mr:case ir:case Er:case $r:case Wr:case Xr:case jr:case Yr:case Zr:{s.length===0?o=r:o=rn(n.getSliderVariables(e,r)).setDependencies(s);break}case I:case ne:s.length===0?o=r:s.length<=(e.is3dPolicy()?2:1)?e.is3dPolicy()&&i.length>s.length&&!e.validImplicitVariables(i)?o=rn(n.getSliderVariables(e,r)).setDependencies(i):e.validExpressionVariables(s)?o=r:o=wy(e.implicitDependency(s)).setDependencies(s):e.validImplicitVariables(s)?o=wy().setDependencies(s):o=rn(n.getSliderVariables(e,r)).setDependencies(i);break;default:o=z(`Programming error: unexpected value type ${r.valueType}`)}return Kr(o)&&o.setCursorContext(r.getCursorContext()),o=Pd(e,n,o),new q(e,t,n,o)}function Uw(e){return new M.FunctionCall(\"pdf\",[e,new M.Identifier(\"x\")])}M.Identifier.prototype.analyze=function(e,t,n){if(this._symbol===br){let i=v1(this,e,t,this.tryGetConcreteTree(e,t),n);if(i)return new q(e,t,this,i)}let r=this.tryGetConcreteTree(e,t,{coerceToNumber:\"all-except-complex\"}),s=Xb(e,t,this,r);return hs(this)&&!N1(s)?bs(e,t,this):s};M.FunctionCall.prototype.analyze=function(e,t,n){let r;Qh[this._symbol]&&xl(t,this).length===0&&!e.is3dPolicy()?r=Uw(this).tryGetConcreteTree(e,t):r=this.tryGetConcreteTree(e,t);let s=Xb(e,t,this,r);if(hs(this)&&!N1(s))return bs(e,t,this);let i=this.getMoveStrategy(e,t,r,n);if(i){let o=this.getDefaultDragMode(i),a=r.asCompilerValue(),u=[new M.Constant(a[0]),new M.Constant(a[1])];return r=Zb(r,S1(i)?new M.MovableComplexNumber(u,i,o):new M.MovablePoint(u,i,o)),new q(e,t,this,r)}return s};function v1(e,t,n,r,s,i){if(r.valueType!==R)return;let o=e.getMoveStrategy(t,n,r,s);if(!o)return;let a=(i!=null?i:e).getDefaultDragMode(o),u=r.asCompilerValue();return r=Zb(r,new M.MovableComplexNumber([new M.Constant(u[0]),new M.Constant(u[1])],o,a)),r.metaData=e.metaData,r}M.Expression.prototype.analyze=function(e,t,n){let r=Xb(e,t,this,this.tryGetConcreteTree(e,t));if(hs(this)&&!N1(r))return bs(e,t,this);let s=v1(this,e,t,r.concreteTree,n);return s?new q(e,t,this,s):r};M.FunctionDefinition.prototype.analyze=function(e,t){var a;if(hs(this))return bs(e,t,this);if(tt[this._symbol])return this.asEquation().analyze(e,t);let n=this._symbol.split(\"_\")[0];if((a=tt[n])!=null&&a.isFunction)return new q(e,t,this,Zl(this._symbol,n));let r=this.tryGetConcreteTree(e,t);if(r instanceof M.Error&&!r.blocksExport&&this._argSymbols.length===1){let u=Tn(t);u[this._argSymbols[0]]=new we(\"identityTransformation\");let c=this._expression.tryGetConcreteTree(e,u);if(c instanceof on&&se(c.valueType,Re))return new q(e,t,this,c)}if(e.is3dPolicy()&&e.assignmentForbidden(this._symbol))return new q(e,t,this,zy(this._symbol));if(r.isError)return new q(e,t,this,r);let s=this._argSymbols,i=r.getDependencies();r instanceof M.IRExpression&&i.length>0&&(r=r.coerceToNumericIfPossible());let o=i.filter(u=>s.indexOf(u)===-1);if(e.unplottablePolarFunction(this._symbol,i))return new q(e,t,this,qI());if(o.some(u=>e.assignmentForbidden(u)))return new q(e,t,this,Xd(o,this._symbol,s).setDependencies(i));if(o.length){let u=this.getSliderVariables(e,r);return new q(e,t,this,rn(u).setDependencies(u))}return!e.areAllScalesLinear()&&!Ul(r.valueType)?new q(e,t,this,Yl(oe(r.valueType))):(r=Pd(e,this,r),new q(e,t,this,r))};M.Assignment.prototype.analyze=function(e,t,n){if(hs(this))return bs(e,t,this);let r=this._symbol;if(!e.validLHS(r))return new q(e,t,this,UI(r));if(tt.hasOwnProperty(r)||e.isComplexEnabled()&&r===br)return this.asEquation().analyze(e,t);let s;if(this._expression instanceof M.FunctionCall&&Qh[this._expression._symbol]&&xl(t,this).length===0&&!e.is3dPolicy())s=Uw(this._expression).tryGetConcreteTree(e,t);else{let d=Tn(t);d[r]=e.validSolvedVariable(r)?void 0:Ac(),s=this.tryGetConcreteTree(e,d)}if(s.isError)return new q(e,t,this,s);if(!e.areAllScalesLinear()&&!Ul(s.valueType))return new q(e,t,this,Yl(oe(s.valueType)));if(this.isEquation(e,s))return this.asEquation().analyze(e,t);let i=s.valueType===Kt||s.valueType===rr;if(e.assignmentForbidden(r)&&i){let d=HI(r).allowExport().setDependencies([r]);return new q(e,t,this,d)}let o=s.getDependencies(),a=Do(e,s);s instanceof M.IRExpression&&!(this.getGraphMode(e,s)===5&&!e.assignmentForbidden(r))&&(o.length>0||e.graphMode(r,a,o)!==10)&&(s=s.coerceToNumericIfPossible());let u=a.includes(\"x\")||a.includes(\"y\"),c=a.includes(\"r\")||a.includes(\"theta\");if(r===\"r\"&&o.includes(\"phi\")){let d=a.includes(\"z\")?Oy():BI();return new q(e,t,this,d)}if(r===\"rho\"&&a.includes(\"z\")){let d=o.includes(\"phi\")?Oy():GI();return new q(e,t,this,d)}let l=this.getSliderVariables(e,s,o);if(e.tooManySliderVariables(o,l,i)||u&&c){let d=rn(l).allowExport().setDependencies(l);return new q(e,t,this,d)}let p=v1(this._expression,e,t,s,n,this);if(p)return new q(e,t,this,p);let f=this.getMoveStrategy(e,t,s,n);if(f){let d=this.getDefaultDragMode(f);return s=Zb(s,S1(f)?new M.MovableComplexNumber([s.slot(0),s.slot(1)],f,d):new M.MovablePoint([s.slot(0),s.slot(1)],f,d)),new q(e,t,this,s)}return s=Pd(e,this,s),new q(e,t,this,s)};M.RecursiveFunctionBaseCase.prototype.analyze=function(e,t){if(hs(this))return bs(e,t,this);if(!this.specifiedArg.valid)return new q(e,t,this,this.specifiedArg.error);let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=this._argSymbols,s=n.getDependencies();if(e.is3dPolicy()&&e.assignmentForbidden(this._symbol))return new q(e,t,this,zy(this._symbol));let i=s.filter(o=>r.indexOf(o)===-1);if(i.includes(this.specifiedArg.argSymbol))return new q(e,t,this,Ox(this.specifiedArg.argSymbol));for(let o of i)if(e.assignmentForbidden(o))return new q(e,t,this,vx(o));if(i.length){let o=this.getSliderVariables(e,n);return new q(e,t,this,rn(o).setDependencies(o))}return!e.areAllScalesLinear()&&!Ul(n.valueType)?new q(e,t,this,Yl(oe(n.valueType))):new q(e,t,this,n)};function Hw(e,t,n){let r=new we(n).tryGetConcreteTree(e,t);if(Kr(r))return r;if(r.isTypedConstant){let s=r.asTypedValue();if(s!==void 0)return s}return IT()}function x$(e){return e[1]!==0&&!isNaN(e[1])}function zw(e){return e.valueType===Ue&&e.value.some(x$)}function T$(e,t,n){let[r,s]=n.variables,i=Hw(e,t,r),o=Hw(e,t,s);if(!(\"value\"in i))return i;if(!(\"value\"in o))return o;if(zw(i)||zw(o))return TT(oe(R))}M.Regression.prototype.analyzeRegression=function(e,t,n,r,s){if(!e.isCustomRegressionSupported()&&!this.tableRegressionData)return new q(e,t,this,CP());if(hs(this))return bs(e,t,this);let i={policy:e,frame:t,exportFrame:n,lastExportFrame:r,tableStatements:s};if(this.tableRegressionData){let a=T$(e,t,this.tableRegressionData);if(a)return new q(e,t,this,a)}let o=iL(i,this);if(o instanceof Wa&&o.model instanceof M.IRExpression&&(o.model=o.model.coerceToNumericIfPossible()),this.tableRegressionData&&o instanceof Wa){let a=We(o.parameters).filter(u=>!/^regressionparameter_/.test(u));if(a.length)return new q(e,t,this,rn(a))}return new q(e,t,this,o)};function O1(e,t){let n=this.tryGetConcreteTree(e,t),r=n.getDependencies();return r.length?new q(e,t,this,rn(this.getSliderVariables(e,n)).setDependencies(r)):new q(e,t,this,this.tryGetConcreteTree(e,t))}M.Histogram.prototype.analyze=function(e,t){return hs(this)?bs(e,t,this):e.areAllScalesLinear()?O1.call(this,e,t):new q(e,t,this,NT())};M.DotPlot.prototype.analyze=function(e,t){return hs(this)?bs(e,t,this):e.areAllScalesLinear()?O1.call(this,e,t):new q(e,t,this,RT())};M.BoxPlot.prototype.analyze=function(e,t){return hs(this)?bs(e,t,this):e.areAllScalesLinear()?O1.call(this,e,t):new q(e,t,this,AT())};function qw(e){return function(t,n){if(hs(this))return bs(t,n,this);let r=this.tryGetConcreteTree(t,n),s=r.getDependencies();if(s.length)return new q(t,n,this,rn(this.getSliderVariables(t,r)).setDependencies(s));let i=new q(t,n,this,this.tryGetConcreteTree(t,n));if(!r.isError){i.evaluationState.expression_type=\"TTEST\";let o=r.args.map(a=>a.asValue());i.evaluationState.ttest_results=e.apply(null,o)}return i}}M.TTest.prototype.analyze=qw(GE);M.IndependentTTest.prototype.analyze=qw(kE);M.Stats.prototype.analyze=function(e,t){if(hs(this))return bs(e,t,this);let n=this.tryGetConcreteTree(e,t),r=n.getDependencies();if(r.length)return new q(e,t,this,rn(this.getSliderVariables(e,n)).setDependencies(r));let s=new q(e,t,this,this.tryGetConcreteTree(e,t));if(!n.isError){s.evaluationState.expression_type=\"STATS\";let i=n.args.map(o=>o.asValue());s.evaluationState.stats_results=HE.apply(null,i)}return s};M.Equation.prototype.analyze=M.CallAssignment.prototype.analyze=M.BaseComparator.prototype.analyze=I$;function I$(e,t){if(hs(this))return bs(e,t,this);if(this.getOperator()!==\"=\"&&!Si.plotInequalities)return new q(e,t,this,Ry());let r=uL({policy:e,frame:t},this);if(r.isError)return new q(e,t,this,r);let s=Do(e,r);if(r instanceof M.SolvedEquation&&s.length){let i=s.concat(r._symbol);if(!e.validImplicitVariables(i))return new q(e,t,this,Ac().setDependencies(i))}return this.getGraphMode(e,r)===8&&!e.validImplicitVariables(s)?new q(e,t,this,Ac().setDependencies(s)):(r=Pd(e,this,r),new q(e,t,this,r))}M.DoubleInequality.prototype.analyze=function(e,t){if(hs(this))return bs(e,t,this);if(!Si.plotInequalities)return new q(e,t,this,Ry());let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=n.getDependencies();return Jr[this._operators[0]].direction!==Jr[this._operators[1]].direction?new q(e,t,this,_y()):e.validDoubleInequalitySymbol(n._symbol)?e.validDoubleInequalityVariables(r)?r.length>2?new q(e,t,this,rn(this.getSliderVariables(e,n)).setDependencies(r)):n._expressions[0].getDependencies().indexOf(n._symbol)!==-1||n._expressions[1].getDependencies().indexOf(n._symbol)!==-1?new q(e,t,this,Ly().setDependencies(r)):new q(e,t,this,n):new q(e,t,this,Ay().setDependencies(r)):new q(e,t,this,Ay().setDependencies(r))};M.ComparatorChain.prototype.analyze=function(e,t){if(hs(this))return bs(e,t,this);let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=n.getDependencies();if(r.length)if(e.is3dPolicy()){if(!e.validImplicitVariables(r))return new q(e,t,this,(this.symbols.includes(\"=\")?YI():jI()).setDependencies(r));if(!(this.symbols.every(i=>i===\"<\"||i===\"<=\")||this.symbols.every(i=>i===\">\"||i===\">=\")||this.symbols.every(i=>i===\"=\")))return new q(e,t,this,_y().setDependencies(r));if(this.symbols.includes(\"=\")&&!r.includes(\"z\"))return new q(e,t,this,JI().setDependencies(r));let s=this._difference.tryGetConcreteTree(e,t);return s=Pd(e,this,s),new q(e,t,this,s)}else return this.symbols.includes(\"=\")?new q(e,t,this,QI()):this.symbols.length>2?new q(e,t,this,$x()):e.validDoubleInequalityVariables(r)?new q(e,t,this,Ly()):new q(e,t,this,rn(this.getSliderVariables(e,n)).setDependencies(r));return new q(e,t,this,n)};M.ParenSeq.prototype.analyze=function(e,t,n){if(hs(this))return bs(e,t,this);let r=this.tryGetConcreteTree(e,t);if(r.isError)return new q(e,t,this,r);let s=this.getMoveStrategy(e,t,r,n);if(s){let i=this.getDefaultDragMode(s),o=r.asCompilerValue(),a=[new M.Constant(o[0]),new M.Constant(o[1])];return r=Zb(r,new M.MovablePoint(a,s,i)),new q(e,t,this,r)}return Xb(e,t,this,r)};M.Table.prototype.analyze=function(e,t){let n=this.getConcreteTree(e,t),r=new q(e,t,this,n);return r.evaluationState.is_graphable=!0,r};M.Image.prototype.analyze=function(e,t,n){let r=this.tryGetConcreteTree(e,t);if(r.radianAngle.isError||r.center.isError||r.width.isError||r.height.isError||r.opacity.isError)return new q(e,t,this,r);let s=r.center.getDependencies(),i=r.radianAngle.getDependencies(),o=r.width.getDependencies(),a=r.height.getDependencies(),u=r.opacity.getDependencies();return s.length||i.length||o.length||a.length||u.length?new q(e,t,this,new M.Image({center:s.length?rn(i).setDependencies(s):r.center,radianAngle:i.length?rn(i).setDependencies(i):r.radianAngle,width:o.length?rn(o).setDependencies(o):r.width,height:a.length?rn(a).setDependencies(a):r.height,opacity:u.length?rn(u).setDependencies(u):r.opacity})):(r.moveStrategy=this.getMoveStrategy(e,t,r,n),new q(e,t,this,r))};M.Slider.prototype.analyze=function(e,t){if(hs(this))return bs(e,t,this);let n=this.tryGetConcreteTree(e,t),r=n.sliderInfo,s;if(r.missingVars.length){let o=ux(r.missingVars);s=new q(e,t,this,rn(e.sliderVariables(o)).setDependencies(o).allowExport())}else s=new q(e,t,this,n);let i=s.evaluationState;if(Si.sliders){i.assignment=r.exportedSymbol,i.slider_min_number=r.values.min,i.slider_max_number=r.values.max,i.slider_step_number=r.values.step,i.slider_min_valid=r.valids.min,i.slider_max_valid=r.valids.max,i.slider_step_valid=r.valids.step;let o=i.slider_min_valid&&i.slider_max_valid&&i.slider_step_valid;i.is_slider=!0,i.raw_slider_latex=this.getInputString(),i.is_slidable=o,i.is_animatable=i.is_slidable&&!i.is_graphable,r.errMsg&&(i.error=r.errMsg.getError())}return delete i.is_evaluable,s};function hs(e){return e.userData&&\"latex\"in e.userData&&oa(e.userData.latex).slice(-1)===\"=\"}function bs(e,t,n){return new q(e,t,n,qd(\"=\"))}function N1(e){return e.concreteTree.isConstant&&e.concreteTree.valueType===I||e.concreteTree.isTypedConstant&&e.concreteTree.valueType===R}function Zb(e,t){return t.warning=e.warning,t}M.Base.prototype.analyzeFourFunction=function(e,t){let n=this.tryGetConcreteTree(e,t);return n.isError?new q(e,t,this,n):new q(e,t,this,z(`Unexpected node type ${this.type}`))};M.Expression.prototype.analyzeFourFunction=function(e,t){let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=n.getDependencies();if(r.length>0){let s=r[0],i,o=tt[s];return o?i=o.isFunction?Li(s,e):_c(s):i=Kd(s),new q(e,t,this,i)}return new q(e,t,this,n)};M.Assignment.prototype.analyzeFourFunction=function(e,t){return new q(e,t,this,ef())};M.FunctionDefinition.prototype.analyzeFourFunction=function(e,t){return new q(e,t,this,tf())};function $w(e,t){return new q(e,t,this,Ua())}M.Equation.prototype.analyzeFourFunction=$w;M.CallAssignment.prototype.analyzeFourFunction=$w;function R1(e,t){return new q(e,t,this,Lc())}M.DoubleInequality.prototype.analyzeFourFunction=R1;M.ComparatorChain.prototype.analyzeFourFunction=R1;M.BaseComparator.prototype.analyzeFourFunction=R1;M.Regression.prototype.analyzeFourFunction=function(e,t){return new q(e,t,this,wc())};M.ParenSeq.prototype.analyzeFourFunction=function(e,t){return new q(e,t,this,Fc())};M.Base.prototype.analyzeScientific=function(e,t){let n=this.tryGetConcreteTree(e,t);return n.isError?new q(e,t,this,n):new q(e,t,this,z(`Unexpected node type ${this.type}`))};M.Expression.prototype.analyzeScientific=function(e,t){let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=n.getDependencies();return r.length>0?new q(e,t,this,rn(r)):new q(e,t,this,n)};M.Assignment.prototype.analyzeScientific=function(e,t){let n=this._symbol;if(tt[n])return new q(e,t,this,Zl(n));let r=Tn(t);r[n]=Ua();let s=this.tryGetConcreteTree(e,r);if(s.isError)return new q(e,t,this,s);let i=s.getDependencies();return this.isEquation(e,s)?new q(e,t,this,Ua()):i.length>0?new q(e,t,this,rn(i)):new q(e,t,this,s)};M.FunctionDefinition.prototype.analyzeScientific=function(e,t){if(tt[this._symbol])return new q(e,t,this,Zl(this._symbol));let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=this._argSymbols,s=n.getDependencies();if(s.indexOf(this._symbol)!==-1)return new q(e,t,this,Rc([this._symbol],{suggestAlternativeFunctionName:!1}));let i=s.filter(o=>r.indexOf(o)===-1);return i.length?new q(e,t,this,Xd(i,this._symbol,r)):new q(e,t,this,n)};function Yw(e,t){return new q(e,t,this,Ua())}M.Equation.prototype.analyzeScientific=Yw;M.CallAssignment.prototype.analyzeScientific=Yw;function A1(e,t){return new q(e,t,this,Lc())}M.DoubleInequality.prototype.analyzeScientific=A1;M.ComparatorChain.prototype.analyzeScientific=A1;M.BaseComparator.prototype.analyzeScientific=A1;M.Regression.prototype.analyzeScientific=function(e,t){return new q(e,t,this,wc())};M.ParenSeq.prototype.analyzeScientific=function(e,t){return new q(e,t,this,Fc())};M.Base.prototype.analyzeSingleExpressionScientific=function(e,t){let n=this.tryGetConcreteTree(e,t);return n.isError?new q(e,t,this,n):new q(e,t,this,z(`Unexpected node type ${this.type}`))};M.Expression.prototype.analyzeSingleExpressionScientific=function(e,t){let n=this.tryGetConcreteTree(e,t);if(n.isError)return new q(e,t,this,n);let r=n.getDependencies();if(r.length>0){let s=r[0],i,o=tt[s];return o?i=o.isFunction?Li(s,e):_c(s):i=Kd(s),new q(e,t,this,i)}return new q(e,t,this,n)};M.Assignment.prototype.analyzeSingleExpressionScientific=function(e,t){return new q(e,t,this,ef())};M.FunctionDefinition.prototype.analyzeSingleExpressionScientific=function(e,t){return new q(e,t,this,tf())};function Xw(e,t){return new q(e,t,this,Ua())}M.Equation.prototype.analyzeSingleExpressionScientific=Xw;M.CallAssignment.prototype.analyzeSingleExpressionScientific=Xw;function _1(e,t){return new q(e,t,this,Lc())}M.DoubleInequality.prototype.analyzeSingleExpressionScientific=_1;M.ComparatorChain.prototype.analyzeSingleExpressionScientific=_1;M.BaseComparator.prototype.analyzeSingleExpressionScientific=_1;M.Regression.prototype.analyzeSingleExpressionScientific=function(e,t){return new q(e,t,this,wc())};M.ParenSeq.prototype.analyzeSingleExpressionScientific=function(e,t){return new q(e,t,this,Fc())};M.Base.prototype.getGraphInfo=function(e,t){let n=t.getDependencies(),r,s;switch(n.length){case 0:r=Zw(t),s=t.boundDomain(\"x\");break;case 1:s=t.boundDomain(n[0]),hi(s)&&!Fs(s)&&(r=Zw(t));break;default:s=dr();break}return{graphMode:this.getGraphMode(e,t),color:Ra(this.userData,this.metaData),pointStyle:this.userData.pointStyle,lineStyle:this.userData.lineStyle,arrowMode:this.userData.arrowMode,operator:this.getOperator(),isLinear:!!r,linearCoefficients:r,domainBound:s}};function Zw(e){switch(e.valueType){case I:return L1(e);case N:{let t=L1(e.slot(0)),n=L1(e.slot(1));return!t||!n?void 0:[t,n]}default:return}}function L1(e){let t=e.getDependencies();switch(t.length){case 0:return[+e.asValue(),0];case 1:if(e.polynomialOrder(t[0])>1)return;let n=e.getPolynomialCoefficients(t[0]);return[n[0]?+n[0].asValue():0,n[1]?+n[1].asValue():0];default:return}}M.Assignment.prototype.getDefaultDragMode=function(e){return e[0].type!==\"none\"&&e[1].type!==\"none\"?\"XY\":e[0].type!==\"none\"?\"X\":e[1].type!==\"none\"?\"Y\":\"NONE\"};M.Expression.prototype.getDefaultDragMode=function(e){return e[0].type===\"updateSlider\"&&e[1].type===\"updateSlider\"?\"XY\":e[0].type===\"updateSlider\"?\"X\":e[1].type===\"updateSlider\"?\"Y\":e[0].type===\"updateSliderNonlinear\"&&e[0].isComplex?\"X\":\"NONE\"};M.FunctionCall.prototype.getDefaultDragMode=function(e){return M.Assignment.prototype.getDefaultDragMode.call(this,e)};var P$=M.List;M.Base.prototype.tableInfo=function(e,t){return!1};M.Identifier.prototype.tableInfo=function(e,t){return e.validFirstColumnVariable(this._symbol)?{independent_variable:this._symbol,dependent_column:this.getInputString(),by_reference:!1}:!1};M.Expression.prototype.tableInfo=function(e,t){let n=t.getDependencies();if(ou(this))return!1;switch(t.valueType){case N:case Pt:return n.length!==0||t.isMovablePoint&&(t.moveStrategy[0].type===\"updateSlider\"||t.moveStrategy[1].type===\"updateSlider\")?!1:{independent_variable:\"x\",dependent_column:\"y\",by_reference:!1,values:P$.wrap(t).asValue()};case I:if(n.length!==1)return!1;let s=n[0];return e.validFirstColumnVariable(s)?{independent_variable:s,dependent_column:this.getInputString(),by_reference:!1}:!1;default:return!1}};M.Assignment.prototype.tableInfo=function(e,t){if(t instanceof M.SolvedEquation||!this.getInputString().length||ou(this)||Sd(t.valueType))return!1;let n=t.getDependencies();if(n.length>1)return!1;let r;if(n.length===0){if(!e.tableableAsConstant(this._symbol))return!1;r=e.implicitIndependent(this._symbol)}else r=n[0];if(!e.validFirstColumnVariable(r))return!1;let s=e.assignmentForbidden(this._symbol)?oa(this.getInputString().replace(/[^=]*=/,\"\")):oa(this.getInputString().split(\"=\")[0]);return{independent_variable:r,dependent_column:s,by_reference:!e.assignmentForbidden(this._symbol)}};M.FunctionDefinition.prototype.tableInfo=function(e,t){if(this._argSymbols.length!==1||!this.getInputString().length||t.getDependencies().length>1)return!1;let r=this._argSymbols[0];if(!e.validFirstColumnVariable(r))return!1;let s=e.assignmentForbidden(this._symbol),i=s?oa(this.getInputString().replace(/[^=]*=/,\"\")):oa(this.getInputString().split(\"=\")[0]);return{independent_variable:r,dependent_column:i,by_reference:!s}};M.BaseComparator.prototype.tableInfo=function(e,t){return!1};M.ComparatorChain.prototype.tableInfo=function(e,t){return!1};M.DoubleInequality.prototype.tableInfo=function(e,t){return!1};M.Equation.prototype.tableInfo=function(e,t){return!1};M.Base.prototype.tableError=function(){return this.isInequality()?E(\"shared-calculator-error-table-inequality-supplement\"):!(this instanceof M.Expression)&&!(this instanceof M.IRExpression)?E(\"shared-calculator-error-table-generic-supplement\"):!1};M.List.prototype.tableError=function(){return E(\"shared-calculator-error-table-list-supplement\")};M.Equation.prototype.tableError=M.Assignment.prototype.tableError=function(){return E(\"shared-calculator-error-table-equation-supplement\")};M.ComparatorChain.prototype.tableError=function(){return this.symbols.includes(\"=\")?E(\"shared-calculator-error-table-equation-supplement\"):E(\"shared-calculator-error-table-inequality-supplement\")};M.FunctionDefinition.prototype.tableError=function(){return E(\"shared-calculator-error-table-function-definition-supplement\")};M.Regression.prototype.tableError=function(){return E(\"shared-calculator-error-table-regression-supplement\")};M.List.prototype.elementAt=function(e){return e=Math.floor(e),e>=0&&e<this.args.length?this.args[e]:new M.Constant(NaN)};M.List.prototype.eachElement=function(t){for(let n=0;n<this.length;n++)t(this.elementAt(n),n)};M.List.prototype.mapElements=function(t){let n=[];for(let r=0;r<this.length;r++)n.push(t(this.elementAt(r),r));return n};M.IRExpression.prototype.elementAt=function(e){let t=this._chunk.elementAt(e);return new on(t)};function E$(){return qr(this._symbol)+\" \"}M.Identifier.prototype.printLatex=E$;M.Constant.prototype.printLatex=function(){return wa(this.asValue())};M.Ticker.prototype.printLatex=function(){return\"\\\\ticker\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.Negative.prototype.printLatex=function(){return\"-\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\"};M.Add.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)+\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.PercentOf.prototype.printLatex=function(){return this.args[0].printLatex()+\" \\\\% \\\\operatorname{of} \"+this.args[1].printLatex()};M.Subtract.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)-\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.Multiply.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)*\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.DotMultiply.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\\\\cdot\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.CrossMultiply.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\\\\times\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.Divide.prototype.printLatex=function(){return\"\\\\frac{\"+this.args[0].printLatex()+\"}{\"+this.args[1].printLatex()+\"}\"};M.Exponent.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)^{\"+this.args[1].printLatex()+\"}\"};M.Assignment.prototype.printLatex=function(){return qr(this._symbol)+\"=\"+this._expression.printLatex()};M.Equation.prototype.printLatex=M.CallAssignment.prototype.printLatex=function(){return this._lhs.printLatex()+\"=\"+this._rhs.printLatex()};function Wb(e){switch(e){case\">\":return\">\";case\"<\":return\"<\";case\">=\":return\"\\\\ge \";case\"<=\":return\"\\\\le \";case\"=\":return\"=\"}return\"\"}M.BaseComparator.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\"+Wb(this.operator)+\"\\\\left(\"+this.args[1].printLatex()+\"\\\\right)\"};M.ComparatorChain.prototype.printLatex=function(){let e=\"\";for(let t=0;t<this.symbols.length;t++)e+=`\\\\left(${this.args[t].printLatex()}\\\\right)${Wb(this.symbols[t])}`;return e+=`\\\\left(${this.args[this.args.length-1].printLatex()}\\\\right)`,e};M.DoubleInequality.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\"+Wb(this.args[1])+this.args[2].printLatex()+Wb(this.args[3])+\"\\\\left(\"+this.args[4].printLatex()+\"\\\\right)\"};M.Or.prototype.printLatex=function(){return this.args[0].printLatex()+\",\"+this.args[1].printLatex()};function Ls(e){return e.printLatex()}function M$(){switch(this._symbol){case\"sqrt\":return\"\\\\sqrt{\"+this.args[0].printLatex()+\"}\";case\"nthroot\":return\"\\\\sqrt[\"+this.args[1].printLatex()+\"]{\"+this.args[0].printLatex()+\"}\";case\"logbase\":return\"\\\\log_{\"+this.args[1].printLatex()+\"}\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\";default:return qr(this._symbol)+\"\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"}}M.FunctionCall.prototype.printLatex=M$;M.RecursiveFunctionBaseCase.prototype.printLatex=function(){return this.originalNode.printLatex()};M.SeededFunctionCall.prototype.printLatex=function(){return qr(this._symbol)+\"\\\\left(\"+this.args.slice(1).map(Ls).join(\", \")+\"\\\\right)\"};M.DotAccess.prototype.printLatex=function(){return\"(\"+this.args[0].printLatex()+\").(\"+this.args[1].printLatex()+\")\"};M.Prime.prototype.printLatex=function(){switch(this.args[0]._symbol){case\"logbase\":return\"\\\\log_{\"+this.args[0].args[1].printLatex()+\"}\"+Array(this.order+1).join(\"'\")+\"\\\\left(\"+this.args[0].args[0].printLatex()+\"\\\\right)\";default:return qr(this.args[0]._symbol)+Array(this.order+1).join(\"'\")+\"\\\\left(\"+this.args[0].args.map(Ls).join(\", \")+\"\\\\right)\"}};M.List.prototype.printLatex=function(){return\"\\\\left[\"+this.args.map(Ls).join(\", \")+\"\\\\right]\"};M.Range.prototype.printLatex=function(){return\"\\\\left[\"+this.args[0].args.map(Ls).join(\", \")+\" ... \"+this.args[1].args.map(Ls).join(\", \")+\"\\\\right]\"};M.UpdateRule.prototype.printLatex=function(){return this.args[0].printLatex()+\"\\\\to(\"+this.args[1].printLatex()+\")\"};M.ListAccess.prototype.printLatex=function(){return\"\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\\\\left[\"+this.args[1].printLatex()+\"\\\\right]\"};M.ParenSeq.prototype.printLatex=function(){return\"\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.BareSeq.prototype.printLatex=function(){return this.args.map(Ls).join(\", \")};M.NamedCoordinateAccess.prototype.printLatex=function(){return\"\\\\left(\\\\left(\"+this.args[0].printLatex()+\"\\\\right).\"+this.symbol+\"\\\\right)\"};M.Norm.prototype.printLatex=function(){return\"\\\\left|\"+this.args[0].printLatex()+\"\\\\right|\"};M.Sum.prototype.printLatex=function(){return\"\\\\sum_{\"+this.args[0].printLatex()+\"=\"+this.args[1].printLatex()+\"}^{\"+this.args[2].printLatex()+\"}\\\\left(\"+this.args[3].printLatex()+\"\\\\right)\"};M.Product.prototype.printLatex=function(){return\"\\\\prod_{\"+this.args[0].printLatex()+\"=\"+this.args[1].printLatex()+\"}^{\"+this.args[2].printLatex()+\"}\\\\left(\"+this.args[3].printLatex()+\"\\\\right)\"};M.Integral.prototype.printLatex=function(){return\"\\\\int_{\"+this.args[1].printLatex()+\"}^{\"+this.args[2].printLatex()+\"}\\\\left(\"+this.args[3].printLatex()+\"\\\\right)d\"+this.args[0].printLatex()};M.FunctionExponent.prototype.printLatex=function(){return this.args[0].printLatex()+\"\\\\left(\"+this.args[1].printLatex()+\"\\\\right)^{\"+this.args[2].printLatex()+\"}\"};M.FunctionFactorial.prototype.printLatex=function(){return this.args[0].printLatex()+\"\\\\left(\"+this.args[1].printLatex()+\"\\\\right)!\"};function w1(e){return e.isConstant&&e.asValue()===!0}function C$(e){return e.isConstant&&e.isNaN()}M.Piecewise.prototype.printLatex=function(){let e=this;if(w1(e.args[0]))return e.args[1].printLatex();let t=[\"\\\\left\\\\{\"];for(;;){if(w1(e.args[0])){t.push(e.args[1].printLatex());break}if(t.push(e.args[0].printLatex(),\": \"),C$(e.args[2])){t.push(e.args[1].printLatex());break}if(t.push(e.args[1].printLatex(),\", \"),!(e.args[2]instanceof M.Piecewise)){t.push(e.args[2].printLatex());break}e=e.args[2]}return t.push(\"\\\\right\\\\}\"),t.join(\"\")};M.Restriction.prototype.printLatex=function(){return w1(this.args[0])?\"\\\\left\\\\{\\\\right\\\\}\":\"\\\\left\\\\{\"+this.args[0].printLatex()+\"\\\\right\\\\}\"};M.FunctionDefinition.prototype.printLatex=function(){return qr(this._symbol)+\"\\\\left(\"+this._argSymbols.map(qr).join(\", \")+\"\\\\right) = \"+this._expression.printLatex()};M.Derivative.prototype.printLatex=function(){return\"\\\\frac{d}{d\"+qr(this._symbol)+\"}\\\\left(\"+this.args[0].printLatex()+\"\\\\right)\"};M.Regression.prototype.printLatex=function(){return\"\\\\left(\"+this._lhs.printLatex()+\"\\\\right)\\\\sim\\\\left(\"+this._rhs.printLatex()+\"\\\\right)\"};M.Histogram.prototype.printLatex=function(){return\"\\\\histogram\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.DotPlot.prototype.printLatex=function(){return\"\\\\dotplot\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.BoxPlot.prototype.printLatex=function(){return\"\\\\boxplot\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.TTest.prototype.printLatex=function(){return\"\\\\TTest\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.IndependentTTest.prototype.printLatex=function(){return\"\\\\IndependentTTest\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.Stats.prototype.printLatex=function(){return\"\\\\Stats\\\\left(\"+this.args.map(Ls).join(\", \")+\"\\\\right)\"};M.AssignmentExpression.prototype.printLatex=function(){return qr(this._symbol)+\"=\"+this.args[1].printLatex()};M.ListComprehension.prototype.printLatex=function(){return\"\\\\left[\"+this._body.printLatex()+\"\\\\operatorname{for}\"+this._inputLists.map(Ls).join(\", \")+\"\\\\right]\"};M.Substitution.prototype.printLatex=function(){return\"\\\\left(\\\\left(\"+this._body.printLatex()+\"\\\\right)\\\\operatorname{with}\"+this._assignments.map(Ls).join(\", \")+\"\\\\right)\"};M.Construction.prototype.printLatex=function(){return\"\\\\construction \"};M.ImaginaryUnit.prototype.printLatex=function(){return br};M.MovableComplexNumber.prototype.printLatex=function(){return Ic(this.asValue())};M.Base.prototype.getExpressionType=function(e,t){switch(e){case 114:return t&&j(t)?\"POINT3D_LIST\":\"POINT3D\";case 100:case 128:return\"CURVE3D_xyz_t\";case 119:return\"SEGMENT3D\";case 129:return\"VECTOR3D\";case 130:case 103:return\"SURFACE_xyz_uv\";case 110:return\"SURFACE_r_\\u03B8z\";case 124:return\"SURFACE_r_\\u03B8z_AMBIGUOUS\";case 109:return\"SURFACE_z_r\\u03B8\";case 111:return\"SURFACE_r_\\u03B8\\u03C6\";case 107:case 108:case 106:return\"SURFACE\";case 118:return\"SPHERE3D\";case 117:return\"TRIANGLE3D\";case 120:case 121:return\"SURFACE_AMBIGUOUS\";case 122:case 123:return\"SURFACE_CONSTANT_AMBIGUOUS\";case 112:case 113:case 210:return\"IMPLICIT_SURFACE\";case 126:case 127:return\"IMPLICIT_SURFACE_AMBIGUOUS\";case 3:case 4:case 25:case 26:return t&&j(t)?\"POINT_LIST\":\"SINGLE_POINT\";case 1:case 2:return\"X_OR_Y\";case 5:return\"PARAMETRIC\";case 6:return\"POLAR\";case 8:return\"IMPLICIT\";case 24:case 17:return\"VECTOR2D\";case 200:case 201:case 202:case 205:case 209:return\"SLICE\";case 211:case 206:return\"SLICE_r\\u03B8z_at_z\";case 203:return\"SLICE_zr\\u03B8_at_r\";case 204:return\"SLICE_zr\\u03B8_at_\\u03B8\";case 213:return\"SLICE_zr\\u03B8_at_xyz\";case 207:return\"SLICE_r\\u03B8\\u03C6_at_\\u03B8\";case 208:return\"SLICE_r\\u03B8\\u03C6_at_\\u03C6\";case 212:return\"SLICE_r\\u03B8\\u03C6_at_xyz\";case 214:case 215:return\"SLICE_xyz_uv\";default:return t!==void 0&&se(t,xe)?\"POLYGON\":\"X_OR_Y\"}};M.Histogram.prototype.getExpressionType=function(e,t){return\"HISTOGRAM\"};M.DotPlot.prototype.getExpressionType=function(e,t){return\"DOTPLOT\"};M.BoxPlot.prototype.getExpressionType=function(e,t){return\"BOXPLOT\"};var jb=class extends Q{};var Jb=class extends Q{constructor(t){super(t),this._symbol=\"sphere\"}};function D$(e){return function(n){return new e(n)}}var S$=[Ep,Mp,Ru,Cp,Dp,Sp,Ms,jb,_u,vp,Lu,wu,Fu,Op,Np,Rp,lo,Go,Fp,Vp,Bp,Gp,ao,kp,Fr,zp,$p,Hp,Up,Jb,qp,Es,Xp,Zp];for(let e of S$)e.prototype.copyWithArgs=D$(e);uo.prototype.copyWithArgs=function(e){return new ps[this.operator](e)};Au.prototype.copyWithArgs=function(e){return new Au(this.symbols,e)};Et.prototype.copyWithArgs=function(e){return new Et(this._constantValue)};rl.prototype.copyWithArgs=function(e){return new rl(this.constructedObjectIds)};sl.prototype.copyWithArgs=function(e){return new sl(this._symbol,e)};il.prototype.copyWithArgs=function(e){return new il(this.tag,e)};gn.prototype.copyWithArgs=function(e){return new gn(new we(this._symbol),e)};we.prototype.copyWithArgs=function(e){return new we(this._symbol)};ko.prototype.copyWithArgs=function(e){return new ko};Ja.prototype.copyWithArgs=function(e){return new Ja(e[0],e[1],e.slice(2),this.shouldCoerceToList,this.parameters)};Ho.prototype.copyWithArgs=function(e){return new Ho(this.symbol,e)};ul.prototype.copyWithArgs=function(e){return new ul(this.order,e)};cl.prototype.copyWithArgs=function(e){return new cl(this.value)};xa.prototype.copyWithArgs=function(e){return new xa(e[0],e.slice(1))};ll.prototype.copyWithArgs=function(e){return new ll(this._stringValue)};pl.prototype.copyWithArgs=function(e){return new pl(e,this.moveStrategy,this.defaultDragMode)};function Ww(e,t,n){try{return N$(e,t,n)}catch(r){if(!(r instanceof v))throw r;let s=[];for(let i of We(n))s.push({id:i,stmtAnalysis:new q(e,t,n[i],r)});return s}}function N$(e,t,n){let r={};for(let c of We(n))r[n[c]._symbol]=n[c];let s=new V1(r),i={},o={definitions:i,baseCases:s.getBaseCases()};for(let c of We(n)){let l=n[c];R$(s,l,o)}for(let c of s.getBaseCaseExports()){let l=c.analyze(e,t,{});for(let p of c.getLegalExports(e))delete t[p];l.rawTree.exportTo(e,l.concreteTree,t)}let a=Tn(t);for(let c of We(i))a[c]=i[c];let u=[];for(let c of We(n)){let l=n[c],p=l._symbol,f=i[p];f.userData=l.userData,f.metaData=l.metaData,f instanceof v?u.push({id:c,stmtAnalysis:new q(e,t,l,f)}):u.push({id:c,stmtAnalysis:f.analyze(e,a,{})})}return u}var V1=class{constructor(t){this.baseCases={};this.baseCaseExports=[];this.analyzedFunctions={};this.recursiveFunctionGroup=t;for(let n in t)this.baseCases[n]=[];for(let n in this.recursiveFunctionGroup)this.analyzeRecursiveFunctionDefinition(this.recursiveFunctionGroup[n])}analyzeRecursiveFunctionDefinition(t){let n;for(let r of t.getExternalBaseCases())this.addBaseCase(r);if(t._expression instanceof Fr){n=t._expression;do{let r=n.args[0],s=n.args[1];if(this.recursiveParameterIndex!==void 0&&r instanceof ps[\"=\"]){let i=t._argSymbols[this.recursiveParameterIndex],o=r.args.findIndex(p=>p instanceof we&&p._symbol===i);if(o===-1)break;let a=r.args[1-o];if(!(a instanceof Et))break;let u=a.asValue(),c=t._argSymbols.filter((p,f)=>f!==this.recursiveParameterIndex).map(p=>new we(p)),l=new Qr(t._symbol,c,{valid:!0,argIndex:this.recursiveParameterIndex,argValue:u,functionDefArgSymbols:t._argSymbols,argSymbol:t._argSymbols[this.recursiveParameterIndex]},s,s);this.baseCaseExports.push(l),this.addBaseCase(l)}else break;n=n.args[2]}while(n instanceof Fr)}else if(t._expression instanceof xa){let r=[];for(let s of t._expression._assignments){let i=Qr.fromCallAssignment(this.recursiveFunctionGroup,s);if((i==null?void 0:i.specifiedArg.valid)===!1)throw i.specifiedArg.error;i&&t._symbol===i._symbol?(this.baseCaseExports.push(i),this.addBaseCase(i)):r.push(s)}r.length>0?n=new xa(t._expression._body,r):n=t._expression._body}else n=t._expression;this.analyzedFunctions[t._symbol]={recursiveExpression:n}}addBaseCase(t){this.baseCases[t._symbol].push(t)}getBaseCases(){return this.baseCases}getBaseCaseExports(){return this.baseCaseExports}getFunctionAnalysis(t){return this.analyzedFunctions[t]}};function R$(e,t,n){let r=e.getFunctionAnalysis(t._symbol);if(!r){n.definitions[t._symbol]=t;return}let s=new Cr(new we(t._symbol),t._argSymbols.map(i=>new we(i)),r.recursiveExpression,n);s.setExternalBaseCases(t.getExternalBaseCases()),n.definitions[t._symbol]=s}function Jw(e,t){let n={};for(let r of We(t)){let s=t[r],i=s.metaData;if(Rm(n,r,s.getDependencies()),Rm(n,r,s.getLegalExports(e)),ui(s)&&s.userData&&s.userData.residualVariable&&Rm(n,r,[no(s.userData.residualVariable)]),jw(n,r,i),Hi(s)&&s.columns)for(let o=0;o<s.columns.length;o++){let a=s.columns[o];if(ha(a))throw z(\"Unexpected concrete column.\");!Kr(a)&&a.header&&a.header.metaData&&jw(n,r,a.header.metaData)}}return n}function Rm(e,t,n){for(let r of n)e[r]||(e[r]=[]),e[r].push(t)}function jw(e,t,n){if(n.extraDepNodes)for(let r of n.extraDepNodes)r&&Rm(e,t,r.getDependencies());n.clickHandler&&Rm(e,t,n.clickHandler.getDependencies())}function Am(e,t,n,r,s){let i={},o={},a=[],u=[];for(let c of We(r))r[c]&&(o[c]=!0,a.push(c));for(let c of We(s))s[c]&&(i[c]=!0,u.push(c));for(;a.length||u.length;){for(;a.length;){let c=a.pop(),l=t[c];if(l)for(let p of l.getLegalExports(e))i[p]||(i[p]=!0,u.push(p))}for(;u.length;){let c=u.pop(),l=n[c];if(l)for(let p of l)o[p]||(o[p]=!0,a.push(p))}}return{ids:o,symbols:i}}function Qw(e){return e.globalRandomSeed||[]}var A$=100;function Qb(e){let t=[];for(let n=0;n<e;n++)t[n]={x:[],y:[],intersects:[]};return t}function _$(e,t,n,r){return n===1&&r===1||n===2&&r===2?function(s){return t(s)-e(s)}:n===1&&r===2||n===2&&r===1?function(s){return s-t(e(s))}:!1}function Kw(e,t){t instanceof M.SolvedEquation?t=t._expression:t instanceof M.OptimizedRegression&&(t=t.model);let n=[],r=[];return t instanceof M.DoubleInequality?M.List.eachArgs(t._expressions,s=>{n.push(s[0].getCompiledFunction()),r.push(s[0].isConstant&&s[1].isNaN()),n.push(s[1].getCompiledFunction()),r.push(s[1].isConstant&&s[1].isNaN())}):M.List.wrap(t).eachElement(s=>{n.push(s.getCompiledFunction()),r.push(s.isConstant&&s.isNaN())}),{functions:n,skipIntersecting:r}}function L$(e,t){let n=[];for(let r in e){if(!e.hasOwnProperty(r)||String(r)===String(t)||!e[r].shouldIntersect())continue;let s=e[r],i=Kw(s.policy,s.concreteTree);n.push({id:r,graphMode:s.getGraphMode(),functions:i.functions,skipIntersecting:i.skipIntersecting})}return n}function w$(e,t){e.intersects=Array(e.x.length);for(let n=0;n<e.x.length;n++)e.intersects[n]=t}function F$(e,t){if(t===1){let n=e.y;e.y=e.x,e.x=n}}function V$(e,t){Array.prototype.push.apply(e.x,t.x),Array.prototype.push.apply(e.y,t.y),e.intersects&&t.intersects&&Array.prototype.push.apply(e.intersects,t.intersects)}function B$(e,t,n){let r=h1(e,t),s=r.poi.zeros,i=r.poi.extrema,o=[],a=0,u=0;for(a=0;a<s.x.length;a++){for(;u<i.x.length&&i.x[u]<s.x[a];u++)si(i.y[u],0)&&o.push(i.x[u]);o.push(s.x[a])}for(;u<i.x.length;u++)si(i.y[u],0)&&o.push(i.x[u]);return{x:o,y:o.map(n)}}function eF(e,t,n){let r=e[n],s=r.getGraphInfo(),i=r.getGraphMode(),o,a,u;try{o=Kw(r.policy,r.concreteTree),a=Qb(o.functions.length),u=L$(e,n)}catch(l){return Qb(0)}if(!u)return a;let c=0;for(let l=0;l<u.length;l++){let p=u[l];for(let f=0;f<o.functions.length;f++){if(o.skipIntersecting[f])continue;let d=o.functions[f].fn,y=Td(t,s,d);for(let g=0;g<p.functions.length;g++){if(u[l].skipIntersecting[g])continue;let m=p.functions[g].fn,h=_$(d,m,i,p.graphMode);if(!h)continue;let b;try{b=B$(h,y,d)}catch(x){return Qb(0)}if(c+=b.x.length,c>A$)return Qb(o.functions.length);w$(b,p.id),F$(b,i),V$(a[f],b)}}}return a}var Rl=class{constructor(t){this.localFrames=new Map;this.global=Tn(t)}hasLocalFrame(t){return this.localFrames.has(t)}getLocalFrame(t){let n=this.localFrames.get(t);if(n)return n;{let r=Tn(this.global);return this.localFrames.set(t,r),r}}deleteLocalFrame(t){this.localFrames.delete(t)}};var Kb={};ia(Kb,{getFrame:()=>G$});function G$(e){let t={};return e.additionalFunctions&&e.additionalFunctions.indexOf(\"sqrt\")!==-1&&(t.sqrt=tt.sqrt),e.width&&(t.width=e.width),e.height&&(t.height=e.height),t}var _m={};ia(_m,{getFrame:()=>q$});var tF={segment:!0,line:!0,ray:!0,circle:!0,arc:!0,vector:!0,glider:!0,parallel:!0,perpendicular:!0,center:!0,radius:!0,area:!0,perimeter:!0,start:!0,end:!0,angles:!0,angle:!0,directedangles:!0,directedangle:!0,coterminal:!0,supplement:!0,vertices:!0,segments:!0,intersection:!0,strictintersection:!0,translate:!0,dilate:!0,rotate:!0,reflect:!0,construction:!0,points:!0,lines:!0,circles:!0,arcs:!0,polygons:!0,rays:!0,anglebisector:!0};var nF={segment:!0,triangle:!0,vector:!0,start:!0,end:!0,sphere:!0};var rF=[\"csc\",\"sec\",\"cot\",\"arccsc\",\"arcsec\",\"arccot\",\"csch\",\"sech\",\"coth\",\"arccsch\",\"arcsech\",\"arccoth\",\"mad\",\"cov\",\"covp\",\"distance\",\"midpoint\"],sF=[\"histogram\",\"dotplot\",\"boxplot\"],k$=[...sF,\"polygon\"],iF=[\"erf\",\"ttest\",\"tscore\",\"ittest\",\"normaldist\",\"tdist\",\"poissondist\",\"binomialdist\",\"pdf\",\"cdf\",\"random\",...sF],H$=[\"distance\",\"midpoint\"],z$=[\"det\",\"inv\",\"transpose\",\"rref\",\"trace\"],oF=Object.keys(tF).filter(e=>e!==\"construction\"),aF=Object.keys(Ad),U$=[\"complexMultiplyPoints\",\"rawTransform\",\"rawTransformConj\",\"transformWithoutTranslation\",\"transformScaleFactor\",\"scaleTangentTransformation\",\"addTangentVector\",\"addTangentTransformation\",\"complex\",\"complexDivide\",\"coerceComplexToReal\",\"coerceRealToComplex\"];function ex(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(!t.hasOwnProperty(r))throw new Error(\"Programming Error: key '\"+r+`' does not exist in table. Must be one of:\n`+Object.keys(t).join(`\n`))}}ex(rF,tt);ex(iF,tt);ex(oF,tt);ex(aF,tt);function q$(e){let t={},n;for(n of We(tt)){if(U$.includes(n)||e.restrictedFunctions===!0&&rF.indexOf(n)!==-1&&!(e.forceEnableGeometryFunctions===!0&&H$.indexOf(n)!==-1)||e.distributions===!1&&iF.indexOf(n)!==-1)continue;let r=oF.indexOf(n)!==-1,s=n in nF;if(r&&s){if(!(e.isGeometryCalculator||e.is3DCalculator))continue}else if(r){if(!e.isGeometryCalculator)continue}else if(s){if(!e.is3DCalculator)continue}else if(k$.indexOf(n)!==-1&&e.is3DCalculator)continue;aF.indexOf(n)!==-1&&!e.isComplexEnabled||z$.indexOf(n)===-1&&(t[n]=tt[n])}return e.trigAngleMultiplier&&(t.trigAngleMultiplier=e.trigAngleMultiplier),e.globalRandomSeed&&(t.globalRandomSeed=e.globalRandomSeed),e.initialEvaluation&&(t.initialEvaluation=e.initialEvaluation),e.globalEventCount&&(t.globalEventCount=e.globalEventCount),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.isComplexEnabled&&(t[br]=new ko),t}var B1={};ia(B1,{getFrame:()=>X$});var uF=[\"pi\",\"e\",\"trigAngleMultiplier\"],cF=[\"sqrt\",\"nthroot\",\"abs\",\"ln\",\"sin\",\"cos\",\"tan\",\"log\",\"arcsin\",\"arccos\",\"arctan\",\"mean\",\"round\",\"stdev\",\"stdevp\",\"nCr\",\"nPr\",\"exp\",\"factorial\"],$$=[\"complexMultiplyPoints\",\"complex\",\"complexDivide\",\"coerceComplexToReal\",\"coerceRealToComplex\",\"complexSqrt\"],Y$=Object.keys(Ad);function lF(e,t){for(let n of e)if(!t.hasOwnProperty(n))throw new Error(\"Programming Error: key '\"+n+`' does not exist in table. Must be one of:\n`+Object.keys(t).join(`\n`))}lF(uF,tt);lF(cF,tt);function X$(e){let t={};return uF.forEach(n=>{t[n]=tt[n]}),cF.forEach(n=>{e.replaceRoundWithReciprocal&&n===\"round\"||(t[n]=tt[n])}),e.trigAngleMultiplier&&(t.trigAngleMultiplier=e.trigAngleMultiplier),e.isComplexEnabled&&(Y$.forEach(n=>t[n]=tt[n]),$$.forEach(n=>t[n]=tt[n]),t[br]=new ko),e.width&&(t.width=e.width),e.height&&(t.height=e.height),t}var G1={};ia(G1,{getFrame:()=>Z$});var pF=[\"pi\",\"e\",\"trigAngleMultiplier\"],dF=[\"sqrt\",\"nthroot\",\"abs\",\"ln\",\"sin\",\"cos\",\"tan\",\"log\",\"arcsin\",\"arccos\",\"arctan\",\"exp\",\"factorial\"];function fF(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(!t.hasOwnProperty(r))throw new Error(\"Programming Error: key '\"+r+`' does not exist in table. Must be one of:\n`+Object.keys(t).join(`\n`))}}fF(pF,tt);fF(dF,tt);function Z$(e){let t={};return pF.forEach(n=>{t[n]=tt[n]}),dF.forEach(n=>{t[n]=tt[n]}),e.trigAngleMultiplier&&(t.trigAngleMultiplier=e.trigAngleMultiplier),e.width&&(t.width=e.width),e.height&&(t.height=e.height),t}function mF(){let e={},t={},n={},r=[],s={};for(let i in this.statements){let o=this.statements[i];if(o instanceof co){let a=o.localFrameID;if(!a)throw new Error(`Programming error: missing localFrameID on table column ${i}`);s[a]||(s[a]=[]),s[a].push(o)}}for(let i in this.statements){if(!this.statements.hasOwnProperty(i))continue;let o=this.statements[i];if(!(o.type===\"Construction\"&&!this.policy.isGeometryEnabled())&&o.type!==\"Ticker\")switch(o.type){case\"Error\":break;case\"Regression\":{n[i]=[],r.push(i);break}case\"TableColumn\":continue;default:{let a=o.getLegalExports(this.policy);if(o.type===\"Table\"){let u=s[i]||[];for(let c of u)for(let l of c.getLegalExports(this.policy))!l.startsWith(\"idref_\")&&!a.includes(l)&&a.push(l)}if(a){for(let c of a)o.localFrameID!==void 0?t[c]=i:e[c]=i;let u=[];for(let c of o.getDependencies())u.push(c);n[i]=cx(u,o.getOptionalDependencies(),a)}break}}}for(let i of r){let o=this.statements[i],a=no(o.userData.residualVariable);a&&(t[a]=i);let u=o.getDependencies().slice(),c={},l;for(;l=u.pop();){if(c[l])continue;c[l]=!0;let p=e[l]||t[l];if(p){u.push(...n[p]),n[i].push(l);continue}t[l]=i}}return{exportMap:e,weakExportMap:t,dependencyMap:n}}function yF(e){if(e.length<2)return\"text\";let t=e.split(\"`\").length-1;return t<2?\"text\":t===2&&e[0]===\"`\"&&e[e.length-1]===\"`\"?\"latex\":\"mixed\"}function gF(e){if(e.length===0)return[\"\"];let t=[],n=e.split(/(`)/),r=!1,s=\"\";for(let i=0;i<n.length;i++){let o=n[i];o.length&&(o===\"`\"?(s+=\"`\",r=!r,r||(t.push(s),s=\"\")):(s+=o,r||(t.push(s),s=\"\")))}return s.length&&t.push(s),t}function k1(e){return gF(e).map(W$)}function W$(e){let n=\"\\\\$({\"+[\"[a-zA-Z][0-9]*\",\"[a-zA-Z]_[a-zA-Z0-9]+\",\"[a-zA-Z]_\\\\{[a-zA-Z0-9]+\\\\}\",\"\\\\\\\\[a-zA-Z]+\",\"\\\\\\\\[a-zA-Z]+_{[a-zA-Z0-9]+}\",\"\\\\\\\\[a-zA-Z]+_[a-zA-Z0-9]+\"].join(\"})|\\\\$({\")+\"})\",r=new RegExp(n,\"g\"),s=[],i=0,o=0,a;for(;a=r.exec(e);){o=a.index,o>i&&s.push(e.substr(i,o-i));let u=a[0],c=u.replace(/[{}\\$]/g,\"\").replace(/^([a-zA-Z])([0-9]+)$/,\"$1_$2\");s.push({symbol:c,str:u}),i=a.index+u.length}return i<e.length&&s.push(e.substr(i)),{raw:e,parts:s}}var hF={bigCutoff:1e7,digits:8};function bF(e,t){let n=t?kl(e,hF):Gl(e,hF);return t?`{${n}}`:n}function xF(e,t){let n={...yx,digits:8,scientificNotationDigits:3},r=t?Ic(e,n):gx(e,n);return t?`{${r}}`:r}function H1(e,t,n,r){return e.map(s=>j$(s,t,n,r)).join(\"\")}function j$(e,t,n,r){var o,a;let s=[],i=yF(e.raw)===\"latex\";for(let u of e.parts)if(typeof u==\"string\")s.push(u);else{let c=new M.Identifier(u.symbol).tryGetConcreteTree(t,n,{coerceToNumber:\"all-except-complex\"});if(c.valueType===I&&c.getDependencies().length===0){let l=c.asValue();if(typeof l==\"number\"){s.push(bF(l,i));continue}}else if(c.valueType===ne&&r<c.length&&c.getDependencies().length===0){let l=(o=c.elementAt)==null?void 0:o.call(c,r).asValue();if(typeof l==\"number\"){s.push(bF(l,i));continue}}else if(c.valueType===R&&c.getDependencies().length===0){let l=c.asTypedValue();if((l==null?void 0:l.valueType)===R){s.push(xF(l.value,i));continue}}else if(c.valueType===Ue&&r<c.length&&c.getDependencies().length===0){let l=(a=c.elementAt)==null?void 0:a.call(c,r).asTypedValue();if((l==null?void 0:l.valueType)===R){s.push(xF(l.value,i));continue}}i?s.push(\"{?}\"):s.push(\"?\")}return s.join(\"\")}var Lm=class{constructor(t){this.singleExpression=t.singleExpression,this.complexEnabled=!!t.isComplexEnabled}isGeometryEnabled(){return!1}is3dProduct(){return!1}is3dPolicy(){return!1}isComplexEnabled(){return this.complexEnabled}isRecursionEnabled(){return!1}polygonUnsupportedPreferTriangle(){return!1}areAllScalesLinear(){return!0}assignmentForbidden(t){return this.singleExpression?t.slice(0,3)!==\"ans\":t.slice(0,3)===\"tmp\"}isValidSlider(t){return!1}sliderVariables(){return[]}graphingEnabled(){return!1}ansEnabled(){return!this.singleExpression}dimensionVarsEnabled(){return!1}disabledFeatures(){return this.singleExpression?[\"Sum\",\"Product\",\"Integral\",\"Derivative\",\"Piecewise\",\"Substitution\",\"PercentOf\"]:[\"Sum\",\"Product\",\"Integral\",\"Derivative\",\"Piecewise\",\"Substitution\"]}shouldIncludeFunctionParametersInRandomSeed(){return!0}};function Q$(e){let t=kl(e,{bigCutoff:1e9,smallCutoff:1e-6,digits:12});return t.indexOf(\"\\\\times\")===-1?t:t[0]===\"-\"?\"-\\\\left(\"+t.substring(1)+\"\\\\right)\":\"\\\\left(\"+t+\"\\\\right)\"}function K$(e){switch(e){case\"exponential\":case\"power\":case\"logarithmic\":return!0;case\"cubic\":case\"linear\":case\"logistic\":case\"sinusoidal\":case\"quadratic\":case\"quartic\":return!1}}function e5(e,t){let n=t.parameterValues||{},[r,s]=t.variables,i=a=>{if(n===\"canonical\")return a;let u=n5(a),c=n&&n[u];return c!==void 0?Q$(c):u},o;switch(e){case\"linear\":{let[a,u]=[i(\"m\"),i(\"b\")];o=`${[`${a}${r}`,`${u}`].join(\"+\")}`;break}case\"quadratic\":{let[a,u,c]=[i(\"a\"),i(\"b\"),i(\"c\")];o=`${[`${a}${r}^2`,`${u}${r}`,`${c}`].join(\"+\")}`;break}case\"cubic\":{let[a,u,c,l]=[i(\"a\"),i(\"b\"),i(\"c\"),i(\"d\")];o=`${[`${a}${r}^3`,`${u}${r}^2`,`${c}${r}`,`${l}`].join(\"+\")}`;break}case\"quartic\":{let[a,u,c,l,p]=[i(\"a\"),i(\"b\"),i(\"c\"),i(\"d\"),i(\"f\")];o=`${[`${a}${r}^4`,`${u}${r}^3`,`${c}${r}^2`,`${l}${r}`,`${p}`].join(\"+\")}`;break}case\"exponential\":{let[a,u]=[i(\"a\"),i(\"b\")];o=`${a}\\\\cdot ${u}^{${r}}`;break}case\"logarithmic\":{let[a,u]=[i(\"a\"),i(\"b\")];o=`${a}+${u}\\\\cdot \\\\ln\\\\left(${r}\\\\right)`;break}case\"logistic\":{let[a,u,c]=[i(\"a\"),i(\"b\"),i(\"c\")];o=`\\\\frac{${a}}{1+e^{-\\\\left(${u}${r}+${c}\\\\right)}}`;break}case\"power\":{let[a,u]=[i(\"a\"),i(\"b\")];o=`${a}\\\\cdot ${r}^{${u}}`;break}case\"sinusoidal\":{let[a,u,c,l]=[i(\"a\"),i(\"b\"),i(\"c\"),i(\"d\")];o=`${a}\\\\cdot \\\\sin\\\\left(${u}${r}+${c}\\\\right)+${l}`;break}default:throw new Error(`Unknown regression type: ${e}`)}return`${s}${t.operator}${t5(o)}`}function t5(e){return e.replace(/\\+-/g,\"-\").replace(/--/g,\"\")}function n5(e){return`\\\\regressionparameter_{${e}}`}var TF=/\\\\regressionparameter_{([^}]+)}/g;function jle(e){var n;return((n=e.match(TF))!=null?n:[]).map(r=>r.replace(TF,(s,i)=>i))}function IF(e,t,n,r){let s=e.regression;if(!s)return;K$(s.type)||(s.isLogMode=!1);let i=e.columns,{columnIds:o}=s,a=r.get(o.x),u=r.get(o.y);if(!(a&&u))return z(\"Missing columns for table regression\");let c=[{id:a.userData.id,isIdentifier:ki(a.header),latex:i[a.columnIndex].latex},{id:u.userData.id,isIdentifier:ki(u.header),latex:i[u.columnIndex].latex}],l=[c[0].isIdentifier?c[0].latex:`\\\\idref_{${c[0].id}}`,c[1].isIdentifier?c[1].latex:`\\\\idref_{${c[1].id}}`],p=e5(s.type,{operator:\"~\",variables:l}),f=Mi(p,n);if(Kr(f))return f;if(!ui(f))return z(`Expected table regression to parse as Regression, but got ${f.type}`);let d=f;return d.tableRegressionData={tableId:t,columnInfo:c!=null?c:[],variables:l},d.metaData={extraDepNodes:[]},d.userData={id:s.id,color:s.color,lineStyle:s.lineStyle,isLogModeRegression:s.isLogMode,shouldGraph:!s.hidden,residualVariable:s.residualVariable},d}var yc=typeof performance!=\"undefined\"?()=>performance.now():()=>Date.now(),{Constant:So,Seed:EF,FunctionCall:a5,Image:u5,Slider:c5,Construction:l5}=M;function p5({evaluationMode:e,is3dProduct:t,isBeta3d:n,isComplexEnabled:r,scales:s,includeFunctionParametersInRandomSeed:i,customRegressions:o,isRecursionEnabled:a}){switch(e){case\"fourFunction\":return new Cc({singleExpression:!1});case\"singleExpressionFourFunction\":return new Cc({singleExpression:!0});case\"scientific\":return new Lm({singleExpression:!1,isComplexEnabled:r});case\"singleExpressionScientific\":return new Lm({singleExpression:!0,isComplexEnabled:r});case\"graphing\":return new Id({enableGeometry:!1,enable3d:t,scales:s,isComplexEnabled:r,includeFunctionParametersInRandomSeed:i,customRegressions:o,isRecursionEnabled:a});case\"geometry\":return new Id({enableGeometry:!0,enable3d:!1,scales:s,includeFunctionParametersInRandomSeed:i,isComplexEnabled:r,customRegressions:o,isRecursionEnabled:a});case\"graphing_3d\":return new $b({beta3d:n,includeFunctionParametersInRandomSeed:i,isComplexEnabled:r,customRegressions:o,isRecursionEnabled:a})}}var d5={fourFunction:Kb,singleExpressionFourFunction:Kb,scientific:B1,singleExpressionScientific:G1,graphing:_m,graphing_3d:_m,geometry:_m},sa=\"**geo_construction_statement_id**\";function ri(e,t){let n=Mi(e,t);return n.isError||n instanceof M.Expression?n:wd()}function f5(e){let t=e.rawTree.userData,n=e.rawTree.metaData;return!!(t.cdf&&t.cdf.show&&n.distributionSpec)}function m5(e){let t=e.evaluationState.expression_type,n=e.rawTree.userData;return!n.clickableInfo||!n.clickableInfo.enabled?!1:Af(e.rawTree)?!0:uu(e.getGraphMode())?!1:tC(t)}function yn(e,t){let n=\"id\"+e;for(let[r,s]of t||[])n+=\"::\"+r+s;return n}var y5=new So(Se(0,1)),g5=new So(Se(1,1)),h5=new So(NaN);function yi(e,t){return e?e===\"0\"?y5:e===\"1\"?g5:ri(e,t):h5}function gc(e,t){if(e)return ri(e,t)}function b5(e){return e.slice(0,3)!==\"ans\"}function x5(e){return e.slice(0,6)!==\"idref_\"}function MF(e,t,n){let{multiplyDefined:r,cycles:s,recursiveFunctionSymbols:i}=e;for(let o of s){let a=[...new Set(o.map(({symbol:u})=>u))].filter(b5).filter(x5).sort();for(let{symbol:u,localFrameID:c}of o){if(n&&i.has(u))continue;let l=MI(a);if(c!==void 0){let p=t.getLocalFrame(c);p[u]=l,e.definitionLevel[u]===1&&(t.global[u]=l)}else t.global[u]=l}}for(let o of We(r))r.hasOwnProperty(o)&&(t.global[o]=Wl(o));for(let[o,a]of e.localDependencyOrder){let u=t.getLocalFrame(o);for(let c of We(a.multiplyDefined))u[c]=Wl(c)}}function hc(e,t){return t.localFrameID!==void 0?e.getLocalFrame(t.localFrameID):e.global}function T5(e,t,n){let r=e.evaluationState,s=e.rawTree,i=s.metaData.cdfMin,o=s.metaData.cdfMax,a={},u=s.type===\"Assignment\"?s._expression:s,c=u&&u.metaData&&u.metaData.distributionSpec,l=Fa(t,n,i,a,-1/0),p=Fa(t,n,o,a,1/0),f=!0,d=!0;if(isNaN(l)&&(f=!1,l=NaN),isNaN(p)&&(d=!1,p=NaN),f?d?l>p&&(f=!1,d=!1,r.error=VI().getError()):r.error=FI().getError():r.error=wI().getError(),f&&d){let m=new a5(\"cdf\",[u,new So(l),new So(p)]);r.cdf_evaluation=+m.tryGetConcreteTree(t,n).asValue()}let y=-1/0,g=1/0;if(c&&(c.discrete&&(y=0),c.symbol===\"binomialdist\"&&u.args&&u.args[0])){let m=+u.args[0].asValue();isFinite(m)&&(g=m)}s.metaData.evaluatedCDFMin=l,s.metaData.evaluatedCDFMax=p,r.cdf_min_valid=f,r.cdf_max_valid=d,r.cdf_min_default=y,r.cdf_max_default=g,r.is_single_identifier=!1,mc(r,t,a)}var q1={coerceToNumber:\"all\"};function I5(e,t,n,r,s){let i={},o=!0,a=NaN,u,c=!1;if(n){let l=n.tryGetConcreteTree(e,t,q1);u=l.getDependencies().length===0?l.asValue():NaN,c=Array.isArray(u),a=c?u:+u;for(let p of l.getDependencies())i[p]=!0}if(c){for(let l of a)if(!isFinite(+l)){o=!1,a=NaN;break}}else isFinite(+a)?s!==void 0&&a>s&&(a=s):(o=!1,a=NaN);return n||(o=!0,r!==void 0&&(a=r)),{value:a,valid:o,missingVarsMap:i}}var wm={lineWidth:{parseNode:\"lineWidth\",valueOutputProp:\"computedLineWidth\",formulaOutputProp:\"\",validOutputProp:\"line_width_valid\",default:(e,t,n,r)=>n.is3dPolicy()?1:2.5,transform:void 0,shouldEvaluate:void 0,seed:\"lw\"},resolution:{parseNode:\"resolution\",valueOutputProp:\"computedResolution\",formulaOutputProp:\"\",validOutputProp:\"resolution_valid\",default:()=>{},transform:void 0,shouldEvaluate:void 0,seed:\"re\"},lineOpacity:{parseNode:\"lineOpacity\",valueOutputProp:\"computedLineOpacity\",formulaOutputProp:\"\",validOutputProp:\"line_opacity_valid\",default:()=>1,transform:void 0,shouldEvaluate:void 0,seed:\"lo\"},pointOpacity:{parseNode:\"pointOpacity\",valueOutputProp:\"computedPointOpacity\",formulaOutputProp:\"\",validOutputProp:\"point_opacity_valid\",default:()=>1,transform:void 0,shouldEvaluate:void 0,seed:\"po\"},pointSize:{parseNode:\"pointSize\",valueOutputProp:\"computedPointSize\",formulaOutputProp:\"\",validOutputProp:\"point_size_valid\",default:(e,t,n)=>n.is3dProduct()?3:8,shouldEvaluate:void 0,transform:void 0,seed:\"ps\"},movablePointSize:{parseNode:\"movablePointSize\",valueOutputProp:\"computedMovablePointSize\",formulaOutputProp:\"\",validOutputProp:\"movable_point_size_valid\",default:()=>8,shouldEvaluate:void 0,transform:void 0,seed:\"ps\"},fillOpacity:{parseNode:\"fillOpacity\",valueOutputProp:\"computedFillOpacity\",formulaOutputProp:\"\",validOutputProp:\"fill_opacity_valid\",default:()=>.4,transform:void 0,shouldEvaluate:e=>{if(!e)return!1;let{expression_type:t,is_inequality:n}=e.evaluationState;return!!(t===\"POLYGON\"||t===\"PARAMETRIC\"||n)},seed:\"fo\"},surfaceOpacity:{parseNode:\"surfaceOpacity\",valueOutputProp:\"computedSurfaceOpacity\",formulaOutputProp:\"\",validOutputProp:\"surface_opacity_valid\",default:()=>1,transform:void 0,shouldEvaluate:e=>{if(!e)return!1;let{expression_type:t}=e.evaluationState;return t===\"CURVE3D_xyz_t\"||t===\"SURFACE\"||t===\"SPHERE3D\"||t===\"SURFACE_AMBIGUOUS\"||t===\"SURFACE_CONSTANT_AMBIGUOUS\"||t===\"IMPLICIT_SURFACE\"||t===\"IMPLICIT_SURFACE_AMBIGUOUS\"||t===\"SURFACE_xyz_uv\"||t===\"SURFACE_z_r\\u03B8\"||t===\"SURFACE_r_\\u03B8z\"||t===\"SURFACE_r_\\u03B8\\u03C6\"||t===\"SURFACE_r_\\u03B8z_AMBIGUOUS\"||t===\"TRIANGLE3D\"},seed:\"fo\"},labelSize:{parseNode:\"labelSize\",valueOutputProp:\"computedLabelSize\",formulaOutputProp:\"\",validOutputProp:\"label_size_valid\",transform:void 0,default:()=>1,shouldEvaluate:void 0,seed:\"ls\"},labelAngle:{parseNode:\"labelAngle\",valueOutputProp:\"computedLabelAngle\",formulaOutputProp:\"label_angle_value\",validOutputProp:\"label_angle_valid\",default:()=>0,transform:e=>`-\\\\trigAngleMultiplier*(${e})`,shouldEvaluate:void 0,seed:\"la\"}};function CF(e,t,n,r,s,i,o){let a=wm[i],u;e&&(u=e.tryGetConcreteTree(r,s));let c=a.default&&a.default(e,u,r,o),l=[\"lineWidth\",\"pointSize\",\"movablePointSize\"].indexOf(i)>=0,p=I5(r,s,n[a.parseNode],c,l?1e4:void 0);n[a.valueOutputProp]=p.value,a.formulaOutputProp&&(t[a.formulaOutputProp]=p.value),t[a.validOutputProp]=p.valid,mc(t,r,p.missingVarsMap)}function P5(e,t,n,r){let s,i,o;if(Hi(e.rawTree)&&e.evaluationState.column_data&&e.rawTree.columns)for(let a=0;a<e.evaluationState.column_data.length;a++){s=e.evaluationState.column_data[a];let u=e.rawTree.columns[a];if(!Kr(u)){if(ha(u))throw z(\"Unexpected concrete column.\");i=u.header.metaData,o=i[r],CF(o,s,i,t,n,r,e.concreteTree.valueType)}}else s=e.evaluationState,i=e.rawTree.metaData,o=i[r],CF(o,s,i,t,n,r,e.concreteTree.valueType)}function DF(e){return kc(e[0],e[1],e[2]).formatHex()}function SF(e,t,n,r,s){let i;if(e){let o=e.tryGetConcreteTree(r,s),a=o.getDependencies().length>0?void 0:o.asValue(),{valueType:u}=o;if(i=!!(a&&(u===Kt||u===rr)),i){let c=o&&o.valueType===Kt?DF(a):a.map(DF);t.colorLatexValue=c,n.color_latex_value=c}else delete t.colorLatexValue,delete n.color_latex_value}else i=!0;n.color_latex_valid=i}function E5(e,t,n){let r,s,i;if(Hi(e.rawTree)&&e.evaluationState.column_data&&e.rawTree.columns)for(let o=0;o<e.evaluationState.column_data.length;o++){r=e.evaluationState.column_data[o];let a=e.rawTree.columns[o];if(!Kr(a)){if(ha(a))throw z(\"Unexpected concrete column.\");s=a.header.metaData,i=s.colorLatex,SF(i,s,r,t,n)}}else r=e.evaluationState,s=e.rawTree.metaData,i=s.colorLatex,SF(i,s,r,t,n)}function M5(e){if(e.concreteTree.valueType===Kt&&e.concreteTree.getDependencies().length>0){let t=e.concreteTree._chunk;try{e.evaluationState.shader=Ma(t,0)}catch(n){e.evaluationState.error=n instanceof M.Error?n.getError():z(n).getError()}}}function C5(e,t,n){let r=e.evaluationState,s=e.rawTree,i={},o=s.metaData.clickHandler;if(!o)return;let a=o.tryGetConcreteTree(t,n);!a.isError&&a.valueType!==ut&&(a=Gd(oe(a.valueType)));for(let c of a.getDependencies())t.validActionVariable(c)||(i[c]=!0);let u=Object.keys(i);u.length>0&&(a=rn(u).setDependencies(a.getDependencies())),a.isError&&!C1(t,a)?r.click_handler={status:\"error\",error:a.getError()}:a.isEmptyAction?r.click_handler={status:\"empty\"}:r.click_handler={status:\"maybe-valid\"},mc(r,t,i)}function D5(e,t,n){let r,s=e.evaluationState,i=e.rawTree,o,a;s.internal_domain_dependency?(r=s.internal_domain_dependency,r===\"u\"?(o=i.metaData.parametricDomain3DuMin,a=i.metaData.parametricDomain3DuMax):r===\"v\"?(o=i.metaData.parametricDomain3DvMin,a=i.metaData.parametricDomain3DvMax):(o=i.metaData.parametricDomainMin,a=i.metaData.parametricDomainMax)):s.expression_type===\"POLAR\"||R_(s.expression_type)?(o=i.metaData.polarDomainMin,a=i.metaData.polarDomainMax,r=\"theta\"):(o=i.metaData.parametricDomainMin,a=i.metaData.parametricDomainMax,r=\"t\");let u={},c=!!(o||a),l=Fa(t,n,o,u,0),p=NaN;a?p=Fa(t,n,a,u,NaN):s.expression_type===\"PARAMETRIC\"||s.expression_type===\"CURVE3D_xyz_t\"?p=1:s.expression_type===\"POLAR\"?p=Math.PI*12/+n.trigAngleMultiplier.asValue():(s.expression_type===\"SURFACE_r_\\u03B8z\"||s.expression_type===\"SURFACE_r_\\u03B8z_AMBIGUOUS\"||s.expression_type===\"SLICE_r\\u03B8z_at_z\")&&(p=Math.PI*2/+n.trigAngleMultiplier.asValue());let f=U1(l,p,s);({min:l,max:p}=f),i.metaData.evaluatedDomainMin=l,i.metaData.evaluatedDomainMax=p,(s.expression_type===\"POLAR\"||s.expression_type===\"SURFACE_r_\\u03B8z\"||s.expression_type===\"SURFACE_r_\\u03B8z_AMBIGUOUS\"||s.expression_type===\"SLICE_r\\u03B8z_at_z\")&&(i.metaData.isExplicitDomain=c),s.domains=[{variable:r,minNumber:l,maxNumber:p,minValid:f.minValid,maxValid:f.maxValid}],s.expression_type===\"PARAMETRIC\"&&delete u.t,s.expression_type===\"CURVE3D_xyz_t\"&&(delete u.t,delete u.u,delete u.v),mc(s,t,u)}function S5(e,t,n){let r=e.evaluationState,s=r.expression_type,i=e.rawTree,o,a,u,c,l={},p=0,f=1,d=0,y=1,g,m;O_(s)?(g=\"theta\",m=\"phi\",o=i.metaData.polarDomainMin,a=i.metaData.polarDomainMax,u=i.metaData.parametricDomain3DphiMin,c=i.metaData.parametricDomain3DphiMax,f=2*Math.PI/+n.trigAngleMultiplier.asValue(),y=Math.PI/+n.trigAngleMultiplier.asValue()):N_(s)?(g=\"r\",m=\"theta\",o=i.metaData.parametricDomain3DrMin,a=i.metaData.parametricDomain3DrMax,u=i.metaData.polarDomainMin,c=i.metaData.polarDomainMax,f=Dr.xmax,y=2*Math.PI/+n.trigAngleMultiplier.asValue()):(g=\"u\",m=\"v\",o=i.metaData.parametricDomain3DuMin,a=i.metaData.parametricDomain3DuMax,u=i.metaData.parametricDomain3DvMin,c=i.metaData.parametricDomain3DvMax),p=Fa(t,n,o,l,p),f=Fa(t,n,a,l,f),d=Fa(t,n,u,l,d),y=Fa(t,n,c,l,y);let h=U1(p,f,r);({min:p,max:f}=h);let b=U1(d,y,r);({min:d,max:y}=b),i.metaData.evaluatedDomain3DMin1=p,i.metaData.evaluatedDomain3DMax1=f,i.metaData.evaluatedDomain3DMin2=d,i.metaData.evaluatedDomain3DMax2=y,r.domains=[{variable:g,minNumber:p,minValid:h.minValid,maxNumber:f,maxValid:h.maxValid},{variable:m,minNumber:d,minValid:b.minValid,maxNumber:y,maxValid:b.maxValid}],(r.expression_type===\"SURFACE_xyz_uv\"||r.expression_type===\"SLICE_xyz_uv\")&&(delete l.u,delete l.v),mc(r,t,l)}function Fa(e,t,n,r,s){if(n){let i=n.tryGetConcreteTree(e,t,q1);for(let o of i.getDependencies())r[o]=!0;return i.isConstant?+i.asValue():NaN}else return s}function U1(e,t,n){let r=!0,s=!0;return isFinite(e)||(r=!1,e=NaN),isFinite(t)||(s=!1,t=NaN),r?s?e>t&&(r=!1,s=!1,n.error=LI().getError()):n.error=_I().getError():n.error=AI().getError(),{min:e,max:t,minValid:r,maxValid:s}}function v5(e,t,n){let r=e.evaluationState,s=e.rawTree,i=s.metaData.vizAxisOffset,o=s.metaData.vizBreadth,a={},u=Fa(t,n,i,a,1),c=Fa(t,n,o,a,1),l=!0,p=!0;isFinite(u)||(l=!1,u=NaN),isFinite(c)||(p=!1,c=NaN),l?p||(r.error=kT().getError()):r.error=GT().getError(),s.metaData.evaluatedAxisOffset=u,s.metaData.evaluatedBreadth=c,r.viz_values={axisOffset:u,breadth:c},r.viz_valids={axisOffset:l,breadth:p},mc(r,t,a)}function z1(e,t,n){if(e.isError||e.getDependencies().length||e.valueType!==ut)return;let r=e.asValue();if(r)for(let s of We(r.updateRules)){t[s]=P1(r,s);let{value:i,valueType:o}=r.updateRules[s];n[s]=new M.Assignment(s,lt(o,i))}}function O5(e,t){if(e.type!==\"statement\"||t.type!==\"statement\"||ws(e.latexSelection,t.latexSelection))return!1;let n=li(e),r=li(t);return delete n.latexSelection,delete r.latexSelection,ws(n,r)}function N5(e,t){if(!(e instanceof Cr))return!1;let n=t[e._symbol];return n?!!n.recursionInfo:!1}var tx=class{constructor(t){this.sendMessageForProgressUpdate=t;this.statements={};this.analysis={};this.currentStatus={};this.currentLabel={};this.unpublishedIds={};this.selectionOnlyChangeIds={};this.intersectId=void 0;this.dirtyExportedSymbolRoots={};this.dirtyStatementRoots={};this.markedRegressionDirty=!1;this.childIntersections=new hd;this.use_degrees=!1;this.initialEvaluation=!1;this.globalEventCount=0;this.evaluationMode=\"graphing\";this.product=\"graphing\";this.beta3d=!1;this.restrictedFunctions=!1;this.forceEnableGeometryFunctions=!1;this.functionDefinition=!0;this.replaceRoundWithReciprocal=!1;this.distributions=!0;this.actions=!0;this.substitutions=!0;this.intervalComprehensions=!0;this.recursion=!0;this.lastClockTickTime=void 0;this.dimensions={width:0,height:0};this.includeFunctionParametersInRandomSeed=!0;this.complex=!1;this.customRegressions=!0;this.getCLSymbolMap=mF;this.invalidate()}invalidate(){delete this.statements[sa];for(let t in this.statements)this.statements.hasOwnProperty(t)&&this.markAsDirtyRoot(t);this.currentStatus={},this.analysis={},this.setPolicy(),this.parent_frame=d5[this.evaluationMode].getFrame({restrictedFunctions:this.restrictedFunctions,forceEnableGeometryFunctions:this.forceEnableGeometryFunctions,isGeometryCalculator:this.evaluationMode===\"geometry\",is3DCalculator:this.product===\"graphing-3d\",isComplexEnabled:this.complex,replaceRoundWithReciprocal:this.replaceRoundWithReciprocal,distributions:this.distributions,additionalFunctions:this.additionalFunctions,disableParentheses:this.disableParentheses,trigAngleMultiplier:new So(this.use_degrees?Math.PI/180:Se(1,1)),initialEvaluation:new So(this.initialEvaluation?1:0),globalEventCount:new So(0),globalRandomSeed:new EF(this.globalRandomSeedString||\"\"),width:this.policy.dimensionVarsEnabled()?new So(Se(this.dimensions.width,1)):Hy(\"width\"),height:this.policy.dimensionVarsEnabled()?new So(Se(this.dimensions.height,1)):Hy(\"height\")}),this.mainFrameContext=new Rl(this.parent_frame),this.lastFrame=Tn(this.parent_frame),this.regressionFrameContext=new Rl(this.parent_frame),this.lastClockTickTime=void 0}setPolicy(){let t=this.viewState?{xAxisScale:this.viewState.xAxisScale,yAxisScale:this.viewState.yAxisScale}:void 0;this.policy=p5({evaluationMode:this.evaluationMode,is3dProduct:this.product===\"graphing-3d\",isBeta3d:this.beta3d,isComplexEnabled:this.complex,scales:t,includeFunctionParametersInRandomSeed:this.includeFunctionParametersInRandomSeed,customRegressions:this.customRegressions,isRecursionEnabled:this.recursion})}getAllActionUpdateSymbols(){var n;let t=new Set;for(let r in this.statements){let s=this.statements[r];s.getUpdateSymbols().forEach(o=>t.add(o)),s instanceof M.Ticker&&s.handler.getUpdateSymbols().forEach(o=>t.add(o));let i=this.analysis[r];(Af(s)||i&&!uu(i.getGraphMode())&&tC(i.evaluationState.expression_type))&&((n=s.metaData.clickHandler)==null||n.getUpdateSymbols().forEach(o=>t.add(o)))}return[...new Set(t)]}processChangeSet(t){let n=yc(),r={cacheWrites:0,cacheReads:0,cacheHits:0,cacheMisses:0};wO(r);let s={intersections:{},graphs:{}};t.isCompleteState&&(this.invalidate(),this.statements={},this.currentLabel={});let i=!!t.isCompleteState&&!t.isUndoRedoState;i!==this.initialEvaluation&&(this.initialEvaluation=i,this.parent_frame.initialEvaluation=new So(i?1:0)),t.hasOwnProperty(\"logInternalErrors\")&&Dx(t.logInternalErrors),t.viewState&&this.setViewState(t.viewState),t.hasOwnProperty(\"degreeMode\")&&this.setDegreeMode(t.degreeMode),t.hasOwnProperty(\"globalRandomSeed\")&&this.setGlobalRandomSeed(t.globalRandomSeed),t.hasOwnProperty(\"includeFunctionParametersInRandomSeed\")&&this.setIncludeFunctionParametersInRandomSeed(t.includeFunctionParametersInRandomSeed),t.hasOwnProperty(\"evaluationMode\")&&this.setEvaluationMode(t.evaluationMode),t.hasOwnProperty(\"additionalFunctions\")&&this.setAdditionalFunctions(t.additionalFunctions),t.hasOwnProperty(\"disableParentheses\")&&this.setDisableParentheses(t.disableParentheses),t.hasOwnProperty(\"restrictedFunctions\")&&this.setRestrictedFunctions(t.restrictedFunctions),t.hasOwnProperty(\"forceEnableGeometryFunctions\")&&this.setForceEnableGeometryFunctions(t.forceEnableGeometryFunctions),t.hasOwnProperty(\"distributions\")&&this.setDistributions(t.distributions),t.hasOwnProperty(\"functionDefinition\")&&this.setFunctionDefinition(t.functionDefinition),t.hasOwnProperty(\"replaceRoundWithReciprocal\")&&this.setReplaceRoundWithReciprocal(t.replaceRoundWithReciprocal),t.hasOwnProperty(\"pointsOfInterest\")&&this.setWorkerConfigProperty(\"pointsOfInterest\",t.pointsOfInterest),t.hasOwnProperty(\"plotSingleVariableImplicitEquations\")&&this.setWorkerConfigProperty(\"plotSingleVariableImplicitEquations\",t.plotSingleVariableImplicitEquations),t.hasOwnProperty(\"plotImplicits\")&&this.setWorkerConfigProperty(\"plotImplicits\",t.plotImplicits),t.hasOwnProperty(\"plotInequalities\")&&this.setWorkerConfigProperty(\"plotInequalities\",t.plotInequalities),t.hasOwnProperty(\"sliders\")&&this.setWorkerConfigProperty(\"sliders\",t.sliders),t.hasOwnProperty(\"actions\")&&this.setActions(!!t.actions),t.hasOwnProperty(\"substitutions\")&&this.setSubstitutions(!!t.substitutions),t.hasOwnProperty(\"intervalComprehensions\")&&this.setIntervalComprehensions(!!t.intervalComprehensions),t.hasOwnProperty(\"recursion\")&&this.setRecursion(!!t.recursion);let o=t.recursionDepthLimit;if(o!==void 0&&o>0&&o<=10**6&&RE(o),t.hasOwnProperty(\"beta3d\")&&this.setBeta3d(!!t.beta3d),t.hasOwnProperty(\"product\")&&this.setProduct(t.product),t.hasOwnProperty(\"selectedIds\")){let f=t.selectedIds||{};if(this.intersectId===void 0||!f[this.intersectId]){let[d]=Object.keys(f);this.intersectId=d}}if(t.hasOwnProperty(\"dimensions\")&&this.setDimensions(t.dimensions),t.hasOwnProperty(\"complex\")&&(this.setComplex(!!t.complex),!t.isCompleteState))throw z(\"Complex mode changed without a complete change set.\");t.hasOwnProperty(\"customRegressions\")&&this.setCustomRegressions(!!t.customRegressions);let a=yc();this.processStatements(t,s);let u=yc();r.processStatements=u-a,a=u;let c=this.updateAnalysis();u=yc(),r.updateAnalysis=u-a,a=u;let l=this._publishAllStatuses();u=yc(),r.publishAllStatuses=u-a,a=u,this._computeAllLabels(),u=yc(),r.computeAllLabels=u-a,a=u,this._computeAriaDescriptions(),u=yc(),r.computeAriaDescriptions=u-a,a=u,this._graphAllChanged(s),u=yc(),r.graphAllChanges=u-a,r.updateIntersections=0;let p=this.processEvents(t.events);return this.unpublishedIds={},this.selectionOnlyChangeIds={},r.timeInWorker=u-n,{syncId:t.syncId,isCompleteState:t.isCompleteState,intersectionChanges:s.intersections,statusChanges:l,graphChanges:s.graphs,timingData:r,eventUpdates:p,dependencyOrder:{definitionLevel:c.definitionLevel,multiplyDefined:c.multiplyDefined}}}processStatements(t,n){if(t.removes)for(let r in t.removes){if(!t.isCompleteState&&this.statements.hasOwnProperty(r)){let s=this.statements[r];if(Hi(s))for(let i of s.getColumnIdsForGraphing())this._notifyGraphRemoved(i,n)}this.removeStatement(r,n)}if(t.statements)for(let r in t.statements){let s=t.statements[r];s===null||this.addStatement(s,n)}}setViewState(t){if(ws(t,this.viewState))return;let n=!!(this.viewState&&t.xAxisScale===this.viewState.xAxisScale&&t.yAxisScale===this.viewState.yAxisScale);if(this.viewState=t,n)for(let r in this.statements)this.statements.hasOwnProperty(r)&&this.markUnpublished(r);else this.invalidate()}getViewState(){return this.viewState}setDegreeMode(t){this.use_degrees=t,this.invalidate()}setDimensions(t){t!==void 0&&(this.dimensions=t,this.invalidate())}setGlobalRandomSeed(t){this.globalRandomSeedString=t,this.parent_frame.globalRandomSeed=new EF(t),this.dirtyExportedSymbolRoots.globalRandomSeed=!0}setIncludeFunctionParametersInRandomSeed(t){this.includeFunctionParametersInRandomSeed=t,this.setPolicy()}setEvaluationMode(t){this.evaluationMode=t,this.invalidate()}setProduct(t){this.product=t,this.invalidate()}setBeta3d(t){this.beta3d=t,this.invalidate()}setAdditionalFunctions(t){this.additionalFunctions=t,this.invalidate()}setDisableParentheses(t){this.disableParentheses=t,this.invalidate()}setRestrictedFunctions(t){this.restrictedFunctions=t,this.invalidate()}setForceEnableGeometryFunctions(t){this.forceEnableGeometryFunctions=t,this.invalidate()}setDistributions(t){this.distributions=t,this.invalidate()}setFunctionDefinition(t){this.functionDefinition=t,this.invalidate()}setReplaceRoundWithReciprocal(t){this.replaceRoundWithReciprocal=t,this.invalidate()}setActions(t){t!==this.actions&&(this.actions=t,this.invalidate())}setSubstitutions(t){t!==this.substitutions&&(this.substitutions=t,this.invalidate())}setIntervalComprehensions(t){t!==this.intervalComprehensions&&(this.intervalComprehensions=t,this.invalidate())}setRecursion(t){t!==this.recursion&&(this.recursion=t,this.invalidate())}setComplex(t){t!==this.complex&&(this.complex=t,this.invalidate())}setCustomRegressions(t){t!==this.customRegressions&&(this.customRegressions=t,this.invalidate())}setWorkerConfigProperty(t,n){n!==Si[t]&&(Si[t]=n,this.invalidate())}_publishAllStatuses(){let t={},n=this.currentStatus;this.currentStatus={};for(let r in{...this.unpublishedIds,...this.selectionOnlyChangeIds}){if(!this.analysis.hasOwnProperty(r))continue;let s=this.analysis[r].evaluationState;ws(s,n[r])||(t[r]=s),this.currentStatus[r]=s}return t}_computeAllLabels(){for(let t in this.currentLabel){let n=this.statements[t];if(!n)continue;let r=hc(this.mainFrameContext,n),s=n.tryGetConcreteTree(this.policy,r),i=1;(s.valueType===Pt||s.valueType===Ue||s.valueType===xn||s.valueType===In||s.valueType===On||s.valueType===Nn)&&(i=s.length);let o=[],a=this.currentLabel[t];if(Bo(a))for(let u=0;u<i;u++)o.push(H1(a,this.policy,r,u));ws(o,n.computedLabels)||(n.computedLabels=o,this.markUnpublished(t))}}_computeAriaDescriptions(){for(let t in this.analysis){let n=this.analysis[t],r=n.evaluationState,i=n.rawTree.userData,o;if(i.description?o=i.description:i.label&&(o=i.label),o){r.computed_description=[];let a=1;n.concreteTree.isList?a=n.concreteTree.length:r.dimensions&&r.dimensions.x&&Array.isArray(r.dimensions.x)&&(a=r.dimensions.x.length);for(let u=0;u<a;u++)r.computed_description.push(H1(k1(o),this.policy,hc(this.mainFrameContext,this.statements[t]),u))}}}_graphAllChanged(t){var i;let n=this.getViewState();if(!n||!Mw(n))return;let r=!1,s=!1;for(let o in this.unpublishedIds){if(!this.analysis.hasOwnProperty(o))continue;let a=this.analysis[o],u=a.evaluationState.expression_type,c=u===\"SINGLE_POINT\"||u===\"POINT_LIST\";if(Hi(a.rawTree)){let l=a.graph(n,void 0),p=a.rawTree.getColumnIdsForGraphing();for(let f of p)l[f]?this._notifyGraphComputed(f,l[f],t):this._notifyGraphRemoved(f,t);if((i=a.rawTree.regression)!=null&&i.userData){let f=a.rawTree.regression.userData.id,d=this.analysis[f];if(d!=null&&d.evaluationState.is_graphable&&a.rawTree.regression.userData.shouldGraph){let y=d.graph(n,void 0);this._notifyGraphComputed(f,y,t)}else this._notifyGraphRemoved(f,t)}}else a.evaluationState.is_graphable&&(a.rawTree.userData.shouldGraph||a.rawTree.userData.showLabel&&c)?(this.postProgressUpdate(\"GRAPHING\",[o]),s=!0,this._notifyGraphComputed(o,a.graph(n,this.childIntersections.getChildIntersections(o)),t),o===this.intersectId&&(r=!0,this._updateIntersections(o,t)),this.postProgressUpdate(\"UNPUBLISHED\",[o])):ga(a.rawTree)||this._notifyGraphRemoved(o,t)}s&&!r&&(this.lastComputedIntersectId=void 0),this.intersectId!==void 0&&!r&&(s||this.intersectId!==this.lastComputedIntersectId)&&this._updateIntersections(this.intersectId,t)}_notifyGraphRemoved(t,n){n.graphs[t]=void 0}_notifyGraphComputed(t,n,r){sO(n),r.graphs[t]=n}_updateIntersections(t,n){if(this.lastComputedIntersectId=t,!this.viewState)return;if(!this.analysis[t]||!this.analysis[t].shouldIntersect()){n.intersections[t]=[];return}this.postProgressUpdate(\"GRAPHING\",[t]);let r=eF(this.analysis,this.viewState,t);n.intersections[t]=r,this.postProgressUpdate(\"UNPUBLISHED\",[t])}getDisabledFeatures(){let t=this.policy.disabledFeatures();this.functionDefinition===!1&&(t=t.concat(\"FunctionDefinition\")),this.actions===!1&&(t=t.concat(\"UpdateRule\")),this.substitutions===!1&&(t=t.concat([\"Substitution\",\"ListComprehension\"]));let n=this.additionalFunctions||[];return t=t.filter(r=>!(r===\"Exponent\"&&n.indexOf(\"exponent\")!==-1||r===\"PercentOf\"&&n.indexOf(\"percent\")!==-1)),t}areFractionsDisallowed(){let{evaluationMode:t}=this;return t!==\"fourFunction\"&&t!==\"singleExpressionFourFunction\"?!1:!this.additionalFunctions||this.additionalFunctions.indexOf(\"fraction\")===-1}addStatement(t,n){if(!t)return;let r=t.id,s=this.statements[r],i=s==null?void 0:s.userData,o=!!i&&O5(i,t)&&!N5(s,this.mainFrameContext.global),a={index:this.policy.ansEnabled()?t.index:void 0,disabledFeatures:this.getDisabledFeatures(),disallowFrac:this.areFractionsDisallowed(),disableParentheses:!!this.disableParentheses,allowIntervalComprehensions:!!this.intervalComprehensions,seedPrefix:yn(r),writeIntegral:this.evaluationMode===\"geometry\",specializeDoubleInequalities:!this.policy.is3dProduct(),includeFunctionParametersInRandomSeed:this.includeFunctionParametersInRandomSeed},u={extraDepNodes:[]};switch(t.type){case\"table\":let p;if(s&&Hi(s)){p=new Set([...s.getColumnIdsForGraphing(),...s.getColumnStatementIds()]);let _=s.getRegressionId();_!==void 0&&p.add(_)}t.shouldGraph=!0;let f=t.columns,d=[],y=new Map,g=_=>!_.replace(/\\\\space|\\\\ /g,\"\").match(/\\S/);for(let _=0;_<f.length;_++){let L=f[_],w=Mi(L.latex,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_]])}),U=[],G=-1;for(let re=0;re<f[_].values.length;re++)g(L.values[re])?U.push(new So(NaN)):(U.push(Mi(L.values[re],{...a,seedPrefix:yn(r,[[\"tr\",re+1],[\"tc\",_]])})),G=re);U=U.slice(0,G+1);let Z=new co(w,U,t.id,_),F=`dcgcolumnstmt${L.id}`;Z.userData={id:F},y.set(L.id,Z),this.updateSingleStatement(F,Z,{selectionOnlyChange:o});let Y=new co(w,U,t.id,_);if(Y.userData=L,Y.header){if(Y.header.userData=L,Y.header.metaData={extraDepNodes:[]},L.colorLatex){let re=ri(L.colorLatex,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_],[\"cl\",_]])});Y.header.metaData.colorLatex=re,Y.header.metaData.extraDepNodes.push(re)}if(L.pointSize){let re=ri(L.pointSize,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_],[\"ps\",_]])});Y.header.metaData.pointSize=re,Y.header.metaData.extraDepNodes.push(re)}if(L.pointOpacity){let re=ri(L.pointOpacity,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_],[\"po\",_]])});Y.header.metaData.pointOpacity=re,Y.header.metaData.extraDepNodes.push(re)}if(L.lineWidth){let re=ri(L.lineWidth,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_],[\"lw\",_]])});Y.header.metaData.lineWidth=re,Y.header.metaData.extraDepNodes.push(re)}if(L.lineOpacity){let re=ri(L.lineOpacity,{...a,seedPrefix:yn(r,[[\"tr\",0],[\"tc\",_],[\"lo\",_]])});Y.header.metaData.lineOpacity=re,Y.header.metaData.extraDepNodes.push(re)}}d.push(Y)}let m;t.regression&&(m=IF(t,r,a,y),m!==void 0&&this.updateSingleStatement(t.regression.id,m,{selectionOnlyChange:o}));let h=new Yp(d,[...y.values()],m,r);if(this.updateSingleStatement(r,h,{selectionOnlyChange:o}),p){let _=new Set([...h.getColumnIdsForGraphing(),...h.getColumnStatementIds()]),L=h.getRegressionId();L&&_.add(L);for(let w of p)_.has(w)||this.removeSingleStatement(w,n)}break;case\"image\":let b=\"-\\\\trigAngleMultiplier*(\"+t.angle+\")\",x=ri(t.center,{...a,seedPrefix:yn(r,[[\"ic\",r]])}),T=ri(b,{...a,seedPrefix:yn(r,[[\"ia\",r]])}),D=ri(t.width,{...a,seedPrefix:yn(r,[[\"iw\",r]])}),P=ri(t.height,{...a,seedPrefix:yn(r,[[\"ih\",r]])}),C=ri(t.opacity,{...a,seedPrefix:yn(r,[[\"io\",r]])});this.updateSingleStatement(r,new u5({center:x,radianAngle:T,width:D,height:P,opacity:C},void 0),{selectionOnlyChange:o});break;case\"ticker\":{this.updateSingleStatement(r,new M.Ticker({handler:ri(t.handlerLatex,{...a,allowDt:!0}),minStep:ri(t.minStepLatex||\"0\",a)}),{selectionOnlyChange:o});break}case\"geometry-toolbar-predicate\":{this.updateSingleStatement(r,ri(`\\\\{${t.latex}:1,0\\\\}`,{...a}),{selectionOnlyChange:o});break}default:t=t;let S,O=oa(t.latex);O.slice(-1)===\"=\"?S=O.substring(0,O.length-1):S=t.latex,this.updateSingleStatement(r,Mi(S,a),{selectionOnlyChange:o});for(let _ in wm){let L=_;if(t[L]){let w=wm[L],U=t[L];w.transform&&(U=w.transform(U));let G=yi(U,{...a,seedPrefix:yn(r,[[w.seed,r]])});u[L]=G,u.extraDepNodes.push(G)}}if(t.colorLatex){let _=gc(t.colorLatex,{...a,seedPrefix:yn(r,[[\"ac\",r]])});u.colorLatex=_,u.extraDepNodes.push(_)}if(t.polarDomain&&t.polarDomain.min&&(u.polarDomainMin=yi(t.polarDomain.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.polarDomainMin)),t.polarDomain&&t.polarDomain.max&&(u.polarDomainMax=yi(t.polarDomain.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.polarDomainMax)),t.parametricDomain&&t.parametricDomain.min&&(u.parametricDomainMin=yi(t.parametricDomain.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.parametricDomainMin)),t.parametricDomain&&t.parametricDomain.max&&(u.parametricDomainMax=yi(t.parametricDomain.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.parametricDomainMax)),t.parametricDomain3Du&&t.parametricDomain3Du.min&&(u.parametricDomain3DuMin=yi(t.parametricDomain3Du.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.parametricDomain3DuMin)),t.parametricDomain3Du&&t.parametricDomain3Du.max&&(u.parametricDomain3DuMax=yi(t.parametricDomain3Du.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.parametricDomain3DuMax)),t.parametricDomain3Dv&&t.parametricDomain3Dv.min&&(u.parametricDomain3DvMin=yi(t.parametricDomain3Dv.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.parametricDomain3DvMin)),t.parametricDomain3Dv&&t.parametricDomain3Dv.max&&(u.parametricDomain3DvMax=yi(t.parametricDomain3Dv.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.parametricDomain3DvMax)),t.parametricDomain3Dr&&t.parametricDomain3Dr.min&&(u.parametricDomain3DrMin=yi(t.parametricDomain3Dr.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.parametricDomain3DrMin)),t.parametricDomain3Dr&&t.parametricDomain3Dr.max&&(u.parametricDomain3DrMax=yi(t.parametricDomain3Dr.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.parametricDomain3DrMax)),t.parametricDomain3Dphi&&t.parametricDomain3Dphi.min&&(u.parametricDomain3DphiMin=yi(t.parametricDomain3Dphi.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.parametricDomain3DphiMin)),t.parametricDomain3Dphi&&t.parametricDomain3Dphi.max&&(u.parametricDomain3DphiMax=yi(t.parametricDomain3Dphi.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.parametricDomain3DphiMax)),t.vizProps&&(t.vizProps.axisOffset&&(u.vizAxisOffset=yi(t.vizProps.axisOffset,{...a,seedPrefix:yn(r,[[\"vo\",r]])}),u.extraDepNodes.push(u.vizAxisOffset)),t.vizProps.breadth&&(u.vizBreadth=yi(t.vizProps.breadth,{...a,seedPrefix:yn(r,[[\"vb\",r]])}),u.extraDepNodes.push(u.vizBreadth))),t.cdf&&t.cdf.show){let _=v_(t.latex);_&&_.type===\"distribution\"&&(u.distributionSpec=_,u.cdfMin=gc(t.cdf.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),u.extraDepNodes.push(u.cdfMin),u.cdfMax=gc(t.cdf.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),u.extraDepNodes.push(u.cdfMax))}if(this.statements[r].shouldPromoteToSlider(this.policy)){let _=t.slider,L=!!(_&&_.isPlayingOnce),w=gc(_&&_.softMin,a),U=gc(_&&_.softMax,a),G=gc(_&&_.min,{...a,seedPrefix:yn(r,[[\"lm\",r]])}),Z=gc(_&&_.max,{...a,seedPrefix:yn(r,[[\"lM\",r]])}),F=gc(_&&_.step,{...a,seedPrefix:yn(r,[[\"ls\",r]])});this.updateSingleStatement(r,new c5(this.statements[r],{sliderMin:G,sliderMax:Z,sliderStep:F,sliderIsPlayingOnce:L,sliderSoftMin:w,sliderSoftMax:U}),{selectionOnlyChange:o})}}let c=t.clickableInfo;c&&c.enabled&&c.latex&&(u.clickHandler=ri(c.latex,{...a,allowIndex:!0})),this.statements[r].userData=t,this.statements[r].metaData=u;let l=t.label;if(l){let p=this.currentLabel[r];(!p||p.raw!==l)&&(this.currentLabel[r]=k1(l))}else delete this.currentLabel[r]}updateSingleStatement(t,n,{selectionOnlyChange:r}){r?this.selectionOnlyChangeIds[t]=!0:(this.markExportsDirty(t),this.markAsDirtyRoot(t)),this.statements[t]=n}removeStatement(t,n){let r=this.statements[t];if(r&&Hi(r)){for(let i of r.getColumnStatementIds())this.removeSingleStatement(i,n);let s=r.getRegressionId();s&&this.removeSingleStatement(s,n)}this.removeSingleStatement(t,n)}removeSingleStatement(t,n){this.statements[t]&&(this.markExportsDirty(t),this._notifyGraphRemoved(t,n),delete this.currentLabel[t],delete this.statements[t],delete this.analysis[t],delete this.currentStatus[t])}markExportsDirty(t){if(this.statements[t]){ui(this.statements[t])&&(this.markedRegressionDirty=!0);for(let n of this.statements[t].getLegalExports(this.policy))this.dirtyExportedSymbolRoots[n]=!0}}markAsDirtyRoot(t){this.dirtyStatementRoots[t]=!0}markUnpublished(t){var r;let n=this.statements[t];n&&ga(n)||n&&ui(n)&&((r=n.tableRegressionData)==null?void 0:r.tableId)!==void 0||(this.unpublishedIds[t]=!0,delete this.selectionOnlyChangeIds[t])}getFrame(){return this.updateAnalysis(),this.mainFrameContext.global}getAnalysis(){return this.updateAnalysis(),this.analysis}getEvaluationState(t){if(this.updateAnalysis(),!!this.analysis[t])return this.analysis[t].evaluationState}_updateRegressions(t){var l;let n=this.lastFrame,r=this.regressionFrameContext;if(!this.policy.graphingEnabled())return;let s=[];for(let p of t.keys())ui(this.statements[p])&&s.push(p);let i=this;s.sort((p,f)=>{var g,m;let d=(g=i.statements[p].userData)==null?void 0:g.residualVariable,y=(m=i.statements[f].userData)==null?void 0:m.residualVariable;return d&&!y?-1:y&&!d?1:0});let o=_f(this.policy,this.statements,s);$P(r.global,o),MF(o,r,this.recursion);let a=o.resolved;this.postProgressUpdate(\"RESOLVED\",a);let u={};for(let p in this.statements){let f=this.statements[p];f&&Hi(f)&&(u[p]=f)}let c=new Set;for(let p of a){if(p===sa){this.postProgressUpdate(\"UNPUBLISHED\",[p]);continue}if(c.has(p))continue;this.postProgressUpdate(\"ANALYZING\",[p]);let f=this.statements[p];if(ui(f)){let d=((l=f.tableRegressionData)==null?void 0:l.tableId)===void 0?hc(r,f):hc(r,u[f.tableRegressionData.tableId]),y=f.analyzeRegression(this.policy,d,this.mainFrameContext.global,n,u);this.analysis[p]=y;let g=this.exportTo({id:p,stmtAnalysis:y},this.mainFrameContext);y.evaluationState.exported_variables=g,t.delete(p),this.postProgressUpdate(\"UNPUBLISHED\",[p])}else{let d=hc(r,f),y=this.analyzeSingleStatementGraphing(p,this.analysis,d,o,\"regression\"),g=[];for(let m of y)this.exportTo(m,r),g.push(m.id),m.id!==p&&c.add(m.id);this.postProgressUpdate(\"UNPUBLISHED\",g)}}}_updateAnalysisAndFrame(t,n,r){var u;let s=this.analysis;$P(this.mainFrameContext.global,t),MF(t,this.mainFrameContext,this.recursion);let o=t.resolved.filter(c=>r.has(c)).concat(Object.keys(this.selectionOnlyChangeIds));this.postProgressUpdate(\"RESOLVED\",o);let a=new Set;for(let c of o){if(c===sa){this.postProgressUpdate(\"UNPUBLISHED\",[c]);continue}if(n.has(c)){this.postProgressUpdate(\"UNPUBLISHED\",[c]);continue}if(a.has(c))continue;this.postProgressUpdate(\"ANALYZING\",[c]);let l=this.analyzeSingleStatement(c,s,t),p=[];for(let f of l){s[f.id]=f.stmtAnalysis;let d=this.exportTo(f,this.mainFrameContext);if(Hi(f.stmtAnalysis.rawTree)){let y=f.stmtAnalysis.rawTree.getColumnStatementIds();for(let g of y){let m=this.analysis[g],h=(u=m==null?void 0:m.evaluationState.exported_variables)!=null?u:[];d.push(...h)}}f.stmtAnalysis.evaluationState.exported_variables=d,p.push(f.id),f.id!==c&&a.add(f.id)}this.postProgressUpdate(\"UNPUBLISHED\",p)}return{analyzedStatements:o}}exportTo(t,n){let r=t.stmtAnalysis.rawTree.exportTo(this.policy,t.stmtAnalysis.concreteTree,n.global),s=this.statements[t.id];if(s instanceof co){let i=hc(n,s);s.exportToLocal(this.policy,t.stmtAnalysis.concreteTree,i)}return r}buildSymbolToExpressionDirtyMap(){return Jw(this.policy,this.statements)}buildChildIntersectionMap(){let t=this.childIntersections,n=new hd;for(let s in this.analysis){let i=this.analysis[s],{geometry:o}=i.evaluationState;if(o!=null&&o.call&&o.call.symbol===\"intersection\"&&this.statements[s].userData.shouldGraph&&!i.concreteTree.isError){let a=!!this.unpublishedIds[s],u=i.concreteTree.asTypedValue();for(let c of o.call.parents){if(c.type===\"arbitrary-expression\")continue;let l=Ta(c);if(!l)continue;let p=this.mainFrameContext.global[l],f=p&&p.userData.id;if(f==null)continue;let y=this.analysis[f].concreteTree.asTypedValue();y&&u&&n.addChildIntersection({id:f,valueType:y.valueType,ref:c},u),a&&this.markUnpublished(f)}}}let r=hd.compareIntersectionCounts({nextChildIntersections:n,prevChildIntersections:t});for(let s in r){let{prev:i,next:o}=r[s];o<i&&this.markUnpublished(s)}return n}findAllRegressionExports(){let t=new Map,n={};for(let r of We(this.statements)){let s=this.statements[r];if(!ui(s))continue;let i=this.analysis[r];if(!i||!ui(i.rawTree))continue;let o=i.concreteTree,a=i.rawTree.getExportsFromConcrete(this.policy,o);t.set(r,a);for(let u of a)n[u]=!0}return{regressionExportMap:t,regressionExportRoots:n}}updateConstruction(){if(!this.policy.isGeometryEnabled){this.parent_frame.construction=nf();return}let t=[];for(let o in this.statements)this.statements[o].userData.isInConstructionsFolder&&t.push(o);let n=this.statements[sa],r=new l5(t);r.metaData={extraDepNodes:[]},r.userData={};let s={};for(let o of(n==null?void 0:n.getDependencies())||[])s[o]=!0;let i={};for(let o of r.getDependencies())i[o]=!0;(!n||!ws(s,i))&&(this.statements[sa]=r,this.parent_frame.construction=r,this.markAsDirtyRoot(sa),this.markExportsDirty(sa))}analyzeExternalRecursiveBaseCases(){if(!this.recursion)return;let t=[],n={};for(let a of Object.keys(this.statements)){let u=this.statements[a];u instanceof Cr&&!this.policy.assignmentForbidden(u._symbol)&&(t.push(a),n[u._symbol]=u)}let{recursiveFunctionGroups:r}=_f(this.policy,this.statements,t),s=new Set;for(let a of t){let u=this.statements[a];u instanceof Cr&&r[a]&&s.add(u._symbol)}let i={},o=[];for(let a of Object.keys(this.statements)){let u=this.statements[a];if(u instanceof ku&&s.has(u._lhs._symbol)){let c=Qr.fromCallAssignment(n,u);if(!c)continue;this.updateSingleStatement(a,c,{selectionOnlyChange:!1});let l=c._symbol;i[l]||(i[l]=[]),i[l].push(c),c.getDependencies().length&&o.push(a)}else if(u instanceof Qr){let c=u._symbol;s.has(u._symbol)?(i[c]||(i[c]=[]),i[c].push(u),u.getDependencies().length&&o.push(a)):this.updateSingleStatement(a,u.originalNode,{selectionOnlyChange:!1})}}for(let a of We(n)){let u=n[a],c=u.getExternalBaseCases(),l=i[a]||[];R5(l,c)||(u.setExternalBaseCases(l),this.markExportsDirty(u.userData.id),this.markAsDirtyRoot(u.userData.id))}if(o.length){let{recursiveFunctionBaseCasesWithCycles:a}=_f(this.policy,this.statements,o);for(let u of a){let c=this.statements[u];if(c instanceof Qr){let l=n[c._symbol];l.setExternalBaseCases(l.getExternalBaseCases().filter(p=>p!==c)),this.statements[u]=c.originalNode}}}}updateAnalysis(){var y,g,m,h;this.updateConstruction(),this.analyzeExternalRecursiveBaseCases();let t=this.buildSymbolToExpressionDirtyMap(),n=Am(this.policy,this.statements,t,this.dirtyStatementRoots,this.dirtyExportedSymbolRoots),r=this.markedRegressionDirty;for(let b in n.ids)this.statements[b]&&ui(this.statements[b])&&(r=!0);let s=new Set;if(r){for(let b in this.statements)this.statements[b]&&s.add(b);this.mainFrameContext=new Rl(this.parent_frame),this.regressionFrameContext=new Rl(this.parent_frame)}else{let b=n.ids;for(let T in b)this.statements[T]&&s.add(T);let x=n.symbols;for(let T of We(x))x[T]&&(delete this.mainFrameContext.global[T],delete this.regressionFrameContext.global[T])}let i=!1;for(let b of s.keys())this.markUnpublished(b),this.mainFrameContext.hasLocalFrame(b)&&(i=!0,this.mainFrameContext.deleteLocalFrame(b));if(i)for(let b in this.statements){let x=this.statements[b];x.localFrameID&&s.has(x.localFrameID)&&s.add(b)}this.markedRegressionDirty=!1,this.dirtyExportedSymbolRoots={},this.dirtyStatementRoots={};let o=this.analysis;(this.evaluationMode===\"graphing\"||this.evaluationMode===\"geometry\"||this.evaluationMode===\"graphing_3d\")&&this._updateRegressions(s);let{regressionExportMap:a,regressionExportRoots:u}=this.findAllRegressionExports(),c=_f(this.policy,this.statements,We(this.statements),a),{analyzedStatements:l}=this._updateAnalysisAndFrame(c,new Set(a.keys()),s),p=Am(this.policy,this.statements,t,{},u);this.markRegressionDependents(p.ids);for(let b in this.analysis){let x=this.analysis[b];if(ui(x.rawTree)&&((y=x.rawTree.tableRegressionData)!=null&&y.tableId)){let T=x.evaluationState,D=this.analysis[x.rawTree.tableRegressionData.tableId];if(!D)throw new Error(`Programming error: table ${x.rawTree.tableRegressionData.tableId} not found for table regression ${b}`);let P=D.evaluationState;if(T.regression){let S=x.rawTree.tableRegressionData.columnInfo.filter(L=>L.isIdentifier).map(L=>no(L.latex)).filter(L=>this.policy.assignmentForbidden(L)),O=(g=x.rawTree.tableRegressionData.columnInfo.find(L=>!L.isIdentifier))==null?void 0:g.latex,_;S.length>0?_=qP(S).getError():O&&(_=UP(O).getError()),P.table_regression={status:\"success\",result:T.regression,export_info:_?{status:\"unexportable\",reason:_}:{status:\"exportable\"}}}else P.table_regression={status:\"error\",error:(m=T.error)!=null?m:z('Expected regression state to define either \"regression\" or \"error\"').getError()}}}if(this.policy.graphingEnabled()){for(let b of l)this.evaluateMetadataForStatement(b,hc(this.mainFrameContext,this.statements[b]),this.policy);this.childIntersections=this.buildChildIntersectionMap()}Qw(t).forEach(b=>{o[b].evaluationState.depends_on_random_seed=!0});let f=Am(this.policy,this.statements,t,{[sa]:!0},{construction:!0});for(let b in f.ids){if(b===sa)continue;let x=o[b].evaluationState;x.geometry&&(x.geometry.unconstructable=!0)}let d;for(let b in this.statements)if((h=this.statements[b].userData)!=null&&h.latexSelection){d=b;break}if(d){let b=Am(this.policy,this.statements,t,{[d]:!0},{[`idref_${d}`]:!0});for(let x in b.ids){if(x===sa)continue;let T=o[x].evaluationState;T.geometry&&(T.geometry.depends_on_selected=!0)}}this.lastFrame=Tn(this.parent_frame);for(let b of We(this.mainFrameContext.global))this.lastFrame[b]=this.mainFrameContext.global[b];return c}analyzeSingleStatement(t,n,r){switch(this.evaluationMode){case\"fourFunction\":case\"singleExpressionFourFunction\":return[{id:t,stmtAnalysis:this.statements[t].analyzeFourFunction(this.policy,this.mainFrameContext.global,n)}];case\"scientific\":return[{id:t,stmtAnalysis:this.statements[t].analyzeScientific(this.policy,this.mainFrameContext.global,n)}];case\"singleExpressionScientific\":return[{id:t,stmtAnalysis:this.statements[t].analyzeSingleExpressionScientific(this.policy,this.mainFrameContext.global,n)}];case\"graphing\":case\"graphing_3d\":case\"geometry\":return this.analyzeSingleStatementGraphing(t,n,hc(this.mainFrameContext,this.statements[t]),r,\"main\")}}analyzeSingleStatementGraphing(t,n,r,s,i){if(!this.policy.graphingEnabled())throw z(\"Expected graphing policy\");if(i===\"main\"&&r.r){let a=Tn(r);a.r=void 0;let u=this.statements[t].analyze(this.policy,a,n);if(u.getGraphMode()===6)return[{id:t,stmtAnalysis:u}]}let o=s.recursiveFunctionGroups[t];if(o&&this.recursion){if(i===\"regression\")for(let u of o){let c=this.statements[u],l=xT(),p={policy:this.policy,rawTree:c,concreteTree:l};return[{id:u,stmtAnalysis:p}]}let a={};for(let u of o)a[u]=this.statements[u];return Ww(this.policy,r,a)}if(i===\"regression\"){let a=this.statements[t],u=a.tryGetConcreteTree(this.policy,r),c={policy:this.policy,rawTree:a,concreteTree:u};return[{id:t,stmtAnalysis:c}]}else{let a=this.statements[t].analyze(this.policy,r,n);return[{id:t,stmtAnalysis:a}]}}evaluateMetadataForStatement(t,n,r){if(t===sa)return;let s=this.analysis[t],i=s.evaluationState.expression_type;for(let o in wm){let a=o,u=wm[a];this.evaluationMode!==\"graphing_3d\"&&a===\"resolution\"||(!u.shouldEvaluate||u.shouldEvaluate(s))&&P5(s,r,n,a)}E5(s,r,n),this.product===\"graphing-3d\"&&M5(s),this.actions&&m5(s)&&C5(s,r,n),i===\"PARAMETRIC\"||i===\"CURVE3D_xyz_t\"||i===\"POLAR\"||i===\"SURFACE_r_\\u03B8z\"||i===\"SURFACE_r_\\u03B8z_AMBIGUOUS\"||i===\"SLICE_r\\u03B8z_at_z\"?D5(s,r,n):i===\"SURFACE_xyz_uv\"||i===\"SLICE_xyz_uv\"||i===\"SURFACE_r_\\u03B8\\u03C6\"||i===\"SURFACE_z_r\\u03B8\"||i===\"SLICE_zr\\u03B8_at_r\"||i===\"SLICE_zr\\u03B8_at_\\u03B8\"||i===\"SLICE_zr\\u03B8_at_xyz\"||i===\"SLICE_r\\u03B8\\u03C6_at_\\u03B8\"||i===\"SLICE_r\\u03B8\\u03C6_at_\\u03C6\"||i===\"SLICE_r\\u03B8\\u03C6_at_xyz\"?S5(s,r,n):i===\"BOXPLOT\"?v5(s,r,n):f5(s)&&T5(s,r,n)}markRegressionDependents(t){for(let n in this.analysis){let r=this.analysis[n];if(ga(r.rawTree)){let s=this.analysis[r.rawTree.tableID];if(!s)continue;let i=s.evaluationState.column_data[r.rawTree.columnIndex];if(!i)continue;i.depends_on_regression=!!t[n]}else r.evaluationState.depends_on_regression=!!t[n]}}processEvents(t){if(!t||!this.actions)return;let n=Tn(this.mainFrameContext.global),r={},s=!1,i=!1,o;for(let a of t)switch(this.globalEventCount+=1,n.globalEventCount=new M.Constant(this.globalEventCount),a.type){case\"step\":{let c=this.statements[a.expressionId];if(!c)continue;let l=c.tryGetConcreteTree(this.policy,n);i=!0,z1(l,r,n);break}case\"click\":{let c=this.statements[a.expressionId];if(!c||!c.metaData.clickHandler)continue;n.index=new M.Constant(a.indexVar+1);let l=c.metaData.clickHandler.tryGetConcreteTree(this.policy,n);i=!0,s=!0,z1(l,r,n);break}case\"clock-tick\":{(o===void 0||a.isFirstTick&&!o.isFirstTick)&&(o=a);break}default:return a}if(o){let a=this.statements[o.id];if(a&&a instanceof M.Ticker){let u=a.minStep.tryGetConcreteTree(this.policy,n,q1).asValue();if(typeof u==\"number\"&&u>=0&&isFinite(u)){let l=this.lastClockTickTime;if(this.lastClockTickTime=Date.now(),!o.isFirstTick&&l!==void 0){n.dt=new M.Constant(this.lastClockTickTime-l);let p=a.handler.tryGetConcreteTree(this.policy,n);z1(p,r,n)}}}}return{objectClicked:s,userAction:i,updates:r}}postProgressUpdate(t,n){var r;(r=this.sendMessageForProgressUpdate)==null||r.call(this,\"evaluatorProgressUpdate\",{update:t,ids:n})}};function R5(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var vF=class{constructor(t){this.context=new tx(t),this.sendMessage=t}processChangeSet(t){let n=this.context.processChangeSet(t);this.sendMessage(\"processChangeSet\",n)}};Object.defineProperty(__dcg_chunk_exports__, 'a', { get: () => _5 });\nObject.defineProperty(__dcg_chunk_exports__, 'b', { get: () => L5 });\nObject.defineProperty(__dcg_chunk_exports__, 'c', { get: () => w5 });\nObject.defineProperty(__dcg_chunk_exports__, 'd', { get: () => ia });\nObject.defineProperty(__dcg_chunk_exports__, 'e', { get: () => F5 });\nObject.defineProperty(__dcg_chunk_exports__, 'f', { get: () => V5 });\nObject.defineProperty(__dcg_chunk_exports__, 'g', { get: () => G5 });\nObject.defineProperty(__dcg_chunk_exports__, 'h', { get: () => u8 });\nObject.defineProperty(__dcg_chunk_exports__, 'i', { get: () => li });\nObject.defineProperty(__dcg_chunk_exports__, 'j', { get: () => kD });\nObject.defineProperty(__dcg_chunk_exports__, 'k', { get: () => Fl });\nObject.defineProperty(__dcg_chunk_exports__, 'l', { get: () => qm });\nObject.defineProperty(__dcg_chunk_exports__, 'm', { get: () => XF });\nObject.defineProperty(__dcg_chunk_exports__, 'n', { get: () => pY });\nObject.defineProperty(__dcg_chunk_exports__, 'o', { get: () => dY });\nObject.defineProperty(__dcg_chunk_exports__, 'p', { get: () => Ll });\nObject.defineProperty(__dcg_chunk_exports__, 'q', { get: () => pD });\nObject.defineProperty(__dcg_chunk_exports__, 'r', { get: () => ZF });\nObject.defineProperty(__dcg_chunk_exports__, 's', { get: () => mY });\nObject.defineProperty(__dcg_chunk_exports__, 't', { get: () => yY });\nObject.defineProperty(__dcg_chunk_exports__, 'u', { get: () => gY });\nObject.defineProperty(__dcg_chunk_exports__, 'v', { get: () => xY });\nObject.defineProperty(__dcg_chunk_exports__, 'w', { get: () => TY });\nObject.defineProperty(__dcg_chunk_exports__, 'x', { get: () => PY });\nObject.defineProperty(__dcg_chunk_exports__, 'y', { get: () => EY });\nObject.defineProperty(__dcg_chunk_exports__, 'z', { get: () => ux });\nObject.defineProperty(__dcg_chunk_exports__, 'A', { get: () => cx });\nObject.defineProperty(__dcg_chunk_exports__, 'B', { get: () => JF });\nObject.defineProperty(__dcg_chunk_exports__, 'C', { get: () => eV });\nObject.defineProperty(__dcg_chunk_exports__, 'D', { get: () => SY });\nObject.defineProperty(__dcg_chunk_exports__, 'E', { get: () => NY });\nObject.defineProperty(__dcg_chunk_exports__, 'F', { get: () => RY });\nObject.defineProperty(__dcg_chunk_exports__, 'G', { get: () => gi });\nObject.defineProperty(__dcg_chunk_exports__, 'H', { get: () => Ed });\nObject.defineProperty(__dcg_chunk_exports__, 'I', { get: () => cV });\nObject.defineProperty(__dcg_chunk_exports__, 'J', { get: () => ws });\nObject.defineProperty(__dcg_chunk_exports__, 'K', { get: () => wY });\nObject.defineProperty(__dcg_chunk_exports__, 'L', { get: () => Vl });\nObject.defineProperty(__dcg_chunk_exports__, 'M', { get: () => Bl });\nObject.defineProperty(__dcg_chunk_exports__, 'N', { get: () => fV });\nObject.defineProperty(__dcg_chunk_exports__, 'O', { get: () => UY });\nObject.defineProperty(__dcg_chunk_exports__, 'P', { get: () => $Y });\nObject.defineProperty(__dcg_chunk_exports__, 'Q', { get: () => FD });\nObject.defineProperty(__dcg_chunk_exports__, 'R', { get: () => tF });\nObject.defineProperty(__dcg_chunk_exports__, 'S', { get: () => $K });\nObject.defineProperty(__dcg_chunk_exports__, 'T', { get: () => nu });\nObject.defineProperty(__dcg_chunk_exports__, 'U', { get: () => YK });\nObject.defineProperty(__dcg_chunk_exports__, 'V', { get: () => nF });\nObject.defineProperty(__dcg_chunk_exports__, 'W', { get: () => Vs });\nObject.defineProperty(__dcg_chunk_exports__, 'X', { get: () => AA });\nObject.defineProperty(__dcg_chunk_exports__, 'Y', { get: () => mo });\nObject.defineProperty(__dcg_chunk_exports__, 'Z', { get: () => wh });\nObject.defineProperty(__dcg_chunk_exports__, '_', { get: () => kn });\nObject.defineProperty(__dcg_chunk_exports__, '$', { get: () => E });\nObject.defineProperty(__dcg_chunk_exports__, 'aa', { get: () => Qt });\nObject.defineProperty(__dcg_chunk_exports__, 'ba', { get: () => I });\nObject.defineProperty(__dcg_chunk_exports__, 'ca', { get: () => De });\nObject.defineProperty(__dcg_chunk_exports__, 'da', { get: () => N });\nObject.defineProperty(__dcg_chunk_exports__, 'ea', { get: () => ut });\nObject.defineProperty(__dcg_chunk_exports__, 'fa', { get: () => pn });\nObject.defineProperty(__dcg_chunk_exports__, 'ga', { get: () => ne });\nObject.defineProperty(__dcg_chunk_exports__, 'ha', { get: () => Xn });\nObject.defineProperty(__dcg_chunk_exports__, 'ia', { get: () => Pt });\nObject.defineProperty(__dcg_chunk_exports__, 'ja', { get: () => $e });\nObject.defineProperty(__dcg_chunk_exports__, 'ka', { get: () => Ro });\nObject.defineProperty(__dcg_chunk_exports__, 'la', { get: () => ft });\nObject.defineProperty(__dcg_chunk_exports__, 'ma', { get: () => Kt });\nObject.defineProperty(__dcg_chunk_exports__, 'na', { get: () => rr });\nObject.defineProperty(__dcg_chunk_exports__, 'oa', { get: () => xe });\nObject.defineProperty(__dcg_chunk_exports__, 'pa', { get: () => In });\nObject.defineProperty(__dcg_chunk_exports__, 'qa', { get: () => de });\nObject.defineProperty(__dcg_chunk_exports__, 'ra', { get: () => xn });\nObject.defineProperty(__dcg_chunk_exports__, 'sa', { get: () => ce });\nObject.defineProperty(__dcg_chunk_exports__, 'ta', { get: () => Wn });\nObject.defineProperty(__dcg_chunk_exports__, 'ua', { get: () => ie });\nObject.defineProperty(__dcg_chunk_exports__, 'va', { get: () => Fn });\nObject.defineProperty(__dcg_chunk_exports__, 'wa', { get: () => fe });\nObject.defineProperty(__dcg_chunk_exports__, 'xa', { get: () => jn });\nObject.defineProperty(__dcg_chunk_exports__, 'ya', { get: () => Ne });\nObject.defineProperty(__dcg_chunk_exports__, 'za', { get: () => Vn });\nObject.defineProperty(__dcg_chunk_exports__, 'Aa', { get: () => Le });\nObject.defineProperty(__dcg_chunk_exports__, 'Ba', { get: () => On });\nObject.defineProperty(__dcg_chunk_exports__, 'Ca', { get: () => ye });\nObject.defineProperty(__dcg_chunk_exports__, 'Da', { get: () => Nn });\nObject.defineProperty(__dcg_chunk_exports__, 'Ea', { get: () => Re });\nObject.defineProperty(__dcg_chunk_exports__, 'Fa', { get: () => Rr });\nObject.defineProperty(__dcg_chunk_exports__, 'Ga', { get: () => le });\nObject.defineProperty(__dcg_chunk_exports__, 'Ha', { get: () => Jn });\nObject.defineProperty(__dcg_chunk_exports__, 'Ia', { get: () => Gt });\nObject.defineProperty(__dcg_chunk_exports__, 'Ja', { get: () => Gs });\nObject.defineProperty(__dcg_chunk_exports__, 'Ka', { get: () => R });\nObject.defineProperty(__dcg_chunk_exports__, 'La', { get: () => Ue });\nObject.defineProperty(__dcg_chunk_exports__, 'Ma', { get: () => Pn });\nObject.defineProperty(__dcg_chunk_exports__, 'Na', { get: () => cs });\nObject.defineProperty(__dcg_chunk_exports__, 'Oa', { get: () => H });\nObject.defineProperty(__dcg_chunk_exports__, 'Pa', { get: () => fr });\nObject.defineProperty(__dcg_chunk_exports__, 'Qa', { get: () => wt });\nObject.defineProperty(__dcg_chunk_exports__, 'Ra', { get: () => mr });\nObject.defineProperty(__dcg_chunk_exports__, 'Sa', { get: () => Rn });\nObject.defineProperty(__dcg_chunk_exports__, 'Ta', { get: () => yr });\nObject.defineProperty(__dcg_chunk_exports__, 'Ua', { get: () => Hn });\nObject.defineProperty(__dcg_chunk_exports__, 'Va', { get: () => Ar });\nObject.defineProperty(__dcg_chunk_exports__, 'Wa', { get: () => ke });\nObject.defineProperty(__dcg_chunk_exports__, 'Xa', { get: () => gr });\nObject.defineProperty(__dcg_chunk_exports__, 'Ya', { get: () => RD });\nObject.defineProperty(__dcg_chunk_exports__, 'Za', { get: () => Qn });\nObject.defineProperty(__dcg_chunk_exports__, '_a', { get: () => RV });\nObject.defineProperty(__dcg_chunk_exports__, '$a', { get: () => at });\nObject.defineProperty(__dcg_chunk_exports__, 'ab', { get: () => oe });\nObject.defineProperty(__dcg_chunk_exports__, 'bb', { get: () => j });\nObject.defineProperty(__dcg_chunk_exports__, 'cb', { get: () => Ve });\nObject.defineProperty(__dcg_chunk_exports__, 'db', { get: () => Sd });\nObject.defineProperty(__dcg_chunk_exports__, 'eb', { get: () => Qm });\nObject.defineProperty(__dcg_chunk_exports__, 'fb', { get: () => se });\nObject.defineProperty(__dcg_chunk_exports__, 'gb', { get: () => ua });\nObject.defineProperty(__dcg_chunk_exports__, 'hb', { get: () => kt });\nObject.defineProperty(__dcg_chunk_exports__, 'ib', { get: () => Ae });\nObject.defineProperty(__dcg_chunk_exports__, 'jb', { get: () => ny });\nObject.defineProperty(__dcg_chunk_exports__, 'kb', { get: () => Ie });\nObject.defineProperty(__dcg_chunk_exports__, 'lb', { get: () => Pm });\nObject.defineProperty(__dcg_chunk_exports__, 'mb', { get: () => Db });\nObject.defineProperty(__dcg_chunk_exports__, 'nb', { get: () => Jse });\nObject.defineProperty(__dcg_chunk_exports__, 'ob', { get: () => wD });\nObject.defineProperty(__dcg_chunk_exports__, 'pb', { get: () => eie });\nObject.defineProperty(__dcg_chunk_exports__, 'qb', { get: () => sie });\nObject.defineProperty(__dcg_chunk_exports__, 'rb', { get: () => iie });\nObject.defineProperty(__dcg_chunk_exports__, 'sb', { get: () => wL });\nObject.defineProperty(__dcg_chunk_exports__, 'tb', { get: () => oie });\nObject.defineProperty(__dcg_chunk_exports__, 'ub', { get: () => Dr });\nObject.defineProperty(__dcg_chunk_exports__, 'vb', { get: () => uie });\nObject.defineProperty(__dcg_chunk_exports__, 'wb', { get: () => cie });\nObject.defineProperty(__dcg_chunk_exports__, 'xb', { get: () => VL });\nObject.defineProperty(__dcg_chunk_exports__, 'yb', { get: () => kL });\nObject.defineProperty(__dcg_chunk_exports__, 'zb', { get: () => Sb });\nObject.defineProperty(__dcg_chunk_exports__, 'Ab', { get: () => HL });\nObject.defineProperty(__dcg_chunk_exports__, 'Bb', { get: () => zL });\nObject.defineProperty(__dcg_chunk_exports__, 'Cb', { get: () => UL });\nObject.defineProperty(__dcg_chunk_exports__, 'Db', { get: () => Pie });\nObject.defineProperty(__dcg_chunk_exports__, 'Eb', { get: () => Eie });\nObject.defineProperty(__dcg_chunk_exports__, 'Fb', { get: () => c8 });\nObject.defineProperty(__dcg_chunk_exports__, 'Gb', { get: () => Mie });\nObject.defineProperty(__dcg_chunk_exports__, 'Hb', { get: () => Cie });\nObject.defineProperty(__dcg_chunk_exports__, 'Ib', { get: () => W1 });\nObject.defineProperty(__dcg_chunk_exports__, 'Jb', { get: () => Bm });\nObject.defineProperty(__dcg_chunk_exports__, 'Kb', { get: () => tY });\nObject.defineProperty(__dcg_chunk_exports__, 'Lb', { get: () => Oi });\nObject.defineProperty(__dcg_chunk_exports__, 'Mb', { get: () => Va });\nObject.defineProperty(__dcg_chunk_exports__, 'Nb', { get: () => to });\nObject.defineProperty(__dcg_chunk_exports__, 'Ob', { get: () => kF });\nObject.defineProperty(__dcg_chunk_exports__, 'Pb', { get: () => rY });\nObject.defineProperty(__dcg_chunk_exports__, 'Qb', { get: () => sY });\nObject.defineProperty(__dcg_chunk_exports__, 'Rb', { get: () => si });\nObject.defineProperty(__dcg_chunk_exports__, 'Sb', { get: () => iY });\nObject.defineProperty(__dcg_chunk_exports__, 'Tb', { get: () => fx });\nObject.defineProperty(__dcg_chunk_exports__, 'Ub', { get: () => PV });\nObject.defineProperty(__dcg_chunk_exports__, 'Vb', { get: () => CD });\nObject.defineProperty(__dcg_chunk_exports__, 'Wb', { get: () => yx });\nObject.defineProperty(__dcg_chunk_exports__, 'Xb', { get: () => SD });\nObject.defineProperty(__dcg_chunk_exports__, 'Yb', { get: () => Zm });\nObject.defineProperty(__dcg_chunk_exports__, 'Zb', { get: () => vD });\nObject.defineProperty(__dcg_chunk_exports__, '_b', { get: () => kl });\nObject.defineProperty(__dcg_chunk_exports__, '$b', { get: () => qr });\nObject.defineProperty(__dcg_chunk_exports__, 'ac', { get: () => no });\nObject.defineProperty(__dcg_chunk_exports__, 'bc', { get: () => oa });\nObject.defineProperty(__dcg_chunk_exports__, 'cc', { get: () => Ic });\nObject.defineProperty(__dcg_chunk_exports__, 'dc', { get: () => Oo });\nObject.defineProperty(__dcg_chunk_exports__, 'ec', { get: () => xi });\nObject.defineProperty(__dcg_chunk_exports__, 'fc', { get: () => $D });\nObject.defineProperty(__dcg_chunk_exports__, 'gc', { get: () => EX });\nObject.defineProperty(__dcg_chunk_exports__, 'hc', { get: () => vX });\nObject.defineProperty(__dcg_chunk_exports__, 'ic', { get: () => gf });\nObject.defineProperty(__dcg_chunk_exports__, 'jc', { get: () => tg });\nObject.defineProperty(__dcg_chunk_exports__, 'kc', { get: () => Md });\nObject.defineProperty(__dcg_chunk_exports__, 'lc', { get: () => WY });\nObject.defineProperty(__dcg_chunk_exports__, 'mc', { get: () => Cc });\nObject.defineProperty(__dcg_chunk_exports__, 'nc', { get: () => IT });\nObject.defineProperty(__dcg_chunk_exports__, 'oc', { get: () => HV });\nObject.defineProperty(__dcg_chunk_exports__, 'pc', { get: () => zV });\nObject.defineProperty(__dcg_chunk_exports__, 'qc', { get: () => We });\nObject.defineProperty(__dcg_chunk_exports__, 'rc', { get: () => Tn });\nObject.defineProperty(__dcg_chunk_exports__, 'sc', { get: () => bX });\nObject.defineProperty(__dcg_chunk_exports__, 'tc', { get: () => ls });\nObject.defineProperty(__dcg_chunk_exports__, 'uc', { get: () => Ts });\nObject.defineProperty(__dcg_chunk_exports__, 'vc', { get: () => wB });\nObject.defineProperty(__dcg_chunk_exports__, 'wc', { get: () => hr });\nObject.defineProperty(__dcg_chunk_exports__, 'xc', { get: () => xE });\nObject.defineProperty(__dcg_chunk_exports__, 'yc', { get: () => pp });\nObject.defineProperty(__dcg_chunk_exports__, 'zc', { get: () => yp });\nObject.defineProperty(__dcg_chunk_exports__, 'Ac', { get: () => gp });\nObject.defineProperty(__dcg_chunk_exports__, 'Bc', { get: () => ZE });\nObject.defineProperty(__dcg_chunk_exports__, 'Cc', { get: () => WE });\nObject.defineProperty(__dcg_chunk_exports__, 'Dc', { get: () => EE });\nObject.defineProperty(__dcg_chunk_exports__, 'Ec', { get: () => Z2 });\nObject.defineProperty(__dcg_chunk_exports__, 'Fc', { get: () => Dv });\nObject.defineProperty(__dcg_chunk_exports__, 'Gc', { get: () => j2 });\nObject.defineProperty(__dcg_chunk_exports__, 'Hc', { get: () => Rg });\nObject.defineProperty(__dcg_chunk_exports__, 'Ic', { get: () => Ef });\nObject.defineProperty(__dcg_chunk_exports__, 'Jc', { get: () => jE });\nObject.defineProperty(__dcg_chunk_exports__, 'Kc', { get: () => JE });\nObject.defineProperty(__dcg_chunk_exports__, 'Lc', { get: () => Sv });\nObject.defineProperty(__dcg_chunk_exports__, 'Mc', { get: () => K2 });\nObject.defineProperty(__dcg_chunk_exports__, 'Nc', { get: () => vv });\nObject.defineProperty(__dcg_chunk_exports__, 'Oc', { get: () => eG });\nObject.defineProperty(__dcg_chunk_exports__, 'Pc', { get: () => Ov });\nObject.defineProperty(__dcg_chunk_exports__, 'Qc', { get: () => tG });\nObject.defineProperty(__dcg_chunk_exports__, 'Rc', { get: () => yG });\nObject.defineProperty(__dcg_chunk_exports__, 'Sc', { get: () => bG });\nObject.defineProperty(__dcg_chunk_exports__, 'Tc', { get: () => xG });\nObject.defineProperty(__dcg_chunk_exports__, 'Uc', { get: () => oo });\nObject.defineProperty(__dcg_chunk_exports__, 'Vc', { get: () => Et });\nObject.defineProperty(__dcg_chunk_exports__, 'Wc', { get: () => tt });\nObject.defineProperty(__dcg_chunk_exports__, 'Xc', { get: () => Jr });\nObject.defineProperty(__dcg_chunk_exports__, 'Yc', { get: () => Nu });\nObject.defineProperty(__dcg_chunk_exports__, 'Zc', { get: () => Bo });\nObject.defineProperty(__dcg_chunk_exports__, '_c', { get: () => $Z });\nObject.defineProperty(__dcg_chunk_exports__, '$c', { get: () => Mk });\nObject.defineProperty(__dcg_chunk_exports__, 'ad', { get: () => M });\nObject.defineProperty(__dcg_chunk_exports__, 'bd', { get: () => $j });\nObject.defineProperty(__dcg_chunk_exports__, 'cd', { get: () => sh });\nObject.defineProperty(__dcg_chunk_exports__, 'dd', { get: () => _O });\nObject.defineProperty(__dcg_chunk_exports__, 'ed', { get: () => zo });\nObject.defineProperty(__dcg_chunk_exports__, 'fd', { get: () => Ta });\nObject.defineProperty(__dcg_chunk_exports__, 'gd', { get: () => Gf });\nObject.defineProperty(__dcg_chunk_exports__, 'hd', { get: () => UO });\nObject.defineProperty(__dcg_chunk_exports__, 'id', { get: () => oK });\nObject.defineProperty(__dcg_chunk_exports__, 'jd', { get: () => pe });\nObject.defineProperty(__dcg_chunk_exports__, 'kd', { get: () => hK });\nObject.defineProperty(__dcg_chunk_exports__, 'ld', { get: () => bK });\nObject.defineProperty(__dcg_chunk_exports__, 'md', { get: () => lr });\nObject.defineProperty(__dcg_chunk_exports__, 'nd', { get: () => qR });\nObject.defineProperty(__dcg_chunk_exports__, 'od', { get: () => Be });\nObject.defineProperty(__dcg_chunk_exports__, 'pd', { get: () => DM });\nObject.defineProperty(__dcg_chunk_exports__, 'qd', { get: () => OA });\nObject.defineProperty(__dcg_chunk_exports__, 'rd', { get: () => UA });\nObject.defineProperty(__dcg_chunk_exports__, 'sd', { get: () => Mi });\nObject.defineProperty(__dcg_chunk_exports__, 'td', { get: () => $z });\nObject.defineProperty(__dcg_chunk_exports__, 'ud', { get: () => v_ });\nObject.defineProperty(__dcg_chunk_exports__, 'vd', { get: () => eC });\nObject.defineProperty(__dcg_chunk_exports__, 'wd', { get: () => tC });\nObject.defineProperty(__dcg_chunk_exports__, 'xd', { get: () => O_ });\nObject.defineProperty(__dcg_chunk_exports__, 'yd', { get: () => N_ });\nObject.defineProperty(__dcg_chunk_exports__, 'zd', { get: () => R_ });\nObject.defineProperty(__dcg_chunk_exports__, 'Ad', { get: () => Un });\nObject.defineProperty(__dcg_chunk_exports__, 'Bd', { get: () => tb });\nObject.defineProperty(__dcg_chunk_exports__, 'Cd', { get: () => YU });\nObject.defineProperty(__dcg_chunk_exports__, 'Dd', { get: () => va });\nObject.defineProperty(__dcg_chunk_exports__, 'Ed', { get: () => uu });\nObject.defineProperty(__dcg_chunk_exports__, 'Fd', { get: () => Hre });\nObject.defineProperty(__dcg_chunk_exports__, 'Gd', { get: () => st });\nObject.defineProperty(__dcg_chunk_exports__, 'Hd', { get: () => Cq });\nObject.defineProperty(__dcg_chunk_exports__, 'Id', { get: () => vC });\nObject.defineProperty(__dcg_chunk_exports__, 'Jd', { get: () => OC });\nObject.defineProperty(__dcg_chunk_exports__, 'Kd', { get: () => NC });\nObject.defineProperty(__dcg_chunk_exports__, 'Ld', { get: () => yb });\nObject.defineProperty(__dcg_chunk_exports__, 'Md', { get: () => gb });\nObject.defineProperty(__dcg_chunk_exports__, 'Nd', { get: () => sc });\nObject.defineProperty(__dcg_chunk_exports__, 'Od', { get: () => Tm });\nObject.defineProperty(__dcg_chunk_exports__, 'Pd', { get: () => _L });\nObject.defineProperty(__dcg_chunk_exports__, 'Qd', { get: () => JC });\nObject.defineProperty(__dcg_chunk_exports__, 'Rd', { get: () => Ob });\nObject.defineProperty(__dcg_chunk_exports__, 'Sd', { get: () => l8 });\nObject.defineProperty(__dcg_chunk_exports__, 'Td', { get: () => qL });\nObject.defineProperty(__dcg_chunk_exports__, 'Ud', { get: () => p8 });\nObject.defineProperty(__dcg_chunk_exports__, 'Vd', { get: () => $L });\nObject.defineProperty(__dcg_chunk_exports__, 'Wd', { get: () => vb });\nObject.defineProperty(__dcg_chunk_exports__, 'Xd', { get: () => f8 });\nObject.defineProperty(__dcg_chunk_exports__, 'Yd', { get: () => QC });\nObject.defineProperty(__dcg_chunk_exports__, 'Zd', { get: () => Cl });\nObject.defineProperty(__dcg_chunk_exports__, '_d', { get: () => m8 });\nObject.defineProperty(__dcg_chunk_exports__, '$d', { get: () => y8 });\nObject.defineProperty(__dcg_chunk_exports__, 'ae', { get: () => Aie });\nObject.defineProperty(__dcg_chunk_exports__, 'be', { get: () => b8 });\nObject.defineProperty(__dcg_chunk_exports__, 'ce', { get: () => JL });\nObject.defineProperty(__dcg_chunk_exports__, 'de', { get: () => A8 });\nObject.defineProperty(__dcg_chunk_exports__, 'ee', { get: () => Ab });\nObject.defineProperty(__dcg_chunk_exports__, 'fe', { get: () => bw });\nObject.defineProperty(__dcg_chunk_exports__, 'ge', { get: () => Voe });\nObject.defineProperty(__dcg_chunk_exports__, 'he', { get: () => Boe });\nObject.defineProperty(__dcg_chunk_exports__, 'ie', { get: () => Id });\nObject.defineProperty(__dcg_chunk_exports__, 'je', { get: () => wa });\nObject.defineProperty(__dcg_chunk_exports__, 'ke', { get: () => i$ });\nObject.defineProperty(__dcg_chunk_exports__, 'le', { get: () => pae });\nObject.defineProperty(__dcg_chunk_exports__, 'me', { get: () => l$ });\nObject.defineProperty(__dcg_chunk_exports__, 'ne', { get: () => F1 });\nObject.defineProperty(__dcg_chunk_exports__, 'oe', { get: () => yF });\nObject.defineProperty(__dcg_chunk_exports__, 'pe', { get: () => gF });\nObject.defineProperty(__dcg_chunk_exports__, 'qe', { get: () => Lm });\nObject.defineProperty(__dcg_chunk_exports__, 're', { get: () => K$ });\nObject.defineProperty(__dcg_chunk_exports__, 'se', { get: () => e5 });\nObject.defineProperty(__dcg_chunk_exports__, 'te', { get: () => TF });\nObject.defineProperty(__dcg_chunk_exports__, 'ue', { get: () => jle });\nObject.defineProperty(__dcg_chunk_exports__, 've', { get: () => tx });\nObject.defineProperty(__dcg_chunk_exports__, 'we', { get: () => vF });\n\n    return __dcg_chunk_exports__;\n  })();"
  const __dcg_shared_module_exports__ = eval(__dcg_shared_module_source__);
  const __dcg_worker_source_exports__ = (function () {
    // worker.js
    const __dcg_worker_source__ = `
      // store the code for the worker module as a function that takes the shared module exports as an argument
      const __dcg_worker_module__ = (__dcg_shared_module_exports__) => {
` + "var n={};__dcg_shared_module_exports__['g'].log=function(e){self.postMessage({log:JSON.stringify(e)})};var o=self;o.window=o;o.onmessage=function(e){let s=e.data&&e.data.connectionId;if(s)if(e.data.originalMessage.type===\"destroy\")delete n[s];else{let a=n[s];a||(a=new __dcg_shared_module_exports__['we']((r,g)=>{o.postMessage({connectionId:s,originalMessage:{type:r,payload:g}})}),n[s]=a),a.processChangeSet(e.data.originalMessage)}};o.loadMessageQueue&&(o.loadMessageQueue.forEach(e=>{o.onmessage(e)}),delete o.loadMessageQueue);\n" + `
      };
      // execute the shared module store its exports
      const __dcg_worker_shared_module_exports__ = ${__dcg_shared_module_source__};
      // call the worker module, passing in the shared module exports
      __dcg_worker_module__(__dcg_worker_shared_module_exports__);`

    let createWorker;
    if (typeof Blob !== 'undefined' && URL && typeof URL.createObjectURL === 'function') {
      createWorker = () => {
        const workerURL = URL.createObjectURL(new Blob([__dcg_worker_source__], { type: 'application/javascript' }))
        const worker = new Worker(workerURL);
        worker.revokeObjectURL = () => {
          URL.revokeObjectURL(workerURL);
        }
        return worker;
      }
    } else {
      // Just for testing in Node
      createWorker = () => {
        (new Function(__dcg_worker_source__))();
      }
    }

    return {createWorker, default: {createWorker}};
  })();
  function Fk(r){return r==null?r+"":typeof r=="object"||typeof r=="function"?Rk[e4.call(r)]||"object":typeof r}function OO(r){var e=!!r&&"length"in r&&r.length,t=Fk(r);return vh(r)||ex(r)?!1:t==="array"||e===0||typeof e=="number"&&e>0&&e-1 in r}function Xy(r,e){return r.nodeName&&r.nodeName.toLowerCase()===e.toLowerCase()}function goe(r,e){return e.toUpperCase()}function yh(r){return r.replace(uoe,"ms-").replace(hoe,goe)}function s0(){this.expando=be.expando+s0.uid++}function boe(r){return r==="true"?!0:r==="false"?!1:r==="null"?null:r===+r+""?+r:moe.test(r)?JSON.parse(r):r}function zq(r,e,t){var o;if(t===void 0&&r.nodeType===1)if(o="data-"+e.replace(foe,"-$&").toLowerCase(),t=r.getAttribute(o),typeof t=="string"){try{t=boe(t)}catch(i){}xh.set(r,e,t)}else t=void 0;return t}function xoe(r,e,t,o){var i,n,a=20,s=o?function(){return o.cur()}:function(){return be.css(r,e,"")},l=s(),c=t&&t[3]||(be.cssNumber[e]?"":"px"),d=r.nodeType&&(be.cssNumber[e]||c!=="px"&&+l)&&Nk.exec(be.css(r,e));if(d&&d[3]!==c){for(l=l/2,c=c||d[3],d=+l||1;a--;)be.style(r,e,d+c),(1-n)*(1-(n=s()/l||.5))<=0&&(a=0),d=d/n;d=d*2,be.style(r,e,d+c),t=t||[]}return t&&(d=+d||+l||0,i=t[1]?d+(t[1]+1)*t[2]:+t[2],o&&(o.unit=c,o.start=d,o.end=i)),i}function Qy(){return!0}function Zy(){return!1}function woe(r,e){return r===voe()==(e==="focus")}function voe(){try{return ja.activeElement}catch(r){}}function NO(r,e,t,o,i,n){var a,s;if(typeof e=="object"){typeof t!="string"&&(o=o||t,t=void 0);for(s in e)NO(r,s,t,o,e[s],n);return r}if(o==null&&i==null?(i=t,o=t=void 0):i==null&&(typeof t=="string"?(i=o,o=void 0):(i=o,o=t,t=void 0)),i===!1)i=Zy;else if(!i)return r;return n===1&&(a=i,i=function(l){return be().off(l),a.apply(this,arguments)},i.guid=a.guid||(a.guid=be.guid++)),r.each(function(){be.event.add(this,e,i,o,t)})}function Ok(r,e,t){if(!t){tn.get(r,e)===void 0&&be.event.add(r,e,Qy);return}tn.set(r,e,!1),be.event.add(r,e,{namespace:!1,handler:function(o){var i,n,a=tn.get(this,e);if(o.isTrigger&1&&this[e]){if(a.length)(be.event.special[e]||{}).delegateType&&o.stopPropagation();else if(a=Vk.call(arguments),tn.set(this,e,a),i=t(this,e),this[e](),n=tn.get(this,e),a!==n||i?tn.set(this,e,!1):n={},a!==n)return o.stopImmediatePropagation(),o.preventDefault(),n&&n.value}else a.length&&(tn.set(this,e,{value:be.event.trigger(be.extend(a[0],be.Event.prototype),a.slice(1),this)}),o.stopImmediatePropagation())}})}function n0(r,e,t){var o,i,n,a,s=r.style;return t=t||Bk(r),t&&(a=t.getPropertyValue(e)||t[e],a===""&&!n4(r)&&(a=be.style(r,e)),!Ya.pixelBoxStyles()&&qO.test(a)&&Coe.test(e)&&(o=s.width,i=s.minWidth,n=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=t.width,s.width=o,s.minWidth=i,s.maxWidth=n)),a!==void 0?a+"":a}function s4(r,e){return{get:function(){if(r()){delete this.get;return}return(this.get=e).apply(this,arguments)}}}function Soe(r){for(var e=r[0].toUpperCase()+r.slice(1),t=Kq.length;t--;)if(r=Kq[t]+e,r in l4)return r}function $q(r){var e=be.cssProps[r]||Wq[r];return e||(r in l4?r:Wq[r]=Soe(r)||r)}function c4(r,e,t){var o=Nk.exec(e);return o?Math.max(0,o[2]-(t||0))+(o[3]||"px"):e}function BO(r,e,t,o,i,n){var a=e==="width"?1:0,s=0,l=0;if(t===(o?"border":"content"))return 0;for(;a<4;a+=2)t==="margin"&&(l+=be.css(r,t+Ug[a],!0,i)),o?(t==="content"&&(l-=be.css(r,"padding"+Ug[a],!0,i)),t!=="margin"&&(l-=be.css(r,"border"+Ug[a]+"Width",!0,i))):(l+=be.css(r,"padding"+Ug[a],!0,i),t!=="padding"?l+=be.css(r,"border"+Ug[a]+"Width",!0,i):s+=be.css(r,"border"+Ug[a]+"Width",!0,i));return!o&&n>=0&&(l+=Math.max(0,Math.ceil(r["offset"+e[0].toUpperCase()+e.slice(1)]-n-l-s-.5))||0),l}function Xq(r,e,t){var o=Bk(r),i=!Ya.boxSizingReliable()||t,n=i&&be.css(r,"boxSizing",!1,o)==="border-box",a=n,s=n0(r,e,o),l="offset"+e[0].toUpperCase()+e.slice(1);if(qO.test(s)){if(!t)return s;s="auto"}return(!Ya.boxSizingReliable()&&n||!Ya.reliableTrDimensions()&&Xy(r,"tr")||s==="auto"||!parseFloat(s)&&be.css(r,"display",!1,o)==="inline")&&r.getClientRects().length&&(n=be.css(r,"boxSizing",!1,o)==="border-box",a=l in r,a&&(s=r[l])),s=parseFloat(s)||0,s+BO(r,e,t||(n?"border":"content"),a,o,s)+"px"}function UO(r,e,t,o){var i;if(Array.isArray(e))be.each(e,function(n,a){t||koe.test(r)?o(r,a):UO(r+"["+(typeof a=="object"&&a!=null?n:"")+"]",a,t,o)});else if(!t&&Fk(e)==="object")for(i in e)UO(r+"["+i+"]",e[i],t,o);else o(r,e)}var wh,aoe,Vk,soe,Zq,loe,Rk,e4,Lk,t4,coe,Ya,vh,ex,ja,r4,be,doe,o4,poe,FO,a0,uoe,hoe,Pk,tn,xh,moe,foe,i4,Nk,Ug,Jy,n4,yoe,RO,Hq,qO,Bk,a4,Coe,Kq,l4,Wq,Eoe,jq,Doe,Yq,Jq,Qq,koe,_oe,Toe,Goe,re,$t=__dcg_shared_module_exports__['b'](()=>{"use strict";wh=[],aoe=Object.getPrototypeOf,Vk=wh.slice,soe=wh.flat?function(r){return wh.flat.call(r)}:function(r){return wh.concat.apply([],r)},Zq=wh.push,loe=wh.indexOf,Rk={},e4=Rk.toString,Lk=Rk.hasOwnProperty,t4=Lk.toString,coe=t4.call(Object),Ya={},vh=function(e){return typeof e=="function"&&typeof e.nodeType!="number"&&typeof e.item!="function"},ex=function(e){return e!=null&&e===e.window},ja=window.document;r4="3.6.0",be=function(r,e){return new be.fn.init(r,e)};be.fn=be.prototype={jquery:r4,constructor:be,length:0,toArray:function(){return Vk.call(this)},get:function(r){return r==null?Vk.call(this):r<0?this[r+this.length]:this[r]},pushStack:function(r){var e=be.merge(this.constructor(),r);return e.prevObject=this,e},each:function(r){return be.each(this,r)},map:function(r){return this.pushStack(be.map(this,function(e,t){return r.call(e,t,e)}))},slice:function(){return this.pushStack(Vk.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(be.grep(this,function(r,e){return(e+1)%2}))},odd:function(){return this.pushStack(be.grep(this,function(r,e){return e%2}))},eq:function(r){var e=this.length,t=+r+(r<0?e:0);return this.pushStack(t>=0&&t<e?[this[t]]:[])},end:function(){return this.prevObject||this.constructor()},push:Zq,sort:wh.sort,splice:wh.splice};be.extend=be.fn.extend=function(){var r,e,t,o,i,n,a=arguments[0]||{},s=1,l=arguments.length,c=!1;for(typeof a=="boolean"&&(c=a,a=arguments[s]||{},s++),typeof a!="object"&&!vh(a)&&(a={}),s===l&&(a=this,s--);s<l;s++)if((r=arguments[s])!=null)for(e in r)o=r[e],!(e==="__proto__"||a===o)&&(c&&o&&(be.isPlainObject(o)||(i=Array.isArray(o)))?(t=a[e],i&&!Array.isArray(t)?n=[]:!i&&!be.isPlainObject(t)?n={}:n=t,i=!1,a[e]=be.extend(c,n,o)):o!==void 0&&(a[e]=o));return a};be.extend({expando:"jQuery"+(r4+Math.random()).replace(/\D/g,""),isReady:!0,error:function(r){throw new Error(r)},noop:function(){},isPlainObject:function(r){var e,t;return!r||e4.call(r)!=="[object Object]"?!1:(e=aoe(r),e?(t=Lk.call(e,"constructor")&&e.constructor,typeof t=="function"&&t4.call(t)===coe):!0)},isEmptyObject:function(r){var e;for(e in r)return!1;return!0},each:function(r,e){var t,o=0;if(OO(r))for(t=r.length;o<t&&e.call(r[o],o,r[o])!==!1;o++);else for(o in r)if(e.call(r[o],o,r[o])===!1)break;return r},makeArray:function(r,e){var t=e||[];return r!=null&&(OO(Object(r))?be.merge(t,typeof r=="string"?[r]:r):Zq.call(t,r)),t},inArray:function(r,e,t){return e==null?-1:loe.call(e,r,t)},merge:function(r,e){for(var t=+e.length,o=0,i=r.length;o<t;o++)r[i++]=e[o];return r.length=i,r},grep:function(r,e,t){for(var o,i=[],n=0,a=r.length,s=!t;n<a;n++)o=!e(r[n],n),o!==s&&i.push(r[n]);return i},map:function(r,e,t){var o,i,n=0,a=[];if(OO(r))for(o=r.length;n<o;n++)i=e(r[n],n,t),i!=null&&a.push(i);else for(n in r)i=e(r[n],n,t),i!=null&&a.push(i);return soe(a)},guid:1,support:Ya});typeof Symbol=="function"&&(be.fn[Symbol.iterator]=wh[Symbol.iterator]);be.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(r,e){Rk["[object "+e+"]"]=e.toLowerCase()});doe=function(r){var e,t,o,i,n,a,s,l=r.document,c=[],d=c.push,p=c.push,u=c.slice,h=/HTML$/i,m=/^[^{]+\{\s*\[native \w/,y=function(){o()};try{p.apply(c=u.call(l.childNodes),l.childNodes),c[l.childNodes.length].nodeType}catch(C){p={apply:c.length?function(v,E){d.apply(v,u.call(E))}:function(v,E){for(var _=v.length,T=0;v[_++]=E[T++];);v.length=_-1}}}function w(){}function S(C){var v=i.createElement("fieldset");try{return!!C(v)}catch(E){return!1}finally{v.parentNode&&v.parentNode.removeChild(v),v=null}}return e=w.support={},t=w.isXML=function(C){var v=C&&C.namespaceURI,E=C&&(C.ownerDocument||C).documentElement;return!h.test(v||E&&E.nodeName||"HTML")},o=w.setDocument=function(C){var v,E,_=C?C.ownerDocument||C:l;return _==i||_.nodeType!==9||!_.documentElement||(i=_,n=i.documentElement,a=!t(i),l!=i&&(E=i.defaultView)&&E.top!==E&&(E.addEventListener?E.addEventListener("unload",y,!1):E.attachEvent&&E.attachEvent("onunload",y)),e.attributes=S(function(T){return T.className="i",!T.getAttribute("className")}),e.getElementsByTagName=S(function(T){return T.appendChild(i.createComment("")),!T.getElementsByTagName("*").length}),v=m.test(n.compareDocumentPosition),s=v||m.test(n.contains)?function(T,I){var P=T.nodeType===9?T.documentElement:T,O=I&&I.parentNode;return T===O||!!(O&&O.nodeType===1&&(P.contains?P.contains(O):T.compareDocumentPosition&&T.compareDocumentPosition(O)&16))}:function(T,I){if(I){for(;I=I.parentNode;)if(I===T)return!0}return!1}),i},w.contains=function(C,v){return(C.ownerDocument||C)!=i&&o(C),s(C,v)},o(),e.sortDetached=S(function(C){return C.compareDocumentPosition(i.createElement("fieldset"))&1}),w}(window);be.contains=doe.contains;poe=be.fn.init=function(r,e,t){if(!r)return this;if(t=t||o4,typeof r=="string")throw new Error("$(string) implementation has been removed");if(r.nodeType)return this[0]=r,this.length=1,this;if(vh(r))throw new Error("$(function) implementation has been removed");return be.makeArray(r,this)};poe.prototype=be.fn;o4=be(ja);FO=/[^\x20\t\r\n\f]+/g,a0=function(r,e,t,o,i,n,a){var s=0,l=r.length,c=t==null;if(Fk(t)==="object"){i=!0;for(s in t)a0(r,e,s,t[s],!0,n,a)}else if(o!==void 0&&(i=!0,vh(o)||(a=!0),c&&(a?(e.call(r,o),e=null):(c=e,e=function(d,p,u){return c.call(be(d),u)})),e))for(;s<l;s++)e(r[s],t,a?o:o.call(r[s],s,e(r[s],t)));return i?r:c?e.call(r):l?e(r[0],t):n},uoe=/^-ms-/,hoe=/-([a-z])/g;Pk=function(r){return r.nodeType===1||r.nodeType===9||!+r.nodeType};s0.uid=1;s0.prototype={cache:function(r){var e=r[this.expando];return e||(e={},Pk(r)&&(r.nodeType?r[this.expando]=e:Object.defineProperty(r,this.expando,{value:e,configurable:!0}))),e},set:function(r,e,t){var o,i=this.cache(r);if(typeof e=="string")i[yh(e)]=t;else for(o in e)i[yh(o)]=e[o];return i},get:function(r,e){return e===void 0?this.cache(r):r[this.expando]&&r[this.expando][yh(e)]},access:function(r,e,t){return e===void 0||e&&typeof e=="string"&&t===void 0?this.get(r,e):(this.set(r,e,t),t!==void 0?t:e)},remove:function(r,e){var t,o=r[this.expando];if(o!==void 0){if(e!==void 0)for(Array.isArray(e)?e=e.map(yh):(e=yh(e),e=e in o?[e]:e.match(FO)||[]),t=e.length;t--;)delete o[e[t]];(e===void 0||be.isEmptyObject(o))&&(r.nodeType?r[this.expando]=void 0:delete r[this.expando])}},hasData:function(r){var e=r[this.expando];return e!==void 0&&!be.isEmptyObject(e)}};tn=new s0,xh=new s0,moe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,foe=/[A-Z]/g;be.extend({hasData:function(r){return xh.hasData(r)||tn.hasData(r)},data:function(r,e,t){return xh.access(r,e,t)},removeData:function(r,e){xh.remove(r,e)},_data:function(r,e,t){return tn.access(r,e,t)},_removeData:function(r,e){tn.remove(r,e)}});be.fn.extend({data:function(r,e){var t,o,i,n=this[0],a=n&&n.attributes;if(r===void 0){if(this.length&&(i=xh.get(n),n.nodeType===1&&!tn.get(n,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&(o=a[t].name,o.indexOf("data-")===0&&(o=yh(o.slice(5)),zq(n,o,i[o])));tn.set(n,"hasDataAttrs",!0)}return i}return typeof r=="object"?this.each(function(){xh.set(this,r)}):a0(this,function(s){var l;if(n&&s===void 0)return l=xh.get(n,r),l!==void 0||(l=zq(n,r),l!==void 0)?l:void 0;this.each(function(){xh.set(this,r,s)})},null,e,arguments.length>1,null,!0)},removeData:function(r){return this.each(function(){xh.remove(this,r)})}});i4=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Nk=new RegExp("^(?:([+-])=|)("+i4+")([a-z%]*)$","i"),Ug=["Top","Right","Bottom","Left"],Jy=ja.documentElement,n4=function(r){return be.contains(r.ownerDocument,r)},yoe={composed:!0};Jy.getRootNode&&(n4=function(r){return be.contains(r.ownerDocument,r)||r.getRootNode(yoe)===r.ownerDocument});RO=/^(?:checkbox|radio)$/i;(function(){var r=ja.createDocumentFragment(),e=r.appendChild(ja.createElement("div")),t=ja.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),Ya.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",Ya.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,e.innerHTML="<option></option>",Ya.option=!!e.lastChild})();Hq=/^([^.]*)(?:\.(.+)|)/;be.event={global:{},add:function(r,e,t,o,i){var n,a,s,l,c,d,p,u,h,m,y,w=tn.get(r);if(Pk(r)){if(t.handler&&(n=t,t=n.handler,i=n.selector),i)throw new Error("Support for event delegation has been removed");for(t.guid||(t.guid=be.guid++),(l=w.events)||(l=w.events=Object.create(null)),(a=w.handle)||(a=w.handle=function(S){return typeof be!="undefined"&&be.event.triggered!==S.type?be.event.dispatch.apply(r,arguments):void 0}),e=(e||"").match(FO)||[""],c=e.length;c--;)if(s=Hq.exec(e[c])||[],h=y=s[1],m=(s[2]||"").split(".").sort(),!!h){if(p=be.event.special[h]||{},h=(i?p.delegateType:p.bindType)||h,p=be.event.special[h]||{},d=be.extend({type:h,origType:y,data:o,handler:t,guid:t.guid,selector:i,namespace:m.join(".")},n),(u=l[h])||(u=l[h]=[],u.delegateCount=0,(!p.setup||p.setup.call(r,o,m,a)===!1)&&r.addEventListener&&r.addEventListener(h,a)),p.add&&(p.add.call(r,d),d.handler.guid||(d.handler.guid=t.guid)),i)throw new Error("Support for event delegation has been removed");u.push(d),be.event.global[h]=!0}}},remove:function(r,e,t,o,i){var n,a,s,l,c,d,p,u,h,m,y,w=tn.hasData(r)&&tn.get(r);if(!(!w||!(l=w.events))){for(e=(e||"").match(FO)||[""],c=e.length;c--;){if(s=Hq.exec(e[c])||[],h=y=s[1],m=(s[2]||"").split(".").sort(),!h){for(h in l)be.event.remove(r,h+e[c],t,o,!0);continue}for(p=be.event.special[h]||{},h=(o?p.delegateType:p.bindType)||h,u=l[h]||[],s=s[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=n=u.length;n--;)d=u[n],(i||y===d.origType)&&(!t||t.guid===d.guid)&&(!s||s.test(d.namespace))&&(!o||o===d.selector||o==="**"&&d.selector)&&(u.splice(n,1),d.selector&&u.delegateCount--,p.remove&&p.remove.call(r,d));a&&!u.length&&((!p.teardown||p.teardown.call(r,m,w.handle)===!1)&&be.removeEvent(r,h,w.handle),delete l[h])}be.isEmptyObject(l)&&tn.remove(r,"handle events")}},dispatch:function(r){var e,t,o,i,n,a,s=new Array(arguments.length),l=be.event.fix(r),c=(tn.get(this,"events")||Object.create(null))[l.type]||[],d=be.event.special[l.type]||{};for(s[0]=l,e=1;e<arguments.length;e++)s[e]=arguments[e];if(l.delegateTarget=this,!(d.preDispatch&&d.preDispatch.call(this,l)===!1)){for(a=be.event.handlers.call(this,l,c),e=0;(i=a[e++])&&!l.isPropagationStopped();)for(l.currentTarget=i.elem,t=0;(n=i.handlers[t++])&&!l.isImmediatePropagationStopped();)(!l.rnamespace||n.namespace===!1||l.rnamespace.test(n.namespace))&&(l.handleObj=n,l.data=n.data,o=((be.event.special[n.origType]||{}).handle||n.handler).apply(i.elem,s),o!==void 0&&(l.result=o)===!1&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(r,e){var t=[],o=e.delegateCount,i=r.target;if(o)throw new Error("Support for event delegtaion has been removed");return i=this,o<e.length&&t.push({elem:i,handlers:e.slice(o)}),t},addProp:function(r,e){Object.defineProperty(be.Event.prototype,r,{enumerable:!0,configurable:!0,get:vh(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[r]},set:function(t){Object.defineProperty(this,r,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(r){return r[be.expando]?r:new be.Event(r)},special:{load:{noBubble:!0},click:{setup:function(r){var e=this||r;return RO.test(e.type)&&e.click&&Xy(e,"input")&&Ok(e,"click",Qy),!1},trigger:function(r){var e=this||r;return RO.test(e.type)&&e.click&&Xy(e,"input")&&Ok(e,"click"),!0},_default:function(r){var e=r.target;return RO.test(e.type)&&e.click&&Xy(e,"input")&&tn.get(e,"click")||Xy(e,"a")}},beforeunload:{postDispatch:function(r){r.result!==void 0&&r.originalEvent&&(r.originalEvent.returnValue=r.result)}}}};be.removeEvent=function(r,e,t){r.removeEventListener&&r.removeEventListener(e,t)};be.Event=function(r,e){if(!(this instanceof be.Event))return new be.Event(r,e);r&&r.type?(this.originalEvent=r,this.type=r.type,this.isDefaultPrevented=r.defaultPrevented||r.defaultPrevented===void 0&&r.returnValue===!1?Qy:Zy,this.target=r.target&&r.target.nodeType===3?r.target.parentNode:r.target,this.currentTarget=r.currentTarget,this.relatedTarget=r.relatedTarget):this.type=r,e&&be.extend(this,e),this.timeStamp=r&&r.timeStamp||Date.now(),this[be.expando]=!0};be.Event.prototype={constructor:be.Event,isDefaultPrevented:Zy,isPropagationStopped:Zy,isImmediatePropagationStopped:Zy,isSimulated:!1,preventDefault:function(){var r=this.originalEvent;this.isDefaultPrevented=Qy,r&&!this.isSimulated&&r.preventDefault()},stopPropagation:function(){var r=this.originalEvent;this.isPropagationStopped=Qy,r&&!this.isSimulated&&r.stopPropagation()},stopImmediatePropagation:function(){var r=this.originalEvent;this.isImmediatePropagationStopped=Qy,r&&!this.isSimulated&&r.stopImmediatePropagation(),this.stopPropagation()}};be.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},be.event.addProp);be.each({focus:"focusin",blur:"focusout"},function(r,e){be.event.special[r]={setup:function(){return Ok(this,r,woe),!1},trigger:function(){return Ok(this,r),!0},_default:function(){return!0},delegateType:e}});be.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(r,e){be.event.special[r]={delegateType:e,bindType:e,handle:function(t){var o,i=this,n=t.relatedTarget,a=t.handleObj;return(!n||n!==i&&!be.contains(i,n))&&(t.type=a.origType,o=a.handler.apply(this,arguments),t.type=e),o}}});be.fn.extend({on:function(r,e,t,o){return NO(this,r,e,t,o)},one:function(r,e,t,o){return NO(this,r,e,t,o,1)},off:function(r,e,t){var o,i;if(r&&r.preventDefault&&r.handleObj)return o=r.handleObj,be(r.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if(typeof r=="object"){for(i in r)this.off(i,e,r[i]);return this}return(e===!1||typeof e=="function")&&(t=e,e=void 0),t===!1&&(t=Zy),this.each(function(){be.event.remove(this,r,t,e)})}});qO=new RegExp("^("+i4+")(?!px)[a-z%]+$","i"),Bk=function(r){var e=r.ownerDocument.defaultView;return(!e||!e.opener)&&(e=window),e.getComputedStyle(r)},a4=function(r,e,t){var o,i,n={};for(i in e)n[i]=r.style[i],r.style[i]=e[i];o=t.call(r);for(i in e)r.style[i]=n[i];return o},Coe=new RegExp(Ug.join("|"),"i");(function(){function r(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Jy.appendChild(l).appendChild(c);var d=window.getComputedStyle(c);t=d.top!=="1%",s=e(d.marginLeft)===12,c.style.right="60%",n=e(d.right)===36,o=e(d.width)===36,c.style.position="absolute",i=e(c.offsetWidth/3)===12,Jy.removeChild(l),c=null}}function e(d){return Math.round(parseFloat(d))}var t,o,i,n,a,s,l=ja.createElement("div"),c=ja.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",Ya.clearCloneStyle=c.style.backgroundClip==="content-box",be.extend(Ya,{boxSizingReliable:function(){return r(),o},pixelBoxStyles:function(){return r(),n},pixelPosition:function(){return r(),t},reliableMarginLeft:function(){return r(),s},scrollboxSize:function(){return r(),i},reliableTrDimensions:function(){var d,p,u,h;return a==null&&(d=ja.createElement("table"),p=ja.createElement("tr"),u=ja.createElement("div"),d.style.cssText="position:absolute;left:-11111px;border-collapse:separate",p.style.cssText="border:1px solid",p.style.height="1px",u.style.height="9px",u.style.display="block",Jy.appendChild(d).appendChild(p).appendChild(u),h=window.getComputedStyle(p),a=parseInt(h.height,10)+parseInt(h.borderTopWidth,10)+parseInt(h.borderBottomWidth,10)===p.offsetHeight,Jy.removeChild(d)),a}}))})();Kq=["Webkit","Moz","ms"],l4=ja.createElement("div").style,Wq={};Eoe=/^(none|table(?!-c[ea]).+)/,jq=/^--/,Doe={position:"absolute",visibility:"hidden",display:"block"},Yq={letterSpacing:"0",fontWeight:"400"};be.extend({cssHooks:{opacity:{get:function(r,e){if(e){var t=n0(r,"opacity");return t===""?"1":t}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(r,e,t,o){if(!(!r||r.nodeType===3||r.nodeType===8||!r.style)){var i,n,a,s=yh(e),l=jq.test(e),c=r.style;if(l||(e=$q(s)),a=be.cssHooks[e]||be.cssHooks[s],t!==void 0){if(n=typeof t,n==="string"&&(i=Nk.exec(t))&&i[1]&&(t=xoe(r,e,i),n="number"),t==null||t!==t)return;n==="number"&&!l&&(t+=i&&i[3]||(be.cssNumber[s]?"":"px")),!Ya.clearCloneStyle&&t===""&&e.indexOf("background")===0&&(c[e]="inherit"),(!a||!("set"in a)||(t=a.set(r,t,o))!==void 0)&&(l?c.setProperty(e,t):c[e]=t)}else return a&&"get"in a&&(i=a.get(r,!1,o))!==void 0?i:c[e]}},css:function(r,e,t,o){var i,n,a,s=yh(e),l=jq.test(e);return l||(e=$q(s)),a=be.cssHooks[e]||be.cssHooks[s],a&&"get"in a&&(i=a.get(r,!0,t)),i===void 0&&(i=n0(r,e,o)),i==="normal"&&e in Yq&&(i=Yq[e]),t===""||t?(n=parseFloat(i),t===!0||isFinite(n)?n||0:i):i}});be.each(["height","width"],function(r,e){be.cssHooks[e]={get:function(t,o,i){if(o)return Eoe.test(be.css(t,"display"))&&(!t.getClientRects().length||!t.getBoundingClientRect().width)?a4(t,Doe,function(){return Xq(t,e,i)}):Xq(t,e,i)},set:function(t,o,i){var n,a=Bk(t),s=!Ya.scrollboxSize()&&a.position==="absolute",l=s||i,c=l&&be.css(t,"boxSizing",!1,a)==="border-box",d=i?BO(t,e,i,c,a):0;return c&&s&&(d-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(a[e])-BO(t,e,"border",!1,a)-.5)),d&&(n=Nk.exec(o))&&(n[3]||"px")!=="px"&&(t.style[e]=o,o=be.css(t,e)),c4(t,o,d)}}});be.cssHooks.marginLeft=s4(Ya.reliableMarginLeft,function(r,e){if(e)return(parseFloat(n0(r,"marginLeft"))||r.getBoundingClientRect().left-a4(r,{marginLeft:0},function(){return r.getBoundingClientRect().left}))+"px"});be.each({margin:"",padding:"",border:"Width"},function(r,e){be.cssHooks[r+e]={expand:function(t){for(var o=0,i={},n=typeof t=="string"?t.split(" "):[t];o<4;o++)i[r+Ug[o]+e]=n[o]||n[o-2]||n[0];return i}},r!=="margin"&&(be.cssHooks[r+e].set=c4)});be.fn.extend({css:function(r,e){return a0(this,function(t,o,i){var n,a,s={},l=0;if(Array.isArray(o)){for(n=Bk(t),a=o.length;l<a;l++)s[o[l]]=be.css(t,o[l],!1,n);return s}return i!==void 0?be.style(t,o,i):be.css(t,o)},r,e,arguments.length>1)}});(function(){var r=ja.createElement("input"),e=ja.createElement("select"),t=e.appendChild(ja.createElement("option"));r.type="checkbox",Ya.checkOn=r.value!=="",Ya.optSelected=t.selected,r=ja.createElement("input"),r.value="t",r.type="radio",Ya.radioValue=r.value==="t"})();Ya.focusin="onfocusin"in window;Jq=/^(?:focusinfocus|focusoutblur)$/,Qq=function(r){r.stopPropagation()};be.extend(be.event,{trigger:function(r,e,t,o){var i,n,a,s,l,c,d,p,u=[t||ja],h=Lk.call(r,"type")?r.type:r,m=Lk.call(r,"namespace")?r.namespace.split("."):[];if(n=p=a=t=t||ja,!(t.nodeType===3||t.nodeType===8)&&!Jq.test(h+be.event.triggered)&&(h.indexOf(".")>-1&&(m=h.split("."),h=m.shift(),m.sort()),l=h.indexOf(":")<0&&"on"+h,r=r[be.expando]?r:new be.Event(h,typeof r=="object"&&r),r.isTrigger=o?2:3,r.namespace=m.join("."),r.rnamespace=r.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,r.result=void 0,r.target||(r.target=t),e=e==null?[r]:be.makeArray(e,[r]),d=be.event.special[h]||{},!(!o&&d.trigger&&d.trigger.apply(t,e)===!1))){if(!o&&!d.noBubble&&!ex(t)){for(s=d.delegateType||h,Jq.test(s+h)||(n=n.parentNode);n;n=n.parentNode)u.push(n),a=n;a===(t.ownerDocument||ja)&&u.push(a.defaultView||a.parentWindow||window)}for(i=0;(n=u[i++])&&!r.isPropagationStopped();)p=n,r.type=i>1?s:d.bindType||h,c=(tn.get(n,"events")||Object.create(null))[r.type]&&tn.get(n,"handle"),c&&c.apply(n,e),c=l&&n[l],c&&c.apply&&Pk(n)&&(r.result=c.apply(n,e),r.result===!1&&r.preventDefault());return r.type=h,!o&&!r.isDefaultPrevented()&&(!d._default||d._default.apply(u.pop(),e)===!1)&&Pk(t)&&l&&vh(t[h])&&!ex(t)&&(a=t[l],a&&(t[l]=null),be.event.triggered=h,r.isPropagationStopped()&&p.addEventListener(h,Qq),t[h](),r.isPropagationStopped()&&p.removeEventListener(h,Qq),be.event.triggered=void 0,a&&(t[l]=a)),r.result}},simulate:function(r,e,t){var o=be.extend(new be.Event,t,{type:r,isSimulated:!0});be.event.trigger(o,null,e)}});be.fn.extend({trigger:function(r,e){return this.each(function(){be.event.trigger(r,e,this)})},triggerHandler:function(r,e){var t=this[0];if(t)return be.event.trigger(r,e,t,!0)}});Ya.focusin||be.each({focus:"focusin",blur:"focusout"},function(r,e){var t=function(o){be.event.simulate(e,o.target,be.event.fix(o))};be.event.special[e]={setup:function(){var o=this.ownerDocument||this.document||this,i=tn.access(o,e);i||o.addEventListener(r,t,!0),tn.access(o,e,(i||0)+1)},teardown:function(){var o=this.ownerDocument||this.document||this,i=tn.access(o,e)-1;i?tn.access(o,e,i):(o.removeEventListener(r,t,!0),tn.remove(o,e))}}});koe=/\[\]$/;be.param=function(r,e){var t,o=[],i=function(n,a){var s=vh(a)?a():a;o[o.length]=encodeURIComponent(n)+"="+encodeURIComponent(s==null?"":s)};if(r==null)return"";if(Array.isArray(r)||r.jquery&&!be.isPlainObject(r))be.each(r,function(){i(this.name,this.value)});else for(t in r)UO(t,r[t],e,i);return o.join("&")};be.offset={setOffset:function(r,e,t){var o,i,n,a,s,l,c,d=be.css(r,"position"),p=be(r),u={};d==="static"&&(r.style.position="relative"),s=p.offset(),n=be.css(r,"top"),l=be.css(r,"left"),c=(d==="absolute"||d==="fixed")&&(n+l).indexOf("auto")>-1,c?(o=p.position(),a=o.top,i=o.left):(a=parseFloat(n)||0,i=parseFloat(l)||0),vh(e)&&(e=e.call(r,t,be.extend({},s))),e.top!=null&&(u.top=e.top-s.top+a),e.left!=null&&(u.left=e.left-s.left+i),"using"in e?e.using.call(r,u):p.css(u)}};be.fn.extend({offset:function(r){if(arguments.length)return r===void 0?this:this.each(function(i){be.offset.setOffset(this,r,i)});var e,t,o=this[0];if(o)return o.getClientRects().length?(e=o.getBoundingClientRect(),t=o.ownerDocument.defaultView,{top:e.top+t.pageYOffset,left:e.left+t.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var r,e,t,o=this[0],i={top:0,left:0};if(be.css(o,"position")==="fixed")e=o.getBoundingClientRect();else{for(e=this.offset(),t=o.ownerDocument,r=o.offsetParent||t.documentElement;r&&(r===t.body||r===t.documentElement)&&be.css(r,"position")==="static";)r=r.parentNode;r&&r!==o&&r.nodeType===1&&(i=be(r).offset(),i.top+=be.css(r,"borderTopWidth",!0),i.left+=be.css(r,"borderLeftWidth",!0))}return{top:e.top-i.top-be.css(o,"marginTop",!0),left:e.left-i.left-be.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var r=this.offsetParent;r&&be.css(r,"position")==="static";)r=r.offsetParent;return r||Jy})}});be.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(r,e){var t=e==="pageYOffset";be.fn[r]=function(o){return a0(this,function(i,n,a){var s;if(ex(i)?s=i:i.nodeType===9&&(s=i.defaultView),a===void 0)return s?s[e]:i[n];s?s.scrollTo(t?s.pageXOffset:a,t?a:s.pageYOffset):i[n]=a},r,o,arguments.length)}});be.each(["top","left"],function(r,e){be.cssHooks[e]=s4(Ya.pixelPosition,function(t,o){if(o)return o=n0(t,e),qO.test(o)?be(t).position()[e]+"px":o})});be.each({Height:"height",Width:"width"},function(r,e){be.each({padding:"inner"+r,content:e,"":"outer"+r},function(t,o){be.fn[o]=function(i,n){var a=arguments.length&&(t||typeof i!="boolean"),s=t||(i===!0||n===!0?"margin":"border");return a0(this,function(l,c,d){var p;return ex(l)?o.indexOf("outer")===0?l["inner"+r]:l.document.documentElement["client"+r]:l.nodeType===9?(p=l.documentElement,Math.max(l.body["scroll"+r],p["scroll"+r],l.body["offset"+r],p["offset"+r],p["client"+r])):d===void 0?be.css(l,c,s):be.style(l,c,d,s)},e,a?i:void 0,a)}})});be.fn.extend({bind:function(r,e,t){return this.on(r,null,e,t)},unbind:function(r,e){return this.off(r,null,e)},delegate:function(r,e,t,o){return this.on(e,r,t,o)},undelegate:function(r,e,t){return arguments.length===1?this.off(r,"**"):this.off(e,r||"**",t)},hover:function(r,e){return this.mouseenter(r).mouseleave(e||r)}});be.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(r,e){be.fn[e]=function(t,o){return arguments.length>0?this.on(e,null,t,o):this.trigger(e)}});_oe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;be.isArray=Array.isArray;be.parseJSON=JSON.parse;be.nodeName=Xy;be.isFunction=vh;be.isWindow=ex;be.camelCase=yh;be.type=Fk;be.now=Date.now;be.isNumeric=function(r){var e=be.type(r);return(e==="number"||e==="string")&&!isNaN(r-parseFloat(r))};be.trim=function(r){return r==null?"":(r+"").replace(_oe,"")};Toe=window.jQuery,Goe=window.$;be.noConflict=function(r){return window.$===be&&(window.$=Goe),r&&window.jQuery===be&&(window.jQuery=Toe),be};typeof noGlobal=="undefined"&&(window.jQuery=window.$=be);re=be});var d4=__dcg_shared_module_exports__['b'](()=>{});var p4=__dcg_shared_module_exports__['b'](()=>{});var u4=__dcg_shared_module_exports__['b'](()=>{});var h4=__dcg_shared_module_exports__['b'](()=>{});var g4=__dcg_shared_module_exports__['b'](()=>{});var m4=__dcg_shared_module_exports__['b'](()=>{});var f4=__dcg_shared_module_exports__['b'](()=>{});var b4=__dcg_shared_module_exports__['b'](()=>{});var y4=__dcg_shared_module_exports__['b'](()=>{});var x4=__dcg_shared_module_exports__['b'](()=>{});var w4=__dcg_shared_module_exports__['b'](()=>{});var v4=__dcg_shared_module_exports__['b'](()=>{});var C4=__dcg_shared_module_exports__['b'](()=>{});var S4=__dcg_shared_module_exports__['b'](()=>{p4();u4();h4();g4();m4();f4();b4();y4();x4();w4();v4();C4()});var Ioe,B1e,E4=__dcg_shared_module_exports__['b'](()=>{Ioe=["education","commercial","generic","prospect"],B1e=[...Ioe,"uncategorized"]});var D4=__dcg_shared_module_exports__['b'](()=>{});function zO(r){let e={};for(let t in r)e[t]=r[t].getAuthoringConfig();return e}var l0,c0,Jt,Yn,Uk,qk,zk,HO,$f,k4=__dcg_shared_module_exports__['b'](()=>{l0=class{},c0=class extends l0{constructor(){super(...arguments);this.latexs=[];this.labels=[]}parser(t){return this.validation=t,this}latex(t){return this.latexs.push(t),this}label(t){return this.labels.push(t),this}addGraphMutations({path:t,graphMutations:o,subData:i,validator:n}){let a=i;for(let s of this.latexs)typeof a=="string"||typeof a=="number"?o.push({type:"value",identifier:s,value:a+""}):typeof a=="boolean"?o.push({type:"value",identifier:s,value:a?"1":"0"}):n.reportError(t,"unexpected latexValue mutation value type:  "+typeof a);for(let s of this.labels)typeof a=="string"?o.push({type:"label",identifier:s,value:a+""}):n.reportError(t,"unexpected label mutation value type:  "+typeof a)}parseString({path:t,subData:o,validator:i}){let n=o;if(!this.validation)return i.reportError(t,'has no validation. Use "string" for no validation'),n;if(i.shouldSkipParsingDataVariable(i))return n;if(typeof this.validation=="object")return n in this.validation?this.validation[n]:(i.reportError(t,"unknown type: "+n),n);switch(this.validation){case"string":return n;case"number":return!/^-?[0-9]*[.]?[0-9]*$/.test(n)||!/[0-9]/g.test(n)?(i.reportError(t,"expected to be a number but it was not: "+n),NaN):parseFloat(n);case"integer":if(!/^-?[0-9]+$/.test(n))return i.reportError(t,"expected to be an integer but it was not: "+n),NaN;parseFloat(n);break;default:this.validation;break}return n}};Jt=class extends l0{constructor(t){super();this.config=t;let o=[];if(t.conditional_attributes)for(let i of t.conditional_attributes){let n=[];for(let a of i.conditions)n.push({value:a.value,attributes:zO(a.attributes)});o.push({attribute_key:i.attribute_key,conditions:n})}this.authoringConfig={type:"object",name:t.name,attributes:zO(t.attributes),conditional_attributes:o}}getAuthoringConfig(){return this.authoringConfig}inflateWithData({path:t,subData:o,validator:i,graphMutations:n}){if(!o||typeof o!="object"){i.reportError(t,"should be an object");return}for(let a in this.config.attributes){let s=o[a],l=t+"."+a;if(s===void 0){i.reportError(l,"should be defined");continue}this.config.attributes[a].inflateWithData({path:l,subData:s,validator:i,graphMutations:n})}for(let{attribute_key:a,conditions:s}of this.config.conditional_attributes||[])for(let{attributes:l,value:c}of s)if(o[a]===c)for(let d in l){let p=t+"."+d,u=o[d];if(u===void 0){i.reportError(p,"should be defined");continue}l[d].inflateWithData({path:p,subData:u,validator:i,graphMutations:n})}}},Yn=class extends l0{constructor(t){super();this.config=t;let o;("minimum"in t||"maximum"in t)&&(o={maximum:t.maximum,minimum:t.minimum}),this.authoringConfig={type:"array",required:!0,name:t.name,count:o,items:t.items.getAuthoringConfig()}}getAuthoringConfig(){return this.authoringConfig}inflateWithData({path:t,subData:o,validator:i,graphMutations:n}){if(!Array.isArray(o)){i.reportError(t,"should be an array");return}for(let a=0;a<o.length;a++){let s=o[a],l=t+"["+a+"]";if(s===void 0){i.reportError(l,"should be defined");continue}this.config.items.inflateWithData({path:l,subData:s,validator:i,graphMutations:n})}}},Uk=class extends c0{constructor(e){super(),this.authoringConfig={type:"string",element:"editor",required:!0,name:e.name,default:e.default}}getAuthoringConfig(){return this.authoringConfig}inflateWithData({path:e,subData:t,validator:o,graphMutations:i}){if(typeof t!="string"){o.reportError(e,"should be a string");return}let n=this.parseString({path:e,subData:t,validator:o});this.addGraphMutations({path:e,subData:n,validator:o,graphMutations:i})}},qk=class extends c0{constructor(e){super(),this.authoringConfig={type:"string",element:"select",required:!0,name:e.name,default:e.default,options:e.options}}getAuthoringConfig(){return this.authoringConfig}inflateWithData({path:e,subData:t,validator:o,graphMutations:i}){if(typeof t!="string"){o.reportError(e,"should be a string");return}if(!this.authoringConfig.options.find(a=>a.value===t)){o.reportError(e,"value must be one of the select options: "+t);return}let n=this.parseString({path:e,subData:t,validator:o});this.addGraphMutations({path:e,subData:n,validator:o,graphMutations:i})}},zk=class extends c0{constructor(e){super(),this.authoringConfig={type:"boolean",required:!0,name:e.name,default:e.default}}getAuthoringConfig(){return this.authoringConfig}inflateWithData({path:e,subData:t,validator:o,graphMutations:i}){if(typeof t!="boolean"){o.reportError(e,"should be a boolean");return}this.addGraphMutations({path:e,subData:t,validator:o,graphMutations:i})}},HO=class{constructor(e){this.shouldExpectDataVariables=e;this.errors=[]}getErrors(){return this.errors}reportError(e,t){this.errors.push(e+" - "+t)}shouldSkipParsingDataVariable(e){return this.shouldExpectDataVariables?!!(typeof e=="string"&&e.includes("{{var:")):!1}},$f=class{constructor(e){this.config=e;this.authoringConfig=zO(e)}getAuthoringConfig(){return this.authoringConfig}inflateWithData(e,t){let o=new HO(e),i=[];for(let n in this.config){let a=t[n];a===void 0&&o.reportError(n,"should be defined."),this.config[n].inflateWithData({path:n,subData:a,validator:o,graphMutations:i})}return{validationErrors:o.getErrors(),graphMutations:i}}}});function zg(r,e){return new Uk({name:r,default:e})}function ar(r,e){return zg(r,e).parser("number")}function Ti(r,e){return zg(r,e).parser("string")}function KO(r,e){return zg(r,e).parser({left:1,mid:2,right:3})}function d0(r,e){return zg(r,e).parser({lowest:1,lower:2,low:3,mid:4,high:5,higher:6,highest:7})}function Moe(r,e){return zg(r,e).parser({small:1,medium:2,large:3})}function Mr(r,e){return new zk({name:r,default:e})}function tx(r,e,t){return new qk({name:r,default:e,options:t}).parser("string")}function zc(r,e){return tx(r,e||"blue",[{label:"Blue",value:"blue"},{label:"Green",value:"green"},{label:"Orange",value:"orange"},{label:"Purple",value:"purple"},{label:"Black",value:"black"},{label:"Red",value:"red"},{label:"Gray",value:"gray"}]).parser({blue:"blue",green:"green",orange:"orange",purple:"purple",black:"black",red:"red",gray:"gray"})}function Aoe(r){return tx(r,"solid",[{label:"Solid",value:"solid"},{label:"Dashed",value:"dashed"},{label:"Dotted",value:"dotted"}]).parser({solid:"solid",dashed:"dashed",dotted:"dotted"})}function _4(r){return zg(r,"attainable").parser({attainable:1,unattainable:2,efficient:3})}function qg(r){return zg(r,"none").parser({none:0,0:0,negative:-1,"-1":-1,positive:1,1:1})}function T4(r){return zg(r,"standard").parser({horizontal:"1",gradual:"2",standard:"3",steep:"4",vertical:"5"})}function WO(r,e){return tx(r,e||"none",[{label:"None",value:"none"},{label:"X",value:"x"},{label:"Y",value:"y"},{label:"Both",value:"both"}]).parser({both:"both",none:"none",x:"x",y:"y"})}var Hk,Kk,Wk,Voe,Loe,Poe,$k,Ooe,Roe,Foe,Noe,G4=__dcg_shared_module_exports__['b'](()=>{k4();Hk=new Jt({name:"Horizontal Axis",attributes:{min:ar("X Min","0").latex("x_{min}"),max:ar("X Max","50").latex("x_{max}"),res:ar("X Res","5").latex("x_{res}"),major_grid:ar("X Major Grid","5").latex("x_{majorGrid}"),label:Ti("X Axis Label","Good 1").label("x_{label}"),tickmark_interval:ar("X Tickmarks","5").latex("x_{tick}"),label_interval:ar("X Labels","5").latex("x_{labelInt}")}}),Kk=new Jt({name:"Vertical Axis",attributes:{min:ar("Y Min","0").latex("y_{min}"),max:ar("Y Max","50").latex("y_{max}"),res:ar("Y Res","5").latex("y_{res}"),major_grid:ar("Y Major Grid","5").latex("y_{majorGrid}"),label:Ti("Y Axis Label","Good 2").label("y_{label}"),tickmark_interval:ar("Y Tickmarks","5").latex("y_{tick}"),label_interval:ar("Y Labels","5").latex("y_{labelInt}")}}),Wk=new Jt({name:"Graph Properties",attributes:{title:Ti("Graph Title","Graph Title").label("p_{Title}")}}),Voe=new Jt({name:"Endpoint Mover",attributes:{appearance:tx("Appearance","1",[{label:"Concave Downward",value:"1"},{label:"Linear",value:"2"},{label:"Concave Upward",value:"3"}]),given:Mr("Given",!0),color:zc("Color"),style:Aoe("Style"),group_points:new Yn({name:"Endpoint Mover Points",maximum:3,items:new Jt({attributes:{color:zc("Color"),label:Ti("label",""),given:Mr("Given",!0),show_coords:Mr("Show Coords",!1)},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{type:_4("Type")}},{value:!1,attributes:{validation:new Jt({attributes:{type:_4("Type")}})}}]}]})})},conditional_attributes:[{attribute_key:"given",conditions:[{value:!1,attributes:{group_label:Ti("Group Label",""),validation:new Jt({attributes:{x_shift:qg("xShift"),y_shift:qg("yShift")}})}},{value:!0,attributes:{x_shift:qg("xShift"),y_shift:qg("yShift")}}]}]}),Loe=new Jt({name:"Shifter",attributes:{increasing_lines:new Yn({name:"Increasing Lines",items:new Jt({attributes:{given:Mr("Given",!0),color:zc("Color","orange"),scale:ar("Scale","1"),type:T4("Type"),label:Ti("label",""),ghostLabel:Ti("ghostLabel",""),postShiftLabel:Ti("postShiftLabel","")},conditional_attributes:[{attribute_key:"given",conditions:[{value:!1,attributes:{validation:new Jt({attributes:{shift:qg("Shift")}})}},{value:!0,attributes:{shift:qg("Shift")}}]}]})}),decreasing_lines:new Yn({name:"Decreasing Lines",items:new Jt({attributes:{given:Mr("Given",!0),color:zc("Color"),scale:ar("Scale","1"),type:T4("Type"),label:Ti("label",""),ghostLabel:Ti("ghostLabel",""),postShiftLabel:Ti("postShiftLabel","")},conditional_attributes:[{attribute_key:"given",conditions:[{value:!1,attributes:{validation:new Jt({attributes:{shift:qg("Shift")}})}},{value:!0,attributes:{shift:qg("Shift")}}]}]})}),shifter_intersections:new Yn({name:"Intersections",items:new Jt({attributes:{increasing_line:ar("Increasing Line","1"),decreasing_line:ar("Decreasing Line","1"),drop_lines:WO("Drop Lines","both"),show_coords:Mr("Show Coords",!1),show_point:Mr("Show Point",!0)}})})}}),Poe=new Jt({name:"Cost Curves",attributes:{role:tx("Role","taker",[{label:"Price Taker",value:"taker"},{label:"Price Setter Upward MC",value:"setter-upward"},{label:"Price Setter Constant MC",value:"setter-constant"}]),mc_show:Mr("Show MC",!0),atc_show:Mr("Show ATC",!0),mc_label:Ti("MC Label","MC"),mc_color:zc("MC Color","orange"),atc_label:Ti("ATC Label","ATC"),atc_color:zc("ATC Color","green")},conditional_attributes:[{attribute_key:"role",conditions:[{value:"taker",attributes:{mc_x:KO("MC Horizontal Alignment","mid"),mc_y:d0("MC Vertical Alignment","mid"),avc_show:Mr("Show AVC",!0),avc_label:Ti("AVC Label","AVC"),avc_color:zc("AVC Color","purple"),avc_y:d0("AVC Vertical Alignment","mid")}},{value:"setter-upward",attributes:{mc_x:KO("MC Horizontal Alignment","mid"),mc_y:d0("MC Vertical Alignment","mid"),avc_show:Mr("Show AVC",!0),avc_label:Ti("AVC Label","AVC"),avc_color:zc("AVC Color","purple"),atc_x:KO("ATC Horizontal Alignment","mid"),atc_y:d0("ATC Vertical Alignment","mid")}},{value:"setter-constant",attributes:{mc_y:d0("MC Vertical Alignment","mid"),fc_align:Moe("FC Alignment","medium")}}]}]}),$k=new Yn({name:"Common Components",items:new Jt({name:"Common Component",attributes:{object_type:tx("Component Type","common_point",[{label:"Point",value:"common_point"},{label:"Line",value:"common_line"},{label:"Curve",value:"common_curve"},{label:"Monotonic Arc",value:"common_mono_arc"},{label:"Polygon",value:"common_polygon"}])},conditional_attributes:[{attribute_key:"object_type",conditions:[{value:"common_point",attributes:{when_point:new Jt({attributes:{given:Mr("Given",!0),color:zc("Color"),connected:Mr("Connected",!1)},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{when_given:new Jt({attributes:{group_points:new Yn({name:"Group Points",minimum:1,items:new Jt({name:"Group Points",attributes:{x_coord:ar("X",""),y_coord:ar("Y",""),label:Ti("label",""),show_point:Mr("Show Point",!0),drop_lines:WO("Drop Lines")},conditional_attributes:[{attribute_key:"show_point",conditions:[{value:!0,attributes:{show_coords:Mr("Show Coords",!1)}}]}]})})}})}},{value:!1,attributes:{when_required:new Jt({attributes:{group_label:Ti("Group Label",""),group_points:new Yn({name:"Group Points",minimum:1,items:new Jt({name:"Group Points",attributes:{drop_lines:WO("Drop Lines"),show_coords:Mr("Show Coords",!1),validation:new Jt({attributes:{x_coord:ar("X",""),y_coord:ar("Y","")}})}})})}})}}]}]})}},{value:"common_line",attributes:{when_line:new Jt({attributes:{given:Mr("Given",!0),color:zc("Color")},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{when_given:new Jt({attributes:{group_lines:new Yn({name:"Group Lines",minimum:1,items:new Jt({attributes:{use_slope:Mr("Use Slope",!0),show_points:Mr("Show Points",!0),show_x_int:Mr("Show X Intercept",!1),show_y_int:Mr("Show Y Intercept",!1),show_slope:Mr("Show Slope",!1)},conditional_attributes:[{attribute_key:"use_slope",conditions:[{value:!1,attributes:{when_not_slope:new Jt({attributes:{x_coord_1:ar("X1",""),y_coord_1:ar("Y1",""),label_1:Ti("Label",""),x_coord_2:ar("X2",""),y_coord_2:ar("Y2",""),label_2:Ti("Label","")}})}},{value:!0,attributes:{when_slope:new Jt({attributes:{x_coord_1:ar("X1",""),y_coord_1:ar("Y1",""),label_1:Ti("Label",""),slope:ar("Slope","")}})}}]},{attribute_key:"show_points",conditions:[{value:!0,attributes:{show_coords:Mr("Show Coords",!1)}}]}]})})}})}},{value:!1,attributes:{when_required:new Jt({attributes:{group_label:Ti("Group Label",""),group_lines:new Yn({name:"Group Lines",minimum:1,items:new Jt({attributes:{use_slope:Mr("Use Slope",!0),show_coords:Mr("Show Coords",!1),show_x_int:Mr("Show X Intercept",!1),show_y_int:Mr("Show Y Intercept",!1),show_slope:Mr("Show Slope",!1)},conditional_attributes:[{attribute_key:"use_slope",conditions:[{value:!1,attributes:{when_not_slope:new Jt({attributes:{validation:new Jt({attributes:{x_coord_1:ar("X1",""),y_coord_1:ar("Y1",""),x_coord_2:ar("X2",""),y_coord_2:ar("Y2","")}})}})}},{value:!0,attributes:{when_slope:new Jt({attributes:{validation:new Jt({attributes:{x_coord_1:ar("X1",""),y_coord_1:ar("Y1",""),slope:ar("slope","")}})}})}}]}]})})}})}}]}]})}},{value:"common_curve",attributes:{when_curve:new Jt({attributes:{color:zc("Color"),given:Mr("Given",!0)},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{when_given:new Jt({attributes:{group_curves:new Yn({name:"Group Curves",minimum:1,items:new Jt({attributes:{show_points:Mr("Show Points",!0),curve_points:new Yn({name:"Curve Points",minimum:3,maximum:6,items:new Jt({attributes:{x_coord:ar("X",""),y_coord:ar("Y",""),label:Ti("Label","")}})})},conditional_attributes:[{attribute_key:"show_points",conditions:[{value:!0,attributes:{show_coords:Mr("Show Coords",!1)}}]}]})})}})}},{value:!1,attributes:{when_required:new Jt({attributes:{group_label:Ti("Group Label",""),group_curves:new Yn({minimum:1,name:"Group Curves",items:new Jt({attributes:{show_coords:Mr("Show Coords",!1),curve_points:new Yn({name:"Curve Points",minimum:3,maximum:6,items:new Jt({attributes:{validation:new Jt({attributes:{x_coord:ar("X",""),y_coord:ar("Y","")}})}})})}})})}})}}]}]})}},{value:"common_mono_arc",attributes:{when_mono_arc:new Jt({attributes:{color:zc("Color"),given:Mr("Given",!0)},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{when_given:new Jt({attributes:{group_mono_arcs:new Yn({name:"Group Monotonic Arcs",minimum:1,items:new Jt({attributes:{show_points:Mr("Show Points",!0),concavity:ar("Concavity",""),x_coord_1:ar("X1",""),y_coord_1:ar("Y1",""),label_1:Ti("Label 1",""),x_coord_2:ar("X2",""),y_coord_2:ar("Y2",""),label_2:Ti("Label 2","")},conditional_attributes:[{attribute_key:"show_points",conditions:[{value:!0,attributes:{show_coords:Mr("Show Coords",!1)}}]}]})})}})}},{value:!1,attributes:{when_required:new Jt({attributes:{group_label:Ti("Group Label",""),group_mono_arcs:new Yn({minimum:1,name:"Group Monotonic Arcs",items:new Jt({attributes:{show_coords:Mr("Show Coords",!1),concavity:ar("Concavity",""),validation:new Jt({attributes:{x_coord_1:ar("X",""),y_coord_1:ar("Y",""),x_coord_2:ar("X",""),y_coord_2:ar("Y","")}})}})})}})}}]}]})}},{value:"common_polygon",attributes:{when_polygon:new Jt({attributes:{color:zc("Color"),given:Mr("Given",!0)},conditional_attributes:[{attribute_key:"given",conditions:[{value:!0,attributes:{when_given:new Jt({attributes:{group_polygons:new Yn({name:"Group Polygons",minimum:1,items:new Jt({attributes:{show_points:Mr("Show Points",!0),show_area:Mr("Show Area",!1),show_perimeter:Mr("Show Perimeter",!1),fill_pattern:Mr("Fill Pattern",!0),polygon_points:new Yn({name:"Polygon Points",minimum:3,maximum:10,items:new Jt({attributes:{x_coord:ar("X",""),y_coord:ar("Y",""),label:Ti("Label","")}})})},conditional_attributes:[{attribute_key:"show_points",conditions:[{value:!0,attributes:{show_coords:Mr("Show Coords",!1)}}]}]})})}})}},{value:!1,attributes:{when_required:new Jt({attributes:{group_label:Ti("Group Label",""),group_polygons:new Yn({minimum:1,name:"Group Polygons",items:new Jt({attributes:{show_coords:Mr("Show Coords",!1),show_area:Mr("Show Area",!1),show_perimeter:Mr("Show Perimeter",!1),fill_pattern:Mr("Fill Pattern",!0),polygon_points:new Yn({name:"Polygon Points",minimum:3,maximum:10,items:new Jt({attributes:{validation:new Jt({attributes:{x_coord:ar("X",""),y_coord:ar("Y","")}})}})})}})})}})}}]}]})}}]}]})}),Ooe=new $f({dcg_x_axis:Hk,dcg_y_axis:Kk,dcg_graph_properties:Wk,dcg_common_components:$k}),Roe=new $f({dcg_x_axis:Hk,dcg_y_axis:Kk,dcg_graph_properties:Wk,dcg_common_components:$k,dcg_endpoint_mover:Voe}),Foe=new $f({dcg_x_axis:Hk,dcg_y_axis:Kk,dcg_graph_properties:Wk,dcg_common_components:$k,dcg_shifter:Loe}),Noe=new $f({dcg_x_axis:Hk,dcg_y_axis:Kk,dcg_graph_properties:Wk,dcg_common_components:$k,dcg_cost_curves:Poe})});var I4=__dcg_shared_module_exports__['b'](()=>{G4()});var jf,M4=__dcg_shared_module_exports__['b'](()=>{jf=async(r,e)=>{try{return{type:"resolved",value:await r()}}catch(t){return{type:"error",error:e?e(t):t instanceof Error?t:new Error(String(t))}}}});var A4=__dcg_shared_module_exports__['b'](()=>{});function V4(r){var o;let[e,t]=(o=qoe.exec(r))!=null?o:[];return t}function $O(r){let e=V4(r);return e?zoe.test(e):!0}function L4(r=window.location.href){let e=V4(r);return e?Hoe.test(e):!1}function jk(r,e){var i;let t="";if(e!==void 0?t=e:typeof window!="undefined"&&(t=(i=new URLSearchParams(window.location.search).get("lang"))!=null?i:""),r===""||t===""||Boe.test(r)||Uoe.test(r)||!$O(r))return r;let o=encodeURIComponent(t);if(r.length){let n=r.split("#"),a=/\?/.test(r)?`${n[0]}&lang=${o}`:`${n[0]}?lang=${o}`;return n[1]!==void 0?`${a}#${n[1]}`:a}else return`?lang=${o}`}var Boe,Uoe,qoe,zoe,Hoe,P4=__dcg_shared_module_exports__['b'](()=>{Boe=/lang=[A-Za-z]+/,Uoe=/(cl|learn|help).kiavash.com/,qoe=/^(?:https?:)?(?:\/\/)?([^\s:\/\?]+)/i,zoe=/(^kiavash\.com$)|(\.kiavash.com$)/,Hoe=/^(local|knox-pr-\d+)\.kiavash\.com$/});var O4=__dcg_shared_module_exports__['b'](()=>{});var R4,F4=__dcg_shared_module_exports__['b'](()=>{R4=()=>{}});var N4,rx,Z1e,B4=__dcg_shared_module_exports__['b'](()=>{N4="v1_10",rx=`dcg-calculator-api-container-${N4}`,Z1e=`dcg-matrix-api-container-${N4}`});var tu=__dcg_shared_module_exports__['b'](()=>{S4();E4();D4();I4();M4();A4();P4();O4();F4();B4()});function U4(r){ru=r}function Vo(r,e){ru==null||ru.notify(r,e)}function Hg(r,e,t){ru==null||ru.leaveBreadcrumb(r,e,t)}function q4(r){ru==null||ru.setBeforeSendCB(r)}var ru,Xa=__dcg_shared_module_exports__['b'](()=>{});function Yk(r){let e=()=>r;return e.isDCGViewConst=!0,e}function bs(r){return typeof r=="function"&&!!r.isDCGViewConst}var np=__dcg_shared_module_exports__['b'](()=>{});function z4(r){let e=r();if(typeof e=="string")return e;if(typeof e!="object")throw new Error(`Unsupported type returned from class getter: ${typeof e}`);return Object.keys(e).filter(t=>e.hasOwnProperty(t)&&e[t]).join(" ")}function Koe(r,e,t){let o=r.className.replace(H4,"").split(K4),i=e.replace(H4,"").split(K4),n={};for(let s of i)n[s]=!0;let a=o.filter(s=>!n.hasOwnProperty(s));return t?`${t} ${a.join(" ")}`.trim():a.join(" ")}function W4(r){let e=z4(r),t=bs(r)?void 0:{onUpdate:o=>{let i=z4(r);e!==i&&(o.className=o.className===e?i:Koe(o,e,i),e=i)}};return{value:e,bindings:t}}var H4,K4,$4=__dcg_shared_module_exports__['b'](()=>{np();H4=/^\s+|\s+$/g,K4=/\s+/});function j4(r){return e=>{if(typeof e!="function")throw new Error(`The ${r} attribute expects a function for the value`);if(bs(e))throw new Error(`The ${r} attribute does not expect a const for the value`);return{bindings:{[r]:e}}}}var Y4=__dcg_shared_module_exports__['b'](()=>{np()});function Xk(r,e,t){return t===void 0?r.removeAttribute(e):r.setAttribute(e,`${t}`)}var jO=__dcg_shared_module_exports__['b'](()=>{});function X4(r){let e=r(),t=typeof e;if(t==="string")return e;if(!t||t!=="object")throw new Error(`Unsupported type returned from style getter: ${t}`);return Object.entries(e).filter(([o,i])=>e.hasOwnProperty(o)&&i!==null&&i!==void 0).map(([o,i])=>`${o}:${i}`).join(";")}function J4(r){let e=X4(r),t=bs(r)?void 0:{onUpdate:o=>{let i=X4(r);e!==i&&(Xk(o,"style",i),e=i)}};return{value:e,bindings:t}}var Q4=__dcg_shared_module_exports__['b'](()=>{jO();np()});function ox(r,e){YO[r]=e}function Z4(r){return YO.hasOwnProperty(r)}function ez(r,e){let t=YO[r];return t(e)}var YO,Jk=__dcg_shared_module_exports__['b'](()=>{YO={}});function tz(r,e){if(e!=null){if(typeof r!="string")throw new Error("Must pass a string for an EventHandler name");if(typeof e!="function")throw new Error("Must pass a function for an EventHandler callback");return{bindings:{onMount(t){t&&(t[r.toLowerCase()]=(o,...i)=>{o&&e.apply(t,[o,...i])})}}}}}var rz=__dcg_shared_module_exports__['b'](()=>{});function oz(r,e){let t=e(),o;return bs(e)||(o={onUpdate(i){if(!i)return;let n=e();n!==t&&(t=n,Xk(i,r,n))}}),{value:t,bindings:o}}var iz=__dcg_shared_module_exports__['b'](()=>{jO();np()});function nz(r){return r.startsWith("on")&&r[2]===r[2].toUpperCase()}var az=__dcg_shared_module_exports__['b'](()=>{});function sz(r,e){if(typeof e!="function")throw new Error(`The "${r}" attr must be a function. It is: ${JSON.stringify(e)}`);return Z4(r)?ez(r,e):nz(r)?tz(r,e):oz(r,e)}var lz=__dcg_shared_module_exports__['b'](()=>{rz();iz();Jk();az()});function cz(r,e,t){let o=r._bindings[e];r._bindings[e]=o?[...o,t]:[t]}function ap(r,e){var o;((o=r._bindings[e])!=null?o:[]).forEach(i=>i())}var XO=__dcg_shared_module_exports__['b'](()=>{});function dz(r){p0.push(r)}function pz(r){let e=p0.filter(t=>t!==r);p0.length=0,p0.push(...e)}function Yf(r,e){if(Kg(e)){let o=`[${e._viewName}]`,i=e.traceViewHierarchy(),n=i.ancestors.length>0?`
View Hierarchy:
${i.formatted}`:"";r=`${r} ${o}${n}`}let t=new Error(r);console.warn(t),p0.forEach(o=>o(t))}var p0,Qk=__dcg_shared_module_exports__['b'](()=>{ou();p0=[]});var kl,Xf,Zk,e_,ix=__dcg_shared_module_exports__['b'](()=>{np();Qk();kl=class{assertNotMounted(){if(this._domNode)throw new Error("Cannot remount a DCGElement")}},Xf=Symbol("DCGPlaceholderElement"),Zk=class extends kl{renderTo(e){this.assertNotMounted(),this._domNode=document.createTextNode(""),e.appendChild(this._domNode)}},e_=class extends kl{constructor(t,o,i){super();this.tagName=t;this.attributes=o;this.children=i;Array.isArray(this.children)&&this.children.forEach(n=>{n instanceof kl&&(n._parentElement=this)})}appendTextNode(t){this._domNode.appendChild(document.createTextNode(t))}renderTo(t,o){this.assertNotMounted(),this._domNode=document.createElement(this.tagName),o.bindAttributesTo(this._domNode,this.attributes),t.appendChild(this._domNode),this.children.forEach(i=>{if(i instanceof kl){i.renderTo(this._domNode,o);return}if(bs(i)){this.appendTextNode(i());return}if(typeof i=="function"){o.bindText(this._domNode,i);return}Yf("Text should be a const or a getter: "+JSON.stringify(i),o),this.appendTextNode(i)})}}});function uz(r,e){r!=null&&(Array.isArray(r)?r.forEach(t=>uz(t,e)):e.push(r))}function iu(r,e,...t){let o=[];t.forEach(s=>uz(s,o));let i=e!=null?e:{},n;o.length===0?n=void 0:o.length===1?n=o[0]:n=o;let a={...i,children:n};return r===Xf?new Zk:typeof r=="string"?new e_(r,i,o):new r(a)._construct()}var nx=__dcg_shared_module_exports__['b'](()=>{ix()});var Kg,ga,ou=__dcg_shared_module_exports__['b'](()=>{lz();XO();np();nx();ix();Qk();Kg=r=>!!r&&r instanceof ga,ga=class extends kl{constructor(t){var o,i;super();this.__generatedHTMLBefore=!1;this._childViews=[];this._bindings={};this._isMounted=!1;this._willBeUnmounted=!1;this.const=Yk;this.createElement=iu;this._viewName=(i=(o=this.constructor)==null?void 0:o.name)!=null?i:"Anonymous DCGView",Object.entries(t!=null?t:{}).filter(([n])=>n!=="children").forEach(([n,a])=>{if(typeof a!="function"&&a!==void 0)throw new Error(`The "${n}" prop must be a function. It is: ${JSON.stringify(a)}`)}),this.props=t!=null?t:{}}init(){}template(){throw new Error("template() must be implemented")}_construct(){var t;if((t=this.init)==null||t.call(this),this._element=this.template(),!(this._element instanceof kl))throw new Error("template() must return a DCGElement");return this._element._parentElement=this,this}bindFn(t){return t.bind(this)}bindIfMounted(t){return this.bindFn((...o)=>{if(this._isMounted)return t.apply(this,o)})}traceViewHierarchy(){let t=[],o=this._parentElement;for(;o;)t.unshift(o),o=o._parentElement;let i=a=>Kg(a)&&!(a._viewName==="Switch"&&Kg(a._parentElement)&&a._parentElement._viewName==="If")&&!["IfDefinedWrapper","SwitchWrapper","SwitchUnionWrapper"].includes(a._viewName),n=[...t,this].filter(i).map((a,s)=>"  ".repeat(s)+"<"+a._viewName+">").join(`
`);return{ancestors:t,formatted:n}}renderTo(t,o){if(o&&o._childViews.push(this),this.__generatedHTMLBefore)throw new Error("Cannot remount a DCGView");this.__generatedHTMLBefore=!0,this._element.renderTo(t,this)}findFirstRootDOMNode(){let t=this._element;return Kg(t)?t.findFirstRootDOMNode():t._domNode}findLastRootDOMNode(){let t=this._element;return Kg(t)?t.findLastRootDOMNode():t._domNode}findAllRootDOMNodes(){let t=this.findFirstRootDOMNode(),o=this.findLastRootDOMNode(),i=[],n=t;for(;n&&(i.push(n),n!==o);)n=n.nextSibling;return i}update(){var t,o,i;if(!this._isMounted)return Yf("Trying to update view that is not mounted. Ignoring update.",this);this.shouldUpdate&&!this.shouldUpdate()||((t=this.willUpdate)==null||t.call(this),ap(this,"willUpdate"),ap(this,"onUpdate"),(o=this.onUpdate)==null||o.call(this),this.updateChildren(),ap(this,"didUpdate"),(i=this.didUpdate)==null||i.call(this))}updateChildren(){this._childViews.forEach(t=>t.update())}bindText(t,o){var a;let i=(a=o())!=null?a:"",n=document.createTextNode(i);t.appendChild(n),cz(this,"onUpdate",()=>{var l;let s=(l=o())!=null?l:"";i!==s&&(n.nodeValue=s,i=s)})}addAttributeBindingsTo(t,o){Object.entries(o).forEach(([i,n])=>{if(!n)return;if(["onMount","didMount","willUnmount","willUpdate","onUpdate","didUpdate"].includes(i)&&(n=n.bind(null,t)),["willMount","onMount","didMount","willUnmount","onUnmount","didUnmount"].includes(i)){let c=!1,d=n;n=(...p)=>{if(c){Yf(`${i} is a one-time binding but was called multiple times`,this);return}c=!0,d(...p)}}let l=this._bindings[i];this._bindings[i]=l?[...l,n]:[n]})}bindAttributesTo(t,o){t instanceof Text||!o||Object.keys(o).filter(i=>i!=="children").forEach(i=>{let n=sz(i,o[i]);n&&("value"in n&&n.value!==void 0&&t.setAttribute(i,n.value),n.bindings&&this.addAttributeBindingsTo(t,n.bindings))})}}});var $0e,t_,hz=__dcg_shared_module_exports__['b'](()=>{$0e=__dcg_shared_module_exports__['e'](Z());ou();t_=class extends ga{constructor(){super(...arguments),this._viewName="Checkbox"}computeChecked(){return!!this.props.checked()}template(){if(!this.props.checked)throw new Error('<Checkbox> expects a "checked={}" prop');if(!this.props.onChange)throw new Error('<Checkbox> expects an "onChange={}" prop');let e={...this.props,type:this.const("checkbox"),checked:this.const(this.computeChecked()?"checked":void 0),onChange:t=>{this.props.onChange(t.target.checked),this._isMounted&&this.update()},onMount:t=>{this.rootDOM=t,this.props.onMount&&this.props.onMount(t)}};return this.createElement("input",e)}didUpdate(){let e=this.computeChecked();this.rootDOM.checked!==e&&(this.rootDOM.checked=e)}}});var gz,mz=__dcg_shared_module_exports__['b'](()=>{gz=r=>{let e=r.length,t=new Array(e),o=new Array(e+1),i=0,n;for(let l=0;l<e;l++){if(r[o[i]]<r[l])n=i+1;else{let c=1,d=i-1;for(;c<=d;){let p=Math.ceil((c+d)/2);r[o[p]]<r[l]?c=p+1:d=p-1}n=c}t[l]=o[n-1],o[n]=l,n>i&&(i=n)}let a=new Array(i),s=o[i];for(let l=i-1;l>=0;l--)a[l]=r[s],s=t[s];return a}});function fz(r,e){let t={};for(let l=0;l<e.length;l++)t[e[l]]=l;let o=r.filter(l=>t[l]===void 0),i=r.map(l=>t[l]).filter(l=>l!==void 0),n=gz(i),a={};for(let l=0;l<n.length;l++){let c=n[l];a[e[c]]=!0}let s=[];for(let l=e.length-1;l>=0;l--){let c=e[l];a[c]||s.push({key:c,beforeKey:e[l+1]})}return{removes:o,inserts:s}}var bz=__dcg_shared_module_exports__['b'](()=>{mz()});function yz(r,e,t){if(!e||e.nodeType!==1)throw new Error("Must pass an HTMLElement for the node");if(e._mountedDCGView)throw new Error("This node is already mounted by a view");let o=new r(t)._construct(),i=document.createDocumentFragment();return o.renderTo(i),e.innerHTML="",ax(o),e._mountedDCGView=o,e.appendChild(i),sx(o),lx(o),o}function xz(r){let e=r._mountedDCGView;if(!e)throw new Error("This node is not mounted by a DCGView");cx(e),r.innerHTML="",delete r._mountedDCGView,dx(e),px(e)}function ax(r){r.willMount&&r.willMount(),ap(r,"willMount"),r._childViews.forEach(ax)}function sx(r){r._isMounted=!0,r.onMount&&r.onMount(),ap(r,"onMount"),r._childViews.forEach(sx)}function lx(r){r.didMount&&r.didMount(),ap(r,"didMount"),r._childViews.forEach(lx)}function cx(r){r.willUnmount&&r.willUnmount(),ap(r,"willUnmount"),r._childViews.forEach(cx)}function dx(r){r._isMounted=!1,r._childViews.forEach(dx),ap(r,"onUnmount"),r.onUnmount&&r.onUnmount()}function px(r){r._childViews.forEach(px),ap(r,"didUnmount"),r.didUnmount&&r.didUnmount()}function r_(r,e){let t=document.createDocumentFragment();return r.renderTo(t,e),t.childNodes}var o_=__dcg_shared_module_exports__['b'](()=>{XO()});var tCe,JO,ux,QO=__dcg_shared_module_exports__['b'](()=>{tCe=__dcg_shared_module_exports__['e'](Z());bz();np();ix();o_();ou();JO=class extends ga{constructor(){super(...arguments),this._viewName="ForWrapper"}template(){return this.props.children}},ux=class extends ga{constructor(){super(...arguments),this._viewName="For"}getKeys(){this._keyToItem={};let e=this.props.each();if(!Array.isArray(e))throw new Error("<For each={}> must return an array");let t=this.props.key?e.map(this.props.key):[...e];if(!this._chosenKeyType&&t.length){let o=typeof t[0];if(o!=="string"&&o!=="number")throw new Error(`The key: ${JSON.stringify(t[0])} is not a string or number`);this._chosenKeyType=o}return t.forEach((o,i)=>{if(typeof o!==this._chosenKeyType)throw new Error(`Keys must be the same type. ${JSON.stringify(o)} is not a ${this._chosenKeyType}`);let n=o;if(n in this._keyToItem)throw new Error(`The key: ${JSON.stringify(o)} is not unique`);this._keyToItem[n]=e[i]}),t}createViewForKey(e){let t=this._keyToItem[e],o=this._viewFunction.call(this,t,e),i=o;return Kg(i)||(i=this.createElement(JO,{},o)),this._keyToView[e]=i,i}template(){if(typeof this.props.each!="function")throw new Error("<For each={}> must be a function");if(!("children"in this.props))throw new Error("<For> expects a child.");if(Array.isArray(this.props.children))throw new Error(`<For> expects a single child. You passed ${this.props.children.length}.`);if(this._viewFunction=this.props.children,this._viewFunction&&this._viewFunction instanceof kl)throw new Error("<For> expects a function that constructs a DCGElement. You passed a DCGElement directly");if(typeof this._viewFunction!="function"){let e=JSON.stringify(this._viewFunction);throw new Error(`<For> expects a function that constructs a DCGElement. You passed ${e}`)}if(bs(this._viewFunction))throw new Error("<For> expects a function that constructs a DCGElement. You passed a constant");return this._keyToView={},this._keys=this.getKeys(),this._startPlaceholder=this.createElement(Xf,null),this._keys.map(e=>{let t=this.createViewForKey(e);return t._parentElement=this,t}),this._endPlaceholder=this.createElement(Xf,null),this._startPlaceholder}detachAllRemovedViews(){let e=this._childViews,t=0;for(let o=0;o<e.length;o++){let i=e[o];i._willBeUnmounted?t++:e[o-t]=i}e.splice(e.length-t,t)}findFirstRootDOMNode(){return this._startPlaceholder._domNode}findLastRootDOMNode(){return this._endPlaceholder._domNode}updateChildren(){let e=this._keys,t=this.getKeys();this._keys=t;let o=fz(e,t),i=[];for(let a=o.removes.length-1;a>=0;a--){let s=o.removes[a],l=this._keyToView[s];cx(l),delete this._keyToView[s],l._willBeUnmounted=!0,l.findAllRootDOMNodes().forEach(c=>c.remove()),i.push(l)}i.length>0&&(this.detachAllRemovedViews(),i.forEach(dx),i.forEach(px));let n=[];for(let a=o.inserts.length-1;a>=0;a--){let s=o.inserts[a].key;if(s in this._keyToView)continue;let l=this.createViewForKey(s);r_(l,this),n.push(l)}n.forEach(ax),o.inserts.forEach(a=>{let s=this._keyToView[a.key].findAllRootDOMNodes(),l;a.beforeKey?l=this._keyToView[a.beforeKey].findFirstRootDOMNode():l=this.findLastRootDOMNode(),s.forEach(c=>{l.before(c)})}),n.forEach(sx),n.forEach(lx);for(let a=0;a<this._childViews.length-n.length;a++)this._childViews[a].update()}renderTo(e,t){super.renderTo(e,t);for(let o of this._keys)this._keyToView[o].renderTo(e,this);this._endPlaceholder.renderTo(e,this)}}});function wz(r,e){let t={each:r,key:e.key},o=iu(ux,t,e.item);return o._viewName="Each",o}var lCe,vz=__dcg_shared_module_exports__['b'](()=>{lCe=__dcg_shared_module_exports__['e'](Z());nx();QO()});var uCe,ZO,nu,u0=__dcg_shared_module_exports__['b'](()=>{uCe=__dcg_shared_module_exports__['e'](Z());np();ix();o_();ou();ZO=class extends ga{constructor(){super(...arguments),this._viewName="SwitchWrapper"}template(){return this.props.children}},nu=class extends ga{constructor(){super(...arguments),this._viewName="Switch"}updateKey(){this._key=this.props.key()}createView(){let e=this._viewFunction(this._key);e=e!=null?e:this.createElement(Xf,null);let t=this.createElement(ZO,{},e);return t._parentElement=this,t}template(){if(typeof this.props.key!="function")throw new Error("<Switch key={}> must be a function");if(!("children"in this.props))throw new Error("<Switch> expects a child.");if(Array.isArray(this.props.children))throw new Error(`<Switch> expects a single child. You passed ${this.props.children.length}.`);if(this._viewFunction=this.props.children,this._viewFunction&&this._viewFunction instanceof kl)throw new Error("<Switch> expects a function that constructs a DCGElement. You passed a DCGElement directly");if(typeof this._viewFunction!="function"){let e=JSON.stringify(this._viewFunction);throw new Error("<Switch> expects a function that constructs a DCGElement. You passed "+e)}if(bs(this._viewFunction))throw new Error("<Switch> expects a function that constructs a DCGElement. You passed a constant");return this.updateKey(),this.createView()}updateChildren(){let e=this._key;this.updateKey();let t=this._key;if(e===t){this._element.update();return}let o=this.findAllRootDOMNodes(),i=document.createTextNode("");o[0].before(i),cx(this._element),this._childViews=[],o.forEach(a=>a.remove()),dx(this._element),px(this._element),this._element=this.createView();let n=r_(this._element,this);ax(this._element),n.forEach(a=>{i.before(a)}),i.remove(),sx(this._element),lx(this._element)}}});var yCe,i_,Cz=__dcg_shared_module_exports__['b'](()=>{yCe=__dcg_shared_module_exports__['e'](Z());np();ix();u0();ou();i_=class extends ga{constructor(){super(...arguments),this._viewName="If"}template(){let{predicate:e}=this.props;if(typeof e!="function")throw new Error("<If predicate={}> must be a function");if(!("children"in this.props))throw new Error("<If> expects a child.");if(Array.isArray(this.props.children))throw new Error(`<If> expects a single child. You passed ${this.props.children.length}.`);let t=this.props.children;if(t&&t instanceof kl)throw new Error("<If> expects a function that constructs a DCGElement. You passed a DCGElement directly");if(typeof t!="function"){let n=JSON.stringify(t);throw new Error(`<If> expects a function that constructs a DCGElement. You passed ${n}`)}if(bs(t))throw new Error("<If> expects a function that constructs a DCGElement. You passed a constant");let o=()=>!!e(),i=n=>n?t():void 0;return this.createElement(nu,{key:o},i)}}});function Sz(r,e){let t=iu(nu,{key:()=>{let o=r();return o!=null}},o=>o?e(r):void 0);return t._viewName="IfDefined",t}var ECe,Ez=__dcg_shared_module_exports__['b'](()=>{ECe=__dcg_shared_module_exports__['e'](Z());nx();u0()});function n_(r,e){return typeof r=="string"?Dz.bind(this,r,e):Dz(void 0,r,e)}var TCe,Dz,e2=__dcg_shared_module_exports__['b'](()=>{TCe=__dcg_shared_module_exports__['e'](Z());nx();u0();Dz=(r,e,t)=>{let o=iu(nu,{key(){let i=e();return r?i&&i[r]:i}},i=>{let n=t[i];return n?n(e):void 0});return o._viewName="SwitchUnion",o}});function kz(r,e){let t=n_(()=>r()?"true":"false",e);return t._viewName="IfElse",t}var ACe,_z=__dcg_shared_module_exports__['b'](()=>{ACe=__dcg_shared_module_exports__['e'](Z());e2()});var PCe,a_,Tz=__dcg_shared_module_exports__['b'](()=>{PCe=__dcg_shared_module_exports__['e'](Z());ou();a_=class extends ga{constructor(){super(...arguments),this._viewName="Input"}computeValue(){let e=this.props.value();return e==null?"":`${e}`}template(){let{value:e,onInput:t,onEnterPressed:o,disabled:i,readOnly:n}=this.props;if(!e)throw new Error('<Input> expects a "value={}" prop');if(!t)throw new Error('<Input> expects an "onInput={}" prop');let a={...this.props,value:this.const(this.computeValue()),onInput:(s=>{t(s.target.value),this._isMounted&&this.update()}).bind(this)};return o&&(a.onKeypress=s=>{s.which===13&&o()}),i&&(a.disabled=()=>i()?!0:void 0),n&&(a.readOnly=()=>n()?!0:void 0),a.hasOwnProperty("tabIndex")||(a.tabIndex=()=>i&&i()?"-1":"0"),a.onMount=s=>{this.rootDOM=s,this.props.onMount&&this.props.onMount(s)},this.createElement("input",a)}didUpdate(){let e=this.computeValue();this.rootDOM.value!==e&&(this.rootDOM.value=e)}}});var FCe,s_,Gz=__dcg_shared_module_exports__['b'](()=>{FCe=__dcg_shared_module_exports__['e'](Z());ou();s_=class extends ga{constructor(){super(...arguments),this._viewName="Textarea"}computeValue(){let e=this.props.value();return e==null?"":`${e}`}template(){let{value:e,onInput:t,disabled:o,readOnly:i}=this.props;if(!e)throw new Error('<Textarea> expects a "value={}" prop');if(!t)throw new Error('<Textarea> expects an "onInput={}" prop');let n={...this.props,onInput:(a=>{this.props.onInput(a.target.value),this._isMounted&&this.update()}).bind(this)};return o&&(n.disabled=()=>o()?!0:void 0),i&&(n.readOnly=()=>i()?!0:void 0),n.onMount=a=>{this.rootDOM=a,this.props.onMount&&this.props.onMount(a)},delete n.value,this.createElement("textarea",n,this.const(this.computeValue()))}didUpdate(){let e=this.computeValue();this.rootDOM.value!==e&&(this.rootDOM.value=e)}}});var l_={};__dcg_shared_module_exports__['d'](l_,{Checkbox:()=>t_,Each:()=>wz,For:()=>ux,If:()=>i_,IfDefined:()=>Sz,IfElse:()=>kz,Input:()=>a_,Switch:()=>nu,SwitchUnion:()=>n_,Textarea:()=>s_});var Iz=__dcg_shared_module_exports__['b'](()=>{hz();vz();QO();Cz();Ez();_z();Tz();u0();e2();Gz()});var t2={};__dcg_shared_module_exports__['d'](t2,{Class:()=>Woe,Components:()=>l_,View:()=>ga,_warn:()=>Yf,addCustomAttribute:()=>ox,addWarningHandler:()=>dz,const:()=>Yk,createElement:()=>iu,isConst:()=>bs,mountToNode:()=>yz,removeWarningHandler:()=>pz,unmountFromNode:()=>xz});var Woe,r2=__dcg_shared_module_exports__['b'](()=>{$4();Y4();Q4();Jk();ou();Iz();np();nx();Jk();o_();ou();Qk();Woe=ga;ox("style",J4);ox("class",W4);["willMount","onMount","didMount","willUnmount","onUnmount","didUnmount","willUpdate","onUpdate","didUpdate"].forEach(r=>ox(r,j4(r)))});var au,Mz=__dcg_shared_module_exports__['b'](()=>{r2();r2();au=t2});var Z=__dcg_shared_module_exports__['c']((gSe,Az)=>{d4();tu();Xa();Mz();$t();au.addWarningHandler(r=>Vo(r));au.addCustomAttribute("href",r=>{let e=jk(r());return{value:`${jk(r())}`,bindings:{onMount(t){if(!["a","use"].includes(t.tagName.toLowerCase()))throw new Error("Cannot have an href on a non-link element.")},onUpdate(t){let o=jk(r());e!==o&&(e=o,t.setAttribute("href",o))}}}});au.addCustomAttribute("onTap",r=>({value:"",bindings:{onMount(e){re(e).on("dcg-tap",r)}}}));au.addCustomAttribute("onTapStart",r=>({bindings:{onMount(e){re(e).on("dcg-tapstart",r)}}}));au.addCustomAttribute("onTapMove",r=>({bindings:{onMount(e){re(e).on("dcg-tapmove",r)}}}));au.addCustomAttribute("onTapEnd",r=>({bindings:{onMount(e){re(e).on("dcg-tapend",r)}}}));au.addCustomAttribute("onLongHold",r=>({bindings:{onMount(e){re(e).on("dcg-longhold",r)}}}));au.addCustomAttribute("manageFocus",r=>r()===void 0?{}:{bindings:{onMount(e){r().shouldBeFocused()&&e.focus(),e.onfocus=function(t){r().shouldBeFocused()||r().onFocusedChanged(!0,t)},e.onblur=function(t){r().shouldBeFocused()&&t.target!==document.activeElement&&r().onFocusedChanged(!1,t)}},onUpdate(e){let t=r().shouldBeFocused(),o=document.activeElement===e;t&&!o?e.focus():o&&!t&&e.blur()},willUnmount(e){e.onfocus=null,e.onblur=null}}});Az.exports=au});var lH=__dcg_shared_module_exports__['c'](x0=>{var Pt=x0&&x0.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o[n]=i[n])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),v_=x0&&x0.__assign||function(){return v_=Object.assign||function(r){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},v_.apply(this,arguments)};(function(){var r=-1,e=1,t=Math.min,o=Math.max;function i(){}function n(k){for(;k;){if(!k.parent)return k;k=k.parent}}function a(k,b,g){if(!b){var f=new Error("prayer failed: "+k);if(g){var D={};f.dcgExtraErrorMetaData=D;for(var V in g){var $=g[V],te=D[V]={};if($){te.localLatex=$.latex();var le=n($);le&&(te.rootLatex=le.latex())}else te.emptyNode=!0}}throw f}}function s(k){a("a direction was passed",k===r||k===e)}function l(k){var b=document.implementation.createHTMLDocument("");if(b.body.innerHTML=k,b.body.children.length===1)return b.body.children[0];for(var g=document.createDocumentFragment();b.body.firstChild;)g.appendChild(b.body.firstChild);return g}var c=function(b,g,f){var D;switch(b){case"svg":case"path":D=document.createElementNS("http://www.w3.org/2000/svg",b);break;default:D=document.createElement(b)}for(var V in g){var $=g[V];$!==void 0&&D.setAttribute(V,typeof $=="string"?$:String($))}if(f)for(var te=0;te<f.length;te++)D.appendChild(f[te]);return D};c.text=function(k){return document.createTextNode(k)},c.block=function(k,b,g,f){var D=[g.html()];f!=null&&f.beforeChild&&D.unshift(f.beforeChild),f!=null&&f.afterChild&&D.push(f.afterChild);var V=c(k,b,D);return g.setDOM(V),R.linkElementByBlockNode(V,g),V},c.entityText=function(k){var b=l(k);return a("entity parses to a single text node",b instanceof DocumentFragment&&b.childNodes.length===1&&b.childNodes[0]instanceof Text),b.childNodes[0]};function d(k,b){var g,f;if(typeof(k==null?void 0:k.closest)=="function")return k.closest(b);if(!(k instanceof HTMLElement))return null;var D=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,V=k;do{if(D.call(V,b))return V;V=(f=(g=V==null?void 0:V.parentElement)!==null&&g!==void 0?g:V==null?void 0:V.parentNode)!==null&&f!==void 0?f:null}while(V!==null&&V.nodeType===1);return null}var p="\xA0",u="\u200B",h="\u02D9",m="\u2211",y="\u220F",w="\u2210",S="\u222B";function C(k){return k.getClientRects().length?k.getBoundingClientRect():{top:0,left:0,height:0,width:0,x:0,y:0,bottom:0,right:0}}function v(){return window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft}function E(){return window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}var _=function(){var k,b;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(k=requestAnimationFrame,b=cancelAnimationFrame):(k=function(g){return setTimeout(g,13)},b=clearTimeout),function(g,f){var D=Date.now(),V,$=0;function te(){var Xe=(Date.now()-D)/g;Xe<=$?ke():$=Xe,f($,ke,le)}function le(){V!==void 0&&b(V),V=void 0}function ke(){le(),V=k(te)}f(g<=0?1:0,ke,le)}}(),T=function(){function k(b){this.span=c("span",{class:"dcg-mq-aria-alert","aria-live":"assertive","aria-atomic":"true"}),this.msg="",this.items=[],this.controller=b}return k.prototype.attach=function(){var b=this.controller.container;this.span.parentNode!==b&&P(b).prepend(P(this.span))},k.prototype.queue=function(b,g){g===void 0&&(g=!1);var f="";if(b instanceof Nt){var D=b.mathspeak({ignoreShorthand:!0});g&&(b.parent&&b.parent.ariaLabel&&b.ariaLabel==="block"?f=b.parent.ariaLabel+" "+D:b.ariaLabel&&(f=b.ariaLabel+" "+D)),f===""&&(f=D)}else f=b||"";return this.items.push(f),this},k.prototype.queueDirOf=function(b){return s(b),this.queue(b===r?"before":"after")},k.prototype.queueDirEndOf=function(b){return s(b),this.queue(b===r?"beginning of":"end of")},k.prototype.alert=function(b){return this.attach(),b&&this.queue(b),this.items.length&&(this.msg=this.items.join(" ").replace(/ +(?= )/g,"").trim(),this.controller.containerHasFocus()&&(this.controller.options.logAriaAlerts&&this.msg&&console.log(this.msg),this.span.textContent=this.msg)),this.clear()},k.prototype.clear=function(b){return this.items.length=0,b!=null&&b.emptyContent&&(this.span.textContent=""),this},k}(),I=function(){function k(b,g){var f;arguments.length===1&&(g=b),!(!b||!g)&&(this.ends=(f={},f[r]=b,f[e]=g,f))}return k.create=function(b,g){arguments.length===1&&(g=b),a("No half-empty DOMFragments",!!b==!!g);var f=new k(b,g);return a("last is a forward sibling of first",f.isValid()),f},k.prototype.isEmpty=function(){return this.ends===void 0},k.prototype.isOneNode=function(){return!!(this.ends&&this.ends[r]===this.ends[e])},k.prototype.isValid=function(){if(!this.ends||this.ends[r]===this.ends[e])return!0;var b;return this.eachNode(function(g){return b=g}),b===this.ends[e]},k.prototype.firstNode=function(){return a("Fragment is not empty",this.ends),this.ends[r]},k.prototype.lastNode=function(){return a("Fragment is not empty",this.ends),this.ends[e]},k.prototype.children=function(){var b=this.oneNode(),g=b.firstChild,f=b.lastChild;return g&&f?new k(g,f):new k},k.prototype.join=function(b){if(!this.ends)return b;if(!b.ends)return this;for(var g=!1,f=this.ends[e].nextSibling;f;){if(f===b.ends[r]){g=!0;break}f=f.nextSibling}return a("sibling must be a forward DOM sibling of this fragment",g),new k(this.ends[r],b.ends[e])},k.prototype.oneNode=function(){return a("Fragment has a single node",this.ends&&this.ends[r]===this.ends[e]),this.ends[r]},k.prototype.oneElement=function(){var b=this.oneNode();return a("Node is an Element",b.nodeType===Node.ELEMENT_NODE),b},k.prototype.oneText=function(){var b=this.oneNode();return a("Node is Text",b.nodeType===Node.TEXT_NODE),b},k.prototype.eachNode=function(b){if(!this.ends)return this;for(var g=this.ends[e],f=this.ends[r],D=void 0;f&&(D=f.nextSibling,b(f),f!==g);f=D);return this},k.prototype.eachElement=function(b){return this.eachNode(function(g){g.nodeType===Node.ELEMENT_NODE&&b(g)}),this},k.prototype.text=function(){var b="";return this.eachNode(function(g){b+=g.textContent||""}),b},k.prototype.toNodeArray=function(){var b=[];return this.eachNode(function(g){return b.push(g)}),b},k.prototype.toElementArray=function(){var b=[];return this.eachElement(function(g){return b.push(g)}),b},k.prototype.toDocumentFragment=function(){var b=document.createDocumentFragment();return this.eachNode(function(g){return b.appendChild(g)}),b},k.prototype.insertBefore=function(b){return this.insDirOf(r,b)},k.prototype.insertAfter=function(b){return this.insDirOf(e,b)},k.prototype.append=function(b){return b.appendTo(this.oneElement()),this},k.prototype.prepend=function(b){return b.prependTo(this.oneElement()),this},k.prototype.appendTo=function(b){return this.insAtDirEnd(e,b)},k.prototype.prependTo=function(b){return this.insAtDirEnd(r,b)},k.prototype.parent=function(){if(!this.ends)return this;var b=this.ends[r].parentNode;return b?new k(b):new k},k.prototype.wrapAll=function(b){if(b.textContent="",!this.ends)return this;var g=this.ends[r].parentNode,f=this.ends[e].nextSibling;return this.appendTo(b),g&&g.insertBefore(b,f),this},k.prototype.replaceWith=function(b){var g,f=(g=this.ends)===null||g===void 0?void 0:g[e],D=f==null?void 0:f.parentNode,V=f==null?void 0:f.nextSibling;this.detach();var $=b.toDocumentFragment();return!f||!D?this:(D.insertBefore($,V||null),this)},k.prototype.nthElement=function(b){if(this.ends&&!(b<0||b!==Math.floor(b)))for(var g=this.ends[r];g;){if(g.nodeType===Node.ELEMENT_NODE){if(b<=0)return g;b-=1}if(g===this.ends[e])return;g=g.nextSibling}},k.prototype.firstElement=function(){return this.nthElement(0)},k.prototype.lastElement=function(){if(this.ends)for(var b=this.ends[e];b;){if(b.nodeType===Node.ELEMENT_NODE)return b;if(b===this.ends[r])return;b=b.previousSibling}},k.prototype.first=function(){return new k(this.firstElement())},k.prototype.last=function(){return new k(this.lastElement())},k.prototype.eq=function(b){return new k(this.nthElement(b))},k.prototype.slice=function(b){if(!this.ends)return this;var g=this.nthElement(b);return g?new k(g,this.ends[e]):new k},k.prototype.next=function(){for(var b=this.oneNode();b;)if(b=b.nextSibling,b&&b.nodeType===Node.ELEMENT_NODE)return new k(b);return new k},k.prototype.prev=function(){for(var b=this.oneNode();b;)if(b=b.previousSibling,b&&b.nodeType===Node.ELEMENT_NODE)return new k(b);return new k},k.prototype.empty=function(){return this.eachElement(function(b){b.textContent=""}),this},k.prototype.remove=function(){return this.toDocumentFragment(),this},k.prototype.detach=function(){return this.remove()},k.prototype.insDirOf=function(b,g){var f;if(!this.ends)return this;var D=(f=g.ends)===null||f===void 0?void 0:f[b];return!D||!D.parentNode?this.detach():(O(b,D.parentNode,this.toDocumentFragment(),D),this)},k.prototype.insAtDirEnd=function(b,g){return this.ends?(W(b,this.toDocumentFragment(),g),this):this},k.prototype.hasClass=function(b){var g=!1;return this.eachElement(function(f){f.classList.contains(b)&&(g=!0)}),g},k.prototype.addClass=function(b){for(var g=function(te){if(!te)return"continue";f.eachElement(function(le){le.classList.add(te)})},f=this,D=0,V=b.split(/\s+/);D<V.length;D++){var $=V[D];g($)}return this},k.prototype.removeClass=function(b){for(var g=function(te){if(!te)return"continue";f.eachElement(function(le){le.classList.remove(te)})},f=this,D=0,V=b.split(/\s+/);D<V.length;D++){var $=V[D];g($)}return this},k.prototype.toggleClass=function(b,g){if(g===!0)return this.addClass(b);if(g===!1)return this.removeClass(b);for(var f=function(le){if(!le)return"continue";D.eachElement(function(ke){ke.classList.toggle(le)})},D=this,V=0,$=b.split(/\s+/);V<$.length;V++){var te=$[V];f(te)}return this},k}(),P=I.create;function O(k,b,g,f){b.insertBefore(g,k===r?f:f.nextSibling)}function W(k,b,g){k===r?g.insertBefore(b,g.firstChild):g.appendChild(b)}var X=function(){function k(b,g,f){this.init(b,g,f)}return k.prototype.init=function(b,g,f){this.parent=b,this[r]=g,this[e]=f},k.copy=function(b){return new k(b.parent,b[r],b[e])},k}();function x(k,b){var g=k[r];if(g){var f=k[e];if(f)for(f=f[e];g!==f;g=g[e]){var D=b(g);if(D===!1)break}}}function L(k,b,g){var f=k[r];if(!f)return b;var D=k[e];if(!D)return b;for(D=D[e];f!==D;f=f[e])b=g(b,f);return b}var R=function(){function k(){var f;this[b]=0,this[g]=0,this.parent=0,this.ends=(f={},f[r]=0,f[e]=0,f),this.id=k.uniqueNodeId()}k.uniqueNodeId=function(){return k.idCounter+=1},k.getNodeOfElement=function(f){if(f){if(!f.nodeType)throw new Error("must pass an Element to NodeBase.getNodeOfElement");var D=f;return D.mqBlockNode||D.mqCmdNode}},k.linkElementByBlockNode=function(f,D){f.mqBlockNode=D},k.linkElementByCmdNode=function(f,D){f.mqCmdNode=D},k.prototype.setEnds=function(f){this.ends=f,a("No half-empty node ends",!!this.ends[r]==!!this.ends[e])},k.prototype.getEnd=function(f){return this.ends[f]},k.prototype.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},k.prototype.setDOM=function(f){return f&&a("DOM is an element or a text node",f.nodeType===Node.ELEMENT_NODE||f.nodeType===Node.TEXT_NODE),this._el=f,this},k.prototype.domFrag=function(){return P(this._el)},k.prototype.createDir=function(f,D){s(f);var V=this;return V.html(),V.domFrag().insDirOf(f,D.domFrag()),D[f]=V.adopt(D.parent,D[r],D[e]),V},k.prototype.createLeftOf=function(f){this.createDir(r,f)},k.prototype.selectChildren=function(f,D){return new ge(f,D)},k.prototype.bubble=function(f){for(var D=this.getSelfNode(),V=D;V;V=V.parent){var $=f(V);if($===!1)break}return this},k.prototype.postOrder=function(f){var D=this.getSelfNode();return function V($){return $?($.eachChild(V),f($),!0):!1}(D),D},k.prototype.isEmpty=function(){return this.ends[r]===0&&this.ends[e]===0},k.prototype.isQuietEmptyDelimiter=function(f){if(!this.isEmpty()||!f||!this.parent||this.parent.ctrlSeq===void 0)return!1;var D=this.parent.ctrlSeq.replace(/^\\(left|right)?/,"");return f.hasOwnProperty(D)},k.prototype.isStyleBlock=function(){return!1},k.prototype.isTextBlock=function(){return!1},k.prototype.children=function(){return new z(this.getEnd(r),this.getEnd(e))},k.prototype.eachChild=function(f){return x(this.ends,f),this},k.prototype.foldChildren=function(f,D){return L(this.ends,f,D)},k.prototype.withDirAdopt=function(f,D,V,$){var te=this.getSelfNode();return new z(te,te).withDirAdopt(f,D,V,$),this},k.prototype.adopt=function(f,D,V){var $=this.getSelfNode();return new z($,$).adopt(f,D,V),this.getSelfNode()},k.prototype.disown=function(){var f=this.getSelfNode();return new z(f,f).disown(),this},k.prototype.remove=function(){return this.domFrag().remove(),this.disown()},k.prototype.shouldIgnoreSubstitutionInSimpleSubscript=function(f){var D=f.disableAutoSubstitutionInSubscripts;if(!D||!this.parent||!(this.parent.parent instanceof lc))return!1;var V=this.parent.parent[r];return!(typeof D=="object"&&V instanceof _r&&V.endsWord&&D.except[V.endsWord]||!this.parent.domFrag().hasClass("dcg-mq-sub"))},k.prototype.getSelfNode=function(){return this},k.prototype.parser=function(){a("Abstract parser() method is never called",!1)},k.prototype.html=function(){throw new Error("html() unimplemented in NodeBase")},k.prototype.text=function(){return""},k.prototype.latex=function(){var f={latex:"",startIndex:-1,endIndex:-1};return this.latexRecursive(f),f.latex},k.prototype.latexRecursive=function(f){},k.prototype.checkCursorContextOpen=function(f){f.startSelectionBefore===this&&(f.startIndex=f.latex.length),f.endSelectionBefore===this&&(f.endIndex=f.latex.length)},k.prototype.checkCursorContextClose=function(f){f.startSelectionAfter===this&&(f.startIndex=f.latex.length),f.endSelectionAfter===this&&(f.endIndex=f.latex.length)},k.prototype.finalizeTree=function(f,D){},k.prototype.contactWeld=function(f,D){},k.prototype.blur=function(f){},k.prototype.focus=function(){},k.prototype.intentionalBlur=function(){},k.prototype.reflow=function(){},k.prototype.registerInnerField=function(f,D){},k.prototype.chToCmd=function(f,D){a("Abstract chToCmd() method is never called",!1)},k.prototype.mathspeak=function(f){return""},k.prototype.seek=function(f,D){},k.prototype.siblingDeleted=function(f,D){},k.prototype.siblingCreated=function(f,D){},k.prototype.finalizeInsert=function(f,D){},k.prototype.fixDigitGrouping=function(f){},k.prototype.writeLatex=function(f,D){},k.prototype.write=function(f,D){};var b,g;return b=r,g=e,k.idCounter=0,k}();function N(k,b,g){a("a parent is always present",k),a("leftward is properly set up",function(){return b?b[e]===g&&b.parent===k:k.getEnd(r)===g}(),{parent:k,leftward:b,leftwardL:b&&b[r],leftwardR:b&&b[e],rightwardL:g&&g[r],rightwardR:g&&g[e]}),a("rightward is properly set up",function(){return g?g[r]===b&&g.parent===k:k.getEnd(e)===b}(),{parent:k,rightward:g,leftwardL:b&&b[r],leftwardR:b&&b[e],rightwardL:g&&g[r],rightwardR:g&&g[e],rightwardParent:g&&g.parent})}var z=function(){function k(b,g,f){var D,V;if(this.disowned=!1,f===void 0&&(f=r),s(f),a("no half-empty fragments",!b==!g,{withDir:b,oppDir:g}),!b||!g){this.setEnds((D={},D[r]=0,D[e]=0,D));return}a("withDir is passed to Fragment",b instanceof Nt),a("oppDir is passed to Fragment",g instanceof Nt),a("withDir and oppDir have the same parent",b.parent===g.parent);var $=(V={},V[f]=b,V[-f]=g,V);this.setEnds($);var te=0;this.each(function(le){te=le}),a("following direction siblings from start reaches end",te===$[e])}return k.prototype.getDOMFragFromEnds=function(){var b=this.ends[r],g=this.ends[e];return b===0||g===0?P():b===g?b.domFrag():b.domFrag().join(g.domFrag())},k.prototype.setEnds=function(b){this.ends=b},k.prototype.getEnd=function(b){return this.ends?this.ends[b]:0},k.prototype.domFrag=function(){return this.getDOMFragFromEnds()},k.prototype.withDirAdopt=function(b,g,f,D){return b===r?this.adopt(g,f,D):this.adopt(g,D,f)},k.prototype.adopt=function(b,g,f){var D;N(b,g,f);var V=this;this.disowned=!1;var $=V.ends[r];if(!$)return this;var te=V.ends[e];if(!te)return this;var le=(D={},D[r]=b.getEnd(r),D[e]=b.getEnd(e),D);return g||(le[r]=$),f?f[r]=te:le[e]=te,b.setEnds(le),te[e]=f,V.each(function(ke){return ke[r]=g,ke.parent=b,g&&(g[e]=ke),g=ke,!0}),V},k.prototype.disown=function(){var b,g=this,f=g.ends[r];if(!f||g.disowned)return g;this.disowned=!0;var D=g.ends[e];if(!D)return g;var V=f.parent;N(V,f[r],f),N(V,D,D[e]);var $=(b={},b[r]=V.getEnd(r),b[e]=V.getEnd(e),b);if(f[r]){var te=f[r];te[e]=D[e]}else $[r]=D[e];if(D[e]){var le=D[e];le[r]=f[r]}else $[e]=f[r];return $[r]&&$[e]?V.setEnds($):V.ends=$,g},k.prototype.remove=function(){return this.domFrag().remove(),this.disown()},k.prototype.each=function(b){return x(this.ends,b),this},k.prototype.fold=function(b,g){return L(this.ends,b,g)},k}(),A={},U={};function pe(k){return k&&k.prototype instanceof Nt}var q=function(k){Pt(b,k);function b(g,f,D){var V=k.call(this,g,f,D)||this;return V.ancestors={},V}return b.fromCursor=function(g){return new b(g.parent,g[r],g[e])},b}(X),F=function(k){Pt(b,k);function b(g,f,D){var V=k.call(this,g,0,0)||this;return V.upDownCache={},V.cursorElement=c("span",{class:"dcg-mq-cursor"},[c.text(u)]),V._domFrag=P(),V.controller=D,V.options=f,V.setDOMFrag(P(V.cursorElement)),V.blink=function(){P(V.cursorElement).toggleClass("dcg-mq-blink")},V}return b.prototype.setDOMFrag=function(g){return this._domFrag=g,this},b.prototype.domFrag=function(){return this._domFrag},b.prototype.show=function(){if(P(this.cursorElement).removeClass("dcg-mq-blink"),this.setDOMFrag(P(this.cursorElement)),this.intervalId)clearInterval(this.intervalId);else{var g=this[e];if(g){var f=this.selection;f&&f.getEnd(r)[r]===this[r]?this.domFrag().insertBefore(f.domFrag()):this.domFrag().insertBefore(g.domFrag())}else this.domFrag().appendTo(this.parent.domFrag().oneElement());this.parent.focus()}return this.intervalId=setInterval(this.blink,500),this},b.prototype.hide=function(){return this.intervalId&&clearInterval(this.intervalId),this.intervalId=0,this.domFrag().detach(),this.setDOMFrag(P()),this},b.prototype.withDirInsertAt=function(g,f,D,V){var $=this.parent;this.parent=f,this[g]=D,this[-g]=V,$!==f&&$.blur&&$.blur(this)},b.prototype.insDirOf=function(g,f){return s(g),this.domFrag().insDirOf(g,f.domFrag()),this.withDirInsertAt(g,f.parent,f[g],f),this.parent.domFrag().addClass("dcg-mq-hasCursor"),this},b.prototype.insLeftOf=function(g){return this.insDirOf(r,g)},b.prototype.insRightOf=function(g){return this.insDirOf(e,g)},b.prototype.insAtDirEnd=function(g,f){return s(g),this.domFrag().insAtDirEnd(g,f.domFrag().oneElement()),this.withDirInsertAt(g,f,0,f.getEnd(g)),f.focus(),this},b.prototype.insAtLeftEnd=function(g){return this.insAtDirEnd(r,g)},b.prototype.insAtRightEnd=function(g){return this.insAtDirEnd(e,g)},b.prototype.jumpUpDown=function(g,f){var D=this;D.upDownCache[g.id]=X.copy(D);var V=D.upDownCache[f.id];if(V){var $=V[e];$?D.insLeftOf($):D.insAtRightEnd(V.parent)}else{var te=D.getBoundingClientRectWithoutMargin().left;f.seek(te,D)}D.controller.aria.queue(f,!0)},b.prototype.getBoundingClientRectWithoutMargin=function(){var g=this.domFrag();g.removeClass("dcg-mq-cursor");var f=C(g.oneElement()),D=f.left,V=f.right;return g.addClass("dcg-mq-cursor"),{left:D,right:V}},b.prototype.unwrapGramp=function(){var g=this.parent.parent,f=g.parent,D=g[e],V=this,$=g[r];if(g.disown().eachChild(function(Ue){return Ue.isEmpty()||(Ue.children().adopt(f,$,D).each(function(ot){return ot.domFrag().insertBefore(g.domFrag()),!0}),$=Ue.getEnd(e)),!0}),!this[e]){var te=this[r];if(te)this[e]=te[e];else for(;!this[e];){var le=this.parent[e];if(le)this.parent=le,this[e]=le.getEnd(r);else{this[e]=g[e],this.parent=f;break}}}var ke=this[e];ke?this.insLeftOf(ke):this.insAtRightEnd(f),g.domFrag().remove();var Xe=g[r],qe=g[e];Xe&&Xe.siblingDeleted(V.options,e),qe&&qe.siblingDeleted(V.options,r)},b.prototype.startSelection=function(){for(var g=this.anticursor=q.fromCursor(this),f=g.ancestors,D=g;D.parent;D=D.parent)f[D.parent.id]=D},b.prototype.endSelection=function(){delete this.anticursor},b.prototype.select=function(){var g,f=this.anticursor;if(this[r]===f[r]&&this.parent===f.parent)return!1;for(var D=this;D.parent;D=D.parent)if(D.parent.id in f.ancestors){g=D.parent;break}a("cursor and anticursor in the same tree",g);var V=g,$=f.ancestors[V.id],te,le,ke=e;if(D[r]!==$){for(var Xe=D;Xe;Xe=Xe[e])if(Xe[e]===$[e]){ke=r,te=D,le=$;break}}ke===e&&(te=$,le=D),te instanceof X&&(te=te[e]),le instanceof X&&(le=le[r]),this.hide().selection=V.selectChildren(te,le);var qe=this.selection.getEnd(ke);return this.insDirOf(ke,qe),this.selectionChanged(),!0},b.prototype.resetToEnd=function(g){this.clearSelection();var f=g.root;this[e]=0,this[r]=f.getEnd(e),this.parent=f},b.prototype.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},b.prototype.deleteSelection=function(){var g=this.selection;g&&(this[r]=g.getEnd(r)[r],this[e]=g.getEnd(e)[e],g.remove(),this.selectionChanged(),delete this.selection)},b.prototype.replaceSelection=function(){var g=this.selection;return g&&(this[r]=g.getEnd(r)[r],this[e]=g.getEnd(e)[e],delete this.selection),g},b.prototype.depth=function(){for(var g=this,f=0;g=g.parent;)f+=g instanceof Fe?1:0;return f},b.prototype.isTooDeep=function(g){return this.options.maxDepth!==void 0?this.depth()+(g||0)>this.options.maxDepth:!1},b.prototype.selectionChanged=function(){},b}(X),ge=function(k){Pt(b,k);function b(g,f,D){var V=k.call(this,g,f,D)||this;return V._el=c("span",{class:"dcg-mq-selection"}),V.getDOMFragFromEnds().wrapAll(V._el),V}return b.prototype.isCleared=function(){return this._el===void 0},b.prototype.domFrag=function(){return this.isCleared()?this.getDOMFragFromEnds():P(this._el)},b.prototype.setEnds=function(g){a("Selection ends are never empty",g[r]&&g[e]),this.ends=g},b.prototype.getEnd=function(g){return this.ends[g]},b.prototype.adopt=function(g,f,D){return this.clear(),k.prototype.adopt.call(this,g,f,D)},b.prototype.clear=function(){var g=this.getDOMFragFromEnds();return this.domFrag().replaceWith(g),this._el=void 0,this},b.prototype.join=function(g,f){return f===void 0&&(f=""),this.fold("",function(D,V){return D+f+V[g]()})},b}(z),ne=function(){function k(b,g,f){this.textareaEventListeners={},this.id=b.id,this.data={},this.root=b,this.container=g,this.options=f,this.aria=new T(this.getControllerSelf()),this.ariaLabel="Math Input",this.ariaPostLabel="",b.controller=this.getControllerSelf(),this.cursor=b.cursor=new F(b,f,this.getControllerSelf())}return k.prototype.getControllerSelf=function(){return this},k.prototype.handle=function(b,g){var f,D=this.options.handlers,V=(f=this.options.handlers)===null||f===void 0?void 0:f.fns[b];if(V){var $=D==null?void 0:D.APIClasses[this.KIND_OF_MQ];a("APIClass is defined",$);var te=new $(this);g===r||g===e?V(g,te):V(te)}},k.onNotify=function(b){k.notifyees.push(b)},k.prototype.notify=function(b){for(var g=0;g<k.notifyees.length;g+=1)k.notifyees[g](this.cursor,b);return this},k.prototype.setAriaLabel=function(b){var g=this.getAriaLabel();return b&&typeof b=="string"&&b!==""?this.ariaLabel=b:this.editable?this.ariaLabel="Math Input":this.ariaLabel="",this.ariaLabel!==g&&!this.containerHasFocus()&&this.updateMathspeak(),this},k.prototype.getAriaLabel=function(){return this.ariaLabel!=="Math Input"?this.ariaLabel:this.editable?"Math Input":""},k.prototype.setAriaPostLabel=function(b,g){var f=this;return b&&typeof b=="string"&&b!==""?(b!==this.ariaPostLabel&&typeof g=="number"&&(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this._ariaAlertTimeout=setTimeout(function(){f.containerHasFocus()?f.aria.alert(f.root.mathspeak().trim()+" "+b.trim()):f.updateMathspeak()},g)),this.ariaPostLabel=b):(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this.ariaPostLabel=""),this},k.prototype.getAriaPostLabel=function(){return this.ariaPostLabel||""},k.prototype.containerHasFocus=function(){return document.activeElement&&this.container.contains(document.activeElement)},k.prototype.getTextarea=function(){var b=this.textarea;return a("textarea initialized",b),b},k.prototype.getTextareaSpan=function(){var b=this.textareaSpan;return a("textareaSpan initialized",b),b},k.prototype.addTextareaEventListeners=function(b){if(this.textarea)for(var g in b){var f=g;this.removeTextareaEventListener(f),this.textarea.addEventListener(f,b[f])}},k.prototype.removeTextareaEventListener=function(b){if(this.textarea){var g=this.textareaEventListeners[b];g&&this.textarea.removeEventListener(b,g)}},k.prototype.exportMathSpeak=function(){return this.root.mathspeak()},k.prototype.updateMathspeak=function(b){},k.prototype.scrollHoriz=function(){},k.prototype.selectionChanged=function(){},k.prototype.setOverflowClasses=function(){},k.notifyees=[],k}(),ae={},j={},oe={handlers:!0,autoCommands:!0,quietEmptyDelimiters:!0,autoParenthesizedFunctions:!0,autoOperatorNames:!0,infixOperatorNames:!0,prefixOperatorNames:!0,leftRightIntoCmdGoes:!0,maxDepth:!0,interpretTildeAsSim:!0,disableAutoSubstitutionInSubscripts:!0},Y={},fe=function(){function k(b){this.version=b}return k.prototype.assertJquery=function(){return a("Interface versions > 2 do not depend on JQuery",this.version<=2),a("JQuery is set for interface v < 3",this.jQuery),this.jQuery},k}(),ye=function(){function k(){}return k}(),Ce=function(){window.console&&console.warn(`You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

See also the "\`dev\` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide" at
  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide`)},De;function Ge(k){return Ce(),De||(De=ee(1)),De(k)}Ge.prototype=ye.prototype,Ge.VERSION="v0.10.1",Ge.interfaceVersion=function(k){if(k!==1)throw"Only interface version 1 supported. You specified: "+k;return Ce=function(){window.console&&console.warn(`You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

See also the "\`dev\` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide" at
  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide`)},Ce(),Ge},Ge.getInterface=ee;var Ye=ee.MIN=1,Q=ee.MAX=3;function ee(k){if(k!==1&&k!==2&&k!==3)throw"Only interface versions between "+Ye+" and "+Q+" supported. You specified: "+k;var b=k;if(b<3){var g=window.jQuery;if(!g)throw"MathQuill interface version ".concat(b," requires jQuery 1.5.2+ to be loaded first");fe.prototype.jQuery=g}var f=v_(v_({},Y),{handlers:function(qe){return{fns:qe||{},APIClasses:le}}});function D(qe,Ue){for(var ot in Ue)if(Ue.hasOwnProperty(ot)){if(ot==="substituteKeyboardEvents"&&b>=3)throw new Error(["As of interface version 3, the 'substituteKeyboardEvents'","option is no longer supported. Use 'overrideTypedText' and","'overrideKeystroke' instead."].join(" "));var nt=Ue[ot],_t=f[ot];qe[ot]=_t?_t(nt):nt}}var V=b<3?fe:function(qe){Pt(Ue,qe);function Ue(){return qe!==null&&qe.apply(this,arguments)||this}return Ue}(fe),$=function(qe){Pt(Ue,qe);function Ue(ot){var nt=qe.call(this)||this;return nt.__controller=ot,nt.__options=ot.options,nt.id=ot.id,nt.data=ot.data,nt}return Ue.prototype.mathquillify=function(ot){var nt=this.__controller,_t=nt.root,Lt=nt.container;nt.createTextarea();var Mt=P(Lt).addClass(ot).children().detach();_t.setDOM(P(c("span",{class:"dcg-mq-root-block","aria-hidden":!0})).appendTo(Lt).oneElement()),R.linkElementByBlockNode(_t.domFrag().oneElement(),_t),this.latex(Mt.text()),this.revert=function(){return nt.removeMouseEventListener(),P(Lt).removeClass("dcg-mq-editable-field dcg-mq-math-mode dcg-mq-text-mode").empty().append(Mt),b<3?this.__options.assertJquery()(Lt):Lt}},Ue.prototype.setAriaLabel=function(ot){return this.__controller.setAriaLabel(ot),this},Ue.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},Ue.prototype.config=function(ot){return D(this.__options,ot),this},Ue.prototype.el=function(){return this.__controller.container},Ue.prototype.text=function(){return this.__controller.exportText()},Ue.prototype.mathspeak=function(){return this.__controller.exportMathSpeak()},Ue.prototype.latex=function(ot){if(arguments.length>0){this.__controller.renderLatexMath(ot);var nt=this.__controller.cursor;return this.__controller.blurred&&nt.hide().parent.blur(nt),this}return this.__controller.exportLatex()},Ue.prototype.selection=function(){return this.__controller.exportLatexSelection()},Ue.prototype.html=function(){return this.__controller.root.domFrag().oneElement().innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?dcg-mq-cursor( dcg-mq-blink)?"?>.?<\/span>/i,"").replace(/ dcg-mq-hasCursor|dcg-mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},Ue.prototype.reflow=function(){return this.__controller.root.postOrder(function(ot){ot.reflow()}),this},Ue.prototype.focus=function(){return this.__controller.getTextarea().focus(),this.__controller.editable&&this.__controller.scrollHoriz(),this},Ue.prototype.blur=function(){return this.__controller.getTextarea().blur(),this},Ue}(ye),te=function(qe){Pt(Ue,qe);function Ue(){return qe!==null&&qe.apply(this,arguments)||this}return Ue.prototype.mathquillify=function(ot){return qe.prototype.mathquillify.call(this,ot),this.__controller.editable=!0,this.__controller.addMouseEventListener(),this.__controller.editablesTextareaEvents(),this},Ue.prototype.select=function(){return this.__controller.selectAll(),this},Ue.prototype.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},Ue.prototype.write=function(ot){this.__controller.writeLatex(ot),this.__controller.scrollHoriz();var nt=this.__controller.cursor;return this.__controller.blurred&&nt.hide().parent.blur(nt),this},Ue.prototype.empty=function(){var ot,nt=this.__controller.root,_t=this.__controller.cursor;return nt.setEnds((ot={},ot[r]=0,ot[e]=0,ot)),nt.domFrag().empty(),delete _t.selection,_t.insAtRightEnd(nt),this},Ue.prototype.cmd=function(ot){var nt=this.__controller.notify(void 0),_t=nt.cursor;if(/^\\[a-z]+$/i.test(ot)&&!_t.isTooDeep()){ot=ot.slice(1);var Lt=A[ot],Mt;Lt&&(Lt.constructor?Mt=new Lt(ot):Mt=Lt(ot),_t.selection&&Mt.replaces(_t.replaceSelection()),Mt.createLeftOf(_t.show()))}else _t.parent.write(_t,ot);return nt.scrollHoriz(),nt.blurred&&_t.hide().parent.blur(_t),this},Ue.prototype.moveToDirEnd=function(ot){return this.__controller.notify("move").cursor.insAtDirEnd(ot,this.__controller.root),this},Ue.prototype.moveToLeftEnd=function(){return this.moveToDirEnd(r)},Ue.prototype.moveToRightEnd=function(){return this.moveToDirEnd(e)},Ue.prototype.keystroke=function(ot,nt){for(var _t=ot.replace(/^\s+|\s+$/g,"").split(/\s+/),Lt=0;Lt<_t.length;Lt+=1)this.__controller.keystroke(_t[Lt],nt);return this},Ue.prototype.typedText=function(ot){for(var nt=0;nt<ot.length;nt+=1)this.__controller.typedText(ot.charAt(nt));return this},Ue.prototype.dropEmbedded=function(ot,nt,_t){var Lt=ot-v(),Mt=nt-E(),M=document.elementFromPoint(Lt,Mt);this.__controller.seek(M,Lt,Mt);var B=new X1().setOptions(_t);B.createLeftOf(this.__controller.cursor)},Ue.prototype.setAriaPostLabel=function(ot,nt){return this.__controller.setAriaPostLabel(ot,nt),this},Ue.prototype.getAriaPostLabel=function(){return this.__controller.getAriaPostLabel()},Ue.prototype.clickAt=function(ot,nt,_t){_t=_t||document.elementFromPoint(ot,nt);var Lt=this.__controller,Mt=Lt.root,M=Mt.domFrag().oneElement();return M.contains(_t)||(_t=M),Lt.seek(_t,ot,nt),Lt.blurred&&this.focus(),this},Ue.prototype.ignoreNextMousedown=function(ot){return this.__controller.cursor.options.ignoreNextMousedown=ot,this},Ue}($),le={AbstractMathQuill:$,EditableField:te};a("API.StaticMath defined",ae.StaticMath),le.StaticMath=ae.StaticMath(le),a("API.MathField defined",ae.MathField),le.MathField=ae.MathField(le),a("API.InnerMathField defined",ae.InnerMathField),le.InnerMathField=ae.InnerMathField(le),ae.TextField&&(le.TextField=ae.TextField(le));var ke=function(qe){if(!qe||!qe.nodeType)return null;for(var Ue,ot=P(qe).children().toElementArray(),nt=0,_t=ot;nt<_t.length;nt++){var Lt=_t[nt];if(Lt.classList.contains("dcg-mq-root-block")){Ue=Lt;break}}var Mt=R.getNodeOfElement(Ue),M=Mt&&Mt.controller,B=M&&le[M.KIND_OF_MQ];return M&&B?new B(M):null};ke.L=r,ke.R=e,ke.config=function(qe){return D(V.prototype,qe),this},ke.registerEmbed=function(qe,Ue){if(!/^[a-z][a-z0-9]*$/i.test(qe))throw"Embed name must start with letter and be only letters and digits";j[qe]=Ue},ke.StaticMath=Xe("StaticMath",le.StaticMath),ke.MathField=Xe("MathField",le.MathField),ke.InnerMathField=Xe("InnerMathField",le.InnerMathField),le.TextField&&(ke.TextField=Xe("TextField",le.TextField)),ke.prototype=$.prototype,ke.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},ke.EditableField.prototype=te.prototype,b<3&&(ke.saneKeyboardEvents=sa);function Xe(qe,Ue){a(qe+" is defined",Ue);function ot(nt,_t){if(!nt||!nt.nodeType)return null;var Lt=ke(nt);if(Lt instanceof Ue)return Lt;var Mt=new No(new Ue.RootBlock,nt,new V(b));return Mt.KIND_OF_MQ=qe,new Ue(Mt).__mathquillify(_t||{},b)}return ot.prototype=Ue.prototype,ot}return ke}Ge.noConflict=function(){return window.MathQuill=we,Ge};var we=window.MathQuill;window.MathQuill=Ge;function Me(k){k.moveOutOf=function(b){a("controller is defined",this.controller),this.controller.handle("moveOutOf",b)},k.deleteOutOf=function(b){a("controller is defined",this.controller),this.controller.handle("deleteOutOf",b)},k.selectOutOf=function(b){a("controller is defined",this.controller),this.controller.handle("selectOutOf",b)},k.upOutOf=function(){a("controller is defined",this.controller),this.controller.handle("upOutOf")},k.downOutOf=function(){a("controller is defined",this.controller),this.controller.handle("downOutOf")},k.reflow=function(){a("controller is defined",this.controller),this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function $e(k,b){throw k?k="'"+k+"'":k="EOF","Parse Error: "+b+" at "+k}var me=function(){function k(b){this._=b}return k.prototype.parse=function(b){return this.skip(k.eof)._(""+b,g,$e);function g(f,D){return D}},k.prototype.or=function(b){a("or is passed a parser",b instanceof k);var g=this;return new k(function(f,D,V){return g._(f,D,$);function $(te){return b._(f,D,V)}})},k.prototype.then=function(b){var g=this;return new k(function(f,D,V){return g._(f,$,V);function $(te,le){var ke=b instanceof k?b:b(le);return a("a parser is returned",ke instanceof k),ke._(te,D,V)}})},k.prototype.many=function(){var b=this;return new k(function(g,f,D){for(var V=[];b._(g,$,te););return f(g,V);function $(le,ke){return g=le,V.push(ke),!0}function te(){return!1}})},k.prototype.times=function(b,g){arguments.length<2&&(g=b);var f=this;return new k(function(D,V,$){for(var te=[],le=!0,ke,Xe=0;Xe<b;Xe+=1)if(le=!!f._(D,qe,Ue),!le)return $(D,ke);for(;Xe<g&&le;Xe+=1)f._(D,qe,ot);return V(D,te);function qe(nt,_t){return te.push(_t),D=nt,!0}function Ue(nt,_t){return ke=_t,D=nt,!1}function ot(nt,_t){return!1}})},k.prototype.result=function(b){return this.then(k.succeed(b))},k.prototype.atMost=function(b){return this.times(0,b)},k.prototype.atLeast=function(b){var g=this;return g.times(b).then(function(f){return g.many().map(function(D){return f.concat(D)})})},k.prototype.map=function(b){return this.then(function(g){return k.succeed(b(g))})},k.prototype.skip=function(b){return this.then(function(g){return b.result(g)})},k.string=function(b){var g=b.length,f="expected '"+b+"'";return new k(function(D,V,$){var te=D.slice(0,g);return te===b?V(D.slice(g),te):$(D,f)})},k.regex=function(b){a("regexp parser is anchored",b.toString().charAt(1)==="^");var g="expected "+b;return new k(function(f,D,V){var $=b.exec(f);if($){var te=$[0];return D(f.slice(te.length),te)}else return V(f,g)})},k.succeed=function(b){return new k(function(g,f){return f(g,b)})},k.fail=function(b){return new k(function(g,f,D){return D(g,b)})},k.letter=k.regex(/^[a-z]/i),k.letters=k.regex(/^[a-z]*/i),k.digit=k.regex(/^[0-9]/),k.digits=k.regex(/^[0-9]*/),k.whitespace=k.regex(/^\s+/),k.optWhitespace=k.regex(/^\s*/),k.any=new k(function(b,g,f){return b?g(b.slice(1),b.charAt(0)):f(b,"expected any character")}),k.all=new k(function(b,g,f){return g("",b)}),k.eof=new k(function(b,g,f){return b?f(b,"expected EOF"):g(b,b)}),k}(),rt=function(){function k(){this.fn=i}return k.prototype.listen=function(b){this.fn=b,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.fn)},k.prototype.listenOnce=function(b){var g=this;this.listen(function(){for(var f=[],D=0;D<arguments.length;D++)f[D]=arguments[D];g.clearListener(),b.apply(void 0,f)})},k.prototype.clearListener=function(){this.fn=i,clearTimeout(this.timeoutId)},k.prototype.trigger=function(){for(var b=[],g=0;g<arguments.length;g++)b[g]=arguments[g];this.fn.apply(this,b)},k}(),vt=function(){var k={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},b={ArrowRight:"Right",ArrowLeft:"Left",ArrowDown:"Down",ArrowUp:"Up",Delete:"Del",Escape:"Esc"," ":"Spacebar"};function g($){switch(D($)){case"Right":case"Left":case"Down":case"Up":return!0}return!1}function f($){return $.length===1&&$>="a"&&$<="z"}function D($){var te;if($.key===void 0){var le=$.which||$.keyCode;return k[le]||String.fromCharCode(le)}return f($.key)?$.key.toUpperCase():(te=b[$.key])!==null&&te!==void 0?te:$.key}function V($){var te=D($),le=[];return $.ctrlKey&&le.push("Ctrl"),$.metaKey&&le.push("Meta"),$.altKey&&le.push("Alt"),$.shiftKey&&le.push("Shift"),le.length?(te!=="Alt"&&te!=="Control"&&te!=="Meta"&&te!=="Shift"&&le.push(te),le.join("-")):te}return function(te,le){var ke=null,Xe=null,qe=new rt;function Ue(){try{te instanceof HTMLTextAreaElement&&te.select()}catch(Pe){}}function ot(Pe){qe.trigger(),qe.clearListener(),te instanceof HTMLTextAreaElement&&(te.value=Pe),Pe&&Ue(),nt=!!Pe}var nt=!1;function _t(){return!("selectionStart"in te)||!(te instanceof HTMLTextAreaElement)?!1:te.selectionStart!==te.selectionEnd}function Lt(){le.options&&le.options.overrideKeystroke?le.options.overrideKeystroke(V(ke),ke):le.keystroke(V(ke),ke)}function Mt(Pe){qe.trigger(Pe),Pe.target===te&&(ke=Pe,Xe=null,nt&&qe.listenOnce(function(Ve){Ve&&Ve.type==="focusout"||Ue()}),Lt())}function M(Pe){qe.trigger(Pe),Pe.target===te&&(ke&&Xe&&Lt(),Xe=Pe,g(Pe)?qe.listenOnce(K):qe.listen(H))}function B(Pe){qe.trigger(Pe),Pe.target===te&&ke&&!Xe&&(g(Pe)?qe.listenOnce(K):qe.listen(H))}function H(){if(!_t()&&te instanceof HTMLTextAreaElement){var Pe=te.value;ke&&(ke.key==="Unidentified"||!ke.altKey&&ke.ctrlKey&&!ke.metaKey&&ke.shiftKey&&(ke.key==="U"||ke.key==="Process"))||(Pe.length===1?(te.value="",le.options&&le.options.overrideTypedText?le.options.overrideTypedText(Pe):le.typedText(Pe)):K())}}function K(){te instanceof HTMLTextAreaElement&&te.value.length>1&&Ue()}function ie(){ke=null,Xe=null,qe.clearListener(),te instanceof HTMLTextAreaElement&&(te.value="")}function ve(Pe){qe.trigger(),Pe.target===te&&(document.activeElement!==te&&te.focus(),qe.listen(function(){if(te instanceof HTMLTextAreaElement){var lt=te.value;te.value="",lt&&le.paste(lt)}}))}function Ee(Pe){qe.trigger(Pe)}return le.KIND_OF_MQ==="StaticMath"?(le.addTextareaEventListeners({keydown:function(Pe){var Ve,lt;(lt=(Ve=le.options).overrideKeystroke)===null||lt===void 0||lt.call(Ve,V(Pe),Pe)}}),{select:ot}):(le.options&&le.options.disableCopyPaste?le.addTextareaEventListeners({keydown:Mt,keypress:M,keyup:B,focusout:ie,copy:function(Pe){Pe.preventDefault()},cut:function(Pe){Pe.preventDefault()},paste:function(Pe){qe.trigger(),Pe.preventDefault()},input:Ee}):le.addTextareaEventListeners({keydown:Mt,keypress:M,keyup:B,focusout:ie,cut:function(){qe.listenOnce(function(){le.cut()})},copy:function(){qe.listenOnce(function(){le.copy()})},paste:ve,input:Ee}),{select:ot})}}(),Re=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.exportText=function(){return this.root.foldChildren("",function(g,f){return g+f.text()})},b}(ne);ne.onNotify(function(k,b){if(b==="edit"||b==="replace"||b===void 0){var g=k.controller;if(!g||!g.options.enableDigitGrouping||g.blurred!==!1)return;g.disableGroupingForSeconds(1)}});var Xt=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.handleTextareaFocusEditable=function(){var f=g.cursor;g.updateMathspeak(),g.blurred=!1,clearTimeout(g.blurTimeout),P(g.container).addClass("dcg-mq-focused"),f.parent||f.insAtRightEnd(g.root),f.selection?(f.selection.domFrag().removeClass("dcg-mq-blur"),g.selectionChanged()):f.show(),g.setOverflowClasses()},g.handleTextareaBlurEditable=function(){g.textareaSelectionTimeout&&(clearTimeout(g.textareaSelectionTimeout),g.textareaSelectionTimeout=0),g.disableGroupingForSeconds(0),g.blurred=!0,g.blurTimeout=setTimeout(function(){g.root.postOrder(function(f){f.intentionalBlur()}),g.cursor.clearSelection().endSelection(),g.blur(),g.updateMathspeak({emptyContent:!0}),g.scrollHoriz()}),window.addEventListener("blur",g.handleWindowBlur)},g.handleTextareaFocusStatic=function(){g.cursor.selection||g.cursor.controller.selectAll(),g.blurred=!1},g.handleTextareaBlurStatic=function(){g.cursor.clearSelection(),g.updateMathspeak({emptyContent:!0})},g.handleWindowBlur=function(){clearTimeout(g.blurTimeout),g.cursor.selection&&g.cursor.selection.domFrag().addClass("dcg-mq-blur"),g.blurWithoutResettingCursor(),g.updateMathspeak({emptyContent:!0})},g}return b.prototype.disableGroupingForSeconds=function(g){var f=this;clearTimeout(this.__disableGroupingTimeout),g===0?this.root.domFrag().removeClass("dcg-mq-suppress-grouping"):(this.root.domFrag().addClass("dcg-mq-suppress-grouping"),this.__disableGroupingTimeout=setTimeout(function(){f.root.domFrag().removeClass("dcg-mq-suppress-grouping")},g*1e3))},b.prototype.blur=function(){this.blurWithoutResettingCursor(),this.options&&this.options.resetCursorOnBlur&&this.cursor.resetToEnd(this)},b.prototype.blurWithoutResettingCursor=function(){this.cursor.hide().parent.blur(this.cursor),P(this.container).removeClass("dcg-mq-focused"),window.removeEventListener("blur",this.handleWindowBlur)},b.prototype.addEditableFocusBlurListeners=function(){var g=this,f=g.cursor;this.addTextareaEventListeners({focus:this.handleTextareaFocusEditable,blur:this.handleTextareaBlurEditable}),g.blurred=!0,f.hide().parent.blur(f)},b.prototype.addStaticFocusBlurListeners=function(){this.addTextareaEventListeners({focus:this.handleTextareaFocusStatic,blur:this.handleTextareaBlurStatic})},b}(Re),Ft=!1,Nt=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.keystroke=function(g,f,D){var V=D.cursor;switch(g){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":D.ctrlDeleteDir(r);break;case"Shift-Backspace":case"Backspace":D.backspace();break;case"Esc":case"Tab":D.escapeDir(e,g,f);return;case"Shift-Tab":case"Shift-Esc":D.escapeDir(r,g,f);return;case"End":D.notify("move").cursor.insAtRightEnd(V.parent),D.aria.queue("end of").queue(V.parent,!0);break;case"Ctrl-End":D.notify("move").cursor.insAtRightEnd(D.root),D.aria.queue("end of").queue(D.ariaLabel).queue(D.root).queue(D.ariaPostLabel);break;case"Shift-End":D.selectToBlockEndInDir(e);break;case"Ctrl-Shift-End":D.selectToRootEndInDir(e);break;case"Home":D.notify("move").cursor.insAtLeftEnd(V.parent),D.aria.queue("beginning of").queue(V.parent,!0);break;case"Ctrl-Home":D.notify("move").cursor.insAtLeftEnd(D.root),D.aria.queue("beginning of").queue(D.ariaLabel).queue(D.root).queue(D.ariaPostLabel);break;case"Shift-Home":D.selectToBlockEndInDir(r);break;case"Ctrl-Shift-Home":D.selectToRootEndInDir(r);break;case"Left":D.moveLeft();break;case"Shift-Left":D.selectLeft();break;case"Ctrl-Left":break;case"Right":D.moveRight();break;case"Shift-Right":D.selectRight();break;case"Ctrl-Right":break;case"Up":D.moveUp();break;case"Down":D.moveDown();break;case"Shift-Up":D.withIncrementalSelection(function($){if(V[r])for(;V[r];)$(r);else $(r)});break;case"Shift-Down":D.withIncrementalSelection(function($){if(V[e])for(;V[e];)$(e);else $(e)});break;case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":D.ctrlDeleteDir(e);break;case"Shift-Del":case"Del":D.deleteForward();break;case"Meta-A":case"Ctrl-A":D.selectAll();break;case"Ctrl-Alt-Up":V.parent.parent&&V.parent.parent instanceof b?D.aria.queue(V.parent.parent):D.aria.queue("nothing above");break;case"Ctrl-Alt-Down":V.parent&&V.parent instanceof b?D.aria.queue(V.parent):D.aria.queue("block is empty");break;case"Ctrl-Alt-Left":V.parent.parent&&V.parent.parent.getEnd(r)?D.aria.queue(V.parent.parent.getEnd(r)):D.aria.queue("nothing to the left");break;case"Ctrl-Alt-Right":V.parent.parent&&V.parent.parent.getEnd(e)?D.aria.queue(V.parent.parent.getEnd(e)):D.aria.queue("nothing to the right");break;case"Ctrl-Alt-Shift-Down":V.selection?D.aria.queue(V.selection.join("mathspeak"," ").trim()+" selected"):D.aria.queue("nothing selected");break;case"Ctrl-Alt-=":case"Ctrl-Alt-Shift-Right":D.ariaPostLabel.length?D.aria.queue(D.ariaPostLabel):D.aria.queue("no answer");break;default:return}D.aria.alert(),f==null||f.preventDefault(),D.scrollHoriz()},b.prototype.moveOutOf=function(g,f,D){a("overridden or never called on this node",!1)},b.prototype.moveTowards=function(g,f,D){a("overridden or never called on this node",!1)},b.prototype.deleteOutOf=function(g,f){a("overridden or never called on this node",!1)},b.prototype.deleteTowards=function(g,f){a("overridden or never called on this node",!1)},b.prototype.unselectInto=function(g,f){a("overridden or never called on this node",!1)},b.prototype.selectOutOf=function(g,f){a("overridden or never called on this node",!1)},b.prototype.selectTowards=function(g,f){a("overridden or never called on this node",!1)},b}(R);ne.onNotify(function(k,b){(b==="move"||b==="upDown")&&k.show().clearSelection()}),Y.leftRightIntoCmdGoes=function(k){if(k&&k!=="up"&&k!=="down")throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+k+'"';return k},ne.onNotify(function(k,b){b!=="upDown"&&(k.upDownCache={})}),ne.onNotify(function(k,b){b==="edit"&&k.show().deleteSelection()}),ne.onNotify(function(k,b){b!=="select"&&k.endSelection()});var Br=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.keystroke=function(g,f){this.cursor.parent.keystroke(g,f,this.getControllerSelf())},b.prototype.escapeDir=function(g,f,D){s(g);var V=this.cursor;if(V.parent!==this.root&&(D==null||D.preventDefault()),V.parent!==this.root)return V.clearSelection(),V.parent.moveOutOf(g,V),V.controller.aria.alert(),this.notify("move")},b.prototype.moveDir=function(g){s(g);var f=this.cursor,D=f.options.leftRightIntoCmdGoes,V=f[g];return f.selection?f.insDirOf(g,f.selection.getEnd(g)):V?V.moveTowards(g,f,D):f.parent.moveOutOf(g,f,D),this.notify("move")},b.prototype.moveLeft=function(){return this.moveDir(r)},b.prototype.moveRight=function(){return this.moveDir(e)},b.prototype.moveUp=function(){return this.moveUpDown("up")},b.prototype.moveDown=function(){return this.moveUpDown("down")},b.prototype.moveUpDown=function(g){var f=this,D=f.notify("upDown").cursor,V,$;g==="up"?(V="upInto",$="upOutOf"):(V="downInto",$="downOutOf");var te=D[r],le=D[e],ke=le&&le[V],Xe=te&&te[V];return ke?D.insAtLeftEnd(ke):Xe?D.insAtRightEnd(Xe):D.parent.bubble(function(qe){var Ue=qe[$];if(Ue&&(typeof Ue=="function"&&(Ue=Ue.call(qe,D)),Ue instanceof Nt&&D.jumpUpDown(qe,Ue),Ue!==!0))return!1}),f},b.prototype.deleteDir=function(g){s(g);var f=this.cursor,D=f[g],V=f.parent.parent,$=f.controller;if(D&&D instanceof Nt)D.sides?$.aria.queue(D.parent.chToCmd(D.sides[-g].ch).mathspeak({createdLeftOf:f})):!D.blocks&&D.parent.ctrlSeq!=="\\text"&&$.aria.queue(D);else if(V&&V instanceof Nt)if(V.sides)$.aria.queue(V.parent.chToCmd(V.sides[g].ch).mathspeak({createdLeftOf:f}));else if(V.blocks&&V.mathspeakTemplate)if(V.upInto&&V.downInto)$.aria.queue(V.mathspeakTemplate[1]);else{var te=V.mathspeakTemplate,le=g===r?te[0]:te[te.length-1];$.aria.queue(le)}else $.aria.queue(V);var ke=f.selection;if(this.notify("edit"),!ke){var Xe=f[g];Xe?Xe.deleteTowards(g,f):f.parent.deleteOutOf(g,f)}var qe=f[r],Ue=f[e];return qe.siblingDeleted&&qe.siblingDeleted(f.options,e),Ue.siblingDeleted&&Ue.siblingDeleted(f.options,r),f.parent.bubble(function(ot){ot.reflow()}),this},b.prototype.ctrlDeleteDir=function(g){s(g);var f=this.cursor;if(!f[g]||f.selection)return this.deleteDir(g);this.notify("edit");var D;g===r?D=new z(f.parent.getEnd(r),f[r]):D=new z(f[e],f.parent.getEnd(e)),f.controller.aria.queue(D),D.remove(),f.insAtDirEnd(g,f.parent);var V=f[r],$=f[e];return V&&V.siblingDeleted(f.options,e),$&&$.siblingDeleted(f.options,r),f.parent.bubble(function(te){te.reflow()}),this},b.prototype.backspace=function(){return this.deleteDir(r)},b.prototype.deleteForward=function(){return this.deleteDir(e)},b.prototype.startIncrementalSelection=function(){a("Multiple selections can't be simultaneously open",!Ft),Ft=!0,this.notify("select");var g=this.cursor;g.anticursor||g.startSelection()},b.prototype.selectDirIncremental=function(g){a("A selection is open",Ft),Ft=!0;var f=this.cursor,D=f.selection;s(g);var V=f[g];V?D&&D.getEnd(g)===V&&f.anticursor[-g]!==V?V.unselectInto(g,f):V.selectTowards(g,f):f.parent.selectOutOf(g,f)},b.prototype.finishIncrementalSelection=function(){a("A selection is open",Ft);var g=this.cursor;g.clearSelection(),g.select()||g.show();var f=g.selection;f&&g.controller.aria.clear().queue(f.join("mathspeak"," ").trim()+" selected"),Ft=!1},b.prototype.withIncrementalSelection=function(g){var f=this;try{this.startIncrementalSelection();try{g(function(D){return f.selectDirIncremental(D)})}finally{this.finishIncrementalSelection()}}finally{Ft=!1}},b.prototype.selectDir=function(g){this.withIncrementalSelection(function(f){return f(g)})},b.prototype.selectLeft=function(){return this.selectDir(r)},b.prototype.selectRight=function(){return this.selectDir(e)},b.prototype.selectAll=function(){this.notify("move");var g=this.cursor;g.insAtRightEnd(this.root),this.withIncrementalSelection(function(f){for(;g[r];)f(r)})},b.prototype.selectToBlockEndInDir=function(g){var f=this.cursor;this.withIncrementalSelection(function(D){for(;f[g];)D(g)})},b.prototype.selectToRootEndInDir=function(g){var f=this,D=this.cursor;this.withIncrementalSelection(function(V){for(;D[g]||D.parent!==f.root;)V(g)})},b}(Xt),de=function(k){Pt(b,k);function b(g){return k.call(this)||this}return b}(Nt),se=function(){function k(H){var K=new Fe;return H.adopt(K,0,0),K}function b(H){for(var K=H[0]||new Fe,ie=1;ie<H.length;ie+=1)H[ie].children().adopt(K,K.getEnd(e),0);return K}var g=me.string,f=me.regex,D=me.letter,V=me.digit,$=me.any,te=me.optWhitespace,le=me.succeed,ke=me.fail,Xe=D.map(function(H){return new _r(H)}),qe=V.map(function(H){return new rr(H)}),Ue=f(/^[^${}\\_^]/).map(function(H){return new _e(H)}),ot=f(/^[^\\a-eg-zA-Z]/).or(g("\\").then(f(/^[a-z]+/i).or(f(/^\s+/).result(" ")).or($))).then(function(H){var K=A[H];if(K)if(K.constructor){var ie=K;return new ie(H).parser()}else{var ve=K;return ve(H).parser()}else return ke("unknown command: \\"+H)}),nt=ot.or(Xe).or(qe).or(Ue),_t=g("{").then(function(){return Mt}).skip(g("}")),Lt=te.then(_t.or(nt.map(k))),Mt=Lt.many().map(b).skip(te),M=g("[").then(Lt.then(function(H){return H.join("latex")!=="]"?le(H):ke("")}).many().map(b).skip(te)).skip(g("]")),B=Mt;return B.block=Lt,B.optBlock=M,B}();Y.maxDepth=function(k){return typeof k=="number"?k:void 0};var He=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.cleanLatex=function(g){return g.replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},b.prototype.exportLatex=function(){return this.cleanLatex(this.root.latex())},b.prototype.writeLatex=function(g){var f=this.notify("edit").cursor;return f.parent.writeLatex(f,g),this},b.prototype.exportLatexSelection=function(){var g={latex:"",startIndex:-1,endIndex:-1},f=this.cursor.selection;if(f)g.startSelectionBefore=f.getEnd(r),g.endSelectionAfter=f.getEnd(e);else{var D=this.cursor[r];D?g.startSelectionAfter=D:g.startSelectionBefore=this.cursor.parent;var V=this.cursor[e];V?g.endSelectionBefore=V:g.endSelectionAfter=this.cursor.parent}this.root.latexRecursive(g);for(var $=g.latex,te=this.cleanLatex($),le=g.startIndex,ke=g.endIndex,Xe=0,qe=0;qe<g.endIndex;qe++)$[qe]!==te[Xe]?(qe<g.startIndex&&(le-=1),ke-=1):Xe+=1;return{latex:te,startIndex:le,endIndex:ke}},b.prototype.classifyLatexForEfficientUpdate=function(g){if(typeof g=="string"){var f=g.match(/-?[0-9.]+$/g);if(f&&f.length===1)return{latex:g,prefix:g.substr(0,g.length-f[0].length),digits:f[0]}}},b.prototype.updateLatexMathEfficiently=function(g,f){var D,V,$,te,le=this.root,ke,Xe=this.classifyLatexForEfficientUpdate(g);if(Xe){if(ke=this.classifyLatexForEfficientUpdate(f),!ke||ke.prefix!==Xe.prefix)return!1}else return!1;var qe=ke.digits,Ue=Xe.digits,ot=!1,nt=!1;qe[0]==="-"&&(ot=!0,qe=qe.substr(1)),Ue[0]==="-"&&(nt=!0,Ue=Ue.substr(1));for(var _t=this.root.getEnd(e),Lt=[],Mt=qe.length-1;Mt>=0;Mt--){if(!_t||_t.ctrlSeq!==qe[Mt]||_t.parent!==le)return!1;Lt.unshift(_t),_t=_t[r]}if(ot&&!nt){var M=_t;if(!M||M.ctrlSeq!=="-"||M[e]!==Lt[0]||M.parent!==le)return!1;var B=M[r];if(B&&B.parent!==le)return!1;Lt[0][r]=M[r],le.getEnd(r)===M&&le.setEnds((D={},D[r]=Lt[0],D[e]=le.getEnd(e),D)),B&&(B[e]=Lt[0]),M.domFrag().remove()}if(!ot&&nt){var H=new Ps("-"),K=document.createElement("span");K.textContent="-",H.setDOM(K);var ie=Lt[0][r];ie&&(ie[e]=H),le.getEnd(r)===Lt[0]&&le.setEnds((V={},V[r]=H,V[e]=le.getEnd(e),V)),H.parent=le,H[r]=Lt[0][r],H[e]=Lt[0],Lt[0][r]=H,H.contactWeld(this.cursor),H.domFrag().insertBefore(Lt[0].domFrag())}var ve=Math.min(qe.length,Ue.length);for(Mt=0;Mt<ve;Mt++){var Ee=Ue[Mt];_t=Lt[Mt],_t.ctrlSeq!==Ee&&(_t.ctrlSeq=Ee,_t.domFrag().oneElement().textContent=Ee,_t.mathspeakName=Ee)}if(qe.length>Ue.length)for(_t=Lt[Ue.length-1],le.setEnds(($={},$[r]=le.getEnd(r),$[e]=_t,$)),_t[e]=0,Mt=qe.length-1;Mt>=ve;Mt--)Lt[Mt].domFrag().remove();if(Ue.length>qe.length){var Pe=document.createDocumentFragment();for(Mt=ve;Mt<Ue.length;Mt++){var Ve=document.createElement("span");Ve.className="dcg-mq-digit",Ve.textContent=Ue[Mt];var lt=new rr(Ue[Mt]);lt.parent=le,lt.setDOM(Ve),Pe.appendChild(Ve),lt[r]=le.getEnd(e),lt[e]=0;var Tt=lt[r];Tt[e]=lt,le.setEnds((te={},te[r]=le.getEnd(r),te[e]=lt,te))}le.domFrag().oneElement().appendChild(Pe)}var gr=this.exportLatex();if(gr!==g)return console.warn("tried updating latex efficiently but did not work. Attempted: "+g+" but wrote: "+gr),!1;var wt=le.getEnd(e);return wt&&wt.fixDigitGrouping(this.cursor.options),!0},b.prototype.renderLatexMathFromScratch=function(g){var f,D=this.root,V=this.cursor,$=me.all,te=me.eof,le=se.skip(te).or($.result(!1)).parse(g);if(D.setEnds((f={},f[r]=0,f[e]=0,f)),le&&le.children().adopt(D,0,0),le){var ke=D.domFrag();ke.children().remove(),ke.oneElement().appendChild(le.html()),D.finalizeInsert(V.options,V)}else D.domFrag().empty()},b.prototype.renderLatexMath=function(g){var f=this.cursor,D=this.root;this.notify("replace"),f.clearSelection();var V=this.exportLatex();(!D.getEnd(r)||!D.getEnd(e)||V!==g)&&(this.updateLatexMathEfficiently(g,V)||this.renderLatexMathFromScratch(g),this.updateMathspeak()),f.insAtRightEnd(D)},b.prototype.renderLatexText=function(g){var f,D=this.root,V=this.cursor;D.domFrag().children().slice(1).remove(),D.setEnds((f={},f[r]=0,f[e]=0,f)),delete V.selection,V.show().insAtRightEnd(D);var $=me.regex,te=me.string,le=me.eof,ke=me.all,Xe=te("$").then(se).skip(te("$").or(le)).map(function(Lt){var Mt=new RootMathCommand(V);Mt.createBlocks();var M=Mt.getEnd(r);return Lt.children().adopt(M,0,0),Mt}),qe=te("\\$").result("$"),Ue=qe.or($(/^[^$]/)).map(function(Lt){return new _e(Lt)}),ot=Xe.or(Ue).many(),nt=ot.skip(le).or(ke.result(!1)).parse(g);if(nt){for(var _t=0;_t<nt.length;_t+=1)nt[_t].adopt(D,D.getEnd(e),0);P(D.html()).appendTo(D.domFrag().oneElement()),D.finalizeInsert(V.options,V)}},b}(Br),xe=function(k){return!1};fe.prototype.ignoreNextMousedown=xe;var at;(function(){ne.onNotify(function(k,b){(b==="edit"||b==="replace")&&at&&at.cursor===k&&at.cb()})})();var We=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.handleMouseDown=function(f){var D=d(f.target,".dcg-mq-root-block"),V=D&&R.getNodeOfElement(D)||R.getNodeOfElement(g.root.domFrag().oneElement()),$=V.domFrag().firstNode().ownerDocument,te=V.controller,le=te.cursor,ke=le.blink,Xe=te.getTextarea();if(f.preventDefault(),f.target.unselectable=!0,le.options.ignoreNextMousedown(f)||d(f.target,".dcg-mq-ignore-mousedown"))return;var qe=null;function Ue(M){qe=M.target}function ot(M){le.anticursor||le.startSelection(),te.seek(qe,M.clientX,M.clientY).cursor.select(),le.selection&&le.controller.aria.clear().queue(le.selection.join("mathspeak")+" selected").alert(),qe=null}function nt(){D==null||D.removeEventListener("mousemove",Ue),$==null||$.removeEventListener("mousemove",ot),$==null||$.removeEventListener("mouseup",Lt),at=void 0}function _t(){te.editable&&(le.show(),le.controller.aria.queue(le.parent).alert())}function Lt(){le.blink=ke,le.selection||_t(),nt()}var Mt;at={cursor:le,cb:function(){Mt=!0,le.blink=ke,le.clearSelection(),_t(),nt()}},!(te.blurred&&(Xe.focus(),Mt))&&(le.blink=i,te.seek(f.target,f.clientX,f.clientY).cursor.startSelection(),D==null||D.addEventListener("mousemove",Ue),$==null||$.addEventListener("mousemove",ot),$==null||$.addEventListener("mouseup",Lt))},g}return b.prototype.addMouseEventListener=function(){this.container.addEventListener("mousedown",this.handleMouseDown)},b.prototype.removeMouseEventListener=function(){this.container.removeEventListener("mousedown",this.handleMouseDown)},b.prototype.seek=function(g,f,D){for(var V=this.notify("select").cursor,$;g&&($=R.getNodeOfElement(g),!$);)g=g.parentElement;return $||($=this.root),V.clearSelection().show(),$.seek(f,V),this.scrollHoriz(),this},b}(He),to=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.setOverflowClasses=function(){var g=this.root.domFrag().oneElement(),f=!1,D=!1;if(!this.blurred){var V=C(g).width,$=g.scrollWidth,te=g.scrollLeft;f=$>V+te,D=te>0}g.classList.contains("dcg-mq-editing-overflow-right")!==f&&g.classList.toggle("dcg-mq-editing-overflow-right"),g.classList.contains("dcg-mq-editing-overflow-left")!==D&&g.classList.toggle("dcg-mq-editing-overflow-left")},b.prototype.scrollHoriz=function(){var g=this,f=this.cursor,D=f.selection,V=C(this.root.domFrag().oneElement());if(f.domFrag().isEmpty()&&!D){this.cancelScrollHoriz&&(this.cancelScrollHoriz(),this.cancelScrollHoriz=void 0);var $=this.root.domFrag().oneElement(),te=$.scrollLeft;_(this.getScrollAnimationDuration(),function(Lt,Mt,M){Lt>=1?(g.cancelScrollHoriz=void 0,$.scrollLeft=0,g.setOverflowClasses()):(g.cancelScrollHoriz=M,Mt(),$.scrollLeft=Math.round((1-Lt)*te))});return}else if(D){var Xe=C(D.domFrag().oneElement()),qe=Xe.left-(V.left+20),Ue=Xe.right-(V.right-20);if(D.getEnd(r)===f[e])if(qe<0)var ke=qe;else if(Ue>0)if(Xe.left-Ue<V.left+20)var ke=qe;else var ke=Ue;else return;else if(Ue>0)var ke=Ue;else if(qe<0)if(Xe.right-qe>V.right-20)var ke=Ue;else var ke=qe;else return}else{var le=C(f.domFrag().oneElement()).left;if(le>V.right-20)var ke=le-(V.right-20);else if(le<V.left+20)var ke=le-(V.left+20);else return}var ot=this.root.domFrag().oneElement();if(!(ke<0&&ot.scrollLeft===0)&&!(ke>0&&ot.scrollWidth<=ot.scrollLeft+V.width)){this.cancelScrollHoriz&&(this.cancelScrollHoriz(),this.cancelScrollHoriz=void 0);var nt=this.root.domFrag().oneElement(),_t=nt.scrollLeft;_(this.getScrollAnimationDuration(),function(Lt,Mt,M){Lt>=1?(g.cancelScrollHoriz=void 0,nt.scrollLeft=Math.round(_t+ke),g.setOverflowClasses()):(g.cancelScrollHoriz=M,Mt(),nt.scrollLeft=Math.round(_t+Lt*ke))})}},b.prototype.getScrollAnimationDuration=function(){var g;return(g=this.options.scrollAnimationDuration)!==null&&g!==void 0?g:100},b}(We);fe.prototype.substituteTextarea=function(k){return c("textarea",{autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:!1,"x-palm-disable-ste-all":!0,tabindex:k?void 0:"-1"})};function Dt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(k){var b=Math.random()*16|0,g=k==="x"?b:b&3|8;return g.toString(16)})}function sa(k,b){return vt(k[0],b)}fe.prototype.substituteKeyboardEvents=sa;var No=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.selectFn=i,g}return b.prototype.createTextarea=function(){this.textareaSpan=c("span",{class:"dcg-mq-textarea"});var g=this.options.tabbable!==void 0?this.options.tabbable:this.KIND_OF_MQ!=="StaticMath",f=this.options.substituteTextarea(g);if(!f.nodeType)throw"substituteTextarea() must return a DOM element, got "+f;!this.options.tabbable&&this.KIND_OF_MQ==="StaticMath"&&f.setAttribute("aria-hidden","true"),this.textarea=P(f).appendTo(this.textareaSpan).oneElement(),this.mathspeakSpan||(this.mathspeakId=Dt(),this.mathspeakSpan=c("span",{class:"dcg-mq-mathspeak",id:this.mathspeakId}),P(this.textareaSpan).prepend(P(this.mathspeakSpan))),this.mathspeakId&&(f==null||f.setAttribute("aria-labelledby",this.mathspeakId)),g&&this.mathspeakSpan&&this.mathspeakSpan.setAttribute("aria-hidden","true");var D=this;D.cursor.selectionChanged=function(){D.selectionChanged()}},b.prototype.selectionChanged=function(){var g=this;g.textareaSelectionTimeout||(g.textareaSelectionTimeout=setTimeout(function(){g.setTextareaSelection()}))},b.prototype.setTextareaSelection=function(){this.textareaSelectionTimeout=0;var g="";this.cursor.selection&&(g=this.cleanLatex(this.cursor.selection.join("latex")),this.options.statelessClipboard&&(g="$"+g+"$")),this.selectFn(g)},b.prototype.staticMathTextareaEvents=function(){var g=this;this.removeTextareaEventListener("cut"),this.removeTextareaEventListener("paste"),g.options.disableCopyPaste?this.removeTextareaEventListener("copy"):this.addTextareaEventListeners({copy:function(){g.setTextareaSelection()}}),this.addStaticFocusBlurListeners();var f=this.getTextarea(),D=vt(f,this).select;this.selectFn=D;var V=this.getTextareaSpan();P(this.container).prepend(P(V))},b.prototype.editablesTextareaEvents=function(){var g=this,f=g.getTextarea(),D=g.getTextareaSpan();if(this.options.version<3){var V=this.options.assertJquery(),$=this.options.substituteKeyboardEvents(V(f),this);this.selectFn=function(le){$.select(le)}}else{var te=vt(f,this).select;this.selectFn=te}P(this.container).prepend(P(D)),this.addEditableFocusBlurListeners(),this.updateMathspeak()},b.prototype.unbindEditablesEvents=function(){var g=this,f=g.getTextarea(),D=g.getTextareaSpan();this.selectFn=function(V){f instanceof HTMLTextAreaElement&&(f.value=V,V&&f.select())},P(D).remove(),this.removeTextareaEventListener("focus"),this.removeTextareaEventListener("blur"),g.blurred=!0,this.removeTextareaEventListener("cut"),this.removeTextareaEventListener("paste")},b.prototype.typedText=function(g){if(g===`
`)return this.handle("enter");var f=this.notify(void 0).cursor;f.parent.write(f,g),this.scrollHoriz()},b.prototype.cut=function(){var g=this,f=g.cursor;f.selection&&setTimeout(function(){g.notify("edit"),f.parent.bubble(function(D){D.reflow()}),g.options&&g.options.onCut&&g.options.onCut()})},b.prototype.copy=function(){this.setTextareaSelection()},b.prototype.paste=function(g){this.options.statelessClipboard&&(g.slice(0,1)==="$"&&g.slice(-1)==="$"?g=g.slice(1,-1):g="\\text{"+g+"}"),this.writeLatex(g).cursor.show(),this.scrollHoriz(),this.options&&this.options.onPaste&&this.options.onPaste()},b.prototype.setupStaticField=function(){this.updateMathspeak(),this.blurred=!0,this.cursor.hide().parent.blur(this.cursor)},b.prototype.updateMathspeak=function(g){var f=this,D=f.getAriaLabel(),V=/[A-Za-z0-9]$/.test(D)?D+":":D,$=f.root.mathspeak().trim(),te=!!(g!=null&&g.emptyContent);this.aria.clear({emptyContent:te}),f.mathspeakSpan&&(f.mathspeakSpan.textContent=(V+" "+$+" "+f.ariaPostLabel).trim())},b}(to),bi=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.finalizeInsert=function(g,f){var D=this;D.postOrder(function(te){te.finalizeTree(g)}),D.postOrder(function(te){te.contactWeld(f)}),D.postOrder(function(te){te.blur(f)}),D.postOrder(function(te){te.reflow()});var V=D[e],$=D[r];V&&V.siblingCreated(g,r),$&&$.siblingCreated(g,e),D.bubble(function(te){te.reflow()})},b.prototype.prepareInsertionAt=function(g){var f=g.options.maxDepth;if(f!==void 0){var D=g.depth();if(D>f)return!1;this.removeNodesDeeperThan(f-D)}return!0},b.prototype.removeNodesDeeperThan=function(g){for(var f=0,D=[[this,f]],V;V=D.shift();){var $=V;$[0].children().each(function(te){var le=te instanceof Fe?1:0;f=$[1]+le,f<=g?D.push([te,f]):(le?te.children():te).remove()})}},b}(Nt),tt=function(){function k(b,g){this.childCount=b,this.render=g}return k}(),St=function(k){Pt(b,k);function b(g,f,D){var V=k.call(this)||this;return V.textTemplate=[""],V.mathspeakTemplate=[""],V.setCtrlSeqHtmlAndText(g,f,D),V}return b.prototype.setEnds=function(g){a("MathCommand ends are never empty",g[r]&&g[e]),this.ends=g},b.prototype.getEnd=function(g){return this.ends[g]},b.prototype.setCtrlSeqHtmlAndText=function(g,f,D){this.ctrlSeq||(this.ctrlSeq=g),f&&(this.domView=f),D&&(this.textTemplate=D)},b.prototype.replaces=function(g){g.disown(),this.replacedFragment=g},b.prototype.isEmpty=function(){return this.foldChildren(!0,function(g,f){return g&&f.isEmpty()})},b.prototype.parser=function(){var g=this,f=se.block;return f.times(this.numBlocks()).map(function(D){g.blocks=D;for(var V=0;V<D.length;V+=1)D[V].adopt(g,g.getEnd(e),0);return g})},b.prototype.createLeftOf=function(g){var f=this,D=f.replacedFragment;if(f.createBlocks(),k.prototype.createLeftOf.call(this,g),D){var V=f.getEnd(r);D.adopt(V,0,0),D.domFrag().appendTo(V.domFrag().oneElement()),f.placeCursor(g),f.prepareInsertionAt(g)}f.finalizeInsert(g.options,g),f.placeCursor(g)},b.prototype.createBlocks=function(){for(var g=this,f=g.numBlocks(),D=g.blocks=Array(f),V=0;V<f;V+=1){var $=D[V]=new Fe;$.adopt(g,g.getEnd(e),0)}},b.prototype.placeCursor=function(g){g.insAtRightEnd(this.foldChildren(this.getEnd(r),function(f,D){return f.isEmpty()?f:D}))},b.prototype.moveTowards=function(g,f,D){var V;D==="up"?V=this.upInto:D==="down"&&(V=this.downInto);var $=V||this.getEnd(-g);f.insAtDirEnd(-g,$),f.controller.aria.queueDirEndOf(-g).queue(f.parent,!0)},b.prototype.deleteTowards=function(g,f){this.isEmpty()?f[g]=this.remove()[g]:this.moveTowards(g,f)},b.prototype.selectTowards=function(g,f){f[-g]=this,f[g]=this[g]},b.prototype.selectChildren=function(){return new ge(this,this)},b.prototype.unselectInto=function(g,f){var D=f.anticursor,V=D.ancestors[this.id];f.insAtDirEnd(-g,V)},b.prototype.seek=function(g,f){function D(le){var ke,Xe=le.domFrag().oneElement(),qe=C(Xe).left,Ue=qe+Xe.offsetWidth;return ke={},ke[r]=qe,ke[e]=Ue,ke}var V=this,$=D(V);if(g<$[r])return f.insLeftOf(V);if(g>$[e])return f.insRightOf(V);var te=$[r];V.eachChild(function(le){var ke=D(le);if(g<ke[r])return g-te<ke[r]-g?le[r]?f.insAtRightEnd(le[r]):f.insLeftOf(V):f.insAtLeftEnd(le),!1;if(g>ke[e]){le[e]?te=ke[e]:$[e]-g<g-ke[e]?f.insRightOf(V):f.insAtRightEnd(le);return}else return le.seek(g,f),!1})},b.prototype.numBlocks=function(){return this.domView.childCount},b.prototype.html=function(){var g=this.blocks;a("domView is defined",this.domView);var f=this.domView,D=f.render(g||[]);return this.setDOM(D),R.linkElementByCmdNode(D,this),D},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+=this.ctrlSeq||"",this.eachChild(function(f){g.latex+="{";var D=g.latex.length;f.latexRecursive(g);var V=g.latex.length;D===V&&(g.latex+=" "),g.latex+="}"}),this.checkCursorContextClose(g)},b.prototype.text=function(){var g=this,f=0;return g.foldChildren(g.textTemplate[f],function(D,V){f+=1;var $=V.text();return D&&g.textTemplate[f]==="("&&$[0]==="("&&$.slice(-1)===")"?D+$.slice(1,-1)+g.textTemplate[f]:D+$+(g.textTemplate[f]||"")})},b.prototype.mathspeak=function(){var g=this,f=0;return g.foldChildren(g.mathspeakTemplate[f]||"Start"+g.ctrlSeq+" ",function(D,V){return f+=1,D+" "+V.mathspeak()+" "+(g.mathspeakTemplate[f]+" "||"End"+g.ctrlSeq+" ")})},b}(bi),Vt=function(k){Pt(b,k);function b(g,f,D,V){var $=k.call(this)||this;return $.setCtrlSeqHtmlTextAndMathspeak(g,f?new tt(0,function(){return f.cloneNode(!0)}):void 0,D,V),$}return b.prototype.setCtrlSeqHtmlTextAndMathspeak=function(g,f,D,V){!D&&g&&(D=g.replace(/^\\/,"")),this.mathspeakName=V||D,k.prototype.setCtrlSeqHtmlAndText.call(this,g,f,[D||""])},b.prototype.parser=function(){return me.succeed(this)},b.prototype.numBlocks=function(){return 0},b.prototype.replaces=function(g){g.remove()},b.prototype.createBlocks=function(){},b.prototype.moveTowards=function(g,f){f.domFrag().insDirOf(g,this.domFrag()),f[-g]=this,f[g]=this[g],f.controller.aria.queue(this)},b.prototype.deleteTowards=function(g,f){f[g]=this.remove()[g]},b.prototype.seek=function(g,f){var D=this.domFrag().oneElement(),V=C(D).left;return g-V<D.offsetWidth/2?f.insLeftOf(this):f.insRightOf(this),f},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+=this.ctrlSeq||"",this.checkCursorContextClose(g)},b.prototype.text=function(){return this.textTemplate.join("")},b.prototype.mathspeak=function(g){return this.mathspeakName||""},b.prototype.placeCursor=function(){},b.prototype.isEmpty=function(){return!0},b}(St),_e=function(k){Pt(b,k);function b(g,f,D){return k.call(this,g,c("span",{},[f||c.text(g)]),void 0,D)||this}return b}(Vt);function ce(k,b,g){return function(){return new _e(k,b?c.entityText(b):void 0,g)}}var Se=function(k){Pt(b,k);function b(g,f,D,V,$){var te=this;return $?te=k.call(this,g,c("span",{},[f||c.text(g||"")]),void 0,V)||this:te=k.call(this,g,c("span",{class:"dcg-mq-binary-operator"},f?[f]:[]),D,V)||this,te}return b.prototype.isBinaryOperator=function(){return!0},b}(Vt);function Qe(k,b,g,f){return function(){return new Se(k,b?c.entityText(b):void 0,g,f)}}var Fe=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ariaLabel="block",g}return b.prototype.join=function(g){return this.foldChildren("",function(f,D){return f+D[g]()})},b.prototype.html=function(){var g=document.createDocumentFragment();return this.eachChild(function(f){var D=f.html();g.appendChild(D)}),g},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),this.eachChild(function(f){return f.latexRecursive(g)}),this.checkCursorContextClose(g)},b.prototype.text=function(){var g=this.getEnd(r),f=this.getEnd(e);return g===f&&g!==0?g.text():this.join("text")},b.prototype.mathspeak=function(){var g="",f={};return this.controller&&(f=this.controller.options.autoOperatorNames),this.foldChildren([],function(D,V){if(V.isPartOfOperator)g+=V.mathspeak();else{if(g!==""){if(f._maxLength>0){var $=f[g.toLowerCase()];typeof $=="string"&&(g=$)}D.push(g+" "),g=""}var te=V.mathspeak(),le=V.ctrlSeq;isNaN(le)&&le!=="."&&(!V.parent||!V.parent.parent||!V.parent.parent.isTextBlock())&&(te=" "+te+" "),D.push(te)}return D}).join("").replace(/ +(?= )/g,"").replace(/(\.)([0-9]+)/g,function(D,V,$){return V+$.split("").join(" ").trim()})},b.prototype.keystroke=function(g,f,D){if(D.options.spaceBehavesLikeTab&&(g==="Spacebar"||g==="Shift-Spacebar")){f==null||f.preventDefault(),D.escapeDir(g==="Shift-Spacebar"?r:e,g,f);return}return k.prototype.keystroke.call(this,g,f,D)},b.prototype.moveOutOf=function(g,f,D){var V;if(D==="up"?V=this.parent.upInto:D==="down"&&(V=this.parent.downInto),!V&&this[g]){var $=-g;f.insAtDirEnd($,this[g]),f.controller.aria.queueDirEndOf($).queue(f.parent,!0)}else f.insDirOf(g,this.parent),f.controller.aria.queueDirOf(g).queue(this.parent)},b.prototype.selectOutOf=function(g,f){f.insDirOf(g,this.parent)},b.prototype.deleteOutOf=function(g,f){f.unwrapGramp()},b.prototype.seek=function(g,f){var D=this.getEnd(e);if(!D)return f.insAtRightEnd(this);var V=D.domFrag().oneElement(),$=C(V).left;if($+V.offsetWidth<g)return f.insAtRightEnd(this);var te=this.getEnd(r);if(g<C(te.domFrag().oneElement()).left)return f.insAtLeftEnd(this);for(;g<C(D.domFrag().oneElement()).left;)D=D[r];return D.seek(g,f)},b.prototype.chToCmd=function(g,f){var D;return g.match(/^[a-eg-zA-Z]$/)?new _r(g):/^\d$/.test(g)?new rr(g):f&&f.typingSlashWritesDivisionSymbol&&g==="/"?A["\xF7"](g):f&&f.typingAsteriskWritesTimesSymbol&&g==="*"?A["\xD7"](g):f&&f.typingPercentWritesPercentOf&&g==="%"?A.percentof(g):(D=U[g]||A[g])?D.constructor?new D(g):D(g):new _e(g)},b.prototype.write=function(g,f){var D=this.chToCmd(f,g.options);g.selection&&D.replaces(g.replaceSelection()),g.isTooDeep()||(D.createLeftOf(g.show()),f==="/"?g.controller.aria.alert("over"):g.controller.aria.alert(D.mathspeak({createdLeftOf:g})))},b.prototype.writeLatex=function(g,f){var D=me.all,V=me.eof,$=se.skip(V).or(D.result(!1)).parse(f);if($&&!$.isEmpty()&&$.prepareInsertionAt(g)){$.children().adopt(g.parent,g[r],g[e]),P($.html()).insertBefore(g.domFrag()),g[r]=$.getEnd(e),$.finalizeInsert(g.options,g);var te=$.getEnd(e),le=$.getEnd(r),ke=te[e],Xe=le[r];ke&&ke.siblingCreated(g.options,r),Xe&&Xe.siblingCreated(g.options,e),g.parent.bubble(function(qe){qe.reflow()})}},b.prototype.focus=function(){return this.domFrag().addClass("dcg-mq-hasCursor"),this.domFrag().removeClass("dcg-mq-empty"),this},b.prototype.blur=function(g){return this.domFrag().removeClass("dcg-mq-hasCursor"),this.isEmpty()&&(this.domFrag().addClass("dcg-mq-empty"),g&&this.isQuietEmptyDelimiter(g.options.quietEmptyDelimiters)&&this.domFrag().addClass("dcg-mq-quiet-delimiter")),this},b}(bi);fe.prototype.mouseEvents=!0,ae.StaticMath=function(k){var b;return b=function(g){Pt(f,g);function f(D){var V=g.call(this,D)||this,$=V.innerFields=[];return V.__controller.root.postOrder(function(te){te.registerInnerField($,k.InnerMathField)}),V}return f.prototype.__mathquillify=function(D,V){return this.config(D),g.prototype.mathquillify.call(this,"dcg-mq-math-mode"),this.__controller.setupStaticField(),this.__options.mouseEvents&&this.__controller.addMouseEventListener(),this.__controller.staticMathTextareaEvents(),this},f.prototype.latex=function(D){var V=g.prototype.latex.apply(this,arguments);if(arguments.length>0){var $=this.innerFields=[];this.__controller.root.postOrder(function(te){te.registerInnerField($,k.InnerMathField)}),this.__controller.updateMathspeak()}return V},f.prototype.setAriaLabel=function(D){return this.__controller.setAriaLabel(D),this},f.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},f}(k.AbstractMathQuill),b.RootBlock=Fe,b};var kt=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b}(Fe);Me(kt.prototype),ae.MathField=function(k){var b;return b=function(g){Pt(f,g);function f(){return g!==null&&g.apply(this,arguments)||this}return f.prototype.__mathquillify=function(D,V){return this.config(D),V>1&&(this.__controller.root.reflow=i),g.prototype.mathquillify.call(this,"dcg-mq-editable-field dcg-mq-math-mode"),delete this.__controller.root.reflow,this},f}(k.EditableField),b.RootBlock=kt,b},ae.InnerMathField=function(k){return a("MathField class is defined",k.MathField),function(b){Pt(g,b);function g(){return b!==null&&b.apply(this,arguments)||this}return g.prototype.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),P(this.__controller.container).removeClass("dcg-mq-editable-field")},g.prototype.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),P(this.__controller.container).addClass("dcg-mq-editable-field")},g}(k.MathField)};var It="\\ ",Kt=".",hr=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.finalizeTree=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.siblingDeleted=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.siblingCreated=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.sharedSiblingMethod=function(g,f){f!==r&&this[e]instanceof b||this.fixDigitGrouping(g)},b.prototype.fixDigitGrouping=function(g){if(g.enableDigitGrouping){var f=this,D=f;do if(/^[0-9]$/.test(D.ctrlSeq))f=D;else if(D.ctrlSeq===It)f=D;else if(D.ctrlSeq===Kt)f=D;else break;while(D=f[r]);b.fixDigitGroupingFromLeft(g,f)}},b.fixDigitGroupingFromLeft=function(g,f){for(;f&&f.ctrlSeq===It;){if(!f[e])return;f=f[e]}if(f instanceof b){var D=f;a("node",D);var V=f,$=0,te=0,le=[];do{if(/^[0-9]$/.test(D.ctrlSeq))V=D,te=0;else if(D.ctrlSeq===It)V=D,$+=1,te=0;else if(D.ctrlSeq===Kt&&D instanceof b)V=D,le.push(D),g.tripleDotsAreEllipsis&&(te+=1);else break;if(te==3)break}while(D=V[e]);if(te===3){var ke=le.pop(),Xe=le.pop(),qe=le.pop();if(ke[e]instanceof b&&b.fixDigitGroupingFromLeft(g,ke[e]),ke.setGroupingClass("dcg-mq-ellipsis-end"),Xe.setGroupingClass("dcg-mq-ellipsis-middle"),qe.setGroupingClass("dcg-mq-ellipsis-start"),V=qe[r],f===qe)return}for(;V!==f&&V&&V.ctrlSeq===It;)V=V[r],$-=1;if(!(f===V&&f&&f.ctrlSeq===It)){var Ue=$>0||le.length>1;Ue?b.removeGroupingBetween(f,V):le[0]?(le[0]!==f&&b.addGroupingBetween(le[0][r],f),le[0]!==V&&b.removeGroupingBetween(le[0],V)):b.addGroupingBetween(V,f)}}},b.removeGroupingBetween=function(g,f){var D=g;do if(D instanceof b&&D.setGroupingClass(void 0),!D||D===f)break;while(D=D[e])},b.addGroupingBetween=function(g,f){for(var te=g,D=0,V=0;te&&(V+=1,a("digit",te instanceof b),te!==f);)te=te[r];var $=V%3;$===0&&($=3);for(var te=g;te;){D+=1;var le=void 0;if(V>=4&&(D===V?le="dcg-mq-group-leading-"+$:D%3===0&&D!==V&&(le="dcg-mq-group-start"),le||(le="dcg-mq-group-other")),te instanceof b&&te.setGroupingClass(le),te===f)break;te=te[r]}},b.prototype.setGroupingClass=function(g){this._groupingClass!==g&&(this._groupingClass&&this.domFrag().removeClass(this._groupingClass),g&&this.domFrag().addClass(g),this._groupingClass=g)},b}(Vt),rr=function(k){Pt(b,k);function b(g,f){return k.call(this,g,c("span",{class:"dcg-mq-digit"},[c.text(g)]),void 0,f)||this}return b.prototype.createLeftOf=function(g){var f=g[r],D=f&&f[r],V=g.parent.parent instanceof lc?g.parent.parent.sub:void 0;g.options.autoSubscriptNumerals&&g.parent!==V&&(f instanceof ir&&f.isItalic!==!1||f instanceof lc&&D instanceof ir&&D.isItalic!==!1)?(new KD().createLeftOf(g),k.prototype.createLeftOf.call(this,g),g.insRightOf(g.parent.parent)):k.prototype.createLeftOf.call(this,g)},b.prototype.mathspeak=function(g){if(g&&g.createdLeftOf){var f=g.createdLeftOf,D=f[r],V=D&&D[r],$=f.parent.parent instanceof lc?f.parent.parent.sub:void 0;if(f.options.autoSubscriptNumerals&&f.parent!==$&&(D instanceof ir&&D.isItalic!==!1||f[r]instanceof lc&&V instanceof ir&&V.isItalic!==!1))return"Subscript "+k.prototype.mathspeak.call(this)+" Baseline"}return k.prototype.mathspeak.call(this)},b}(hr),ir=function(k){Pt(b,k);function b(g,f){return k.call(this,g,c("var",{},[f||c.text(g)]))||this}return b.prototype.text=function(){var g=this.ctrlSeq||"";return this.isPartOfOperator?g[0]=="\\"?g=g.slice(1,g.length):g[g.length-1]==" "&&(g=g.slice(0,-1)):(this[r]&&!(this[r]instanceof b)&&!(this[r]instanceof Se)&&this[r].ctrlSeq!=="\\ "&&(g="*"+g),this[e]&&!(this[e]instanceof Se)&&!(this[e]instanceof lc)&&(g+="*")),g},b.prototype.mathspeak=function(){var g=this.ctrlSeq||"";return this.isPartOfOperator||g.length>1||this.parent&&this.parent.parent&&this.parent.parent.isTextBlock()?k.prototype.mathspeak.call(this):'"'+g+'"'},b}(Vt);function Rt(k,b,g){return function(){return new ir(k,c.entityText(b))}}fe.prototype.autoCommands={_maxLength:0},Y.autoCommands=function(k){if(typeof k!="string"||!/^[a-z]+(?: [a-z]+)*$/i.test(k))throw'"'+k+'" not a space-delimited list of only letters';for(var b=k.split(" "),g={},f=0,D=0;D<b.length;D+=1){var V=b[D];if(V.length<2)throw'autocommand "'+V+'" not minimum length of 2';if(A[V]===yi)throw'"'+V+'" is a built-in operator name';g[V]=1,f=o(f,V.length)}return g._maxLength=f,g},fe.prototype.quietEmptyDelimiters={},Y.quietEmptyDelimiters=function(k){k===void 0&&(k="");for(var b=k.split(" "),g={},f=0;f<b.length;f+=1){var D=b[f];g[D]=1}return g},fe.prototype.autoParenthesizedFunctions={_maxLength:0},Y.autoParenthesizedFunctions=function(k){if(typeof k!="string"||!/^[a-z]+(?: [a-z]+)*$/i.test(k))throw'"'+k+'" not a space-delimited list of only letters';for(var b=k.split(" "),g={},f=0,D=0;D<b.length;D+=1){var V=b[D];if(V.length<2)throw'autocommand "'+V+'" not minimum length of 2';g[V]=1,f=o(f,V.length)}return g._maxLength=f,g};function yr(k,b){for(var g="",f=0;k instanceof _r&&k.ctrlSeq===k.letter&&f<b;)g=k.letter+g,k=k[r],f+=1;return g}var _r=function(k){Pt(b,k);function b(g){var f=k.call(this,g)||this;return f.letter=g,f}return b.prototype.checkAutoCmds=function(g){var f;if(!this.shouldIgnoreSubstitutionInSimpleSubscript(g.options)){var D=g.options.autoCommands,V=D._maxLength||0;if(V>0)for(var $=(f=yr(this,V))!==null&&f!==void 0?f:"";$.length;){if(D.hasOwnProperty($)){for(var te=this,le=1;te&&le<$.length;le+=1,te=te[r]);new z(te,this).remove(),g[r]=te[r];var ke=A[$],Xe;return pe(ke)?Xe=new ke($):Xe=ke($),Xe.createLeftOf(g)}$=$.slice(1)}}},b.prototype.autoParenthesize=function(g){var f=g.parent.getEnd(e);if(!(f&&f instanceof tl&&f.ctrlSeq==="\\left(")&&!this.shouldIgnoreSubstitutionInSimpleSubscript(g.options)){for(var D="",V=this,$=0,te=g.options.autoParenthesizedFunctions,le=te._maxLength||0,ke=g.options.autoOperatorNames;V instanceof b&&$<le;)D=V.letter+D,V=V[r],$+=1;for(;D.length;){if(te.hasOwnProperty(D)&&ke.hasOwnProperty(D))return g.parent.write(g,"(");D=D.slice(1)}}},b.prototype.createLeftOf=function(g){k.prototype.createLeftOf.call(this,g),this.checkAutoCmds(g),this.autoParenthesize(g)},b.prototype.italicize=function(g){return this.isItalic=g,this.isPartOfOperator=!g,g&&(delete this.endsCategory,delete this.endsWord),this.domFrag().toggleClass("dcg-mq-operator-name",!g),this},b.prototype.finalizeTree=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.siblingDeleted=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.siblingCreated=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.sharedSiblingMethod=function(g,f){f!==r&&this[e]instanceof b||this.autoUnItalicize(g)},b.prototype.autoUnItalicize=function(g){var f=g.autoOperatorNames;if(f._maxLength!==0&&!this.shouldIgnoreSubstitutionInSimpleSubscript(g)){for(var D=this.letter,V=this[r];V instanceof b;V=V[r])D=V.letter+D;for(var $=this[e];$ instanceof b;$=$[e])D+=$.letter;var te=V&&V[e],le=$&&$[r];new z(te||this.parent.getEnd(r),le||this.parent.getEnd(e)).each(function(ve){ve instanceof b&&(ve.italicize(!0).domFrag().removeClass("dcg-mq-first dcg-mq-last dcg-mq-followed-by-supsub"),ve.ctrlSeq=ve.letter)});var ke=f._maxLength||0;e:for(var Xe=0,qe=V[e]||this.parent.getEnd(r);qe&&Xe<D.length;Xe+=1,qe=qe[e])for(var Ue=t(ke,D.length-Xe);Ue>0;Ue-=1){var ot=D.slice(Xe,Xe+Ue),nt=void 0;if(f.hasOwnProperty(ot)){for(var _t=0,Lt=qe;_t<Ue;_t+=1,Lt=Lt[e])Lt instanceof b&&(Lt.italicize(!1),nt=Lt);var Mt=Fi.hasOwnProperty(ot);if(qe.ctrlSeq=(Mt?"\\":"\\operatorname{")+qe.ctrlSeq,nt.ctrlSeq+=Mt?" ":"}",nt.endsWord=ot,g.infixOperatorNames[ot]?nt.endsCategory="infix":g.prefixOperatorNames[ot]&&(nt.endsCategory="prefix"),$n.hasOwnProperty(ot)){var M=nt[r],B=M&&M[r],H=B&&B[r];H.domFrag().addClass("dcg-mq-last")}if(this.shouldOmitPadding(qe[r])||qe.domFrag().addClass("dcg-mq-first"),!this.shouldOmitPadding(nt[e]))if(nt[e]instanceof lc){var K=nt[e],ie=K.siblingCreated=K.siblingDeleted=function(){K.domFrag().toggleClass("dcg-mq-after-operator-name",!(K[e]instanceof tl))};ie()}else nt.domFrag().toggleClass("dcg-mq-last",!(nt[e]instanceof tl));Xe+=Ue-1,qe=nt;continue e}}}},b.prototype.shouldOmitPadding=function(g){return!!(!g||g.ctrlSeq==="."||g instanceof Se&&g.isBinaryOperator()||g instanceof Wp)},b}(ir),Fi={};fe.prototype.autoOperatorNames=la();var $n={limsup:1,liminf:1,projlim:1,injlim:1};function la(){for(var k={_maxLength:9},b="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),g=0;g<b.length;g+=1)Fi[b[g]]=k[b[g]]=1;for(var f="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),g=0;g<f.length;g+=1)Fi[f[g]]=1;for(var D="sin cos tan sec cosec csc cotan cot ctg".split(" "),g=0;g<D.length;g+=1)k[D[g]]=k["arc"+D[g]]=k[D[g]+"h"]=k["ar"+D[g]+"h"]=k["arc"+D[g]+"h"]=1;for(var V="gcf hcf lcm proj span".split(" "),g=0;g<V.length;g+=1)k[V[g]]=1;return k}Y.autoOperatorNames=function(k){if(typeof k!="string")throw'"'+k+'" not a space-delimited list';if(!/^[a-z\|\-]+(?: [a-z\|\-]+)*$/i.test(k))throw'"'+k+'" not a space-delimited list of letters or "|"';for(var b=k.split(" "),g={},f=0,D=0;D<b.length;D+=1){var V=b[D];if(V.length<2)throw'"'+V+'" not minimum length of 2';if(V.indexOf("|")<0)g[V]=V,f=o(f,V.length);else{var $=V.split("|");if($.length>2)throw'"'+V+'" has more than 1 mathspeak delimiter';if($[0].length<2)throw'"'+V[0]+'" not minimum length of 2';g[$[0]]=$[1].replace(/-/g," "),f=o(f,$[0].length)}}return g._maxLength=f,g},fe.prototype.infixOperatorNames={},Y.infixOperatorNames=Wi,fe.prototype.prefixOperatorNames={},Y.prefixOperatorNames=Wi,fe.prototype.disableAutoSubstitutionInSubscripts=!1,Y.disableAutoSubstitutionInSubscripts=function(k){if(typeof k=="boolean")return k;if(typeof k!="object"||k===null||!("except"in k))throw'"'+k+'" not an object with property "except"';return{except:Wi(k.except)}};function Wi(k){if(typeof k!="string")throw'"'+k+'" not a space-delimited list';if(!/^[a-z]+(?: [a-z]+)*$/i.test(k))throw'"'+k+'" not a space-delimited list of letters';for(var b=k.split(" "),g={},f=0;f<b.length;f+=1){var D=b[f];if(D.length<2)throw'"'+D+'" not minimum length of 2';g[D]=!0}return g}var yi=function(k){Pt(b,k);function b(g){return k.call(this,g||"")||this}return b.prototype.createLeftOf=function(g){for(var f=this.ctrlSeq,D=0;D<f.length;D+=1)new _r(f.charAt(D)).createLeftOf(g)},b.prototype.parser=function(){for(var g=this.ctrlSeq,f=new Fe,D=0;D<g.length;D+=1)new _r(g.charAt(D)).adopt(f,f.getEnd(e),0);return me.succeed(f.children())},b}(Vt);for(var hn in fe.prototype.autoOperatorNames)fe.prototype.autoOperatorNames.hasOwnProperty(hn)&&(A[hn]=yi);A.operatorname=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.createLeftOf=function(){},b.prototype.numBlocks=function(){return 1},b.prototype.parser=function(){return se.block.map(function(g){var f=!0,D="",V=g.children();return V.each(function($){$ instanceof _r?D+=$.letter:f=!1}),f&&D==="ans"?$D():V})},b}(St),A.f=function(k){Pt(b,k);function b(){var g=this,f="f";return g=k.call(this,f)||this,g.letter=f,g.domView=new tt(0,function(){return c("var",{class:"dcg-mq-f"},[c.text("f")])}),g}return b.prototype.italicize=function(g){return this.domFrag().eachElement(function(f){return f.textContent="f"}),this.domFrag().toggleClass("dcg-mq-f",g),k.prototype.italicize.call(this,g)},b}(_r),A[" "]=A.space=function(){return new hr("\\ ",c("span",{},[c.text(p)])," ")},A["."]=function(){return new hr(".",c("span",{class:"dcg-mq-digit"},[c.text(".")]),".")},A["'"]=A.prime=ce("'","&prime;","prime"),A["\u2033"]=A.dprime=ce("\u2033","&Prime;","double prime"),A.backslash=ce("\\backslash ","\\","backslash"),U["\\"]||(U["\\"]=A.backslash),A.$=ce("\\$","$","dollar"),A["\u25A1"]=A.square=ce("\\square ","\u25A1","square"),A.mid=ce("\\mid ","\u2223","mid");var el=function(k){Pt(b,k);function b(g,f,D){return k.call(this,g,c("span",{class:"dcg-mq-nonSymbola"},[f||c.text(g)]))||this}return b}(Vt);A["@"]=function(){return new el("@")},A["&"]=function(){return new el("\\&",c.entityText("&amp;"),"and")},A["%"]=function(k){Pt(b,k);function b(){return k.call(this,"\\%",c.text("%"),"percent")||this}return b.prototype.parser=function(){var g=me.optWhitespace,f=me.string;return g.then(f("\\operatorname{of}").map(function(){return jD()})).or(k.prototype.parser.call(this))},b}(el),A["\u2225"]=A.parallel=ce("\\parallel ","&#x2225;","parallel"),A["\u2226"]=A.nparallel=ce("\\nparallel ","&#x2226;","not parallel"),A["\u27C2"]=A.perp=ce("\\perp ","&#x27C2;","perpendicular");function Bo(k){return Rt("\\"+k+" ","&"+k+";",k)}A.\u03B1=A.alpha=Bo("alpha"),A.\u03B2=A.beta=Bo("beta"),A.\u03B3=A.gamma=Bo("gamma"),A.\u03B4=A.delta=Bo("delta"),A.\u03B6=A.zeta=Bo("zeta"),A.\u03B7=A.eta=Bo("eta"),A.\u03B8=A.theta=Bo("theta"),A.\u03B9=A.iota=Bo("iota"),A.\u03BA=A.kappa=Bo("kappa"),A.\u03BC=A.mu=Bo("mu"),A.\u03BD=A.nu=Bo("nu"),A.\u03BE=A.xi=Bo("xi"),A.\u03C1=A.rho=Bo("rho"),A.\u03C3=A.sigma=Bo("sigma"),A.\u03C4=A.tau=Bo("tau"),A.\u03C7=A.chi=Bo("chi"),A.\u03C8=A.psi=Bo("psi"),A.\u03C9=A.omega=Bo("omega"),A.\u03D5=A.phi=Rt("\\phi ","&#981;","phi"),A.\u03C6=A.phiv=A.varphi=Rt("\\varphi ","&phi;","phi"),A["\u03F5"]=A.epsilon=Rt("\\epsilon ","&#1013;","epsilon"),A.\u03B5=A.epsiv=A.varepsilon=Rt("\\varepsilon ","&epsilon;","epsilon"),A.\u03D6=A.piv=A.varpi=Rt("\\varpi ","&piv;","piv"),A.\u03C2=A.sigmaf=A.sigmav=A.varsigma=Rt("\\varsigma ","&sigmaf;","sigma"),A.\u03D1=A.thetav=A.vartheta=A.thetasym=Rt("\\vartheta ","&thetasym;","theta"),A.\u03C5=A.upsilon=A.upsi=Rt("\\upsilon ","&upsilon;","upsilon"),A.\u03DC=A.gammad=A.Gammad=A.digamma=Rt("\\digamma ","&#989;","gamma"),A.\u03F0=A.kappav=A.varkappa=Rt("\\varkappa ","&#1008;","kappa"),A.\u03F1=A.rhov=A.varrho=Rt("\\varrho ","&#1009;","rho"),A.pi=A.\u03C0=function(){return new el("\\pi ",c.entityText("&pi;"),"pi")},A.\u03BB=A.lambda=function(){return new el("\\lambda ",c.entityText("&lambda;"),"lambda")},A.\u03A5=A.Upsilon=A.Upsi=A.upsih=A.Upsih=function(){return new Vt("\\Upsilon ",c("var",{style:"font-family: serif"},[c.entityText("&upsih;")]),"capital upsilon")};function ac(k){return function(){return new _e("\\"+k+" ",c.entityText("&"+k+";"))}}A.\u0393=A.Gamma=ac("Gamma"),A.\u0394=A.Delta=ac("Delta"),A.\u0398=A.Theta=ac("Theta"),A.\u039B=A.Lambda=ac("Lambda"),A.\u039E=A.Xi=ac("Xi"),A.\u03A0=A.Pi=ac("Pi"),A.\u03A3=A.Sigma=ac("Sigma"),A.\u03A6=A.Phi=ac("Phi"),A.\u03A8=A.Psi=ac("Psi"),A.\u03A9=A.Omega=ac("Omega"),A["\u2200"]=A.forall=ac("forall");var ca=function(k){Pt(b,k);function b(g){var f=k.call(this)||this;return f.latexStr=g,f}return b.prototype.createLeftOf=function(g){var f=se.parse(this.latexStr);f.children().adopt(g.parent,g[r],g[e]),g[r]=f.getEnd(e),P(f.html()).insertBefore(g.domFrag()),f.finalizeInsert(g.options,g);var D=f.getEnd(e),V=D&&D[e];V&&V.siblingCreated(g.options,r);var $=f.getEnd(r),te=$&&$[r];te&&te.siblingCreated(g.options,e),g.parent.bubble(function(le){le.reflow()})},b.prototype.mathspeak=function(){return se.parse(this.latexStr).mathspeak()},b.prototype.parser=function(){var g=se.parse(this.latexStr).children();return me.succeed(g)},b}(St);A["\u2070"]=function(){return new ca("^0")},A["\xB9"]=function(){return new ca("^1")},A["\xB2"]=function(){return new ca("^2")},A["\xB3"]=function(){return new ca("^3")},A["\u2074"]=function(){return new ca("^4")},A["\u2075"]=function(){return new ca("^5")},A["\u2076"]=function(){return new ca("^6")},A["\u2077"]=function(){return new ca("^7")},A["\u2078"]=function(){return new ca("^8")},A["\u2079"]=function(){return new ca("^9")},A["\xBC"]=function(){return new ca("\\frac14")},A["\xBD"]=function(){return new ca("\\frac12")},A["\xBE"]=function(){return new ca("\\frac34")},A["\u221A"]=function(){return new ca("\\sqrt{}")};function op(k){return k instanceof Se||k instanceof _r&&k.endsCategory=="infix"}function bd(k){if(!k)return!1;var b=k[r];if(b){if(op(b)||b instanceof _r&&b.endsCategory=="prefix"||!(b instanceof tl)&&/^(\\ )|[,;:\(\[]$/.test(b.ctrlSeq))return!1}else return k.parent&&k.parent.parent&&k.parent.parent.isStyleBlock()?bd(k.parent.parent):!1;return!0}var Ps=function(k){Pt(b,k);function b(g,f,D){return k.call(this,g,f,void 0,D,!0)||this}return b.prototype.isBinaryOperator=function(){return bd(this)},b.prototype.contactWeld=function(g,f){this.sharedSiblingMethod(g.options,f)},b.prototype.siblingCreated=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.siblingDeleted=function(g,f){this.sharedSiblingMethod(g,f)},b.prototype.sharedSiblingMethod=function(g,f){if(f!==e)return this.domFrag().oneElement().className=bd(this)?"dcg-mq-binary-operator":"",this},b}(Se);A["+"]=function(k){Pt(b,k);function b(){return k.call(this,"+",c.text("+"))||this}return b.prototype.mathspeak=function(){return bd(this)?"plus":"positive"},b}(Ps);var lh=function(k){Pt(b,k);function b(){return k.call(this,"-",c.entityText("&minus;"))||this}return b.prototype.mathspeak=function(){return bd(this)?"minus":"negative"},b}(Ps);A["\u2212"]=A["\u2014"]=A["\u2013"]=A["-"]=lh,A["\xB1"]=A.pm=A.plusmn=A.plusminus=function(){return new Ps("\\pm ",c.entityText("&plusmn;"),"plus-or-minus")},A.mp=A.mnplus=A.minusplus=function(){return new Ps("\\mp ",c.entityText("&#8723;"),"minus-or-plus")},U["*"]=A.sdot=A.cdot=Qe("\\cdot ","&middot;","*","times");var Hp=function(k){Pt(b,k);function b(){return k.call(this,"\\to ",c.entityText("&rarr;"),"to")||this}return b.prototype.deleteTowards=function(g,f){if(g===r){var D=f[r];new z(D,this).remove(),f[r]=D[r],new lh().createLeftOf(f),f[r].bubble(function(V){V.reflow()});return}k.prototype.deleteTowards.call(this,g,f)},b}(Se);A["\u2192"]=A.to=Hp;var yd=function(k){Pt(b,k);function b(g,f){var D=this,V=f?"Strict":"";return D=k.call(this,g["ctrlSeq".concat(V)],c.entityText(g["htmlEntity".concat(V)]),g["text".concat(V)],g["mathspeak".concat(V)])||this,D.data=g,D.strict=f,D}return b.prototype.swap=function(g){this.strict=g;var f=g?"Strict":"";this.ctrlSeq=this.data["ctrlSeq".concat(f)],this.domFrag().children().replaceWith(P(c.entityText(this.data["htmlEntity".concat(f)]))),this.textTemplate=[this.data["text".concat(f)]],this.mathspeakName=this.data["mathspeak".concat(f)]},b.prototype.deleteTowards=function(g,f){if(g===r&&!this.strict){this.swap(!0),this.bubble(function(D){D.reflow()});return}k.prototype.deleteTowards.call(this,g,f)},b}(Se),El={ctrlSeq:"\\le ",htmlEntity:"&le;",text:"\u2264",mathspeak:"less than or equal to",ctrlSeqStrict:"<",htmlEntityStrict:"&lt;",textStrict:"<",mathspeakStrict:"less than"},HD={ctrlSeq:"\\ge ",htmlEntity:"&ge;",text:"\u2265",mathspeak:"greater than or equal to",ctrlSeqStrict:">",htmlEntityStrict:"&gt;",textStrict:">",mathspeakStrict:"greater than"},fO=function(k){Pt(b,k);function b(){return k.call(this,HD,!0)||this}return b.prototype.createLeftOf=function(g){var f=g[r];if(f instanceof Se&&f.ctrlSeq==="-"){var D=f;g[r]=D[r],D.remove(),new Hp().createLeftOf(g),g[r].bubble(function(V){V.reflow()});return}k.prototype.createLeftOf.call(this,g)},b}(yd);A["<"]=A.lt=function(){return new yd(El,!0)},A[">"]=A.gt=fO,A["\u2264"]=A.le=A.leq=function(){return new yd(El,!1)},A["\u2265"]=A.ge=A.geq=function(){return new yd(HD,!1)},A["\u221E"]=A.infty=A.infin=A.infinity=ce("\\infty ","&infin;","infinity"),A["\u2260"]=A.ne=A.neq=Qe("\\ne ","&ne;","not equal");var K1=function(k){Pt(b,k);function b(){return k.call(this,"=",c.text("="),"=","equals")||this}return b.prototype.createLeftOf=function(g){var f=g[r];if(f instanceof yd&&f.strict){f.swap(!1),f.bubble(function(D){D.reflow()});return}k.prototype.createLeftOf.call(this,g)},b}(Se);A["="]=K1,A["\xD7"]=A.times=A.cross=Qe("\\times ","&times;","[x]","times"),A["\xF7"]=A.div=A.divide=A.divides=Qe("\\div ","&divide;","[/]","over");var Gg=function(k){Pt(b,k);function b(){return k.call(this,"\\sim ",c.text("~"),"~","tilde")||this}return b.prototype.createLeftOf=function(g){if(g[r]instanceof b){var f=g[r];g[r]=f[r],f.remove(),new Ty().createLeftOf(g),g[r].bubble(function(D){D.reflow()});return}k.prototype.createLeftOf.call(this,g)},b}(Se),Ty=function(k){Pt(b,k);function b(){return k.call(this,"\\approx ",c.entityText("&approx;"),"\u2248","approximately equal")||this}return b.prototype.deleteTowards=function(g,f){if(g===r){var D=f[r];new z(D,this).remove(),f[r]=D[r],new Gg().createLeftOf(f),f[r].bubble(function(V){V.reflow()});return}k.prototype.deleteTowards.call(this,g,f)},b}(Se);A.tildeNbsp=ce("~",p," "),A.sim=Gg,A["\u2248"]=A.approx=Ty,U["~"]=A.sim,A["~"]=A.tildeNbsp,Y.interpretTildeAsSim=function(k){var b=!!k;return b?A["~"]=A.sim:A["~"]=A.tildeNbsp,b},A["\u25EF"]=A.bigcirc=ce("\\bigcirc ","&#9711;","circle"),A["\u2220"]=A.ang=A.angle=ce("\\angle ","&ang;","angle"),A["\xB0"]=A.degree=ce("\\degree ","&deg;","degrees"),A["\u25B3"]=A.triangle=ce("\\triangle ","&#9651;","triangle"),A["\u2245"]=A.cong=Qe("\\cong ","&cong;","cong","congruent"),A["\u2221"]=A.measuredangle=ce("\\measuredangle ","&#8737;","measured angle"),A["\u25B1"]=A.parallelogram=ce("\\parallelogram ","&#9649;","parallelogram"),A["\u2247"]=A.ncong=Qe("\\ncong ","&ncong;","ncong","not congruent"),A["\u2241"]=A.nsim=Qe("\\nsim ","&nsim;","nsim","not similar");var Kp={sqrt:{width:"",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 32 54"},[c("path",{d:"M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"})])}},"|":{width:".4em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[c("path",{d:"M4.4 0 L4.4 54 L5.6 54 L5.6 0"})])}},"[":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 11 24"},[c("path",{d:"M8 0 L3 0 L3 24 L8 24 L8 23 L4 23 L4 1 L8 1"})])}},"]":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 11 24"},[c("path",{d:"M3 0 L8 0 L8 24 L3 24 L3 23 L7 23 L7 1 L3 1"})])}},"(":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"3 0 106 186"},[c("path",{d:"M85 0 A61 101 0 0 0 85 186 L75 186 A75 101 0 0 1 75 0"})])}},")":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"3 0 106 186"},[c("path",{d:"M24 0 A61 101 0 0 1 24 186 L34 186 A75 101 0 0 0 34 0"})])}},"{":{width:".7em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"10 0 210 350"},[c("path",{d:"M170 0 L170 6 A47 52 0 0 0 123 60 L123 127 A35 48 0 0 1 88 175 A35 48 0 0 1 123 223 L123 290 A47 52 0 0 0 170 344 L170 350 L160 350 A58 49 0 0 1 102 301 L103 220 A45 40 0 0 0 58 180 L58 170 A45 40 0 0 0 103 130 L103 49 A58 49 0 0 1 161 0"})])}},"}":{width:".7em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"10 0 210 350"},[c("path",{d:"M60 0 L60 6 A47 52 0 0 1 107 60 L107 127 A35 48 0 0 0 142 175 A35 48 0 0 0 107 223 L107 290 A47 52 0 0 1 60 344 L60 350 L70 350 A58 49 0 0 0 128 301 L127 220 A45 40 0 0 1 172 180 L172 170 A45 40 0 0 1 127 130 L127 49 A58 49 0 0 0 70 0"})])}},"&#8741;":{width:".7em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[c("path",{d:"M3.2 0 L3.2 54 L4 54 L4 0 M6.8 0 L6.8 54 L6 54 L6 0"})])}},"&lang;":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[c("path",{d:"M6.8 0 L3.2 27 L6.8 54 L7.8 54 L4.2 27 L7.8 0"})])}},"&rang;":{width:".55em",html:function(){return c("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[c("path",{d:"M3.2 0 L6.8 27 L3.2 54 L2.2 54 L5.8 27 L2.2 0"})])}}},_f="\u27A4",sc=function(k){Pt(b,k);function b(g,f,D,V,$){var te=k.call(this,g,new tt(1,function(le){var ke,Xe;return c.block(f,D,le[0],{beforeChild:(ke=$==null?void 0:$.beforeChild)===null||ke===void 0?void 0:ke.call($),afterChild:(Xe=$==null?void 0:$.afterChild)===null||Xe===void 0?void 0:Xe.call($)})}))||this;return te.ariaLabel=V||g.replace(/^\\/,""),te.mathspeakTemplate=["Start"+te.ariaLabel+",","End"+te.ariaLabel],te.shouldNotSpeakDelimiters=$&&$.shouldNotSpeakDelimiters,te}return b.prototype.mathspeak=function(g){return!this.shouldNotSpeakDelimiters||g&&g.ignoreShorthand?k.prototype.mathspeak.call(this):this.foldChildren("",function(f,D){return f+" "+D.mathspeak(g)}).trim()},b}(St);A.mathrm=function(k){Pt(b,k);function b(){return k.call(this,"\\mathrm","span",{class:"dcg-mq-roman dcg-mq-font"},"Roman Font",{shouldNotSpeakDelimiters:!0})||this}return b.prototype.isTextBlock=function(){return!0},b}(sc),A.mathit=function(){return new sc("\\mathit","i",{class:"dcg-mq-font"},"Italic Font")},A.mathbf=function(){return new sc("\\mathbf","b",{class:"dcg-mq-font"},"Bold Font")},A.mathsf=function(){return new sc("\\mathsf","span",{class:"dcg-mq-sans-serif dcg-mq-font"},"Serif Font")},A.mathtt=function(){return new sc("\\mathtt","span",{class:"dcg-mq-monospace dcg-mq-font"},"Math Text")},A.underline=function(){return new sc("\\underline","span",{class:"dcg-mq-non-leaf dcg-mq-underline"},"Underline")},A.overline=A.bar=function(){return new sc("\\overline","span",{class:"dcg-mq-non-leaf dcg-mq-overline"},"Overline")},A.overrightarrow=function(){return new sc("\\overrightarrow","span",{class:"dcg-mq-non-leaf dcg-mq-overarrow"},"Over Right Arrow",{afterChild:function(){return c("span",{class:"dcg-mq-arrow-right-content"},[c.text(_f)])}})},A.overleftarrow=function(){return new sc("\\overleftarrow","span",{class:"dcg-mq-non-leaf dcg-mq-overarrow"},"Over Left Arrow",{beforeChild:function(){return c("span",{class:"dcg-mq-arrow-left-content"},[c.text(_f)])}})},A.overleftrightarrow=function(){return new sc("\\overleftrightarrow ","span",{class:"dcg-mq-non-leaf dcg-mq-overarrow"},"Over Left and Right Arrow",{beforeChild:function(){return c("span",{class:"dcg-mq-arrow-left-content"},[c.text(_f)])},afterChild:function(){return c("span",{class:"dcg-mq-arrow-right-content"},[c.text(_f)])}})},A.overarc=function(){return new sc("\\overarc","span",{class:"dcg-mq-non-leaf dcg-mq-overarc"},"Over Arc")},A.dot=function(){return new St("\\dot",new tt(1,function(k){return c("span",{class:"dcg-mq-non-leaf"},[c("span",{class:"dcg-mq-dot-recurring-inner"},[c("span",{class:"dcg-mq-dot-recurring"},[c.text(h)]),c.block("span",{class:"dcg-mq-empty-box"},k[0])])])}))},A.textcolor=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.setColor=function(g){this.color=g,this.domView=new tt(1,function(f){return c.block("span",{class:"dcg-mq-textcolor",style:"color:"+g},f[0])}),this.ariaLabel=g.replace(/^\\/,""),this.mathspeakTemplate=["Start "+this.ariaLabel+",","End "+this.ariaLabel]},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g);var f=this.blocks[0];g.latex+="\\textcolor{"+this.color+"}{",f.latexRecursive(g),g.latex+="}",this.checkCursorContextClose(g)},b.prototype.parser=function(){var g=this,f=me.optWhitespace,D=me.string,V=me.regex;return f.then(D("{")).then(V(/^[#\w\s.,()%-]*/)).skip(D("}")).then(function($){return g.setColor($),k.prototype.parser.call(g)})},b.prototype.isStyleBlock=function(){return!0},b}(St);var CU=A.class=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.parser=function(){var g=this,f=me.string,D=me.regex;return me.optWhitespace.then(f("{")).then(D(/^[-\w\s\\\xA0-\xFF]*/)).skip(f("}")).then(function(V){return g.cls=V||"",g.domView=new tt(1,function($){return c.block("span",{class:"dcg-mq-class ".concat(V)},$[0])}),g.ariaLabel=V+" class",g.mathspeakTemplate=["Start "+g.ariaLabel+",","End "+g.ariaLabel],k.prototype.parser.call(g)})},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g);var f=this.blocks[0];g.latex+="\\class{"+this.cls+"}{",f.latexRecursive(g),g.latex+="}",this.checkCursorContextClose(g)},b.prototype.isStyleBlock=function(){return!0},b}(St),Tf=/^[\+\-]?[\d]+$/;function W1(k){if(!k)return"";var b="";return k.eachChild(function(g){g.ctrlSeq!==void 0&&(b+=g.ctrlSeq)}),b}fe.prototype.charsThatBreakOutOfSupSub="";var lc=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="_{...}^{...}",g}return b.prototype.setEnds=function(g){a("SupSub ends must be MathBlocks",g[r]instanceof Fe&&g[e]instanceof Fe),this.ends=g},b.prototype.getEnd=function(g){return this.ends[g]},b.prototype.createLeftOf=function(g){if(!(!this.replacedFragment&&!g[r]&&g.options.supSubsRequireOperand))return k.prototype.createLeftOf.call(this,g)},b.prototype.contactWeld=function(g){for(var f=r;f;f=f===r?e:!1){var D=this[f],V=void 0;if(D instanceof b){for(var $="sub";$;$=$==="sub"?"sup":!1){var te=this[$],le=D[$];if(te){if(!le)D.addBlock(te.disown());else if(te.isEmpty())V=new X(le,0,le.getEnd(r));else{te.domFrag().children().insAtDirEnd(-f,le.domFrag().oneElement());var ke=te.children().disown();V=new X(le,ke.getEnd(e),le.getEnd(r)),f===r?ke.adopt(le,le.getEnd(e),0):ke.adopt(le,0,le.getEnd(r))}this.placeCursor=function(Xe,qe){return function(Ue){Ue.insAtDirEnd(-f,Xe||qe)}}(le,te)}}this.remove(),g&&g[r]===this&&(f===e&&V?V[r]?g.insRightOf(V[r]):g.insAtLeftEnd(V.parent):g.insRightOf(D));break}}},b.prototype.finalizeTree=function(){var g=this.getEnd(r);g.write=function(f,D){if(f.options.autoSubscriptNumerals&&this===this.parent.sub&&"0123456789".indexOf(D)>=0){var V=this.chToCmd(D,f.options);V instanceof Vt?f.deleteSelection():f.clearSelection().insRightOf(this.parent),V.createLeftOf(f.show()),f.controller.aria.queue("Baseline").alert(V.mathspeak({createdLeftOf:f}));return}f[r]&&!f[e]&&!f.selection&&f.options.charsThatBreakOutOfSupSub.indexOf(D)>-1&&(f.insRightOf(this.parent),f.controller.aria.queue("Baseline")),Fe.prototype.write.call(this,f,D)}},b.prototype.moveTowards=function(g,f,D){f.options.autoSubscriptNumerals&&!this.sup?f.insDirOf(g,this):k.prototype.moveTowards.call(this,g,f,D)},b.prototype.deleteTowards=function(g,f){if(f.options.autoSubscriptNumerals&&this.sub){var D=this.sub.getEnd(-g);D instanceof Vt?D.remove():D&&D.deleteTowards(g,f.insAtDirEnd(-g,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(r,f.insAtLeftEnd(this.sub)),this.sup&&f.insDirOf(-g,this))}else k.prototype.deleteTowards.call(this,g,f)},b.prototype.latexRecursive=function(g){if(this.checkCursorContextOpen(g),this.sub){g.latex+="_{";var f=g.latex.length;this.sub.latexRecursive(g);var D=g.latex.length;f===D&&(g.latex+=" "),g.latex+="}"}if(this.sup){g.latex+="^{";var f=g.latex.length;this.sup.latexRecursive(g);var D=g.latex.length;f===D&&(g.latex+=" "),g.latex+="}"}this.checkCursorContextClose(g)},b.prototype.text=function(){function g(f,D){var V=D&&D.text()||"";return D?f+(V.length===1?V:"("+(V||" ")+")"):""}return g("_",this.sub)+g("^",this.sup)},b.prototype.addBlock=function(g){this.supsub==="sub"?(this.sup=this.upInto=this.sub.upOutOf=g,g.adopt(this,this.sub,0).downOutOf=this.sub,g.setDOM(P(c("span",{class:"dcg-mq-sup"})).append(g.domFrag().children()).prependTo(this.domFrag().oneElement()).oneElement()),R.linkElementByBlockNode(g.domFrag().oneElement(),g)):(this.sub=this.downInto=this.sup.downOutOf=g,g.adopt(this,0,this.sup).upOutOf=this.sup,this.domFrag().removeClass("dcg-mq-sup-only"),g.setDOM(P(c("span",{class:"dcg-mq-sub"})).append(g.domFrag().children()).appendTo(this.domFrag().oneElement()).oneElement()),R.linkElementByBlockNode(g.domFrag().oneElement(),g),this.domFrag().append(P(c("span",{style:"display:inline-block;width:0"},[c.text(u)]))));for(var f=0;f<2;f+=1)(function(D,V,$,te){var le=D[V];le.deleteOutOf=function(ke,Xe){if(Xe.insDirOf(this[ke]?-ke:ke,this.parent),!this.isEmpty()){var qe=this.getEnd(ke);this.children().disown().withDirAdopt(ke,Xe.parent,Xe[ke],Xe[-ke]).domFrag().insDirOf(-ke,Xe.domFrag()),Xe[-ke]=qe}D.supsub=$,delete D[V],delete D["".concat(te,"Into")];var Ue=D[$];Ue["".concat(te,"OutOf")]=$1,delete Ue.deleteOutOf,V==="sub"&&D.domFrag().addClass("dcg-mq-sup-only").children().last().remove(),this.remove()}})(this,"sub sup".split(" ")[f],"sup sub".split(" ")[f],"down up".split(" ")[f])},b}(St);function $1(k){var b=this.parent,g=k;do{if(g[e])return k.insLeftOf(b);g=g.parent.parent}while(g!==b);k.insRightOf(b)}var KD=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.supsub="sub",g.domView=new tt(1,function(f){return c("span",{class:"dcg-mq-supsub dcg-mq-non-leaf"},[c.block("span",{class:"dcg-mq-sub"},f[0]),c("span",{style:"display:inline-block;width:0"},[c.text(u)])])}),g.textTemplate=["_"],g.mathspeakTemplate=["Subscript,",", Baseline"],g.ariaLabel="subscript",g}return b.prototype.finalizeTree=function(){this.downInto=this.sub=this.getEnd(r),this.sub.upOutOf=$1,k.prototype.finalizeTree.call(this)},b}(lc);A.subscript=A._=KD,A.superscript=A.supscript=A["^"]=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.supsub="sup",g.domView=new tt(1,function(f){return c("span",{class:"dcg-mq-supsub dcg-mq-non-leaf dcg-mq-sup-only"},[c.block("span",{class:"dcg-mq-sup"},f[0])])}),g.textTemplate=["^(",")"],g.ariaLabel="superscript",g.mathspeakTemplate=["Superscript,",", Baseline"],g}return b.prototype.mathspeak=function(g){var f=this.upInto;if(f!==void 0){var D=W1(f);if((!g||!g.ignoreShorthand)&&Tf.test(D)){if(D==="0")return"to the 0 power";if(D==="2")return"squared";if(D==="3")return"cubed";var V="";/^[+-]?\d{1,3}$/.test(D)&&(/(11|12|13|4|5|6|7|8|9|0)$/.test(D)?V="th":/1$/.test(D)?V="st":/2$/.test(D)?V="nd":/3$/.test(D)&&(V="rd"));var $=typeof f=="object"?f.mathspeak():D;return"to the "+$+V+" power"}}return k.prototype.mathspeak.call(this)},b.prototype.finalizeTree=function(){this.upInto=this.sup=this.getEnd(e),this.sup.downOutOf=$1,k.prototype.finalizeTree.call(this)},b}(lc);var Wp=function(k){Pt(b,k);function b(g,f,D){var V=k.call(this)||this;V.ariaLabel=D||g.replace(/^\\/,"");var $=new tt(2,function(te){return c("span",{class:"dcg-mq-large-operator dcg-mq-non-leaf"},[c("span",{class:"dcg-mq-to"},[c.block("span",{},te[1])]),c("big",{},[c.text(f)]),c("span",{class:"dcg-mq-from"},[c.block("span",{},te[0])])])});return Vt.prototype.setCtrlSeqHtmlTextAndMathspeak.call(V,g,$),V}return b.prototype.createLeftOf=function(g){k.prototype.createLeftOf.call(this,g),g.options.sumStartsWithNEquals&&(new _r("n").createLeftOf(g),new K1().createLeftOf(g))},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+=this.ctrlSeq+"_{";var f=g.latex.length;this.getEnd(r).latexRecursive(g);var D=g.latex.length;D===f&&(g.latex+=" "),g.latex+="}^{",f=g.latex.length,this.getEnd(e).latexRecursive(g),D=g.latex.length,f===D&&(g.latex+=" "),g.latex+="}",this.checkCursorContextClose(g)},b.prototype.mathspeak=function(){return"Start "+this.ariaLabel+" from "+this.getEnd(r).mathspeak()+" to "+this.getEnd(e).mathspeak()+", end "+this.ariaLabel+", "},b.prototype.parser=function(){for(var g=me.string,f=me.optWhitespace,D=me.succeed,V=se.block,$=this,te=$.blocks=[new Fe,new Fe],le=0;le<te.length;le+=1)te[le].adopt($,$.getEnd(e),0);return f.then(g("_").or(g("^"))).then(function(ke){var Xe=te[ke==="_"?0:1];return V.then(function(qe){return qe.children().adopt(Xe,Xe.getEnd(e),0),D($)})}).many().result($)},b.prototype.finalizeTree=function(){var g=this.getEnd(r),f=this.getEnd(e);g.ariaLabel="lower bound",f.ariaLabel="upper bound",this.downInto=g,this.upInto=f,g.upOutOf=f,f.downOutOf=g},b}(St);A["\u2211"]=A.sum=A.summation=function(){return new Wp("\\sum ",m,"sum")},A["\u220F"]=A.prod=A.product=function(){return new Wp("\\prod ",y,"product")},A.coprod=A.coproduct=function(){return new Wp("\\coprod ",w,"co product")},A["\u222B"]=A.int=A.integral=function(k){Pt(b,k);function b(){var g=k.call(this,"\\int ","","integral")||this;return g.ariaLabel="integral",g.domView=new tt(2,function(f){return c("span",{class:"dcg-mq-int dcg-mq-non-leaf"},[c("big",{},[c.text(S)]),c("span",{class:"dcg-mq-supsub dcg-mq-non-leaf"},[c("span",{class:"dcg-mq-sup"},[c.block("span",{class:"dcg-mq-sup-inner"},f[1])]),c.block("span",{class:"dcg-mq-sub"},f[0]),c("span",{style:"display:inline-block;width:0"},[c.text(u)])])])}),g}return b.prototype.createLeftOf=function(g){St.prototype.createLeftOf.call(this,g)},b}(Wp);var WD=A.frac=A.dfrac=A.cfrac=A.fraction=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="\\frac",g.domView=new tt(2,function(f){return c("span",{class:"dcg-mq-fraction dcg-mq-non-leaf"},[c.block("span",{class:"dcg-mq-numerator"},f[0]),c.block("span",{class:"dcg-mq-denominator"},f[1]),c("span",{style:"display:inline-block;width:0"},[c.text(u)])])}),g.textTemplate=["(",")/(",")"],g}return b.prototype.finalizeTree=function(){var g=this.getEnd(r),f=this.getEnd(e);this.upInto=f.upOutOf=g,this.downInto=g.downOutOf=f,g.ariaLabel="numerator",f.ariaLabel="denominator",this.getFracDepth()>1?this.mathspeakTemplate=["StartNestedFraction,","NestedOver",", EndNestedFraction"]:this.mathspeakTemplate=["StartFraction,","Over",", EndFraction"]},b.prototype.mathspeak=function(g){if(g&&g.createdLeftOf){var f=g.createdLeftOf;return f.parent.mathspeak()}var D=W1(this.getEnd(r)),V=W1(this.getEnd(e));if((!g||!g.ignoreShorthand)&&Tf.test(D)&&Tf.test(V)){var $=D==="1"||D==="-1",te="";if(V==="2"?te=$?"half":"halves":V==="3"?te=$?"third":"thirds":V==="4"?te=$?"quarter":"quarters":V==="5"?te=$?"fifth":"fifths":V==="6"?te=$?"sixth":"sixths":V==="7"?te=$?"seventh":"sevenths":V==="8"?te=$?"eighth":"eighths":V==="9"&&(te=$?"ninth":"ninths"),te!==""){for(var le="",ke=!1,Xe=this[r];Xe&&Xe[r]!==void 0;Xe=Xe[r])if(Xe.ctrlSeq!=="\\ ")if(Tf.test(Xe.ctrlSeq||""))ke=!0;else{ke=!1;break}return ke&&(le+="and "),le+=this.getEnd(r).mathspeak()+" "+te,le}}return k.prototype.mathspeak.call(this)},b.prototype.getFracDepth=function(){var g=0,f=function(D,V){return D instanceof Nt&&D.ctrlSeq&&D.ctrlSeq.toLowerCase().search("frac")>=0&&(V+=1),D&&D.parent?f(D.parent,V):V};return f(this,g)},b}(St),bO=A.over=U["/"]=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.createLeftOf=function(g){if(!this.replacedFragment){var f=g[r],D=g.options.typingSlashCreatesNewFraction&&this instanceof WD;if(!D)for(;f&&!(op(f)||f instanceof hr&&f._groupingClass==="dcg-mq-ellipsis-end"||f instanceof(A.text||i)||f instanceof Wp||f.ctrlSeq==="\\ "||/^[,;:]$/.test(f.ctrlSeq));)f=f[r];if(f instanceof Wp&&f[e]instanceof lc){f=f[e];var V=f[e];V instanceof lc&&V.ctrlSeq!=f.ctrlSeq&&(f=f[e])}if(f!==g[r]&&!g.isTooDeep(1)){var V=f[e],$=g[r];this.replaces(new z(V||g.parent.getEnd(r),$)),g[r]=f}}k.prototype.createLeftOf.call(this,g)},b}(WD),$D=function(){return new Vt("\\operatorname{ans}",c("span",{class:"dcg-mq-ans"},[c.text("ans")]),"ans")};A.ans=$D;var jD=function(){return new Vt("\\%\\operatorname{of}",c("span",{class:"dcg-mq-nonSymbola dcg-mq-operator-name"},[c.text("% of ")]),"percent of")};A.percent=A.percentof=jD;var YD=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.tokenId="",g.ctrlSeq="\\token",g.textTemplate=["token(",")"],g.mathspeakTemplate=["StartToken,",", EndToken"],g.ariaLabel="token",g}return b.prototype.html=function(){var g=c("span",{class:"dcg-mq-token dcg-mq-ignore-mousedown","data-dcg-mq-token":this.tokenId});return this.setDOM(g),R.linkElementByCmdNode(g,this),g},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+="\\token{"+this.tokenId+"}",this.checkCursorContextClose(g)},b.prototype.mathspeak=function(){var g=[];return this.domFrag().children().eachElement(function(f){var D=f.getAttribute("aria-label");typeof D=="string"&&D!==""&&g.push(D)}),g.length>0?g.join(" ").trim():"token "+this.tokenId},b.prototype.parser=function(){var g=this;return se.block.map(function(f){var D=f.getEnd(r);if(D)for(g.tokenId+=D.ctrlSeq;D=D[e];)g.tokenId+=D.ctrlSeq;return g})},b}(Vt);A.token=YD;var XD=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="\\sqrt",g.domView=new tt(1,function(f){return c("span",{class:"dcg-mq-non-leaf dcg-mq-sqrt-container"},[c("span",{class:"dcg-mq-scaled dcg-mq-sqrt-prefix"},[Kp.sqrt.html()]),c.block("span",{class:"dcg-mq-non-leaf dcg-mq-sqrt-stem"},f[0])])}),g.textTemplate=["sqrt(",")"],g.mathspeakTemplate=["StartRoot,",", EndRoot"],g.ariaLabel="root",g}return b.prototype.parser=function(){return se.optBlock.then(function(g){return se.block.map(function(f){var D=new Gy;return D.blocks=[g,f],g.adopt(D,0,0),f.adopt(D,g,0),D})}).or(k.prototype.parser.call(this))},b.prototype.deleteTowards=function(g,f){if(!this.isEmpty()&&g===1){this.moveTowards(e,f),f.parent.deleteOutOf(r,f);return}k.prototype.deleteTowards.call(this,g,f)},b}(St);A.sqrt=XD,A.hat=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="\\hat",g.domView=new tt(1,function(f){return c("span",{class:"dcg-mq-non-leaf"},[c("span",{class:"dcg-mq-hat-prefix"},[c.text("^")]),c.block("span",{class:"dcg-mq-hat-stem"},f[0])])}),g.textTemplate=["hat(",")"],g}return b}(St);var Gy=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.domView=new tt(2,function(f){return c("span",{class:"dcg-mq-nthroot-container dcg-mq-non-leaf"},[c.block("sup",{class:"dcg-mq-nthroot dcg-mq-non-leaf"},f[0]),c("span",{class:"dcg-mq-scaled dcg-mq-sqrt-container"},[c("span",{class:"dcg-mq-sqrt-prefix dcg-mq-scaled"},[Kp.sqrt.html()]),c.block("span",{class:"dcg-mq-sqrt-stem dcg-mq-non-leaf"},f[1])])])}),g.textTemplate=["sqrt[","](",")"],g}return b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+="\\sqrt[",this.getEnd(r).latexRecursive(g),g.latex+="]{",this.getEnd(e).latexRecursive(g),g.latex+="}",this.checkCursorContextClose(g)},b.prototype.mathspeak=function(){var g=this.getEnd(r).mathspeak(),f=this.getEnd(e).mathspeak();return this.getEnd(r).ariaLabel="Index",this.getEnd(e).ariaLabel="Radicand",g==="3"?"Start Cube Root, "+f+", End Cube Root":"Root Index "+g+", Start Root, "+f+", End Root"},b.prototype.deleteTowards=function(g,f){St.prototype.deleteTowards.call(this,g,f)},b}(XD);A.nthroot=Gy,A.cbrt=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.createLeftOf=function(g){k.prototype.createLeftOf.call(this,g),new rr("3").createLeftOf(g),g.controller.moveRight()},b}(Gy);var j1=function(k){Pt(b,k);function b(g,f,D){var V=new tt(1,function($){return c("span",{class:"dcg-mq-non-leaf"},[c("span",{class:"dcg-mq-diacritic-above"},[f]),c.block("span",{class:"dcg-mq-diacritic-stem"},$[0])])});return k.call(this,g,V,D)||this}return b}(St);A.vec=function(){return new j1("\\vec",c.entityText("&rarr;"),["vec(",")"])},A.tilde=function(){return new j1("\\tilde",c.text("~"),["tilde(",")"])};var JD=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.setDOM=function(g){var f;k.prototype.setDOM.call(this,g);var D=this.domFrag().children();return D.isEmpty()||(this.delimFrags=(f={},f[r]=D.first(),f[e]=D.last(),f)),this},b}(St),tl=function(k){Pt(b,k);function b(g,f,D,V,$){var te,le=k.call(this,"\\left"+V,void 0,[f,D])||this;return le.side=g,le.sides=(te={},te[r]={ch:f,ctrlSeq:V},te[e]={ch:D,ctrlSeq:$},te),le}return b.prototype.numBlocks=function(){return 1},b.prototype.html=function(){var g=this,f=this.getSymbol(r),D=this.getSymbol(e);return this.domView=new tt(1,function(V){return c("span",{class:"dcg-mq-non-leaf dcg-mq-bracket-container"},[c("span",{style:"width:"+f.width,class:"dcg-mq-scaled dcg-mq-bracket-l dcg-mq-paren"+(g.side===e?" dcg-mq-ghost":"")},[f.html()]),c.block("span",{style:"margin-left:"+f.width+";margin-right:"+D.width,class:"dcg-mq-bracket-middle dcg-mq-non-leaf"},V[0]),c("span",{style:"width:"+D.width,class:"dcg-mq-scaled dcg-mq-bracket-r dcg-mq-paren"+(g.side===r?" dcg-mq-ghost":"")},[D.html()])])}),k.prototype.html.call(this)},b.prototype.getSymbol=function(g){var f=this.sides[g||e].ch;return Kp[f]||{width:"0",html:""}},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+="\\left"+this.sides[r].ctrlSeq,this.getEnd(r).latexRecursive(g),g.latex+="\\right"+this.sides[e].ctrlSeq,this.checkCursorContextClose(g)},b.prototype.mathspeak=function(g){var f=this.sides[r].ch,D=this.sides[e].ch;if(f==="|"&&D==="|")this.mathspeakTemplate=["StartAbsoluteValue,",", EndAbsoluteValue"],this.ariaLabel="absolute value";else if(g&&g.createdLeftOf&&this.side){var V="";return this.side===r?V=this.textTemplate[0]:this.side===e&&(V=this.textTemplate[1]),(this.side===r?"left ":"right ")+Ig[V]}else this.mathspeakTemplate=["left "+Ig[f]+",",", right "+Ig[D]],this.ariaLabel=Ig[f]+" block";return k.prototype.mathspeak.call(this)},b.prototype.matchBrack=function(g,f,D){return D instanceof b&&D.side&&D.side!==-f&&(!g.restrictMismatchedBrackets||Gf[this.sides[this.side].ch]===D.sides[D.side].ch||g.restrictMismatchedBrackets!=="none"&&{"(":"]","[":")"}[this.sides[r].ch]===D.sides[e].ch)&&D},b.prototype.closeOpposing=function(g){g.side=0,g.sides[this.side]=this.sides[this.side];var f=g.delimFrags[this.side===r?r:e].removeClass("dcg-mq-ghost");this.replaceBracket(f,this.side)},b.prototype.createLeftOf=function(g){var f;if(!this.replacedFragment){var D=g.options;this.sides[r].ch==="|"?f=this.matchBrack(D,e,g[e])||this.matchBrack(D,r,g[r])||this.matchBrack(D,0,g.parent.parent):f=this.matchBrack(D,-this.side,g[-this.side])||this.matchBrack(D,-this.side,g.parent.parent)}if(f){var V=this.side=-f.side;this.closeOpposing(f),f===g.parent.parent&&g[V]&&new z(g[V],g.parent.getEnd(V),-V).disown().withDirAdopt(-V,f.parent,f,f[V]).domFrag().insDirOf(V,f.domFrag()),f.bubble(function($){$.reflow()})}else f=this,V=f.side,f.replacedFragment?f.side=0:g[-V]&&(f.replaces(new z(g[-V],g.parent.getEnd(-V),V)),g[-V]=0),k.prototype.createLeftOf.call(this,g);V===r?g.insAtLeftEnd(f.getEnd(r)):g.insRightOf(f)},b.prototype.placeCursor=function(){},b.prototype.unwrap=function(){this.getEnd(r).children().disown().adopt(this.parent,this,this[e]).domFrag().insertAfter(this.domFrag()),this.remove()},b.prototype.deleteSide=function(g,f,D){var V=this.parent,$=this[g],te=V.getEnd(g);if(g===this.side){this.unwrap(),$?D.insDirOf(-g,$):D.insAtDirEnd(g,V);return}var le=D.options,ke=!this.side;if(this.side=-g,this.matchBrack(le,g,this.getEnd(r).getEnd(this.side))){this.closeOpposing(this.getEnd(r).getEnd(this.side));var Xe=this.getEnd(r).getEnd(g);this.unwrap(),Xe&&Xe.siblingCreated(D.options,g),$?D.insDirOf(-g,$):D.insAtDirEnd(g,V)}else{if(this.matchBrack(le,g,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else if(f&&ke){this.unwrap(),$?D.insDirOf(-g,$):D.insAtDirEnd(g,V);return}else{this.sides[g]=QD(this),this.delimFrags[r].removeClass("dcg-mq-ghost"),this.delimFrags[e].removeClass("dcg-mq-ghost");var qe=this.delimFrags[g].addClass("dcg-mq-ghost");this.replaceBracket(qe,g)}if($){var Ue=this.getEnd(r),Xe=Ue.getEnd(g);Ue.domFrag().removeClass("dcg-mq-empty"),new z($,te,-g).disown().withDirAdopt(-g,Ue,Xe,0).domFrag().insAtDirEnd(g,Ue.domFrag().oneElement()),Xe&&Xe.siblingCreated(D.options,g),D.insDirOf(-g,$)}else f?D.insDirOf(g,this):D.insAtDirEnd(g,this.getEnd(r))}},b.prototype.replaceBracket=function(g,f){var D=this.getSymbol(f);if(g.children().replaceWith(P(D.html())),g.oneElement().style.width=D.width,f===r){var V=g.next();V.isEmpty()||(V.oneElement().style.marginLeft=D.width)}else{var $=g.prev();$.isEmpty()||($.oneElement().style.marginRight=D.width)}},b.prototype.deleteTowards=function(g,f){this.deleteSide(-g,!1,f)},b.prototype.finalizeTree=function(){this.getEnd(r).deleteOutOf=function(g,f){this.parent.deleteSide(g,!0,f)},this.finalizeTree=this.intentionalBlur=function(){this.delimFrags[this.side===r?e:r].removeClass("dcg-mq-ghost"),this.side=0}},b.prototype.siblingCreated=function(g,f){f===-this.side&&this.finalizeTree()},b}(JD);function QD(k){var b=k.side,g=k.sides[b];return{ch:Gf[g.ch],ctrlSeq:Gf[g.ctrlSeq]}}var Gf={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},Ig={"&lang;":"angle-bracket","&rang;":"angle-bracket","|":"pipe"};function Y1(k,f,g){var f=f||k,D=Gf[k],V=Gf[f];U[k]=function(){return new tl(r,k,D,f,V)},U[D]=function(){return new tl(e,k,D,f,V)},Ig[k]=Ig[D]=g}Y1("(","","parenthesis"),Y1("[","","bracket"),Y1("{","\\{","brace"),A.langle=function(){return new tl(r,"&lang;","&rang;","\\langle ","\\rangle ")},A.rangle=function(){return new tl(e,"&lang;","&rang;","\\langle ","\\rangle ")},U["|"]=function(){return new tl(r,"|","|","|","|")},A.lVert=function(){return new tl(r,"&#8741;","&#8741;","\\lVert ","\\rVert ")},A.rVert=function(){return new tl(e,"&#8741;","&#8741;","\\lVert ","\\rVert ")},A.left=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.parser=function(){var g=me.regex,f=me.string,D=me.optWhitespace;return D.then(g(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(V){var $=V.replace(/^\\/,"");return V=="\\langle"&&($="&lang;",V=V+" "),V=="\\lVert"&&($="&#8741;",V=V+" "),se.then(function(te){return f("\\right").skip(D).then(g(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(le){var ke=le.replace(/^\\/,"");le=="\\rangle"&&(ke="&rang;",le=le+" "),le=="\\rVert"&&(ke="&#8741;",le=le+" ");var Xe=new tl(0,$,ke,V,le);return Xe.blocks=[te],te.adopt(Xe,0,0),Xe})})})},b}(St),A.right=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.parser=function(){return me.fail("unmatched \\right")},b}(St);var Iy=Kp["("],My=Kp[")"],If=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="\\binom",g.domView=new tt(2,function(f){return c("span",{class:"dcg-mq-non-leaf dcg-mq-bracket-container"},[c("span",{style:"width:"+Iy.width,class:"dcg-mq-paren dcg-mq-bracket-l dcg-mq-scaled"},[Iy.html()]),c("span",{style:"margin-left:"+Iy.width+"; margin-right:"+My.width,class:"dcg-mq-non-leaf dcg-mq-bracket-middle"},[c("span",{class:"dcg-mq-array dcg-mq-non-leaf"},[c.block("span",{},f[0]),c.block("span",{},f[1])])]),c("span",{style:"width:"+My.width,class:"dcg-mq-paren dcg-mq-bracket-r dcg-mq-scaled"},[My.html()])])}),g.textTemplate=["choose(",",",")"],g.mathspeakTemplate=["StartBinomial,","Choose",", EndBinomial"],g.ariaLabel="binomial",g}return b.prototype.finalizeTree=function(){var g=this.getEnd(r),f=this.getEnd(e);this.upInto=f.upOutOf=g,this.downInto=g.downOutOf=f,g.ariaLabel="upper index",f.ariaLabel="lower index"},b}(JD);A.binom=A.binomial=If,A.choose=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.createLeftOf=function(g){bO.prototype.createLeftOf.call(this,g)},b}(If);var yO=function(k){Pt(b,k);function b(){var g=k!==null&&k.apply(this,arguments)||this;return g.ctrlSeq="\\MathQuillMathField",g.domView=new tt(1,function(f){return c("span",{class:"dcg-mq-editable-field"},[c.block("span",{class:"dcg-mq-root-block","aria-hidden":"true"},f[0])])}),g}return b.prototype.parser=function(){var g=this,f=me.string,D=me.regex,V=me.succeed;return f("[").then(D(/^[a-z][a-z0-9]*/i)).skip(f("]")).map(function($){g.name=$}).or(V(void 0)).then(k.prototype.parser.call(this))},b.prototype.finalizeTree=function(g){var f=new No(this.getEnd(r),this.domFrag().oneElement(),g);f.KIND_OF_MQ="MathField",f.editable=!0,f.createTextarea(),f.editablesTextareaEvents(),f.cursor.insAtRightEnd(f.root),Me(f.root);function D(V){if(V.parentNode&&!P(V).hasClass("dcg-mq-root-block")&&D(V.parentNode),V.nodeType===Node.ELEMENT_NODE){var $=V;$.getAttribute("aria-hidden")==="true"&&($.removeAttribute("aria-hidden"),P(V).children().eachElement(function(te){te.setAttribute("aria-hidden","true")}))}}D(this.domFrag().parent().oneElement()),this.domFrag().oneElement().removeAttribute("aria-hidden")},b.prototype.registerInnerField=function(g,f){var D=this.getEnd(r).controller,V=new f(D);g[this.name]=V,g.push(V)},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),this.getEnd(r).latexRecursive(g),this.checkCursorContextClose(g)},b.prototype.text=function(){return this.getEnd(r).text()},b}(St);A.editable=A.MathQuillMathField=yO;var X1=function(k){Pt(b,k);function b(){return k!==null&&k.apply(this,arguments)||this}return b.prototype.setOptions=function(g){function f(){return""}return this.text=g.text||f,this.domView=new tt(0,function(){return c("span",{},[l(g.htmlString||"")])}),this.latex=g.latex||f,this},b.prototype.latexRecursive=function(g){this.checkCursorContextOpen(g),g.latex+=this.latex(),this.checkCursorContextClose(g)},b.prototype.parser=function(){var g=this,f=me.string,D=me.regex,V=me.succeed;return f("{").then(D(/^[a-z][a-z0-9]*/i)).skip(f("}")).then(function($){return f("[").then(D(/^[-\w\s]*/)).skip(f("]")).or(V(void 0)).map(function(te){return g.setOptions(j[$](te))})})},b}(Vt);if(A.embed=X1,window.jQuery){De=ee(1);for(var J1 in De)(function(k,b){typeof b=="function"?(Ge[k]=function(){return Ce(),b.apply(this,arguments)},Ge[k].prototype=b.prototype):Ge[k]=b})(J1,De[J1])}})()});var mY=__dcg_shared_module_exports__['c']((LLe,gY)=>{gY.exports={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}});var bY=__dcg_shared_module_exports__['c']((PLe,fY)=>{var gue=/([\w-]+)|=|(['"])([.\s\S]*?)\2/g,mue=mY();fY.exports=function(r){var e=0,t,o=!0,i={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};return r.replace(gue,function(n){if(n==="="){o=!0,e++;return}o?e===0?((mue[n]||r.charAt(r.length-2)==="/")&&(i.voidElement=!0),i.name=n):(i.attrs[t]=n.replace(/^['"]|['"]$/g,""),t=void 0):(t&&(i.attrs[t]=t),t=n),e++,o=!1}),i}});var xY=__dcg_shared_module_exports__['c']((OLe,yY)=>{var fue=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,bue=bY(),yue=Object.create?Object.create(null):{};function N3(r,e,t,o,i){var n=e.indexOf("<",o),a=e.slice(o,n===-1?void 0:n);/^\s*$/.test(a)&&(a=" "),(!i&&n>-1&&t+r.length>=0||a!==" ")&&r.push({type:"text",content:a})}yY.exports=function(e,t){t||(t={}),t.components||(t.components=yue);var o=[],i,n=-1,a=[],s={},l=!1;return e.replace(fue,function(c,d){if(l){if(c!=="</"+i.name+">")return;l=!1}var p=c.charAt(1)!=="/",u=c.indexOf("<!--")===0,h=d+c.length,m=e.charAt(h),y;p&&!u&&(n++,i=bue(c),i.type==="tag"&&t.components[i.name]&&(i.type="component",l=!0),!i.voidElement&&!l&&m&&m!=="<"&&N3(i.children,e,n,h,t.ignoreWhitespace),s[i.tagName]=i,n===0&&o.push(i),y=a[n-1],y&&y.children.push(i),a[n]=i),(u||!p||i.voidElement)&&(u||n--,!l&&m!=="<"&&m&&(y=n===-1?o:a[n].children,N3(y,e,n,h,t.ignoreWhitespace)))}),!o.length&&e.length&&N3(o,e,0,0,t.ignoreWhitespace),o}});var CY=__dcg_shared_module_exports__['c']((RLe,vY)=>{function xue(r){var e=[];for(var t in r)e.push(t+'="'+r[t]+'"');return e.length?" "+e.join(" "):""}function wY(r,e){switch(e.type){case"text":return r+e.content;case"tag":return r+="<"+e.name+(e.attrs?xue(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?r:r+e.children.reduce(wY,"")+"</"+e.name+">"}}vY.exports=function(r){return r.reduce(function(e,t){return e+wY("",t)},"")}});var EY=__dcg_shared_module_exports__['c']((FLe,SY)=>{SY.exports={parse:xY(),stringify:CY()}});var $re=__dcg_shared_module_exports__['c']((Wre,vU)=>{(function(r){if(typeof Wre=="object"&&typeof vU!="undefined")vU.exports=r();else{var e;typeof window!="undefined"?e=window:typeof global!="undefined"?e=global:typeof self!="undefined"?e=self:e=this,e.Bugsnag=r()}})(function(){var r,e,t,o=["navigation","request","process","log","user","state","error","manual"],i=function(M,B,H){for(var K=H,ie=0,ve=M.length;ie<ve;ie++)K=B(K,M[ie],ie,M);return K},n=function(M,B){return i(M,function(H,K,ie,ve){return B(K,ie,ve)?H.concat(K):H},[])},a=function(M,B){return i(M,function(H,K,ie,ve){return H===!0||K===B},!1)},s=function(M){return Object.prototype.toString.call(M)==="[object Array]"},l=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(M){var B=[],H;for(H in M)Object.prototype.hasOwnProperty.call(M,H)&&B.push(H);if(!l)return B;for(var K=0,ie=c.length;K<ie;K++)Object.prototype.hasOwnProperty.call(M,c[K])&&B.push(c[K]);return B},p=function(M,B){return M===void 0&&(M=1),B===void 0&&(B=1/0),function(H){return typeof H=="number"&&parseInt(""+H,10)===H&&H>=M&&H<=B}},u=function(M){return typeof M=="function"||s(M)&&n(M,function(B){return typeof B=="function"}).length===M.length},h=function(M){return typeof M=="string"&&!!M.length},m={},y=function(){return{unhandledExceptions:!0,unhandledRejections:!0}};m.schema={apiKey:{defaultValue:function(){return null},message:"is required",validate:h},appVersion:{defaultValue:function(){},message:"should be a string",validate:function(M){return M===void 0||h(M)}},appType:{defaultValue:function(){},message:"should be a string",validate:function(M){return M===void 0||h(M)}},autoDetectErrors:{defaultValue:function(){return!0},message:"should be true|false",validate:function(M){return M===!0||M===!1}},enabledErrorTypes:{defaultValue:function(){return y()},message:"should be an object containing the flags { unhandledExceptions:true|false, unhandledRejections:true|false }",allowPartialObject:!0,validate:function(M){if(typeof M!="object"||!M)return!1;var B=d(M),H=d(y());return!(n(B,function(K){return a(H,K)}).length<B.length||n(d(M),function(K){return typeof M[K]!="boolean"}).length>0)}},onError:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:u},onSession:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:u},onBreadcrumb:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:u},endpoints:{defaultValue:function(M){return typeof M=="undefined"?{notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}:{notify:null,sessions:null}},message:"should be an object containing endpoint URLs { notify, sessions }",validate:function(M){return M&&typeof M=="object"&&h(M.notify)&&h(M.sessions)&&n(d(M),function(B){return!a(["notify","sessions"],B)}).length===0}},autoTrackSessions:{defaultValue:function(M){return!0},message:"should be true|false",validate:function(M){return M===!0||M===!1}},enabledReleaseStages:{defaultValue:function(){return null},message:"should be an array of strings",validate:function(M){return M===null||s(M)&&n(M,function(B){return typeof B=="string"}).length===M.length}},releaseStage:{defaultValue:function(){return"production"},message:"should be a string",validate:function(M){return typeof M=="string"&&M.length}},maxBreadcrumbs:{defaultValue:function(){return 25},message:"should be a number \u2264100",validate:function(M){return p(0,100)(M)}},enabledBreadcrumbTypes:{defaultValue:function(){return o},message:"should be null or a list of available breadcrumb types ("+o.join(",")+")",validate:function(M){return M===null||s(M)&&i(M,function(B,H){return B===!1?B:a(o,H)},!0)}},context:{defaultValue:function(){},message:"should be a string",validate:function(M){return M===void 0||typeof M=="string"}},user:{defaultValue:function(){return{}},message:"should be an object with { id, email, name } properties",validate:function(M){return M===null||M&&i(d(M),function(B,H){return B&&a(["id","email","name"],H)},!0)}},metadata:{defaultValue:function(){return{}},message:"should be an object",validate:function(M){return typeof M=="object"&&M!==null}},logger:{defaultValue:function(){},message:"should be null or an object with methods { debug, info, warn, error }",validate:function(M){return!M||M&&i(["debug","info","warn","error"],function(B,H){return B&&typeof M[H]=="function"},!0)}},redactedKeys:{defaultValue:function(){return["password"]},message:"should be an array of strings|regexes",validate:function(M){return s(M)&&M.length===n(M,function(B){return typeof B=="string"||B&&typeof B.test=="function"}).length}},plugins:{defaultValue:function(){return[]},message:"should be an array of plugin objects",validate:function(M){return s(M)&&M.length===n(M,function(B){return B&&typeof B=="object"&&typeof B.load=="function"}).length}},featureFlags:{defaultValue:function(){return[]},message:'should be an array of objects that have a "name" property',validate:function(M){return s(M)&&M.length===n(M,function(B){return B&&typeof B=="object"&&typeof B.name=="string"}).length}}};var w=function(M){for(var B=1;B<arguments.length;B++){var H=arguments[B];for(var K in H)Object.prototype.hasOwnProperty.call(H,K)&&(M[K]=H[K])}return M},S=function(M,B){return i(M,function(H,K,ie,ve){return H.concat(B(K,ie,ve))},[])};function C(){return C=Object.assign?Object.assign.bind():function(M){for(var B=1;B<arguments.length;B++){var H=arguments[B];for(var K in H)Object.prototype.hasOwnProperty.call(H,K)&&(M[K]=H[K])}return M},C.apply(this,arguments)}var v=m.schema,E={releaseStage:w({},v.releaseStage,{defaultValue:function(){return/^localhost(:\d+)?$/.test(window.location.host)?"development":"production"}}),appType:C({},v.appType,{defaultValue:function(){return"browser"}}),logger:w({},v.logger,{defaultValue:function(){return typeof console!="undefined"&&typeof console.debug=="function"?_():void 0}})},_=function(){var M={},B=console.log;return S(["debug","info","warn","error"],function(H){var K=console[H];M[H]=typeof K=="function"?K.bind(console,"[bugsnag]"):B.bind(console,"[bugsnag]")}),M},T=function(){function M(H,K,ie,ve){ve===void 0&&(ve=new Date),this.type=ie,this.message=H,this.metadata=K,this.timestamp=ve}var B=M.prototype;return B.toJSON=function(){return{type:this.type,name:this.message,timestamp:this.timestamp,metaData:this.metadata}},M}(),I=T,P={};(function(M,B){"use strict";typeof r=="function"&&r.amd?r("stackframe",[],B):typeof P=="object"?P=B():M.StackFrame=B()})(this,function(){"use strict";function M(wt){return!isNaN(parseFloat(wt))&&isFinite(wt)}function B(wt){return wt.charAt(0).toUpperCase()+wt.substring(1)}function H(wt){return function(){return this[wt]}}var K=["isConstructor","isEval","isNative","isToplevel"],ie=["columnNumber","lineNumber"],ve=["fileName","functionName","source"],Ee=["args"],Pe=K.concat(ie,ve,Ee);function Ve(wt){if(wt instanceof Object)for(var pr=0;pr<Pe.length;pr++)wt.hasOwnProperty(Pe[pr])&&wt[Pe[pr]]!==void 0&&this["set"+B(Pe[pr])](wt[Pe[pr]])}Ve.prototype={getArgs:function(){return this.args},setArgs:function(wt){if(Object.prototype.toString.call(wt)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=wt},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(wt){if(wt instanceof Ve)this.evalOrigin=wt;else if(wt instanceof Object)this.evalOrigin=new Ve(wt);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var wt=this.getFunctionName()||"{anonymous}",pr="("+(this.getArgs()||[]).join(",")+")",xi=this.getFileName()?"@"+this.getFileName():"",$i=M(this.getLineNumber())?":"+this.getLineNumber():"",tr=M(this.getColumnNumber())?":"+this.getColumnNumber():"";return wt+pr+xi+$i+tr}};for(var lt=0;lt<K.length;lt++)Ve.prototype["get"+B(K[lt])]=H(K[lt]),Ve.prototype["set"+B(K[lt])]=function(wt){return function(pr){this[wt]=!!pr}}(K[lt]);for(var Tt=0;Tt<ie.length;Tt++)Ve.prototype["get"+B(ie[Tt])]=H(ie[Tt]),Ve.prototype["set"+B(ie[Tt])]=function(wt){return function(pr){if(!M(pr))throw new TypeError(wt+" must be a Number");this[wt]=Number(pr)}}(ie[Tt]);for(var gr=0;gr<ve.length;gr++)Ve.prototype["get"+B(ve[gr])]=H(ve[gr]),Ve.prototype["set"+B(ve[gr])]=function(wt){return function(pr){this[wt]=String(pr)}}(ve[gr]);return Ve});var O={};(function(M,B){"use strict";typeof r=="function"&&r.amd?r("error-stack-parser",["stackframe"],B):typeof O=="object"?O=B(P):M.ErrorStackParser=B(M.StackFrame)})(this,function(B){"use strict";var H=/(^|@)\S+\:\d+/,K=/^\s*at .*(\S+\:\d+|\(native\))/m,ie=/^(eval@)?(\[native code\])?$/;return{parse:function(Ee){if(typeof Ee.stacktrace!="undefined"||typeof Ee["opera#sourceloc"]!="undefined")return this.parseOpera(Ee);if(Ee.stack&&Ee.stack.match(K))return this.parseV8OrIE(Ee);if(Ee.stack)return this.parseFFOrSafari(Ee);throw new Error("Cannot parse given Error object")},extractLocation:function(Ee){if(Ee.indexOf(":")===-1)return[Ee];var Pe=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/,Ve=Pe.exec(Ee.replace(/[\(\)]/g,""));return[Ve[1],Ve[2]||void 0,Ve[3]||void 0]},parseV8OrIE:function(Ee){var Pe=Ee.stack.split(`
`).filter(function(Ve){return!!Ve.match(K)},this);return Pe.map(function(Ve){Ve.indexOf("(eval ")>-1&&(Ve=Ve.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var lt=Ve.replace(/^\s+/,"").replace(/\(eval code/g,"("),Tt=lt.match(/ (\((.+):(\d+):(\d+)\)$)/);lt=Tt?lt.replace(Tt[0],""):lt;var gr=lt.split(/\s+/).slice(1),wt=this.extractLocation(Tt?Tt[1]:gr.pop()),pr=gr.join(" ")||void 0,xi=["eval","<anonymous>"].indexOf(wt[0])>-1?void 0:wt[0];return new B({functionName:pr,fileName:xi,lineNumber:wt[1],columnNumber:wt[2],source:Ve})},this)},parseFFOrSafari:function(Ee){var Pe=Ee.stack.split(`
`).filter(function(Ve){return!Ve.match(ie)},this);return Pe.map(function(Ve){if(Ve.indexOf(" > eval")>-1&&(Ve=Ve.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),Ve.indexOf("@")===-1&&Ve.indexOf(":")===-1)return new B({functionName:Ve});var lt=/((.*".+"[^@]*)?[^@]*)(?:@)/,Tt=Ve.match(lt),gr=Tt&&Tt[1]?Tt[1]:void 0,wt=this.extractLocation(Ve.replace(lt,""));return new B({functionName:gr,fileName:wt[0],lineNumber:wt[1],columnNumber:wt[2],source:Ve})},this)},parseOpera:function(Ee){return!Ee.stacktrace||Ee.message.indexOf(`
`)>-1&&Ee.message.split(`
`).length>Ee.stacktrace.split(`
`).length?this.parseOpera9(Ee):Ee.stack?this.parseOpera11(Ee):this.parseOpera10(Ee)},parseOpera9:function(Ee){for(var Pe=/Line (\d+).*script (?:in )?(\S+)/i,Ve=Ee.message.split(`
`),lt=[],Tt=2,gr=Ve.length;Tt<gr;Tt+=2){var wt=Pe.exec(Ve[Tt]);wt&&lt.push(new B({fileName:wt[2],lineNumber:wt[1],source:Ve[Tt]}))}return lt},parseOpera10:function(Ee){for(var Pe=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,Ve=Ee.stacktrace.split(`
`),lt=[],Tt=0,gr=Ve.length;Tt<gr;Tt+=2){var wt=Pe.exec(Ve[Tt]);wt&&lt.push(new B({functionName:wt[3]||void 0,fileName:wt[2],lineNumber:wt[1],source:Ve[Tt]}))}return lt},parseOpera11:function(Ee){var Pe=Ee.stack.split(`
`).filter(function(Ve){return!!Ve.match(H)&&!Ve.match(/^Error created at/)},this);return Pe.map(function(Ve){var lt=Ve.split("@"),Tt=this.extractLocation(lt.pop()),gr=lt.shift()||"",wt=gr.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0,pr;gr.match(/\(([^\)]*)\)/)&&(pr=gr.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var xi=pr===void 0||pr==="[arguments not available]"?void 0:pr.split(",");return new B({functionName:wt,args:xi,fileName:Tt[0],lineNumber:Tt[1],columnNumber:Tt[2],source:Ve})},this)}}});var W=O,X=function(M,B,H,K){var ie=K&&K.redactedKeys?K.redactedKeys:[],ve=K&&K.redactedPaths?K.redactedPaths:[];return JSON.stringify(ne(M,ie,ve),B,H)},x=20,L=25e3,R=8,N="...";function z(M){return M instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(M))}function A(M){return"[Throws: "+(M?M.message:"?")+"]"}function U(M,B){for(var H=0,K=M.length;H<K;H++)if(M[H]===B)return!0;return!1}function pe(M,B){for(var H=0,K=M.length;H<K;H++)if(B.indexOf(M[H])===0)return!0;return!1}function q(M,B){for(var H=0,K=M.length;H<K;H++)if(typeof M[H]=="string"&&M[H].toLowerCase()===B.toLowerCase()||M[H]&&typeof M[H].test=="function"&&M[H].test(B))return!0;return!1}function F(M){return Object.prototype.toString.call(M)==="[object Array]"}function ge(M,B){try{return M[B]}catch(H){return A(H)}}function ne(M,B,H){var K=[],ie=0;function ve(Ee,Pe){function Ve(){return Pe.length>R&&ie>L}if(ie++,Pe.length>x||Ve())return N;if(Ee===null||typeof Ee!="object")return Ee;if(U(K,Ee))return"[Circular]";if(K.push(Ee),typeof Ee.toJSON=="function")try{ie--;var lt=ve(Ee.toJSON(),Pe);return K.pop(),lt}catch(ro){return A(ro)}var Tt=z(Ee);if(Tt){ie--;var gr=ve({name:Ee.name,message:Ee.message},Pe);return K.pop(),gr}if(F(Ee)){for(var wt=[],pr=0,xi=Ee.length;pr<xi;pr++){if(Ve()){wt.push(N);break}wt.push(ve(Ee[pr],Pe.concat("[]")))}return K.pop(),wt}var $i={};try{for(var tr in Ee)if(Object.prototype.hasOwnProperty.call(Ee,tr)){if(pe(H,Pe.join("."))&&q(B,tr)){$i[tr]="[REDACTED]";continue}if(Ve()){$i[tr]=N;break}$i[tr]=ve(ge(Ee,tr),Pe.concat(tr))}}catch(ro){}return K.pop(),$i}return ve(M,[])}function ae(M,B,H,K){if(typeof H=="string"){K===void 0?K=null:K!==null&&typeof K!="string"&&(K=X(K));var ie=B[H];if(typeof ie=="number"){M[ie]={name:H,variant:K};return}M.push({name:H,variant:K}),B[H]=M.length-1}}function j(M,B,H){if(s(B)){for(var K=0;K<B.length;++K){var ie=B[K];ie===null||typeof ie!="object"||ae(M,H,ie.name,ie.variant)}return M}}function oe(M){return S(n(M,Boolean),function(B){var H=B.name,K=B.variant,ie={featureFlag:H};return typeof K=="string"&&(ie.variant=K),ie})}function Y(M,B,H){var K=B[H];typeof K=="number"&&(M[K]=null,delete B[H])}var fe={add:ae,clear:Y,merge:j,toEventApi:oe},ye=function(M){return!!M&&(!!M.stack||!!M.stacktrace||!!M["opera#sourceloc"])&&typeof(M.stack||M.stacktrace||M["opera#sourceloc"])=="string"&&M.stack!==M.name+": "+M.message},Ce=De;function De(M){switch(Object.prototype.toString.call(M)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return M instanceof Error}}var Ge=Ce,Ye=function(M,B,H,K){var ie;if(B){var ve;if(H===null)return ee(M,B);typeof H=="object"&&(ve=H),typeof H=="string"&&(ve=(ie={},ie[H]=K,ie)),ve&&(B==="__proto__"||B==="constructor"||B==="prototype"||(M[B]||(M[B]={}),M[B]=w({},M[B],ve)))}},Q=function(M,B,H){if(typeof B=="string"){if(!H)return M[B];if(M[B])return M[B][H]}},ee=function(M,B,H){if(typeof B=="string"){if(!H){delete M[B];return}B==="__proto__"||B==="constructor"||B==="prototype"||M[B]&&delete M[B][H]}},we={add:Ye,get:Q,clear:ee},Me={};(function(M,B){"use strict";typeof r=="function"&&r.amd?r("stack-generator",["stackframe"],B):typeof Me=="object"?Me=B(P):M.StackGenerator=B(M.StackFrame)})(this,function(M){return{backtrace:function(H){var K=[],ie=10;typeof H=="object"&&typeof H.maxStackSize=="number"&&(ie=H.maxStackSize);for(var ve=arguments.callee;ve&&K.length<ie&&ve.arguments;){for(var Ee=new Array(ve.arguments.length),Pe=0;Pe<Ee.length;++Pe)Ee[Pe]=ve.arguments[Pe];/function(?:\s+([\w$]+))+\s*\(/.test(ve.toString())?K.push(new M({functionName:RegExp.$1||void 0,args:Ee})):K.push(new M({args:Ee}));try{ve=ve.caller}catch(Ve){break}}return K}}});function $e(){return $e=Object.assign?Object.assign.bind():function(M){for(var B=1;B<arguments.length;B++){var H=arguments[B];for(var K in H)Object.prototype.hasOwnProperty.call(H,K)&&(M[K]=H[K])}return M},$e.apply(this,arguments)}var me=function(){function M(H,K,ie,ve,Ee){ie===void 0&&(ie=[]),ve===void 0&&(ve=Re()),this.apiKey=void 0,this.context=void 0,this.groupingHash=void 0,this.originalError=Ee,this._handledState=ve,this.severity=this._handledState.severity,this.unhandled=this._handledState.unhandled,this.app={},this.device={},this.request={},this.breadcrumbs=[],this.threads=[],this._metadata={},this._features=[],this._featuresIndex={},this._user={},this._session=void 0,this._correlation=void 0,this.errors=[Ft(H,K,M.__type,ie)]}var B=M.prototype;return B.addMetadata=function(K,ie,ve){return we.add(this._metadata,K,ie,ve)},B.setTraceCorrelation=function(K,ie){typeof K=="string"&&(this._correlation=$e({traceId:K},typeof ie=="string"?{spanId:ie}:{}))},B.getMetadata=function(K,ie){return we.get(this._metadata,K,ie)},B.clearMetadata=function(K,ie){return we.clear(this._metadata,K,ie)},B.addFeatureFlag=function(K,ie){ie===void 0&&(ie=null),fe.add(this._features,this._featuresIndex,K,ie)},B.addFeatureFlags=function(K){fe.merge(this._features,K,this._featuresIndex)},B.getFeatureFlags=function(){return fe.toEventApi(this._features)},B.clearFeatureFlag=function(K){fe.clear(this._features,this._featuresIndex,K)},B.clearFeatureFlags=function(){this._features=[],this._featuresIndex={}},B.getUser=function(){return this._user},B.setUser=function(K,ie,ve){this._user={id:K,email:ie,name:ve}},B.toJSON=function(){return{payloadVersion:"4",exceptions:S(this.errors,function(K){return w({},K,{message:K.errorMessage})}),severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,request:this.request,breadcrumbs:this.breadcrumbs,context:this.context,groupingHash:this.groupingHash,metaData:this._metadata,user:this._user,session:this._session,featureFlags:this.getFeatureFlags(),correlation:this._correlation}},M}(),rt=function(M){var B={file:M.fileName,method:vt(M.functionName),lineNumber:M.lineNumber,columnNumber:M.columnNumber,code:void 0,inProject:void 0};return B.lineNumber>-1&&!B.file&&!B.method&&(B.file="global code"),B},vt=function(M){return/^global code$/i.test(M)?"global code":M},Re=function(){return{unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}},Xt=function(M){return typeof M=="string"?M:""};function Ft(M,B,H,K){return{errorClass:Xt(M),errorMessage:Xt(B),type:H,stacktrace:i(K,function(ie,ve){var Ee=rt(ve);try{return JSON.stringify(Ee)==="{}"?ie:ie.concat(Ee)}catch(Pe){return ie}},[])}}function Nt(M){return M.cause?[M].concat(Nt(M.cause)):[M]}me.getStacktrace=function(M,B,H){if(ye(M))return W.parse(M).slice(B);try{return n(Me.backtrace(),function(K){return(K.functionName||"").indexOf("StackGenerator$$")===-1}).slice(1+H)}catch(K){return[]}},me.create=function(M,B,H,K,ie,ve){ie===void 0&&(ie=0);var Ee=de(M,B,K,ve),Pe=Ee[0],Ve=Ee[1],lt;try{var Tt=me.getStacktrace(Pe,Ve>0?1+Ve+ie:0,1+ie);lt=new me(Pe.name,Pe.message,Tt,H,M)}catch(xi){lt=new me(Pe.name,Pe.message,[],H,M)}if(Pe.name==="InvalidError"&&lt.addMetadata(""+K,"non-error parameter",Br(M)),Pe.cause){var gr,wt=Nt(Pe).slice(1),pr=S(wt,function(xi){var $i=Ge(xi)&&ye(xi)?W.parse(xi):[],tr=de(xi,!0,"error cause"),ro=tr[0];return ro.name==="InvalidError"&&lt.addMetadata("error cause",Br(xi)),Ft(ro.name,ro.message,me.__type,$i)});(gr=lt.errors).push.apply(gr,pr)}return lt};var Br=function(M){return M===null?"null":M===void 0?"undefined":M},de=function(M,B,H,K){var ie,ve=0,Ee=function(Pe){var Ve=H==="error cause"?"was":"received";K&&K.warn(H+" "+Ve+' a non-error: "'+Pe+'"');var lt=new Error(H+" "+Ve+' a non-error. See "'+H+'" tab for more detail.');return lt.name="InvalidError",lt};if(!B)Ge(M)?ie=M:(ie=Ee(typeof M),ve+=2);else switch(typeof M){case"string":case"number":case"boolean":ie=new Error(String(M)),ve+=1;break;case"function":ie=Ee("function"),ve+=2;break;case"object":M!==null&&Ge(M)?ie=M:M!==null&&se(M)?(ie=new Error(M.message||M.errorMessage),ie.name=M.name||M.errorClass,ve+=1):(ie=Ee(M===null?"null":"unsupported object"),ve+=2);break;default:ie=Ee("nothing"),ve+=2}if(!ye(ie))try{throw ie}catch(Pe){ye(Pe)&&(ie=Pe,ve=1)}return[ie,ve]};me.__type="browserjs";var se=function(M){return(typeof M.name=="string"||typeof M.errorClass=="string")&&(typeof M.message=="string"||typeof M.errorMessage=="string")},He=me,xe=function(M,B,H){var K=0,ie=function(){if(K>=M.length)return H(null,!0);B(M[K],function(ve,Ee){if(ve)return H(ve);if(Ee===!1)return H(null,!1);K++,ie()})};ie()},at=function(M,B,H,K){var ie=function(ve,Ee){if(typeof ve!="function")return Ee(null);try{if(ve.length!==2){var Pe=ve(B);return Pe&&typeof Pe.then=="function"?Pe.then(function(Ve){return setTimeout(function(){return Ee(null,Ve)})},function(Ve){setTimeout(function(){return H(Ve),Ee(null,!0)})}):Ee(null,Pe)}ve(B,function(Ve,lt){if(Ve)return H(Ve),Ee(null);Ee(null,lt)})}catch(Ve){H(Ve),Ee(null)}};xe(M,ie,K)},We=function(M,B,H,K){for(var ie=!1,ve=M.slice();!ie&&ve.length;)try{ie=ve.pop()(B)===!1}catch(Ee){K.error("Error occurred in "+H+" callback, continuing anyway\u2026"),K.error(Ee)}return ie},to=function(B,H){var K="000000000"+B;return K.substr(K.length-H)},Dt=typeof window=="object"?window:self,sa=0;for(var No in Dt)Object.hasOwnProperty.call(Dt,No)&&sa++;var bi=navigator.mimeTypes?navigator.mimeTypes.length:0,tt=to((bi+navigator.userAgent.length).toString(36)+sa.toString(36),4),St=function(){return tt},Vt=0,_e=4,ce=36,Se=Math.pow(ce,_e);function Qe(){return to((Math.random()*Se<<0).toString(ce),_e)}function Fe(){return Vt=Vt<Se?Vt:0,Vt++,Vt-1}function kt(){var M="c",B=new Date().getTime().toString(ce),H=to(Fe().toString(ce),_e),K=St(),ie=Qe()+Qe();return M+B+H+K+ie}kt.fingerprint=St;var It=kt,Kt=function(){function M(){this.id=It(),this.startedAt=new Date,this._handled=0,this._unhandled=0,this._user={},this.app={},this.device={}}var B=M.prototype;return B.getUser=function(){return this._user},B.setUser=function(K,ie,ve){this._user={id:K,email:ie,name:ve}},B.toJSON=function(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}},B._track=function(K){this[K._handledState.unhandled?"_unhandled":"_handled"]+=1},M}(),hr=Kt,rr=fe.add,ir=fe.clear,Rt=fe.merge,yr=function(){},_r=function(){function M(H,K,ie,ve){var Ee=this;K===void 0&&(K=m.schema),ie===void 0&&(ie=[]),this._notifier=ve,this._config={},this._schema=K,this._delivery={sendSession:yr,sendEvent:yr},this._logger={debug:yr,info:yr,warn:yr,error:yr},this._plugins={},this._breadcrumbs=[],this._session=null,this._metadata={},this._featuresIndex={},this._features=[],this._context=void 0,this._user={},this._cbs={e:[],s:[],sp:[],b:[]},this.Client=M,this.Event=He,this.Breadcrumb=I,this.Session=hr,this._config=this._configure(H,ie),S(ie.concat(this._config.plugins),function(lt){lt&&Ee._loadPlugin(lt)}),this._depth=1;var Pe=this,Ve=this.notify;this.notify=function(){return Ve.apply(Pe,arguments)}}var B=M.prototype;return B.addMetadata=function(K,ie,ve){return we.add(this._metadata,K,ie,ve)},B.getMetadata=function(K,ie){return we.get(this._metadata,K,ie)},B.clearMetadata=function(K,ie){return we.clear(this._metadata,K,ie)},B.addFeatureFlag=function(K,ie){ie===void 0&&(ie=null),rr(this._features,this._featuresIndex,K,ie)},B.addFeatureFlags=function(K){Rt(this._features,K,this._featuresIndex)},B.clearFeatureFlag=function(K){ir(this._features,this._featuresIndex,K)},B.clearFeatureFlags=function(){this._features=[],this._featuresIndex={}},B.getContext=function(){return this._context},B.setContext=function(K){this._context=K},B._configure=function(K,ie){var ve=i(ie,function(lt,Tt){return Tt&&Tt.configSchema?w({},lt,Tt.configSchema):lt},this._schema),Ee=i(d(ve),function(lt,Tt){var gr=ve[Tt].defaultValue(K[Tt]);if(K[Tt]!==void 0){var wt=ve[Tt].validate(K[Tt]);wt?ve[Tt].allowPartialObject?lt.config[Tt]=w(gr,K[Tt]):lt.config[Tt]=K[Tt]:(lt.errors[Tt]=ve[Tt].message,lt.config[Tt]=gr)}else lt.config[Tt]=gr;return lt},{errors:{},config:{}}),Pe=Ee.errors,Ve=Ee.config;if(ve.apiKey){if(!Ve.apiKey)throw new Error("No Bugsnag API Key set");/^[0-9a-f]{32}$/i.test(Ve.apiKey)||(Pe.apiKey="should be a string of 32 hexadecimal characters")}return this._metadata=w({},Ve.metadata),Rt(this._features,Ve.featureFlags,this._featuresIndex),this._user=w({},Ve.user),this._context=Ve.context,Ve.logger&&(this._logger=Ve.logger),Ve.onError&&(this._cbs.e=this._cbs.e.concat(Ve.onError)),Ve.onBreadcrumb&&(this._cbs.b=this._cbs.b.concat(Ve.onBreadcrumb)),Ve.onSession&&(this._cbs.s=this._cbs.s.concat(Ve.onSession)),d(Pe).length&&this._logger.warn(Fi(Pe,K)),Ve},B.getUser=function(){return this._user},B.setUser=function(K,ie,ve){this._user={id:K,email:ie,name:ve}},B._loadPlugin=function(K){var ie=K.load(this);K.name&&(this._plugins["~"+K.name+"~"]=ie)},B.getPlugin=function(K){return this._plugins["~"+K+"~"]},B._setDelivery=function(K){this._delivery=K(this)},B.startSession=function(){var K=new hr;K.app.releaseStage=this._config.releaseStage,K.app.version=this._config.appVersion,K.app.type=this._config.appType,K._user=w({},this._user);var ie=We(this._cbs.s,K,"onSession",this._logger);return ie?(this._logger.debug("Session not started due to onSession callback"),this):this._sessionDelegate.startSession(this,K)},B.addOnError=function(K,ie){ie===void 0&&(ie=!1),this._cbs.e[ie?"unshift":"push"](K)},B.removeOnError=function(K){this._cbs.e=n(this._cbs.e,function(ie){return ie!==K})},B._addOnSessionPayload=function(K){this._cbs.sp.push(K)},B.addOnSession=function(K){this._cbs.s.push(K)},B.removeOnSession=function(K){this._cbs.s=n(this._cbs.s,function(ie){return ie!==K})},B.addOnBreadcrumb=function(K,ie){ie===void 0&&(ie=!1),this._cbs.b[ie?"unshift":"push"](K)},B.removeOnBreadcrumb=function(K){this._cbs.b=n(this._cbs.b,function(ie){return ie!==K})},B.pauseSession=function(){return this._sessionDelegate.pauseSession(this)},B.resumeSession=function(){return this._sessionDelegate.resumeSession(this)},B.leaveBreadcrumb=function(K,ie,ve){if(K=typeof K=="string"?K:"",ve=typeof ve=="string"&&a(o,ve)?ve:"manual",ie=typeof ie=="object"&&ie!==null?ie:{},!!K){var Ee=new I(K,ie,ve),Pe=We(this._cbs.b,Ee,"onBreadcrumb",this._logger);if(Pe){this._logger.debug("Breadcrumb not attached due to onBreadcrumb callback");return}this._breadcrumbs.push(Ee),this._breadcrumbs.length>this._config.maxBreadcrumbs&&(this._breadcrumbs=this._breadcrumbs.slice(this._breadcrumbs.length-this._config.maxBreadcrumbs))}},B._isBreadcrumbTypeEnabled=function(K){var ie=this._config.enabledBreadcrumbTypes;return ie===null||a(ie,K)},B.notify=function(K,ie,ve){ve===void 0&&(ve=yr);var Ee=He.create(K,!0,void 0,"notify()",this._depth+1,this._logger);this._notify(Ee,ie,ve)},B._notify=function(K,ie,ve){var Ee=this;if(ve===void 0&&(ve=yr),K.app=w({},K.app,{releaseStage:this._config.releaseStage,version:this._config.appVersion,type:this._config.appType}),K.context=K.context||this._context,K._metadata=w({},K._metadata,this._metadata),K._user=w({},K._user,this._user),K.breadcrumbs=this._breadcrumbs.slice(),Rt(K._features,this._features,K._featuresIndex),this._config.enabledReleaseStages!==null&&!a(this._config.enabledReleaseStages,this._config.releaseStage))return this._logger.warn("Event not sent due to releaseStage/enabledReleaseStages configuration"),ve(null,K);var Pe=K.severity,Ve=function(Tt){Ee._logger.error("Error occurred in onError callback, continuing anyway\u2026"),Ee._logger.error(Tt)},lt=[].concat(this._cbs.e).concat(ie);at(lt,K,Ve,function(Tt,gr){if(Tt&&Ve(Tt),!gr)return Ee._logger.debug("Event not sent due to onError callback"),ve(null,K);Ee._isBreadcrumbTypeEnabled("error")&&M.prototype.leaveBreadcrumb.call(Ee,K.errors[0].errorClass,{errorClass:K.errors[0].errorClass,errorMessage:K.errors[0].errorMessage,severity:K.severity},"error"),Pe!==K.severity&&(K._handledState.severityReason={type:"userCallbackSetSeverity"}),K.unhandled!==K._handledState.unhandled&&(K._handledState.severityReason.unhandledOverridden=!0,K._handledState.unhandled=K.unhandled),Ee._session&&(Ee._session._track(K),K._session=Ee._session),Ee._delivery.sendEvent({apiKey:K.apiKey||Ee._config.apiKey,notifier:Ee._notifier,events:[K]},function(wt){return ve(wt,K)})})},M}(),Fi=function(M,B){var H=new Error(`Invalid configuration
`+S(d(M),function(K){return"  - "+K+" "+M[K]+", got "+$n(B[K])}).join(`

`));return H},$n=function(M){switch(typeof M){case"string":case"number":case"object":return JSON.stringify(M);default:return String(M)}},la=_r,Wi={},yi=["events.[].metaData","events.[].breadcrumbs.[].metaData","events.[].request"];Wi.event=function(M,B){var H=X(M,null,null,{redactedPaths:yi,redactedKeys:B});return H.length>1e6&&(M.events[0]._metadata={notifier:`WARNING!
Serialized payload was `+H.length/1e6+`MB (limit = 1MB)
metadata was removed`},H=X(M,null,null,{redactedPaths:yi,redactedKeys:B})),H},Wi.session=function(M,B){var H=X(M,null,null);return H};var hn={};hn=function(M,B){return B===void 0&&(B=window),{sendEvent:function(H,K){if(K===void 0&&(K=function(){}),M._config.endpoints.notify===null){var ie=new Error("Event not sent due to incomplete endpoint configuration");return K(ie)}var ve=el(M._config,"notify","4",B),Ee=Wi.event(H,M._config.redactedKeys),Pe=new B.XDomainRequest;Pe.onload=function(){K(null)},Pe.onerror=function(){var Ve=new Error("Event failed to send");M._logger.error("Event failed to send\u2026",Ve),Ee.length>1e6&&M._logger.warn("Event oversized ("+(Ee.length/1e6).toFixed(2)+" MB)"),K(Ve)},Pe.open("POST",ve),setTimeout(function(){try{Pe.send(Ee)}catch(Ve){M._logger.error(Ve),K(Ve)}},0)},sendSession:function(H,K){if(K===void 0&&(K=function(){}),M._config.endpoints.sessions===null){var ie=new Error("Session not sent due to incomplete endpoint configuration");return K(ie)}var ve=el(M._config,"sessions","1",B),Ee=new B.XDomainRequest;Ee.onload=function(){K(null)},Ee.open("POST",ve),setTimeout(function(){try{Ee.send(Wi.session(H,M._config.redactedKeys))}catch(Pe){M._logger.error(Pe),K(Pe)}},0)}}};var el=function(M,B,H,K){var ie=JSON.parse(JSON.stringify(new Date)),ve=Bo(M.endpoints[B],K.location.protocol);return ve+"?apiKey="+encodeURIComponent(M.apiKey)+"&payloadVersion="+H+"&sentAt="+encodeURIComponent(ie)},Bo=hn._matchPageProtocol=function(M,B){return B==="http:"?M.replace(/^https:/,"http:"):M},ac=function(M,B){return B===void 0&&(B=window),{sendEvent:function(H,K){K===void 0&&(K=function(){});try{var ie=M._config.endpoints.notify;if(ie===null){var ve=new Error("Event not sent due to incomplete endpoint configuration");return K(ve)}var Ee=new B.XMLHttpRequest,Pe=Wi.event(H,M._config.redactedKeys);Ee.onreadystatechange=function(){if(Ee.readyState===B.XMLHttpRequest.DONE){var Ve=Ee.status;if(Ve===0||Ve>=400){var lt=new Error("Request failed with status "+Ve);M._logger.error("Event failed to send\u2026",lt),Pe.length>1e6&&M._logger.warn("Event oversized ("+(Pe.length/1e6).toFixed(2)+" MB)"),K(lt)}else K(null)}},Ee.open("POST",ie),Ee.setRequestHeader("Content-Type","application/json"),Ee.setRequestHeader("Bugsnag-Api-Key",H.apiKey||M._config.apiKey),Ee.setRequestHeader("Bugsnag-Payload-Version","4"),Ee.setRequestHeader("Bugsnag-Sent-At",new Date().toISOString()),Ee.send(Pe)}catch(Ve){M._logger.error(Ve)}},sendSession:function(H,K){K===void 0&&(K=function(){});try{var ie=M._config.endpoints.sessions;if(ie===null){var ve=new Error("Session not sent due to incomplete endpoint configuration");return K(ve)}var Ee=new B.XMLHttpRequest;Ee.onreadystatechange=function(){if(Ee.readyState===B.XMLHttpRequest.DONE){var Pe=Ee.status;if(Pe===0||Pe>=400){var Ve=new Error("Request failed with status "+Pe);M._logger.error("Session failed to send\u2026",Ve),K(Ve)}else K(null)}},Ee.open("POST",ie),Ee.setRequestHeader("Content-Type","application/json"),Ee.setRequestHeader("Bugsnag-Api-Key",M._config.apiKey),Ee.setRequestHeader("Bugsnag-Payload-Version","1"),Ee.setRequestHeader("Bugsnag-Sent-At",new Date().toISOString()),Ee.send(Wi.session(H,M._config.redactedKeys))}catch(Pe){M._logger.error(Pe)}}}},ca=new Date,op=function(){ca=new Date},bd={name:"appDuration",load:function(M){return M.addOnError(function(B){var H=new Date;B.app.duration=H-ca},!0),{reset:op}}},Ps=function(M){return M===void 0&&(M=window),{load:function(B){B.addOnError(function(H){H.context===void 0&&(H.context=M.location.pathname)},!0)}}},lh=function(B,H){var K="000000000"+B;return K.substr(K.length-H)},Hp=typeof window=="object"?window:self,yd=0;for(var El in Hp)Object.hasOwnProperty.call(Hp,El)&&yd++;var HD=navigator.mimeTypes?navigator.mimeTypes.length:0,fO=lh((HD+navigator.userAgent.length).toString(36)+yd.toString(36),4),K1=function(){return fO},Gg=0,Ty=4,Kp=36,_f=Math.pow(Kp,Ty);function sc(){return lh((Math.random()*_f<<0).toString(Kp),Ty)}function CU(){return Gg=Gg<_f?Gg:0,Gg++,Gg-1}function Tf(){var M="c",B=new Date().getTime().toString(Kp),H=lh(CU().toString(Kp),Ty),K=K1(),ie=sc()+sc();return M+B+H+K+ie}Tf.fingerprint=K1;var W1=Tf,lc="bugsnag-anonymous-id",$1=function(M){try{var B=M.localStorage,H=B.getItem(lc);return H&&/^c[a-z0-9]{20,32}$/.test(H)||(H=W1(),B.setItem(lc,H)),H}catch(K){}},KD=function(M,B){return M===void 0&&(M=navigator),B===void 0&&(B=window),{load:function(H){var K={locale:M.browserLanguage||M.systemLanguage||M.userLanguage||M.language,userAgent:M.userAgent};B&&B.screen&&B.screen.orientation&&B.screen.orientation.type?K.orientation=B.screen.orientation.type:B&&B.document&&(K.orientation=B.document.documentElement.clientWidth>B.document.documentElement.clientHeight?"landscape":"portrait"),H._config.generateAnonymousId&&(K.id=$1(B)),H.addOnSession(function(ie){ie.device=w({},ie.device,K),H._config.collectUserIp||Wp(ie)}),H.addOnError(function(ie){ie.device=w({},ie.device,K,{time:new Date}),H._config.collectUserIp||Wp(ie)},!0)},configSchema:{generateAnonymousId:{validate:function(H){return H===!0||H===!1},defaultValue:function(){return!0},message:"should be true|false"}}}},Wp=function(M){var B=M.getUser();(!B||!B.id)&&M.setUser(M.device.id)},WD=function(M){return M===void 0&&(M=window),{load:function(B){B.addOnError(function(H){H.request&&H.request.url||(H.request=w({},H.request,{url:M.location.href}))},!0)}}},bO={load:function(M){M._sessionDelegate=$D}},$D={startSession:function(M,B){var H=M;return H._session=B,H._pausedSession=null,H._config.enabledReleaseStages!==null&&!a(H._config.enabledReleaseStages,H._config.releaseStage)?(H._logger.warn("Session not sent due to releaseStage/enabledReleaseStages configuration"),H):(H._delivery.sendSession({notifier:H._notifier,device:B.device,app:B.app,sessions:[{id:B.id,startedAt:B.startedAt,user:B._user}]}),H)},resumeSession:function(M){return M._session?M:M._pausedSession?(M._session=M._pausedSession,M._pausedSession=null,M):M.startSession()},pauseSession:function(M){M._pausedSession=M._session,M._session=null}},jD={load:function(M){M._config.collectUserIp||M.addOnError(function(B){B._user&&typeof B._user.id=="undefined"&&delete B._user.id,B._user=w({id:"[REDACTED]"},B._user),B.request=w({clientIp:"[REDACTED]"},B.request)})},configSchema:{collectUserIp:{defaultValue:function(){return!0},message:"should be true|false",validate:function(M){return M===!0||M===!1}}}},YD={};YD.load=function(M){var B=/^(local-)?dev(elopment)?$/.test(M._config.releaseStage);B||!M._isBreadcrumbTypeEnabled("log")||S(XD,function(H){var K=console[H];console[H]=function(){for(var ie=arguments.length,ve=new Array(ie),Ee=0;Ee<ie;Ee++)ve[Ee]=arguments[Ee];M.leaveBreadcrumb("Console output",i(ve,function(Pe,Ve,lt){var Tt="[Unknown value]";try{Tt=String(Ve)}catch(gr){}if(Tt==="[object Object]")try{Tt=JSON.stringify(Ve)}catch(gr){}return Pe["["+lt+"]"]=Tt,Pe},{severity:H.indexOf("group")===0?"log":H}),"log"),K.apply(console,ve)},console[H]._restore=function(){console[H]=K}})};var XD=n(["log","debug","info","warn","error"],function(M){return typeof console!="undefined"&&typeof console[M]=="function"}),Gy=200,j1=5e5,JD=function(M,B){return M===void 0&&(M=document),B===void 0&&(B=window),{load:function(H){if(!H._config.trackInlineScripts)return;var K=B.location.href,ie="",ve=!!M.attachEvent,Ee=ve?M.readyState==="complete":M.readyState!=="loading",Pe=function(){return M.documentElement.outerHTML};ie=Pe();var Ve=M.onreadystatechange;M.onreadystatechange=function(){M.readyState==="interactive"&&(ie=Pe(),Ee=!0);try{Ve.apply(this,arguments)}catch(tr){}};var lt=null,Tt=function(tr){lt=tr},gr=function(){var tr=M.currentScript||lt;if(!tr&&!Ee){var ro=M.scripts||M.getElementsByTagName("script");tr=ro[ro.length-1]}return tr},wt=function(tr){(!Ee||!ie)&&(ie=Pe());var ro=["<!-- DOC START -->"].concat(ie.split(`
`)),da=tr-1,gn=Math.max(da-3,0),Dl=Math.min(da+3,ro.length);return i(ro.slice(gn,Dl),function(pa,Bc,Ay){return pa[gn+1+Ay]=Bc.length<=Gy?Bc:Bc.substr(0,Gy),pa},{})};H.addOnError(function(tr){tr.errors[0].stacktrace=n(tr.errors[0].stacktrace,function(pa){return!/__trace__$/.test(pa.method)});var ro=tr.errors[0].stacktrace[0],da=function(pa){return pa.replace(/#.*$/,"").replace(/\?.*$/,"")};if(!(ro&&ro.file&&da(ro.file)!==da(K))){var gn=gr();if(gn){var Dl=gn.innerHTML;tr.addMetadata("script","content",Dl.length<=j1?Dl:Dl.substr(0,j1)),ro&&ro.lineNumber&&(ro.code=wt(ro.lineNumber))}}},!0);var pr=S(["setTimeout","setInterval","setImmediate","requestAnimationFrame"],function(tr){return tl(B,tr,function(ro){return $i(ro,function(da){return{get:function(){return da[0]},replace:function(gn){da[0]=gn}}})})}),xi=pr[0];S(["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],function(tr){!B[tr]||!B[tr].prototype||!Object.prototype.hasOwnProperty.call(B[tr].prototype,"addEventListener")||(tl(B[tr].prototype,"addEventListener",function(ro){return $i(ro,QD)}),tl(B[tr].prototype,"removeEventListener",function(ro){return $i(ro,QD,!0)}))});function $i(tr,ro,da){return da===void 0&&(da=!1),function(){var gn=[].slice.call(arguments);try{var Dl=ro(gn),pa=Dl.get();if(da&&tr.apply(this,gn),typeof pa!="function")return tr.apply(this,gn);if(pa.__trace__)Dl.replace(pa.__trace__);else{var Bc=gr();pa.__trace__=function(){Tt(Bc),xi(function(){Tt(null)},0);var roe=pa.apply(this,arguments);return Tt(null),roe},pa.__trace__.__trace__=pa.__trace__,Dl.replace(pa.__trace__)}}catch(Ay){}if(tr.apply)return tr.apply(this,gn);switch(gn.length){case 1:return tr(gn[0]);case 2:return tr(gn[0],gn[1]);default:return tr()}}}},configSchema:{trackInlineScripts:{validate:function(H){return H===!0||H===!1},defaultValue:function(){return!0},message:"should be true|false"}}}};function tl(M,B,H){var K=M[B];if(!K)return K;var ie=H(K);return M[B]=ie,K}function QD(M){var B=!!M[1]&&typeof M[1].handleEvent=="function";return{get:function(){return B?M[1].handleEvent:M[1]},replace:function(H){B?M[1].handleEvent=H:M[1]=H}}}var Gf=function(M){return M===void 0&&(M=window),{load:function(B){"addEventListener"in M&&B._isBreadcrumbTypeEnabled("user")&&M.addEventListener("click",function(H){var K,ie;try{K=Y1(H.target),ie=Iy(H.target,M)}catch(ve){K="[hidden]",ie="[hidden]",B._logger.error("Cross domain error when tracking click event. See docs: https://tinyurl.com/yy3rn63z")}B.leaveBreadcrumb("UI click",{targetText:K,targetSelector:ie},"user")},!0)}}},Ig=/^\s*([^\s][\s\S]{0,139}[^\s])?\s*/;function Y1(M){var B=M.textContent||M.innerText||"";return!B&&(M.type==="submit"||M.type==="button")&&(B=M.value),B=B.replace(Ig,"$1"),B.length>140?B.slice(0,135)+"(...)":B}function Iy(M,B){var H=[M.tagName];if(M.id&&H.push("#"+M.id),M.className&&M.className.length&&H.push("."+M.className.split(" ").join(".")),!B.document.querySelectorAll||!Array.prototype.indexOf)return H.join("");try{if(B.document.querySelectorAll(H.join("")).length===1)return H.join("")}catch(ie){return H.join("")}if(M.parentNode.childNodes.length>1){var K=Array.prototype.indexOf.call(M.parentNode.childNodes,M)+1;H.push(":nth-child("+K+")")}return B.document.querySelectorAll(H.join("")).length===1?H.join(""):M.parentNode?Iy(M.parentNode,B)+" > "+H.join(""):H.join("")}var My={};My=function(M){M===void 0&&(M=window);var B={load:function(H){if("addEventListener"in M&&H._isBreadcrumbTypeEnabled("navigation")){var K=function(ie){return function(){return H.leaveBreadcrumb(ie,{},"navigation")}};M.addEventListener("pagehide",K("Page hidden"),!0),M.addEventListener("pageshow",K("Page shown"),!0),M.addEventListener("load",K("Page loaded"),!0),M.document.addEventListener("DOMContentLoaded",K("DOMContentLoaded"),!0),M.addEventListener("load",function(){return M.addEventListener("popstate",K("Navigated back"),!0)}),M.addEventListener("hashchange",function(ie){var ve=ie.oldURL?{from:If(ie.oldURL,M),to:If(ie.newURL,M),state:J1(M)}:{to:If(M.location.href,M)};H.leaveBreadcrumb("Hash changed",ve,"navigation")},!0),M.history.pushState&&X1(H,M.history,"pushState",M,!0),M.history.replaceState&&X1(H,M.history,"replaceState",M)}}};return B};var If=function(M,B){var H=B.document.createElement("A");return H.href=M,""+H.pathname+H.search+H.hash},yO=function(M,B,H,K){var ie=If(M.location.href,M);return{title:H,state:B,prevState:J1(M),to:K||ie,from:ie}},X1=function(M,B,H,K,ie){ie===void 0&&(ie=!1);var ve=B[H];B[H]=function(Ee,Pe,Ve){M.leaveBreadcrumb("History "+H,yO(K,Ee,Pe,Ve),"navigation"),ie&&typeof M.resetEventCount=="function"&&M.resetEventCount(),ve.apply(B,[Ee,Pe].concat(Ve!==void 0?Ve:[]))}},J1=function(M){try{return M.history.state}catch(B){}},k="request",b=function(M,B){M===void 0&&(M=[]),B===void 0&&(B=window);var H=[],K={load:function(ie){if(!ie._isBreadcrumbTypeEnabled("request"))return;var ve=[ie._config.endpoints.notify,ie._config.endpoints.sessions].concat(M);Ee(),lt();function Ee(){if(!(!("addEventListener"in B.XMLHttpRequest.prototype)||!("WeakMap"in B))){var wt=new WeakMap,pr=new WeakMap,xi=B.XMLHttpRequest.prototype.open;B.XMLHttpRequest.prototype.open=function(ro,da){this&&wt.set(this,{method:ro,url:da}),xi.apply(this,arguments)};var $i=B.XMLHttpRequest.prototype.send;B.XMLHttpRequest.prototype.send=function(ro){var da=this,gn=wt.get(this);if(gn){var Dl=pr.get(this);Dl&&(this.removeEventListener("load",Dl.load),this.removeEventListener("error",Dl.error));var pa=new Date,Bc=function(){return Ve(gn.method,gn.url,g(pa))},Ay=function(){return Pe(gn.method,gn.url,da.status,g(pa))};this.addEventListener("load",Ay),this.addEventListener("error",Bc),this&&pr.set(this,{load:Ay,error:Bc})}$i.apply(this,arguments)}}}function Pe(wt,pr,xi,$i){if(pr===void 0){ie._logger.warn("The request URL is no longer present on this XMLHttpRequest. A breadcrumb cannot be left for this request.");return}if(!(typeof pr=="string"&&a(ve,pr.replace(/\?.*$/,"")))){var tr={status:xi,method:String(wt),url:String(pr),duration:$i};xi>=400?ie.leaveBreadcrumb("XMLHttpRequest failed",tr,k):ie.leaveBreadcrumb("XMLHttpRequest succeeded",tr,k)}}function Ve(wt,pr,xi){if(pr===void 0){ie._logger.warn("The request URL is no longer present on this XMLHttpRequest. A breadcrumb cannot be left for this request.");return}typeof pr=="string"&&a(ve,pr.replace(/\?.*$/,""))||ie.leaveBreadcrumb("XMLHttpRequest error",{method:String(wt),url:String(pr),duration:xi},k)}function lt(){if(!(!("fetch"in B)||B.fetch.polyfill)){var wt=B.fetch;B.fetch=function(){var xi=arguments,$i=arguments[0],tr=arguments[1],ro,da=null;return $i&&typeof $i=="object"?(da=$i.url,tr&&"method"in tr?ro=tr.method:$i&&"method"in $i&&(ro=$i.method)):(da=$i,tr&&"method"in tr&&(ro=tr.method)),ro===void 0&&(ro="GET"),new Promise(function(gn,Dl){var pa=new Date;wt.apply(void 0,xi).then(function(Bc){Tt(Bc,ro,da,g(pa)),gn(Bc)}).catch(function(Bc){gr(ro,da,g(pa)),Dl(Bc)})})}}}var Tt=function(wt,pr,xi,$i){var tr={method:String(pr),status:wt.status,url:String(xi),duration:$i};wt.status>=400?ie.leaveBreadcrumb("fetch() failed",tr,k):ie.leaveBreadcrumb("fetch() succeeded",tr,k)},gr=function(wt,pr,xi){ie.leaveBreadcrumb("fetch() error",{method:String(wt),url:String(pr),duration:xi},k)}}};return K},g=function(M){return M&&new Date-M},f={load:function(M){var B=0;M.addOnError(function(H){if(B>=M._config.maxEvents)return M._logger.warn("Cancelling event send due to maxEvents per session limit of "+M._config.maxEvents+" being reached"),!1;B++}),M.resetEventCount=function(){B=0}},configSchema:{maxEvents:{defaultValue:function(){return 10},message:"should be a positive integer \u2264100",validate:function(M){return p(1,100)(M)}}}},D={};D={load:function(M){M.addOnError(function(B){var H=i(B.errors,function(K,ie){return K.concat(ie.stacktrace)},[]);S(H,function(K){K.file=V(K.file)})})}};var V=D._strip=function(M){return typeof M=="string"?M.replace(/\?.*$/,"").replace(/#.*$/,""):M},$=function(M,B){return M===void 0&&(M=window),B===void 0&&(B="window onerror"),{load:function(H){if(!H._config.autoDetectErrors||!H._config.enabledErrorTypes.unhandledExceptions)return;function K(ve,Ee,Pe,Ve,lt){if(Pe===0&&/Script error\.?/.test(ve))H._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{var Tt={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}},gr;if(lt)gr=H.Event.create(lt,!0,Tt,B,1),te(gr.errors[0].stacktrace,Ee,Pe,Ve);else if(typeof ve=="object"&&ve!==null&&(!Ee||typeof Ee!="string")&&!Pe&&!Ve&&!lt){var wt=ve.type?"Event: "+ve.type:"Error",pr=ve.message||ve.detail||"";gr=H.Event.create({name:wt,message:pr},!0,Tt,B,1),gr.originalError=ve,gr.addMetadata(B,{event:ve,extraParameters:Ee})}else gr=H.Event.create(ve,!0,Tt,B,1),te(gr.errors[0].stacktrace,Ee,Pe,Ve);H._notify(gr)}typeof ie=="function"&&ie.apply(this,arguments)}var ie=M.onerror;M.onerror=K}}},te=function(M,B,H,K){M[0]||M.push({});var ie=M[0];!ie.file&&typeof B=="string"&&(ie.file=B),!ie.lineNumber&&le(H)&&(ie.lineNumber=H),ie.columnNumber||(le(K)?ie.columnNumber=K:window.event&&le(window.event.errorCharacter)&&(ie.columnNumber=window.event.errorCharacter))},le=function(M){return typeof M=="number"&&String.call(M)!=="NaN"},ke,Xe=function(M){M===void 0&&(M=window);var B={load:function(H){if(!(!H._config.autoDetectErrors||!H._config.enabledErrorTypes.unhandledRejections)){var K=function(ie){var ve=ie.reason,Ee=!1;try{ie.detail&&ie.detail.reason&&(ve=ie.detail.reason,Ee=!0)}catch(Ve){}var Pe=H.Event.create(ve,!1,{severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}},"unhandledrejection handler",1,H._logger);Ee&&S(Pe.errors[0].stacktrace,qe(ve)),H._notify(Pe,function(Ve){if(Ge(Ve.originalError)&&!Ve.originalError.stack){var lt;Ve.addMetadata("unhandledRejection handler",(lt={},lt[Object.prototype.toString.call(Ve.originalError)]={name:Ve.originalError.name,message:Ve.originalError.message,code:Ve.originalError.code},lt))}})};"addEventListener"in M?M.addEventListener("unhandledrejection",K):M.onunhandledrejection=function(ie,ve){K({detail:{reason:ie,promise:ve}})},ke=K}}};return B},qe=function(M){return function(B){B.file!==M.toString()&&B.method&&(B.method=B.method.replace(/^\s+/,""))}},Ue={},ot="Bugsnag JavaScript",nt="8.0.0",_t="https://github.com/bugsnag/bugsnag-js",Lt=w({},m.schema,E),Mt={_client:null,createClient:function(M){typeof M=="string"&&(M={apiKey:M}),M||(M={});var B=[bd,KD(),Ps(),WD(),f,bO,jD,D,$(),Xe(),My(),Gf(),b(),YD,JD()],H=new la(M,Lt,B,{name:ot,version:nt,url:_t});return H._setDelivery(window.XDomainRequest?hn:ac),H._logger.debug("Loaded!"),H.leaveBreadcrumb("Bugsnag loaded",{},"state"),H._config.autoTrackSessions?H.startSession():H},start:function(M){return Mt._client?(Mt._client._logger.warn("Bugsnag.start() was called more than once. Ignoring."),Mt._client):(Mt._client=Mt.createClient(M),Mt._client)},isStarted:function(){return Mt._client!=null}};return S(["resetEventCount"].concat(d(la.prototype)),function(M){/^_/.test(M)||(Mt[M]=function(){if(!Mt._client)return console.log("Bugsnag."+M+"() was called before Bugsnag.start()");Mt._client._depth+=1;var B=Mt._client[M].apply(Mt._client,arguments);return Mt._client._depth-=1,B})}),Ue=Mt,Ue.Client=la,Ue.Event=He,Ue.Session=hr,Ue.Breadcrumb=I,Ue.default=Mt,Ue})});var PO={showGrid:!0,showXAxis:!0,showYAxis:!0,xAxisStep:0,yAxisStep:0,xAxisScale:"linear",yAxisScale:"linear",xAxisMinorSubdivisions:0,yAxisMinorSubdivisions:0,xAxisArrowMode:"NONE",yAxisArrowMode:"NONE",xAxisLabel:"",yAxisLabel:"",xAxisNumbers:!0,yAxisNumbers:!0,polarMode:!1,polarNumbers:!0,degreeMode:!1,randomSeed:"",restrictGridToFirstQuadrant:!1,userLockedViewport:!1,complex:!1},Nq={threeDMode:!1,worldRotation3D:[],axis3D:[0,0,1],speed3D:0,showPlane3D:!0,showNumbers3D:!0,plane3dOpacity:"",backgroundColor3d:"#FFF",showAxis3D:!0,showAxisLabels3D:!0,showBox3D:!0},ooe={squareAxes:!0},ioe={...Nq,...ooe,product:"graphing",includeFunctionParametersInRandomSeed:!0,hideCustomColors:!1};function Bq(r){return r in Nq}var hc={...PO,...ioe},Uq=Object.keys(PO);function qq(r){return r in PO}var Yy=r=>isFinite(r)&&(r>0||r===0);function noe(r){return r.length===1?`0${r}`:r}function eu(){let r=new Uint8Array(16);if(typeof crypto!="undefined")crypto.getRandomValues(r);else if(typeof msCrypto!="undefined")msCrypto.getRandomValues(r);else return __dcg_shared_module_exports__['j'](Date.now().toString()+Math.random().toString());return Array.prototype.slice.call(r).map(t=>noe(t.toString(16))).join("")}$t();var C1e=function(){{let r="_*_";re.Event.prototype.wasHandled=function(e){e=e||r;let t=this.originalEvent,o=t&&t.handledBy;if(o&&o[e])return!0;if(e!==r)return!1;let i=this.target.closest("[handleEvent]");return i&&i!==this.currentTarget?i.getAttribute("handleEvent")!=="false":!1},re.Event.prototype.handle=function(e){e=e||r;let t=this.originalEvent;if(!t)return;let o=t.handledBy;o||(o=t.handledBy={}),o[e]=!0}}}();var Zc=__dcg_shared_module_exports__['e'](Z());$t();tu();var Vz=r=>$O(r)||r==="localhost",c_=r=>{let{search:e,hostname:t}=typeof location!="undefined"?location:typeof window!="undefined"?window.location:new Location;return Vz(t)?new URLSearchParams(r!=null?r:e):new URLSearchParams},Lz=r=>{let e=c_(r),t=new Map;for(let[o,i]of e)t.set(o,i||"");return t},Xn=(r,e=c_())=>e.get(r)||void 0;var Pz=(r,e=c_())=>{let t=e.get(r)||void 0;return t?parseInt(t,10):void 0},ji=(r,e=c_())=>e.has(r)&&e.get(r)!=="false";var o2=(r,e,t)=>{let o=new URLSearchParams(r);return o.set(e,t),`?${o.toString()}`};function d_(r,e=window.location.toString()){let t=r.toString();t=t.split("&").map(i=>i.replace(/=(true)?$/,"")).join("&");let o=new URL(e);o.search=t,Vz(o.hostname)&&history.replaceState({},"",o.toString())}var ySe=navigator.userAgent.match(/MSIE 8.0/i)!==null,xSe=navigator.userAgent.match(/MSIE 9.0/i)!==null,Rz=navigator.userAgent.match(/MSIE/i)!==null||navigator.userAgent.match(/Trident/i)!==null&&navigator.userAgent.match(/rv:11/i)!==null,wSe=navigator.userAgent.match(/Edge/i)!==null,Rs=navigator.userAgent.match(/iPad/i)!==null,gc=navigator.userAgent.match(/Mobile|Android/i)!==null||ji("forceMobile"),Sh=navigator.userAgent.match(/Android/i)!==null,mc=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)!==null||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,Fz=navigator.userAgent.match(/Chrome/i)!==null,hx=navigator.userAgent.match(/Firefox/i)!==null,p_=navigator.userAgent.match(/^((?!chrome|android).)*safari/i)!==null,qo=navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)!==null,Nz=navigator.platform.match(/(Win32)/i)!==null,Bz=navigator.userAgent.match(/Touch/i)!==null,vSe=navigator.userAgent.match(/Kindle/i)!==null||navigator.userAgent.match(/Silk/i)!==null,CSe=navigator.userAgent.match(/KeyWeb/i)!==null,Eh=window.parent!==window;var i2=mc||Sh||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||ji("forceTouchDevice"),sp=i2,Ch=(()=>{let r=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return r?[parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3]||"0",10)]:null})(),SSe=(()=>{let r=navigator.appVersion.match(/OS X (\d+)_(\d+)_?(\d+)?/);return r?[parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3]||"0",10)]:null})(),ESe=(()=>{let r=navigator.appVersion.match(/Chrom(e|ium)\/([0-9]+)\.([0-9]+)\.?([0-9]+)?/);return r?[parseInt(r[2],10),parseInt(r[3],10),parseInt(r[4]||"0",10)]:null})(),u_=!(!("inputMode"in document.createElement("textarea"))||mc&&Ch&&Ch[0]<15),DSe=(()=>{let r=document.createElement("canvas");return!!(r.getContext&&r.getContext("2d"))})(),gx=window.matchMedia("(prefers-reduced-motion: reduce)").matches||document.location.search.indexOf("prefersReducedMotion")>=0,Uz=()=>document.createElement("video"),kSe=(()=>{let r=Uz();return r.canPlayType&&!!r.canPlayType('video/webm; codecs="vp8, vorbis"')})(),_Se=(async()=>{if(Xn("autoplay")!==void 0)return ji("autoplay");let r=Uz();r.src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAu1tZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTMgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTI4LjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAwZYiEAD//8m+P5OXfBeLGOfKE3xkODvFZuBflHv/+VwJIta6cbpIo4ABLoKBaYTkTAAAC7m1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAPoAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIYdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAPoAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAACgAAAAWgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAD6AAAAAAAAQAAAAABkG1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAEAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAATttaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAD7c3RibAAAAJdzdHNkAAAAAAAAAAEAAACHYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAACgAFoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADFhdmNDAWQACv/hABhnZAAKrNlCjfkhAAADAAEAAAMAAg8SJZYBAAZo6+JLIsAAAAAYc3R0cwAAAAAAAAABAAAAAQAAQAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAC5QAAAAEAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguMTIuMTAw",r.muted=!0,r.playsInline=!0,r.style.display="none";let e=await new Promise(t=>{document.readyState!=="loading"?t(document.body):document.addEventListener("DOMContentLoaded",()=>t(document.body))});e.appendChild(r);try{await r.play()}catch(t){return!1}finally{e.removeChild(r)}return!0})(),Oz,h_=(Oz=window.matchMedia("(forced-colors: active)"))==null?void 0:Oz.matches;var wr={};__dcg_shared_module_exports__['d'](wr,{ALT:()=>l2,BACKSPACE:()=>Wg,CAPSLOCK:()=>d2,CONTROL:()=>s2,DELETE:()=>jz,DOWN:()=>On,END:()=>lp,ENTER:()=>Dh,ESCAPE:()=>Pn,HOME:()=>kh,LEFT:()=>su,META:()=>c2,PAGEDOWN:()=>jg,PAGEUP:()=>$g,RIGHT:()=>lu,SHIFT:()=>h0,SPACEBAR:()=>p2,TAB:()=>_l,UP:()=>Ia,isBacktick:()=>joe,isEnterOrSpace:()=>mx,isHelp:()=>n2,isModifierKey:()=>g0,isRedo:()=>Qf,isSelectAll:()=>$oe,isSwitchPanes:()=>a2,isUndo:()=>Jf,lookup:()=>Be,lookupChar:()=>Ho});var Jf=r=>!r.altKey&&!r.shiftKey&&(r.ctrlKey||r.metaKey)&&(r.key=="z"||r.which==90),Qf=r=>!r.altKey&&(r.ctrlKey||r.metaKey)&&(r.key==="y"||r.which==89||r.shiftKey&&(r.key==="Z"||r.key==="z"||r.which===90)),$oe=r=>!r.altKey&&(r.ctrlKey||r.metaKey)&&(r.key==="a"||r.key==="A"||r.which==65),joe=r=>!r.altKey&&!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&(r.key==="`"||r.which==192),n2=r=>!r.altKey&&(r.ctrlKey||r.metaKey)&&(r.key==="/"||r.which==191),a2=r=>r.key==="F6"||r.key==="f6"||r.which===117||r.keyCode===117,Wg="Backspace",_l="Tab",Dh="Enter",h0="Shift",s2="Control",l2="Alt",c2="Meta",d2="CapsLock",Pn="Esc",p2="Space",$g="PageUp",jg="PageDown",lp="End",kh="Home",su="Left",Ia="Up",lu="Right",On="Down",jz="Del",qz={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",46:"Del",91:"Meta",93:"Meta"},zz={Backspace:Wg,Tab:_l,Enter:Dh,Shift:h0,Control:s2,Alt:l2,Meta:c2,CapsLock:d2,Escape:Pn," ":p2,PageUp:$g,PageDown:jg,End:lp,Home:kh,ArrowLeft:su,ArrowUp:Ia,ArrowRight:lu,ArrowDown:On,Delete:jz},g0=r=>{let e=[h0,l2,s2,d2,c2];return!!r.key&&e.includes(r.key)},mx=r=>Be(r)===Dh||Be(r)===p2,Hz={UIKeyInputUpArrow:Ia,UIKeyInputDownArrow:On,UIKeyInputLeftArrow:su,UIKeyInputRightArrow:lu,UIKeyInputEscape:Pn,UIKeyInputPageUp:$g,UIKeyInputPageDown:jg},u2=["0123456789abcdefghijklmnopqrstuvwxyz","\xBA\xA1\u2122\xA3\xA2\u221E\xA7\xB6\u2022\xAA\xE5\u222B\xE7\u2202 \u0192\xA9\u02D9 \u2206\u02DA\xAC\xB5 \xF8\u03C0\u0153\xAE\xDF\u2020 \u221A\u2211\u2248\xA5\u03A9","\u201A\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB0\xB7\xC5\u0131\xC7\xCE\xB4\xCF\u02DD\xD3\u02C6\xD4\uF8FF\xD2\xC2\u02DC\xD8\u220F\u0152\u2030\xCD\u02C7\xA8\u25CA\u201E\u02DB\xC1\xB8"].map(r=>r.split("")),Kz=u2[0],Wz=u2[1],$z=u2[2],Yz={},Xz={};for(let r=0;r<Kz.length;r++){let e=Kz[r];Wz[r]!==" "&&(Yz[Wz[r]]=e.toUpperCase()),$z[r]!==" "&&(Xz[$z[r]]=e.toUpperCase())}var Be=r=>{if(r.key&&zz[r.key])return zz[r.key];if(r.which&&qz[r.which])return qz[r.which];if(r.key&&Hz[r.key])return Hz[r.key]},Ho=r=>{if(!r.key)return String.fromCharCode(r.which||-1);if(qo&&r.altKey){let e=r.shiftKey?Xz:Yz;if(e[r.key])return e[r.key]}if(r.key.length===1)return r.key.toUpperCase();if(r.key==="Enter")return"\r";if(r.key==="Tab")return"	"};$t();var wi=function(r){if(!r)return;let e=r.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX}},Yi=function(r,e){Object.assign(r.style,e)};function cp(r){return!!(r&&(r.offsetWidth||r.offsetHeight||r.getClientRects().length))}function g_(r){if(document.readyState!=="loading")r();else{let e=function(){document.removeEventListener("DOMContentLoaded",e),r()};document.addEventListener("DOMContentLoaded",e)}}var Yoe=document.location.href.indexOf("dcgDebugTouchTracking=dcgYES")!==-1,Yg,fx;window._touchtracking_id_counter==null&&(window._touchtracking_id_counter=0);window._touchtracking_id_counter+=1;var f0="touchtracking_id_"+window._touchtracking_id_counter,fn=function(r){fx&&(fx.value="("+Date.now()+") "+r+`
`+fx.value)};function Zf(r){if(r.classList.add("dcg-tap-container",f0),mc&&r.style.setProperty("--dcg-minimum-input-font-size","16px"),Yoe){Yg&&Yg.remove(),Yg=document.createElement("div"),Yi(Yg,{position:"absolute",bottom:"10px",right:"10px"});let e=document.createElement("textarea");e.setAttribute("rows","30"),e.setAttribute("cols","40"),Yg.append(e);let t=document.createElement("div");t.id="dcg-touchtracking-debug-copy",t.classList.add("dcg-btn-blue"),t.innerText="COPY LOGS",Yg.append(t),fx=Yg.querySelector("textarea"),r.append(Yg),t.addEventListener("mousedown",()=>{fx&&(fx.select(),document.execCommand("copy"))},!0),fn("monitor touches")}}var xx=0,Dd=1,b0=2,bx=3,Th=4,io=xx,h2={},dp={},_h=[],g2=0,m0=null,f_=null,Xg=!1,m_=null,Jz=Xg,Jg=function(r){let e=document.activeElement;r.type.startsWith("key")?g0(r)||(Xg=!0):r.type.startsWith("pointer")&&(Xg=!1);let t=!!(e&&Gh(e));e&&!e.closest(".dcg-tap-container."+f0)&&(e=null),e!==m_?(m_&&m_.classList.remove("dcg-focus-visible"),e&&(Xg||t)&&e.classList.add("dcg-focus-visible")):Jz!==Xg&&e&&!t&&(Xg?e.classList.add("dcg-focus-visible"):e.classList.remove("dcg-focus-visible")),Jz=Xg,m_=e};document.addEventListener("keydown",Jg,{capture:!0});document.addEventListener("keydown",Jg);document.addEventListener("pointerdown",Jg);document.addEventListener("pointerdown",Jg,{capture:!0});document.addEventListener("focusin",Jg,{capture:!0});document.addEventListener("focusin",Jg);document.addEventListener("focusout",Jg,{capture:!0});document.addEventListener("focusout",Jg);var Qz,fc=[],m2=function(r){if(!(r instanceof Element))return[];let e=r.closest(".dcg-tap-container."+f0);if(!e)return[];let t=r,o=[];for(;t;){if(o.push(t),t===e)return o;t=t.parentNode}return[]},b_=function(r,e){f_=null,io=r,fn("beginMode:"+io),io===Dd?_h=m2(e.originalEvent.touches[0].target):_h=m2(e.target),_h.forEach(t=>{t.classList.add("dcg-depressed")}),_h.forEach(t=>{let o=re(t);o.data({originalScrollTop:o.scrollTop(),originalScrollLeft:o.scrollLeft()})}),dp={}};function Gh(r){let e=["text","password","email","number","url","search"];return r.matches("input")&&e.indexOf(r.type)>=0||r.matches('textarea, [role="textbox"], [contenteditable=true]')||r.classList.contains("dcg-mathquill-input-span")}var wx=function(r){if(!(r instanceof Element))return!1;let e=r.closest(".dcg-tap-container");return e?e.matches(".dcg-tap-container."+f0):!1},Xoe=function(r){return io!==bx&&!Gh(r)&&wx(r)},vx=function(r,e){f_=null;let t=!1;fn("endMode:"+io),document.querySelectorAll(".dcg-depressed").forEach(i=>{i.classList.remove("dcg-depressed")});let o=document.activeElement;if(!nH(r.target)&&o&&Xoe(o))try{o.blur()}catch(i){}if(_h.forEach(i=>{let n=re(i),a=n.data("originalScrollTop")-n.scrollTop(),s=n.data("originalScrollLeft")-n.scrollLeft();(a||s)&&(dp.scroll=!0)}),dp["dcg-tapstart"]===1&&dp["dcg-tapend"]===1&&!dp["dcg-tapcancel"]&&!dp.scroll){fn("potential dcg-tap");let i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;if(r&&!r.device&&i===0&&n===0){fn("event appears to be simulated"),t=!0,io=bx;let l=r.target.getBoundingClientRect();i=(l.left+l.right)/2,n=(l.top+l.bottom)/2}fn("potential dcg-tap coords:"+i+":"+n);let a=!1,s=!1;for(let l of _h){if(a)break;let c;if(typeof l.getBoundingClientRect=="function"&&(c=l.getBoundingClientRect()),typeof l.getAttribute=="function"&&l.getAttribute("tapboundary")==="true"&&(a=!0),!(c&&(i<c.left||n<c.top||i>c.right||n>c.bottom))){f_=l,s=!0,Tl("dcg-tap",r,{target:f_,touches:e.touches,changedTouches:e.changedTouches});break}}fn("result of dcg-tap:  did_dispatch="+s+"  did_escape="+a)}io===Dd||io===Th?m0=setTimeout(()=>{m0=null,g2=new Date().getTime()},1e3):t&&(m0=setTimeout(()=>{m0=null,g2=new Date().getTime()},100)),_h=[],io=xx},yx=function(){return m0||new Date().getTime()-g2<500},rH=function(r){return r.identifier!==void 0?r.identifier:r.pointerId},Zz=function(r){let e=[];for(let t of r)e.push({identifier:rH(t),x:t.pageX,y:t.pageY,screenX:t.screenX,screenY:t.screenY,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY});return e},Tl=function(r,e,t){let o=rH(e),i=Zz(t.touches),n=Zz(t.changedTouches);if(fn("dispatchEvent:"+r),r==="dcg-tapstart")h2[o]={type:r,pageX:n[0].pageX,pageY:n[0].pageY};else if(r==="dcg-tapmove"){let c=n[0],d=h2[o];if(d&&c.pageX===d.pageX&&c.pageY===d.pageY||(io===Dd||io===Th)&&d&&d.type==="dcg-tapstart"&&Math.abs(d.pageX-c.pageX)+Math.abs(d.pageY-c.pageY)<2)return;h2[o]={type:r,pageX:n[0].pageX,pageY:n[0].pageY}}let a=r.toLowerCase();dp[a]===void 0?dp[a]=1:dp[a]+=1;let s=re.event.fix(e.originalEvent);s.type=r,s.device=io===Dd||io===Th?"touch":io===bx?"keyboard":"mouse",s.touches=i,s.changedTouches=n,s.target=t.target?t.target:e.target;let l=s.device!=="keyboard"&&dp["dcg-longhold"]>0;s.wasLongheld=function(){return l},s.preventTap=function(){dp["dcg-tapcancel"]=1},clearTimeout(Qz),s.type==="dcg-tapstart"&&s.device!=="keyboard"&&s.touches.length===1&&(Qz=setTimeout(()=>{Tl("dcg-longhold",e,t)},500)),s.target&&s.target.nodeName&&s.target.nodeName.toLowerCase()==="a"&&s.type==="dcg-tap"&&s.device==="keyboard"&&s.target.click&&s.target.click(),fn("trigger event:"+s.type),re(s.target).trigger(s)},y_=function(r){let e=_h,t=!!_h.length,o=document.querySelectorAll(".dcg-tap-container."+f0+" .dcg-hovered"),i=Array.from(o).filter(wx),n=[],a=[],s=[];r&&m2(r).forEach(l=>{(!t||e.indexOf(l)!==-1)&&(i.indexOf(l)===-1&&s.push(l),n.push(l))});for(let l of i)n.indexOf(l)===-1&&a.push(l);a.forEach(l=>{l&&l.classList.remove("dcg-hovered"),re(l).trigger("tipsyhide")}),s.forEach(l=>{l&&l.classList.add("dcg-hovered"),re(l).trigger("tipsyshow")})},x_=function(r){for(let e of fc)if(e.pointerId===r)return!0;return!1},f2=function(r){for(let e=0;e<fc.length;e++)fc[e].pointerId===r&&fc.splice(e,1)},oH=function(r){io===xx&&b_(Th,r),b2(),y_(null),fc.push(r.originalEvent),Tl("dcg-tapstart",r,{touches:fc,changedTouches:[r.originalEvent]})},eH=function(r){f2(r.originalEvent.pointerId);let e={touches:fc,changedTouches:[r.originalEvent]};Tl("dcg-tapcancel",r,e),fc.length===0&&vx(r,e)},tH=function(r){f2(r.originalEvent.pointerId);let e={touches:fc,changedTouches:[r.originalEvent]};Tl("dcg-tapend",r,e),fc.length===0&&vx(r,e)},w_=function(r){return r.originalEvent.pointerType==="touch"},Cx=function(r,e){r.trim().split(/\s+/).forEach(t=>{let o=Joe?{passive:!1}:void 0;document.addEventListener(t,i=>{fn("document.on:"+i.type),e(re.event.fix(i))},o)})};Cx("pointerdown MSPointerDown",r=>{if(!(io===b0||io===Dd||!w_(r))){if(x_(r.originalEvent.pointerId)){fn("exit. pointer id already exists: "+r.originalEvent.pointerId);return}oH(r)}});Cx("pointermove MSPointerMove",r=>{io===b0||io===Dd||!w_(r)||(x_(r.originalEvent.pointerId)||(fn("pointer id already exists: "+r.originalEvent.pointerId),oH(r)),f2(r.originalEvent.pointerId),fc.push(r.originalEvent),Tl("dcg-tapmove",r,{touches:fc,changedTouches:[r.originalEvent]}))});re(document).on("pointercancel MSPointerCancel",r=>{if(fn("document.on:"+r.type),io!==Th||!w_(r)||!x_(r.originalEvent.pointerId))return;eH(r);let e;for(;e=fc.pop();){let t=re.Event(e,{originalEvent:e});eH(t)}});re(document).on("pointerup MSPointerUp",r=>{if(fn("document.on:"+r.type),io!==Th||!w_(r)||!x_(r.originalEvent.pointerId))return;tH(r);let e;for(;e=fc.pop();){let t=re.Event(e,{originalEvent:e});tH(t)}});var Joe=function(){let r=!1;try{let e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",()=>{},e),window.removeEventListener("test",()=>{},e)}catch(e){}return r}();Cx("touchstart",r=>{io===b0||io===Th||(b2(),io===xx&&b_(Dd,r),y_(null),Tl("dcg-tapstart",r,{touches:r.originalEvent.touches,changedTouches:r.originalEvent.changedTouches}))});Cx("touchmove",r=>{io===Dd&&Tl("dcg-tapmove",r,{touches:r.originalEvent.touches,changedTouches:r.originalEvent.changedTouches})});Cx("touchcancel",r=>{if(io!==Dd)return;let e={touches:r.originalEvent.touches,changedTouches:r.originalEvent.changedTouches};Tl("dcg-tapcancel",r,e),r.originalEvent.touches.length===0&&vx(r,e)});Cx("touchend",r=>{if(io!==Dd)return;let e={touches:r.originalEvent.touches,changedTouches:r.originalEvent.changedTouches};Tl("dcg-tapend",r,e),r.originalEvent.touches.length===0&&vx(r,e)});function iH(){return!!(io===Dd||io===Th||yx())}re(document).on("mousedown",r=>{if(fn("document.on:"+r.type),!(r.button===1||r.button===2)){if(iH()){!r.target.matches("input, textarea, select")&&wx(r.target)&&r.preventDefault(),fn("abort mousedown: "+io+":"+yx());return}b_(b0,r),Tl("dcg-tapstart",r,{touches:[r],changedTouches:[r]})}});var nH=function(r){return!(r instanceof Element)||!wx(r)||r.closest(".dcg-do-blur")||r.closest(".dcg-text-selectable")?!1:!!r.closest(".dcg-do-not-blur")},b2=function(){try{let r=window.getSelection();if((r==null?void 0:r.rangeCount)===1){let e=r.getRangeAt(0).commonAncestorContainer;e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),e&&e.closest(".dcg-text-selectable")&&r.removeAllRanges()}}catch(r){}};re(document).on("mousedown",r=>{fn("document.on:"+r.type),nH(r.target)&&r.preventDefault(),b2()});re(document).on("mouseleave",r=>{if(fn("document.on:"+r.type),io===xx){if(yx()){fn("abort mouseleave: "+io+":"+yx());return}y_(null)}});re(document).on("mousemove",r=>{if(fn("document.on:"+r.type),!(r.button===1||r.button===2)&&!(io===Dd||io===Th)){if(yx()){fn("abort mousemove: "+io+":"+yx());return}y_(r.target),Tl("dcg-tapmove",r,{touches:[r],changedTouches:[r]})}});re(document).on("mouseup",r=>{if(fn("document.on:"+r.type),r.button===1||r.button===2||io!==b0)return;let e={touches:[],changedTouches:[r]};Tl("dcg-tapend",r,e),vx(r,e)});re(document).on("keydown",r=>{if(fn("document.on:"+r.type),!(!mx(r)||!wx(r.target))&&io!==bx){if(r.target.matches('a:not([ontap]), button:not([ontap]), input, textarea, select, [role="textbox"], [contenteditable="true"], summary'))return;r.preventDefault(),b_(bx,r),Tl("dcg-tapstart",r,{touches:[r],changedTouches:[r]})}});re(document).on("keyup",r=>{if(fn("document.on:"+r.type),!mx(r)||!wx(r.target)||io!==bx)return;let e={touches:[],changedTouches:[r]};Tl("dcg-tapend",r,e),vx(r,e)});function y2(){return io!==xx}function aH(){return Xg}var sH={monitor:Zf,isTapActive:y2,elIsTypeable:Gh,shouldIgnoreMouseDown:iH};var HSe=__dcg_shared_module_exports__['e'](lH());$t();var cH=["exp|exponent ln|natural-log log","total length count mean median quantile quartile nCr nPr stats","stdev|standard-deviation stddev|standard-deviation","stdDev|standard-deviation stdevp|standard-deviation-population","stddevp|standard-deviation-population stdDevP|standard-deviation-population mad var|variance","varp|variance-population variance cov|co-variance covp|co-variance-population corr|correlation spearman","lcm mcm gcd mcd gcf mod ceil|ceiling floor round abs|absolute-value min max sign|signum signum sgn","sin|sine cos|cosine tan|tangent csc|co-secant sec|secant cot|co-tangent","sinh|hyperbolic-sine cosh|hyperbolic-cosine tanh|hyperbolic-tangent csch|hyperbolic-co-secant","sech|hyperbolic-secant coth|hyperbolic-co-tangent","arcsin|arc-sine arccos|arc-cosine arctan|arc-tangent arccsc|arc-co-secant arcsec|arc-secant","arccot|arc-co-tangent","arcsinh|hyperbolic-arc-sine arccosh|hyperbolic-arc-cosine arctanh|hyperbolic-arc-co-tangent","arccsch|hyperbolic-arc-co-secant arcsech|hyperbolic-arc-secant","arccoth|hyperbolic-arc-co-tangent","arsinh|hyperbolic-ar-sine arcosh|hyperbolic-ar-cosine artanh|hyperbolic-ar-co-tangent","arcsch|hyperbolic-ar-co-secant arsech|hyperbolic-ar-secant","arcoth|hyperbolic-ar-co-tangent","polygon","distance midpoint","sort shuffle join unique","erf|error-function","TTest|t-test ttest|t-test TScore|t-score tscore|t-score","iTTest|independent-t-test ittest|independent-t-test IndependentTTest","TScore|t-score Tscore|t-score tscore|t-score","normaldist|normal-distribution tdist|t-distribution poissondist|poisson-distribution","binomialdist|binomial-distribution","uniformdist|uniform-distribution","pdf cdf random inverseCdf inversecdf","histogram dotplot boxplot","pdf cdf","rgb hsv","for","width height","with",...__dcg_shared_module_exports__['Q']].join(" "),Qoe=["det|determinant","inv|inverse","transpose","rref|reduced-row-echelon-form","trace"].join(" ");cH+=" "+Qoe;var Zoe="alpha beta sqrt theta phi rho pi tau nthroot cbrt sum prod integral percent infinity infty cross";function Qg(r){r||(r={});let e=[Zoe];return r.disallowAns||e.push("ans"),r.disallowFrac||e.push("frac"),r.additionalCommands&&(e=e.concat(r.additionalCommands)),e.join(" ")}function x2(r){r||(r={});let e=cH;return r.additionalOperators&&r.additionalOperators.length&&(e=`${e} ${r.additionalOperators.join(" ")}`),r.includeGeometryFunctions&&(e+=" "+Object.keys(__dcg_shared_module_exports__['R']).join(" ")),r.include3DFunctions&&(e+=" "+Object.keys(__dcg_shared_module_exports__['V']).join(" ")),e}function eie(){return"for with"}function tie(){let r="ln log";for(let[e,t]of Object.entries(__dcg_shared_module_exports__['T']))t=="Trig"&&(r+=" "+e.replace(/^\\/,""));return r}function Sx(r){return{autoOperatorNames:x2(r),infixOperatorNames:eie(),prefixOperatorNames:tie()}}var dH=window.MathQuill.noConflict().getInterface(3);dH.config({leftRightIntoCmdGoes:"up",sumStartsWithNEquals:!0,supSubsRequireOperand:!0,charsThatBreakOutOfSupSub:"+-=<>*",autoCommands:Qg(),autoSubscriptNumerals:!0,restrictMismatchedBrackets:!0,typingPercentWritesPercentOf:!0,substituteTextarea:function(r){if(!u_&&(mc||Sh)){let t=document.createElement("span");return t.classList.add("dcg-mathquill-input-span"),t.setAttribute("tabindex",r?"0":"-1"),t.setAttribute("role","textbox"),Yi(t,{display:"inline-block",height:"1px",width:"1px"}),t}if(Nz&&Bz){let t=document.createElement("textarea");return t.setAttribute("readonly",""),t.setAttribute("inputmode","none"),t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","none"),t.setAttribute("spellcheck","false"),t.setAttribute("autocomplete","off"),t.setAttribute("tabindex",r?"0":"-1"),re(t).on("keydown",function(){this.readOnly=!1,this.select()}).on("blur",function(){this.readOnly=!0}),t}let e=document.createElement("textarea");return e.setAttribute("inputmode","none"),e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","none"),e.setAttribute("tabindex",r?"0":"-1"),e.setAttribute("spellcheck","false"),e.setAttribute("autocomplete","off"),e},...Sx(),quietEmptyDelimiters:"( [",resetCursorOnBlur:!0,enableDigitGrouping:!0,tripleDotsAreEllipsis:!0,disableAutoSubstitutionInSubscripts:{except:"log"},interpretTildeAsSim:!0});var Hc=dH;function Ex(r){let e=__dcg_shared_module_exports__['X'](r),t=0;for(;!__dcg_shared_module_exports__['Z'](e);)t+=1,e=__dcg_shared_module_exports__['Y'](e);return t}var Dx=class{constructor(e,t,o){this.mathField=e;this.$mathField=t;this.props=o;this.wasFocusedLastUpdate=!1;this.$mathField.on("focusin.view focusout.view",i=>this.onFocusEvent(i))}willUnmount(){this.$mathField.off(".view")}updateMathquillFocused(){var o,i,n,a;if(!this.mathField)return;let e=this.isFocused(),t=this.shouldBeFocused();t&&t!==this.wasFocusedLastUpdate&&(i=(o=this.props).selectOnFocus)!=null&&i.call(o)&&((a=(n=this.mathField).select)==null||a.call(n)),this.wasFocusedLastUpdate=t,e!==t&&(t?this.mathField.focus():this.mathField.blur())}isFocused(){var e;return!!(document.activeElement&&((e=this.mathField)!=null&&e.el().contains(document.activeElement)))}shouldBeFocused(){return this.props.isFocused()}onFocusEvent(e){let t=this.isFocused();t!==this.shouldBeFocused()&&this.props.onFocusedChanged(t,e)}};var i$=__dcg_shared_module_exports__['e'](Z());var xa=__dcg_shared_module_exports__['e'](Z());var _Te=__dcg_shared_module_exports__['e'](Z());var C_={IS_HOVERED:1.25,IS_PRESSED:1.125,IS_GHOSTED:.4},w0={IS_HOVERED:.5,IS_DEPRESSED:.3},w2={IS_GHOSTED:.4},S_={IS_HOVERED:.3,IS_DEPRESSED:.5},E_={IS_GHOSTED:.4},v0=1;Xa();function C0(r){let e=__dcg_shared_module_exports__['sd'](r);if(e.type!=="Assignment")return NaN;if(e._expression.type!=="Constant")return NaN;if(!new __dcg_shared_module_exports__['ie']({enableGeometry:!1,enable3d:!1,scales:void 0,includeFunctionParametersInRandomSeed:!0,isComplexEnabled:!1,customRegressions:!0}).validLHS(e._symbol))return NaN;if(__dcg_shared_module_exports__['Wc'][e._symbol])return NaN;let o=e._expression.asValue();return typeof o=="number"?o:NaN}function oie(r){return __dcg_shared_module_exports__['ic'](r)!==null}var kx=oie;function Qo(r,e){if(/^\s*(\-|\+)?([0-9]+(\.[0-9]+)?)\s*$/.test(r))return parseFloat(r);let o=__dcg_shared_module_exports__['rc'](__dcg_shared_module_exports__['Wc']);return o.trigAngleMultiplier=new __dcg_shared_module_exports__['Vc'](e?Math.PI/180:1),+__dcg_shared_module_exports__['sd'](r).tryGetConcreteTree(__dcg_shared_module_exports__['td'],o).asValue()}function ni(r,e){if(!isFinite(r))return r;if(!isFinite(e))return e;let t=__dcg_shared_module_exports__['Mb'](r,e);if(r>0!=e>0||r===0||e===0)return 0;let o=r>0?1:-1,i=Math.abs(r).toExponential().split("e"),n=Math.abs(e).toExponential().split("e"),a=i[0],s=n[0],l=i[1],c=n[1];if(c!==l)return o*Math.pow(10,Math.max(parseFloat(l),parseFloat(c)));if(a[0]!==s[0])return parseFloat(t.toPrecision(1));let d=1;for(let p=2;p<Math.min(a.length,s.length)&&(d++,a[p]===s[p]);p++);return parseFloat(t.toPrecision(d))}function iie(r){switch(r.type){case"TokenNode":case"Letter":return!0;case"OperatorName":{for(let e of r.arg.args)if(e.type!=="Letter")return!1;return!0}case"Cmd":return __dcg_shared_module_exports__['S'](r.val);default:return!1}}function v2(r){let e;try{e=__dcg_shared_module_exports__['rd'](r)}catch(i){return}if(e.args.length===0||e.args.length>2)return;let t=e.args[0];if(!iie(t))return;let o;if(e.args.length>1){let i=e.args[1];if(i.type!=="SupSub")return;let{sup:n,sub:a}=i;if(n!==void 0||a===void 0)return;for(let s of a.args)if(s.type!=="Letter"&&s.type!=="Digit")return;o=a}return{base:t,subscript:o}}function ol(r){return v2(r)!==void 0}function mH(r){let e=__dcg_shared_module_exports__['rd'](r),t=__dcg_shared_module_exports__['qd'](e);switch(t.type){case"Letter":return t.val;case"Cmd":return t.val;default:return}}function uH(r){return r.replace(/^(\\? )+|(\\? )+$/g,"")}function S0(r){let e=r.indexOf("=");if(e===-1)return;let t=uH(r.slice(0,e));if(ol(t))return t;try{let o=__dcg_shared_module_exports__['rd'](`${t}=0`),i=__dcg_shared_module_exports__['qd'](o);if(i.type==="Comparator"&&i.symbol==="="&&__dcg_shared_module_exports__['nd'](i.args[0])){let n=r.indexOf("\\left(");if(n===-1&&(n=r.indexOf("(")),n===-1)return;let a=uH(r.slice(0,n));if(ol(a))return a}}catch(o){}}function Tx(r,e){let t=v2(e);if(t===void 0)return[];let o=[],i;try{i=__dcg_shared_module_exports__['rd'](r)}catch(n){return o}return _x(i,t,o,{wrapInBraces:!1}),o}function kd(r,e){return Tx(r,e).length!==0}function D_(r,e,t){return v2(t)===void 0?r:C2(r,e,t)}function C2(r,e,t){let o=Tx(r,e);if(o.length===0)return r;let i="",n=0;for(let a of o){if(i+=r.slice(n,a.base.start),/[a-z]$/i.test(i)&&e[0]=="\\"&&t[0]!=="\\"&&(i+=" "),a.wrapInBraces&&(i+="{"),i+=t,n=a.base.end,a.subscript){let s=0,l=0;for(let c=a.subscript.start;c>=0;c--)if(r[c]==="{"&&(s+=1),r[c]==="_"){l=c;break}i+=r.slice(n,l),n=a.subscript.end;for(let c=a.subscript.end;c<r.length&&!(s<=0);c++)r[c]==="}"&&(s-=1,n=c+1)}a.wrapInBraces&&(i+="}")}return i+=r.slice(n,r.length),i}function hH(r,e){if(r.args.length!==e.args.length)return!1;for(let t=0;t<r.args.length;t++){let o=r.args[t],i=e.args[t];if(!(o.type==="Letter"&&i.type==="Letter"&&o.val===i.val)&&!(o.type==="Digit"&&i.type==="Digit"&&o.val===i.val))return!1}return!0}function nie(r,e,t){let o=r.arg.args,i=e.arg.args;if(o.length===i.length){for(let n=0;n<o.length;n++){let a=o[n],s=i[n];if(a.type!=="Digit"||a.type!==s.type||a.val!==s.val)return}t.push({base:e.span,wrapInBraces:!1})}}function _x(r,e,t,{wrapInBraces:o}){let{base:i,subscript:n}=e;for(let a=0;a<r.args.length;a++){let s=a-1>=0?r.args[a-1]:void 0,l=r.args[a],c;if(a+1<r.args.length){let d=r.args[a+1];d.type==="SupSub"&&d.sub!==void 0&&(c=d.sub)}switch(l.type){case"Letter":case"Cmd":if(i.type!==l.type||i.val!==l.val)break;if(n&&c&&hH(n,c))t.push({base:l.span,subscript:c.span,wrapInBraces:o});else if(!n&&!c){if((s==null?void 0:s.type)==="Symbol"&&s.val==="."&&l.type==="Letter"&&(i.val==="x"||i.val==="y"||i.val==="z"))break;t.push({base:l.span,wrapInBraces:o})}break;case"OperatorName":{if(i.type!==l.type||i.arg.args.length!==l.arg.args.length)break;let d=!0;for(let p=0;p<i.arg.args.length;p++){let u=i.arg.args[p],h=l.arg.args[p];if(u.type!=="Letter"||h.type!=="Letter"||u.val!==h.val){d=!1;break}}if(!d)break;n&&c&&hH(n,c)?t.push({base:l.span,subscript:c.span,wrapInBraces:o}):!n&&!c&&t.push({base:l.span,wrapInBraces:o});break}case"Digit":case"Symbol":case"EscapedSymbol":break;case"LeftRight":case"Sqrt":_x(l.arg,e,t,{wrapInBraces:!1});break;case"Frac":_x(l.num,e,t,{wrapInBraces:!1}),_x(l.den,e,t,{wrapInBraces:!1});break;case"SupSub":(s==null?void 0:s.type)==="Cmd"&&__dcg_shared_module_exports__['U'](s.val)&&l.sub&&_x(l.sub,e,t,{wrapInBraces:!gH(l.sub,"_")}),l.sup&&_x(l.sup,e,t,{wrapInBraces:!gH(l.sup,"^")});break;case"TokenNode":{if(i.type!==l.type)break;nie(i,l,t)}break;default:{let d=l;throw new Error("Unexpected token type: "+d.type)}}}}function gH(r,e){for(let t=r.span.start;t>=0;t--){let o=r.span.input[t];if(o===e)break;if(o==="{")return!0}return!1}var E2=1e6;function k_(r){let e=tb(r);if(!e)return!1;switch(e){case"anonymous-function":case"function-reference":case"point-list-reference":case"recursive-function":return!0;case"point-list":return!1}}function tb(r){if(!r||r.type!=="expression")return;let e=r.formula,t=r.formula.recursion,o=r.formula.function_definition,i=xH(r,o);if(t&&t.type==="iterative"&&t.signature.argTypes.length===1&&t.returnType===__dcg_shared_module_exports__['ba']&&r.formula.function_definition&&i!==void 0&&isFinite(i)&&Math.abs(i)<E2)return"recursive-function";if(e.is_tableable&&e.table_info)return pp(r)?e.table_info.by_reference?"point-list-reference":"point-list":e.table_info.by_reference?"function-reference":"anonymous-function"}function fH(r){let e=r.formula.table_info;if(!e)return;let t=[],o=[];if(e.values)for(let i=0;i<e.values.length;i++){let n=e.values[i][0];t.push(isNaN(n)?"":__dcg_shared_module_exports__['je'](n));let a=e.values[i][1];o.push(isNaN(a)?"":__dcg_shared_module_exports__['je'](a))}return{headers:[e.independent_variable,e.dependent_column],values:[t,o]}}function bH(r){let e=r.formula.table_info;if(e)return{headers:[e.dependent_column+".x",e.dependent_column+".y"],values:[[],[]]}}var S2=["-2","-1","0","1","2"];function yH(r){let e=r.formula.table_info;if(e)return e.dependent_column===e.independent_variable?{headers:["x","1x"],values:[S2,[]]}:{headers:[e.independent_variable,e.dependent_column],values:[S2,[]]}}function xH(r,e){var t,o,i;if(e)return(i=(o=(t=r.formula.recursion)==null?void 0:t.recursiveStructure)==null?void 0:o.baseCaseInfo[e])==null?void 0:i.min}function wH(r){let e=r.formula.function_definition,t=r.formula.recursion;if(!e||!t)return;let o=xH(r,e);if(o===void 0)return;let i=[];for(let n=o;n<=o+4;n++)i.push(`${n}`);return{headers:["x",`${__dcg_shared_module_exports__['$b'](e)}\\left(x\\right)`],values:[i,[]]}}function vH(r){let e=r.formula.function_definition;return e?{headers:["x",`${__dcg_shared_module_exports__['$b'](e)}\\left(x\\right)`],values:[S2,[]]}:void 0}var __=class{constructor(e,t){this.cb=e;this.document=t;this.observedAriaLiveElements=new WeakMap;this.destroyed=!1;this.onAriaLabelFocus=e=>{let t=e.target;if(this.isElement(t)){let o=t.getAttribute("aria-label");o&&this.cb(o,"label")}};this.document.documentElement.addEventListener("focus",this.onAriaLabelFocus,!0),this.ariaLiveContentObserver=new MutationObserver(o=>this.handleAriaLiveContentMutations(o)),t.documentElement.querySelectorAll('[aria-live="assertive"]').forEach(o=>this.startObservingAriaLiveElement(o)),this.treeObserver=new MutationObserver(o=>this.handleDocumentTreeMutations(o)),this.treeObserver.observe(t.documentElement,{childList:!0,subtree:!0,attributeFilter:["aria-live"]})}destroy(){this.destroyed=!0,this.document.documentElement.removeEventListener("focus",this.onAriaLabelFocus,!0),this.ariaLiveContentObserver.disconnect()}isObservingElement(e){return!!this.observedAriaLiveElements.get(e)}handleAriaLiveContentMutations(e){var o;let t=new Map;for(let i of e){if(!this.observedAriaLiveElements.get(i.target))continue;let n=t.get(i.target);n||(n=[],t.set(i.target,n)),n.push(i)}for(let[i,n]of t){let a=i.cloneNode(!0),s=[a.textContent||""];for(let l=n.length-1;l>=0;l--){let c=n[l];switch(c.type){case"attributes":{c.attributeName!==null&&a.setAttribute(c.attributeName,c.oldValue||""),s.push(a.textContent||"");break}case"characterData":{c.oldValue!==null&&(a.textContent=c.oldValue),a.textContent&&a.textContent!==s[s.length-1]&&s.push(a.textContent);break}case"childList":{if(c.addedNodes.length>1||c.removedNodes.length>1)throw new Error(`Expected at most one removed node and one added node, but got ${c.removedNodes.length} removed nodes and ${c.addedNodes.length} added nodes`);c.addedNodes.length===1&&((o=a.firstChild)==null||o.remove()),c.removedNodes.length===1&&c.removedNodes.forEach(d=>a.appendChild(d.cloneNode(!0))),a.textContent&&a.textContent!==s[s.length-1]&&s.push(a.textContent);break}}}for(let l of s.reverse())this.cb(l,"alert")}}startObservingAriaLiveElement(e){this.destroyed||e.getAttribute("aria-live")==="assertive"&&(this.observedAriaLiveElements.get(e)||(this.observedAriaLiveElements.set(e,!0),e.textContent&&this.cb(e.textContent,"alert"),this.ariaLiveContentObserver.observe(e,{attributes:!0,characterData:!0,childList:!0,attributeOldValue:!0,characterDataOldValue:!0})))}stopObservingAriaLiveElement(e){this.observedAriaLiveElements.set(e,!1)}handleDocumentTreeMutations(e){for(let t of e)t.addedNodes.forEach(o=>{this.isElement(o)&&o.getAttribute("aria-live")==="assertive"&&this.startObservingAriaLiveElement(o)}),this.isElement(t.target)&&t.attributeName==="aria-live"&&(t.target.getAttribute("aria-live")==="assertive"?this.startObservingAriaLiveElement(t.target):this.stopObservingAriaLiveElement(t.target)),t.removedNodes.forEach(o=>{this.isElement(o)&&(this.stopObservingAriaLiveElement(o),o.querySelectorAll('[aria-live="assertive"]').forEach(i=>this.stopObservingAriaLiveElement(i)))})}isElement(e){var o;let t=(o=this.document.defaultView)==null?void 0:o.Element;return t?e instanceof t:!1}};var cu,T_=[],CH="",aie;function Rn(){cu&&(cu.textContent="")}function Bt(r){T_.push(r)}function Te(r){if(r!==void 0&&Bt(r),cu&&T_.length>0){let e=T_.join(" ").replace(/ +(?= )/g,"");cu.setAttribute("aria-relevant",CH===e&&qo?"all":"additions text"),cu.textContent=e,CH=e}T_.length=0}function sie(){cu=document.createElement("p"),cu.setAttribute("aria-live","assertive"),cu.setAttribute("aria-atomic","true"),cu.classList.add("dcg-aria-alert"),document.body.appendChild(cu),ji("logAria")&&(aie=new __((r,e)=>__dcg_shared_module_exports__['g'].log(`[aria ${e}] ${r}`),document))}g_(sie);function lie(r){return r.replace(new RegExp("(?<!\\\\left|\\\\sqrt)(\\[|\\(|\\\\\\{)","g"),"\\left$1").replace(new RegExp("(?<!\\\\right)(\\]|\\)|\\\\\\})(?!{)","g"),"\\right$1")}function cie(r){return r.replace(/\\ |\\space(?![a-zA-Z])/g," ")}function G_(r){if(!r||r.args.length===0)return;let e=r.args[r.args.length-1];switch(e.isTrailing=!0,e.type){case"Sqrt":case"LeftRight":G_(e.arg);break;case"Frac":G_(e.num),G_(e.den);break;case"TokenNode":case"SupSub":case"Other":break;default:}}function D2(r){return{type:"Other",originalType:r.type,val:r.val}}function die(r){switch(r.type){case"Cmd":{if(!__dcg_shared_module_exports__['S'](r.val))return D2(r);let e=r.val.match(/^\\([a-zA-Z]+)/);if(!e)return D2(r);let t=e[1],o=[];for(let i of t)o.push({type:"Other",originalType:"Letter",val:i});return o}case"OperatorName":return du(r.arg).args;case"EscapedSymbol":case"Letter":case"Digit":case"Symbol":return D2(r);case"Sqrt":return{type:"Sqrt",optArg:r.optArg&&du(r.optArg),arg:du(r.arg)};case"Frac":return{type:"Frac",num:du(r.num),den:du(r.den)};case"TokenNode":return{type:"TokenNode",arg:du(r.arg)};case"SupSub":return{type:"SupSub",sup:r.sup&&du(r.sup),sub:r.sub&&du(r.sub),nprimes:r.nprimes};case"LeftRight":return{type:"LeftRight",left:r.left,right:r.right,arg:du(r.arg)};default:throw new Error(`Programming Error: Invalid atom type ${r.type}`)}}function du(r){let e=[];for(let t of r.args){let o=die(t);Array.isArray(o)?e.push(...o):e.push(o)}return{type:"Group",args:e}}function SH(r){try{let e=lie(cie(r)),t=__dcg_shared_module_exports__['rd'](e);return du(t)}catch(e){return}}function DH(r){let e=SH(r);if(e===void 0)return()=>!1;let t=e;G_(t);function o(i){let n=SH(i);return n===void 0?!1:tm(t,n)}return o}function tm(r,e){if(!e)return!1;for(let t=0;t<e.args.length;t++)if(kH(r,e,t)||pie(r,e.args[t]))return!0;return!1}function pie(r,e){switch(e.type){case"Sqrt":return tm(r,e.arg)||tm(r,e.optArg);case"Frac":return tm(r,e.num)||tm(r,e.den);case"SupSub":return tm(r,e.sup)||tm(r,e.sub);case"LeftRight":return tm(r,e.arg);case"TokenNode":return!1;case"Other":return!1;default:throw new Error(`Programming Error: Invalid atom type ${e.type}`)}}function kH(r,e,t){if(r.args.length>e.args.length-t)return!1;for(let o=0;o<r.args.length;o++)if(!uie(r.args[o],e.args[o+t]))return!1;return!0}function em(r,e,t){return!r&&!e?!0:!r||!e?!1:r.args.length===0?!0:r.args.length>e.args.length||!(t!=null&&t.allowPrefix)&&r.args.length<e.args.length?!1:kH(r,e,0)}function uie(r,e){let t=!!r.isTrailing;switch(r.type){case"Sqrt":return e.type==="Sqrt"&&em(r.optArg,e.optArg)&&em(r.arg,e.arg);case"Frac":return e.type==="Frac"&&em(r.num,e.num)&&em(r.den,e.den);case"SupSub":return e.type==="SupSub"&&r.nprimes<=e.nprimes&&(!r.sup||em(r.sup,e.sup))&&em(r.sub,e.sub,{allowPrefix:t});case"LeftRight":return e.type==="LeftRight"&&EH(r.left,e.left)&&EH(r.right,e.right)&&em(r.arg,e.arg,{allowPrefix:t});case"TokenNode":return e.type==="TokenNode"&&em(r.arg,e.arg);case"Other":return r.type===e.type&&r.val===e.val}}function EH(r,e){return r.type===e.type&&r.val===e.val}function hie(r){return r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}function _H(r){let e=hie(r);return e=e.replace(/\\\\ /g,"\\\\? "),e=e.replace(/\\\\([A-Za-z]+) ?/g,"\\\\?$1 ?"),new RegExp(e)}var TH={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function _2(r){let e=[],t=r.toLowerCase();if(t.slice(0,3)==="rgb")try{e=t.replace(/[^\d,]/g,"").split(",").slice(0,3).map(o=>parseInt(o,10))}catch(o){k2(r)}else if(t[0]==="#"){let o=/^#?([a-f\d])([a-f\d])([a-f\d])$/;t=t.replace(o,(i,n,a,s)=>n+n+a+a+s+s);try{e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/.exec(t).slice(1).map(i=>parseInt(i,16))}catch(i){k2(r)}}else e=TH[t];return gie(e)||k2(r),{R:e[0],G:e[1],B:e[2]}}function gie(r){return!__dcg_shared_module_exports__['L'](r)||r.length!==3?!1:__dcg_shared_module_exports__['n'](r,e=>Number.isInteger(e)&&e>=0&&e<=255)}function k2(r){throw new Error("Invalid color string: "+r)}function GH(r){let e=r.R/255,t=r.G/255,o=r.B/255,i=[];return i[0]=.49*e+.31*t+.2*o,i[1]=.17697*e+.8124*t+.01063*o,i[2]=.01*t+.99*o,i=__dcg_shared_module_exports__['l'](i,n=>n/.17697),{X:i[0],Y:i[1],Z:i[2]}}function IH(r){let i=r.X,n=r.Y,a=r.Z,s=[];return s[0]=116*E0(n/100)-16,s[1]=500*(E0(i/95.047)-E0(n/100)),s[2]=200*(E0(n/100)-E0(a/108.883)),{L:s[0],a:s[1],b:s[2]}}function E0(r){let e=.20689655172413793;return r>Math.pow(e,3)?Math.pow(r,1/3):r/(3*e*e)+4/29}function mie(r,e){let l=r.L,c=r.a,d=r.b,p=e.L,u=e.a,h=e.b,m=l-p,y=Math.sqrt(c*c+d*d),w=Math.sqrt(u*u+h*h),S=y-w,C=c-u,v=d-h,E=Math.sqrt(C*C+v*v-S*S),_=1+.045*y,T=1+.015*y,I=m/(1*1),P=S/(1*_),O=E/(1*T);return Math.sqrt(I*I+P*P+O*O)}function fie(r,e){let t=IH(GH(_2(r))),o=IH(GH(_2(e)));return mie(t,o)}function MH(r,e){let t=__dcg_shared_module_exports__['l'](e,i=>fie(r,i)),o=__dcg_shared_module_exports__['s'](t);return e[t.indexOf(o)]}function bie({R:r,G:e,B:t}){return .2126729*(r/255)**2.4+.7151522*(e/255)**2.4+.072175*(t/255)**2.4}var T2=.342;function G2(r,e=!1,t=T2){if(typeof r!="string"||!r)return!1;try{let o=_2(r);return bie(o)>t?!e:e}catch(o){return!1}}var VH={folderId:"",secret:!1,readonly:!1},ob={latex:"",color:"",hidden:!1,values:[],points:!0,lines:!1,dragMode:"NONE",pointStyle:"POINT",lineStyle:"SOLID",colorLatex:"",lineOpacity:"",lineWidth:"",pointOpacity:"",pointSize:"",disableGraphInteractions:!1};function I_(r){let e=(r.columns||[]).map(t=>({...ob,...t}));return{...VH,...r,columns:e}}function LH(r){return r={...r,columns:r.columns.map(e=>__dcg_shared_module_exports__['lb'](ob,e))},__dcg_shared_module_exports__['lb'](VH,r)}function M_(r){return{type:"table",id:r.id,columns:r.columns.map(t=>({...t,tableId:r.id})),regression:r.regression}}function PH(r,e){let t=__dcg_shared_module_exports__['vc'](r),o=__dcg_shared_module_exports__['vc'](e);if(!__dcg_shared_module_exports__['Rb'](t.n/t.d,r)||!__dcg_shared_module_exports__['Rb'](o.n/o.d,e))return;let i=__dcg_shared_module_exports__['xc'](t.d,o.d),n=t.n*(i/t.d),s=o.n*(i/o.d)-n;return{nstart:n,nstep:s,lcm:i}}function wie(r){return isFinite(r)?__dcg_shared_module_exports__['_b'](r,{digits:8,bigCutoff:1e6,smallCutoff:.001}):"\\mathrm{undefined}"}function vie(r){return!isFinite(r[0])||!isFinite(r[1])?"\\mathrm{undefined}":__dcg_shared_module_exports__['cc'](r,{digits:5,bigCutoff:1e6,smallCutoff:.001})}function Cie(r){return Array.isArray(r)?r[1]!==0:!1}function RH(r){return r.length>=1&&r.every(Cie)}function Sie(r,e,t,o){let i=r.columnModels[e];i.error=t.error,i.computed=t.computed&&!!i.latex,i.draggable=!t.error&&!t.computed,i.dependsOnRegression=!!t.depends_on_regression,i.packedErrors=[],i.computedValues=[],i.hasNanOrErrorValue=!1,i.hasComplexValue=!1;for(let n=t.values.length-1;n>=0;n--){let a=t.values[n];typeof a=="number"?(i.computedValues[n]=wie(a),isNaN(a)&&(i.hasNanOrErrorValue=!0)):Array.isArray(a)?(i.computedValues[n]=vie(a),(isNaN(a[0])||isNaN(a[1]))&&(i.hasNanOrErrorValue=!0),a[1]!==0&&(i.hasComplexValue=!0)):(i.computedValues[n]="",i.packedErrors[n]=a,i.hasNanOrErrorValue=!0)}if(i.suppressIcon=o||e>0&&RH(t.values),t.plotted&&!i.suppressIcon)for(let n=0;n<t.values.length;n++){if(i.packedErrors[n])continue;let a=t.values[n];Array.isArray(a)&&a[1]!==0&&!isNaN(a[1])&&(i.packedErrors[n]=__dcg_shared_module_exports__['pc']().getError())}}function FH(r){let e=ys(r);if(!e)return;let t=ib(r);if(!t){r.isExpanded||Mx(r,!0);return}e.row>=t.min&&e.row<t.max&&Mx(r,!0)}function ib(r){if(r.isExpanded)return;let e=Kc(r);if(!(e<30))return{min:8,max:e-4}}function NH(r,e){let t=r.columnModels[e];return{values:t.values.slice(),dragMode:t.dragMode,hidden:t.hidden,id:t.id,color:t.color,points:t.points,lines:t.lines,pointStyle:t.pointStyle,lineStyle:t.lineStyle,latex:t.latex,colorLatex:t.colorLatex,lineOpacity:t.lineOpacity,lineWidth:t.lineWidth,pointSize:t.pointSize,pointOpacity:t.pointOpacity,disableGraphInteractions:t.disableGraphInteractions}}var Eie=0;function Die(){return"table_guid_"+Eie++}function kie(r,e,t){r.columnModels[e].values.splice(t,0,"")}function _ie(r,e,t){r.columnModels[e].values.splice(t,1)}function BH(r,e,t){let{color:o}=t;(!o||!kx(o))&&(o=r.controller.getNextColor());let i={...t,type:"table-column",guid:Die(),index:e,error:void 0,table:r,color:o,packedErrors:[],computedValues:[],shouldGraph:void 0,computed:void 0,draggable:void 0,hasNanOrErrorValue:!1,dependsOnRegression:!1,hasComplexValue:!1,suppressIcon:!1};return e===0&&(i.hidden=!0),i}function k0(r,e){let t=r.table.formula;if(!t)return!1;let o=t.column_data[r.index];return o?!!o[e]:!1}function UH(r){return k0(r,"color_latex_valid")}function qH(r){return k0(r,"line_opacity_valid")}function zH(r){return k0(r,"line_width_valid")}function HH(r){return k0(r,"point_size_valid")}function KH(r){return k0(r,"point_opacity_valid")}function WH(r){let e=r.table.formula;if(!e)return;let t=e.column_data[r.index];if(t)return t.color_latex_value}function $H(r){r.draggingOnGraphpaper?r.preTransientState||(r.preTransientState={columns:Vx(r,{stripDefaults:!1}).columns}):delete r.preTransientState,uu(r);let e=il(r),t=e&&e.hidden;__dcg_shared_module_exports__['k'](r.columnModels,o=>{o.shouldGraph=!t&&!o.hidden&&!r.controller.is3dProduct()}),Gie(r),Iie(r),Tie(r)}function Kc(r){let e=2,t,o=ys(r);return o&&o.row>e&&(e=o.row),r.columnModels.forEach(i=>{t=i.computed?i.computedValues.length:i.values.length+1,t>e&&(e=t)}),e}function Ax(r){return r.columnModels.length}function jH(r,e){var o;r.formula=e;let t=r.controller.is3dProduct()||RH(e.column_data[0].values);for(let i=0;i<e.column_data.length&&i<Ax(r);i++){let n=e.column_data[i];Sie(r,i,n,t)}((o=e.table_regression)==null?void 0:o.status)==="success"&&r.regression&&(r.regression.residualVariable=e.table_regression.result.residualVariable)}function I2(r,e){for(let t=0;t<r.columnModels.length;t++)kie(r,t,e)}function YH(r,e){let t=ib(r);t&&e===t.max-1&&Mx(r,!0);for(let o=0;o<r.columnModels.length;o++)_ie(r,o,e),o>0&&h6(r.columnModels[o])}function A_(r,e){let t={id:r.controller.generateId(),latex:e?e.latex:"",color:r.controller.getNextColor()},o=e?e.columnIndex:r.columnModels.length,i={...ob,...t,values:[]},n=BH(r,o,i);r.columnModels.splice(o,0,n);for(let a=o+1;a<r.columnModels.length;a++)r.columnModels[a].index=a}function _0(r,e){var o;let[t]=r.columnModels.splice(e,1);for(let i=e;i<r.columnModels.length;i++)r.columnModels[i].index=i;t&&((o=r.regression)==null?void 0:o.columnIds.y)===t.id&&I0(r,void 0)}function XH(r,e){let t,o=r.columnModels.length,i=[];for(t=0;t<o;t++)i.push("");let n=r.columnModels[0].values;if(e>1){let a=r.controller.getDegreeMode(),s=Qo(n[0],a),l=Qo(n[1],a);if(isFinite(s)&&isFinite(l)){let c=PH(s,l);if(c){let d=c.nstart,p=d/c.lcm;for(t=0;t<e;t++){let u=Qo(n[t],a);if(!__dcg_shared_module_exports__['Rb'](u,p))return i;d+=c.nstep,p=d/c.lcm}(""+s).length<8&&(""+l).length<8?i[0]=""+p:i[0]="\\frac{"+d+"}{"+c.lcm+"}"}}}return i}function T0(r,e,t){for(let o=0;o<r.columnModels.length;o++){let i=r.columnModels[o],n={cellLocation:{column:o,row:0}};if(e(i.latex,"tableHeader",n),t!=null&&t.headersOnly)continue;e(i.colorLatex,"tableColumnColorLatex",n),e(i.pointSize,"tableColumnPointSize",n),e(i.pointOpacity,"tableColumnPointOpacity",n),e(i.lineWidth,"tableColumnLineWidth",n),e(i.lineOpacity,"tableColumnLineOpacity",n);let a=r.columnModels[o];for(let s=0;s<a.values.length;s++)a.values[s]&&e(a.values[s],"tableCellValue",{cellLocation:{column:o,row:s+1}})}}function Tie(r){let e=M_({type:"table",id:r.id,secret:r.secret,readonly:r.readonly,folderId:r.folderId,columns:r.columnModels.map(o=>NH(r,o.index)),regression:__dcg_shared_module_exports__['i'](r.regression)});for(let o=0;o<e.columns.length;o++)e.columns[o].hidden=!r.columnModels[o].shouldGraph;r.cachedParsableState=e;let t=r.regression;if(e.regression&&t){let o=il(r);o&&o.hidden&&(e.regression={...e.regression,hidden:!0})}}function JH(r){return r.slice(0,r.length-1)}function Vx(r,e){let t={...r.cachedViewState,columns:JH(r.cachedViewState.columns)};return e.stripDefaults?LH(t):(t.regression===void 0&&delete t.regression,t)}function Gie(r){let e=r.columnModels.map((t,o)=>NH(r,o));r.cachedViewState={id:r.id,type:r.type,folderId:r.folderId,columns:e,secret:r.secret,readonly:r.readonly,regression:__dcg_shared_module_exports__['i'](r.regression)}}function M2(r,e){r.draggingOnGraphpaper=e}function Iie(r){let e={...r.cachedViewState,columns:JH(r.cachedViewState.columns),regression:__dcg_shared_module_exports__['i'](r.regression)};r.cachedUndoRedoFullState=e,r.preTransientState&&(e={...e,...r.preTransientState}),r.cachedUndoRedoDiffState=e}var Mie={id:!1,type:!1,columns:!1,regression:!0,folderId:!0,secret:!0,readonly:!0,disableGraphInteractions:!0};function QH(r,e){__dcg_shared_module_exports__['qb']({from:e,to:r,props:Mie}),e6(r,e.columns)}function ZH(r,e){let t=__dcg_shared_module_exports__['i'](I_(r)),o={...t,...pu(e),columnModels:void 0,formula:void 0,draggingOnGraphpaper:!1,cachedViewState:{},cachedParsableState:{},cachedUndoRedoDiffState:{},cachedUndoRedoFullState:{},isExpanded:!1};return e6(o,t.columns),o}function e6(r,e){r.columnModels=e.map((t,o)=>BH(r,o,t)),A_(r)}var OH=["x","y","z","u","v","w"];function A2(r,e,t){let o=[],i=Math.min(e.length,OH.length);for(let n=0;n<i;n++)o.push({id:t.generateId(),latex:__dcg_shared_module_exports__['$b'](OH[n]+"_"+r),values:e[n],color:t.getNextColor(),hidden:!1,points:!0,lines:!1,dragMode:"NONE",pointStyle:"POINT",lineStyle:"SOLID",colorLatex:"",lineWidth:"",lineOpacity:"",pointOpacity:"",pointSize:"",disableGraphInteractions:!1});return{id:t.generateId(),type:"table",folderId:"",secret:!1,readonly:!1,columns:o}}function t6(r,e){let t=Vx(r,{stripDefaults:!1});if(!t.columns||!e.columns)return e;for(let o=0;o<e.columns.length;o++){let i=t.columns[o],n=e.columns[o];if(i)for(let a in i)i.hasOwnProperty(a)&&(n.hasOwnProperty(a)||(n[a]=i[a]))}return e}function ys(r){if(!r)return;let e=r.controller.getFocusLocation();if(e&&e.type==="table"&&e.id===r.id)return e.location}function vi(r,e){for(let t=0;t<r.columnModels.length;t++){let o=r.columnModels[t];if(o.id===e)return o}}function V2(r,e,t){let o=vi(r,e);o&&(o.points=t,t||(o.dragMode="NONE"))}function r6(r,e,t){let o=vi(r,e);o&&(o.pointStyle=t)}function o6(r,e,t){let o=vi(r,e);o&&(o.lines=t)}function i6(r,e,t){let o=vi(r,e);o&&(o.lineStyle=t)}function V_(r,e,t){let o=vi(r,e);o&&(o.lineWidth=t)}function L_(r,e,t){let o=vi(r,e);o&&(o.lineOpacity=t)}function P_(r,e,t){let o=vi(r,e);o&&(o.pointSize=t)}function O_(r,e,t){let o=vi(r,e);o&&(o.pointOpacity=t)}function n6(r,e,t){let o=vi(r,e);if(o)if(t.type==="inert")o.disableGraphInteractions=t.disableGraphInteractions,t.disableGraphInteractions&&(o.dragMode="NONE");else{let i=t.dragMode;o.dragMode=i,i!=="NONE"&&!o.points&&(o.points=!0),i!=="NONE"&&(o.disableGraphInteractions=!1)}}function a6(r,e,t){n6(r,e,{type:"draggable",dragMode:t})}function s6(r,e,t){let o=vi(r,e);!o||!kx(t)||(o.color=t,o.colorLatex="")}function l6(r,e){r.regression&&(r.regression.color=e)}function c6(r,e){r.regression&&(r.regression.isLogMode=e)}function R_(r,e,t){let o=vi(r,e);o&&(o.colorLatex=t)}function Mx(r,e){r.isExpanded=e}function d6(r,e,t){let o=vi(r,e);o&&(o.hidden=t,t&&u6(r))}function p6(r,e,t){let o=vi(r,e);o&&(o.boundingBoxes=t,u6(r))}function u6(r){let e=[];r.columnModels.forEach(t=>{t.boundingBoxes&&!t.hidden&&(e=e.concat(t.boundingBoxes))}),r.boundingBoxes=e}function F_(r,e){let t=vi(r,e);return t?!t.points&&!t.lines:!0}function Ih(r,e,t){if(e.row===0){let i=r.columnModels[e.column].id,n=vi(r,i);if(!n)return;n.latex=t,e.column>=r.columnModels.length-1&&A_(r);return}let o=r.columnModels[e.column];for(let i=o.values.length;i<e.row-1;i++)o.values[i]="";r.columnModels[o.index].values[e.row-1]=t,e.column>0&&h6(r.columnModels[o.index])}function h6(r){for(;r.values.length>0&&!r.values[r.values.length-1];)r.values.pop()}function g6(r,e){return!!r.columnModels[e.column]&&e.row>=0}function m6(r){let e;if(r.values){for(e of r.values)if(e!=="")return!1}if(r.computedValues){for(e of r.computedValues)if(e!=="")return!1}return!0}function f6(r){return r.computed}function Lx(r){return r.computed||r.index===r.table.columnModels.length-1}function b6(r,e){n6(r.table,r.id,{type:"inert",disableGraphInteractions:e})}function G0(r,e,t){let o=r.columnModels[t];return o.computed?o.computedValues[e]||"":o.values[e]||""}function y6(r){let e=Kc(r),t=Ax(r);for(let o=0;o<t;o++)if(G0(r,e-1,o)!=="")return!1;return!0}function I0(r,e){var o,i;let t=!__dcg_shared_module_exports__['J']((o=r.regression)==null?void 0:o.columnIds,e==null?void 0:e.columnIds)||((i=r.regression)==null?void 0:i.type)!==(e==null?void 0:e.type);r.regression=e,r.regression&&t&&(r.regression.residualVariable=void 0)}function up(r){return!!r.latex&&!r.error&&!r.dependsOnRegression}function rm(r){return r.computedValues.length>=2&&!r.hasNanOrErrorValue&&!r.hasComplexValue}function x6(r){var i,n;let e=r.regression;if(!e)return;let t=(i=r.columnModels.find(a=>a.id===e.columnIds.x))==null?void 0:i.latex,o=(n=r.columnModels.find(a=>a.id===e.columnIds.y))==null?void 0:n.latex;return t&&o?[t,o]:void 0}var Aie=30,Vie=10,N_=__dcg_shared_module_exports__['Zd'].RED,B_=__dcg_shared_module_exports__['Zd'].BLUE,U_=__dcg_shared_module_exports__['Zd'].GREEN,q_=__dcg_shared_module_exports__['Zd'].PURPLE,z_=__dcg_shared_module_exports__['Zd'].ORANGE,Px=__dcg_shared_module_exports__['Zd'].BLACK;function gu(r,e){switch(e){case __dcg_shared_module_exports__['Zd'].RED:return r.s("graphing-calculator-text-color-red");case __dcg_shared_module_exports__['Zd'].BLUE:return r.s("graphing-calculator-text-color-blue");case __dcg_shared_module_exports__['Zd'].GREEN:return r.s("graphing-calculator-text-color-green");case __dcg_shared_module_exports__['Zd'].PURPLE:return r.s("graphing-calculator-text-color-purple");case __dcg_shared_module_exports__['Zd'].ORANGE:return r.s("graphing-calculator-text-color-orange");case __dcg_shared_module_exports__['Zd'].BLACK:return r.s("graphing-calculator-text-color-black");case __dcg_shared_module_exports__['Zd'].GRAY:return r.s("graphing-calculator-text-color-gray");default:let{r:t,g:o,b:i}=__dcg_shared_module_exports__['Vd'](e),n=Math.max(t,o,i),a=Math.min(t,o,i),s=n/255,l=n===0?0:(n-a)/n,c=0;n!==a&&(n===t?c=(o-i)/(n-a)+(o<i?6:0):n===o?c=(i-t)/(n-a)+2:c=(t-o)/(n-a)+4,c/=6),c*=360,l*=100;let d=s*100;return d<10?r.s("graphing-calculator-text-color-black"):l<10?d>90?r.s("graphing-calculator-text-color-white"):d>75?r.s("graphing-calculator-text-color-light-gray"):d>50?r.s("graphing-calculator-text-color-gray"):r.s("graphing-calculator-text-color-dark-gray"):c>=0&&c<15?d<50?r.s("graphing-calculator-text-color-dark-red"):d<75?r.s("graphing-calculator-text-color-red"):r.s("graphing-calculator-text-color-light-red"):c>=15&&c<45?d<50?r.s("graphing-calculator-text-color-dark-orange"):d<75?r.s("graphing-calculator-text-color-orange"):r.s("graphing-calculator-text-color-light-orange"):c>=45&&c<75?d<50?r.s("graphing-calculator-text-color-dark-yellow"):d<75?r.s("graphing-calculator-text-color-yellow"):r.s("graphing-calculator-text-color-light-yellow"):c>=75&&c<105?d<50?r.s("graphing-calculator-text-color-dark-lime"):d<75?r.s("graphing-calculator-text-color-lime"):r.s("graphing-calculator-text-color-light-lime"):c>=105&&c<135?d<50?r.s("graphing-calculator-text-color-dark-green"):d<75?r.s("graphing-calculator-text-color-green"):r.s("graphing-calculator-text-color-light-green"):c>=135&&c<165?d<50?r.s("graphing-calculator-text-color-dark-cyan"):d<75?r.s("graphing-calculator-text-color-cyan"):r.s("graphing-calculator-text-color-light-cyan"):c>=165&&c<195?d<50?r.s("graphing-calculator-text-color-dark-teal"):d<75?r.s("graphing-calculator-text-color-teal"):r.s("graphing-calculator-text-color-light-teal"):c>=195&&c<225?d<50?r.s("graphing-calculator-text-color-dark-blue"):d<75?r.s("graphing-calculator-text-color-blue"):r.s("graphing-calculator-text-color-light-blue"):c>=225&&c<255?d<50?r.s("graphing-calculator-text-color-dark-indigo"):d<75?r.s("graphing-calculator-text-color-indigo"):r.s("graphing-calculator-text-color-light-indigo"):c>=255&&c<285?d<50?r.s("graphing-calculator-text-color-dark-violet"):d<75?r.s("graphing-calculator-text-color-violet"):r.s("graphing-calculator-text-color-light-violet"):c>=285&&c<315?d<50?r.s("graphing-calculator-text-color-dark-magenta"):d<75?r.s("graphing-calculator-text-color-magenta"):r.s("graphing-calculator-text-color-light-magenta"):c>=315&&c<345?d<50?r.s("graphing-calculator-text-color-dark-pink"):d<75?r.s("graphing-calculator-text-color-pink"):r.s("graphing-calculator-text-color-light-pink"):c>=345&&c<=360?d<50?r.s("graphing-calculator-text-color-dark-red"):d<75?r.s("graphing-calculator-text-color-red"):r.s("graphing-calculator-text-color-light-red"):r.s("graphing-calculator-text-color-unknown")}}var L2=r=>{if(!Array.isArray(r))return[r];let e=Array(Math.min(r.length,Vie));for(let t=0;t<e.length;t++)e[t]=r[Math.round(t*r.length/e.length)];return e};function w6(r,e){switch(r.type){case"single-color":case"color-array":return L2(r.value).every(o=>G2(o,e));case"shader":case"image":return!1;default:let t=r;throw new Error("Unexpected ColorSwatchSpec type: "+t.type)}}function Ox(r,e,t=T2){switch(r.type){case"single-color":case"color-array":return L2(r.value).some(i=>G2(i,e,t));case"shader":case"image":return!0;default:let o=r;throw new Error("Unexpected ColorSwatchSpec type: "+o.type)}}var Rx=r=>{switch(r.type){case"single-color":return r.value;case"color-array":let e=L2(r.value);if(e.length===0)return __dcg_shared_module_exports__['Zd'].BLACK;if(e.length===1)return r.value[0];let t=Aie/e.length;return`linear-gradient(to right${e.reduce((i,n,a)=>`${i}, ${n} ${a*t}px, ${n} ${(a+1)*t}px`,"")})`;case"shader":return"#808080";case"image":return'url("'+r.value+'")';default:let o=r;throw new Error("Unexpected ColorSwatchSpec type: "+o.type)}};var Lie=0;function Pie(){return"abstract_item_"+Lie++}function pu(r){return{guid:Pie(),controller:r,index:-1,displayIndex:"-1",secretIndex:"-1",isHiddenFromUI:!0,renderShell:!0}}function H_(r,e){r.secret=e}function M0(r,e){r.readonly=e}function Qa(r,e){r.type!=="folder"&&(r.folderId=e)}function uu(r){r.isHiddenFromUI=P2(r)}function K_(r){return r.isHiddenFromUI||r.filteredBySearch?"none":r.renderShell?"shell":"render"}function om(r){let e=A0(r),t=e.type==="color-array"?{type:"single-color",value:e.value[0]}:e;return Rx(t)}function A0(r){if(!r.colorLatex)return{type:"single-color",value:r.color};if(/^data:image/.test(r.colorLatex))return{type:"image",value:r.colorLatex};let e,t,o=!1;return r.type==="expression"?(e=$_(r),t=W_(r),o=r.formula.color_latex_valid===void 0):r.type==="table-column"&&(e=WH(r),t=UH(r)),t&&e?Array.isArray(e)?{type:"color-array",value:e}:{type:"single-color",value:e}:o?{type:"single-color",value:"#999"}:{type:"single-color",value:r.color}}function yc(r){return r.type==="expression"||r.type==="image"||r.type==="table-column"?!!r.disableGraphInteractions:!1}var V0=class{constructor(e,t){this.exports=new Map;if(!t)return;let o=Oie(e);for(let i of __dcg_shared_module_exports__['qc'](t.definitionLevel))this.exports.set(i,{name:i,isTableColumnAssignment:t.definitionLevel[i]===1,isRegressionExport:o.has(i),isMultiplyDefined:!!t.multiplyDefined[i]})}optimisticallyRegisterColumnName(e){this.cachedLastSubscripts=void 0,!this.exports.get(e)&&this.exports.set(e,{name:e,isMultiplyDefined:!1,isRegressionExport:!1,isTableColumnAssignment:!0})}isDefined(e,t){let o=this.exports.get(e);return t.includeRegressionExports?!!o:o&&!o.isRegressionExport}isMultiplyDefined(e,t){var o;return this.isDefined(e,t)&&!!((o=this.exports.get(e))!=null&&o.isMultiplyDefined)}getLastSubscriptForName(e,t){var o,i;if(e.includes("_"))throw new Error(`Programming error: ${e} already has a subscript`);this.cachedLastSubscripts===void 0&&(this.cachedLastSubscripts={});for(let n of this.exports.values()){if(!t.includeRegressionExports&&n.isRegressionExport)continue;let[a,s]=n.name.split("_"),l=parseInt(s,10);isNaN(l)||a===e&&(this.cachedLastSubscripts[e]=Math.max((o=this.cachedLastSubscripts[e])!=null?o:0,l))}return(i=this.cachedLastSubscripts[e])!=null?i:-1}};function Oie(r){var t,o,i,n,a;let e=new Set;for(let s of r)if(s.type==="table"&&((o=(t=s.formula)==null?void 0:t.table_regression)==null?void 0:o.status)==="success"){let l=s.formula.table_regression.result.residualVariable,c=__dcg_shared_module_exports__['ac'](l);e.add(c)}else if(s.type==="expression"&&s.formula.is_regression){let l=(i=s.formula.regression)==null?void 0:i.residualVariable,c=l?__dcg_shared_module_exports__['ac'](l):void 0;c&&e.add(c);for(let d of(a=(n=s.formula)==null?void 0:n.exported_variables)!=null?a:[])d!==c&&e.add(d)}return e}function j_(r,e){let t=r.cachedViewState;return e.stripDefaults?__dcg_shared_module_exports__['wb'](t):t}function Rie(r){r.cachedViewState={type:r.type,id:r.id,title:r.title,hidden:r.hidden,inFrontOfEverything:r.inFrontOfEverything,readonly:r.readonly,collapsed:r.collapsed,secret:r.secret}}function Fie(r){r.cachedUndoRedoDiffState=r.cachedViewState,r.cachedUndoRedoFullState=r.cachedViewState}function C6(r,e){return{...__dcg_shared_module_exports__['i'](__dcg_shared_module_exports__['vb'](r)),...pu(e),cachedUndoRedoDiffState:{},cachedUndoRedoFullState:{},cachedViewState:{}}}function S6(r){Nie(r),uu(r),Rie(r),Fie(r)}function Nie(r){let t=r.controller.getAllSelectedItems();r.collapsedChildIsSelected=r.collapsed&&__dcg_shared_module_exports__['o'](t,o=>o.type!=="folder"&&o.folderId===r.id)}var Bie={id:!1,type:!1,hidden:!0,secret:!0,inFrontOfEverything:!0,collapsed:!0,title:!0,readonly:!0,disableGraphInteractions:!0};function E6(r,e){__dcg_shared_module_exports__['qb']({from:e,to:r,props:Bie})}function Fx(r,e){r.collapsed=e}function D6(r,e){r.title=e}function k6(r,e){r.hidden=e}function _6(r){return r.hidden}function T6(r,e){r.inFrontOfEverything=e}var Nx="dcg_geometry_toolbar_",I6={selection:{visible:!0},"box-selection":{visible:!0},"expression-edit":{visible:!0},point:{visible:!1},line:{visible:!1},segment:{visible:!1},ray:{visible:!1},vector:{visible:!1},circle:{visible:!1},arc:{visible:!1},parallel:{visible:!1},perpendicular:{visible:!1},anglebisector:{visible:!1},midpoint:{visible:!1},polygon:{visible:!1},compass:{visible:!1},angle:{visible:!1},directedangle:{visible:!1},reflect:{visible:!1},translate:{visible:!1},rotate:{visible:!1},dilate:{visible:!1}};function M6(r){if(r.toolbar!=="all"){if(r.toolbar==="custom"){let e=__dcg_shared_module_exports__['mb'](I6,r.toolbarState),t={toolbar:"custom"};return e!==void 0&&(t.toolbarState=e),t}return r}}function A6(r){return r===void 0?{toolbar:"all"}:r.toolbar==="custom"?{toolbar:"custom",toolbarState:__dcg_shared_module_exports__['nb'](I6,r.toolbarState)}:r}function V6(r,e){return e.stripDefaults?M6(r.cachedViewState):r.cachedViewState}function O2(r){return r.cachedUndoRedoDiffState}function Uie(r){r.toolbar==="custom"?r.cachedViewState={toolbar:"custom",toolbarState:__dcg_shared_module_exports__['i'](r.toolbarState)}:r.cachedViewState={toolbar:r.toolbar}}function L6(r){Uie(r),qie(r),r.__cachedToolbarState=void 0}function P6(r){let e=[];for(let t in r.toolbarState){let o=t,i=r.toolbarState[o];i.visible&&i.disabledLatex&&e.push({type:"geometry-toolbar-predicate",id:`${Nx}${o}`,latex:i.disabledLatex})}return e}function O6(r,e){if(!r.toolbarState[e].disabledLatex)return;let t=r.formulas[e];if(t!=null&&t.error)return{key:"shared-calculator-error-custom-toolbar-not-condition",vars:{}}}function R6(r,e,t){let o=e.replace(Nx,"");o in r.toolbarState&&(r.formulas[o]=t)}function qie(r){let e=r.cachedViewState;r.cachedUndoRedoDiffState=e,r.cachedUndoRedoFullState=e}function Y_(r){let e=A6(r);return{toolbar:e.toolbar,toolbarState:e.toolbar==="custom"?e.toolbarState:zie(),formulas:{},selectedToolForGroup:{},__cachedToolbarState:void 0,cachedViewState:e,cachedUndoRedoDiffState:e,cachedUndoRedoFullState:e}}function F6(){return Y_(void 0)}function zie(){return{selection:{visible:!0},"box-selection":{visible:!0},"expression-edit":{visible:!0},point:{visible:!0},line:{visible:!0},segment:{visible:!0},ray:{visible:!0},vector:{visible:!1},circle:{visible:!0},arc:{visible:!1},parallel:{visible:!1},perpendicular:{visible:!1},anglebisector:{visible:!1},midpoint:{visible:!1},polygon:{visible:!1},compass:{visible:!1},angle:{visible:!1},directedangle:{visible:!1},reflect:{visible:!1},translate:{visible:!1},rotate:{visible:!1},dilate:{visible:!1}}}function N6(r,e){r.toolbar=e,r.__cachedToolbarState=void 0}function B6(r,e,t){let{groups:o,items:i}=L0(r,t);for(let n of o){let a=i[n];a!=null&&a.dropdown&&a.dropdown.indexOf(e)!==-1&&(r.selectedToolForGroup[a.group]=e),e!=="box-selection"&&(a==null?void 0:a.group)==="selection"&&(a!=null&&a.dropdown)&&(r.selectedToolForGroup.selection=a.dropdown[0])}r.__cachedToolbarState=void 0}function X_(r,e,t){r.toolbarState[e]={visible:t.visible,disabledLatex:t.disabledLatex},r.__cachedToolbarState=void 0}function nb(r,e){return r.toolbar==="all"?!0:r.toolbar==="none"?!1:r.toolbarState[e].visible}function Bx(r,e){var o;if(r.toolbar==="all")return!0;let t=nb(r,e);if(t&&r.formulas[e]){let i=r.formulas[e],n=(o=i==null?void 0:i.typed_constant_value)==null?void 0:o.value;return typeof n=="number"?!n:!0}return t||e==="selection"}function L0(r,e){var i;if(((i=r.__cachedToolbarState)==null?void 0:i.authorMode)===e)return r.__cachedToolbarState.state;let t={};for(let n of R2())if(n.dropdown){let a=n.dropdown.filter(s=>e||nb(r,s));if(a.sort((s,l)=>{let c=Bx(r,s),d=Bx(r,l),p=nb(r,s),u=nb(r,l);return(c?0:p?1:2)-(d?0:u?1:2)}),a.length>0){let s=r.selectedToolForGroup[n.group];(!s||a.indexOf(s)===-1)&&(s=a[0]),!e&&!Bx(r,s)&&(s=a.find(l=>Bx(r,l))||a[0]),t[n.group]={group:n.group,current:s,dropdown:a.length>1?a:void 0}}}else(e||nb(r,n.current))&&(t[n.group]=n);let o=Object.keys(t);r.__cachedToolbarState={authorMode:e,state:{groups:o,items:t}};for(let n of o){let a=t[n];r.selectedToolForGroup[n]=a==null?void 0:a.current}return{groups:o,items:t}}function R2(){return[{group:"selection",current:"selection",dropdown:["selection","box-selection"]},{group:"point",current:"point",dropdown:["point","midpoint"]},{group:"line",current:"segment",dropdown:["segment","line","ray","vector","parallel","perpendicular","anglebisector"]},{group:"circle",current:"circle",dropdown:["circle","compass","arc"]},{group:"angle",current:"angle",dropdown:["angle","directedangle"]},{group:"polygon",current:"polygon"}]}var Hie=0;function Kie(){return"helper_item_"+Hie++}function U6(r){return{...r,formula:__dcg_shared_module_exports__['me'](),guid:Kie(),cachedParsableState:{type:"statement",id:r.id,latex:r.latex,shouldGraph:!1}}}function q6(r,e,t){var c;e.formula=t;let{proxy:o}=e,i=(c=t.typed_constant_value)==null?void 0:c.value,n=__dcg_shared_module_exports__['N'](i)?i:NaN,a=__dcg_shared_module_exports__['L'](i)&&__dcg_shared_module_exports__['n'](i,__dcg_shared_module_exports__['N'])?i.slice(0):void 0,s=o.listValue,l=o.numericValue;o.setPropertyWithoutNotifying("numericValue",n),o.setPropertyWithoutNotifying("listValue",a),__dcg_shared_module_exports__['J'](n,l)||r.runAfterDispatch(()=>{o.notifyPropertyChange("numericValue")}),__dcg_shared_module_exports__['J'](a,s)||r.runAfterDispatch(()=>{o.notifyPropertyChange("listValue")})}var N2={enabled:!1,latex:"",hoveredImage:"",depressedImage:""},J_={center:"\\left(0,0\\right)",angle:"0",width:"10",height:"10",opacity:"1",clickableInfo:N2,description:"",draggable:!1},z6={folderId:"",hidden:!1,secret:!1,readonly:!1,disableGraphInteractions:!1,foreground:!1,name:"",...J_};function Q_(r){return{...z6,...r,clickableInfo:{...N2,...r.clickableInfo}}}function H6(r){let e=__dcg_shared_module_exports__['lb'](z6,r),t=__dcg_shared_module_exports__['mb'](N2,r.clickableInfo);return t===void 0?delete e.clickableInfo:e.clickableInfo=t,e}function B2(r){return __dcg_shared_module_exports__['sb'](r,J_)}function Z_(r){return{type:"image",id:r.id,...B2(r),guid:"",index:0,color:"",shouldGraph:r.hidden,showPoints:!1}}$t();function K6(r,e){r.hidden=e}function xc(r,e,t){r[e]=t}function W6(r,e){return r[e]}function $6(r,e){r.description=e}function j6(r,e){r.name=e}function tT(r,e){e.type==="inert"?(r.disableGraphInteractions=e.disableGraphInteractions,e.disableGraphInteractions&&(r.draggable=!1,r.clickableInfo={...r.clickableInfo,enabled:!1})):e.type==="draggable"?(r.draggable=e.draggable,e.draggable&&(r.disableGraphInteractions=!1)):e.type==="clickable"&&(r.clickableInfo=e.clickableInfo,e.clickableInfo.enabled&&(r.disableGraphInteractions=!1))}function U2(r,e){tT(r,{type:"draggable",draggable:e})}function Ux(r){if(!r.formula)return;let e=r.formula.center_reference_id,t=r.formula.center_reference_symbol;if(!e||!t)return;let o=r.controller.getItemModel(e);if(!(!o||o.type!=="expression")&&o.formula.assignment===t&&nl(o))return o}function jie(r){let e=Ux(r);if(!e)return!1;let t=Ci(e);return!(!t||t==="NONE")}function hp(r){return!r.draggable||yc(r)?!1:jie(r)}function Y6(r){if(!r.formula||!r.formula.center_is_point_literal)return!1;let e=r.formula.move_strategy;if(!e)return!1;let t=e[2],o=e[3],i=t&&t.type!=="none",n=o&&o.type!=="none";return!!(i||n)}function X6(r,e){r.opacity=e}function q2(r,e){r.foreground=e}function J6(r,e){r.image_url=e}function rT(r,e){e(r.opacity,"imageOpacity"),e(r.center,"imageCenter"),e(r.height,"imageHeight"),e(r.width,"imageWidth"),e(r.angle,"imageAngle")}function Yie(r){let e=Z_(r);e.color=r.color,e.index=r.index,e.guid=r.guid,e.shouldGraph=r.shouldGraph,e.showPoints=r.showPoints,r.cachedParsableState=e}function Q6(r){r.draggingOnGraphpaper?r.preTransientState||(r.preTransientState={center:r.center,width:r.width,height:r.height}):delete r.preTransientState,uu(r);let e=il(r);r.shouldGraph=e&&e.hidden?!1:!r.hidden,r.showPoints=r.shouldGraph&&Za(r)&&r.loadStatus==="loaded"&&!hp(r)&&r.controller.isTraceEnabled(),Jie(r),Qie(r),Yie(r)}function Z6(r,e){r.formula=e,r.error=Xie(r)}function oT(r){return r.formula?r.formula.variables.map(t=>__dcg_shared_module_exports__['$b'](t))||[]:[]}function Xie(r){let e={scale:r.controller.s("graphing-calculator-error-log-axes-image"),center:r.controller.s("graphing-calculator-error-image-invalid-center"),angle:r.controller.s("graphing-calculator-error-image-invalid-angle"),width:r.controller.s("graphing-calculator-error-image-invalid-width"),height:r.controller.s("graphing-calculator-error-image-invalid-height"),opacity:r.controller.s("graphing-calculator-error-image-invalid-opacity")};for(let t in r.formula.errorMap)if(r.formula.errorMap[t])return e[t]}function eK(r,e){return!r.formula||!r.formula.errorMap?!1:!!r.formula.errorMap[e]}function iT(r,e){let t=r.cachedViewState;return e.stripDefaults?H6(t):t}function Jie(r){let e=r.cachedViewState.clickableInfo,t=!0,o=!0;if(e&&(e.depressedImage===r.clickableInfo.depressedImage&&(o=!1),e.hoveredImage===r.clickableInfo.hoveredImage&&(t=!1)),t&&(r.hoveredImageObj&&(re(r.hoveredImageObj).off("load"),delete r.hoveredImageObj),r.clickableInfo.hoveredImage)){r.hoveredImageObj=new Image;let i=function(){r.controller.requestRedrawGraph()},n=function(){};eT(r.hoveredImageObj,r.clickableInfo.hoveredImage,i,n)}if(o&&(r.depressedImageObj&&(re(r.depressedImageObj).off("load"),delete r.depressedImageObj),r.clickableInfo.depressedImage)){r.depressedImageObj=new Image;let i=function(){r.controller.requestRedrawGraph()},n=function(){};eT(r.depressedImageObj,r.clickableInfo.depressedImage,i,n)}if(r.cachedViewState.image_url!==r.image_url){re(r.imageObj).off("load"),r.imageObj=new Image;let i=function(){r.controller.dispatch({type:"image-load-success",id:r.id})},n=function(){r.controller.dispatch({type:"image-load-error",id:r.id})},s=r.controller.getGraphSettings().config.cacheRenderedSvgs?{fetchMimeType:{imageModel:r}}:void 0;eT(r.imageObj,r.image_url,i,n,s)}r.cachedViewState={type:r.type,id:r.id,folderId:r.folderId,image_url:r.image_url,name:r.name,hidden:r.hidden,foreground:r.foreground,secret:r.secret,readonly:r.readonly,disableGraphInteractions:r.disableGraphInteractions,...B2(r)}}function z2(r,e){r.draggingOnGraphpaper=e}function Qie(r){let e=r.cachedViewState;r.cachedUndoRedoFullState=r.cachedViewState,r.preTransientState&&(e={...e,...r.preTransientState}),r.cachedUndoRedoDiffState=e}function Zie(r){let e=document.createElement("canvas");return e.width=2,e.height=2,e.getContext("2d").drawImage(r,0,0,2,2),e.toDataURL()}function eT(r,e,t,o,i={}){re(r).on("load.initial-image-load",()=>{let s=r.width,l=r.height;s===1&&l===1?(re(r).off(".initial-image-load"),re(r).on("load",t),r.src=Zie(r)):t()}).on("error",o);let n=/^data:/.test(e);n||(r.crossOrigin="anonymous");let{fetchMimeType:a}=i;a?n?(r.src=e,a.imageModel.mimeType=e.substring(5,e.indexOf(";"))):fetch(e).then(s=>{let l=s.headers.get("Content-type");return l&&(a.imageModel.mimeType=l),s.blob()}).then(s=>{let l=URL.createObjectURL(s);r.src=l}):r.src=e}function tK(r,e){return{...__dcg_shared_module_exports__['i'](Q_(r)),...pu(e),color:__dcg_shared_module_exports__['Zd'].BLUE,loadStatus:"loading",failures:0,imageObj:new Image,hoveredImageObj:void 0,depressedImageObj:void 0,mimeType:void 0,shouldGraph:void 0,showPoints:void 0,error:void 0,formula:void 0,draggingOnGraphpaper:!1,cachedViewState:{},cachedParsableState:{},cachedUndoRedoDiffState:{},cachedUndoRedoFullState:{}}}var ene={id:!1,type:!1,image_url:!0,name:!0,folderId:!0,hidden:!0,secret:!0,readonly:!0,disableGraphInteractions:!0,foreground:!0,...__dcg_shared_module_exports__['tb'](J_)};function rK(r,e){__dcg_shared_module_exports__['qb']({from:e,to:r,props:ene})}function oK(r){let{controller:e,files:t,id:o}=r,i={errors:[],tokens:[]};for(let n=0;n<t.length;n++){let a=t[n];if(!a.type.match("image/*")){i.errors.push(e.s("graphing-calculator-error-image-invalid-file",{file:a.name}));continue}i.tokens.push(rne({controller:e,file:a,id:o}))}return i}var tne=0;function rne(r){let{controller:e,file:t,id:o}=r,i=""+tne++;return e.getGraphSettings().config.imageUploadCallback(t,(n,a)=>{setTimeout(()=>{if(n)e.dispatch({type:"image-upload-error",token:i,error:n});else{let s=new Image;eT(s,a,function(){let d=s.width,p=s.height,u=Math.max(d,p)/Math.min(d,p);d<p?(p=10,d=Math.round(10*p/u)/10):(d=10,p=Math.round(10*d/u)/10),e.dispatch({type:"image-upload-success",token:i,url:a,width:d+"",height:p+"",name:t.name,id:o})},function(){e.dispatch({type:"image-upload-error",token:i,error:!0})})}})}),i}function nT(r,e){r.loadStatus=e,e==="loaded"&&(r.failures=0),e==="failed"&&(r.failures+=1)}function H2(r){r.imageObj.src=r.imageObj.src,nT(r,"loading")}function aT(r,e,t){tT(r,{type:"clickable",clickableInfo:{...r.clickableInfo,[e]:t}})}function iK(r,e){tT(r,{type:"clickable",clickableInfo:{...r.clickableInfo,latex:e}})}function ab(r){var e;return!!(r.clickableInfo.enabled&&r.formula&&((e=r.formula.click_handler)==null?void 0:e.status)==="maybe-valid")}function K2(r,e){tT(r,{type:"inert",disableGraphInteractions:e})}var sT=class{invalidate(){this.suggestedIdentifierRename=void 0}suggestionForId(e){if(this.suggestedIdentifierRename&&this.suggestedIdentifierRename.id===e)return this.suggestedIdentifierRename}updateForSelectedItem(e,t){function o(c){return im(e,c).length}function i(c,d){return im(e,c).filter(p=>p.folderId===d).length}if(!t||t.type!=="expression"){this.invalidate();return}this.suggestedIdentifierRename&&this.suggestedIdentifierRename.id!==t.id&&(this.suggestedIdentifierRename=void 0),this.suggestedIdentifierRename&&P0(e,this.suggestedIdentifierRename.from)===0&&(this.suggestedIdentifierRename=void 0);let n=t.formula.defined_name||"",a=n?__dcg_shared_module_exports__['$b'](n):"";if(!this.suggestedIdentifierRename){a&&(this.suggestedIdentifierRename={id:t.id,from:a,to:a,countOfChanges:0,folderId:void 0});return}if(a===this.suggestedIdentifierRename.to)return;if(this.suggestedIdentifierRename.to=a,this.suggestedIdentifierRename.from===this.suggestedIdentifierRename.to||!this.suggestedIdentifierRename.from||!this.suggestedIdentifierRename.to){this.suggestedIdentifierRename.countOfChanges=0;return}if(o(n)>1){this.suggestedIdentifierRename.countOfChanges=0;return}let s=__dcg_shared_module_exports__['ac'](this.suggestedIdentifierRename.from);if(this.suggestedIdentifierRename.folderId=void 0,o(s)>0){let c;if(t.folderId&&(c=i(s,t.folderId))===0)this.suggestedIdentifierRename.folderId=t.folderId,this.suggestedIdentifierRename.countOfChanges=c;else{this.suggestedIdentifierRename.countOfChanges=0;return}}let l=P0(e,this.suggestedIdentifierRename.from,this.suggestedIdentifierRename.folderId);this.suggestedIdentifierRename.countOfChanges=l}};var nK={folderId:"",text:"",secret:!1,readonly:!1};function aK(r){return{...nK,...r}}function sK(r){return __dcg_shared_module_exports__['lb'](nK,r)}function W2(r,e){r.text=e}function lK(r,e){return{...__dcg_shared_module_exports__['i'](aK(r)),...pu(e),cachedUndoRedoDiffState:{},cachedUndoRedoFullState:{},cachedViewState:{}}}function cK(r){uu(r),ine(r),nne(r)}var one={id:!1,type:!1,folderId:!0,text:!0,secret:!0,readonly:!0};function dK(r,e){__dcg_shared_module_exports__['qb']({from:e,to:r,props:one})}function lT(r,e){let t=r.cachedViewState;return e.stripDefaults?sK(t):t}function ine(r){r.cachedViewState={type:r.type,id:r.id,folderId:r.folderId,text:r.text,secret:r.secret,readonly:r.readonly}}function nne(r){r.cachedUndoRedoDiffState=r.cachedViewState,r.cachedUndoRedoFullState=r.cachedViewState}var zx={handlerLatex:"",minStepLatex:"",open:!1,playing:!1};function cT(r){return{type:"ticker",id:r.id,handlerLatex:r.handlerLatex,minStepLatex:r.minStepLatex,shouldGraph:!1}}function uK(r){return __dcg_shared_module_exports__['mb'](zx,r)}function dT(r){return{...zx,...r}}var hK="dcg_ticker_guid_internal",sne=hK;function gK(){return $2(zx)}function lne(r){r.cachedParsableState=cT(r)}function mK(r,e){return e.stripDefaults?uK(r.cachedViewState):r.cachedViewState}function fK(r){return r.cachedUndoRedoDiffState}function bK(r){return r.cachedUndoRedoFullState}function cne(r){r.cachedViewState={handlerLatex:r.handlerLatex,minStepLatex:r.minStepLatex,playing:r.playing,open:r.open}}function dne(r){let e=r.cachedViewState;r.cachedUndoRedoDiffState=e,r.cachedUndoRedoFullState=e}function $2(r){return{...dT(r),type:"ticker",guid:hK,id:sne,avgDelta:0,lastTickTime:void 0,cachedViewState:{},cachedParsableState:{},cachedUndoRedoDiffState:{},cachedUndoRedoFullState:{},filteredBySearch:!1}}function yK(r,e){__dcg_shared_module_exports__['rb'](e,r)}function xK(r,e){r.formula=e}function wK(r){cne(r),dne(r),lne(r)}function vK(r,{currentFrameTime:e,previousFrameTime:t}){var a,s;if(!r.playing||((a=r.formula)==null?void 0:a.handler.status)!=="maybe-valid")return!1;if(r.lastTickTime==null||t==null)return!0;if(((s=r.formula)==null?void 0:s.minStep.status)!=="valid")return!1;let o=r.formula.minStep.value,i=r.lastTickTime+o;if(e>=i)return!0;let n=e-t;return i-e<n/2}function CK(r,e){r.lastTickTime=e}function SK(r){if(r.formula)return r.formula.handler.status==="error"?r.formula.handler.error:void 0}function EK(r){if(r.formula)return r.formula.minStep.status==="error"?r.formula.minStep.error:void 0}function O0(r){var e;return(((e=r.formula)==null?void 0:e.variables)||[]).map(t=>__dcg_shared_module_exports__['$b'](t))}function pT(r,e){e(r.handlerLatex,"tickerHandler"),e(r.minStepLatex,"tickerMinStep")}var $x="**dcg_geo_expression_edit_tool_preview**";function DK(r){return{controller:r,__itemModelArray:[],__itemIdToModel:{},__helperIdToModel:{},__toolPreviewIdToModel:{},__anyDependsOnRandomSeed:!1,__anyFunctionDefinitionsDependOnRandomSeed:!1,__anyUnmutedTones:!1,__anyTones:!1,__anyIsAction:!1,selectedItemMap:{},tabOrder:[],drawLayers:[],colorIdx:0,expressionAnalysis:{},nextDisplayIndex:"1",ticker:gK(),renamePrompt:new sT,__exportedVariables:new V0([],void 0)}}function kK(r){for(let e=0;e<r.__itemModelArray.length;e++){let t=r.__itemModelArray[e];if(t.type==="image"&&t.loadStatus==="loading")return!0}return!1}function _K(r){let e=__dcg_shared_module_exports__['m'](__dcg_shared_module_exports__['H'](r.controller.getColors()),o=>o!=__dcg_shared_module_exports__['Zd'].ORANGE),t=e[r.colorIdx];return r.colorIdx=(r.colorIdx+1)%e.length,t}function sb(r,e){return r.__itemModelArray[e]}function jx(r){for(let e=0;e<r.__itemModelArray.length;e++){let t=r.__itemModelArray[e];if(Yx(t))return t}}function gT(r){for(let e=r.__itemModelArray.length-1;e>=0;e--){let t=r.__itemModelArray[e];if(Yx(t))return t}}function R0(r,e){let t;do{if(e--,e===-1)return;t=sb(r,e)}while(t&&!Yx(t));return t}function F0(r,e){let t,o=B0(r);do{if(e++,e===o)return;t=sb(r,e)}while(t&&!Yx(t));return t}function il(r){if(r.type!=="folder"&&r.folderId){let e=r.controller.getListModel(),t=fu(e,r.folderId);if(t&&t.type==="folder")return t}}function TK(r,e){let t=fu(r,e);if(!t||t.type!=="folder")return 0;let o=0,i=r.__itemModelArray.length;for(let n=t.index+1;n<i;n++){let a=r.__itemModelArray[n];if(a.type==="folder"||a.folderId!==e)break;o+=1}return o}function GK(r,e){let t=fu(r,e);if(!t||t.type!=="folder")return[];let o=[],i=r.__itemModelArray.length;for(let n=t.index+1;n<i;n++){let a=r.__itemModelArray[n];if(a.type==="folder"||a.folderId!==e)break;o.push(a.id)}return o}function IK(r,e){let t=[],o=fu(r,e);if(!o||o.type!=="folder")return t;let i=r.__itemModelArray.length;for(let n=o.index+1;n<i;n++){let a=r.__itemModelArray[n];if(a.type==="folder"||a.folderId!==e)break;t.push(a)}return t}function MK(r){return!!(r&&r.readonly)}function Hx(r){if(!r)return!1;if(r.secret)return!0;let e=il(r);return!!(e&&e.secret&&e.id!==__dcg_shared_module_exports__['xb'])}function Yx(r){return!P2(r)}function AK(r){return r.id===__dcg_shared_module_exports__['xb']||r.type!=="folder"&&r.folderId===__dcg_shared_module_exports__['xb']}function P2(r){if(!r||r.filteredBySearch||AK(r))return!0;if(r.controller.isItemBeingDragged(r.id))return!!r.controller.shouldRenderDraggedItemAsToken();if(!r.controller.shouldShowAuthorFeatures()&&Hx(r))return!0;let t=il(r);return!!(t&&t.collapsed&&!r.controller.getExpressionSearchStr())}function mT(r){return r.__itemModelArray}function VK(r){return __dcg_shared_module_exports__['H'](r.__helperIdToModel)}function Xx(r){return __dcg_shared_module_exports__['H'](r.__toolPreviewIdToModel)}function Jx(r,e){for(let t=0;t<r.__itemModelArray.length;t++){let o=r.__itemModelArray[t];Kx(o,e)}for(let t in r.__toolPreviewIdToModel)Kx(r.__toolPreviewIdToModel[t],e);if(r.ticker.open&&(e(r.ticker.handlerLatex,{type:"item",location:"tickerHandler",item:r.ticker}),e(r.ticker.minStepLatex,{type:"item",location:"tickerMinStep",item:r.ticker})),r.controller.isGeometry()){let o=r.controller.getGeometryToolbarModel().toolbarState;for(let i in o){let n=i,a=o[n];a.visible&&a.disabledLatex&&e(a.disabledLatex,{type:"geometry-toolbar",tool:n})}}}function Kx(r,e){switch(r.type){case"expression":ST(r,(o,i)=>e(o,{type:"item",location:i,item:r}));break;case"table":T0(r,(o,i,n)=>e(o,{type:"item",location:i,item:r,...n}));break;case"image":rT(r,(o,i)=>e(o,{type:"item",location:i,item:r}));break;case"ticker":pT(r,(o,i)=>e(o,{type:"item",location:i,item:r}));break;case"folder":case"text":break;default:return r}}function LK(r,e){if(!ol(e))return!1;let o=!1;return Jx(r,i=>{kd(i,e)&&(o=!0)}),o}function PK(r,e){let t=!1;for(let o of r.__itemModelArray)if(o.type==="table"&&(T0(o,i=>{kd(i,e)&&(t=!0)},{headersOnly:!0}),t))return!0;return!1}function OK(r,e){let t=0,o=ol(e);r.ticker.filteredBySearch=r.ticker.open&&!kd(r.ticker.handlerLatex,e)&&!kd(r.ticker.minStepLatex,e);for(let i of r.__itemModelArray){if(!o){i.filteredBySearch=!1,t++;continue}switch(i.filteredBySearch=!0,i.type){case"expression":ST(i,s=>{kd(s,e)&&(i.filteredBySearch=!1,t++)});let n=Vl(i);i.label&&n&&i.label.match(hT(e))&&(i.filteredBySearch=!1,t++);break;case"table":T0(i,s=>{kd(s,e)&&(i.filteredBySearch=!1,t++)});break;case"image":rT(i,s=>{kd(s,e)&&(i.filteredBySearch=!1,t++)});break;case"folder":case"text":break;default:return i}!i.filteredBySearch&&i.type!=="folder"&&i.folderId&&(r.__itemIdToModel[i.folderId].filteredBySearch=!1,t++)}return t}function RK(r,e){let t=0,o=DH(e),i=_H(e);r.ticker.filteredBySearch=!!e&&r.ticker.open&&!o(r.ticker.handlerLatex)&&!o(r.ticker.minStepLatex);for(let n=0;n<r.__itemModelArray.length;n++){if(!e){r.__itemModelArray[n].filteredBySearch=!1;continue}let a=r.__itemModelArray[n];switch(a.filteredBySearch=!0,a.type){case"expression":ST(a,c=>{o(c)&&(a.filteredBySearch=!1,t++)});let s=Vl(a);aw(a)&&(a.label||s)&&(e==="\\operatorname{label}"||e.length>1&&"label".indexOf(e)===0||o(a.label))&&(a.filteredBySearch=!1,t++);break;case"table":T0(a,c=>{o(c)&&(a.filteredBySearch=!1,t++)});break;case"image":e==="\\operatorname{image}"||e.length>1&&"image".indexOf(e)===0?(a.filteredBySearch=!1,t++):rT(a,c=>{o(c)&&(a.filteredBySearch=!1,t++)});break;case"folder":a.title&&a.title.indexOf(e)>=0&&(a.filteredBySearch=!1,t++);break;case"text":i.test(a.text)&&(a.filteredBySearch=!1,t++);break;default:return a}!a.filteredBySearch&&a.type!=="folder"&&a.folderId&&(r.__itemIdToModel[a.folderId].filteredBySearch=!1,t++)}return t}function hT(r,e){return new RegExp("\\$\\{"+r.replace("{","\\{?").replace("}","\\}?").replace("_","\\_?")+"\\}",e)}function P0(r,e,t){let o=0;for(let i=0;i<r.__itemModelArray.length;i++){let n=r.__itemModelArray[i];if(n.type!=="expression"||t&&n.folderId!==t)continue;if(Vl(n)&&n.label){let s=n.label.match(hT(e,"g"));s&&(o+=s.length)}}return Jx(r,(i,n)=>{t&&(n.type!=="item"||n.item.type==="ticker"||n.item.type==="folder"||n.item.folderId!==t)||(o+=Tx(i,e).length)}),o}function mu(r,e,t,o){r.renamePrompt.invalidate(),t=t.trim().replace(/_\{([a-zA-Z0-9])\}/g,"_$1");for(let i=0;i<r.__itemModelArray.length;i++){let n=r.__itemModelArray[i];if(n.type==="expression"){if((o==null?void 0:o.limitToFolder)!==void 0&&o.limitToFolder!==n.folderId)continue;let a=Vl(n);n.label&&a&&n.label.match(hT(e))&&bu(n,n.label.replace(hT(e,"g"),"${"+t.trim()+"}"))}}Jx(r,(i,n)=>{if(o&&o.limitToItem!==void 0&&(n.type!=="item"||o.limitToItem!==n.item.id)||o&&o.limitToFolder!==void 0&&(n.type!=="item"||n.item.type==="ticker"||n.item.type==="folder"||o.limitToFolder!==n.item.folderId))return;let a=D_(i,e,t);if(n.type==="geometry-toolbar"){let l=r.controller.getGeometryToolbarModel();X_(l,n.tool,{visible:!0,disabledLatex:a});return}let s=n.item;if(a!==i){let l;switch(n.cellLocation!==void 0&&s.columnModels&&(l=s.columnModels[n.cellLocation.column].id),n.location){case"latex":{Al(s,a);break}case"cdfMin":{kT(s,a);break}case"cdfMax":{_T(s,a);break}case"colorLatex":{X0(s,a);break}case"lineWidth":{iw(s,a);break}case"resolution":{ET(s,a);break}case"clickableInfoLatex":{vT(s,a);break}case"fillOpacity":{W0(s,a);break}case"surfaceOpacity":{$0(s,a);break}case"lineOpacity":{ow(s,a);break}case"pointOpacity":{j0(s,a);break}case"pointSize":case"movablePointSize":Y0(s,a);break;case"labelAngle":{DT(s,a);break}case"labelSize":{J0(s,a);break}case"polarDomainMin":{Gl(s,a,"theta");break}case"polarDomainMax":{Il(s,a,"theta");break}case"parametricDomainMin":{Gl(s,a,"t");break}case"parametricDomainMax":{Il(s,a,"t");break}case"parametricDomain3DuMin":{Gl(s,a,"u");break}case"parametricDomain3DuMax":{Il(s,a,"u");break}case"parametricDomain3DvMin":{Gl(s,a,"v");break}case"parametricDomain3DvMax":{Il(s,a,"v");break}case"parametricDomain3DrMin":{Gl(s,a,"r");break}case"parametricDomain3DrMax":{Il(s,a,"r");break}case"parametricDomain3DphiMin":{Gl(s,a,"phi");break}case"parametricDomain3DphiMax":{Il(s,a,"phi");break}case"sliderMin":{tw(s,a);break}case"sliderMax":{rw(s,a);break}case"sliderStep":{K0(s,a);break}case"imageOpacity":{xc(s,"opacity",a);break}case"imageCenter":{xc(s,"center",a);break}case"imageHeight":{xc(s,"height",a);break}case"imageWidth":{xc(s,"width",a);break}case"imageAngle":{xc(s,"angle",a);break}case"tickerHandler":{s.handlerLatex=a;break}case"tickerMinStep":{s.minStepLatex=a;break}case"tableHeader":case"tableCellValue":if(!n.cellLocation||s.type!=="table")break;Ih(s,n.cellLocation,a);break;case"tableColumnColorLatex":{l&&R_(s,l,a);break}case"tableColumnPointSize":{l&&P_(s,l,a);break}case"tableColumnPointOpacity":{l&&O_(s,l,a);break}case"tableColumnLineWidth":{l&&V_(s,l,a);break}case"tableColumnLineOpacity":{l&&L_(s,l,a);break}case"residualVariable":break;default:{let c=n.location;throw new Error(`Unexpected latex location ${c}`)}}}})}function fT(r){let e=[];Jx(r,o=>{if(o.indexOf("~")!==-1||o.indexOf("\\sim")!==-1)return;let i=/_(\d)|_\{(?:\s|\\space)*(\d+)(?:\s|\\space)*\}/g;for(;;){let n=i.exec(o);if(!n)break;e.push(parseInt(n[1]||n[2],10))}}),e.sort((o,i)=>o-i);let t=1;for(let o=0;o<e.length;o++)e[o]===t&&t++;return t}function FK(r){let e=0;return Jx(r,t=>{let o=/\\token\{(\d+)\}/g;for(;;){let i=o.exec(t);if(!i)break;let n=parseInt(i[1],10);n>e&&(e=n)}}),e}function NK(r){let e={};return Jx(r,t=>{if(t.indexOf("~")!==-1||t.indexOf("\\sim")!==-1)return;let o=/(\\?[a-zA-Z]+)_(\d)|(\\?[a-zA-Z]+)_\{(?:\s|\\space)*(\d+)(?:\s|\\space)*\}/g;for(;;){let i=o.exec(t);if(!i)break;let n=i[1]||i[3],a=i[2]||i[4];n[0]!=="\\"&&(n=n[n.length-1]);let s=parseInt(a,10);e[n]||(e[n]=0),s>e[n]&&(e[n]=s)}}),e}function BK(r,e){let t=[],o=[],i=[],n=[],a={points:[],angles:[],polygons:[],other:[]};function s(c){if(mne(r,c.id)&&e!=="actual")return;if(c.id===$x&&e!=="preview")return;if(c.type==="expression"&&c.folderId===__dcg_shared_module_exports__['xb']){pp(c)?a.points.push(c.id):sm(c)?a.angles.push(c.id):nw(c)?a.polygons.push(c.id):a.other.push(c.id);return}let d=!1;if(c.type!=="folder"&&c.folderId){let u=r.__itemIdToModel[c.folderId];u&&u.type==="folder"&&u.inFrontOfEverything&&(d=!0)}let p=i;d?p=n:c.type==="image"&&!c.foreground&&(p=o),c.type==="table"?(c.regression&&(t.push(c.regression.id),p.push(c.regression.id)),__dcg_shared_module_exports__['k'](c.columnModels,u=>{t.push(u.id),p.push(u.id)})):(t.push(c.id),p.push(c.id))}r.__itemModelArray.forEach(s),Xx(r).forEach(s);let l=[...a.polygons,...a.other,...a.angles,...a.points];t.push(...l),i.push(...l),r.tabOrder=t,r.drawLayers=[],o.length&&r.drawLayers.push({layer:-1,drawOrder:o,drawSet:new Set(o)}),r.drawLayers.push({layer:0,drawOrder:i,drawSet:new Set(i)}),n.length&&r.drawLayers.push({layer:1,drawOrder:n,drawSet:new Set(n)})}function fu(r,e,t){let o=r.__itemIdToModel[e];if(o)return o;if(t&&t.includePreviewItems)return r.__toolPreviewIdToModel[e]}function UK(r,e){return!!r.__toolPreviewIdToModel[e]}function im(r,e){var o;let t=[];for(let i=0;i<r.__itemModelArray.length;i++){let n=r.__itemModelArray[i];n.type==="expression"&&((o=xn(n))==null?void 0:o.identifier)===e&&t.push(n)}return t}function pne(r,e){return r.__helperIdToModel[e]}function qK(r){return __dcg_shared_module_exports__['H'](r.__helperIdToModel)}function zK(r,e){let t=U6(e);r.__helperIdToModel[t.id]=t,Object.defineProperty(e.proxy,"isActive",{get:()=>{var o;return((o=r.__helperIdToModel[t.id])==null?void 0:o.proxy)===t.proxy}})}function N0(r){r.__anyUnmutedTones=r.__itemModelArray.some(e=>z0(e)),r.__anyTones=r.__anyUnmutedTones||r.__itemModelArray.some(e=>vc(e))}function HK(r,e){r.__exportedVariables=new V0(mT(r),e)}function Y2(r){r.__anyDependsOnRandomSeed=!1,r.__anyFunctionDefinitionsDependOnRandomSeed=!1;for(let e=0;e<r.__itemModelArray.length;e++){let t=r.__itemModelArray[e];t&&"formula"in t&&t.formula&&t.formula.depends_on_random_seed&&(r.__anyDependsOnRandomSeed=!0,t.type==="expression"&&t.formula.function_definition&&(r.__anyFunctionDefinitionsDependOnRandomSeed=!0))}}function KK(r){r.__anyIsAction=!1}function bT(r){if(!r.__anyIsAction){if(r.ticker.open){r.__anyIsAction=!0;return}for(let e=0;e<r.__itemModelArray.length;e++){let t=r.__itemModelArray[e];if(t&&"formula"in t&&t.formula){if(t.type!=="expression"&&t.type!=="image")continue;let{formula:o}=t;if(o.hasOwnProperty("action_value")||o.hasOwnProperty("click_handler")){r.__anyIsAction=!0;return}}}}}function lb(r){ji("showIDs")?hne(r):une(r);for(let e in r.selectedItemMap)r.__itemIdToModel[e]||delete r.selectedItemMap[e]}function une(r){let e=!r.controller.shouldShowAuthorFeatures(),t=1,o=1;for(let i=0;i<r.__itemModelArray.length;i++){let n=r.__itemModelArray[i];n.index=i,n.displayIndex=""+t,Hx(n)&&(n.secretIndex=""+o,o+=1),!AK(n)&&(!e||!Hx(n))&&(t+=1)}r.nextDisplayIndex=""+t}function hne(r){for(let e=0;e<r.__itemModelArray.length;e++){let t=r.__itemModelArray[e];t.index=e;let o=t.id.length<=6?t.id:t.id.substring(0,4)+"\u2026";t.displayIndex=o,Hx(t)&&(t.secretIndex=o)}r.nextDisplayIndex=""}function gne(r){r.renamePrompt.invalidate(),r.__itemModelArray=[],r.__itemIdToModel={},r.__helperIdToModel={},r.__toolPreviewIdToModel={},r.__anyDependsOnRandomSeed=!1,r.__anyFunctionDefinitionsDependOnRandomSeed=!1,r.__anyUnmutedTones=!1,r.__anyTones=!1}function B0(r){return r.__itemModelArray.length}function WK(r){return r.__itemModelArray.filter(e=>e.type==="expression"&&e.folderId===__dcg_shared_module_exports__['xb']&&!!ma(e)).length}function $K(r){return r.nextDisplayIndex==="1"}function jK(r){let e=[];for(let t=0;t<r.__itemModelArray.length;t++){let o=r.__itemModelArray[t];o.type==="expression"&&o.sliderExists&&e.push(o)}return e}function cb(r){let e;for(let t in r.selectedItemMap){if(e!==void 0)return;e=t}if(e!==void 0)return r.__itemIdToModel[e]}function mne(r,e){return!!r.selectedItemMap[e]}function YK(r){return Object.keys(r.selectedItemMap)}function yT(r){let e=[];for(let t in r.selectedItemMap)e.push(r.__itemIdToModel[t]);return e}function XK(r){return{list:r.__itemModelArray.map(e=>e.cachedUndoRedoDiffState),ticker:fK(r.ticker)}}function X2(r){return{list:r.__itemModelArray.map(e=>e.cachedUndoRedoFullState),ticker:bK(r.ticker)}}function JK(r,e){let t={list:r.__itemModelArray.map(i=>{switch(i.type){case"expression":return H0(i,e);case"image":return iT(i,e);case"table":return Vx(i,e);case"folder":return j_(i,e);case"text":return lT(i,e);default:return i}})},o=mK(r.ticker,e);return o&&(t.ticker=o),t}function*fne(r){for(let e=r.list.length-1;e>=0;e--){let t=r.list[e];if(yield t.id,t.type==="table"&&t.columns)for(let o=t.columns.length-1;o>=0;o--)yield t.columns[o].id;t.type==="table"&&t.regression&&(yield t.regression.id)}}function QK(r){let e=0,t=/^[0-9]+$/;for(let o of fne(r))if(t.test(o)){let i=parseInt(o,10);i>e&&(e=i)}return e}function ZK(r,e,t){t||(t={});let o,i;for(r.colorIdx=0,gne(r),r.expressionAnalysis={},o=0;o<e.list.length;o++){if(i=Wx(r,e.list[o]),t.remapColors&&"color"in i&&i.color){let n=__dcg_shared_module_exports__['H'](r.controller.getColors());__dcg_shared_module_exports__['p'](n,i.color)||(i.color=MH(i.color,n))}r.__itemModelArray.push(i),r.__itemIdToModel[i.id]=i}if(r.ticker=$2(e.ticker),lb(r),r.nextDisplayIndex==="1"){let n=Wx(r,{type:"expression",id:r.controller.generateId(),color:r.controller.getNextColor()});wc(r,n,r.__itemModelArray.length)}}function Wx(r,e){switch(e.type){case"expression":return CT(e,r.controller);case"table":return ZH(e,r.controller);case"image":return tK(e,r.controller);case"folder":return C6(e,r.controller);case"text":return lK(e,r.controller);default:return e}}function eW(r,e){let t,o,i=r.__itemIdToModel;for(r.__itemModelArray=[],r.__itemIdToModel={},r.renamePrompt.invalidate(),t=0;t<e.list.length;t++){let n=e.list[t];if(o=i[n.id],o&&o.type===n.type)switch(o.type){case"expression":if(n.type!==o.type)throw new Error("invalid restoration");gW(o,n);break;case"table":if(n.type!==o.type)throw new Error("invalid restoration");QH(o,n);break;case"image":if(n.type!==o.type)throw new Error("invalid restoration");rK(o,n);break;case"folder":{if(n.type!==o.type)throw new Error("invalid restoration");E6(o,n)}break;case"text":if(n.type!==o.type)throw new Error("invalid restoration");dK(o,n);break;default:return o}else o=Wx(r,n);r.__itemModelArray.push(o),r.__itemIdToModel[o.id]=o}e.ticker&&yK(r.ticker,e.ticker),Y2(r),bT(r),N0(r),HK(r,void 0),lb(r)}function tW(r,e,t){let o=t[0]&&t[0].tableId,i=fu(r,o||e);if(!i)return;let n;switch(i.type){case"expression":let a=!1,s=!1,l;i.__workerNeedsDotplotXMode=!1;for(let p=0;p<t.length;p++){let u=t[p];if("recursionTerminationStatus"in u&&u.recursionTerminationStatus===1&&(s=!0),"nanBlame"in u&&u.nanBlame!==void 0&&(l=u.nanBlame),u.graphMode===15){i.error=u.error;continue}"resolved"in u&&!u.resolved&&(a=!0),"boundingBox"in u&&u.boundingBox&&(n||(n=[]),n.push(u.boundingBox)),u.needsDotplotXMode&&(i.__workerNeedsDotplotXMode=!0)}i.unresolved=a,i.boundingBoxes=n,i.recursiveDepthPlottingError=s,i.nanBlame=l;let c=1/0,d=-1/0;for(let p of t){if(p.graphMode!==6)continue;let u=p.sampledDomain;u&&(c=Math.min(c,u.min),d=Math.max(d,u.max))}isFinite(c)&&(i.__workerSampledDomainMin=c),isFinite(d)&&(i.__workerSampledDomainMax=d);return;case"table":for(let p=0;p<t.length;p++){let u=t[p];"boundingBox"in u&&u.boundingBox&&(n||(n=[]),n.push(u.boundingBox))}n&&p6(i,e,n);return;default:return}}function rW(r,e,t){var s;let o,i,n,a=__dcg_shared_module_exports__['i'](r.expressionAnalysis);for(o in e){if(!e.hasOwnProperty(o))continue;n=e[o],i=fu(r,o);let l={isGraphable:!!n.is_graphable,isError:!!n.error,errorMessage:n.error?r.controller.unpack(n.error):void 0};if(i)switch(i.type){case"expression":j2(i,n);let{value:d,valueType:p}=(s=n.typed_constant_value)!=null?s:{};d!==void 0&&(p===__dcg_shared_module_exports__['ga']?l.evaluation={type:"ListOfNumber",value:d.slice()}:__dcg_shared_module_exports__['_'](p,__dcg_shared_module_exports__['ba'])&&(l.evaluation={type:"Number",value:d}),l.evaluationDisplayed=!!n.is_evaluable);break;case"image":Z6(i,n);break;case"table":jH(i,n);break;case"folder":case"text":break;default:return i}else o===r.ticker.id&&xK(r.ticker,n);let c=pne(r,o);if(c)q6(r.controller,c,n);else{let d=r.__toolPreviewIdToModel[o];d&&j2(d,n)}o.startsWith(Nx)&&R6(r.controller.getGeometryToolbarModel(),o,n),o!==r.ticker.id&&!o.startsWith(Nx)&&(a[o]=l)}Y2(r),N0(r),bT(r),HK(r,t),r.expressionAnalysis=a}function vo(r,e){r.selectedItemMap={},e&&(r.selectedItemMap[e.id]="selected")}function oW(r){return Object.values(r.selectedItemMap).some(e=>e==="tentatively-selected")}function iW(r,e){r.selectedItemMap={},e&&(r.selectedItemMap[e.id]="tentatively-selected")}function nW(r){for(let e in r.selectedItemMap)r.selectedItemMap[e]==="tentatively-selected"&&(r.selectedItemMap[e]="selected")}function aW(r){for(let e in r.selectedItemMap)r.selectedItemMap[e]==="tentatively-selected"&&delete r.selectedItemMap[e]}function J2(r,e,t){r.selectedItemMap[e]?delete r.selectedItemMap[e]:r.selectedItemMap[e]=t}function Q2(r,e){r.selectedItemMap={};for(let t in e)r.selectedItemMap[t]="selected"}function am(r,e,t,o){if(e===t)return;let i=r.__itemModelArray.splice(e,o);e<t&&(t=t-o+1),r.__itemModelArray.splice.apply(r.__itemModelArray,[t,0,...i]),lb(r)}function wc(r,e,t){let o=String(e.id);if(r.__itemIdToModel.hasOwnProperty(o))throw Error("Item with id '"+o+"' is already in list");r.__itemIdToModel[o]=e,r.__itemModelArray.splice(t,0,e),lb(r)}function Wc(r,e){wc(r,e,B0(r))}function Qx(r,e){let t=[],o=r.__itemModelArray[e];if(o.type==="folder"){let i=0,n=e+1;for(let a=n;a<r.__itemModelArray.length;a++){let s=r.__itemModelArray[a];if(s.type==="folder"||s.folderId!==o.id)break;Za(s)&&vo(r,void 0),s.readonly?(a>n&&(r.__itemModelArray[a]=r.__itemModelArray[n],r.__itemModelArray[n]=s),Qa(s,""),n+=1):(delete r.__itemIdToModel[s.id],delete r.expressionAnalysis[o.id],i+=1)}i>0&&t.push(...r.__itemModelArray.splice(n,i))}return Za(o)&&vo(r,void 0),t.push(...r.__itemModelArray.splice(e,1)),delete r.__itemIdToModel[o.id],delete r.expressionAnalysis[o.id],Y2(r),t.some(i=>vc(i))&&N0(r),lb(r),t}function sW(r){return r.__anyDependsOnRandomSeed}function lW(r){return r.__anyFunctionDefinitionsDependOnRandomSeed}function cW(r){return r.__anyIsAction}function dW(r){return r.__anyUnmutedTones}function db(r,e){let t=fu(r,e);return t?Qx(r,t.index):[]}function xT(r){let e=cb(r);if(!e)return!1;let t=R0(r,e.index);return t?(vo(r,t),t.index===B0(r)-1&&e.type==="expression"&&al(e)&&Qx(r,t.index),!0):!1}function wT(r){let e=cb(r);if(!e)return!1;let t=F0(r,e.index);return t?(vo(r,t),!0):!1}function pW(r,e){let t=r.selectedItemMap;return e in t?t[e]:void 0}function Za(r){return!!r.controller.getListModel().selectedItemMap[r.id]}function uW(r){if(!r.controller.shouldShowAuthorFeatures()){r.renamePrompt.invalidate();return}let e=cb(r);r.renamePrompt.updateForSelectedItem(r,e)}function U0(r,e){r.dragState=e}function q0(r){switch(r.type){case"expression":return ew(r);case"image":return oT(r);case"table":return[];case"text":return[];case"folder":return[];default:return r}}function hW(r,e){for(let t of mT(r))t.type==="folder"&&Fx(t,e)}function Zx(r){return r?r.type==="image"&&ab(r)||r.type==="expression"&&xs(r):!1}function Z2(r){return r.__exportedVariables}Xa();var sw=class{suspend(){return new Promise((e,t)=>{if(this.audioContext)this.audioContext.suspend().then(()=>{e()}).catch(o=>{Vo(o),t(o)});else{e();return}})}getResumedAudioContext(){return new Promise((e,t)=>{if(!this.audioContext){let o=window.AudioContext||window.webkitAudioContext;if(!o){t();return}try{this.audioContext=new o({latencyHint:"interactive",sampleRate:44100})}catch(i){t(i)}}this.audioContext&&(this.audioContext.state!=="running"?this.audioContext.resume().then(()=>{e({audioContext:this.audioContext,poiBuffer:this.poiBuffer})}).catch(o=>{Vo(o),t(o)}):this.audioContext.resume().then(()=>{e({audioContext:this.audioContext,poiBuffer:this.poiBuffer})}).catch(o=>{Vo(o),t(o)}))})}};var bne=.25;function mW(r,e){return bne*__dcg_shared_module_exports__['fc'](r,0,yne(e))}function yne(r){return r<=0||!isFinite(r)?0:__dcg_shared_module_exports__['fc'](660/r,0,10)}var ws,xne="data:audio/mpeg;base64,//uQx"+"A".repeat(23)+"WGluZwAAAA8AAAACAAACcQCA"+"gICA".repeat(16)+"/".repeat(66)+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+"A".repeat(320)+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+"/".repeat(15)+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+"/".repeat(18)+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+"V".repeat(97)+"Q==";function wne(){ws&&(ws.src="about:blank",ws.load(),ws=void 0)}function TT(){if(!(!Rs&&!mc)){if(!ws){let r=document.createElement("div");ws=document.createElement("audio"),r.appendChild(ws),ws.setAttribute("x-webkit-airplay","deny"),ws.controls=!1,ws.disableRemotePlayback=!0,ws.preload="auto",ws.loop=!0,ws.src=xne,ws.load()}ws.paused&&ws.play().catch(wne)}}function GT(){ws&&ws.pause()}var fW=44100,yu=hx?.02:0,Q0=class{constructor(e){this.expressionSynthMap=new Map;this.useOfflineContext=!1;this.globalUnmuteState=!1;this.hasEverInteractedWithMute=!1;this.maxGain=.5;this.handleVisibilityChange=()=>{!this.audioContext||this.isGlobalMuted()||document.visibilityState==="hidden"&&this.controller.dispatch({type:"mute-global"})};this.handleBeforeUnload=()=>{if(!this.audioContext||this.isGlobalMuted())return;let e=this.audioContext;e instanceof AudioContext&&setTimeout(()=>{if(e.state!=="closed")try{e.close()}catch(t){}},100),this.controller.dispatch({type:"mute-global"}),this.controller.runAfterDispatch(()=>this.clearAudioContext())};this.audioContextManager=new sw,this.controller=e,document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("beforeunload",this.handleBeforeUnload)}unload(){this.handleBeforeUnload()}setOfflineAudio(){this.useOfflineContext=!0}prepareToRenderAudio(e){this.useOfflineContext&&(this.offlineBuffer=void 0,this.audioContext=new OfflineAudioContext(1,e*fW,fW),this.audioContext.addEventListener("complete",async t=>{this.offlineBuffer=t.renderedBuffer,this.clearAudioContext()}),this.createMainNodes(),this.recomputeAudio())}getHasEverInteractedWithMute(){return this.hasEverInteractedWithMute}registerMuteInteraction(){this.hasEverInteractedWithMute=!0}async startRendering(){return this.audioContext.startRendering()}getRenderedBuffer(){return this.offlineBuffer}clearAudioContext(){for(let e of this.expressionSynthMap.values())e.tearDown();this.audioContext=void 0,this.expressionSynthMap=new Map}async spinUpAudioContext(){if(!this.useOfflineContext){if(this.audioContext)this.audioContext.state==="suspended"&&!this.useOfflineContext&&await this.audioContext.resume();else{let e=await this.audioContextManager.getResumedAudioContext();this.audioContext=e.audioContext}this.gainNode||this.createMainNodes()}}createMainNodes(){this.audioContext&&(this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.compressor=this.audioContext.createDynamicsCompressor(),this.compressor.threshold.value=-10,this.compressor.knee.value=4,this.compressor.ratio.value=20,this.compressor.attack.value=.01,this.compressor.release.value=.01,this.gainNode.connect(this.compressor),this.compressor.connect(this.audioContext.destination))}async _recomputeAudio(e){var t,o,i,n,a,s,l;if(e.length!==0&&!(this.nothingShouldSound()&&((t=this.audioContext)==null?void 0:t.state)!=="running")){if(this.useOfflineContext){if(!this.audioContext)return}else await this.spinUpAudioContext();if(this.nothingShouldSound()){if(this.expressionSynthMap.size>0){for(let c of this.expressionSynthMap.values())c.tearDown();this.expressionSynthMap.clear()}}else for(let c of e){let d=c.type==="expression"?c.formula.typed_constant_value:void 0,p=c.id;d&&!this.expressionSynthMap.has(p)&&this.expressionSynthMap.set(p,new IT(this,this.gainNode)),(o=this.expressionSynthMap.get(p))==null||o.updateFromValues(d),c.type==="remove"&&this.expressionSynthMap.has(p)?((i=this.expressionSynthMap.get(p))==null||i.tearDown(),this.expressionSynthMap.delete(p)):c.type==="expression"&&(Z0(c)?(a=this.expressionSynthMap.get(p))==null||a.setGain(0):(n=this.expressionSynthMap.get(p))==null||n.setGain(this.maxGain))}this.audioContext&&(this.expressionSynthMap.size>0&&!this.isGlobalMuted()?(s=this.gainNode)==null||s.gain.setTargetAtTime(1,this.audioContext.currentTime+yu,Mh):(l=this.gainNode)==null||l.gain.setTargetAtTime(0,this.audioContext.currentTime+yu,Mh))}}nothingShouldSound(){return!this.globalUnmuteState||!this.hasAnyUnmutedTones()}recomputeAudio(){N0(this.controller.getListModel());let t=this.controller.getAllItemModels().filter(n=>z0(n)),o=[],i=new Set(t.map(n=>n.id));for(let n of this.expressionSynthMap.keys())i.has(n)||o.push({id:n,type:"remove"});this._recomputeAudio([...t,...o])}isGlobalMuted(){return!this.globalUnmuteState}someExpressionsShouldPlayTones(){var e,t;return(t=(e=this.controller)==null?void 0:e.getAllItemModels())==null?void 0:t.some(o=>z0(o))}hasAnyUnmutedTones(){return dW(this.controller.getListModel())}handleAction(e){var t,o,i,n;switch(e.type){case"mute-global":{GT(),this.globalUnmuteState=!1,(o=(t=this.controller).logEvent)==null||o.call(t,{category:"tone",action:"mute-global"});break}case"unmute-global":{TT(),this.globalUnmuteState=!0,this.hasEverInteractedWithMute=!0,(n=(i=this.controller).logEvent)==null||n.call(i,{category:"tone",action:"unmute-global"});break}default:return e}this.recomputeAudio()}handleMuteKeyShortcut(){this.controller.toneItemsExist()?this.isGlobalMuted()?(this.controller.dispatch({type:"unmute-global"}),Bt(this.controller.s("graphing-calculator-narration-unmuted")),this.someExpressionsShouldPlayTones()||Bt(this.controller.s("graphing-calculator-narration-no-playing-tones"))):(this.controller.dispatch({type:"mute-global"}),Bt(this.controller.s("graphing-calculator-narration-muted"))):Bt(this.controller.s("graphing-calculator-narration-no-tone-expressions")),Te()}};var Mh=.005,vne=15e-5,lw=20,cw=2e4,eR=class{constructor(e,t){e.audioContext&&(this.audioContext=e.audioContext,this.oscillator=this.audioContext.createOscillator(),this.oscillator.type="sine",this.gain=this.audioContext.createGain(),this.gain.gain.value=0,this.oscillator.connect(this.gain),this.gain.connect(t),this.oscillator.start())}stop(e=0){this.gain.gain.setTargetAtTime(0,this.audioContext.currentTime+e+yu,Mh),setTimeout(()=>{this.oscillator.stop()},1e3*(2*Mh+e+yu)+1)}setFrequencyAndGain(e,t){(!isFinite(e)||!isFinite(t)||e>cw||e<lw)&&(t=0);let o=mW(t,e);o>0&&this.oscillator.frequency.setTargetAtTime(__dcg_shared_module_exports__['fc'](e,lw,cw),this.audioContext.currentTime+yu,vne),this.gain.gain.setTargetAtTime(o,this.audioContext.currentTime+yu,Mh)}},IT=class{constructor(e,t){e.audioContext&&(this.audioContext=e.audioContext,this.gain=this.audioContext.createGain(),this.gain.gain.value=0,this.gain.connect(t),this.synthesizers=[])}updateFromValues(e){var t,o,i;if(e&&e.valueType===__dcg_shared_module_exports__['Ma'])this.synthesizers.length>1?(this.tearDownSynthesizers(this.synthesizers.slice(1)),this.synthesizers.length=1):this.synthesizers.length===0&&(this.synthesizers=[this.makeSynth()]),(t=this.synthesizers[0])==null||t.setFrequencyAndGain(e.value[0],e.value[1]);else if(e&&e.valueType===__dcg_shared_module_exports__['Na']){if(this.synthesizers.length>e.value.length&&(this.tearDownSynthesizers(this.synthesizers.slice(e.value.length)),this.synthesizers.length=e.value.length),e.value.length>this.synthesizers.length)for(let n=this.synthesizers.length;n<e.value.length;n++)this.synthesizers.push(this.makeSynth());for(let n=0;n<e.value.length;n++)this.synthesizers[n].setFrequencyAndGain(e.value[n][0],e.value[n][1])}else this.tearDownSynthesizers(this.synthesizers),this.synthesizers=[];this.synthesizers.length>0?(o=this.gain)==null||o.gain.setTargetAtTime(1,this.audioContext.currentTime+yu,Mh):(i=this.gain)==null||i.gain.setTargetAtTime(0,this.audioContext.currentTime+yu,Mh)}makeSynth(){return new eR(this,this.gain)}tearDownSynthesizers(e){if(e)for(let t of e)t.stop()}setGain(e){this.gain.gain.setTargetAtTime(e,this.audioContext.currentTime+yu,Mh)}tearDown(){this.tearDownSynthesizers(this.synthesizers),this.synthesizers=[]}};var tC=4;function oR(r){return r===void 0?NaN:+r}function $c(r){return!!r&&r.type==="expression"&&!!r.formula&&!!r.formula.typed_constant_value&&!!r.formula.geometry}function xW(r){var t,o;let e=r.formula;return e?r.controller.isDecimalToFractionEnabled()&&((t=e.typed_constant_value)==null?void 0:t.valueType)===__dcg_shared_module_exports__['ba']&&__dcg_shared_module_exports__['Xb'](oR((o=e.typed_constant_value)==null?void 0:o.value)):!1}function Ah(r){return!!(r.formula&&r.formula.is_graphable)}function MT(r){return!(!mp(r)||!cC(r)||!lC(r))}function iR(r){var a,s;let e=r.formula;if(!e)return!1;if(e.warning){let l=(a=r.formula.typed_constant_value)==null?void 0:a.value;if(l===void 0||Number.isNaN(l))return!1}let o=!(e.operator==="="&&r.controller.isThreeDMode()&&(e.assignment==="x"||e.assignment==="y"||e.assignment==="z"||e.assignment==="r"))&&e.is_evaluable&&((s=e.typed_constant_value)==null?void 0:s.value)!==void 0&&e.typed_constant_value.valueType!==__dcg_shared_module_exports__['ca']&&!(__dcg_shared_module_exports__['sd'](r.latex)instanceof __dcg_shared_module_exports__['Yc']),i=xW(r)&&cm(r),n=!!e.rgb_value&&r.formula.assignment;return!!(o||i||n)}function Vh(r){var a,s,l;let e=(a=r.formula)==null?void 0:a.recursion;if(!e||e.type==="iterative"||!e.recursiveStructure)return[];if(e.recursionGroup.length>1)return[];let{maxRecursiveCallOffsets:t,parameterSymbols:o,baseCaseInfo:i}=e.recursiveStructure,n=[];for(let c in t){if(((s=o[c])==null?void 0:s.length)!==1)continue;let d=i[c];if(d&&Math.abs(d.min)>E2)continue;let p=t[c],u,h;d?(u=d.min+p-1,h=d.min+d.consecutiveCount):(u=p,h=1);for(let m=h;m<=u;m++)if(!((l=d==null?void 0:d.additional)!=null&&l.includes(m))&&(n.push(`${__dcg_shared_module_exports__['$b'](c)}\\left(${m}\\right)`),n.length>tC))return[]}return n}function nR(r){var t;let e=(t=r.formula.typed_constant_value)==null?void 0:t.value;return r.formula.rgb_value?r.formula.rgb_value:iR(r)||xW(r)?e:NaN}function dw(r){let e=r.formula.ttest_results;if(!(!e||!isFinite(e.lessThan)))return{lessThan:e.lessThan,greaterThan:e.greaterThan,notEqual:e.notEqual}}function wW(r){let e=r.formula.stats_results;if(!(!e||!isFinite(e.min)))return{min:e.min,q1:e.q1,median:e.median,q3:e.q3,max:e.max}}function lm(r,e){if(!isFinite(e))return r;let t=r.indexOf("=")+1;return Qo(r.slice(t),!1)===e?r:r.slice(0,t)+__dcg_shared_module_exports__['ke'](e)}function al(r){let e=r.latex||"",t=r.label||"";return(e+t).split(" ").join("")===""}function Ci(r,e={isReverseDrag:!1}){let t=r.dragMode==="AUTO"&&r.formula.default_drag_mode!==void 0?r.formula.default_drag_mode:r.dragMode;return r.controller.isThreeDMode()&&(t="NONE"),r.dragMode==="AUTO"&&!e.isReverseDrag&&ma(r)&&(t="NONE"),__dcg_shared_module_exports__['ob'](t,r.formula.move_strategy)}function Ene(r){let e=Ci(r);r.interactiveLabel&&e!=="NONE"&&iC(r,!1)}function _d(r,e,t){if(!r.sliderExists)return NaN;let o=jc(r),i=gp(r),n=Td(r);if(t&&t.overwriteStep!==void 0&&(n=t.overwriteStep),e=__dcg_shared_module_exports__['cd']({target:e,hardMin:r.slider.hardMin?o:void 0,hardMax:r.slider.hardMax?i:void 0,step:n}),!t||!t.ignoreSoftLimits){if(!r.slider.hardMin&&e<o)return o;if(!r.slider.hardMax&&e>i)return i}return e}function aR(r,e,t={}){if(!r.sliderExists)return NaN;let o=Ll(r),i=jc(r),n=gp(r),a=Td(r);t.overwriteStep===void 0&&(t.overwriteStep=a||(n-i)/20);let s=0;switch(e){case"min":return _d(r,i);case"max":return _d(r,n);case"up":s=1;break;case"down":s=-1;break;case"bigup":s=5;break;case"bigdown":s=-5;break;default:return e}let l=o;for(let c=0;c<20;c++){let d=c/3*t.overwriteStep,p=o;if(s>0)o=_d(r,l+d,t),o>p&&(s-=1);else if(s<0)o=_d(r,l-d,t),o<p&&(s+=1);else break}return o}function AT(r,e){if(!r.sliderExists)return;r.slider.isPlaying&&Cc(r,!1);let t=_d(r,e,{ignoreSoftLimits:!0});r.latex=lm(r.latex,t)}function vW(r,e,t){if(!r.sliderExists)return;r.slider.isPlaying&&Cc(r,!1),hw(r);let o=aR(r,e,t);r.latex=lm(r.latex,o)}function CW(r,e){if(!r.sliderExists)return;r.slider.isPlaying&&Cc(r,!1);let t=_d(r,e);r.latex=lm(r.latex,t)}function SW(r,e){if(!r.sliderExists||r.resetSliderAnimationTargetValue)return;let t=r.sliderLastTickTime;if(r.sliderLastTickTime=e,t===void 0)return;let o=e-t,i=jc(r),n=gp(r),a=Td(r),s=r.slider.animationPeriod,l=r.slider.loopMode;if(isNaN(r.sliderAnimationTargetValue)){let u=Ll(r);isNaN(u)||(r.sliderAnimationTargetValue=u)}let c=a?a/2:0;if(l==="LOOP_FORWARD_REVERSE")r.sliderAnimationTargetValue>=n?es(r,{playDirection:-1}):r.sliderAnimationTargetValue<=i&&es(r,{playDirection:1});else if(l==="LOOP_FORWARD")es(r,{playDirection:1}),r.sliderAnimationTargetValue>=n+c&&(r.sliderAnimationTargetValue=i-c);else if(l==="PLAY_ONCE")es(r,{playDirection:1});else if(l==="PLAY_INDEFINITELY")es(r,{playDirection:1});else throw new Error("Unexpected slider loop mode: "+l);isFinite(o)||(o=0);let d,p;if(l==="PLAY_INDEFINITELY")d=o/(s/4),a&&(d*=a),r.sliderAnimationTargetValue+=d,p=r.sliderAnimationTargetValue,a||(p=ni(p-d*.1,p+d*.1)),p=_d(r,p,{ignoreSoftLimits:!0}),r.latex=lm(r.latex,p);else{if(o=Math.min(o,s/10),d=(n-i)*o/s,r.sliderAnimationTargetValue+=d*r.slider.playDirection,r.sliderAnimationTargetValue=Math.max(i-c,Math.min(n+c,r.sliderAnimationTargetValue)),p=r.sliderAnimationTargetValue,!a){let u=d/o*16.666666666666668;p=ni(p-u*.1,p+u*.1)}p=_d(r,p),r.latex=lm(r.latex,p)}}function ew(r){let e=r.formula;return e?e.is_single_identifier?[]:e.variables.map(t=>__dcg_shared_module_exports__['$b'](t))||[]:[]}function j2(r,e){r.formula=e,r.error=e.error,r.unresolved=!1,r.expressionTooComplex=!1,r.recursiveDepthPlottingError=!1,r.nanBlame=__dcg_shared_module_exports__['fe'].None,e.is_slider?(!r.sliderExists||r.resetSliderAnimationTargetValue)&&(r.sliderAnimationTargetValue=Ll(r),r.sliderDragging=!1,r.sliderExists=!0):r.sliderExists=!1,r.resetSliderAnimationTargetValue=!1;let t={};e.is_regression&&(t=e.regression.parameters,r.residualVariable=e.regression.residualVariable,r.controller.areLogModeRegressionsForced()&&(r.isLogModeRegression=!0)),__dcg_shared_module_exports__['J'](r.regressionParameters,t)||(r.regressionParameters=t)}function vc(r){var e,t;return r.type==="expression"&&(((e=r.formula.typed_constant_value)==null?void 0:e.valueType)===__dcg_shared_module_exports__['Ma']||((t=r.formula.typed_constant_value)==null?void 0:t.valueType)===__dcg_shared_module_exports__['Na'])}function EW(r){var t,o,i,n;if(!vc(r)||((t=r.formula.typed_constant_value)==null?void 0:t.valueType)===__dcg_shared_module_exports__['Na']||((o=r.formula.typed_constant_value)==null?void 0:o.valueType)===__dcg_shared_module_exports__['Ma']&&((i=r.formula.typed_constant_value)==null?void 0:i.value[0])>=lw&&((n=r.formula.typed_constant_value)==null?void 0:n.value[0])<=cw)return!1;let e=__dcg_shared_module_exports__['sd'](r.latex);return!!(e&&e._dependencies&&e._dependencies.length===1)}function Z0(r){var e;return!!r.hidden||!!((e=il(r))!=null&&e.hidden)}function z0(r){return!vc(r)||Z0(r)?!1:r.formula.typed_constant_value.valueType===__dcg_shared_module_exports__['Ma']?r.formula.typed_constant_value.value[1]>0:r.formula.typed_constant_value.valueType===__dcg_shared_module_exports__['Na']?r.formula.typed_constant_value.value.some(e=>e[1]>0):!1}function Dne(r){if(r.shouldGraph=!ma(r),r.folderId===__dcg_shared_module_exports__['xb']){let e=r.controller.getExpressionIdForIdentifier(r.controller.getHoveredOrFocusedTokenIdentifier())===r.id,t=r.controller.isItemSelected(r.id);(e||t||r.controller.getGhostMode())&&(r.shouldGraph=!0)}}function ma(r){var t;if(!r)return!1;if(r.hidden)return!0;if((t=r==null?void 0:r.formula)!=null&&t.expression_type&&mw(r))return!0;let e=il(r);return!!(e&&e.hidden)}function kne(r){let e=r.formula&&r.formula.raw_slider_latex;if(!r.sliderExists||r.latex!==e){r.cachedDisplayLatex={storedLatex:r.latex,valueLatex:r.latex};return}let{latex:t}=r;if(r.cachedDisplayLatex.storedLatex!==t){r.cachedDisplayLatex={storedLatex:r.latex,valueLatex:r.latex};return}let o=kW(r);if(isFinite(o)){let i=r.controller.getFocusLocation();i&&i.type==="expression"&&i.id===r.id||(r.cachedDisplayLatex.valueLatex=lm(r.latex,o))}}function rC(r){return r.cachedDisplayLatex.valueLatex}function DW(r){return __dcg_shared_module_exports__['Tb'](r).latex}function sR(r){return r.slider.hardMin?r.slider.min:DW(jc(r))}function lR(r){return r.slider.hardMax?r.slider.max:DW(gp(r))}function jc(r){if(r.slider.hardMin){let e=r.formula.slider_min_number;return isFinite(e)?e:NaN}else{let e=r.controller.getDegreeMode(),t=Qo(r.slider.min,e),o=Ll(r),i=Td(r),n=r.slider.hardMax?r.formula.slider_max_number:void 0,s=r.controller.is3dProduct()?__dcg_shared_module_exports__['ub'].xmin:-10;if(t<s&&(s=t),o<s&&(s=o),n<s&&(s=n),i){let l=__dcg_shared_module_exports__['cd']({target:s,hardMin:void 0,hardMax:n,step:i});l<=s?s=l:s=l-i}return s}}function gp(r){if(r.slider.hardMax){let e=r.formula.slider_max_number;return isFinite(e)?e:NaN}else{let e=r.controller.getDegreeMode(),t=Qo(r.slider.max,e),o=Ll(r),i=Td(r),n=r.slider.hardMin?r.formula.slider_min_number:void 0;return __dcg_shared_module_exports__['dd']({storedMax:t,sliderValue:o,step:i,hardMin:n,is3d:r.controller.is3dProduct()})}}function Td(r){return r.formula.slider_step_number}function kW(r){var t;if(!r.formula||!r.formula.is_slider)return;let e=(t=r.formula.typed_constant_value)==null?void 0:t.value;if(e!==void 0)return+e}function Ll(r){let e=r.formula&&r.formula.raw_slider_latex;if(r.latex!==e)return C0(r.latex);let t=kW(r);return isFinite(t)?t:NaN}function cR(r){return r.slider.loopMode!=="PLAY_ONCE"?!1:Ll(r)>=gp(r)}function _W(r,e){return r.formula.viz_valids?!!r.formula.viz_valids[e]:!1}function Lh(r,e){return r.vizProps[e]}function TW(r,e,t){r.vizProps={...r.vizProps,[e]:t}}function pw(r,e){if(e.type==="inert")r.disableGraphInteractions=e.disableGraphInteractions,e.disableGraphInteractions&&(r.dragMode="NONE",r.clickableInfo={...r.clickableInfo,enabled:!1},r.editableLabelMode="NONE",r.interactiveLabel=!1);else if(e.type==="drag-mode"){let t=e.dragMode;r.dragMode=t,t!=="NONE"&&(r.disableGraphInteractions=!1),r.movablePointSize!==r.pointSize&&(t==="NONE"?r.pointSize=r.movablePointSize:r.movablePointSize=r.pointSize)}else e.type==="clickable"?(r.clickableInfo=e.clickableInfo,e.clickableInfo.enabled&&(r.disableGraphInteractions=!1)):e.type==="editable-label"?(r.editableLabelMode=e.editable,e.editable!=="NONE"&&(r.disableGraphInteractions=!1)):e.type==="interactive-label"&&(r.interactiveLabel=e.interactive,e.interactive&&(r.disableGraphInteractions=!1))}function GW(r,e,t){pw(r,{type:"clickable",clickableInfo:{...r.clickableInfo,[e]:t}})}function vT(r,e){pw(r,{type:"clickable",clickableInfo:{...r.clickableInfo,latex:e}})}function xs(r){var e;return!!(r.clickableInfo.enabled&&MR(r)&&((e=r.formula.click_handler)==null?void 0:e.status)==="maybe-valid")}function uw(r){return!!(r&&r.type==="expression"&&xs(r))}function IW(r){return!!r.__workerNeedsDotplotXMode}function VT(r){return!!(r.formula&&r.formula.slider_min_valid)}function LT(r){return!!(r.formula&&r.formula.slider_max_valid)}function PT(r){return!!(r.formula&&r.formula.slider_step_valid)}function OT(r,e){var t;if(!e)throw new Error("Programming Error in test. Pass domain variable");return(t=r.formula.domains)==null?void 0:t.find(o=>o.variable===e)}function MW(r,e){if(!r.formula)return NaN;if(xw(r)&&isFinite(r.__workerSampledDomainMin))return r.__workerSampledDomainMin;let t=OT(r,e),o=t==null?void 0:t.minNumber;return o!==void 0&&isFinite(o)?o:NaN}function AW(r,e){if(!r.formula)return NaN;if(xw(r)&&isFinite(r.__workerSampledDomainMax))return r.__workerSampledDomainMax;let t=OT(r,e),o=t==null?void 0:t.maxNumber;return o!==void 0&&isFinite(o)?o:NaN}function VW(r,e){let t=OT(r,e);return t?t.minValid:!1}function LW(r,e){let t=OT(r,e);return t?t.maxValid:!1}function H0(r,e){let t=r.cachedViewState;if((!e.stripDefaults||r.parametricDomain.min!==""||r.parametricDomain.max!=="")&&(t={...t,domain:{min:r.parametricDomain.min===""?"0":r.parametricDomain.min,max:r.parametricDomain.max===""?"1":r.parametricDomain.max}}),e.stripDefaults)return __dcg_shared_module_exports__['Eb'](t,{is3d:r.controller.is3dProduct()});if(t.points===void 0||t.lines===void 0||t.fill===void 0){let o=__dcg_shared_module_exports__['i'](t);return o.points===void 0&&delete o.points,o.lines===void 0&&delete o.lines,o.fill===void 0&&delete o.fill,o}return t}function _ne(r){let e=r.cachedViewState;e&&__dcg_shared_module_exports__['Gb'](e,r)&&e.folderId===r.folderId&&e.color===r.color&&e.latex===r.latex&&e.showLabel===r.showLabel&&e.showAngleLabel===r.showAngleLabel&&e.label===r.label&&e.hidden===r.hidden&&e.secret===r.secret&&e.readonly===r.readonly&&e.disableGraphInteractions===r.disableGraphInteractions&&e.fill===r.fill&&e.points===r.points&&e.lines===r.lines&&e.extendTo3D===r.extendTo3D&&e.lineStyle===r.lineStyle&&e.arrowMode===r.arrowMode&&e.pointStyle===r.pointStyle&&e.dragMode===r.dragMode&&e.labelSize===r.labelSize&&e.labelOrientation===r.labelOrientation&&e.suppressTextOutline===r.suppressTextOutline&&e.interactiveLabel===r.interactiveLabel&&e.editableLabelMode===r.editableLabelMode&&e.residualVariable===r.residualVariable&&e.regressionParameters===r.regressionParameters&&e.isLogModeRegression===r.isLogModeRegression&&e.displayEvaluationAsFraction===r.displayEvaluationAsFraction&&e.slider===r.slider&&e.strictIntersection===r.strictIntersection||(r.cachedViewState={type:r.type,id:r.id,folderId:r.folderId,color:r.color,latex:r.latex,showLabel:r.showLabel,showAngleLabel:r.showAngleLabel,label:r.label,hidden:r.hidden,secret:r.secret,readonly:r.readonly,disableGraphInteractions:r.disableGraphInteractions,points:r.points,lines:r.lines,extendTo3D:r.extendTo3D,lineStyle:r.lineStyle,arrowMode:r.arrowMode,pointStyle:r.pointStyle,fill:r.fill,dragMode:r.dragMode,labelSize:r.labelSize,labelOrientation:r.labelOrientation,suppressTextOutline:r.suppressTextOutline,interactiveLabel:r.interactiveLabel,editableLabelMode:r.editableLabelMode,residualVariable:r.residualVariable,regressionParameters:r.regressionParameters,isLogModeRegression:r.isLogModeRegression,displayEvaluationAsFraction:r.displayEvaluationAsFraction,slider:r.slider,strictIntersection:r.strictIntersection,...__dcg_shared_module_exports__['Fb'](r)})}function dR(r,e){e&&hw(r),r.draggingOnGraphpaper=e}function Tne(r){let e=r.memoizedUndoRedoStateParams,t=r.cachedViewState,o=r.preTransientState;if(r.cachedUndoRedoFullState=t,e&&e.viewState===t&&e.preTransientState===o)return;r.memoizedUndoRedoStateParams={viewState:t,preTransientState:o};let i;o?i={...t,latex:o.latex,slider:{...t.slider,...o.slider}}:i={...t},delete i.regressionParameters,delete i.residualVariable,r.cachedUndoRedoDiffState=i}function CT(r,e){let t=__dcg_shared_module_exports__['i'](__dcg_shared_module_exports__['Db'](r,{is3d:e.is3dProduct(),defaultLogModeRegressions:e.areLogModeRegressionsDefault()})),{color:o}=t;return(!o||!kx(o))&&(o=e.getNextColor()),{...t,...pu(e),labelDropdownOpen:!1,formula:{error:void 0,operator:"=",variables:[]},error:void 0,unresolved:!1,expressionTooComplex:!1,color:o,pointStyle:t.pointStyle,lineStyle:t.lineStyle,arrowMode:t.arrowMode,displayEvaluationAsFraction:t.displayEvaluationAsFraction,shouldGraph:void 0,sliderDragging:void 0,sliderAnimationTargetValue:void 0,resetSliderAnimationTargetValue:!1,sliderLastTickTime:void 0,draggingOnGraphpaper:!1,cachedUndoRedoDiffState:void 0,cachedUndoRedoFullState:void 0,cachedParsableState:void 0,cachedViewState:void 0,cachedDisplayLatex:{storedLatex:"",valueLatex:""}}}function Gne(r){let e=il(r),t=!!(e&&e.hidden),o=r.cachedViewState,i=r.index,n=r.showLabel&&!t,a=r.showAngleLabel,s=r.shouldGraph,l=r.memoizedParsableStateParams;if(l&&l.viewState===o&&l.index===i&&l.showLabel===n&&l.showAngleLabel===a&&l.shouldGraph===s)return;r.memoizedParsableStateParams={viewState:o,index:i,showLabel:n,showAngleLabel:a,shouldGraph:s};let c=__dcg_shared_module_exports__['Hb'](o);c.index=i,c.showLabel=n,c.showAngleLabel=a,c.shouldGraph=s,c.isInConstructionsFolder=r.folderId===__dcg_shared_module_exports__['xb'],r.cachedParsableState=c}function ST(r,e){e(r.latex,"latex"),e(r.clickableInfo.latex,"clickableInfoLatex"),e(r.lineWidth,"lineWidth"),e(r.fillOpacity,"fillOpacity"),e(r.surfaceOpacity,"surfaceOpacity"),e(r.lineOpacity,"lineOpacity"),e(r.pointOpacity,"pointOpacity"),e(r.pointSize,"pointSize"),e(r.movablePointSize,"movablePointSize"),e(r.labelSize,"labelSize"),e(r.labelAngle,"labelAngle"),e(r.colorLatex,"colorLatex"),ub(r)&&(e(r.parametricDomain.min,"parametricDomainMin"),e(r.parametricDomain.max,"parametricDomainMax")),(a7(r)||n7(r))&&(e(r.parametricDomain3Du.min,"parametricDomain3DuMin"),e(r.parametricDomain3Du.max,"parametricDomain3DuMax"),e(r.parametricDomain3Dv.min,"parametricDomain3DvMin"),e(r.parametricDomain3Dv.max,"parametricDomain3DvMax")),(xw(r)||zT(r))&&(e(r.polarDomain.min,"polarDomainMin"),e(r.polarDomain.max,"polarDomainMax")),(vR(r)||wR(r))&&e(r.resolution,"resolution"),mp(r)&&(e(r.cdf.min,"cdfMin"),e(r.cdf.max,"cdfMax")),r.sliderExists&&(e(r.slider.min,"sliderMin"),e(r.slider.max,"sliderMax"),e(r.slider.step,"sliderStep")),r.residualVariable&&e(r.residualVariable,"residualVariable")}function Ns(r){return r.formula&&r.formula.assignment}function pR(r){return r.formula&&r.formula.shader}function xn(r){let e=r.cachedAssignmentOrFunctionName;if(e&&e.latex===r.latex)return e.result;let t=S0(r.latex),o=t?{latex:t,identifier:__dcg_shared_module_exports__['ac'](t)}:void 0;return r.cachedAssignmentOrFunctionName={latex:r.latex,result:o},o}function PW(r){var t,o;let e=(o=(t=r.formula)==null?void 0:t.typed_constant_value)==null?void 0:o.valueType;return e==null?!1:__dcg_shared_module_exports__['bb'](e)}function RT(r){var o;let e=(o=xn(r))==null?void 0:o.latex,t=e==null?void 0:e.match(/^(\\token\{\d+\})$/);if(t)return t[1]}function OW(r){var o,i;let e=(i=(o=r.formula)==null?void 0:o.typed_constant_value)==null?void 0:i.valueType,t=!1;if(e&&__dcg_shared_module_exports__['bb'](e)&&(t=!0,e=__dcg_shared_module_exports__['cb'](e)),e==null||!__dcg_shared_module_exports__['db'](e))return"U";switch(e){case __dcg_shared_module_exports__['da']:return t?"P":"p";case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['ya']:case __dcg_shared_module_exports__['wa']:return t?"L":"l";case __dcg_shared_module_exports__['Ga']:return t?"V":"v";case __dcg_shared_module_exports__['ua']:case __dcg_shared_module_exports__['sa']:return t?"C":"c";case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:return t?"A":"a";case __dcg_shared_module_exports__['oa']:return"P";case __dcg_shared_module_exports__['Ea']:return"T";default:return e}}function Ine(r){var t,o;let e=(o=(t=r.formula)==null?void 0:t.typed_constant_value)==null?void 0:o.valueType;if(e==null||(__dcg_shared_module_exports__['bb'](e)&&(e=__dcg_shared_module_exports__['cb'](e)),!__dcg_shared_module_exports__['db'](e)))return"unknown";switch(e){case __dcg_shared_module_exports__['da']:return"point";case __dcg_shared_module_exports__['qa']:return"segment";case __dcg_shared_module_exports__['ya']:return"ray";case __dcg_shared_module_exports__['wa']:return"line";case __dcg_shared_module_exports__['Ga']:return"vector";case __dcg_shared_module_exports__['ua']:return"arc";case __dcg_shared_module_exports__['sa']:return"circle";case __dcg_shared_module_exports__['Aa']:return"angle";case __dcg_shared_module_exports__['Ca']:return"directedangle";case __dcg_shared_module_exports__['oa']:return"polygon";case __dcg_shared_module_exports__['Ea']:return"transformation";default:return e}}function uR(r){var t,o;let e=(o=(t=r.formula)==null?void 0:t.typed_constant_value)==null?void 0:o.valueType;if(e==null||(__dcg_shared_module_exports__['bb'](e)&&(e=__dcg_shared_module_exports__['cb'](e)),!__dcg_shared_module_exports__['db'](e)))return"unknown";switch(e){case __dcg_shared_module_exports__['da']:return"point";case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['ya']:case __dcg_shared_module_exports__['wa']:case __dcg_shared_module_exports__['Ga']:return"line";case __dcg_shared_module_exports__['ua']:return"arc";case __dcg_shared_module_exports__['sa']:return"circle";case __dcg_shared_module_exports__['Aa']:return"angle";case __dcg_shared_module_exports__['Ca']:return"directedangle";case __dcg_shared_module_exports__['oa']:return"polygon";case __dcg_shared_module_exports__['Ea']:return"transformation";default:return e}}function RW(r){return r.indexOf("\\token{")!==-1}function FW(r){var o,i,n,a;let e=(i=(o=r.formula.geometry)==null?void 0:o.call)==null?void 0:i.symbol,t=(a=(n=r.formula)==null?void 0:n.typed_constant_value)==null?void 0:a.valueType;return!e||e==="apply"||__dcg_shared_module_exports__['gd'](e)&&t!==void 0&&!__dcg_shared_module_exports__['fb'](t,__dcg_shared_module_exports__['Ea'])?Ine(r):e==="segments"?"segment":e}function Mne(r){return!!(r.sliderExists&&(r.slider.isPlaying||r.sliderDragging)||r.draggingOnGraphpaper)}function NW(r){return!!(r.sliderExists&&r.sliderDragging||r.draggingOnGraphpaper)}function hR(r){Mne(r)?r.preTransientState||(r.preTransientState={latex:r.latex,slider:{min:r.slider.min,max:r.slider.max,playDirection:r.slider.playDirection}}):delete r.preTransientState,(!r.sliderExists||!r.slider.isPlaying)&&(r.sliderLastTickTime=void 0),uu(r),Dne(r),Ene(r),_ne(r),Tne(r),Gne(r),kne(r)}var Ane={id:!1,type:!1,color:!0,folderId:!0,latex:!0,showLabel:!0,showAngleLabel:!0,label:!0,hidden:!0,secret:!0,readonly:!0,disableGraphInteractions:!0,points:!0,lines:!0,lineStyle:!0,arrowMode:!0,pointStyle:!0,fill:!0,dragMode:!0,labelSize:!0,labelOrientation:!0,suppressTextOutline:!0,interactiveLabel:!0,editableLabelMode:!0,residualVariable:!0,regressionParameters:!0,isLogModeRegression:!0,displayEvaluationAsFraction:!0,slider:!0,strictIntersection:!0,angleType:!0,showAngleDirection:!0,extendTo3D:!1,...__dcg_shared_module_exports__['tb'](__dcg_shared_module_exports__['zb'])};function gW(r,e){__dcg_shared_module_exports__['qb']({from:e,to:r,props:Ane}),r.resetSliderAnimationTargetValue=!0,r.sliderAnimationTargetValue=void 0}function tw(r,e){e?es(r,{hardMin:!0,min:e}):es(r,{hardMin:!1,min:r.controller.is3dProduct()?`${__dcg_shared_module_exports__['ub'].xmin}`:"-10"})}function rw(r,e){e?es(r,{hardMax:!0,max:e}):es(r,{hardMax:!1,max:r.controller.is3dProduct()?`${__dcg_shared_module_exports__['ub'].xmax}`:"10"})}function es(r,e){r.slider={...r.slider,...e}}function Cc(r,e){!r||r.slider.isPlaying===e||(es(r,{isPlaying:e}),e&&(hw(r),r.sliderAnimationTargetValue=Ll(r)))}function hw(r){if(!r.slider.hardMin){let e=__dcg_shared_module_exports__['je'](jc(r));e!==r.slider.min&&es(r,{min:e})}if(!r.slider.hardMax){let e=__dcg_shared_module_exports__['je'](gp(r));e!==r.slider.max&&es(r,{max:e})}}function Al(r,e){let t=C0(e);if(isFinite(t)){let o=__dcg_shared_module_exports__['bd']({target:t,step:Td(r),hardMin:r.slider.hardMin?jc(r):void 0,hardMax:r.slider.hardMax?gp(r):void 0});o.min||es(r,{hardMin:!1,min:"-10"}),o.max||es(r,{hardMax:!1,max:"10"}),o.step||es(r,{step:""})}r.latex=e}function BW(r,e){es(r,{loopMode:e,playDirection:1}),e==="PLAY_INDEFINITELY"&&es(r,{hardMin:!1,hardMax:!1,min:"",max:""}),r.sliderAnimationTargetValue=jc(r)}function oC(r,e){e&&hw(r),r.sliderDragging=e}function K0(r,e){es(r,{step:e})}function UW(r,e){es(r,{animationPeriod:e})}function cm(r){var e;return((e=r.formula.typed_constant_value)==null?void 0:e.valueType)===__dcg_shared_module_exports__['Ka']?!1:r.displayEvaluationAsFraction}function qW(r,e){r.displayEvaluationAsFraction=e}function bu(r,e){r.label=e}function dm(r,e){sm(r)?r.showAngleLabel=e:r.showLabel=e}function zW(r,e){r.description=e}function Gl(r,e,t){switch(t){case"theta":r.polarDomain={...r.polarDomain,min:e};break;case"t":r.parametricDomain={...r.parametricDomain,min:e};break;case"u":r.parametricDomain3Du={...r.parametricDomain3Du,min:e};break;case"v":r.parametricDomain3Dv={...r.parametricDomain3Dv,min:e};break;case"r":r.parametricDomain3Dr={...r.parametricDomain3Dr,min:e};break;case"phi":r.parametricDomain3Dphi={...r.parametricDomain3Dphi,min:e};break;default:return t}}function Il(r,e,t){switch(t){case"theta":r.polarDomain={...r.polarDomain,max:e};break;case"t":r.parametricDomain={...r.parametricDomain,max:e};break;case"u":r.parametricDomain3Du={...r.parametricDomain3Du,max:e};break;case"v":r.parametricDomain3Dv={...r.parametricDomain3Dv,max:e};break;case"r":r.parametricDomain3Dr={...r.parametricDomain3Dr,max:e};break;case"phi":r.parametricDomain3Dphi={...r.parametricDomain3Dphi,max:e};break;default:return t}}function gR(r,e){r.isLogModeRegression=e}function FT(r,e){kx(e)&&(r.color=e,r.colorLatex="")}function mR(r,e){r.fill=e}function W0(r,e){r.fillOpacity!==e&&(r.fillOpacity=e)}function $0(r,e){r.surfaceOpacity!==e&&(r.surfaceOpacity=e)}function ow(r,e){r.lineOpacity!==e&&(r.lineOpacity=e)}function j0(r,e){r.pointOpacity!==e&&(r.pointOpacity=e)}function Y0(r,e){r.pointSize===e&&r.movablePointSize===e||(r.pointSize=e,r.movablePointSize=e)}function iw(r,e){r.lineWidth!==e&&(r.lineWidth=e)}function ET(r,e){r.resolution!==e&&(r.resolution=e)}function X0(r,e){r.colorLatex!==e&&(r.colorLatex=e)}function HW(r,e){r.labelDropdownOpen=e}function pb(r,e){pw(r,{type:"drag-mode",dragMode:e})}function fR(r,e){r.points=e}function bR(r,e){r.pointStyle!==e&&(r.pointStyle=e,e!=="POINT"&&(r.dragMode="NONE"))}function yR(r,e){r.lines=e}function KW(r,e){r.extendTo3D=e}function NT(r,e){r.lineStyle!==e&&(r.lineStyle=e)}function WW(r,e){r.arrowMode=e===Vne(r)?"DEFAULT":e}function Vne(r){return"NONE"}function J0(r,e){r.labelSize=e}function DT(r,e){r.labelAngle=e}function xR(r,e){r.labelOrientation=e}function $W(r,e){r.suppressTextOutline=e}function iC(r,e){pw(r,{type:"interactive-label",interactive:e})}function BT(r,e){pw(r,{type:"editable-label",editable:e})}function jW(r){return r.editableLabelMode}function gw(r){let{editableLabelMode:e}=r;return e==="MATH"||e==="TEXT"}function YW(r,e){r.strictIntersection=e}function XW(r){return!!(Ci(r)!=="NONE"&&ma(r))}function JW(r,e){r.hidden=e,!e&&mw(r)&&(r.lines=r.points=r.fill=void 0)}function mw(r){if(xu(r)&&!r.controller.isThreeDMode())return!1;let{points:e,lines:t,fill:o}=r,i=__dcg_shared_module_exports__['vd'](r.formula.expression_type,{points:e,lines:t,fill:o},n=>{Vo("getReconciledExpressionProps [Chrome Switch Bug]",{metaData:{method:"areAllVisibilityPropsOff",type:n}})});return!i.points&&!i.lines&&!i.fill}function pm(r){return r.formula.map_type!==void 0?!1:ub(r)||xw(r)||zT(r)}function Ph(r){return r.formula.map_type!==void 0?!1:a7(r)||n7(r)||CR(r)}function QW(r,e){switch(e){case"theta":return r.polarDomain.min;case"t":return r.parametricDomain.min;case"u":return r.parametricDomain3Du.min;case"v":return r.parametricDomain3Dv.min;case"r":return r.parametricDomain3Dr.min;case"phi":return r.parametricDomain3Dphi.min;default:return e}}function ZW(r,e){switch(e){case"theta":return r.polarDomain.max;case"t":return r.parametricDomain.max;case"u":return r.parametricDomain3Du.max;case"v":return r.parametricDomain3Dv.max;case"r":return r.parametricDomain3Dr.max;case"phi":return r.parametricDomain3Dphi.max;default:return e}}function fw(r){return!!r.formula.action_value&&Object.keys(r.formula.action_value).length>0}function e7(r){return!!r.sliderExists}function nw(r){return r.formula.expression_type==="POLYGON"}function xu(r){return!!r.formula.is_inequality}function bw(r){return!!r.formula.is_regression}function ub(r){return r.formula.expression_type==="PARAMETRIC"||r.formula.expression_type==="CURVE3D_xyz_t"&&!SR(r)&&!ER(r)}function yw(r){return r.formula.expression_type==="POINT3D"}function wR(r){return r.formula.expression_type==="CURVE3D_xyz_t"||r.formula.expression_type==="SLICE"||r.formula.expression_type==="SLICE_r\u03B8z_at_z"||r.formula.expression_type==="SLICE_zr\u03B8_at_r"||r.formula.expression_type==="SLICE_zr\u03B8_at_\u03B8"||r.formula.expression_type==="SLICE_zr\u03B8_at_xyz"||r.formula.expression_type==="SLICE_r\u03B8\u03C6_at_\u03B8"||r.formula.expression_type==="SLICE_r\u03B8\u03C6_at_\u03C6"||r.formula.expression_type==="SLICE_r\u03B8\u03C6_at_xyz"||r.formula.expression_type==="SLICE_xyz_uv"}function t7(r){return r.formula.expression_type==="SLICE_zr\u03B8_at_r"||r.formula.expression_type==="SLICE_r\u03B8\u03C6_at_\u03B8"}function r7(r){return r.formula.expression_type==="SLICE_zr\u03B8_at_\u03B8"||r.formula.expression_type==="SLICE_r\u03B8\u03C6_at_\u03C6"}function vR(r){switch(r.formula.expression_type){case"SURFACE_xyz_uv":case"SURFACE_z_r\u03B8":case"SURFACE_r_\u03B8z":case"SURFACE_r_\u03B8z_AMBIGUOUS":case"SURFACE_r_\u03B8\u03C6":case"SURFACE":case"SURFACE_AMBIGUOUS":case"SURFACE_CONSTANT_AMBIGUOUS":case"IMPLICIT_SURFACE":case"IMPLICIT_SURFACE_AMBIGUOUS":case"TRIANGLE3D":case"SPHERE3D":return!0;default:return!1}}function UT(r){return r.formula.expression_type==="TRIANGLE3D"}function o7(r){return r.formula.expression_type==="SPHERE3D"}function i7(r){return r.formula.expression_type==="IMPLICIT_SURFACE"||r.formula.expression_type==="IMPLICIT_SURFACE_AMBIGUOUS"}function qT(r){return Lne(r)||Pne(r)}function Lne(r){return r.formula.expression_type==="X_OR_Y"||r.formula.expression_type==="IMPLICIT"||r.formula.expression_type==="SURFACE_AMBIGUOUS"||r.formula.expression_type==="SURFACE_CONSTANT_AMBIGUOUS"||r.formula.expression_type==="IMPLICIT_SURFACE_AMBIGUOUS"}function Pne(r){return!r.formula.is_inequality&&(r.formula.expression_type==="POLAR"||r.formula.expression_type==="SURFACE_r_\u03B8z_AMBIGUOUS")}function xw(r){return r.formula.expression_type==="POLAR"}function zT(r){return __dcg_shared_module_exports__['zd'](r.formula.expression_type)}function CR(r){return __dcg_shared_module_exports__['yd'](r.formula.expression_type)}function n7(r){return __dcg_shared_module_exports__['xd'](r.formula.expression_type)}function a7(r){return r.formula.expression_type==="SURFACE_xyz_uv"||r.formula.expression_type==="SLICE_xyz_uv"}function sm(r){let e=r.formula.typed_constant_value;if(!e)return!1;let t=e.valueType;return t===__dcg_shared_module_exports__['Aa']||t===__dcg_shared_module_exports__['Ba']||t===__dcg_shared_module_exports__['Ca']||t===__dcg_shared_module_exports__['Da']}function Vl(r){let e=sm(r);return e&&r.showAngleLabel||!e&&r.showLabel}function aw(r){if(pp(r))return!0;let e=r.formula.typed_constant_value;if(!e)return!1;let t=e.valueType;return t===__dcg_shared_module_exports__['qa']||t===__dcg_shared_module_exports__['ra']||t===__dcg_shared_module_exports__['Aa']||t===__dcg_shared_module_exports__['Ba']||t===__dcg_shared_module_exports__['Ca']||t===__dcg_shared_module_exports__['Da']}function SR(r){return r.formula.expression_type==="SEGMENT3D"}function ER(r){return r.formula.expression_type==="VECTOR3D"}function nl(r){return r.formula.expression_type==="SINGLE_POINT"}function hb(r){return r.formula.expression_type==="POINT_LIST"}function pp(r){return r.formula.expression_type==="POINT_LIST"||r.formula.expression_type==="SINGLE_POINT"}function um(r){return r.formula.expression_type==="POINT3D_LIST"}function hm(r){let e=Yc(r);return!!(e&&e.type==="visualization"&&e.symbol==="boxplot")}function Oh(r){let e=Yc(r);return!!(e&&e.type==="visualization"&&e.symbol==="dotplot")}function gb(r){let e=Yc(r);return!!(e&&e.type==="visualization"&&e.symbol==="histogram")}function HT(r){return hm(r)||Oh(r)||gb(r)}function ww(r){return r.formula.expression_type==="TTEST"}function KT(r){return r.formula.expression_type==="STATS"}function Rh(r){let e=Yc(r);return!!(e&&e.type==="distribution")}function s7(r){let{formula:e}=r;return e?!!e.is_discrete_distribution:!1}function l7(r){var t,o;let e=(o=(t=r.formula)==null?void 0:t.geometry)==null?void 0:o.valueType;if(e!==void 0)return __dcg_shared_module_exports__['fb'](e,__dcg_shared_module_exports__['qa'])}function Yc(r){if(r.controller.areDistributionsEnabled()&&r.latex)return(!r.cachedParseToplevelFunction||r.cachedParseToplevelFunction.latex!==r.latex)&&(r.cachedParseToplevelFunction={latex:r.latex,spec:__dcg_shared_module_exports__['ud'](r.latex)}),r.cachedParseToplevelFunction.spec}function DR(r){return nC(r)&&Rh(r)}function nC(r){return!!r.formula.expression_type}function kR(r){return!!r.formula.is_concrete_list}function mp(r){return!DR(r)||kR(r)?!1:r.cdf.show}function aC(r){return r.cdf.min}function sC(r){return r.cdf.max}function c7(r){let e=oR(r.formula.cdf_min_default);return e===-1/0?"-\\infty":isFinite(e)?e+"":"-\\infty"}function d7(r){let e=oR(r.formula.cdf_max_default);return e===1/0?"\\infty":isFinite(e)?e+"":"\\infty"}function p7(r,e){r.cdf={...r.cdf,show:e}}function kT(r,e){r.cdf={...r.cdf,min:e}}function _T(r,e){r.cdf={...r.cdf,max:e}}function lC(r){return!!r.formula&&r.formula.cdf_min_valid!==!1}function cC(r){return!!r.formula&&r.formula.cdf_max_valid!==!1}function _R(r){return!!r.formula&&r.formula.fill_opacity_valid!==!1}function TR(r){return!!r.formula&&r.formula.surface_opacity_valid!==!1}function u7(r){return!!r.formula&&r.formula.line_opacity_valid!==!1}function h7(r){return!!r.formula&&r.formula.point_opacity_valid!==!1}function GR(r){return!!r.formula&&r.formula.label_size_valid!==!1}function IR(r){return!!r.formula&&r.formula.label_angle_valid!==!1}function g7(r){return!!r.formula&&r.formula.movable_point_size_valid!==!1}function WT(r){return!!r.formula&&r.formula.point_size_valid!==!1}function $T(r){return!!r.formula&&r.formula.line_width_valid!==!1}function m7(r){return!!r.formula&&r.formula.resolution_valid!==!1}function W_(r){return!!r.formula&&r.formula.color_latex_valid!==!1}function $_(r){return r.formula&&r.formula.color_latex_value}function f7(r){return r.formula&&r.formula.label_angle_value}function jT(r){let e=r.formula&&r.formula.cdf_evaluation;return isFinite(e)?e:0}function MR(r){if(!r||!__dcg_shared_module_exports__['wd'](r.formula.expression_type))return!1;let e=Ci(r);return!(e&&e!=="NONE")}function b7(r){r.showLabel=__dcg_shared_module_exports__['Ab'].showLabel,r.showAngleLabel=__dcg_shared_module_exports__['Ab'].showAngleLabel,r.label=__dcg_shared_module_exports__['Ab'].label,r.hidden=__dcg_shared_module_exports__['Ab'].hidden,r.dragMode=__dcg_shared_module_exports__['Ab'].dragMode,r.fill=__dcg_shared_module_exports__['Ab'].fill,r.points=__dcg_shared_module_exports__['Ab'].points,r.pointStyle=__dcg_shared_module_exports__['Ab'].pointStyle,r.lines=__dcg_shared_module_exports__['Ab'].lines,r.lineStyle=__dcg_shared_module_exports__['Ab'].lineStyle,r.slider=r.controller.is3dProduct()?__dcg_shared_module_exports__['Cb']:__dcg_shared_module_exports__['Bb'],r.latex="",r.labelSize="",r.labelOrientation="default",r.displayEvaluationAsFraction=__dcg_shared_module_exports__['Ab'].displayEvaluationAsFraction,r.strictIntersection=__dcg_shared_module_exports__['Ab'].strictIntersection,r.suppressTextOutline=!1,r.interactiveLabel=!1,r.editableLabelMode=__dcg_shared_module_exports__['Ab'].editableLabelMode,__dcg_shared_module_exports__['rb'](__dcg_shared_module_exports__['zb'],r)}function YT(r){return!!r.formula.move_strategy}function AR(r,e){pw(r,{type:"inert",disableGraphInteractions:e})}function y7(r){if((r==null?void 0:r.type)!=="expression"||!r.formula.typed_constant_value)return;let{value:e,valueType:t}=r.formula.typed_constant_value;switch(t){case __dcg_shared_module_exports__['da']:case __dcg_shared_module_exports__['Ka']:return{x:e[0],y:e[1]}}}function VR(r,e){var t;if(!(r.type!=="expression"&&r.type!=="image"))return(t=r.formula.computed_description)==null?void 0:t[e||0]}function wu(r,e,t){let o=Intl.ListFormat;if(typeof o=="function")try{return new o(r,t).format(e)}catch(i){}return e.join(", ")}var gm={cb20221031:"1"};$t();function LR(r){let e={};return re.extend(!0,e,r),re.param(e)}var dC="";function mb(){return dC}var x7=[];function w7(r){x7.push(r)}function One(r){if(r.status===401)for(let e of x7)e()}async function Rne(r){if(r&&r.routeDeprecated)throw r.js&&new Function(r.js)(),r}function PR(r){let e=new URLSearchParams;return Object.entries(r).forEach(([t,o])=>{Array.isArray(o)?o.forEach(i=>e.append(t,String(i))):e.set(t,String(o))}),e}function Fne(){throw{status:0,responseJSON:{errors:[{key:"connection_failed",message:"Connection failed. Check your internet connection?"}]}}}async function XT(r){let e=await r.catch(Fne);if(One(e),!e.ok){let o;try{o=await e.json()}catch(i){}throw{status:e.status,statusText:e.statusText,responseJSON:o}}let t=await e.json();return await Rne(t),t}async function ts(r,e,t){let o={method:"POST",credentials:"include",headers:{Accept:"application/json, text/javascript, */*; q=0.01"}};e&&(o.body=LR(e),o.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8");let i="";return t!==void 0&&(i=`?${PR(t).toString()}}`),await XT(fetch(`${dC}${r}${i}`,o))}async function v7(r,e,t){let o={method:"PUT",credentials:"include",headers:{Accept:"application/json, text/javascript, */*; q=0.01"}};e&&(o.body=LR(e),o.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8");let i="";return t!==void 0&&(i=`?${PR(t).toString()}}`),await XT(fetch(`${dC}${r}${i}`,o))}async function C7(r,e){let t={method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript, */*; q=0.01"},body:JSON.stringify(e||null)};return await XT(fetch(dC+r,t))}async function Gd(r,e){let t={method:"GET",credentials:"include",headers:{Accept:"application/json, text/javascript, */*; q=0.01"}},o=/\?/.test(String(r))?"&":"?";return await XT(fetch(`${dC}${r}${o}${PR({...e,...gm})}`,t))}function pC(r){return async e=>Gd(r,e)}function vw(r){return async e=>ts(r,e)}function uC(r){let e=[];for(let t of r){if(!t||typeof t!="string")continue;let o=t.split("-")[0];e.push(t),e.push(o);for(let i in Xc){let n=Xc[i];i.split("-")[0]===o&&n.useAsRoot&&e.push(i)}}return e}function S7(){let r={},e=Object.keys(Xc);for(let t in e){let o=e[t];r[o]={code:o,display_name:Xc[o].displayName}}return r}var Xc={en:{displayName:"English (US)",userGuideURL:"https://docs.google.com/document/d/1gV-WgDjgR9hKKb32ffeUpjwggNAgfqxl0Gsg6xocbok/preview",useAsRoot:!1},es:{displayName:"Espa\xF1ol (LATAM)",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_ES-ES.pdf",useAsRoot:!0},et:{displayName:"Eesti",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},ru:{displayName:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_RU.pdf",useAsRoot:!1},da:{displayName:"Dansk",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},de:{displayName:"Deutsch",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_DE.pdf",useAsRoot:!1},"pt-BR":{displayName:"Portugu\xEAs (Brasil)",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!0},"pt-PT":{displayName:"Portugu\xEAs (Portugal)",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},ca:{displayName:"Catal\xE0",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},fr:{displayName:"Fran\xE7ais",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_FR.pdf",useAsRoot:!0},"fr-CA":{displayName:"Fran\xE7ais (Canada)",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_FR.pdf",useAsRoot:!0},it:{displayName:"Italiano",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_IT.pdf",useAsRoot:!1},is:{displayName:"\xCDslenska",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},nl:{displayName:"Nederlands",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},no:{displayName:"Norsk",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},"sv-SE":{displayName:"Svenska",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!0},hu:{displayName:"Magyar",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},cs:{displayName:"\u010Ce\u0161tina",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},pl:{displayName:"Polski",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_PL.pdf",useAsRoot:!1},id:{displayName:"Bahasa Indonesia",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},vi:{displayName:"Ti\u1EBFng Vi\u1EC7t",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_VI.pdf",useAsRoot:!1},el:{displayName:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_EL.pdf",useAsRoot:!1},uk:{displayName:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},ka:{displayName:"\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},th:{displayName:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},tr:{displayName:"T\xFCrk\xE7e",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_TR.pdf",useAsRoot:!1},"zh-CN":{displayName:"\u7B80\u4F53\u4E2D\u6587",useAsRoot:!0,userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_ZH-CN.pdf"},"zh-TW":{displayName:"\u7E41\u9AD4\u4E2D\u6587",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_ZH-TW.pdf",useAsRoot:!1},ko:{displayName:"\uD55C\uAD6D\uC5B4",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide.pdf",useAsRoot:!1},ja:{displayName:"\u65E5\u672C\u8A9E",userGuideURL:"https://kiavash.s3.amazonaws.com/kiavash_User_Guide_JA.pdf",useAsRoot:!1}};var E7=`account-shell-button-cancel = Cancel
account-shell-button-contact-us = Contact Us
account-shell-button-download-braille = Download Braille Equations
account-shell-button-download-png = Download PNG
account-shell-button-download-svg = Download SVG
account-shell-button-duplicate = Duplicate
account-shell-button-edit = Edit
account-shell-button-embed = Embed
account-shell-button-export-image = Export Image
account-shell-button-hide-browser-warning = Hide this warning.
account-shell-button-line-medium = Medium
account-shell-button-line-thick = Thick
account-shell-button-line-thin = Thin
account-shell-button-log-in = Log In
account-shell-button-mygraphs-attempt-recovery = Attempt recovery.
account-shell-button-mygraphs-cancel = Cancel
account-shell-button-mygraphs-close-graph-list = Close Graph List
account-shell-button-mygraphs-close-graph-preview = Close Graph Preview
account-shell-button-mygraphs-delete-construction = Delete Construction
account-shell-button-mygraphs-delete-graph = Delete Graph
account-shell-button-mygraphs-delete-title = Delete { $graphTitle }
account-shell-button-mygraphs-save = Save
account-shell-button-mygraphs-try-again = Try again
account-shell-button-open-construction = Open Construction
account-shell-button-open-graph = Open Graph
account-shell-button-print = Print
account-shell-button-rename = Rename
account-shell-button-retry-now = Retry now
account-shell-button-save = Save
account-shell-button-save-copy = Save Copy
account-shell-button-sign-up = Sign Up
account-shell-button-submit-graph = Submit this graph
account-shell-button-update-graph = Submit your current graph instead
account-shell-error-art-contest-logged-out = Log in to participate in the art contest
account-shell-error-connection-failed = Connection failed. Try checking your internet connection.
account-shell-error-graph-too-large = This graph is too large to save. The maximum allowable size is 5 MB.
account-shell-error-logging-out = Error logging out.
account-shell-error-mygraphs-check-connection = Check your internet connection?
account-shell-error-mygraphs-error-deleting = Error deleting.
account-shell-error-mygraphs-error-loading = Error loading graph
account-shell-error-save-art-contest = Error saving. Please try again later.
account-shell-error-sharing-link = Sorry, there was an error generating a link to your graph.
account-shell-error-something-went-wrong = Something went wrong, please report this to kiavash.com support. (Error { $error_num })
account-shell-error-submitting = Error submitting. Please try again later.
account-shell-error-unexpected-server = Unexpected server error. Try again, or e-mail { $email }.
account-shell-error-unknown = Sorry! Something went wrong. Please try again later.
account-shell-heading-3dcalc-page-title = kiavash | 3D Graphing Calculator
account-shell-heading-artist-statement = Your Artist Statement
account-shell-heading-birth-year = Your Birth Year
account-shell-heading-contact-us = Contact Us
account-shell-heading-country = Your Country
account-shell-heading-download-instructions = Download Instructions
account-shell-heading-duplicate-construction = Duplicate This Construction
account-shell-heading-duplicate-graph = Duplicate This Graph
account-shell-heading-email = Your Email
account-shell-heading-email-details = This will never be shared, but please provide an email where we can reach you!
account-shell-heading-embossing-instructions = Embossing Instructions
account-shell-heading-export-image = Export Image
account-shell-heading-export-size = Size
account-shell-heading-file-format = File Format
account-shell-heading-geometry-legacy-page-title = kiavash | Geometry (Legacy)
account-shell-heading-geometry-page-title = kiavash | Geometry
account-shell-heading-graphingcalc-page-title = kiavash | Graphing Calculator
account-shell-heading-line-thickness = Line Thickness
account-shell-heading-math-art-contest = Global Math Art Contest
account-shell-heading-mygraphs-examples = Examples
account-shell-heading-mygraphs-recovered-work = Recovered Work
account-shell-heading-mygraphs-saved-constructions = Saved Constructions
account-shell-heading-mygraphs-saved-graphs = Saved Graphs
account-shell-heading-name = Your Name
account-shell-heading-name-details = This will be public.
account-shell-heading-named-graph = { $title } | kiavash
account-shell-heading-rename-construction = Rename This Construction
account-shell-heading-rename-graph = Rename This Graph
account-shell-heading-resources = Resources
account-shell-heading-save-construction = Save This Construction
account-shell-heading-save-graph = Save This Graph
account-shell-heading-share-construction = Share Your Construction
account-shell-heading-share-graph = Share Your Graph
account-shell-heading-submit-graph = Submit This Graph
account-shell-heading-title-mygraphs-search = Search
account-shell-heading-tours = Tours
account-shell-heading-unsupported-browser = Unsupported Browser
account-shell-label-account-information = Account Information
account-shell-label-advanced-preferences = Advanced
account-shell-label-art-contest-nudge-construction = Have a construction that you're proud of? We'd love to see it!
account-shell-label-art-contest-nudge-graph = Do you have a graph that you're proud of? We'd love to see it!
account-shell-label-artist-statement-description = In 2-3 sentences, describe the inspiration behind your graph.
account-shell-label-artist-statement-placeholder = Tell us about this graph...
account-shell-label-betchacant-loading = Challenge accepted...
account-shell-label-birth-year-placeholder = Birth Year
account-shell-label-country-placeholder = Country
account-shell-label-created-days-ago = { $number } days ago
account-shell-label-created-hours-ago = { $number } hours ago
account-shell-label-created-last-week = last week
account-shell-label-created-minutes-ago = { $number } minutes ago
account-shell-label-created-on-date = { $month } { $day }, { $year }
account-shell-label-created-one-hour-ago = one hour ago
account-shell-label-created-one-minute-ago = one minute ago
account-shell-label-created-seconds-ago = less than a minute ago
account-shell-label-created-weeks-ago = { $number } weeks ago
account-shell-label-created-yesterday = yesterday
account-shell-label-email-address = Email Address
account-shell-label-email-placeholder = email@example.com
account-shell-label-export-size-large-rectangle = Large Rectangle
account-shell-label-export-size-large-square = Large Square
account-shell-label-export-size-medium-rectangle = Medium Rectangle
account-shell-label-export-size-medium-square = Medium Square
account-shell-label-export-size-small-square = Small Square
account-shell-label-feature-flag-actions = Actions
account-shell-label-feedback = Feedback
account-shell-label-feedback-email = Email address so we can respond! (optional)
account-shell-label-feedback-message = Questions? Feedback?
account-shell-label-feedback-placeholder = Write to us!
account-shell-label-feedback-sending = Sending...
account-shell-label-graph-actions = Graph actions
account-shell-label-graph-title = Title
account-shell-label-help = Help
account-shell-label-help-menu = Help Menu
account-shell-label-join-contest = Join the contest
account-shell-label-language = Language
account-shell-label-loading = Loading...
account-shell-label-math-art-contest = Global Math Art Contest
account-shell-label-month-apr = Apr
account-shell-label-month-aug = Aug
account-shell-label-month-dec = Dec
account-shell-label-month-feb = Feb
account-shell-label-month-jan = Jan
account-shell-label-month-jul = Jul
account-shell-label-month-jun = Jun
account-shell-label-month-mar = Mar
account-shell-label-month-may = May
account-shell-label-month-nov = Nov
account-shell-label-month-oct = Oct
account-shell-label-month-sep = Sep
account-shell-label-mygraphs-example = example
account-shell-label-mygraphs-last-saved = last saved: { $date }
account-shell-label-mygraphs-no-unsaved-changes = no unsaved changes
account-shell-label-mygraphs-unsaved-graph = unsaved graph
account-shell-label-no-unsaved-changes = No Unsaved Changes
account-shell-label-open-graph-mac = { $open_graph } (cmd+o)
account-shell-label-open-graph-pc = { $open_graph } (ctrl+o)
account-shell-label-save-changes-mac = Save Changes (cmd+s)
account-shell-label-save-changes-pc = Save Changes (ctrl+s)
account-shell-label-saving-graph = Saving graph...
account-shell-label-share = share
account-shell-label-share-construction = Share Construction
account-shell-label-share-graph = Share Graph
account-shell-label-share-link = Share this link:
account-shell-label-submission-already-received = Your Art Contest Submission
account-shell-label-submission-received = Submission Received!
account-shell-label-submitting = Submitting...
account-shell-label-success = Success
account-shell-label-try-a-quest-title = Try a Quest
account-shell-label-zoom = Zoom: { $value }%
account-shell-link-3d-user-guide = 3D User Guide
account-shell-link-account-settings = Account Settings
account-shell-link-download-chrome = Click here to download Google Chrome.
account-shell-link-email-support = Email Our Support Team
account-shell-link-geometry-user-guide = Geometry User Guide
account-shell-link-getting-started = Getting Started
account-shell-link-help = Help
account-shell-link-help-center = Help Center
account-shell-link-keyboard-shortcuts = Keyboard Shortcuts
account-shell-link-learn-more = Learn More
account-shell-link-privacy = Privacy Policy
account-shell-link-read-blog = Read our blog
account-shell-link-send-feedback = Send Feedback and Questions
account-shell-link-sign-out = Sign Out
account-shell-link-terms = Terms of Service
account-shell-link-try-a-quest = Try a quest
account-shell-link-try-next-quest = Try another
account-shell-link-user-guide = kiavash User Guide
account-shell-link-video-tutorials = Video Tutorials
account-shell-narration-edit-selected-country = Edit Selected Country
account-shell-narration-edit-selected-year = Edit Selected Year
account-shell-narration-graph-preview = Graph Preview
account-shell-narration-language-menu = Language Options Menu
account-shell-narration-mygraphs-open-graph = Open graph
account-shell-narration-share-options = Share Options
account-shell-text-3d-expression-list-notice = Please share any bugs, questions, or suggestions at: <1>feedback@kiavash.com</1>
account-shell-text-advanced-preferences-instructions = Try these advanced features. Feel free to send any questions or feedback to support@kiavash.com.
account-shell-text-art-contest-congratulations = Congratulations, and keep graphing!
account-shell-text-art-contest-copyright-agreement = I pledge that (a) this is my original work and (b) this isn't based on copyrighted material.
account-shell-text-art-contest-create-graph-notice = Create a new graph or open one of your graphs to participate in the art contest.
account-shell-text-art-contest-deadline-notice = Submissions are open until January 15th.
account-shell-text-art-contest-has-arrived = Have a graph that you're proud of? We'd love to see it! Learn more at <1>kiavash.com/art<2> (opens in new tab)</2></1>.
account-shell-text-art-contest-has-closed = This year's contest is now closed. We're hard at work looking through all of the incredible creations, and will post results soon at <1>kiavash.com/art<2> (opens in new tab)</2></1>.
account-shell-text-art-contest-legal-disclaimer = By submitting this graph, you acknowledge that kiavash Studio, PBC may, at its discretion, post it publicly at the contest website and/or on social media channels.
account-shell-text-art-contest-loading-submissions = Loading your submissions...
account-shell-text-art-contest-my-first-year = This is my first year participating in the art contest.
account-shell-text-art-contest-see-submissions = See your submissions
account-shell-text-art-contest-someone-else-artist-statement = Participant's Artist Statement
account-shell-text-art-contest-someone-else-artist-statement-description = In 2-3 sentences, please have the participant describe the inspiration behind their graph.
account-shell-text-art-contest-someone-else-birth-year = Participant's Birth Year
account-shell-text-art-contest-someone-else-copyright-agreement = I pledge that (a) I am 18 or older and legally allowed to submit on behalf of this participant, (b) this is the participant's original work, and (c) this work isn't based on copyrighted material.
account-shell-text-art-contest-someone-else-country = Participant's Country
account-shell-text-art-contest-someone-else-email = Adult's (Your) Email
account-shell-text-art-contest-someone-else-first-year = This is the participant\u2019s first year participating in the art contest.
account-shell-text-art-contest-someone-else-name = Participant's Name
account-shell-text-art-contest-submit-construction = Submit your current construction
account-shell-text-art-contest-submit-graph = Submit your current graph
account-shell-text-art-contest-success-paragraph = If you'd like to revise your submission, feel free to resubmit anytime before<1> January 15th</1>. We'll only look at the most recent submission for each tool.
account-shell-text-art-contest-success-paragraph-someone-else = If you'd like to revise the submission, please delete it from the table of graphs you\u2019ve submitted and resubmit. Feel free to resubmit anytime before<1> January 15th</1>. We'll only look at the most recent submission for each tool.
account-shell-text-art-contest-view-or-update-submission = View or change your submission
account-shell-text-art-contest-view-submission = View your submission
account-shell-text-art-contest-your-2d-submission = View your graphing calculator submission
account-shell-text-art-contest-your-geometry-submission = View your geometry submission
account-shell-text-artcontest-ineligible = <1><2>Based on the provided age, we aren\u2019t able to accept this graph submission this year.</2><3>Keep up the awesome graphing! There will be new contests every year.</3></1>
account-shell-text-artcontest-someone-else = <1><2>Based on your age and location, you need a teacher, parent, or guardian over the age of 18 to submit your graph for you.</2><3>Here is the link to your graph: </3><graphlink/><4>Please share it with one of them and have them submit it at <5>kiavash.com/art</5>.</4></1>
account-shell-text-confirm-leave = Are you sure you want to leave this graph? Your unsaved work will be lost.
account-shell-text-construction-cleared = Construction cleared.
account-shell-text-continue-with-quest = ...or <1>keep playing with this quest</1>.
account-shell-text-copy-of-title = [Copy of] { $originalTitle }
account-shell-text-download-instructions = To download, right click on the image of the graph select "Save As." You might also be able to click and drag the image onto your desktop.
account-shell-text-embossing-etc-print = Set paper size to { $size }. Then click "Edit" and select File > Emboss.
account-shell-text-embossing-etc-save = Save this image. Open Firebird, select File > Open > Image File, and open the image.
account-shell-text-embossing-vpmax-print = Right click image and select "print". Set paper size to { $size }.
account-shell-text-embossing-vpmax-save = Right click graph image and save to desktop.
account-shell-text-error = error
account-shell-text-feature-flag-actions-description = Make graphs interactive by defining rules for responding to clicks or to the passage of time.
account-shell-text-feedback-sent = Thank you! We'll be in touch soon.
account-shell-text-graph-cleared = Graph cleared.
account-shell-text-graph-migrated-from-geometry = '{ $title }' was auto-migrated from the old geometry tool.
account-shell-text-logged-in = Logged in successfully!
account-shell-text-login-window-blocked-apple = Login window blocked. Please allow popups from kiavash.com to sign in with Apple
account-shell-text-login-window-blocked-google = Login window blocked. Please allow popups from kiavash.com to sign in with Google.
account-shell-text-maintenance-mode = kiavash is currently undergoing maintenance.
account-shell-text-mygraphs-attempting-recovery = Attempting recovery...
account-shell-text-mygraphs-contest-submit-to-contest = <1>Submit this graph to the <2>Global Math Art Contest!</2></1>
account-shell-text-mygraphs-count-more = { $count } more...
account-shell-text-mygraphs-current-construction = Current Construction
account-shell-text-mygraphs-current-graph = Current Graph
account-shell-text-mygraphs-deleting = Deleting...
account-shell-text-mygraphs-loading = Loading...
account-shell-text-mygraphs-lost-work = Lost work?
account-shell-text-mygraphs-new-blank-graph = New Blank Graph
account-shell-text-mygraphs-new-construction = New Blank Construction
account-shell-text-mygraphs-no-construction-search-results = No saved constructions match your search.
account-shell-text-mygraphs-no-examples-match-search = No examples match your search.
account-shell-text-mygraphs-no-graph-search-results = No saved graphs match your search.
account-shell-text-mygraphs-no-saved-constructions = No saved constructions yet.
account-shell-text-mygraphs-no-saved-graphs = No saved graphs yet.
account-shell-text-mygraphs-no-unsaved-constructions = Couldn't find any unsaved constructions.
account-shell-text-mygraphs-no-unsaved-graphs = Couldn't find any unsaved graphs.
account-shell-text-mygraphs-opened-graph = Opened '{ $graphTitle }'
account-shell-text-mygraphs-or = or
account-shell-text-mygraphs-search-by-title = search by title
account-shell-text-mygraphs-to-save-constructions = to save your constructions!
account-shell-text-mygraphs-to-save-graphs = to save your graphs!
account-shell-text-mygraphs-version = Version
account-shell-text-new-construction-created = New construction created.
account-shell-text-new-graph-created = New graph created.
account-shell-text-or = or
account-shell-text-saved = saved
account-shell-text-unsupported-browser-android = kiavash works best on your version of Android if you use the Chrome Browser.
account-shell-text-untitled = Untitled
account-shell-text-untitled-graph = Untitled Graph
account-shell-text-welcome-to-3d = Welcome to kiavash 3D (Beta)
shared-button-back = Back
shared-button-cancel = Cancel
shared-button-change-email-address = Change email address
shared-button-change-email-and-password = Change email and password
shared-button-close-dialog = Close Dialog
shared-button-close-message = Close Message
shared-button-confirm-name = Confirm Name
shared-button-continue-to-kiavash = Continue to kiavash
shared-button-delete-account-question = Delete your kiavash account?
shared-button-fun-classification = I'm here for fun
shared-button-hide-password = Hide Password
shared-button-learn-more-capitalized = Learn More
shared-button-login-capitalized = Log In
shared-button-next = Next
shared-button-non-education-classification = I work outside of education
shared-button-recover-password = Recover Password
shared-button-save = Save
shared-button-send-delete-account-email = Send Delete Account Email
shared-button-send-email = Send Email
shared-button-show-password = Show Password
shared-button-sign-up = Sign Up
shared-button-student-classification = I'm a student
shared-button-teacher-classification = I'm an educator
shared-button-try-again = Didn't work? Try again!
shared-calculator-button-braille-mode-nemeth = Nemeth
shared-calculator-button-braille-mode-ueb = UEB
shared-calculator-button-clear = clear
shared-calculator-button-go = Go
shared-calculator-button-hide-options = Hide Options
shared-calculator-button-mac = Mac Shortcuts
shared-calculator-button-show-options = Show Options
shared-calculator-button-windows-chrome = Windows / ChromeOS Shortcuts
shared-calculator-error-3d-bad-equality-slice = We don't support this type of equality restriction.
shared-calculator-error-3d-length-type-error = Function '{ $fn }' cannot be applied to { $arg } in the 3d calculator. Use '{ $alternativeFn }' to find the number of elements in a list.
shared-calculator-error-3d-mixed-restriction-equation = Cannot apply both an inequality restriction and an equality restriction to this expression.
shared-calculator-error-3d-multiple-equality-restrictions = Cannot apply more than one equality restriction.
shared-calculator-error-action-merge-free-variable = Cannot combine an action that depends on free variable '{ $symbol }'.
shared-calculator-error-add-arguments-to-definition-many = Try including '{ $symbols }' and '{ $lastSymbol }' as arguments by defining the function as '{ $newSignature }'.
shared-calculator-error-add-arguments-to-definition-one = Try including '{ $lastSymbol }' as an argument by defining the function as '{ $newSignature }'.
shared-calculator-error-add-type-error = Cannot add { $symbol1 } and { $symbol2 }.
shared-calculator-error-adjacent-mixed-number = Sorry, I don't know what to do with mixed number '{ $mixedNumber }'. Try using a '*' symbol around it.
shared-calculator-error-adjacent-numbers = Sorry, I don't know what to do with adjacent numbers '{ $left }' and '{ $right }'. Try using parentheses or a '*' symbol.
shared-calculator-error-ans-undefined = The previous expression didn't define any value for ans.
shared-calculator-error-assignments-unsupported = This calculator does not support defining variables.
shared-calculator-error-bad-for-input-list-dependency = A definition on the right-hand side of 'for' can't depend on input variable '{ $symbol }'.
shared-calculator-error-bad-for-interval-dependency = Parameter bounds on the right-hand side of 'for' can't depend on input variable '{ $symbol }'.
shared-calculator-error-bad-implicit-call = Use parentheses around the argument of '{ $symbol }'.
shared-calculator-error-bad-integral-bound-dependency = Integration bounds can't depend on integration variable '{ $symbol }'.
shared-calculator-error-bad-interval-comprehension-arity =
    { $count ->
        [one] You can't use 'for' to parameterize { $type } using 1 parameter.
       *[other] You can't use 'for' to parameterize { $type } using { $count } parameters.
    }
shared-calculator-error-bad-log-exponent = Only { $form } is supported. Otherwise, use parens.
shared-calculator-error-bad-product-bound-dependency = Product bounds can't depend on product index '{ $symbol }'.
shared-calculator-error-bad-sample-size = Sample size must be a finite, non-negative number.
shared-calculator-error-bad-sum-bound-dependency = Summation bounds can't depend on summation index '{ $symbol }'.
shared-calculator-error-bad-symbol-context = You can't use '{ $symbol }' in this context.
shared-calculator-error-bad-trig-exponent = Only { $form1 } and { $form2 } are supported. Otherwise, use parens.
shared-calculator-error-bad-tuple-dimensions = Points may only have { $symbol } coordinates.
shared-calculator-error-binary-operator-missing-operand = You need something on both sides of the '{ $symbol }' symbol.
shared-calculator-error-blank-expression = You haven't written anything yet.
shared-calculator-error-boxplot-breadth-invalid = Invalid height. Try using any number.
shared-calculator-error-boxplot-offset-invalid = Invalid offset. Try using any number.
shared-calculator-error-cannot-assign-color = Cannot assign a color to '{ $variable }'.
shared-calculator-error-cannot-redefine = You can't redefine '{ $symbol }' because it's already defined.
shared-calculator-error-cannot-redefine-root = You can't define '{ $symbol }' because '{ $symbolRoot }' is already defined.
shared-calculator-error-cannot-restrict = Cannot create a restriction based on '{ $variable }' in this type of expression.
shared-calculator-error-cannot-restrict-with-equality = Cannot create an equality restriction based on '{ $variable }' in this type of expression.
shared-calculator-error-cannot-subscript = '{ $symbol }' cannot have a subscript.
shared-calculator-error-cant-combine-spherical-and-cylindrical = Can't combine spherical and cylindrical coordinates.
shared-calculator-error-cdf-max-invalid = Invalid cdf max. Try using any number.
shared-calculator-error-cdf-max-less-than-min = Invalid cdf limits. Min should be less than max.
shared-calculator-error-cdf-min-invalid = Invalid cdf min. Try using any number.
shared-calculator-error-cdf-too-many-arguments = 'cdf' should be called on a distribution with at most two numbers. { $recommendation }
shared-calculator-error-cdf-too-many-arguments-recommendation = For example, try typing: D.cdf(-1,1) where D=normaldist().
shared-calculator-error-cdf-wrong-arity = 'cdf' should be called on a distribution with at least one number. { $recommendation }
shared-calculator-error-cdf-wrong-arity-recommendation = For example, try typing: D.cdf(x) where D=normaldist().
shared-calculator-error-clickable-object-assignment-not-defined = "{ $symbol }" is not defined. Try using a different variable or adding a slider.
shared-calculator-error-clickable-object-assignment-not-identifier = Invalid symbol. Try using a single letter.
shared-calculator-error-clickable-object-invalid-expression = Can't evaluate this. Try a number or simple expression.
shared-calculator-error-colon-missing-condition = The left side of a ':' must be a condition, like 'x>1'.
shared-calculator-error-color-arity = '{ $symbol }' should be called with 3 arguments. { $recommendation }
shared-calculator-error-color-arity-recommendation = For example, try typing: { $recommendation }.
shared-calculator-error-color-not-assigned = To use a color, you must assign it to a variable.
shared-calculator-error-combine-type-error = Cannot combine { $symbol1 } and { $symbol2 }.
shared-calculator-error-comparator-type-error = Cannot compare { $symbol1 } to { $symbol2 }.
shared-calculator-error-complex-list-access = Indexing a list with a complex number is not well-defined.
shared-calculator-error-complex-operation-undefined = Note: '{ $symbol }' isn't well-defined for complex numbers.
shared-calculator-error-complex-operation-unimplemented = Note: '{ $symbol }' is not yet implemented for complex numbers.
shared-calculator-error-complex-point-coordinate = Points with complex coordinates are not supported.
shared-calculator-error-complex-round = Note: '{ $symbol }' with complex precision is not well-defined.
shared-calculator-error-complex-sort = Note: '{ $symbol }' uses lexicographic ordering for complex numbers.
shared-calculator-error-complex-table-point-coordinate = Only real-valued coordinate pairs can be plotted.
shared-calculator-error-complicated-double-inequality = We only support solved double inequalities. Try deleting one side of the inequality.
shared-calculator-error-complicated-polar-implicit = Polar equations must be linear in r.
shared-calculator-error-constant-unsupported = This calculator does not support the constant '{ $symbol }'.
shared-calculator-error-coordinate-access-type-error = Cannot access coordinate '{ $coordinate }' of { $symbol }.
shared-calculator-error-custom-regressions-unsupported = This calculator does not support custom regressions.
shared-calculator-error-custom-toolbar-not-condition = Please write a valid condition and make sure every referenced variable is defined.
shared-calculator-error-deeply-nested = Definitions are nested too deeply.
shared-calculator-error-dependency-cycle = '{ $symbols }' and '{ $lastSymbol }' can't be defined in terms of each other.
shared-calculator-error-depends-on-deleted-geo-object = This depends on a geometric object that's no longer defined.
shared-calculator-error-derivative-missing-body = What do you want to take the derivative of?
shared-calculator-error-derivative-type-error = Cannot take the derivative of { $symbol }.
shared-calculator-error-derivative-type-error-respect = Cannot take the derivative of { $symbol1 } with respect to { $symbol2 }.
shared-calculator-error-derivative-variable-type-error = Cannot take derivative with respect to '{ $symbol1 }' because it is { $symbol2 }.
shared-calculator-error-differential-with-superscript = Integration variable cannot have a superscript.
shared-calculator-error-distribution-as-function = Cannot call distribution '{ $symbol }' as a function. Try '{ $symbol }.pdf(x)'.
shared-calculator-error-divide-type-error = Cannot divide { $symbol1 } by { $symbol2 }.
shared-calculator-error-domain-max-invalid = Invalid domain max. Try using any number.
shared-calculator-error-domain-max-less-than-min = Invalid domain limits. Min should be less than max.
shared-calculator-error-domain-min-invalid = Invalid domain min. Try using any number.
shared-calculator-error-dot-lhs-constant-number = Sorry, I don't understand this use of '.' after a constant number.
shared-calculator-error-dot-lhs-type-error = Cannot call '.{ $symbol }' on { $type }.
shared-calculator-error-dot-rhs-property-error = '.{ $symbol }' cannot be followed by parentheses.
shared-calculator-error-duplicate-function-parameter = Cannot use '{ $dependency }' for multiple parameters of this function.
shared-calculator-error-duplicate-update-rules = An action cannot specify multiple update rules for '{ $symbol }'.
shared-calculator-error-empty-paren = Parentheses cannot be empty.
shared-calculator-error-empty-pipe = Absolute value symbol cannot be empty.
shared-calculator-error-empty-radical = Radical cannot be empty.
shared-calculator-error-empty-radical-index = Radical index cannot be empty.
shared-calculator-error-empty-square-bracket = Square brackets cannot be empty.
shared-calculator-error-empty-subscript = Subscripts cannot be empty.
shared-calculator-error-empty-superscript = Superscripts cannot be empty.
shared-calculator-error-equation-required = Try adding an equals sign to turn this into an equation.
shared-calculator-error-equation-required-symbol = Try adding '{ $lhs }' to the beginning of this equation.
shared-calculator-error-equations-unsupported = This calculator does not support this type of equation.
shared-calculator-error-event-handler-type-error = This should be an action. Try '{ $example }'.
shared-calculator-error-exponent-type-error = Cannot raise { $symbol1 } to { $symbol2 }.
shared-calculator-error-feature-unavailable = This feature is not available in the current calculator.
shared-calculator-error-fraction-empty = You need a numerator and denominator for your fraction.
shared-calculator-error-fraction-missing-denominator = You need a denominator for the bottom of your fraction.
shared-calculator-error-fraction-missing-numerator = You need a numerator for the top of your fraction.
shared-calculator-error-function-definition-unsupported = This calculator does not support function definitions.
shared-calculator-error-function-name-as-parameter = Cannot use function name '{ $dependency }' as a function parameter.
shared-calculator-error-function-not-defined = Function '{ $dependency }' is not defined.
shared-calculator-error-function-only-works-in-complex = The '{ $symbol }' function is only available in complex mode.
shared-calculator-error-function-type-error-1 = Function '{ $fn }' cannot be applied to { $arg }.
shared-calculator-error-function-type-error-2 = Function '{ $fn }' cannot be applied to { $arg1 } and { $arg2 }.
shared-calculator-error-function-type-error-many = Function '{ $fn }' cannot be applied to these arguments.
shared-calculator-error-function-unsupported = This calculator does not support the '{ $symbol }' function.
shared-calculator-error-geometry-length-type-error = Function '{ $fn }' cannot be applied to { $arg } in the geometry calculator. Use '{ $alternativeFn }' to find the number of elements in a list.
shared-calculator-error-gpu-expression-too-complex = We encountered a GPU error while plotting this expression.
shared-calculator-error-gpu-function-unsupported = Cannot use the '{ $symbol }' function here.
shared-calculator-error-gpu-integral-unsupported = Cannot use integrals here.
shared-calculator-error-gpu-long-product = Products may not have more than { $maxTermCount } terms here.
shared-calculator-error-gpu-long-sum = Sums may not have more than { $maxTermCount } terms here.
shared-calculator-error-gpu-max-list-size = Lists may not have more than { $maxListSize } elements here.
shared-calculator-error-gpu-variable-list-length = List length cannot depend on variable '{ $symbol }' here.
shared-calculator-error-gpu-variable-product = Product bound cannot depend on variable '{ $symbol }' here.
shared-calculator-error-gpu-variable-sum = Sum bound cannot depend on variable '{ $symbol }' here.
shared-calculator-error-heterogeneous-list = All elements of a list must have the same type.
shared-calculator-error-identifier-as-function = '{ $symbol }' is a function. Try using parentheses.
shared-calculator-error-identifier-is-not-function = '{ $symbol }' is not a function. Try defining it as '{ $symbol }(x) = x^2' instead.
shared-calculator-error-illegal-bin-width = The second argument to '{ $symbol }' must be a positive number.
shared-calculator-error-illegal-dot-call = Function '{ $symbol }' cannot be called with dot notation.
shared-calculator-error-implicits-disabled = Plotting implicit equations and inequalities is disabled.
shared-calculator-error-incorrect-list-comprehension-input = Definitions on the right-hand side of 'for' must set a variable equal to a list. Try i=[1...10].
shared-calculator-error-incorrect-product-lower-bound = Lower bound of a product must set a variable equal to a number. Try n=1.
shared-calculator-error-incorrect-sum-lower-bound = Lower bound of a sum must set a variable equal to a number. Try n=1.
shared-calculator-error-index-type-error = Cannot index { $symbol1 } with { $symbol2 }.
shared-calculator-error-inequalities-disabled = Plotting inequalities is disabled.
shared-calculator-error-inequalities-unsupported = This calculator does not support inequalities.
shared-calculator-error-integral-argument-type-error = Cannot take the integral of { $symbol }.
shared-calculator-error-integral-lower-bound-type-error = Lower bound of an integral cannot be { $symbol }.
shared-calculator-error-integral-missing-body = What do you want to take the integral of?
shared-calculator-error-integral-missing-bound = Integrals must have upper and lower bounds.
shared-calculator-error-integral-missing-differential = Integrand must end with an integration variable, like dx.
shared-calculator-error-integral-upper-bound-type-error = Upper bound of an integral cannot be { $symbol }.
shared-calculator-error-internal-error = [internal] { $msg }
shared-calculator-error-invalid-dependent-first-table-column = This column header can't be defined elsewhere in the calculator.
shared-calculator-error-invalid-double-equality-3d = Sorry, we only plot double equalities that contain z. Try adding 0*z to one side.
shared-calculator-error-invalid-double-inequality-3d = We only plot double inequalities of x, y, and z.
shared-calculator-error-invalid-double-inequality-variables = We only plot double inequalities of x and y.
shared-calculator-error-invalid-first-table-column = First column may not be { $most } or { $last }.
shared-calculator-error-invalid-half-empty-range = Range must have an upper and lower bound.
shared-calculator-error-invalid-implicit-variables = We only support implicit equations of x and y.
shared-calculator-error-invalid-implicit-variables-3d = We only support implicit equations of x, y, and z.
shared-calculator-error-invalid-inequality-variables = We only plot inequalities of x and y, or r and \u03B8.
shared-calculator-error-invalid-interval-comprehension-invalid-bound = Parameter bounds on the right-hand side of 'for' must be of the form '0<{ $identifier }<1'.
shared-calculator-error-invalid-interval-comprehension-return-type = You can't use 'for' to parameterize { $type }.
shared-calculator-error-invalid-lhs = Sorry, you can't graph { $symbol } as a function of anything yet.
shared-calculator-error-invalid-operator-name = Operator names may only contain letters.
shared-calculator-error-invalid-regression-parameter = '{ $symbol }' may not be used as a regression parameter. Try using a different variable name.
shared-calculator-error-invalid-subscript = Subscripts may only contain letters and digits. '{ $symbol }' is not allowed.
shared-calculator-error-invalid-table-entry = Table entries must be simple expressions. { $supplement }
shared-calculator-error-invalid-table-header = Table headers must be simple expressions. { $supplement }
shared-calculator-error-list-comprehension-input-type-error = A definition on the right-hand side of 'for' must be a list, but { $identifier } is { $actual }. Try { $identifier }={ $example }.
shared-calculator-error-list-type-error = Cannot store { $symbol1 } in a list.
shared-calculator-error-log-scale-box-plot = Cannot plot a box plot on a log scale.
shared-calculator-error-log-scale-dot-plot = Cannot plot a dot plot on a log scale.
shared-calculator-error-log-scale-histogram = Cannot plot a histogram on a log scale.
shared-calculator-error-log-scale-type-error = Cannot plot { $symbol } on a log scale.
shared-calculator-error-logbase-unsupported = This calculator does not support specifying the base of a logarithm. Try 'log' or 'ln'.
shared-calculator-error-malformed-list = Lists are written like this: [1, 2, 3].
shared-calculator-error-malformed-point = Points are written like this: (1, 2).
shared-calculator-error-matrix-add-dimensions = Cannot add matrices with different dimensions.
shared-calculator-error-matrix-assignment = This calculator does not support this type of variable definition. Try using 'New Matrix'.
shared-calculator-error-matrix-element-type-error = Cannot use { $arg } as an element of a matrix.
shared-calculator-error-matrix-fractional-power = A matrix can only be raised to integer powers.
shared-calculator-error-matrix-invalid-variable = Cannot use '{ $symbol }' as a variable.
shared-calculator-error-matrix-multiply-dimensions = Cannot multiply matrices with incompatible dimensions.
shared-calculator-error-matrix-power-dimensions = Only square matrices can be raised to a power.
shared-calculator-error-matrix-subtract-dimensions = Cannot subtract matrices with different dimensions.
shared-calculator-error-max-list-size = Lists may not have more than { $maxListSize } elements.
shared-calculator-error-method-requires-list = '{ $symbol }' requires a list. For example, try typing: { $recommendation }.
shared-calculator-error-mismatched-braces = Expected '{ $symbol1 }' to match '{ $symbol2 }'.
shared-calculator-error-mismatched-double-inequality = Double inequalities must both go the same way, e.g. { $example }.
shared-calculator-error-mixed-comparator-chain = Cannot mix inequalities and equations in a chain of comparisons.
shared-calculator-error-multiply-defined = You've defined '{ $dependency }' in more than one place. Try deleting some of the definitions of '{ $dependency }'.
shared-calculator-error-multiply-type-error = Cannot multiply { $symbol1 } by { $symbol2 }.
shared-calculator-error-multiply-type-error-2d = Ambiguous multiplication of { $symbol1 } by { $symbol2 }. Try typing: (1, 2) * (2, 1).
shared-calculator-error-multiply-type-error-3d = Ambiguous multiplication of { $symbol1 } by { $symbol2 }. Try typing: (1, 2, 3) cross (2, 1, 0).
shared-calculator-error-multiply-type-error-cross = Cannot take the cross product of { $symbol1 } and { $symbol2 }.
shared-calculator-error-negative-type-error = Cannot negate { $symbol }.
shared-calculator-error-nested-interval-comprehension = You can't yet use 'for' to introduce a new parameter to an already parameterized point.
shared-calculator-error-non-arithmetic-range = Ranges must be arithmetic sequences.
shared-calculator-error-non-list-double-reducer = Both arguments of '{ $symbol }' must be lists. For example, try typing: { $recommendation }.
shared-calculator-error-non-list-parameterized-reducer = The first argument of '{ $symbol }' must be a list. For example, try typing: { $recommendation }.
shared-calculator-error-non-singular-inverse = Singular matrices do not have an inverse.
shared-calculator-error-non-square-determinant = Only square matrices have a determinant.
shared-calculator-error-non-square-inverse = Only square matrices have an inverse.
shared-calculator-error-non-square-trace = Only square matrices have a trace.
shared-calculator-error-operator-type-error = Cannot apply { $symbol } to { $symbol1 } and { $symbol2 }.
shared-calculator-error-optimization-error = We couldn't find any region where this model is defined.
shared-calculator-error-parameter-already-defined = You can't use '{ $dependency }' as a parameter of this function because '{ $dependency }' is already defined.
shared-calculator-error-parse-error = Sorry, I don't understand this.
shared-calculator-error-pdf-wrong-arity = 'pdf' should be called on a distribution with a number. { $recommendation }
shared-calculator-error-pdf-wrong-arity-recommendation = For example, try typing: D.pdf(x) where D=normaldist().
shared-calculator-error-percent-missing-of = '%' must be used with 'of'. Try '25% of 12'.
shared-calculator-error-piecewise-branch-type-error = Cannot use { $symbol1 } and { $symbol2 } as the branches in a piecewise. Every branch must have the same type.
shared-calculator-error-piecewise-condition-type-error = The condition in a piecewise expression must be { $symbol1 } but was { $symbol2 }.
shared-calculator-error-piecewise-missing-condition = A piecewise expression must have at least one condition.
shared-calculator-error-piecewise-part-missing-condition = Every part of a piecewise expression must have a condition except the last.
shared-calculator-error-point-type-error = Cannot use { $symbol1 } as a coordinate of { $symbol2 }.
shared-calculator-error-points-unsupported = This calculator does not support points.
shared-calculator-error-polygon-unsupported-in-3d = This calculator does not support the 'polygon' function. Try 'triangle' instead.
shared-calculator-error-prime-variable-type-error = Cannot take derivative of '{ $symbol1 }' with respect to { $symbol2 }.
shared-calculator-error-prime-without-paren = Primed function calls must use parentheses.
shared-calculator-error-primed-function-arity = Prime notation can only be used for functions of a single argument.
shared-calculator-error-product-argument-type-error = Cannot take the product of { $symbol }.
shared-calculator-error-product-infinite-bound-type-error = Product bounds must be finite numbers.
shared-calculator-error-product-lower-bound-type-error = Lower bound of a product cannot be { $symbol }.
shared-calculator-error-product-missing-body = What do you want to take the product of?
shared-calculator-error-product-missing-bound = Products must have upper and lower bounds.
shared-calculator-error-product-upper-bound-type-error = Upper bound of a product cannot be { $symbol }.
shared-calculator-error-random-arity = 'random' should be called with no arguments, or an optional number of samples. For example, try random() or random(10).
shared-calculator-error-random-from-broadcast-distribution = Cannot sample from a list of distributions
shared-calculator-error-recursion-argument-type = Expected argument { $index } to be { $expectedType } but found { $foundType }.
shared-calculator-error-recursion-base-case-argument-non-number = Base case arguments must be simple numbers. Try using piecewise syntax.
shared-calculator-error-recursion-base-case-free-variable = This recursion's base case can't depend on variable '{ $freeVariable }'.
shared-calculator-error-recursion-base-case-same-type = Base cases must all have the same return type.
shared-calculator-error-recursion-base-case-too-complicated = For a recursion with multiple parameters, try using piecewise syntax.
shared-calculator-error-recursion-depth-limit-exceeded = Recursive depth limit exceeded without reaching a base case.
shared-calculator-error-recursion-does-not-terminate = This recursion doesn't reach a base case.
shared-calculator-error-recursion-missing-base-case =
    { $count ->
        [one] The definition of function '{ $lastSymbol }' depends on itself. If '{ $lastSymbol }' is meant to be a recursive function, try adding a valid base case.
       *[other] The definitions of functions '{ $symbols }' and '{ $lastSymbol }' depend on each other. If they are meant to be mutually recursive functions, try adding a valid base case.
    }
shared-calculator-error-recursion-wrong-arity =
    { $count ->
        [one] Function '{ $fnSymbol }' requires 1 argument.
       *[other] Function '{ $fnSymbol }' requires { $count } arguments.
    }
shared-calculator-error-regression-recursion = Recursive functions may not be used inside regressions.
shared-calculator-error-regression-type-error = Cannot regress { $symbol1 } against { $symbol2 }.
shared-calculator-error-required-arguments-area = Function '{ $symbol }' requires a polygon.
shared-calculator-error-required-arguments-circle = Function 'circle' requires a center point and another point, segment, or radius value.
shared-calculator-error-required-arguments-coterminal = Function '{ $symbol }' requires an angle.
shared-calculator-error-required-arguments-dilate = Function '{ $symbol }' requires an object, then a point and a number.
shared-calculator-error-required-arguments-glider = Function 'glider' requires an object, then a number.
shared-calculator-error-required-arguments-intersection = Function 'intersection' requires 2 objects (lines, circles, or arcs).
shared-calculator-error-required-arguments-length = Function 'length' requires a segment.
shared-calculator-error-required-arguments-midpoint = Function 'midpoint' requires a segment or 2 points.
shared-calculator-error-required-arguments-perpendicular = Function '{ $symbol }' requires a line and a point.
shared-calculator-error-required-arguments-points = Function '{ $symbol }' requires { $count } points.
shared-calculator-error-required-arguments-polygon = Function 'polygon' requires several points.
shared-calculator-error-required-arguments-radius = Function '{ $symbol }' requires a circle or arc.
shared-calculator-error-required-arguments-reflect = Function 'reflect' requires an object, then a line, segment, ray, or vector.
shared-calculator-error-required-arguments-sphere = Function 'sphere' requires a center point and a radius value.
shared-calculator-error-required-arguments-start = Function '{ $symbol }' requires a vector.
shared-calculator-error-required-arguments-supplement = Function 'supplement' requires a directed angle.
shared-calculator-error-required-arguments-translate = Function 'translate' requires an object, then 2 points or a vector.
shared-calculator-error-required-arguments-triangle = Function 'triangle' requires three 3d points.
shared-calculator-error-required-arguments-vector = Function 'vector' requires a start point and end point.
shared-calculator-error-self-referential-base-case = A base case for recursive function '{ $symbol }' cannot depend on '{ $symbol }'.
shared-calculator-error-self-referential-functions =
    { $count ->
        [one] The definition of function '{ $lastSymbol }' depends on itself.
       *[other] The definitions of functions '{ $symbols }' and '{ $lastSymbol }' depend on each other.
    }
shared-calculator-error-self-referential-suggest-alternative = '{ $symbol }' cannot be defined recursively. Try renaming this function.
shared-calculator-error-shadowed-index = You can't use '{ $symbol }' as an index because it's already defined.
shared-calculator-error-shadowed-integration-variable = You can't use '{ $symbol }' as an integration variable because it's already defined.
shared-calculator-error-shadowed-list-comprehension-input = You can't define '{ $symbol }' more than once on the right-hand side of 'for'.
shared-calculator-error-single-variable-implicit-equations-disabled = Plotting single-variable implicit equations is disabled.
shared-calculator-error-slider-limit-references-export = Slider limits cannot depend on the slider variable '{ $symbol }'.
shared-calculator-error-slider-max-invalid = Invalid slider max. Try using any number.
shared-calculator-error-slider-max-less-than-min = Invalid slider limits. Min should be less than max.
shared-calculator-error-slider-min-invalid = Invalid slider min. Try using any number.
shared-calculator-error-slider-step-invalid = Invalid slider step. Try using any number.
shared-calculator-error-slow-evaluation = This is taking a long time to evaluate. Try editing or deleting this expression.
shared-calculator-error-substitution-ambiguous-comma = Ambiguous use of ',' and '{ $operation }'. Add parentheses around the '{ $operation }' expression.
shared-calculator-error-substitution-body-action = The left hand side of a 'with' substitution cannot be an action.
shared-calculator-error-substitution-body-regression-parameter-dependency = Can't use '{ $operator }' to substitute for the existing variable '{ $globalVariable }' because the expression on the left-hand side depends on '{ $regressionParameter }', which is a regression parameter.
shared-calculator-error-substitution-duplicate-assignment = A 'with' expression cannot make multiple substitutions for '{ $symbol }'.
shared-calculator-error-substitution-function-lhs = Substituting for '{ $symbol }' is not allowed because it is a function.
shared-calculator-error-substitution-illegal-lhs = Substituting for '{ $symbol }' is not allowed.
shared-calculator-error-substitution-invalid-assignments = 'with' must be followed by one or more variable definitions.
shared-calculator-error-substitution-local-lhs = Substituting for variable '{ $symbol }' is not allowed because it is locally defined.
shared-calculator-error-substitution-nested = Using one 'with' expression inside another 'with' expression is not allowed.
shared-calculator-error-substitution-recursive-call-lhs = Can't use '{ $operator }' to substitute for the existing variable '{ $globalVariable }' because the expression on the left-hand side depends on a recursive function call to '{ $fnSymbol }'.
shared-calculator-error-substitution-type-error = Cannot substitute { $actual } for { $expected }.
shared-calculator-error-substitution-unsupported-interval = Intervals are not allowed on the right-hand side of 'with'. You might want to try using 'for' instead.
shared-calculator-error-subtract-type-error = Cannot subtract { $symbol2 } from { $symbol1 }.
shared-calculator-error-sum-argument-type-error = Cannot take the sum of { $symbol }.
shared-calculator-error-sum-infinite-bound-type-error = Summation bounds must be finite numbers.
shared-calculator-error-sum-lower-bound-type-error = Lower bound of a sum cannot be { $symbol }.
shared-calculator-error-sum-missing-body = What do you want to take the sum of?
shared-calculator-error-sum-missing-bound = Sums must have upper and lower bounds.
shared-calculator-error-sum-upper-bound-type-error = Upper bound of a sum cannot be { $symbol }.
shared-calculator-error-superscript-with-prime = Superscripts and primes cannot be combined.
shared-calculator-error-table-entry-type-error = Table entry cannot be { $symbol }.
shared-calculator-error-table-equation-supplement = Equations are not allowed.
shared-calculator-error-table-function-definition-supplement = Function definitions are not allowed.
shared-calculator-error-table-generic-supplement = This type of expression is not allowed.
shared-calculator-error-table-header-type-error = Table header cannot be { $symbol }.
shared-calculator-error-table-inequality-supplement = Inequalities are not allowed.
shared-calculator-error-table-list-supplement = Lists are not allowed.
shared-calculator-error-table-regression-invalid-data = There's an error in the provided data.
shared-calculator-error-table-regression-invalid-export-identifier = The headers need to be simple identifiers to export. Try assigning { $latex } to a variable and then referencing it in the table header.
shared-calculator-error-table-regression-log-with-negative = Logarithmic regressions only work if the first column is all positive numbers.
shared-calculator-error-table-regression-supplement = Regressions are not allowed.
shared-calculator-error-table-regression-type-error = The data contains { $symbol }.
shared-calculator-error-tdist-wrong-arity = 'tdist' requires 1 argument. For example, try typing: tdist(1).
shared-calculator-error-ticker-min-step-nonnegative = Min step must evaluate to a non-negative number.
shared-calculator-error-token-with-subscript = Tokens may not have subscripts.
shared-calculator-error-too-many-arguments = '{ $symbol }' accepts at most { $max } arguments.
shared-calculator-error-too-many-variables-many-symbols = Too many variables. Try defining '{ $variables }' or '{ $lastVariable }'.
shared-calculator-error-too-many-variables-no-symbols = Too many variables, I don't know what to do with this.
shared-calculator-error-too-many-variables-one-symbol = Too many variables. Try defining '{ $variable }'.
shared-calculator-error-transformation-definition-expected-types-1 = Try using { $arg }.
shared-calculator-error-transformation-definition-expected-types-2 = Try using { $arg1 } and { $arg2 }.
shared-calculator-error-transformation-definition-expected-types-use-fewer-1 = Try using just { $arg }.
shared-calculator-error-transformation-definition-expected-types-use-fewer-2 = Try using just { $arg1 } and { $arg2 }.
shared-calculator-error-transformation-definition-type-error-1 = A { $fn } cannot be defined using { $arg }. { $expectedTypeMessage }
shared-calculator-error-transformation-definition-type-error-2 = A { $fn } cannot be defined using { $arg1 } and { $arg2 }. { $expectedTypeMessage }
shared-calculator-error-transformation-definition-type-error-many = A '{ $fn }' cannot be defined with these arguments.
shared-calculator-error-transformation-definition-type-error-use-more-1 = A { $fn } cannot be defined using just { $arg }. { $expectedTypeMessage }
shared-calculator-error-transformation-definition-type-error-use-more-2 = A { $fn } cannot be defined using just { $arg1 } and { $arg2 }. { $expectedTypeMessage }
shared-calculator-error-transformation-type-error-1 = Transformation '{ $fn }' cannot be applied to { $arg }.
shared-calculator-error-transformation-type-error-2 = Transformation '{ $fn }' cannot be applied to { $arg1 } and { $arg2 }.
shared-calculator-error-transformation-type-error-many = Transformation '{ $fn }' cannot be applied to these arguments.
shared-calculator-error-ttest-list-too-short = Lists for '{ $symbol }' must have at least 2 elements.
shared-calculator-error-two-numbers-error = Cannot make a polygon from two numbers.
shared-calculator-error-unary-operator-missing-left = You need something before the '{ $symbol }' symbol.
shared-calculator-error-unary-operator-missing-right = You need something after the '{ $symbol }' symbol.
shared-calculator-error-unexpected-equality = Cannot use an equality here.
shared-calculator-error-unexpected-inequality = Cannot use an inequality here.
shared-calculator-error-unexpected-prime = Sorry, I don't understand this use of prime notation.
shared-calculator-error-unexpected-subscript = Only functions and variables may have subscripts.
shared-calculator-error-unexpected-symbol = Sorry, I don't understand the way that '{ $symbol }' is used here.
shared-calculator-error-unplottable-chained-equality = This calculator cannot plot chained equations.
shared-calculator-error-unplottable-long-inequality-chain = This calculator cannot plot chains of more than 2 inequalities.
shared-calculator-error-unplottable-polar-function = We can't plot \u03B8 as a function of r. Try plotting r(\u03B8) instead.
shared-calculator-error-unrecognized-symbol = Sorry, I don't understand the '{ $symbol }' symbol.
shared-calculator-error-update-rule-function-lhs = '{ $symbol }' cannot be updated because it is a function.
shared-calculator-error-update-rule-illegal-lhs = Variable '{ $symbol }' cannot be updated.
shared-calculator-error-update-rule-local-lhs = Variable '{ $symbol }' cannot be updated because it is locally defined.
shared-calculator-error-update-rule-non-identifier-lhs = The left hand side of '{ $arrow }' should be a variable name like '{ $example }'.
shared-calculator-error-update-rule-type-error = Cannot update a variable to { $symbol }.
shared-calculator-error-update-rule-undefined-lhs = Variable '{ $symbol }' must be defined to be updated.
shared-calculator-error-use-r-for-cylindrical-coordinates = Can't combine '\u03C1' and 'z'. Try 'r' for cylindrical coordinates.
shared-calculator-error-use-rho-for-spherical-coordinates = Can't combine 'r' and '\u03C6'. Try '\u03C1' (rho) for spherical coordinates.
shared-calculator-error-variable-as-function = Variable '{ $dependency }' can't be used as a function.
shared-calculator-error-variable-invalid-function-name = This calculator can not use '{ $symbol }' as a function name.
shared-calculator-error-variable-length-distribution-list = The length of a list of distributions can't depend on free variable '{ $symbol }'.
shared-calculator-error-variable-length-integral-depends-on-integration-var = Can't integrate a list whose length depends on integration variable '{ $symbol }'.
shared-calculator-error-variable-length-product-body-depends-on-index = Can't take the product of a list whose length depends on product index '{ $symbol }'.
shared-calculator-error-variable-length-sum-body-depends-on-index = Can't sum a list whose length depends on summation index '{ $symbol }'.
shared-calculator-error-variable-length-top-level-list = Can't plot a list whose length depends on free variable '{ $symbol }'.
shared-calculator-error-variable-seed = Random seed cannot depend on free variable '{ $symbol }'.
shared-calculator-error-variable-unsupported = This calculator does not support the '{ $symbol }' variable.
shared-calculator-error-variables-unsupported = This calculator does not support variables like '{ $variable }'.
shared-calculator-error-write-integral = Type '{ $command }' for { $symbol }.
shared-calculator-error-wrong-arity-many-arg = Function '{ $dependency }' requires { $assignment_arity } arguments. { $supplement }
shared-calculator-error-wrong-arity-single-arg-too-few = Function '{ $dependency }' requires an argument. { $supplement }
shared-calculator-error-wrong-arity-single-arg-too-many = Function '{ $dependency }' requires only 1 argument. { $supplement }
shared-calculator-error-wrong-arity-supplement = For example, try typing: { $recommendation }.
shared-calculator-error-wrong-two-arg-arity = Function '{ $symbol }' requires 2 arguments. For example, try typing: { $recommendation }.
shared-calculator-error-zero-arg-reducer = Function '{ $symbol }' requires at least one argument. For example, try typing: { $symbol }(1, 2).
shared-calculator-heading-function-table-column-header = Function
shared-calculator-heading-keyboard-shortcuts = Keyboard Shortcuts
shared-calculator-heading-keyboard-shortcuts-audio-tracing = Audio Tracing
shared-calculator-heading-keyboard-shortcuts-braille = Braille
shared-calculator-heading-keyboard-shortcuts-common-actions = Common Actions
shared-calculator-heading-keyboard-shortcuts-common-symbols = Common Symbols
shared-calculator-heading-keyboard-shortcuts-kiavash-com-only = kiavash.com Only
shared-calculator-heading-keyboard-shortcuts-expression-entry-and-navigation = Expression Entry and Navigation
shared-calculator-heading-keyboard-shortcuts-geometry-expression-edit = Expression Edit
shared-calculator-heading-keyboard-shortcuts-geometry-graph-navigation-during-construction = Graph Navigation During Construction
shared-calculator-heading-keyboard-shortcuts-geometry-token-navigator = Token Navigator
shared-calculator-heading-keyboard-shortcuts-geometry-tool-selection = Tool Selection
shared-calculator-heading-keyboard-shortcuts-interactive-points = Interactive Points
shared-calculator-heading-keyboard-shortcuts-slider-trace = Slider Trace
shared-calculator-heading-keyboard-shortcuts-sliders = Sliders
shared-calculator-heading-keyboard-shortcuts-symbols-and-supported-functions = <1>Common Symbols and <2>Supported Functions</2></1>
shared-calculator-heading-keyboard-shortcuts-tables = Tables
shared-calculator-heading-mac-table-column-header = Mac Shortcut
shared-calculator-heading-windows-chrome-table-column-header = Windows / ChromeOS Shortcut
shared-calculator-label-for = for
shared-calculator-label-hide-custom-colors = Hide custom colors from geo toolbar
shared-calculator-label-list-of-count-items-suffix =
    { $count ->
        [0] empty
        [one] 1 item
       *[other] { $count } items
    }
shared-calculator-label-os = Operating System
shared-calculator-label-saved = Saved!
shared-calculator-label-saving = Saving...
shared-calculator-label-search-results = Search Results
shared-calculator-label-slow-plotting = This expression is currently being plotted and may take a long time
shared-calculator-label-toast-learn-more = Learn more
shared-calculator-label-toast-undo = Undo
shared-calculator-label-value-type-action = an action
shared-calculator-label-value-type-angle = an angle
shared-calculator-label-value-type-any = an unknown object
shared-calculator-label-value-type-arc = an arc
shared-calculator-label-value-type-bool = a true/false value
shared-calculator-label-value-type-circle = a circle
shared-calculator-label-value-type-color = a color
shared-calculator-label-value-type-complex = a complex number
shared-calculator-label-value-type-directed-angle = a directed angle
shared-calculator-label-value-type-distribution = a distribution
shared-calculator-label-value-type-empty-list = an empty list
shared-calculator-label-value-type-error = an error object
shared-calculator-label-value-type-lambda-complex = a parameterized complex number
shared-calculator-label-value-type-lambda-point = a parameterized point
shared-calculator-label-value-type-lambda-point3d = a parameterized 3d point
shared-calculator-label-value-type-line = a line
shared-calculator-label-value-type-list-of-2d-points = a list of 2d points
shared-calculator-label-value-type-list-of-3d-points = a list of 3d points
shared-calculator-label-value-type-list-of-angles = a list of angles
shared-calculator-label-value-type-list-of-any = a list of unknown objects
shared-calculator-label-value-type-list-of-arcs = a list of arcs
shared-calculator-label-value-type-list-of-bool = a list of true/false values
shared-calculator-label-value-type-list-of-circles = a list of circles
shared-calculator-label-value-type-list-of-colors = a list of colors
shared-calculator-label-value-type-list-of-complex = a list of complex numbers
shared-calculator-label-value-type-list-of-directed-angles = a list of directed angles
shared-calculator-label-value-type-list-of-distributions = a list of distributions
shared-calculator-label-value-type-list-of-lambda-complex = a list of parameterized complex numbers
shared-calculator-label-value-type-list-of-lambda-point = a list of parameterized points
shared-calculator-label-value-type-list-of-lambda-point3d = a list of parameterized 3d points
shared-calculator-label-value-type-list-of-lines = a list of lines
shared-calculator-label-value-type-list-of-numbers = a list of numbers
shared-calculator-label-value-type-list-of-points = a list of points
shared-calculator-label-value-type-list-of-polygons = a list of polygons
shared-calculator-label-value-type-list-of-rays = a list of rays
shared-calculator-label-value-type-list-of-restrictions = a list of restrictions
shared-calculator-label-value-type-list-of-segment3d = a list of 3d segments
shared-calculator-label-value-type-list-of-segments = a list of segments
shared-calculator-label-value-type-list-of-sphere3d = a list of 3d sphere
shared-calculator-label-value-type-list-of-tone = a list of tones
shared-calculator-label-value-type-list-of-transformations = a list of transformations
shared-calculator-label-value-type-list-of-triangle3d = a list of 3d triangles
shared-calculator-label-value-type-list-of-vector3d = a list of 3d vectors
shared-calculator-label-value-type-list-of-vectors = a list of vectors
shared-calculator-label-value-type-number = a number
shared-calculator-label-value-type-point = a point
shared-calculator-label-value-type-point2d = a 2d point
shared-calculator-label-value-type-point3d = a 3d point
shared-calculator-label-value-type-polygon = a polygon
shared-calculator-label-value-type-ray = a ray
shared-calculator-label-value-type-restriction = a restriction
shared-calculator-label-value-type-seed = a string
shared-calculator-label-value-type-segment = a segment
shared-calculator-label-value-type-segment3d = a 3d segment
shared-calculator-label-value-type-sphere3d = a 3d sphere
shared-calculator-label-value-type-tone = a tone
shared-calculator-label-value-type-transformation = a transformation
shared-calculator-label-value-type-triangle3d = a 3d triangle
shared-calculator-label-value-type-vector = a vector
shared-calculator-label-value-type-vector3d = a 3d vector
shared-calculator-narration-author-mode = Author Mode
shared-calculator-narration-author-mode-off = Author mode off
shared-calculator-narration-author-mode-on = Author mode on
shared-calculator-narration-braille-mode = Braille Mode
shared-calculator-narration-disable-tool = Disable { $tool } when this condition is true
shared-calculator-narration-display-as-decimal = Displaying as fraction. Press Enter to display as Decimal
shared-calculator-narration-display-as-fraction = Displaying as decimal. Press Enter to display as Fraction
shared-calculator-narration-expression-index = Expression { $index }
shared-calculator-narration-expression-list = Expression List
shared-calculator-narration-hotkey-braille-mode-nemeth = Braille mode Nemeth
shared-calculator-narration-hotkey-braille-mode-off = Braille mode off
shared-calculator-narration-hotkey-braille-mode-ueb = Braille mode UEB
shared-calculator-narration-input-error = input has an error
shared-calculator-narration-item-clickable = { $item } clickable
shared-calculator-narration-item-selected = { $item } selected
shared-calculator-narration-item-unknown = Unknown
shared-calculator-narration-item-unselected = { $item } unselected
shared-calculator-narration-keypad = keypad
shared-calculator-narration-keypad-controlbar = Control Bar
shared-calculator-narration-keypad-key-10-n = Times ten to the power of
shared-calculator-narration-keypad-key-abs = Absolute Value
shared-calculator-narration-keypad-key-action-to = Set Value To
shared-calculator-narration-keypad-key-action-with = Substitute With
shared-calculator-narration-keypad-key-alpha = Alpha
shared-calculator-narration-keypad-key-angle = Angle
shared-calculator-narration-keypad-key-angles = Angles
shared-calculator-narration-keypad-key-ans = Answer
shared-calculator-narration-keypad-key-arc = Arc
shared-calculator-narration-keypad-key-arccos = Inverse Cosine
shared-calculator-narration-keypad-key-arccot = Inverse Cotangent
shared-calculator-narration-keypad-key-arccsc = Inverse Cosecant
shared-calculator-narration-keypad-key-arcsec = Inverse Secant
shared-calculator-narration-keypad-key-arcsin = Inverse Sine
shared-calculator-narration-keypad-key-arctan = Inverse Tangent
shared-calculator-narration-keypad-key-area = Area
shared-calculator-narration-keypad-key-arg = Argument
shared-calculator-narration-keypad-key-backspace = Backspace
shared-calculator-narration-keypad-key-beta = Beta
shared-calculator-narration-keypad-key-binomialdist = Binomial Distribution
shared-calculator-narration-keypad-key-boxplot = Box Plot
shared-calculator-narration-keypad-key-ceil = Ceiling
shared-calculator-narration-keypad-key-center = Center
shared-calculator-narration-keypad-key-circle = Circle
shared-calculator-narration-keypad-key-conj = Complex conjugate
shared-calculator-narration-keypad-key-corr = Correlation
shared-calculator-narration-keypad-key-cos = Cosine
shared-calculator-narration-keypad-key-cosh = Hyperbolic Cosine
shared-calculator-narration-keypad-key-cot = Cotangent
shared-calculator-narration-keypad-key-coterminal = Coterminal
shared-calculator-narration-keypad-key-coth = Hyperbolic Cotangent
shared-calculator-narration-keypad-key-cov = Co Variance
shared-calculator-narration-keypad-key-covp = Population Co Variance
shared-calculator-narration-keypad-key-csc = Cosecant
shared-calculator-narration-keypad-key-csch = Hyperbolic Cosecant
shared-calculator-narration-keypad-key-cubed = Cubed
shared-calculator-narration-keypad-key-decimal = Decimal
shared-calculator-narration-keypad-key-dilate = Dilate
shared-calculator-narration-keypad-key-directed-angle = Directed Angle
shared-calculator-narration-keypad-key-directed-angles = Directed Angles
shared-calculator-narration-keypad-key-distance = Distance
shared-calculator-narration-keypad-key-divide = Divide
shared-calculator-narration-keypad-key-dotplot = Dot Plot
shared-calculator-narration-keypad-key-enter = Enter
shared-calculator-narration-keypad-key-erf = Error Function
shared-calculator-narration-keypad-key-exp = Exponent
shared-calculator-narration-keypad-key-factorial = Factorial
shared-calculator-narration-keypad-key-floor = Floor
shared-calculator-narration-keypad-key-fraction = A over B
shared-calculator-narration-keypad-key-glider = Glider
shared-calculator-narration-keypad-key-histogram = Histogram
shared-calculator-narration-keypad-key-imag = Imaginary
shared-calculator-narration-keypad-key-int = Integral
shared-calculator-narration-keypad-key-intersection = Intersection
shared-calculator-narration-keypad-key-inversecdf = Inverse CDF function
shared-calculator-narration-keypad-key-ittest = Independent T Test
shared-calculator-narration-keypad-key-left-arrow = Left Arrow
shared-calculator-narration-keypad-key-left-bracket = Left Bracket
shared-calculator-narration-keypad-key-left-paren = Left Parenthesis
shared-calculator-narration-keypad-key-line = Line
shared-calculator-narration-keypad-key-ln = Natural Log
shared-calculator-narration-keypad-key-log = Log
shared-calculator-narration-keypad-key-loga = Log A
shared-calculator-narration-keypad-key-mean = Mean
shared-calculator-narration-keypad-key-median = Median
shared-calculator-narration-keypad-key-midpoint = Midpoint
shared-calculator-narration-keypad-key-minus = Minus
shared-calculator-narration-keypad-key-normaldist = Normal Distribution
shared-calculator-narration-keypad-key-nthroot = Nth Root
shared-calculator-narration-keypad-key-parallel = Parallel
shared-calculator-narration-keypad-key-pdf = Probability Density Function
shared-calculator-narration-keypad-key-percent-of = Percent Of
shared-calculator-narration-keypad-key-perimeter = Perimeter
shared-calculator-narration-keypad-key-perpendicular = Perpendicular
shared-calculator-narration-keypad-key-phi = Phi
shared-calculator-narration-keypad-key-pi = Pi
shared-calculator-narration-keypad-key-plus = Plus
shared-calculator-narration-keypad-key-poissondist = Poisson Distribution
shared-calculator-narration-keypad-key-polygon = Polygon
shared-calculator-narration-keypad-key-prime = Function derivative
shared-calculator-narration-keypad-key-product = Product
shared-calculator-narration-keypad-key-quantile = Quantile
shared-calculator-narration-keypad-key-quartile = Quartile
shared-calculator-narration-keypad-key-radius = Radius
shared-calculator-narration-keypad-key-random = Random Number
shared-calculator-narration-keypad-key-ray = Ray
shared-calculator-narration-keypad-key-real = Real
shared-calculator-narration-keypad-key-reciprocal = Reciprocal
shared-calculator-narration-keypad-key-reflect = Reflect
shared-calculator-narration-keypad-key-rho = Rho
shared-calculator-narration-keypad-key-right-arrow = Right Arrow
shared-calculator-narration-keypad-key-right-bracket = Right Bracket
shared-calculator-narration-keypad-key-right-paren = Right Parenthesis
shared-calculator-narration-keypad-key-rotate = Rotate
shared-calculator-narration-keypad-key-round = Round
shared-calculator-narration-keypad-key-sec = Secant
shared-calculator-narration-keypad-key-segment = Segment
shared-calculator-narration-keypad-key-segments = Segments
shared-calculator-narration-keypad-key-shift = Shift
shared-calculator-narration-keypad-key-sin = Sine
shared-calculator-narration-keypad-key-sinh = Hyperbolic Sine
shared-calculator-narration-keypad-key-spearman = Spearman Rank Correlation
shared-calculator-narration-keypad-key-sphere = Sphere
shared-calculator-narration-keypad-key-sqrt = Square Root
shared-calculator-narration-keypad-key-squared = Squared
shared-calculator-narration-keypad-key-stats = Summary statistics
shared-calculator-narration-keypad-key-stdev = Standard Deviation
shared-calculator-narration-keypad-key-stdevp = Standard Deviation of Population
shared-calculator-narration-keypad-key-subscript = Subscript
shared-calculator-narration-keypad-key-sum = Sum
shared-calculator-narration-keypad-key-superscript = Superscript
shared-calculator-narration-keypad-key-supplement = Supplement
shared-calculator-narration-keypad-key-tan = Tangent
shared-calculator-narration-keypad-key-tanh = Hyperbolic Tangent
shared-calculator-narration-keypad-key-tau = Tau
shared-calculator-narration-keypad-key-tdist = Student-t Distribution
shared-calculator-narration-keypad-key-theta = Theta
shared-calculator-narration-keypad-key-times = Times
shared-calculator-narration-keypad-key-toggle-audio-trace = Toggle Audio Trace
shared-calculator-narration-keypad-key-toggle-letters = Toggle Letters
shared-calculator-narration-keypad-key-toggle-numbers = Toggle Numbers
shared-calculator-narration-keypad-key-tone = Tone
shared-calculator-narration-keypad-key-translate = Translate
shared-calculator-narration-keypad-key-triangle = Triangle
shared-calculator-narration-keypad-key-tscore = T Score
shared-calculator-narration-keypad-key-ttest = T Test
shared-calculator-narration-keypad-key-uniformdist = Uniform Distribution
shared-calculator-narration-keypad-key-vector = Vector
shared-calculator-narration-keypad-key-vertices = Vertices
shared-calculator-narration-keypad-key-ythroot = Yth Root
shared-calculator-narration-keypad-plus-minus = Plus-Minus
shared-calculator-narration-math-input-error-message = expression has error
shared-calculator-narration-settings-display-size = Display Size
shared-calculator-narration-settings-display-size-default = Display size: default
shared-calculator-narration-settings-display-size-large = Display size: large
shared-calculator-narration-show-as-decimal = Show as Decimal
shared-calculator-narration-show-as-fraction = Show as Fraction
shared-calculator-narration-six-key-mode-off = Six Key Braille Input off
shared-calculator-narration-six-key-mode-on = Six Key Braille Input on
shared-calculator-text-complex-enabled-note = Hint: try writing { $eq1 } or { $eq2 }.
shared-calculator-text-complex-radian-mode = Complex mode uses radians
shared-calculator-text-customize-toolbar = Customize the Toolbar
shared-calculator-text-keyboard-shortcut-add-expression = Add an Expression
shared-calculator-text-keyboard-shortcut-add-folder = Add a Folder
shared-calculator-text-keyboard-shortcut-add-image = Add an Image
shared-calculator-text-keyboard-shortcut-add-note = Add a Note
shared-calculator-text-keyboard-shortcut-add-table = Add a Table
shared-calculator-text-keyboard-shortcut-add-table-regression = Add Regression from within the Active Table
shared-calculator-text-keyboard-shortcut-adjust-playback-speed = Adjust Playback Speed (1 = slowest, 5 = fastest)
shared-calculator-text-keyboard-shortcut-announce-slider-animations = Announce Active Slider Animations
shared-calculator-text-keyboard-shortcut-beginning-of-block = Beginning of Current Block
shared-calculator-text-keyboard-shortcut-beginning-of-expression = Beginning of Current Expression
shared-calculator-text-keyboard-shortcut-close-a-dialog = Close a Dialog
shared-calculator-text-keyboard-shortcut-collapse-all-folders = Collapse All Folders
shared-calculator-text-keyboard-shortcut-collapse-folder = Collapse Selected Folder
shared-calculator-text-keyboard-shortcut-decrease-volume = Decrease Volume
shared-calculator-text-keyboard-shortcut-decrease-x = Decrease X
shared-calculator-text-keyboard-shortcut-decrease-x-larger = Decrease X by Larger Amount
shared-calculator-text-keyboard-shortcut-decrease-y = Decrease Y
shared-calculator-text-keyboard-shortcut-decrease-y-larger = Decrease Y by Larger Amount
shared-calculator-text-keyboard-shortcut-degrees-toggle = Toggle Between Degrees and Radians
shared-calculator-text-keyboard-shortcut-delete-expression = Delete the Expression that has Keyboard Focus
shared-calculator-text-keyboard-shortcut-delete-selection = Delete Selection
shared-calculator-text-keyboard-shortcut-describe-axes = Describe the graph axes
shared-calculator-text-keyboard-shortcut-end-of-block = End of Current Block
shared-calculator-text-keyboard-shortcut-end-of-expression = End of Current Expression
shared-calculator-text-keyboard-shortcut-exit-block = Exit Current Block
shared-calculator-text-keyboard-shortcut-expand-all-folders = Expand All Folders
shared-calculator-text-keyboard-shortcut-expand-folder = Expand Selected Folder
shared-calculator-text-keyboard-shortcut-first-point = First Point
shared-calculator-text-keyboard-shortcut-focus-expression-list = Focus the Expression List
shared-calculator-text-keyboard-shortcut-focus-first-interactive-point = Focus First Interactive Point On Screen
shared-calculator-text-keyboard-shortcut-focus-graph-paper = Focus the Graph Paper
shared-calculator-text-keyboard-shortcut-geometry-add-object-to-selection = Add Object that has Keyboard Focus to Group of Selected Items (when box-select is active)
shared-calculator-text-keyboard-shortcut-geometry-add-object-token-to-selection = Add an Object Token to Selection
shared-calculator-text-keyboard-shortcut-geometry-cancel-active-tool = Cancel Active Tool
shared-calculator-text-keyboard-shortcut-geometry-choose-toolbar-item-and-focus-graph = Select a Tool and Focus the Graph
shared-calculator-text-keyboard-shortcut-geometry-close-token-navigator = Close Token navigator
shared-calculator-text-keyboard-shortcut-geometry-delete-selected-objects = Delete Selected Object(s)
shared-calculator-text-keyboard-shortcut-geometry-describe-object = Describe Object that has Keyboard Focus
shared-calculator-text-keyboard-shortcut-geometry-deselect-all-objects = Deselect All Objects
shared-calculator-text-keyboard-shortcut-geometry-drag-movable-objects = Drag All Movable Objects
shared-calculator-text-keyboard-shortcut-geometry-expression-edit-add-object = Add Object that has Keyboard Focus to Expression
shared-calculator-text-keyboard-shortcut-geometry-expression-edit-complete = Finish Editing and Return to Expression List (When All Required Objects Have Been Added)
shared-calculator-text-keyboard-shortcut-geometry-expression-edit-next-object = Move to Next Valid Object for the Active Expression
shared-calculator-text-keyboard-shortcut-geometry-expression-edit-previous-object = Move to Previous Valid Object for the Active Expression
shared-calculator-text-keyboard-shortcut-geometry-focus-selected-objects-toolbar = Focus the Toolbar for the Selected Object(s)
shared-calculator-text-keyboard-shortcut-geometry-focus-toolbar = Focus the Geometry Toolbar
shared-calculator-text-keyboard-shortcut-geometry-move-between-toolbar-categories = Move Between Categories in the Toolbar
shared-calculator-text-keyboard-shortcut-geometry-move-between-toolbar-dropdown-items = Move Through Tools in a Dropdown
shared-calculator-text-keyboard-shortcut-geometry-move-to-bottom-of-graph = Move to Bottom Edge of Graph
shared-calculator-text-keyboard-shortcut-geometry-move-to-left-of-graph = Move to Left Edge of Graph
shared-calculator-text-keyboard-shortcut-geometry-move-to-right-of-graph = Move to Right Edge of Graph
shared-calculator-text-keyboard-shortcut-geometry-move-to-top-of-graph = Move to Top Edge of Graph
shared-calculator-text-keyboard-shortcut-geometry-move-token-between-expression-list-and-navigator = Move an Object Token Between the Expression List and Navigator
shared-calculator-text-keyboard-shortcut-geometry-navigate-graph = Move to Add Point
shared-calculator-text-keyboard-shortcut-geometry-navigate-object-levels = Navigate Between Object Levels
shared-calculator-text-keyboard-shortcut-geometry-navigate-tokens-at-current-level = Move Between Object Tokens at Current Level
shared-calculator-text-keyboard-shortcut-geometry-next-object = Give Attention to Next Valid Object for the Active Tool
shared-calculator-text-keyboard-shortcut-geometry-open-options = Open Options for the Selected Object(s)
shared-calculator-text-keyboard-shortcut-geometry-open-token-navigator = Open Token navigator
shared-calculator-text-keyboard-shortcut-geometry-open-transformation-options = Open Transformation Options for Selected Object
shared-calculator-text-keyboard-shortcut-geometry-previous-object = Give Attention to Previous Valid Object for the Active Tool
shared-calculator-text-keyboard-shortcut-geometry-repeat-active-tool-prompt = Repeat Active Tool Prompt
shared-calculator-text-keyboard-shortcut-geometry-select-next-category = Select Next Construction Tool Category
shared-calculator-text-keyboard-shortcut-geometry-select-next-tool-within-category = Select Next Tool within Active Category
shared-calculator-text-keyboard-shortcut-geometry-select-previous-category = Select Previous Construction Tool Category
shared-calculator-text-keyboard-shortcut-geometry-select-previous-tool-within-category = Select Previous Tool within Active Category
shared-calculator-text-keyboard-shortcut-geometry-select-single-object-token = Select a Single Object Token
shared-calculator-text-keyboard-shortcut-geometry-select-tool-by-number = Select the nth Construction Tool Category
shared-calculator-text-keyboard-shortcut-hear-graph = Hear Graph
shared-calculator-text-keyboard-shortcut-hear-specific-branch = Hear Only Branch 1 Through 10
shared-calculator-text-keyboard-shortcut-increase-selection-left = Increase Selection Left
shared-calculator-text-keyboard-shortcut-increase-selection-right = Increase Selection Right
shared-calculator-text-keyboard-shortcut-increase-volume = Increase Volume
shared-calculator-text-keyboard-shortcut-increase-x = Increase X
shared-calculator-text-keyboard-shortcut-increase-x-larger = Increase X by Larger Amount
shared-calculator-text-keyboard-shortcut-increase-y = Increase Y
shared-calculator-text-keyboard-shortcut-increase-y-larger = Increase Y by Larger Amount
shared-calculator-text-keyboard-shortcut-keypad-toggle = Show or Hide the Keypad
shared-calculator-text-keyboard-shortcut-last-point = Last Point
shared-calculator-text-keyboard-shortcut-move-to-denominator = Move to Denominator Within Fraction
shared-calculator-text-keyboard-shortcut-move-to-numerator = Move to Numerator Within Fraction
shared-calculator-text-keyboard-shortcut-move-to-origin = Move to Origin
shared-calculator-text-keyboard-shortcut-mute-toggle = Mute or Unmute Audio Playback
shared-calculator-text-keyboard-shortcut-nemeth-mode = Switch to Nemeth
shared-calculator-text-keyboard-shortcut-next-character = Next Character
shared-calculator-text-keyboard-shortcut-next-curve = Move to Next Curve
shared-calculator-text-keyboard-shortcut-next-expression = Move to Next Expression
shared-calculator-text-keyboard-shortcut-next-interactive-point = Go to Next Interactive Point
shared-calculator-text-keyboard-shortcut-next-item = Move to Next Item (skips table cells)
shared-calculator-text-keyboard-shortcut-next-poi = Next Point of Interest
shared-calculator-text-keyboard-shortcut-next-point = Next Point
shared-calculator-text-keyboard-shortcut-open-a-graph = Open a Graph
shared-calculator-text-keyboard-shortcut-open-expression-options = Open Options for the Expression that has Keyboard Focus
shared-calculator-text-keyboard-shortcut-open-shortcuts-dialog = Open Keyboard Shortcuts Dialog
shared-calculator-text-keyboard-shortcut-pan-graph = Pan Graph in Given Direction (when focused)
shared-calculator-text-keyboard-shortcut-previous-character = Previous Character
shared-calculator-text-keyboard-shortcut-previous-curve = Move to Previous Curve
shared-calculator-text-keyboard-shortcut-previous-expression = Move to Previous Expression
shared-calculator-text-keyboard-shortcut-previous-interactive-point = Go to Previous Interactive Point
shared-calculator-text-keyboard-shortcut-previous-item = Move to Previous Item (skips table cells)
shared-calculator-text-keyboard-shortcut-previous-poi = Previous Point of Interest
shared-calculator-text-keyboard-shortcut-previous-point = Previous Point
shared-calculator-text-keyboard-shortcut-print-a-graph = Print a Graph
shared-calculator-text-keyboard-shortcut-print-mode = Switch to Print
shared-calculator-text-keyboard-shortcut-redo = Redo
shared-calculator-text-keyboard-shortcut-remove-empty-expression = Remove Selected Empty Expression
shared-calculator-text-keyboard-shortcut-rotate-3d-cube = Rotate Cube in Given Direction (when focused)
shared-calculator-text-keyboard-shortcut-rotate-3d-cube-command = <key>UP ARROW</key>, <key>DOWN ARROW</key>, <key>LEFT ARROW</key>, or <key>RIGHT ARROW</key>
shared-calculator-text-keyboard-shortcut-save-a-graph = Save a Graph
shared-calculator-text-keyboard-shortcut-select-all = Select All
shared-calculator-text-keyboard-shortcut-show-answer-as-decimal-or-fraction = Show Answer as Decimal or Fraction
shared-calculator-text-keyboard-shortcut-show-or-hide-expression = Show or Hide the Selected Expression
shared-calculator-text-keyboard-shortcut-show-or-hide-expression-list = Show or Hide the Expression List
shared-calculator-text-keyboard-shortcut-slider-decrease = Decrease Value
shared-calculator-text-keyboard-shortcut-slider-decrease-larger = Decrease Value by Larger Increment
shared-calculator-text-keyboard-shortcut-slider-increase = Increase Value
shared-calculator-text-keyboard-shortcut-slider-increase-larger = Increase Value by Larger Increment
shared-calculator-text-keyboard-shortcut-slider-maximum = Highest Value
shared-calculator-text-keyboard-shortcut-slider-minimum = Lowest Value
shared-calculator-text-keyboard-shortcut-slider-trace-decrease = Decrease Value of Selected Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-decrease-larger = Decrease Value of Selected Slider by Larger Increment When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-increase = Increase Value of Selected Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-increase-larger = Increase Value of Selected Slider by Larger Increment When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-maximum = Move to Highest Value of Selected Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-minimum = Move to Lowest Value of Selected Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-next-slider = Select Next Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-slider-trace-previous-slider = Select Previous Slider When in Slider Trace
shared-calculator-text-keyboard-shortcut-speak-answer = Speak Answer
shared-calculator-text-keyboard-shortcut-speak-branch = Speak Branch
shared-calculator-text-keyboard-shortcut-speak-color = Speak Color
shared-calculator-text-keyboard-shortcut-speak-focused-block = Speak Block that has Keyboard Focus
shared-calculator-text-keyboard-shortcut-speak-label = Speak Label
shared-calculator-text-keyboard-shortcut-speak-left-adjacent-block = Speak Left-Adjacent Block
shared-calculator-text-keyboard-shortcut-speak-parent-block = Speak Parent Block
shared-calculator-text-keyboard-shortcut-speak-poi-count = Speak Point of Interest Count
shared-calculator-text-keyboard-shortcut-speak-point-type = Speak Type of Selected Point
shared-calculator-text-keyboard-shortcut-speak-right-adjacent-block = Speak Right-Adjacent Block
shared-calculator-text-keyboard-shortcut-speak-selection = Speak Selection
shared-calculator-text-keyboard-shortcut-speak-x = Speak X Coordinate
shared-calculator-text-keyboard-shortcut-speak-y = Speak Y Coordinate
shared-calculator-text-keyboard-shortcut-spin-3d-cube = Spin Cube in Given Direction (when focused)
shared-calculator-text-keyboard-shortcut-spin-3d-cube-command = Press and hold <key>UP ARROW</key>, <key>DOWN ARROW</key>, <key>LEFT ARROW</key>, or <key>RIGHT ARROW</key>
shared-calculator-text-keyboard-shortcut-summarize-graph = Summarize Selected Curve
shared-calculator-text-keyboard-shortcut-switch-pane-in-3d-quest = Move Between Expression List and Quest Instruction Pane
shared-calculator-text-keyboard-shortcut-table-first-column = First Column in Row
shared-calculator-text-keyboard-shortcut-table-first-row = First Row in Column
shared-calculator-text-keyboard-shortcut-table-last-column = Last Column in Row
shared-calculator-text-keyboard-shortcut-table-last-row = Last Row in Column
shared-calculator-text-keyboard-shortcut-table-next-cell = Next Cell
shared-calculator-text-keyboard-shortcut-table-next-column = Next Column
shared-calculator-text-keyboard-shortcut-table-next-row = Next Row
shared-calculator-text-keyboard-shortcut-table-previous-cell = Previous Cell
shared-calculator-text-keyboard-shortcut-table-previous-column = Previous Column
shared-calculator-text-keyboard-shortcut-table-previous-row = Previous Row
shared-calculator-text-keyboard-shortcut-table-speak-column-header = Speak Column Header
shared-calculator-text-keyboard-shortcut-toggle-account-menu = Open or Close the Account Menu
shared-calculator-text-keyboard-shortcut-toggle-audio-trace = Enable or Disable Audio Trace Mode
shared-calculator-text-keyboard-shortcut-toggle-author-mode = Toggle Author Mode Features
shared-calculator-text-keyboard-shortcut-toggle-braille-typing = Turn Braille Typing On or Off
shared-calculator-text-keyboard-shortcut-toggle-edit-list-mode = Turn Edit List Mode On or Off
shared-calculator-text-keyboard-shortcut-toggle-graph-settings-menu = Open or Close the Graph Settings Menu
shared-calculator-text-keyboard-shortcut-toggle-help-menu = Open or Close the Help Menu
shared-calculator-text-keyboard-shortcut-toggle-language-menu = Open or Close the Language Menu
shared-calculator-text-keyboard-shortcut-toggle-share-menu = Open or Close the Share Menu
shared-calculator-text-keyboard-shortcut-toggle-slider-trace = Toggle Slider Trace Mode
shared-calculator-text-keyboard-shortcut-ueb-mode = Switch to UEB
shared-calculator-text-keyboard-shortcut-undo = Undo
shared-calculator-text-keyboard-shortcut-zoom-fit = Zoom to Fit
shared-calculator-text-keyboard-shortcut-zoom-in = Zoom In
shared-calculator-text-keyboard-shortcut-zoom-out = Zoom Out
shared-calculator-text-keyboard-shortcut-zoom-restore-default = Restore Default Viewport
shared-calculator-text-search-results =
    { $count ->
        [0] No results.
        [one] 1 result.
       *[other] { $count } results.
    }
shared-heading-keyboard-shortcuts-supported-functions = Supported Functions
shared-label-choose-all-that-describe = Choose all that describe you:
shared-label-continue-with-email = Continue with email:
shared-label-create-password = Create Password
shared-label-email = Email
shared-label-enter-password = Enter password:
shared-label-family-name = Last Name (optional)
shared-label-first-name = First Name
shared-label-given-name-or-nickname = First Name or Nickname
shared-label-last-name = Last Name
shared-label-name = Name
shared-label-new-email-address = New Email Address
shared-label-opens-in-new-tab-suffix = { $title } (opens in new tab)
shared-label-optional = (optional)
shared-label-password = Password
shared-label-to = to
shared-message-account-reactivated = You previously requested to delete your account, but because you logged back in within 30 days, we will not delete your account. Welcome back!
shared-message-change-password-email-sent = We will send a link to your email address ({ $emailAddress }) so you can change your password.
shared-message-check-email-for-delete-link = Please check your email ({ $emailAddress }) for the link to delete your account.
shared-message-check-email-for-link = Please check { $emailAddress } for the Change Email link.
shared-message-check-email-for-password-link = Please check your email ({ $emailAddress }) for the link to change your password.
shared-message-check-email-for-password-recovery-link = Message sent. Please check your email for a password recovery link.
shared-message-delete-account-notice = When you delete your account, <1>we will retain your data for 30 days.</1> You can reactivate your account at any time during those 30 days by logging back in. If there's something about kiavash we can improve, please <2>let us know.</2>
shared-message-delete-account-will-send-email = We will send you a link to your email address ({ $email }) so you can delete your account.
shared-message-email-sent = Email sent
shared-message-email-settings-will-send-email = We will send a Change Email link to { $emailAddress }.
shared-message-google-login-not-available = Google Login is not available on this device.
shared-message-information-saved = Saved!
shared-message-maintenance-starts-at = Saving, sharing, and signing in will be temporarily disabled on { $localizedStartDate } starting at approximately { $localizedStartTime }.
shared-message-maintenance-window = Saving, sharing, and signing in will be temporarily disabled on { $localizedStartDate } between approximately { $localizedStartTime } and { $localizedEndTime }.
shared-message-please-review-name = We tried to split your name into first and last name. Please review your name below and edit any mistakes.
shared-message-set-new-email-address = Set a new email address and password.
shared-prompt-continue-with-apple = Continue with Apple
shared-prompt-continue-with-google = Continue with Google
shared-prompt-enter-email-for-password-recovery-link = Enter your email address to get a password recovery link.
shared-prompt-forgot-password = Forgot password?
shared-prompt-set-password = Set a password instead
shared-text-cookie-notice = We use cookies only for logged in users. Please stay logged out to use kiavash without cookies.
shared-text-or = or
shared-text-previous-apple = You've previously signed in with Apple. Click the button below to sign in.
shared-text-previous-google = You've previously signed in with Google. Click the button below to sign in.
shared-text-privacy-notice = By signing up, you agree to our <1>Privacy Policy</1> & <2>Terms</2>.
shared-title-account-finish-set-up = You signed up with <1>{$v0}</1>. Finish setting up your account below.
shared-title-account-reactivated = Your account has been reactivated.
shared-title-account-settings = Account Settings
shared-title-authenticate = Log In or Sign Up
shared-title-change-email-address = Change your kiavash email address
shared-title-change-password-narrow = Password
shared-title-change-password-wide = Change Password
shared-title-delete-account = Are you sure you want to delete your account?
shared-title-email-settings = Email
shared-title-language-menu = Language
shared-title-login = Log In
shared-title-profile-information-narrow = Profile
shared-title-profile-information-wide = Profile Information
shared-title-recover-password = Recover Password
shared-title-using-for-sign-up = You're signing up with <1>{$v0}</1>.
shared-title-welcome = Welcome!
shared-title-welcome-with-name = Welcome, { $name }!
basic-calculator-button-controlbar-abc = abc
basic-calculator-button-controlbar-clear = clear
basic-calculator-button-controlbar-clear-all = clear all
basic-calculator-button-controlbar-func = func
basic-calculator-button-controlbar-main = main
basic-calculator-button-turn-braille-mode-off = Turn { $mode } off
basic-calculator-error-fractions-unavailable = Fractions are not available in the current calculator.
basic-calculator-error-parentheses-unavailable = Parentheses are not available in this calculator.
basic-calculator-heading-braille-table-type-this = Type this
basic-calculator-heading-braille-table-typeset = Typeset
basic-calculator-label-answer-hint = Your answers show up on this side.
basic-calculator-label-controlbar-deg = deg
basic-calculator-label-controlbar-rad = rad
basic-calculator-label-convert-to-decimal = Convert to decimal.
basic-calculator-label-convert-to-fraction = Convert to fraction.
basic-calculator-label-reverse-contrast = Reverse Contrast
basic-calculator-link-download-braille-equations = Download Braille Equations
basic-calculator-link-view-braille-examples = View more examples
basic-calculator-narration-calc-description-fourfunction = kiavash Four-Function Calculator
basic-calculator-narration-calc-description-scientific = kiavash Scientific Calculator
basic-calculator-narration-controlbar-abc = A B C
basic-calculator-narration-controlbar-backspace = backspace
basic-calculator-narration-controlbar-clear = clear
basic-calculator-narration-controlbar-clear-all = clear all
basic-calculator-narration-controlbar-degrees = Degrees
basic-calculator-narration-controlbar-functions = Functions
basic-calculator-narration-controlbar-main = main
basic-calculator-narration-controlbar-radians = Radians
basic-calculator-narration-controlbar-redo = Redo
basic-calculator-narration-controlbar-settings = settings
basic-calculator-narration-controlbar-undo = Undo
basic-calculator-narration-convert-to-decimal = Displaying as fraction. Press Enter to display as Decimal
basic-calculator-narration-convert-to-fraction = Displaying as decimal. Press Enter to display as Fraction
basic-calculator-narration-hotkey-six-key-input-off = Six Key Braille Input off
basic-calculator-narration-hotkey-six-key-input-on = Six Key Braille Input on
basic-calculator-text-braille-mode-is-on = { $mode } is on!
basic-calculator-text-how-to-type-braille = Use a Refreshable Braille display, or just type Braille with a keyboard.
geometry-label-construct-instruction = Click down here to construct
geometry-label-pick-tool-instruction = Pick a tool to get started
graphing-calculator-button-add-table-regression = Add Regression
graphing-calculator-button-audio-trace-hear-graph = Hear Graph
graphing-calculator-button-audio-trace-stop-graph = Stop Graph
graphing-calculator-button-change-image = Change Image
graphing-calculator-button-clear-graph = Delete All
graphing-calculator-button-copy-poi-coordinates = Export point to expression list
graphing-calculator-button-copy-table-regression-model-to-expression-list = Export as custom regression
graphing-calculator-button-delete-table-regression = Delete regression
graphing-calculator-button-done = Done
graphing-calculator-button-draggable = Draggable
graphing-calculator-button-draggable-points = Draggable Points
graphing-calculator-button-edit-graph-on-kiavash-logo = edit graph on
graphing-calculator-button-editable-math = Editable Math
graphing-calculator-button-editable-text = Editable Text
graphing-calculator-button-find-cdf = Find Cumulative Probability (CDF)
graphing-calculator-button-funcs = funcs
graphing-calculator-button-functions = functions
graphing-calculator-button-functions-menu-custom-colors = Custom Colors
graphing-calculator-button-functions-menu-number-theory = Number Theory
graphing-calculator-button-geometry-label-points = Label Points
graphing-calculator-button-hide-folder-from-students-2 = Hide this folder from students.
graphing-calculator-button-in-front-of-everything = In front of everything
graphing-calculator-button-keypad-audio-trace-off = Audio Trace Off
graphing-calculator-button-keypad-describe-axes = Describe Axes
graphing-calculator-button-keypad-describe-curve = Describe Curve
graphing-calculator-button-keypad-describe-curve-short = Curve
graphing-calculator-button-keypad-describe-point = Describe Point
graphing-calculator-button-keypad-describe-point-short = Point
graphing-calculator-button-label = Label
graphing-calculator-button-label-editable = Editable
graphing-calculator-button-label-show-on-hover = Show on hover
graphing-calculator-button-label-text-outline = Text outline
graphing-calculator-button-load-image-retry = Retry.
graphing-calculator-button-move-to-expression-list-action = Move
graphing-calculator-button-place-image-behind-graphs = Place behind graphs
graphing-calculator-button-regression-log-mode = Log Mode
graphing-calculator-button-regression-plot-residuals = plot
graphing-calculator-button-replace = Replace
graphing-calculator-button-reset-graph = Reset
graphing-calculator-button-settings-degrees = Degrees
graphing-calculator-button-settings-radians = Radians
graphing-calculator-button-settings-zoom-square = Zoom Square
graphing-calculator-button-share-graph-link-copy = Copy
graphing-calculator-button-show-all-table-rows = Show all
graphing-calculator-button-slider-add-all-variables = all
graphing-calculator-button-visual-parameters-binned = Binned
graphing-calculator-button-visual-parameters-center = Center
graphing-calculator-button-visual-parameters-count = Count
graphing-calculator-button-visual-parameters-density = Density
graphing-calculator-button-visual-parameters-exact = Exact
graphing-calculator-button-visual-parameters-exclude-outliers = Exclude Outliers
graphing-calculator-button-visual-parameters-left = Left
graphing-calculator-button-visual-parameters-relative = Relative
graphing-calculator-error-equation-contains-unresolved-details = This plot contains fine detail that has not been fully resolved.
graphing-calculator-error-expression-replacement = Replacement must be a valid function or variable name.
graphing-calculator-error-expression-search = Can only rename a valid function or variable name.
graphing-calculator-error-failed-to-load-image = Failed to load image.
graphing-calculator-error-image-invalid-angle = Invalid angle. Try using any number.
graphing-calculator-error-image-invalid-center = Invalid center. Try, for example, (0,0).
graphing-calculator-error-image-invalid-file = The file "{ $file }" is not an image
graphing-calculator-error-image-invalid-height = Invalid height. Try using any number.
graphing-calculator-error-image-invalid-opacity = Invalid opacity. Try using any number.
graphing-calculator-error-image-invalid-width = Invalid width. Try using any number.
graphing-calculator-error-legacy-random-seed-behavior = This graph uses legacy randomization behavior.
graphing-calculator-error-log-axes-image = Cannot plot images on a log scale.
graphing-calculator-error-nan-blame-complex-coercion = Plotted values are non-real at all input points. Try using absolute value to convert complex numbers to real.
graphing-calculator-error-reached-maximum-recursion-depth = Reached maximum recursion depth while plotting this expression.
graphing-calculator-error-table-regression-unexportable-reserved-variable-single = Column { $variable } can't be referenced outside of the table. To create a standalone regression, first try renaming that column.
graphing-calculator-error-table-regression-unexportable-reserved-variables-many = These columns can't be referenced outside of the table. To export the regression model, first try renaming the columns.
graphing-calculator-error-tone-frequency-out-of-range = Tones can only play for frequencies between { $min }Hz and { $max }Hz.
graphing-calculator-heading-advanced = Advanced
graphing-calculator-heading-audio-trace-describe = Describe
graphing-calculator-heading-audio-trace-navigation = Navigation
graphing-calculator-heading-audio-trace-screen-reader = Screen Reader
graphing-calculator-heading-calculus = Calculus
graphing-calculator-heading-clickable = Clickable
graphing-calculator-heading-dist-tab-distributions = Distributions
graphing-calculator-heading-dist-tab-visualizations = Visualizations
graphing-calculator-heading-drag = Drag
graphing-calculator-heading-fill = Fill
graphing-calculator-heading-functions-menu-advanced = Advanced
graphing-calculator-heading-functions-menu-complex = Complex
graphing-calculator-heading-functions-menu-polar = Polar Coordinates
graphing-calculator-heading-functions-menu-sound = Sound
graphing-calculator-heading-geometry = Geometry
graphing-calculator-heading-geometry-measurements = Properties & Measurements
graphing-calculator-heading-geometry-tools = Geometry Tools
graphing-calculator-heading-geometry-transformations = Transformations
graphing-calculator-heading-hyperbolic-trig = Hyperbolic Trig Functions
graphing-calculator-heading-image-opacity = Opacity
graphing-calculator-heading-inverse-trig = Inverse Trig Functions
graphing-calculator-heading-keypad-audio-trace-point-of-interest = <1>Point</1><2>of Interest</2>
graphing-calculator-heading-label = Label
graphing-calculator-heading-label-orientation = Orientation
graphing-calculator-heading-lines = Lines
graphing-calculator-heading-lists = List Operations
graphing-calculator-heading-points = Points
graphing-calculator-heading-quest = Quest: { $title }
graphing-calculator-heading-regression-equation = Equation
graphing-calculator-heading-regression-parameters = Regression Parameters
graphing-calculator-heading-regression-residuals = Residuals
graphing-calculator-heading-regression-statistics = Statistics
graphing-calculator-heading-slider-animation-mode = Animation Mode
graphing-calculator-heading-slider-speed = Speed
graphing-calculator-heading-stat-tests = Statistical Tests
graphing-calculator-heading-stats = Statistics
graphing-calculator-heading-style = Style
graphing-calculator-heading-surfaces = Surfaces
graphing-calculator-heading-table-regression-model-structure = Regression model structure
graphing-calculator-heading-trig = Trig Functions
graphing-calculator-heading-visual-parameters-bar-heights = Bar Heights
graphing-calculator-heading-visual-parameters-bin-alignment = Bin Alignment
graphing-calculator-heading-visual-parameters-display-properties = Display Properties
graphing-calculator-heading-visual-parameters-x-values = X Values
graphing-calculator-label-adaptive-peel-warning = This graph has many transparent layers, which may result in degraded performance or visual innacuracies.
graphing-calculator-label-add-base-case = add base case:
graphing-calculator-label-add-depressed-image-tooltip = Add Depressed Image
graphing-calculator-label-add-hovered-image-tooltip = Add Hovered Image
graphing-calculator-label-add-item-tooltip = Add Item
graphing-calculator-label-add-slider = add slider:
graphing-calculator-label-angle-tooltip = Angle
graphing-calculator-label-animation-properties-tooltip = Animation Properties
graphing-calculator-label-audio-trace-curve = Curve
graphing-calculator-label-audio-trace-need-screen-reader = Your Screen Reader needs to be on to hear these.
graphing-calculator-label-audio-trace-point = Point
graphing-calculator-label-audio-trace-speed = Speed
graphing-calculator-label-audio-trace-volume = Volume
graphing-calculator-label-axes = Axes
graphing-calculator-label-braille-nemeth = Braille Nemeth
graphing-calculator-label-braille-size-etc11 = ETC Romeo/Juliet (11.5 x 11 in)
graphing-calculator-label-braille-size-etc8 = ETC Romeo/Juliet (8.5 x 11 in)
graphing-calculator-label-braille-size-vpmax11 = VP Max (11.5 x 11 in)
graphing-calculator-label-braille-size-vpmax8 = VP Max (8.5 x 11 in)
graphing-calculator-label-braille-ueb = Braille UEB
graphing-calculator-label-cdf-maximum = Max:
graphing-calculator-label-cdf-minimum = Min:
graphing-calculator-label-change-depressed-image-tooltip = Change Depressed Image
graphing-calculator-label-change-hovered-image-tooltip = Change Hovered Image
graphing-calculator-label-convert-to-table-tooltip = Convert to Table
graphing-calculator-label-create-table = Create Table
graphing-calculator-label-depressed = Depressed
graphing-calculator-label-disable-graph-interactions = Disable Graph Interactions
graphing-calculator-label-disable-zoom = Disable zooming
graphing-calculator-label-display-properties = Local Display Preferences
graphing-calculator-label-drop-image-here = Drop Image Here
graphing-calculator-label-duplicate-expression-tooltip = Duplicate
graphing-calculator-label-edit-graph-bounds = Graph Bounds
graphing-calculator-label-edit-list-tooltip = Edit List
graphing-calculator-label-evaluation-list = { $count } element list
graphing-calculator-label-example-graph-3d-world = 3D World
graphing-calculator-label-example-graph-calculus-derivatives = Calculus: Derivatives
graphing-calculator-label-example-graph-calculus-fundamental-theorem-of-calculus = Calculus: Fundamental Theorem of Calculus
graphing-calculator-label-example-graph-calculus-integral-with-adjustable-bounds = Calculus: Integral with adjustable bounds
graphing-calculator-label-example-graph-calculus-integrals = Calculus: Integrals
graphing-calculator-label-example-graph-calculus-secant-line = Calculus: Secant Line
graphing-calculator-label-example-graph-calculus-tangent-line = Calculus: Tangent Line
graphing-calculator-label-example-graph-calculus-taylor-expansion-of-sin-x = Calculus: Taylor Expansion of sin(x)
graphing-calculator-label-example-graph-checkerboard-inversion = Checkerboard Inversion
graphing-calculator-label-example-graph-conic-sections-circle = Conic Sections: Circle
graphing-calculator-label-example-graph-conic-sections-ellipse-with-foci = Conic Sections: Ellipse with Foci
graphing-calculator-label-example-graph-conic-sections-hyperbola = Conic Sections: Hyperbola
graphing-calculator-label-example-graph-conic-sections-parabola-and-focus = Conic Sections: Parabola and Focus
graphing-calculator-label-example-graph-fastest-path-to-a-point = Fastest Path to a Point
graphing-calculator-label-example-graph-fireworks = Fireworks!
graphing-calculator-label-example-graph-fractal-valentine = Fractal Valentine
graphing-calculator-label-example-graph-lines-point-slope-form = Lines: Point Slope Form
graphing-calculator-label-example-graph-lines-slope-intercept-form = Lines: Slope Intercept Form
graphing-calculator-label-example-graph-lines-two-point-form = Lines: Two Point Form
graphing-calculator-label-example-graph-lists-curve-stitching = Lists: Curve Stitching
graphing-calculator-label-example-graph-lists-family-of-sin-curves = Lists: Family of sin Curves
graphing-calculator-label-example-graph-lists-plotting-a-list-of-points = Lists: Plotting a List of Points
graphing-calculator-label-example-graph-outstretched-arm = Outstretched Arm
graphing-calculator-label-example-graph-pac-man = Pac Man
graphing-calculator-label-example-graph-parabolas-standard-form = Parabolas: Standard Form
graphing-calculator-label-example-graph-parabolas-standard-form-plus-tangent = Parabolas: Standard Form + Tangent
graphing-calculator-label-example-graph-parabolas-vertex-form = Parabolas: Vertex Form
graphing-calculator-label-example-graph-parametric-cycloid = Parametric: Cycloid
graphing-calculator-label-example-graph-parametric-introduction = Parametric: Introduction
graphing-calculator-label-example-graph-polar-conic-sections = Polar: Conic Sections
graphing-calculator-label-example-graph-polar-limacon = Polar: Limacon
graphing-calculator-label-example-graph-polar-logarithmic-spiral = Polar: Logarithmic Spiral
graphing-calculator-label-example-graph-polar-rose = Polar: Rose
graphing-calculator-label-example-graph-pride-flag = PRIDE flag
graphing-calculator-label-example-graph-regular-sine-wave = Regular Sine Wave?
graphing-calculator-label-example-graph-stats-anscombes-quartet = Statistics: Anscombe's Quartet
graphing-calculator-label-example-graph-stats-fourth-order-polynomial = Statistics: 4th Order Polynomial
graphing-calculator-label-example-graph-stats-linear-regression = Statistics: Linear Regression
graphing-calculator-label-example-graph-transformations-inverse-of-a-function = Transformations: Inverse of a Function
graphing-calculator-label-example-graph-transformations-scaling-a-function = Transformations: Scaling a Function
graphing-calculator-label-example-graph-transformations-translating-a-function = Transformations: Translating a Function
graphing-calculator-label-example-graph-trig-period-and-amplitude = Trigonometry: Period and Amplitude
graphing-calculator-label-example-graph-trig-phase = Trigonometry: Phase
graphing-calculator-label-example-graph-trig-unit-circle = Trigonometry: Unit Circle
graphing-calculator-label-example-graph-trig-wave-interference = Trigonometry: Wave Interference
graphing-calculator-label-expression-delete-tooltip = Delete
graphing-calculator-label-expression-lowercase = expression
graphing-calculator-label-extend-to-3d = Extend to 3D
graphing-calculator-label-folder-lowercase = folder
graphing-calculator-label-geometry-dilation-by-point = Dilate at <parent1/> by <parent2/>
graphing-calculator-label-geometry-move-to-folder-placeholder = Folder name
graphing-calculator-label-geometry-reflection-over-point = Reflect over <parent1/>
graphing-calculator-label-geometry-rotation-around-point-by-angle = Rotate around <parent1/> by <parent2/>
graphing-calculator-label-geometry-tools = Geometry Tools
graphing-calculator-label-geometry-tools-dropdown-menu-angle = Angle tools
graphing-calculator-label-geometry-tools-dropdown-menu-circle = Circle tools
graphing-calculator-label-geometry-tools-dropdown-menu-line = Line tools
graphing-calculator-label-geometry-tools-dropdown-menu-point = Point tools
graphing-calculator-label-geometry-tools-dropdown-menu-polygon = Polygon tools
graphing-calculator-label-geometry-tools-dropdown-menu-selection = Selection tools
graphing-calculator-label-geometry-tools-dropdown-menu-transformation = Transformation tools
graphing-calculator-label-geometry-tools-open-dropdown-menu-transformation = Open { $item } menu
graphing-calculator-label-geometry-translation-by-two-points = Translate from <parent1/> to <parent2/>
graphing-calculator-label-geometry-translation-by-vector = Translate by <parent1/>
graphing-calculator-label-hide-expression-list-tooltip = Hide Expression List
graphing-calculator-label-hide-keypad = Hide Keypad
graphing-calculator-label-hovered = Hovered
graphing-calculator-label-image-angle = Angle:
graphing-calculator-label-image-center = Center:
graphing-calculator-label-image-height = Height:
graphing-calculator-label-image-lowercase = image
graphing-calculator-label-image-opacity = Opacity:
graphing-calculator-label-image-width = Width:
graphing-calculator-label-label-size-tooltip = Label Scale Factor
graphing-calculator-label-line-thickness-3d-tooltip = Line Thickness
graphing-calculator-label-line-thickness-tooltip = Line Thickness (px)
graphing-calculator-label-list-index = Use <1>index</1> to reference the clicked index in the list.
graphing-calculator-label-lock-expression-tooltip = Prevent Editing
graphing-calculator-label-more-viewport-options = More Options
graphing-calculator-label-note-lowercase = note
graphing-calculator-label-opacity-tooltip = Opacity (0 to 1)
graphing-calculator-label-open-graph-tooltip = Open Graph
graphing-calculator-label-open-graph-with-shortcut-tooltip = Open Graph (CTRL+O)
graphing-calculator-label-png = PNG
graphing-calculator-label-poi-unknown-coordinates = unknown coordinates
graphing-calculator-label-point-size-3d-tooltip = Point Size
graphing-calculator-label-point-size-tooltip = Point Size (px)
graphing-calculator-label-randomize-tooltip = Randomize
graphing-calculator-label-recent-transformations = Recent Transformations
graphing-calculator-label-recenter = Center Origin
graphing-calculator-label-redo-tooltip = Redo
graphing-calculator-label-redo-with-shortcut-tooltip = Redo (CTRL+Y)
graphing-calculator-label-reference-count =
    { $count ->
        [one] (1 reference)
       *[other] ({ $count } references)
    }
graphing-calculator-label-reference-count-in-folder =
    { $count ->
        [one] (1 reference in folder)
       *[other] ({ $count } references in folder)
    }
graphing-calculator-label-regression-log-mode-help-tooltip = Log mode help
graphing-calculator-label-regression-parameters-not-exact = Parameters might not be exact. Click to learn more.
graphing-calculator-label-regression-what-is-rmse-tooltip = What is RMSE? Click to learn more.
graphing-calculator-label-regression-why-is-negative-tooltip = Why is this negative? Click to learn more.
graphing-calculator-label-remove-depressed-image = Remove depressed image
graphing-calculator-label-remove-hovered-image = Remove hovered image
graphing-calculator-label-rename = rename
graphing-calculator-label-resolution-tooltip = 3D Grid Sample Resolution
graphing-calculator-label-search-expressions = Search this graph
graphing-calculator-label-settings-3d-perspective-distortion-ratio = Perspective Distortion Ratio
graphing-calculator-label-settings-3d-perspective-max = Most distortion (Perspective view)
graphing-calculator-label-settings-3d-perspective-min = No distortion (Orthographic view)
graphing-calculator-label-settings-all-axes = All axes:
graphing-calculator-label-settings-arrows = Arrows
graphing-calculator-label-settings-axis-labels-3d = Labels
graphing-calculator-label-settings-axis-numbers = Axis Numbers
graphing-calculator-label-settings-complex-mode = Complex Mode
graphing-calculator-label-settings-domain-plane = XY plane
graphing-calculator-label-settings-grid = Grid
graphing-calculator-label-settings-hidden-objects = Reveal { $count } hidden objects
graphing-calculator-label-settings-lock-viewport = Lock Viewport
graphing-calculator-label-settings-minor-gridlines = Minor Gridlines
graphing-calculator-label-settings-numbers-3d = Numbers
graphing-calculator-label-settings-one-quadrant = One Quadrant
graphing-calculator-label-settings-reverse-contrast = Reverse contrast
graphing-calculator-label-settings-six-key-braille = Six Key Braille Input
graphing-calculator-label-settings-step = Step:
graphing-calculator-label-settings-translucent-surfaces = Translucent surfaces
graphing-calculator-label-settings-x-axis = X-Axis
graphing-calculator-label-settings-y-axis = Y-Axis
graphing-calculator-label-show-keypad = Show Keypad
graphing-calculator-label-slider-disabled-while-ticker-playing = Sliders are disabled while the ticker is running.
graphing-calculator-label-slider-step = Step:
graphing-calculator-label-stats-first-quartile = Q1
graphing-calculator-label-stats-maximum = Max
graphing-calculator-label-stats-median = Median
graphing-calculator-label-stats-minimum = Min
graphing-calculator-label-stats-third-quartile = Q3
graphing-calculator-label-svg = SVG
graphing-calculator-label-table-lowercase = table
graphing-calculator-label-table-regression-type-cubic = Cubic Regression
graphing-calculator-label-table-regression-type-exponential = Exponential Regression
graphing-calculator-label-table-regression-type-linear = Linear Regression
graphing-calculator-label-table-regression-type-logarithmic = Logarithmic Regression
graphing-calculator-label-table-regression-type-logistic = Logistic Regression
graphing-calculator-label-table-regression-type-power = Power Regression
graphing-calculator-label-table-regression-type-quadratic = Quadratic Regression
graphing-calculator-label-table-regression-type-quartic = Quartic Regression
graphing-calculator-label-table-regression-type-sinusoidal = Sinusoidal Regression
graphing-calculator-label-ticker-close = cancel
graphing-calculator-label-ticker-help-tooltip = On slow computers, this might run slower. Use local variable "dt" to capture the actual update speed.
graphing-calculator-label-ticker-lowercase = ticker
graphing-calculator-label-ticker-min-step = Min Step Time
graphing-calculator-label-ticker-pause = pause
graphing-calculator-label-ticker-play = play
graphing-calculator-label-tooltip-geometry-settings = Geometry Settings
graphing-calculator-label-tooltip-graph-settings = Graph Settings
graphing-calculator-label-tooltip-open-graph = Open Graph
graphing-calculator-label-tooltip-reset = Reset
graphing-calculator-label-tooltip-show-list = Show List
graphing-calculator-label-tooltip-viewport-default = Default Viewport
graphing-calculator-label-tooltip-zoom-default-orientation = Default Orientation
graphing-calculator-label-tooltip-zoom-in = Zoom In
graphing-calculator-label-tooltip-zoom-out = Zoom Out
graphing-calculator-label-tooltip-zoom-xy-orientation = XY Orientation
graphing-calculator-label-undo-tooltip = Undo
graphing-calculator-label-undo-with-shortcut-tooltip = Undo (CTRL+Z)
graphing-calculator-label-unlock-expression-tooltip = Allow Editing
graphing-calculator-label-update-on-click = On click:
graphing-calculator-label-update-to-new-behavior = Update to new behavior
graphing-calculator-link-edit-on-kiavash = edit graph on
graphing-calculator-link-learn-more = Learn more.
graphing-calculator-link-view-braille-examples = View examples
graphing-calculator-narration-3d-graphpaper-label = three-dimensional graph paper
graphing-calculator-narration-3d-orientation-options-label = Orientation
graphing-calculator-narration-3d-rotate-down = Tilt forward.
graphing-calculator-narration-3d-rotate-left = Rotate left.
graphing-calculator-narration-3d-rotate-right = Rotate right.
graphing-calculator-narration-3d-rotate-up = Tilt backward.
graphing-calculator-narration-3d-rotation-speed = Speed { $speed } \xB0 per second
graphing-calculator-narration-3d-rotation-stopped = Stopped.
graphing-calculator-narration-add-base-case-prompt =
    { $count ->
        [one] Add 1 base case
       *[other] Add { $count } base cases
    }
graphing-calculator-narration-add-expression = Add expression
graphing-calculator-narration-add-folder = Add folder
graphing-calculator-narration-add-image = Add image
graphing-calculator-narration-add-item-menu = Add Item Menu
graphing-calculator-narration-add-note = Add note
graphing-calculator-narration-add-slider-prompt = Add slider for { $vars }
graphing-calculator-narration-add-table = Add table
graphing-calculator-narration-add-ticker = Add Ticker
graphing-calculator-narration-all-folders-collapsed = all folders collapsed
graphing-calculator-narration-all-folders-expanded = all folders expanded
graphing-calculator-narration-audio-instructions-enter-audio-trace-mac = Press OPTION+T for audio trace.
graphing-calculator-narration-audio-instructions-enter-audio-trace-windows = Press ALT+T for audio trace.
graphing-calculator-narration-audio-trace-branch-not-found = Branch { $branch } does not exist.
graphing-calculator-narration-audio-trace-cannot-change-slider-value = Unable to adjust slider
graphing-calculator-narration-audio-trace-description-branch-count = Branches: { $branches }.
graphing-calculator-narration-audio-trace-description-color = Color: { $color }.
graphing-calculator-narration-audio-trace-description-multiple-extrema = { $count } extrema.
graphing-calculator-narration-audio-trace-description-multiple-intercepts = { $count } intercepts.
graphing-calculator-narration-audio-trace-description-multiple-intersections = { $count } intersections.
graphing-calculator-narration-audio-trace-description-multiple-labels = { $count } point labels.
graphing-calculator-narration-audio-trace-description-multiple-roots = { $count } zero crossings.
graphing-calculator-narration-audio-trace-description-no-curve-selected = No curve selected.
graphing-calculator-narration-audio-trace-description-one-extremum = 1 extremum.
graphing-calculator-narration-audio-trace-description-one-intercept = 1 intercept.
graphing-calculator-narration-audio-trace-description-one-intersection = 1 intersection.
graphing-calculator-narration-audio-trace-description-one-label = 1 point label.
graphing-calculator-narration-audio-trace-description-one-root = 1 zero crossing.
graphing-calculator-narration-audio-trace-description-shading-above = Shading above.
graphing-calculator-narration-audio-trace-description-shading-below = Shading below.
graphing-calculator-narration-audio-trace-description-shading-in-regions = Shading in regions.
graphing-calculator-narration-audio-trace-description-shading-left = Shading on the left.
graphing-calculator-narration-audio-trace-description-shading-right = Shading on the right.
graphing-calculator-narration-audio-trace-description-visible-grid = Grid lines are visible.
graphing-calculator-narration-audio-trace-description-visible-x-axis = X axis visible.
graphing-calculator-narration-audio-trace-description-visible-x-axis-and-label = X axis visible and is labeled { $label }.
graphing-calculator-narration-audio-trace-description-visible-x-axis-range = X axis visible from { $xmin } to { $xmax }.
graphing-calculator-narration-audio-trace-description-visible-x-axis-range-and-label = X axis visible from { $xmin } to { $xmax } and is labeled { $label }.
graphing-calculator-narration-audio-trace-description-visible-xyz-axis-range = X Y and Z axes visible from { $xmin } to { $xmax }.
graphing-calculator-narration-audio-trace-description-visible-y-axis = Y axis visible.
graphing-calculator-narration-audio-trace-description-visible-y-axis-and-label = Y axis visible and is labeled { $label }.
graphing-calculator-narration-audio-trace-description-visible-y-axis-range = Y axis visible from { $ymin } to { $ymax }.
graphing-calculator-narration-audio-trace-description-visible-y-axis-range-and-label = Y axis visible from { $ymin } to { $ymax } and is labeled { $label }.
graphing-calculator-narration-audio-trace-description-visible-z-axis = Z axis visible.
graphing-calculator-narration-audio-trace-description-visible-z-axis-and-label = Z axis visible and is labeled { $label }.
graphing-calculator-narration-audio-trace-description-visible-z-axis-range = Z axis visible from { $zmin } to { $zmax }.
graphing-calculator-narration-audio-trace-description-visible-z-axis-range-and-label = Z axis visible from { $zmin } to { $zmax } and is labeled { $label }.
graphing-calculator-narration-audio-trace-expression-with-column = Expression { $index } column { $column }
graphing-calculator-narration-audio-trace-first-point = First point
graphing-calculator-narration-audio-trace-first-slider = First slider.
graphing-calculator-narration-audio-trace-instructions-disable-mac = To disable audio trace, press OPTION+T.
graphing-calculator-narration-audio-trace-instructions-disable-windows = To disable audio trace, press ALT+T.
graphing-calculator-narration-audio-trace-instructions-expression-navigation-mac = To move between expressions, press COMMAND+Up-Arrow or COMMAND+Down-Arrow.
graphing-calculator-narration-audio-trace-instructions-expression-navigation-windows = To move between expressions, press ALT+Up-Arrow or ALT+Down-Arrow.
graphing-calculator-narration-audio-trace-instructions-hear-graph = To hear the graph, press H.
graphing-calculator-narration-audio-trace-instructions-use-arrow-keys = Use Arrow keys to navigate.
graphing-calculator-narration-audio-trace-last-point = Last point
graphing-calculator-narration-audio-trace-last-slider = Last slider.
graphing-calculator-narration-audio-trace-multiple-sliders-paused = { $sliders } animating sliders were paused.
graphing-calculator-narration-audio-trace-no-more-pois = No more points of interest
graphing-calculator-narration-audio-trace-no-sliders-paused = No animating sliders were paused.
graphing-calculator-narration-audio-trace-one-slider-paused = One animating slider was paused.
graphing-calculator-narration-audio-trace-playback-speed = Graph playback speed { $speed }
graphing-calculator-narration-audio-trace-poi-count = Points of interest, { $x }.
graphing-calculator-narration-audio-trace-point-type-definition = Definition
graphing-calculator-narration-audio-trace-point-type-extremum = Extremum
graphing-calculator-narration-audio-trace-point-type-intercept = Intercept
graphing-calculator-narration-audio-trace-point-type-intersection = Intersection
graphing-calculator-narration-audio-trace-point-type-intersection-with-curves = Intersection with { $curves }
graphing-calculator-narration-audio-trace-point-type-label = Label
graphing-calculator-narration-audio-trace-point-type-not-a-poi = Not a P O I
graphing-calculator-narration-audio-trace-point-type-root = Zero
graphing-calculator-narration-audio-trace-point-type-trace = Trace
graphing-calculator-narration-audio-trace-property-branch-number = Branch { $branch }.
graphing-calculator-narration-audio-trace-property-type-before-coordinates = { $type } at
graphing-calculator-narration-audio-trace-property-x = X: { $x }.
graphing-calculator-narration-audio-trace-property-y = Y: { $y }.
graphing-calculator-narration-audio-trace-slider-value-unknown = Unable to determine slider value
graphing-calculator-narration-audio-trace-sound-effects-disabled = Sound effects have been disabled.
graphing-calculator-narration-audio-trace-traceable-curves =
    { $sketchCount ->
        [one] 1 audio traceable curve.
       *[other] { $sketchCount } audio traceable curves.
    }
graphing-calculator-narration-audio-trace-tracing-different-expression = Tracing { $expression }.
graphing-calculator-narration-audio-trace-unable-to-play = Unable to play audio.
graphing-calculator-narration-audio-trace-unable-to-trace-this-expression = Unable to audio trace this expression.
graphing-calculator-narration-audio-trace-unsupported-expression = { $expression } cannot be audio traced.
graphing-calculator-narration-audio-trace-volume = Volume { $volume } percent
graphing-calculator-narration-cdf-maximum = Max
graphing-calculator-narration-cdf-minimum = Min
graphing-calculator-narration-click-action = Click Action
graphing-calculator-narration-clickable-image-options = Clickable Image Options
graphing-calculator-narration-collapse = Collapse
graphing-calculator-narration-collapse-folder-index = Collapse Folder { $index }
graphing-calculator-narration-collapse-folder-title = Collapse { $folder } folder
graphing-calculator-narration-color-picker-custom-colors-label = Custom
graphing-calculator-narration-color-picker-label = Color Picker
graphing-calculator-narration-color-picker-standard-colors-label = Standard
graphing-calculator-narration-color-unknown = unknown
graphing-calculator-narration-computed-cell-role-description = computed cell
graphing-calculator-narration-configure-toolbar = Geometry Toolbar Configuration
graphing-calculator-narration-create-table = Create Table
graphing-calculator-narration-create-table-expression = Create Table from Expression { $index }
graphing-calculator-narration-create-table-secret-expression = Create Table from Secret Expression { $index }
graphing-calculator-narration-delete = Delete
graphing-calculator-narration-delete-expression = Delete Expression { $index }
graphing-calculator-narration-delete-folder-index = Delete Folder { $index }
graphing-calculator-narration-delete-folder-title = Delete { $folder } folder
graphing-calculator-narration-delete-image = Delete Image { $index }
graphing-calculator-narration-delete-secret-expression = Delete Secret Expression { $index }
graphing-calculator-narration-delete-table = Delete Table { $index }
graphing-calculator-narration-delete-text = Delete Note { $index }
graphing-calculator-narration-describe = Unknown object
graphing-calculator-narration-describe-expression = Expression { $index }
graphing-calculator-narration-describe-folder-index = Folder { $index }
graphing-calculator-narration-describe-folder-title = { $folder } folder
graphing-calculator-narration-describe-image = Image { $index }
graphing-calculator-narration-describe-secret-expression = Secret expression { $index }
graphing-calculator-narration-describe-table = Table { $index }
graphing-calculator-narration-describe-text = Note { $index }
graphing-calculator-narration-description-collapsed-folder = Collapsed Folder
graphing-calculator-narration-description-collapsed-readonly-folder = Collapsed Locked Folder
graphing-calculator-narration-description-collapsed-secret-folder = Collapsed Secret Folder
graphing-calculator-narration-description-collapsed-secret-readonly-folder = Collapsed Secret Locked Folder
graphing-calculator-narration-description-folder = Folder
graphing-calculator-narration-description-hidden-collapsed-folder = Hidden Collapsed Folder
graphing-calculator-narration-description-hidden-collapsed-readonly-folder = Hidden Collapsed Locked Folder
graphing-calculator-narration-description-hidden-collapsed-secret-folder = Hidden Collapsed Secret Folder
graphing-calculator-narration-description-hidden-collapsed-secret-readonly-folder = Hidden Collapsed Secret Locked Folder
graphing-calculator-narration-description-hidden-folder = Hidden Folder
graphing-calculator-narration-description-hidden-readonly-folder = Hidden Locked Folder
graphing-calculator-narration-description-hidden-secret-folder = Hidden Secret Folder
graphing-calculator-narration-description-hidden-secret-readonly-folder = Hidden Secret Locked Folder
graphing-calculator-narration-description-readonly-folder = Locked Folder
graphing-calculator-narration-description-secret-folder = Secret Folder
graphing-calculator-narration-description-secret-readonly-folder = Secret Locked Folder
graphing-calculator-narration-dist-tab-distributions = Distributions
graphing-calculator-narration-dist-tab-visualizations = Visualizations
graphing-calculator-narration-domain3d-maximum = domain { $term } Maximum:
graphing-calculator-narration-domain3d-minimum = domain { $term } Minimum:
graphing-calculator-narration-drag-mode-x = X
graphing-calculator-narration-drag-mode-xy = X and Y
graphing-calculator-narration-drag-mode-y = Y
graphing-calculator-narration-draggable-image-off-screen-prompt = { " " }not completely visible on screen
graphing-calculator-narration-duplicate = Duplicate
graphing-calculator-narration-duplicate-expression = Duplicate Expression { $index }
graphing-calculator-narration-duplicate-folder-index = Duplicate Folder { $index }
graphing-calculator-narration-duplicate-folder-title = Duplicate { $folder } folder
graphing-calculator-narration-duplicate-image = Duplicate Image { $index }
graphing-calculator-narration-duplicate-secret-expression = Duplicate Secret Expression { $index }
graphing-calculator-narration-duplicate-table = Duplicate Table { $index }
graphing-calculator-narration-duplicate-text = Duplicate Note { $index }
graphing-calculator-narration-edit-action = Edit Action
graphing-calculator-narration-edit-expression-list = Edit Expression List
graphing-calculator-narration-edit-folder-title = Edit Folder { $index } Title
graphing-calculator-narration-edit-graph-on-kiavash = Edit graph on kiavash
graphing-calculator-narration-edit-image-title = Edit Image { $index } Title
graphing-calculator-narration-edit-list-mode-off = Edit list mode off.
graphing-calculator-narration-edit-list-mode-on = Edit list mode on.
graphing-calculator-narration-edit-on-kiavash = Edit graph on kiavash
graphing-calculator-narration-edit-slider-variable-limits = Edit { $variable } Limits
graphing-calculator-narration-edit-text-title = Note { $index }
graphing-calculator-narration-edit-title = Edit Title
graphing-calculator-narration-editable-label-mode = Editable label mode
graphing-calculator-narration-editable-point-label = Editable point label
graphing-calculator-narration-expand = Expand
graphing-calculator-narration-expand-folder-index = Expand Folder { $index }
graphing-calculator-narration-expand-folder-title = Expand { $folder } folder
graphing-calculator-narration-expression-audio-trace-mac = To audio trace, press OPTION+T.
graphing-calculator-narration-expression-audio-trace-windows = To audio trace, press ALT+T.
graphing-calculator-narration-expression-bar = Expression Bar
graphing-calculator-narration-expression-evaluation-has-graph = Has graph.
graphing-calculator-narration-expression-evaluation-has-graph-and-regression = Has graph and regression. To access statistics, press Tab.
graphing-calculator-narration-expression-evaluation-has-regression = Has regression. To access statistics, press Tab.
graphing-calculator-narration-expression-evaluation-is-distribution = is distribution.
graphing-calculator-narration-expression-evaluation-is-t-test = is T test. To access statistics, press Tab.
graphing-calculator-narration-expression-hidden-label = Hidden { $label }
graphing-calculator-narration-expression-index-table = Expression { $index } table
graphing-calculator-narration-expression-label = Label
graphing-calculator-narration-expression-tone-muted = Muted tone.
graphing-calculator-narration-expression-tone-unmuted = Unmuted tone.
graphing-calculator-narration-fill-opacity = Fill Opacity:
graphing-calculator-narration-fill-visible = Fill visible
graphing-calculator-narration-folder-collapsed = folder collapsed
graphing-calculator-narration-folder-expanded = folder expanded
graphing-calculator-narration-folder-has-items = { $folder } has { $count } items
graphing-calculator-narration-functions = Functions
graphing-calculator-narration-geometry-added-object-type = Added { $type }.
graphing-calculator-narration-geometry-added-object-type-and-point = Added { $type } and 1 point.
graphing-calculator-narration-geometry-added-object-type-and-points = Added { $type } and { $points } points.
graphing-calculator-narration-geometry-added-points = Added { $points } points.
graphing-calculator-narration-geometry-angle-of-polygon = { $itemDescription } of { $parent }
graphing-calculator-narration-geometry-angle-through-points = { $itemDescription } through { $parent1 }, { $parent2 }, and { $parent3 }
graphing-calculator-narration-geometry-anglebisector-of-item = { $bisectorDescription }, bisector of { $item }
graphing-calculator-narration-geometry-arc-through-points = Arc { $index } starting at { $start }. Middle at { $middle }. End at { $end }.
graphing-calculator-narration-geometry-circle-with-center-and-radius = Circle { $index } with center at { $center } and radius { $radius }.
graphing-calculator-narration-geometry-construct-menu = Construct
graphing-calculator-narration-geometry-construction-icon-label = Token Count
graphing-calculator-narration-geometry-construction-role-description = construction
graphing-calculator-narration-geometry-dilated-item = dilated { $item }
graphing-calculator-narration-geometry-edge-of-polygon = Edge { $polygonEdge } of { $item }
graphing-calculator-narration-geometry-glider-on-item = { $gliderDescription } on { $item }
graphing-calculator-narration-geometry-glider-with-assignment = Glider { $assignment }
graphing-calculator-narration-geometry-hidden-construction-description = Hidden { $description }
graphing-calculator-narration-geometry-hidden-line = Hidden line
graphing-calculator-narration-geometry-hidden-parallel = Hidden parrallel
graphing-calculator-narration-geometry-hidden-perpendicular = Hidden perpendicular
graphing-calculator-narration-geometry-hidden-ray = Hidden ray
graphing-calculator-narration-geometry-hidden-segment = Hidden segment
graphing-calculator-narration-geometry-hidden-vector = Hidden vector
graphing-calculator-narration-geometry-intersection-of-items = { $intersectionDescription } of { $item1 } and { $item2 }
graphing-calculator-narration-geometry-intersection-with-assignment = Intersection { $assignment }
graphing-calculator-narration-geometry-item-at-coordinates-to-coordinates = { $itemDescription } from { $x1 } { $y1 } to { $x2 } { $y2 }
graphing-calculator-narration-geometry-label-options = Label Options
graphing-calculator-narration-geometry-labeled-angle = Angle { $label }
graphing-calculator-narration-geometry-labeled-directed-angle = Directed Angle { $label }
graphing-calculator-narration-geometry-list-of-angles = List of { $count } angles
graphing-calculator-narration-geometry-list-of-any = List of { $count } unknown objects
graphing-calculator-narration-geometry-list-of-arcs = List of { $count } arcs
graphing-calculator-narration-geometry-list-of-circles = List of { $count } circles
graphing-calculator-narration-geometry-list-of-directed-angles = List of { $count } directed angles
graphing-calculator-narration-geometry-list-of-lines = List of { $count } lines
graphing-calculator-narration-geometry-list-of-points = List of { $count } points
graphing-calculator-narration-geometry-list-of-polygons = List of { $count } polygons
graphing-calculator-narration-geometry-list-of-rays = List of { $count } rays
graphing-calculator-narration-geometry-list-of-segments = List of { $count } segments
graphing-calculator-narration-geometry-midpoint-of-item = { $midpointDescription } of { $item }
graphing-calculator-narration-geometry-midpoint-with-assignment = Midpoint { $assignment }
graphing-calculator-narration-geometry-moved-to-coordinates = Moved to x: { $x }, y: { $y }.
graphing-calculator-narration-geometry-near-item = Near { $item }.
graphing-calculator-narration-geometry-no-tool-inputs = No inputs exist
graphing-calculator-narration-geometry-nothing-selected = Nothing selected.
graphing-calculator-narration-geometry-parallel-to-line-through-point = Parallel line { $index } to { $line }, passing through { $point }
graphing-calculator-narration-geometry-perpendicular-to-line-through-point = Perpedicular line { $index } to { $line }, passing through { $point }
graphing-calculator-narration-geometry-point-with-assignment = Point { $assignment }
graphing-calculator-narration-geometry-polygon-through-vertices = { $itemDescription } through vertices { $vertices }
graphing-calculator-narration-geometry-reflected-item = reflected { $item }
graphing-calculator-narration-geometry-rotated-item = rotated { $item }
graphing-calculator-narration-geometry-segment-length = { $segmentDescription } with length { $length }
graphing-calculator-narration-geometry-segment-with-assignment = Segment { $assignment }
graphing-calculator-narration-geometry-straight-from-item-to-item = { $straightType } from { $start } to { $end }
graphing-calculator-narration-geometry-straight-index-of-item = { $straightType } { $index } of { $item }
graphing-calculator-narration-geometry-style-menu = Style
graphing-calculator-narration-geometry-token-navigator-depth = Depth: { $depth }
graphing-calculator-narration-geometry-token-navigator-label = Token Navigator
graphing-calculator-narration-geometry-tool-cancelled = Cancelled.
graphing-calculator-narration-geometry-tool-disabled = The { $tool } tool is disabled.
graphing-calculator-narration-geometry-transformed-item = transformed { $item }
graphing-calculator-narration-geometry-translated-item = translated { $item }
graphing-calculator-narration-geometry-unable-to-move = Unable to move.
graphing-calculator-narration-geometry-unlabeled-angle = Angle { $index }
graphing-calculator-narration-geometry-unlabeled-angle-with-measurement = { $measurementText } Angle { $index }
graphing-calculator-narration-geometry-unlabeled-arc = Arc { $index }
graphing-calculator-narration-geometry-unlabeled-circle = Circle { $index }
graphing-calculator-narration-geometry-unlabeled-decagon = Decagon { $index }
graphing-calculator-narration-geometry-unlabeled-directed-angle = Directed Angle { $index }
graphing-calculator-narration-geometry-unlabeled-directed-angle-with-measurement = { $measurementText } Directed Angle { $index }
graphing-calculator-narration-geometry-unlabeled-glider = Glider { $index }
graphing-calculator-narration-geometry-unlabeled-heptagon = Heptagon { $index }
graphing-calculator-narration-geometry-unlabeled-hexagon = Hexagon { $index }
graphing-calculator-narration-geometry-unlabeled-intersection = Intersection { $index }
graphing-calculator-narration-geometry-unlabeled-line = Line
graphing-calculator-narration-geometry-unlabeled-line-with-index = Line { $index }
graphing-calculator-narration-geometry-unlabeled-midpoint = Midpoint { $index }
graphing-calculator-narration-geometry-unlabeled-nonagon = Nonagon { $index }
graphing-calculator-narration-geometry-unlabeled-octagon = Octagon { $index }
graphing-calculator-narration-geometry-unlabeled-parallel = Parallel line
graphing-calculator-narration-geometry-unlabeled-parallel-with-index = Parallel line { $index }
graphing-calculator-narration-geometry-unlabeled-pentagon = Pentagon { $index }
graphing-calculator-narration-geometry-unlabeled-perpendicular = Perpendicular line
graphing-calculator-narration-geometry-unlabeled-perpendicular-with-index = Perpendicular line { $index }
graphing-calculator-narration-geometry-unlabeled-point = Point { $index }
graphing-calculator-narration-geometry-unlabeled-polygon = Polygon { $index } with { $sideCount } sides
graphing-calculator-narration-geometry-unlabeled-quadrilateral = Quadrilateral { $index }
graphing-calculator-narration-geometry-unlabeled-ray = Ray
graphing-calculator-narration-geometry-unlabeled-ray-with-index = Ray { $index }
graphing-calculator-narration-geometry-unlabeled-segment = Segment
graphing-calculator-narration-geometry-unlabeled-segment-with-index = Segment { $index }
graphing-calculator-narration-geometry-unlabeled-triangle = Triangle { $index }
graphing-calculator-narration-geometry-unlabeled-vector = Vector
graphing-calculator-narration-geometry-unlabeled-vector-with-index = Vector { $index }
graphing-calculator-narration-graph-settings-controls = Graph Settings Controls
graphing-calculator-narration-graphpaper-label = graph paper
graphing-calculator-narration-hide = Hide
graphing-calculator-narration-hide-animation-properties = Hide Animation Properties
graphing-calculator-narration-hide-expression = Hide Expression { $index }
graphing-calculator-narration-hide-expression-list = Hide expression list
graphing-calculator-narration-hide-folder-index = Hide Folder { $index }
graphing-calculator-narration-hide-folder-title = Hide { $folder } folder
graphing-calculator-narration-hide-image = Hide Image { $index }
graphing-calculator-narration-hide-options = Hide Options
graphing-calculator-narration-hide-options-expression = Hide Options for Expression { $index }
graphing-calculator-narration-hide-options-image = Hide Options for Image { $index }
graphing-calculator-narration-hide-options-secret-expression = Hide Options for Secret Expression { $index }
graphing-calculator-narration-hide-secret-expression = Hide Secret Expression { $index }
graphing-calculator-narration-hide-table = Hide Table { $index }
graphing-calculator-narration-hide-table-column = Hide Column
graphing-calculator-narration-hide-table-regression = Hide Regression
graphing-calculator-narration-hide-text = Hide Note { $index }
graphing-calculator-narration-image-styles = Styles
graphing-calculator-narration-item-at-coordinates = { $itemDescription } at { $coordinates }
graphing-calculator-narration-item-hidden = Item hidden.
graphing-calculator-narration-item-visible = Item visible.
graphing-calculator-narration-item-with-list-index = index { $listIndex } of { $item }
graphing-calculator-narration-items-deleted =
    { $count ->
        [one] { $count } item deleted.
       *[other] { $count } items deleted.
    }
graphing-calculator-narration-keypad-hidden = Keypad hidden
graphing-calculator-narration-keypad-key-next-curve = Next Curve
graphing-calculator-narration-keypad-key-next-poi = Next Point of Interest
graphing-calculator-narration-keypad-key-next-point = Next Point
graphing-calculator-narration-keypad-key-previous-curve = Previous Curve
graphing-calculator-narration-keypad-key-previous-poi = Previous Point of Interest
graphing-calculator-narration-keypad-key-previous-point = Previous Point
graphing-calculator-narration-keypad-key-speed-down = Speed Down
graphing-calculator-narration-keypad-key-speed-up = Speed Up
graphing-calculator-narration-keypad-key-volume-down = Volume Down
graphing-calculator-narration-keypad-key-volume-up = Volume Up
graphing-calculator-narration-keypad-visible = Keypad visible
graphing-calculator-narration-label-angle = Label Angle:
graphing-calculator-narration-label-menu = Label
graphing-calculator-narration-label-size = Label Size:
graphing-calculator-narration-label-text = Label Text
graphing-calculator-narration-label-visible = Label visible
graphing-calculator-narration-line-opacity = Line Opacity:
graphing-calculator-narration-line-style-dashed = Dashed
graphing-calculator-narration-line-style-dotted = Dotted
graphing-calculator-narration-line-style-solid = Solid
graphing-calculator-narration-lines-visible = Lines visible
graphing-calculator-narration-locked-items-not-deleted =
    { $count ->
        [one] { $count } locked item could not be deleted.
       *[other] { $count } locked items could not be deleted.
    }
graphing-calculator-narration-main-kiavash-geometry = kiavash Geometry
graphing-calculator-narration-main-kiavash-graphing-calculator = kiavash Graphing Calculator
graphing-calculator-narration-make-clickable = make clickable
graphing-calculator-narration-menu-drag-enabled = Drag Enabled
graphing-calculator-narration-movable-point-off-screen-prompt = { " " }not visible on screen
graphing-calculator-narration-movable-point-prefix = Point
graphing-calculator-narration-movable-point-suffix-usage-instructions = { " " }is movable. Press Arrows or Shift+Arrows to adjust.
graphing-calculator-narration-mute = Mute
graphing-calculator-narration-mute-all = Mute all
graphing-calculator-narration-mute-expression = Mute Expression { $index }
graphing-calculator-narration-mute-secret-expression = Mute Secret Expression { $index }
graphing-calculator-narration-muted = Muted
graphing-calculator-narration-no-geometry-tools-available = No geometry tools available.
graphing-calculator-narration-no-playing-tones = No currently playing tones
graphing-calculator-narration-no-tone-expressions = No tones in this graph
graphing-calculator-narration-options-menu = Options Menu
graphing-calculator-narration-options-menu-closed = Options menu closed.
graphing-calculator-narration-options-menu-open = Options menu open.
graphing-calculator-narration-pause-variable-animation = Pause { $variable } Animation
graphing-calculator-narration-play-variable-animation = Play { $variable } Animation
graphing-calculator-narration-poi-graph-point = Point
graphing-calculator-narration-point-size = Point Size:
graphing-calculator-narration-point-style-cross = Cross
graphing-calculator-narration-point-style-open = Open
graphing-calculator-narration-point-style-point = Point
graphing-calculator-narration-points-visible = Points visible
graphing-calculator-narration-redo = Redo
graphing-calculator-narration-rename = Rename
graphing-calculator-narration-rename-expression = Rename in Expression { $index }
graphing-calculator-narration-rename-secret-expression = Rename in Secret Expression { $index }
graphing-calculator-narration-rename-table = Rename in Table { $index }
graphing-calculator-narration-run-action-icon = Run Action
graphing-calculator-narration-settings-all-axes-max = Max for x, y, and z
graphing-calculator-narration-settings-all-axes-min = Min for x, y, and z
graphing-calculator-narration-settings-angle = Angle Settings
graphing-calculator-narration-settings-cartesian-grid = Cartesian Grid
graphing-calculator-narration-settings-polar-grid = Polar Grid
graphing-calculator-narration-settings-show-both = Show Both
graphing-calculator-narration-settings-show-positive = Show Positive
graphing-calculator-narration-settings-x-axis-label-placeholder = e.g. \u201Cx\u201D
graphing-calculator-narration-settings-x-axis-max = X Axis Maximum:{ " " }
graphing-calculator-narration-settings-x-axis-min = X Axis Minimum:{ " " }
graphing-calculator-narration-settings-x-axis-step = X Axis Step Size:{ " " }
graphing-calculator-narration-settings-y-axis-label-placeholder = e.g. \u201Cy\u201D
graphing-calculator-narration-settings-y-axis-max = Y Axis Maximum:{ " " }
graphing-calculator-narration-settings-y-axis-min = Y Axis Minimum:{ " " }
graphing-calculator-narration-settings-y-axis-step = Y Axis Step Size:{ " " }
graphing-calculator-narration-settings-z-axis-max = Z Axis Maximum:{ " " }
graphing-calculator-narration-settings-z-axis-min = Z Axis Minimum:{ " " }
graphing-calculator-narration-share-graph-link = Link to this graph
graphing-calculator-narration-share-graph-link-copied = Link copied
graphing-calculator-narration-share-graph-link-unable-to-copy = Unable to copy link
graphing-calculator-narration-show = Show
graphing-calculator-narration-show-animation-properties = Show Animation Properties
graphing-calculator-narration-show-expression = Show Expression { $index }
graphing-calculator-narration-show-folder-index = Show Folder { $index }
graphing-calculator-narration-show-folder-title = Show { $folder } folder
graphing-calculator-narration-show-image = Show Image { $index }
graphing-calculator-narration-show-options = Show Options
graphing-calculator-narration-show-options-expression = Show Options for Expression { $index }
graphing-calculator-narration-show-options-image = Show Options for Image { $index }
graphing-calculator-narration-show-options-secret-expression = Show Options for Secret Expression { $index }
graphing-calculator-narration-show-secret-expression = Show Secret Expression { $index }
graphing-calculator-narration-show-table = Show Table { $index }
graphing-calculator-narration-show-table-column = Show Column
graphing-calculator-narration-show-table-regression = Show Regression
graphing-calculator-narration-show-text = Show Note { $index }
graphing-calculator-narration-slider-animate-faster = Animate Faster
graphing-calculator-narration-slider-animate-slower = Animate Slower
graphing-calculator-narration-slider-animating-at-speed = Animating at { $speed }x
graphing-calculator-narration-slider-loop-forwards-and-backwards = Loop forwards and backwards
graphing-calculator-narration-slider-maximum = Slider Maximum:
graphing-calculator-narration-slider-minimum = Slider Minimum:
graphing-calculator-narration-slider-play-indefinitely = Play indefinitely
graphing-calculator-narration-slider-play-once = Play once
graphing-calculator-narration-slider-repeat-one-direction = Repeat in one direction
graphing-calculator-narration-slider-step = Slider Step Size:
graphing-calculator-narration-slider-trace-no-sliders = No sliders to trace.
graphing-calculator-narration-slider-trace-off = Slider trace off.
graphing-calculator-narration-slider-trace-on = Slider trace on.
graphing-calculator-narration-slider-variable-paused = { $variable } paused
graphing-calculator-narration-slider-variable-playing = { $variable } playing
graphing-calculator-narration-slider-variable-restarted = { $variable } restarted
graphing-calculator-narration-slow-compute = Is taking a long time to compute.
graphing-calculator-narration-slow-evaluation = Is taking a long time to evaluate.
graphing-calculator-narration-style-menu = Style Menu
graphing-calculator-narration-surface-opacity = Surface Opacity:
graphing-calculator-narration-surfaces-visible = Surfaces visible
graphing-calculator-narration-table-no-column-header = No column header
graphing-calculator-narration-table-regression-equation = Regression Equation
graphing-calculator-narration-tick-action = Tick Action
graphing-calculator-narration-toggle-audio-trace = Toggle Audio Trace
graphing-calculator-narration-toggle-letters = Toggle Letters
graphing-calculator-narration-unable-to-add-expression = Unable to add expression
graphing-calculator-narration-unable-to-add-note = Unable to add note
graphing-calculator-narration-unable-to-add-table = Unable to add table
graphing-calculator-narration-unable-to-add-table-regression = Unable to add regression
graphing-calculator-narration-undo = Undo
graphing-calculator-narration-unmute = Unmute
graphing-calculator-narration-unmute-all = Unmute all
graphing-calculator-narration-unmute-expression = Unmute Expression { $index }
graphing-calculator-narration-unmute-secret-expression = Unmute Secret Expression { $index }
graphing-calculator-narration-unmuted = Unmuted
graphing-calculator-narration-viewport-default = Graph viewport default
graphing-calculator-narration-viewport-pan-down = Graph pan down
graphing-calculator-narration-viewport-pan-left = Graph pan left
graphing-calculator-narration-viewport-pan-right = Graph pan right
graphing-calculator-narration-viewport-pan-up = Graph pan up
graphing-calculator-narration-viewport-updated = Graph viewport updated.
graphing-calculator-narration-viewport-zoom-3d-default = Graph set to default orientation
graphing-calculator-narration-viewport-zoom-3d-xy = Graph set to X Y orientation
graphing-calculator-narration-viewport-zoom-in = Graph zoom in
graphing-calculator-narration-viewport-zoom-out = Graph zoom out
graphing-calculator-narration-viewport-zoom-recenter = Graph recenter
graphing-calculator-narration-viewport-zoom-square = Graph zoom square
graphing-calculator-narration-visual-parameters-height = Height
graphing-calculator-narration-visual-parameters-offset = Offset
graphing-calculator-narration-visual-parameters-width = Width
graphing-calculator-narration-x-percentage-coordinate = { $x } percent from left.
graphing-calculator-narration-y-percentage-coordinate = { $y } percent from top.
graphing-calculator-narration-zoom-options-label = Zoom
graphing-calculator-text-add-screen-reader-label-placeholder = Add screen reader label
graphing-calculator-text-arrow-mode-both = Both
graphing-calculator-text-arrow-mode-default = Default
graphing-calculator-text-arrow-mode-none = None
graphing-calculator-text-arrow-mode-positive = Positive
graphing-calculator-text-audio-trace-no-implicit-support = Sorry, but I can't trace implicit curves yet.
graphing-calculator-text-audio-trace-no-parametric-support = Sorry, but I can't trace parametric curves yet.
graphing-calculator-text-audio-trace-no-polar-support = Sorry, but I can't trace polar curves yet.
graphing-calculator-text-audio-trace-off = Audio trace off.
graphing-calculator-text-audio-trace-on = Audio trace on.
graphing-calculator-text-color-black = black
graphing-calculator-text-color-blue = blue
graphing-calculator-text-color-cyan = cyan
graphing-calculator-text-color-dark-blue = dark blue
graphing-calculator-text-color-dark-cyan = dark cyan
graphing-calculator-text-color-dark-gray = dark gray
graphing-calculator-text-color-dark-green = dark green
graphing-calculator-text-color-dark-indigo = dark indigo
graphing-calculator-text-color-dark-lime = dark lime
graphing-calculator-text-color-dark-magenta = dark magenta
graphing-calculator-text-color-dark-orange = dark orange
graphing-calculator-text-color-dark-pink = dark pink
graphing-calculator-text-color-dark-red = dark red
graphing-calculator-text-color-dark-teal = dark teal
graphing-calculator-text-color-dark-violet = dark violet
graphing-calculator-text-color-dark-yellow = dark yellow
graphing-calculator-text-color-gray = gray
graphing-calculator-text-color-green = green
graphing-calculator-text-color-indigo = indigo
graphing-calculator-text-color-light-blue = light blue
graphing-calculator-text-color-light-cyan = light cyan
graphing-calculator-text-color-light-gray = light gray
graphing-calculator-text-color-light-green = light green
graphing-calculator-text-color-light-indigo = light indigo
graphing-calculator-text-color-light-lime = light lime
graphing-calculator-text-color-light-magenta = light magenta
graphing-calculator-text-color-light-orange = light orange
graphing-calculator-text-color-light-pink = light pink
graphing-calculator-text-color-light-red = light red
graphing-calculator-text-color-light-teal = light teal
graphing-calculator-text-color-light-violet = light violet
graphing-calculator-text-color-light-yellow = light yellow
graphing-calculator-text-color-lime = lime
graphing-calculator-text-color-magenta = magenta
graphing-calculator-text-color-orange = orange
graphing-calculator-text-color-pink = pink
graphing-calculator-text-color-purple = purple
graphing-calculator-text-color-red = red
graphing-calculator-text-color-teal = teal
graphing-calculator-text-color-unknown = color unknown
graphing-calculator-text-color-violet = violet
graphing-calculator-text-color-white = white
graphing-calculator-text-color-yellow = yellow
graphing-calculator-text-complex-plotting-note = Note: complex values will be plotted as (real, imag)
graphing-calculator-text-enter-pareneter = Enter the { $param }.
graphing-calculator-text-export-braille-email-accessibility = Feedback? Email <1>accessibility@kiavash.com</1>.
graphing-calculator-text-export-snapshot = Export a snapshot to the expression list
graphing-calculator-text-folder-placeholder = Untitled folder
graphing-calculator-text-geometry-arrow-mode = Arrow Mode: { $mode }
graphing-calculator-text-geometry-delete-selected-objects =
    { $count ->
        [one] Delete 1 object
       *[other] Delete { $count } objects
    }
graphing-calculator-text-geometry-delete-selected-unlocked-objects =
    { $count ->
        [one] Delete 1 unlocked object
       *[other] Delete { $count } unlocked objects
    }
graphing-calculator-text-geometry-glider = glider
graphing-calculator-text-geometry-hide-objects = Hide
graphing-calculator-text-geometry-intersection = intersection
graphing-calculator-text-geometry-move-to-expression-list-message = Move to expression list
graphing-calculator-text-geometry-multi-select-more-dropdown = More
graphing-calculator-text-geometry-no-constructed-objects = No constructed objects yet.
graphing-calculator-text-geometry-select-hint = Select a { $type }
graphing-calculator-text-geometry-selected-objects =
    { $count ->
        [one] 1 object selected
       *[other] { $count } objects selected
    }
graphing-calculator-text-geometry-show-objects = Show
graphing-calculator-text-geometry-tool-angle-bisector-display-name = Angle bisector
graphing-calculator-text-geometry-tool-angle-bisector-hint-angle = Choose an angle to bisect
graphing-calculator-text-geometry-tool-angle-display-name = Angle
graphing-calculator-text-geometry-tool-angle-hint-1 = Choose a starting point
graphing-calculator-text-geometry-tool-angle-hint-2 = Choose a vertex point
graphing-calculator-text-geometry-tool-angle-hint-3 = Choose an endpoint
graphing-calculator-text-geometry-tool-angles-hint-1 = Choose a starting point or a polygon
graphing-calculator-text-geometry-tool-arc-display-name = Arc
graphing-calculator-text-geometry-tool-arc-hint-1 = Choose a point (start)
graphing-calculator-text-geometry-tool-arc-hint-2 = Choose a point (middle)
graphing-calculator-text-geometry-tool-arc-hint-3 = Choose a point (end)
graphing-calculator-text-geometry-tool-box-selection-display-name = Box Select
graphing-calculator-text-geometry-tool-circle-by-length-display-name = Circle by length
graphing-calculator-text-geometry-tool-circle-display-name = Circle
graphing-calculator-text-geometry-tool-circle-hint-center = Choose a point (center)
graphing-calculator-text-geometry-tool-circle-hint-radius = Choose a point (radius)
graphing-calculator-text-geometry-tool-compass-hint-center = Choose a center point
graphing-calculator-text-geometry-tool-compass-hint-segment = Choose a segment to set the radius
graphing-calculator-text-geometry-tool-dilate-display-name = Dilate
graphing-calculator-text-geometry-tool-dilation-hint-center = Choose point (center)
graphing-calculator-text-geometry-tool-dilation-hint-scale-factor = Scale factor
graphing-calculator-text-geometry-tool-directed-angle-display-name = Directed Angle
graphing-calculator-text-geometry-tool-directedangle-display-name = Directed angle
graphing-calculator-text-geometry-tool-expression-edit-display-name = Insert into current expression.
graphing-calculator-text-geometry-tool-expression-edit-generic-hint-0 = No valid inputs
graphing-calculator-text-geometry-tool-expression-edit-generic-hint-1 = Choose { $type }
graphing-calculator-text-geometry-tool-expression-edit-generic-hint-2 = Choose { $type1 } or { $type2 }
graphing-calculator-text-geometry-tool-expression-edit-generic-hint-any-object = Choose any object
graphing-calculator-text-geometry-tool-expression-edit-generic-hint-many = Choose one of the following: { $types }
graphing-calculator-text-geometry-tool-expression-edit-starting-transformation-hint = Choose an object to transform
graphing-calculator-text-geometry-tool-line-display-name = Line
graphing-calculator-text-geometry-tool-line-hint-end = Choose a 2nd point
graphing-calculator-text-geometry-tool-line-hint-start = Choose a 1st point
graphing-calculator-text-geometry-tool-midpoint-display-name = Midpoint
graphing-calculator-text-geometry-tool-midpoint-hint = Choose a segment
graphing-calculator-text-geometry-tool-parallel-display-name = Parallel
graphing-calculator-text-geometry-tool-parallel-hint-point = Choose a point to pass through
graphing-calculator-text-geometry-tool-parallel-hint-straight-line = Choose a line to be parallel to
graphing-calculator-text-geometry-tool-perpendicular-display-name = Perpendicular
graphing-calculator-text-geometry-tool-perpendicular-hint-point = Choose a point to pass through
graphing-calculator-text-geometry-tool-perpendicular-hint-straight-line = Choose a line to be perpendicular to
graphing-calculator-text-geometry-tool-point-display-name = Point
graphing-calculator-text-geometry-tool-point-hint = Select or create a point
graphing-calculator-text-geometry-tool-polygon-display-name = Polygon
graphing-calculator-text-geometry-tool-polygon-hint-finish-point = Choose another point, or click an existing point to finish
graphing-calculator-text-geometry-tool-polygon-hint-first-point = Choose a point
graphing-calculator-text-geometry-tool-polygon-hint-next-point = Choose another point
graphing-calculator-text-geometry-tool-ray-display-name = Ray
graphing-calculator-text-geometry-tool-ray-hint-end = Choose a point (direction)
graphing-calculator-text-geometry-tool-ray-hint-start = Choose a point (vertex)
graphing-calculator-text-geometry-tool-reflect-display-name = Reflect
graphing-calculator-text-geometry-tool-reflection-hint-choose-line = Choose line of reflection
graphing-calculator-text-geometry-tool-rotate-display-name = Rotate
graphing-calculator-text-geometry-tool-rotation-hint-angle = Choose angle
graphing-calculator-text-geometry-tool-rotation-hint-angle-end = Choose angle end point
graphing-calculator-text-geometry-tool-rotation-hint-angle-start = Construct or choose angle
graphing-calculator-text-geometry-tool-rotation-hint-center = Choose point (center)
graphing-calculator-text-geometry-tool-segment-display-name = Segment
graphing-calculator-text-geometry-tool-segment-hint-end = Choose another point
graphing-calculator-text-geometry-tool-segment-hint-start = Choose a point
graphing-calculator-text-geometry-tool-selection-display-name = Select
graphing-calculator-text-geometry-tool-translate-display-name = Translate
graphing-calculator-text-geometry-tool-translation-hint-from-with-vector = Choose start point or a vector
graphing-calculator-text-geometry-tool-translation-hint-to = Choose end point
graphing-calculator-text-geometry-tool-vector-copy-display-name = Copy of Vector
graphing-calculator-text-geometry-tool-vector-copy-hint-end = Choose new start point for copy
graphing-calculator-text-geometry-tool-vector-display-name = Vector
graphing-calculator-text-geometry-tool-vector-end-point-display-name = Vector End Point
graphing-calculator-text-geometry-tool-vector-hint-end = Choose end point
graphing-calculator-text-geometry-tool-vector-hint-start = Choose start point or a vector to copy
graphing-calculator-text-geometry-tool-vector-start-point-display-name = Vector Start Point
graphing-calculator-text-image-placeholder = Unnamed image
graphing-calculator-text-label-orientation-above = Above
graphing-calculator-text-label-orientation-above-left = Above Left
graphing-calculator-text-label-orientation-above-right = Above Right
graphing-calculator-text-label-orientation-below = Below
graphing-calculator-text-label-orientation-below-left = Below Left
graphing-calculator-text-label-orientation-below-right = Below Right
graphing-calculator-text-label-orientation-default = Default
graphing-calculator-text-label-orientation-left = Left
graphing-calculator-text-label-orientation-right = Right
graphing-calculator-text-loading-image = Loading image...
graphing-calculator-text-make-custom-regression = Make a custom regression model in a new line using <1>~</1>. <2>Learn how</2>.
graphing-calculator-text-note-placeholder = Empty note
graphing-calculator-text-parameter-name-binwidth = Bin Width
graphing-calculator-text-parameter-name-data = Data Set
graphing-calculator-text-parameter-name-dof = Degrees of Freedom
graphing-calculator-text-parameter-name-height = Height
graphing-calculator-text-parameter-name-max = Maximum
graphing-calculator-text-parameter-name-mean = Mean
graphing-calculator-text-parameter-name-min = Minimum
graphing-calculator-text-parameter-name-offset = Offset
graphing-calculator-text-parameter-name-probsuccess = Success Probability
graphing-calculator-text-parameter-name-stddev = Standard Deviation
graphing-calculator-text-parameter-name-trials = Trials
graphing-calculator-text-refreshable-braille-display-note = Use a refreshable Braille display, or just type Braille with a keyboard.
graphing-calculator-text-regression-potentially-inaccurate-parameters = Some parameters may be too large or small to represent accurately.
graphing-calculator-text-share-graph-link = Link to this graph
graphing-calculator-text-table-created = Table created.
graphing-calculator-text-table-creation-error = Error creating table.
graphing-calculator-text-table-more-rows = { $rowCount } more rows
graphing-calculator-text-toast-choose-one-file = You can only choose one file as a replacement
graphing-calculator-text-toast-error-importing-graph = Error importing graph. Check the URL?
graphing-calculator-text-toast-error-no-folders = Only graphs without folders can be inserted into a folder.
graphing-calculator-text-toast-expression-size-limit = Maximum expression size reached.
graphing-calculator-text-toast-graph-cleared = Graph cleared.
graphing-calculator-text-toast-graph-reset = Graph reset.
graphing-calculator-text-toast-image-upload-failed = Image upload failed.
graphing-calculator-text-toast-imported-graph = Graph imported!
graphing-calculator-text-toast-importing-graph = Importing graph...
graphing-calculator-text-toast-no-file-selected = You did not select a file
graphing-calculator-text-toast-uploading-images = Uploading images...
graphing-calculator-text-toast-zoom-to-fit = We zoomed to fit your data.
graphing-calculator-text-undefined-parameter = { $parameter } is undefined
graphing-calculator-text-view-regression-options = Regression options
graphing-calculator-text-zoom-fit = Zoom Fit
graphing-tours-heading-quest-success = You completed the "{ $title }" quest.
graphing-tours-heading-regressions = Regressions
graphing-tours-heading-restrictions = Restrictions
graphing-tours-heading-sliders = Sliders
graphing-tours-heading-tables = Tables
graphing-tours-label-add-regression = Click here to add a regression.
graphing-tours-label-add-slider = Add a slider
graphing-tours-label-awesome = Awesome!
graphing-tours-label-brilliant = Brilliant!
graphing-tours-label-change-color = Change color
graphing-tours-label-check-progress = Check my progress
graphing-tours-label-close-quest = Exit quest
graphing-tours-label-close-quests = Exit quests
graphing-tours-label-close-tour = Close tour
graphing-tours-label-new-item = Click here to add a new item.
graphing-tours-label-next-step-countdown = Continuing in { $seconds }...
graphing-tours-label-nice = Nice!
graphing-tours-label-quest-back-to-quest = Back to quest
graphing-tours-label-quest-take-a-tour = Take a tour
graphing-tours-label-quest-tours = Looking around? Try a quick tour.
graphing-tours-label-quest-tours-aria = Tours that might help with this quest
graphing-tours-label-regressions-better-fit = Edit this equation to find a better fit. Try, for example:<br>{ $equation }
graphing-tours-label-regressions-check-model = Nice. Let's check the model.
graphing-tours-label-regressions-data = First, let's get some data.
graphing-tours-label-regressions-data-2 = Let's start with some data!
graphing-tours-label-regressions-docs = Head over to Google Docs and copy and paste this { $sample_data_link }.
graphing-tours-label-regressions-equation = Now type: { $equation }
graphing-tours-label-regressions-expression-option = ... and select the "expression" option.
graphing-tours-label-regressions-fill-sample-data = Fill in the sample data:
graphing-tours-label-regressions-hint-1 = Hint #1: to get { $y_1 } type { $y1 }.
graphing-tours-label-regressions-hint-2 = Hint #2: { $twiddle } is in our onscreen keypad in the 'A B C' section.
graphing-tours-label-regressions-keep-exploring = Nice work \u2013 Keep exploring!
graphing-tours-label-regressions-new-model = Now, let's try a new model.
graphing-tours-label-regressions-new-table = Click here to add a new table.
graphing-tours-label-regressions-own-data = Note: you can add your own data instead by clicking the { $plus_icon } button.
graphing-tours-label-regressions-residuals = Residuals are the difference between your data and your model. Click here to add them to your table and plot them on the graph.
graphing-tours-label-regressions-sample-data = sample data
graphing-tours-label-require-expressions-visible = Click to show the list of expressions.
graphing-tours-label-require-not-edit-list-mode = Click to return to your expressions.
graphing-tours-label-require-resources-not-open = Click to return to this graph.
graphing-tours-label-restrictions-abc = Hint: press the 'A B C' button on the keypad to find the { $buttons } buttons
graphing-tours-label-restrictions-blank-expression = Click here to make a new blank expression.
graphing-tours-label-restrictions-change-equation = Change this equation to { $sample_expression }
graphing-tours-label-restrictions-change-model = Use this menu to switch to a different regression model.
graphing-tours-label-restrictions-domain = Restrict the domain of this line by adding { $sample_expression } to the end.
graphing-tours-label-restrictions-dont-forget = Don't forget the "y="!
graphing-tours-label-restrictions-graph-parabola = Now graph: { $sample_expression }
graphing-tours-label-restrictions-move-parabola = Move the parabola.
graphing-tours-label-restrictions-new-expression = Click here to create a new expression.
graphing-tours-label-restrictions-range = Now let's restrict the range. Add { $sample_expression } to the end.
graphing-tours-label-restrictions-star = You're a restrictions star!
graphing-tours-label-restrictions-start = Let's get started!
graphing-tours-label-restrictions-straight-line = Try graphing a straight line, like { $sample_expression }
graphing-tours-label-restrictions-type-all = Try typing all of { $sample_expression }
graphing-tours-label-restrictions-typing-hint = Hint: you can type { $suggestion1 }, or use the { $suggestion2 } button on the keypad below.
graphing-tours-label-self-destruct = This message will self-destruct in { $seconds }...
graphing-tours-label-show-surface = Show 3D surface
graphing-tours-label-sliders-add = Now click here to add the sliders.
graphing-tours-label-sliders-blank-expression = Click here to create a new blank expression.
graphing-tours-label-sliders-change-value = Type in here to change the value.
graphing-tours-label-sliders-drag-handle = Drag the handle to change the value.
graphing-tours-label-sliders-hands-free = Go "Hands-free"
graphing-tours-label-sliders-make-sliders = Let's make some sliders!
graphing-tours-label-sliders-press-play = Press play to animate the slider.
graphing-tours-label-sliders-pro = You're a slider pro!
graphing-tours-label-sliders-try-typing = Try typing { $sample_expression }
graphing-tours-label-tables-back = Click back to continue editing.
graphing-tours-label-tables-close-options = Click anywhere to close the drawing options.
graphing-tours-label-tables-dots = Click here to connect the dots.
graphing-tours-label-tables-enter = Now try pressing Enter.
graphing-tours-label-tables-fill-another = Just fill in one more...
graphing-tours-label-tables-fill-cell = Fill it in.
graphing-tours-label-tables-fill-row = Fill in this whole row.
graphing-tours-label-tables-last-trick = Last trick!
graphing-tours-label-tables-next-row = Go down to the next row to add more data.
graphing-tours-label-tables-open-options = Click and hold on this icon until the options menu opens up.
graphing-tours-label-tables-scroll = Scroll back up to the table.
graphing-tours-label-tables-select-table = ... and select the "table" option.
graphing-tours-label-tables-start = Let's make a table!
graphing-tours-label-tables-type-number = Type any number here.
graphing-tours-label-tables-valid-number = Uh-oh! Type a valid number here.
graphing-tours-label-tables-whiz = You're a tables whiz!
graphing-tours-label-turn-off-axes = Turn off axes
graphing-tours-narration-exiting-quest = Exiting quest.
graphing-tours-narration-quest-goal-complete = { $goal }. Complete.
graphing-tours-narration-quest-goal-incomplete = { $goal }. Incomplete.
graphing-tours-narration-quest-started = Started "{ $title }" quest.
graphing-tours-narration-quest-thumbnail = Thumbnail for '{ $title }' quest
graphing-tours-narration-tour-thumbnail = Thumbnail for '{ $title }' tour
matrix-calculator-narration-keypad-key-det = Determinant
matrix-calculator-narration-keypad-key-inverse = Inverse
matrix-calculator-narration-keypad-key-rref = Reduced row echelon form
matrix-calculator-narration-keypad-key-trace = Trace
matrix-calculator-narration-keypad-key-transpose = Transpose
frontpage-error-something-went-wrong-try-again-later = Sorry! Something went wrong. Please try again later.
frontpage-link-shared-3d-calculator-short = 3D
frontpage-link-shared-geometry-short = Geometry
frontpage-link-shared-graphing-calculator-short = Graphing
frontpage-narration-art-contest-image-of-graph = Image of { $graphTitle }
frontpage-narration-art-contest-image-of-graph-by = Image of graph by { $name }
frontpage-narration-shared-kiavash-logo = kiavash Logo
frontpage-text-header-terms-update = We've updated our Terms of Service.























































































































































































































































































































































































































































































































































































































































































































































































































































































`;var mm=class{constructor(e){this.value=e}valueOf(){return this.value}},Xi=class extends mm{constructor(e="???"){super(e)}toString(e){return`{${this.value}}`}},Sc=class extends mm{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),this.value.toString(10)}}},vu=class extends mm{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),new Date(this.value).toISOString()}}};var D7=100,Bne="\u2068",Une="\u2069";function qne(r,e,t){if(t===e||t instanceof Sc&&e instanceof Sc&&t.value===e.value)return!0;if(e instanceof Sc&&typeof t=="string"){let o=r.memoizeIntlObject(Intl.PluralRules,e.opts).select(e.value);if(t===o)return!0}return!1}function k7(r,e,t){return e[t]?Sw(r,e[t].value):(r.reportError(new RangeError("No default")),new Xi)}function OR(r,e){let t=[],o=Object.create(null);for(let i of e)i.type==="narg"?o[i.name]=hC(r,i.value):t.push(hC(r,i));return{positional:t,named:o}}function hC(r,e){switch(e.type){case"str":return e.value;case"num":return new Sc(e.value,{minimumFractionDigits:e.precision});case"var":return zne(r,e);case"mesg":return Hne(r,e);case"term":return Kne(r,e);case"func":return Wne(r,e);case"select":return $ne(r,e);default:return new Xi}}function zne(r,{name:e}){let t;if(r.params)if(Object.prototype.hasOwnProperty.call(r.params,e))t=r.params[e];else return new Xi(`$${e}`);else if(r.args&&Object.prototype.hasOwnProperty.call(r.args,e))t=r.args[e];else return r.reportError(new ReferenceError(`Unknown variable: $${e}`)),new Xi(`$${e}`);if(t instanceof mm)return t;switch(typeof t){case"string":return t;case"number":return new Sc(t);case"object":if(t instanceof Date)return new vu(t.getTime());default:return r.reportError(new TypeError(`Variable type not supported: $${e}, ${typeof t}`)),new Xi(`$${e}`)}}function Hne(r,{name:e,attr:t}){let o=r.bundle._messages.get(e);if(!o)return r.reportError(new ReferenceError(`Unknown message: ${e}`)),new Xi(e);if(t){let i=o.attributes[t];return i?Sw(r,i):(r.reportError(new ReferenceError(`Unknown attribute: ${t}`)),new Xi(`${e}.${t}`))}return o.value?Sw(r,o.value):(r.reportError(new ReferenceError(`No value: ${e}`)),new Xi(e))}function Kne(r,{name:e,attr:t,args:o}){let i=`-${e}`,n=r.bundle._terms.get(i);if(!n)return r.reportError(new ReferenceError(`Unknown term: ${i}`)),new Xi(i);if(t){let s=n.attributes[t];if(s){r.params=OR(r,o).named;let l=Sw(r,s);return r.params=null,l}return r.reportError(new ReferenceError(`Unknown attribute: ${t}`)),new Xi(`${i}.${t}`)}r.params=OR(r,o).named;let a=Sw(r,n.value);return r.params=null,a}function Wne(r,{name:e,args:t}){let o=r.bundle._functions[e];if(!o)return r.reportError(new ReferenceError(`Unknown function: ${e}()`)),new Xi(`${e}()`);if(typeof o!="function")return r.reportError(new TypeError(`Function ${e}() is not callable`)),new Xi(`${e}()`);try{let i=OR(r,t);return o(i.positional,i.named)}catch(i){return r.reportError(i),new Xi(`${e}()`)}}function $ne(r,{selector:e,variants:t,star:o}){let i=hC(r,e);if(i instanceof Xi)return k7(r,t,o);for(let n of t){let a=hC(r,n.key);if(qne(r,i,a))return Sw(r,n.value)}return k7(r,t,o)}function RR(r,e){if(r.dirty.has(e))return r.reportError(new RangeError("Cyclic reference")),new Xi;r.dirty.add(e);let t=[],o=r.bundle._useIsolating&&e.length>1;for(let i of e){if(typeof i=="string"){t.push(r.bundle._transform(i));continue}if(r.placeables++,r.placeables>D7)throw r.dirty.delete(e),new RangeError(`Too many placeables expanded: ${r.placeables}, max allowed is ${D7}`);o&&t.push(Bne),t.push(hC(r,i).toString(r)),o&&t.push(Une)}return r.dirty.delete(e),t.join("")}function Sw(r,e){return typeof e=="string"?r.bundle._transform(e):RR(r,e)}var JT=class{constructor(e,t,o){this.dirty=new WeakSet,this.params=null,this.placeables=0,this.bundle=e,this.errors=t,this.args=o}reportError(e){if(!this.errors||!(e instanceof Error))throw e;this.errors.push(e)}memoizeIntlObject(e,t){let o=this.bundle._intls.get(e);o||(o={},this.bundle._intls.set(e,o));let i=JSON.stringify(t);return o[i]||(o[i]=new e(this.bundle.locales,t)),o[i]}};function QT(r,e){let t=Object.create(null);for(let[o,i]of Object.entries(r))e.includes(o)&&(t[o]=i.valueOf());return t}var _7=["unitDisplay","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"];function G7(r,e){let t=r[0];if(t instanceof Xi)return new Xi(`NUMBER(${t.valueOf()})`);if(t instanceof Sc)return new Sc(t.valueOf(),{...t.opts,...QT(e,_7)});if(t instanceof vu)return new Sc(t.valueOf(),{...QT(e,_7)});throw new TypeError("Invalid argument to NUMBER")}var T7=["dateStyle","timeStyle","fractionalSecondDigits","dayPeriod","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function I7(r,e){let t=r[0];if(t instanceof Xi)return new Xi(`DATETIME(${t.valueOf()})`);if(t instanceof vu)return new vu(t.valueOf(),{...t.opts,...QT(e,T7)});if(t instanceof Sc)return new vu(t.valueOf(),{...QT(e,T7)});throw new TypeError("Invalid argument to DATETIME")}var M7=new Map;function A7(r){let e=Array.isArray(r)?r.join(" "):r,t=M7.get(e);return t===void 0&&(t=new Map,M7.set(e,t)),t}var gC=class{constructor(e,{functions:t,useIsolating:o=!0,transform:i=n=>n}={}){this._terms=new Map,this._messages=new Map,this.locales=Array.isArray(e)?e:[e],this._functions={NUMBER:G7,DATETIME:I7,...t},this._useIsolating=o,this._transform=i,this._intls=A7(e)}hasMessage(e){return this._messages.has(e)}getMessage(e){return this._messages.get(e)}addResource(e,{allowOverrides:t=!1}={}){let o=[];for(let i=0;i<e.body.length;i++){let n=e.body[i];if(n.id.startsWith("-")){if(t===!1&&this._terms.has(n.id)){o.push(new Error(`Attempt to override an existing term: "${n.id}"`));continue}this._terms.set(n.id,n)}else{if(t===!1&&this._messages.has(n.id)){o.push(new Error(`Attempt to override an existing message: "${n.id}"`));continue}this._messages.set(n.id,n)}}return o}formatPattern(e,t=null,o=null){if(typeof e=="string")return this._transform(e);let i=new JT(this,o,t);try{return RR(i,e).toString(i)}catch(n){if(i.errors&&n instanceof Error)return i.errors.push(n),new Xi().toString(i);throw n}}};var FR=/^(-?[a-zA-Z][\w-]*) *= */gm,V7=/\.([a-zA-Z][\w-]*) *= */y,jne=/\*?\[/y,NR=/(-?[0-9]+(?:\.([0-9]+))?)/y,Yne=/([a-zA-Z][\w-]*)/y,L7=/([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y,Xne=/^[A-Z][A-Z0-9_-]*$/,ZT=/([^{}\n\r]+)/y,Jne=/([^\\"\n\r]*)/y,P7=/\\([\\"])/y,O7=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y,Qne=/^\n+/,R7=/ +$/,Zne=/ *\r?\n/g,eae=/( *)$/,tae=/{\s*/y,F7=/\s*}/y,rae=/\[\s*/y,oae=/\s*] */y,iae=/\s*\(\s*/y,nae=/\s*->\s*/y,aae=/\s*:\s*/y,sae=/\s*,?\s*/y,lae=/\s+/y,Ew=class{constructor(e){this.body=[],FR.lastIndex=0;let t=0;for(;;){let O=FR.exec(e);if(O===null)break;t=FR.lastIndex;try{this.body.push(l(O[1]))}catch(W){if(W instanceof SyntaxError)continue;throw W}}function o(O){return O.lastIndex=t,O.test(e)}function i(O,W){if(e[t]===O)return t++,!0;if(W)throw new W(`Expected ${O}`);return!1}function n(O,W){if(o(O))return t=O.lastIndex,!0;if(W)throw new W(`Expected ${O.toString()}`);return!1}function a(O){O.lastIndex=t;let W=O.exec(e);if(W===null)throw new SyntaxError(`Expected ${O.toString()}`);return t=O.lastIndex,W}function s(O){return a(O)[1]}function l(O){let W=d(),X=c();if(W===null&&Object.keys(X).length===0)throw new SyntaxError("Expected message value or attributes");return{id:O,value:W,attributes:X}}function c(){let O=Object.create(null);for(;o(V7);){let W=s(V7),X=d();if(X===null)throw new SyntaxError("Expected attribute value");O[W]=X}return O}function d(){let O;if(o(ZT)&&(O=s(ZT)),e[t]==="{"||e[t]==="}")return p(O?[O]:[],1/0);let W=T();return W?O?p([O,W],W.length):(W.value=I(W.value,Qne),p([W],W.length)):O?I(O,R7):null}function p(O=[],W){for(;;){if(o(ZT)){O.push(s(ZT));continue}if(e[t]==="{"){O.push(u());continue}if(e[t]==="}")throw new SyntaxError("Unbalanced closing brace");let R=T();if(R){O.push(R),W=Math.min(W,R.length);continue}break}let X=O.length-1,x=O[X];typeof x=="string"&&(O[X]=I(x,R7));let L=[];for(let R of O)R instanceof eG&&(R=R.value.slice(0,R.value.length-W)),R&&L.push(R);return L}function u(){n(tae,SyntaxError);let O=h();if(n(F7))return O;if(n(nae)){let W=w();return n(F7,SyntaxError),{type:"select",selector:O,...W}}throw new SyntaxError("Unclosed placeable")}function h(){if(e[t]==="{")return u();if(o(L7)){let[,O,W,X=null]=a(L7);if(O==="$")return{type:"var",name:W};if(n(iae)){let x=m();if(O==="-")return{type:"term",name:W,attr:X,args:x};if(Xne.test(W))return{type:"func",name:W,args:x};throw new SyntaxError("Function names must be all upper-case")}return O==="-"?{type:"term",name:W,attr:X,args:[]}:{type:"mesg",name:W,attr:X}}return C()}function m(){let O=[];for(;;){switch(e[t]){case")":return t++,O;case void 0:throw new SyntaxError("Unclosed argument list")}O.push(y()),n(sae)}}function y(){let O=h();return O.type!=="mesg"?O:n(aae)?{type:"narg",name:O.name,value:C()}:O}function w(){let O=[],W=0,X;for(;o(jne);){i("*")&&(X=W);let x=S(),L=d();if(L===null)throw new SyntaxError("Expected variant value");O[W++]={key:x,value:L}}if(W===0)return null;if(X===void 0)throw new SyntaxError("Expected default variant");return{variants:O,star:X}}function S(){n(rae,SyntaxError);let O;return o(NR)?O=v():O={type:"str",value:s(Yne)},n(oae,SyntaxError),O}function C(){if(o(NR))return v();if(e[t]==='"')return E();throw new SyntaxError("Invalid expression")}function v(){let[,O,W=""]=a(NR),X=W.length;return{type:"num",value:parseFloat(O),precision:X}}function E(){i('"',SyntaxError);let O="";for(;;){if(O+=s(Jne),e[t]==="\\"){O+=_();continue}if(i('"'))return{type:"str",value:O};throw new SyntaxError("Unclosed string literal")}}function _(){if(o(P7))return s(P7);if(o(O7)){let[,O,W]=a(O7),X=parseInt(O||W,16);return X<=55295||57344<=X?String.fromCodePoint(X):"\uFFFD"}throw new SyntaxError("Unknown escape sequence")}function T(){let O=t;switch(n(lae),e[t]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return P(e.slice(O,t))}return e[t-1]===" "?P(e.slice(O,t)):!1}function I(O,W){return O.replace(W,"")}function P(O){let W=O.replace(Zne,`
`),X=eae.exec(O)[1].length;return new eG(W,X)}}},eG=class{constructor(e,t){this.value=e,this.length=t}};var dae=["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"],tG=class r{constructor(e,t){this.bundles=e;this.onError=t}static fromSources(e,t,o){let i=[];for(let{lang:n,source:a}of e){let s=n.split("-")[0],l=new gC(n,{...o,useIsolating:dae.indexOf(s)>=0});l.addResource(new Ew(a),{allowOverrides:!1}),l.addResource(new Ew(`
l10n-internal-date-day-month-year = {DATETIME($d, month: "short", day: "numeric", year: "numeric")}
l10n-internal-date-day-month = {DATETIME($d, month: "short", day: "numeric")}
l10n-internal-time = {DATETIME($d, minute: "numeric", hour: "numeric")}
      `),{allowOverrides:!1}),i.push(l)}return new r(i,t)}format(e,t){for(let o of this.bundles){if(!o.hasMessage(e))continue;let i=o.getMessage(e);if(!(i!=null&&i.value))return;let n=[],a=o.formatPattern(i.value,this.coerceNumericVariables(t),n);for(let s of n)this.onError(`Error formatting ${e} for locale ${o.locales.join(",")}: ${s}`);return a}this.onError(`Couldn't find message for key ${e} for locales ${this.getLocales().join(",")}`)}formatDate(e,t){return t.showYear?this.format("l10n-internal-date-day-month-year",{d:e}):this.format("l10n-internal-date-day-month",{d:e})}formatTime(e){let t=this.format("l10n-internal-time",{d:e});return this.getLocales()[0]==="en"?t==null?void 0:t.toLowerCase():t}hasTranslation(e,t){for(let o of this.bundles)if(o.locales.indexOf(t)>=0)return o.hasMessage(e);return!1}coerceNumericVariables(e){let t={};for(let o in e){let i=e[o];__dcg_shared_module_exports__['lc'](i)?t[o]=i.value:typeof i=="number"?t[o]=`${i}`:t[o]=i}return t}getLocales(){return this.bundles.reduce((e,t)=>e.concat(t.locales),[])}};var rG="",BR={},N7={},UR={},pae=["ar","hy-AM","hi","tr","xx-XX"];function oG(r){rG=r||""}function qR(r){for(let e in r)delete UR[e],N7[e]=r[e]}function iG(r,e){let t=e!=null?e:rG;return U7(t).hasTranslation(r,t)}function Bs(r,e){if(e)for(let t in e)e.hasOwnProperty(t)&&(r=r.split("__"+t+"__").join(e[t]));return r}function fa(r,e,t){return B7(r,e!=null?e:{},t!=null?t:rG)}function Id(r){return function(t,o){return B7(t,o!=null?o:{},r())}}function uae(r){let e={};for(let t in r){let o=r[t];o!==void 0&&(e[t]=o)}return e}function B7(r,e,t){let i=U7(t).format(r,uae(e));return i==null?(__dcg_shared_module_exports__['g'].warn(`Could not format string ${r}`),""):i}function U7(r){let e=UR[r];if(!e){BR[r]||(BR[r]=uC([r]));let t=[];for(let i of BR[r]){let n=N7[i];n&&t.push({lang:i,source:n})}let o={};r==="xx-XX"&&(o.transform=i=>i.replace(/[a-z]/gi,"\u2666")),e=UR[r]=tG.fromSources([...t,{lang:"en",source:E7}],i=>{__dcg_shared_module_exports__['g'].warn(i)},o)}return e}function mC(){return rG}function zR(r){return Xc.hasOwnProperty(r)||__dcg_shared_module_exports__['p'](pae,r)}function Ec(r,e){if(r==null)return"";if(typeof r=="string")return r;if(typeof r=="number")return""+r;let t=r.vars,o;if(t){o={};for(let i in t){if(!t.hasOwnProperty(i))continue;let n=t[i];__dcg_shared_module_exports__['lc'](n)?o[i]=n:o[i]=Ec(n,e)}}return fa(r.key,o,e)}var Dw=typeof kiavashLocaleData=="object"?kiavashLocaleData:{};function fm(){let r=uC([Xn("lang"),navigator.userLanguage,navigator.language]);for(let e=0;e<r.length;e++){let t=r[e];if(zR(t))return t}return"en"}async function kw(r){if(Dw[r]||r==="en"||r==="xx-XX")return oG(r),!0;if(!zR(r)){let e=r.indexOf("-")!==-1?r.split("-")[0]:r;for(let t in Xc)if(e===t.split("-")[0]&&Xc[t].useAsRoot){r=t;break}}try{let e=await Gd(`/api/v1/calculator/language/${r}.ftl`);return Dw[r]=e[r],qR(Dw),oG(r),!0}catch(e){throw e.status===404&&__dcg_shared_module_exports__['g'].warn(r+" is not an available language."),e}}function nG(r){if(Dw[r])return!0;let e=uC([r]);for(let t of e)if(Dw[t])return!0;return!1}qR(Dw);oG(fm());var gae=/`[^`]*`/g,mae=/^[\+\-]?[\d]*(\.\d+)?$/,fae=r=>{if(r!=null){let e=r.match(/`/g);return(e!=null&&e.length||0)%2==0}return!0},bae=r=>{let e=[];if(r==null||r.length==0)return e;let t=0,o;for(;o=gae.exec(r);){let n=r.slice(t,o.index);n.length>0&&e.push({from:t,to:o.index,type:"text",text:n}),t=o.index+o[0].length,e.push({from:o.index,to:t,type:"math",text:o[0].slice(1,-1)})}let i=r.slice(t);return i.length>0&&e.push({from:t,to:r.length,type:"text",text:i}),e},q7=Hc.StaticMath(document.createElement("span"));function rn(r){let e="",t=[];fae(r)?t=bae(r):t=[{from:0,to:r.length,type:"text",text:r}];for(let o of t)e+=o.type==="text"?o.text:Gi(o.text);return e}function Gi(r){let e="";return mae.test(r)?(/^\+/.test(r)?(e="positive ",r=r.slice(1)):/^\-/.test(r)&&(e="negative ",r=r.slice(1)),e+=r.replace(/(\.)([0-9]+)/g,(t,o,i)=>o+i.split("").join(" ").trim())):(q7.latex(r),e=q7.mathspeak().trim()),e}function aG(r,e,t){let o=r.formula.typed_constant_value;if(o!=null&&o.value){if(__dcg_shared_module_exports__['sc'](o))return`${Ec(__dcg_shared_module_exports__['ab'](o.valueType),e.getLanguage())}. ${e.s("shared-calculator-label-list-of-count-items-suffix",{count:o.value.length})}`;if(__dcg_shared_module_exports__['db'](o.valueType))return Ec(__dcg_shared_module_exports__['ab'](o.valueType),e.getLanguage());switch(o.valueType){case __dcg_shared_module_exports__['ba']:return Gi(__dcg_shared_module_exports__['_b'](+o.value,t));case __dcg_shared_module_exports__['Ka']:return Gi(__dcg_shared_module_exports__['cc'](o.value,t));case __dcg_shared_module_exports__['ma']:return gu(e,r.formula.rgb_value);case __dcg_shared_module_exports__['ca']:case __dcg_shared_module_exports__['Ia']:case __dcg_shared_module_exports__['la']:case __dcg_shared_module_exports__['Oa']:case __dcg_shared_module_exports__['Qa']:case __dcg_shared_module_exports__['Sa']:case __dcg_shared_module_exports__['Ua']:case __dcg_shared_module_exports__['Wa']:case __dcg_shared_module_exports__['Ma']:case __dcg_shared_module_exports__['ea']:case __dcg_shared_module_exports__['ka']:case __dcg_shared_module_exports__['ja']:return Ec(__dcg_shared_module_exports__['ab'](o.valueType),e.getLanguage());default:let i=o.valueType;throw new Error(`Unexpected valueType ${i}`)}}}var Ma=1;function _w(r,e){let t=[],o=r.formula.geometry&&r.formula.geometry.call;if(!o||!o.parents)return[];for(let i of o.parents)if(i.type==="arbitrary-expression")t.push(void 0);else{let n=__dcg_shared_module_exports__['fd'](i),a=e.getGeoTokenInfoFromIdentifier(n);t.push(a?e.getItemModel(a.calcId):void 0)}return t}function Fh(r,e={}){let t=r.formula.typed_constant_value.value,o=r.formula.typed_constant_value.valueType;return e.listIndex!==void 0&&__dcg_shared_module_exports__['bb'](o)&&(o=__dcg_shared_module_exports__['cb'](o),t=t[e.listIndex]),{value:t,valueType:o}}function sG(r,e,t){var y,w;let o=t.depth?t.depth:0,i,n=[],a=(y=r.formula.geometry.call)==null?void 0:y.symbol,s=_w(r,e),[l,c]=s,{value:d}=Fh(r,t),[p,u]=d,h=(w=t.poi)==null?void 0:w.ariaLabel,m=h!==void 0&&h!==""?h:r.label;if(r.hidden&&o>=Ma&&typeof p=="number"&&typeof u=="number")return[Jc(e,p,u)];switch(a){case"intersection":m?i=e.s("graphing-calculator-narration-geometry-intersection-with-assignment",{assignment:rn(m)}):i=e.s("graphing-calculator-narration-geometry-unlabeled-intersection",{index:r.id}),o<Ma&&l!==void 0&&c!==void 0?n.push(e.s("graphing-calculator-narration-geometry-intersection-of-items",{intersectionDescription:i,item1:Bi(l,e,{includeDetails:!1,depth:o+1}),item2:Bi(c,e,{includeDetails:!1,depth:o+1})})):n.push(i);break;case"midpoint":m?i=e.s("graphing-calculator-narration-geometry-midpoint-with-assignment",{assignment:rn(m)}):i=e.s("graphing-calculator-narration-geometry-unlabeled-midpoint",{index:r.id}),o<Ma&&l!==void 0?n.push(e.s("graphing-calculator-narration-geometry-midpoint-of-item",{midpointDescription:i,item:Bi(l,e,{includeDetails:!1,depth:o+1})})):n.push(i);break;case"glider":m?i=e.s("graphing-calculator-narration-geometry-glider-with-assignment",{assignment:rn(m)}):i=e.s("graphing-calculator-narration-geometry-unlabeled-glider",{index:r.id}),o<Ma&&l!==void 0?n.push(e.s("graphing-calculator-narration-geometry-glider-on-item",{gliderDescription:i,item:Bi(l,e,{includeDetails:!1,depth:o+1})})):n.push(i);break;default:m?i=e.s("graphing-calculator-narration-geometry-point-with-assignment",{assignment:rn(m)}):i=e.s("graphing-calculator-narration-geometry-unlabeled-point",{index:r.id}),t.includeDetails&&typeof p=="number"&&typeof u=="number"?n.push(e.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:i,coordinates:Jc(e,p,u)})):n.push(i)}return n}function z7(r,e,t){var p,u;let o=t.depth?t.depth:0,i=[],n=_w(r,e),[a]=n,{value:s}=Fh(r,t),l=s[1],c=e.get2dProjection(),d=c&&c.viewport;return o<Ma&&a!==void 0&&$c(a)&&!__dcg_shared_module_exports__['gd']((u=(p=a.formula.geometry)==null?void 0:p.call)==null?void 0:u.symbol)&&typeof l=="number"&&d!==void 0?i.push(e.s("graphing-calculator-narration-geometry-circle-with-center-and-radius",{index:r.id,center:Bi(a,e,{includeDetails:!1,depth:o+1}),radius:Gi(__dcg_shared_module_exports__['Tb'](l,d.xmax-d.xmin).latex)})):i.push(e.s("graphing-calculator-narration-geometry-unlabeled-circle",{index:r.id})),i}function H7(r,e,t){let o=t.depth?t.depth:0,i=[],n=_w(r,e),[a,s,l]=n;return o<Ma&&a!==void 0&&s!==void 0&&l!==void 0?i.push(e.s("graphing-calculator-narration-geometry-arc-through-points",{index:r.id,start:Bi(a,e,{includeDetails:!1,depth:o+1}),middle:Bi(s,e,{includeDetails:!1,depth:o+1}),end:Bi(l,e,{includeDetails:!1,depth:o+1})})):i.push(e.s("graphing-calculator-narration-geometry-unlabeled-arc",{index:r.id})),i}function K7(r,e,t){let o=t.depth?t.depth:0,{value:i}=Fh(r,t),n=i.length;if(t.polygonEdge!==void 0)if(t.polygonEdge>=0&&t.polygonEdge<i.length){let l=i[t.polygonEdge],c=i[(t.polygonEdge+1)%i.length];i=[l,c]}else return[e.s("shared-calculator-narration-item-unknown")];let a,s=[];if(n===3?a=e.s("graphing-calculator-narration-geometry-unlabeled-triangle",{index:r.id}):n===4?a=e.s("graphing-calculator-narration-geometry-unlabeled-quadrilateral",{index:r.id}):n===5?a=e.s("graphing-calculator-narration-geometry-unlabeled-pentagon",{index:r.id}):n===6?a=e.s("graphing-calculator-narration-geometry-unlabeled-hexagon",{index:r.id}):n===7?a=e.s("graphing-calculator-narration-geometry-unlabeled-heptagon",{index:r.id}):n===8?a=e.s("graphing-calculator-narration-geometry-unlabeled-octagon",{index:r.id}):n===9?a=e.s("graphing-calculator-narration-geometry-unlabeled-nonagon",{index:r.id}):n===10?a=e.s("graphing-calculator-narration-geometry-unlabeled-decagon",{index:r.id}):a=e.s("graphing-calculator-narration-geometry-unlabeled-polygon",{index:r.id,sideCount:n}),t.polygonEdge!==void 0){let l=i.length>0?i[0][0]:void 0,c=i.length>0?i[0][1]:void 0,d=i.length>1?i[1][0]:void 0,p=i.length>1?i[1][1]:void 0;t.includeDetails&&o<Ma&&typeof l=="number"&&typeof c=="number"&&typeof d=="number"&&typeof p=="number"?s.push(e.s("graphing-calculator-narration-geometry-item-at-coordinates-to-coordinates",{itemDescription:a,x1:Md(e,l),y1:Ad(e,c),x2:Md(e,d),y2:Ad(e,p)})):s.push(a)}else if(t.includeDetails&&o<Ma){let l=[];if(n<=10){let c=_w(r,e).filter(d=>$c(d)&&d.type==="expression"&&!d.hidden&&Fh(d,t).valueType===__dcg_shared_module_exports__['da']);c.length===n&&c.forEach(d=>{l.push(Bi(d,e,{includeDetails:!1,depth:o+1}))})}l.length?s.push(e.s("graphing-calculator-narration-geometry-polygon-through-vertices",{itemDescription:a,vertices:wu(e.getLanguage(),l)})):s.push(a)}else s.push(a);return s}function W7(r,e,t){var T,I,P;let o=t.depth?t.depth:0,i="",n=[],a=(T=r.formula.geometry.call)==null?void 0:T.symbol,s=r.formula.geometry.listAccess,{value:l,valueType:c}=Fh(r,t),[d,p]=l[0],[u,h]=l[1],m=_w(r,e),y=t.listIndex||0,w=VR(r,y)||r.label,[S,C]=m,v=e.get2dProjection(),E=v&&v.viewport,_=S!==void 0&&C===void 0&&s!==void 0;if(a==="parallel")o<Ma&&S!==void 0&&C!==void 0?n.push(e.s("graphing-calculator-narration-geometry-parallel-to-line-through-point",{index:r.id,line:Bi(S,e,{includeDetails:!1,depth:o+1}),point:Bi(C,e,{includeDetails:!1,depth:o+1})})):r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-parallel")):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-parallel"):n.push(e.s("graphing-calculator-narration-geometry-unlabeled-parallel-with-index",{index:r.id}));else if(a==="perpendicular")o<Ma&&S!==void 0&&C!==void 0?n.push(e.s("graphing-calculator-narration-geometry-perpendicular-to-line-through-point",{index:r.id,line:Bi(S,e,{includeDetails:!1,depth:o+1}),point:Bi(C,e,{includeDetails:!1,depth:o+1})})):r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-perpendicular")):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-perpendicular"):n.push(e.s("graphing-calculator-narration-geometry-unlabeled-perpendicular-with-index",{index:r.id}));else if(c===__dcg_shared_module_exports__['wa'])r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-line")):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-line"):i=e.s("graphing-calculator-narration-geometry-unlabeled-line-with-index",{index:r.id});else if(c===__dcg_shared_module_exports__['ya']){if(r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-ray")):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-ray"):i=e.s("graphing-calculator-narration-geometry-unlabeled-ray-with-index",{index:r.id}),m.length===1&&(S==null?void 0:S.type)==="expression"&&(((I=S==null?void 0:S.formula.geometry)==null?void 0:I.valueType)===__dcg_shared_module_exports__['Aa']||((P=S==null?void 0:S.formula.geometry)==null?void 0:P.valueType)===__dcg_shared_module_exports__['Ca'])){let O=Bi(S,e,{includeDetails:!1,depth:o+1});i=e.s("graphing-calculator-narration-geometry-anglebisector-of-item",{bisectorDescription:i,item:O})}}else if(c===__dcg_shared_module_exports__['qa']){if(r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-segment")):w?i=e.s("graphing-calculator-narration-geometry-segment-with-assignment",{assignment:rn(w)}):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-segment"):i=e.s("graphing-calculator-narration-geometry-unlabeled-segment-with-index",{index:r.id}),t.includeDetails&&o<Ma&&w===""&&s===void 0&&E!==void 0&&typeof d=="number"&&typeof p=="number"&&typeof u=="number"&&typeof h=="number"){let O=u-d,W=h-p,X=Math.sqrt(O*O+W*W);isNaN(X)||(i=e.s("graphing-calculator-narration-geometry-segment-length",{segmentDescription:i,length:Gi(__dcg_shared_module_exports__['Tb'](X,E.xmax-E.xmin).latex)}))}}else c===__dcg_shared_module_exports__['Ga']&&(r.hidden&&o>=Ma?n.push(e.s("graphing-calculator-narration-geometry-hidden-vector")):_?i=e.s("graphing-calculator-narration-geometry-unlabeled-vector"):i=e.s("graphing-calculator-narration-geometry-unlabeled-vector-with-index",{index:r.id}));return i!==""&&o<Ma&&(S!==void 0&&C!==void 0?n.push(e.s("graphing-calculator-narration-geometry-straight-from-item-to-item",{straightType:i,start:Bi(S,e,{includeDetails:!1,depth:o+1}),end:Bi(C,e,{includeDetails:!1,depth:o+1})})):_&&n.push(e.s("graphing-calculator-narration-geometry-straight-index-of-item",{straightType:i,index:s,item:Bi(S,e,{includeDetails:!1,depth:o+1})}))),!n.length&&i&&n.push(i),n}function $7(r,e,t){var y;let o=t.depth?t.depth:0,i=t.listIndex?t.listIndex:0,n="",a=[],{valueType:s}=Fh(r,t),l=VR(r,i)||r.label,c="",d=(y=e.getGrapher())==null?void 0:y.getGraphSketch(r.id);if(d&&"labels"in d){let S=d.labels[i];S&&"text"in S&&(c=rn(S.text))}s===__dcg_shared_module_exports__['Aa']?l?n=e.s("graphing-calculator-narration-geometry-labeled-angle",{label:rn(l)}):c?n=e.s("graphing-calculator-narration-geometry-unlabeled-angle-with-measurement",{index:r.id,measurementText:c}):n=e.s("graphing-calculator-narration-geometry-unlabeled-angle",{index:r.id}):s===__dcg_shared_module_exports__['Ca']&&(l?n=e.s("graphing-calculator-narration-geometry-labeled-directed-angle",{label:rn(l)}):c?n=e.s("graphing-calculator-narration-geometry-unlabeled-directed-angle-with-measurement",{index:r.id,measurementText:c}):n=e.s("graphing-calculator-narration-geometry-unlabeled-directed-angle",{index:r.id}));let p=_w(r,e),[u,h,m]=p;return o<Ma&&u!==void 0&&"hidden"in u&&!u.hidden&&h!==void 0&&"hidden"in h&&!h.hidden&&m!==void 0&&"hidden"in m&&!m.hidden?a.push(e.s("graphing-calculator-narration-geometry-angle-through-points",{itemDescription:n,parent1:Bi(u,e,{includeDetails:!1,depth:o+1}),parent2:Bi(h,e,{includeDetails:!1,depth:o+1}),parent3:Bi(m,e,{includeDetails:!1,depth:o+1})})):o<Ma&&u!==void 0&&"hidden"in u&&!u.hidden&&h===void 0&&m===void 0?a.push(e.s("graphing-calculator-narration-geometry-angle-of-polygon",{itemDescription:n,parent:Bi(u,e,{includeDetails:!1,depth:o+1})})):a.push(n),a}function j7(r,e,t){let{value:o,valueType:i}=Fh(r,t),n=[],a=o.length;switch(__dcg_shared_module_exports__['cb'](i)){case __dcg_shared_module_exports__['da']:n.push(e.s("graphing-calculator-narration-geometry-list-of-points",{count:a}));break;case __dcg_shared_module_exports__['sa']:n.push(e.s("graphing-calculator-narration-geometry-list-of-circles",{count:a}));break;case __dcg_shared_module_exports__['ua']:n.push(e.s("graphing-calculator-narration-geometry-list-of-arcs",{count:a}));break;case __dcg_shared_module_exports__['oa']:n.push(e.s("graphing-calculator-narration-geometry-list-of-polygons",{count:a}));break;case __dcg_shared_module_exports__['wa']:n.push(e.s("graphing-calculator-narration-geometry-list-of-lines",{count:a}));break;case __dcg_shared_module_exports__['ya']:n.push(e.s("graphing-calculator-narration-geometry-list-of-rays",{count:a}));break;case __dcg_shared_module_exports__['qa']:n.push(e.s("graphing-calculator-narration-geometry-list-of-segments",{count:a}));break;case __dcg_shared_module_exports__['Aa']:n.push(e.s("graphing-calculator-narration-geometry-list-of-angles",{count:a}));break;case __dcg_shared_module_exports__['Ca']:n.push(e.s("graphing-calculator-narration-geometry-list-of-directed-angles",{count:a}));break;default:n.push(e.s("graphing-calculator-narration-geometry-list-of-any",{count:a}));break}return n[0]=`${n[0]}.`,n}var Y7=1,X7=2,J7=4,Q7=8,dG=15,Z7=12,e9=3,t9=1,r9=2,o9=3,i9=4,fb=5,Tw=6;function bm(r,e,t){let o=[],i=r.length;if(t===fb)for(let n=0;n<i;n+=2){let a=e.mapX(r[n]),s=e.mapY(r[n+1]);o.push(a,s)}else if(t===Tw)for(let n=0;n<i;n+=2){let a=e.mapX(r[n+1]),s=e.mapY(r[n]);o.push(a,s)}else if(t===t9)for(let n=0;n<r.length;n+=2){let a=r[n],s=r[n+1],l=e.mapX(s*Math.cos(a)),c=e.mapY(s*Math.sin(a));o.push(l,c)}else if(t===r9)for(let n=0;n<r.length;n+=2){let a=r[n],s=r[n+1];s<0&&(s=0);let l=e.mapX(s*Math.cos(a)),c=e.mapY(s*Math.sin(a));o.push(l,c)}else if(t===o9)for(let n=0;n<r.length;n+=2){let a=r[n]*Math.PI/180,s=r[n+1],l=e.mapX(s*Math.cos(a)),c=e.mapY(s*Math.sin(a));o.push(l,c)}else if(t===i9)for(let n=0;n<r.length;n+=2){let a=r[n]*Math.PI/180,s=r[n+1];s<0&&(s=0);let l=e.mapX(s*Math.cos(a)),c=e.mapY(s*Math.sin(a));o.push(l,c)}return o}function n9(r,e){return HR(r,e,dG,!0)}function a9(r,e){return yae(r,e,dG,!0)}function lG(r,e,t,o){let i=[],n,a,s,l;o?(a=r[0],s=r[1],n=2,l=e(a,s),l&&i.push(a,s)):(a=r[r.length-2],s=r[r.length-1],n=0,l=e(a,s));for(let c=n;c<r.length;c+=2){let d=a,p=s,u=l;a=r[c],s=r[c+1],l=e(a,s),!(!l&&!u)&&(l&&u&&i.push(a,s),l&&!u&&(i.push(...t(a,s,d,p)),i.push(a,s)),!l&&u&&i.push(...t(d,p,a,s)))}return i}function cG(r,e,t,o){let i=[[]],n=0,a,s,l,c;o?(s=r[0],l=r[1],a=2,c=e(s,l),c&&i[n].push(s,l)):(s=r[r.length-2],l=r[r.length-1],a=0,c=e(s,l));for(let d=a;d<r.length;d+=2){let p=s,u=l,h=c;s=r[d],l=r[d+1],c=e(s,l),!(!c&&!h)&&(c&&h&&i[n].push(s,l),c&&!h&&(i[n].push(...t(s,l,p,u)),i[n].push(s,l)),!c&&h&&(i[n].push(...t(p,u,s,l)),n++,i[n]=[]))}return i.filter(d=>d.length>0)}var s9=r=>function(e,t){return e>=r},l9=r=>function(e,t){return e<=r},c9=r=>function(e,t){return t>=r},d9=r=>function(e,t){return t<=r},p9=r=>function(e,t,o,i){let n=i-t;return[r,t+n*(r-e)/(o-e)]},u9=r=>function(e,t,o,i){let n=i-t;return[r,t+n*(r-e)/(o-e)]},h9=r=>function(e,t,o,i){let n=o-e;return[e+n*(r-t)/(i-t),r]},g9=r=>function(e,t,o,i){let n=o-e;return[e+n*(r-t)/(i-t),r]};function HR(r,e,t,o){let i=r;return t&J7&&(i=lG(r,s9(e.xmin),p9(e.xmin),o)),t&X7&&(i=lG(i,c9(e.ymin),h9(e.ymin),o)),t&Q7&&(i=lG(i,l9(e.xmax),u9(e.xmax),o)),t&Y7&&(i=lG(i,d9(e.ymax),g9(e.ymax),o)),i}function yae(r,e,t,o){let i=[r];return t&J7&&(i=__dcg_shared_module_exports__['x'](i.map(n=>cG(n,s9(e.xmin),p9(e.xmin),o)),!0)),t&X7&&(i=__dcg_shared_module_exports__['x'](i.map(n=>cG(n,c9(e.ymin),h9(e.ymin),o)),!0)),t&Q7&&(i=__dcg_shared_module_exports__['x'](i.map(n=>cG(n,l9(e.xmax),u9(e.xmax),o)),!0)),t&Y7&&(i=__dcg_shared_module_exports__['x'](i.map(n=>cG(n,d9(e.ymax),g9(e.ymax),o)),!0)),i}function m9(r,e,t){let o=[],i=r[0],n=i+t,a=[];o.push(a);for(let s=0;s<r.length;s+=2){let l=r[s],c=r[s+1];if(c<0&&(c=0),l>=n){for(a=[],o.push(a),i=r[s-2],n=i;l>=n;)n+=t;s-=4}else a.push(l,c)}if(e===0)for(let s=0;s<o.length;s++)o[s].push(0,0);else{let s=t/16,l=e;for(let c=0;c<o.length;c++){let d=o[c];i=d[0],n=d[d.length-2];for(let p=n;p>i;p-=s)d.push(p,l);d.push(i,l)}}return o}function KR(r,e){return r=r.slice(),r.push(r[r.length-2],e),r.push(r[0],e),[r]}function bC(r,e,t){switch(r){case 1:return Tw;case 8:case 5:case 2:return fb;case 6:return t.degreeMode?e?i9:o9:e?r9:t9}}function yb(r,e,t,o=3){let[i,n,a,s]=r,{x:l,y:c}=e.mathToPixels.mapPoint({x:i,y:n}),{x:d,y:p}=e.mathToPixels.mapPoint({x:a,y:s}),u=Math.min(o,Math.max(e.screen.width,e.screen.height)),h={xmin:-u,ymin:-u,xmax:e.screen.width+u,ymax:e.screen.height+u},m=l-d,y=c-p,w=-m,S=-y,C=l-h.xmin,v=h.xmax-l,E=c-h.ymin,_=h.ymax-c,T=[],I=[];if(m!==0){let R=C/m,N=v/w;m<0?(T.push(R),I.push(N)):(T.push(N),I.push(R))}if(y!==0){let R=E/y,N=_/S;y<0?(T.push(R),I.push(N)):(T.push(N),I.push(R))}(t===17||t===24)&&(T.push(0),I.push(1)),t===19&&T.push(0);let P=Math.max(...T),O=Math.min(...I);if(P>O)return{mapped:[l,c,d,p],clipped:[]};let W=l+w*P,X=c+S*P,x=l+w*O,L=c+S*O;return W<h.xmin&&x<h.xmin||W>h.xmax&&x>h.xmax||X<h.ymin&&L<h.ymin||X>h.ymax&&L>h.ymax?{mapped:[l,c,d,p],clipped:[]}:{mapped:[l,c,d,p],clipped:[W,X,x,L]}}var qs=class{constructor(e,t,o){this.pattern=o,this.replen=this.pattern[0]+this.pattern[1],t/this.replen>1e3&&(this.pattern[0]=t*this.pattern[0]/this.replen/1e3,this.pattern[1]=t*this.pattern[1]/this.replen/1e3),this.pstate=0,this.dstaccum=0,this.px=null,this.py=null,this.ctx=e}static getDashedPattern(e,t){let o=e.lineWidth*11/(t?3.5:2.5),i=o*7/11;return[o,i]}static getDottedPattern(e,t,o){let i=.5*e.lineWidth*.1/(o?3.5:2.5),n=i*8/.1;return t&&(n*=2),[i,n]}static getTotalSegmentLength(e){if(e.length<4)return 0;let t=0,o=0,i=e[0],n=e[1];for(;isNaN(i)||isNaN(n);){if(o+=2,o>=e.length)return 0;i=e[o],n=e[o+1]}let a,s;for(o+=2;o<e.length;o+=2)a=e[o],s=e[o+1],!(isNaN(a)||isNaN(s))&&(t+=__dcg_shared_module_exports__['Lb'](a-i,s-n),i=a,n=s);return t}start(e,t){this.px=e,this.py=t}next(e,t){if(this.px===null||this.py===null)throw new Error("Must call start before calling next");let o=this.pattern[this.pstate],i=Math.sqrt(Math.pow(e-this.px,2)+Math.pow(t-this.py,2));if(i>1e-5){for(;i+this.dstaccum>=o;){let n=e-this.px,a=t-this.py,s=o-this.dstaccum;n*=s/i,a*=s/i,this.pstate===0&&(this.ctx.moveTo(this.px,this.py),this.ctx.lineTo(this.px+n,this.py+a)),this.dstaccum=0,this.px+=n,this.py+=a,this.pstate=this.pstate===0?1:0,o=this.pattern[this.pstate],i-=s}this.pstate===0&&(this.ctx.moveTo(this.px,this.py),this.ctx.lineTo(e,t))}this.px=e,this.py=t,this.dstaccum+=i}close(){this.pstate=0,this.dstaccum=0,this.px=null,this.py=null}drawSegment(e){let t=0,o=e[0],i=e[1];for(;isNaN(o)||isNaN(i);){if(t+=2,t>=e.length)return;o=e[t],i=e[t+1]}this.start(o,i);let n,a;for(t+=2;t<e.length;t+=2)n=e[t],a=e[t+1],!(isNaN(n)||isNaN(a))&&this.next(n,a);this.close()}};function Ui(r,e){let t=r;t._dcgSaveClassName&&t._dcgSaveClassName(e)}function Si(r){let e=r;e._dcgRestoreClassName&&e._dcgRestoreClassName()}var Nh,xb=new Map,pG=0;function f9(r,e,t){let o=r.imageObj;if(Nh&&Nh.color===e&&Nh.img===o)return Nh.canvas;Nh?(Nh.color=e,Nh.img=o):Nh={color:e,img:o,canvas:document.createElement("canvas")};let i=Nh.canvas,n=r.mimeType==="image/svg+xml";i.width=0,i.width=n?t.width:o.width,i.height=n?t.height:o.height;let a=i.getContext("2d");return a.drawImage(o,0,0,i.width,i.height),a.fillStyle=e,a.globalCompositeOperation="source-atop",a.fillRect(0,0,i.width,i.height),i}function wae(r,e){if(e.width*e.height>1e3*1e3*window.devicePixelRatio*window.devicePixelRatio)return r.imageObj;let t=r.image_url,o=xb.get(t),i;if(!o||e.width!==o.size.width||e.height!==o.size.height){o&&(xb.delete(t),pG-=o.canvas.width*o.canvas.height);let n=r.imageObj,a=document.createElement("canvas");a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(n,0,0,a.width,a.height);let l=20*1e3*1e3;if(a.width*a.height>l)return r.imageObj;for(pG+=a.width*a.height;pG>l;){let[c,d]=Array.from(xb)[0];xb.delete(c),pG-=d.canvas.width*d.canvas.height}xb.set(t,{canvas:a,size:e}),i=a}else xb.delete(t),xb.set(t,o),i=o.canvas;return i}function b9(r,e,t,o={cacheRenderedSvgs:!1}){let{ctx:i,projection:n}=r,a=e.formula;if(!a||!a.dimensions.x)return;let s=a.dimensions;for(let l=0;l<s.x.length;l++){let c=s.x[l],d=s.y[l],p=s.width[l],u=s.height[l],h=s.radianAngle[l];if(!isFinite(c)||!isFinite(d)||!isFinite(p)||!isFinite(u)||!isFinite(h))continue;Ui(i,"dcg-svg-image"),i.save(),Si(i),i.globalAlpha=s.opacity[l];let m=n.mapy(u)-n.mapy(0),y=n.mapx(p)-n.mapx(0),w=h===0?1:Math.abs(y/p*(u/m)),S=n.mapx(c),C=n.mapy(d),v=S-y/2,E=C+m*w/2,_=u<0?-1:1,T=p<0?-1:1,I=v*T,P=E*_,O=Math.abs(y),W=Math.abs(m);h!==0&&(i.translate(S,C),i.scale(1,1/w),i.rotate(h),i.translate(-S,-C)),i.scale(T,_);let X=t.shouldDrawHovered(r,e.id,l),x=t.shouldDrawPressed(e.id,l),L=o.currentKeyboardAttention&&o.currentKeyboardAttention.calcId===e.id&&(o.currentKeyboardAttention.listIndex===void 0||o.currentKeyboardAttention.listIndex===l),N=e.imageObj,z=window.devicePixelRatio*(n.screen.width/n.screen.height),A={width:Math.floor(O*z),height:Math.floor(W*z)};x?e.depressedImageObj?N=e.depressedImageObj:N=f9(e,"rgba(50,50,50,0.2)",A):X?e.hoveredImageObj?N=e.hoveredImageObj:N=f9(e,"rgba(200,200,200,0.2)",A):o.cacheRenderedSvgs&&e.mimeType==="image/svg+xml"&&A.width>0&&A.height>0&&(N=wae(e,A)),i.drawImage(N,I,P,O,W*w);let U=0,pe=3;if(Za(e)&&e.controller.isTraceEnabled()&&(i.beginPath(),i.rect(I-U,P-U,O+2*U,W*w+2*U),i.restore(),i.save(),i.strokeStyle="#6993C7",i.lineWidth=pe,i.stroke()),L){let q=i.globalAlpha;U=5,i.beginPath(),i.roundRect?i.roundRect(I-U,P-U,O+2*U,W*w+2*U,U):i.rect(I-U,P-U,O+2*U,W*w+2*U),i.restore(),i.save(),i.strokeStyle=__dcg_shared_module_exports__['Zd'].FOCUS_OUTLINE,i.globalAlpha=1,i.lineWidth=pe,i.stroke(),i.globalAlpha=q}i.restore()}}function y9(r){return r.uncommitted?"#ccc":!r.selected&&!r.hovered&&x9(r)===1?__dcg_shared_module_exports__['Sd'](r.color,.2):r.color}function x9(r){let e=.6;return r.hidden?r.selected?e=.4:e=.25:r.selected||r.isPoint?e=1:r.hovered&&(e=.8),r.isTransparentObject&&(e*=.3),e}function vae(r){return r.hidden?r.isPoint?0:r.selected?.3:.2:r.selected||r.isPoint||r.hovered?1:.7}function w9(r,e){r=r.replace(/#/,"");let t,o,i;return r.length===3?(t=parseInt(r.slice(0,1)+r.slice(0,1),16),o=parseInt(r.slice(1,2)+r.slice(1,2),16),i=parseInt(r.slice(2,3)+r.slice(2,3),16)):r.length===6?(t=parseInt(r.slice(0,2),16),o=parseInt(r.slice(2,4),16),i=parseInt(r.slice(4,6),16)):(t=0,o=0,i=0),`rgba(${t}, ${o}, ${i}, ${e})`}function yC(r){return w9(y9(r),vae(r))}function uG(r){return w9(y9(r),x9(r))}function hG(r){return Math.abs(Math.abs(r)-Math.PI/2)<1e-6}function Rl(r,e){let t=r;t._dcgStartNamedGroup&&t._dcgStartNamedGroup(e)}function xC(r,e){let t=r;t._dcgSetTitle&&t._dcgSetTitle(e)}function Fl(r){let e=r;e._dcgEndNamedGroup&&e._dcgEndNamedGroup()}var ym=10,xm=3;function mG(r,e){return r+1e-8*(e-r)>r&&e-r>1e-300&&e-r<1e300}function v9(r,e){return r>1e-300&&mG(r,e)}var Co=class r{constructor(e=-10,t=10,o=-10,i=10,n=-2,a=2){this.xmin=e,this.xmax=t,this.ymin=o,this.ymax=i,this.zmin=n,this.zmax=a}static fromObject({xmin:e,xmax:t,ymin:o,ymax:i,zmin:n,zmax:a}){return new r(e,t,o,i,n,a)}toObject(){return{xmin:this.xmin,ymin:this.ymin,zmin:this.zmin,xmax:this.xmax,ymax:this.ymax,zmax:this.zmax}}equals(e){return!(this.xmin!==e.xmin||this.ymin!==e.ymin||this.zmin!==e.zmin||this.xmax!==e.xmax||this.ymax!==e.ymax||this.zmax!==e.zmax)}isXValid(e){return e==="linear"?mG(this.xmin,this.xmax):v9(this.xmin,this.xmax)}isYValid(e){return e==="linear"?mG(this.ymin,this.ymax):v9(this.ymin,this.ymax)}isZValid(){return this.zmin===void 0||this.zmax===void 0?!1:mG(this.zmin,this.zmax)}isValid(e){return this.isXValid(e.xAxisScale)&&this.isYValid(e.yAxisScale)}isSquare(e,t){return Math.abs(e.height-e.width*this.aspectRatio(t))<1}isSquare3D(){let{xmin:e,xmax:t,ymin:o,ymax:i,zmin:n,zmax:a}=this;if(n===void 0||a===void 0)return!1;let s=[t-e,i-o,a-n];return Math.min(...s)/Math.max(...s)>.99999}aspectRatio(e){let t=ym/xm,o=e.yAxisScale==="linear"?this.ymax-this.ymin:Math.log10(this.ymax/this.ymin)*t,i=e.xAxisScale==="linear"?this.xmax-this.xmin:Math.log10(this.xmax/this.xmin)*t;return o/i}getSquaredAxisLimits({axis:e,screen:t,settings:o}){let[i,n,a,s,l]=e==="y"?[{min:this.ymin,max:this.ymax},{min:this.xmin,max:this.xmax},t.height/t.width,o.yAxisScale,o.xAxisScale]:[{min:this.xmin,max:this.xmax},{min:this.ymin,max:this.ymax},t.width/t.height,o.xAxisScale,o.yAxisScale];if(s==="logarithmic"){let d=l==="logarithmic"?Math.log(n.max)-Math.log(n.min):(n.max-n.min)*xm/(ym*Math.LOG10E),{min:p,max:u}=C9({min:Math.log(i.min),max:Math.log(i.max)},a*d);return{min:Math.exp(p),max:Math.exp(u)}}let c=l==="logarithmic"?(Math.log10(n.max)-Math.log10(n.min))*ym/xm:n.max-n.min;return C9(i,c*a)}squareXAxis(e,t){let{min:o,max:i}=this.getSquaredAxisLimits({axis:"x",screen:e,settings:t}),n=new r(o,i,this.ymin,this.ymax);return n.isXValid(t.xAxisScale)?n:this}squareYAxis(e,t){let{min:o,max:i}=this.getSquaredAxisLimits({axis:"y",screen:e,settings:t}),n=new r(this.xmin,this.xmax,o,i);return n.isYValid(t.yAxisScale)?n:this}squareCrop(e,t){return this.aspectRatio({xAxisScale:t.xAxisScale,yAxisScale:t.yAxisScale})>e.height/e.width?this.squareYAxis(e,t):this.squareXAxis(e,t)}polarDiameter(){let e=Math.abs(this.xmax),t=Math.abs(this.xmin),o=Math.abs(this.ymax),i=Math.abs(this.ymin);return 1.5*Math.max(e,t,o,i)}largestR(){return Math.sqrt(Math.pow(Math.max(-this.xmin,this.xmax),2)+Math.pow(Math.max(-this.ymin,this.ymax),2))}smallestR(){return this.xmin<=0&&this.xmax>=0&&this.ymin<=0&&this.ymax>=0?0:this.xmin<=0&&this.xmax>=0?Math.min(Math.abs(this.ymin),Math.abs(this.ymax)):this.ymin<=0&&this.ymax>=0?Math.min(Math.abs(this.xmin),Math.abs(this.xmax)):Math.sqrt(Math.pow(Math.max(this.xmin,-this.xmax),2)+Math.pow(Math.max(this.ymin,-this.ymax),2))}};function C9(r,e){let t=.5*(r.min+r.max),[o,i]=[t-.5*e,t+.5*e];return Math.abs((i-o)/e-1)>.1?{min:-.5*e,max:.5*e}:{min:o,max:i}}var fG=1.4,E9=1.5,yG={};function G9(r={}){return Object.keys(r).length}function bG(r,e={}){return G9(e)===0?r:r.filter((t,o)=>!e[o])}function D9(r,e){let t=[];for(let o=0;o<r;o++)t.push(e);return t}function Dae(){return!!Object.keys(yG).length}var I9=function(r,e){let t=3;return e&&(t+=e),new Co(-t,r.width+t,-t,r.height+t)};function k9(r,e){let{displayAsRightAngle:t,rx:o,ry:i,startAngle:n,deltaAngle:a,yscreen:s,xscreen:l}=r;if(t){let c=o*Math.cos(-n),d=o*Math.cos(-n-a),p=i*Math.sin(-n),u=i*Math.sin(-n-a);e.moveTo(l+c,s+p),e.lineTo(l+c+d,s+p+u),e.lineTo(l+d,s+u)}else e.ellipse(l,s,o,i,0,-n,-n-a,a>0)}var Su=class r{constructor(e,t,o){if(this.controller=e,this.getExpressionAriaLabel=o,t.config.plaidMode){let i=["RED","BLUE","GREEN","PURPLE","ORANGE","BLACK"];for(let n of i)yG[__dcg_shared_module_exports__['Zd'][n]]=document.createElement("img"),yG[__dcg_shared_module_exports__['Zd'][n]].setAttribute("src","/assets/img/april-fools/"+n.toLowerCase()+".png")}}redrawToCtx(e,t,o,i,n,a){let{ctx:s,projection:l}=e;Rl(s,"expressions");let c=l.settings.highlight,d=this.controller.isGeometry();i.forEach(p=>{let u=t[p],h=o[p];u!==void 0&&(d&&l.settings.setProperty("highlight",u.showHighlight),Rl(s,"sketch"),l.settings.takingScreenshot&&xC(s,this.getExpressionAriaLabel(p)),r.drawSketchToCtx({sketch:t[p],drawContext:e,poiLabelsLayer:n,clickableObjectsLayer:a,geometryContext:this.controller.getGeoModel()}),Fl(s)),h&&h.shouldGraph&&b9(e,h,a,{currentKeyboardAttention:this.controller.get2dPOIController().keyboardAttentionManager.getKeyboardAttention(),cacheRenderedSvgs:this.controller.getGraphSettings().config.cacheRenderedSvgs})}),Fl(s),l.settings.setProperty("highlight",c)}static eachSegment(e,t){for(let o of e.branches)if(o.graphMode!==15)for(let i of o.segments)t(o,i)}static drawSketchToCtx({sketch:e,drawContext:t,poiLabelsLayer:o,clickableObjectsLayer:i,geometryContext:n}){var h,m,y,w,S;if(!e.branches||!e.branches.length)return;let{ctx:a,projection:s}=t,l=a.lineWidth,c=a.globalAlpha,d=s.settings.globalCurveColor?s.settings.globalCurveColor:e.color,p=yG[d],u;p&&p.complete&&p.naturalWidth>0?u=a.createPattern(p,"repeat"):u=d,a.lineJoin="round",a.lineCap="round";for(let C of e.branches){if(__dcg_shared_module_exports__['ge'](C)||C.graphMode===15||C.graphMode===22)continue;let v=1;i.shouldDrawHovered(t,e.id,C.listIndex)&&(v=C_.IS_HOVERED),i.shouldDrawPressed(e.id,C.listIndex)&&(v=C_.IS_PRESSED),i.shouldDrawGhosted(e.id)&&(v=C_.IS_GHOSTED),v*=(h=n==null?void 0:n.getToolFadeOpacity(e.id))!=null?h:1,v*=s.settings.getFillOpacityMultiplier(),a.strokeStyle=d,a.fillStyle=C.color&&!s.settings.globalCurveColor&&!Dae()?C.color:u,C.graphMode!==6&&(a.kiavash_batching=!0,a.beginPath());let E=C.graphMode===6?.2:(m=C.fillOpacity)!=null?m:NaN;a.globalAlpha=r._clampedOpacity(E*v,.4);let _=jR(s,C);for(let T of _)r.fillPolygonFillToCtx(a,T);C.graphMode!==6&&(a.fill(),a.kiavash_batching=!1),a.globalAlpha=1;for(let T of C.segments){let I=2;C.graphMode&&(I=C.graphMode);let P=T,O=C.lineWidth!==void 0,W=C.lineWidth,X=2.5,x=(y=C.arrowMode)!=null?y:"DEFAULT";if(a.strokeStyle=C.color,a.fillStyle=C.color,O&&(W<=0||!isFinite(W)))continue;a.lineWidth=O?W:X;let L=s.settings.graphLineWidth/X,R=1.3;s.settings.highlight&&(R*=5/7),e.tokenSelected?(L*=E9,R/=E9):e.tokenHovered&&(L*=fG,R/=fG),a.lineWidth*=L,a.globalAlpha*=s.settings.curveOpacity,a.globalAlpha=r._clampedOpacity(s.settings.curveOpacity===1?1:C.lineOpacity,1);let N=C.operator,z="default";N==="<"||N===">"||N==="!="?z="DASHED":N==="<="||N===">="?z="SOLID":e.style==="DASHED"||C.style==="DASHED"?z="DASHED":(e.style==="DOTTED"||C.style==="DOTTED")&&(z="DOTTED",O&&(a.lineWidth*=2)),a.globalAlpha*=(w=n==null?void 0:n.getToolFadeOpacity(e.id))!=null?w:1;let A=!C.isIntersectionExtension&&i.shouldDrawHovered(t,e.id,C.listIndex),U=!C.isIntersectionExtension&&i.shouldDrawPressed(e.id,C.listIndex),pe=i.shouldDrawGhosted(e.id);pe?a.globalAlpha*=w2.IS_GHOSTED:(U||A)&&(a.save(),a.lineWidth+=4.5,a.globalAlpha*=U?w0.IS_DEPRESSED:w0.IS_HOVERED,r.drawGraphStrokeToCtx(a,s,P,{type:z,graphMode:I,op:N,arrowMode:x,arrowHeadBaseWidth:(a.lineWidth-4.5)*R,opacityMultiplier:U?w0.IS_DEPRESSED:w0.IS_HOVERED}),a.restore()),r.drawGraphStrokeToCtx(a,s,P,{type:z,graphMode:I,op:N,arrowMode:x,arrowHeadBaseWidth:a.lineWidth*R,opacityMultiplier:((S=n==null?void 0:n.getToolFadeOpacity(e.id))!=null?S:1)*(pe?w2.IS_GHOSTED:v0)})}}a.lineWidth=l,a.globalAlpha=c,a.strokeStyle=d,r.eachSegment(e,(C,v)=>{var E;if((C.graphMode===3||C.graphMode===25)&&C.showPoint){let _=v,T=[],I;if(C.interactiveLabel&&e.labels)for(let z=0,A=e.labels.length;z<A;z++){let U=e.labels[z];if(U.type==="poi"){let pe=o.isOpenPOI(U.poi),q=o.getHoveredPOI()===U.poi;T.push(pe||q),!pe&&q&&(I=z)}}let P=1;typeof C.pointSize=="number"?P=C.pointSize/8:Array.isArray(C.pointSize)&&(P=C.pointSize.map(z=>z/8));let O;Array.isArray(C.color)&&(O=C.color);let W=i.getHoveredObjectById(e.id),X=i.shouldDrawHovered(t,e.id,void 0),x=i.getPressedObject(),L=i.shouldDrawPressed(e.id,x==null?void 0:x.listIndex),R=i.shouldDrawGhosted(e.id),N=C.droppedIndices;if((X||L)&&!R){let z=_.length;N&&(z+=G9(N));let A=D9(z,0),U=Array.isArray(P)?P.slice():D9(z,P);L&&x?x.listIndex===void 0?(A=A.map(()=>S_.IS_DEPRESSED),U=U.map(pe=>pe*1.5)):(A[x.listIndex]=S_.IS_DEPRESSED,U[x.listIndex]*=1.5):X&&W&&(A=A.map((pe,q)=>W.listIndexes===void 0||W.listIndexes[q]?S_.IS_HOVERED:pe),U=U.map((pe,q)=>W.listIndexes===void 0||W.listIndexes[q]?pe*1.5:pe)),r.drawPointsToCtx({ctx:a,projection:s,segment:_,style:C.style,sizeOverrideIdxs:T,opacityOverrideIdx:I,sizeFactor:U,opacityFactor:A,colorOverrides:O,baseOpacity:C.pointOpacity,droppedIndices:N,sketch:e,isKeyboardFocused:i.isKeyboardFocused(e.id,void 0)}),a.restore()}r.drawPointsToCtx({ctx:a,projection:s,segment:_,style:C.style,sizeOverrideIdxs:T,opacityOverrideIdx:I,sizeFactor:P,opacityFactor:((E=n==null?void 0:n.getToolFadeOpacity(e.id))!=null?E:1)*(R?E_.IS_GHOSTED:v0),colorOverrides:O,baseOpacity:C.pointOpacity,droppedIndices:N,sketch:e})}})}static drawGraphStrokeToCtx(e,t,o,i){let n={arrowHeadBaseWidth:e.lineWidth},{type:a,graphMode:s,op:l,arrowMode:c,arrowHeadBaseWidth:d}=Object.assign({},n,i);if(s===20||s===21){let[y,w,S]=o,C=t.mathToPixels.mapX(y),v=t.mathToPixels.mapY(w),E=t.mathToPixels.dangerouslyGetXScaleFactor(),_=t.mathToPixels.dangerouslyGetYScaleFactor(),T=Math.abs(S*E),I=Math.abs(S*_),P,O;if(s===21?(P=-o[3],O=-o[4]):(P=0,O=2*Math.PI),e.save(),Ui(e,"dcg-svg-curve"),e.kiavash_batching||e.beginPath(),a==="DASHED"){let W=qs.getDashedPattern(e,!!t.settings.highlight);e.setLineDash(W)}else if(a==="DOTTED"){let W=qs.getDottedPattern(e,!!t.settings.config.projectorMode,!!t.settings.highlight);e.setLineDash(W)}e.ellipse(C,v,T,I,0,P,O,P>O),e.kiavash_batching||e.stroke(),Si(e),e.restore();return}else if(s===23){let[y,w,S,C,v]=o,E=!v&&hG(C),_=vm(C,t),T=t.mathToPixels.mapX(y),I=t.mathToPixels.mapY(w),P=t.mathToPixels.dangerouslyGetXScaleFactor(),O=t.mathToPixels.dangerouslyGetYScaleFactor(),W=P>O?P/O:1,X=P>O?1:O/P,x=Math.abs(W*_),L=Math.abs(X*_);if(e.save(),Ui(e,"dcg-svg-curve"),e.globalAlpha=.4*i.opacityMultiplier,e.kiavash_batching||e.beginPath(),e.moveTo(T,I),e.lineTo(T+x*Math.cos(-S),I+L*Math.sin(-S)),k9({displayAsRightAngle:E,rx:x,ry:L,startAngle:S,deltaAngle:C,yscreen:I,xscreen:T},e),e.lineTo(T,I),!e.kiavash_batching&&!v&&e.fill(),e.globalAlpha=i.opacityMultiplier,e.kiavash_batching||e.beginPath(),k9({displayAsRightAngle:E,rx:x,ry:L,startAngle:S,deltaAngle:C,yscreen:I,xscreen:T},e),v){let R=-S-C,N=T+x*Math.cos(R),z=I+L*Math.sin(R);YR(e,N,z,-S,-C,10,x)}e.globalAlpha=i.opacityMultiplier,e.kiavash_batching||e.stroke(),e.lineWidth=1.5,e.globalAlpha=.2*i.opacityMultiplier,e.moveTo(T+1.5*x*Math.cos(-S),I+1.5*L*Math.sin(-S)),e.lineTo(T,I),e.lineTo(T+1.5*x*Math.cos(-S-C),I+1.5*L*Math.sin(-S-C)),e.stroke(),Si(e),e.restore()}else if(s===17||s===18||s===19||s===24){let{clipped:y,mapped:w}=yb(o,t,s,e.lineWidth);if(y.length===0)return;let[S,C,v,E]=y,[_,T,I,P]=w;e.save(),Ui(e,"dcg-svg-curve");let O;if(e.kiavash_batching||e.beginPath(),a=="DASHED"?(O=new qs(e,qs.getTotalSegmentLength(y),qs.getDashedPattern(e,!!t.settings.highlight)),O.drawSegment(y)):a=="DOTTED"?(O=new qs(e,qs.getTotalSegmentLength(y),qs.getDottedPattern(e,!!t.settings.config.projectorMode,!!t.settings.highlight)),O.drawSegment(y)):(e.moveTo(S,C),e.lineTo(v,E)),s===17){let W=_9(a)*d,{startArrow:X,endArrow:x}=Gae(Tae(s,c));X&&bp(e,I,P,_,T,W),x&&bp(e,_,T,I,P,W)}else if(s===24&&(_!==I||T!==P)){let W=_9(a)*d;bp(e,_,T,I,P,W)}e.kiavash_batching||e.stroke(),Si(e),e.restore();return}let p=bC(s,l!=="=",t.settings),u=bm(o,t.mathToPixels,p),h=n9(u,I9(t.screen,e.lineWidth));if(h.length===0)return;e.save(),Ui(e,"dcg-svg-curve");let m;if(e.kiavash_batching||e.beginPath(),a=="DASHED")m=new qs(e,qs.getTotalSegmentLength(h),qs.getDashedPattern(e,!!t.settings.highlight)),m.drawSegment(h);else if(a=="DOTTED")m=new qs(e,qs.getTotalSegmentLength(h),qs.getDottedPattern(e,!!t.settings.config.projectorMode,!!t.settings.highlight)),m.drawSegment(h);else if((a==="SOLID"||a==="default")&&e.lineWidth===1)if(h.length>4||h[0]!==h[2]&&h[1]!==h[3]){e.moveTo(h[0],h[1]);for(let w=0;w<h.length;w+=2)e.lineTo(h[w],h[w+1])}else{e.moveTo(__dcg_shared_module_exports__['Sb'](h[0]),__dcg_shared_module_exports__['Sb'](h[1]));for(let w=0;w<h.length;w+=2)e.lineTo(__dcg_shared_module_exports__['Sb'](h[w]),__dcg_shared_module_exports__['Sb'](h[w+1]))}else{e.moveTo(h[0],h[1]);for(let y=0;y<h.length;y+=2)e.lineTo(h[y],h[y+1])}e.kiavash_batching||e.stroke(),Si(e),e.restore()}static mapPointToScreen(e,t,o){let n=e.mapx(t);if(n<-20||n>e.screen.width+20)return null;let a=e.mapy(o);return a<-20||a>e.screen.height+20?null:{x:n,y:a}}static drawPointToCtx(e){let{ctx:t,projection:o,sketch:i,x:n,y:a}=e,{sizeFactor:s}=e,l=t.lineWidth,c=t.fillStyle,d=t.strokeStyle,p=r.mapPointToScreen(o,n,a);if(!p||e.sizeFactor!==void 0&&(e.sizeFactor<=0||!isFinite(e.sizeFactor)))return!1;Ui(t,"dcg-svg-point"),e.alpha!==void 0?t.globalAlpha=e.alpha:t.globalAlpha=.9,e.opacityFactor!==void 0&&(t.globalAlpha*=e.opacityFactor),t.kiavash_batching||t.beginPath();let u=o.settings.pointLineWidth;if(e.overrideSize&&(u=o.settings.config.projectorMode?17:11,t.lineWidth=u),i.tokenSelected?s?s*=1.5:s=1.5:i.tokenHovered&&(s?s*=fG:s=fG),s!==void 0&&(u*=s,t.lineWidth=u),e.colorOverride&&(t.fillStyle=e.colorOverride,t.strokeStyle=e.colorOverride),e.finalHardcodedSize!==void 0&&(u=e.finalHardcodedSize,t.lineWidth=u),e.style==="CROSS"){let h=u*.4;t.moveTo(p.x-h,p.y-h),t.lineTo(p.x+h,p.y+h),t.moveTo(p.x+h,p.y-h),t.lineTo(p.x-h,p.y+h),t.lineWidth=u*.3}else if(e.style==="OPEN"){let h=u*.42;t.moveTo(p.x+h,p.y),t.arc(p.x,p.y,h,0,Math.PI*2,!0),t.closePath(),t.fillStyle="white",t.lineWidth=u*.25,t.fill()}else t.moveTo(p.x-.1,p.y-.1),t.lineTo(p.x-.1,p.y+.1),t.lineTo(p.x+.1,p.y+.1),t.lineTo(p.x+.1,p.y-.1);if(t.kiavash_batching||t.stroke(),t.globalAlpha=1,e.isKeyboardFocused){let h=u/2+6;t.lineWidth=2,t.strokeStyle="#6A93D2",t.beginPath(),t.moveTo(p.x+h,p.y),t.arc(p.x,p.y,h,0,Math.PI*2,!0),t.stroke(),t.closePath()}return t.lineWidth=l,t.fillStyle=c,t.strokeStyle=d,Si(t),!0}static drawPointsToCtx(e){let{ctx:t,projection:o,segment:i,style:n,sizeOverrideIdxs:a,opacityOverrideIdx:s,sizeFactor:l,opacityFactor:c,colorOverrides:d,baseOpacity:p,droppedIndices:u}=e,h=t.lineWidth;t.lineWidth=o.settings.pointLineWidth;let m;Array.isArray(p)?(m=p.map(y=>r._clampedOpacity(y,.9)),m=bG(m,u)):m=r._clampedOpacity(p,.9),Array.isArray(l)&&(l=bG(l,u)),Array.isArray(c)&&(c=bG(c,u)),d&&(d=bG(d,u));for(let y=0;y<i.length;y++)r.drawPointToCtx({ctx:t,projection:o,sketch:e.sketch,x:i[y][0],y:i[y][1],alpha:s===y?.6:Array.isArray(m)?m[y]:m,style:n,overrideSize:a[y],sizeFactor:Array.isArray(l)?l[y]:l,opacityFactor:Array.isArray(c)?c[y]:c,colorOverride:d&&d[y],isKeyboardFocused:e.isKeyboardFocused});t.lineWidth=h}static fillPolygonFillToCtx(e,t){if(t.length>=6){Ui(e,"dcg-svg-region"),e.kiavash_batching||e.beginPath(),e.moveTo(t[0],t[1]);for(let o=2;o<t.length;o+=2)e.lineTo(t[o],t[o+1]);e.lineTo(t[0],t[1]),e.kiavash_batching||e.fill(),Si(e)}}static _clampedOpacity(e,t){return typeof e!="number"?t:e<0?0:e>1?1:isFinite(e)?e:t}};function*kae(r,e){let t=e.graphMode,o=e.operator,i=o=="<"||o==">"||o=="<="||o==">=",n=!r.settings.disableFill&&(t===7||i),a=o=="<="||o=="<";if(n)for(let s of e.segments)switch(t){case 6:{let l=a?0:r.viewport.polarDiameter(),c=r.settings.degreeMode?180:2*Math.PI;yield*m9(s,l,c);break}case 2:{let l=a?r.viewport.ymin:r.viewport.ymax;yield*KR(s,l);break}case 1:{let l=a?r.viewport.xmin:r.viewport.xmax;yield*KR(s,l);break}case 7:yield s}}function _ae(r){switch(r){case 2:return e9;case 1:return Z7;case 6:case 7:default:return dG}}function*jR(r,e){let t=e.graphMode;if(t!==1&&t!==2&&t!==6&&t!==7)return;let o=I9(r.screen);for(let i of kae(r,e)){let n=t===7?fb:bC(t,!0,r.settings),a=bm(i,r.mathToPixels,n);yield HR(a,o,_ae(e.graphMode),!1)}}function Tae(r,e){return r===17?e==="DEFAULT"?"NONE":e:"NONE"}function Gae(r){switch(r){case"NONE":return{startArrow:!1,endArrow:!1};case"POSITIVE":return{startArrow:!1,endArrow:!0};case"BOTH":return{startArrow:!0,endArrow:!0};default:let e=r;throw new Error("Unexpected arrowMode: "+e)}}function _9(r){switch(r){case"default":case"SOLID":case"DASHED":return 4;case"DOTTED":return 2;default:let e=r;throw new Error("Unexpected line style "+e)}}function bp(r,e,t,o,i,n){let a=Math.atan2(i-t,o-e),s=o-n*Math.cos(a-Math.PI/9),l=i-n*Math.sin(a-Math.PI/9),c=o-n*Math.cos(a+Math.PI/9),d=i-n*Math.sin(a+Math.PI/9),p=o-(n-2)*Math.cos(a-Math.PI/18),u=i-(n-2)*Math.sin(a-Math.PI/18),h=o-(n-2)*Math.cos(a+Math.PI/18),m=i-(n-2)*Math.sin(a+Math.PI/18);r.moveTo(o,i),r.lineTo(s,l),r.lineTo(c,d),r.lineTo(o,i),r.lineTo(p,u),r.lineTo(h,m),r.lineTo(o,i)}function YR(r,e,t,o,i,n,a){let s=o+i,l=n*Math.min(1,Math.max(.5,Math.abs(i)/.8)),c=i<=0,d=Math.PI/2;a<25?d+=.25:d+=.1,c||(d*=-1);let p=e+Math.cos(s+d),u=t+Math.sin(s+d);bp(r,p,u,e,t,l)}function vm(r,e){let t=20;return e.settings.config.projectorMode&&(t*=1.4),t}var bo=__dcg_shared_module_exports__['e'](Z());function Iae(r,e){let t=document.createRange();t.selectNode(r);let o=t.getBoundingClientRect();if(!(o.width>0&&o.height>0))return;let n=window.getComputedStyle(r.parentElement),a=r.nodeValue||"";if(!a)return;let l=-.228*parseFloat(n.fontSize),c=n.fontStyle+" "+n.fontWeight+" "+n.fontSize+" "+n.fontFamily,d=o.left-e.originX,p=o.top-e.originY,u;if(n.transform!=="none"){let h=n.transform.match(/^matrix\(([\d.-]+), *([\d.-]+), *([\d.-]+), *([\d.-]+), *([\d.-]+), *([\d.-]+)\)$/);if(h){let m=n.transformOrigin.match(/^([\d.-]+)px ([\d.-]+)px$/);m&&(u={matrix:[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6])],origin:{x:parseFloat(m[1]),y:parseFloat(m[2])}})}}return{type:"text",text:a,color:n.color||"#000",font:c,x:d,y:p+o.height+l,hasOutline:e.hasOutline,transform:u}}function A9(r,e){r.beginPath();for(let t of e.instructions)switch(t.type){case"moveTo":r.moveTo(t.x,t.y);break;case"lineTo":r.lineTo(t.x,t.y);break;case"arcTo":r.arcTo(t.cx,t.cy,t.x,t.y,t.radius);break;case"ellipse":r.ellipse(t.centerX,t.centerY,t.radiusX,t.radiusY,t.rotation,t.startAngle,t.endAngle,t.anticlockwise);break}r.closePath()}function Mae(r,e){let t=r.getBoundingClientRect();if(!(t.width>0&&t.height>0))return;let i=5,n=3,a=t.left-e.originX,s=t.top-e.originY,l=-i+a,c=t.width+i+a,d=-i+s,p=t.height+i+s;return{type:"path",hasOutline:!1,instructions:[{type:"moveTo",x:l+n,y:d},{type:"lineTo",x:c-n,y:d},{type:"arcTo",cx:c,cy:d,x:c,y:d+n,radius:n},{type:"lineTo",x:c,y:p-n},{type:"arcTo",cx:c,cy:p,x:c-n,y:p,radius:n},{type:"lineTo",x:l+n,y:p},{type:"arcTo",cx:l,cy:p,x:l,y:p-n,radius:n},{type:"lineTo",x:l,y:d+n},{type:"arcTo",cx:l,cy:d,x:l+n,y:d,radius:n}],strokeColor:"#C2C2C2",fillColor:"rgba(255,255,255,.75)"}}function Aae(r,e){let t=r.getBoundingClientRect();if(!(t.width>0&&t.height>0))return;let i=15,n=5,a=2,s="#5a87cd",l=3,c=t.left-e.originX-i,d=t.top-e.originY-n,p=c+t.width+2*i,u=d+t.height+2*n,h=c+l,m=p-l,y=d+l,w=u-l,S=[{type:"moveTo",x:h,y:d},{type:"lineTo",x:m,y:d},{type:"arcTo",x:p,y,radius:l,cx:p,cy:d},{type:"lineTo",x:p,y:w},{type:"arcTo",x:m,y:u,radius:l,cx:p,cy:u},{type:"lineTo",x:h,y:u},{type:"arcTo",x:c,y:w,radius:l,cx:c,cy:u},{type:"lineTo",x:c,y},{type:"arcTo",x:h,y:d,radius:l,cx:c,cy:d}];l-=a,c+=a,d+=a,p-=a,u-=a,h=c+l,m=p-l,y=d+l,w=u-l;let C=[{type:"moveTo",x:h,y:d},{type:"arcTo",x:c,y,radius:l,cx:c,cy:d},{type:"lineTo",x:c,y:w},{type:"arcTo",x:h,y:u,radius:l,cx:c,cy:u},{type:"lineTo",x:m,y:u},{type:"arcTo",x:p,y:w,radius:l,cx:p,cy:u},{type:"lineTo",x:p,y},{type:"arcTo",x:m,y:d,radius:l,cx:p,cy:d},{type:"lineTo",x:h,y:d}];return{type:"path",instructions:S.concat(C),fillColor:s,hasOutline:!1}}function V9(r,e){if(r==="0px 0px")return;let t=r.match(/^([^ ]+) +(.+)$/);if(!t)return;let o=t[1],i=t[2],n=parseFloat(o),a=parseFloat(i);if(o.endsWith("%")&&(n*=e.width/100),o.endsWith("%")&&(a*=e.height/100),!(n===0||a===0))return[n,a]}function Vae(r,e,t){if(e.borderTopWidth==="0px")return;let o=r.getBoundingClientRect();if(!(o.width>0&&o.height>0))return;let n=o.left-t.originX,a=o.top-t.originY,s=o.width,l=parseFloat(e.borderTopWidth||"1px"),c=e.borderTopColor||"#000",d,p=V9(e.borderTopLeftRadius,o),u=V9(e.borderTopRightRadius,o);return p&&u?d=[{type:"ellipse",centerX:n+p[0],centerY:a+p[1],radiusX:p[0],radiusY:p[1],rotation:0,startAngle:Math.PI,endAngle:3*Math.PI/2,anticlockwise:!1},{type:"lineTo",x:n+o.width-u[0],y:a},{type:"ellipse",centerX:n+o.width-u[0],centerY:a+u[1],radiusX:u[0],radiusY:u[1],rotation:0,startAngle:3*Math.PI/2,endAngle:0,anticlockwise:!1},{type:"lineTo",x:n+o.width,y:a+u[1]+l},{type:"ellipse",centerX:n+u[0],centerY:a+u[1]+l,radiusX:u[0],radiusY:u[1],rotation:0,startAngle:0,endAngle:3*Math.PI/2,anticlockwise:!0},{type:"lineTo",x:n+p[0],y:a+l},{type:"ellipse",centerX:n+p[0],centerY:a+p[1]+l,radiusX:p[0],radiusY:p[1],rotation:0,startAngle:3*Math.PI/2,endAngle:Math.PI,anticlockwise:!0}]:d=[{type:"moveTo",x:n,y:a},{type:"lineTo",x:s+n,y:a},{type:"lineTo",x:s+n,y:l+a},{type:"lineTo",x:n,y:l+a}],{type:"path",instructions:d,fillColor:c,hasOutline:t.hasOutline}}function L9(r,e){let t=Math.sqrt(r[0]*r[0]+r[1]*r[1]),o=Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=r[0]*e[0]+r[1]*e[1],n=Math.acos(i/(t*o));return r[0]*e[1]-r[1]*e[0]<0&&(n*=-1),n}function Lae(r,e,t,o,i,n,a,s,l){let c=Math.cos(i),d=Math.sin(i),p=(r-s)/2,u=(e-l)/2,h=c*p+d*u,m=-d*p+c*u,y=t*t,w=o*o,S=h*h,C=m*m,v=Math.sqrt((y*w-y*C-w*S)/(y*C+w*S));n===a&&(v*=-1);let E=v*t*m/o,_=-v*o*h/t,T=(r+s)/2,I=(e+l)/2,P=c*E-d*_+T,O=d*E+c*_+I,W=[1,0],X=[(h-E)/t,(m-_)/o],x=[(-h-E)/t,(-m-_)/o],L=L9(W,X),R=L9(W,x);return{centerX:P,centerY:O,radiusX:t,radiusY:o,startAngle:L,endAngle:R,rotation:i,anticlockwise:a===0}}var P9={};function Pae(r,e){let t=r+"-"+e,o=P9[t];if(o)return o;o=[],P9[t]=o;let i=e.split(" ");if(i.length!==4)return o;let n=parseFloat(i[0]),a=parseFloat(i[2]),s=parseFloat(i[1]),l=parseFloat(i[3]),c=a-n,d=l-s;function p(_){return(_-n)/c}function u(_){return(_-s)/d}let h="[0-9-.]+",m="(M"+h+" "+h+")",y="(L"+h+" "+h+")",w="(A"+h+" "+h+" "+h+" "+h+" "+h+" "+h+" "+h+")",S=new RegExp(m+"|"+y+"|"+w,"g"),C=r.match(S);if(!C||!C.length)return o;let v=NaN,E=NaN;for(let _ of C){let T=_.substr(1).split(" ").map(parseFloat);switch(_[0]){case"M":v=p(T[0]),E=u(T[1]),o.push({type:"moveTo",x:v,y:E});break;case"L":v=p(T[0]),E=u(T[1]),o.push({type:"lineTo",x:v,y:E});break;case"A":let I=T[0]/c,P=T[1]/d,O=T[2],W=T[3],X=T[4],x=p(T[5]),L=u(T[6]),R=Lae(v,E,I,P,O,W,X,x,L);v=x,E=L,o.push({type:"ellipse",...R});break}}return o}function Oae(r,e){let t=r.childNodes[0];if(!t||t.nodeName!=="path")return;let o=r.getBoundingClientRect();if(!(o.width>0&&o.height>0))return;let n=t.getAttribute("d")||"",a=r.getAttribute("viewBox")||"",s=Pae(n,a),l=window.getComputedStyle(r),c=o.width,d=o.height,p=o.left-e.originX,u=o.top-e.originY;s=__dcg_shared_module_exports__['i'](s);for(let h of s)switch(h.type){case"moveTo":case"lineTo":h.x=h.x*c+p,h.y=h.y*d+u;break;case"arcTo":h.x=h.x*c+p,h.y=h.y*d+u,h.cx=h.x*c+p,h.cy=h.y*d+u,h.radius*=c;break;case"ellipse":h.centerX=h.centerX*c+p,h.centerY=h.centerY*d+u,h.radiusX*=c,h.radiusY*=d;break;default:return h}return{type:"path",fillColor:l.color||"#000",instructions:s,hasOutline:e.hasOutline}}function R9(r,e,t){if(r.classList.contains("dcg-mq-mathspeak"))return;let o=window.getComputedStyle(r),i=Vae(r,o,e);i&&t.push(i);let n=r.childNodes;for(let a=0;a<n.length;a++){let s=n[a];if(s.nodeType===3){let l=Iae(s,e);l&&t.push(l)}else if(s.nodeName==="svg"){let l=Oae(s,e);l&&t.push(l)}else s.nodeType===1&&R9(s,e,t)}}function vG(r,e){let t=[];if(e.hasBorder){let o=Mae(r,e);o&&t.push(o)}if(e.hasFocus){let o=Aae(r,e);o&&t.push(o)}return R9(r,e,t),t}function CG(r,e){Ui(e,"dcg-svg-label"),e.save(),Si(e);for(let t of r)switch(t.type){case"path":t.hasOutline&&(e.strokeStyle="#FFF",e.lineWidth=3,e.miterLimit=10,A9(e,t),e.stroke());break;case"text":t.hasOutline&&(e.font=t.font,e.strokeStyle="#FFF",e.lineWidth=3,e.miterLimit=2,t.transform?(e.save(),O9(e,t),e.strokeText(t.text,0,0),e.restore()):e.strokeText(t.text,t.x,t.y));break;default:return t}for(let t of r)switch(t.type){case"path":A9(e,t),t.strokeColor&&(e.strokeStyle=t.strokeColor,e.lineWidth=1,e.miterLimit=10,e.stroke()),t.fillColor&&(e.fillStyle=t.fillColor,e.fill());break;case"text":e.font=t.font,e.fillStyle=t.color,t.transform?(e.save(),O9(e,t),e.fillText(t.text,0,0),e.restore()):e.fillText(t.text,t.x,t.y);break;default:return t}e.restore()}function O9(r,e){if(!e.transform)return;let t=Math.abs(e.transform.matrix[0]),o=Math.abs(e.transform.matrix[3]);r.translate(e.x+e.transform.origin.x,e.y+e.transform.origin.y),r.transform.apply(r,e.transform.matrix),r.translate(-e.transform.origin.x/t,-e.transform.origin.y/o)}var Vd=__dcg_shared_module_exports__['e'](Z());var SG=__dcg_shared_module_exports__['e'](Z());var Et=class extends SG.Class{template(){return this.props.children?this.props.children:SG.createElement("div",{onMount:e=>this.onMountMathquill(e)})}onMount(){if(this.props.children){let e=this.findAllRootDOMNodes();if(e.length!==1)throw new Error(`StaticMathquillView expects exactly 1 child DOM Node. Got: ${e.length}`);let t=e[0];if(t instanceof HTMLElement)this.onMountMathquill(t);else throw new Error("StaticMathquillView expects an HTMLElement as child DOM node")}}onMountMathquill(e){var t,o;this.props.tokenController&&(this.mathquillTokenHelper=new Aw(this.props.tokenController(),e,!0)),this.staticMath=Hc.StaticMath(e,{...this.props.config(),overrideKeystroke:(i,n)=>{var a,s;(s=(a=this.props).onUserPressedKey)!=null&&s.call(a,i,n)&&n.stopPropagation()}}),(o=(t=this.props).didMountMathquill)==null||o.call(t,this.staticMath),e.classList.add("dcg-static-mathquill-view"),this.updateMathquill()}didUpdate(){this.updateMathquill()}updateMathquill(){var e;this.updateMathquillAria(),this.updateMathquillLatex(),(e=this.mathquillTokenHelper)==null||e.updateTokens(this.props.latex())}updateMathquillLatex(){if(!this.staticMath)return;let e=this.props.latex();this.lastLatex!==e&&(this.staticMath.latex(e),this.lastLatex=e,this.props.onReflow&&this.props.onReflow())}updateMathquillAria(){if(!this.staticMath||!this.props.getAriaLabel)return;let e=this.props.getAriaLabel();e!==this.staticMath.getAriaLabel()&&this.staticMath.setAriaLabel(e)}};var{For:Rae,IfElse:Fae}=Vd.Components,Bl=class extends Vd.Class{template(){return Vd.createElement("span",{class:Vd.const("dcg-mixed-text-math")},Vd.createElement(Rae,{each:()=>__dcg_shared_module_exports__['pe'](this.props.content()),key:(e,t)=>`${e}|${t}`},e=>Fae(()=>__dcg_shared_module_exports__['oe'](e)==="latex",{true:()=>Vd.createElement(Et,{latex:()=>e.substring(1,e.length-1),config:this.props.mqConfig}),false:()=>Vd.createElement("span",{class:Vd.const("dcg-label-raw-text")},()=>e)})))}};var Aa=__dcg_shared_module_exports__['e'](Z());$t();$t();function EG(r){return Array.from(r.querySelectorAll('input:enabled, button:enabled, select:enabled, textarea:enabled, [tabindex="0"], a[href]')).filter(e=>!e.matches('[aria-hidden="true"], [aria-hidden="true"] *, [aria-disabled="true"], [aria-disabled="true"] *')&&cp(e))}function F9(r){return function(t){if(Be(t)==_l&&r){let o=EG(r);if(o.length===0)return;let i=o[0],n=o[o.length-1];t.shiftKey&&document.activeElement===i?(t.preventDefault(),re(n).trigger("focus")):!t.shiftKey&&document.activeElement===n?(t.preventDefault(),re(i).trigger("focus")):document.activeElement&&!r.contains(document.activeElement)&&(t.preventDefault(),re(i).trigger("focus"))}}}function Ld(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}var{IfElse:Nae}=Aa.Components,Bae=500,Eu=5,vC=2,XR=class extends Aa.Class{constructor(){super(...arguments),this.offsetLeft=0}init(){this.uuid=this.props.uuid()}gravity(){var e,t;return((t=(e=this.props).gravity)==null?void 0:t.call(e))||"s"}template(){return Aa.createElement("div",{class:()=>{var e,t,o,i;return{"dcg-tooltip-positioning-container":!0,"dcg-tooltip-gravity-n-s":this.gravity()==="n"||this.gravity()==="s","dcg-tooltip-gravity-e-w":this.gravity()==="e"||this.gravity()==="w","dcg-tooltip-theme-light":((t=(e=this.props).theme)==null?void 0:t.call(e))==="light","dcg-tooltip-theme-dark":((i=(o=this.props).theme)==null?void 0:i.call(o))!=="light"}},style:()=>{var e,t,o,i;return{top:`${this.props.hitAreaRect().top+(((t=(e=this.props).offset)==null?void 0:t.call(e).top)||0)}px`,left:`${this.props.hitAreaRect().left+(((i=(o=this.props).offset)==null?void 0:i.call(o).left)||0)}px`,width:`${this.props.hitAreaRect().width}px`,height:`${this.props.hitAreaRect().height}px`}}},Aa.createElement("div",{class:Aa.const("dcg-tooltip-message-container"),style:this.bindFn(this.getMessageStyle)},Aa.createElement("div",{role:Aa.const("tooltip"),id:this.const(this.uuid),class:()=>{var e,t;return{"dcg-tooltip-message":!0,"dcg-text-selectable":(t=(e=this.props).sticky)==null?void 0:t.call(e),"dcg-sticky-not-stuck":this.props.isStickyAndNotStuck()}},onMount:e=>this.tooltipMessage=e,style:()=>({left:`${Math.round(this.offsetLeft)}px`})},Nae(()=>!!this.props.customTooltipView,{true:()=>this.props.customTooltipView(),false:()=>Aa.createElement("span",null,this.props.tooltip)}))),Aa.createElement("div",{class:()=>({"dcg-tooltip-arrow":!0,[this.getTooltipGravityClass()]:!0}),style:()=>{var e,t;return((t=(e=this.props).theme)==null?void 0:t.call(e))==="light"?this.getArrowWithBorderStyle():this.getSolidArrowStyle()}}))}updatePositionIfNecessary(){if(this.gravity()!=="s"&&this.gravity()!=="n")return;let e=this.tooltipMessage.getBoundingClientRect(),t=this.tooltipMessage.closest(".dcg-tap-container");if(!t)return;let o=t.getBoundingClientRect();e.right+vC>o.right?this.offsetLeft=o.right-e.right-vC:e.left-vC<o.left&&(this.offsetLeft=o.left-e.left+vC),this.offsetLeft!==0&&this.update()}didMount(){this.updatePositionIfNecessary()}getTooltipGravityClass(){switch(this.gravity()){case"n":return"dcg-tooltip-gravity-n";case"s":return"dcg-tooltip-gravity-s";case"e":return"dcg-tooltip-gravity-e";case"w":return"dcg-tooltip-gravity-w"}}getArrowWithBorderStyle(){let e=this.gravity(),t=this.getBackgroundColor(),o="#bbb",i="8px",n={width:i,height:i,border:`1px solid ${o}`,background:t};switch(e){case"s":return{...n,top:"100%",left:"50%","margin-top":"1px","border-right":"0","border-bottom":"0"};case"n":return{...n,bottom:"100%",left:"50%","margin-bottom":"1px","border-left":"0","border-top":"0"};case"e":return{...n,top:"50%",left:"100%","margin-left":"1px","border-right":"0","border-top":"0"};case"w":return{...n,top:"50%",right:"100%","margin-right":"1px","border-left":"0","border-bottom":"0"};default:return e}}getSolidArrowStyle(){let e=this.gravity(),t=this.getBackgroundColor(),o=`transparent transparent ${t} transparent`,i=`${t} transparent transparent transparent`,n=`transparent ${t} transparent transparent`,a=`transparent transparent transparent ${t}`,s=`-${Eu}px`;switch(e){case"s":return{top:"100%",left:"50%",border:`${Eu}px solid transparent`,"border-color":o,"margin-top":s,"margin-left":s};case"n":return{bottom:"100%",left:"50%",border:`${Eu}px solid transparent`,"border-color":i,"margin-bottom":s,"margin-left":s};case"e":return{top:"50%",left:"100%",border:`${Eu}px solid transparent`,"border-color":n,"margin-left":`-${Eu}px`,"margin-top":s};case"w":return{top:"50%",right:"100%",border:`${Eu}px solid transparent`,"border-color":a,"margin-right":s,"margin-top":s};default:return e}}getBackgroundColor(){var e,t;return((t=(e=this.props).theme)==null?void 0:t.call(e))==="light"?"#fff":this.props.isStickyAndNotStuck()?"#666":"#000"}getMessageStyle(){let e=this.props.hitAreaRect(),t=this.gravity(),o=this.props.maxWidth();switch(t){case"s":return{top:"100%",width:`${o}px`,transform:"translate(-50%, 0)",left:`${.5*e.width}px`,"margin-top":`${Eu}px`,"text-align":"center"};case"n":return{bottom:"100%",width:`${o}px`,transform:"translate(-50%, 0)",left:`${.5*e.width}px`,"margin-bottom":`${Eu}px`,"text-align":"center"};case"e":return{transform:"translate(0, -50%)",left:"100%",width:`${o}px`,top:`${.5*e.height}px`,"margin-left":`${Eu}px`,"text-align":"left"};case"w":return{transform:"translate(0, -50%)",right:"100%",width:`${o}px`,top:`${.5*e.height}px`,"margin-right":`${Eu}px`,"text-align":"right"};default:return t}}};function Uae(){return document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}var ze=class extends Aa.Class{init(){this.uuid=`dcg-tooltip-${Ld()}`}template(){return Aa.createElement("div",{class:()=>{var e,t,o,i;return{"dcg-tooltip-hit-area-container":!0,"dcg-display-block":(t=(e=this.props).displayBlock)==null?void 0:t.call(e),"dcg-do-not-blur":!0,"dcg-sticky-tooltip":this.isSticky(),"dcg-tooltip-disabled":this.props.disabled&&this.props.disabled(),"dcg-cursor-default":!this.isSticky(),[((i=(o=this.props).additionalClass)==null?void 0:i.call(o))||""]:!!this.props.additionalClass}},handleEvent:Aa.const("true"),didMount:e=>{this.isMounted=!0,this.hitAreaNode=e,this.setupEventListeners(this.hitAreaNode)},tabIndex:()=>this.isSticky()?"0":"-1","aria-label":()=>this.isSticky()?this.props.tooltip():void 0,role:()=>this.isSticky()?"note":void 0,onFocus:()=>{this.isSticky()&&(this.showTooltip(),this.stickTooltip())},onTap:e=>{var t,o,i,n,a;if(this.isSticky())if(e.stopPropagation(),this.isStuck)this.hideTooltipImmediately();else{if((o=(t=this.props).disabled)!=null&&o.call(t))return;this.showTooltip(),this.stickTooltip(),(i=this.hitAreaNode)==null||i.focus()}else if(this.shouldShowOnTapstart()){if((a=(n=this.props).disabled)!=null&&a.call(n))return;this.showTooltip(),this.setUpHideOnExternalMousedown()}else this.hideTooltipImmediately()}},this.props.children)}isSticky(){var e,t,o,i;return!!((t=(e=this.props).sticky)!=null&&t.call(e))&&!((i=(o=this.props).disabled)!=null&&i.call(o))}shouldShowOnTapstart(){var e,t;return!!((t=(e=this.props).showOnTapstart)!=null&&t.call(e))}didUpdate(){this.updateTooltip()}updateTooltip(){if(!this.wrapperRef)return;if(!this.props.tooltip()){this.hideTooltip();return}let e=this.hitAreaNode.getBoundingClientRect(),t=this.wrapperRef.elt.getBoundingClientRect(),{originalTop:o,originalLeft:i}=this.wrapperRef,n=e.top-t.top,a=e.left-t.left;Math.abs(n-o)>3||Math.abs(a-i)>3?this.hideTooltip():this.wrapperRef.view.update()}handleShowEvent(e){var o,i;if((i=(o=this.props).disabled)!=null&&i.call(o))return;let t=this.props.delay?this.props.delay():Bae;this.clearTimeouts(),this.showTooltipTimeout=setTimeout(e,t)}hideTooltipImmediately(){this.clearTimeouts(),this.hideTooltip()}handleHideEvent(){this.clearTimeouts(),this.hideTooltipTimeout=setTimeout(this.bindFn(this.hideTooltip),150)}setupEventListeners(e){re(e).on("tipsyshow",t=>{t.target===e&&this.handleShowEvent(()=>{this.showTooltip()})}).on("tipsyhide",t=>{t.target!==e||this.isStuck||this.handleHideEvent()}).on("keydown",t=>{!g0(t)&&!mx(t)&&this.isStuck&&this.hideTooltipImmediately()})}willUnmount(){this.clearTimeouts(),this.isMounted=!1,this.hideTooltip()}setUpHideOnExternalMousedown(){re(document).on(`mousedown.dcg-tooltip-${this.uuid} touchstart.dcg-tooltip-${this.uuid} pointerdown.dcg-tooltip-${this.uuid}`,e=>{this.wrapperRef&&(this.hitAreaNode.contains(e.target)||this.wrapperRef.elt.contains(e.target)||this.hideTooltip())})}stickTooltip(){this.isMounted&&this.wrapperRef&&(this.isStuck||(this.setUpHideOnExternalMousedown(),this.isStuck=!0,this.updateTooltip()))}clearTimeouts(){clearTimeout(this.showTooltipTimeout),clearTimeout(this.hideTooltipTimeout)}showTooltip(){var h,m,y;if(!this.isMounted||this.wrapperRef||!this.props.tooltip())return;let e=this.hitAreaNode.getBoundingClientRect(),t=document.createElement("div");t.className="dcg-tooltip-mount-pt";let o=this.hitAreaNode.closest(".dcg-tap-container"),i=Uae();(!!i&&i.contains(this.hitAreaNode)&&i.closest(".dcg-tap-container")?i:o).appendChild(t);let a=t.getBoundingClientRect(),s=e.left-a.left,l=e.top-a.top,c=200;if((m=(h=this.props).noWrap)!=null&&m.call(h)){let w=(y=t.closest(".dcg-tap-container"))==null?void 0:y.getBoundingClientRect();w&&(c=w.width-2*vC)}let d={...this.props,isStickyAndNotStuck:()=>this.isSticky()&&!this.isStuck,maxWidth:()=>c,hitAreaRect:()=>({top:l||0,left:s||0,width:e.width||0,height:e.height||0}),uuid:()=>this.uuid};this.setupEventListeners(t),re(t).on("dcg-tap",()=>{this.isSticky()&&this.stickTooltip()});let p=Aa.mountToNode(XR,t,d);re(document).on(`keydown.dcg-tooltip-${this.uuid}`,w=>{Be(w)===Pn&&this.hideTooltip()});let u=()=>this.updateTooltip();window.addEventListener("scroll",u,!0),this.wrapperRef={elt:t,view:p,originalLeft:s,originalTop:l,onScroll:u},this.assignAriaDescribedBy()}hideTooltip(){this.clearTimeouts(),this.wrapperRef&&(this.isStuck=!1,re(document).off(`.dcg-tooltip-${this.uuid}`),window.removeEventListener("scroll",this.wrapperRef.onScroll,!0),this.restoreAriaDescribedBy(),Aa.unmountFromNode(this.wrapperRef.elt),this.wrapperRef.elt.parentNode&&this.wrapperRef.elt.parentNode.removeChild(this.wrapperRef.elt),this.wrapperRef=void 0)}assignAriaDescribedBy(){var t,o;if((o=(t=this.props).sticky)!=null&&o.call(t))return;let e=EG(this.hitAreaNode)[0]||this.hitAreaNode;this.originalDescribedBy=e.getAttribute("aria-describedby"),e.setAttribute("aria-describedby",this.uuid)}restoreAriaDescribedBy(){var t,o;if((o=(t=this.props).sticky)!=null&&o.call(t))return;let e=EG(this.hitAreaNode)[0]||this.hitAreaNode;this.originalDescribedBy?e.setAttribute("aria-describedby",this.originalDescribedBy):e.removeAttribute("aria-describedby")}};function DG(r,e,t){return Math.max(e,Math.min(t,r))}var Vw=class{constructor(e){let t=e.data,o=e.width,i=e.height;this.imageData=e;for(let s=1;s<o;s++)t[s]+=t[s-1];for(let s=1;s<i;s++)t[s*o]+=t[s*o-o];let n=o*i-o-i+1,a=o-1;for(let s=0;s<n;s++){let l=1+s%a,d=(1+Math.floor(s/a))*o,p=l-1+d,u=l+d-o,h=l-1+d-o;t[d+l]+=t[p]+t[u]-t[h]}}getSumForValidRect(e){let t=e.left-1,o=e.right-1,i=e.top-1,n=e.bottom-1,a=this.imageData.width,s=this.imageData.data,l=s[t+i*a],c=s[o+i*a],d=s[t+n*a],p=s[o+n*a];return t>=0&&i>=0?p-c-d+l:t>=0?p-d:i>=0?p-c:p}getSum(e){let t={left:DG(Math.floor(e.left),0,this.imageData.width),right:DG(Math.ceil(e.right),0,this.imageData.width),top:DG(Math.floor(e.top),0,this.imageData.height),bottom:DG(Math.ceil(e.bottom),0,this.imageData.height)};return t.left>=t.right||t.top>=t.bottom?0:this.getSumForValidRect(t)}};var Sm=1/2,Cm=document.createElement("canvas"),JR=[];function qae(r,e){if(!(e.width*e.height>0))return new Vw({width:0,height:0,data:[]});Cm.width=0,Cm.width=Math.round(e.width*Sm),Cm.height=Math.round(e.height*Sm);let o=Cm.getContext("2d");o.save(),o.scale(Cm.width/r.canvas.width,Cm.height/r.canvas.height),o.drawImage(r.canvas,0,0),o.restore();let i=o.getImageData(0,0,Cm.width,Cm.height),n=i.data;n.length/4,JR.length,JR=new Array(n.length/4);let a=JR;for(let l=0;l<a.length;l++)a[l]=n[l*4+3];return new Vw({width:i.width,height:i.height,data:a})}function N9(r){for(let e=0;e<r.length;e++){let t=zae(e,r);r[e]=[t]}return r.map(e=>e[0])}function zae(r,e){let t=1/0,o=-1,i=e[r];if(i.length===1)return i[0];for(let n=0;n<i.length;n++){let a=e[r][n].staticScore,s=Hae(r,n,e),l=a+s;(o===-1||l<t)&&(t=l,o=n)}return i[o]}function Hae(r,e,t){let o=0,i=t[r][e];for(let n=0;n<t.length;n++){if(n===r)continue;let a=0,s=t[n];for(let l=s.length-1;l>=0;l--){let c=s[l],d=Math.max(0,Math.min(i.right,c.right)-Math.max(i.left,c.left)),p=Math.max(0,Math.min(i.bottom,c.bottom)-Math.max(i.top,c.top));a+=d*p}o+=a/s.length}return o}function Kae(r,e){let t=e.getSum({left:r.left*Sm,right:r.right*Sm,top:r.top*Sm,bottom:r.bottom*Sm});return t/=200,t/=Sm*Sm,t}function Wae(r,e){let t=$ae(r,e);return 10*(r.width*r.height-t)}function $ae(r,e){let t=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),o=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top));return t*o}function B9(r,e){let t;return()=>(t||(t={viewport:{left:0,right:e.width,top:0,bottom:e.height},integralImage:qae(r(),e)}),t)}function kG(r,e){if(e.length<=1)return;let t=r();for(let o of e)o.staticScore+=Wae(o,t.viewport),o.staticScore+=Kae(o,t.integralImage)}function U9(r,e){let t=e.nakedLabel?0:e.pt_radius,o=Math.round(t/Math.sqrt(2)),i=[],n=e.pt_x,a=e.pt_y,s=e.width,l=e.height,c=400;i.push({cx_s:0,cy_s:0,cx_a:0,cy_a:0,staticScore:c,orientation:"center",matches:{default:1,center:1,center_auto:1,auto_center:1}}),i.push({cx_s:.5,cx_a:t+3,cy_s:0,cy_a:0,staticScore:c,orientation:"right",matches:{default:1,right:1,center_auto:1,auto_right:1}}),i.push({cx_s:-.5,cx_a:-t-3,cy_s:0,cy_a:0,staticScore:c,orientation:"left",matches:{default:1,left:1,center_auto:1,auto_left:1}}),i.push({cx_s:0,cx_a:0,cy_s:-.5,cy_a:-t,staticScore:c,orientation:"above",matches:{default:1,above:1,auto_center:1,above_auto:1}}),i.push({cx_s:-.5,cx_a:-o,cy_s:-.5,cy_a:-o,staticScore:c,orientation:"tl",matches:{default:1,above_left:1,above_auto:1,auto_left:1}}),i.push({cx_s:.5,cx_a:o,cy_s:-.5,cy_a:-o,staticScore:c,orientation:"tr",matches:{default:1,above_right:1,above_auto:1,auto_right:1}}),i.push({cx_s:0,cx_a:0,cy_s:.5,cy_a:t,staticScore:c,orientation:"below",matches:{default:1,below:1,auto_center:1,below_auto:1}}),i.push({cx_s:-.5,cx_a:-o,cy_s:.5,cy_a:o,staticScore:c,orientation:"bl",matches:{default:1,below_left:1,below_auto:1,auto_left:1}}),i.push({cx_s:.5,cx_a:o,cy_s:.5,cy_a:o,staticScore:c,orientation:"br",matches:{default:1,below_right:1,below_auto:1,auto_right:1}});let d=Math.cos(e.rotation),p=Math.sin(e.rotation),u=i.map(h=>{let m=h.cx_s*s+h.cx_a,y=h.cy_s*l+h.cy_a,w=m*d-y*p,S=y*d+m*p,C={multiplyWidth:h.cx_s-.5,multiplyHeight:h.cy_s-.5,addX:h.cx_a,addY:h.cy_a},v=-s/2,E=s/2,_=-l/2,T=l/2;if(e.rotation){let I=jae([{x:v*d-_*p,y:_*d+v*p},{x:v*d-T*p,y:T*d+v*p},{x:E*d-_*p,y:_*d+E*p},{x:E*d-T*p,y:T*d+E*p}]);v=I.left,E=I.right,_=I.top,T=I.bottom}return v=Math.round(n+w+v),E=Math.round(n+w+E),_=Math.round(a+S+_),T=Math.round(a+S+T),{pt_x:Math.round(n),pt_y:Math.round(a),left:v,right:E,top:_,bottom:T,width:E-v,height:T-_,translate:C,staticScore:e.priorOrientation===h.orientation?h.staticScore-20:h.staticScore,orientation:h.orientation,matches:h.matches}});return e.enforceOrientation&&e.enforceOrientation!=="default"?u=__dcg_shared_module_exports__['m'](u,h=>!!h.matches[e.enforceOrientation]):e.nakedLabel?u=__dcg_shared_module_exports__['m'](u,h=>h.orientation==="center"):e.keepOrientation&&e.priorOrientation?u=__dcg_shared_module_exports__['m'](u,h=>h.orientation===e.priorOrientation):u=__dcg_shared_module_exports__['m'](u,h=>h.orientation!=="center"),kG(r,u),u}function q9(r,e){let t=[],o=e.width,i=e.height,n=o/2,a=i/2,s=e.pt_x1,l=e.pt_y1,c=e.pt_x2,d=e.pt_y2,p=5,u=(d-l)/(c-s),h=Math.atan2(d-l,c-s)+Math.PI/2,m=p*Math.cos(h),y=p*Math.sin(h),w=Math.min(l,d)-Math.abs(y)-i,S=Math.max(l,d)+Math.abs(y),C=[.5,.4,.6,.2,.8],v=[0,20,20,40,40],E=[];for(let T of C)E.push({x:s*(1-T)+c*T,y:l*(1-T)+d*T});for(let T=0;T<E.length;T++){let I=E[T],P,O,W,X;if(u>=2||u<=-2){W=X=I.y-a;let N=Math.abs((c-s)/(d-l)*a)+Math.abs(m);P=I.x+N,O=I.x-N-o}else if(u<=.05&&u>=-.05){P=O=I.x-n;let N=Math.abs(u*n)+Math.abs(y);W=I.y-N-i,X=I.y+N}else m>0?(P=I.x+m,O=I.x-m-o):(P=I.x+m-o,O=I.x-m),y>0?(W=I.y+y,X=I.y-y-i):(W=I.y+y-i,X=I.y-y);W<w?W=w:W>S&&(W=S),X<w?X=w:X>S&&(X=S);let x=(c-s)*(W-l)-(d-l)*(P-s)>0,L=T.toString()+(x?"-a":"-b");t.push({pt_x:I.x,pt_y:I.y,left:P,top:W,staticScore:v[T],orientation:L,matches:{[L]:1}});let R=T.toString()+(x?"-b":"-a");t.push({pt_x:I.x,pt_y:I.y,left:O,top:X,staticScore:v[T],orientation:R,matches:{[R]:1}})}let _=t.map(T=>{let I=Math.round(T.left),P=Math.round(T.left+o),O=Math.round(T.top),W=Math.round(T.top+i);return{pt_x:Math.round(T.pt_x),pt_y:Math.round(T.pt_y),translate:{multiplyWidth:0,multiplyHeight:0,addX:T.left-T.pt_x,addY:T.top-T.pt_y},left:I,right:P,top:O,bottom:W,width:P-I,height:W-O,staticScore:e.priorOrientation===T.orientation?T.staticScore-20:T.staticScore,orientation:T.orientation,matches:T.matches}});return e.keepOrientation&&e.priorOrientation&&(_=__dcg_shared_module_exports__['m'](_,T=>T.orientation===e.priorOrientation)),kG(r,_),_}function z9(r,e){let t=[],o=e.pt_x,i=e.pt_y,n=e.width,a=e.height,s=-(e.startAngle+e.deltaAngle/2),l=e.isRightAngle?e.radius*Math.sqrt(2)-1:e.radius+4,c=l+Math.sqrt(e.width*e.width/4+e.height*e.height/4),d=[],p=c*Math.sin(s);p>l+1/2*a&&(p=l+1/2*a),p<-l-1/2*a&&(p=-l-1/2*a),d.push({x:o+c*Math.cos(s)-n/2,y:i+p-a/2});for(let h=0;h<d.length;h++){let m=d[h],y=h.toString()+"-a";t.push({pt_x:m.x,pt_y:m.y,left:m.x,top:m.y,staticScore:0,orientation:y,matches:{[y]:1}})}let u=t.map(h=>{let m=Math.round(h.left),y=Math.round(h.left+n),w=Math.round(h.top),S=Math.round(h.top+a);return{pt_x:Math.round(h.pt_x),pt_y:Math.round(h.pt_y),translate:{multiplyWidth:0,multiplyHeight:0,addX:h.left-h.pt_x,addY:h.top-h.pt_y},left:m,right:y,top:w,bottom:S,width:y-m,height:S-w,staticScore:e.priorOrientation===h.orientation?h.staticScore-20:h.staticScore,orientation:h.orientation,matches:h.matches}});return e.keepOrientation&&e.priorOrientation&&(u=__dcg_shared_module_exports__['m'](u,h=>h.orientation===e.priorOrientation)),kG(r,u),u}function H9(r,e){let t=[],o=e.width,i=e.height,n=10,a=Math.round(n/Math.sqrt(2)),s=0,l=50,c=0,d=0,p=0;for(let y=0;y<e.path.length-2;y+=2)p+=1,c+=e.path[y],d+=e.path[y+1];let u=c/p,h=d/p;t.push({left:u-o/2,top:h-i/2,staticScore:s,orientation:"center",matches:{center:1}}),t.push({left:u+n+3,top:h-i/2,staticScore:l,orientation:"right",matches:{right:1}}),t.push({left:u-(n+o)-3,top:h-i/2,staticScore:l,orientation:"left",matches:{left:1}}),t.push({left:u-o/2,top:h-(i+n),staticScore:l,orientation:"top",matches:{top:1}}),t.push({left:u-(o+a),top:h-(i+a),staticScore:l,orientation:"tl",matches:{tl:1}}),t.push({left:u+a,top:h-(i+a),staticScore:l,orientation:"tr",matches:{tr:1}}),t.push({left:u-o/2,top:h+n,staticScore:l,orientation:"bottom",matches:{bottom:1}}),t.push({left:u-(o+a),top:h+a,staticScore:l,orientation:"bl",matches:{bl:1}}),t.push({left:u+a,top:h+a,staticScore:l,orientation:"br",matches:{br:1}});let m=t.map(y=>{let w=Math.round(y.left),S=Math.round(y.left+o),C=Math.round(y.top),v=Math.round(y.top+i);return{pt_x:Math.round(u),pt_y:Math.round(h),translate:{multiplyWidth:0,multiplyHeight:0,addX:y.left-u,addY:y.top-h},left:w,right:S,top:C,bottom:v,width:S-w,height:v-C,staticScore:e.priorOrientation===y.orientation?y.staticScore-20:y.staticScore,orientation:y.orientation,matches:y.matches}});return e.keepOrientation&&e.priorOrientation&&(m=__dcg_shared_module_exports__['m'](m,y=>y.orientation===e.priorOrientation)),kG(r,m),m}function jae(r){let e=r[0].x,t=r[0].x,o=r[0].y,i=r[0].y;for(let n=r.length-1;n>=1;n--){let{x:a,y:s}=r[n];a<e&&(e=a),a>t&&(t=a),s<o&&(o=s),s>i&&(i=s)}return{left:e,right:t,top:o,bottom:i}}var Xae=1,Uh=class{constructor(e,t,o,i,n,a,s){this.x=e,this.y=t,this.type=o,this.sketch=i,this.branch=n,this.pointIdxOnBranch=a,this.bareLabel=s===void 0?!1:s,this.id=Xae++}getLabel(){let e=this.sketch&&this.sketch.branches[this.branch];return e&&"labels"in e&&e.labels&&e.labels[this.pointIdxOnBranch]||""}getGraphMode(){return this.sketch.branches[this.branch].graphMode}getCompiledFunction(){let e=this.sketch.branches[this.branch];if(!(!("compiled"in e)||!e.compiled))return e.compiled.fn}isAttachedToPlottedPoint(){return this.type===1006||this.type===1008}isMovable(){return __dcg_shared_module_exports__['Ed'](this.getGraphMode())}isPersistent(){return this.type===1008}getLabelSize(){let e=this.sketch&&this.sketch.branches[this.branch];return this.type===1008&&e&&"labelSize"in e?e.labelSize===void 0?1:e.labelSize:1}getLabelRotation(){let e=this.sketch&&this.sketch.branches[this.branch];return this.type===1008&&e&&"labelAngle"in e?e.labelAngle===void 0?0:e.labelAngle:0}getPointOpacity(){let e=this.sketch&&this.sketch.branches[this.branch];if(e&&"pointOpacity"in e){let t=e.pointOpacity;if(t!==void 0){let o;return Array.isArray(t)?o=t[this.pointIdxOnBranch]:o=t,isFinite(o)?Math.max(0,Math.min(1,o)):1}}return 1}getPointSize(){let e=this.sketch&&this.sketch.branches[this.branch];if(e&&"pointSize"in e){let t=e.pointSize;if(t!==void 0){let o;Array.isArray(t)?o=t[this.pointIdxOnBranch]:o=t;let i=isFinite(o)?Math.max(0,o):8;return this.isMovable()?__dcg_shared_module_exports__['ae'](i):i}}return this.isMovable()?__dcg_shared_module_exports__['be'](8):8}getTextOutline(){if(this.hasEditableLabel())return!1;let e=this.sketch&&this.sketch.branches[this.branch];return this.type===1008&&e&&"suppressTextOutline"in e?!e.suppressTextOutline:!0}hasInteractiveLabel(){let e=this.sketch&&this.sketch.branches[this.branch];return e&&"interactiveLabel"in e?!!e.interactiveLabel:!1}hasEditableLabel(){let e=this.sketch&&this.sketch.branches[this.branch];return e&&"editableLabel"in e?!!e.editableLabel:!1}isBareLabel(){return this.bareLabel}getMovablePoint(){return this.sketch.getMovablePointByIndex(this.pointIdxOnBranch)}isSelected(){return this.sketch.showHighlight}};var{If:K9,Input:Jae,For:Qae,Switch:Zae}=bo.Components,ese=300,W9={id:!0,sketchId:!0,rotatedWidth:!0,rotatedHeight:!0,alignedWidth:!0,alignedHeight:!0,content:!0,focused:!0,isNakedLabel:!0,isClickable:!0,hasOutline:!0,hasBorder:!0,classes:!0,styles:!0,dotStyles:!0,poi:!1,objectSpec:!1,x:!1,y:!1,screenX:!1,screenY:!1,left:!1,top:!1,rotation:!1,opacity:!1,forcedOrientation:!1,orientation:!1,labelDOM:!1,containerDOM:!1,willCopyToCanvas:!1,layerFilter:!1,cachedDrawingCommands:!1,animation:!1,layerNumber:!1,isComplex:!1};function $9(r,e){return e?e.getPOIById(r):null}function wb(r,e){return 1e3*(r.pixelsToMath.mapX(r.mathToPixels.mapX(e)+.5)-r.pixelsToMath.mapX(r.mathToPixels.mapX(e)-.5))}function TG(r,e){return 1e3*(r.pixelsToMath.mapY(r.mathToPixels.mapY(e)+.5)-r.pixelsToMath.mapY(r.mathToPixels.mapY(e)-.5))}function tse(r,{x:e,y:t}){let o=wb(r,e),i=TG(r,t);return{xscale:o,yscale:i}}function j9(r,e){return e?[r[1],r[0]]:r}function tF(r,e){let t,o=!1,i="",n="",{poi:a}=r,s=a.getGraphMode();if(r.type==="poi"){let{xscale:c,yscale:d}=tse(e,a);t=a.getLabel();let p,u=a.type===1007&&a.getCompiledFunction();if(u){let h=s===1,m=h?a.y:a.x,[y,w]=j9([c,d],h);p=__dcg_shared_module_exports__['Ub'](m,y,w,u),p=j9(p,h)}else p=[__dcg_shared_module_exports__['Tb'](a.x,c),__dcg_shared_module_exports__['Tb'](a.y,d)];o=!isFinite(p[1].value),i=p[0].superscript?p[0].mantissa+"^{"+p[0].superscript+"}":p[0].latex,n=p[1].superscript?p[1].mantissa+"^{"+p[1].superscript+"}":p[1].latex,i==="undefined"&&(i="\\mathrm{undefined}"),n==="undefined"&&(n="\\mathrm{undefined}")}else t=r.text;let l=t&&__dcg_shared_module_exports__['oe'](t);return t?l==="latex"?{is_hole:o,type:"latex",text:t.substring(1,t.length-1)}:l==="text"?{is_hole:o,type:"text",text:t}:{is_hole:o,type:"mixed",text:t}:r.type==="poi"?r.poi.hasEditableLabel()?{is_hole:o,type:"text",text:""}:s===25||s===26?{is_hole:o,type:"latex",text:__dcg_shared_module_exports__['cc']([a.x,a.y],__dcg_shared_module_exports__['Wb'])}:{is_hole:o,type:"latex",text:"\\left("+i+",\\space "+n+"\\right)"}:{is_hole:o,type:"text",text:"?"}}var Y9=4,ZR=class extends bo.Class{getClassName(){var e;return((e=this.props.point())==null?void 0:e.y)!==void 0?"dcg-audio-trace-line dcg-audio-trace-line--horizontal":"dcg-audio-trace-line"}getTraceCoord(){var i,n;let e=(i=this.props.point())==null?void 0:i.x,t=(n=this.props.point())==null?void 0:n.y,o=this.props.projection();if(e!==void 0)return`${Math.round(10*o.mapx(e))/10-Y9/2}px`;if(t!==void 0)return`${Math.round(10*o.mapy(t))/10-Y9/2}px`}getStyle(){var o;let e=this.getTraceCoord(),t=(o=this.props.point())==null?void 0:o.color;return{"--dcg-trace-coord":e,"--dcg-trace-color":t}}template(){return bo.createElement("div",{class:this.bindFn(this.getClassName),style:this.bindFn(this.getStyle)})}},Pw=class extends bo.Class{constructor(){super(...arguments),this.labelsDirty=!1,this.traceLinePt=void 0}init(){this.grapher=this.props.grapher(),this.controller=this.grapher.controller,this.cachedLabelDict={},this.cachedLabelOrder=[],this.hoveredPOI=void 0,this.openedPOI2Sketch={}}template(){return bo.createElement("div",{class:bo.const("dcg-graph-outer"),style:this.const({"z-index":"0"}),didMount:this.bindFn(this.didMountRoot)},bo.createElement("div",null,bo.createElement(Qae,{each:()=>this.cachedLabelOrder},e=>bo.createElement("div",{class:()=>this.getLabelClasses(e),style:()=>this.getLabelStyles(e),didMount:t=>this.linkLabelContainerNode(e,t)},bo.createElement("div",{class:bo.const("dcg-pt"),style:()=>this.getDotStyles(e)}),bo.createElement("div",{class:bo.const("dcg-label"),didMount:t=>this.linkLabelDOMNode(e,t)},this.renderLabelContent(e),bo.createElement(K9,{predicate:()=>this.showPOIbutton(e)},()=>bo.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-button-copy-poi-coordinates"),offset:this.const({top:4})},bo.createElement("button",{class:bo.const("dcg-unstyled-button dcg-poi-copy-button"),onTap:()=>this.copyPOI(e),"aria-label":()=>this.controller.s("graphing-calculator-button-copy-poi-coordinates")},bo.createElement("i",{class:bo.const("dcg-icon-insert")})))))))),bo.createElement(K9,{predicate:()=>!0},()=>bo.createElement(ZR,{point:()=>this.traceLinePt,projection:()=>this.grapher.getProjection()})))}copyPOI(e){delete this.openedPOI2Sketch[e],this.setHoveredPOI(void 0),this.controller.dispatch({type:"add-poi-expression",latex:this.getLabelContent(e).text})}showPOIbutton(e){if(!this.controller.isListEnabled()||!this.controller.isListVisible())return!1;let t=this.getHoveredPOI();(t==null?void 0:t.id)!==parseInt(e)&&(t=void 0);let o=$9(e,this.grapher.graphSketches[this.openedPOI2Sketch[e]])||t;switch(o==null?void 0:o.type){case 1001:case 1002:case 1003:case 1004:return!0;default:return!1}}setTraceLine(e){__dcg_shared_module_exports__['J'](e,this.traceLinePt)||(this.traceLinePt=e,this.update())}getAriaLabelForId(e){let t=this.cachedLabelDict[e],o;t?t.isComplex?o=Gi(__dcg_shared_module_exports__['cc']([t.x,t.y])):o=Jc(this.controller,t.x,t.y):o=this.controller.s("graphing-calculator-label-poi-unknown-coordinates");let i=this.controller.s("graphing-calculator-narration-editable-point-label");return this.controller.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:i,coordinates:o})}renderLabelContent(e){return bo.createElement(Zae,{key:()=>this.getLabelContent(e).type},t=>t==="text"?bo.createElement("span",{class:bo.const("dcg-label-raw-text")},()=>this.getLabelContent(e).text):t==="latex"?bo.createElement(Et,{latex:()=>this.getLabelContent(e).text,config:this.bindFn(this.getMQConfig)}):t==="mixed"?bo.createElement(Bl,{content:()=>this.getLabelContent(e).text,mqConfig:()=>this.controller.getMathquillConfig({})}):t==="MATH"?bo.createElement("div",{class:()=>({"dcg-editable-label-border":!0,"dcg-do-not-blur":!0,"dcg-focus":this.shouldEditableLabelBeFocused(e),"dcg-empty-label":this.getEditableLabelText(e).trim().length===0}),style:()=>({"border-color":__dcg_shared_module_exports__['Sd'](this.getEditableLabelTextColor(e),.3)})},bo.createElement(Ze,{latex:()=>this.getEditableLabelText(e),placeholder:()=>"",isFocused:()=>this.shouldEditableLabelBeFocused(e),capExpressionSize:()=>this.controller.getGraphSettings().config.capExpressionSize,selectOnFocus:bo.const(!1),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.getAriaLabelForId(e),getAriaPostLabel:this.const(""),onUserChangedLatex:o=>this.onLabelInput(o,e),onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:o=>this.onEditableLabelFocusChange(o,e),hasError:this.const(!1),noFadeout:this.const(!0),needsSystemKeypad:()=>!this.controller.isKeypadEnabled()})):bo.createElement("div",{class:()=>({"dcg-resizing-text-input-container":!0,"dcg-editable-label-border":!0,"dcg-focus":this.shouldEditableLabelBeFocused(e),"dcg-empty-label":this.getEditableLabelText(e).trim().length===0}),style:()=>({"border-color":__dcg_shared_module_exports__['Sd'](this.getEditableLabelTextColor(e),.3)}),onScroll:o=>{o.target&&(o.target.scrollLeft=0)}},bo.createElement(Jae,{"aria-label":()=>this.getAriaLabelForId(e),onInput:o=>this.onLabelInput(o,e),value:()=>this.getEditableLabelText(e),onFocus:()=>this.onEditableLabelFocusChange(!0,e),onBlur:()=>this.onEditableLabelFocusChange(!1,e)}),bo.createElement("span",{class:bo.const("dcg-text-input-content")},()=>this.getEditableLabelText(e)||" ")))}getSketchIdFromLabelId(e){let t=this.cachedLabelDict[e];if(t)return t.sketchId}getEditableLabelTextColor(e){let t=this.getSketchIdFromLabelId(e);if(!t)return"#000";let o=this.controller.getItemModel(t);return!o||o.type!=="expression"?"#000":om(o)}onEditableLabelFocusChange(e,t){let o=this.getSketchIdFromLabelId(t);o&&(e?this.controller.dispatch({type:"set-focus-location",location:{type:"editable-label",id:o}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"editable-label",id:o}}),this.update())}shouldEditableLabelBeFocused(e){let t=this.getSketchIdFromLabelId(e),o=this.controller.getFocusLocation();return!(!o||o.type!=="editable-label"||!t||o.id!==t)}onLabelInput(e,t){let o=this.getSketchIdFromLabelId(t);if(!o)return;let i=this.controller.getItemModel(o);if(!i||i.type!=="expression")return;let n=e;this.controller.getItemEditableLabelMode(o)==="MATH"&&n.length>0&&(n="`"+n+"`"),this.controller.dispatch({type:"set-item-label",id:o,label:n})}getEditableLabelText(e){let t=this.getSketchIdFromLabelId(e);if(!t)return"";let o=this.controller.getItemModel(t);return!o||o.type!=="expression"?"":this.controller.getItemEditableLabelMode(t)==="MATH"?o.label.substring(1,o.label.length-1):o.label}linkLabelDOMNode(e,t){let o=this.cachedLabelDict[e];o&&(o.labelDOM=t)}linkLabelContainerNode(e,t){let o=this.cachedLabelDict[e];o&&(o.containerDOM=t)}getLabelClasses(e){let t=this.cachedLabelDict[e];return t?t.classes:{}}getLabelStyles(e){let t=this.cachedLabelDict[e];return t?t.styles:{}}getDotStyles(e){let t=this.cachedLabelDict[e];return t?t.dotStyles:{}}getLabelContent(e){let t=this.cachedLabelDict[e];if(t){let o=this.getSketchIdFromLabelId(e);if(!o)return{is_hole:!1,type:"text",text:""};let i=this.controller.getItemEditableLabelMode(o);return t.classes["dcg-editable-label"]&&i!==void 0&&i!=="NONE"?{is_hole:!1,type:i,text:""}:t.content}return{is_hole:!1,type:"text",text:""}}didMountRoot(e){this.node=e}computeHoveredLabel(e,t){let o;this.hoveredPOI?this.isOpenPOI(this.hoveredPOI)?this.grapher.setLayerClass("hoveredPOI","dcg-mouse-over-opened-poi"):(o=this.computeLabel(e,{poi:this.hoveredPOI,type:"poi"},t,"hovered",1/0),this.grapher.setLayerClass("hoveredPOI","dcg-mouse-over-closed-poi")):this.grapher.setLayerClass("hoveredPOI",void 0);let i=this.getHoveredInteractiveLabel();i&&!i.bareLabel?this.grapher.setLayerClass("interactiveLabel","dcg-mouse-over-opened-poi"):this.grapher.setLayerClass("interactiveLabel",void 0),o&&this.saveLabelToCache(o)}computeTraceLabel(e,t){if(!this.traceInfo)return;let o=this.traceInfo.pt;if(!o)return;let i=new Uh(o.x,o.y,1007,this.traceInfo.branchInfo.sketch,this.traceInfo.branchInfo.branch,0),n=this.computeLabel(e,{poi:i,type:"poi"},t,"trace",1/0);n&&this.saveLabelToCache(n)}computeLabel(e,t,o,i,n){var ye,Ce;let{projection:a}=e,s=t.type==="poi"?t.poi.id+"":t.id;i==="trace"&&(s="*trace*");let l=t.poi,c=a.mapx(l.x),d=a.mapy(l.y),p=c,u=d;if(t.type!=="poi"&&(c=0,d=0),!a.coordsAreOnscreen(c,d,20)||this.isHiddenInteractiveLabel(l))return;let h=!1,m,y=l.sketch,w=y&&y.branches[0];w&&(h=!!("nakedLabel"in w&&w.nakedLabel),m="labelOrientation"in w?w.labelOrientation:void 0);let S=y.id,C=this.controller.getItemModel(S);if(l.hasEditableLabel()&&C&&C.type==="expression"&&!nl(C))return;let v=(C==null?void 0:C.type)==="expression"&&__dcg_shared_module_exports__['fb']((Ce=(ye=C.formula)==null?void 0:ye.typed_constant_value)==null?void 0:Ce.valueType,__dcg_shared_module_exports__['Ka']),E=tF(t,a),_=l.pointIdxOnBranch,T=l.getLabelSize();this.grapher.settings.config.projectorMode&&(T*=1.2),Array.isArray(T)&&(T=T[_]);let I=l.getLabelRotation();Array.isArray(I)&&(I=I[_]);let P=l.getPointOpacity()*this.controller.getGeoModel().getToolFadeOpacity(S),O=l.getTextOutline(),W=l.isPersistent(),X=l.isAttachedToPlottedPoint(),x=l.hasInteractiveLabel(),L=l.hasEditableLabel(),R=(C==null?void 0:C.type)==="expression"&&xs(C),N=this.grapher.clickableObjectsLayer.shouldDrawPressed(S,l.pointIdxOnBranch),z=this.grapher.clickableObjectsLayer.shouldDrawHovered(e,S,l.pointIdxOnBranch),A=this.grapher.clickableObjectsLayer.isKeyboardFocused(S,l.pointIdxOnBranch),U=y.color;if(N){let De=__dcg_shared_module_exports__['jc'](U);De.l>.2?De.l-=.2:De.l+=.1,U=De.toString()}else if(z){let De=__dcg_shared_module_exports__['jc'](U);De.l>.2?De.l-=.1:De.l+=.2,U=De.toString()}let pe=!W,q=X;x&&(q=!0,pe=!0),i==="trace"&&(q=!1,pe=!0);let F=o[s],ge=F&&F.orientation,ne={"dcg-poi-label":!0,"dcg-tracept":i==="trace","dcg-opened":i==="opened","dcg-hole":E.is_hole,"dcg-show-border":pe,"dcg-hide-dot":q,"dcg-naked-label":h,"dcg-editable-label":L&&!this.takingScreenshot,"dcg-has-outline":O&&!pe,"dcg-focus":A};isFinite(T)||(T=1);let j={"font-size":Math.round(T*1100)/10+"%"},oe=!ne["dcg-editable-label"]&&!ne["dcg-tracept"]&&!ne["dcg-show-border"]&&!x,Y=L?"above-canvas":oe?"canvas-labels":"not-drawn";oe?j.visibility="hidden":(j.left=c+"px",j.top=d+"px",I&&(j.transform=`rotate(${I}rad)`),delete j.opacity),W&&U&&(j.color=U);let fe={};return i==="trace"&&(fe["background-color"]=U,fe["border-color"]=U),{id:s,sketchId:S,poi:l,x:l.x,y:l.y,screenX:c,screenY:d,top:u,left:p,rotatedWidth:F==null?void 0:F.rotatedWidth,rotatedHeight:F==null?void 0:F.rotatedHeight,alignedWidth:F==null?void 0:F.alignedWidth,alignedHeight:F==null?void 0:F.alignedHeight,labelDOM:F==null?void 0:F.labelDOM,containerDOM:F==null?void 0:F.containerDOM,cachedDrawingCommands:F==null?void 0:F.cachedDrawingCommands,animation:F==null?void 0:F.animation,forcedOrientation:m,focused:A,isNakedLabel:h,isClickable:R,orientation:ge,rotation:I,classes:ne,styles:j,dotStyles:fe,content:E,hasBorder:l.hasEditableLabel(),willCopyToCanvas:oe,layerFilter:Y,opacity:P,layerNumber:n,isComplex:v,hasOutline:O||l.hasEditableLabel(),objectSpec:t.type!=="poi"?t.type==="angle"?{type:t.type,segments:[a.mapx(t.segments[0]),a.mapy(t.segments[1]),t.segments[2],t.segments[3]]}:{type:t.type,segments:a.map_xy_pairs(t.segments)}:void 0}}computeAllLabels(e,t){let o={},i,n,a=this.grapher.graphSketches;for(let l of this.grapher.getDrawLayers())for(let c of l.drawOrder){let d=a[c];if(!d)continue;let p=d.labels;if(p.length)for(let u=0;u<p.length;u++){let h=p[u],m=this.computeLabel(e,h,t,"opened",l.layer);m&&(Array.isArray(d.color)&&(m.styles.color=d.color[u]),this.saveLabelToCache(m))}}let s={};for(i in this.openedPOI2Sketch){let l=$9(i,a[this.openedPOI2Sketch[i]]);l&&(s[i]=l.sketch.id,n=this.computeLabel(e,{poi:l,type:"poi"},t,"opened",1/0),n&&this.saveLabelToCache(n))}return this.openedPOI2Sketch=s,o}saveLabelToCache(e){let t=e.id;this.cachedLabelDict[t]||this.cachedLabelOrder.push(t),this.cachedLabelDict[t]=e}markLabelsDirty(){this.labelsDirty=!0}getInteractiveLabelUnderPoint(e){let t;for(let o=this.cachedLabelOrder.length-1;o>=0;o--){let i=this.cachedLabelOrder[o],n=this.cachedLabelDict[i];if(!n||!n.rotatedWidth||!n.rotatedHeight)continue;let a=n.screenX,s=n.screenY,{left:l,top:c,rotatedWidth:d,rotatedHeight:p}=n;if(d>0&&p>0&&e.x>a+l&&e.x<a+l+d&&e.y>s+c&&e.y<s+c+p){let u=this.getSketchIdFromLabelId(i);if(u===void 0)continue;let h=this.controller.getItemModel(u);if(!h||h.type!=="expression")continue;if(gw(h))return{type:"editable",model:h,layerNumber:n.layerNumber};!t&&XW(h)?t={type:"draggable",model:h,layerNumber:n.layerNumber,label:{x:n.x,y:n.y}}:!t&&n.isClickable&&(t={type:"clickable",model:h,layerNumber:n.layerNumber,poi:n.poi})}}return t}positionLabels(e,t,o,i){let n=!this.labelsDirty;this.labelsDirty=!1;let a=[];e.forEach(d=>{let p=t[d];if(!p||!p.labelDOM)return;let u,h,m=this.getSketchIdFromLabelId(d);if(m!==void 0){let I=this.grapher.getGraphSketch(m);I&&I.branches&&(u=I.branches[0].pointSize,h=__dcg_shared_module_exports__['Ed'](I.branches[0].graphMode))}(u===void 0||typeof u!="number"||u<0)&&(u=8);let y=this.grapher.settings.config.projectorMode?1.3:1;h&&(u=__dcg_shared_module_exports__['ae'](u));let w=.5*u*y+3,S=p.screenX,C=p.screenY,v=p.classes["dcg-show-border"]?2:0,E=p.labelDOM.clientWidth+v,_=p.labelDOM.clientHeight+v;if(!(E>0&&_>0))return;let T=0;this.takingScreenshot&&p.hasBorder&&(T=5),a.push({renderedLabel:p,pt_x:S,pt_y:C,pt_radius:w+T,rotation:p.rotation,nakedLabel:p.isNakedLabel,width:E,height:_,keepOrientation:n,priorOrientation:p.orientation,enforceOrientation:p.forcedOrientation})});let s=B9(i,o),l=a.map(d=>{if(d.renderedLabel.objectSpec){if(d.renderedLabel.objectSpec.type==="segment")return q9(s,{pt_x1:d.renderedLabel.objectSpec.segments[0],pt_y1:d.renderedLabel.objectSpec.segments[1],pt_x2:d.renderedLabel.objectSpec.segments[2],pt_y2:d.renderedLabel.objectSpec.segments[3],pt_radius:10,width:d.width,height:d.height,keepOrientation:d.keepOrientation,priorOrientation:d.priorOrientation||""});if(d.renderedLabel.objectSpec.type==="polygon")return H9(s,{path:d.renderedLabel.objectSpec.segments,pt_radius:10,width:d.width,height:d.height,keepOrientation:d.keepOrientation,priorOrientation:d.priorOrientation||""});if(d.renderedLabel.objectSpec.type==="angle"){let p=d.renderedLabel.objectSpec.segments,u=this.grapher.settings.config.projectorMode?30:20;return z9(s,{pt_x:p[0],pt_y:p[1],startAngle:p[2],deltaAngle:p[3],isRightAngle:hG(p[3]),radius:u,pt_radius:10,width:d.width,height:d.height,keepOrientation:d.keepOrientation,priorOrientation:d.priorOrientation||""})}}else return U9(s,d);return[]});N9(l).forEach((d,p)=>{let u=a[p].renderedLabel;u.orientation=d.orientation;let h=d.left-d.pt_x,m=d.top-d.pt_y;u.left=h,u.top=m,u.rotatedWidth=d.width,u.rotatedHeight=d.height,u.alignedWidth=a[p].width,u.alignedHeight=a[p].height;let y=d.translate.multiplyWidth*u.alignedWidth+d.translate.addX,w=d.translate.multiplyHeight*u.alignedHeight+d.translate.addY;u.screenX=d.pt_x,u.screenY=d.pt_y;let S=u.animation;S||(S={from_dx:y,from_dy:w,to_dx:y,to_dy:w,now_dx:y,now_dy:w,positionChangeTime:0,orientation:d.orientation},u.animation=S),S.orientation===d.orientation&&(S.to_dx=y,S.to_dy=w);let C,v,E=(Date.now()-S.positionChangeTime)/ese;if(E<1){let T=.3*E+2.4*E*E-1.7*E*E*E;C=S.from_dx*(1-T)+S.to_dx*T,v=S.from_dy*(1-T)+S.to_dy*T}else C=S.to_dx,v=S.to_dy;S.now_dx=C,S.now_dy=v,S.to_dx=y,S.to_dy=w,S.orientation!==d.orientation&&(S.positionChangeTime=Date.now(),S.from_dx=C,S.from_dy=v,S.orientation=d.orientation);let _=u.labelDOM;if(_&&!u.willCopyToCanvas){_.style.transform=`translate(${S.now_dx}px,${S.now_dy}px)`;let T=u.containerDOM;T&&(T.style.left=d.pt_x+"px",T.style.top=d.pt_y+"px")}})}copyToCtx(e,t){Rl(e,"labels");let o=this.node.getBoundingClientRect();this.cachedLabelOrder.forEach(i=>{var p,u;let n=this.cachedLabelDict[i];if(!n||!n.willCopyToCanvas)return;let a=n.labelDOM;if(!a||t.filter!==n.layerFilter||!t.allowedSketches.has(n.sketchId))return;let s=(p=n.cachedDrawingCommands)==null?void 0:p.commands,l={};for(let h in W9)if(W9[h]===!0){let m=n[h],y=(u=n.cachedDrawingCommands)==null?void 0:u.cacheKeys[h];l[h]=m,__dcg_shared_module_exports__['J'](y,m)||(s=void 0)}if(!s){let h={originX:o.x,originY:o.y,hasOutline:!!n.hasOutline,hasBorder:!!n.hasBorder,hasFocus:!!n.focused&&n.isNakedLabel};s=vG(a,h),n.cachedDrawingCommands={cacheKeys:l,commands:s}}let c=this.computeRotatedCenter(n.screenX,n.screenY,n.rotation),d={x:0,y:0};n.animation&&(d.x=n.animation.now_dx,d.y=n.animation.now_dy),e.save(),e.globalAlpha=n.opacity,e.rotate(n.rotation),e.translate(c.x+d.x,c.y+d.y),CG(s,e),e.restore()}),Fl(e)}areAnyLabelsAnimating(){var e;for(let t in this.cachedLabelDict){let o=(e=this.cachedLabelDict[t])==null?void 0:e.animation;if(o&&(o.now_dx!==o.to_dx||o.now_dy!==o.to_dy))return!0}return!1}computeRotatedCenter(e,t,o){let i=Math.cos(-o),n=Math.sin(-o),a=e*i-t*n,s=t*i+e*n;return{x:a,y:s}}recomputeLabels(e,t,o){let i=this.cachedLabelDict;this.cachedLabelDict={},this.cachedLabelOrder=[],this.computeAllLabels(e,i),this.computeHoveredLabel(e,i),this.computeTraceLabel(e,i),this.update(),this.positionLabels(this.cachedLabelOrder,this.cachedLabelDict,t,o)}clearOpenedPOI(){this.openedPOI2Sketch={}}closePOI(e){delete this.openedPOI2Sketch[e.id]}openPOI(e){this.openedPOI2Sketch[e.id]=e.sketch.id}isOpenPOI(e){return this.openedPOI2Sketch.hasOwnProperty(e.id)}isHiddenInteractiveLabel(e){return!e||!e.hasInteractiveLabel()?!1:!this.isOpenPOI(e)&&this.getHoveredPOI()!==e}setHoveredPOI(e){this.hoveredPOI=e}getHoveredPOI(){return this.hoveredPOI}getHoveredInteractiveLabel(){let e=this.getHoveredPOI();if(e&&e.hasInteractiveLabel())return e}setTraceInfo(e){this.traceInfo=e}isTracing(){return!!this.traceInfo}getTraceInfo(){return this.traceInfo}getMQConfig(){return this.controller.getMathquillConfig({})}};function Bw(r,e){let t=r[e];return Array.isArray(t)&&r.tableInfo?t[r.tableInfo.rowIndex]:t}var CC=class{constructor(e){this.geoHoveredObjects={},this.grapher=e,this.renderedPointsIdOrder=[],this.renderedPoints={},this.speakThrottledAlert=__dcg_shared_module_exports__['E'](()=>{let t=this.getPOIUnderAttention();if(!t){this.lastAriaAlert=void 0;return}let o=this.getAriaAlert({id:t.id,lastAriaAlert:this.lastAriaAlert,includeUsageInstructions:!1});o!=null&&o.updated&&(Te(o.completeMessage),this.lastAriaAlert=o)},1e3,{leading:!1,trailing:!0})}recomputeMovablePoints(e){let{projection:t}=e,o=this.grapher.graphSketches,i=this.renderedPoints;this.renderedPoints={},this.renderedPointsIdOrder=[];let n=this.grapher.poiController.keyboardAttentionManager.getKeyboardAttention(),a=n==null?void 0:n.calcId,s=(n==null?void 0:n.listIndex)||0,l=S=>{let C=!!n&&a===S.sketch.id&&s===S.listIndex,v=this.processPOI(t,S,i[S.id],C);v&&(this.renderedPoints[S.id]=v,this.renderedPoints[S.id].poi=S,this.renderedPointsIdOrder.push(S.id))};for(let S of this.grapher.generateMergeDrawOrder()){let C=o[S];C&&(C.getMovablePoints().forEach(l),C.getStaticLabeledPoints().forEach(l))}let c=this.renderedPoints[this.hoveredPointId],d=this.renderedPoints[this.pressedPointId],p=c&&c.poi,u=d&&d.poi;p||this.setHoveredPointId(void 0),u||this.setPressedPointId(void 0);let h=u||p,m,y;if(h?(m=h.type==="movable-point"&&h.tableInfo&&h.tableInfo.dragX,y=h.type==="movable-point"&&h.tableInfo&&h.tableInfo.dragY,m&&y||!m&&!y?this.grapher.setLayerClass("movablePoints","dcg-mouse-over-movable-point"):m?this.grapher.setLayerClass("movablePoints","dcg-mouse-over-movable-point-ew"):this.grapher.setLayerClass("movablePoints","dcg-mouse-over-movable-point-ns")):this.grapher.setLayerClass("movablePoints",void 0),!this.getPOIUnderAttention()){this.lastAriaAlert=void 0;return}this.speakThrottledAlert()}_clampedOpacity(e){return e<0?0:e>1?1:__dcg_shared_module_exports__['O'](e)?e:1}getAllRenderedObjects(e){return this.renderedPointsIdOrder.filter(t=>e?this.renderedPoints[t].type===e:!0).map(t=>this.renderedPoints[t])}getOrderedTabTargets(e){let t=[];return this.renderedPointsIdOrder.forEach(o=>{let i=this.renderedPoints[o];if(e&&i.type!==e||this.getTabIndex(o)===-1)return;let n=i.poi;t.push({calcId:n.sketch.id,listIndex:n.listIndex,polygonEdge:void 0,description:this.getAriaLabel(o)})}),t}redrawToCtx(e,t,o,i){let n=this.grapher.graphSketches;for(let a of o){let s=n[a];if(!s)continue;let l=s.branches[0],c,d;__dcg_shared_module_exports__['he'](l)&&(c=l.pointOpacity,d=l.pointSize!==void 0?l.pointSize:8),s.getMovablePoints().forEach(p=>{let u;if(i.renderForScreenshot)u={screenX:t.mapx(p.x),screenY:t.mapy(p.y),color:p.color,pointOpacity:c,pointSize:d,animationPercent:0};else if(u=this.renderedPoints[p.id],!u||u.type!=="movable")return;i.showMovablePoints?this.drawMovablePointOnCtx(e,p.sketch,u):Su.drawPointToCtx({ctx:e,projection:t,x:p.x,y:p.y,alpha:c,sketch:p.sketch,sizeFactor:1,opacityFactor:1,colorOverride:p.color,finalHardcodedSize:d})})}}processPOI(e,t,o,i){let n=t.id,a=t.x,s=t.y,l=e.mapx(a),c=e.mapy(s),d=e.coordsAreOnscreen(l,c,20);if(!d&&!i)return;let p=t.sketch?this.grapher.controller.getItemModel(t.sketch.id):void 0,u=!!(p&&Za(p));if(!(p&&this.grapher.controller.shouldIgnoreGraphInteractions(p)))return o||(t.type==="movable-point"?o={type:"movable",id:n,pointOnScreen:d,poi:t,projection:e,screenX,screenY,color:Bw(t,"color"),pointOpacity:Bw(t,"pointOpacity"),pointSize:Bw(t,"pointSize"),pointIsHovered:!1,pointIsPressed:!1,selected:u,lastHoverActionTime:0,animationPercent:0}:p&&p.type==="expression"&&p.label!==void 0&&p.showLabel&&Ci(p)!=="NONE"?o={type:"draggable-label",id:n,pointOnScreen:d,selected:u,poi:t,projection:e,screenX,screenY}:o={type:"static",id:n,pointOnScreen:d,poi:t,projection:e,screenX,screenY,selected:u}),o.pointOnScreen=d,o.poi=t,o.projection=e,o.screenX=l,o.screenY=c,o.type==="movable"&&(o.color=Bw(o.poi,"color"),o.pointOpacity=Bw(o.poi,"pointOpacity"),o.pointSize=Bw(o.poi,"pointSize"),o.selected=u,this.updateMovablePointAnimation(o,i)),o}drawMovablePointOnCtx(e,t,o){var m;let i=o.pointSize/2*(this.grapher.settings.config.projectorMode?1.3:1);i<0&&(i=0),t.showHighlight&&(i*=1.15);let n=Array.isArray(o.color)?o.color[0]:o.color,a=o.screenX,s=o.screenY,l=o.animationPercent||0;e.save();let c=e.globalAlpha,d=this.shouldDrawGhosted(t.id)?E_.IS_GHOSTED:v0,p=this._clampedOpacity(d*o.pointOpacity);p*=(m=this.grapher.controller.getGeoModel().getToolFadeOpacity(t.id))!=null?m:1;let u=__dcg_shared_module_exports__['be'](i);e.fillStyle=n,e.globalAlpha=.35*p,e.beginPath(),e.moveTo(a+u,s),e.arc(a,s,u,0,Math.PI*2,!0),e.closePath(),e.fill(),e.globalAlpha=p,(t.tokenHovered||!!this.geoHoveredObjects[t.id])&&(i=.7*i+.3*u),i=i+(u-i)*l,e.beginPath(),e.moveTo(a+i,s),e.arc(a,s,i,0,Math.PI*2,!0),e.closePath(),e.fill(),e.globalAlpha=c,e.restore()}updateMovablePointAnimation(e,t){let o=Date.now(),i=e.id,n=this.hoveredPointId===i||t,a=this.pressedPointId===i;e.pointIsPressed=a,n!==e.pointIsHovered&&(e.pointIsHovered=n,e.lastHoverActionTime=o);let s=e.animationPercent||0,c=.004*(o-e.lastHoverActionTime);a?s=1:n?(s+=c,s>=1?s=1:this.requestRedrawNextFrame()):(s-=c,s<=0?s=0:this.requestRedrawNextFrame()),e.animationPercent=s}shouldDrawGhosted(e){if(!e)return!1;let t=this.grapher.controller.getItemModel(e);return!t||t.type!=="expression"?!1:ma(t)}getTabIndex(e){if(this.grapher.controller.getActiveTool()!=="selection")return-1;let t=this.renderedPoints[e];if(!t)return-1;let o=t.poi,i=this.grapher.controller.getItemEditableLabelMode(o.sketch.id),n=this.grapher.controller.getItemModel(o.sketch.id),a=n&&n.type==="expression"&&!xs(n)&&(t.type==="movable"||i===void 0||i==="NONE"),s=this.grapher.settings,l=s.config.graphpaper&&s.config.enableTabindex;return a&&l?0:-1}getAriaHidden(){return!this.grapher.settings.config.graphpaper}getAriaLabel(e){let t=this.getAriaAlert({id:e,includeUsageInstructions:!1});return t&&t.completeMessage}speakAriaAlert(){var i;let e=(i=this.getPOIUnderAttention())==null?void 0:i.id;if(e){let n=this.renderedPoints[e];if(!n||n.type==="static")return this.lastAriaAlert=void 0,!1}let t=this.getAriaAlert({id:e,lastAriaAlert:this.lastAriaAlert,includeUsageInstructions:!0}),o=!this.lastAriaAlert||this.lastAriaAlert.id!==e||!!(t!=null&&t.updated);return this.lastAriaAlert=t,t!=null&&t.completeMessage?(o&&Te(t.completeMessage),!0):!1}getAriaAlert(e){var W,X;let{id:t,lastAriaAlert:o,includeUsageInstructions:i}=e;if(!t)return;let n=this.renderedPoints[t];if(!n)return;let{controller:a}=this.grapher,s=n.poi.sketch?a.getItemModel(n.poi.sketch.id):void 0;if(!s||s.type!=="expression")return;o&&o.id!==t&&(o=void 0);let l=n.poi,c=n.pointOnScreen,d=n.projection,p=((W=s==null?void 0:s.formula.typed_constant_value)==null?void 0:W.valueType)===__dcg_shared_module_exports__['Ka']?(X=s==null?void 0:s.formula.typed_constant_value)==null?void 0:X.value:void 0;if(!l||!d||!d.viewport)return;let h=o==null?void 0:o.label,m=l.ariaLabel;a.isGeometry()&&$c(s)&&(m=sG(s,a,{poi:l,includeDetails:!1}).join(" "));let y=h!==m,w=n.selected,S=!!(o!=null&&o.selected)!==w,C=l.x,v=l.y,E=C!==(o==null?void 0:o.coordX)||v!==(o==null?void 0:o.coordY),_=o&&(y||S||E),T=m||a.s("graphing-calculator-narration-movable-point-prefix"),I=!a.isGeometry()&&(n.type==="movable"||n.type==="draggable-label")&&i?a.s("graphing-calculator-narration-movable-point-suffix-usage-instructions"):"",P=c?"":a.s("graphing-calculator-narration-movable-point-off-screen-prompt"),O;if(o?y||!E&&S?O=T+P:E?p?O=`${Gi(__dcg_shared_module_exports__['cc'](p))}${P}`:O=`${Md(a,C)} ${Ad(a,v)}${P}`:S?O=T:O=o.completeMessage:O=`${a.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:T,coordinates:p?Gi(__dcg_shared_module_exports__['cc'](p)):Jc(a,C,v)})}${I}${P}`,(!o||_)&&a.isGeometry()&&(n.type==="movable"||n.type==="draggable-label")){let x=a.getActiveTool();(x==="selection"||x==="box-selection")&&(O=rF(O||m||"",s,a))}return{id:t,coordX:C,coordY:v,label:m,selected:w,completeMessage:O,updated:_}}setHoveredPointId(e){e!==this.hoveredPointId&&(this.hoveredPointId=e,this.requestRedrawNextFrame())}isMovingPoint(){return!!this.pressedPointId}setPressedPointId(e){e!==this.pressedPointId&&(this.pressedPointId=e,this.requestRedrawNextFrame())}getPOIUnderAttention(){let e=this.grapher.poiController.keyboardAttentionManager.getKeyboardAttention();if(!e)return;let t=e.listIndex||0;for(let o in this.renderedPoints){let n=this.renderedPoints[o].poi;if(n.sketch.id===e.calcId&&n.listIndex===t)return n}}setGeoHoveredObjects(e){__dcg_shared_module_exports__['J'](e,this.geoHoveredObjects)||(this.geoHoveredObjects=e,this.requestRedrawNextFrame())}requestRedrawNextFrame(){this.grapher.controller.requestRedrawGraph()}};function Jc(r,e,t){return Md(r,e)+" "+Ad(r,t)}function Md(r,e){let t=r.getGraphSettings().showXAxis,o=r.get2dProjection();if(!o)return"";let{width:i}=o.screen;return t?r.s("graphing-calculator-narration-audio-trace-property-x",{x:Gi(__dcg_shared_module_exports__['Tb'](e,wb(o,e)).latex)}):r.s("graphing-calculator-narration-x-percentage-coordinate",{x:Math.round(o.mathToPixels.mapX(e)/i*1e3)/10})}function Ad(r,e){let t=r.getGraphSettings().showYAxis,o=r.get2dProjection();if(!o)return"";let{height:i}=o.screen;return t?r.s("graphing-calculator-narration-audio-trace-property-y",{y:Gi(__dcg_shared_module_exports__['Tb'](e,wb(o,e)).latex)}):r.s("graphing-calculator-narration-y-percentage-coordinate",{y:Math.round(o.mathToPixels.mapY(e)/i*1e3)/10})}function Lo(r,e){if(!r)return"";let{controller:t}=r;if(r.type==="expression"){let o=t.isItemSecret(r.id);switch(e){case"describe":return o?t.s("graphing-calculator-narration-describe-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-describe-expression",{index:r.displayIndex});case"delete":return o?t.s("graphing-calculator-narration-delete-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-delete-expression",{index:r.displayIndex});case"duplicate":return o?t.s("graphing-calculator-narration-duplicate-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-duplicate-expression",{index:r.displayIndex});case"show":return o?t.s("graphing-calculator-narration-show-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-show-expression",{index:r.displayIndex});case"hide":return o?t.s("graphing-calculator-narration-hide-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-hide-expression",{index:r.displayIndex});case"show-options":return o?t.s("graphing-calculator-narration-show-options-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-show-options-expression",{index:r.displayIndex});case"hide-options":return o?t.s("graphing-calculator-narration-hide-options-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-hide-options-expression",{index:r.displayIndex});case"create_table":return o?t.s("graphing-calculator-narration-create-table-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-create-table-expression",{index:r.displayIndex});case"rename":return o?t.s("graphing-calculator-narration-rename-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-rename-expression",{index:r.displayIndex});case"mute":return o?t.s("graphing-calculator-narration-mute-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-mute-expression",{index:r.displayIndex});case"unmute":return o?t.s("graphing-calculator-narration-unmute-secret-expression",{index:r.secretIndex}):t.s("graphing-calculator-narration-unmute-expression",{index:r.displayIndex})}}if(r.type==="image")switch(e){case"describe":return t.s("graphing-calculator-narration-describe-image",{index:r.displayIndex});case"delete":return t.s("graphing-calculator-narration-delete-image",{index:r.displayIndex});case"duplicate":return t.s("graphing-calculator-narration-duplicate-image",{index:r.displayIndex});case"show":return t.s("graphing-calculator-narration-show-image",{index:r.displayIndex});case"hide":return t.s("graphing-calculator-narration-hide-image",{index:r.displayIndex});case"show-options":return t.s("graphing-calculator-narration-show-options-image",{index:r.displayIndex});case"hide-options":return t.s("graphing-calculator-narration-hide-options-image",{index:r.displayIndex});case"edit_title":return t.s("graphing-calculator-narration-edit-image-title",{index:r.displayIndex})}if(r.type==="text")switch(e){case"describe":return t.s("graphing-calculator-narration-describe-text",{index:r.displayIndex});case"delete":return t.s("graphing-calculator-narration-delete-text",{index:r.displayIndex});case"duplicate":return t.s("graphing-calculator-narration-duplicate-text",{index:r.displayIndex});case"show":return t.s("graphing-calculator-narration-show-text",{index:r.displayIndex});case"hide":return t.s("graphing-calculator-narration-hide-text",{index:r.displayIndex});case"edit_title":return t.s("graphing-calculator-narration-edit-text-title",{index:r.displayIndex})}if(r.type==="table")switch(e){case"describe":return t.s("graphing-calculator-narration-describe-table",{index:r.displayIndex});case"delete":return t.s("graphing-calculator-narration-delete-table",{index:r.displayIndex});case"duplicate":return t.s("graphing-calculator-narration-duplicate-table",{index:r.displayIndex});case"show":return t.s("graphing-calculator-narration-show-table",{index:r.displayIndex});case"hide":return t.s("graphing-calculator-narration-hide-table",{index:r.displayIndex});case"rename":return t.s("graphing-calculator-narration-rename-table",{index:r.displayIndex})}if(r.type==="folder"){let o=!!r.title;switch(e){case"describe":return o?t.s("graphing-calculator-narration-describe-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-describe-folder-index",{index:r.displayIndex});case"collapse":return o?t.s("graphing-calculator-narration-collapse-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-collapse-folder-index",{index:r.displayIndex});case"expand":return o?t.s("graphing-calculator-narration-expand-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-expand-folder-index",{index:r.displayIndex});case"show":return o?t.s("graphing-calculator-narration-show-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-show-folder-index",{index:r.displayIndex});case"hide":return o?t.s("graphing-calculator-narration-hide-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-hide-folder-index",{index:r.displayIndex});case"duplicate":return o?t.s("graphing-calculator-narration-duplicate-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-duplicate-folder-index",{index:r.displayIndex});case"delete":return o?t.s("graphing-calculator-narration-delete-folder-title",{folder:r.title}):t.s("graphing-calculator-narration-delete-folder-index",{index:r.displayIndex});case"edit_title":return t.s("graphing-calculator-narration-edit-folder-title",{index:r.displayIndex})}}switch(e){case"describe":return t.s("graphing-calculator-narration-describe");case"delete":return t.s("graphing-calculator-narration-delete");case"duplicate":return t.s("graphing-calculator-narration-duplicate");case"expand":return t.s("graphing-calculator-narration-expand");case"collapse":return t.s("graphing-calculator-narration-collapse");case"show":return t.s("graphing-calculator-narration-show");case"hide":return t.s("graphing-calculator-narration-hide");case"show-options":return t.s("graphing-calculator-narration-show-options");case"hide-options":return t.s("graphing-calculator-narration-hide-options");case"create_table":return t.s("graphing-calculator-narration-create-table");case"rename":return t.s("graphing-calculator-narration-rename");case"edit_title":return t.s("graphing-calculator-narration-edit-title");case"mute":return t.s("graphing-calculator-narration-mute");case"unmute":return t.s("graphing-calculator-narration-unmute");default:return e}}function Bi(r,e,t={includeDetails:!0}){var s,l,c;if(!r)return e.s("graphing-calculator-narration-geometry-nothing-selected");let o=t.description?t.description:"";if(r.type!=="expression"){if(r.type==="image"){let d=o!==""?o:Lo(r,"describe"),p=t.listIndex||0,{x:u,y:h}=r.formula.dimensions;u&&h&&typeof u[p]=="number"&&typeof h[p]=="number"?o=e.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:d,coordinates:Jc(e,u[p],h[p])}):o=d}}else(!r.latex||!((s=r.formula)!=null&&s.typed_constant_value))&&(o=o!==""?o:Lo(r,"describe"));let i=t.poi&&t.poi.sketch.showPOI&&t.poi.type==="static-labeled-point",n=r.type==="expression"&&((l=r.formula.typed_constant_value)==null?void 0:l.valueType)===__dcg_shared_module_exports__['Ka']?(c=r.formula.typed_constant_value)==null?void 0:c.value:void 0;!o&&$c(r)?(o=rse(r,e,t),o=ise(o,r,e,t)):t.includeDetails&&t.poi&&!i&&(o=n?o:e.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:o,coordinates:Jc(e,t.poi.x,t.poi.y)}));let a=o;return t.includeSelectionState&&!Zx(r)&&!i&&(a=rF(a,r,e)),Zx(r)&&(a=e.s("shared-calculator-narration-item-clickable",{item:a})),a}function rse(r,e,t={includeDetails:!0}){var l;let{value:o,valueType:i}=Fh(r,t);if(!o)return e.s("shared-calculator-narration-item-unknown");let n=[];if(__dcg_shared_module_exports__['bb'](i))n=j7(r,e,t);else switch(i){case __dcg_shared_module_exports__['da']:n=sG(r,e,t);break;case __dcg_shared_module_exports__['sa']:n=z7(r,e,t);break;case __dcg_shared_module_exports__['ua']:n=H7(r,e,t);break;case __dcg_shared_module_exports__['oa']:n=K7(r,e,t);break;case __dcg_shared_module_exports__['wa']:case __dcg_shared_module_exports__['ya']:case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['Ga']:n=W7(r,e,t);break;case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:n=$7(r,e,t);break;default:n.push(e.s("shared-calculator-narration-item-unknown"))}let a=n.join(" "),s=(l=r.formula.geometry)==null?void 0:l.call;return s&&(a=ose(a,s,e)),a}function ose(r,e,t){let o,i=e.parents;if(e.symbol==="apply"){let n=i[0].type!=="arbitrary-expression"?__dcg_shared_module_exports__['fd'](i[0]):void 0,a=n?t.getItemsByIdentifier(n):[];if(n&&a.length===0)o=n;else for(let s of a){if(s.type!=="expression")continue;let l=s.formula.geometry;if(!(!l||!l.call)){o=l.call.symbol;break}}}else if(__dcg_shared_module_exports__['gd'](e.symbol))o=e.symbol;else return r;switch(o){case"coterminal":case"supplement":return r;case"dilate":return t.s("graphing-calculator-narration-geometry-dilated-item",{item:r});case"rotate":return t.s("graphing-calculator-narration-geometry-rotated-item",{item:r});case"translate":return t.s("graphing-calculator-narration-geometry-translated-item",{item:r});case"reflect":return t.s("graphing-calculator-narration-geometry-reflected-item",{item:r});default:return t.s("graphing-calculator-narration-geometry-transformed-item",{item:r})}}function ise(r,e,t,o){var i,n;return o.listIndex!==void 0&&((n=(i=e.formula)==null?void 0:i.geometry)!=null&&n.valueType)&&__dcg_shared_module_exports__['bb'](e.formula.geometry.valueType)?t.s("graphing-calculator-narration-item-with-list-index",{listIndex:o.listIndex+1,item:r}):o.polygonEdge!==void 0?t.s("graphing-calculator-narration-geometry-edge-of-polygon",{polygonEdge:o.polygonEdge+1,item:r}):r}function rF(r,e,t){return(e&&Za(e)?t.s("shared-calculator-narration-item-selected",{item:r}):t.s("shared-calculator-narration-item-unselected",{item:r})).trim()}function ct(r){return{shouldBeFocused:()=>vb(r),onFocusedChanged:e=>{oF(r,e)}}}function vb(r){let e=r.predicate;if(e&&!e())return!1;let t=r.controller.getFocusLocation();return t&&__dcg_shared_module_exports__['J'](t,r.location)}function oF(r,e){let t=r.predicate;t&&!t()||(e?r.controller.dispatch({type:"set-focus-location",location:r.location}):r.controller.dispatch({type:"blur-focus-location",location:r.location}))}var{cos:rs,sin:vs,max:Em,min:Uw,abs:Pd,sign:X9,hypot:J9,PI:zs}=Math,SC=22,ba=SC/2,ya=SC/2,bt=r=>r.toFixed(1),nF={type:"arc",center:[0,0],radius:1,startAngle:zs/4,endAngle:zs/4+zs},Q9=[[-1,0],[0,1],[1,-1]],aF={start:0,delta:zs/4},iF=zs/4,sF={angle:zs/8,side:1},nse=["dcg-token-perpendicular","dcg-token-parallel","dcg-token-translate","dcg-token-vector","dcg-token-segment","dcg-token-line","dcg-token-ray","dcg-token-angle","dcg-token-angles","dcg-token-directedangle","dcg-token-directedangles","dcg-token-arc","dcg-token-polygon"];function Z9(r){return nse.includes(r)}function e$(r){switch(r.type){case"angle":case"angles":return use(r.start,r.delta);case"directedangle":case"directedangles":return hse(r.start,r.delta);case"arc":return gse(r.arcDetails);case"polygon":return mse(r.points);case"segment":return fse(r.angle);case"line":return bse(r.angle);case"anglebisector":case"ray":return yse(r.angle);case"vector":case"translate":return xse(r.angle);case"parallel":return wse(r.angle,r.side);case"perpendicular":return vse(r.angle)}}function t$(r,e,t){var o,i,n,a,s,l,c;switch(r){case"angle":case"angles":case"directedangle":case"directedangles":{let d=(o=ase(r,e))!=null?o:aF,{start:p,delta:u}=d;return{type:r,start:p,delta:u}}case"arc":{let d=(i=sse(e))!=null?i:nF;return{type:r,arcDetails:d}}case"polygon":{let d=(n=lse(e))!=null?n:Q9;return{type:r,points:d}}case"perpendicular":case"anglebisector":case"ray":case"line":case"segment":{let d=(a=r$(e))!=null?a:iF;return{type:r,angle:d}}case"translate":{let d=(s=dse(e))!=null?s:iF;return{type:r,angle:d}}case"vector":{let d=(l=cse(e))!=null?l:iF;return{type:r,angle:d}}case"parallel":{let{angle:d,side:p}=(c=pse(e,t))!=null?c:sF;return{type:r,angle:d,side:p}}}}function ase(r,e){if((e==null?void 0:e.valueType)!==__dcg_shared_module_exports__['Aa']&&(e==null?void 0:e.valueType)!==__dcg_shared_module_exports__['Ca'])return;let[t,o,i]=e.value;return{type:r,start:o,delta:i}}function sse(r){return(r==null?void 0:r.valueType)===__dcg_shared_module_exports__['ua']?__dcg_shared_module_exports__['Hc'](r.value):void 0}function lse(r){return(r==null?void 0:r.valueType)===__dcg_shared_module_exports__['oa']?r.value:void 0}function r$(r){let e=r==null?void 0:r.valueType;if(e!==__dcg_shared_module_exports__['qa']&&e!==__dcg_shared_module_exports__['wa']&&e!==__dcg_shared_module_exports__['ya'])return;let[[t,o],[i,n]]=r.value;return __dcg_shared_module_exports__['Kb'](i-t,n-o)}function cse(r){if((r==null?void 0:r.valueType)!==__dcg_shared_module_exports__['Ga'])return;let[e,t]=r.value[0];return __dcg_shared_module_exports__['Kb'](e,t)}function dse(r){if((r==null?void 0:r.valueType)!==__dcg_shared_module_exports__['Ea'])return;let[e,t]=r.value[1];return __dcg_shared_module_exports__['Kb'](e,t)}function pse(r,e){var i;if((r==null?void 0:r.valueType)!==__dcg_shared_module_exports__['wa'])return sF;let t=(i=r$(r))!=null?i:sF.angle,o=1;if(e.length===2){let n=e[0],a=e[1],s=n==null?void 0:n.valueType;if((s===__dcg_shared_module_exports__['qa']||s===__dcg_shared_module_exports__['wa']||s===__dcg_shared_module_exports__['ya'])&&(a==null?void 0:a.valueType)===__dcg_shared_module_exports__['da']){let[l,c]=n.value[0],[d,p]=n.value[1],[u,h]=a.value,m=d-l,w=-(p-c),S=m,C=d-u,v=p-h;o=w*C+S*v>0?1:-1}}return{angle:t,side:o}}function o$(r,e){(!isFinite(r)||!isFinite(e))&&(r=aF.start,e=aF.delta);let t=rs(r),o=-vs(r),i=rs(r+e),n=-vs(r+e),a=Em(0,t,i)-Uw(0,t,i),s=Em(0,o,n)-Uw(0,o,n),l=Pd(e)>zs,c=l?2:Em(a,s),d=.73*SC/c,p=d*t,u=d*o,h=d*i,m=d*n,y=l?0:(Uw(0,p,h)+Em(0,p,h))/2,w=l?0:(Uw(0,u,m)+Em(0,u,m))/2,S=ba-y,C=ya-w;return{x1:p,y1:u,x2:h,y2:m,tx:S,ty:C,r:d}}function use(r,e){let{x1:t,y1:o,x2:i,y2:n,tx:a,ty:s,r:l}=o$(r,e),c=.6,d=c*t,p=c*o,u=c*i,h=c*n,m=Pd(e)>zs?1:0,y=e>0?0:1,w=`M ${bt(d)} ${bt(p)} A ${bt(c*l)} ${bt(c*l)} 0 ${m} ${y} ${bt(u)} ${bt(h)}`;return`<g transform="translate(${a} ${s})"><polyline points="${bt(t)},${bt(o)},0,0,${bt(i)},${bt(n)}" /><path d = "${w}" class="dcg-token-angle-arc"/><path d = "${w} L 0 0" class="dcg-token-angle-fill"/></g>`}function hse(r,e){let{x1:t,y1:o,x2:i,y2:n,tx:a,ty:s,r:l}=o$(r,e),c=.8,d=c*t,p=c*o,u=__dcg_shared_module_exports__['wc'](1/(c*l),0,2),h=(Pd(e)-u)*X9(e),m=(e+h)/2,y=c*l*rs(r+h),w=-c*l*vs(r+h),S=X9(e),C=S*3.5,v=S*(60*zs)/180,E=.7,_=r+m,T=y+C*vs(_+v*(1-E)),I=w+C*rs(_+v*(1-E)),P=y+C*vs(_-v*E),O=w+C*rs(_-v*E),W=Pd(e)>zs?1:0,X=e>0?0:1,x=`M ${bt(d)} ${bt(p)} A ${bt(c*l)} ${bt(c*l)} 0 ${W} ${X} ${bt(y)} ${bt(w)}`,L=`M ${bt(T)} ${bt(I)} L ${bt(y)} ${bt(w)} L ${bt(P)} ${bt(O)}`;return`<g transform="translate(${a} ${s})"><polyline points="${bt(t)},${bt(o)},0,0,${bt(i)},${bt(n)}" />`+(Pd(e)<.05?"":`<path d = "${x}" class="dcg-token-directedangle-arc"/>`)+(Pd(e)<.29?"":`<path d = "${L}" class="dcg-token-directedangle-arrowhead"/>`)+"</g>"}function gse(r){if(r===void 0)return"";switch(r.type){case"arc":{let{startAngle:e,endAngle:t}=r;(!isFinite(e)||!isFinite(t))&&(e=nF.startAngle,t=nF.endAngle);let o=t-e,i=.386*SC;if(Pd(o)>6.16)return`<circle cx="${bt(ba)}" cy="${bt(ya)}" r="${bt(i)}">`;if(Pd(o)<zs/6){let C=(e+t)/2,v=i*vs(C),E=i*rs(C);return`<path d = "M ${bt(ba-v)} ${bt(ya-E)} l ${bt(2*v)} ${bt(2*E)}" />`}let n=.66*zs;Pd(o)<n&&(i/=Pd(o)/2);let a=i*rs(e),s=-i*vs(e),l=i*rs(t),c=-i*vs(t),d=i*rs((e+t)/2),p=-i*vs((e+t)/2),u=__dcg_shared_module_exports__['wc'](2*(zs-Pd(o)),0,1),h=u*(Uw(a,l,d)+Em(a,l,d))/2,m=u*(Uw(s,c,p)+Em(s,c,p))/2,y=ba-h,w=ya-m;return`<path d = "${`M ${bt(a+y)} ${bt(s+w)} A ${bt(i)} ${bt(i)} 0 ${Pd(o)>zs?1:0} ${o>0?0:1} ${bt(l+y)} ${bt(c+w)}`}" />`}case"rays":{let{start1:e,end1:t}=r,o=t[0]-e[0],i=t[1]-e[1];(!isFinite(o)||!isFinite(o))&&(o=1,i=1);let n=J9(o,i),a=3,s=a*o/n,l=-a*i/n;return`<path d = "M ${bt(ba-s)} ${bt(ya-l)} l ${bt(-5*s)} ${bt(-5*l)}" /><path d = "M ${bt(ba+s)} ${bt(ya+l)} l ${bt(5*s)} ${bt(5*l)}" />`}case"segment":{let{start:e,end:t}=r,o=t[0]-e[0],i=t[1]-e[1];(!isFinite(o)||!isFinite(o))&&(o=1,i=1);let n=J9(o,i),a=7,s=a*o/n,l=a*i/n;return`<path d = "M ${bt(ba-s)} ${bt(ya-l)} l ${bt(2*s)} ${bt(2*l)}" />`}}}function mse(r){if(r.length<2)return"";r.some(S=>!isFinite(S[0])||!isFinite(S[1]))&&(r=Q9);let e=r[0];r=r.slice(1);let t=e[0],o=t,i=e[1],n=i;for(let S=0;S<r.length;S++){let C=r[S][0],v=r[S][1];C<t&&(t=C),C>o&&(o=C),v<i&&(i=v),v>n&&(n=v)}let a=(t+o)/2,s=(i+n)/2,l=Em(o-t,n-i),c=.8*SC,d=S=>ba+c*(S-a)/l,p=S=>ya-c*(S-s)/l,u=S=>`${S[0].toFixed(1)} ${S[1].toFixed(1)}`,h=d(e[0]),m=p(e[1]);if(!isFinite(h)||!isFinite(m))return"";let y=[];for(let S of r){let C=d(S[0]),v=p(S[1]);if(!isFinite(C)||!isFinite(v))return"";y.push(u([C,v]))}return`<path d = ${`"M ${u([h,m])} ${y.map(S=>`L ${S} `).join(" ")} Z"`} />`}function lF(r,e,t){let i=7*rs(r),n=7*vs(-r);return`<path d = "M ${bt(ba-e*i)} ${bt(ya-e*n)} L ${bt(ba+t*i)} ${bt(ya+t*n)}" />`}function fse(r){return lF(r,1,1)}function bse(r){return lF(r,2,2)}function yse(r){return lF(r,1,2)}function xse(r){let o=48*(zs/180),i=8.5-1,n=8.5-7*rs(o),a=ba-i*rs(r),s=ya+i*vs(r),l=ba+n*rs(r),c=ya-n*vs(r),d=`M ${bt(a)} ${bt(s)} L ${bt(l)} ${bt(c)}`,p=ba+8.5*rs(r),u=ya+8.5*vs(-r),h=p-7*rs(r+o/2),m=u+7*vs(r+o/2),y=p-7*rs(r-o/2),w=u+7*vs(r-o/2),S=`M ${bt(h)} ${bt(m)} L ${bt(p)} ${bt(u)} L ${bt(y)} ${bt(w)}`;return`<path d = "${d}"/><path d = "${S}" class="dcg-token-vector-arrowhead"/>`}function wse(r,e){let o=14*rs(r),i=14*-vs(r),n=4*rs(r+e*zs/2),a=4*-vs(r+e*zs/2);return`<path d = "M ${bt(ba-o)} ${bt(ya-i)} L ${bt(ba+o)} ${bt(ya+i)}" /><path d = "M ${bt(ba+n-o)} ${bt(ya+a-i)} L ${bt(ba+n+o)} ${bt(ya+a+i)}" class="dcg-token-parallel-parent"/>`}function vse(r){let t=14*rs(r),o=14*-vs(r);return`<path d = "M ${bt(ba-t)} ${bt(ya-o)} L ${bt(ba+t)} ${bt(ya+o)}" /><path d = "M ${bt(ba+o)} ${bt(ya-t)} L ${bt(ba-o)} ${bt(ya+t)}" class="dcg-token-parallel-parent"/>`}var{If:EC}=xa.Components,Cse=.8,_u=class extends xa.Class{init(){this.controller=this.props.controller()}template(){return xa.createElement("span",{class:()=>{var t,o;let e=this.parentOrChildHovered();return{"dcg-geo-token-view":!0,"dcg-static-token":(o=(t=this.props).isStatic)==null?void 0:o.call(t),"dcg-selected-token":this.isTokenSelected(),"dcg-hidden-token":this.isHidden(),"dcg-token-has-label":this.showLabel(),"dcg-child-of-hovered-token":e==="child","dcg-parent-of-hovered-token":e==="parent","dcg-assignment-token":!!this.getAssignment(),"dcg-graph-interactions-disabled":this.isGraphInteractionDisabled(),"dcg-light-color":this.isLightColor()}},style:()=>({color:this.getColor()}),role:this.bindFn(this.getAriaRole),"dcg-token-type":()=>this.getTokenInfo().iconType,"aria-roledescription":()=>this.props.insideGroup()?void 0:this.controller.s("graphing-calculator-narration-geometry-construction-role-description"),"aria-label":this.bindFn(this.getAriaLabel),"aria-selected":this.bindFn(this.isTokenSelected),tabIndex:()=>this.props.putInTabOrder()?0:-1,manageFocus:()=>this.props.focusLocation?ct({controller:this.controller,location:this.props.focusLocation()}):void 0,onTapStart:this.bindFn(this.onTapStart),onTap:this.bindFn(this.onTap),onPointerOver:this.bindFn(this.onPointerOver),onPointerOut:this.bindFn(this.onPointerOut)},xa.createElement("span",{class:xa.const("dcg-token-background")}),xa.createElement("span",{class:()=>({"dcg-token-icon":!0,[this.getAdditionalTokenClass()]:!!this.getAdditionalTokenClass(),"dcg-token-is-list":this.getIsList()&&!this.getAssignment()})},xa.createElement(EC,{predicate:()=>!!this.getIcon()},()=>xa.createElement("i",{class:this.bindFn(this.getIcon)})),xa.createElement(EC,{predicate:()=>Z9(this.getAdditionalTokenClass())},()=>xa.createElement("div",{willUnmount:()=>this.willUnmountSVG(),didMount:e=>this.didMountSVG(e)}))),xa.createElement(EC,{predicate:()=>!!this.getAssignment()},()=>xa.createElement(Et,{latex:this.bindFn(this.getAssignment),config:this.const({})})),xa.createElement(EC,{predicate:()=>this.showLabel()},()=>xa.createElement("span",{class:()=>({"dcg-token-label":!0})},()=>this.getLabel())),xa.createElement(EC,{predicate:this.bindFn(this.isGraphInteractionDisabled)},()=>xa.createElement("i",{class:xa.const("dcg-icon-lock")})))}isLightColor(){let e=this.getColor();return!e||this.isTransformation()||this.isHidden()?!1:Ox({type:"single-color",value:e},this.controller.invertSwatches(),Cse)}didMountSVG(e){this.svgElement=e,this.renderSVGElement()}willUnmountSVG(){this.svgElement=void 0,this.lastSVGInputs=void 0}getTypedValue(e){var i;if(e===void 0)return;let t=this.controller.getItemsByIdentifier(e);if(!t||t.length!==1)return;let o=t[0];return(i=o==null?void 0:o.formula)==null?void 0:i.typed_constant_value}getParentValues(e){var n,a,s;let t=this.controller.getItemsByIdentifier(e);if(!t||t.length!==1)return[];let o=t[0],i=(s=(a=(n=o==null?void 0:o.formula)==null?void 0:n.geometry)==null?void 0:a.call)==null?void 0:s.parents;return i===void 0?[]:i.map(l=>{if(l.type==="arbitrary-expression")return;let c=__dcg_shared_module_exports__['fd'](l);return this.getTypedValue(c)})}renderSVGElement(){if(!this.svgElement)return;let e=this.props.identifier(),t=this.getIconType(),o=this.getTypedValue(e),i=this.getParentValues(e),n=t$(t,o,i);n!==void 0&&(__dcg_shared_module_exports__['J'](n,this.lastSVGInputs)||(this.lastSVGInputs=n,this.svgElement.innerHTML=`<svg>${e$(n)}</svg>`))}getAdditionalTokenClass(){if(this.getAssignment()||this.hasError())return"";switch(this.getIconType()){case"glider":return"dcg-token-glider";case"line":return"dcg-token-line";case"segment":return"dcg-token-segment";case"ray":return"dcg-token-ray";case"intersection":return"dcg-token-intersection";case"midpoint":return"dcg-token-midpoint";case"parallel":return"dcg-token-parallel";case"perpendicular":return"dcg-token-perpendicular";case"anglebisector":return"dcg-token-ray";case"rotate":return"dcg-token-rotate";case"circle":return"dcg-token-circle";case"arc":return"dcg-token-arc";case"vector":return"dcg-token-vector";case"dilate":return"dcg-token-dilate";case"reflect":return"dcg-token-reflect";case"translate":return"dcg-token-translate";case"transformation":return"dcg-token-transformation";case"point":case"start":case"end":return"dcg-token-point";case"polygon":return"dcg-token-polygon";case"angle":return"dcg-token-angle";case"angles":return"dcg-token-angles";case"directedangle":case"directedangles":return"dcg-token-directedangle"}return""}getIdFromParentRef(e){if(e.type==="arbitrary-expression")return;let t=__dcg_shared_module_exports__['fd'](e);return this.controller.getExpressionIdForIdentifier(t)}isGraphInteractionDisabled(){let e=this.props.controller().getExpressionIdForIdentifier(this.props.identifier())||"",t=this.controller.getItemModel(e);return!!t&&(t.type==="expression"||t.type==="image")&&!!t.disableGraphInteractions}parentOrChildHovered(){var c,d,p,u,h,m;if(!this.props.showParentChildrenHover||!this.props.showParentChildrenHover())return!1;let e=this.controller.getHoveredOrFocusedTokenIdentifier(),t=this.controller.getExpressionIdForIdentifier(e),o=this.props.identifier(),i=this.props.controller().getExpressionIdForIdentifier(o)||"";if(!t)return!1;let n=this.controller.getItemModel(t),a=this.controller.getItemModel(i);if(!n||n.type!=="expression"||!a||a.type!=="expression")return!1;let s=((p=(d=(c=n.formula)==null?void 0:c.geometry)==null?void 0:d.call)==null?void 0:p.parents)||[],l=((m=(h=(u=a.formula)==null?void 0:u.geometry)==null?void 0:h.call)==null?void 0:m.parents)||[];for(let y=0;y<s.length;y++)if(this.getIdFromParentRef(s[y])===i)return"parent";for(let y=0;y<l.length;y++)if(this.getIdFromParentRef(l[y])===t)return"child";return!1}willUnmount(){this.implicitMouseOut()}didUpdate(){this.renderSVGElement();let e=this.props.identifier();this.currentlyActiveIdentifier&&e!==this.currentlyActiveIdentifier&&this.implicitMouseOut()}implicitMouseOut(){this.currentlyActiveIdentifier&&this.controller.runAfterDispatch(()=>{let e=this.currentlyActiveIdentifier;e&&(this.currentlyActiveIdentifier=void 0,this.controller.dispatch({type:"unset-active-token",identifier:e,style:"hovered"}))})}isHidden(){return this.getTokenInfo().isHidden}hasError(){let e=this.getTokenInfo();return!e||e.hasError}getIcon(){if(this.getAssignment())return;let e=this.getTokenInfo();if(this.hasError())return"dcg-icon-error";switch(e.iconType){case"point":case"glider":case"intersection":case"strictintersection":case"midpoint":case"start":case"end":return"dcg-icon-point";case"dilate":return"dcg-icon-dilation";case"rotate":return"dcg-icon-rotation";case"reflect":return"dcg-icon-reflection";case"transformation":return"dcg-icon-title";case"angle":case"angles":case"directedangle":case"directedangles":case"polygon":case"vector":case"translate":case"apply":case"arc":case"circle":case"clockwise":case"counterclockwise":case"error":case"line":case"parallel":case"perpendicular":case"anglebisector":case"ray":case"reflex":case"segment":case"segments":case"unknown":case"vertices":return;default:return e.iconType}}showLabel(){return!!this.getLabel()}getLabel(){if(this.getAssignment())return"";if(this.getIconType()!=="point"&&this.getIconType()!=="midpoint")return!1;let e=this.getTokenInfo().label.trim();return e.length<=2?e:""}getAssignment(){let e=this.props.identifier();return e[0]!=="$"?__dcg_shared_module_exports__['$b'](e):""}getAriaLabel(){let e=this.getTokenInfo(),t=Bi(this.controller.getItemModel(e==null?void 0:e.calcId),this.controller,{includeDetails:!1,depth:1});return this.isHidden()?this.controller.s("graphing-calculator-narration-geometry-hidden-construction-description",{description:t}):t}isTransformation(){var e;return((e=this.getTokenInfo())==null?void 0:e.groupType)==="transformation"}getColor(){if(this.getAssignment())return;let e=this.getTokenInfo();if(this.hasError())return"#fa824c";if(!(this.getIconType()==="translate"&&!this.isHidden()))return this.isTransformation()||this.isHidden()?"#aaa":e.color}getIconType(){return this.getTokenInfo().iconType}getIsList(){return this.getTokenInfo().isList}getTokenInfo(){let e=this.props.identifier();return this.controller.getTokenRenderInfoByIdentifier(e)}onPointerOver(e){var t,o;(o=(t=this.props).isStatic)!=null&&o.call(t)||e.pointerType==="mouse"&&(this.currentlyActiveIdentifier=this.props.identifier(),this.controller.dispatch({type:"set-active-token",identifier:this.currentlyActiveIdentifier,style:"hovered"}))}onPointerOut(e){var t,o;(o=(t=this.props).isStatic)!=null&&o.call(t)||e.pointerType==="mouse"&&this.currentlyActiveIdentifier&&(this.controller.dispatch({type:"unset-active-token",identifier:this.currentlyActiveIdentifier,style:"hovered"}),this.currentlyActiveIdentifier=void 0)}onTapStart(e){var t,o;(o=(t=this.props).isStatic)!=null&&o.call(t)||e.handle()}onTap(e){var t,o;(o=(t=this.props).isStatic)!=null&&o.call(t)||(e.handle(),this.props.focusLocation&&this.controller.dispatch({type:"set-focus-location",location:this.props.focusLocation()}),this.controller.dispatch({type:"select-expression-that-defines-token",identifier:this.props.identifier(),toggle:this.isTokenSelected(),multiSelectMode:this.controller.isMultiSelectEnabled()&&!!e.shiftKey}))}isTokenSelected(){let e=this.getTokenInfo();return!!(e&&e.isSelected)}getAriaRole(){var e,t;if(!((t=(e=this.props).isStatic)!=null&&t.call(e)))return this.props.insideGroup()?"option":"button"}};var qw=r=>{let e=function(){return r};return e.isDcgViewConst=!0,e},Aw=class{constructor(e,t,o){this.tokenController=e,this.mathNode=t,this.isStatic=o}updateTokens(e){if(!this.mathNode)return;if(!this.lastTokenInfo||this.lastTokenInfo.latex!==e)if(!this.tokenController.doesLatexContainToken(e))this.lastTokenInfo={latex:e,tokens:[]};else{let o=[];this.mathNode.querySelectorAll(".dcg-mq-token").forEach(i=>{o.push(i)}),this.lastTokenInfo={latex:e,tokens:o}}let t=this.lastTokenInfo.tokens;for(let o of t){let i=o.dcgTokenView;if(i)i.update();else{let n=o.getAttribute("data-dcg-mq-token")||"",a=i$.mountToNode(_u,o,{controller:qw(this.tokenController),identifier:qw("$"+n),insideMQ:qw(!0),insideGroup:qw(!1),putInTabOrder:qw(!1),isStatic:qw(this.isStatic)});o.dcgTokenView=a}}}};var{If:Sse}=Zc.Components,zw=500,Ese=30,Ze=class r extends Zc.Class{constructor(){super(...arguments),this.lastLatexProp=""}template(){return Zc.createElement("div",{class:Zc.const("dcg-mq-container")},Zc.createElement(Sse,{predicate:()=>this.getPlaceholder().trim().length>0},()=>Zc.createElement("span",{class:Zc.const("dcg-mq-placeholder")},Zc.createElement(Et,{config:()=>this.props.config(),latex:()=>this.getPlaceholder()}))),Zc.createElement("div",{class:()=>({"dcg-math-field":!0,"dcg-no-fadeout":this.props.noFadeout&&this.props.noFadeout(),"dcg-invalid":this.props.hasError(),"dcg-focus":this.props.isFocused()}),didMount:e=>this.didMountMathquill(e),"data-dcg-label":()=>this.props.dataLabelAttributeValue?this.props.dataLabelAttributeValue():void 0}))}willUnmount(){var e;(e=this.mathquillFocus)==null||e.willUnmount(),this.mathField=void 0}getPlaceholder(){return!this.props.placeholder||this.props.isFocused()||this.props.latex()?"":this.props.placeholder()}didMountMathquill(e){this.cachedConfig=this.getCacheableMQConfig();let t={...this.cachedConfig,restrictMismatchedBrackets:"none",handlers:{reflow:i=>{this.props.onReflow&&this.mathField&&this.props.onReflow(i)}},onCut:()=>{this.mathField&&this.props.onUserChangedLatex(this.mathField.latex())},onPaste:()=>{this.mathField&&this.props.onUserChangedLatex(this.mathField.latex())},overrideTypedText:i=>{this.mathField&&this.viewCanAcceptText(i)&&(this.props.onUserTypedText?this.props.onUserTypedText(i):(this.mathField.typedText(i),this.props.onUserChangedLatex(this.mathField.latex())))},overrideKeystroke:(i,n)=>{if(i==="Backspace"&&n.preventDefault(),!this.mathField)return;if(i==="Spacebar"&&this.props.disableSpace&&this.props.disableSpace())return n.preventDefault();let a=Be(n);if(a==="Up"||a==="Down"||a==="Left"||a==="Right"||a==="Esc"){let s=[];n.ctrlKey&&s.push("Ctrl"),n.metaKey&&s.push("Meta"),n.altKey&&s.push("Alt"),n.shiftKey&&s.push("Shift"),s.length?(s.push(a),i=s.join("-")):i=a}this.props.onUserPressedKey?this.props.onUserPressedKey(i,n):(this.mathField.keystroke(i,n),this.props.onUserChangedLatex(this.mathField.latex())),this.maybeTriggerOnSelectionChange()}};this.props.needsSystemKeypad&&this.props.needsSystemKeypad()&&(t.substituteTextarea=()=>{let i=document.createElement("textarea");return i.setAttribute("autocorrect","off"),i.setAttribute("autocapitalize","none"),i.setAttribute("spellcheck","false"),i.setAttribute("autocomplete","off"),i}),this.props.tokenController&&(this.mathquillTokenHelper=new Aw(this.props.tokenController(),e,!1)),this.$mathField=re(e);let o=Hc.MathField(e,t);this.mathField=o,e._mqMathFieldInstance=this.mathField,e._mqViewInstance=this,this.mathquillFocus=new Dx(o,this.$mathField,this.props),this.$mathField.on("paste.view",i=>this.onPasteEvent(i)),!u_&&(mc||Sh)&&this.$mathField.on("keypress.view",i=>this.onKeypressEvent(i)),this.hookupMQTapTouch(o),this.updateMathquill()}getCacheableMQConfig(){let e={...this.props.config()};return this.props.capExpressionSize()&&(e.maxDepth=Ese),e}didUpdate(){this.updateMathquill()}updateMathquill(){var e,t;this.updateMathquillConfig(),this.updateMathquillAria(),this.updateMathquillLatex(),(e=this.mathquillFocus)==null||e.updateMathquillFocused(),this.updateMathquillPostLabel(),(t=this.mathquillTokenHelper)==null||t.updateTokens(this.props.latex())}onPasteEvent(e){let t="",o=window.clipboardData,i=e.originalEvent;o&&o.getData?t=o.getData("Text"):i&&i.clipboardData&&i.clipboardData.getData&&(t=i.clipboardData.getData("text/plain"));let n=this.viewCanAcceptText(t);return!n&&this.props.onExpressionSizeExceeded&&this.props.onExpressionSizeExceeded(),n}viewCanAcceptText(e){return r.canAcceptText(this.mathField,this.props.capExpressionSize(),e)}static canAcceptText(e,t,o){if(!e)return!1;if(!t)return!0;let i=e.latex();return Ex(i)+Ex(o)<=zw}onKeypressEvent(e){if(e.stopPropagation(),e.preventDefault(),!this.mathField)return;let t=e.key&&e.key.length===1?e.key:void 0;t&&this.viewCanAcceptText(t)&&(this.props.onUserTypedText?this.props.onUserTypedText(t):(this.mathField.typedText(t),this.props.onUserChangedLatex(this.mathField.latex())))}hookupMQTapTouch(e){this.$mathField.on("dcg-tapstart.view",()=>{let t="dcg-tapend.mathquill-selection-change";re(document).on(t,()=>{this.maybeTriggerOnSelectionChange(),re(document).off(t)})}),e.ignoreNextMousedown(()=>sH.shouldIgnoreMouseDown()),this.$mathField.on("dcg-tap.view",t=>{var n;let o=t;if(o.device!=="touch"||o.target.closest(".dcg-mq-ignore-mousedown"))return;let i=o.changedTouches[0];e.clickAt(i.clientX,i.clientY,i.target),(n=this.mathquillFocus)!=null&&n.isFocused()||e.focus()})}updateMathquillConfig(e={}){if(!this.mathField)return;let t={...this.getCacheableMQConfig(),...e};__dcg_shared_module_exports__['J'](t,this.cachedConfig)||(this.cachedConfig=t,this.mathField.config(t))}updateMathquillAria(){if(!this.mathField)return;let e=this.props.getAriaLabel();e!==this.mathField.getAriaLabel()&&this.mathField.setAriaLabel(e)}updateMathquillPostLabel(){this.mathField&&this.mathField.setAriaPostLabel(this.props.getAriaPostLabel(),this.props.hasError()?5e3:1e3)}updateMathquillLatex(){let e=this.props.latex();this.mathField&&this.lastLatexProp!==e&&(this.props.capExpressionSize()&&Ex(e)>zw||(this.lastLatexProp=e,this.mathField.latex()!==e&&this.mathField.latex(e)))}maybeTriggerOnSelectionChange(){let e=this.props.onSelectionChanged;if(!e||!this.mathField)return;let t=this.mathField.selection();__dcg_shared_module_exports__['J'](t,this.lastSelection)||(this.lastSelection=t,e(t))}static getFocusedMathquill(){if(!document.activeElement)return;let e=document.activeElement.closest(".dcg-mq-editable-field");if(e)return e._mqMathFieldInstance}static getMQViewInstance(e){let t=e.el();if(t)return t._mqViewInstance}static applyArrowKeyAndReturnIfWasAtBounds(e,t,o){let i=e.selection(),n=i.startIndex===0&&i.endIndex===i.latex.length;if((t==="Up"||t==="Down")&&n)return e.keystroke(t,o),!0;e.keystroke(t,o);let a=e.selection();return!(a.latex!==i.latex||a.startIndex!==i.startIndex||a.endIndex!==i.endIndex)}static temporarilyOverrideLeftRightIntoCommandGoes(e,t){var n;let o=r.getMQViewInstance(e);if(!o)return()=>{};let i=(n=o.getCacheableMQConfig().leftRightIntoCmdGoes)!=null?n:"up";return o.updateMathquillConfig({leftRightIntoCmdGoes:t}),()=>o.updateMathquillConfig({leftRightIntoCmdGoes:i})}static simulateKeypressFromKeypad(e,t){var n;let o=r.getMQViewInstance(e);if(!o)return;let i=(n=o.getCacheableMQConfig().leftRightIntoCmdGoes)!=null?n:"up";if((t==="Left"||t==="Right")&&o.updateMathquillConfig({leftRightIntoCmdGoes:void 0}),o.props.onUserPressedKey)o.props.onUserPressedKey(t);else{e.keystroke(t);let a=e.latex();o.props.onUserChangedLatex(a)}o.maybeTriggerOnSelectionChange(),(t==="Left"||t==="Right")&&o.updateMathquillConfig({leftRightIntoCmdGoes:i})}static simulateUserChangedLatex(e){let t=r.getMQViewInstance(e);if(t&&t.mathField){let o=t.mathField.latex();t.props.onUserChangedLatex(o)}}static handleKeystrokeAndDecideIfSpecialEvent(e,t,o){return t==="Enter"||t==="Delete"&&e.latex()===""||t==="Backspace"&&e.latex()===""?!0:t==="Up"||t==="Down"||t==="Left"||t==="Right"?r.applyArrowKeyAndReturnIfWasAtBounds(e,t,o):(e.keystroke(t,o),!1)}static normalizeLatex(e,t){let o=document.createElement("div"),i=Hc.MathField(o,t);return i.latex(e),i.latex()}};var GG=class{constructor(e){this.mq=e,this.id=e.id,this.data=e.data}simulateUserChangedLatex(){Ze.simulateUserChangedLatex(this.mq)}simulateKeypress(e){Ze.simulateKeypressFromKeypad(this.mq,e)}config(e){return this.mq.config(e),this}latex(e){return e===void 0?this.mq.latex():(this.mq.latex(e),this.simulateUserChangedLatex(),this)}reflow(){this.mq.reflow()}el(){return this.mq.el()}getAriaLabel(){return this.mq.getAriaLabel()}setAriaLabel(e){return this.mq.setAriaLabel(e)}html(){return this.mq.html()}mathspeak(){return this.mq.mathspeak()}text(){return this.mq.text()}selection(){return this.mq.selection()}select(){return this.mq.select(),this}moveToRightEnd(){return this.mq.moveToRightEnd(),this}moveToLeftEnd(){return this.mq.moveToLeftEnd(),this}cmd(e){return this.mq.cmd(e),this.simulateUserChangedLatex(),this}write(e){return this.mq.write(e),this.simulateUserChangedLatex(),this}keystroke(e){return this.simulateKeypress(e),this}typedText(e){return this.mq.typedText(e),this.simulateUserChangedLatex(),this}clearSelection(){return this.mq.clearSelection(),this}getAriaPostLabel(){return this.mq.getAriaPostLabel()}setAriaPostLabel(e,t){return this.mq.setAriaPostLabel(e,t),this}blur(){return this.mq.blur(),this}focus(){return this.mq.focus(),this}revert(){return this.mq.revert()}ignoreNextMousedown(e){return this.mq.ignoreNextMousedown(e),this}clickAt(e,t,o){return this.mq.clickAt(e,t,o),this}};function n$(r){let e=r.mode,t=r.width,o=r.height,i=r.currentBounds,n=r.graphpaperAspectRatio,a=r.mathAspectRatio,s=r.mathBounds,l=t/o,c={x:i.left+i.width/2,y:i.bottom+i.height/2};if(s.left===void 0!=(s.right===void 0)||s.bottom===void 0!=(s.top===void 0))return __dcg_shared_module_exports__['g'].warn('asyncScreenshot: cannot specify "left" bound without "right" or "bottom" bound without "top". Got: '+s),i;let d=s.left!==void 0&&s.right!==void 0,p=s.bottom!==void 0&&s.top!==void 0,u=d&&p,h,m,y,w,S,C,v,E,_,T;switch(e){case"stretch":return u?s:d?{left:s.left,right:s.right,bottom:i.bottom,top:i.top}:p?{left:i.left,right:i.right,bottom:s.bottom,top:s.top}:i;case"contain":return u?(w=s.right-s.left,S=s.top-s.bottom,C={x:s.left+w/2,y:s.bottom+S/2},y=w/S,l>y?(m=S/o,h=m*a,{left:C.x-h*t/2,right:C.x+h*t/2,bottom:s.bottom,top:s.top}):(h=w/t,m=h/a,{left:s.left,right:s.right,bottom:C.y-m*o/2,top:C.y+m*o/2})):d?(v=s.right-s.left,E=s.left+v/2,y=v/i.height,l>y?(m=i.height/o,h=m*a,{left:E-h*t/2,right:E+h*t/2,bottom:i.bottom,top:i.top}):(h=v/t,m=h/a,{left:s.left,right:s.right,bottom:c.y-m*o/2,top:c.y+m*o/2})):p?(_=s.top-s.bottom,T=s.bottom+_/2,y=i.width/_,l>y?(m=_/o,h=m*a,{left:c.x-h*t/2,right:c.x+h*t/2,bottom:s.bottom,top:s.top}):(h=i.width/t,m=h/a,{left:i.left,right:i.right,bottom:T-m*o/2,top:T+m*o/2})):l>n?(m=i.height/o,h=m*a,{left:c.x-h*t/2,right:c.x+h*t/2,bottom:i.bottom,top:i.top}):(h=i.width/t,m=h/a,{left:i.left,right:i.right,bottom:c.y-m*o/2,top:c.y+m*o/2});case"preserveX":return u?(w=s.right-s.left,S=s.top-s.bottom,C={x:s.left+w/2,y:s.bottom+S/2},y=w/S,h=w/t,m=h/a,{left:s.left,right:s.right,bottom:C.y-m*o/2,top:C.y+m*o/2}):p?(_=s.top-s.bottom,T=s.bottom+_/2,y=i.width/_,h=i.width/t,m=h/a,{left:i.left,right:i.right,bottom:T-m*o/2,top:T+m*o/2}):d?(v=s.right-s.left,h=v/t,m=h/a,{left:s.left,right:s.right,bottom:c.y-m*o/2,top:c.y+m*o/2}):(v=i.right-i.left,h=v/t,m=h/a,{left:i.left,right:i.right,bottom:c.y-m*o/2,top:c.y+m*o/2});case"preserveY":return u?(w=s.right-s.left,S=s.top-s.bottom,C={x:s.left+w/2,y:s.bottom+S/2},y=w/S,m=S/o,h=m*a,{left:C.x-h*t/2,right:C.x+h*t/2,bottom:s.bottom,top:s.top}):d?(v=s.right-s.left,E=s.left+v/2,y=v/i.height,m=i.height/o,h=m*a,{left:E-h*t/2,right:E+h*t/2,bottom:i.bottom,top:i.top}):p?(_=s.top-s.bottom,m=_/o,h=m*a,{left:c.x-h*t/2,right:c.x+h*t/2,bottom:s.bottom,top:s.top}):(_=i.top-i.bottom,m=_/o,h=m*a,{left:c.x-h*t/2,right:c.x+h*t/2,bottom:i.bottom,top:i.top});default:return i}}function kC(r,e){for(let t in e)if(e.hasOwnProperty(t)&&e[t]===r)return!0;return!1}function cF(r){return kC(r,pF)}function dF(r){return kC(r,uF)}function s$(r){return kC(r,hF)}function Dse(r){return kC(r,DC)}function kse(r){return kC(r,gF)}var pF={OPEN:"OPEN",CROSS:"CROSS",POINT:"POINT"},uF={SOLID:"SOLID",DASHED:"DASHED",DOTTED:"DOTTED"},hF={NONE:"NONE",AUTO:"AUTO",X:"X",Y:"Y",XY:"XY"},DC={POINTS:"POINTS",LINES:"LINES",POINTS_AND_LINES:"POINTS_AND_LINES"},gF={DEFAULT:"default",CENTER:"center",CENTER_AUTO:"center_auto",AUTO_CENTER:"auto_center",ABOVE:"above",ABOVE_LEFT:"above_left",ABOVE_RIGHT:"above_right",ABOVE_AUTO:"above_auto",BELOW:"below",BELOW_LEFT:"below_left",BELOW_RIGHT:"below_right",BELOW_AUTO:"below_auto",LEFT:"left",AUTO_LEFT:"auto_left",RIGHT:"right",AUTO_RIGHT:"auto_right"};function _se(r){return{id:r.id,type:r.type,columns:r.columns.map(Tse)}}function Tse(r){return{id:r.id,latex:r.latex,color:r.color,hidden:r.hidden,pointStyle:r.pointStyle,pointSize:r.pointSize,pointOpacity:r.pointOpacity,lineStyle:r.lineStyle,lineWidth:r.lineWidth,lineOpacity:r.lineOpacity,points:r.points,lines:r.lines,dragMode:r.dragMode,values:r.values.slice()}}function Gse(r){let e=["latex","color","lineStyle","lineWidth","lineOpacity","pointStyle","pointSize","movablePointSize","pointOpacity","points","lines","fill","fillOpacity","hidden","secret","dragMode","label","showLabel","labelSize","labelOrientation","interactiveLabel","readonly"],t={id:r.id,type:r.type};return e.forEach(o=>{r.hasOwnProperty(o)&&(t[o]=r[o])}),r.hasOwnProperty("parametricDomain")&&(t.parametricDomain={min:r.parametricDomain.min,max:r.parametricDomain.max}),r.hasOwnProperty("parametricDomain3Du")&&(t.parametricDomain3Du={min:r.parametricDomain3Du.min,max:r.parametricDomain3Du.max}),r.hasOwnProperty("parametricDomain3Dv")&&(t.parametricDomain3Dv={min:r.parametricDomain3Dv.min,max:r.parametricDomain3Dv.max}),r.hasOwnProperty("parametricDomain3Dr")&&(t.parametricDomain3Dr={min:r.parametricDomain3Dr.min,max:r.parametricDomain3Dr.max}),r.hasOwnProperty("parametricDomain3Dphi")&&(t.parametricDomain3Dphi={min:r.parametricDomain3Dphi.min,max:r.parametricDomain3Dphi.max}),r.hasOwnProperty("polarDomain")&&(t.polarDomain={min:r.polarDomain.min,max:r.polarDomain.max}),r.hasOwnProperty("domain")&&(t.domain={min:r.domain.min,max:r.domain.max}),r.slider&&(r.slider.hardMin&&(t.sliderBounds=t.sliderBounds||{},t.sliderBounds.min=r.slider.min),r.slider.hardMax&&(t.sliderBounds=t.sliderBounds||{},t.sliderBounds.max=r.slider.max),r.slider.step&&(t.sliderBounds=t.sliderBounds||{},t.sliderBounds.step=r.slider.step),t.playing=!!r.slider.isPlaying),t}function Ise(r){return{id:r.id,type:r.type,hidden:r.hidden,secret:r.secret}}function Mse(r){return{id:r.id,type:r.type,hidden:r.hidden,secret:r.secret}}function Ase(r){return{id:r.id,type:r.type,secret:r.secret,text:r.text}}function IG(r){switch(r.type){case"expression":return Gse(r);case"table":return _se(r);case"folder":return Mse(r);case"image":return Ise(r);case"text":return Ase(r);default:return r}}function Cb(r,e){return r.hasOwnProperty("id")?r.id+"":e.generateId()}function Vse(r,e){let t={type:"expression",id:Cb(r,e)};if(t.type="expression",t.id=Cb(r,e),r.hasOwnProperty("latex")&&(t.latex=r.latex+""),r.hasOwnProperty("color")&&(t.color=r.color+""),r.hasOwnProperty("points")&&(t.points=!!r.points),r.hasOwnProperty("lines")&&(t.lines=!!r.lines),r.hasOwnProperty("style")&&(__dcg_shared_module_exports__['g'].warn("As of API v1.1 the 'style' property is deprecated and has been split into 'pointStyle' and 'lineStyle'."),cF(r.style)?t.pointStyle=r.style:dF(r.style)?t.lineStyle=r.style:__dcg_shared_module_exports__['g'].warn("Invalid style: '"+r.style+"'.")),r.hasOwnProperty("pointStyle")&&(cF(r.pointStyle)?t.pointStyle=r.pointStyle:__dcg_shared_module_exports__['g'].warn("Invalid pointStyle: '"+r.pointStyle+"'.")),r.hasOwnProperty("pointSize")&&(t.pointSize=""+r.pointSize),r.hasOwnProperty("movablePointSize")&&(t.movablePointSize=""+r.movablePointSize),r.hasOwnProperty("pointOpacity")&&(t.pointOpacity=""+r.pointOpacity),r.hasOwnProperty("lineStyle")&&(dF(r.lineStyle)?t.lineStyle=r.lineStyle:__dcg_shared_module_exports__['g'].warn("Invalid lineStyle: '"+r.lineStyle+"'.")),r.hasOwnProperty("lineWidth")&&(t.lineWidth=""+r.lineWidth),r.hasOwnProperty("lineOpacity")&&(t.lineOpacity=""+r.lineOpacity),r.hasOwnProperty("hidden")&&(t.hidden=!!r.hidden),r.hasOwnProperty("readonly")&&(t.readonly=!!r.readonly),r.hasOwnProperty("secret")&&(t.secret=!!r.secret),r.hasOwnProperty("sliderBounds")&&r.sliderBounds&&(t.slider={min:__dcg_shared_module_exports__['je'](r.sliderBounds.min),max:__dcg_shared_module_exports__['je'](r.sliderBounds.max),step:__dcg_shared_module_exports__['je'](r.sliderBounds.step)},t.slider.min&&(t.slider.hardMin=!0),t.slider.max&&(t.slider.hardMax=!0)),r.hasOwnProperty("playing")){let{playing:o}=r;typeof o!="boolean"?__dcg_shared_module_exports__['g'].warn(`Invalid value for 'playing'. Expected a boolean but got '${o}'.`):(t.slider||(t.slider={}),t.slider.isPlaying=o)}return r.hasOwnProperty("parametricDomain3Du")&&r.parametricDomain3Du&&(t.parametricDomain3Du={min:__dcg_shared_module_exports__['je'](r.parametricDomain3Du.min),max:__dcg_shared_module_exports__['je'](r.parametricDomain3Du.max)}),r.hasOwnProperty("parametricDomain3Dv")&&r.parametricDomain3Dv&&(t.parametricDomain3Dv={min:__dcg_shared_module_exports__['je'](r.parametricDomain3Dv.min),max:__dcg_shared_module_exports__['je'](r.parametricDomain3Dv.max)}),r.hasOwnProperty("parametricDomain3Dr")&&r.parametricDomain3Dr&&(t.parametricDomain3Dr={min:__dcg_shared_module_exports__['je'](r.parametricDomain3Dr.min),max:__dcg_shared_module_exports__['je'](r.parametricDomain3Dr.max)}),r.hasOwnProperty("parametricDomain3Dphi")&&r.parametricDomain3Dphi&&(t.parametricDomain3Dphi={min:__dcg_shared_module_exports__['je'](r.parametricDomain3Dphi.min),max:__dcg_shared_module_exports__['je'](r.parametricDomain3Dphi.max)}),r.hasOwnProperty("parametricDomain")&&r.parametricDomain?(t.parametricDomain={min:__dcg_shared_module_exports__['je'](r.parametricDomain.min),max:__dcg_shared_module_exports__['je'](r.parametricDomain.max)},r.hasOwnProperty("domain")&&__dcg_shared_module_exports__['g'].warn("Both 'parametricDomain' and the deprecated 'domain' property were specified. Using 'parametricDomain'.")):r.hasOwnProperty("domain")&&(__dcg_shared_module_exports__['g'].warn("The 'domain' property is deprecated.Use 'parametricDomain' to specify the domain for parametric functions"),t.parametricDomain={min:__dcg_shared_module_exports__['je'](r.domain.min),max:__dcg_shared_module_exports__['je'](r.domain.max)}),r.hasOwnProperty("polarDomain")&&r.polarDomain&&(t.polarDomain={min:__dcg_shared_module_exports__['je'](r.polarDomain.min),max:__dcg_shared_module_exports__['je'](r.polarDomain.max)}),r.hasOwnProperty("dragMode")&&(s$(r.dragMode)?t.dragMode=r.dragMode:__dcg_shared_module_exports__['g'].warn("Invalid dragMode: '"+r.dragMode+"'.")),r.hasOwnProperty("label")&&(t.label=r.label+""),r.hasOwnProperty("showLabel")&&(t.showLabel=!!r.showLabel),r.hasOwnProperty("showAngleLabel")&&(t.showAngleLabel=!!r.showAngleLabel),r.hasOwnProperty("labelSize")&&(typeof r.labelSize=="string"?t.labelSize=r.labelSize:__dcg_shared_module_exports__['g'].warn("Invalid labelSize: "+r.labelSize)),r.hasOwnProperty("labelOrientation")&&(kse(r.labelOrientation)?t.labelOrientation=r.labelOrientation:__dcg_shared_module_exports__['g'].warn("Invalid labelOrientation: "+r.labelOrientation)),r.hasOwnProperty("fill")&&(t.fill=!!r.fill),r.hasOwnProperty("fillOpacity")&&(t.fillOpacity=""+r.fillOpacity),t}function Lse(r,e){let t={id:Cb(r,e)};return r.hasOwnProperty("latex")&&(t.latex=r.latex+""),r.hasOwnProperty("color")&&(t.color=r.color+""),r.hasOwnProperty("hidden")&&(t.hidden=!!r.hidden),r.hasOwnProperty("points")&&(t.points=!!r.points),r.hasOwnProperty("lines")&&(t.lines=!!r.lines),r.hasOwnProperty("values")&&r.values&&(t.values=r.values.map(o=>o+"")),r.hasOwnProperty("pointStyle")&&(cF(r.pointStyle)?t.pointStyle=r.pointStyle:__dcg_shared_module_exports__['g'].warn("Invalid pointStyle: '"+r.pointStyle+"'.")),r.hasOwnProperty("pointSize")&&(t.pointSize=""+r.pointSize),r.hasOwnProperty("pointOpacity")&&(t.pointOpacity=""+r.pointOpacity),r.hasOwnProperty("lineStyle")&&(dF(r.lineStyle)?t.lineStyle=r.lineStyle:__dcg_shared_module_exports__['g'].warn("Invalid lineStyle: '"+r.lineStyle+"'.")),r.hasOwnProperty("lineWidth")&&(t.lineWidth=""+r.lineWidth),r.hasOwnProperty("lineOpacity")&&(t.lineOpacity=""+r.lineOpacity),r.hasOwnProperty("columnMode")&&(__dcg_shared_module_exports__['g'].warn("As of API v1.1 the 'columnMode' property is deprecated and has been split into individual 'points' and 'lines' properties."),r.columnMode===DC.POINTS_AND_LINES?(t.points=!0,t.lines=!0):r.columnMode===DC.LINES?(t.points=!1,t.lines=!0):(t.points=!0,t.lines=!1),t.lines&&!t.points&&r.hasOwnProperty("dragMode")&&r.dragMode!=="NONE"&&(__dcg_shared_module_exports__['g'].warn("A 'lines' value of true and 'points' value of false is only compatible with a dragMode of 'NONE'. Proceeding by setting 'points' to true."),t.points=!0),Dse(r.columnMode)&&__dcg_shared_module_exports__['g'].warn("Invalid columnMode: '"+r.columnMode+"'.")),r.hasOwnProperty("dragMode")&&(s$(r.dragMode)?t.dragMode=r.dragMode==="AUTO"?"NONE":r.dragMode:__dcg_shared_module_exports__['g'].warn("Invalid dragMode: '"+r.dragMode+"'.")),t}function Pse(r,e){let t={type:"table",id:Cb(r,e)};return r.hasOwnProperty("columns")&&r.columns&&(t.columns=r.columns.map(o=>Lse(o,e))),t}function Ose(r,e){let t={type:"folder",id:Cb(r,e)};return r.hasOwnProperty("hidden")&&(t.hidden=!!r.hidden),t}function a$(r,e){let t={type:"text",id:Cb(r,e)};return r.hasOwnProperty("text")&&(t.text=r.text),r.hasOwnProperty("secret")&&(t.secret=!!r.secret),r.hasOwnProperty("readonly")&&(t.readonly=!!r.readonly),t}function Rse(r,e){let t={type:"image",id:Cb(r,e)};return r.hasOwnProperty("hidden")&&(t.hidden=!!r.hidden),t}function MG(r,e,t){let o=r.type;if(e&&o&&o!==e){__dcg_shared_module_exports__['g'].warn("Cannot change type of expression from '"+e+"' to '"+o+"'.");return}if(e==="text"&&o===void 0)return a$(r,t);switch(o){case void 0:case"expression":return Vse(r,t);case"image":return Rse(r,t);case"table":return Pse(r,t);case"folder":return Ose(r,t);case"text":return a$(r,t);default:if(e){__dcg_shared_module_exports__['g'].warn("Cannot modify expressions of type: '"+e+"' through the API.");return}else{__dcg_shared_module_exports__['g'].warn("Invalid expression type: '"+o+"'.");return}}}function Tu(r){return r==="es-ES"?(__dcg_shared_module_exports__['g'].warn("{language: 'es-ES'} has been deprecated. Proceeding with {language: 'es'}"),"es"):r}var Ot=function(r,e,t){var o=document.createElement("img"),i,n;if(o.onerror=e,o.onload=function(){n&&!(t&&t.noRevoke)&&Ot.revokeObjectURL(n),e&&e(Ot.scale(o,t))},Ot.isInstanceOf("Blob",r)||Ot.isInstanceOf("File",r))i=n=Ot.createObjectURL(r),o._type=r.type;else if(typeof r=="string")i=r,t&&t.crossOrigin&&(o.crossOrigin=t.crossOrigin);else return!1;return i?(o.src=i,o):Ot.readFile(r,function(a){var s=a.target;s&&s.result?o.src=s.result:e&&e(a)})},AG=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;Ot.isInstanceOf=function(r,e){return Object.prototype.toString.call(e)==="[object "+r+"]"};Ot.transformCoordinates=function(){};Ot.getTransformedOptions=function(r){return r};Ot.renderImageToCanvas=function(r,e,t,o,i,n,a,s,l,c){return r.getContext("2d").drawImage(e,t,o,i,n,a,s,l,c),r};Ot.hasCanvasOption=function(r){return r.canvas||r.crop};Ot.scale=function(r,e){e=e||{};var t=document.createElement("canvas"),o=r.getContext||Ot.hasCanvasOption(e)&&t.getContext,i=r.naturalWidth||r.width,n=r.naturalHeight||r.height,a=i,s=n,l,c,d,p,u,h,m,y,w,S=function(){var v=Math.max((d||a)/a,(p||s)/s);v>1&&(a=Math.ceil(a*v),s=Math.ceil(s*v))},C=function(){var v=Math.min((l||a)/a,(c||s)/s);v<1&&(a=Math.ceil(a*v),s=Math.ceil(s*v))};return o&&(e=Ot.getTransformedOptions(e),m=e.left||0,y=e.top||0,e.sourceWidth?(u=e.sourceWidth,e.right!==void 0&&e.left===void 0&&(m=i-u-e.right)):u=i-m-(e.right||0),e.sourceHeight?(h=e.sourceHeight,e.bottom!==void 0&&e.top===void 0&&(y=n-h-e.bottom)):h=n-y-(e.bottom||0),a=u,s=h),l=e.maxWidth,c=e.maxHeight,d=e.minWidth,p=e.minHeight,o&&l&&c&&e.crop?(a=l,s=c,w=u/h-l/c,w<0?(h=c*u/l,e.top===void 0&&e.bottom===void 0&&(y=(n-h)/2)):w>0&&(u=l*h/c,e.left===void 0&&e.right===void 0&&(m=(i-u)/2))):((e.contain||e.cover)&&(d=l=l||d,p=c=c||p),e.cover?(C(),S()):(S(),C())),o?(t.width=a,t.height=s,Ot.transformCoordinates(t,e),Ot.renderImageToCanvas(t,r,m,y,u,h,0,0,a,s)):(r.width=a,r.height=s,r)};Ot.createObjectURL=function(r){return AG?AG.createObjectURL(r):!1};Ot.revokeObjectURL=function(r){return AG?AG.revokeObjectURL(r):!1};Ot.readFile=function(r,e,t){if(window.FileReader){var o=new FileReader;if(o.onload=o.onerror=e,t=t||"readAsDataURL",o[t])return o[t](r),o}return!1};(!window.navigator||!window.navigator.platform||!/iP(hone|od|ad)/.test(window.navigator.platform))&&(l$=Ot.renderImageToCanvas,Ot.detectSubsampling=function(r){var e,t;return r.width*r.height>1024*1024?(e=document.createElement("canvas"),e.width=e.height=1,t=e.getContext("2d"),t.drawImage(r,-r.width+1,0),t.getImageData(0,0,1,1).data[3]===0):!1},Ot.detectVerticalSquash=function(r,e){var t=r.naturalHeight||r.height,o=document.createElement("canvas"),i=o.getContext("2d"),n,a,s,l,c;for(e&&(t/=2),o.width=1,o.height=t,i.drawImage(r,0,0),n=i.getImageData(0,0,1,t).data,a=0,s=t,l=t;l>a;)c=n[(l-1)*4+3],c===0?s=l:a=l,l=s+a>>1;return l/t||1},Ot.renderImageToCanvas=function(r,e,t,o,i,n,a,s,l,c){if(e._type==="image/jpeg"){var d=r.getContext("2d"),p=document.createElement("canvas"),u=1024,h=p.getContext("2d"),m,y,w,S;if(p.width=u,p.height=u,d.save(),m=Ot.detectSubsampling(e),m&&(t/=2,o/=2,i/=2,n/=2),y=Ot.detectVerticalSquash(e,m),m||y!==1){for(o*=y,l=Math.ceil(u*l/i),c=Math.ceil(u*c/n/y),s=0,S=0;S<n;){for(a=0,w=0;w<i;)h.clearRect(0,0,u,u),h.drawImage(e,t,o,i,n,-w,-S,i,n),d.drawImage(p,0,0,u,u,a,s,l,c),w+=u,a+=l;S+=u,s+=c}return d.restore(),r}}return l$(r,e,t,o,i,n,a,s,l,c)});var l$,Fse=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);Ot.blobSlice=Fse&&function(){var r=this.slice||this.webkitSlice||this.mozSlice;return r.apply(this,arguments)};Ot.metaDataParsers={jpeg:{65505:[]}};Ot.parseMetaData=function(r,e,t){t=t||{};var o=this,i=t.maxMetaDataSize||262144,n={},a=!(window.DataView&&r&&r.size>=12&&r.type==="image/jpeg"&&Ot.blobSlice);(a||!Ot.readFile(Ot.blobSlice.call(r,0,i),function(s){var l=s.target.result,c=new DataView(l),d=2,p=c.byteLength-4,u=d,h,m,y,w;if(c.getUint16(0)===65496){for(;d<p&&(h=c.getUint16(d),h>=65504&&h<=65519||h===65534);){if(m=c.getUint16(d+2)+2,d+m>c.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(y=Ot.metaDataParsers.jpeg[h],y)for(w=0;w<y.length;w+=1)y[w].call(o,c,d,m,n,t);d+=m,u=d}!t.disableImageHead&&u>6&&(l.slice?n.imageHead=l.slice(0,u):n.imageHead=new Uint8Array(l).subarray(0,u))}else console.log("Invalid JPEG file: Missing JPEG marker.");e(n)},"readAsArrayBuffer"))&&e(n)};var Nse=Ot.hasCanvasOption;Ot.hasCanvasOption=function(r){return Nse(r)||r.orientation};Ot.transformCoordinates=function(r,e){var t=r.getContext("2d"),o=r.width,i=r.height,n=e.orientation;if(n)switch(n>4&&(r.width=i,r.height=o),n){case 2:t.translate(o,0),t.scale(-1,1);break;case 3:t.translate(o,i),t.rotate(Math.PI);break;case 4:t.translate(0,i),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-i);break;case 7:t.rotate(.5*Math.PI),t.translate(o,-i),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-o,0);break}};Ot.getTransformedOptions=function(r){if(!r.orientation||r.orientation===1)return r;var e={},t;for(t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);switch(r.orientation){case 2:e.left=r.right,e.right=r.left;break;case 3:e.left=r.right,e.top=r.bottom,e.right=r.left,e.bottom=r.top;break;case 4:e.top=r.bottom,e.bottom=r.top;break;case 5:e.left=r.top,e.top=r.left,e.right=r.bottom,e.bottom=r.right;break;case 6:e.left=r.top,e.top=r.right,e.right=r.bottom,e.bottom=r.left;break;case 7:e.left=r.bottom,e.top=r.right,e.right=r.top,e.bottom=r.left;break;case 8:e.left=r.bottom,e.top=r.left,e.right=r.top,e.bottom=r.right;break}return r.orientation>4&&(e.maxWidth=r.maxHeight,e.maxHeight=r.maxWidth,e.minWidth=r.minHeight,e.minHeight=r.minWidth,e.sourceWidth=r.sourceHeight,e.sourceHeight=r.sourceWidth),e};Ot.ExifMap=function(){return this};Ot.ExifMap.prototype.map={Orientation:274};Ot.ExifMap.prototype.get=function(r){return this[r]||this[this.map[r]]};Ot.getExifThumbnail=function(r,e,t){var o,i,n;if(!t||e+t>r.byteLength){console.log("Invalid Exif data: Invalid thumbnail data.");return}for(o=[],i=0;i<t;i+=1)n=r.getUint8(e+i),o.push((n<16?"0":"")+n.toString(16));return"data:image/jpeg,%"+o.join("%")};Ot.exifTagTypes={1:{getValue:function(r,e){return r.getUint8(e)},size:1},2:{getValue:function(r,e){return String.fromCharCode(r.getUint8(e))},size:1,ascii:!0},3:{getValue:function(r,e,t){return r.getUint16(e,t)},size:2},4:{getValue:function(r,e,t){return r.getUint32(e,t)},size:4},5:{getValue:function(r,e,t){return r.getUint32(e,t)/r.getUint32(e+4,t)},size:8},9:{getValue:function(r,e,t){return r.getInt32(e,t)},size:4},10:{getValue:function(r,e,t){return r.getInt32(e,t)/r.getInt32(e+4,t)},size:8}};Ot.exifTagTypes[7]=Ot.exifTagTypes[1];Ot.getExifValue=function(r,e,t,o,i,n){var a=Ot.exifTagTypes[o],s,l,c,d,p,u;if(!a){console.log("Invalid Exif data: Invalid tag type.");return}if(s=a.size*i,l=s>4?e+r.getUint32(t+8,n):t+8,l+s>r.byteLength){console.log("Invalid Exif data: Invalid data offset.");return}if(i===1)return a.getValue(r,l,n);for(c=[],d=0;d<i;d+=1)c[d]=a.getValue(r,l+d*a.size,n);if(a.ascii){for(p="",d=0;d<c.length&&(u=c[d],u!=="\0");d+=1)p+=u;return p}return c};Ot.parseExifTag=function(r,e,t,o,i){var n=r.getUint16(t,o);i.exif[n]=Ot.getExifValue(r,e,t,r.getUint16(t+2,o),r.getUint32(t+4,o),o)};Ot.parseExifTags=function(r,e,t,o,i){var n,a,s;if(t+6>r.byteLength){console.log("Invalid Exif data: Invalid directory offset.");return}if(n=r.getUint16(t,o),a=t+2+12*n,a+4>r.byteLength){console.log("Invalid Exif data: Invalid directory size.");return}for(s=0;s<n;s+=1)this.parseExifTag(r,e,t+2+12*s,o,i);return r.getUint32(a,o)};Ot.parseExifData=function(r,e,t,o,i){if(!i.disableExif){var n=e+10,a,s,l;if(r.getUint32(e+4)===1165519206){if(n+8>r.byteLength){console.log("Invalid Exif data: Invalid segment size.");return}if(r.getUint16(e+8)!==0){console.log("Invalid Exif data: Missing byte alignment offset.");return}switch(r.getUint16(n)){case 18761:a=!0;break;case 19789:a=!1;break;default:console.log("Invalid Exif data: Invalid byte alignment marker.");return}if(r.getUint16(n+2,a)!==42){console.log("Invalid Exif data: Missing TIFF marker.");return}s=r.getUint32(n+4,a),o.exif=new Ot.ExifMap,s=Ot.parseExifTags(r,n,n+s,a,o),s&&!i.disableExifThumbnail&&(l={exif:{}},s=Ot.parseExifTags(r,n,n+s,a,l),l.exif[513]&&(o.exif.Thumbnail=Ot.getExifThumbnail(r,n+l.exif[513],l.exif[514]))),o.exif[34665]&&!i.disableExifSub&&Ot.parseExifTags(r,n,n+o.exif[34665],a,o),o.exif[34853]&&!i.disableExifGps&&Ot.parseExifTags(r,n,n+o.exif[34853],a,o)}}};Ot.metaDataParsers.jpeg[65505].push(Ot.parseExifData);Ot.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"};Ot.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}};Ot.ExifMap.prototype.getText=function(r){var e=this.get(r);switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[r][e];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(e[0],e[1],e[2],e[3]);case"ComponentsConfiguration":return this.stringValues[r][e[0]]+this.stringValues[r][e[1]]+this.stringValues[r][e[2]]+this.stringValues[r][e[3]];case"GPSVersionID":return e[0]+"."+e[1]+"."+e[2]+"."+e[3]}return String(e)};(function(r){var e=r.tags,t=r.map,o;for(o in e)e.hasOwnProperty(o)&&(t[e[o]]=o)})(Ot.ExifMap.prototype);Ot.ExifMap.prototype.getAll=function(){var r={},e,t;for(e in this)this.hasOwnProperty(e)&&(t=this.tags[e],t&&(r[t]=this.getText(t)));return r};function c$(r,e){let t=[.92,.86,.8,.7,.6,.5,.4,.3,.2,.1],o;for(let i=0;i<t.length;i++)if(o=r.toDataURL("image/jpeg",t[i]),o.length<e)return o;return o}function Bse(r,e){let t=r.toDataURL().length,o=r.width,i=r.height,n=document.createElement("canvas"),a;for(let s=0;s<2;s++){let l=Math.sqrt(e/t);if(o=Math.round(l*o),i=Math.round(l*i),n.height=i,n.width=o,n.getContext("2d").drawImage(r,0,0,o,i),a=n.toDataURL(),t=a.length,t<e)return a}return a}function Use(r){let t=r.getContext("2d").getImageData(0,0,r.width,r.height).data;for(let o=3;o<t.length;o+=4)if(t[o]!==255)return!0;return!1}function VG(r,e){Ot(r,o=>{if(!o.toDataURL){e(!0);return}let i=2e5,n;r.type==="image/jpeg"?n=c$(o,i):(n=o.toDataURL(),n.length>i&&(n=n.length>.75*o.width*o.height&&!Use(o)?c$(o,i):Bse(o,i))),e(null,n)},{orientation:!0,canvas:!0,maxWidth:1600,maxHeight:1600})}var LG={};__dcg_shared_module_exports__['d'](LG,{LARGE:()=>Hse,MEDIUM:()=>mF,SMALL:()=>zse,VERY_LARGE:()=>Kse,VERY_SMALL:()=>qse});var qse=9,zse=12,mF=16,Hse=20,Kse=24;var fF={keypad:!0,graphpaper:!0,expressions:!0,settingsMenu:!0,zoomButtons:!0,showResetButtonOnGraphpaper:!1,expressionsTopbar:!0,capExpressionSize:!1,pointsOfInterest:!0,trace:!0,border:!0,lockViewport:!1,expressionsCollapsed:!1,authorFeatures:!1,authorMode:!0,advancedStyling:!1,images:!0,imageUploadCallback:VG,folders:!0,notes:!0,sliders:!0,links:!0,qwertyKeyboard:!0,restrictedFunctions:!1,forceEnableGeometryFunctions:!1,pasteGraphLink:!1,pasteTableData:!0,degreeMode:!1,clearIntoDegreeMode:!1,autosize:!0,plotSingleVariableImplicitEquations:!0,plotImplicits:!0,plotInequalities:!0,colors:{RED:N_,BLUE:B_,GREEN:U_,ORANGE:z_,PURPLE:q_,BLACK:Px},invertedColors:!1,functionDefinition:!0,projectorMode:!1,decimalToFraction:!0,fontSize:16,language:"en",backgroundColor:"#fff",textColor:"#000",distributions:!0,brailleMode:"none",sixKeyInput:!1,brailleControls:!0,graphDescription:void 0,zoomFit:!0,forceLogModeRegressions:!1,defaultLogModeRegressions:!1,actions:"auto",audio:!0,logScales:!0,translucentSurfaces:!1,perspectiveDistortion:1,showKeyboardShortcutsInTooltips:!1,tone:!0,muted:!0,showPerformanceMeter:!1,allowComplex:!0,customRegressions:!0},d$=Object.keys(fF),Wse={orientationButtons:!0,debug3dRender:void 0,debugPeelLayers:void 0,adaptivePeeling:!0,debugPixelRatio:void 0,translucentOpacity:"0.8",peelFloatTexture:!1,debugScale:1/10,peelUpsample:void 0},p$={product:"graphing",showHamburger:!1,disableScrollFix:!1,branding:!0,onlyTraceSelected:!1,disableMouseInteractions:!1,nativeOnscreenKeypad:!1,plaidMode:!1,wireframe:!1,pasteGraphLinkCallback:void 0,editOnWeb:!1,crossOriginSaveTest:!1,enableTabindex:!0,audioTraceReverseExpressions:!1,audioTraceSimult:!1,transparentBackground:!1,pauseWhenOffscreen:!1,hideGeoUI:!1,substitutions:!0,intervalComprehensions:!0,recursion:!0,beta3d:!1,disableLighting:!1,disableWorkerOnZoom:!1,cacheRenderedSvgs:!1,ghostMode:!1,tableRegressions:!0,reflectionArc:!1,logInternalErrors:!1,debugProgressUpdates:!1,recursionDepthLimit:void 0,...Wse},$se={solutions:!0,menus:!0,singleVariableSolutions:!0,clickableObjects:!1,administerSecretFolders:!1},Hw={...fF,...p$};function bF(r){return!!(fF.hasOwnProperty(r)||p$.hasOwnProperty(r)||$se.hasOwnProperty(r))}function PG(r){let e=__dcg_shared_module_exports__['i'](Hw);for(let t in r)e.hasOwnProperty(t)&&(e[t]=r[t]);return __dcg_shared_module_exports__['Rd'](e.backgroundColor)||(e.backgroundColor=Hw.backgroundColor,__dcg_shared_module_exports__['g'].warn("Invalid backgroundColor. Background color must be a 3- or 6-character hex color (e.g. #cde or #ffaaaa)")),__dcg_shared_module_exports__['Rd'](e.textColor)||(e.textColor=Hw.textColor,__dcg_shared_module_exports__['g'].warn("Invalid textColor. Text color must be a 3- or 6-character hex color (e.g. #000 or #001111)")),e.actions!==!0&&e.actions!==!1&&e.actions!=="auto"&&(e.actions=Hw.actions,__dcg_shared_module_exports__['g'].warn("Invalid actions setting. Must be true, false, or 'auto'.")),r.zoomButtons===void 0&&(!e.graphpaper||e.lockViewport)&&(e.zoomButtons=!1),r.images===void 0&&(e.graphpaper||(e.images=!1)),r.hasOwnProperty("menus")&&(__dcg_shared_module_exports__['g'].warn("As of API version 0.4, the 'menus' option is deprecated and has been split into 'settingsMenu' (boolean) and 'expressionsTopbar' (boolean)."),r.hasOwnProperty("settingsMenu")||(e.settingsMenu=!!r.menus),r.hasOwnProperty("expressionsTopbar")||(e.expressionsTopbar=!!r.menus)),r.hasOwnProperty("solutions")&&(__dcg_shared_module_exports__['g'].warn("As of API v1.0, the 'solutions' option is deprecated and has been replaced with 'pointsOfInterest' (boolean)."),r.hasOwnProperty("pointsOfInterest")||(e.pointsOfInterest=!!r.solutions)),r.hasOwnProperty("singleVariableSolutions")&&__dcg_shared_module_exports__['g'].warn("As of API v1.0, the 'singleVariableSolutions' has been removed. The calculator no longer displays solutions to single variable equations."),r.hasOwnProperty("clickableObjects")&&(__dcg_shared_module_exports__['g'].warn("As of API v1.7, the 'clickableObjects' option is deprecated and has been replaced with 'actions'."),r.clickableObjects===!0&&!r.hasOwnProperty("actions")&&(e.actions=!0)),r.hasOwnProperty("administerSecretFolders")&&(__dcg_shared_module_exports__['g'].warn("As of API v1.8, the 'administerSecretFolders' option is deprecated and has been subsumed under 'authorFeatures'."),r.administerSecretFolders===!0&&!r.hasOwnProperty("authorFeatures")&&(e.authorFeatures=!0)),e.graphpaper||(e.expressionsCollapsed&&(e.expressionsCollapsed=!1,__dcg_shared_module_exports__['g'].warn("kiavash API initialized with bad options. graphpaper: false and expressionsCollapsed: true are incompatible. Proceeding with expressionsCollapsed: false.")),e.zoomButtons&&(e.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("kiavash API initialized with bad options. graphpaper: false and zoomButtons: true are incompatible. Proceeding with zoomButtons: false.")),e.showResetButtonOnGraphpaper&&(e.showResetButtonOnGraphpaper=!1,__dcg_shared_module_exports__['g'].warn("kiavash API initialized with bad options. graphpaper: false and showResetButtonOnGraphpaper: true are incompatible. Proceeding with showResetButtonOnGraphpaper: false."))),e.lockViewport&&e.zoomButtons&&(e.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("kiavash API initialized with bad options. lockViewport: true and zoomButtons: true are incompatible. Proceeding with zoomButtons: false.")),(e.notes===!1||e.folders===!1||e.images===!1)&&e.pasteGraphLink===!0&&(e.pasteGraphLink=!1,__dcg_shared_module_exports__['g'].warn("kiavash API initialized with bad options. pasteGraphLink: true is incompatible with disabling the creation of note, folder, or image expressions. Proceeding with pasteGraphLink: false.")),e.language&&(e.language=Tu(e.language)),e}function jse(r){hx?setTimeout(r,25):requestAnimationFrame(r)}var u$=1,Kw={},_C=!1;function g$(){_C=!0,jse(Yse)}var h$={};function Yse(){h$.rafSPY&&h$.rafSPY(),_C=!1;for(let r in Kw)Kw[r].detectAndEnqueueEvent(),_C=!0;if(_C){g$();for(let r in Kw)Kw[r].dispatchQueuedEvent()}}var Sb=class{constructor(e,t){this.elt=e;this.cb=t;this.destroyed=!1;this.lastOffscreen=!1;this.id=u$.toString(),this.appliedScale={x:1,y:1},u$++}stopWatching(){delete Kw[this.id]}startWatching(){this.checkForChanges(),Kw[this.id]=this,_C||g$()}resetAppliedScalingAndGetBoundingClientRect(){let e=this.elt.getBoundingClientRect(),t={x:e.width/this.elt.offsetWidth,y:e.height/this.elt.offsetHeight};if(t.x===this.appliedScale.x&&t.y===this.appliedScale.y)return e;let o=this.elt.querySelector(".dcg-dom-change-wrapper");return o&&(this.appliedScale=t,Yi(o,{transform:"scale("+1/this.appliedScale.x+","+1/this.appliedScale.y+")",width:100*this.appliedScale.x+"%",height:100*this.appliedScale.y+"%",transformOrigin:"0 0"})),e}detectAndEnqueueEvent(){if(this.destroyed)return;let e=!0;if(!(document.body&&document.body.contains(this.elt)))this.lastSize&&(this.lastSize=void 0,this.queuedEvent={type:"removed",target:this.elt,isOffscreen:!0});else{let o=this.resetAppliedScalingAndGetBoundingClientRect();e=o.top>window.innerHeight||o.bottom<0||o.left>window.innerWidth||o.right<0,this.lastSize?(o.width!==this.lastSize.width||o.height!==this.lastSize.height||window.devicePixelRatio!==this.lastSize.pixelRatio)&&(this.lastSize.width=o.width,this.lastSize.height=o.height,this.lastSize.pixelRatio=window.devicePixelRatio,this.queuedEvent={type:"resized",target:this.elt,size:{...this.lastSize},isOffscreen:e}):(this.lastSize={width:o.width,height:o.height,pixelRatio:window.devicePixelRatio},this.queuedEvent={type:"added",target:this.elt,size:{...this.lastSize},isOffscreen:e})}e!==this.lastOffscreen&&(this.lastOffscreen=e,this.queuedEvent||(this.queuedEvent={type:"offscreen-noop",target:this.elt,isOffscreen:e}))}dispatchQueuedEvent(){let e=this.queuedEvent;e&&(this.queuedEvent=void 0,this.cb(e))}checkForChanges(){this.detectAndEnqueueEvent(),this.dispatchQueuedEvent()}destroy(){this.stopWatching();for(let e in this)this.hasOwnProperty(e)&&delete this[e];this.destroyed=!0}};var Xse=0,Jse=`guid_${Math.round(Math.random()*1e6)}_${new Date().getTime()}_`;function yF(r,e,t){var o;(o=r[e])==null||o.forEach(i=>i.callback(e,t))}function xF(r,e){e.split(" ").forEach(t=>{var n,a;let[o,i]=t.split(".");if(o&&i)r[o]=(n=r[o])==null?void 0:n.filter(s=>s.namespace!==i);else if(o)delete r[o];else if(i)for(let s in r)r[s]=(a=r[s])==null?void 0:a.filter(l=>l.namespace!==i)})}function wF(r,e,t){e.split(" ").forEach(o=>{var s;let[i,n]=o.split("."),a={namespace:n,callback:t};r[i]||(r[i]=[]),(s=r[i])==null||s.push(a)})}var Jn=class{constructor(){this.__eventObservers={},this.guid=Jse+ ++Xse}triggerEvent(e,t){yF(this.__eventObservers,e,t)}observeEvent(e,t){wF(this.__eventObservers,e,t)}unobserveEvent(e){xF(this.__eventObservers,e)}};var Qse=0,Zse="guid_"+Math.round(Math.random()*1e6)+"_"+new Date().getTime()+"_",vF=class{constructor(e){this.__observers={},this.guid=Zse+ ++Qse,e&&this.setProperties(e)}unobserveAll(){this.__observers={}}getProperty(e){return this[e]}setProperty(e,t){let o=this[e];this.setPropertyWithoutNotifying(e,t),!__dcg_shared_module_exports__['J'](o,t)&&this.notifyPropertyChange(e)}setPropertyWithoutNotifying(e,t){this[e]=t}setProperties(e){let t=[];for(let o of Object.keys(e)){let i=this[o];this.setPropertyWithoutNotifying(o,e[o]),__dcg_shared_module_exports__['J'](i,e[o])||t.push(o)}t.forEach(o=>this.notifyPropertyChange(o))}notifyPropertyChange(e){yF(this.__observers,e,this)}observe(e,t){wF(this.__observers,e,t)}unobserve(e){xF(this.__observers,e)}observeAndSync(e,t){this.observe(e,t);let o=e.split(" ");for(let i=0;i<o.length;i++){let a=o[i].split(".")[0];this.hasOwnProperty(a)&&t(a,this)}}},Hs=vF;var m1=__dcg_shared_module_exports__['e'](Z());var JC=__dcg_shared_module_exports__['e'](Z());$t();var Ww,Ut,TC,EF,SF;function sl(r,e){var t=Object.keys(e),o;for(o=0;o<t.length;o++)r=r.replace(new RegExp("\\{"+t[o]+"\\}","gi"),e[t[o]]);return r}function OG(r){var e,t,o;if(!r)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",t="";do for(t="",o=0;o<12;o++)t+=e[Math.floor(Math.random()*e.length)];while(r[t]);return t}function ele(r,e){var t,o,i={},n,a;for(r=r.split(","),e=e||10,t=0;t<r.length;t+=2)o="&"+r[t+1]+";",n=parseInt(r[t],e),i[o]="&#"+n+";";return i["\\xa0"]="&#160;",i}function tle(r){var e={left:"start",right:"end",center:"middle",start:"start",end:"end"};return e[r]||e.start}SF=ele("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);Ww={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}};TC=function(r,e){this.__root=r,this.__ctx=e};TC.prototype.addColorStop=function(r,e){var t=this.__ctx.__createElement("stop"),o,i;t.setAttribute("offset",r),e.indexOf("rgba")!==-1?(o=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,i=o.exec(e),t.setAttribute("stop-color",sl("rgb({r},{g},{b})",{r:i[1],g:i[2],b:i[3]})),t.setAttribute("stop-opacity",i[4])):t.setAttribute("stop-color",e),this.__root.appendChild(t)};EF=function(r,e){this.__root=r,this.__ctx=e};Ut=function(r){var e={width:500,height:500,enableMirroring:!1},t;if(arguments.length>1?(t=e,t.width=arguments[0],t.height=arguments[1]):r?t=r:t=e,!(this instanceof Ut))return new Ut(t);this._randomPostfix="-"+function(){return"xxxxxxxx".replace(/x/g,function(i){return(Math.random()*16|0).toString(16)})}(),this._svgClassNames=[],this.width=t.width||e.width,this.height=t.height||e.height,this.enableMirroring=t.enableMirroring!==void 0?t.enableMirroring:e.enableMirroring,this.canvas=this,this.__document=t.document||document,t.ctx?this.__ctx=t.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)};Ut.prototype.__createElement=function(r,e,t){typeof e=="undefined"&&(e={});var o=this.__document.createElementNS("http://www.w3.org/2000/svg",r),i=Object.keys(e),n,a;for(t&&(o.setAttribute("fill","none"),o.setAttribute("stroke","none")),n=0;n<i.length;n++)a=i[n],o.setAttribute(a,e[a]);var s=this._svgClassNames&&this._svgClassNames[this._svgClassNames.length-1];return s&&o.setAttribute("class",s),o};Ut.prototype.__setDefaultStyles=function(){var r=Object.keys(Ww),e,t;for(e=0;e<r.length;e++)t=r[e],this[t]=Ww[t].canvas};Ut.prototype.__applyStyleState=function(r){var e=Object.keys(r),t,o;for(t=0;t<e.length;t++)o=e[t],this[o]=r[o]};Ut.prototype.__getStyleState=function(){var r,e={},t=Object.keys(Ww),o;for(r=0;r<t.length;r++)o=t[r],e[o]=this[o];return e};Ut.prototype.__applyStyleToCurrentElement=function(r){var e=this.__currentElement,t=this.__currentElementsToStyle;t&&(e.setAttribute(r,""),e=t.element,t.children.forEach(function(h){h.setAttribute(r,"")}));var o=Object.keys(Ww),i,n,a,s,l,c;for(i=0;i<o.length;i++)if(n=Ww[o[i]],a=this[o[i]],n.apply){if(a instanceof EF){if(a.__ctx)for(;a.__ctx.__defs.childNodes.length;)s=a.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[s]=s,this.__defs.appendChild(a.__ctx.__defs.childNodes[0]);e.setAttribute(n.apply,sl("url(#{id})",{id:a.__root.getAttribute("id")}))}else if(a instanceof TC)e.setAttribute(n.apply,sl("url(#{id})",{id:a.__root.getAttribute("id")}));else if(n.apply.indexOf(r)!==-1&&n.svg!==a)if((n.svgAttr==="stroke"||n.svgAttr==="fill")&&a.indexOf("rgba")!==-1){l=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,c=l.exec(a),e.setAttribute(n.svgAttr,sl("rgb({r},{g},{b})",{r:c[1],g:c[2],b:c[3]}));var d=c[4],p=this.globalAlpha;p!=null&&(d*=p),e.setAttribute(n.svgAttr+"-opacity",d)}else{var u=n.svgAttr;if(o[i]==="globalAlpha"&&(u=r+"-"+n.svgAttr,e.getAttribute(u)))continue;e.setAttribute(u,a)}}};Ut.prototype.__closestGroupOrSvg=function(r){return r=r||this.__currentElement,r.nodeName==="g"||r.nodeName==="svg"?r:this.__closestGroupOrSvg(r.parentNode)};Ut.prototype.getSerializedSvg=function(r){var e=new XMLSerializer().serializeToString(this.__root),t,o,i,n,a,s;if(s=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,s.test(e)&&(e=e.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),r)for(t=Object.keys(SF),o=0;o<t.length;o++)i=t[o],n=SF[i],a=new RegExp(i,"gi"),a.test(e)&&(e=e.replace(a,n));return e};Ut.prototype.getSvg=function(){return this.__root};Ut.prototype._dcgStartNamedGroup=function(r){var e=this.__createElement("g");e.setAttribute("id",r+this._randomPostfix);var t=this.__closestGroupOrSvg();this.__groupStack.push(t),t.appendChild(e),this.__currentElement=e};Ut.prototype._dcgEndNamedGroup=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElement||(this.__currentElement=this.__root.childNodes[1])};Ut.prototype._dcgSaveClassName=function(r){this._svgClassNames.push(r),this.__currentElement&&this.__currentElement.tagName==="path"&&!this.__currentDefaultPath&&(this.__currentElement.getAttribute("class")||this.__currentElement.setAttribute("class",r))};Ut.prototype._dcgRestoreClassName=function(){this._svgClassNames.pop()};Ut.prototype.save=function(){var r=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(r),this.__currentElement=r,this.__stack.push(this.__getStyleState())};Ut.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var r=this.__stack.pop();this.__applyStyleState(r)};Ut.prototype.__addTransform=function(r){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var t=this.__createElement("g");e.appendChild(t),this.__currentElement=t}var o=this.__currentElement.getAttribute("transform");o?o+=" ":o="",o+=r,this.__currentElement.setAttribute("transform",o)};Ut.prototype.scale=function(r,e){e===void 0&&(e=r),this.__addTransform(sl("scale({x},{y})",{x:r,y:e}))};Ut.prototype.rotate=function(r){var e=r*180/Math.PI;this.__addTransform(sl("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))};Ut.prototype.translate=function(r,e){this.__addTransform(sl("translate({x},{y})",{x:r,y:e}))};Ut.prototype.transform=function(r,e,t,o,i,n){this.__addTransform(sl("matrix({a},{b},{c},{d},{e},{f})",{a:r,b:e,c:t,d:o,e:i,f:n}))};Ut.prototype.beginPath=function(){var r,e;this.__currentDefaultPath="",this.__currentPosition={},r=this.__createElement("path",{},!0),e=this.__closestGroupOrSvg(),e.appendChild(r),this.__currentElement=r};Ut.prototype.__applyCurrentDefaultPath=function(){var r=this.__currentElement;r.nodeName==="path"?r.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",r.nodeName)};Ut.prototype.__addPathCommand=function(r){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=r};Ut.prototype.moveTo=function(r,e){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:r,y:e},this.__addPathCommand(sl("M {x} {y}",{x:r,y:e}))};Ut.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")};Ut.prototype.lineTo=function(r,e){this.__currentPosition={x:r,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(sl("L {x} {y}",{x:r,y:e})):this.__addPathCommand(sl("M {x} {y}",{x:r,y:e}))};Ut.prototype.bezierCurveTo=function(r,e,t,o,i,n){this.__currentPosition={x:i,y:n},this.__addPathCommand(sl("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:r,cp1y:e,cp2x:t,cp2y:o,x:i,y:n}))};Ut.prototype.quadraticCurveTo=function(r,e,t,o){this.__currentPosition={x:t,y:o},this.__addPathCommand(sl("Q {cpx} {cpy} {x} {y}",{cpx:r,cpy:e,x:t,y:o}))};var CF=function(r){var e=Math.sqrt(r[0]*r[0]+r[1]*r[1]);return[r[0]/e,r[1]/e]};Ut.prototype.arcTo=function(r,e,t,o,i){var n=this.__currentPosition&&this.__currentPosition.x,a=this.__currentPosition&&this.__currentPosition.y;if(!(typeof n=="undefined"||typeof a=="undefined")){if(i<0)throw new Error("IndexSizeError: The radius provided ("+i+") is negative.");if(n===r&&a===e||r===t&&e===o||i===0){this.lineTo(r,e);return}var s=CF([n-r,a-e]),l=CF([t-r,o-e]);if(s[0]*l[1]===s[1]*l[0]){this.lineTo(r,e);return}var c=s[0]*l[0]+s[1]*l[1],d=Math.acos(Math.abs(c)),p=CF([s[0]+l[0],s[1]+l[1]]),u=i/Math.sin(d/2),h=r+u*p[0],m=e+u*p[1],y=[-s[1],s[0]],w=[l[1],-l[0]],S=function(E){var _=E[0],T=E[1];return T>=0?Math.acos(_):-Math.acos(_)},C=S(y),v=S(w);this.lineTo(h+y[0]*i,m+y[1]*i),this.arc(h,m,i,C,v)}};Ut.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")};Ut.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")};Ut.prototype.rect=function(r,e,t,o){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(r,e),this.lineTo(r+t,e),this.lineTo(r+t,e+o),this.lineTo(r,e+o),this.lineTo(r,e),this.closePath()};Ut.prototype.fillRect=function(r,e,t,o){var i,n;i=this.__createElement("rect",{x:r,y:e,width:t,height:o},!0),n=this.__closestGroupOrSvg(),n.appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("fill")};Ut.prototype.strokeRect=function(r,e,t,o){var i,n;i=this.__createElement("rect",{x:r,y:e,width:t,height:o},!0),n=this.__closestGroupOrSvg(),n.appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("stroke")};Ut.prototype.__clearCanvas=function(){for(var r=this.__closestGroupOrSvg(),e=r.getAttribute("transform"),t=this.__root.childNodes[1],o=t.childNodes,i=o.length-1;i>=0;i--)o[i]&&t.removeChild(o[i]);this.__currentElement=t,this.__groupStack=[],e&&this.__addTransform(e)};Ut.prototype.clearRect=function(r,e,t,o){if(r===0&&e===0&&t===this.width&&o===this.height){this.__clearCanvas();return}var i,n=this.__closestGroupOrSvg();i=this.__createElement("rect",{x:r,y:e,width:t,height:o,fill:"#FFFFFF"},!0),n.appendChild(i)};Ut.prototype.createLinearGradient=function(r,e,t,o){var i=this.__createElement("linearGradient",{id:OG(this.__ids),x1:r+"px",x2:t+"px",y1:e+"px",y2:o+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(i),new TC(i,this)};Ut.prototype.createRadialGradient=function(r,e,t,o,i,n){var a=this.__createElement("radialGradient",{id:OG(this.__ids),cx:o+"px",cy:i+"px",r:n+"px",fx:r+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new TC(a,this)};Ut.prototype.__parseFont=function(){var r=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,e=r.exec(this.font),t={style:e[1]||"normal",size:e[4]||"10px",family:e[6]||"sans-serif",weight:e[3]||"normal",decoration:e[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(t.decoration="underline"),this.__fontHref&&(t.href=this.__fontHref),t};Ut.prototype.__wrapTextLink=function(r,e){if(r.href){var t=this.__createElement("a");return t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r.href),t.appendChild(e),t}return e};Ut.prototype.__applyText=function(r,e,t,o){var i=this.__parseFont(),n=this.__closestGroupOrSvg(),a=this.__createElement("text",{"font-family":i.family,"font-size":i.size,"font-style":i.style,"font-weight":i.weight,"text-decoration":i.decoration,x:e,y:t,"text-anchor":tle(this.textAlign)},!0);a.appendChild(this.__document.createTextNode(r)),this.__currentElement=a,this.__applyStyleToCurrentElement(o),n.appendChild(this.__wrapTextLink(i,a))};Ut.prototype.fillText=function(r,e,t){this.__applyText(r,e,t,"fill")};Ut.prototype.strokeText=function(r,e,t){this.__applyText(r,e,t,"stroke")};Ut.prototype.measureText=function(r){return this.__ctx.font=this.font,this.__ctx.measureText(r)};Ut.prototype.arc=function(r,e,t,o,i,n){if(o!==i){o=o%(2*Math.PI),i=i%(2*Math.PI),o===i&&(i=(i+2*Math.PI-.001*(n?-1:1))%(2*Math.PI));var a=r+t*Math.cos(i),s=e+t*Math.sin(i),l=r+t*Math.cos(o),c=e+t*Math.sin(o),d=n?0:1,p=0,u=i-o;u<0&&(u+=2*Math.PI),n?p=u>Math.PI?0:1:p=u>Math.PI?1:0,this.lineTo(l,c),this.__addPathCommand(sl("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:t,ry:t,xAxisRotation:0,largeArcFlag:p,sweepFlag:d,endX:a,endY:s})),this.__currentPosition={x:a,y:s}}};Ut.prototype.clip=function(){var r=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),t=OG(this.__ids),o=this.__createElement("g");this.__applyCurrentDefaultPath(),r.removeChild(this.__currentElement),e.setAttribute("id",t),e.appendChild(this.__currentElement),this.__defs.appendChild(e),r.setAttribute("clip-path",sl("url(#{id})",{id:t})),r.appendChild(o),this.__currentElement=o};Ut.prototype.drawImage=function(){var r=Array.prototype.slice.call(arguments),e=r[0],t,o,i,n,a=0,s=0,l,c,d,p,u,h,m,y,w,S,C;if(r.length===3)t=r[1],o=r[2],l=e.width,c=e.height,i=l,n=c;else if(r.length===5)t=r[1],o=r[2],i=r[3],n=r[4],l=e.width,c=e.height;else if(r.length===9)a=r[1],s=r[2],l=r[3],c=r[4],t=r[5],o=r[6],i=r[7],n=r[8];else throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);d=this.__closestGroupOrSvg(),m=this.__currentElement;var v="translate("+t+", "+o+")";if(e instanceof Ut){if(p=e.getSvg().cloneNode(!0),p.childNodes&&p.childNodes.length>1){for(u=p.childNodes[0];u.childNodes.length;)C=u.childNodes[0].getAttribute("id"),this.__ids[C]=C,this.__defs.appendChild(u.childNodes[0]);if(h=p.childNodes[1],h){var E=h.getAttribute("transform"),_;E?_=E+" "+v:_=v,h.setAttribute("transform",_),d.appendChild(h)}}}else(e.nodeName==="CANVAS"||e.nodeName==="IMG")&&(y=this.__createElement("image"),y.setAttribute("width",i),y.setAttribute("height",n),y.setAttribute("opacity",this.globalAlpha),y.setAttribute("preserveAspectRatio","none"),(a||s||l!==e.width||c!==e.height)&&(w=this.__document.createElement("canvas"),w.width=i,w.height=n,S=w.getContext("2d"),S.drawImage(e,a,s,l,c,0,0,i,n),e=w),y.setAttribute("transform",v),y.setAttribute("xlink:href",e.nodeName==="CANVAS"?e.toDataURL():e.getAttribute("src")),d.appendChild(y))};Ut.prototype.createPattern=function(r,e){var t=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),o=OG(this.__ids),i;return t.setAttribute("id",o),t.setAttribute("width",r.width),t.setAttribute("height",r.height),r.nodeName==="CANVAS"||r.nodeName==="IMG"?(i=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("width",r.width),i.setAttribute("height",r.height),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r.nodeName==="CANVAS"?r.toDataURL():r.getAttribute("src")),t.appendChild(i),this.__defs.appendChild(t)):r instanceof Ut&&(t.appendChild(r.__root.childNodes[1]),this.__defs.appendChild(t)),new EF(t,this)};Ut.prototype.setLineDash=function(r){r&&r.length>0?this.lineDash=r.join(","):this.lineDash=null};Ut.prototype.ellipse=function(r,e,t,o,i,n,a,s){if(n!==a){n=n%(2*Math.PI),a=a%(2*Math.PI),n===a&&(a=(a+2*Math.PI-.001*(s?-1:1))%(2*Math.PI));var l=r+Math.cos(-i)*t*Math.cos(a)+Math.sin(-i)*o*Math.sin(a),c=e-Math.sin(-i)*t*Math.cos(a)+Math.cos(-i)*o*Math.sin(a),d=r+Math.cos(-i)*t*Math.cos(n)+Math.sin(-i)*o*Math.sin(n),p=e-Math.sin(-i)*t*Math.cos(n)+Math.cos(-i)*o*Math.sin(n),u=s?0:1,h=0,m=a-n;m<0&&(m+=2*Math.PI),s?h=m>Math.PI?0:1:h=m>Math.PI?1:0,this.lineTo(d,p),this.__addPathCommand(sl("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:t,ry:o,xAxisRotation:i*(180/Math.PI),largeArcFlag:h,sweepFlag:u,endX:l,endY:c})),this.__currentPosition={x:l,y:c}}};Ut.prototype._dcgSetTitle=function(r){var e=this.__currentElement,t=!1,o,i=e.getElementsByTagName("title");i.length>0?o=i[0]:(o=this.__document.createElementNS("http://www.w3.org/2000/svg","title"),t=!0),o.textContent=r,t&&e.appendChild(o)};Ut.prototype.drawFocusRing=function(){};Ut.prototype.createImageData=function(){};Ut.prototype.getImageData=function(){};Ut.prototype.putImageData=function(){};Ut.prototype.globalCompositeOperation=function(){};Ut.prototype.setTransform=function(){};var m$=Ut;var qh=class r extends Hs{constructor(){super();this.highlightPropertyMultipliers={};this.stateProperties=[],this.cloneProperties=[],this.highlightPropertyMultipliers={},this.config=new Hs;for(let t in hc)hc.hasOwnProperty(t)&&this.addStateProperty(t,hc[t]);this.setProperty("labelHangingColor","rgba(150,150,150,1)"),this.setProperty("lastChangedAxis","x"),this.addDynamicProperties()}addDynamicProperties(){let t=this;function o(n,a,s){t.cloneProperties.push(n);function l(){t.setProperty(n,t.config.projectorMode?s:a)}t.config.observe("projectorMode",l),l()}function i(n,a,s,l,c){t.cloneProperties.push(n);function d(){let u;t.config.projectorMode?u=t.highlight?c:l:u=t.highlight?s:a,t.setProperty(n,u)}let p=[a,s,l,c];t.highlightPropertyMultipliers[n]=p.map(u=>u/p[0]),t.observe("highlight",d),t.config.observe("projectorMode",d),d()}o("labelSize",14,19),o("majorAxisOpacity",.4,1),o("minorAxisOpacity",.12,.25),o("axisOpacity",.9,.9),o("axisLineWidth",1.5,2),o("axisLineOffset",.25,0),o("pixelsPerLabel",80,120),i("curveOpacity",.7,1,.7,1),o("globalCurveColor",void 0,void 0),o("disableFill",!1,!1),i("graphLineWidth",2.5,3.5,5,7),i("pointLineWidth",8,8*1.2,8*1.3,8*1.2*1.3)}setController(t){this.controller=t,this.registerCallbacks()}getHighlightPropertyMultiplier(t,o){let i=o?1:0;return this.config.projectorMode?this.highlightPropertyMultipliers[t][2+i]:this.highlightPropertyMultipliers[t][i]}getFillOpacityMultiplier(){return this.highlight&&this.controller&&this.controller.isGeometry()?1.3:1}addStateProperty(t,o){this[t]=o,this.stateProperties.push(t),this.cloneProperties.push(t)}static fromObject(t){let o=new r;return o.cloneProperties.forEach(i=>{t.hasOwnProperty(i)&&o.setProperty(i,t[i])}),o}registerCallbacks(){let t=()=>{var o;(o=this.controller)==null||o.requestRedrawGraph()};this.stateProperties.forEach(o=>{this.observe(o,t)}),this.config.observe("backgroundColor",t),this.config.observe("textColor",t),this.config.observe("invertedColors",t),this.observe("backgroundColor",t),this.observe("textColor",t),this.config.observe("enableTabindex",t),this.config.observeAndSync("projectorMode",t)}_validateSetting(t,o){let i;switch(t){case"xAxisMinorSubdivisions":case"yAxisMinorSubdivisions":i=Math.round(Math.min(Math.max(0,o),5)),o!==i&&__dcg_shared_module_exports__['g'].warn("minorSubdivisions must be an integer between 0 and 5. You provided "+o+", which we changed to "+i+".");break;case"degreeMode":case"projectorMode":case"showGrid":case"showXAxis":case"showYAxis":case"xAxisNumbers":case"yAxisNumbers":case"polarNumbers":case"enableTabindex":case"invertedColors":case"complex":i=o==="false"?!1:!!o,o!==i&&__dcg_shared_module_exports__['g'].warn(t+" must be a Boolean. You provided "+o+" ("+typeof o+"), which we changed to "+i+" ("+typeof i+").");break;case"xAxisStep":case"yAxisStep":i=parseFloat(o),isFinite(o)||(i=0,__dcg_shared_module_exports__['g'].warn(t+" must be a number. You provided "+o+", which we changed to "+i+"."));break;case"xAxisScale":case"yAxisScale":i=o,!this.config.logScales&&o==="logarithmic"?(i="linear",__dcg_shared_module_exports__['g'].warn("Must set logScales: true to set "+t+" to 'logarithmic'.")):o!=="linear"&&o!=="logarithmic"&&(i="linear",__dcg_shared_module_exports__['g'].warn(t+' must be "linear" or "logarithmic". You provided '+o+", which we changed to "+i+"."));break;case"xAxisArrowMode":case"yAxisArrowMode":i=__dcg_shared_module_exports__['h'][o],i!==o&&(i="NONE",__dcg_shared_module_exports__['g'].warn(`unknown AxisArrowMode. Allowed values are: 
`+__dcg_shared_module_exports__['G'](__dcg_shared_module_exports__['h']).join(`
`)));break;case"xAxisLabel":case"yAxisLabel":i=o,typeof o!="string"&&(i="",__dcg_shared_module_exports__['g'].warn(t+" must be a string. you provided a "+typeof o+"."));break;case"randomSeed":i=o,typeof o!="string"&&(i=""+o,__dcg_shared_module_exports__['g'].warn("randomSeed must be a string. you provided a "+typeof o+"."));break;case"backgroundColor":i=o,typeof o!="string"&&(i="",__dcg_shared_module_exports__['g'].warn(t+" must be a string. you provided a "+typeof o+".")),i||(i="#fff"),i[0]!=="#"&&(i="#"+i);break;case"textColor":i=o,typeof o!="string"&&(i="",__dcg_shared_module_exports__['g'].warn(t+" must be a string. you provided a "+typeof o+".")),i||(i="#000"),i[0]!=="#"&&(i="#"+i);break;case"fontSize":i=o,typeof o!="number"&&(i=parseInt(i,10),__dcg_shared_module_exports__['g'].warn("fontSize must be a number. Attempted to convert "+o+" to "+i+"."));break;case"language":i=o,typeof o!="string"&&(i="",__dcg_shared_module_exports__['g'].warn(t+" must be a string. you provided a "+typeof o+".")),o!=="en"&&!nG(o)&&(i="en",__dcg_shared_module_exports__['g'].warn(o+" is not currently an available language."));break;default:i=o;break}return i}validateSettings(t){let o={},i=!1;for(let n in t)this.stateProperties.indexOf(n)>=0?o[n]=this._validateSetting(n,t[n]):(__dcg_shared_module_exports__['g'].warn('Invalid graph setting "'+n+'".'),i=!0);return i&&__dcg_shared_module_exports__['g'].warn(`Available graph settings are: 
`+this.stateProperties.join(`
`)),this.config.allowComplex||o.complex&&(__dcg_shared_module_exports__['g'].warn("complex: true is not compatible with allowComplex: false. Forcing complex: false"),o.complex=!1),o.complex&&(o.degreeMode&&__dcg_shared_module_exports__['g'].warn("degreeMode: true is not compatible with complex: true. Forcing degreeMode: false"),o.degreeMode=!1),o}getConfiguredBackgroundColor(){return __dcg_shared_module_exports__['Qd'](this.config.backgroundColor||"#fff")}getBackgroundColor({invertWhite:t}={invertWhite:!1}){let o=this.getConfiguredBackgroundColor();return this.config.invertedColors&&t?__dcg_shared_module_exports__['Ud'](o):o}getConfiguredTextColor(){return __dcg_shared_module_exports__['Qd'](this.config.textColor||"#000")}getTextColor({invertBlack:t}={invertBlack:!1}){let o=this.getConfiguredTextColor();return this.config.invertedColors&&t?__dcg_shared_module_exports__['Ud'](o):o}cloneConfig(){let t={};for(let o of Object.keys(Hw))t[o]=__dcg_shared_module_exports__['i'](this.config[o]);return t}};$t();var WG={};__dcg_shared_module_exports__['d'](WG,{CLCalculator:()=>P$,Label:()=>__dcg_shared_module_exports__['dc'],applyDiff:()=>R$,applyLocalizationMap:()=>z$,blankGeometryCalculatorState:()=>Vce,blankGraphingCalculatorState:()=>Ace,builtInFrame:()=>Gce,calculateDiff:()=>B$,colorHelpers:()=>__dcg_shared_module_exports__['$d'],context:()=>Tce,expressionParser:()=>$F,extractLocalizationMap:()=>q$,formatLatex:()=>ej,migrateGeoStateToCalcState:()=>zh,migrateToLatest:()=>vp,numberToDecimalString:()=>__dcg_shared_module_exports__['ke'],numberToLatex:()=>__dcg_shared_module_exports__['je'],parseNodes:()=>rj,parser:()=>kce,policies:()=>Mce,replaceIdentifierWithLatex:()=>C2,treeQueries:()=>_ce,types:()=>Ice});function DF(){return{type:"folder",id:__dcg_shared_module_exports__['xb'],title:"geometry",secret:!0}}var $w={version:Od,randomSeed:"",graph:{viewport:{xmin:-10,ymin:-13.25,xmax:10,ymax:13.25},showGrid:!1,product:"geometry-calculator",showXAxis:!1,showYAxis:!1,degreeMode:!0},expressions:{list:[DF(),{id:"1",type:"expression"}]}};function rle(r){typeof r.min=="number"&&(r.min=""+r.min),typeof r.max=="number"&&(r.max=""+r.max),typeof r.step=="number"&&(r.step=""+r.step)}function ole(r){r.slider&&rle(r.slider),typeof r.id!="string"&&(r.id=""+r.id)}function ile(r,e){let t=nle(r)+1,o={},i,n;for(let a of r)if(ole(a),a.type==="folder")i=a.id,o[a.id]&&(a.id=""+t,t+=1),n=a.id,o[a.id]=!0,a.hasOwnProperty("folderId")&&delete a.folderId;else{if(i!==void 0&&a.folderId===i?a.folderId=n:(a.folderId&&(a.folderId=""),i=void 0,n=void 0),a.type==="table"&&Array.isArray(a.columns))for(let s of a.columns)o[s.id]&&(s.id=""+t,t+=1),o[s.id]=!0;o[a.id]&&(a.id=""+t,t+=1),o[a.id]=!0}e==="geometry-calculator"&&!o[__dcg_shared_module_exports__['xb']]&&r.push(DF())}function b$(r,e){let t=parseFloat(e);return t!==Math.floor(t)?r:Math.max(r,t)}function nle(r){let e=0;for(let t of r)if(e=b$(e,t.id),t.type==="table"&&Array.isArray(t.column))for(let o of t.columns)b$(e,o.id);return e}function RG(r){var i,n;let e=__dcg_shared_module_exports__['i'](r),t=e.graph&&e.graph.product,o=e.expressions.list;return Array.isArray(o)&&ile(o,t),(i=e.graph)!=null&&i.complex&&((n=e.graph)!=null&&n.degreeMode)&&(e.graph.degreeMode=!1),e}var kF={NONE:"NONE",POSITIVE:"POSITIVE",BOTH:"BOTH"},ale={expression:!0,table:!0,image:!0,folder:!0,text:!0};function sle(r){if(r.type){if(ale.hasOwnProperty(r.type))return r.type;throw new Error("Invalid item type: '"+r.type+"'.")}return r.text!==void 0?"text":r.columns!==void 0||r.headings!==void 0?"table":"expression"}function FG(r){return r.replace(/\\(total|length|mean|median|quantile|stdev|stddev|stdDev|stdevp|stddevp|stdDevP|var|variance|cov|corr|ceil|floor|round|abs|mod|lcm|mcm|mcd|nCr|nPr|signum|sign|arcsinh|arccosh|arctanh|arccsch|arcsech|arccoth|arccsc|arcsec|arccot)/g,"\\operatorname{$1}")}function lle(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="latex"?e[t]=FG(r[t]):t==="values"?e[t]=r[t].map(FG):e[t]=r[t]);return e}function cle(r){let e=sle(r),t={},o;switch(e){case"expression":for(o in r)r.hasOwnProperty(o)&&(o==="latex"?t[o]=FG(r[o]):t[o]=r[o]);return t.type=e,t;case"table":for(o in r)r.hasOwnProperty(o)&&(o==="columns"?t[o]=r[o].map(lle):t[o]=r[o]);return t.type=e,t;case"image":for(o in r)r.hasOwnProperty(o)&&(o==="width"||o==="height"||o==="x"||o==="y"?t[o]=FG(r[o]):t[o]=r[o]);return t.type=e,t;case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t.type=e,t}}var y$={none:kF.NONE,both:kF.BOTH,positive:kF.POSITIVE};function dle(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="xAxisArrows"||t==="yAxisArrows"||(e[t]=r[t]));return e.xAxisArrowMode=y$[r.xAxisArrows||"none"],e.yAxisArrowMode=y$[r.yAxisArrows||"none"],e}function x$(r){if(r.version)throw new Error("Unexpected version: "+r.version);let e={};return e.graph=dle(r.graph),e.expressions={list:r.expressions.list.map(cle)},e.version=0,e}function NG(r){return r.replace(/\\(sech|csch)/g,"\\operatorname{$1}")}function ple(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="latex"?e[t]=NG(r[t]):t==="values"?e[t]=r[t].map(NG):e[t]=r[t]);return e}function ule(r){let e=r.type,t={},o;switch(e){case"expression":for(o in r)r.hasOwnProperty(o)&&(o==="latex"?t[o]=NG(r[o]):t[o]=r[o]);return t;case"table":for(o in r)r.hasOwnProperty(o)&&(o==="columns"?t[o]=r[o].map(ple):t[o]=r[o]);return t;case"image":for(o in r)r.hasOwnProperty(o)&&(o==="width"||o==="height"||o==="x"||o==="y"?t[o]=NG(r[o]):t[o]=r[o]);return t;case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t;default:throw new Error("Unexpected expression type: "+e)}}function w$(r){if(r.version)throw new Error("Unexpected version: "+r.version);let e={};return e.graph=r.graph,e.expressions={list:r.expressions.list.map(ule)},e.version=1,e}var hle=2,gle="#C0504D",mle="#4F81BD",fle="#9BBB59",ble="#8064A2",yle="#F79646",xle="#000000";function v$(r){switch(r){case gle:return __dcg_shared_module_exports__['Zd'].RED;case mle:return __dcg_shared_module_exports__['Zd'].BLUE;case fle:return __dcg_shared_module_exports__['Zd'].GREEN;case ble:return __dcg_shared_module_exports__['Zd'].PURPLE;case yle:return __dcg_shared_module_exports__['Zd'].ORANGE;case xle:return __dcg_shared_module_exports__['Zd'].BLACK;default:return r}}function wle(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="color"?e[t]=v$(r[t]):e[t]=r[t]);return e}function vle(r){let e=r.type,t={},o;switch(e){case"expression":for(o in r)r.hasOwnProperty(o)&&(o==="color"?t[o]=v$(r[o]):t[o]=r[o]);return t;case"table":for(o in r)r.hasOwnProperty(o)&&(o==="columns"?t[o]=r[o].map(wle):t[o]=r[o]);return t;case"image":case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t;default:throw new Error("Unexpected expression type: "+e)}}function C$(r){if(r.version>1)throw new Error("Unexpected version: "+r.version);let e={};return e.graph=r.graph,e.expressions={list:r.expressions.list.map(vle)},e.version=hle,e}function _F(r){if(typeof r=="string")return r;if(r===void 0)return"";let e=r+"";return e=e.replace(/1e\+?([-\d]+)/,"10^{$1}"),e=e.replace(/([-\d\.]+)e\+?([-\d]+)/,"$1\\cdot 10^{$2}"),e}function Cle(r){let e=r.type,t={},o;switch(e){case"expression":for(o in r)r.hasOwnProperty(o)&&(o==="sliderMax"||o==="sliderMin"||o==="sliderInterval"?t[o]=_F(r[o]):o==="domain"?t[o]={max:_F(r[o].max),min:_F(r[o].min)}:t[o]=r[o]);return t.hasOwnProperty("sliderMin")&&t.sliderInterval===void 0&&(t.sliderInterval=""),t;case"image":case"table":case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t;default:throw new Error("Unexpected expression type: "+e)}}function S$(r){if(r.version>2)throw new Error("Unexpected version: "+r.version);let e={};return e.graph=r.graph,e.expressions={list:r.expressions.list.map(Cle)},e.version=3,e}function E$(r){switch(r){case"point":return"POINT";case"cross":return"CROSS";case"open":return"OPEN";case"normal":return"SOLID";case"dashed":return"DASHED";case"dotted":return"DOTTED";default:return r}}function Sle(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="style"?e[t]=E$(r[t]):e[t]=r[t]);return e}function Ele(r){let e=r.type,t={},o;switch(e){case"expression":for(o in r)r.hasOwnProperty(o)&&(o==="style"?t[o]=E$(r[o]):t[o]=r[o]);return t;case"table":for(o in r)r.hasOwnProperty(o)&&(o==="columns"?t[o]=r[o].map(Sle):t[o]=r[o]);return t;case"image":case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t;default:throw new Error("Unexpected expression type: "+e)}}function D$(r){if(r.version!==3)throw new Error("Unexpected version: "+r.version);let e={};return e.graph=r.graph,e.expressions={list:r.expressions.list.map(Ele)},e.version=4,e}function Dle(r){let e={},t;for(let o in r)if(r.hasOwnProperty(o))switch(t=r[o],o){case"showAxes":e.showXAxis=t,e.showYAxis=t;break;case"showLabels":e.xAxisNumbers=t,e.yAxisNumbers=t,e.polarNumbers=t;break;case"labelXMode":e.xAxisStep=t==="pi"?Math.PI:0;break;case"labelYMode":e.yAxisStep=t==="pi"?Math.PI:0;break;default:e[o]=t}return e}function kle(r){let e={};for(let t in r)r.hasOwnProperty(t)&&(t==="showPoints"||t==="showLine"||(e[t]=r[t]));return(r.showPoints!==void 0||r.showLine!==void 0)&&(r.showPoints&&r.showLine?e.columnMode="POINTS_AND_LINES":r.showPoints?e.columnMode="POINTS":r.showLine?e.columnMode="LINES":(e.hidden=!0,e.columnMode="POINTS")),e}function _le(r){let e=r.type,t={},o;switch(e){case"expression":r.hidden===void 0?r.hasOwnProperty("graphed")?t.hidden=!r.graphed:r.hasOwnProperty("userRequestedGraphing")?t.hidden=r.userRequestedGraphing==="never":t.hidden=!1:t.hidden=r.hidden;for(o in r)if(r.hasOwnProperty(o)&&!(o==="graphed"||o==="userRequestedGraphing"||o==="hidden")&&o!=="slider"){if(o==="color"){typeof r.color=="object"?t.color=r.color.value:t.color=r.color;continue}if(o==="style"){t.style=r.style==="normal"?"SOLID":r.style;continue}if(o==="sliderInterval"){t.sliderInterval=r.sliderInterval==="undefined"?"":r.sliderInterval;continue}t[o]=r[o]}return t;case"table":if(r.headings||r.columns){let i=r.headings?r.headings:r.columns;if(t.columns=i.map(kle),r.rows)for(let n=0;n<t.columns.length;n++){let a=t.columns[n];a.values=[];for(let s=0;s<r.rows.length;s++)a.values.push(r.rows[s][n])}}for(o in r)r.hasOwnProperty(o)&&(o==="rows"||o==="headings"||o==="columns"||(t[o]=r[o]));return t;case"image":case"text":case"folder":for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t;default:throw new Error("Unexpected expression type: "+e)}}function k$(r){if(r.version!==4)throw new Error("Unexpected version: "+r.version);return{version:5,graph:Dle(r.graph),expressions:{list:r.expressions.list.map(_le)}}}var Tle=6;function Gle(r){return r.length<2?!1:r[0]==="`"&&r[r.length-1]==="`"}function Ile(r){if(Gle(r))return{raw:r,parts:[r]};let t="({"+["[a-zA-Z][0-9]*","[a-zA-Z]_[a-zA-Z0-9]+","[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|({")+"})",o=new RegExp(t,"g"),i=[],n=0,a=0,s;for(;s=o.exec(r);){a=s.index,a>n&&i.push(r.substr(n,a-n));let l=s[0],c=l.replace(/[{}\$]/g,"").replace(/^([a-zA-Z])([0-9]+)$/,"$1_$2");i.push({symbol:c,str:l}),n=s.index+l.length}return n<r.length&&i.push(r.substr(n)),{raw:r,parts:i}}function Mle(r){let e={};for(let t in r)if(r.hasOwnProperty(t)&&t!=="style")if(t==="values"&&(e[t]=r[t].map(o=>o?""+o:"")),t==="columnMode"&&!r.hasOwnProperty("points")&&!r.hasOwnProperty("lines"))switch(r[t]){case"LINES":e.points=!1,e.lines=!0;break;case"POINTS_AND_LINES":e.points=!0,e.lines=!0;break;default:e.points=!0,e.lines=!1}else e[t]=r[t];return e.hasOwnProperty("pointStyle")||(e.pointStyle="POINT"),e.hasOwnProperty("lineStyle")||(e.lineStyle="SOLID"),e.id=""+e.id,e}var _$={sliderMin:"min",sliderMax:"max",sliderInterval:"step",sliderHardMin:"hardMin",sliderHardMax:"hardMax",sliderAnimationPeriod:"animationPeriod",sliderLoopMode:"loopMode",sliderPlayDirection:"playDirection",sliderIsPlaying:"isPlaying"};function Ale(r){let e=Ile(r),t="";return __dcg_shared_module_exports__['k'](e.parts,o=>{t+=typeof o=="object"&&o.str?"$"+o.str:o}),t}function Vle(r,e){let t=r.latex.split("=");if(t.length!==2)return;let o=Qo(t[1],e);if(!isFinite(o))return;let i=r.slider.hardMin?Qo(r.slider.min||"-10",e):void 0,n=r.slider.hardMax?Qo(r.slider.max||"10",e):void 0,a=r.slider.step?Qo(r.slider.step,e):void 0,s=__dcg_shared_module_exports__['bd']({target:o,step:a,hardMin:i,hardMax:n});s.min||(delete r.slider.hardMin,delete r.slider.min),s.max||(delete r.slider.hardMax,delete r.slider.max),s.step||delete r.slider.step}function Lle(r,e,t,o){let i=r.type,n={},a;switch(i){case"folder":for(a in r)r.hasOwnProperty(a)&&(a==="memberIds"||(n[a]=r[a]));break;case"expression":for(a in r)if(r.hasOwnProperty(a)){if(a==="style"&&!r.hasOwnProperty("pointStyle")&&!r.hasOwnProperty("lineStyle")){let s=r[a];__dcg_shared_module_exports__['p'](["POINT","OPEN","CROSS"],s)?(n.pointStyle=s,n.lineStyle="SOLID"):__dcg_shared_module_exports__['p'](["SOLID","DASHED","DOTTED"],s)?(n.pointStyle="POINT",n.lineStyle=s):(n.pointStyle="POINT",n.lineStyle="SOLID");continue}_$.hasOwnProperty(a)?(n.slider=n.slider||{},n.slider[_$[a]]=r[a]):n[a]=r[a],r.label&&(n.label=Ale(r.label))}n.latex&&n.slider&&!n.slider.isPlaying&&Vle(n,o),n.hasOwnProperty("fillOpacity")||(n.fillOpacity=.4),n.label===!1&&(n.label=""),n.labelSize||(n.labelSize="medium"),n.labelOrientation||(n.labelOrientation="default"),n.verticalLabel||(n.verticalLabel=!1),n.interactiveLabel||(n.interactiveLabel=!1);break;case"image":for(a in r)!r.hasOwnProperty(a)||a==="x"||a==="y"||(n[a]=r[a]);n.center="\\left("+(r.x||"0")+","+(r.y||"0")+"\\right)",n.angle=r.angle||"0",n.foreground=!!n.foreground;break;case"text":for(a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);break;case"table":for(a in r)r.hasOwnProperty(a)&&(a==="columns"?n[a]=r[a].map(Mle):n[a]=r[a]);break;default:throw new Error("Unexpected expression type: "+i)}if(n.id=""+n.id,r.type==="folder")e.folderId=n.id,e.memberIds=r.memberIds,n.folderId="";else{let s=t[n.id];e.memberIds&&e.memberIds[s]?n.folderId=e.folderId:(n.folderId="",e.folderId=void 0,e.memberIds=void 0)}return n}function Ple(r){let e=0,t=/^[0-9]+$/;for(let o=r.length-1;o>=0;o--){let i=r[o],n=i.id,a;if(t.test(n)&&(a=parseInt(n,10),a>e&&(e=a)),i.type==="table"&&i.columns)for(let s=i.columns.length-1;s>=0;s--)n=i.columns[s].id,t.test(n)&&(a=parseInt(n,10),a>e&&(e=a))}return e+1}function T$(r){if(r.version!==5)throw new Error("Unexpected version: "+r.version);let e=!!(r.graph&&r.graph.degreeMode),t=r.expressions.list,o=-1,i={},n={},a={};return{version:Tle,graph:r.graph,expressions:{list:t.map(l=>(i[l.id]?(o===-1&&(o=Ple(t)),n[o]=l.id,l=__dcg_shared_module_exports__['i'](l),l.id=o+"",o+=1):n[l.id]=l.id,i[l.id]=!0,Lle(l,a,n,e)))}}}function TF(r){if(r.version!==6)throw new Error(`Unexpected version: ${r.version}`);let e=r.expressions.list.map(t=>{if(t.type==="expression"&&t.domain){let o={...t,parametricDomain:{min:t.domain.min,max:t.domain.max}};return delete o.domain,o}return t});return{version:7,randomSeed:r.randomSeed,graph:r.graph,expressions:{list:e}}}function GF(r){let e=r.split("_");return e.length===2&&e[1]&&e[1].length===1?e[0]+"_{"+e[1]+"}":r}function G$(r){return r=__dcg_shared_module_exports__['i'](r),!r.rules&&(r.assignment||r.expression)&&(r.rules=[{id:"1",assignment:r.assignment||"",expression:r.expression||""}]),delete r.assignment,delete r.expression,r}function GC(r){let e=/\\operatorname(?:\{stdev\}p|\{stddev\}p|\{stdDev\}P|\{var\}iance)/g;return r.replace(e,t=>{switch(t){case"\\operatorname{stdev}p":return"\\operatorname{stdevp}";case"\\operatorname{stddev}p":return"\\operatorname{stddevp}";case"\\operatorname{stdDev}P":return"\\operatorname{stdDevP}";case"\\operatorname{var}iance":return"\\operatorname{variance}";default:return""}})}function Ole(r){return r.columns?{...r,columns:r.columns.map(Rle)}:r}function Rle(r){let{latex:e,values:t}=r,o={...r};return e&&(o.latex=GC(e),o.latex=GF(o.latex)),t&&(o.values=t.map(i=>i?GC(i):"")),o}function IF(r){if(r.version!==7)throw new Error(`Unexpected version: ${r.version}`);let e=r.expressions.list.map(t=>{if(t.type==="image"){let o={...t,opacity:""};t.hasOwnProperty("stringOpacity")?o.opacity=t.stringOpacity:t.hasOwnProperty("opacity")?o.opacity=t.opacity+"":delete o.opacity,t.clickableInfo&&(o.clickableInfo=G$(t.clickableInfo)),delete o.stringOpacity;for(let i in t)if(i==="x"||i==="y"||i==="width"||i==="height"){let n=t[i];n&&(o[i]=GC(n))}return o}else if(t.type==="expression"){let o={...t,fillOpacity:"",lineStyle:"SOLID"};if(t.lineStyle==="SINGLE_PIXEL"?o.lineWidth="1":t.hasOwnProperty("lineStyle")?o.lineStyle=t.lineStyle:delete o.lineStyle,o.hasOwnProperty("lineWidth")||(o.lineWidth=""),o.hasOwnProperty("lineOpacity")||(o.lineOpacity=""),o.hasOwnProperty("pointOpacity")||(o.pointOpacity=""),o.hasOwnProperty("pointSize")||(o.pointSize=""),o.hasOwnProperty("colorLatex")||(o.colorLatex=""),typeof t.latex=="string"&&(o.latex=GC(t.latex)),t.latex&&(o.latex=GC(t.latex)),t.hasOwnProperty("stringFillOpacity")?o.fillOpacity=t.stringFillOpacity:t.hasOwnProperty("fillOpacity")?o.fillOpacity=t.fillOpacity+"":delete o.fillOpacity,o.slider&&t.slider&&t.slider.newLoopMode&&(o.slider=__dcg_shared_module_exports__['i'](o.slider),o.slider.loopMode=t.slider.newLoopMode,delete o.slider.newLoopMode),o.residualVariable&&(o.residualVariable=GF(o.residualVariable)),o.regressionParameters){o.regressionParameters={};for(let i in t.regressionParameters){let n=GF(i),a=t.regressionParameters[i];o.regressionParameters[n]=a}}return t.clickableInfo&&(o.clickableInfo=G$(t.clickableInfo)),o}else if(t.type==="table")return Ole(t);return t});return{version:8,randomSeed:r.randomSeed||eu(),graph:r.graph,expressions:{list:e}}}function Fle(r,e,t){if(r.verticalLabel)switch(delete e.verticalLabel,t?e.labelAngle="90":e.labelAngle="\\frac{\\pi}{2}",r.labelOrientation){case"above":e.labelOrientation="right";break;case"below":e.labelOrientation="left";break;case"left":e.labelOrientation="above";break;case"right":e.labelOrientation="below";break}r.extendedLabelOrientation&&(e.labelOrientation=r.extendedLabelOrientation,delete e.extendedLabelOrientation)}function Nle(r,e){if(r.vizProps)switch(r.vizProps.dotplotSize){case"small":e.pointSize="9";break;case"large":e.pointSize="20";break}if(r.vizProps){let t={...r.vizProps};delete t.dotplotSize,Object.keys(t).length?e.vizProps=t:delete e.vizProps}}function MF(r){return r.filter(({assignment:e,expression:t})=>!!e&&!!t)}function AF(r){return r.map(({assignment:e,expression:t})=>`${e}\\to ${t}`).join(",")||""}function VF(r){let e=JSON.stringify(r),t=/_(\d)|_\{(\d+)\}/g,o,i={};for(;(o=t.exec(e))!==null;){let n=o[1]!==void 0?o[1]:o[2];i[n]=!0}return i}function LF(r,e){for(let t=e+1;;t++)if(!r[t])return t}function I$(r){let e=JSON.stringify(r),t=/"(\d+)"/g,o,i={};for(;(o=t.exec(e))!==null;){let n=o[1]!==void 0?o[1]:o[2];i[n]=!0}return i}function M$(r,e){for(let t=e+1;;t++)if(!r[t])return t}function Ble(r){if(/^\d+$/.test(r)){let e=parseInt(r,10);return e===0?"\\infty":""+Math.round(1e3/e)}else return`\\frac{1000}{${r}}`}function Ule(r,e){let t={handlerLatex:r,playing:!0,open:!0};return e!==void 0&&(t.minStepLatex=Ble(e)),t}function PF(r){if(r.version!==8)throw new Error(`Unexpected version: ${r.version}`);let e=!1;r.graph&&r.graph.degreeMode&&(e=!0);let t=r.expressions.ticker||zx,o=0,i,n=0,a,s=[];for(let l of r.expressions.list)switch(l.type){case"expression":{let c={...l};Fle(l,c,e),Nle(l,c);let d;if(l.clickableInfo&&l.clickableInfo.rules){let{rules:p,...u}=l.clickableInfo,h=u,m=MF(p),y=AF(m);if(m.length>1){i||(i=VF(r)),o=LF(i,o),a||(a=I$(r)),n=M$(a,n);let w=`A_{${o}}`;h.latex=w,d={type:"expression",id:""+n,latex:`${w}=${y}`},l.folderId!==void 0&&(d.folderId=l.folderId)}else h.latex=y;c.clickableInfo=h}c.clickableInfo&&c.clickableInfo.enabled&&c.hidden&&(c.clickableInfo.enabled=!1),s.push(c),d&&s.push(d);break}case"image":{if(l.clickableInfo&&l.clickableInfo.rules){let c={...l},{rules:d,...p}=l.clickableInfo,u=p,h=MF(d),m=AF(h),y;if(h.length>1){i||(i=VF(r)),o=LF(i,o),a||(a=I$(r)),n=M$(a,n);let w=`A_{${o}}`;u.latex=w,y={type:"expression",id:""+n,latex:`${w}=${m}`},l.folderId!==void 0&&(y.folderId=l.folderId)}else u.latex=m;c.clickableInfo=u,s.push(c),y&&s.push(y)}else s.push(l);break}case"simulation":{let c;if(l.clickableInfo&&l.clickableInfo.rules){let p=MF(l.clickableInfo.rules);c=AF(p)}else c="";if(l.isPlaying&&c!==""){i||(i=VF(r)),o=LF(i,o);let p=`A_{${o}}`;c=`${p}=${c}`,t=Ule(p,l.fps)}let d={type:"expression",id:l.id,latex:c};l.folderId!==void 0&&(d.folderId=l.folderId),s.push(d);break}default:s.push(l);break}return{version:9,randomSeed:r.randomSeed||eu(),graph:r.graph,expressions:{list:s,ticker:t}}}function A$(r){r.clickableInfo&&(r.description===void 0&&r.clickableInfo.description!==void 0&&(r.description=r.clickableInfo.description),delete r.clickableInfo.description,Object.keys(r.clickableInfo).length===0&&delete r.clickableInfo)}function qle(r){switch(r.labelSize){case"small":r.labelSize="0.85";break;case"medium":r.labelSize="1";break;case"large":r.labelSize="1.35";break;default:break}}function zle(r){let e=0,t=/^[0-9]+$/;for(let o=r.length-1;o>=0;o--){let i=r[o],n=i.id;if(t.test(n)){let a=parseInt(n,10);a>e&&(e=a)}if(i.type==="table"&&i.columns){for(let a=i.columns.length-1;a>=0;a--)if(n=i.columns[a].id,!!n&&t.test(n)){let s=parseInt(n,10);s>e&&(e=s)}}}return e}function OF(r){if(r.version!==9)throw new Error(`Unexpected version: ${r.version}`);let e=[],t={},o=zle(r.expressions.list);for(let n of r.expressions.list)switch(n.type){case"expression":{let l={...n};A$(l),qle(l),e.push(l);break}case"image":{let l={...n};A$(l);let c=l.description;(c===void 0||c==="")&&l.draggable&&l.center!==void 0&&l.center!==""&&(t[l.center]===void 0?t[l.center]=[l]:t[l.center].push(l)),e.push(l);break}case"table":let a={...n};if(!a.columns||!ol(a.columns[0].latex)){e.push(a);break}let s=a.columns[0].latex;for(let l=1;l<a.columns.length;l++){let c=a.columns[l];if(!c.lines||!kd(c.latex,s))continue;delete c.lines,o++;let d={type:"expression",latex:"y="+D_(c.latex,s,"x"),id:`${o}`};c.color&&(d.color=c.color),c.lineStyle&&(d.lineStyle=c.lineStyle),c.lineWidth&&(d.lineWidth=c.lineWidth),c.lineOpacity&&(d.lineOpacity=c.lineOpacity),e.push(d)}e.push(a);break;default:e.push(n);break}for(let n of e){if(n.type!=="expression"||n.latex===void 0||n.latex===""||n.latex.indexOf("=")===-1||n.dragMode===void 0||n.dragMode==="NONE"||n.label===void 0||n.label==="")continue;let a=n.latex.slice(0,n.latex.indexOf("=")),s=t[a];if(s!==void 0)for(let l of s)l.description=n.label}return{...r,version:10,expressions:{...r.expressions,list:e}}}function Hle(r){let e=/[ \\]*=[ \\]*\\operatorname\{(dilation|reflection|rotation|translation)\}\\left\(/g;return r.type!=="expression"||!r.latex||(r.latex=r.latex.replace(e,(t,o)=>{switch(o){case"dilation":return"\\left(x\\right)=\\operatorname{dilate}\\left(x,";case"rotation":return"\\left(x\\right)=\\operatorname{rotate}\\left(x,";case"reflection":return"\\left(x\\right)=\\operatorname{reflect}\\left(x,";case"translation":return"\\left(x\\right)=\\operatorname{translate}\\left(x,";default:return""}})),r}function Kle(r,e){var t;if(r.type==="image"&&r.folderId&&!r.draggable&&!((t=r.clickableInfo)!=null&&t.enabled)&&e.has(r.folderId)&&r.disableGraphInteractions!==!1){let o={...r};return o.disableGraphInteractions=!0,o}else return r}function Wle(r){var a;if(r.type!=="expression")return r;let e={...r},t=(a=(r.latex||"").split("=")[0])==null?void 0:a.trim(),o=r.parametricDomain3Du,i=r.parametricDomain3Dv,n=r.parametricDomain;return t==="r"||(t==="z"?(o&&(e.parametricDomain3Dr={...o}),i&&(e.polarDomain={...i})):t==="\\rho"?(o&&(e.polarDomain={...o}),i&&(e.parametricDomain3Dphi={...i})):r.polarDomain||n&&(e.parametricDomain3Du={...n},e.parametricDomain3Dv={...n})),e}function RF(r){if(r.version!==10)throw new Error(`Unexpected version: ${r.version}`);let e={...r.graph};delete e.projectorMode;let t={...r.expressions},o=[],i=new Set;for(let n of t.list)n.type==="folder"&&n.collapsed&&i.add(n.id);for(let n of t.list)switch(n.type){case"expression":{if((e==null?void 0:e.product)==="geometry-calculator"){let a={...n};Hle(a),o.push(a)}else if((e==null?void 0:e.product)==="graphing-3d"){let a=Wle(n);o.push(a)}else o.push(n);break}case"image":{o.push(Kle(n,i));break}default:o.push(n)}return t.list=o,{...r,version:11,graph:e,expressions:t}}function FF(r){var i,n;if(r.version!==11)throw new Error(`Unexpected version: ${r.version}`);let e=(i=r.includeFunctionParametersInRandomSeed)!=null?i:!1,t={...r.expressions},o=[];for(let a of t.list)switch(a.type){case"expression":{if(((n=r.graph)==null?void 0:n.product)==="graphing-3d"&&!r.doNotMigrate3dLineWidthZero){let s=$le(a);o.push(s)}else o.push(a);break}default:o.push(a)}return t.list=o,{...r,expressions:t,includeFunctionParametersInRandomSeed:e,version:12}}function $le(r){return r.type!=="expression"||r.lineWidth!=="0"?r:{...r,lineWidth:"0.1"}}function V$(r){var o,i;let e=(o=r.includeFunctionParametersInRandomSeed)!=null?o:!0,t=((i=r.graph)==null?void 0:i.product)==="graphing-3d"?{...r,includeFunctionParametersInRandomSeed:e,doNotMigrate3dLineWidthZero:!0,version:11}:{...r,includeFunctionParametersInRandomSeed:e,version:11};return t.includeFunctionParametersInRandomSeed===!1&&delete t.includeFunctionParametersInRandomSeed,t}var NF=[x$,w$,C$,S$,D$,k$,T$,TF,IF,PF,OF,RF,FF];var Od=12;function vp(r){if(r.version>Od)return typeof console!="undefined"&&console.warn&&console.warn("Loading saved state with version "+r.version+" but last known version is "+Od+". States saved in a newer version of the calculator may not load correctly in an older version of the calculator."),RG(r);if(r.hasOwnProperty("version")&&!NF[r.version])return typeof console!="undefined"&&console.warn&&console.warn("State has invalid version "+r.version+". If a version is present, it should be a non-negative integer less than or equal to "+Od+"."),RG(r);for(r.hasOwnProperty("version")||(r=NF[0](r));r.version<Od;)r=NF[r.version+1](r);return RG(r)}function jle(r){return V$(r)}function L$(r){return jle(vp(r))}function P$(r){let e=vp(r),t={},o=e.graph.degreeMode,i=e.randomSeed,n=e.graph.product==="geometry-calculator"?"geometry":e.graph.product==="graphing-3d"?"graphing_3d":"graphing";function a(s){switch(s.type){case void 0:case"expression":{let c=__dcg_shared_module_exports__['Hb'](__dcg_shared_module_exports__['Db'](s,{is3d:!1,defaultLogModeRegressions:!1}));t[c.id]=c}break;case"table":{let c=M_(I_(s));t[c.id]=c}break;case"image":{let c=Z_(Q_(s));t[c.id]=c;break}case"folder":case"text":break;default:return s}}for(let s of e.expressions.list)a(s);if(e.version>=10&&e.expressions.ticker){let s="dcg_ticker_guid_internal",l={...dT(e.expressions.ticker),id:s};t[s]=cT(l)}return{setExpression(s){a(s)},getChangeSet(){return{statements:t,isCompleteState:!0,degreeMode:o,globalRandomSeed:i,evaluationMode:n}}}}function R$(r,e){let t=__dcg_shared_module_exports__['i'](r);return BG(t,e)}function BG(r,e){for(let t of __dcg_shared_module_exports__['G'](e)){let o=e[t];Xle(o)?r[t]=o.s:Jle(o)?delete r[t]:Qle(o)?r[t]=Yle(r[t],o.l):Zle(o)&&(r[t]=BG(r[t],o.e))}return r}function Yle(r,e){let t=[];for(let i=0;i<r.length;i++){let n=e[i];n&&n.a&&t.push(...O$(r,n.a)),n&&n.e?t.push(BG(r[i],n.e)):(!n||!n.d)&&t.push(r[i])}let o=e[r.length];return o&&o.a&&t.push(...O$(r,o.a)),t}function O$(r,e){let t=[];for(let o of e)if(ece(o))t.push(o.s);else if(tce(o)){let i=r[o.m.f];o.m.e?t.push(BG(i,o.m.e)):t.push(i)}return t}function Xle(r){return r.hasOwnProperty("s")}function Jle(r){return r.hasOwnProperty("d")}function Qle(r){return r.hasOwnProperty("l")}function Zle(r){return r.hasOwnProperty("e")}function ece(r){return r.hasOwnProperty("s")}function tce(r){return r.hasOwnProperty("m")}function F$(r){let e=r.length,t=new Array(e),o=new Array(e+1),i=0;for(let s=0;s<e;s++){let l;if(r[o[i]]<r[s])l=i+1;else{let c=1,d=i-1;for(;c<=d;){let p=Math.ceil((c+d)/2);r[o[p]]<r[s]?c=p+1:d=p-1}l=c}t[s]=o[l-1],o[l]=s,l>i&&(i=l)}let n=new Array(i),a=o[i];for(let s=i-1;s>=0;s--)n[s]=r[a],a=t[a];return n}function B$(r,e){return UG(r,e,0)}function UG(r,e,t){let o={};for(let i in r){if(!r.hasOwnProperty(i))continue;if(!e.hasOwnProperty(i)){o[i]={d:1};continue}let n=r[i],a=e[i],s=rce(n,a,t,i);s&&(o[i]=s)}for(let i in e)e.hasOwnProperty(i)&&!r.hasOwnProperty(i)&&(o[i]={s:e[i]});return o}function rce(r,e,t,o){if(__dcg_shared_module_exports__['L'](r)&&__dcg_shared_module_exports__['L'](e)){if(t===1&&o==="list"||t===2&&o==="columns")return ice(r,e);if(!__dcg_shared_module_exports__['J'](r,e))return{s:e}}else if(__dcg_shared_module_exports__['M'](r)&&__dcg_shared_module_exports__['M'](e)){let i=UG(r,e,oce(t,o));if(!__dcg_shared_module_exports__['K'](i))return{e:i}}else if(!__dcg_shared_module_exports__['J'](r,e))return{s:e}}function oce(r,e){return r===0&&e==="expressions"?1:3}function ice(r,e){let t={},o={};for(let s=0;s<r.length;s++){if(o[r[s].id]!==void 0)return{s:e};o[r[s].id]=s}let i={};for(let s=0;s<e.length;s++){if(i[e[s].id]!==void 0)return{s:e};i[e[s].id]=s}let n=nce(r,e,o),a=0;for(let s=0;s<r.length;s++){let l=r[s];if(!n[l.id])t[s]={d:1};else{let c=i[l.id],d=e[c],p={};if(a!==c&&(p.a=e.slice(a,c).map(u=>N$(r,o,u))),!__dcg_shared_module_exports__['J'](l,d)){let u=l.type==="table"&&d.type==="table";p.e=UG(l,d,u?2:3)}__dcg_shared_module_exports__['K'](p)||(t[s]=p),a=c+1}}if(a<e.length&&(t[r.length]={a:e.slice(a,e.length).map(s=>N$(r,o,s))}),!__dcg_shared_module_exports__['K'](t))return{l:t}}function N$(r,e,t){if(e[t.id]){let o=r[e[t.id]],i={f:e[t.id]};return __dcg_shared_module_exports__['J'](o,t)||(i.e=UG(o,t,3)),{m:i}}return{s:t}}function nce(r,e,t){let o={},i=e.filter(a=>t[a.id]!==void 0).map(a=>t[a.id]),n=F$(i);for(let a of n)o[r[a].id]=!0;return o}function U$(r){return r.location==="expression"||r.location==="object"?`${r.location}:${r.id}:${r.path}`:`${r.location}:${r.path}`}function BF(r){let e=()=>new Error(`Invalid key: ${r}`),t=r.split(":"),o=t[0];if(!o||o!="expression"&&o!="settings"&&o!="object")throw e();if(o=="settings"){if(t.length!=2)throw e();return{location:o,path:t[1]}}if(t.length!=3)throw e();return{location:o,id:t[1],path:t[2]}}function qG(r,e,t){if(!r)return;let o=e.split("."),i=r;for(let n=0;n<o.length;n++){let a=o[n];if(!i[a])break;n==o.length-1&&typeof i[a]=="string"?i[a]=t:i=i[a]}}function UF(r,e){return(t,o,i,n)=>{if(t){let a=U$({...e,path:o});r[a]={value:t,type:i,context:n}}}}function ace(r){var o,i;let e={},t=UF(e,{location:"expression",id:r.id});switch(r.type){case"expression":t(r.label,"label","interpolated-string","expression-list-expression-label"),t(r.description,"description","string","expression-list-expression-clickable-description");break;case"image":t(r.image_url,"image_url","image","expression-list-image-url"),t(r.description,"description","string","expression-list-image-clickable-description"),t((o=r.clickableInfo)==null?void 0:o.hoveredImage,"clickableInfo.hoveredImage","image","expression-list-image-clickable-hovered"),t((i=r.clickableInfo)==null?void 0:i.depressedImage,"clickableInfo.depressedImage","image","expression-list-image-clickable-depressed");break;case"text":t(r.text,"text","string","expression-list-note-text");break;case"folder":t(r.title,"title","string","expression-list-folder-title");break}return e}function sce(r){let e={},t=UF(e,{location:"settings"});return t(r.graph.xAxisLabel,"xAxisLabel","string","settings-xaxis-label"),t(r.graph.yAxisLabel,"yAxisLabel","string","settings-yaxis-label"),e}function lce(r){let e={},t=UF(e,{location:"object",id:r.id});return t(r.label,"label","string","geometry-object-label"),r.type==="image"&&t(r.url,"url","image","geometry-object-image-url"),e}function q$(r){let e={};if(r.type=="graph"){let t=r.graphState.expressions.list;for(let i of t){let n=ace(i);for(let a in n)e[a]=n[a]}let o=sce(r.graphState);for(let i in o)e[i]=o[i]}else{let t=r.geometryState.objects;for(let o in t){let i=lce(t[o]);for(let n in i)e[n]=i[n]}}return e}function z$(r,e,t){var i;let o=__dcg_shared_module_exports__['i'](r);if(t==="graph"){let n={},a=(i=o.expressions)==null?void 0:i.list,s=Array.isArray(a)?a:[];for(let l of s)n[l.id]=l;for(let l in e){let c=BF(l);c.location=="expression"?qG(n[c.id],c.path,e[l].value):qG(o.graph,c.path,e[l].value)}}else if(o.objects)for(let n in e){let a=BF(n);a.location=="object"&&qG(o.objects[a.id],a.path,e[n].value)}return o}function zG(r,e){switch(r.type){case"Mul":case"DotMul":case"CrossMul":case"Div":case"Prime":case"Call":case"ImplicitCall":case"Dot":case"Pipes":case"Sqrt":case"Nthroot":case"Frac":case"Derivative":case"Integral":case"EmptyIntegral":case"Sum":case"Product":case"Piecewise":case"Paren":case"Juxt":case"Superscript":case"Bang":case"Index":case"Comparator":case"ComparatorChain":case"Tilde":case"Pos":case"Neg":case"Add":case"Sub":case"List":case"Seq":case"Colon":case"Ellipsis":case"PercentOf":case"RightArrow":case"For":case"With":{let o=0;for(let i of r.args)o+=zG(i,e);return o}case"Decimal":return e===void 0||parseFloat(r.val)===e?1:0;case"MixedNumber":{if(e===void 0)return 3;let o=0;return parseFloat(r.whole)===e&&(o+=1),parseFloat(r.num)===e&&(o+=1),parseFloat(r.den)===e&&(o+=1),o}case"Letter":case"EmptyPiecewise":case"Cmd":case"EmptyRangeEnd":return 0;case"Subscript":return zG(r.args[0],e);default:throw`Unexpected surface node ${r.type}.`}}var cce={version:Od,randomSeed:"",graph:{viewport:{xmin:-10,ymin:-13.25,xmax:10,ymax:13.25}},expressions:{list:[{id:"1",type:"expression"}]}},Eb=cce;function dce(r){return{...r,version:"0"}}var H$=dce;var pce={centerX:0,centerY:0,size:15},uce={scale:1,unit:"",visible:!1,showLegend:!1};function hce(r){let e=r.objects||{},t=__dcg_shared_module_exports__['i'](e);for(let o in t){let i=t[o];i.label&&(i.showLabel=!0)}return{version:"1",objects:t,viewport:r.viewport||pce,customTools:r.customTools||{},grid:r.grid||uce}}var K$=hce;function gce(r){return(r.type==="point"||r.type==="glider")&&!r.draggable}function mce(r){let e=r.objects||{},t=__dcg_shared_module_exports__['i'](e),o=__dcg_shared_module_exports__['i'](r.grid);for(let i in t){let n=t[i];gce(n)&&(n.draggable=!0),n.type==="angle"&&n.showLabel&&!n.label&&(n.label="{angle}"),n.type==="segment"&&n.showLabel&&!n.label&&(n.label="{length}")}return o.unit="",o.scale=1,{version:"2",objects:t,viewport:r.viewport,customTools:r.customTools||{},grid:o}}var W$=mce;function qF(r){return r&&(r.type==="circle"||r.type==="compass")}function fce(r){let e=__dcg_shared_module_exports__['i'](r.objects||{});for(let t in e){let o=e[t];if(o.type==="point")o.y=-o.y;else if(o.type==="glider"){let i=e[o.parents.host];qF(i)&&(o.t=-o.t)}else if(o.type==="intersection"){let i=e[o.parents.host1],n=e[o.parents.host2];qF(i)&&qF(n)&&(o.negRoot=!o.negRoot)}}return{version:"3",objects:e,viewport:r.viewport,customTools:r.customTools||{},graphSettings:{showGrid:!!(r.grid||{}).visible,showAxes:!1,showAxisNumbers:!1}}}var $$=fce;function bce(r){let e=__dcg_shared_module_exports__['i'](r.objects||{});for(let t in e){let o=e[t];o.draggable===!1&&(o.locked=!0),delete o.draggable}return{...r,version:"4",objects:e}}var j$=bce;var HG=[H$,K$,W$,$$,j$],yce="4";function zF(r){let e=parseInt(yce,10),t=parseInt(r.version||"0",10);for(t>e&&typeof console!="undefined"&&console.warn&&console.warn(`Loading saved state with version ${t}, but last known version is ${e}. States saved in a newer version of the geometry tool may not load correctly in older versions of the tool.`),HG[t]||typeof console!="undefined"&&console.warn&&console.warn(`State has invalid version: ${t}. If a version is present, it should be a non-negative integer less than or equal to ${e}.`),t===0&&(r=HG[0](r));t<e;)t+=1,HG[t]&&(r=HG[t](r));return r}var xce=!1;function Db(r,e){let t=e[r];return t.type==="transformed-object"?Db(t.parents.object,e):t.type}function Y$(r){switch(r){case"circle":case"compass":case"arc":return!0}return!1}function wce(r,e,t){let o=Db(e,t);if(o==="circle"||o==="compass"){let i=r/(2*Math.PI);return i<0?i+1:i}return r}function X$(r){switch(r){case"scaled-rotation":case"vector":return!0}return!1}function vce(r){switch(r){case"point":case"midpoint":case"glider":case"intersection":case"polygon":return"P";case"line":case"segment":case"ray":case"vector":case"parallel":case"perpendicular":return"L";case"circle":case"compass":return"C";case"arc":case"angle":return"A";case"image":return"I";case"dilation":case"rotation":case"translation":case"reflection":case"scaled-rotation":return"T";case"transformed-object":return"T";default:return r}}function zh(r){let e=!xce,t=zF(r),o={},i={},n=v=>{if(i.hasOwnProperty(v))return i[v];let E=Db(v,t.objects);if(e&&!X$(E)){let P=o.token||1;o.token=P+1;let O="\\token{"+P+"}";return i[v]=O,O}let _=vce(E),T=o[_]||1;o[_]=T+1;let I=_+"_{"+T+"}";return i[v]=I,I};function a(v){let E=o[v]||1;return o[v]=E+1,v+"_{"+E+"}"}let s=(v,E,_)=>n(v)+"=\\operatorname{"+E+"}\\left("+_.map(n).join(",")+"\\right)",l=v=>`\\operatorname{segment}\\left(${v}.\\operatorname{start},${v}.\\operatorname{end}\\right)`,{centerX:c,centerY:d,size:p}=t.viewport;p*=1.25;let u=1,h=p/(1+u),m=h*u,y={version:11,randomSeed:"",expressions:{list:[]},graph:{product:"geometry-calculator",viewport:{xmin:c-h,xmax:c+h,ymin:d-m,ymax:d+m},showGrid:!1,showXAxis:!1,showYAxis:!1,squareAxes:!0,degreeMode:!0}};t.graphSettings.showGrid&&(y.graph.showGrid=!0,y.graph.xAxisMinorSubdivisions=1,y.graph.yAxisMinorSubdivisions=1,y.graph.xAxisStep=1,y.graph.yAxisStep=1);let w=y.expressions.list,S=[],C=[];for(let v in t.objects){let E=t.objects[v],_=Db(E.id,t.objects),T={id:E.id,type:"expression",color:E.color,hidden:!!E.hidden};if(e&&!X$(_)&&(T.folderId=__dcg_shared_module_exports__['xb']),E.locked&&(T.dragMode="NONE"),!E.hidden&&E.label&&E.showLabel){if(T.label=E.label,T.showLabel=!0,_==="segment"&&E.label.indexOf("{length}")!==-1)if(E.label==="{length}")T.label="";else{let I=a("l"),P=I+"=\\operatorname{round}\\left(\\operatorname{length}\\left("+n(E.id)+"\\right),2\\right)";C.push({id:"len-"+T.id,type:"expression",latex:P}),T.label=T.label.replace(/\{length\}/g,"${"+I+"}")}if(_==="angle"&&E.label.indexOf("{angle}")!==-1)if(E.label==="{angle}")T.label="";else{let I=a("a"),P=I+"=\\operatorname{round}\\left("+n(E.id)+"\\right)";C.push({id:"angle-"+T.id,type:"expression",latex:P}),T.label=T.label.replace(/\{angle}/g,"${"+I+"}\xB0")}if(_==="polygon"&&E.label.indexOf("{area}")!==-1)if(E.label==="{area}")T.label="";else{let I=a("a"),P=I+"=\\operatorname{round}\\left(\\operatorname{area}\\left("+n(E.id)+"\\right),2\\right)";C.push({id:"area-"+T.id,type:"expression",latex:P}),T.label=T.label.replace(/\{area\}/g,"${"+I+"}")}if(_==="polygon"&&E.label.indexOf("{perimeter}")!==-1){let I=a("p"),P=I+"=\\operatorname{round}\\left(\\operatorname{perimeter}\\left("+n(E.id)+"\\right),2\\right)";C.push({id:"perim-"+T.id,type:"expression",latex:P}),T.label=T.label.replace(/\{perimeter\}/g,"${"+I+"}")}}switch(E.type){case"point":{let A=E.x===null?0:E.x,U=E.y===null?0:E.y;T.latex=n(E.id)+"=\\left("+__dcg_shared_module_exports__['ke'](A)+","+__dcg_shared_module_exports__['ke'](U)+"\\right)";break}case"glider":{let A=Db(E.parents.host,t.objects),U=n(E.parents.host);A==="vector"&&(U=l(U)),T.latex=n(E.id)+"=\\operatorname{glider}\\left("+U+","+__dcg_shared_module_exports__['ke'](wce(E.t,E.parents.host,t.objects))+"\\right)";break}case"intersection":let I=Db(E.parents.host1,t.objects),P=Db(E.parents.host2,t.objects),O=n(E.parents.host1),W=n(E.parents.host2);I==="vector"&&(O=l(O)),P==="vector"&&(W=l(W));let X=E.negRoot;(Y$(I)&&!Y$(P)||P==="arc")&&(X=!X);let x=X?[O,W]:[W,O];T.latex=n(v)+"=\\operatorname{intersection}\\left("+x.join(",")+"\\right)";break;case"midpoint":T.latex=s(E.id,E.type,[E.parents.straight]);break;case"circle":T.latex=s(E.id,E.type,[E.parents.point1,E.parents.point2]);break;case"arc":T.latex=s(E.id,E.type,[E.parents.point1,E.parents.point2,E.parents.point3]);break;case"compass":T.latex=s(E.id,"circle",[E.parents.center,E.parents.straight]);break;case"line":case"segment":case"ray":case"vector":T.latex=s(E.id,E.type,[E.parents.point1,E.parents.point2]);break;case"parallel":case"perpendicular":T.latex=s(E.id,E.type,[E.parents.straight,E.parents.point]);break;case"polygon":T.latex=s(E.id,E.type,E.parents.points);break;case"angle":T.latex=s(E.id,E.type,[E.parents.point1,E.parents.point2,E.parents.point3]);break;case"transformed-object":T.latex=n(E.id)+"="+n(E.parents.transformation)+"\\left("+n(E.parents.object)+"\\right)";break;case"dilation":T.latex=n(E.id)+"\\left(x\\right)=\\operatorname{dilate}\\left(x,"+n(E.parents.center)+","+(E.scaleFactor||"0/0")+"\\right)";break;case"reflection":T.latex=n(E.id)+"\\left(x\\right)=\\operatorname{reflect}\\left(x,"+n(E.parents.straight)+"\\right)";break;case"translation":T.latex=n(E.id)+"\\left(x\\right)=\\operatorname{translate}\\left(x,"+n(E.parents.from)+","+n(E.parents.to)+"\\right)";break;case"rotation":T.latex=n(E.id)+"\\left(x\\right)=\\operatorname{rotate}\\left(x,"+n(E.parents.center)+","+(E.angle||"0/0")+"\\right)";break;case"scaled-rotation":let L=n(E.parents.center),R=n(E.parents.from),N=n(E.parents.to);T.latex=n(E.id)+`\\left(x\\right)=\\operatorname{rotate}\\left(\\operatorname{dilate}\\left(x,${L},\\frac{\\left|${N}-${L}\\right|}{\\left|${R}-${L}\\right|}\\right),${L},\\operatorname{directedangle}\\left(${R},${L},${N}\\right)\\right)`;break;case"image":break;default:return E}T.latex&&(T.folderId===__dcg_shared_module_exports__['xb']?S.push(T):C.push(T))}return w.push({type:"folder",id:__dcg_shared_module_exports__['xb'],title:"geometry",secret:!0}),w.push.apply(w,S),w.push.apply(w,C),y}function J$(r){return r==="<="?"\\le ":r===">="?"\\ge ":r}function To(r){switch(r.type){case"Comparator":return os(r.args,J$(r.symbol));case"ComparatorChain":{let n="";for(let a=0;a<r.symbols.length;a++)n+=To(r.args[a])+J$(r.symbols[a]);return n+=To(r.args[r.args.length-1]),n}case"Tilde":return os(r.args,"~");case"Pos":return"+"+To(r.args[0]);case"Neg":return"-"+To(r.args[0]);case"Add":return os(r.args,"+");case"Sub":return os(r.args,"-");case"Mul":return os(r.args,"*");case"DotMul":return os(r.args,"\\cdot ");case"CrossMul":return os(r.args,"\\times ");case"Div":return os(r.args,"/");case"Bang":return To(r.args[0])+"!";case"Call":let e=KF(r.args);return e?e.script+"\\left("+e.arg+"\\right)":To(r.args[0])+"\\left("+To(r.args[1])+"\\right)";case"Paren":return"\\left("+To(r.args[0])+"\\right)";case"List":return"\\left["+r.args.map(To).join(",")+"\\right]";case"Pipes":return"\\left|"+To(r.args[0])+"\\right|";case"Index":return To(r.args[0])+"\\left["+To(r.args[1])+"\\right]";case"Subscript":return os(r.args,"_",!0);case"Superscript":return os(r.args,"^",!0);case"Prime":if(r.args[0].type==="Call"){let n=KF(r.args[0].args);return n?n.script+HF(r.nprimes)+"\\left("+n.arg+"\\right)":To(r.args[0].args[0])+HF(r.nprimes)+"\\left("+To(r.args[0].args[1])+"\\right)"}return To(r.args[0])+HF(r.nprimes);case"Seq":return r.args.map(To).join(",");case"Sqrt":return"\\sqrt"+IC(To(r.args[0]));case"Nthroot":return"\\sqrt["+To(r.args[0])+"]"+IC(To(r.args[1]));case"Frac":return"\\frac{"+To(r.args[0])+"}{"+To(r.args[1])+"}";case"Derivative":return"\\frac{d}{d"+To(r.args[0])+"}"+To(r.args[1]);case"Integral":case"EmptyIntegral":if(r.args[0].type!=="Cmd")throw new Error("Expected first argument of an integral to be the variable");let t="d"+r.args[0].val;if(r.args.length===3)return MC("int",r.args[1],r.args[2])+t;let o=To(r.args[3]);return MC("int",r.args[1],r.args[2])+o+t;case"Sum":return Q$(r.args,"sum");case"Product":return Q$(r.args,"prod");case"Piecewise":return"\\{"+To(r.args[0])+"\\}";case"EmptyPiecewise":return"\\{\\}";case"Colon":return os(r.args,":");case"Ellipsis":return os(r.args,"...");case"For":return os(r.args,"\\for ");case"With":return os(r.args,"\\with ");case"Dot":return os(r.args,".");case"PercentOf":return os(r.args,"\\% \\of ");case"RightArrow":return os(r.args,"->");case"Juxt":return os(r.args,r.args[0].type==="Cmd"?" ":"");case"ImplicitCall":{let n=KF(r.args);return n?n.script+n.arg:os(r.args,"")}case"MixedNumber":return r.whole+"\\frac{"+r.num+"}{"+r.den+"}";case"Letter":case"Decimal":case"Alphanumeric":return r.val;case"Cmd":return"\\"+r.val;case"EmptyRangeEnd":return"EmptyRangeEnd";case"Err":throw r.error;default:return r}}function IC(r){return r.length>1?"{"+r+"}":r}function MC(r,e,t){let o=IC(To(e));if(t){let i=IC(To(t));return`\\${r}_${o}^${i}`}return`\\${r}_${o}`}function os(r,e,t=!1){let o=To(r[0]),i=t?IC(To(r[1])):To(r[1]);return o+e+i}function Q$(r,e){let t=To(r[0]);return MC(e,r[1],r[2])+t}function HF(r){let e="";for(let t=0;t<r;t++)e+="'";return e}function Z$(r){return r.type==="Cmd"&&r.val==="logbase"}function KF(r){let e=r[1],t;if(r[1].type==="Seq"&&r[1].args.length===2&&(e=r[1].args[1],t=r[1].args[0]),r[0].type==="Superscript"&&Z$(r[0].args[0]))return{script:MC("log",e,r[0].args[1]),arg:t?To(t):""};if(Z$(r[0]))return{script:MC("log",e),arg:t?To(t):""}}function ej(r){let e=$F.parse(r.latex);if(e.type=="Err")return;let t=Va(e);for(;t.type==="Paren";)t=t.args[0];return Gu(t)?{latex:r.latex}:{latex:To(t)}}function Cce(r){return r.isPseudoSurfaceNode}function Gu(r){switch(r.type){case"Letter":case"Decimal":case"Cmd":return r.val==="0";case"Paren":return Gu(r.args[0]);default:return!1}}function Dm(r){switch(r.type){case"Letter":case"Decimal":case"Cmd":return r.val==="1";case"Paren":return Dm(r.args[0]);default:return!1}}function tj(r){return r.type==="Neg"?Dm(r.args[0]):r.type==="Paren"?tj(r.args[0]):!1}function KG(r){return{isPseudoSurfaceNode:!0,type:"Decimal",span:r,val:"0"}}function WF(r,e){return{isPseudoSurfaceNode:!0,type:"Neg",span:e,args:[r]}}function Sce(r,e){return{isPseudoSurfaceNode:!0,type:"Paren",span:e,args:[r]}}function Dc(r,e){return{...r,span:e}}function Va(r,e){let t;switch(r.type){case"Add":{let n=Va(r.args[0]),a=Va(r.args[1]);if(Gu(n))return Dc(a,r.span);if(Gu(a))return Dc(n,r.span);let s;if(a.type==="Neg"?s=Va(a.args[0]):a.type==="Paren"&&a.args[0].type==="Neg"&&(s=Va(a.args[0].args[0])),s!==void 0)return{isPseudoSurfaceNode:!0,type:"Sub",span:r.span,args:[n,s]};t=[n,a];break}case"Sub":{let n=Va(r.args[0]),a=Va(r.args[1]);if(Gu(n))return WF(a,r.span);if(Gu(a))return Dc(n,r.span);let s;if(a.type==="Neg"?s=a.args[0]:a.type==="Paren"&&a.args[0].type==="Neg"&&(s=a.args[0].args[0]),s)return{isPseudoSurfaceNode:!0,type:"Add",span:r.span,args:[n,s]};t=[n,a];break}case"Mul":{let n=Va(r.args[0]),a=Va(r.args[1]);if(Dm(n))return Dc(a,r.span);if(Dm(a))return Dc(n,r.span);if(Gu(n)||Gu(a))return KG(r.span);t=[n,a];break}case"Juxt":{let n=Va(r.args[0],r),a=Va(r.args[1],r);if(Dm(n))return Dc(a,r.span);if(Dm(a))return Dc(n,r.span);if(tj(n))return WF(a,r.span);if(Gu(n)||Gu(a))return KG(r.span);if(n.type==="Neg"){let s={...r,type:"Juxt",isPseudoSurfaceNode:!0,args:[n.args[0],a]};return WF(s,r.span)}t=[n,a];break}case"Frac":case"Div":{let n=Va(r.args[0]),a=Va(r.args[1]);if(Dm(a))return Dc(n,r.span);t=[n,a];break}case"Superscript":let o=Va(r.args[0]),i=Va(r.args[1]);if(Dm(i))return Dc(o,r.span);(e==null?void 0:e.type)==="Juxt"&&e.args[0].type==="Decimal"&&o.type==="Decimal"&&(o=Sce(o,o.span)),t=[o,i];break;case"Paren":{let n=Va(r.args[0]);if((e==null?void 0:e.type)!=="Juxt"){if(__dcg_shared_module_exports__['md'](n))return Dc(n,r.span);let a="args"in n?n.args:void 0;if((!a||a.length<=1)&&n.type!=="Neg")return Dc(n,r.span)}t=[n];break}case"Pos":{let n=Va(r.args[0]);return Dc(n,r.span)}case"Neg":{let n=Va(r.args[0]),a="args"in n?n.args[0]:void 0;if(n.type==="Paren"&&a&&a.type==="Neg"&&a.args[0])return Dc(Va(a.args[0]),r.span);if(n.type==="Neg"&&a)return Dc(a,r.span);t=[n];break}case"Cmd":case"Letter":case"Decimal":case"MixedNumber":case"EmptyRangeEnd":case"EmptyPiecewise":case"ComparatorChain":return{...r,isPseudoSurfaceNode:!0};default:t=r.args.map(n=>Cce(n)?n:n.type==="Alphanumeric"?{...n,isPseudoSurfaceNode:!0}:Va(n))}return{...r,isPseudoSurfaceNode:!0,args:t}}function Ece(r,e){return r==null&&(r=""),__dcg_shared_module_exports__['sd'](r,e)}function Dce(r){if(r!=null)try{let e=__dcg_shared_module_exports__['rd'](r);return __dcg_shared_module_exports__['qd'](e)}catch(e){let t=e instanceof rj.Base?e.getInputSpan():void 0;t||(t=__dcg_shared_module_exports__['W'](r,0,r.length));let o={...__dcg_shared_module_exports__['pd'](),originalError:e};return __dcg_shared_module_exports__['od'](t,o)}}var kce={parse:Ece},$F={parse:Dce},_ce={countNumbers:zG},Tce=__dcg_shared_module_exports__['ve'],Gce=__dcg_shared_module_exports__['Wc'],Ice=__dcg_shared_module_exports__['kb'],rj=__dcg_shared_module_exports__['ad'],Mce={graphing:new __dcg_shared_module_exports__['ie']({enableGeometry:!1,enable3d:!1,scales:void 0,includeFunctionParametersInRandomSeed:!0,isComplexEnabled:!1,customRegressions:!0}),scientific:new __dcg_shared_module_exports__['qe']({singleExpression:!1}),fourFunction:new __dcg_shared_module_exports__['mc']({singleExpression:!1})},Ace=Eb,Vce=$w;var Yw=class{constructor(e,t){this.is3d=!0;this.color="#000000",this.showHighlight=!1,this.selected=!1,this.hoistToTop=!1,this.id=e,this.branches=t!==void 0?t:[]}updateFrom(e){e&&(this.showHighlight=e.showHighlight,this.hoistToTop=e.hoistToTop,this.selected=e.selected)}};function oj(r){return r.is3d}function ed(r,e){if(oj(e)||r.isGeoUIActive()&&r.getAllToolPreviewItems().filter(o=>o.id===e.id).length>0)return!1;for(let t of e.branches)if(Cp(t,r.getGraphSettings().config.audioTraceSimult))return!0;return!1}function Cp(r,e){if(r)switch(r.graphMode){case 8:case 5:case 6:return e&&r.segments.length>0;case 1:case 2:case 3:case 4:case 25:case 26:return r.segments.length>0;default:return!1}}function ij(r,e){for(let t=0;t<r.branches.length;t++)if(Cp(r.branches[t],e))return t;return 0}function AC(r,e,t){let o=0;for(let i=0;i<=e;i++)Cp(r.branches[i],t)&&(o+=1);return o}function nj(r){switch(r.graphMode){case 1:case 2:case 3:case 4:case 25:case 26:return!0;default:return!1}}function aj(r,e){switch(e){case 2:case 8:case 5:case 6:case 3:case 4:case 25:case 26:return{independentMin:r.xmin,independentMax:r.xmax,dependentMin:r.ymin,dependentMax:r.ymax};case 1:return{independentMin:r.ymin,independentMax:r.ymax,dependentMin:r.xmin,dependentMax:r.xmax};default:throw jF(e)}}function jF(r){return`Unexpected graph mode. Received ${r}`}function YF(r){let e=Math.random()*2-1;return(r+.2*e)/1.02}function sj(r,e){if(r===1)return e.y;if(r===2||r===8||r===5||r===6)return e.x;throw jF(r)}function lj(r,e){let t=([o,i])=>{let n=e!=null&&e.degreeMode?o*Math.PI/180:o;return[i*Math.cos(n),i*Math.sin(n)]};return __dcg_shared_module_exports__['x'](__dcg_shared_module_exports__['D'](r,2).map(o=>t(o)),!0)}function XF(r,e,t){let o=bm(r,e.mathToPixels,t),i=a9(o,{xmin:0,xmax:e.screen.width,ymin:0,ymax:e.screen.height}),n=e.pixelsToMath;return t===Tw&&(n=new __dcg_shared_module_exports__['Nd'](n.yScale,n.xScale)),i.map(s=>bm(s,n,t))}function cj(r,e){return r[0]-e[0]}function dj(r){switch(r.graphMode){case 2:case 3:case 4:case 25:case 26:return{independent:r.x,dependent:r.y};case 1:return{independent:r.y,dependent:r.x};default:throw jF(r.graphMode)}}var Lce=.1;function JF(r){return r<0?Lce:0}function VC(r){var _;let e=r.getGrapher();if(!e)return"";let t=e.viewportController.getViewport(),o=e.getProjection(),{showGrid:i,showXAxis:n,xAxisNumbers:a,showYAxis:s,yAxisNumbers:l,xAxisLabel:c,yAxisLabel:d}=e.settings,p=!1,u="",h=!1,m=[],y=Gi(__dcg_shared_module_exports__['dc'].value(t.xmin,wb(o,t.xmin)).latex),w=Gi(__dcg_shared_module_exports__['dc'].value(t.xmax,wb(o,t.xmax)).latex),S=Gi(__dcg_shared_module_exports__['dc'].value(t.ymin,TG(o,t.ymin)).latex),C=Gi(__dcg_shared_module_exports__['dc'].value(t.ymax,TG(o,t.ymax)).latex),v=t.zmin?Gi(__dcg_shared_module_exports__['dc'].value(t.zmin).latex):"",E=t.zmax?Gi(__dcg_shared_module_exports__['dc'].value(t.zmax).latex):"";if(r.is3dProduct()){let{xmin:T,xmax:I,ymin:P,ymax:O,zmin:W,zmax:X}=t,{showAxis3D:x,showNumbers3D:L,showPlane3D:R}=e.settings;T===P&&T===W&&I===O&&I===X&&x?(n=s=p=!1,m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-xyz-axis-range",{xmin:y,xmax:w}))):(n=s=p=x,c=d=u="",a=l=h=L,i=n&&R)}if(n&&(a&&c!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-x-axis-range-and-label",{xmin:y,xmax:w,label:c})):a&&c===""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-x-axis-range",{xmin:y,xmax:w})):!a&&c!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-x-axis-and-label",{label:c})):!a&&c===""&&m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-x-axis"))),s&&(l&&d!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-y-axis-range-and-label",{ymin:S,ymax:C,label:d})):l&&d===""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-y-axis-range",{ymin:S,ymax:C})):!l&&d!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-y-axis-and-label",{label:d})):!l&&d===""&&m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-y-axis"))),p&&(h&&u!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-z-axis-range-and-label",{zmin:v,zmax:E,label:u})):h&&u===""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-z-axis-range",{zmin:v,zmax:E})):!h&&u!==""?m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-z-axis-and-label",{label:u})):!h&&u===""&&m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-z-axis"))),i&&m.push(r.s("graphing-calculator-narration-audio-trace-description-visible-grid")),r.is3dProduct()&&m.push(Pce(r)),!r.isGeometry()&&!r.is3dProduct()){let T=(_=r.getGrapher())==null?void 0:_.graphSketches,I=0;for(let P in T)ed(r,T[P])&&(I+=1);m.push(r.s("graphing-calculator-narration-audio-trace-traceable-curves",{sketchCount:__dcg_shared_module_exports__['kc'](I)}))}return m.join(" ").trim()}function Pce(r){return""}function Oce(r,e,t){return{x:r.x,y:r.y,branch:r.branch,reportedBranch:t,type:r.type,graphMode:e,intersects:r.intersects}}var Jw=101,$G=class{constructor(e,t,o){this.grapher=o,this.controller=e,this.audiograph=t,this.reset()}reset(){this.currentPoint=void 0,this.resetToFirstBranch(),this.sampledPoints=[],this.pois=[],this.independent=0}resetToFirstBranch(){let e=this.getCurrentSketch();this.branch=e?ij(e,this.grapher.settings.config.audioTraceSimult):0}resetTracePoint(){this.grapher.traceLayer.setTraceInfo(void 0),this.grapher.traceLayer.setTraceLine(void 0),this.drawTracePoint(this.getCurrentPoint())}drawTracePoint(e){let t=this.getCurrentSketch();if(!e||!t)return;let o=t.branches[this.branch];if(!o)return;let i=o.graphMode;if(__dcg_shared_module_exports__['Fd'](i))return;let n={x:e.x,y:e.y},a={branchInfo:{branch:e.branch,id:t.id,sketch:t},pt:n};__dcg_shared_module_exports__['J'](a,this.grapher.traceLayer.getTraceInfo())||(this.grapher.traceLayer.setTraceInfo(a),this.controller.requestRedrawGraph())}drawTraceLine(e,t){if(e===void 0||!t)return;let o=this.getCurrentSketch();t===1?this.grapher.traceLayer.setTraceLine({x:void 0,y:e,color:o==null?void 0:o.color}):this.grapher.traceLayer.setTraceLine({x:e,y:void 0,color:o==null?void 0:o.color})}moveToOrigin(){let e=this.getCurrentSketch();if(!e||!ed(this.controller,e))return;let t=e.branches[this.branch];if(!Cp(t,this.grapher.settings.config.audioTraceSimult))return;let o=t.graphMode;if(o===2)this.setIndependent("x",0);else if(o===1)this.setIndependent("y",0);else if(__dcg_shared_module_exports__['Fd'](o)){let i=this.getSortedPOI()[0];this.setIndependent("x",i?i.x:0)}}getCurrentSketch(){let e,t=this.controller.getSelectedItem();if(t)if(t.type==="table"){let o=this.audiograph.getFocusedTableLocation();if(o&&(e=this.getGraphSketchForTableLocation(t,o)),!e){for(let i of t.columnModels)if(e=this.grapher.getGraphSketch(i.id),e!==void 0)break}}else e=this.grapher.getGraphSketch(t.id);return e}getFirstTraceableSketch(e){let[t]=this.getTraceableCurves(void 0,this.controller.shouldAudioTraceReverseExpressions()?"up":"down");if(t){let o=this.controller.getItemModelByIndex(t.expressionIndex);if(!o)return;let i;switch(t.type){case"expression":i=this.grapher.getGraphSketch(o.id);break;case"table":e!=null&&e.selectAssociatedExpression&&this.audiograph.setFocusedTableLocation(t.location),i=this.getGraphSketchForTableLocation(o,t.location);break;default:let n=t;throw new Error(`Unexpected curve type ${n}`)}if(i)return e!=null&&e.selectAssociatedExpression&&this.controller.dispatch({type:"set-selected-index",index:t.expressionIndex}),i}}canTrace(e){if(!e||e.type==="image"||e.type==="text")return!1;let t;if(e.type==="expression"&&e.shouldGraph)t=this.grapher.getGraphSketch(e.id);else if(e.type==="table"){for(let o of e.columnModels)if(o.shouldGraph){t=this.grapher.getGraphSketch(o.id);break}}return t?ed(this.controller,t):!1}getTraceableExpressionCount(){let e=0,t=this.controller.getItemCount();for(let o=0;o<t;o++){let i=this.controller.getItemModelByIndex(o);i&&this.canTrace(i)&&e++}return e}computeStepSizes(){let e=this.grapher.getProjection().viewport;if(!e)return;let t=e.xmin,o=e.xmax,i=e.ymin,n=e.ymax,a=this.getCurrentSketch();if(!a||!ed(this.controller,a))return;let s=a.branches[this.branch];if(!Cp(s,this.grapher.settings.config.audioTraceSimult))return;let l=s.graphMode;if(l===2)this.independent<t?this.independent=t:this.independent>o&&(this.independent=o);else if(l===1)this.independent<i?this.independent=i:this.independent>n&&(this.independent=n);else if(__dcg_shared_module_exports__['Fd'](l)){let c,d;this.independent<t?(d=this.getSortedPOI()[0],this.independent=d&&d.x!==void 0?d.x:0):this.independent>o&&(c=this.getSortedPOI(),d=c[c.length-1],this.independent=d&&d.x!==void 0?d.x:0)}}getPoint(e,t){let o,i=this.getCurrentSketch();if(!i||!ed(this.controller,i))return o;let n,a,s=0,l=i.branches[e];if(!l)return;let c=AC(i,e,this.grapher.settings.config.audioTraceSimult);"compiled"in l&&l.compiled&&(a=l.compiled.fn);let d=l.graphMode,p=this.grapher.getProjection(),{mathToPixels:u,pixelsToMath:h,screen:m}=p;if(d===2||d===8){let y=h.mapX(u.mapX(t)+m.width/(Jw-1));n=this.getInterveningPOIs(t,y,e,d)[0],(!n||n.x!==t||n.branch!==e)&&(n=void 0,s=a?a(t):0),n?o={x:n.x,y:n.y,type:n.type,typeChain:n.typeChain,branch:n.branch,reportedBranch:c,graphMode:d,intersects:n.intersects}:a&&(o={x:t,y:s,branch:e,reportedBranch:c,graphMode:d})}else if(d===1){let y=h.mapY(u.mapY(t)-m.height/(Jw-1));n=this.getInterveningPOIs(t,y,e,d)[0],(!n||n.y!==t||n.branch!==e)&&(n=void 0,s=a?a(t):0),n?o={x:n.x,y:n.y,type:n.type,typeChain:n.typeChain,branch:n.branch,reportedBranch:c,graphMode:d,intersects:n.intersects}:a&&(o={y:t,x:s,branch:e,reportedBranch:c,graphMode:d})}else if(__dcg_shared_module_exports__['Fd'](d)){let y=h.mapX(u.mapX(t)+m.width/(Jw-1));n=this.getInterveningPOIs(t,y,e,d)[0],n&&n.x===t&&n.branch===e?o={x:n.x,y:n.y,type:n.type,typeChain:n.typeChain,branch:n.branch,reportedBranch:c,graphMode:d,intersects:n.intersects}:o={x:t,y:NaN,branch:e,reportedBranch:c,graphMode:d}}return o}getSampledPoints(){return this.sampledPoints.length===0&&this.updateSampledPoints(),this.sampledPoints}updateSampledPoints(){let e=this.getCurrentSketch();if(!e||!ed(this.controller,e))return;let t=[],o=this.grapher.getProjection(),i=o.viewport;for(let n=0;n<e.branches.length;n++){let a=e.branches[n];if(!Cp(a,this.grapher.settings.config.audioTraceSimult))continue;let s=a.graphMode,l=0,c=0,d=[],p;if(s===2||__dcg_shared_module_exports__['Fd'](s))l=i.xmin,c=i.xmax,p=(u,h,m)=>o.mathToPixels.interpolateX(u,h,m);else if(s===1)l=i.ymin,c=i.ymax,p=(u,h,m)=>o.mathToPixels.interpolateY(u,h,m);else continue;for(let u=0;u<Jw;u++){let h=p(l,c,u/(Jw-1)),m=__dcg_shared_module_exports__['Tb'](h).value,y=p(l,c,(u+1)/(Jw-1)),w=__dcg_shared_module_exports__['Tb'](y).value,S=this.getInterveningPOIs(m,w,n,s);if(S.length>0)d.push.apply(d,S);else{let C=this.getPoint(n,m);C&&d.push(C)}}t.push.apply(t,this.removeDuplicates(d,s))}this.sampledPoints=t}getCurrentPoint(){return this.currentPoint||this.updateCurrentPoint(),this.currentPoint}updateCurrentPoint(e){if(e){this.currentPoint=e;let t=e.graphMode;t===2||__dcg_shared_module_exports__['Fd'](t)?this.independent=e.x!==void 0?e.x:0:t===1&&(this.independent=e.y!==void 0?e.y:0),this.branch=e.branch}else this.currentPoint=this.getPoint(this.branch,this.independent)}prevPoint(){this.moveToPoint(-1)}nextPoint(){this.moveToPoint(1)}firstPoint(){let e=this.getSampledPoints();e.length>0&&this.updateCurrentPoint(e[0])}lastPoint(){let e=this.getSampledPoints();e.length>0&&this.updateCurrentPoint(e[e.length-1])}moveToPoint(e){let t=this.getCurrentPoint();if(!t)return;if(__dcg_shared_module_exports__['Fd'](t.graphMode)){this.moveToPOI(e);return}let o=this.getSampledPoints(),i=this.getClosestPointIndexOnSameBranch(o,t);if(i!==-1){let n=i+e;n<=0?(n=0,Bt(this.controller.s("graphing-calculator-narration-audio-trace-first-point"))):n>=o.length-1&&(n=o.length-1,Bt(this.controller.s("graphing-calculator-narration-audio-trace-last-point")));let a=o[n];this.updateCurrentPoint(a)}}canMoveToPrevPoint(){let e=this.getCurrentPoint();if(!e)return!1;if(__dcg_shared_module_exports__['Fd'](e.graphMode))return this.canMoveToPrevPOI();let t=this.getSampledPoints(),o=this.getClosestPointIndexOnSameBranch(t,e);return o!==-1&&o>0}canMoveToNextPoint(){let e=this.getCurrentPoint();if(!e)return!1;if(__dcg_shared_module_exports__['Fd'](e.graphMode))return this.canMoveToNextPOI();let t=this.getSampledPoints(),o=this.getClosestPointIndexOnSameBranch(t,e);return o!==-1&&o<t.length-1}prevPOI(){this.moveToPOI(-1)}nextPOI(){this.moveToPOI(1)}getSortedPOI(){return(!this.pois||this.pois.length===0)&&this.updatePOI(),this.pois}updatePOI(){let e=[],t,o=[],i=this.getCurrentSketch();if(!(!i||!ed(this.controller,i))){for(let n=0;n<i.branches.length;n++){let a=i.branches[n];if(!a)continue;let s=AC(i,n,this.grapher.settings.config.audioTraceSimult),l=a.graphMode;if(o=[],t=i.getBranchPOI(n),t.length>0){l===2||__dcg_shared_module_exports__['Fd'](l)?o=__dcg_shared_module_exports__['u'](t,"x"):l===1&&(o=__dcg_shared_module_exports__['u'](t,"y"));let c=[];for(let d of o)c.push(Oce(d,l,s));e.push.apply(e,this.removeDuplicates(c,l))}}this.pois=e}}removeDuplicates(e,t){let o=[];for(let i of e){if(i={...i},i.graphMode=t,o.length===0){o.push(i);continue}let n=o[o.length-1];__dcg_shared_module_exports__['Tb'](n.x).value===__dcg_shared_module_exports__['Tb'](i.x).value&&__dcg_shared_module_exports__['Tb'](n.y).value===__dcg_shared_module_exports__['Tb'](i.y).value&&n.branch===i.branch?(n.typeChain||(n.typeChain=n.type!==void 0?[n.type]:[]),i.type!==void 0&&n.typeChain.indexOf(i.type)===-1&&n.typeChain.push(i.type),i.type===1001&&i.intersects&&n.intersects===void 0&&(n.intersects=i.intersects)):o.push(i)}return o}getInterveningPOIs(e,t,o,i){let n=[],a=this.getSortedPOI(),s=NaN;for(let l of a)l&&((i===2||__dcg_shared_module_exports__['Fd'](i))&&!isNaN(l.x)?s=l.x:i===1&&!isNaN(l.y)&&(s=l.y),l.branch===o&&!isNaN(s)&&(e<=s&&s<t||t<=s&&s<e)&&n.push(l));return e>t?n.reverse():n}setIndependent(e,t){let o=this.getSampledPoints();for(let n of o)if(n&&n.hasOwnProperty(e)&&n[e]===t){if(e==="x"){this.independent=n.x!==void 0?n.x:0,this.updateCurrentPoint();return}else if(e==="y"){this.independent=n.y!==void 0?n.y:0,this.updateCurrentPoint();return}}let i=!0;if(o.length>0){let n=Math.floor((o.length-1)/2),a=o[n];a&&(e==="x"?(this.independent=a.x!==void 0?a.x:0,i=!1):e==="y"&&(this.independent=a.y!==void 0?a.y:0,i=!1))}i&&(this.independent=0),this.resetToFirstBranch(),this.updateCurrentPoint()}moveToPOI(e){if(!this.getCurrentPoint())return;let o=this.getSampledPoints(),i=this.getPOIIndexByDirection(e);i===-1?Bt(this.controller.s("graphing-calculator-narration-audio-trace-no-more-pois")):this.updateCurrentPoint(o[i])}getPOIIndexByDirection(e){let t=this.getCurrentPoint();if(!t)return-1;let o=this.getSampledPoints(),i=this.getClosestPointIndexOnSameBranch(o,t),n=-1;if(i!==-1){let a=t.graphMode,s=e===1?o.length-1:0;for(let l=i;l!==s+e;l+=e){let c=o[l];if(((a===2||__dcg_shared_module_exports__['Fd'](a))&&t.x!==c.x||a===1&&t.y!==c.y)&&c.type!==void 0){n=l;break}}}return n}canMoveToPrevPOI(){return this.getPOIIndexByDirection(-1)!==-1}canMoveToNextPOI(){return this.getPOIIndexByDirection(1)!==-1}getClosestPointIndexOnSameBranch(e,t){let o=-1,i=1/0;if(e.length>0&&t){let n=t.graphMode;for(let a=0;a<e.length;a++){let s=e[a];if(t.branch!==s.branch)continue;let l;n===2||__dcg_shared_module_exports__['Fd'](n)?l=Math.abs(s.x-t.x):l=Math.abs(s.y-t.y),l<i&&(o=a,i=l)}}return o}prevCurve(){this.controller.shouldAudioTraceReverseExpressions()?this.switchCurves("down"):this.switchCurves("up")}nextCurve(){this.controller.shouldAudioTraceReverseExpressions()?this.switchCurves("up"):this.switchCurves("down")}switchCurves(e){let t=this.controller.getSelectedItem();if(!t)return;let o=e==="down"?this.findNextTraceableIndex(t.index):this.findPrevTraceableIndex(t.index);if(o){let i=this.controller.getItemModelByIndex(o.expressionIndex);if(!i)return;o.type==="table"&&this.audiograph.setFocusedTableLocation(o.location),this.controller.dispatch({type:"set-selected-id",id:i.id,state:"selected"}),this.controller.runAfterDispatch(()=>this.audiograph.enterAudioTrace())}}canMoveToPrevCurve(){let e=this.controller.getSelectedItem();return e?this.controller.shouldAudioTraceReverseExpressions()?!!this.findNextTraceableIndex(e.index):!!this.findPrevTraceableIndex(e.index):!1}canMoveToNextCurve(){let e=this.controller.getSelectedItem();return e?this.controller.shouldAudioTraceReverseExpressions()?!!this.findPrevTraceableIndex(e.index):!!this.findNextTraceableIndex(e.index):!1}*getTraceableCurves(e,t="down"){let o=t==="down"?1:-1;for(let i=e!=null?e:t==="down"?0:this.controller.getItemCount()-1;t==="down"?i<=this.controller.getItemCount()-1:i>=0;i+=o){let n=this.controller.getItemModelByIndex(i);if(this.canTrace(n))if((n==null?void 0:n.type)==="table"){let a=[];for(let l=1;l<n.columnModels.length;l+=1){let c=n.columnModels[l];c!=null&&c.shouldGraph&&this.grapher.getGraphSketch(c.id)&&a.push({type:"table",expressionIndex:i,location:{tableId:n.id,type:"cell",location:{column:l,row:0}}})}this.controller.areTableRegressionsEnabled()&&n.regression&&!n.regression.hidden&&a.push({type:"table",expressionIndex:i,location:{type:"table-regression",location:void 0,tableId:n.id}}),t==="up"&&a.reverse();let s=this.audiograph.getFocusedTableLocation();if(s){let l=a.findIndex(({location:c})=>__dcg_shared_module_exports__['J'](c,s));yield*a.slice(l!==-1?l:0)}else yield*a}else yield{type:"expression",expressionIndex:i}}}findNextTraceableIndex(e){let[t,o]=this.getTraceableCurves(e,"down");return o}findPrevTraceableIndex(e){let[t,o]=this.getTraceableCurves(e,"up");return o}getGraphSketchForTableLocation(e,t){if(!(!e||e.type!=="table")){if(t.type==="cell"){let o=e.columnModels[t.location.column];if(o)return this.grapher.getGraphSketch(o.id)}else if(t.type==="table-regression"){let o=e.regression;if(o)return this.grapher.getGraphSketch(o.id)}}}};Xa();var pj=__dcg_shared_module_exports__['f']("//tQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAIAAAHVwAgICAgICAgICAgICBAQEBAQEBAQEBAQEBgYGBgYGBgYGBgYGBggICAgICAgICAgICAoKCgoKCgoKCgoKCgoMDAwMDAwMDAwMDAwODg4ODg4ODg4ODg4OD///////////////8AAAA5TEFNRTMuOThyAaUAAAAALmcAABRAJAiwQgAAQAAAB1cctrbdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7UMQAAAjsKyK0YYABp52xtx8wAgAgBd34IAhAgnsECEe7QIAAgsPxACDgcBAEHQfD/g+D4PggCAIf///ghLny4Pg+D5+sHz/wf+XPwfB8H3iMHwfwffUCYPvz/Y7Hg/H4/H4/H4HAwADcoDwAP7XfuAFtXrhzjsjOXP8iCYM4IBVoH2DGAhQR2hm5vikA2IVEPX9nQaITi6IiLCKX/fxcg/DdGmS5BP7fIGQ0hw7DQi5Q//8midImXygdJ0tlz/1NAgXIANV6MA2Vy2y27jv/+1LEBIALOHOTvGGAMXWhbnTxGZ+LOa2FNMsDtj9/jUmPqqqARrNvlVjDDoGZqq0T11A0DVqeEnlQk8q4sVEp0FcqdxLoEJ0RPYWvIlQkbGA0Anw6VJJgqRKw1NJaAXkR4ag0/FwCCABbbdbJA0fzVgdvgvu5Px6Rwiv3VllZVDREqmWntLyBDka3sz951iTve+ddHP0/M3P/+ydU4zbqOZOeop5jfu1kwk8VezPeGc1hRMbWrJNv6SO/fH0Mc15KYvKqAAAAdrdsrbBDuBpp4v/7UsQGgguVE2ekjNP5aSBo6YSNgKAQUoCZEBJK8q73G/nhJFFmLY5dNc4b7gjBRyEs5yjJokY9TBoU/pXQBglyNjeiA87V8vkzaw019YTu2fxY0t6gteLMI37f9fYw7UVnWoE4NJOSpQBu3GfVAIVACgw+IikZZAnB7UKlLGnha4PDbIhsBhk4RYmlE2hYZ8NrQ5HnyEUvZxDyVG1hM33ZZH0OlrJV5///3/51qTGtJgxhREVLEfoO1w6686eRAAAAUicksbA1qegZCe2AuEgJ//tSxAkCDF0XSaw8ailyn+l1h4w1BvVY04S56fYY5nGkBZHMGLBjHDUMlORG4wcCT9R6RB+3vM8jVMU1hmlOoXIOMKqotE2HxWYNJq/7EZ2l63NJ+Z2aTA4Yq+7t0PhOxCz9WP1mA3DJZZGDkRfq+qFAGwhwHUAVqBfDiMUlypaMWApR1VoWLChfUpJzkBDMCTf85UZr6jyHa1psZnTS5iKatTVKcX/Ker9zMvM1T0okGyiQcreJbU1tc+Yj/ms3395FBIADkjlkjbAZNdiwgRD/+1LEBwAL8Tdbp6Rh+XmT6XWHjCx5U4sTCtlUidNtS9I7oUx7oxdIZlOghkIQYzB0vxtMs6QgCg4WMVakQMM5HRfrsdIEftM0yfOHnNGkiPRMoWCKSsxsChat8/vYw4c4t+CMMB5AAAAXZrftWiEVdbSgnURZoWvK2KhK9GfCkIGnQKxIqbYJ0JCNFJ3St1wuUNRLW4Kw5VhLVGrmgYKhhRe1qzzC7SqFFyjJlIqXcPD6gw//epZ9bwQFw+s+rdVAFtzl0AAAA3I3JK0QJxtCHv/7UsQGAApAM0WssGFpSCKqNYMMvgZph6CwIhKEt0yEiMwFKpnDBBajVc5jbTM7KayRt3I43h8Ag05kd9AtqO0bItmf/+Aevzf7dx28sK0hvP//3/izNwf1pfEAgANutuOJACSqWvuW+SKNLQSpOQKsrX3XxnZxy2Rus0Q1irPy9Mkg4kZGJFRQUax4R+jsACwavqYd2bmRX/6VnKrLk2Z2VGYwQNCIEasJh7/oBScAAMtBNgBWssKw0uCAgKkVpJirpZyBklUCwqaSIkW6BgIY//tSxBIDSYw3Km0kSoEzi9KAliSw9QNAydBqoFQVEQNBwiJYiBWdDqxiwVBUGqg6JgaBoGj3//////huVcFQsIRoPjBXLBGA8AkCwOhcD4KAmFAtEYcR6E8gD2OAXJ2N//uSJVZVJNRdh0gkLCwuKioqz4sLC3//////4sLC31ioqKpAoqKirOgFqkxBTUUzLjk4LjKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+1LEIwPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==");var km=.075,ai=.0015,uj=.02,hj=125,gj=330,mj=2e3,Fce=27.5,Nce=4186,QF=.04,ZF=.2,fj=25;function bj(r){return r<2e3?.002:.005}function Bce(r){return{segments:r.clippedSegments.length,totalPoints:r.clippedSegments.map(e=>e.length).reduce((e,t)=>e+t,0),graphMode:r.graphMode,duration:r.duration,discrete:r.discrete}}var LC=class{constructor(e,t){this.audioContext=e.audioContext,this.audioContext&&(this.oscillator=this.audioContext.createOscillator(),this.oscillator.setPeriodicWave(e.getBaseWaveform()),this.firstHarmonic=this.audioContext.createOscillator(),this.firstHarmonic.setPeriodicWave(e.getFirstHarmonicWaveform()),this.firstHarmonicGain=this.audioContext.createGain(),this.firstHarmonicGain.gain.value=0,this.pan=this.audioContext.createStereoPanner(),this.pan.pan.value=0,this.gain=this.audioContext.createGain(),this.gain.gain.value=0,this.oscillatorGain=this.audioContext.createGain(),this.oscillatorGain.gain.value=.5,this.oscillatorGain.connect(this.gain),this.oscillator.connect(this.oscillatorGain),this.firstHarmonic.connect(this.firstHarmonicGain),this.firstHarmonicGain.connect(this.gain),this.gain.connect(this.pan),this.pan.connect(t),this.oscillator.start(),this.firstHarmonic.start(),this.brownNoiseGain=this.audioContext.createGain(),this.brownNoiseGain.gain.value=0,this.brownNoiseSource=this.audioContext.createBufferSource(),this.brownNoiseSource.buffer=e.brownNoiseSample,this.brownNoiseSource.loop=!0,this.brownNoiseSource.start(),this.brownNoiseSource.connect(this.brownNoiseGain),this.brownNoiseGain.connect(this.pan))}stop(e){let t=Math.max(this.audioContext.currentTime,e);this.gain.gain.setTargetAtTime(0,t,ai),this.brownNoiseGain.gain.setTargetAtTime(0,t,ai),setTimeout(()=>{this.oscillator.stop(),this.firstHarmonic.stop(),this.brownNoiseSource.stop(),this.pan.disconnect()},1e3*(2*ai+Math.max(0,e-this.audioContext.currentTime))+1)}};function Uce(r){if(r.length<=2)return[r];let e=__dcg_shared_module_exports__['D'](r,2),t=0,o=[[e[0]]],i=e[0][0]<e[1][0];for(let n=1;n<e.length;n++)o[t].push(e[n]),n<e.length-1&&i!==e[n][0]<e[n+1][0]&&(i=!i,t++,o[t]=[e[n]]);return o.map(n=>__dcg_shared_module_exports__['x'](n))}function qce(r){let e=__dcg_shared_module_exports__['D'](r,2);return e.sort((t,o)=>t[0]-o[0]),__dcg_shared_module_exports__['x'](e)}var jG=class{constructor({controller:e,agNavigator:t,audioEnabled:o}){this.isPlayingOneBranch=!1;this.FREQ_MIN=hj;this.FREQ_MAX=mj;this.FREQ_BASE=gj;e&&(this.controller=e),this.audioContextManager=new sw,this.audioGraphNavigator=t,this.audioEnabled=o,this.screenDuration=5,this.audioVolume=.5}getBaseWaveform(){var o;let e=new Float32Array([0,1,0,.25]),t=new Float32Array([1,0,.25,0]);return(o=this.audioContext)==null?void 0:o.createPeriodicWave(e,t)}getFirstHarmonicWaveform(){var o;let e=new Float32Array([0,0,0,.25,0,0,0,0]),t=new Float32Array([1,0,1,0,.25,0,.3,0]);return(o=this.audioContext)==null?void 0:o.createPeriodicWave(e,t)}async prepareSynthesizer(){if(!this.audioEnabled()||!this.audioContextManager||!this.audioGraphNavigator)return;try{this.audioContext=(await this.audioContextManager.getResumedAudioContext()).audioContext,this.playbackSupported=!0}catch(o){this.playbackSupported=!1;return}this.audioContext.destination.disconnect(),this.mainGainNode=this.audioContext.createGain(),this.mainGainNode.gain.value=this.audioVolume,this.mainGainNode.connect(this.audioContext.destination);let e=this.audioContext.sampleRate*this.screenDuration;this.brownNoiseSample=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate);let t=YF(0);for(let o=0;o<e;o++)t=YF(t),this.brownNoiseSample.getChannelData(0)[o]=t;if(!this.poiBufferSample)try{this.poiBufferSample=await this.audioContext.decodeAudioData(pj.buffer.slice(0))}catch(o){Vo(o)}TT()}releaseAudio(){var e;this.stop(),(e=this.audioContextManager)==null||e.suspend()}synthesizePoint(e,t,o,i){let{gain:n,brownNoiseGain:a,oscillator:s,firstHarmonic:l,firstHarmonicGain:c,pan:d}=i;o=Math.max(o,this.audioContext.currentTime);let p=this.mapDependentToFrequency(t);if(!(!this.viewportBounds||!p)){if(t<this.viewportBounds.dependentMin||t>this.viewportBounds.dependentMax){a.gain.setTargetAtTime(QF,o,ai),a.gain.setTargetAtTime(0,o+km,ai);return}s.frequency.setValueAtTime(p,o),l.frequency.setValueAtTime(p,o),n.gain.setTargetAtTime(1,o,ai),e>0&&c.gain.setTargetAtTime(.15,o,ai),a.gain.setTargetAtTime(JF(t),o,ai),d.pan.setTargetAtTime(this.getPanValueFromIndependent(e),o,ai),n.gain.setTargetAtTime(0,o+km,ai),c.gain.setTargetAtTime(0,o+km,ai),a.gain.setTargetAtTime(0,o+km,ai)}}playPoint(e){!nj(e)||!this.audioContextManager||(this.setupScales(e.graphMode),this.prepareSynthesizer().then(()=>{let t=new LC(this,this.mainGainNode);this.turnMainGainOn();let o=this.audioContext.currentTime,{independent:i,dependent:n}=dj(e);if(!this.mapDependentToFrequency(n)||!this.viewportBounds){t.stop(o);return}if(this.synthesizePoint(i,n,o,t),e.intersects){let a=this.audioContext.createBufferSource();a.connect(t.gain),a.buffer=this.poiBufferSample;try{a==null||a.start(this.audioContext.currentTime)}catch(s){}}t.stop(o+km+ai)}))}playCurrentSketch(e="sequential"){this.audioContextManager&&this.prepareSynthesizer().then(()=>{this.isPlaying=!0,this.isPlayingOneBranch=!1,this.controller.runAfterDispatch(()=>this.controller.dispatch({type:"render"})),this.prepareToPlay(e),this.startPlayingTime=this.audioContext.currentTime+ai,this.currentPlayLoopStartTime=this.startPlayingTime,this.lagLoggingData||(this.lagLoggingData={startPlayingTime:this.startPlayingTime,branchCount:this.branches.length,branchInfo:this.branches.map(t=>Bce(t)),branchIteratorStartTimes:[],branchIteratorRunTimes:[],branchIteratorCallCount:0,branchLags:[],screenDuration:this.screenDuration}),e==="sequential"?(this.currentPlayLoopBranchIndex=0,this.playBranchIterators=[this.playBranch(this.currentPlayLoopBranchIndex,this.currentPlayLoopStartTime)],this.lagLoggingData&&(this.lagLoggingData.proposedDuration=this.branches.reduce((t,o)=>{var i;return t+((i=o.duration)!=null?i:0)},0)),this.sequentialPlayLoop()):e==="simultaneous"&&(this.playBranchIterators=this.branches.map((t,o)=>this.playBranch(o,this.currentPlayLoopStartTime)),this.playBranchIterators.push(this.playBlankSpace(this.currentPlayLoopStartTime)),this.simultaneousPlayLoop())})}stop(){var i,n,a,s,l,c;GT(),clearTimeout(this.timeoutId),this.isPlaying=!1,this.startPlayingTime=void 0;let e=(i=this.audioContext)==null?void 0:i.currentTime;if(!e)return;this.lagLoggingData&&(this.lagLoggingData.actualDuration=e-this.lagLoggingData.startPlayingTime,this.lagLoggingData.stopPlayingTime=e,(a=(n=this.controller).logEvent)==null||a.call(n,{category:"audio-trace",action:"stop-graph"}),this.lagLoggingData=void 0);let t=(s=this.playBranchIterators)==null?void 0:s.map(d=>d.next()).filter(d=>!d.done);t==null||t.forEach(d=>{var p,u;return(u=(p=d.value).synthStopCallback)==null?void 0:u.call(p,e)}),this.playBranchIterators=[],(l=this.mainGainNode)==null||l.gain.cancelScheduledValues(e),(c=this.mainGainNode)==null||c.gain.setTargetAtTime(0,e,ai);let o=this.mainGainNode;setTimeout(()=>o.disconnect(),1e3*2*ai+1),this.controller.runAfterDispatch(()=>this.controller.dispatch({type:"render"}))}getGraphMode(){if(this.branches)return this.currentPlayLoopBranchIndex!==void 0?this.branches[this.currentPlayLoopBranchIndex].graphMode:this.branches[0].graphMode}playBranchByIndex(e){this.audioContext&&this.prepareSynthesizer().then(()=>{this.prepareToPlay("simultaneous"),this.isPlayingOneBranch=!0,this.isPlaying=!0,this.startPlayingTime=this.audioContext.currentTime+ai,this.currentPlayLoopStartTime=this.startPlayingTime,this.currentPlayLoopBranchIndex=e,this.branches[0].graphMode===8||this.branches[0].graphMode==5||this.branches[0].graphMode==6?(this.playBranchIterators=this.branches.map((t,o)=>this.playBranch(o,this.currentPlayLoopStartTime)),this.playBranchIterators.push(this.playBlankSpace(this.currentPlayLoopStartTime))):this.playBranchIterators=[this.playBranch(e,this.startPlayingTime)],this.simultaneousPlayLoop()})}getPlaybackSupported(){return this.playbackSupported}getIsPlaying(){return this.isPlaying}getAudioSpeed(){return this.screenDuration*10}setAudioSpeed(e){this.screenDuration=e/10}getAudioVolume(){return this.audioVolume}setAudioVolume(e){var t;this.audioVolume=e,(t=this.mainGainNode)==null||t.gain.setTargetAtTime(this.audioVolume,0,ai)}getCurrentIndependentValue(){var o,i;if(!this.getIsPlaying()||this.startPlayingTime===void 0)return;if(this.isPlayingOneBranch)return(i=(o=this.branches[this.currentPlayLoopBranchIndex]).mapTimeToIndependent)==null?void 0:i.call(o,this.audioContext.currentTime-this.startPlayingTime);let e=this.audioContext.currentTime-this.startPlayingTime,t=0;for(let n of this.branches)if(!(!n.duration||!n.mapIndependentToTime||!n.mapTimeToIndependent)){if(e-t>=n.duration){t+=n.duration;continue}return n.mapTimeToIndependent(e-t)}}getCurrentBranchIndex(){if(!this.getIsPlaying()||this.startPlayingTime===void 0)return;if(this.isPlayingOneBranch)return this.currentPlayLoopBranchIndex;let e=this.audioContext.currentTime-this.startPlayingTime,t=0;for(let o=0;o<this.branches.length;o++){let i=this.branches[o];if(i.duration){if(e-t>=i.duration){t+=i.duration;continue}return o}}}preprocessBranch(e,t){switch(e.graphMode){case 8:case 5:case 6:let o=[],i=e.segments;if(e.graphMode===6){let n=this.controller.getViewState();i=i.map(a=>lj(a,n))}for(let n of i){let s=XF(n,t,fb);o.push(...s.filter(l=>l.length>2))}return o=__dcg_shared_module_exports__['x'](o.map(n=>Uce(n).map(a=>qce(a))),!0),o.sort((n,a)=>n[0]-a[0]),o.map(n=>({graphMode:e.graphMode,discrete:!1,poi:e.poi,clippedSegments:[n]})).filter(n=>n.clippedSegments.length>0);case 2:case 1:{let n=[];for(let a of e.segments){let s=e.graphMode===2?fb:Tw,l=XF(a,t,s);n.push(...l.filter(c=>c.length>2))}return n.sort((a,s)=>a[0]-s[0]),{graphMode:e.graphMode,discrete:!1,clippedSegments:n,poi:e.poi}}case 3:case 25:case 26:case 4:{let{viewport:n}=t,a=e.segments[0].slice();a.sort(cj);let s=[],l=[];for(let c of a)s.push(c[0],c[1]),c[0]>=n.xmin&&c[0]<=n.xmax&&c[1]>=n.ymin&&c[1]<=n.ymax&&l.push(c[0],c[1]);return{graphMode:2,discrete:!0,clippedSegments:[l],poi:void 0}}default:throw new Error(`Unimplemented graph mode: ${e.graphMode}`)}}turnMainGainOn(){var e,t;(e=this.mainGainNode)==null||e.gain.cancelScheduledValues(0),(t=this.mainGainNode)==null||t.gain.setTargetAtTime(this.audioVolume,0,ai)}getPanValueFromIndependent(e){if(!this.independentScale)return 0;let t=__dcg_shared_module_exports__['Jd'](this.independentScale,e)/this.screenDuration;return __dcg_shared_module_exports__['wc'](2*t-1,-1,1)}setupScales(e){this.projection=this.controller.get2dProjection(),this.viewportBounds=aj(this.projection.viewport,e);let t=e===1?this.projection.settings.yAxisScale:this.projection.settings.xAxisScale,o=e===1?this.projection.settings.xAxisScale:this.projection.settings.yAxisScale;this.independentScale=__dcg_shared_module_exports__['Id'](t,[this.viewportBounds.independentMin,this.viewportBounds.independentMax],[0,this.screenDuration]),this.dependentScale=__dcg_shared_module_exports__['Id'](o,[this.viewportBounds.dependentMin,this.viewportBounds.dependentMax],[0,1]),this.viewportBounds.dependentMax<=Nce&&this.viewportBounds.dependentMin>=Fce&&this.viewportBounds.dependentMax-this.viewportBounds.dependentMin>=1e3?(this.FREQ_MIN=this.viewportBounds.dependentMin,this.FREQ_MAX=this.viewportBounds.dependentMax,this.FREQ_BASE=void 0):(this.FREQ_MIN=hj,this.FREQ_MAX=mj,this.FREQ_BASE=gj)}densifyBranches(){this.branches.map(e=>{if(e.discrete)return e;let t=this.independentScale,o=this.dependentScale;return!t||!o||!e.clippedSegments||(e.clippedSegments=e.clippedSegments.map(i=>{let n=[];for(let a=0;a<i.length;a+=2){let s=this.mapDependentToFrequency(i[a+1]),l=this.mapDependentToFrequency(i[a+3]);if(n.push(i[a]),n.push(i[a+1]),s&&l&&isFinite(s)&&isFinite(l)&&Math.abs((l-s)/s)>=bj(Math.min(l,s))){let c=Math.ceil(Math.abs((l-s)/s)/bj(Math.min(l,s)));for(let d=1;d<c;d++)n.push(__dcg_shared_module_exports__['Kd'](t.type,i[a],i[a+2],d*1/c)),n.push(__dcg_shared_module_exports__['Kd'](o.type,i[a+1],i[a+3],d*1/c))}}return n})),e})}setupToPlayBranches(e){if(!this.audioGraphNavigator||!this.audioContext||!this.mainGainNode)return;let t=this.audioGraphNavigator.getCurrentSketch();if(!t)return;let o=this.controller.get2dProjection();if(this.branches=__dcg_shared_module_exports__['x'](t.branches.filter(i=>Cp(i,this.controller.getGraphSettings().config.audioTraceSimult)).map(i=>this.preprocessBranch(i,o))).filter(i=>i.clippedSegments.length>0),!!this.branches.length)if(this.setupScales(this.branches[0].graphMode),this.densifyBranches(),e==="simultaneous"){let i=Math.min(...this.branches.map(c=>c.clippedSegments[0][0])),n=Math.max(...this.branches.map(c=>c.clippedSegments.slice(-1)[0].slice(-2)[0])),a=this.mapIndependentToTime(n)-this.mapIndependentToTime(i),s=__dcg_shared_module_exports__['Id'](this.branches[0].graphMode===1?this.projection.settings.yAxisScale:this.projection.settings.xAxisScale,[i,n],[0,a]),l=__dcg_shared_module_exports__['Id'](this.branches[0].graphMode===1?this.projection.settings.yAxisScale:this.projection.settings.xAxisScale,[0,a],[i,n]);this.branches.forEach(c=>{c.duration=c.discrete?a+km:a,c.mapIndependentToTime=d=>__dcg_shared_module_exports__['Jd'](s,d),c.mapTimeToIndependent=d=>__dcg_shared_module_exports__['Jd'](l,d)})}else this.branches.forEach(i=>{let n=i.clippedSegments[0][0],a=i.clippedSegments.slice(-1)[0].slice(-2)[0];i.discrete?i.duration=i.clippedSegments.reduce((c,d)=>c+d.length/2,0)*(km+uj):i.duration=this.mapIndependentToTime(a)-this.mapIndependentToTime(n);let s=__dcg_shared_module_exports__['Id'](this.branches[0].graphMode===1?this.projection.settings.yAxisScale:this.projection.settings.xAxisScale,[n,a],[0,i.duration]),l=__dcg_shared_module_exports__['Id'](this.branches[0].graphMode===1?this.projection.settings.yAxisScale:this.projection.settings.xAxisScale,[0,i.duration],[n,a]);i.mapIndependentToTime=c=>__dcg_shared_module_exports__['Jd'](s,c),i.mapTimeToIndependent=c=>__dcg_shared_module_exports__['Jd'](l,c)})}prepareToPlay(e){this.setupToPlayBranches(e),this.turnMainGainOn(),clearInterval(this.timeoutId)}sequentialPlayLoop(){var o,i,n,a,s;let e=this.audioContext.currentTime,t=(o=this.playBranchIterators[0])==null?void 0:o.next();if(this.lagLoggingData&&(this.lagLoggingData.branchIteratorCallCount++,this.audioContext.currentTime-e>0&&(this.lagLoggingData.branchIteratorStartTimes.push(e),this.lagLoggingData.branchIteratorRunTimes.push(this.audioContext.currentTime-e))),!!t){if(t.done)if(((i=t.value)==null?void 0:i.duration)!==void 0&&(this.currentPlayLoopStartTime=((n=t.value.startTime)!=null?n:this.currentPlayLoopStartTime)+t.value.duration),this.currentPlayLoopBranchIndex<this.branches.length-1)this.currentPlayLoopBranchIndex++,this.playBranchIterators[0]=this.playBranch(this.currentPlayLoopBranchIndex,this.currentPlayLoopStartTime),this.sequentialPlayLoop();else{(a=this.mainGainNode)==null||a.gain.cancelScheduledValues(this.currentPlayLoopStartTime),(s=this.mainGainNode)==null||s.gain.setTargetAtTime(0,this.currentPlayLoopStartTime,ai),clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>this.stop(),1e3*(Math.max(this.currentPlayLoopStartTime-this.audioContext.currentTime,0)+ai));return}this.timeoutId=setTimeout(()=>this.sequentialPlayLoop(),fj)}}simultaneousPlayLoop(){var t,o;let e=this.playBranchIterators.map(i=>i.next());if(e.every(i=>i.done)){let i=this.currentPlayLoopStartTime+Math.max(...e.map(n=>{var a;return(a=n.value)!=null&&a.duration&&isFinite(n.value.duration)?n.value.duration:0}));(t=this.mainGainNode)==null||t.gain.cancelScheduledValues(i),(o=this.mainGainNode)==null||o.gain.setTargetAtTime(0,i,ai),this.timeoutId=setTimeout(()=>this.stop(),1e3*(Math.max(i-this.audioContext.currentTime,0)+ai))}else this.timeoutId=setTimeout(()=>this.simultaneousPlayLoop(),fj)}*playBlankSpace(e){let t=Math.max(this.audioContext.currentTime,e),o=new LC(this,this.mainGainNode),{oscillator:i,pan:n,brownNoiseGain:a,gain:s}=o;i.stop(),s.gain.setTargetAtTime(1,t,ai);let l=this.branches.map(p=>{if(p.mapIndependentToTime)return[p.clippedSegments[0][0],p.clippedSegments.slice(-1)[0].slice(-2)[0]]}).filter(p=>!!p),c=[];for(l.sort((p,u)=>p[0]-u[0]);l.length>0;){let p=l[0];l=l.filter(u=>u[1]>p[1]),l.filter(u=>u[0]<=p[1]).length===0&&c.push([p[1],Math.min(...l.map(u=>u[0]))])}c=c.filter(p=>isFinite(p[0])&&isFinite(p[1]));let d=p=>{o.stop(p)};for(let p of c){let u=t+this.mapIndependentToTime(p[0]),h=t+this.mapIndependentToTime(p[1]);for(;u>this.audioContext.currentTime+ZF;)yield{synthStopCallback:d};a.gain.setTargetAtTime(QF,u,ai),a.gain.setTargetAtTime(0,h,ai),n.pan.setValueAtTime(this.getPanValueFromIndependent(p[0]),u),n.pan.linearRampToValueAtTime(this.getPanValueFromIndependent(p[1]),h)}return{duration:0}}mapDiscreteSegmentIndexToTime(e){return e/2*(km+uj)}*playBranch(e,t){var y,w,S,C;let o=this.branches[e];if(!(o!=null&&o.duration)||!(o!=null&&o.mapIndependentToTime))return{duration:0};let i=new LC(this,this.mainGainNode),n=o.clippedSegments,a=v=>{i.stop(v)},{oscillator:s,gain:l,firstHarmonic:c,firstHarmonicGain:d,pan:p,brownNoiseGain:u}=i,h=Math.max(this.audioContext.currentTime,t);if(o.poi&&o.poi.intersections&&this.poiBufferSample){let v=sj(o.graphMode,o.poi.intersections);for(let E of v){let _=this.audioContext.createBufferSource();_.connect(l),_.buffer=this.poiBufferSample;try{_==null||_.start(h+o.mapIndependentToTime(E))}catch(T){}}}let m=h;for(let v=0;v<n.length;v++){let E=n[v];for(let _=0;_<E.length;_+=2){let T=_===0,I=_+2>=E.length,P=o.discrete?m+this.mapDiscreteSegmentIndexToTime(_):h+o.mapIndependentToTime(E[_]),O=this.mapDependentToFrequency(E[_+1]);for(;P>this.audioContext.currentTime+ZF;)yield{synthStopCallback:a,duration:void 0};if(o.discrete){this.synthesizePoint(E[_],E[_+1],m+this.mapDiscreteSegmentIndexToTime(_),i);continue}if(P<this.audioContext.currentTime-ZF&&this.lagLoggingData&&this.lagLoggingData.branchLags.push({branchIndex:e,segmentIndex:v,pos:_,nextTime:P,proposedStartTime:t,lagAmount:this.audioContext.currentTime-P,currentTime:this.audioContext.currentTime}),T&&(d.gain.cancelScheduledValues(P),u.gain.cancelScheduledValues(P),l.gain.setTargetAtTime(1,P,ai)),O!==void 0&&isFinite(O)){s.frequency.linearRampToValueAtTime(O,P),c.frequency.linearRampToValueAtTime(O,P);let W=P;if(_>=2&&E[_-2]<=0!=E[_]<=0){let R=E[_-2],N=E[_];W=h+o.mapIndependentToTime(__dcg_shared_module_exports__['Kd']((w=(y=this.independentScale)==null?void 0:y.type)!=null?w:"linear",R,N,Math.abs(N)/(Math.abs(N)+Math.abs(R))))}d.gain.setTargetAtTime(E[_]>0?.15:0,W,ai);let x=P;if(_>=2&&E[_+1]<=0!=E[_-1]<=0){let R=E[_-2],N=E[_],z=E[_-1],A=E[_+1];x=h+o.mapIndependentToTime(__dcg_shared_module_exports__['Kd']((C=(S=this.independentScale)==null?void 0:S.type)!=null?C:"linear",R,N,Math.abs(z)/(Math.abs(z)+Math.abs(A))))}u.gain.setTargetAtTime(JF(E[_+1]),x,ai)}I&&(l.gain.setTargetAtTime(0,P,ai),v<o.clippedSegments.length-1&&u.gain.setTargetAtTime(QF,P,ai)),_===0?p.pan.setValueAtTime(this.getPanValueFromIndependent(E[_]),P):p.pan.linearRampToValueAtTime(this.getPanValueFromIndependent(E[_]),P)}m+=this.mapDiscreteSegmentIndexToTime(E.length)}return o.duration=Math.max(0,o.duration,this.audioContext.currentTime-t),i.stop(h+o.duration),{duration:o.duration,startTime:h}}mapIndependentToTime(e){return this.independentScale?__dcg_shared_module_exports__['Jd'](this.independentScale,e):0}mapDependentToFrequency(e){if(!this.dependentScale)return;let t=__dcg_shared_module_exports__['Jd'](this.dependentScale,e);if(this.FREQ_BASE)return Math.min(Math.max(this.FREQ_BASE*Math.pow(2,t),this.FREQ_MIN),this.FREQ_MAX);{let o=this.FREQ_MAX-this.FREQ_MIN;return Math.min(Math.max(this.FREQ_MIN+o*t,this.FREQ_MIN),this.FREQ_MAX)}}};var PC=[{speed:1600,displayedSpeed:"1/32 x"},{speed:1200,displayedSpeed:"1/24 x"},{speed:800,displayedSpeed:"1/16 x"},{speed:400,displayedSpeed:"1/8 x"},{speed:200,displayedSpeed:"1/4 x"},{speed:100,displayedSpeed:"1/2 x"},{speed:50,displayedSpeed:"1 x"},{speed:25,displayedSpeed:"2 x"},{speed:12.5,displayedSpeed:"4 x"},{speed:6.25,displayedSpeed:"8 x"}],YG=class{constructor(e,t){this.focusedTableLocation=void 0;this.grapher=t,this.controller=e,this.audioTraceActive=!1,this.wasFocusInExpressionsView=!1,this.sliderTraceActive=!1,this.sliderIndex=0,this.sliderArray=[],this.lastSpokenBranch=1,this.agNavigator=new $G(e,this,this.grapher),this.agSynthesizer=new jG({controller:e,agNavigator:this.agNavigator,audioEnabled:()=>this.controller.getAudio()}),this.audioSpeedIndex=6,this.agSynthesizer.releaseAudio()}remove(){}handleKeydown(e){let t=e.altKey&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey;t&&Ho(e)==="S"?this.controller.getSelectedItem()&&(this.audioTraceActive||this.isFocusInExpressionsView())&&(e.preventDefault(),e.stopPropagation(),this.describeCurve()):t&&Ho(e)==="G"?(this.audioTraceActive||this.isFocusInExpressionsView())&&(e.preventDefault(),e.stopPropagation(),this.describeAxes()):t&&Ho(e)==="T"?(e.preventDefault(),e.stopPropagation(),this.toggleAudioTrace()):this.audioTraceActive&&(this.sliderTraceActive?this.sliderTraceKeydown(e):(this.stopAnimations(),this.audioTraceKeydown(e)))}sliderTraceKeydown(e){let t=e.altKey||e.metaKey,o=!t&&!e.ctrlKey&&!e.shiftKey;o&&Be(e)===su||Ho(e)==="J"?(e.preventDefault(),e.stopPropagation(),this.decrementSliderValue()):o&&Be(e)===lu||Ho(e)==="L"?(e.preventDefault(),e.stopPropagation(),this.incrementSliderValue()):o&&Be(e)===jg?(e.preventDefault(),e.stopPropagation(),this.decrementBigSliderValue()):o&&Be(e)===$g?(e.preventDefault(),e.stopPropagation(),this.incrementBigSliderValue()):!t&&(Be(e)===On||!e.shiftKey&&Be(e)===_l||Ho(e)==="K")?(e.preventDefault(),e.stopPropagation(),this.nextSlider()):!t&&(Be(e)===Ia||e.shiftKey&&Be(e)===_l||Ho(e)==="I")?(e.preventDefault(),e.stopPropagation(),this.prevSlider()):o&&Be(e)===kh||Ho(e)==="U"?(e.preventDefault(),e.stopPropagation(),this.sliderMin()):o&&Be(e)===lp||Ho(e)==="N"?(e.preventDefault(),e.stopPropagation(),this.sliderMax()):this.audioTraceKeydown(e)}audioTraceKeydown(e){let t=e.altKey||e.metaKey,o=t&&!e.ctrlKey&&!e.shiftKey,i=!t&&!e.ctrlKey&&!e.shiftKey,n=Ho(e);if(Be(e)===Ia&&o)e.preventDefault(),e.stopPropagation(),Rn(),this.agNavigator.prevCurve();else if(Be(e)===On&&o)e.preventDefault(),e.stopPropagation(),Rn(),this.agNavigator.nextCurve();else if(i&&Be(e)===su||Be(e)===Ia||n==="J")e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"keypad/audio-trace",command:"previous-point"});else if(i&&Be(e)===lu||Be(e)===On||n==="L")e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"keypad/audio-trace",command:"next-point"});else if(!t&&(Be(e)===jg||!e.shiftKey&&Be(e)===_l||n==="I"))e.preventDefault(),e.stopPropagation(),this.reportAndMoveToNextPOI();else if(!t&&(Be(e)===$g||e.shiftKey&&Be(e)===_l||n==="K"))e.preventDefault(),e.stopPropagation(),this.reportAndMoveToPrevPOI();else if(i&&Be(e)===kh||n==="U")e.preventDefault(),e.stopPropagation(),this.reportAndMoveToFirstPoint();else if(i&&Be(e)===lp||n==="N")e.preventDefault(),e.stopPropagation(),this.reportAndMoveToLastPoint();else if(i&&n==="X")e.preventDefault(),e.stopPropagation(),this.reportX();else if(i&&n==="P")e.preventDefault(),e.stopPropagation(),this.reportPOICount();else if(i&&n==="Y")e.preventDefault(),e.stopPropagation(),this.reportY();else if(i&&n==="T")e.preventDefault(),e.stopPropagation(),this.reportType();else if(i&&n==="B")e.preventDefault(),e.stopPropagation(),this.reportBranch();else if(i&&n==="O")e.preventDefault(),e.stopPropagation(),this.reportAndMoveToOrigin();else if(i&&n==="H")e.preventDefault(),e.stopPropagation(),this.hearGraph();else if(i&&typeof n=="string"&&n>="0"&&n<="9"){if(e.preventDefault(),e.stopPropagation(),Rn(),!this.controller.getAudio()){Te(this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled"));return}this.agSynthesizer.stop();let a=this.agNavigator.getCurrentSketch();if(a){let s;e.which===48?s=9:s=e.which-49;let l=s,c=-1;for(let d=0;d<a.branches.length;d++)if(Cp(a.branches[d],this.grapher.settings.config.audioTraceSimult)&&(l-=1),l<0){c=d;break}c>=0?this.agSynthesizer.getPlaybackSupported()?(this.agSynthesizer.playBranchByIndex(c),this.grapher.traceLayer.setTraceInfo(void 0),this.graphAnimationTimeoutId=requestAnimationFrame(()=>this.animateCurrentSketchLine())):Te(this.controller.s("graphing-calculator-narration-audio-trace-unable-to-play")):Te(this.controller.s("graphing-calculator-narration-audio-trace-branch-not-found",{branch:s+1}))}else Te(this.controller.s("graphing-calculator-narration-audio-trace-description-no-curve-selected"))}else t&&typeof n=="string"&&n>="1"&&n<="5"?(e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"set-audio-trace-speed",speed:parseInt(n,10)+3})):!e.altKey&&!e.ctrlKey&&!e.metaKey&&n==="V"?(e.preventDefault(),e.stopPropagation(),this.controller.getAudio()?e.shiftKey?this.controller.dispatch({type:"keypad/audio-trace",command:"volume-down"}):this.controller.dispatch({type:"keypad/audio-trace",command:"volume-up"}):Te(this.controller.s("graphing-calculator-narration-audio-trace-unable-to-play"))):i&&n==="A"?(e.preventDefault(),e.stopPropagation(),Rn(),this.queueAnimatingPoints(!0),Te()):i&&n==="S"&&this.controller.isListEnabled()?(e.preventDefault(),e.stopPropagation(),this.toggleSliderTrace()):i&&n==="C"?(e.preventDefault(),e.stopPropagation(),this.reportColor()):i&&this.exitAudioTrace();this.controller.dispatch({type:"render"})}describeCurve(){Rn();let e=this.agNavigator.getCurrentSketch();if(!e){Te(this.controller.s("graphing-calculator-narration-audio-trace-description-no-curve-selected"));return}Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-color",{color:gu(this.controller,e.color)}));let t=AC(e,e.branches.length-1,this.grapher.settings.config.audioTraceSimult);t>1&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-branch-count",{branches:t}));let o=!1,i=!1;for(let a of e.branches)if(t===1&&a.segments.length>0&&a.hasOwnProperty("operator")){if(a.graphMode===2){if(a.operator===">"||a.operator===">="){Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-shading-above"));break}else if(a.operator==="<"||a.operator==="<="){Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-shading-below"));break}}else if(a.graphMode===1){if(a.operator===">"||a.operator===">="){Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-shading-right"));break}else if(a.operator==="<"||a.operator==="<="){Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-shading-left"));break}}}else t>1&&(a.graphMode===2||a.graphMode===1?(a.operator==="<"||a.operator==="<="||a.operator===">"||a.operator===">=")&&(o=!0):a.graphMode===7&&(i=!0));o&&i&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-description-shading-in-regions"));let n=e.getPOI();if(n.length>0){let a=[];for(let s of n)a[s.type]===void 0?a[s.type]=1:a[s.type]+=1;a.forEach((s,l)=>{l===1001?Bt(s===1?this.controller.s("graphing-calculator-narration-audio-trace-description-one-intersection"):this.controller.s("graphing-calculator-narration-audio-trace-description-multiple-intersections",{count:s})):l===1002?Bt(s===1?this.controller.s("graphing-calculator-narration-audio-trace-description-one-root"):this.controller.s("graphing-calculator-narration-audio-trace-description-multiple-roots",{count:s})):l===1003?Bt(s===1?this.controller.s("graphing-calculator-narration-audio-trace-description-one-intercept"):this.controller.s("graphing-calculator-narration-audio-trace-description-multiple-intercepts",{count:s})):l===1004?Bt(s===1?this.controller.s("graphing-calculator-narration-audio-trace-description-one-extremum"):this.controller.s("graphing-calculator-narration-audio-trace-description-multiple-extrema",{count:s})):l===1008&&Bt(s===1?this.controller.s("graphing-calculator-narration-audio-trace-description-one-label"):this.controller.s("graphing-calculator-narration-audio-trace-description-multiple-labels",{count:s}))})}Te()}describeAxes(){Rn(),Te(VC(this.controller))}queueCoordinates(e){if(!this.grapher.getProjection().viewport||!e)return;let o=this.agNavigator.getCurrentSketch();e.hasOwnProperty("branch")&&o&&o.branches.length>1&&this.lastSpokenBranch!==e.reportedBranch&&this.queueCoordinateProp(e,"branch"),e.hasOwnProperty("type")&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-property-type-before-coordinates",{type:this.describePOI(e)})),e.graphMode===25||e.graphMode===26?Bt(Gi(__dcg_shared_module_exports__['cc']([e.x,e.y]))):(this.queueCoordinateProp(e,"x"),this.queueCoordinateProp(e,"y"))}queueCoordinateProp(e,t){if(this.grapher.getProjection().viewport&&e)switch(t){case"branch":typeof e.reportedBranch=="number"&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-property-branch-number",{branch:e.reportedBranch}));break;case"type":Bt(this.describePOI(e));break;case"x":Bt(Md(this.controller,e.x));break;case"y":Bt(Ad(this.controller,e.y));break;default:let i=t;throw new Error(`Unexpected prop ${i}`)}}describePOI(e){if(e!=null&&e.typeChain){let t=[];for(let o=0;o<e.typeChain.length;o++)t.push(this.poiTypeToText(e,o));return wu(this.controller.getLanguage(),t)}else return this.poiTypeToText(e)}poiTypeToText(e,t){switch(t&&e.typeChain?e.typeChain[t]:e.type){case 1001:let i=this.getIntersectingCurves(e);return i!==""?this.controller.s("graphing-calculator-narration-audio-trace-point-type-intersection-with-curves",{curves:i}):this.controller.s("graphing-calculator-narration-audio-trace-point-type-intersection");case 1002:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-root");case 1003:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-intercept");case 1004:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-extremum");case 1006:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-definition");case 1007:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-trace");case 1008:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-label");default:return this.controller.s("graphing-calculator-narration-audio-trace-point-type-not-a-poi")}}getIntersectingCurves(e){return!e||!e.intersects?"":this.getExpressionAriaLabel(e.intersects)}getExpressionAriaLabel(e){var o;let t=this.controller.getItemModel(e);return t?t.type==="expression"&&t.label?rn(t.label):t.type==="table"&&((o=this.focusedTableLocation)==null?void 0:o.type)==="cell"?this.controller.s("graphing-calculator-narration-audio-trace-expression-with-column",{index:t.displayIndex,column:this.focusedTableLocation.location.column+1}):Lo(t,"describe"):""}exitAudioTrace(e){var t;if(this.audioTraceActive){if(this.audioTraceActive=!1,this.controller.isKeypadEnabled()&&this.controller.dispatch({type:"keypad/123"}),e||(e=this.controller.s("graphing-calculator-text-audio-trace-off")),this.controller.dispatch({type:"toast/close"}),this.wasFocusInExpressionsView){let o=this.controller.getSelectedItem();if((!o||!this.controller.isItemSelectable(o.id))&&(o=this.controller.getFirstFullyVisibleItem()),o&&this.controller.isItemSelectable(o.id)){let i={type:"move-focus-to-item",id:o.id,where:"end"};if(o.type==="table")switch((t=this.focusedTableLocation)==null?void 0:t.type){case"cell":i.where={location:"cell",...this.focusedTableLocation.location},this.focusedTableLocation.location.column===1&&this.enteredAudioTraceWithFirstTableColumnFocused&&(i.where.column=0);break;case"table-regression":i={type:"set-focus-location",location:{type:"table-regression-type-dropdown",id:o.id}}}this.controller.dispatch(i)}}this.wasFocusInExpressionsView=!1,this.focusedTableLocation=void 0,this.stopAnimations(),this.sliderTraceActive=!1,this.sliderIndex=0,this.agSynthesizer.stop(),this.agSynthesizer.releaseAudio(),this.agNavigator.reset(),this.lastSpokenBranch=1,this.grapher.traceLayer.setTraceInfo(void 0),this.grapher.traceLayer.setTraceLine(void 0),this.controller.requestRedrawGraph(),this.enteredAudioTraceWithFirstTableColumnFocused=!1,Te(e),this.resumeAnimations()}}isFocusInExpressionsView(){var e;return!!((e=document.activeElement)!=null&&e.closest(".dcg-exppanel-container"))}canAudioTraceCurrentExp(){let e=this.controller.getSelectedItem();return e?e.type==="table"?!!this.agNavigator.getCurrentSketch():this.agNavigator.canTrace(e):!1}enterAudioTrace(e){var a,s;let t=this.controller.getSelectedItem(),o=t&&t.type!=="table"&&!this.agNavigator.canTrace(t)?this.getExpressionAriaLabel(t.id):void 0,i=!1;this.audioTraceActive||(this.wasFocusInExpressionsView=this.isFocusInExpressionsView(),t&&o&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-unsupported-expression",{expression:o})),i=!!o||!this.wasFocusInExpressionsView);let n;if(i)n=this.agNavigator.getFirstTraceableSketch({selectAssociatedExpression:!0});else if(!o){if(t&&t.type==="expression"&&t.formula&&t.formula.error)return this.exitAudioTrace(),this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-narration-audio-trace-description-no-curve-selected")}});if(t&&t.type==="table"){if(!this.focusedTableLocation){let l=ys(t),c=this.controller.getFocusLocation();c!=null&&c.type.startsWith("table-regression")||(a=document.activeElement)!=null&&a.closest(".dcg-table-regression")?this.setFocusedTableLocation({tableId:t.id,type:"table-regression",location:void 0}):(this.enteredAudioTraceWithFirstTableColumnFocused=(l==null?void 0:l.column)===0,this.setFocusedTableLocation(l?{tableId:t.id,type:"cell",location:{column:l.column||1,row:l.row}}:void 0))}}else this.enteredAudioTraceWithFirstTableColumnFocused=!1,this.setFocusedTableLocation(void 0);n=this.agNavigator.getCurrentSketch()}if(!n){this.agNavigator.reset(),this.lastSpokenBranch=1,this.exitAudioTrace(),n=this.agNavigator.getCurrentSketch();let l=n==null?void 0:n.branches[0].graphMode;return l===8&&!this.grapher.settings.config.audioTraceSimult?(this.exitAudioTrace(),this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-text-audio-trace-no-implicit-support")}})):l===5&&!this.grapher.settings.config.audioTraceSimult?(this.exitAudioTrace(),this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-text-audio-trace-no-parametric-support")}})):l===6&&!this.grapher.settings.config.audioTraceSimult?(this.exitAudioTrace(),this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-text-audio-trace-no-polar-support")}})):this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-narration-audio-trace-description-no-curve-selected")}})}if((s=this.controller.toneController)==null||s.handleAction({type:"mute-global"}),this.agNavigator.reset(),this.agNavigator.computeStepSizes(),this.lastSpokenBranch=1,this.grapher.traceLayer.clearOpenedPOI(),this.controller.requestRedrawGraph(),!this.audioTraceActive&&(this.controller.isKeypadEnabled()||this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-calculator-text-audio-trace-on"),noAria:!0,onHide:()=>this.exitAudioTrace(),hideAfter:0}}),o&&n&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-tracing-different-expression",{expression:this.getExpressionAriaLabel(this.focusedTableLocation?this.focusedTableLocation.tableId:n.id)})),Bt(this.controller.s("graphing-calculator-text-audio-trace-on")),this.controller.getAudio()||Bt(this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled")),this.pauseAnimations(),this.queueAnimatingPoints(!1),this.agSynthesizer.prepareSynthesizer(),(!e||!e.fromKeypad)&&(Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-use-arrow-keys")),this.controller.getAudio()&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-hear-graph")),this.agNavigator.getTraceableExpressionCount()>1&&(qo?Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-expression-navigation-mac")):Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-expression-navigation-windows"))),qo?Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-disable-mac")):Bt(this.controller.s("graphing-calculator-narration-audio-trace-instructions-disable-windows"))),this.wasFocusInExpressionsView)){let l=this.controller.findEl(".dcg-graph-outer");l&&(re(l).one("focusin",()=>{setTimeout(()=>{Te()},0)}),this.controller.dispatch({type:"set-focus-location",location:{type:"graph-paper"}}))}this.agNavigator.moveToOrigin(),Bt(this.getExpressionAriaLabel(n.id)),this.reportAudioTrace({playSound:!1}),this.wasFocusInExpressionsView||Te(),this.audioTraceActive=!0,this.controller.isKeypadEnabled()&&this.controller.dispatch({type:"keypad/audio"})}checkIfSelectedItemChanged(e){this.lastSelectedId!==e&&(this.lastSelectedId=e,this.audioTraceActive&&(e?(Bt(this.getExpressionAriaLabel(e)),this.exitSliderTrace(),this.agNavigator.updatePOI(),this.agNavigator.moveToOrigin(),this.reportAudioTrace(),Te()):this.exitAudioTrace()))}pauseAnimations(){this.sliderArray.length=0,this.controller.getAllModelsWithSliders().forEach(t=>{t.slider.isPlaying&&(this.controller.dispatch({type:"set-slider-isplaying",id:t.id,isPlaying:!1}),this.sliderArray.push(t))})}resumeAnimations(){if(this.sliderArray.length!==0){for(let e=0;e<this.sliderArray.length;e++){let t=this.sliderArray[e];t.slider.isPlaying!==!0&&this.controller.dispatch({type:"set-slider-isplaying",id:t.id,isPlaying:!0})}this.sliderArray.length=0}}stopAnimations(){this.controller.getAllModelsWithSliders().forEach(t=>{t.slider.isPlaying&&this.controller.dispatch({type:"set-slider-isplaying",id:t.id,isPlaying:!1})})}hasActiveSliders(){let e=this.controller.getAllModelsWithSliders();for(let t=0;t<e.length;t++)if(e[t].slider.isPlaying)return!0;return!1}queueAnimatingPoints(e){this.sliderArray.length===1?Bt(this.controller.s("graphing-calculator-narration-audio-trace-one-slider-paused")):this.sliderArray.length>1?Bt(this.controller.s("graphing-calculator-narration-audio-trace-multiple-sliders-paused",{sliders:this.sliderArray.length})):e&&Bt(this.controller.s("graphing-calculator-narration-audio-trace-no-sliders-paused"))}queueSliderLatex(){this.hasActiveSliders()||this.agSynthesizer.stop();let e=this.getSelectedSlider();e?Bt(e.latex):Bt(this.controller.s("graphing-calculator-narration-audio-trace-slider-value-unknown"))}getSelectedSlider(){let e=this.controller.getAllModelsWithSliders();return this.sliderIndex<=e.length-1?e[this.sliderIndex]:null}incrementSliderValue(){this.adjustSlider("up")}decrementSliderValue(){this.adjustSlider("down")}incrementBigSliderValue(){this.adjustSlider("bigup")}decrementBigSliderValue(){this.adjustSlider("bigdown")}nextSlider(){this.adjustSlider("next")}prevSlider(){this.adjustSlider("prev")}sliderMin(){this.adjustSlider("min")}sliderMax(){this.adjustSlider("max")}adjustSlider(e){let t=this.getSelectedSlider();if(!t){Bt(this.controller.s("graphing-calculator-narration-audio-trace-cannot-change-slider-value"));return}let o=t.latex,i=this.controller.getAllModelsWithSliders().length;switch(e){case"up":case"down":case"bigup":case"bigdown":case"min":case"max":this.controller.dispatch({type:"adjust-slider-by-keyboard",id:t.id,adjustment:e}),this.queueSliderLatex(),Te();break;case"next":this.sliderIndex++,this.sliderIndex>=i&&(Bt(this.controller.s("graphing-calculator-narration-audio-trace-last-slider")),this.sliderIndex=i-1),this.queueSliderLatex(),Te();return;case"prev":this.sliderIndex--,this.sliderIndex<0&&(Bt(this.controller.s("graphing-calculator-narration-audio-trace-first-slider")),this.sliderIndex=0),this.queueSliderLatex(),Te();return}!t.slider.isPlaying&&o!==t.latex&&(this.queueSliderLatex(),Te())}toggleAudioTrace(){this.audioTraceActive?this.exitAudioTrace():this.enterAudioTrace()}toggleSliderTrace(){this.sliderTraceActive?this.exitSliderTrace():this.enterSliderTrace()}enterSliderTrace(){if(this.sliderTraceActive)return;this.sliderIndex=0,this.controller.getAllModelsWithSliders().length!==0?(Bt(this.controller.s("graphing-calculator-narration-slider-trace-on")),this.queueSliderLatex(),this.sliderTraceActive=!0):(Bt(this.controller.s("graphing-calculator-narration-slider-trace-no-sliders")),this.sliderTraceActive=!1),Te()}exitSliderTrace(){this.sliderTraceActive&&(Bt(this.controller.s("graphing-calculator-narration-slider-trace-off")),this.sliderTraceActive=!1,this.sliderIndex=0,Te())}recomputePoints(){!this.audioTraceActive||this.agSynthesizer.getIsPlaying()||(this.agNavigator.updatePOI(),this.agNavigator.updateSampledPoints(),this.agNavigator.updateCurrentPoint(),this.agNavigator.resetTracePoint(),this.agNavigator.computeStepSizes())}reportAndMoveToPrevPoint(){Rn(),this.agNavigator.prevPoint(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToNextPoint(){Rn(),this.agNavigator.nextPoint(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToOrigin(){Rn(),this.agNavigator.moveToOrigin(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToPrevPOI(){Rn(),this.agNavigator.prevPOI(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToNextPOI(){Rn(),this.agNavigator.nextPOI(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToFirstPoint(){Rn(),this.agNavigator.firstPoint(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportAndMoveToLastPoint(){Rn(),this.agNavigator.lastPoint(),this.reportAudioTrace(),this.controller.dispatch({type:"render"})}reportX(){Rn(),this.reportAudioTrace({propToSpeak:"x",playSound:!1})}reportY(){Rn(),this.reportAudioTrace({propToSpeak:"y",playSound:!1})}reportColor(){Rn();let e=this.agNavigator.getCurrentSketch();e?Bt(gu(this.controller,e.color)):Bt(this.controller.s("graphing-calculator-narration-color-unknown")),Te()}reportPOICount(){Rn();let e=this.agNavigator.getCurrentSketch(),t=e?e.getPOI().length:0;Te(this.controller.s("graphing-calculator-narration-audio-trace-poi-count",{x:t}))}reportType(){Rn(),this.reportAudioTrace({propToSpeak:"type",playSound:!1})}reportBranch(){Rn(),this.reportAudioTrace({propToSpeak:"branch",playSound:!1})}describePoint(){Rn(),this.reportAudioTrace({playSound:!1}),Te()}playCurrentPoint(){let e=this.agNavigator.getCurrentPoint();e&&this.agSynthesizer.playPoint(e)}reportAudioTrace(e){var a,s;let t=this.agNavigator.getCurrentPoint();if(!t)return;let o=e==null?void 0:e.propToSpeak,i=this.controller.getAudio()&&this.agSynthesizer.getPlaybackSupported()&&((a=e==null?void 0:e.playSound)!=null?a:!0),n=(s=e==null?void 0:e.speakCoordinates)!=null?s:!0;this.agSynthesizer.stop(),i&&this.playCurrentPoint(),n&&(o?this.queueCoordinateProp(t,o):this.queueCoordinates(t),this.lastSpokenBranch=t.reportedBranch?t.reportedBranch:t.branch+1,setTimeout(()=>{Te()},o?0:100))}adjustPlaybackSpeed(e){if(!this.controller.getAudio()){Te(this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled"));return}if(e<0||e>=PC.length)return;this.audioSpeedIndex=e;let t=PC[e];return this.agSynthesizer.setAudioSpeed(t.speed),Te(this.controller.s("graphing-calculator-narration-audio-trace-playback-speed",{speed:t.displayedSpeed}))}speedUp(){this.adjustPlaybackSpeed(this.audioSpeedIndex+1)}speedDown(){this.adjustPlaybackSpeed(this.audioSpeedIndex-1)}adjustVolume(e){if(Rn(),!this.controller.getAudio()){Te(this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled"));return}let t=this.agSynthesizer.getAudioVolume(),o=e==="up"?Math.min(100,Math.round((t+.1)*100)):Math.max(0,Math.round((t-.1)*100));this.agSynthesizer.setAudioVolume(o/100),this.playCurrentPoint(),Te(this.controller.s("graphing-calculator-narration-audio-trace-volume",{volume:o}))}getFocusedTableLocation(){return this.focusedTableLocation}setFocusedTableLocation(e){this.focusedTableLocation=e}getAudioTraceActive(){return this.audioTraceActive}isAudioTracing(){return!!this.agSynthesizer&&this.agSynthesizer.getIsPlaying()}handleEvaluatorChange(e){}hearGraph(){var e,t;if(Rn(),!this.controller.getAudio()){Te(this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled"));return}if(this.agSynthesizer.getPlaybackSupported()){this.agSynthesizer.stop();let o=this.agNavigator.getCurrentSketch();if((t=(e=this.controller).logEvent)==null||t.call(e,{category:"audio-trace",action:"hear-graph"}),o&&ed(this.controller,o)){let i=this.grapher.settings.config.audioTraceSimult?"simultaneous":"sequential";this.agSynthesizer.playCurrentSketch(i),i==="simultaneous"?(this.grapher.traceLayer.setTraceInfo(void 0),requestAnimationFrame(()=>this.animateCurrentSketchLine())):(this.grapher.traceLayer.setTraceLine(void 0),requestAnimationFrame(()=>this.animateCurrentSketchPoint()))}else Te(this.controller.s("graphing-calculator-narration-audio-trace-unable-to-trace-this-expression"))}else Te(this.controller.s("graphing-calculator-narration-audio-trace-unable-to-play"))}animateCurrentSketchPoint(){if(this.graphAnimationTimeoutId&&cancelAnimationFrame(this.graphAnimationTimeoutId),this.graphAnimationTimeoutId=requestAnimationFrame(()=>this.animateCurrentSketchPoint()),!this.agSynthesizer.getIsPlaying())return;let e=this.agSynthesizer.getCurrentIndependentValue(),t=this.agSynthesizer.getCurrentBranchIndex();e!==void 0&&t!==void 0&&this.agNavigator.drawTracePoint(this.agNavigator.getPoint(t,e))}animateCurrentSketchLine(){if(this.graphAnimationTimeoutId&&cancelAnimationFrame(this.graphAnimationTimeoutId),this.graphAnimationTimeoutId=requestAnimationFrame(()=>this.animateCurrentSketchLine()),!this.agSynthesizer.getIsPlaying())return;let e=this.agSynthesizer.getCurrentIndependentValue();e!==void 0&&this.agNavigator.drawTraceLine(e,this.agSynthesizer.getGraphMode())}stopGraph(){this.agSynthesizer.stop(),this.graphAnimationTimeoutId&&cancelAnimationFrame(this.graphAnimationTimeoutId)}getAudioSpeedIndex(){return this.audioSpeedIndex}getAudioVolume(){var e;return(e=this.agSynthesizer.getAudioVolume())!=null?e:.5}};var XG=class{redrawToCtx(e,t){let{ctx:o,projection:i}=e;if(!t)return;o.save(),o.lineWidth=2,o.fillStyle="rgba(0,0,0,.15)",o.strokeStyle="rgba(0,0,0,.4)";let n=i.mapx(t.left),a=i.mapy(t.top),s=i.mapx(t.right),l=i.mapy(t.bottom),c=s-n,d=l-a;o.fillRect(n,a,c,d),o.strokeRect(n,a,c,d),o.restore()}};var _m={};_m.vpmax8={width:170,height:220,margins:{left:5,top:15,right:5,bottom:50}};_m.vpmax11={width:230,height:220,margins:{left:15,top:15,right:5,bottom:5}};_m.etc8={width:96,height:96,margins:{left:5,top:15,right:0,bottom:0}};_m.etc11={width:132,height:134,margins:{left:10,top:15,right:5,bottom:5}};var Au={};__dcg_shared_module_exports__['d'](Au,{UnicodeBraille:()=>Ks,latexToNemeth:()=>Hh,latexToUeb:()=>Kh,nemethToLatex:()=>w3,uebToLatex:()=>v3,version:()=>Mpe});var Aj=Object.defineProperty,zce=Object.getOwnPropertyNames,yj=Object.getOwnPropertySymbols,Hce=Object.prototype.hasOwnProperty,Kce=Object.prototype.propertyIsEnumerable,xj=(r,e,t)=>e in r?Aj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qw=(r,e)=>{for(var t in e||(e={}))Hce.call(e,t)&&xj(r,t,e[t]);if(yj)for(var t of yj(e))Kce.call(e,t)&&xj(r,t,e[t]);return r},Zw=(r=>typeof __dcg_shared_module_exports__['a']!="undefined"?__dcg_shared_module_exports__['a']:typeof Proxy!="undefined"?new Proxy(r,{get:(e,t)=>(typeof __dcg_shared_module_exports__['a']!="undefined"?__dcg_shared_module_exports__['a']:e)[t]}):r)(function(r){if(typeof __dcg_shared_module_exports__['a']!="undefined")return __dcg_shared_module_exports__['a'].apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')}),c3=(r,e)=>function(){return e||(0,r[zce(r)[0]])((e={exports:{}}).exports,e),e.exports},d3=(r,e)=>{for(var t in e)Aj(r,t,{get:e[t],enumerable:!0})},Wce=c3({"generated/latex.jison.js"(r,e){"use strict";var t=function(){var o=function(x,L,R,N){for(R=R||{},N=x.length;N--;R[x[N]]=L);return R},i=[1,13],n=[1,14],a=[1,15],s=[1,16],l=[1,17],c=[1,21],d=[1,18],p=[1,19],u=[1,20],h=[1,22],m=[1,23],y=[1,28],w=[1,30],S=[1,31],C=[1,32],v=[1,33],E=[1,29],_=[5,21,27,38],T=[5,19,21,22,23,24,25,26,27,28,32,33,34,35,36,37,38],I=[5,10,12,13,14,19,21,22,23,24,25,26,27,28,32,33,34,35,36,37,38],P=[5,10,19,21,22,23,24,25,26,27,28,32,33,34,35,36,37,38],O={trace:function(){},yy:{},symbols_:{error:2,sentence:3,group:4,EOF:5,level:6,expression:7,subscript:8,superscript:9,_:10,atom:11,"^":12,"PRIMES^":13,PRIMES:14,delimited_group:15,typeform:16,frac:17,radical:18,LEFT:19,delimiter:20,RIGHT:21,FRAC:22,OPERATOR_NAME:23,MATHRM:24,TEXT:25,RADICAL_OPTARG:26,CLOSE_OPTARG:27,RADICAL:28,curly_group:29,greek:30,command:31,SYMBOL:32,DELIMITER:33,DELIMITER_COMMAND:34,GREEK:35,COMMAND:36,"{":37,"}":38,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",10:"_",12:"^",13:"PRIMES^",14:"PRIMES",19:"LEFT",21:"RIGHT",22:"FRAC",23:"OPERATOR_NAME",24:"MATHRM",25:"TEXT",26:"RADICAL_OPTARG",27:"CLOSE_OPTARG",28:"RADICAL",32:"SYMBOL",33:"DELIMITER",34:"DELIMITER_COMMAND",35:"GREEK",36:"COMMAND",37:"{",38:"}"},productions_:[0,[3,2],[3,1],[4,3],[4,2],[4,1],[4,2],[4,1],[6,2],[6,2],[6,1],[6,1],[8,2],[9,2],[9,2],[9,1],[7,1],[7,1],[7,1],[7,1],[7,1],[15,5],[15,4],[17,3],[16,2],[16,2],[16,2],[18,4],[18,3],[18,2],[18,2],[11,1],[11,1],[11,1],[11,1],[11,1],[20,1],[20,1],[30,1],[31,1],[29,3],[29,2]],performAction:function(L,R,N,z,A,U,pe){var q=U.length-1;switch(A){case 1:return U[q-1];case 2:return z.group();case 3:this.$=z.group(U[q-2],U[q-1],U[q]);break;case 4:case 6:this.$=z.group(U[q-1],U[q]);break;case 5:case 7:this.$=z.group(U[q]);break;case 8:this.$=z.level({_:z.group(U[q-1]),"^":z.group(U[q])});break;case 9:this.$=z.level({_:z.group(U[q]),"^":z.group(U[q-1])});break;case 10:this.$=z.level({"^":z.group(U[q])});break;case 11:this.$=z.level({_:z.group(U[q])});break;case 12:case 13:this.$=U[q];break;case 14:this.$=z.processPrimes(U[q-1],U[q]);break;case 15:this.$=z.processPrimes(U[q],z.group());break;case 21:this.$=z.group(U[q-3],U[q-2],U[q]);break;case 22:this.$=z.group(U[q-2],U[q]);break;case 23:this.$=z.fraction(z.group(U[q-1]),z.group(U[q]));break;case 24:this.$=z.typeform("operator_name",z.group(U[q]));break;case 25:this.$=z.typeform("mathrm",z.group(U[q]));break;case 26:this.$=z.typeform("text",z.group(U[q]));break;case 27:this.$=z.radical(U[q],z.group(U[q-2]));break;case 28:this.$=z.radical(z.group(U[q]),z.group());break;case 29:case 30:this.$=z.radical(z.group(U[q]));break;case 35:case 36:this.$=z.terminal(U[q]);break;case 37:case 39:this.$=z.command(U[q]);break;case 38:this.$=z.greek(U[q]);break;case 40:this.$=U[q-1];break;case 41:this.$=z.group();break}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,10:i,11:12,12:n,13:a,14:s,15:8,16:9,17:10,18:11,19:l,20:25,22:c,23:d,24:p,25:u,26:h,28:m,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{1:[3]},{5:[1,34]},{1:[2,2]},o(_,[2,5],{15:8,16:9,17:10,18:11,11:12,29:24,20:25,30:26,31:27,7:35,19:l,22:c,23:d,24:p,25:u,26:h,28:m,32:y,33:w,34:S,35:C,36:v,37:E}),o(_,[2,7],{6:4,7:5,8:6,9:7,15:8,16:9,17:10,18:11,11:12,29:24,20:25,30:26,31:27,4:36,10:i,12:n,13:a,14:s,19:l,22:c,23:d,24:p,25:u,26:h,28:m,32:y,33:w,34:S,35:C,36:v,37:E}),o(T,[2,11],{9:37,12:n,13:a,14:s}),o(T,[2,10],{8:38,10:i}),o(I,[2,16]),o(I,[2,17]),o(I,[2,18]),o(I,[2,19]),o(I,[2,20]),{11:39,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:40,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:41,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},o(P,[2,15]),{20:42,33:w,34:S},{11:43,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:44,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:45,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:46,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{4:47,6:4,7:5,8:6,9:7,10:i,11:12,12:n,13:a,14:s,15:8,16:9,17:10,18:11,19:l,20:25,22:c,23:d,24:p,25:u,26:h,27:[1,48],28:m,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{11:49,17:50,20:25,22:c,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},o(I,[2,31]),o(I,[2,32]),o(I,[2,33]),o(I,[2,34]),o(I,[2,35]),{4:51,6:4,7:5,8:6,9:7,10:i,11:12,12:n,13:a,14:s,15:8,16:9,17:10,18:11,19:l,20:25,22:c,23:d,24:p,25:u,26:h,28:m,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E,38:[1,52]},o(I,[2,36]),o(I,[2,37]),o(I,[2,38]),o(I,[2,39]),{1:[2,1]},o(_,[2,4],{6:4,7:5,8:6,9:7,15:8,16:9,17:10,18:11,11:12,29:24,20:25,30:26,31:27,4:53,10:i,12:n,13:a,14:s,19:l,22:c,23:d,24:p,25:u,26:h,28:m,32:y,33:w,34:S,35:C,36:v,37:E}),o(_,[2,6]),o(T,[2,8]),o(T,[2,9]),o([5,12,13,14,19,21,22,23,24,25,26,27,28,32,33,34,35,36,37,38],[2,12]),o(P,[2,13]),o(P,[2,14]),{4:54,6:4,7:5,8:6,9:7,10:i,11:12,12:n,13:a,14:s,15:8,16:9,17:10,18:11,19:l,20:25,21:[1,55],22:c,23:d,24:p,25:u,26:h,28:m,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},o(I,[2,24]),o(I,[2,25]),o(I,[2,26]),{11:56,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},{27:[1,57]},{11:58,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},o(I,[2,29]),o(I,[2,30]),{38:[1,59]},o(I,[2,41]),o(_,[2,3]),{21:[1,60]},{20:61,33:w,34:S},o(I,[2,23]),{11:62,20:25,29:24,30:26,31:27,32:y,33:w,34:S,35:C,36:v,37:E},o(I,[2,28]),o(I,[2,40]),{20:63,33:w,34:S},o(I,[2,22]),o(I,[2,27]),o(I,[2,21])],defaultActions:{3:[2,2],34:[2,1]},parseError:function(L,R){if(R.recoverable)this.trace(L);else{var N=new Error(L);throw N.hash=R,N}},parse:function(L){var R=this,N=[0],z=[],A=[null],U=[],pe=this.table,q="",F=0,ge=0,ne=0,ae=2,j=1,oe=U.slice.call(arguments,1),Y=Object.create(this.lexer),fe={yy:{}};for(var ye in this.yy)Object.prototype.hasOwnProperty.call(this.yy,ye)&&(fe.yy[ye]=this.yy[ye]);Y.setInput(L,fe.yy),fe.yy.lexer=Y,fe.yy.parser=this,typeof Y.yylloc=="undefined"&&(Y.yylloc={});var Ce=Y.yylloc;U.push(Ce);var De=Y.options&&Y.options.ranges;typeof fe.yy.parseError=="function"?this.parseError=fe.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Ge(Br){N.length=N.length-2*Br,A.length=A.length-Br,U.length=U.length-Br}for(var Ye=function(){var Br;return Br=Y.lex()||j,typeof Br!="number"&&(Br=R.symbols_[Br]||Br),Br},Q,ee,we,Me,$e,me,rt={},vt,Re,Xt,Ft;;){if(we=N[N.length-1],this.defaultActions[we]?Me=this.defaultActions[we]:((Q===null||typeof Q=="undefined")&&(Q=Ye()),Me=pe[we]&&pe[we][Q]),typeof Me=="undefined"||!Me.length||!Me[0]){var Nt="";Ft=[];for(vt in pe[we])this.terminals_[vt]&&vt>ae&&Ft.push("'"+this.terminals_[vt]+"'");Y.showPosition?Nt="Parse error on line "+(F+1)+`:
`+Y.showPosition()+`
Expecting `+Ft.join(", ")+", got '"+(this.terminals_[Q]||Q)+"'":Nt="Parse error on line "+(F+1)+": Unexpected "+(Q==j?"end of input":"'"+(this.terminals_[Q]||Q)+"'"),this.parseError(Nt,{text:Y.match,token:this.terminals_[Q]||Q,line:Y.yylineno,loc:Ce,expected:Ft})}if(Me[0]instanceof Array&&Me.length>1)throw new Error("Parse Error: multiple actions possible at state: "+we+", token: "+Q);switch(Me[0]){case 1:N.push(Q),A.push(Y.yytext),U.push(Y.yylloc),N.push(Me[1]),Q=null,ee?(Q=ee,ee=null):(ge=Y.yyleng,q=Y.yytext,F=Y.yylineno,Ce=Y.yylloc,ne>0&&ne--);break;case 2:if(Re=this.productions_[Me[1]][1],rt.$=A[A.length-Re],rt._$={first_line:U[U.length-(Re||1)].first_line,last_line:U[U.length-1].last_line,first_column:U[U.length-(Re||1)].first_column,last_column:U[U.length-1].last_column},De&&(rt._$.range=[U[U.length-(Re||1)].range[0],U[U.length-1].range[1]]),me=this.performAction.apply(rt,[q,ge,F,fe.yy,Me[1],A,U].concat(oe)),typeof me!="undefined")return me;Re&&(N=N.slice(0,-1*Re*2),A=A.slice(0,-1*Re),U=U.slice(0,-1*Re)),N.push(this.productions_[Me[1]][0]),A.push(rt.$),U.push(rt._$),Xt=pe[N[N.length-2]][N[N.length-1]],N.push(Xt);break;case 3:return!0}}return!0}},W=function(){var x={EOF:1,parseError:function(R,N){if(this.yy.parser)this.yy.parser.parseError(R,N);else throw new Error(R)},setInput:function(L,R){return this.yy=R||this.yy||{},this._input=L,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var L=this._input[0];this.yytext+=L,this.yyleng++,this.offset++,this.match+=L,this.matched+=L;var R=L.match(/(?:\r\n?|\n).*/g);return R?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),L},unput:function(L){var R=L.length,N=L.split(/(?:\r\n?|\n)/g);this._input=L+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-R),this.offset-=R;var z=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),N.length-1&&(this.yylineno-=N.length-1);var A=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:N?(N.length===z.length?this.yylloc.first_column:0)+z[z.length-N.length].length-N[0].length:this.yylloc.first_column-R},this.options.ranges&&(this.yylloc.range=[A[0],A[0]+this.yyleng-R]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(L){this.unput(this.match.slice(L))},pastInput:function(){var L=this.matched.substr(0,this.matched.length-this.match.length);return(L.length>20?"...":"")+L.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var L=this.match;return L.length<20&&(L+=this._input.substr(0,20-L.length)),(L.substr(0,20)+(L.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var L=this.pastInput(),R=new Array(L.length+1).join("-");return L+this.upcomingInput()+`
`+R+"^"},test_match:function(L,R){var N,z,A;if(this.options.backtrack_lexer&&(A={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(A.yylloc.range=this.yylloc.range.slice(0))),z=L[0].match(/(?:\r\n?|\n).*/g),z&&(this.yylineno+=z.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:z?z[z.length-1].length-z[z.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+L[0].length},this.yytext+=L[0],this.match+=L[0],this.matches=L,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(L[0].length),this.matched+=L[0],N=this.performAction.call(this,this.yy,this,R,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),N)return N;if(this._backtrack){for(var U in A)this[U]=A[U];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var L,R,N,z;this._more||(this.yytext="",this.match="");for(var A=this._currentRules(),U=0;U<A.length;U++)if(N=this._input.match(this.rules[A[U]]),N&&(!R||N[0].length>R[0].length)){if(R=N,z=U,this.options.backtrack_lexer){if(L=this.test_match(N,A[U]),L!==!1)return L;if(this._backtrack){R=!1;continue}else return!1}else if(!this.options.flex)break}return R?(L=this.test_match(R,A[z]),L!==!1?L:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var R=this.next();return R||this.lex()},begin:function(R){this.conditionStack.push(R)},popState:function(){var R=this.conditionStack.length-1;return R>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(R){return R=this.conditionStack.length-1-Math.abs(R||0),R>=0?this.conditionStack[R]:"INITIAL"},pushState:function(R){this.begin(R)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(R,N,z,A){var U=A;switch(z){case 0:break;case 1:return this.begin("optarg"),26;break;case 2:return this.popState(),27;break;case 3:return 23;case 4:return 24;case 5:return 25;case 6:return 28;case 7:return 22;case 8:return 13;case 9:return 14;case 10:return 12;case 11:return 10;case 12:return 19;case 13:return 21;case 14:return 34;case 15:return 33;case 16:return 37;case 17:return 38;case 18:return 32;case 19:return 32;case 20:return 32;case 21:return 35;case 22:return 35;case 23:return 36;case 24:return 32;case 25:return 5}},rules:[/^(?:\s+)/,/^(?:(\\sqrt)\s*\[)/,/^(?:\])/,/^(?:(\\operatorname))/,/^(?:(\\mathrm))/,/^(?:(\\text))/,/^(?:(\\sqrt))/,/^(?:(\\frac))/,/^(?:'+\^)/,/^(?:'+)/,/^(?:\^)/,/^(?:[_])/,/^(?:(\\left))/,/^(?:(\\right))/,/^(?:(\\langle|\\rangle|\\vert|\\Vert))/,/^(?:\[|\]|\\\{|\\\}|\(|\)|\||\\\|)/,/^(?:\{)/,/^(?:\})/,/^(?:\\(infty))/,/^(?:\\(int))/,/^(?:!)/,/^(?:\\(alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|omicron|pi|rho|sigma|tau|xi|upsilon|phi|chi|psi|omega))/,/^(?:\\(Alpha|Beta|Gamma|Delta|Epsilon|Zeta|Eta|Theta|Iota|Kappa|Lambda|Mu|Nu|Omicron|Pi|Rho|Sigma|Tau|Xi|Upsilon|Phi|Chi|Psi|Omega))/,/^(?:\\[A-Za-z]+)/,/^(?:\\.|.)/,/^(?:$)/],conditions:{optarg:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0},INITIAL:{rules:[0,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return x}();O.lexer=W;function X(){this.yy={}}return X.prototype=O,O.Parser=X,new X}();typeof Zw!="undefined"&&typeof r!="undefined"&&(r.parser=t,r.Parser=t.Parser,r.parse=function(){return t.parse.apply(t,arguments)},r.main=function(){},typeof e!="undefined"&&Zw.main===e&&r.main(process.argv.slice(1)))}}),Vj=c3({"generated/nemeth-to-latex.jison.js"(r,e){"use strict";var t=function(){var o=function(Br,de,se,He){for(se=se||{},He=Br.length;He--;se[Br[He]]=de);return se},i=[1,11],n=[1,12],a=[1,13],s=[1,79],l=[1,80],c=[1,77],d=[1,78],p=[1,39],u=[1,40],h=[1,67],m=[1,68],y=[1,69],w=[1,70],S=[1,71],C=[1,72],v=[1,73],E=[1,74],_=[1,75],T=[1,76],I=[1,41],P=[1,35],O=[1,36],W=[1,37],X=[1,38],x=[1,42],L=[1,43],R=[1,44],N=[1,45],z=[1,46],A=[1,47],U=[1,48],pe=[1,49],q=[1,50],F=[1,51],ge=[1,52],ne=[1,53],ae=[1,54],j=[1,55],oe=[1,56],Y=[1,57],fe=[1,58],ye=[1,59],Ce=[1,60],De=[1,61],Ge=[1,17],Ye=[1,62],Q=[1,63],ee=[1,64],we=[1,65],Me=[1,66],$e=[5,12,13,14,18,24,25],me=[5,11,12,13,14,15,17,18,20,21,23,24,25,27,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91],rt=[1,84],vt=[5,11,12,13,14,15,17,18,20,21,23,24,25,27,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,91],Re=[5,11,12,13,14,15,17,18,20,21,23,24,25,27,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91],Xt={trace:function(){},yy:{},symbols_:{error:2,sentence:3,group:4,EOF:5,element:6,index_element:7,modified_expression:8,radical:9,primes:10,OPEN_MODEXP:11,MODEXP_UNDER:12,MODEXP_OVER:13,CLOSE_MODEXP:14,RADICAL_INDEX:15,index_group:16,OPEN_RADICAL:17,CLOSE_RADICAL:18,level:19,LEVEL:20,BASELINE:21,frac:22,OPEN_FRAC:23,SLASH:24,CLOSE_FRAC:25,geo_token:26,GEO_TOKEN:27,number:28,subscript_head:29,atom:30,command:31,greek:32,letter:33,comma:34,period:35,space:36,operation:37,comparison:38,level_with_comparison:39,ellipsis:40,colon:41,infinity:42,integral:43,factorial:44,ampersand:45,question_mark:46,bracket:47,",":48,".":49,"[":50,"{":51,"(":52,"]":53,"}":54,")":55,LANGLE:56,RANGLE:57,PIPE:58,DOUBLE_PIPE:59,SPACE:60,COMMAND:61,GREEK:62,LETTER:63,CAPITAL_LETTER:64,"+":65,"-":66,CDOT:67,TIMES:68,"*":69,"/":70,DIV:71,PERCENT_OF:72,PERCENT:73,MEASURED_ANGLE:74,ANGLE:75,CIRCLE:76,PARALLELOGRAM:77,TO:78,TRIANGLE:79,DEGREE:80,COMPARISON:81,LEVEL_WITH_COMPARISON:82,ELLIPSIS:83,COLON:84,NUMBER:85,INFINITY:86,INTEGRAL:87,FACTORIAL:88,"&":89,PRIMES:90,"?":91,unknown:92,UNKNOWN:93,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",11:"OPEN_MODEXP",12:"MODEXP_UNDER",13:"MODEXP_OVER",14:"CLOSE_MODEXP",15:"RADICAL_INDEX",17:"OPEN_RADICAL",18:"CLOSE_RADICAL",20:"LEVEL",21:"BASELINE",23:"OPEN_FRAC",24:"SLASH",25:"CLOSE_FRAC",27:"GEO_TOKEN",48:",",49:".",50:"[",51:"{",52:"(",53:"]",54:"}",55:")",56:"LANGLE",57:"RANGLE",58:"PIPE",59:"DOUBLE_PIPE",60:"SPACE",61:"COMMAND",62:"GREEK",63:"LETTER",64:"CAPITAL_LETTER",65:"+",66:"-",67:"CDOT",68:"TIMES",69:"*",70:"/",71:"DIV",72:"PERCENT_OF",73:"PERCENT",74:"MEASURED_ANGLE",75:"ANGLE",76:"CIRCLE",77:"PARALLELOGRAM",78:"TO",79:"TRIANGLE",80:"DEGREE",81:"COMPARISON",82:"LEVEL_WITH_COMPARISON",83:"ELLIPSIS",84:"COLON",85:"NUMBER",86:"INFINITY",87:"INTEGRAL",88:"FACTORIAL",89:"&",90:"PRIMES",91:"?",93:"UNKNOWN"},productions_:[0,[3,2],[3,1],[4,2],[4,1],[6,1],[6,1],[6,2],[6,1],[8,7],[8,6],[8,5],[8,6],[8,5],[8,5],[8,4],[8,4],[8,3],[8,4],[8,4],[8,4],[8,4],[8,3],[8,3],[8,2],[9,5],[9,4],[9,4],[9,3],[9,3],[9,2],[19,1],[19,1],[22,5],[22,4],[22,4],[22,3],[26,2],[16,2],[16,1],[7,3],[7,2],[7,2],[7,3],[7,2],[7,2],[7,1],[7,1],[7,1],[29,1],[29,1],[29,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[30,1],[34,1],[35,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[36,1],[31,1],[32,1],[33,1],[33,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[37,1],[38,1],[39,1],[40,1],[41,1],[28,1],[42,1],[43,1],[44,1],[45,1],[10,1],[46,1],[92,1]],performAction:function(de,se,He,xe,at,We,to){var Dt=We.length-1;switch(at){case 1:return We[Dt-1];case 2:return xe.group();case 3:case 38:case 42:case 44:case 45:this.$=xe.group(We[Dt-1],We[Dt]);break;case 4:case 39:this.$=xe.group(We[Dt]);break;case 7:this.$=xe.group(We[Dt-1],We[Dt]);break;case 9:this.$=xe.modified_expression(We[Dt-5],We[Dt-3],We[Dt-1]);break;case 10:this.$=xe.modified_expression(We[Dt-4],We[Dt-2]);break;case 11:this.$=xe.modified_expression(We[Dt-3],We[Dt-1]);break;case 12:this.$=xe.modified_expression(We[Dt-4],xe.group(),We[Dt-1]);break;case 13:this.$=xe.modified_expression(We[Dt-3],xe.group(),We[Dt-1]);break;case 14:this.$=xe.modified_expression(We[Dt-3],xe.group(),xe.group());break;case 15:case 16:this.$=xe.modified_expression(We[Dt-2],xe.group());break;case 17:this.$=xe.modified_expression(We[Dt-1]);break;case 18:case 19:case 22:case 23:case 24:this.$=xe.modified_expression(xe.group());break;case 20:case 21:xe.warnOrError("Multi-level modified expressions are not supported."),this.$=xe.modified_expression(xe.group());break;case 25:this.$=xe.radical(We[Dt-1],We[Dt-3]);break;case 26:this.$=xe.radical(We[Dt-1],xe.group());break;case 27:this.$=xe.radical(xe.group(),We[Dt-2]);break;case 28:this.$=xe.radical(xe.group(),xe.group());break;case 29:this.$=xe.radical(We[Dt-1]);break;case 30:this.$=xe.radical(xe.group());break;case 31:this.$=xe.level(We[Dt]);break;case 32:this.$=xe.baseline();break;case 33:this.$=xe.fraction(We[Dt-3],We[Dt-1]);break;case 34:this.$=xe.fraction(We[Dt-2],xe.group());break;case 35:this.$=xe.fraction(xe.group(),We[Dt-1]);break;case 36:this.$=xe.fraction(xe.group(),xe.group());break;case 37:this.$=xe.geo_token(We[Dt]);break;case 40:this.$=xe.group(xe.simple_subscript(We[Dt-2],We[Dt]),We[Dt-1]);break;case 41:this.$=xe.simple_subscript(We[Dt-1],We[Dt]);break;case 43:xe.warnOrError("Illegal use of Nemeth primes"),this.$=xe.group(xe.simple_subscript(We[Dt-2],We[Dt-1]),We[Dt]);break;case 69:this.$=xe.terminal(",");break;case 70:this.$=xe.terminal(".");break;case 71:this.$=xe.terminal("[");break;case 72:this.$=xe.terminal("\\{");break;case 73:this.$=xe.terminal("(");break;case 74:this.$=xe.terminal("]");break;case 75:this.$=xe.terminal("\\}");break;case 76:this.$=xe.terminal(")");break;case 77:this.$=xe.terminal("\\langle ");break;case 78:this.$=xe.terminal("\\rangle ");break;case 79:this.$=xe.terminal("|");break;case 80:this.$=xe.terminal("\\|");break;case 81:this.$=xe.terminal(" ");break;case 82:this.$=xe.command(We[Dt].toLowerCase());break;case 83:this.$=xe.terminal(xe.greek(We[Dt]));break;case 84:this.$=xe.terminal(We[Dt].toLowerCase());break;case 85:this.$=xe.terminal(We[Dt].toUpperCase());break;case 86:this.$=xe.terminal("+");break;case 87:this.$=xe.terminal("-");break;case 88:this.$=xe.terminal("\\cdot ");break;case 89:this.$=xe.terminal("\\times ");break;case 90:this.$=xe.terminal("*");break;case 91:this.$=xe.terminal("/");break;case 92:this.$=xe.terminal("\\div ");break;case 93:this.$=xe.terminal("\\%\\operatorname{of}");break;case 94:this.$=xe.terminal("\\%");break;case 95:this.$=xe.terminal("\\measuredangle ");break;case 96:this.$=xe.terminal("\\angle ");break;case 97:this.$=xe.terminal("\\bigcirc ");break;case 98:this.$=xe.terminal("\\parallelogram ");break;case 99:this.$=xe.terminal("\\to ");break;case 100:this.$=xe.terminal("\\triangle ");break;case 101:this.$=xe.terminal("\\degree ");break;case 102:this.$=xe.comparison(We[Dt].trim());break;case 103:this.$=xe.level_with_comparison(We[Dt].trim());break;case 104:this.$=xe.terminal("\\ldots ");break;case 105:this.$=xe.terminal(":");break;case 106:this.$=xe.terminal(We[Dt]);break;case 107:this.$=xe.terminal("\\infty ");break;case 108:this.$=xe.terminal("\\int ");break;case 109:this.$=xe.terminal("!");break;case 110:this.$=xe.terminal("\\&");break;case 111:this.$=xe.primes(We[Dt]);break;case 112:this.$=xe.terminal("?");break}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,11:i,15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{1:[3]},{5:[1,81]},{1:[2,2]},o($e,[2,4],{6:4,7:5,8:6,9:7,29:8,28:9,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,22:32,26:33,19:34,4:82,11:i,15:n,17:a,20:s,21:l,23:c,27:d,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me}),o(me,[2,5]),o(me,[2,6]),o(me,[2,8],{10:83,90:rt}),o(vt,[2,46],{10:85,28:86,85:Ge,90:rt}),o(me,[2,47],{10:87,90:rt}),o(me,[2,48],{10:88,90:rt}),{4:89,6:4,7:5,8:6,9:7,11:i,12:[1,91],13:[1,90],14:[1,92],15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{7:95,16:93,17:[1,94],19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{4:96,6:4,7:5,8:6,9:7,11:i,15:n,17:a,18:[1,97],19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},o(Re,[2,49]),o(Re,[2,50]),o(Re,[2,51]),o(Re,[2,106]),o(Re,[2,52]),o(Re,[2,53]),o(Re,[2,54]),o(Re,[2,55]),o(Re,[2,56]),o(Re,[2,57]),o(Re,[2,58]),o(Re,[2,59]),o(Re,[2,60]),o(Re,[2,61]),o(Re,[2,62]),o(Re,[2,63]),o(Re,[2,64]),o(Re,[2,65]),o(Re,[2,66]),o(Re,[2,67]),o(Re,[2,68]),o(Re,[2,82]),o(Re,[2,83]),o(Re,[2,84]),o(Re,[2,85]),o(Re,[2,69]),o(Re,[2,70]),o(Re,[2,81]),o(Re,[2,86]),o(Re,[2,87]),o(Re,[2,88]),o(Re,[2,89]),o(Re,[2,90]),o(Re,[2,91]),o(Re,[2,92]),o(Re,[2,93]),o(Re,[2,94]),o(Re,[2,95]),o(Re,[2,96]),o(Re,[2,97]),o(Re,[2,98]),o(Re,[2,99]),o(Re,[2,100]),o(Re,[2,101]),o(Re,[2,102]),o(Re,[2,103]),o(Re,[2,104]),o(Re,[2,105]),o(Re,[2,107]),o(Re,[2,108]),o(Re,[2,109]),o(Re,[2,110]),o(Re,[2,112]),o(Re,[2,71]),o(Re,[2,72]),o(Re,[2,73]),o(Re,[2,74]),o(Re,[2,75]),o(Re,[2,76]),o(Re,[2,77]),o(Re,[2,78]),o(Re,[2,79]),o(Re,[2,80]),{4:98,6:4,7:5,8:6,9:7,11:i,15:n,17:a,19:34,20:s,21:l,22:32,23:c,24:[1,99],26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{28:100,85:Ge},o(Re,[2,31]),o(Re,[2,32]),{1:[2,1]},o($e,[2,3]),o(me,[2,7]),o(me,[2,111]),o(vt,[2,42],{28:101,85:Ge}),o(me,[2,41],{10:102,90:rt}),o(me,[2,44]),o(me,[2,45]),{12:[1,103],13:[1,104],14:[1,105]},{12:[1,106],13:[1,107],14:[1,108]},{12:[1,110],13:[1,109],14:[1,111]},o(me,[2,24]),{17:[1,112]},{4:113,6:4,7:5,8:6,9:7,11:i,15:n,17:a,18:[1,114],19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{7:95,16:115,17:[2,39],19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{18:[1,116]},o(Re,[2,30]),{24:[1,117]},{4:118,6:4,7:5,8:6,9:7,11:i,15:n,17:a,19:34,20:s,21:l,22:32,23:c,25:[1,119],26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},o(Re,[2,37]),o(me,[2,40]),o(me,[2,43]),{4:120,6:4,7:5,8:6,9:7,11:i,13:[1,121],14:[1,122],15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{4:123,6:4,7:5,8:6,9:7,11:i,14:[1,124],15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},o(me,[2,17]),{14:[1,125]},{14:[1,126]},o(me,[2,22]),{14:[1,127]},{14:[1,128]},o(me,[2,23]),{4:129,6:4,7:5,8:6,9:7,11:i,15:n,17:a,18:[1,130],19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{18:[1,131]},o(Re,[2,28]),{17:[2,38]},o(Re,[2,29]),{4:132,6:4,7:5,8:6,9:7,11:i,15:n,17:a,19:34,20:s,21:l,22:32,23:c,25:[1,133],26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},{25:[1,134]},o(Re,[2,36]),{13:[1,135],14:[1,136]},{4:137,6:4,7:5,8:6,9:7,11:i,14:[1,138],15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},o(me,[2,16]),{14:[1,139]},o(me,[2,15]),o(me,[2,18]),o(me,[2,20]),o(me,[2,19]),o(me,[2,21]),{18:[1,140]},o(Re,[2,27]),o(Re,[2,26]),{25:[1,141]},o(Re,[2,34]),o(Re,[2,35]),{4:142,6:4,7:5,8:6,9:7,11:i,14:[1,143],15:n,17:a,19:34,20:s,21:l,22:32,23:c,26:33,27:d,28:9,29:8,30:10,31:14,32:15,33:16,34:18,35:19,36:20,37:21,38:22,39:23,40:24,41:25,42:26,43:27,44:28,45:29,46:30,47:31,48:p,49:u,50:h,51:m,52:y,53:w,54:S,55:C,56:v,57:E,58:_,59:T,60:I,61:P,62:O,63:W,64:X,65:x,66:L,67:R,68:N,69:z,70:A,71:U,72:pe,73:q,74:F,75:ge,76:ne,77:ae,78:j,79:oe,80:Y,81:fe,82:ye,83:Ce,84:De,85:Ge,86:Ye,87:Q,88:ee,89:we,91:Me},o(me,[2,11]),{14:[1,144]},o(me,[2,14]),o(me,[2,13]),o(Re,[2,25]),o(Re,[2,33]),{14:[1,145]},o(me,[2,10]),o(me,[2,12]),o(me,[2,9])],defaultActions:{3:[2,2],81:[2,1],115:[2,38]},parseError:function(de,se){if(se.recoverable)this.trace(de);else{var He=new Error(de);throw He.hash=se,He}},parse:function(de){var se=this,He=[0],xe=[],at=[null],We=[],to=this.table,Dt="",sa=0,No=0,bi=0,tt=2,St=1,Vt=We.slice.call(arguments,1),_e=Object.create(this.lexer),ce={yy:{}};for(var Se in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Se)&&(ce.yy[Se]=this.yy[Se]);_e.setInput(de,ce.yy),ce.yy.lexer=_e,ce.yy.parser=this,typeof _e.yylloc=="undefined"&&(_e.yylloc={});var Qe=_e.yylloc;We.push(Qe);var Fe=_e.options&&_e.options.ranges;typeof ce.yy.parseError=="function"?this.parseError=ce.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function kt(hn){He.length=He.length-2*hn,at.length=at.length-hn,We.length=We.length-hn}for(var It=function(){var hn;return hn=_e.lex()||St,typeof hn!="number"&&(hn=se.symbols_[hn]||hn),hn},Kt,hr,rr,ir,Rt,yr,_r={},Fi,$n,la,Wi;;){if(rr=He[He.length-1],this.defaultActions[rr]?ir=this.defaultActions[rr]:((Kt===null||typeof Kt=="undefined")&&(Kt=It()),ir=to[rr]&&to[rr][Kt]),typeof ir=="undefined"||!ir.length||!ir[0]){var yi="";Wi=[];for(Fi in to[rr])this.terminals_[Fi]&&Fi>tt&&Wi.push("'"+this.terminals_[Fi]+"'");_e.showPosition?yi="Parse error on line "+(sa+1)+`:
`+_e.showPosition()+`
Expecting `+Wi.join(", ")+", got '"+(this.terminals_[Kt]||Kt)+"'":yi="Parse error on line "+(sa+1)+": Unexpected "+(Kt==St?"end of input":"'"+(this.terminals_[Kt]||Kt)+"'"),this.parseError(yi,{text:_e.match,token:this.terminals_[Kt]||Kt,line:_e.yylineno,loc:Qe,expected:Wi})}if(ir[0]instanceof Array&&ir.length>1)throw new Error("Parse Error: multiple actions possible at state: "+rr+", token: "+Kt);switch(ir[0]){case 1:He.push(Kt),at.push(_e.yytext),We.push(_e.yylloc),He.push(ir[1]),Kt=null,hr?(Kt=hr,hr=null):(No=_e.yyleng,Dt=_e.yytext,sa=_e.yylineno,Qe=_e.yylloc,bi>0&&bi--);break;case 2:if($n=this.productions_[ir[1]][1],_r.$=at[at.length-$n],_r._$={first_line:We[We.length-($n||1)].first_line,last_line:We[We.length-1].last_line,first_column:We[We.length-($n||1)].first_column,last_column:We[We.length-1].last_column},Fe&&(_r._$.range=[We[We.length-($n||1)].range[0],We[We.length-1].range[1]]),yr=this.performAction.apply(_r,[Dt,No,sa,ce.yy,ir[1],at,We].concat(Vt)),typeof yr!="undefined")return yr;$n&&(He=He.slice(0,-1*$n*2),at=at.slice(0,-1*$n),We=We.slice(0,-1*$n)),He.push(this.productions_[ir[1]][0]),at.push(_r.$),We.push(_r._$),la=to[He[He.length-2]][He[He.length-1]],He.push(la);break;case 3:return!0}}return!0}},Ft=function(){var Br={EOF:1,parseError:function(se,He){if(this.yy.parser)this.yy.parser.parseError(se,He);else throw new Error(se)},setInput:function(de,se){return this.yy=se||this.yy||{},this._input=de,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var de=this._input[0];this.yytext+=de,this.yyleng++,this.offset++,this.match+=de,this.matched+=de;var se=de.match(/(?:\r\n?|\n).*/g);return se?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),de},unput:function(de){var se=de.length,He=de.split(/(?:\r\n?|\n)/g);this._input=de+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-se),this.offset-=se;var xe=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),He.length-1&&(this.yylineno-=He.length-1);var at=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:He?(He.length===xe.length?this.yylloc.first_column:0)+xe[xe.length-He.length].length-He[0].length:this.yylloc.first_column-se},this.options.ranges&&(this.yylloc.range=[at[0],at[0]+this.yyleng-se]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(de){this.unput(this.match.slice(de))},pastInput:function(){var de=this.matched.substr(0,this.matched.length-this.match.length);return(de.length>20?"...":"")+de.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var de=this.match;return de.length<20&&(de+=this._input.substr(0,20-de.length)),(de.substr(0,20)+(de.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var de=this.pastInput(),se=new Array(de.length+1).join("-");return de+this.upcomingInput()+`
`+se+"^"},test_match:function(de,se){var He,xe,at;if(this.options.backtrack_lexer&&(at={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(at.yylloc.range=this.yylloc.range.slice(0))),xe=de[0].match(/(?:\r\n?|\n).*/g),xe&&(this.yylineno+=xe.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:xe?xe[xe.length-1].length-xe[xe.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+de[0].length},this.yytext+=de[0],this.match+=de[0],this.matches=de,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(de[0].length),this.matched+=de[0],He=this.performAction.call(this,this.yy,this,se,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),He)return He;if(this._backtrack){for(var We in at)this[We]=at[We];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var de,se,He,xe;this._more||(this.yytext="",this.match="");for(var at=this._currentRules(),We=0;We<at.length;We++)if(He=this._input.match(this.rules[at[We]]),He&&(!se||He[0].length>se[0].length)){if(se=He,xe=We,this.options.backtrack_lexer){if(de=this.test_match(He,at[We]),de!==!1)return de;if(this._backtrack){se=!1;continue}else return!1}else if(!this.options.flex)break}return se?(de=this.test_match(se,at[xe]),de!==!1?de:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var se=this.next();return se||this.lex()},begin:function(se){this.conditionStack.push(se)},popState:function(){var se=this.conditionStack.length-1;return se>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(se){return se=this.conditionStack.length-1-Math.abs(se||0),se>=0?this.conditionStack[se]:"INITIAL"},pushState:function(se){this.begin(se)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(se,He,xe,at){var We=at;switch(xe){case 0:return this.begin("modexp"),11;break;case 1:return 21;case 2:return this.begin("modexp"),11;break;case 3:return 12;case 4:return 13;case 5:return this.popState(),14;break;case 6:return 65;case 7:return 66;case 8:return 67;case 9:return 68;case 10:return 69;case 11:return 70;case 12:return 71;case 13:return 56;case 14:return 50;case 15:return 51;case 16:return 52;case 17:return 57;case 18:return 53;case 19:return 54;case 20:return 55;case 21:return 59;case 22:return 58;case 23:return 84;case 24:return 72;case 25:return 73;case 26:return 74;case 27:return 75;case 28:return 76;case 29:return 77;case 30:return 78;case 31:return 79;case 32:return 80;case 33:return 82;case 34:return 82;case 35:return 82;case 36:return 82;case 37:return 82;case 38:return 82;case 39:return 82;case 40:return 82;case 41:return 82;case 42:return 81;case 43:return 82;case 44:return 82;case 45:return 81;case 46:return 81;case 47:return 81;case 48:return 81;case 49:return 81;case 50:return 81;case 51:return 81;case 52:return 81;case 53:return 81;case 54:return 81;case 55:return 81;case 56:return 83;case 57:return 20;case 58:return 49;case 59:return 21;case 60:return 90;case 61:return 62;case 62:return 15;case 63:return this.begin("radical"),17;break;case 64:return this.popState(),18;break;case 65:return 18;case 66:return 87;case 67:return 89;case 68:return 88;case 69:return 61;case 70:return 61;case 71:return 27;case 72:return He.yytext=this.matches[1],85;break;case 73:return 23;case 74:return 24;case 75:return 25;case 76:return He.yytext=this.matches[1],64;break;case 77:return 63;case 78:return 86;case 79:return 91;case 80:return 48;case 81:return 49;case 82:return 60;case 83:return 5;case 84:return 93}},rules:[/^(?:"(?=[^>\]]+%))/,/^(?:")/,/^(?:"(?=[^>\]]+\]|[^>\]]+%))/,/^(?:%)/,/^(?:<)/,/^(?:\])/,/^(?:[+])/,/^(?:[-])/,/^(?:[*])/,/^(?:[@][*])/,/^(?:[@][\#])/,/^(?:[_][/])/,/^(?:[.][/])/,/^(?:[.][.][(])/,/^(?:[@][(])/,/^(?:[.][(])/,/^(?:[(])/,/^(?:[.][.][)])/,/^(?:[@][)])/,/^(?:[.][)])/,/^(?:[)])/,/^(?:[\\][\\])/,/^(?:[\\])/,/^(?:[_][3])/,/^(?:[@][0][O][F][ ]?)/,/^(?:[@][0])/,/^(?:[M][$][\[][ ])/,/^(?:[$][\[][ ])/,/^(?:[$]C[ ])/,/^(?:[$]G[ ])/,/^(?:[ ][$]O[ ])/,/^(?:[$]T[ ])/,/^(?:[^][.][*])/,/^(?:[ ][\^;]+[.]K[ ])/,/^(?:[\^;]+[=])/,/^(?:[ ][\^;]+[/][.]K[ ])/,/^(?:[ ][\^;]+[@][:][@][:][ ])/,/^(?:[ ][\^;]+["]K[:][ ])/,/^(?:[ ][\^;]+[.]1[:][ ])/,/^(?:[ ][\^;]+["]K[ ])/,/^(?:[ ][\^;]+[.]1[ ])/,/^(?:[ ][\^;]+[/][$][L][ ])/,/^(?:[ ][.]K[ ])/,/^(?:[ ][\^;]+[/]?[$][L][ ])/,/^(?:[ ][\^;]+[$]P[ ])/,/^(?:[=])/,/^(?:[ ][/][.]K[ ])/,/^(?:[ ][@][:][@][:][ ])/,/^(?:[ ][/]?[@][:][.][K][ ])/,/^(?:[ ]["]K[:][ ])/,/^(?:[ ][.]1[:][ ])/,/^(?:[ ]["]K[ ])/,/^(?:[ ][.]1[ ])/,/^(?:[/]?[@][:])/,/^(?:[ ][/]?[$][L][ ])/,/^(?:[ ][$]P[ ])/,/^(?:[ ]['][']['][ ])/,/^(?:[\^;]+)/,/^(?:[.]["])/,/^(?:["])/,/^(?:[']+)/,/^(?:[.][,]?[ABGDEZ\?\:IKLMNXOPRSTUYF\&W])/,/^(?:[.]*[<])/,/^(?:[.]*[>])/,/^(?:[.]*\])/,/^(?:[.]*\])/,/^(?:!)/,/^(?:[_]&)/,/^(?:&)/,/^(?:(ARC)?(SIN|COS|TAN|CSC|SEC|COT)(H)?)/,/^(?:(ARG|DET|EXP|IM|INF|LIM|LN|LOG|MAX|MIN|MOD|RE|SUP))/,/^(?:(TOKEN)[ ]?)/,/^(?:#?(\d*\.?\d+))/,/^(?:[,]*[?])/,/^(?:[,]*[/])/,/^(?:[,]*#)/,/^(?:[,]([A-Z]))/,/^(?:[A-Z])/,/^(?:[,][=])/,/^(?:[_][8])/,/^(?:[,][ ]?)/,/^(?:[.])/,/^(?:[ ])/,/^(?:$)/,/^(?:.)/],conditions:{radical:{rules:[0,1,2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0},modexp:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0},INITIAL:{rules:[2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}};return Br}();Xt.lexer=Ft;function Nt(){this.yy={}}return Nt.prototype=Xt,Xt.Parser=Nt,new Nt}();typeof Zw!="undefined"&&typeof r!="undefined"&&(r.parser=t,r.Parser=t.Parser,r.parse=function(){return t.parse.apply(t,arguments)},r.main=function(){},typeof e!="undefined"&&Zw.main===e&&r.main(process.argv.slice(1)))}}),Lj=c3({"generated/ueb-to-latex.jison.js"(r,e){"use strict";var t=function(){var o=function(bi,tt,St,Vt){for(St=St||{},Vt=bi.length;Vt--;St[bi[Vt]]=tt);return St},i=[1,15],n=[1,16],a=[1,17],s=[1,37],l=[1,38],c=[1,39],d=[1,40],p=[1,45],u=[1,14],h=[1,49],m=[1,50],y=[1,41],w=[1,42],S=[1,43],C=[1,59],v=[1,44],E=[1,46],_=[1,47],T=[1,48],I=[1,57],P=[1,58],O=[1,60],W=[1,61],X=[1,62],x=[1,63],L=[1,64],R=[1,65],N=[1,66],z=[1,67],A=[1,68],U=[1,69],pe=[1,70],q=[1,71],F=[1,72],ge=[1,73],ne=[1,74],ae=[1,75],j=[1,76],oe=[1,77],Y=[1,78],fe=[1,79],ye=[1,80],Ce=[1,81],De=[1,82],Ge=[1,83],Ye=[1,84],Q=[1,85],ee=[1,86],we=[1,87],Me=[1,88],$e=[1,89],me=[1,51],rt=[1,52],vt=[1,53],Re=[1,54],Xt=[1,55],Ft=[1,90],Nt=[1,56],Br=[5,14,18,19,32,55,56,57],de=[5,10,13,14,15,18,19,32,55,56,57],se=[5,10,13,14,15,17,18,19,21,23,24,26,31,32,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101],He=[1,98],xe=[1,99],at=[1,100],We=[2,40],to=[10,13,15,17,21,23,24,26,31,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101],Dt={trace:function(){},yy:{},symbols_:{error:2,sentence:3,group:4,EOF:5,expression_group:6,delimited_expression:7,level:8,radical:9,LEVEL:10,basic_token:11,bracketed_expression:12,RADICAL_WITH_INDEX:13,CLOSE_RADICAL:14,RADICAL:15,frac:16,OPEN_FRAC:17,OVER:18,CLOSE_FRAC:19,simple_frac:20,NUMBER:21,NUMBER_FRAC_DENOMINATOR:22,NUMBER_FRAC_NUMERATOR_BAD:23,NUMBER_FRAC_DENOMINATOR_BAD:24,geo_token:25,GEO_TOKEN:26,number:27,atom:28,lbracket:29,rbracket:30,OPEN_GROUP:31,CLOSE_GROUP:32,command:33,greek:34,letter:35,comma:36,period:37,colon:38,infinity:39,integral:40,factorial:41,ampersand:42,question_mark:43,bracket:44,space:45,operation:46,comparison:47,ellipsis:48,primes:49,",":50,".":51,"[":52,"{":53,"(":54,"]":55,"}":56,")":57,SPACE:58,COMMAND:59,GREEK:60,CAPITAL_LETTER:61,LETTER:62,PIPE:63,DOUBLE_PIPE:64,"+":65,"-":66,CDOT:67,TIMES:68,"*":69,DIV:70,SLASH:71,PERCENT_OF:72,PERCENT:73,TO:74,ANGLE:75,MEASURED_ANGLE:76,DEGREE:77,CIRCLE:78,PARALLELOGRAM:79,TRIANGLE:80,"=":81,NEQ:82,"<":83,">":84,LEQ:85,APPROX:86,GEQ:87,SIM:88,NSIM:89,PARALLEL:90,PERPENDICULAR:91,CONG:92,NCONG:93,ELLIPSIS:94,COLON:95,INFINITY:96,INTEGRAL:97,FACTORIAL:98,"&":99,PRIMES:100,"?":101,unknown:102,UNKNOWN:103,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",10:"LEVEL",13:"RADICAL_WITH_INDEX",14:"CLOSE_RADICAL",15:"RADICAL",17:"OPEN_FRAC",18:"OVER",19:"CLOSE_FRAC",21:"NUMBER",22:"NUMBER_FRAC_DENOMINATOR",23:"NUMBER_FRAC_NUMERATOR_BAD",24:"NUMBER_FRAC_DENOMINATOR_BAD",26:"GEO_TOKEN",31:"OPEN_GROUP",32:"CLOSE_GROUP",50:",",51:".",52:"[",53:"{",54:"(",55:"]",56:"}",57:")",58:"SPACE",59:"COMMAND",60:"GREEK",61:"CAPITAL_LETTER",62:"LETTER",63:"PIPE",64:"DOUBLE_PIPE",65:"+",66:"-",67:"CDOT",68:"TIMES",69:"*",70:"DIV",71:"SLASH",72:"PERCENT_OF",73:"PERCENT",74:"TO",75:"ANGLE",76:"MEASURED_ANGLE",77:"DEGREE",78:"CIRCLE",79:"PARALLELOGRAM",80:"TRIANGLE",81:"=",82:"NEQ",83:"<",84:">",85:"LEQ",86:"APPROX",87:"GEQ",88:"SIM",89:"NSIM",90:"PARALLEL",91:"PERPENDICULAR",92:"CONG",93:"NCONG",94:"ELLIPSIS",95:"COLON",96:"INFINITY",97:"INTEGRAL",98:"FACTORIAL",99:"&",100:"PRIMES",101:"?",103:"UNKNOWN"},productions_:[0,[3,2],[3,1],[4,3],[4,2],[4,1],[4,2],[4,1],[7,1],[7,1],[8,2],[8,2],[8,2],[9,4],[9,3],[9,3],[9,2],[9,4],[9,3],[9,2],[16,5],[16,4],[16,4],[16,3],[16,2],[20,2],[20,1],[20,1],[25,2],[11,1],[11,1],[11,1],[6,2],[6,2],[6,1],[6,1],[12,3],[12,2],[12,3],[12,2],[27,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[28,1],[36,1],[37,1],[29,1],[29,1],[29,1],[30,1],[30,1],[30,1],[45,1],[33,1],[34,1],[35,1],[35,1],[44,1],[44,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[46,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[48,1],[38,1],[39,1],[40,1],[41,1],[42,1],[49,1],[43,1],[102,1]],performAction:function(tt,St,Vt,_e,ce,Se,Qe){var Fe=Se.length-1;switch(ce){case 1:return Se[Fe-1];case 2:return _e.group();case 3:case 36:this.$=_e.group(Se[Fe-2],Se[Fe-1],Se[Fe]);break;case 4:case 6:case 32:case 33:case 37:this.$=_e.group(Se[Fe-1],Se[Fe]);break;case 5:case 7:case 34:case 35:this.$=_e.group(Se[Fe]);break;case 10:case 11:case 12:this.$=_e.basic_level(Se[Fe-1],_e.group(Se[Fe]));break;case 13:case 17:this.$=_e.radical(Se[Fe-1],_e.group(Se[Fe-2]));break;case 14:case 15:this.$=_e.radical(_e.group(),_e.group(Se[Fe-1]));break;case 16:this.$=_e.radical(_e.group(),_e.group());break;case 18:this.$=_e.radical(Se[Fe-1]);break;case 19:this.$=_e.radical(_e.group());break;case 20:this.$=_e.fraction(Se[Fe-3],Se[Fe-1]);break;case 21:this.$=_e.fraction(Se[Fe-2],_e.group());break;case 22:this.$=_e.fraction(_e.group(),Se[Fe-1]);break;case 23:case 24:this.$=_e.fraction(_e.group(),_e.group());break;case 25:this.$=_e.fraction(_e.group(_e.terminal(_e.to_number(Se[Fe-1]))),_e.group(_e.terminal(_e.to_number(Se[Fe]))));break;case 26:this.$=_e.fraction(_e.group(_e.terminal(_e.to_number(Se[Fe]))),_e.group());break;case 27:this.$=_e.fraction(_e.group(),_e.group(_e.terminal(_e.to_number(Se[$01]))));break;case 28:this.$=_e.geo_token(Se[Fe]);break;case 38:this.$=_e.group(Se[Fe-1]);break;case 39:this.$=_e.group();break;case 40:this.$=_e.terminal(_e.to_number(Se[Fe]));break;case 60:this.$=_e.terminal(",");break;case 61:this.$=_e.terminal(".");break;case 62:this.$=_e.terminal("[");break;case 63:this.$=_e.terminal("\\{");break;case 64:this.$=_e.terminal("(");break;case 65:this.$=_e.terminal("]");break;case 66:this.$=_e.terminal("\\}");break;case 67:this.$=_e.terminal(")");break;case 68:this.$=_e.terminal(" ");break;case 69:this.$=_e.command("\\"+Se[Fe].trim().toLowerCase());break;case 70:this.$=_e.terminal(_e.greek(Se[Fe]));break;case 71:this.$=_e.terminal(Se[Fe].toUpperCase());break;case 72:this.$=_e.terminal(Se[Fe].toLowerCase());break;case 73:this.$=_e.terminal("|");break;case 74:this.$=_e.terminal("\\|");break;case 75:this.$=_e.terminal("+");break;case 76:this.$=_e.terminal("-");break;case 77:this.$=_e.terminal("\\cdot ");break;case 78:this.$=_e.terminal("\\times ");break;case 79:this.$=_e.terminal("*");break;case 80:this.$=_e.terminal("\\div ");break;case 81:this.$=_e.terminal("/");break;case 82:this.$=_e.terminal("\\%\\operatorname{of}");break;case 83:this.$=_e.terminal("\\%");break;case 84:this.$=_e.terminal("\\to ");break;case 85:this.$=_e.terminal("\\angle ");break;case 86:this.$=_e.terminal("\\measuredangle ");break;case 87:this.$=_e.terminal("\\degree ");break;case 88:this.$=_e.terminal("\\bigcirc ");break;case 89:this.$=_e.terminal("\\parallelogram ");break;case 90:this.$=_e.terminal("\\triangle ");break;case 91:this.$=_e.terminal("=");break;case 92:this.$=_e.terminal("\\neq ");break;case 93:this.$=_e.terminal("<");break;case 94:this.$=_e.terminal(">");break;case 95:this.$=_e.terminal("\\leq ");break;case 96:this.$=_e.terminal("\\approx ");break;case 97:this.$=_e.terminal("\\geq ");break;case 98:this.$=_e.terminal("\\sim ");break;case 99:this.$=_e.terminal("\\nsim ");break;case 100:this.$=_e.terminal("\\parallel ");break;case 101:this.$=_e.terminal("\\perp ");break;case 102:this.$=_e.terminal("\\cong ");break;case 103:this.$=_e.terminal("\\ncong ");break;case 104:this.$=_e.terminal("\\ldots ");break;case 105:this.$=_e.terminal(":");break;case 106:this.$=_e.terminal("\\infty ");break;case 107:this.$=_e.terminal("\\int ");break;case 108:this.$=_e.terminal("!");break;case 109:this.$=_e.terminal("\\&");break;case 110:this.$=_e.primes(Se[Fe]);break;case 111:this.$=_e.terminal("?");break}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{1:[3]},{5:[1,91]},{1:[2,2]},o(Br,[2,5],{8:8,9:9,7:92,10:i,13:n,15:a}),o(Br,[2,7],{6:4,7:5,11:6,12:7,8:8,9:9,28:10,16:11,20:12,29:13,27:18,33:19,25:20,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,4:93,10:i,13:n,15:a,17:s,21:l,23:c,24:d,26:p,31:u,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt}),o(de,[2,34],{11:6,12:7,28:10,16:11,20:12,29:13,27:18,33:19,25:20,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,6:94,17:s,21:l,23:c,24:d,26:p,31:u,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt}),o(de,[2,35],{11:6,12:7,28:10,16:11,20:12,29:13,27:18,33:19,25:20,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,6:95,17:s,21:l,23:c,24:d,26:p,31:u,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt}),o(se,[2,8]),o(se,[2,9]),o(se,[2,29]),o(se,[2,30]),o(se,[2,31]),{4:96,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,30:97,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,55:He,56:xe,57:at,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{4:101,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,32:[1,102],33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{9:105,11:103,12:104,13:n,15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{11:106,12:107,14:[1,108],16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{4:109,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,14:[1,110],15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},o(se,[2,41]),o(se,[2,42]),o(se,[2,43]),o(se,[2,44]),o(se,[2,45]),o(se,[2,46]),o(se,[2,47]),o(se,[2,48]),o(se,[2,49]),o(se,[2,50]),o(se,[2,51]),o(se,[2,52]),o(se,[2,53]),o(se,[2,54]),o(se,[2,55]),o(se,[2,56]),o(se,[2,57]),o(se,[2,58]),o(se,[2,59]),{4:111,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,18:[1,112],19:[1,113],20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},o(se,We,{22:[1,114]}),o(se,[2,26]),o(se,[2,27]),o(to,[2,62]),o(to,[2,63]),o(to,[2,64]),o(se,[2,69]),{21:[1,116],27:115},o(se,[2,70]),o(se,[2,71]),o(se,[2,72]),o(se,[2,60]),o(se,[2,61]),o(se,[2,105]),o(se,[2,106]),o(se,[2,107]),o(se,[2,108]),o(se,[2,109]),o(se,[2,111]),o(se,[2,73]),o(se,[2,74]),o(se,[2,68]),o(se,[2,75]),o(se,[2,76]),o(se,[2,77]),o(se,[2,78]),o(se,[2,79]),o(se,[2,80]),o(se,[2,81]),o(se,[2,82]),o(se,[2,83]),o(se,[2,84]),o(se,[2,85]),o(se,[2,86]),o(se,[2,87]),o(se,[2,88]),o(se,[2,89]),o(se,[2,90]),o(se,[2,91]),o(se,[2,92]),o(se,[2,93]),o(se,[2,94]),o(se,[2,95]),o(se,[2,96]),o(se,[2,97]),o(se,[2,98]),o(se,[2,99]),o(se,[2,100]),o(se,[2,101]),o(se,[2,102]),o(se,[2,103]),o(se,[2,104]),o(se,[2,110]),{1:[2,1]},o(Br,[2,4],{6:4,7:5,11:6,12:7,8:8,9:9,28:10,16:11,20:12,29:13,27:18,33:19,25:20,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,4:117,10:i,13:n,15:a,17:s,21:l,23:c,24:d,26:p,31:u,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt}),o(Br,[2,6]),o(de,[2,32]),o(de,[2,33]),{30:118,55:He,56:xe,57:at},o(se,[2,37]),o(se,[2,65]),o(se,[2,66]),o(se,[2,67]),{32:[1,119]},o(se,[2,39]),o(se,[2,10]),o(se,[2,11]),o(se,[2,12]),{4:120,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,14:[1,121],15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{4:123,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,14:[1,122],15:a,16:11,17:s,20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},o(se,[2,16]),{14:[1,124]},o(se,[2,19]),{18:[1,125]},{4:126,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,19:[1,127],20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},o(se,[2,24]),o(se,[2,25]),o(se,[2,28]),o(se,We),o(Br,[2,3]),o(se,[2,36]),o(se,[2,38]),{14:[1,128]},o(se,[2,15]),o(se,[2,14]),{14:[1,129]},o(se,[2,18]),{4:130,6:4,7:5,8:8,9:9,10:i,11:6,12:7,13:n,15:a,16:11,17:s,19:[1,131],20:12,21:l,23:c,24:d,25:20,26:p,27:18,28:10,29:13,31:u,33:19,34:21,35:22,36:23,37:24,38:25,39:26,40:27,41:28,42:29,43:30,44:31,45:32,46:33,47:34,48:35,49:36,50:h,51:m,52:y,53:w,54:S,58:C,59:v,60:E,61:_,62:T,63:I,64:P,65:O,66:W,67:X,68:x,69:L,70:R,71:N,72:z,73:A,74:U,75:pe,76:q,77:F,78:ge,79:ne,80:ae,81:j,82:oe,83:Y,84:fe,85:ye,86:Ce,87:De,88:Ge,89:Ye,90:Q,91:ee,92:we,93:Me,94:$e,95:me,96:rt,97:vt,98:Re,99:Xt,100:Ft,101:Nt},{19:[1,132]},o(se,[2,23]),o(se,[2,13]),o(se,[2,17]),{19:[1,133]},o(se,[2,21]),o(se,[2,22]),o(se,[2,20])],defaultActions:{3:[2,2],91:[2,1]},parseError:function(tt,St){if(St.recoverable)this.trace(tt);else{var Vt=new Error(tt);throw Vt.hash=St,Vt}},parse:function(tt){var St=this,Vt=[0],_e=[],ce=[null],Se=[],Qe=this.table,Fe="",kt=0,It=0,Kt=0,hr=2,rr=1,ir=Se.slice.call(arguments,1),Rt=Object.create(this.lexer),yr={yy:{}};for(var _r in this.yy)Object.prototype.hasOwnProperty.call(this.yy,_r)&&(yr.yy[_r]=this.yy[_r]);Rt.setInput(tt,yr.yy),yr.yy.lexer=Rt,yr.yy.parser=this,typeof Rt.yylloc=="undefined"&&(Rt.yylloc={});var Fi=Rt.yylloc;Se.push(Fi);var $n=Rt.options&&Rt.options.ranges;typeof yr.yy.parseError=="function"?this.parseError=yr.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function la(El){Vt.length=Vt.length-2*El,ce.length=ce.length-El,Se.length=Se.length-El}for(var Wi=function(){var El;return El=Rt.lex()||rr,typeof El!="number"&&(El=St.symbols_[El]||El),El},yi,hn,el,Bo,ac,ca,op={},bd,Ps,lh,Hp;;){if(el=Vt[Vt.length-1],this.defaultActions[el]?Bo=this.defaultActions[el]:((yi===null||typeof yi=="undefined")&&(yi=Wi()),Bo=Qe[el]&&Qe[el][yi]),typeof Bo=="undefined"||!Bo.length||!Bo[0]){var yd="";Hp=[];for(bd in Qe[el])this.terminals_[bd]&&bd>hr&&Hp.push("'"+this.terminals_[bd]+"'");Rt.showPosition?yd="Parse error on line "+(kt+1)+`:
`+Rt.showPosition()+`
Expecting `+Hp.join(", ")+", got '"+(this.terminals_[yi]||yi)+"'":yd="Parse error on line "+(kt+1)+": Unexpected "+(yi==rr?"end of input":"'"+(this.terminals_[yi]||yi)+"'"),this.parseError(yd,{text:Rt.match,token:this.terminals_[yi]||yi,line:Rt.yylineno,loc:Fi,expected:Hp})}if(Bo[0]instanceof Array&&Bo.length>1)throw new Error("Parse Error: multiple actions possible at state: "+el+", token: "+yi);switch(Bo[0]){case 1:Vt.push(yi),ce.push(Rt.yytext),Se.push(Rt.yylloc),Vt.push(Bo[1]),yi=null,hn?(yi=hn,hn=null):(It=Rt.yyleng,Fe=Rt.yytext,kt=Rt.yylineno,Fi=Rt.yylloc,Kt>0&&Kt--);break;case 2:if(Ps=this.productions_[Bo[1]][1],op.$=ce[ce.length-Ps],op._$={first_line:Se[Se.length-(Ps||1)].first_line,last_line:Se[Se.length-1].last_line,first_column:Se[Se.length-(Ps||1)].first_column,last_column:Se[Se.length-1].last_column},$n&&(op._$.range=[Se[Se.length-(Ps||1)].range[0],Se[Se.length-1].range[1]]),ca=this.performAction.apply(op,[Fe,It,kt,yr.yy,Bo[1],ce,Se].concat(ir)),typeof ca!="undefined")return ca;Ps&&(Vt=Vt.slice(0,-1*Ps*2),ce=ce.slice(0,-1*Ps),Se=Se.slice(0,-1*Ps)),Vt.push(this.productions_[Bo[1]][0]),ce.push(op.$),Se.push(op._$),lh=Qe[Vt[Vt.length-2]][Vt[Vt.length-1]],Vt.push(lh);break;case 3:return!0}}return!0}},sa=function(){var bi={EOF:1,parseError:function(St,Vt){if(this.yy.parser)this.yy.parser.parseError(St,Vt);else throw new Error(St)},setInput:function(tt,St){return this.yy=St||this.yy||{},this._input=tt,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var tt=this._input[0];this.yytext+=tt,this.yyleng++,this.offset++,this.match+=tt,this.matched+=tt;var St=tt.match(/(?:\r\n?|\n).*/g);return St?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),tt},unput:function(tt){var St=tt.length,Vt=tt.split(/(?:\r\n?|\n)/g);this._input=tt+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-St),this.offset-=St;var _e=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),Vt.length-1&&(this.yylineno-=Vt.length-1);var ce=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:Vt?(Vt.length===_e.length?this.yylloc.first_column:0)+_e[_e.length-Vt.length].length-Vt[0].length:this.yylloc.first_column-St},this.options.ranges&&(this.yylloc.range=[ce[0],ce[0]+this.yyleng-St]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(tt){this.unput(this.match.slice(tt))},pastInput:function(){var tt=this.matched.substr(0,this.matched.length-this.match.length);return(tt.length>20?"...":"")+tt.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var tt=this.match;return tt.length<20&&(tt+=this._input.substr(0,20-tt.length)),(tt.substr(0,20)+(tt.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var tt=this.pastInput(),St=new Array(tt.length+1).join("-");return tt+this.upcomingInput()+`
`+St+"^"},test_match:function(tt,St){var Vt,_e,ce;if(this.options.backtrack_lexer&&(ce={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(ce.yylloc.range=this.yylloc.range.slice(0))),_e=tt[0].match(/(?:\r\n?|\n).*/g),_e&&(this.yylineno+=_e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:_e?_e[_e.length-1].length-_e[_e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+tt[0].length},this.yytext+=tt[0],this.match+=tt[0],this.matches=tt,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(tt[0].length),this.matched+=tt[0],Vt=this.performAction.call(this,this.yy,this,St,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),Vt)return Vt;if(this._backtrack){for(var Se in ce)this[Se]=ce[Se];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var tt,St,Vt,_e;this._more||(this.yytext="",this.match="");for(var ce=this._currentRules(),Se=0;Se<ce.length;Se++)if(Vt=this._input.match(this.rules[ce[Se]]),Vt&&(!St||Vt[0].length>St[0].length)){if(St=Vt,_e=Se,this.options.backtrack_lexer){if(tt=this.test_match(Vt,ce[Se]),tt!==!1)return tt;if(this._backtrack){St=!1;continue}else return!1}else if(!this.options.flex)break}return St?(tt=this.test_match(St,ce[_e]),tt!==!1?tt:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var St=this.next();return St||this.lex()},begin:function(St){this.conditionStack.push(St)},popState:function(){var St=this.conditionStack.length-1;return St>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(St){return St=this.conditionStack.length-1-Math.abs(St||0),St>=0?this.conditionStack[St]:"INITIAL"},pushState:function(St){this.begin(St)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(St,Vt,_e,ce){var Se=ce;switch(_e){case 0:this.begin("captext");return;case 1:return 61;case 2:return this.popState(),61;break;case 3:return 65;case 4:return 66;case 5:return 67;case 6:return 68;case 7:return 69;case 8:return 70;case 9:return 52;case 10:return 53;case 11:return 54;case 12:return 55;case 13:return 56;case 14:return 57;case 15:return 82;case 16:return 85;case 17:return 86;case 18:return 87;case 19:return 81;case 20:return 83;case 21:return 84;case 22:return 89;case 23:return 88;case 24:return 72;case 25:return 73;case 26:return 74;case 27:return 76;case 28:return 75;case 29:return 78;case 30:return 79;case 31:return 80;case 32:return 93;case 33:return 92;case 34:return 94;case 35:return 13;case 36:return 15;case 37:return 14;case 38:return 10;case 39:return 31;case 40:return 32;case 41:return 97;case 42:return 98;case 43:return 99;case 44:return 17;case 45:return 18;case 46:return 19;case 47:return 90;case 48:return 91;case 49:return 96;case 50:return Vt.yytext=this.matches[1],21;break;case 51:return Vt.yytext=this.matches[1],22;break;case 52:return Vt.yytext=this.matches[1],24;break;case 53:return 71;case 54:return 50;case 55:return 51;case 56:return 100;case 57:return 64;case 58:return 63;case 59:return 95;case 60:return 59;case 61:return 59;case 62:return 26;case 63:return 60;case 64:return 77;case 65:return Vt.yytext=this.matches[1],61;break;case 66:return 62;case 67:return;case 68:return 101;case 69:return;case 70:return 58;case 71:return 5;case 72:return 103}},rules:[/^(?:([,][,])(?=[A-Z]))/,/^(?:[A-Z](?=[A-Z]))/,/^(?:[A-Z])/,/^(?:["][6])/,/^(?:["][-])/,/^(?:["][4])/,/^(?:["][8])/,/^(?:["][9])/,/^(?:["][/])/,/^(?:[.][<])/,/^(?:[_][<])/,/^(?:["][<])/,/^(?:[.][>])/,/^(?:[_][>])/,/^(?:["][>])/,/^(?:["][7][@][:])/,/^(?:[_][@][<])/,/^(?:[\^][9])/,/^(?:[_][@][>])/,/^(?:["][7])/,/^(?:[@][<])/,/^(?:[@][>])/,/^(?:[@][9][@][:])/,/^(?:[@][9])/,/^(?:[.][0][O][F][ ]?)/,/^(?:[.][0])/,/^(?:[:][O])/,/^(?:[.][_][\[])/,/^(?:[_][\[])/,/^(?:[$][=])/,/^(?:[$][@][#][D])/,/^(?:[$][#][C])/,/^(?:["][_][9][@][:])/,/^(?:["][_][9])/,/^(?:[4][4][4])/,/^(?:[%][9])/,/^(?:[%])/,/^(?:[\+])/,/^(?:[95]+(?=.))/,/^(?:[<])/,/^(?:[>])/,/^(?:!)/,/^(?:[6])/,/^(?:[@]&)/,/^(?:[(])/,/^(?:[.][/])/,/^(?:[)])/,/^(?:#[L])/,/^(?:#-)/,/^(?:#=)/,/^(?:#([A-J4]+))/,/^(?:[/]([A-J4]+))/,/^(?:[#][/]([A-J4]+))/,/^(?:[_]?[/])/,/^(?:[1])/,/^(?:[4])/,/^(?:[7]+)/,/^(?:[_][\\][_][\\])/,/^(?:[_][\\])/,/^(?:[3])/,/^(?:(ARC)?(SIN|COS|TAN|CSC|SEC|COT)(H)?)/,/^(?:(ARG|DET|EXP|IM|INF|LIM|LN|LOG|MAX|MIN|MOD|RE|SUP))/,/^(?:(TOKEN)[ ]?)/,/^(?:[,]?[.][ABGDEZ\?\:IKLMNXOPRSTUYF\&W])/,/^(?:[^][J])/,/^(?:[,]([A-Z]))/,/^(?:[A-Z])/,/^(?:[,]['])/,/^(?:[8])/,/^(?:[;])/,/^(?:[ ])/,/^(?:$)/,/^(?:.)/],conditions:{captext:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72],inclusive:!0},INITIAL:{rules:[0,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72],inclusive:!0}}};return bi}();Dt.lexer=sa;function No(){this.yy={}}return No.prototype=Dt,Dt.Parser=No,new No}();typeof Zw!="undefined"&&typeof r!="undefined"&&(r.parser=t,r.Parser=t.Parser,r.parse=function(){return t.parse.apply(t,arguments)},r.main=function(){},typeof e!="undefined"&&Zw.main===e&&r.main(process.argv.slice(1)))}}),p3=["abs","ans","arccosh","arccot","arccoth","arccsc","arccsch","arcsec","arcsech","arcsinh","arctanh","binomialdist","boxplot","cdf","ceil","corr","cov","csch","distance","dotplot","erf","floor","gcf","histogram","IndependentTTest","iTTest","ittest","lcm","length","mad","mcd","mcm","mean","median","midpoint","mod","nCr","normaldist","nPr","pdf","poissondist","polygon","quantile","quartile","random","round","sech","sign","signum","sgn","stdDev","stddev","stdDevP","stddevp","stdev","stdevp","tdist","total","TScore","TScore","Tscore","tscore","tscore","TTest","ttest","var","variance","varp"],nI=p3,$ce=Oj(p3),u3;function Pj(r){let e=!1,t=0,o="",i="";for(let n of r)if(n.type==="terminal"&&/[A-Za-z]/.test(n.value))o+=n.value,t++;else break;return i=o.replace(u3,"\\operatorname{$1}"),e=t>0&&i!==o,{modified:e,terminalCount:t,value:i}}function h3(r){return nI.indexOf(r.toLowerCase())!==-1}function aI(r){if(!Array.isArray(r))throw new Error("Operator names must be an array, got "+typeof r);for(let e of r)if(typeof e!="string")throw new Error("Operator names must be strings, found "+typeof e);nI=r,jce()}function sI(){nI=p3,u3=$ce}function jce(){u3=Oj(nI)}function Oj(r){let e=r.sort((t,o)=>o.length-t.length||o.localeCompare(t)).join("|");return new RegExp("("+e+")","g")}var Rj={};d3(Rj,{command:()=>g3,fraction:()=>Jce,greek:()=>Yce,group:()=>m3,level:()=>Nj,processPrimes:()=>Xce,radical:()=>Qce,terminal:()=>Fj,typeform:()=>Bj});function Fj(r){return{type:"terminal",value:r}}function g3(r){return{type:"command",value:r}}function Yce(r){return{type:"greek",value:r}}function Nj(r){return{subscript:r._,superscript:r["^"],type:"level"}}function Xce(r,e){let t=[],o=r.match(/'+/);if(o!==null){let i=o[0].length;for(let n=0;n<i;n++)t.push(g3("\\prime"))}return m3(t,e)}function Jce(r,e){return{type:"fraction",numerator:r,denominator:e}}function Bj(r,e){return{name:r,type:"typeform",value:e}}function Qce(r,e){return{type:"radical",index:e,radicand:r}}function m3(...r){return Array.prototype.concat.apply([],r)}var JG={"~":"\\ ","\\,":"\\ ","\\:":"\\ ","\\;":"\\ ","\\!":"\\ "},wj={"\\Vert":"\\|","\\ge":"\\geq","\\le":"\\leq","\\vert":"|"},Zce={"\\space":!0};function Tm(r){let e=[];for(let t=0;t<r.length;t++){let o=r[t];switch(o.type){case"command":let i=o.value.slice(1).trim();wj.hasOwnProperty(o.value)?e.push(g3(wj[o.value])):h3(i)?e.push(Bj("operator_name",ede(i))):Zce[o.value]||e.push(o);break;case"level":let n={subscript:o.subscript&&o.subscript.length>0?Tm(o.subscript):void 0,superscript:o.superscript&&o.superscript.length>0?Tm(o.superscript):void 0,type:o.type};(n.subscript||n.superscript)&&e.push(n);break;case"fraction":e.push({denominator:Tm(o.denominator),numerator:Tm(o.numerator),type:o.type});break;case"radical":e.push({index:o.index?Tm(o.index):void 0,radicand:Tm(o.radicand),type:o.type});break;case"terminal":tde(r.slice(t))?(e.push({type:"command",value:"\\ldots"}),t+=2):e.push({type:o.type,value:JG.hasOwnProperty(o.value)?JG[o.value]:o.value});break;case"typeform":e.push(o);break;case"greek":e.push({type:o.type,value:JG.hasOwnProperty(o.value)?JG[o.value]:o.value});break;default:throw new Error(`Unexpected item:
`+JSON.stringify({group:r,item:o}))}}return e}function ede(r){let e=[];for(let t of r)e.push(Fj(t));return e}function tde(r){let e=0;for(let t=0;t<Math.min(3,r.length);t++){let o=r[t];o.type==="terminal"&&o.value==="."&&e++}return e===3}function f3(r){if(!r.hash)throw r;return{_diagnostic:{expected:r.hash.expected,message:r.message,text:r.hash.text,token:r.hash.token},location:r.hash.loc}}var Uj=Wce();Uj.parser.yy=Rj;function qj(r){try{return{isError:!1,value:Uj.parser.parse(r)}}catch(e){return{isError:!0,error:f3(e)}}}function rde(r){return r.isError}function ode(r,e){return rde(r)?r:{isError:!1,value:e(r.value)}}function ev(r,e){let t=ode(r,e);return r.warnings&&(t.warnings=r.warnings),t}function ide(r){return ev(qj(r),e=>mde(Tm(e)))}var vj={"!":"&","*":"@#",",":", ","/":"_/",":":"_3","<":' "K ',"=":" .K ",">":" .1 ","?":"_8","[":"@(","\\ ":" ","\\%":"@0","\\&":"_&","\\,":" ","\\infty":",=","\\int":"!","\\{":".(","\\|":"\\\\","\\}":".)","]":"@)","|":"\\"};function e3(r){return/^[a-z]$/.test(r.value)?r.value.toUpperCase():/^[A-Z]$/.test(r.value)?","+r.value:/^[0-9.]$/.test(r.value)||/^[+\-()]$/.test(r.value)?r.value:vj.hasOwnProperty(r.value)?vj[r.value]:"[terminal: "+r.value+"]"}var Cj={"\\Vert":"\\\\","\\angle":"$[ ","\\approx":" @:@: ","\\bigcirc":"$C ","\\cong":" @:.K ","\\cdot":"*","\\degree":"~.*","\\div":"./","\\ge":" .1: ","\\geq":" .1: ","\\langle":"..(","\\ldots":" ''' ","\\le":' "K: ',"\\leq":' "K: ',"\\measuredangle":"M$[ ","\\ncong":" /@:.K ","\\ne":" /.K ","\\neq":" /.K ","\\nparallel":" /$L ","\\nsim":"/@:","\\parallel":" $L ","\\parallelogram":"$G ","\\perp":" $P ","\\prime":"'","\\prod":".,P","\\rangle":"..)","\\sim":"@:","\\sum":".,S","\\times":"@*","\\to":" $O ","\\triangle":"$T ","\\vert":"\\"},Sj={"\\Alpha":".,A","\\Beta":".,B","\\Chi":".,&","\\Delta":".,D","\\Epsilon":".,E","\\Eta":".,:","\\Gamma":".,G","\\Iota":".,I","\\Kappa":".,K","\\Lambda":".,L","\\Mu":".,M","\\Nu":".,N","\\Omega":".,W","\\Omicron":".,O","\\Phi":".,F","\\Pi":".,P","\\Psi":".,Y","\\Rho":".,R","\\Sigma":".,S","\\Tau":".,T","\\Theta":".,?","\\Upsilon":".,U","\\Xi":".,X","\\Zeta":".,Z","\\alpha":".A","\\beta":".B","\\chi":".&","\\delta":".D","\\epsilon":".E","\\eta":".:","\\gamma":".G","\\iota":".I","\\kappa":".K","\\lambda":".L","\\mu":".M","\\nu":".N","\\omega":".W","\\omicron":".O","\\phi":".F","\\pi":".P","\\psi":".Y","\\rho":".R","\\sigma":".S","\\tau":".T","\\theta":".?","\\upsilon":".U","\\xi":".X","\\zeta":".Z"};function Ej(r){return Cj.hasOwnProperty(r.value)?Cj[r.value]:r.value.slice(1).toUpperCase()+" "}function nde(r){return Sj.hasOwnProperty(r.value)?Sj[r.value]:r.value.slice(1).toUpperCase()+" "}function ade(r){return r.value==="\\space"}function sde(r,e){return r.isStartOfLine&&/^-?$/.test(e)||/\s-?$/.test(e)||r.wasFraction}function lde(r){return r.value==="\\sum"||r.value==="\\prod"}function cde(r,e){if(e>=r.length)return!1;let t=r[e];if(t.type==="terminal"){if(/^[0-9]$/.test(t.value))return!0;if(t.value!=="."||e+1>=r.length)return!1;if(t=r[e+1],t.type==="terminal")return/^[0-9]$/.test(t.value)}return!1}function Im(r,e){let t="",o=r.levelIndicator,i=0,n=!1;for(let a=0;a<e.length;a++){cde(e,a)&&(o===""&&/[A-Z]$/.test(t)?t+=Iu(o):sde(r,t)&&(t+="#"));let s=e[a],l=a<e.length-1?e[a+1]:null;switch(s.type!=="level"&&o!==r.levelIndicator&&(t3(s)?o="":(r.wasModifiedExpression&&r.levelIndicator===""?r=td(r,{wasModifiedExpression:!1}):t+=Iu(r.levelIndicator),o=r.levelIndicator)),s.type){case"terminal":!r.wasModifiedExpression&&o!==""&&t3(s)?t+=" "+Iu(o)+e3(s).trim()+" ":t+=e3(s),s.value==="."&&l&&(l.type==="terminal"&&/^[^_\d,]/.test(e3(l))||l.type==="greek")&&(t+='"'),r=td(r,{wasFraction:!1,wasRomanCommand:!1});break;case"command":if(!ade(s)){let h=lde(s);h&&(t+='"'),!h&&o!==""&&t3(s)?t+=" "+Iu(o)+Ej(s).trim()+" ":t+=Ej(s),r=td(r,{wasFraction:!1,wasModifiedExpression:h,wasRomanCommand:!0})}break;case"greek":t+=nde(s),r=td(r,{wasFraction:!1});break;case"fraction":let c=dde(r,s);t+=c.value,i=Math.max(i,c.fractionLevel),r=td(r,{wasFraction:!0,wasRomanCommand:!1});break;case"radical":let d=pde(r,s);t+=d.value,i=Math.max(i,d.fractionLevel),r=td(r,{wasFraction:!1,wasRomanCommand:!1});break;case"level":!r.wasModifiedExpression&&r.wasRomanCommand?(n=/\s$/.test(t),n&&(t=t.replace(/\s$/,""))):n=!1;let p=t.length>0&&/[A-Za-z]/.test(t[t.length-1])===!0,u=ude(r,p,n,s);t+=u.value,o=u.levelIndicator,r=td(r,{wasFraction:!1,wasRomanCommand:!1});break;case"typeform":t+=Im(r,s.value).value,s.name==="operator_name"&&(t+=" "),r=td(r,{wasFraction:!1,wasModifiedExpression:!1,wasRomanCommand:!1});break}}return{fractionLevel:i,levelIndicator:o,value:t}}function dde(r,e){r=td(r,{isStartOfLine:!1});let t=Im(r,e.numerator),o=Im(r,e.denominator),i=Math.max(t.fractionLevel,o.fractionLevel),n="";for(let s=0;s<i;s++)n+=",";let a=n+"?"+t.value;return t.levelIndicator!==r.levelIndicator&&(a+=Iu(r.levelIndicator)),/\.$/.test(t.value)&&(a+='"'),a+=n+"/"+o.value,o.levelIndicator!==r.levelIndicator&&(a+=Iu(r.levelIndicator)),/\.$/.test(o.value)&&(a+='"'),a+=n+"#",{fractionLevel:i+1,value:a}}function pde(r,e){let t=r.radicalLevel,o="",i="";for(let a=0;a<t;a++)i+=".";if(e.index){o+=i+"<";let a=Im(td(r,{isStartOfLine:!1}),e.index);o+=a.value,/\.$/.test(a.value)&&(o+='"'),a.levelIndicator!==r.levelIndicator&&(o+=Iu(r.levelIndicator)),o+=">"}else o+=i+">";let n=Im(td(r,{isStartOfLine:!1,radicalLevel:t+1}),e.radicand);return o+=n.value,/\.$/.test(n.value)&&(o+='"'),n.levelIndicator!==r.levelIndicator&&(o+=Iu(r.levelIndicator)),o+=i+"]",{fractionLevel:n.fractionLevel,value:o}}function ude(r,e,t,o){let i=r.levelIndicator,n="",a=hde(o.superscript);if(n+=a,o.subscript){r.wasModifiedExpression&&(n+="%"),i=r.levelIndicator+";";let s=Im(td(r,{isStartOfLine:!1,levelIndicator:i}),o.subscript);e&&/^[0-9]*(\.|\,)?[0-9]+$/.test(s.value)&&i.length<=1?i=r.levelIndicator:!r.wasModifiedExpression&&o.subscript[0]&&o.subscript[0].type!=="level"&&(n+=Iu(i)),n+=s.value,/\.$/.test(s.value)&&(n+='"')}if(o.superscript){r.wasModifiedExpression&&(n+="<"),i=r.levelIndicator+"^";let s=Im(td(r,{isStartOfLine:!1,levelIndicator:i}),o.superscript.slice(a.length));!r.wasModifiedExpression&&o.superscript[0]&&o.superscript[0].type!=="level"&&s.value!==""&&(n+=Iu(i)),n+=s.value,/\.$/.test(s.value)&&(n+='"')}return r.wasModifiedExpression?n+="]":r.wasRomanCommand&&t&&(n+=" ",i=i.slice(0,i.length-1)),{levelIndicator:i,value:n}}function hde(r){let e="";if(r)for(let t of r)if(t.type==="command"&&t.value==="\\prime")e+="'";else break;return e}function Iu(r){return r||'"'}function gde(){return{isStartOfLine:!0,levelIndicator:"",radicalLevel:0,wasFraction:!1,wasModifiedExpression:!1,wasRomanCommand:!1}}function td(r,e){return Qw(Qw({},r),e)}function t3(r){return r.type==="terminal"||r.type==="command"?/^<|>|\=|\\leq?|\\geq?|\\neq?$/.test(r.value):!1}function mde(r){let e=gde();return Im(e,r).value}function fde(r){return ev(qj(r),e=>Tde(Tm(e)))}var Dj={"!":"6","(":'"<',")":'">',"*":'"9',"+":'"6',",":"1","-":'"-',".":"4","/":"_/",":":"3","<":"@<","=":'"7',">":"@>","?":"8","[":".<","\\ ":" ","\\%":".0","\\&":"@&","\\,":" ","\\infty":"#=","\\int":"!","\\{":"_<","\\|":"_\\_\\","\\}":"_>","]":".>","|":"_\\"};function bde(r,e,t){let o="",i=e.value,n=t&&t.type==="terminal"?t.value:"";return zj(i,r)&&(o+=";"),/^[\D]/.test(i)&&(r=Mu(r,{wasNumber:!1})),/^[a-z]$/.test(i)?r.capsLock?(r=Mu(r,{capsLock:!1}),o+=",'"+i.toUpperCase()):o+=i.toUpperCase():/^[A-Z]$/.test(i)?r.capsLock?o+=i:/[A-Z]/.test(n)?(r=Mu(r,{capsLock:!0}),o+=",,"+i):o+=","+i:(r=Mu(r,{capsLock:!1}),/^[0-9.]$/.test(i)?o+=Cde(i):Dj.hasOwnProperty(i)?o+=Dj[i]:o+="[terminal: "+i+"]"),{value:o,ctx:r}}var kj={"\\Vert":"_\\_\\","\\angle":"_{","\\approx":"^9","\\bigcirc":"$=","\\cdot":'"4',"\\cong":'"_9',"\\degree":"~J","\\div":'"/',"\\ge":"_@>","\\geq":"_@>","\\langle":"@<","\\ldots":"444","\\le":"_@<","\\leq":"_@<","\\measuredangle":"._{","\\ncong":'"_9@:',"\\ne":'"7@:',"\\neq":'"7@:',"\\nsim":"@9@:","\\parallel":"#L","\\parallelogram":"$@#D","\\perp":"#-","\\prime":"7","\\prod":",.P","\\rangle":"@>","\\sim":"@9","\\sum":",.S","\\times":'"8',"\\to":":O","\\triangle":"$#C","\\vert":"_\\"},_j={"\\Alpha":",.A","\\Beta":",.B","\\Chi":",.&","\\Delta":",.D","\\Epsilon":",.E","\\Eta":",.:","\\Gamma":",.G","\\Iota":",.I","\\Kappa":",.K","\\Lambda":",.L","\\Mu":",.M","\\Nu":",.N","\\Omega":",.W","\\Omicron":",.O","\\Phi":",.F","\\Pi":",.P","\\Psi":",.Y","\\Rho":",.R","\\Sigma":",.S","\\Tau":",.T","\\Theta":",.?","\\Upsilon":",.U","\\Xi":",.X","\\Zeta":",.Z","\\alpha":".A","\\beta":".B","\\chi":".&","\\delta":".D","\\epsilon":".E","\\eta":".:","\\gamma":".G","\\iota":".I","\\kappa":".K","\\lambda":".L","\\mu":".M","\\nu":".N","\\omega":".W","\\omicron":".O","\\phi":".F","\\pi":".P","\\psi":".Y","\\rho":".R","\\sigma":".S","\\tau":".T","\\theta":".?","\\upsilon":".U","\\xi":".X","\\zeta":".Z"};function yde(r,e){let t;return kj.hasOwnProperty(r.value)?t=kj[r.value]:t=r.value.slice(1).toUpperCase()+" ",zj(t,e)&&(t=";"+t),/^[\D]/.test(t)&&(e=Mu(e,{wasNumber:!1})),{value:t,ctx:e}}function xde(r){return _j.hasOwnProperty(r.value)?_j[r.value]:r.value.slice(1).toUpperCase()+" "}function wde(r){return r.value==="\\space"}function vde(r,e){if(e<r.length){let t=r[e];if(t.type==="terminal"){if(/^\d$/.test(t.value))return!0;if(t.value!=="."||e+1>=r.length)return!1;if(t=r[e+1],t.type==="terminal")return/^\d$/.test(t.value)}}return!1}function Cde(r){let e="";for(let o of r)o===","?e+="1":o==="."?e+="4":o==="0"?e+="J":e+=String.fromCharCode(64+Number(o));return e}function Mm(r,e){let t,o,i="",n=!0;for(let a=0;a<e.length;a++){vde(e,a)?(r=Mu(r,{wasNumber:!0}),n&&(i+="#",n=!1)):n=!0;let s=e[a];switch(s.type){case"terminal":let l=a<e.length-1?e[a+1]:void 0;t=bde(r,s,l),r=t.ctx,i+=t.value,i[i.length-1]===" "&&(n=!0);break;case"command":wde(s)||(o=yde(s,r),r=o.ctx,i+=o.value,i[i.length-1]===" "&&(n=!0));break;case"greek":i+=xde(s),i[i.length-1]===" "&&(n=!0);break;case"fraction":let c=Sde(r,s);i+=c.value,r=c.ctx,n=!1;break;case"radical":let d=Ede(r,s);i+=d.value,n=!0;break;case"level":let p=Dde(r,s);i+=p.value,r=p.ctx,n=!0;break;case"typeform":let u=Mm(r,s.value).value;i+=u,/(ARC)?(SIN|COS|TAN|CSC|SEC|COT)(H)?/.test(u)&&(i+=" ");break}}return{ctx:r,value:i}}function zj(r,e){return e.wasNumber&&/^[A-Ja-j]/.test(r)}function Sde(r,e){let t=Mm(r,e.numerator),o=Mm(r,e.denominator),i;return i3(t.value)&&i3(o.value)?(r=Mu(r,{wasNumber:!0}),i=t.value+"/"+o.value.slice(1)):(r=Mu(r,{wasNumber:!1}),i="("+t.value+"./"+o.value+")"),{ctx:r,value:i}}function i3(r){return/^\#[A-J41]+$/.test(r)}function Ede(r,e){let t="%",o=Mm(r,e.radicand);if(e.index){let i=Mm(r,m3(Nj({"^":e.index})));t+=i.value,/\#[A-J]$/.test(i.value)&&/^[A-J]/.test(o.value)&&(t+=";")}return t+=o.value+"+",{ctx:r,value:t}}function Dde(r,e){let t="",o=kde(e.superscript);t+=o;let i;if(e.subscript){let n=Mm(r,e.subscript);Gj(e.subscript,n.value,0)?i="<"+Tj(n.value)+">":i=n.value,r=Mu(r,{wasNumber:n.ctx.wasNumber}),i!==""&&(t+="5"+i)}if(e.superscript){let n=Mm(r,e.superscript.slice(o.length));Gj(e.superscript,n.value,o.length)?i="<"+Tj(n.value)+">":i=n.value,r=Mu(r,{wasNumber:n.ctx.wasNumber}),(o===""||i!=="")&&(t+="9"+i)}return{ctx:r,value:t}}function Tj(r){return/^;/.test(r)?r.slice(1):r}function kde(r){let e="";if(r)for(let t of r)if(t.type==="command"&&t.value==="\\prime")e+="7";else break;return e}function Gj(r,e,t){let o=r[0],i=(e.match(/\</g)||[]).length,n=/^["|\.|_]?\</.test(e),a=(e.match(/\>/g)||[]).length,s=/["|\.|_]?\>$/.test(e);return!i3(e)&&r.length-t>1&&i===0&&a===0||i>0&&a>0&&(!n||!s)||i>1||a>1||o&&o.type==="typeform"}function _de(){return{capsLock:!1,wasNumber:!1}}function Mu(r,e){return Qw(Qw({},r),e)}function Tde(r){let e=_de();return Mm(e,r).value}var n3={};d3(n3,{baseline:()=>Lde,command:()=>Ide,comparison:()=>Vde,expression:()=>Nde,fraction:()=>Ode,geo_token:()=>Mde,greek:()=>Ude,group:()=>qde,level:()=>b3,level_with_comparison:()=>Ade,modified_expression:()=>Rde,primes:()=>Pde,radical:()=>Fde,simple_subscript:()=>Bde,terminal:()=>Gde});function Gde(r){return{type:"terminal",value:r}}function Ide(r){return{type:"command",value:"\\"+r.trim()+" "}}function Mde(r){return{type:"geo_token",index:r}}var Hj={'"K':"<",'"K:':"\\leq ",$L:"\\parallel ",$O:"\\to ",$P:"\\perp ",".1":">",".1:":"\\geq ",".K":"=","@:.K":"\\cong ","/@:.K":"\\ncong ","@:@:":"\\approx","/$L":"\\nparallel ","/.K":"\\neq ","=":"=","@:":"\\sim ","/@:":"\\nsim "};function Ade(r){let e=/[\^;]+/.exec(r),t=e?e.toString():"",o=r.slice(b3.length);return{type:"level_with_comparison",level:t,value:Hj[o]}}function Vde(r){return{type:"comparison",value:Hj[r]}}function b3(r){return{type:"level",value:r}}function Lde(){return b3("")}function Pde(r){return{type:"primes",value:r}}function Ode(r,e){return{type:"fraction",numerator:r,denominator:e}}function Rde(r,e,t){return{type:"modified_expression",expression:r,under:e,over:t}}function Fde(r,e){return{type:"radical",value:r,index:e}}function Nde(r){return{type:"expression",value:r}}function Bde(r,e){return{type:"simple_subscript",base:r,subscript:e}}var Ij={".&":"\\chi",".,&":"\\Chi",".,:":"\\Eta",".,?":"\\Theta",".,A":"\\Alpha",".,B":"\\Beta",".,D":"\\Delta",".,E":"\\Epsilon",".,F":"\\Phi",".,G":"\\Gamma",".,I":"\\Iota",".,K":"\\Kappa",".,L":"\\Lambda",".,M":"\\Mu",".,N":"\\Nu",".,O":"\\Omicron",".,P":"\\prod",".,R":"\\Rho",".,S":"\\sum",".,T":"\\Tau",".,U":"\\Upsilon",".,W":"\\Omega",".,X":"\\Xi",".,Y":"\\Psi",".,Z":"\\Zeta",".:":"\\eta",".?":"\\theta",".A":"\\alpha",".B":"\\beta",".D":"\\delta",".E":"\\epsilon",".F":"\\phi",".G":"\\gamma",".I":"\\iota",".K":"\\kappa",".L":"\\lambda",".M":"\\mu",".N":"\\nu",".O":"\\omicron",".P":"\\pi",".R":"\\rho",".S":"\\sigma",".T":"\\tau",".U":"\\upsilon",".W":"\\omega",".X":"\\xi",".Y":"\\psi",".Z":"\\zeta"};function Ude(r){if(Ij.hasOwnProperty(r))return Ij[r]+" ";throw new Error("Unknown Greek letter")}function qde(...r){return Array.prototype.concat.apply([],r)}var y3=Vj(),rI=y3.parser.lexer,_b=Object.create(rI),zde=_b,RC=y3.parser.terminals_,Qn=y3.parser.symbols_;_b.setInput=function(r,e){this.delimiterStack=[],this.outputQueue=[],this.canAcceptPrimes=!1,rI.setInput.call(this,r,e)};_b.lex=function(){let r=-1;if(!this)return r;if(this.outputQueue.length)return this.outputQueue.shift();let e=rI.lex.call(this);for(;RC[e]==="UNKNOWN"||!this.canAcceptPrimes&&RC[e]==="PRIMES";)this.warn(),e=rI.lex.call(this);this.canAcceptPrimes=!0;let t,o,i=this.delimiterStack?this.delimiterStack[this.delimiterStack.length-1]:-1;switch(RC[e]){case"OPEN_FRAC":case"OPEN_MODEXP":this.delimiterStack.push(e),this.canAcceptPrimes=!1;break;case"RADICAL_INDEX":i===Qn.RADICAL_INDEX&&(this.delimiterStack.pop(),this.pushCloseTokens(i)),this.delimiterStack.push(e),this.canAcceptPrimes=!1;break;case"OPEN_RADICAL":i===Qn.RADICAL_INDEX&&this.delimiterStack.pop(),this.delimiterStack.push(e),this.canAcceptPrimes=!1;break;case"SLASH":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===Qn.OPEN_FRAC){t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e),this.delimiterStack.push(e),this.canAcceptPrimes=!1;break;case"CLOSE_FRAC":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===Qn.SLASH){t=!0;break}else if(o===Qn.OPEN_FRAC){this.addMissingToken(Qn.SLASH),t=!0;break}else this.pushCloseTokens(o);if(!t)return this.warn(),this.canAcceptPrimes=!1,this.lex();break;case"CLOSE_RADICAL":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===Qn.OPEN_RADICAL){t=!0;break}else if(o===Qn.RADICAL_INDEX){t=!0,this.addMissingToken(Qn.OPEN_RADICAL);break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e);break;case"CLOSE_MODEXP":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===Qn.OPEN_MODEXP){t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e);break;case"EOF":for(;this.delimiterStack.length;)o=this.delimiterStack.pop()||-1,this.pushCloseTokens(o);break}return this.outputQueue.push(e),r=this.outputQueue.shift()||-1,r};_b.warn=function(){this.yylloc&&this.yy.warnings.push({location:this.yylloc})};_b.addMissingToken=function(r){this.outputQueue.push(r),this.warn()};_b.pushCloseTokens=function(r){switch(RC[r]){case"OPEN_FRAC":this.addMissingToken(Qn.SLASH),this.addMissingToken(Qn.CLOSE_FRAC);break;case"SLASH":this.addMissingToken(Qn.CLOSE_FRAC);break;case"RADICAL_INDEX":this.addMissingToken(Qn.OPEN_RADICAL),this.addMissingToken(Qn.CLOSE_RADICAL);break;case"OPEN_RADICAL":this.addMissingToken(Qn.CLOSE_RADICAL);break;case"OPEN_MODEXP":this.addMissingToken(Qn.CLOSE_MODEXP);break}};_b.pushOpenTokens=function(r){switch(RC[r]){case"SLASH":this.addMissingToken(Qn.OPEN_FRAC);break;case"CLOSE_FRAC":this.addMissingToken(Qn.OPEN_FRAC),this.addMissingToken(Qn.SLASH);break;case"CLOSE_RADICAL":this.addMissingToken(Qn.OPEN_RADICAL);break;case"CLOSE_MODEXP":this.addMissingToken(Qn.OPEN_MODEXP);break}};var Hde=Vj();function Kde(r,e){e||(e={});let t=Hde.parser,o=Object.create(t);o.yy=n3,o.yy.warnOrError=n=>{o.parseError(n,{recoverable:!1})};let i=Object.create(t);i.yy=Qw({warnings:[]},n3),i.yy.warnOrError=n=>{i.yy.warnings.push(n)},i.lexer=zde,e.strict?t=o:t=i;try{return{isError:!1,value:t.parse(r),warnings:t.yy.warnings||[]}}catch(n){return{error:f3(n),isError:!0}}}function Gm(r,e){let t="",o=e,i="",n=!1,a="",s="",l=Wde(r);for(let c=0;c<r.length;c++){let d=r[c],p=c+1<r.length?r[c+1]:null;switch(d.type){case"terminal":let u=Pj(r.slice(c));u.value!==""?(t+=u.value,c+=u.terminalCount-1,n=n||u.modified):d.value===" "?(n?(i=a,t+=OC(o,i),o=i):t+="\\ ",n=!1):(l[c]===eI?t+="\\left":l[c]===a3&&(t+="\\right"),t+=d.value);break;case"comparison":i="",t+=OC(o,i),o=i,n=!1,t+=d.value;break;case"level_with_comparison":t+=OC(o,d.level),o=d.level,n=!1,t+=d.value;break;case"command":let h=d.value.slice(1).trim();p&&p.type==="terminal"&&/[a-z]/.test(p.value)?(t+=h,n=!1):h3(h)?(t+="\\operatorname{"+h+"}",n=!0):(t+=d.value,n=!0),a=o;break;case"expression":t+=d.value;break;case"fraction":t+=Xde(d.numerator,d.denominator,o);break;case"geo_token":t+="\\token{"+d.index.value+"}";break;case"modified_expression":t+=Gm(d.expression,o)+" ",d.under&&(t+="_{"+Gm(d.under,o)+"}"),d.over&&(t+="^{"+Gm(d.over,o)+"}");break;case"radical":t+="\\sqrt",d.index&&(t+="["+Gm(d.index,o)+"]"),t+="{"+Gm(d.value,o)+"}";break;case"simple_subscript":o===""?(t+=d.base.value+"_{"+d.subscript.value+"}",d.base.type==="command"&&(n=!0,a=o)):t+=d.base.value+d.subscript.value;break;case"level":t+=OC(o,d.value,s),o=d.value,d.value==="^"&&s!==""&&(s="");break;case"primes":p&&p.type==="level"&&p.value===";"?s=d.value:o!==""?(t+=Array(d.value.length+1).join("\\prime "),s=""):(t+=d.value,s="");break}}return t+=OC(o,e)+s,t.replace(/([^\\])( )$/,"$1")}var eI=1,a3=-1,QG=0,r3=2;function Wde(r){let e=[],t=[];for(let o=0;o<r.length;o++){let i=r[o];if($de(i))e.push({direction:eI,index:o}),t.push(QG);else if(jde(i)){for(;e.length&&e[e.length-1].direction===r3;)e.pop();if(e.length){let n=e.pop();if(n){let a=n.index;t[a]=eI,t.push(a3)}}else t.push(QG)}else if(Yde(i))if(e.length&&e[e.length-1].direction===r3){let n=e.pop();if(n){let a=n.index;t[a]=eI,t.push(a3)}}else e.push({direction:r3,index:o}),t.push(QG);else t.push(QG)}return t}function $de(r){return r.type==="terminal"?/^(\\langle |\[|\(|\\{)$/.test(r.value):!1}function jde(r){return r.type==="terminal"?/^(\\rangle |\]|\)|\\})$/.test(r.value):!1}function Yde(r){return r.type==="terminal"?/^(\\\||\|)$/.test(r.value):!1}function Xde(r,e,t){return"\\frac{"+Gm(r,t)+"}{"+Gm(e,t)+"}"}function OC(r,e,t){let o="",i,n,a,s=Math.max(r.length,e.length);for(i=0;i<s&&r[i]===e[i];i++);for(n=r.length-1;n>=i;n--)o+="}";for(a=i;a<e.length;a++)e[a]==="^"&&(t&&(o+=t),o+="^{"),e[a]===";"&&(o+="_{");return o}function Jde(r){return Gm(r,"")}function Qde(r,e){return e&&e.operatorNames?aI(e.operatorNames):sI(),ev(Kde(r,e),Jde)}var x3=Lj(),oI=x3.parser.lexer,Tb=Object.create(oI),Zde=Tb,iI=x3.parser.terminals_,is=x3.parser.symbols_;Tb.setInput=function(r,e){this.delimiterStack=[],this.outputQueue=[],oI.setInput.call(this,r,e)};Tb.lex=function(){let r=-1;if(this.outputQueue.length)return this.outputQueue.shift();let e=oI.lex.call(this);for(;iI[e]==="UNKNOWN";)this.warn(),e=oI.lex.call(this);let t,o,i=this.delimiterStack?this.delimiterStack[this.delimiterStack.length-1]:-1;switch(iI[e]){case"OPEN_FRAC":this.delimiterStack.push(e);break;case"OPEN_GROUP":this.delimiterStack.push(e);break;case"RADICAL_WITH_INDEX":i===is.RADICAL_WITH_INDEX&&(this.delimiterStack.pop(),this.pushCloseTokens(i)),this.delimiterStack.push(e);break;case"RADICAL":i===is.RADICAL_WITH_INDEX&&this.delimiterStack.pop(),this.delimiterStack.push(e);break;case"OVER":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===is.OPEN_FRAC){t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e),this.delimiterStack.push(e);break;case"CLOSE_FRAC":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===is.OVER){t=!0;break}else if(o===is.OPEN_FRAC){this.outputQueue.push(is.OVER),t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e);break;case"CLOSE_GROUP":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===is.OPEN_GROUP){t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e);break;case"CLOSE_RADICAL":for(t=!1;this.delimiterStack.length;)if(o=this.delimiterStack.pop()||-1,o===is.RADICAL||o===is.RADICAL_WITH_INDEX){t=!0;break}else this.pushCloseTokens(o);t||this.pushOpenTokens(e);break;case"EOF":for(;this.delimiterStack.length;)o=this.delimiterStack.pop()||-1,this.pushCloseTokens(o);break}return this.outputQueue.push(e),r=this.outputQueue.shift()||-1,r};Tb.warn=function(){this.yylloc&&this.yy.warnings.push({location:this.yylloc})};Tb.addMissingToken=function(r){this.outputQueue.push(r),this.warn()};Tb.pushCloseTokens=function(r){switch(iI[r]){case"OPEN_FRAC":this.addMissingToken(is.OVER),this.addMissingToken(is.CLOSE_FRAC);break;case"OVER":this.addMissingToken(is.CLOSE_FRAC);break;case"OPEN_GROUP":this.addMissingToken(is.CLOSE_GROUP);break;case"RADICAL_WITH_INDEX":case"RADICAL":this.addMissingToken(is.CLOSE_RADICAL);break}};Tb.pushOpenTokens=function(r){switch(iI[r]){case"OVER":this.addMissingToken(is.OPEN_FRAC);break;case"CLOSE_FRAC":this.addMissingToken(is.OPEN_FRAC),this.addMissingToken(is.OVER);break;case"CLOSE_GROUP":this.addMissingToken(is.OPEN_GROUP);break;case"CLOSE_RADICAL":this.addMissingToken(is.RADICAL);break}};var s3={};d3(s3,{basic_level:()=>rpe,bracketed_level:()=>ope,command:()=>tpe,expression:()=>lpe,fraction:()=>npe,geo_token:()=>spe,greek:()=>dpe,group:()=>cpe,primes:()=>ipe,radical:()=>ape,terminal:()=>epe,to_number:()=>ppe});function epe(r){return{type:"terminal",value:r}}function tpe(r){return{type:"command",value:r}}function rpe(r,e){return{type:"basic_level",level:r,value:e}}function ope(r,e,t,o){return{type:"bracketed_level",level:r,lbrack:e,value:t,rbrack:o}}function ipe(r){return{type:"primes",value:r.length>0?Array(r.length+1).join("'"):""}}function npe(r,e){return{type:"fraction",numerator:r,denominator:e}}function ape(r,e){return{type:"radical",value:r,index:e}}function spe(r){return{type:"geo_token",index:r}}function lpe(r){return{type:"expression",value:r}}function cpe(...r){return Array.prototype.concat.apply([],r)}var Mj={",.&":"\\Chi",",.:":"\\Eta",",.?":"\\Theta",",.A":"\\Alpha",",.B":"\\Beta",",.D":"\\Delta",",.E":"\\Epsilon",",.F":"\\Phi",",.G":"\\Gamma",",.I":"\\Iota",",.K":"\\Kappa",",.L":"\\Lambda",",.M":"\\Mu",",.N":"\\Nu",",.O":"\\Omicron",",.P":"\\prod",",.R":"\\Rho",",.S":"\\sum",",.T":"\\Tau",",.U":"\\Upsilon",",.W":"\\Omega",",.X":"\\Xi",",.Y":"\\Psi",",.Z":"\\Zeta",".&":"\\chi",".:":"\\eta",".?":"\\theta",".A":"\\alpha",".B":"\\beta",".D":"\\delta",".E":"\\epsilon",".F":"\\phi",".G":"\\gamma",".I":"\\iota",".K":"\\kappa",".L":"\\lambda",".M":"\\mu",".N":"\\nu",".O":"\\omicron",".P":"\\pi",".R":"\\rho",".S":"\\sigma",".T":"\\tau",".U":"\\upsilon",".W":"\\omega",".X":"\\xi",".Y":"\\psi",".Z":"\\zeta"};function dpe(r){if(Mj.hasOwnProperty(r))return Mj[r]+" ";throw new Error("Unknown Greek letter")}function ppe(r){let e="";for(let o of r)o==="4"?e+=".":o==="J"?e+="0":e+=o.charCodeAt(0)-64;return e}var upe=Lj();function hpe(r,e){e||(e={});let t=upe.parser,o=Object.create(t);o.yy=s3;let i=Object.create(t);i.yy=Qw({warnings:[]},s3),i.lexer=Zde,e.strict?t=o:t=i;try{return{isError:!1,value:t.parse(r),warnings:t.yy.warnings||[]}}catch(n){return{error:f3(n),isError:!0}}}function kb(r,e){let t="",o=!1,i="",n=gpe(r);for(let a=0;a<r.length;a++){let s=r[a],l=a+1<r.length?r[a+1]:null;switch(s.type){case"terminal":let c=Pj(r.slice(a));c.value!==""?(t+=c.value,a+=c.terminalCount-1):s.value===" "&&!o?t+="\\ ":(n[a]===tI?t+="\\left":n[a]===l3&&(t+="\\right"),t+=s.value),o=!1;break;case"command":let d=s.value.slice(1).trim();l&&l.type==="terminal"&&/[a-z]/.test(l.value)?(t+=d,o=!1):h3(d)?(t+="\\operatorname{"+d+"}",o=!0):(t+=s.value,o=!0);break;case"expression":t+=s.value;break;case"fraction":t+=ype(s.numerator,s.denominator);break;case"radical":t+="\\sqrt",s.index&&(t+="["+kb(s.index)+"]"),t+="{"+kb(s.value)+"}";break;case"geo_token":t+="\\token{"+s.index.value+"}";break;case"basic_level":t+=xpe(s.level,s.value,i),s.level==="9"&&(i="");break;case"bracketed_level":t+=wpe(s.level,s.lbrack,s.value,s.rbrack,i),s.level==="9"&&(i="");break;case"primes":l&&(l.type==="basic_level"||l.type==="bracketed_level")&&l.level==="5"?i=s.value:e&&e!==""?(t+=Array(s.value.length+1).join("\\prime "),i=""):(t+=s.value,i="");break}}return t+=i,t.replace(/([^\\])( )$/,"$1")}var tI=1,l3=-1,ZG=0,o3=2;function gpe(r){let e=[],t=[];for(let o=0;o<r.length;o++){let i=r[o];if(mpe(i))e.push({direction:tI,index:o}),t.push(ZG);else if(fpe(i)){for(;e.length&&e[e.length-1].direction===o3;)e.pop();if(e.length){let n=e.pop();if(n){let a=n.index;t[a]=tI,t.push(l3)}}else t.push(ZG)}else if(bpe(i))if(e.length&&e[e.length-1].direction===o3){let n=e.pop();if(n){let a=n.index;t[a]=tI,t.push(l3)}}else e.push({direction:o3,index:o}),t.push(ZG);else t.push(ZG)}return t}function mpe(r){return r.type==="terminal"?/^(\\langle |\[|\(|\\{)$/.test(r.value):!1}function fpe(r){return r.type==="terminal"?/^(\\rangle |\]|\)|\\})$/.test(r.value):!1}function bpe(r){return r.type==="terminal"?/^(\\\||\|)$/.test(r.value):!1}function ype(r,e){return"\\frac{"+kb(r)+"}{"+kb(e)+"}"}function xpe(r,e,t){let o="",i="{"+kb(e,r)+"}";return r==="9"?o+=t+"^"+i:r==="5"&&(o+="_"+i),o}function wpe(r,e,t,o,i){let n="",a="{"+e+kb(t,r)+o+"}";return r==="9"?n+=i+"^"+a:r==="5"&&(n+="_"+a),n}var vpe=kb;function Cpe(r,e){return e&&e.operatorNames?aI(e.operatorNames):sI(),ev(hpe(r,e),t=>vpe(t,""))}var Kj=` A1B'K2L@CIF/MSP"E3H9O6R^DJG>NTQ,*5<-U8V.%[$+X!&;:4\\0Z7(_?W]#Y)=`,Wj=10240;function Spe(r){return String.fromCharCode(Wj+r)}function Epe(r){return r.charCodeAt(0)-Wj}function Dpe(r){return Kj[r]}function kpe(r){return Kj.indexOf(r)}function _pe(r){let e="";for(let t of r)e+=Spe(kpe(t));return e}function $j(r){let e="";for(let t of r)e+=Dpe(Epe(t));return e}function Tpe(r){return $j(r).replace(/[@-^]/g,e=>String.fromCharCode(e.charCodeAt(0)+32))}function Gpe(r){let e="";if(r)for(let t of r){let o=t.charCodeAt(0);96<=o&&o<=127&&(o-=32,t=String.fromCharCode(o)),32<=o&&o<=95&&(t=_pe(t),o=t.charCodeAt(0)),10305<=o&&o<=10495&&(o=10240+(o-1024)%64,t=String.fromCharCode(o)),10240<=o&&o<=10304?e+=t:e+="\u2800"}return e}function Ipe(r){for(let e=0;e<r.length;e++){let t=r.charCodeAt(e);if(t<10240||t>10304)return!1}return!0}function jj(r){if(!Ipe(r))throw new Error("EncodingError: Expected input to be six-dot unicode braille characters.")}function w3(r,e){return jj(r),Qde(Ks.toBrailleAscii(r),e)}function Hh(r,e){return e&&e.operatorNames?aI(e.operatorNames):sI(),ev(ide(r),Ks.coerceToSixDotCells)}function v3(r,e){return jj(r),Cpe(Ks.toBrailleAscii(r),e)}function Kh(r,e){return e&&e.operatorNames?aI(e.operatorNames):sI(),ev(fde(r),Ks.coerceToSixDotCells)}var Ks={coerceToSixDotCells:Gpe,toBrailleAscii:$j,toExpandedBrailleAscii:Tpe},Mpe="1.0.3";var kc=class{constructor(e,t,o){this.screen=e,this.viewport=t,this.settings=o,this.mathCoordinates=__dcg_shared_module_exports__['Md'](t),this.pixelCoordinates=__dcg_shared_module_exports__['Ld'](e),this.updateScalePairs()}updateScalePairs(){let{xAxisScale:e,yAxisScale:t}=this.settings;this.mathToPixels=__dcg_shared_module_exports__['Nd'].fromRects(this.mathCoordinates,this.pixelCoordinates,{xAxisScale:e,yAxisScale:t}),this.pixelsToMath=this.mathToPixels.inverse()}mapx(e){return this.mathToPixels.mapX(e)}mapy(e){return this.mathToPixels.mapY(e)}reverse_mapx(e){return this.pixelsToMath.mapX(e)}reverse_mapy(e){return this.pixelsToMath.mapY(e)}mapAlongAxis(e,t){switch(t){case"x":return this.mapx(e);case"y":return this.mapy(e);default:{let o=t;throw new Error(`Unknown axis: ${o}`)}}}reverseMapAlongAxis(e,t){switch(t){case"x":return this.reverse_mapx(e);case"y":return this.reverse_mapy(e);default:{let o=t;throw new Error(`Unknown axis: ${o}`)}}}map_pt(e){return this.mathToPixels.mapPoint(e)}map_xy_pairs(e){let t=[];for(let o=0;o<e.length;o+=2)t.push(this.mapx(e[o])),t.push(this.mapy(e[o+1]));return t}reverse_map_pt(e){return this.pixelsToMath.mapPoint(e)}coordsAreOnscreen(e,t,o=0){return e>-o&&t>-o&&e<this.screen.width+o&&t<this.screen.height+o}closestPointOnScreen(e){let t=this.pixelCoordinates;return{x:Math.min(Math.max(e.x,t.left),t.right),y:Math.min(Math.max(e.y,t.top),t.bottom)}}};var rd=class{constructor(e,t){this.width=e,this.height=t}};var Ape=10240;function Vpe(r,e,t,o,i){let{dotSpacing:n}=r,a=1+n,s=i.charCodeAt(0)-Ape;s&1&&e.fillRect(t,o,1,1),s&2&&e.fillRect(t,o+a,1,1),s&4&&e.fillRect(t,o+2*a,1,1),s&8&&e.fillRect(t+a,o,1,1),s&16&&e.fillRect(t+a,o+a,1,1),s&32&&e.fillRect(t+a,o+2*a,1,1)}function dI(r,e){let{x:t,y:o,width:i,height:n}=e,a=r.getImageData(t,o,i,n).data;for(let s=3;s<a.length;s+=4)if(a[s]!==0)return!1;return!0}function Lpe(r,e){let{x:t,y:o,width:i,height:n}=e,a=r.getImageData(t,o,i,n).data;for(let s=3;s<a.length;s+=4)if(a[s]===0)return!1;return!0}function C3(r,e,t,o,i){return dI(e,uI(r,t,o,i))}function Ppe(r,e,t,o,i){let{dotSpacing:n}=r,a=3+2*n;for(let s=0;s<i.length;s++)Vpe(r,e,t+a*s,o,i[s])}function $h(r,e){let{dotSpacing:t}=r;return(2+t)*e.length+(1+t)*(e.length-1)}function pI(r,e){let{dotSpacing:t}=r;return 3+2*t}function uI(r,e,t,o){let{cellPadding:i}=r;return{x:e-i,y:t-i,width:$h(r,o)+2*i,height:pI(r,o)+2*i}}function lI(r,e){if(!r)return e;let t=Math.min(r.x,e.x),o=Math.min(r.y,e.y),i=Math.max(r.x+r.width,e.x+e.width)-t,n=Math.max(r.y+r.height,e.y+e.height)-o;return{x:t,y:o,width:i,height:n}}function Yj(r,e,t){return Math.min(Math.max(r,e),t)}function FC(r,e,t,o,i){return{x:Yj(t,0,e.canvas.width-$h(r,i)),y:Yj(o,0,e.canvas.height-pI(r,i))}}function NC(r,e,t,o,i){let n=e.fillStyle;e.fillStyle="white";let a=uI(r,t,o,i);e.fillRect(a.x,a.y,a.width,a.height),e.fillStyle="black",Ppe(r,e,t,o,i),e.fillStyle=n}function S3(r,e,t,o){let{cellPadding:i}=r;return{x:Math.round(e-($h(r,o)+i)),y:t}}function Ope(r){return r.replace(/\u283C(?!$)/g,"")}function Wh(r,e){let t=e==="nemeth"?Hh(r):Kh(r);return t.isError?"":Ope(t.value)}function rv(r,e){return e>=0?r*Math.pow(10,e):r/Math.pow(10,-e)}function Jj(r,e,t,o){let[i,n]=t,a=Math.ceil(Math.log(n-i)/Math.LN10)-1,s=a,l=5,c=15;e:for(let d=a;a-d<4;d--)for(let p of[5,2,1]){let u=rv(p,d),h=Math.floor(i/u)+1,m=Math.ceil(n/u)-1,y=Math.abs(o(u)-o(0)),w=Wh(String(rv(h*p,d)),e),S=Wh(String(rv(m*p,d)),e);if(y<$h(r,w)+$h(r," ")||y<$h(r,S)+$h(r," ")||m-h>=c)break e;s=d,l=p}return{int:l,exp:s}}function Qj(r,e,t){return Jj(r,e,[t.viewport.xmin,t.viewport.xmax],o=>t.mapx(o))}function Rpe(r,e,t){return t.viewport.isSquare(t.screen,{xAxisScale:t.settings.xAxisScale,yAxisScale:t.settings.yAxisScale})?Qj(r,e,t):Jj(r,e,[t.viewport.ymin,t.viewport.ymax],o=>t.mapy(o))}function Xj(r,e){let{int:t,exp:o}=r,[i,n]=e,a=Math.ceil(i/rv(t,o)),s=Math.floor(n/rv(t,o)),l=[];for(let c=a;c<=s;c++)l.push(rv(c*t,o));return l}function Fpe(r,e,t){return{x:Xj(Qj(r,e,t),[t.viewport.xmin,t.viewport.xmax]),y:Xj(Rpe(r,e,t),[t.viewport.ymin,t.viewport.ymax])}}function Zj(r,e,t,o,i,n){if(t.margins===void 0||e===void 0)return;let a=Npe(o),s=t.margins,l={...e.settings},c=l.showGrid&&Bpe(o),d=!!l.showXAxis,p=!!l.showYAxis,u=!!l.xAxisNumbers,h=l.xAxisArrowMode,m=!!l.yAxisNumbers,y=l.yAxisArrowMode,w=a.graphLineWidth,S={showGrid:!1,xAxisNumbers:!1,xAxisArrowMode:"NONE",yAxisNumbers:!1,yAxisArrowMode:"NONE",showXAxis:!1,showYAxis:!1,graphLineWidth:w,pointLineWidth:2.5,curveOpacity:1,globalCurveColor:"#000",disableFill:!0};for(let U in S)e.settings[U]=S[U];let C=r.width-s.right-s.left,v=r.height-s.top-s.bottom,E=new rd(C,v),_=e.getProjection().viewport;e.settings.squareAxes&&(_=_.squareCrop(E,e.settings));let T=new kc(E,_,e.settings),I=r.getContext("2d"),P=document.createElement("canvas");P.width=C,P.height=v;let O=P.getContext("2d"),W=document.createElement("canvas");W.width=C,W.height=v;let X=W.getContext("2d"),x=document.createElement("canvas");x.width=C,x.height=v;let L=x.getContext("2d"),R=document.createElement("canvas");R.width=C,R.height=v;let N=R.getContext("2d"),z=document.createElement("canvas");z.width=C,z.height=v;let A=z.getContext("2d");if(I!==null&&N!==null&&O!==null&&L!==null&&A!==null&&X!==null){e.settings.disableFill=!0,e.screenshotToCanvas(R,{width:C,height:v,targetPixelRatio:1,transparentBackground:!0,showMovablePoints:n}),e.settings.disableFill=!1,e.screenshotToCanvas(P,{width:C,height:v,targetPixelRatio:1,transparentBackground:!0,showMovablePoints:n}),I.fillStyle="white",I.fillRect(0,0,r.width,r.height);let U=Math.round(T.mapx(0)),pe=Math.round(T.mapy(0)),q=l.xAxisLabel!==""?l.xAxisLabel.replace(/ /g,"\\ "):"x",F=l.yAxisLabel!==""?l.yAxisLabel.replace(/ /g,"\\ "):"y",ge=1;if(d&&T.coordsAreOnscreen(C-6,pe-8,0)){let j={...a,cellPadding:a.cellPadding+ge},oe=2+2*pI(j,q),Y=C-2,fe=pe-oe,ye=Wh(q,i);({x:Y,y:fe}=S3(j,Y,fe,ye)),{x:Y,y:fe}=FC(j,O,Y,fe,ye),NC(j,A,Y,fe,ye)}if(p&&T.coordsAreOnscreen(U+4,1,0)){let j={...a,cellPadding:a.cellPadding+ge},oe=U+4,Y=1,fe=Wh(F,i);({x:oe,y:Y}=FC(j,O,oe,Y,fe)),NC(j,A,oe,Y,fe)}let{x:ne,y:ae}=Fpe(a,i,T);if(d){let j;for(let oe of ne){if(oe===0&&p)continue;let Y=Math.round(T.mapx(oe));if(!(Y<2||Y>T.screen.width-2)&&u){let fe=$h(a,Wh("-1",i))-$h(a,Wh("1",i)),ye=oe<0?fe+1:1,Ce=Y-ye,De=pe+4,Ge=Wh(""+oe,i);({x:Ce,y:De}=FC(a,A,Ce,De,Ge)),C3(a,N,Ce,De,Ge)&&(NC(a,A,Ce,De,Ge),j=lI(j,uI(a,Ce,De,Ge)))}}a.embossPatternInequalities&&j&&(j=lI(j,{x:0,y:pe,width:C,height:0}),L.fillStyle="white",L.fillRect(j.x,j.y,j.width,j.height))}if(p){let j;for(let oe of ae){if(oe===0&&d)continue;let Y=Math.round(T.mapy(oe));if(Y<2||Y>T.screen.height-2)continue;let fe=-Math.ceil(pI(a," ")/2);if(m){let ye=U-4,Ce=Y+fe,De=Wh(""+oe,i);({x:ye,y:Ce}=S3(a,ye,Ce,De)),{x:ye,y:Ce}=FC(a,A,ye,Ce,De),C3(a,N,ye,Ce,De)&&(NC(a,A,ye,Ce,De),j=lI(j,uI(a,ye,Ce,De)))}}a.embossPatternInequalities&&j&&(j=lI(j,{x:U,y:0,width:0,height:v}),L.fillStyle="white",L.fillRect(j.x,j.y,j.width,j.height))}if(d&&p){let j=U-2,oe=pe+2,Y=Wh(u||m?"0":"o",i);({x:j,y:oe}=S3(a,j,oe,Y)),T.coordsAreOnscreen(j,oe,0)&&({x:j,y:oe}=FC(a,A,j,oe,Y),C3(a,N,j,oe,Y)&&NC(a,A,j,oe,Y))}for(let j of ne){let oe=Math.round(T.mapx(j));oe<2||oe>T.screen.width-2||p&&j===0||c&&BC(L,"white",oe-1,0,v,3)}for(let j of ae){let oe=Math.round(T.mapy(j));oe<2||oe>T.screen.height-2||d&&j===0||c&&UC(L,"white",oe-1,0,C,3)}d&&UC(L,"white",pe-3,0,C,7),p&&BC(L,"white",U-3,0,v,7);for(let j of ne){let oe=Math.round(T.mapx(j));oe<2||oe>T.screen.width-2||p&&j===0||(c?BC(L,cI(o),oe,0,v):d&&BC(L,cI(o),oe,pe-3,pe+2))}for(let j of ae){let oe=Math.round(T.mapy(j));oe<2||oe>T.screen.height-2||d&&j===0||(c?UC(L,cI(o),oe,0,C):p&&UC(L,cI(o),oe,U-3,U+2))}if(d&&UC(L,tv(o),pe,0,C),p&&BC(L,tv(o),U,0,v),y!=="NONE"&&(Hpe(L,tv(o),U,0),y==="BOTH"&&zpe(L,tv(o),U,v-1)),h!=="NONE"&&(Upe(L,tv(o),C-1,pe),h==="BOTH"&&qpe(L,tv(o),0,pe)),a.embossPatternInequalities)for(let j=0;j<C;j+=6)for(let oe=0;oe<v;oe+=6){let Y={x:j,y:oe,width:3,height:3};Lpe(O,Y)&&dI(L,Y)&&dI(N,Y)&&dI(A,Y)&&Kpe(X,"black",j,oe)}a.embossPatternInequalities||I.drawImage(P,s.left,s.top),I.drawImage(x,s.left,s.top),I.drawImage(R,s.left,s.top),I.drawImage(z,s.left,s.top),a.embossPatternInequalities&&I.drawImage(W,s.left,s.top)}for(let U in S)e.settings[U]=l[U]}function Npe(r){if(r==="etc8"||r==="etc11")return{dotSpacing:0,cellPadding:1,graphLineWidth:1.75,embossPatternInequalities:!0};if(r==="vpmax8"||r==="vpmax11")return{dotSpacing:1,cellPadding:2,graphLineWidth:1,embossPatternInequalities:!1};{let e=r;throw new Error(`Unexpected embosser model ${e}`)}}function Bpe(r){if(r==="etc8"||r==="etc11")return!1;if(r==="vpmax8"||r==="vpmax11")return!0;{let e=r;throw new Error(`Unexpected embosser model ${e}`)}}function tv(r){switch(r){case"vpmax8":case"vpmax11":return"rgb(145, 145, 145)";case"etc8":case"etc11":return"rgb(0, 0, 0)";default:let e=r;throw new Error("Unexpected embosser model: "+e)}}function cI(r){switch(r){case"vpmax8":case"vpmax11":return"rgb(219, 219, 219)";case"etc8":case"etc11":return"rgb(0, 0, 0)";default:let e=r;throw new Error("Unexpected embosser model: "+e)}}function BC(r,e,t,o,i,n=1){let a=r.fillStyle;r.fillStyle=e,r.fillRect(t-1,o,n,i-o),r.fillStyle=a}function UC(r,e,t,o,i,n=1){let a=r.fillStyle;r.fillStyle=e,r.fillRect(o,t-1,i-o,n),r.fillStyle=a}function Upe(r,e,t,o){let i=r.fillStyle;r.fillStyle=e;for(let n=-2;n<=2;n++)r.fillRect(t-Math.abs(n),o-1+n,1,1);r.fillStyle=i}function qpe(r,e,t,o){let i=r.fillStyle;r.fillStyle=e;for(let n=-2;n<=2;n++)r.fillRect(t+Math.abs(n),o-1+n,1,1);r.fillStyle=i}function zpe(r,e,t,o){let i=r.fillStyle;r.fillStyle=e;for(let n=-2;n<=2;n++)r.fillRect(t-1+n,o-Math.abs(n),1,1);r.fillStyle=i}function Hpe(r,e,t,o){let i=r.fillStyle;r.fillStyle=e;for(let n=-2;n<=2;n++)r.fillRect(t-1+n,o+Math.abs(n),1,1);r.fillStyle=i}function Kpe(r,e,t,o){let i=r.fillStyle;r.fillStyle=e,r.fillRect(t+1,o,1,1),r.fillRect(t,o+1,1,1),r.fillRect(t+1,o+1,1,1),r.fillRect(t+2,o+1,1,1),r.fillRect(t+1,o+2,1,1),r.fillStyle=i}var eVe=__dcg_shared_module_exports__['e'](Z());function E3(r,e){return`${r}_dcg_delim_${e}`}var qC=class{constructor(e){this.hoveredObjects={},this.grapher=e,this.controller=this.grapher.controller,this.renderedTabTargetOrder=[],this.renderedTabTargets={}}getOrderedTabTargets(){return this.renderedTabTargetOrder.map(e=>{let t=this.renderedTabTargets[e];return{calcId:t.id,listIndex:t.listIndex,polygonEdge:void 0,description:t.description}})}recomputeClickableObjects(){this.renderedTabTargets={},this.renderedTabTargetOrder=[];for(let e of this.grapher.getTabOrder()){let t=this.controller.getItemModel(e);if(!t)continue;let o=this.grapher.getGraphSketch(e),i=this.grapher.getGraphImage(e);if(o&&t.type==="expression"&&xs(t))for(let n=0;n<o.branches.length;n++){let a=o.branches[n];if(!a.segments||a.segments.length===0)continue;let s=0;__dcg_shared_module_exports__['ge'](a)?o.getBranchPOI(n).forEach(l=>{s=l.pointIdxOnBranch||0,isFinite(l.x)&&isFinite(l.y)&&this.addTabTarget(t,s)}):(s="listIndex"in a&&a.listIndex!==void 0?a.listIndex:0,a.segments.length>0&&this.addTabTarget(t,s))}else if(i&&i.shouldGraph&&t.type==="image"&&ab(t)){let n=t.formula&&t.formula.dimensions;if(!n||!n.x||!n.y||!n.width||!n.height||!n.radianAngle)continue;for(let a=0;a<n.x.length;a++)isFinite(n.x[a])&&isFinite(n.y[a])&&isFinite(n.width[a])&&isFinite(n.height[a])&&isFinite(n.radianAngle[a])&&this.addTabTarget(t,a)}}Object.keys(this.hoveredObjects).length||this.pressedObject?this.grapher.setLayerClass("clickableObjects","dcg-mouse-over-clickable-object"):this.grapher.setLayerClass("clickableObjects",void 0)}addTabTarget(e,t){let o=E3(e.id,t);this.renderedTabTargetOrder.indexOf(o)!==-1||this.renderedTabTargets[o]!==void 0||(this.renderedTabTargetOrder.push(o),this.renderedTabTargets[o]={type:e.type,id:e.id,listIndex:t,description:this.getComputedDescription(e,t)})}getTabIndex(e){if(this.controller.getActiveTool()!=="selection"||!this.renderedTabTargets[e])return-1;let o=this.grapher.settings;return!o.config.graphpaper||!o.config.enableTabindex?-1:0}getAriaHidden(){return!this.grapher.settings.config.graphpaper}getCachedDescription(e){return this.renderedTabTargets[e].description}getComputedDescription(e,t){let o=e.formula&&e.formula.computed_description&&e.formula.computed_description[t];return o&&o!==""?rn(o):this.grapher.getAudioTrace().getExpressionAriaLabel(e.id)}getModelId(e){let t=this.renderedTabTargets[e];return t?t.id:""}getListIndex(e){let t=this.renderedTabTargets[e];if(t)return t.listIndex}isKeyboardFocused(e,t){if(!e)return!1;let o=this.grapher.poiController.keyboardAttentionManager.getKeyboardAttention(),i=o==null?void 0:o.calcId;return e===i&&(t===void 0||t===(o==null?void 0:o.listIndex))}shouldDrawHovered(e,t,o){if(!t)return!1;if(this.isKeyboardFocused(t,o))return!0;let{translationPreviewVectorParents:i,rotationPreviewAngleMarkerParents:n}=e.transformationPreviewParentData;if(i.has(t)||n.has(t)&&!this.controller.isToolPreviewItem(t))return!0;if(this.isAnObjectPressed()&&!this.isObjectPressed(t))return!1;let a=this.getHoveredObjectById(t);return a?a.listIndexes===void 0||o===void 0?!0:!!a.listIndexes[o]:!1}setHoveredObjects(e){__dcg_shared_module_exports__['J'](e,this.hoveredObjects)||(this.hoveredObjects=e,this.requestRedrawNextFrame())}getHoveredObjects(){let e=this.grapher.poiController.keyboardAttentionManager.getKeyboardAttention();if(e){let t=__dcg_shared_module_exports__['i'](this.hoveredObjects),o=t[e.calcId],i=e.listIndex||0;return o?o.listIndexes?o.listIndexes[i]=!0:o.listIndexes={[i]:!0}:(o={listIndexes:{[i]:!0}},t[e.calcId]=o),t}else return this.hoveredObjects}getHoveredObjectById(e){return this.getHoveredObjects()[e]}shouldDrawPressed(e,t){if(!e)return!1;let o=this.pressedObject;return!o||o.id!==e?!1:t===void 0?!0:o.listIndex===t}isObjectPressed(e){return e===void 0?!1:!!(this.pressedObject&&this.pressedObject.id===e)}setPressedObject(e){!e&&!this.pressedObject||e&&this.pressedObject&&e.id===this.pressedObject.id&&e.listIndex===this.pressedObject.listIndex||(this.pressedObject=e,this.requestRedrawNextFrame())}getPressedObject(){return this.pressedObject}isAnObjectPressed(){return!!this.pressedObject}requestRedrawNextFrame(){this.controller.requestRedrawGraph()}shouldDrawGhosted(e){if(!e)return!1;let t=this.controller.getItemModel(e);return!t||t.type!=="expression"?!1:ma(t)}};var jh=__dcg_shared_module_exports__['e'](Z()),{If:$pe}=jh.Components,hI=class extends jh.Class{init(){this.controller=this.props.grapher().controller,this.poiController=this.props.grapher().poiController}template(){return jh.createElement($pe,{predicate:this.bindFn(this.showCursor)},()=>jh.createElement("div",{class:jh.const("dcg-geo-keyboard-cursor"),style:()=>({top:`${this.getPosition().y}px`,left:`${this.getPosition().x}px`})}))}getPosition(){let e=this.poiController.getGeoKeyboardPt(),t=this.props.grapher().getProjection();return{x:t.mapx(e.x),y:t.mapy(e.y)}}showCursor(){return this.controller.isVirtualMouseAllowed()}};var eY=__dcg_shared_module_exports__['e'](Z());var ll=__dcg_shared_module_exports__['e'](Z());var{If:jpe}=ll.Components,gI=class extends ll.Class{init(){this.grapher=this.props.grapher(),this.controller=this.grapher.controller,this.width=0,this.height=0,this.pixelRatio=0}getDevicePixelRatio(){return window.devicePixelRatio||1}template(){return ll.createElement("div",{class:ll.const("dcg-graph-outer"),didMount:e=>this.rootNode=e,manageFocus:this.const(ct({controller:this.controller,location:{type:"graph-paper"}}))},ll.createElement("div",{tabIndex:()=>this.getShiftTabElementTabIndex(),onFocus:()=>{let e=this.rootNode.getAttribute("aria-label")||"";this.rootNode.setAttribute("aria-label",""),this.rootNode.focus(),this.rootNode.setAttribute("aria-label",e),this.controller.get2dPOIController().handleTabEvent("prev")}}),ll.createElement(jpe,{predicate:()=>this.isIOSAndIframe()},()=>ll.createElement("div",{style:ll.const("width:1px; height:.5px; pointer-events:none; opacity: 0;"),"aria-hidden":ll.const("true")},ll.const("text"))),ll.createElement("canvas",{class:ll.const("dcg-graph-inner"),didMount:e=>{this.canvasNode=e,this.ctx=this.canvasNode.getContext("2d"),this.resize(0,0)},style:()=>({position:"relative",display:"block",outline:"none","-webkit-transform":this.isIOSAndIframe()?"translate3d(0,-.25px,0)":void 0})}))}getShiftTabElementTabIndex(){var t;return((t=this.rootNode)==null?void 0:t.getAttribute("tabindex"))!=="0"||this.controller.getActiveTool()!=="selection"||this.rootNode===document.activeElement?"-1":"0"}isIOSAndIframe(){return mc&&Eh}resize(e,t,o){var i;o=o||this.getDevicePixelRatio(),!(e===this.width&&t===this.height&&o===this.pixelRatio)&&(this.width=e,this.height=t,this.canvasNode.style.width=e+"px",this.canvasNode.style.height=t+"px",this.canvasNode.setAttribute("width",""+e*o),this.canvasNode.setAttribute("height",""+t*o),this.pixelRatio=o,this.ctx=this.canvasNode.getContext("2d"),(i=this.ctx)==null||i.scale(o,o),this.update())}getAriaLabel(e){let t=[],{graphDescription:o}=this.grapher.settings.config;if(this.grapher.type==="3d"&&this.controller.is3dProduct())o!==void 0?t.push(o):(t.push(`${this.controller.s("graphing-calculator-narration-3d-graphpaper-label")}.`),t.push(VC(this.controller)));else if(this.grapher.type==="2d"&&!this.controller.is3dProduct()){let i=this.grapher.getAudioTrace();if(!i)return"";o!==void 0?t.push(o):(t.push(`${this.controller.s("graphing-calculator-narration-graphpaper-label")}.`),t.push(VC(this.controller)),e>0&&(i.getAudioTraceActive()||i.agNavigator.getFirstTraceableSketch({selectAssociatedExpression:!1})!==void 0&&(qo?t.push(this.controller.s("graphing-calculator-narration-audio-instructions-enter-audio-trace-mac")):t.push(this.controller.s("graphing-calculator-narration-audio-instructions-enter-audio-trace-windows")))))}if(t.length)return t.join(" ").trim()}updateAria(e,t){let o=this.getAriaLabel(t);o!==void 0?(this.rootNode.setAttribute("role","img"),this.rootNode.setAttribute("aria-roledescription",this.controller.s("graphing-calculator-narration-graphpaper-label")),this.rootNode.setAttribute("aria-label",o),this.rootNode.setAttribute("aria-hidden",!e||!this.grapher.settings.config.graphpaper?"true":"false"),this.rootNode.setAttribute("tabindex",e&&this.grapher.settings.config.graphpaper&&this.grapher.settings.config.enableTabindex?"0":"-1")):["role","aria-roledescription","aria-label","aria-hidden","tabindex"].forEach(n=>this.rootNode.removeAttribute(n)),this.update()}speakAriaLabelAgain(){let e=this.rootNode.getAttribute("aria-label");e&&Te(e)}};var D3=class{constructor(e){this._layerClasses={};this._classLayers={};this.elt=e.elt,this.settings=e.settings,this.controller=e.controller,this.evaluator=e.evaluator,this.elt.style.overflow="hidden"}classLayers(e){var t,o;return(o=(t=this._classLayers)[e])!=null?o:t[e]=new Set}setLayerClass(e,t){let o=this._layerClasses[e];if(this._layerClasses[e]=t,o!==t){if(o){let i=this.classLayers(o);i.delete(e),i.size===0&&this.elt.classList.remove(o)}t&&(this.classLayers(t).add(e),this.elt.classList.add(t))}}},k3=class extends D3{constructor(e){super(e),this.canvasLayer=eY.mountToNode(gI,this.elt,{grapher:()=>this}),this.elt.appendChild(this.canvasLayer.rootNode)}getImageData(e,t,o,i){var n;return(n=this.canvasLayer.ctx)==null?void 0:n.getImageData(e,t,o,i)}_setIsVisible(e){e!==this.isVisible&&(this.isVisible=e,e?this.controller.requestRedrawGraph():this.canvasLayer.resize(0,0))}getIsVisible(){return this.isVisible}};function*zC(r){for(let e=0;e<r.length;e++)yield*r[e].drawOrder}var _3=class extends k3{setDrawLayers(e){__dcg_shared_module_exports__['J'](this.__drawLayers,e)||(this.__drawLayers=e,this.controller.requestRedrawGraph())}setTabOrder(e){this.__tabOrder=e}getDrawLayers(){return this.__drawLayers}getTabOrder(){return this.__tabOrder}generateMergeDrawOrder(){return zC(this.__drawLayers)}},T3=class extends _3{constructor(){super(...arguments);this.__redrawRequested=!1;this.events=new Jn}redrawAllLayers(){this.__redrawRequested=!0}redrawAllLayersSynchronously(){return this._redrawAllLayers()}notifyAfterRedraw(t){if(!this.__redrawRequested)t();else{this.notifyAfterRedraw_i?this.notifyAfterRedraw_i++:this.notifyAfterRedraw_i=1;let o="redraw.notifyAfterRedraw"+this.notifyAfterRedraw_i;this.events.observeEvent(o,()=>{this.events.unobserveEvent(o),t()})}}},G3=class extends T3{getUserRequestedViewport(){return this._lastUserRequestedViewport}setUserRequestedViewport(e){this._lastUserRequestedViewportUpdateToken||(this._lastUserRequestedViewportUpdateToken=0),this._lastUserRequestedViewportUpdateToken+=1,this._lastUserRequestedViewport=__dcg_shared_module_exports__['i'](e),this._afterViewportChange()}getCurrentViewport(){return this.viewportController.getViewport().toObject()}debounceUserRequestedViewportChange(){this.__debouncedViewportCommit||(this.__debouncedViewportCommit=__dcg_shared_module_exports__['F']((o,i)=>{if(!this.isDragging&&this._lastUserRequestedViewportUpdateToken===i){if(this._lastUserRequestedViewport){let n=Co.fromObject(this._lastUserRequestedViewport);if(this.computeConcreteViewport(n).equals(o))return}this.controller.dispatch({type:"commit-user-requested-viewport",viewport:o})}},1e3));let e=this.getCurrentViewport();this.__debouncedViewportCommit(e,this._lastUserRequestedViewportUpdateToken)}},I3=class extends G3{getState(e){let t={...this.getCurrentViewport()};this.controller.is3dProduct()||(delete t.zmin,delete t.zmax);let o={viewport:t};return this.settings.stateProperties.forEach(i=>{i!=="randomSeed"&&i!=="includeFunctionParametersInRandomSeed"&&(!this.controller.is3dProduct()&&Bq(i)||(o[i]=this.settings[i]))}),e.stripDefaults&&(o=__dcg_shared_module_exports__['lb'](hc,o)),o}getUndoRedoDiffState(){let e=this.getUndoRedoFullState();return e.speed3D!==0&&delete e.worldRotation3D,e}getUndoRedoFullState(){let e={};return this.settings.stateProperties.forEach(t=>{e[t]=this.settings[t]}),e.viewport=this.getUserRequestedViewport(),e}},ov=class extends I3{};var iv=class{constructor(e,t){this.is3d=!1;this.color="#000000",this.style="normal",this.showPOI=!1,this.showHighlight=!1,this.hoistToTop=!1,this.selected=!1,this.tokenHovered=!1,this.tokenSelected=!1,this.labels=[],this.id=e,this.branches=t!==void 0?t:[],this.getPOI().forEach(o=>{o.type===1008&&this.labels.push({type:"poi",poi:o})}),t.forEach((o,i)=>{if(o.graphMode===22){if(o.objectType===17){let n=new Uh(0,0,1008,this,i,0,!1);this.labels.push({id:"label-"+e+"-"+(o.listIndex||0),type:"segment",poi:n,segments:o.segments[0],text:o.labels&&o.labels[0]||""})}else if(o.objectType===16){let n=new Uh(0,0,1008,this,i,0,!1);this.labels.push({id:"label-"+e+"-"+(o.listIndex||0),type:"polygon",poi:n,segments:o.segments[0],text:o.labels&&o.labels[0]||""})}else if(o.objectType===23){let n=new Uh(0,0,1008,this,i,0,!1);this.labels.push({id:"label-"+e+"-"+(o.listIndex||0),type:"angle",poi:n,segments:o.segments[0],text:o.labels&&o.labels[0]||""})}}})}getPOI(){if(this.__cachedPOI)return this.__cachedPOI;this.__cachedPOI=[],this.__cachedPOIIds={};for(let e=0;e<this.branches.length;e++){let t=this.branches[e];if(t.graphMode===1||t.graphMode===2){let o=t.poi;o.zeros&&this._pushPOI(o.zeros,e,1002),o.intercept&&this._pushPOI(o.intercept,e,1003),o.extrema&&this._pushPOI(o.extrema,e,1004),o.intersections&&this._pushPOI(o.intersections,e,1001)}else if(__dcg_shared_module_exports__['ge'](t)){let o=t.poi,i=(t.graphMode===3||t.graphMode===25)&&t.interactiveLabel===!0;if(t.showLabel===!0||i){let n=t.nakedLabel;o.defined&&this._pushPOI(o.defined,e,1008,n)}else o.defined&&this._pushPOI(o.defined,e,1006)}}return this.__cachedPOI}getBranchPOI(e){return this.getPOI().filter(t=>t.branch===e)}getMovablePoints(){if(this.__cachedMovablePoints)return this.__cachedMovablePoints;this.__cachedMovablePoints=[];let e=this.branches[0];if(e&&e.segments.length===1&&__dcg_shared_module_exports__['he'](e)){let t=e.segments[0];for(let o=0;o<t.length;o++){let i;e.tableId&&(i={tableId:e.tableId,columnId:this.id,rowIndex:e.movablePointInfo[o].index,dragX:e.movablePointInfo[o].dragX,dragY:e.movablePointInfo[o].dragY});let n=e.scaleFactors?e.scaleFactors[0][o]:void 0,a=i?i.rowIndex:o,s=e.segments.length===1&&e.labels&&e.labels[o]?e.labels[o]:void 0,l=e.hasOwnProperty("pointOpacity")?e.pointOpacity:1,c=e.pointSize!==void 0?e.pointSize:8;this.__cachedMovablePoints.push({type:"movable-point",id:"movable:["+this.id+","+a+"]",listIndex:a,sketch:this,color:this.color,pointOpacity:l,pointSize:c,tableInfo:i,scaleFactor:n,x:t[o][0],y:t[o][1],label:s,ariaLabel:s&&rn(s)})}}return this.__cachedMovablePoints}getMovablePointByIndex(e){return this.getMovablePoints()[e]}getStaticLabeledPoints(){if(this.__cachedStaticLabeledPoints)return this.__cachedStaticLabeledPoints;let e=this.branches[0];return this.__cachedStaticLabeledPoints=[],this.getPOI().forEach(t=>{if(t.type!==1006&&t.type!==1008||e.graphMode!==3&&e.graphMode!==25)return;let o=e.showLabel,i=t.getLabel();!o&&i===""||this.__cachedStaticLabeledPoints.push({type:"static-labeled-point",id:"static["+this.id+","+t.id+"]",listIndex:t.pointIdxOnBranch,x:t.x,y:t.y,sketch:t.sketch,label:i,ariaLabel:i!==""?rn(i):void 0})}),this.__cachedStaticLabeledPoints}_pushPOI(e,t,o,i=!1){for(let n=0,a=e.x.length;n<a;n++){let s=new Uh(e.x[n],e.y[n],o,this,t,n,i);e.intersects&&(s.intersects=e.intersects[n]),this.__cachedPOI.push(s),this.__cachedPOIIds[s.id]=s}}updateIntersections(e){for(let o=0,i=this.branches.length;o<i;o++){let n=this.branches[o];n.graphMode!==15&&n.graphMode!==22&&(n.poi.intersections=e[o])}let t=this.__cachedPOI;this.__cachedPOI=[],t.forEach(o=>{o.type!==1001?this.__cachedPOI.push(o):delete this.__cachedPOIIds[o.id]});for(let o=0;o<this.branches.length;o++){let i=this.branches[o];if(i.graphMode===1||i.graphMode===2){let n=i.poi;n.intersections&&this._pushPOI(n.intersections,o,1001)}}}getPOIById(e){return this.__cachedPOIIds[e]}updateFrom(e){if(e&&(this.showPOI=e.showPOI,this.showHighlight=e.showHighlight,this.hoistToTop=e.hoistToTop,this.selected=e.selected,this.tokenSelected=e.tokenSelected,this.tokenHovered=e.tokenHovered,__dcg_shared_module_exports__['ge'](this.branches[0]))){let t=!0;for(let o=0;o<this.__cachedPOI.length;o++){let i=e.__cachedPOI[o],n=this.__cachedPOI[o];if(!i||i.type!==n.type){t=!1;break}}if(t)for(let o=0;o<this.__cachedPOI.length;o++){let i=e.__cachedPOI[o],n=this.__cachedPOI[o];delete this.__cachedPOIIds[n.id],this.__cachedPOIIds[i.id]=n,n.id=i.id}}}};var Yh=document.createElement("canvas").getContext("2d"),cl=class r{constructor(e,t){this._label=e,this._fontSize=t,this._layout=Xpe(e,t)}getRect(){return this.getRectWhenCenteredAt({x:0,y:0})}getRectWhenCenteredAt(e){return{left:this._layout.left+e.x,right:this._layout.right+e.x,top:this._layout.top+e.y,bottom:this._layout.bottom+e.y}}getBoundsWhenCenteredAt(e,t){switch(t){case"x":return{lower:this._layout.left+e,upper:this._layout.right+e};case"y":return{lower:this._layout.top+e,upper:this._layout.bottom+e};default:let o=t;throw new Error(`Unknown axis: ${o}`)}}getWidth(){return this._layout.right-this._layout.left}getHeight(){return this._layout.bottom-this._layout.top}getDimensionAlongAxis(e){switch(e){case"x":return this.getWidth();case"y":return this.getHeight();default:let t=e;throw new Error(`Unknown axis: ${t}`)}}clampBoundsWithinRect(e,t){let o,i;return e.x+this._layout.left<t.left?o=t.left-this._layout.left:e.x+this._layout.right>t.right?o=t.right-this._layout.right:o=e.x,e.y+this._layout.top<t.top?i=t.top-this._layout.top:e.y+this._layout.bottom>t.bottom?i=t.bottom-this._layout.bottom:i=e.y,{x:o,y:i}}getValue(){return this._label.value}getMinusWidth(){return this.getValue()<0?(r.setCtxFontSize(Yh,this._fontSize),Yh.measureText("-1").width-Yh.measureText("1").width):0}getString(){return this._label.superscript?this._label.mantissa+"^"+this._label.superscript:this._label.string}drawCenteredAt(e,t,o){let i=t.x,n=r.computeBaselineFromCenter(t.y,this._fontSize);o&&Ui(e,o),e.save(),o&&Si(e),r.setCtxFontSize(e,this._fontSize),this._label.superscript?(e.strokeText(this._label.mantissa,this._layout.mantissa_x+i,this._layout.mantissa_y+n),e.strokeText(this._label.superscript,this._layout.superscript_x+i,this._layout.superscript_y+n),e.fillText(this._label.mantissa,this._layout.mantissa_x+i,this._layout.mantissa_y+n),e.fillText(this._label.superscript,this._layout.superscript_x+i,this._layout.superscript_y+n)):(e.strokeText(this._label.string,this._layout.mantissa_x+i,this._layout.mantissa_y+n),e.fillText(this._label.string,this._layout.mantissa_x+i,this._layout.mantissa_y+n)),e.restore()}static computeBaselineFromCenter(e,t){return e+.272*t}static setCtxFontSize(e,t){e.font=t+"px Arial",e.textAlign="center"}};function Xpe(r,e){if(r.superscript){let t=e;cl.setCtxFontSize(Yh,t);let o=Yh.measureText(r.mantissa).width,i=Math.round(.8*e);cl.setCtxFontSize(Yh,i);let n=Yh.measureText(r.superscript).width,a=0,s=e/5,l=o/2+n/2,c=-e/4,d=c-i/2,p=s+t/2,u=a-o/2,h=l+n/2;return{top:d,bottom:p,left:u,right:h,mantissa_height:t,mantissa_width:o,mantissa_x:a,mantissa_y:s,superscript_height:i,superscript_width:n,superscript_x:l,superscript_y:c}}else{let t=e;cl.setCtxFontSize(Yh,e);let o=Yh.measureText(r.string).width,i=0,n=0,a=n-t/2,s=n+t/2,l=i-o/2,c=i+o/2;return{top:a,bottom:s,left:l,right:c,mantissa_height:t,mantissa_width:o,mantissa_x:i,mantissa_y:n}}}function Jpe(r,e,t,o){let i=Math.ceil(r/t),n=Math.floor(e/t),a=1/t;if(!(i>n)&&!(n-i>1e4))for(let s=i;s<=n;s++)o(s/a)}var M3={base:10,major:[1,2,5],minor:[5,4,5]},Qpe={base:10,major:[Math.PI,2*Math.PI,5*Math.PI],minor:[4,4,5]},Zpe={base:2,major:[Math.PI/3],minor:[3]};function eue(r){return r?{base:10,major:[r,2*r,5*r],minor:[4,4,5]}:M3}function A3(r,e){let{major:t,minor:o,base:i}=e,n=1/0,a=1/0;for(let s=0;s<t.length;s++){let l=t[s],c=Math.ceil(Math.log(r/l)/Math.log(i)),d=l*Math.pow(i,c);if(d<n){n=d;let p=o[s];a=n/p}}return{major:n,minor:a}}function tue(r,e,t){return 1+(e-r)/t}function tY(r){let e=r.screen.width,t=r.screen.height,o=r.viewport.xmax-r.viewport.xmin,i=r.viewport.ymax-r.viewport.ymin,n=r.settings.pixelsPerLabel;return{majorStepX:n/e*o,majorStepY:n/t*i}}function od(r){let e=l=>{let[c,d,p,u,h]=l==="x"?[r.viewport.xmin,r.viewport.xmax,r.settings.xAxisStep,r.settings.xAxisNumbers,r.settings.xAxisMinorSubdivisions]:[r.viewport.ymin,r.viewport.ymax,r.settings.yAxisStep,r.settings.yAxisNumbers,r.settings.yAxisMinorSubdivisions],m=d-c,y=Math.abs(p!=null?p:NaN),w=0,S=0;if(y&&y!==Math.PI){let C=tue(c,d,y);if(C>=3&&C<100){let v=0;if(u){let _=0;Jpe(c,d,y,T=>{let I=new cl(__dcg_shared_module_exports__['Tb'](T,m),r.settings.labelSize);_=Math.max(I.getDimensionAlongAxis(l),_)}),v=_+10}else v=h===1?8:20;let E=l==="x"?"width":"height";C*v<=r.screen[E]&&(w=y,y===3||y===5?S=1:S=y/4)}}if(!w){let C=tY(r)[l==="x"?"majorStepX":"majorStepY"],v=A3(C,__dcg_shared_module_exports__['Tb'](y,m).string.indexOf("\u03C0")>=0?C>=1?Qpe:Zpe:eue(y));w=v.major,S=v.minor}return{majorStep:w,minorStep:S}},t=()=>{var l,c;if(Math.abs((l=r.settings.xAxisStep)!=null?l:NaN)===Math.abs((c=r.settings.yAxisStep)!=null?c:NaN)){let{xmin:u,xmax:h,ymin:m,ymax:y}=r.viewport,w=r.screen.width/(h-u),S=r.screen.height/(y-m),C=w/S,v=.01;if(C>=1-v&&C<=2){let{majorStep:E,minorStep:_}=e("y");return{x:{majorStep:E,minorStep:_},y:{majorStep:E,minorStep:_}}}if(C<=1-v&&C>=.5){let{majorStep:E,minorStep:_}=e("x");return{x:{majorStep:E,minorStep:_},y:{majorStep:E,minorStep:_}}}}return{x:e("x"),y:e("y")}},o=()=>{let{xAxisScale:l,yAxisScale:c}=r.settings,d=l==="logarithmic",p=c==="logarithmic";return!d&&!p?t():{x:d?{majorStep:NaN,minorStep:NaN}:e("x"),y:p?{majorStep:NaN,minorStep:NaN}:e("y")}},{x:i,y:n}=o(),{xAxisMinorSubdivisions:a=0,yAxisMinorSubdivisions:s=0}=r.settings;return{majorStepX:i.majorStep,minorStepX:a>0?i.majorStep/a:i.minorStep,majorStepY:n.majorStep,minorStepY:s>0?n.majorStep/s:n.minorStep}}function rY(r){let e=tY(r),t=A3(e.majorStepX,M3),o=A3(e.majorStepY,M3),i=t.major>o.major?t:o;return{majorStepR:i.major,minorStepR:i.minor}}var{floor:Gb,ceil:Ib,round:rue,log10:mI,log2:oY,abs:Vm}=Math,Am=r=>h_?`rgba(255,255,255,${r})`:`rgba(0,0,0,${r})`,yI=class{redrawToCtx(e,t){let{ctx:o,projection:i}=e;Rl(o,"graphpaper");let n=i.settings.showGrid&&!i.settings.threeDMode;if(i.settings.polarMode&&n){let a=rY(i);Rl(o,"grid"),this.drawPolarGrid(o,i,a),Fl(o),Rl(o,"axis"),this.drawAxes(o,i,t);let s=this.drawPolarStepNumbers(o,i,a);this.drawLabels(o,i,s),Fl(o)}else{let a=od(i),s=V3(i);n&&(Rl(o,"grid"),this.drawCartesianGrid(o,i,a,s),Fl(o));let l=!n&&!i.settings.threeDMode;Rl(o,"axis"),i.settings.threeDMode||this.drawAxes(o,i,t);let c=this.drawCartesianStepNumbers(o,i,a,l,s);this.drawLabels(o,i,c),Fl(o)}Fl(o)}addTextShadow(e,t){let{threeDMode:o,showPlane3D:i}=t.settings;e.strokeStyle=t.settings.getBackgroundColor({invertWhite:o}),e.lineWidth=3,o&&(!i||t.settings.invertedColors)&&(e.lineWidth=1.5),e.miterLimit=2}drawPolarGrid(e,t,o){e.save();let i=t.settings.minorAxisOpacity,a=1-(1-t.settings.majorAxisOpacity)/(1-i),s=__dcg_shared_module_exports__['Sb'](t.mapx(0)),l=__dcg_shared_module_exports__['Sb'](t.mapy(0)),c=t.screen.height/(t.viewport.ymax-t.viewport.ymin),d=t.screen.width/(t.viewport.xmax-t.viewport.xmin),p=c/d,u=d/c,h=l/p,m=t.viewport.smallestR(),y=t.viewport.largestR(),w=o.minorStepR*Math.max(1,Math.floor(m/o.minorStepR)),S=o.majorStepR*Math.max(1,Math.floor(m/o.majorStepR));e.lineWidth=1,e.strokeStyle=Am(i);for(let v of ql(w,y,o.minorStepR)){Ui(e,"dcg-svg-minor-gridline"),e.beginPath(),Si(e),e.scale(1,p);let E=t.mapx(v)-s;e.moveTo(s+E,h),e.arc(s,h,E,0,2*Math.PI),e.scale(1,u),e.stroke()}let C=m>0?5:15;for(let v of ql(0,359,C)){if((v===0||v===180)&&t.settings.showXAxis||(v===90||v===270)&&t.settings.showYAxis)continue;Ui(e,"dcg-svg-minor-gridline"),e.beginPath(),Si(e),e.moveTo(s,l);let E=t.mapx(y*Math.cos(v*Math.PI/180)),_=t.mapy(y*Math.sin(v*Math.PI/180));e.lineTo(__dcg_shared_module_exports__['Sb'](E),__dcg_shared_module_exports__['Sb'](_)),e.stroke()}e.lineWidth=1,e.strokeStyle=Am(a);for(let v of ql(S,y,o.majorStepR)){Ui(e,"dcg-svg-major-gridline"),e.beginPath(),Si(e),e.scale(1,p);let E=t.mapx(v)-s;e.moveTo(s+E,h),e.arc(s,h,E,0,2*Math.PI),e.scale(1,u),e.stroke()}e.restore()}drawCartesianGrid(e,t,o,i=V3(t)){e.save();let{xmin:n,xmax:a,ymin:s,ymax:l}=t.viewport,c=t.screen.width,d=t.screen.height,p=d,u=0;t.settings.restrictGridToFirstQuadrant&&(n=0,s=0,p=t.mapy(0),u=t.mapx(0));let h=t.settings.minorAxisOpacity*i.x.unitOpacity,m=t.settings.minorAxisOpacity*i.y.unitOpacity,y=t.settings.majorAxisOpacity;e.lineWidth=1;let w=R=>{if(R===0&&t.settings.showYAxis)return;let N=__dcg_shared_module_exports__['Sb'](t.mapx(R));N===__dcg_shared_module_exports__['Sb'](0)||N===__dcg_shared_module_exports__['Sb'](c)||(e.beginPath(),e.moveTo(N,0),e.lineTo(N,p),e.stroke())},S=R=>{if(R===0&&t.settings.showXAxis)return;let N=__dcg_shared_module_exports__['Sb'](t.mapy(R));N===__dcg_shared_module_exports__['Sb'](0)||N===__dcg_shared_module_exports__['Sb'](d)||(e.beginPath(),e.moveTo(u,N),e.lineTo(c,N),e.stroke())};Ui(e,"dcg-svg-minor-gridline");let{majorStepX:C,majorStepY:v,minorStepX:E,minorStepY:_}=o,T=t.settings.xAxisScale==="logarithmic",I=t.settings.yAxisScale==="logarithmic",P=T?i.x.minor:ql(n,a,E),O=I?i.y.minor:ql(s,l,_);e.strokeStyle=Am(h);for(let R of P)w(R);e.strokeStyle=Am(m);for(let R of O)S(R);Si(e);let W=1-(1-y)/(1-h),X=1-(1-y)/(1-m);Ui(e,"dcg-svg-major-gridline");let x=T?i.x.major:ql(n,a,C),L=I?i.y.major:ql(s,l,v);e.strokeStyle=Am(W);for(let R of x)w(R);e.strokeStyle=Am(X);for(let R of L)S(R);Si(e),e.restore()}drawAxes(e,t,o){let i=t.settings.axisLineOffset,n=t.settings.axisOpacity,a=`rgba(127,205,230,${n.toString()})`,s=Am(n),l=t.settings.xAxisArrowMode,c=t.settings.yAxisArrowMode,d=t.settings.showXAxis,p=t.settings.showYAxis,u=1,h=Math.round(t.mapx(0))-i,m=Math.round(t.mapy(0))-i,y=t.screen.height,w=t.screen.width;function S(E,_,T){e.save();let I=Math.PI/12,P=8*Math.max(e.lineWidth,1.5);e.lineJoin="round",e.fillStyle=s,e.strokeStyle=s,e.beginPath(),e.moveTo(E,_),e.lineTo(E+Math.cos(T-I)*P,_+Math.sin(T-I)*P),e.lineTo(E+Math.cos(T+I)*P,_+Math.sin(T+I)*P),e.lineTo(E,_),e.lineTo(E+Math.cos(T-I)*P,_+Math.sin(T-I)*P),e.stroke(),e.fill(),e.restore()}let C=y,v=0;t.settings.restrictGridToFirstQuadrant&&(C=m,v=h,l==="BOTH"&&(l="POSITIVE"),c==="BOTH"&&(c="POSITIVE")),p&&(Rl(e,"yaxis"),t.settings.takingScreenshot&&xC(e,t.settings.yAxisLabel||"Y axis"),e.save(),Ui(e,"dcg-svg-axis-line"),e.lineWidth=t.settings.axisLineWidth*(o==="y"?u:1),e.strokeStyle=o==="y"?a:s,c==="BOTH"?(e.beginPath(),e.moveTo(h,2*t.settings.axisLineWidth),e.lineTo(h,y-2*t.settings.axisLineWidth),e.stroke(),S(h,y-t.settings.axisLineWidth,3*Math.PI/2),S(h,t.settings.axisLineWidth,Math.PI/2)):c==="POSITIVE"?(e.beginPath(),e.moveTo(h,2*t.settings.axisLineWidth),e.lineTo(h,C),e.stroke(),S(h,t.settings.axisLineWidth,Math.PI/2)):(e.beginPath(),e.moveTo(h,0),e.lineTo(h,C),e.stroke()),Si(e),e.restore(),Fl(e)),d&&(Rl(e,"xaxis"),t.settings.takingScreenshot&&xC(e,t.settings.xAxisLabel||"X axis"),e.save(),Ui(e,"dcg-svg-axis-line"),e.lineWidth=t.settings.axisLineWidth*(o==="x"?u:1),e.strokeStyle=o==="x"?a:s,l==="BOTH"?(e.beginPath(),e.moveTo(2*t.settings.axisLineWidth,m),e.lineTo(w-2*t.settings.axisLineWidth,m),e.stroke(),S(t.settings.axisLineWidth,m,0),S(w-t.settings.axisLineWidth,m,Math.PI)):l==="POSITIVE"?(e.beginPath(),e.lineTo(v,m),e.lineTo(w-2*t.settings.axisLineWidth,m),e.stroke(),S(w-t.settings.axisLineWidth,m,Math.PI)):(e.beginPath(),e.lineTo(v,m),e.lineTo(w,m),e.stroke()),Si(e),e.restore(),Fl(e))}drawPolarStepNumbers(e,t,o){e.save();let i=t.settings.showGrid,n=t.settings.xAxisNumbers&&t.settings.showXAxis,a=t.settings.yAxisNumbers&&t.settings.showYAxis,s=i&&t.settings.polarNumbers,l=t.viewport.largestR(),c=t.viewport.smallestR(),d=t.viewport.xmin,p=t.viewport.xmax,u=t.viewport.ymin,h=t.viewport.ymax,m=t.screen.width,y=t.screen.height,w={left:3,right:m-3,top:3,bottom:y-3},S=t.settings.labelHangingColor,C=t.settings.getTextColor(),v=t.settings.labelSize,E=v;this.addTextShadow(e,t),e.fillStyle=C;function _(z,A,U){let pe=Math.sqrt(z*z-A*A);u<=pe&&pe<=h&&U.push({x:t.mapx(A),y:t.mapy(pe)}),u<=-pe&&-pe<=h&&U.push({x:t.mapx(A),y:t.mapy(-pe)})}function T(z,A,U){let pe=Math.sqrt(z*z-A*A);d<=pe&&pe<=p&&U.push({x:t.mapx(pe),y:t.mapy(A)}),d<=-pe&&-pe<=p&&U.push({x:t.mapx(-pe),y:t.mapy(A)})}let I=t.mapx(0),P=t.mapy(0),O=u<=0&&0<=h,W=d<=0&&0<=p,X=O&&n,x=W&&a,L="";if(!X&&!x&&i){let z=Vm(I),A=Vm(I-m),U=Vm(P),pe=Vm(P-y),q,F,ge,ne;z<=A?(q="left",ge=z):(q="right",ge=A),U<=pe?(F="top",ne=U):(F="bottom",ne=pe),n&&a?L=ge<=ne?q:F:a?L=q:n&&(L=F)}let R={left:0,right:m,top:P-1,bottom:P+1},N={left:I-1,right:I+1,top:0,bottom:y};for(let z of ql(0,l,o.majorStepR)){let A=[],U=[],pe=[],q=new cl(__dcg_shared_module_exports__['Tb'](z,l),v),F=q.getRect();switch(z>0?(x&&u<=z&&z<=h&&U.push({x:I-F.right-5,y:t.mapy(z)}),x&&u<=-z&&-z<=h&&U.push({x:I-F.right-5,y:t.mapy(-z)}),X&&d<=z&&z<=p&&A.push({x:t.mapx(z),y:P-F.top+3}),X&&d<=-z&&-z<=p&&A.push({x:t.mapx(-z),y:P-F.top+3})):x&&!n&&u<=z&&z<=h?U.push({x:I-F.right-5,y:t.mapy(z)}):X&&!a&&d<=z&&z<=p&&A.push({x:t.mapx(z),y:P-F.top+3}),L){case"top":T(z,h,pe);break;case"bottom":T(z,u,pe);break;case"left":_(z,d,pe);break;case"right":_(z,p,pe);break}A.forEach(ge=>{ge=q.clampBoundsWithinRect(ge,w),q.drawCenteredAt(e,ge,"dcg-svg-axis-value"),fI(R,q.getRectWhenCenteredAt(ge))}),U.forEach(ge=>{ge=q.clampBoundsWithinRect(ge,w),q.drawCenteredAt(e,ge,"dcg-svg-axis-value"),fI(N,q.getRectWhenCenteredAt(ge))}),pe.forEach(ge=>{ge=q.clampBoundsWithinRect(ge,w),q.drawCenteredAt(e,ge,"dcg-svg-axis-value")})}if(s){let z=Math.ceil(c/o.majorStepR),A=Math.floor(l/o.majorStepR),pe=Math.ceil((z+A)/2)*o.majorStepR,q=c>0?15:30;for(let F of ql(0,359,q)){let ge;t.settings.degreeMode?ge=F.toString()+"\xB0":ge=__dcg_shared_module_exports__['Tb'](F*Math.PI/180,2*Math.PI).string;let ne=e.measureText(ge).width/2,ae=pe/1.05,j=ae*Math.cos(F*Math.PI/180),oe=ae*Math.sin(F*Math.PI/180);if(j<d||j>p||oe<u||oe>h)continue;let Y=t.mapx(j),fe=t.mapy(oe);F===0||F===180?fe-=E:(F===90||F===270)&&(Y+=ne+3);let ye=__dcg_shared_module_exports__['wc'](Y,3+ne,m-3-ne),Ce=__dcg_shared_module_exports__['wc'](fe,3+E,y-3-E);Ce=cl.computeBaselineFromCenter(Ce,v),Ui(e,"dcg-svg-polar-axis-value"),e.save(),Si(e),e.fillStyle=S,cl.setCtxFontSize(e,v),e.strokeText(ge,ye,Ce),e.fillText(ge,ye,Ce),e.restore()}}return e.restore(),{x:R,y:N}}drawLabels(e,t,o){let i=t.viewport.xmin,n=t.viewport.xmax,a=t.viewport.ymin,s=t.viewport.ymax,l=t.screen.width,c=t.screen.height,d=(n-i)/l,p=(s-a)/c,u=t.settings.getTextColor(),h=t.mapx(0),m=t.mapy(0),y=t.settings.labelSize,w=15,S=t.settings.showXAxis&&t.settings.xAxisLabel,C=t.settings.showYAxis&&t.settings.yAxisLabel,v=o.x,E=o.y;if(S&&v){Ui(e,"dcg-svg-axis-label"),e.save(),Si(e),e.fillStyle=u;let _;if(e.__xLabelOffset&&t.settings.isViewportTransient&&bI(e.__xLabelOffset.xscale,d)&&bI(e.__xLabelOffset.yscale,p)&&(_={x:e.__xLabelOffset.x+h,y:e.__xLabelOffset.y+m}),this._setAxisLabelFont(e,S,y,t),!_){let T=e.measureText(S).width,I=l-T-w,P=y;v.bottom+P<c?_={x:I,y:v.bottom+P}:_={x:I,y:v.top-P/2},e.__xLabelOffset={x:_.x-h,y:_.y-m,xscale:d,yscale:p}}e.strokeText(S,_.x,_.y),e.fillText(S,_.x,_.y),e.restore()}else e.__xLabelPosition=null;if(C&&E){Ui(e,"dcg-svg-axis-label"),e.save(),Si(e),e.fillStyle=u;let _;if(e.__yLabelOffset&&t.settings.isViewportTransient&&bI(e.__yLabelOffset.xscale,d)&&bI(e.__yLabelOffset.yscale,p)&&(_={x:e.__yLabelOffset.x+h,y:e.__yLabelOffset.y+m}),this._setAxisLabelFont(e,C,y,t),!_){let T=e.measureText(C).width,I=y,P=T+5;if(!this._isShortMathyLabel(C)){let W=T;T=I,I=W,P=T*.5}let O=0+w+I;E.left-T>0?_={x:E.left-P,y:O}:_={x:E.right+T,y:O},e.__yLabelOffset={x:_.x-h,y:_.y-m,xscale:d,yscale:p}}e.translate(_.x,_.y),this._isShortMathyLabel(C)||e.rotate(-Math.PI/2),e.strokeText(C,0,0),e.fillText(C,0,0),e.restore()}else e.__yLabelPosition=null}_isShortMathyLabel(e){return e.trim().match(/^([a-zA-Z]?)\(?([a-zA-Z]?)\)?$/)}_setAxisLabelFont(e,t,o,i){this.addTextShadow(e,i),this._isShortMathyLabel(t)?e.font="italic "+Math.round(o*1.4)+"px Times":e.font=Math.round(o*1.2)+"px Arial"}drawCartesianStepNumbers(e,t,o,i,n=V3(t)){e.save();let{showXAxis:a,showYAxis:s}=t.settings,l=a&&t.settings.xAxisNumbers,c=s&&t.settings.yAxisNumbers,{xmin:d,xmax:p,ymin:u,ymax:h}=t.viewport,m=t.screen.width,y=t.screen.height,w={left:3,top:3,right:m-3,bottom:y-3};t.settings.restrictGridToFirstQuadrant&&(d=0,u=0);let S=t.settings.getTextColor({invertBlack:t.settings.threeDMode}),C=t.settings.threeDMode?S:t.settings.labelHangingColor,v=t.mapx(0),E=t.mapy(0),_=t.settings.labelSize;this.addTextShadow(e,t);let T={left:0,right:m,top:E-1,bottom:E+1},I={left:v-1,right:v+1,top:0,bottom:y};if(t.settings.threeDMode&&!t.settings.showNumbers3D)return{x:T,y:I};let P=5,O=!1;if(a&&s&&(l||c)){O=!0,e.fillStyle=S;let R=new cl(__dcg_shared_module_exports__['Tb'](0,1),_);R.drawCenteredAt(e,{x:v-R.getRect().right-P,y:E-R.getRect().top+P},"dcg-svg-axis-value")}let{majorStepX:W,majorStepY:X}=o,x=[],L=[];if(l){let R=t.settings.xAxisScale==="logarithmic",N=R?n.x.label:ql(d,p,W);for(let z of N){let A=R?void 0:p-d,U=__dcg_shared_module_exports__['Tb'](z,A,R),pe=new cl(U,_);pe.getString()==="0"&&O||x.push(pe)}}if(c){let R=t.settings.yAxisScale==="logarithmic",N=R?n.y.label:ql(u,h,X);for(let z of N){let A=R?void 0:h-u,U=__dcg_shared_module_exports__['Tb'](z,A,R),pe=new cl(U,_);pe.getString()==="0"&&O||L.push(pe)}}if(i){e.save(),Ui(e,"dcg-svg-tickmark");let R=t.settings.axisLineOffset,N=t.settings.axisOpacity,z=Am(N);e.lineWidth=t.settings.axisLineWidth,e.strokeStyle=z;let A=Math.round(t.mapy(0))-R,U=Math.round(t.mapx(0))-R,pe=Math.round(2*e.lineWidth)-R;e.beginPath(),x.forEach(q=>{let F=Math.round(t.mapx(q.getValue()))-R;e.moveTo(F,A-pe),e.lineTo(F,A+pe)}),L.forEach(q=>{let F=Math.round(t.mapy(q.getValue()))-R;e.moveTo(U-pe,F),e.lineTo(U+pe,F)}),e.stroke(),Si(e),e.restore()}return x.forEach(R=>{let N={x:t.mapx(R.getValue())-.5*R.getMinusWidth(),y:E-R.getRect().top+P},z=R.clampBoundsWithinRect(N,w);e.fillStyle=N.y===z.y||t.settings.yAxisScale==="logarithmic"?S:C;let A="dcg-svg-axis-value";N.x!==z.x&&(A+=" dcg-svg-offcenter-axis-value"),R.drawCenteredAt(e,z,A),fI(T,R.getRectWhenCenteredAt(z)),Si(e)}),L.forEach(R=>{let N={x:v-P-R.getRect().right,y:t.mapy(R.getValue())},z=R.clampBoundsWithinRect(N,w);e.fillStyle=N.x===z.x||t.settings.xAxisScale==="logarithmic"?S:C;let A="dcg-svg-axis-value";N.y!==z.y&&(A+=" dcg-svg-offcenter-axis-value"),R.drawCenteredAt(e,z,A),fI(I,R.getRectWhenCenteredAt(z)),Si(e)}),e.restore(),{x:T,y:I}}};function ql(r,e,t){let o=Math.ceil(r/t),i=Math.floor(e/t);if(!oue({nmin:o,nmax:i}))return[];let n=[];for(let a=o;a<=i;a++)n.push(a*t);return n}var oue=({nmin:r,nmax:e})=>isFinite(e-r)&&e-r<=1e4;function V3(r){return{x:iY("x",r),y:iY("y",r)}}function iY(r,e){let t=new Set,o=new Set,i=new Set,n=1;function a(ne){return v?e.mapx(ne):e.mapy(ne)}function s(ne,ae){return Vm(a(ae)-a(ne))}let l=(ne,ae)=>{let j=ne*ae,oe=(ne+1)*ae;if(j<E&&oe<E||j>_&&oe>_)return;let Y=ne>=5?s(7*ae,8*ae):ne>=2?s(3*ae,4*ae):s(ae,2*ae),fe=Y/s(j,oe);if(Y<40)return;let ye={settings:{pixelsPerLabel:e.settings.pixelsPerLabel*fe,labelSize:e.settings.labelSize,xAxisNumber:e.settings.xAxisNumbers,yAxisNumber:e.settings.yAxisNumbers},screen:{width:Y,height:Y},viewport:{xmin:j,ymin:j,xmax:oe,ymax:oe}},{minorStepX:Ce,majorStepX:De}=od(ye),Ge=Math.max(j,E),Ye=Math.min(oe,_);for(let Q=Gb(Ge/Ce);Q<Ib(Ye/Ce);Q++)i.add(Q*Ce);for(let Q=Gb(Ge/De);Q<Ib(Ye/De);Q++){let ee=Q*De;ee<=j||ee>=oe||(o.add(ee),t.add(ee))}},c={label:[],major:[],minor:[],unitOpacity:1},{xAxisScale:d,yAxisScale:p,pixelsPerLabel:u}=e.settings,{xmin:h,xmax:m,ymin:y,ymax:w}=e.viewport,{width:S,height:C}=e.screen,v=r==="x",[E,_]=v?[h,m]:[y,w],T=v?S:C,I=v?d:p,P=e.settings.xAxisMinorSubdivisions!==0;if(I!=="logarithmic")return c;let O=Gb(mI(E)),W=Ib(mI(_)),X=Ib(mI(_)-mI(E)),x=s(10**O,10**(O+1)),L=15,R=100,N=x>L,z=[];x>6.25*u&&(z=[2,3,4,6,8]),x>12*u&&(z=[2,3,4,5,6,7,8]),x>14*u&&(z=[2,3,4,5,6,7,8,9]);let A=z.length!=0;if(L<=x&&x<=R&&(n=Math.sqrt((x-L)/(R-L))),!isFinite(X))return c;let U=Gb(T/u),pe=Math.max(1,2**rue(oY(X/U)));for(let ne=Ib(O/pe);ne<=Gb(W/pe);ne++)t.add(10**(ne*pe));o=new Set([...t]);let q=Gb(T/L),F=Math.max(1,2**Ib(oY(X/q)));for(let ne=Ib(O/F);ne<=Gb(W/F);ne++)(N?o:i).add(10**(ne*F));if(N)for(let ne=O;ne<W;ne++){let ae=10**ne;for(let j of z)t.add(j*ae);if(A){for(let j=2;j<=9;j++)o.add(j*ae);for(let j=1;j<=9;j++)l(j,ae)}else for(let j=2;j<=9;j++)i.add(j*ae)}P&&(i=new Set);let ge=v?e.reverse_mapx(a(E)+u/4):e.reverse_mapy(a(E)-2*e.settings.labelSize);return{label:[...t].filter(ne=>ge<=ne&&ne<=_),major:[...o].filter(ne=>E<=ne&&ne<=_),minor:[...i].filter(ne=>E<=ne&&ne<=_),unitOpacity:n}}function fI(r,e){e.left<r.left&&(r.left=e.left),e.right>r.right&&(r.right=e.right),e.top<r.top&&(r.top=e.top),e.bottom>r.bottom&&(r.bottom=e.bottom)}function bI(r,e){let t=Vm(r),o=Vm(e);return Vm(t-o)<=(t<o?o:t)*1e-4}var IVe=__dcg_shared_module_exports__['e'](Z());var KC=class{constructor(e){this.grapher=e,this.controller=this.grapher.controller,this.renderedTabTargetOrder=[],this.renderedTabTargets={}}recomputeImages(e){let{projection:t}=e;this.renderedTabTargets={},this.renderedTabTargetOrder=[];for(let o of this.grapher.generateMergeDrawOrder()){let i=this.controller.getItemModel(o);if(i&&i.type==="image"&&i.shouldGraph&&hp(i)){let n=i.formula.dimensions;if(!n||!n.x||!n.y||!n.width||!n.height||!n.radianAngle)continue;for(let a=0;a<n.x.length;a++)if(isFinite(n.x[a])&&isFinite(n.y[a])&&isFinite(n.width[a])&&isFinite(n.height[a])&&isFinite(n.radianAngle[a])){this.renderedTabTargetOrder.push(o),this.renderedTabTargets[o]={id:o,description:this.getComputedDescription(i,a),x:n.x[a],y:n.y[a],radianAngle:n.radianAngle[a],width:n.width[a],height:n.height[a],widthScale:Math.abs(t.mapx(1)-t.mapx(0)),heightScale:Math.abs(t.mapy(1)-t.mapy(0)),screenX:t.mapx(n.x[a]),screenY:t.mapy(n.y[a]),centerId:i.formula.center_reference_id,selected:Za(i)};break}}}this.speakAriaAlert()}getOrderedTabTargets(){return this.getTabIndex()===-1?[]:this.renderedTabTargetOrder.map(e=>{var o;let t=this.renderedTabTargets[e];return{calcId:t.id,listIndex:void 0,polygonEdge:void 0,description:this.controller.isGeometry()||(o=this.getAriaAlert({id:t.id,includeUsageInstructions:!0}))==null?void 0:o.completeMessage}})}getStyle(e){let t=this.renderedTabTargets[e];if(!t)return;let{screenX:o,screenY:i,radianAngle:n,width:a,height:s,widthScale:l,heightScale:c}=t,d=c/l,p=a*l,u=s*c/d,h=o-p/2,m=i-u/2,y=`translate(${h}px, ${m}px)`,w=n?` rotate(${n}rad)`:"",S=d===1?"":` scale(1,${d})`;return{position:"absolute",top:0,left:0,transform:y+S+w,width:p+"px",height:u+"px"}}getTabIndex(){if(this.controller.getActiveTool()!=="selection")return-1;let e=this.grapher.settings;return e.config.graphpaper&&e.config.enableTabindex?0:-1}getAriaHidden(){return!this.grapher.settings.config.graphpaper}getComputedDescription(e,t){let o=e.formula&&e.formula.computed_description&&e.formula.computed_description[t];return o&&o!==""?rn(o):this.grapher.getAudioTrace().getExpressionAriaLabel(e.id)}getAriaLabel(e){let t=this.getAriaAlert({id:e,includeUsageInstructions:!1});return t&&t.completeMessage}speakAriaAlert(){if(this.controller.isGeometry())return;let e=this.getFocusedImage();if(!e){this.lastAriaAlert=void 0;return}let t=e.id,o=this.getAriaAlert({id:t,lastAriaAlert:this.lastAriaAlert,includeUsageInstructions:!0});this.lastAriaAlert=o,o&&o.completeMessage&&Te(o.completeMessage)}getAriaAlert(e){let{id:t,lastAriaAlert:o,includeUsageInstructions:i}=e;if(!t)return;let n=this.controller.getItemModel(t);if(!n||n.type!=="image")return;let a=this.renderedTabTargets[t];if(!a)return;o&&o.id!==t&&(o=void 0);let s=o==null?void 0:o.label,l=a.description,c=s!==l,d=!!(o!=null&&o.selected),p=a.selected,u=d!==p,h=o&&o.coordX,m=o&&o.coordY,y=a.x,w=a.y,S=y!==h||w!==m,C=this.grapher.getProjection(),v=Jc(this.controller,y,w),E=l,_=i?this.controller.s("graphing-calculator-narration-movable-point-suffix-usage-instructions"):"",T=this.isImageFullyVisible(n,C)?"":this.controller.s("graphing-calculator-narration-draggable-image-off-screen-prompt"),I;return o?c||!S&&u?I=E+T:S?I=v+T:I="":I=this.controller.s("graphing-calculator-narration-item-at-coordinates",{itemDescription:E,coordinates:v})+_+T,{id:t,coordX:y,coordY:w,label:l,completeMessage:I}}getFocusedImage(){let e=this.grapher.poiController.keyboardAttentionManager.getKeyboardAttention();return e?this.renderedTabTargets[e.calcId]:void 0}speakImageAttribute(e,t){if(!(!e||!this.grapher.getAudioTrace()||!this.grapher.getProjection()))switch(t){case"X":Te(Md(this.controller,e.x));break;case"Y":Te(Ad(this.controller,e.y));break;case"L":Te(e.description);break}}hasNonlinearMoveStrategy(e){if(!e)return!1;let t=this.controller.getItemModel(e);if(!t||t.type!=="expression"||!t.formula)return!1;let o=t.formula.move_strategy;return!o||!o[0]?!1:o[0].type==="updateSliderNonlinear"}isImageFullyVisible(e,t){let o=e.formula.dimensions;if(!o||!o.x||!o.y)return!1;for(let i=0;i<o.x.length;i++)if(!t.coordsAreOnscreen(t.mapx(o.x[i]),t.mapy(o.y[i])))return!1;return!0}};var nY={translate:!0,reflect:!0,dilate:!0,rotate:!0},RVe={selection:!0,point:!0,line:!0,segment:!0,ray:!0,vector:!0,circle:!0,arc:!0,parallel:!0,perpendicular:!0,midpoint:!0,polygon:!0,compass:!0,angle:!0,directedangle:!0,anglebisector:!0,"box-selection":!0,"expression-edit":!0,...nY},nv=Object.keys(nY);var jt=__dcg_shared_module_exports__['e'](Z());var xI=__dcg_shared_module_exports__['e'](Z());var iue=.9,Xh=class extends xI.Class{template(){return xI.createElement("div",{class:()=>{var e,t;return{"dcg-color-swatch":!0,"dcg-forced-color-none":!0,"dcg-color-evaluation":(t=(e=this.props).isEvaluation)==null?void 0:t.call(e),"dcg-light-color":Ox(this.props.color(),this.props.invertSwatches(),iue)}},style:()=>({background:Rx(this.props.color())}),"aria-label":()=>{var e,t;return(t=(e=this.props).ariaLabel)==null?void 0:t.call(e)}})}};function L3(r,e){if(r.indexOf("\\idref_{")===0){let t=r.indexOf("}"),o=r.slice(8,t);return e(o)+r.slice(t+1)}else return r}function P3(r,e){var i;let t={};for(let n in r){let a=r[n];if(a.type==="polygon-segment"&&!a.showAsSepratePreviewObject){let s=aY(a,e,{});if(!s)throw new Error("Expected polygon-segment object to be converted");t[n]={type:"inline",rhs:s.rhs}}}let o={...t};for(let n in r){if(t[n])continue;let a=r[n],s=aY(a,e,t);s&&(o[n]={type:"assignment",latex:`${(i=s.lhs)!=null?i:a.id}=${s.rhs}`,color:a.color,showAngleLabel:s.showAngleLabel,sliderInfo:s.sliderInfo})}return o}function aY(r,e,t){var n;let o=a=>{let s=a;return t[a]?s=t[a].rhs:e.isBeingCommitted&&(s=L3(a,e.getVariableNameForId)),s},i=a=>a.map(o);switch(r.type){case"point-reference":return{rhs:r.parents[0]};case"point":let{x:a,y:s}=r;return{rhs:"\\left("+__dcg_shared_module_exports__['je'](a)+","+__dcg_shared_module_exports__['je'](s)+"\\right)"};case"glider":return{rhs:"\\operatorname{glider}\\left("+i(r.parents)[0]+","+__dcg_shared_module_exports__['je'](r.t)+"\\right)"};case"polygon":return{rhs:"\\operatorname{"+r.type+"}\\left("+i(r.parents).join(",")+"\\right)"};case"circle":case"arc":case"compass":case"segment":case"line":case"ray":case"parallel":case"perpendicular":case"anglebisector":case"intersection":case"midpoint":return{rhs:"\\operatorname{"+r.type+"}\\left("+i(r.parents).join(",")+"\\right)"};case"vector-copy":{let[m,y]=i(r.parents);return{rhs:`\\operatorname{translate}\\left(${m},${m}.\\operatorname{start},${y}\\right)`}}case"vector":return{rhs:"\\operatorname{"+r.type+"}\\left("+i(r.parents).join(",")+"\\right)"};case"vector-endpoint":return{rhs:`${i(r.parents)[0]}.\\operatorname{${r.location}}`};case"translate":case"reflect":case"dilate":case"rotate":{let m=r.type==="dilate"||r.type==="rotate"?[...i([r.parents[0]]),r.parents[1]]:i(r.parents);return{rhs:`\\operatorname{${r.type}}\\left(x,${m.join(",")}\\right)`,lhs:`${r.id}\\left(x\\right)`}}case"angle":case"directedangle":return{showAngleLabel:(n=r.showAngleLabel)!=null?n:!0,rhs:"\\operatorname{"+r.type+"}\\left("+i(r.parents).join(",")+"\\right)"};case"polygon-angle":case"polygon-directedangle":let l=r.type==="polygon-angle"?"angles":"directedangles",c=i(r.parents)[0],d=r.angleIndex;return{showAngleLabel:e.isBeingCommitted,rhs:`\\operatorname{${l}}\\left(${c}\\right)\\left[${d}\\right]`};case"polygon-segment":return{rhs:i(r.parents)[0]+(r.listAccess!==void 0?"\\left["+r.listAccess+"\\right]":"")+".\\operatorname{segments}\\left["+(r.edgeNumber+1)+"\\right]"};case"slider":return{lhs:r.lhsLatex,rhs:r.rhsLatex,sliderInfo:r.sliderInfo};case"expression-edit-preview-latex":return r.rhsLatex===""?void 0:{showAngleLabel:r.rhsLatex.trim().startsWith("\\operatorname{angle}\\left("),rhs:r.rhsLatex};default:return r}}function O3(r,e){__dcg_shared_module_exports__['sc'](r)?r.value.forEach((t,o)=>{let i=__dcg_shared_module_exports__['cb'](r.valueType);if(__dcg_shared_module_exports__['gb'](i))throw new Error("Programming error: unexpected lambda type");e({valueType:i,value:t},o+1)}):e(r,void 0)}function WC(r){let e=r.formula.geometry,t=e==null?void 0:e.identifier;return t?__dcg_shared_module_exports__['$b'](t):"\\idref_{"+r.id+"}"}function Mb(r,e){let{controller:t,expandLists:o=!0}=r;t.getAllItemModels().concat(t.getAllToolPreviewItems()).forEach(n=>{var d;if(!$c(n))return;let a=n.formula.typed_constant_value,s=n.formula.geometry,l=WC(n),c=!t.getItemModel(n.id);o&&t.canExpandListForItem(n.id)?O3(a,(p,u)=>{var y;let h=l+(u===void 0?"":"\\left["+u+"\\right]"),m={calcId:n.id,data:s,hidden:!n.shouldGraph,isGraphableAndInteractive:!!((y=n.formula)!=null&&y.is_graphable)&&!r.controller.shouldIgnoreGraphInteractions(n),assignment:l,listIndex:u!==void 0?u-1:void 0,typedRuntimeValue:p,referenceLatex:h};e(m,c)}):e({calcId:n.id,data:s,hidden:!n.shouldGraph,isGraphableAndInteractive:!!((d=n.formula)!=null&&d.is_graphable)&&!r.controller.shouldIgnoreGraphInteractions(n),assignment:l,listIndex:void 0,typedRuntimeValue:a,referenceLatex:l},c)})}function nue(r,e){switch(r.valueType){case __dcg_shared_module_exports__['ia']:return{valueType:__dcg_shared_module_exports__['da'],value:r.value[e]};case __dcg_shared_module_exports__['ta']:return{valueType:__dcg_shared_module_exports__['sa'],value:r.value[e]};case __dcg_shared_module_exports__['ra']:return{valueType:__dcg_shared_module_exports__['qa'],value:r.value[e]};case __dcg_shared_module_exports__['za']:return{valueType:__dcg_shared_module_exports__['ya'],value:r.value[e]};case __dcg_shared_module_exports__['Ha']:return{valueType:__dcg_shared_module_exports__['Ga'],value:r.value[e]};case __dcg_shared_module_exports__['xa']:return{valueType:__dcg_shared_module_exports__['wa'],value:r.value[e]};case __dcg_shared_module_exports__['pa']:return{valueType:__dcg_shared_module_exports__['oa'],value:r.value[e]};case __dcg_shared_module_exports__['va']:return{valueType:__dcg_shared_module_exports__['ua'],value:r.value[e]};case __dcg_shared_module_exports__['Ba']:return{valueType:__dcg_shared_module_exports__['Aa'],value:r.value[e]};case __dcg_shared_module_exports__['Da']:return{valueType:__dcg_shared_module_exports__['Ca'],value:r.value[e]};case __dcg_shared_module_exports__['ja']:case __dcg_shared_module_exports__['ga']:case __dcg_shared_module_exports__['La']:case __dcg_shared_module_exports__['Fa']:case __dcg_shared_module_exports__['ha']:case __dcg_shared_module_exports__['Ja']:case __dcg_shared_module_exports__['na']:case __dcg_shared_module_exports__['Na']:case __dcg_shared_module_exports__['Pa']:case __dcg_shared_module_exports__['Ra']:case __dcg_shared_module_exports__['Ta']:case __dcg_shared_module_exports__['Va']:case __dcg_shared_module_exports__['Xa']:throw new Error("Programming Error: unexpected type "+__dcg_shared_module_exports__['ab'](r.valueType));default:throw r.valueType,new Error("Programming Error: expected a list type but found "+__dcg_shared_module_exports__['ab'](r.valueType))}}function R3(r,e){return{...r,referenceLatex:r.assignment+"\\left["+e+"\\right]",typedRuntimeValue:nue(r.typedRuntimeValue,e),listIndex:e}}function wI(r){switch(r){case __dcg_shared_module_exports__['da']:return"Point";case __dcg_shared_module_exports__['sa']:return"Circle";case __dcg_shared_module_exports__['ua']:return"Arc";case __dcg_shared_module_exports__['oa']:return"Polygon";case __dcg_shared_module_exports__['wa']:return"Line";case __dcg_shared_module_exports__['qa']:return"Segment";case __dcg_shared_module_exports__['ya']:return"Ray";case __dcg_shared_module_exports__['Ga']:return"Vector";case __dcg_shared_module_exports__['Aa']:return"Angle";case __dcg_shared_module_exports__['Ca']:return"Angle"}}function sY(r){if(!r)return;let e=r.typedRuntimeValue;return wI(e.valueType)}var Sp=class{constructor(e){this.model=e;this.s=e.s}createOutput(){return this.model.createCustomToolOutput(this.getSpec())}clearTentativeOutputs(){let e=this.getSpec(),t={},o=this.model.getNonObjectsState().ui.currentTool.idMap;for(let i in o){let n=o[i];!this.model.isObjectALockedToolInput(n)&&this.model.isObjectUncommitted(n)&&(t[i]=n)}this.model.deleteObjectsAndRememberReusableId(t),this.model.tentativelyMatchToolInput(e,""),this.createOutput()}didLockInput(e){var n;let{currentTool:t}=this.model.getNonObjectsState().ui,o=t.inputIndex,i=e.inputs[o];i&&(n=i.numberInputInfo)!=null&&n.defaultLatex&&!t.idMap[i.id]&&this.onNumberInput(i.numberInputInfo.defaultLatex)}shouldReferenceSpecificItemInList(e,t){return!t}getExpandedReferenceForDef(e,t){return this.shouldReferenceSpecificItemInList(e,t)?e.referenceLatex:e.assignment}getListIndexForHover(e,t){if(this.shouldReferenceSpecificItemInList(e,t))return e.listIndex}_getOrCreatePoint(e,t,o){let i=this.model.getOrCreatePointNearMouse(e,o);if(i.type==="def")return{createdNew:!1,def:i.def,reference:this.getExpandedReferenceForDef(i.def,t),previewOnly:!1};let n=this.createPointDefinition(i.spec,t),a=i.spec.type==="point-reference"?i.spec.targetSpec.parentDefs:i.spec.parentDefs,s=0;for(let c=0;c<a.length;c++){let d=a[c];if(d.polygonEdgeInfo){let p=this.model.createToolInputDependency({type:"polygon-segment",parents:[d.polygonEdgeInfo.polygonDef.referenceLatex],edgeNumber:d.polygonEdgeInfo.edgeNumber||0,polygonColor:this.getPolygonEdgeColor(d)},this.getSpec(),s);n.parents[c]=p,s+=1,this.model.setObjectHovered({tokenId:p,listIndex:void 0})}else this.model.setObjectHovered({calcId:d.calcId,listIndex:this.getListIndexForHover(d,t)})}return{createdNew:!0,def:void 0,reference:this.model._createInputObject(n),previewOnly:n.type==="point"&&n.previewOnly}}_isReadyToCommit(){return this.model.getNonObjectsState().ui.currentTool.inputIndex>=this.getSpec().inputs.length}_getFirstMissingInput(){let{inputIndex:e}=this.model.getNonObjectsState().ui.currentTool;return this.getSpec().inputs[e]}canNextInputBePoint(){let e=this._getFirstMissingInput();return e&&e.type==="point"?!0:!!(e&&e.type==="union"&&e.valueTypes.indexOf(__dcg_shared_module_exports__['da'])!==-1)}getNonPointInputType(){let e=this._getFirstMissingInput();if(!(!e||e.type==="point"))return e.type==="union"?e:e.type}isValidNextInputType(e){if(this.canNextInputBePoint()&&__dcg_shared_module_exports__['_'](e,__dcg_shared_module_exports__['da']))return!0;let t=this._getFirstMissingInput();if(!t)return!1;let o=[];if(t.type==="union")o=t.valueTypes;else{let i=t.type;switch(i){case"point":o=[__dcg_shared_module_exports__['da']];break;case"straight":o=[...__dcg_shared_module_exports__['eb'].types];break;case"angle":o=[__dcg_shared_module_exports__['Aa'],__dcg_shared_module_exports__['Ca']];break;case"arc":o=[__dcg_shared_module_exports__['ua']];break;case"circle":o=[__dcg_shared_module_exports__['sa']];break;case"polygon":o=[__dcg_shared_module_exports__['oa']];break;case"segment":o=[__dcg_shared_module_exports__['qa']];break;case"vector":o=[__dcg_shared_module_exports__['Ga']];break;default:return i}}return t.numberInputInfo&&o.push(__dcg_shared_module_exports__['ba']),o.some(i=>__dcg_shared_module_exports__['_'](e,i))}getAllValidNextInputTypes(){return __dcg_shared_module_exports__['_a'].filter(e=>this.isValidNextInputType(e))}getHint(){let e=this._getFirstMissingInput();return e?e.hint!==void 0?this.s(e.hint):this.s("graphing-calculator-text-geometry-select-hint",{type:e.type}):""}getSpecIdToLockIn(e,t){let o=e.inputs[t];if(o)return o.id}tryCommitResults(){if(this.model.attemptLockToolInputIn(this.getSpec()),this._isReadyToCommit()){let e=this.model.getUncommittedObjects();for(let o in e)e[o].type==="expression-edit-preview-latex"&&delete e[o];let t={...this.model.getNonObjectsState().ui.currentTool.idMap};return this.model.commitObjects(),this.model.deselectAllObjects(),this.model.cancelToolplay(),{committed:e,toolIdToLatex:t}}return{committed:void 0}}tentativelyAddInput({target:e,pointInfo:t},o){var n,a;let i;if(e)if(e.polygonEdgeInfo){let s=this.model.createToolInputDependency({type:"polygon-segment",parents:[(n=e.polygonEdgeInfo)==null?void 0:n.polygonDef.referenceLatex],edgeNumber:((a=e.polygonEdgeInfo)==null?void 0:a.edgeNumber)||0,polygonColor:this.getPolygonEdgeColor(e)},this.getSpec(),0);this.model.setObjectHovered({tokenId:s,listIndex:void 0}),i=s}else i=this.getExpandedReferenceForDef(e,o),this.model.setObjectHovered({calcId:e.calcId,listIndex:this.getListIndexForHover(e,o)});else t&&(i=t.reference,t!=null&&t.def&&!t.createdNew&&!t.previewOnly&&this.model.setObjectHovered({calcId:t.def.calcId,listIndex:this.getListIndexForHover(t.def,o)}));i&&this.model.tentativelyMatchToolInput(this.getSpec(),i)}onFocus(e){this.clearTentativeOutputs(),e&&this.tentativelyAddInput({target:e},!1),this.createOutput()}onMove(e){this.clearTentativeOutputs();let t=this.canNextInputBePoint(),o=this.getNonPointInputType(),i=!1;if(o){let n=this.model.getObjectDefUnderMouse(e.pt,e.tolerance,this.model.getCurrentTool());n&&this.model.objectIsInstanceOf(n,o)&&(this.tentativelyAddInput({target:n},e.shift),i=!0)}if(!i&&t){let n=this._getOrCreatePoint(e.pt,e.shift,e.tolerance);i=!n.previewOnly,this.isDegenerateInput(n.reference)?n.def&&this.model.setObjectHovered({calcId:n.def.calcId,listIndex:this.getListIndexForHover(n.def,e.shift)}):this.tentativelyAddInput({pointInfo:n},e.shift)}return this.createOutput(),i}isDegenerateInput(e){return!!this.model.getNonObjectsState().ui.currentTool.lockedIds[e]}getNumberInputLatex(){let e=this.getSpec(),{inputIndex:t,idMap:o}=this.model.getNonObjectsState().ui.currentTool,i=e.inputs[t];return i!=null&&i.numberInputInfo&&o[`${i.id}-number`]||""}onNumberInput(e){this.clearTentativeOutputs();let t=this.getSpec();this.model.storeNumberInputLatex(t,e),this.createOutput()}createPointDefinition(e,t){let o=e.parentDefs,i;switch(e.type){case"point-reference":{i={type:"point-reference",parents:[this.getExpandedReferenceForDef(o[0],t)]};break}default:{let n=o.map(a=>this.getExpandedReferenceForDef(a,t));i={...e,parents:n}}}return i}shouldUseJitEdges(){return!0}shouldHighlightRelevantObjects(){return!0}getPolygonEdgeColor(e){var n;let{ui:t}=this.model.getNonObjectsState(),o=e.polygonEdgeInfo?this.model.controller.getItemModel(e.polygonEdgeInfo.polygonDef.calcId):void 0;if((o==null?void 0:o.type)!=="expression")return t.colors.line;let i=W_(o)&&$_(o);return e.listIndex!==void 0&&Array.isArray(i)?(n=i[e.listIndex])!=null?n:t.colors.line:typeof i=="string"?i:o.color}};function vI(r,e){if(typeof e=="object")return e.valueTypes.some(t=>__dcg_shared_module_exports__['_'](r,t));switch(e){case"point":return r===__dcg_shared_module_exports__['da'];case"straight":return r===__dcg_shared_module_exports__['wa']||r===__dcg_shared_module_exports__['ya']||r===__dcg_shared_module_exports__['qa']||r===__dcg_shared_module_exports__['Ga'];case"angle":return r===__dcg_shared_module_exports__['Aa']||r===__dcg_shared_module_exports__['Ca'];case"arc":return r===__dcg_shared_module_exports__['ua'];case"circle":return r===__dcg_shared_module_exports__['sa'];case"polygon":return r===__dcg_shared_module_exports__['oa'];case"segment":return r===__dcg_shared_module_exports__['qa'];case"vector":return r===__dcg_shared_module_exports__['Ga'];default:return e}}var SI=class r{constructor(e,t){this.value=e;this.valueType=t}static point(e){return new r(e,__dcg_shared_module_exports__['da'])}static polygonSegment(e){return new r(e,__dcg_shared_module_exports__['qa'])}},yo=class extends Sp{constructor(t,o){super(t);this.definition=o;this.s=t.s,this.displayName=o.displayName,this.toolType=o.toolType,this.toolName=o.name,this.icon=o.icon,this.workflows=o.workflows.map(i=>{let n=i.input.broadcast?__dcg_shared_module_exports__['ib'](i.input.types,{geometry:!0}):__dcg_shared_module_exports__['hb'](i.input.types,{geometry:!0});return{...i,signature:n}})}getWorkflows(){return this.workflows}getMatchingWorkflow(t){let o=t.map(s=>s.valueType),i=this.workflows.filter(s=>s.signature.matches(o));if(i.length===0)return;let n=i.find(s=>o.length>=s.signature.minArity),a=n!=null&&n.canCommit?n.canCommit(t):!!n;return{firstMatch:n!=null?n:i[0],canCommit:a,allMatches:i,inputs:t,argTypes:o}}getInputAtIndex(t){let{idMap:o}=this.model.getNonObjectsState().ui.currentTool,i=o[`${t}`];if(i)return this.getInputById(i)}getInputById(t){let i=this.model.getUncommittedObjects()[t];if(i&&aue(i))return SI.point(i);if(i&&i.type==="polygon-segment")return SI.polygonSegment(i);let n=this.model.findDefsForInputId(t)[0];return n==null?void 0:n.typedRuntimeValue}getMatchingWorkflowForCurrentInputs(t=1/0){let{inputIndex:o}=this.model.getNonObjectsState().ui.currentTool,i=[];for(let n=0;n<=Math.min(o,t);n++){let a=this.getInputAtIndex(n);if(a===void 0)break;i.push(a)}return this.getMatchingWorkflow(i)}canNextInputBePoint(){let{inputIndex:t}=this.model.getNonObjectsState().ui.currentTool,o=this.getMatchingWorkflowForCurrentInputs(t-1);return!!(o!=null&&o.allMatches.some(i=>{let n=i.signature.argTypeAtIndex(t);return n===void 0?!1:__dcg_shared_module_exports__['jb'](__dcg_shared_module_exports__['da'],n)}))}isDegenerateInput(t){if(this.definition.isDegenerateInput){let o=this.getMatchingWorkflowForCurrentInputs(),i=this.getInputById(t);return i?this.definition.isDegenerateInput({previousInputs:(o==null?void 0:o.inputs)||[],proposedInput:i}):!1}return super.isDegenerateInput(t)}getSpec({isCommitting:t}={isCommitting:!1}){var l,c;let o=this.getMatchingWorkflowForCurrentInputs();if(!o)return{inputs:[],outputs:[]};let{inputIndex:i}=this.model.getNonObjectsState().ui.currentTool,n=o.firstMatch,a=[],s=(l=n.signature.maxArity)!=null?l:i+1;for(let d=0;d<s;d++){let p=n.signature.argTypeAtIndex(d);if(!p)throw new Error(`Expected arg type for arg ${d}`);if(lY(p)){let u=[];if(d===i){let h=this.getMatchingWorkflowForCurrentInputs(d-1);for(let m of(c=h==null?void 0:h.allMatches)!=null?c:[]){let y=m.signature.argTypeAtIndex(d);y&&!lY(y)&&u.push(...typeof y=="number"?[y]:y.getTypes())}}u.length>0?a.push({id:`${d}`,type:"union",hint:CI(n,d),valueTypes:[...u,__dcg_shared_module_exports__['da']]}):a.push({id:`${d}`,type:"point",hint:CI(n,d)})}else a.push({id:`${d}`,type:"union",hint:CI(n,d),valueTypes:typeof p=="number"?[p]:p.getTypes().slice()})}return{inputs:a,outputs:F3(n,o.inputs,t)}}tryCommitResults(){var t;if(this.model.attemptLockToolInputIn(this.getSpec()),(t=this.getMatchingWorkflowForCurrentInputs())!=null&&t.canCommit){this.clearTentativeOutputs(),this.model.createCustomToolOutput(this.getSpec({isCommitting:!0}));let o=this.model.getUncommittedObjects();for(let n in o)o[n].type==="expression-edit-preview-latex"&&delete o[n];let i={...this.model.getNonObjectsState().ui.currentTool.idMap};return this.model.commitObjects(),this.model.deselectAllObjects(),this.model.cancelToolplay(),{committed:o,toolIdToLatex:i}}return{committed:void 0}}getExpressionEditHint(t){var i;let o=(i=this.getMatchingWorkflowForCurrentInputs())==null?void 0:i.firstMatch;return o?this.s(CI(o,t)):""}shouldReferenceSpecificItemInList(t,o){var i,n;if(o){let{inputIndex:a}=this.model.getNonObjectsState().ui.currentTool;return!((n=(i=this.getMatchingWorkflowForCurrentInputs())==null?void 0:i.allMatches)!=null?n:[]).some(c=>{let d=c.signature.argTypeAtIndex(a);return d===void 0?!1:typeof d=="number"?__dcg_shared_module_exports__['bb'](d):d.getTypes().some(__dcg_shared_module_exports__['bb'])})}else return!0}};function F3(r,e,t){let o;return Array.isArray(r.output)?o=r.output:o=r.output({inputs:e,isCommitting:t}),o.map((i,n)=>({...i,id:`result-${n}`,hidden:!1,parents:i.parents.map(a=>({type:"reference-input",id:`${a}`}))}))}function lY(r){return typeof r=="number"?r===__dcg_shared_module_exports__['da']:r.getTypes().every(e=>__dcg_shared_module_exports__['fb'](e,__dcg_shared_module_exports__['da']))}function CI(r,e){return Array.isArray(r.input.hints)?r.input.hints[e]:r.input.hints(e)}function aue(r){switch(r.type){case"point":case"intersection":case"glider":case"point-reference":case"midpoint":case"vector-endpoint":return!0;default:return r.type,!1}}var Jh=__dcg_shared_module_exports__['e'](Z()),av=class extends Jh.Class{template(){return Jh.createElement("div",{class:Jh.const("dcg-dot-dot-dropdown")},Jh.createElement("i",{class:Jh.const("dcg-icon-ellipsis-vertical"),"aria-hidden":Jh.const("true")}))}};var sv=__dcg_shared_module_exports__['e'](Z());$t();var cY='a, input, button:not([disabled]), textarea, select [role="textbox"], [tabIndex="0"], [role="option"], [role="button"], [role="link"], summary',EI=class{constructor({closeMenu:e,focusIcon:t,getIconSelector:o,getContainerEl:i,isIconFocused:n}){this.globalKeyDownListener=e=>{let t=Be(e);if(t===Pn){e.preventDefault(),e.stopPropagation(),this.focusIcon(),this.closeMenu();return}if(t==="Tab"&&!e.altKey&&!e.ctrlKey&&!e.metaKey){if(this.isIconFocused()){e.shiftKey?this.focusLastOption():this.focusFirstOption(),e.preventDefault(),e.stopPropagation();return}if(this.isLastOptionViewFocused()&&!e.shiftKey){this.focusIcon(),e.preventDefault(),e.stopPropagation();return}if(this.isFirstOptionViewFocused()&&e.shiftKey){this.focusIcon(),e.preventDefault(),e.stopPropagation();return}}};this.tapListener=e=>{let t=this.getContainerEl();if(!t)return;let{target:o}=e,i=this.getIconSelector();if(i&&o.closest(i))return;if(t.contains(o)){if(!o.matches(cY))return;let{first:a,last:s}=this.getDOMTabStops();a===o?this.focusFirstOption():s===o&&this.focusLastOption();return}Array.from(document.querySelectorAll(".dcg-keypad,.dcg-show-keypad-container")).some(a=>a.contains(o))||this.closeMenu()};this.closeMenu=e,this.getContainerEl=i,this.getIconSelector=o,this.isIconFocused=n,this.focusIcon=t}isFirstOptionViewFocused(){let{first:e}=this.getDOMTabStops();return e!==void 0&&e.matches(":focus")}focusFirstOption(){let{first:e}=this.getDOMTabStops();e!==void 0&&e.focus()}focusLastOption(){let{last:e}=this.getDOMTabStops();e!==void 0&&e.focus()}isLastOptionViewFocused(){let{last:e}=this.getDOMTabStops();return e!==void 0&&e.matches(":focus")}getDOMTabStops(){let e=this.getContainerEl();if(e===void 0)return{};let t=Array.from(e.querySelectorAll(cY)).filter(o=>o.getAttribute("tabIndex")!=="-1");return{first:t.find(o=>cp(o)),last:[...t.reverse()].find(o=>cp(o))}}};var zl=class extends sv.Class{init(){this.controller=this.props.controller()}template(){return sv.createElement("div",{class:sv.const("dcg-options-menu-container"),didMount:this.bindFn(this.didMountView),didUnmount:this.bindFn(this.didUnmountView)},this.props.children)}didMount(){this.props.openAriaAlert&&Te(this.props.openAriaAlert())}willUnmount(){this.props.closeAriaAlert&&Te(this.props.closeAriaAlert())}didMountView(e){this.focusHelper=new EI({isIconFocused:()=>this.isIconModelFocused(),focusIcon:()=>this.focusIcon(),getContainerEl:()=>this.openView,closeMenu:()=>this.hideOptions(),getIconSelector:()=>{var t;return`[dcg-open-menu-guid="${(t=this.controller.getOpenItemMenu())==null?void 0:t.guid}"]`}}),this.guid=__dcg_shared_module_exports__['P']("dcg-dropdown-menu"),this.openView=e,this.positionMenu(),this.moveFocusIfAppropriate(),this.attachKeyDownListeners(),this.attachTapListener()}isIconModelFocused(){let e=this.controller.getFocusLocation();return __dcg_shared_module_exports__['J'](e,this.props.menuButtonFocusLocation())}attachKeyDownListeners(){this.props.shouldHandleTabAndEscape()&&document.addEventListener("keydown",this.focusHelper.globalKeyDownListener)}attachTapListener(){re(document.body).on(`dcg-tapstart.${this.guid}`,this.focusHelper.tapListener)}didUnmountView(){document.removeEventListener("keydown",this.focusHelper.globalKeyDownListener),re(document.body).off(`.${this.guid}`),this.openView=void 0}moveFocusIfAppropriate(){this.shouldMoveFocusToFirstOption()?this.focusHelper.focusFirstOption():this.shouldMoveFocusToLastOption()&&this.focusHelper.focusLastOption()}hideOptions(){this.controller.dispatch({type:"close-item-settings-menu"})}getRootEl(){return this.controller.findEl(this.props.rootElSelector())}positionMenu(){var a;let e=this.controller.getOpenMenuIcon();if(!e||!this.openView)return;let t=this.getRootEl();if(!t)return;let o=t.getBoundingClientRect(),i=e.getBoundingClientRect(),n=i.width;if(this.props.menuType()==="geo-tool-dropdown"||this.props.menuType()==="multi-select-construct"||this.props.menuType()==="multi-select-style"||this.props.menuType()==="multi-select-label"||this.props.menuType()==="multi-select-more"){Yi(this.openView,{display:"block"});let s=(a=this.openView.querySelector(".dcg-options-menu"))==null?void 0:a.getBoundingClientRect();if(!s)return;let l=i.left-o.left,c=o.right-(i.left+n);l+n/2>=s.width/2&&c+n/2>=s.width/2?Yi(this.openView,{top:`${i.top-o.top}px`,left:`${l+n/2-s.width/2}px`}):l<c?Yi(this.openView,{top:`${i.top-o.top}px`,left:"0px"}):Yi(this.openView,{top:`${i.top-o.top}px`,right:`${s.width}px`})}else Yi(this.openView,{top:`${i.top-o.top}px`,left:`${i.left-o.left}px`,display:"block"})}focusIcon(){this.controller.focusOpenMenuIcon()}shouldMoveFocusToFirstOption(){if(this.props.focusOnOpen)return this.props.focusOnOpen()==="first";if(this.openView&&this.openView.matches(":focus-within"))return!1;let e=this.controller.getOpenItemMenu();return(e==null?void 0:e.type)===this.props.menuType()&&!!(e!=null&&e.focusFirstOption)}shouldMoveFocusToLastOption(){return this.props.focusOnOpen?this.props.focusOnOpen()==="last":!1}};var Ab=__dcg_shared_module_exports__['e'](Z()),DI=class extends Ab.Class{onSpanMount(e){e.insertAdjacentHTML("beforeend",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><style>.cls-1{fill:#7c69b3}.cls-3{fill:#719972}</style></defs><g id="Layer_1"><path d="M35.3 45.6ZM7.2 97.3z" class="cls-3"/><path fill="#fff" d="M7.2 97.3"/><path d="M47.7 39.8c2.5-2.9 3.7-6.3 3.7-10.3s-1-6.6-3-9.3c-2-2.7-4.6-4.6-7.7-5.7V2.7H30v11.8c-3.1 1.1-5.7 3-7.7 5.7s-3 5.8-3 9.3 1.3 7.6 3.9 10.5L4.7 89.4l2.5 7.9 8.2-5.1 17.1-46.9c.9.2 1.9.2 2.8.2 1.1 0 2.1 0 3.1-.3l16.8 47.1 8.2 4.3 1.7-8.2-17.5-48.7Zm-16.2-6.5c-1-1-1.5-2.3-1.5-3.8s.5-2.8 1.5-3.8 2.3-1.5 3.8-1.5 2.8.5 3.8 1.5 1.5 2.3 1.5 3.8-.5 2.8-1.5 3.8-2.3 1.5-3.8 1.5-2.8-.5-3.8-1.5Z" class="cls-3"/><path d="m49.8 94.3-9.9-27.8-8.7 15.6c-.6 1.1-.2 2.5.8 3.2l17.6 10.5c.4.2.8.3 1.2.3-.4-.5-.8-1.1-1-1.8ZM94.1 16 76.5 5.5c-1.1-.6-2.5-.3-3.1.8L54.2 40.8l11.3 31.3 29.5-53c.6-1.1.2-2.5-.8-3.2Z" class="cls-1"/></g></svg>')}template(){return Ab.createElement("span",{"aria-hidden":Ab.const("true"),class:Ab.const("dcg-construct-button-icon"),onMount:this.bindFn(this.onSpanMount)})}};var go=__dcg_shared_module_exports__['e'](Z());var kI=__dcg_shared_module_exports__['e'](Z());function pY(r,e,t){r.save();for(let o of t)switch(o.type){case"point":{let i;!o.color||o.color==="dark"?i=uG({isPoint:!0,color:e.point,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1}):o.color==="light"?i=__dcg_shared_module_exports__['Sd'](e.point,.7):i=o.color;let n;switch(o.size){case"small":n=5;break;case"large":n=10;break;case"medium":default:n=5;break}o.hollow?(r.lineWidth=2,r.strokeStyle=i,r.beginPath(),r.arc(o.x,o.y,n-1,0,2*Math.PI),r.stroke()):(r.fillStyle=i,r.beginPath(),r.arc(o.x,o.y,n,0,2*Math.PI),r.fill())}break;case"circle":{let i;!o.color||o.color==="dark"?i=yC({isPoint:!1,color:e.circle,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1}):o.color==="light"?i=__dcg_shared_module_exports__['Sd'](e.circle,.7):typeof o.color=="function"?i=o.color(e):i=o.color;let n;switch(o.lineWidth){case"small":n=2;break;case"large":n=7;break;case"medium":case void 0:n=4;break;default:n=o.lineWidth;break}r.lineWidth=n,r.strokeStyle=i,r.beginPath(),r.arc(o.x,o.y,o.radius,0,2*Math.PI),r.stroke()}break;case"arc":{let i;!o.color||o.color==="dark"?i=yC({isPoint:!1,color:e.circle,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1}):o.color==="light"?i=__dcg_shared_module_exports__['Sd'](e.circle,.7):i=o.color;let n;switch(o.lineWidth){case"small":n=2;break;case"large":n=7;break;case"medium":default:n=4;break}r.lineWidth=n,r.strokeStyle=i,r.beginPath(),r.arc(o.x,o.y,o.radius,o.startAngle,o.endAngle),r.stroke()}break;case"stroked-path":{let i;!o.color||o.color==="dark"?i=yC({isPoint:!1,color:e.line,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1}):o.color==="light"?i=__dcg_shared_module_exports__['Sd'](e.line,.7):typeof o.color=="function"?i=o.color(e):i=o.color;let n=o.path,a;switch(o.lineWidth){case"small":a=1;break;case"large":a=5;break;case"medium":default:a=3;break}r.lineCap="round",r.lineJoin="round",r.strokeStyle=i,r.lineWidth=a,r.beginPath(),r.moveTo(n[0],n[1]);for(let s=2;s<n.length;s+=2)r.lineTo(n[s],n[s+1]);if(o.arrow){let s=[],l=n.length-1;lue(s,n[l-3],n[l-2],n[l-1],n[l],a/2+9.5);for(let c=0;c<s.length;c+=2)r.lineTo(s[c],s[c+1])}r.stroke()}break;case"filled-polygon":{let i;o.color?i=o.color:i=uG({isPoint:!1,color:e.polygon,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1,isTransparentObject:!0});let n=o.path;r.fillStyle=i,r.beginPath(),r.moveTo(n[0],n[1]);for(let a=2;a<n.length;a+=2)r.lineTo(n[a],n[a+1]);r.fill()}break;case"angle":{let i=yC({isPoint:!1,color:e.angle,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1,isTransparentObject:!0}),n=uG({isPoint:!1,color:e.angle,uncommitted:!1,featured:!1,hidden:!1,hovered:!1,projectorMode:!1,isTransparentObject:!0});sue(r,{type:"angle-indicator",lineWidth:4,strokeStyle:i,fillStyle:n,isRightAngle:!1,x:o.x,y:o.y,isDirected:o.isDirected,radius:o.radius,startAngle:o.startAngle,deltaAngle:o.deltaAngle})}break;case"ellipse":r.lineWidth=o.lineWidth,r.strokeStyle=o.color,r.beginPath(),r.ellipse(o.x,o.y,o.rx,o.ry,0,0,2*Math.PI),r.stroke();break;default:return o}r.restore()}function sue(r,e){r.beginPath(),dY(r,e),r.lineTo(e.x,e.y),r.lineTo(e.x+e.radius*Math.cos(e.startAngle),e.y+e.radius*Math.sin(e.startAngle)),e.isDirected||(r.fillStyle=e.fillStyle,r.fill()),r.strokeStyle=e.strokeStyle,r.lineWidth=e.lineWidth,r.beginPath(),dY(r,e),r.stroke()}function dY(r,e){let t=e.startAngle+e.deltaAngle;if(e.isRightAngle){let o=e.radius*Math.cos(e.startAngle),i=e.radius*Math.cos(t),n=e.radius*Math.sin(e.startAngle),a=e.radius*Math.sin(t);r.moveTo(e.x+o,e.y+n),r.lineTo(e.x+o+i,e.y+n+a),r.lineTo(e.x+i,e.y+a)}else r.arc(e.x,e.y,e.radius,e.startAngle,t)}function lue(r,e,t,o,i,n=12){let a=Math.atan2(i-t,o-e),s=o-n*Math.cos(a-Math.PI/9),l=i-n*Math.sin(a-Math.PI/9),c=o-n*Math.cos(a+Math.PI/9),d=i-n*Math.sin(a+Math.PI/9),p=o-(n-2)*Math.cos(a-Math.PI/18),u=i-(n-2)*Math.sin(a-Math.PI/18),h=o-(n-2)*Math.cos(a+Math.PI/18),m=i-(n-2)*Math.sin(a+Math.PI/18);r.push(s,l,c,d,o,i,p,u,h,m,o,i)}var Vb=class extends kI.Class{template(){return kI.createElement("canvas",{didMount:this.bindFn(this.didMountCanvas),width:()=>this.props.width(),height:()=>this.props.height(),style:()=>({width:this.props.width()/2+"px",height:this.props.height()/2+"px"})})}didMountCanvas(e){this.canvas=e,this.redraw()}didUpdate(){this.redraw()}redraw(){let e=this.props.instructions()||[],t=this.props.model().getNonObjectsState().ui.colors;if(__dcg_shared_module_exports__['J'](e,this.lastInstructions)&&__dcg_shared_module_exports__['J'](t,this.lastColors))return;this.lastInstructions=e,this.lastColors=t;let o=this.canvas.getContext("2d");o.clearRect(0,0,o.canvas.width,o.canvas.height),pY(o,t,e)}};var Ws=__dcg_shared_module_exports__['e'](Z());var{For:cue,Each:due,SwitchUnion:pue}=Ws.Components,lv=class extends Ws.Class{init(){this.controller=this.props.controller(),this.geoModel=this.controller.getGeoModel()}template(){return Ws.createElement("div",{class:()=>({"dcg-options-menu":!0,"dcg-select-tools-dropdown":!0,"dcg-shift-menu-left":this.props.items()[0][0]==="angle"||this.props.items()[0][0]==="segment"}),"aria-label":this.props.ariaLabel,onKeyDown:this.bindFn(this.handleKeyPress),"dcg-geo-tool-group":this.bindFn(this.props.group)},Ws.createElement("div",{class:Ws.const("dcg-options-menu-section-container"),role:Ws.const("menu")},due(()=>this.props.items(),{item:e=>Ws.createElement("div",{class:()=>({"dcg-options-menu-section":!0})},Ws.createElement(cue,{each:()=>e},t=>Ws.createElement("button",{role:Ws.const("menuitemradio"),tabIndex:()=>t===e[0]&&this.sectionKey(e)===this.sectionKey(this.props.items()[0])?0:-1,"aria-disabled":()=>!this.isToolEnabled(t),"aria-description":()=>this.isToolEnabled(t)?void 0:this.controller.s("graphing-calculator-narration-geometry-tool-disabled",{tool:t}),"aria-checked":()=>this.controller.getActiveTool()===t,onTap:o=>{this.isToolEnabled(t)&&this.props.onChooseTool({tool:t,fromKeyboard:o.device==="keyboard"})},"dcg-geo-tool":this.const(t),class:()=>({"dcg-dropdown-tool":!0,"dcg-unstyled-button":!0,"dcg-transformation-tool":__dcg_shared_module_exports__['gd'](t),"dcg-selected-tool":this.controller.getActiveTool()===t,"dcg-disabled":!this.isToolEnabled(t),"dcg-will-be-hidden-or-disabled":this.controller.toolWillBeHiddenOrDisabled(t)}),manageFocus:this.const(ct({controller:this.controller,location:{type:"geo-basic-tool-menu-item",tool:t}}))},pue("type",()=>this.getIconInfo(t))({css:o=>Ws.createElement("i",{class:()=>o().className}),canvas:o=>Ws.createElement(Vb,{model:()=>this.geoModel,width:this.const(100),height:this.const(100),instructions:()=>o().instructions})}),Ws.createElement("span",null,()=>this.geoModel.getDisplayNameForTool(t))))),key:e=>this.sectionKey(e)})),this.props.children)}sectionKey(e){return e.join("-")}getIconInfo(e){switch(e){case"dilate":return{type:"css",className:"dcg-icon-dilation"};case"reflect":return{type:"css",className:"dcg-icon-reflection"};case"rotate":return{type:"css",className:"dcg-icon-rotation"};case"translate":return{type:"css",className:"dcg-icon-vector"};default:return{type:"canvas",instructions:this.geoModel.getIconInstructionsForTool(e)}}}isToolEnabled(e){return this.controller.isGeoToolEnabled(e)&&this.geoModel.isToolActuallyUsable(e)}handleKeyPress(e){let t=Be(e);if(t!=="Up"&&t!=="Down"&&t!=="Esc")return;let o=__dcg_shared_module_exports__['x'](this.props.items()),i=this.controller.getFocusLocation();if(t==="Esc"){(i==null?void 0:i.type)==="geo-basic-tool-menu-item"&&this.focusMenuIcon(),this.controller.dispatch({type:"close-item-settings-menu"}),e.stopPropagation(),e.preventDefault();return}if((i==null?void 0:i.type)!=="geo-basic-tool-menu-item")return;let n=t==="Down"?1:-1,s=(o.indexOf(i.tool)+n)%o.length;s<0&&(s=o.length+s),s>=0&&(this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool-menu-item",tool:o[s]}}),e.preventDefault(),e.stopPropagation())}focusMenuIcon(){let e=this.props.group();if(!e)return;if(e==="construct-from-selection")return this.controller.dispatch({type:"set-focus-location",location:{type:"multi-select-construct-icon"}});let t=this.controller.getGeoToolbarItemsForGroup(e),o=t==null?void 0:t.current;if(o)return this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:o}})}};var{If:uY,For:uue,Switch:hue}=go.Components,Lb=class extends go.Class{getAriaLabel(){let e=this.props.controller(),t=this.props.menuName();if(t)return e.s("graphing-calculator-label-geometry-tools-open-dropdown-menu-transformation",{item:t})}template(){return go.createElement("span",{class:go.const("dcg-tool-dropdown"),role:go.const("button"),tabIndex:go.const("-1"),"aria-label":this.bindFn(this.getAriaLabel),"aria-expanded":this.props.ariaExpanded,onTap:this.bindFn(this.handleOnTap)},go.createElement("span",{class:go.const("dcg-dropdown-icon")},go.createElement("i",{class:go.const("dcg-icon-caret-down")})))}handleOnTap(e){e.handle(),this.props.openDropDown()}},_I=class extends go.Class{init(){this.controller=this.props.controller(),this.geoModel=this.controller.getGeoModel()}getGroups(){return this.controller.getGeoToolbarGroupKeys()}hasDropdown(e){return!!this.getGroup(e).dropdown}template(){return go.createElement("div",{role:go.const("toolbar"),"aria-label":()=>this.controller.s("graphing-calculator-label-geometry-tools"),class:go.const("dcg-geo-basic-tools dcg-animate-in-after-initial-load"),onKeyDown:e=>this.handleToolbarKeydown(e)},go.createElement("div",{class:go.const("dcg-geo-basic-tools-row")},go.createElement(uue,{each:()=>this.getGroups()},e=>go.createElement("div",{class:go.const("dcg-tool-button-container")},go.createElement("button",{class:()=>({"dcg-split-btn":this.hasDropdown(e),"dcg-selected":this.isGroupSelected(this.getGroup(e)),"dcg-disabled":!this.isGroupEnabled(this.getGroup(e)),"dcg-menu-open":this.isGroupDropdownOpen(this.getGroup(e)),"dcg-will-be-hidden-or-disabled":this.controller.toolWillBeHiddenOrDisabled(this.getGroup(e).current)}),"dcg-geo-tool":()=>this.getGroup(e).current,"dcg-geo-tool-group":()=>e,tabIndex:()=>this.isGroupSelected(this.getGroup(e))?0:-1,"aria-label":()=>this.geoModel.getDisplayNameForTool(this.getGroup(e).current),"aria-disabled":()=>!this.isGroupEnabled(this.getGroup(e)),"aria-haspopup":()=>this.hasDropdown(e),"aria-pressed":()=>this.isGroupSelected(this.getGroup(e)),onTap:t=>this.handleTap(t,this.getGroup(e)),onLongHold:()=>this.openMenuFromLongHold(this.getGroup(e)),"dcg-open-menu-guid":()=>this.getGuid(this.getGroup(e)),manageFocus:()=>ct({controller:this.controller,location:{type:"geo-basic-tool",tool:this.getGroup(e).current}}),"aria-controls":()=>this.getGuid(this.getGroup(e)),"aria-expanded":()=>this.isGroupDropdownOpen(this.getGroup(e))},go.createElement("span",{class:()=>({"dcg-basic-tool-btn":!0,"dcg-icon":!0})},go.createElement(Vb,{model:()=>this.geoModel,width:this.const(96),height:this.const(96),instructions:()=>this.geoModel.getIconInstructionsForTool(this.getGroup(e).current)})),go.createElement(uY,{predicate:()=>this.hasDropdown(e)},()=>go.createElement(Lb,{menuName:()=>hY(this.controller,e),controller:this.props.controller,ariaExpanded:()=>this.isGroupDropdownOpen(this.getGroup(e)),openDropDown:()=>this.openDropdownMenu(this.getGroup(e))}))),go.createElement(uY,{predicate:()=>this.isGroupDropdownOpen(this.getGroup(e))},()=>go.createElement(zl,{controller:this.props.controller,shouldHandleTabAndEscape:this.const(!1),menuType:this.const("geo-tool-dropdown"),menuButtonFocusLocation:this.const({type:"geo-basic-tool",tool:this.getGroup(e).current}),rootElSelector:this.const(".dcg-geo-basic-tools-row")},go.createElement(lv,{controller:this.props.controller,group:()=>e,ariaLabel:()=>hY(this.controller,e),items:()=>this.getDropdownTools(e),onChooseTool:t=>{this.controller.dispatch({type:"select-geo-tool",tool:t.tool,focusGraphPaper:!!t.fromKeyboard})}})))))),go.createElement(hue,{key:()=>this.controller.getGeometryGettingStartedMessageState()},e=>{switch(e){case"hidden":return go.createElement("span",null);case"construct":case"pick-a-tool":return go.createElement("div",{class:()=>({"dcg-geo-getting-started-pointer":!0,"dcg-geo-getting-started-has-tool":this.controller.getGeometryGettingStartedMessageState()!=="pick-a-tool"})},this.bindFn(this.getPointerMessage),go.createElement("span",{class:go.const("dcg-curved-icon-container")},go.createElement("i",{class:go.const("dcg-icon-curved-arrow")})))}}))}getDropdownTools(e){let t=this.controller.getOpenItemMenu();if(!t||t.type!=="geo-tool-dropdown"||t.group!==e)return[];if(t.group==="line"){let o=[],i=[];for(let n of t.tools)n==="segment"||n==="line"||n==="ray"||n==="vector"?o.push(n):i.push(n);return[o,i]}return[t.tools]}isGroupSelected(e){return this.selectedTool()===e.current}isGroupEnabled(e){return this.controller.isGeoToolEnabled(e.current)}getGroup(e){let t=this.controller.getGeoToolbarItemsForGroup(e);if(!t)throw new Error("Programing error: "+e+" not found");return t}getPointerMessage(){return this.controller.getGeometryGettingStartedMessageState()==="pick-a-tool"?this.controller.s("geometry-label-pick-tool-instruction"):this.controller.s("geometry-label-construct-instruction")}getFocusedOrActiveTool(){let e=this.controller.getAllVisibleGeoToolbarItems(),t=this.controller.getFocusLocation();if(!t)return;let o;return t.type==="geo-basic-tool"||t.type==="geo-basic-tool-menu-item"?o=t.tool:o=this.controller.getActiveTool(),e.find(i=>{var n,a;return i.current===o||i.dropdown&&((a=(n=i.dropdown)==null?void 0:n.indexOf)==null?void 0:a.call(n,o))>-1})}handleToolbarKeydown(e){var l,c,d,p;let t=Be(e);if(t!=="Up"&&t!=="Down"&&t!=="Left"&&t!=="Right"&&t!=="Home"&&t!=="End"||(e.preventDefault(),e.stopPropagation(),!this.controller.getFocusLocation()))return;let i=this.controller.getAllVisibleGeoToolbarItems(),n=this.getFocusedOrActiveTool();if(!n)return;let a=i.findIndex(u=>u.group===n.group),s;if(t==="Home")s=(l=i[0])==null?void 0:l.current;else if(t==="End")s=(c=i[i.length-1])==null?void 0:c.current;else if(t==="Left"||t==="Right"){let u=t==="Left"?-1:1,h=Math.max(0,Math.min(i.length-1,a+u));s=(d=i[h])==null?void 0:d.current,((p=this.controller.getOpenItemMenu())==null?void 0:p.type)==="geo-tool-dropdown"&&this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"geo-tool-dropdown",guid:this.getGuid(n),tools:[],group:n.group}})}else(t==="Up"||t==="Down")&&this.openDropdownMenu(n);s&&this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:s}})}selectedTool(){let e=this.controller.getActiveTool();return e==="expression-edit"?"selection":e}openDropdownMenu(e){e.dropdown&&(this.isGroupSelected(e)||this.controller.dispatch({type:"select-geo-tool",tool:e.current}),this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"geo-tool-dropdown",guid:this.getGuid(e),tools:e.dropdown,group:e.group,focusFirstOption:!1}}),this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool-menu-item",tool:e.current}}))}getGuid(e){return e.dropdown?"geo-dropdown-"+e.dropdown[0]:""}openMenuFromLongHold(e){this.controller.dispatch({type:"select-geo-tool",tool:e.current}),this.openDropdownMenu(e)}handleTap(e,t){e.wasLongheld()||e.wasHandled()||(e.shiftKey||this.isGroupSelected(this.getGroup(t.group))?this.openDropdownMenu(t):(this.controller.dispatch({type:"select-geo-tool",tool:t.current,focusGraphPaper:e.device==="keyboard"}),e.device!=="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:t.current}})))}isGroupDropdownOpen(e){let t=this.controller.getOpenItemMenu();return(t==null?void 0:t.type)==="geo-tool-dropdown"&&t.group===e.group}};function hY(r,e){switch(e){case"selection":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-selection");case"point":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-point");case"line":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-line");case"circle":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-circle");case"angle":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-angle");case"polygon":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-polygon");case"transformation":return r.s("graphing-calculator-label-geometry-tools-dropdown-menu-transformation")}}var Cs=__dcg_shared_module_exports__['e'](Z());var Pr=__dcg_shared_module_exports__['e'](Z());var Hl=__dcg_shared_module_exports__['e'](Z()),TI=__dcg_shared_module_exports__['e'](EY());var B3=/\{\$([a-zA-Z0-9\-]+([a-zA-Z0-9\-]+_)*[a-zA-Z0-9\-]+)\}/;function DY(r,e){let t=0,o=0,i={},n={},a=s(r);if(!/^<0>/.test(a)||!/<\/0>$/.test(a))throw new Error("Expected template string to start and end with <0> and </0>, but found "+JSON.stringify(a));return a.slice(3,-4).trim();function s(c){if(e.isConst(c))return vue(e.getConstValue(c));if(e.isNamedBinding(c)){let d=l(i,e.getBindingName(c)),p=`{$${d}}`;if(!B3.test(p))throw new Error(`Invalid <Localize> variable: ${p}.`);return e.addBinding&&e.addBinding(d,c),i[d]=!0,p}else if(c!==r&&e.isView(c)){let d=l(n,e.getViewName(c));if(!/[a-zA-Z0-9\-_]/.test(d))throw new Error(`Invalid <Localize> subview identifier: ${d}.`);return e.addView&&e.addView(d,c),n[d]=!0,`<${d}/>`}else if(e.isBinding(c)){let d=l(i,`v${t++}`),p=`{$${d}}`;return e.addBinding&&e.addBinding(d,c),i[d]=!0,p}else{let d=`${o++}`;e.addElement&&e.addElement(d,c);let p=[];return e.forEachChild(c,u=>{p.push(s(u))}),n[d]=!0,p.length>0?`<${d}>${p.join("")}</${d}>`:`<${d}/>`}}function l(c,d){let p=0,u=d;for(;c[u];)u=`${d}-${++p}`;return u}}var wue=!0;function vue(r){return wue?r:r.replace(/\{|\}/g,e=>`{"${e}"}`).replace(/(^|[\s\n]+)(\[|\]|\.)/g,(e,t,o)=>`${t}{"${o}"}`)}function Cue(r){return r.__DCGViewLocalizeBindingName}function Sue(r){return typeof r=="function"&&r.__DCGViewLocalizeViewName}var vr=class extends Hl.Class{init(){this.viewMap={},this.elementMap={},this.bindingMap={},this.i18n=this.props.i18n(),this.templateString=this.serializeToTemplateString(Hl.createElement("div",{style:Hl.const("display: contents;")},this.props.children))}template(){return Hl.createElement(Hl.Components.If,{predicate:()=>this.shouldShow()},()=>Hl.createElement(Hl.Components.Switch,{key:()=>U3(this.translatedString())},e=>this.renderDeserializedTemplateNode(this.parseAndValidate(e))))}shouldShow(){let e=this.props.options&&this.props.options();return e&&e.hideUntranslatedView&&this.i18n.hasTranslation?this.i18n.hasTranslation(this.props.key()):!0}translatedString(){let e={};for(let t in this.bindingMap)e[t]=Bs(`{$${t}}`);return this.i18n.s(this.props.key(),e)}static variable(e,t){let o=()=>t();return o.__DCGViewLocalizeBindingName=e,o}static subview(e,t){let o=()=>t();return o.__DCGViewLocalizeViewName=e,o}parseAndValidate(e){let t=(0,TI.parse)(e),o={},i={};n(t);for(let a in this.elementMap)if(!i[a])return(0,TI.parse)(U3(this.templateString));for(let a in this.bindingMap)if(!o[a])return(0,TI.parse)(U3(this.templateString));return t;function n(a){if(Array.isArray(a)){for(let s of a)n(s);return}a.name==="token"?o[a.attrs.id]=!0:a.type!=="text"&&(i[a.name]=!0,n(a.children))}}renderDeserializedTemplateNode(e){if(Array.isArray(e))return e.map(t=>this.renderDeserializedTemplateNode(t));if(e.type==="text")return Hl.const(e.content||"");if(e.name==="token"){let t=this.bindingMap[e.attrs.id];return t||(()=>"")}else if(this.elementMap[e.name]){let t=this.elementMap[e.name],o=e.children.map(i=>this.renderDeserializedTemplateNode(i));return _Y(t.type,t.attributes,o)}else return this.viewMap[e.name]?this.viewMap[e.name]():_Y("span",{},[])}serializeToTemplateString(e){return DY(e,{isView:Sue,isConst:kY,isBinding:t=>typeof t=="function",isNamedBinding:Cue,getConstValue:t=>t(),getBindingName:t=>t.__DCGViewLocalizeBindingName,getViewName:t=>t.__DCGViewLocalizeViewName,addBinding:(t,o)=>{this.bindingMap[t]=o},addElement:(t,o)=>{this.elementMap[t]={type:o.tagName,attributes:o.attributes}},addView:(t,o)=>{if(this.viewMap[t])throw new Error(`Unexpected duplicate view ${t}.`);this.viewMap[t]=o},forEachChild:(t,o)=>{for(let i of t.children){if(!kY(i)&&typeof i!="function"&&i instanceof Hl.View)throw new Error("Bare DCGViews are not allowed inside <Localize>. Use Localize.subview().");o(i)}}})}};function kY(r){return typeof r=="function"&&r.isDCGViewConst}function _Y(r,e,t){return Hl.createElement(r,e,t)}function U3(r){return`<0>${r}</0>`.replace(new RegExp(B3.source,"g"),(t,o)=>`<token id="${o}"/>`)}var{Switch:Eue,SwitchUnion:Due}=Pr.Components,Vu=class extends Pr.Class{template(){return Due("type",()=>this.getLatexOrToken())({identifier:e=>Pr.createElement(_u,{identifier:()=>e().identifier,insideMQ:()=>!1,controller:()=>this.props.controller(),insideGroup:()=>!1,putInTabOrder:()=>!1}),latex:e=>Pr.createElement(Et,{config:()=>this.props.controller().getMathquillConfig({}),latex:()=>e().latex,tokenController:this.props.controller})})}getLatexOrToken(){let e=this.props.parent();switch(e.type){case"arbitrary-expression":return{type:"latex",latex:e.latex};case"list-access":case"polygon-edge":case"simple":return{type:"identifier",identifier:__dcg_shared_module_exports__['fd'](e)};default:return{type:"latex",latex:"unknown"}}}},GI=class extends Pr.Class{init(){this.controller=this.props.controller()}template(){return Pr.createElement(Eue,{key:this.bindFn(this.getTransformationType)},e=>{switch(e){case"translate":return this.getParents().length===1?Pr.createElement("div",null,Pr.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-geometry-translation-by-vector")},Pr.const("Translate by"),Pr.const(" "),vr.subview("parent1",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[0]})))):Pr.createElement("div",null,Pr.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-geometry-translation-by-two-points")},Pr.const("Translate from"),Pr.const(" "),vr.subview("parent1",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[0]})),Pr.const(" "),Pr.const("to"),Pr.const(" "),vr.subview("parent2",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[1]}))));case"reflect":return Pr.createElement("div",null,Pr.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-geometry-reflection-over-point")},Pr.const("Reflect over"),Pr.const(" "),vr.subview("parent1",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[0]}))));case"dilate":return Pr.createElement("div",null,Pr.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-geometry-dilation-by-point")},Pr.const("Dilate at"),Pr.const(" "),vr.subview("parent1",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[0]})),Pr.const(" by "),vr.subview("parent2",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[1]}))));case"rotate":return Pr.createElement("div",null,Pr.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-geometry-rotation-around-point-by-angle")},Pr.const("Rotate around"),Pr.const(" "),vr.subview("parent1",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>this.getParents()[0]})),Pr.const(" by "),vr.subview("parent2",()=>Pr.createElement(Vu,{controller:this.props.controller,parent:()=>kue(this.getParents()[1],this.controller.getGraphSettings().degreeMode)}))));case void 0:return Pr.createElement("span",null)}})}getParents(){let e=this.getGeometry();return!e||!e.call?[]:e&&e.call?e.call.parents:[]}getGeometry(){var e;return(e=this.props.model())==null?void 0:e.formula.geometry}getTransformationType(){var o;let e=this.getGeometry(),t=(o=e==null?void 0:e.call)==null?void 0:o.symbol;switch(t){case"translate":case"dilate":case"reflect":case"rotate":return t}}};function kue(r,e){let t=e?"\xB0":"";if(r.type==="arbitrary-expression")return{...r,latex:r.latex+t};if(r.type==="simple"){let o=__dcg_shared_module_exports__['$b'](r.identifier);if(!/^\\token\{(\d+)\}$/.test(o))return{type:"arbitrary-expression",latex:o+t}}return r}var{Each:_ue,If:Tue}=Cs.Components,II=class extends Cs.Class{init(){this.controller=this.props.controller()}template(){return Cs.createElement(lv,{controller:this.props.controller,ariaLabel:()=>this.controller.s("graphing-calculator-narration-geometry-construct-menu"),group:()=>"construct-from-selection",items:()=>{var o,i;let e=[this.getTransformations()],t=(i=(o=this.props.constructFromSelectionInfo())==null?void 0:o.relevantTools)!=null?i:[];return t.length>0&&e.push(t),e},onChooseTool:e=>this.chooseTool(e)},Cs.createElement(Tue,{predicate:()=>this.props.existingTransformations().length>0},()=>Cs.createElement("div",{class:Cs.const("dcg-options-menu-section dcg-existing-transformations-container")},Cs.createElement("div",{class:Cs.const("dcg-transformation-header")},()=>this.controller.s("graphing-calculator-label-recent-transformations")),Cs.createElement("div",{role:Cs.const("menu"),"aria-label":()=>this.controller.s("graphing-calculator-label-recent-transformations"),onKeyDown:this.bindFn(this.handleKeyPress)},_ue(()=>this.props.existingTransformations(),{item:(e,t)=>Cs.createElement("div",{class:Cs.const("dcg-existing-transformation"),role:Cs.const("menuitemradio"),tabIndex:()=>t===this.props.existingTransformations()[0].id?0:-1,onTap:()=>this.applyTransformation(e),onPointerOut:o=>this.onPointerOut(o,e),onPointerOver:o=>this.onPointerOver(o,e),willUnmount:()=>this.onImplicitMouseOut(e),manageFocus:()=>ct({controller:this.controller,location:{type:"geo-construct-menu-existing-transformations",transformationId:e.id}})},Cs.createElement(GI,{controller:this.props.controller,model:()=>e})),key:e=>e.id})))))}generateToolOutput(e){let t=this.props.constructFromSelectionInfo();if(!t)return;let{selected:o}=t;return this.controller.getGeoModel().generatePureToolOutput(e,o)}chooseTool(e){var o,i;let t=e.tool;if(!__dcg_shared_module_exports__['gd'](t)){let n=this.generateToolOutput(t);if(n!=null&&n.canCommit)this.controller.dispatch({type:"close-item-settings-menu"}),this.controller.getGeoModel().resetToolMode(),this.controller.dispatch({type:"commit-geo-objects",shiftKey:!1,committed:n.outputs,clearToolAndSelection:!0,toolIdToLatex:{}});else{let a=this.controller.getSelectedItem();this.controller.dispatch({type:"select-geo-tool",tool:t,forceSingleUse:!0,focusGraphPaper:!!e.fromKeyboard});let s=this.controller.getGeoModel(),l=(i=(o=s.getTool(t)).getSpec)==null?void 0:i.call(o);if(!l||(a==null?void 0:a.type)!=="expression")return;s.tentativelyMatchToolInput(l,WC(a)),s.attemptLockToolInputIn(l)}return}this.controller.dispatch({type:"select-geo-tool",tool:t,focusGraphPaper:!!e.fromKeyboard})}getTransformations(){return nv.filter(e=>this.controller.isGeoToolVisible(e))}handleKeyPress(e){let t=Be(e);if(t!=="Up"&&t!=="Down"&&t!=="Esc")return;let o=this.props.existingTransformations(),i=this.controller.getFocusLocation();if(t==="Esc"){if((i==null?void 0:i.type)==="geo-construct-menu-existing-transformations")return this.controller.dispatch({type:"set-focus-location",location:{type:"multi-select-construct-icon"}});this.controller.dispatch({type:"close-item-settings-menu"}),e.stopPropagation(),e.preventDefault();return}if((i==null?void 0:i.type)!=="geo-construct-menu-existing-transformations")return;let n=t==="Down"?1:-1,s=(o.findIndex(l=>l.id===i.transformationId)+n)%o.length;s<0&&(s=o.length+s),s>=0&&(this.controller.dispatch({type:"set-focus-location",location:{type:"geo-construct-menu-existing-transformations",transformationId:o[s].id}}),e.preventDefault(),e.stopPropagation())}onPointerOver(e,t){var i;if(e.pointerType!=="mouse")return;let o=(i=xn(t))==null?void 0:i.identifier;o&&(this.currentlyActiveTokenIdentifier=o,this.controller.dispatch({type:"set-active-token",identifier:this.currentlyActiveTokenIdentifier,style:"hovered"}))}onPointerOut(e,t){var i;if(e.pointerType!=="mouse")return;let o=(i=xn(t))==null?void 0:i.identifier;o&&this.currentlyActiveTokenIdentifier&&this.currentlyActiveTokenIdentifier===o&&(this.controller.dispatch({type:"unset-active-token",identifier:this.currentlyActiveTokenIdentifier,style:"hovered"}),this.currentlyActiveTokenIdentifier=void 0)}onImplicitMouseOut(e){var o;let t=(o=xn(e))==null?void 0:o.identifier;t&&this.currentlyActiveTokenIdentifier&&this.currentlyActiveTokenIdentifier===t&&this.controller.runAfterDispatch(()=>{let i=this.currentlyActiveTokenIdentifier;i&&(this.currentlyActiveTokenIdentifier=void 0,this.controller.dispatch({type:"unset-active-token",identifier:i,style:"hovered"}))})}applyTransformation(e){var o;if(!((o=e.formula.geometry)!=null&&o.identifier))return;let t=__dcg_shared_module_exports__['$b'](e.formula.geometry.identifier);this.controller.dispatch({type:"apply-transformation-to-selected",assignmentLatex:t})}};var Pa=__dcg_shared_module_exports__['e'](Z());var Kl=__dcg_shared_module_exports__['e'](Z());var{For:Gue,If:Iue}=Kl.Components,Po=class extends Kl.Class{constructor(){super(...arguments),this.btnViews={}}init(){this.config=this.props.staticConfig()}template(){return Kl.createElement("div",{class:Kl.const("dcg-segmented-control-container"),role:()=>{var e,t;return(t=(e=this.props).treatAsMultiSelect)!=null&&t.call(e)?"listbox":"radiogroup"},"aria-multiselectable":()=>{var e,t;return(t=(e=this.props).treatAsMultiSelect)!=null&&t.call(e)?!0:void 0},onKeyDown:this.bindFn(this.handleRadioKeydown),"aria-label":this.props.ariaGroupLabel},Kl.createElement(Gue,{each:()=>this.config,key:e=>e.key},(e,t)=>Kl.createElement("div",{class:()=>({"dcg-segmented-control-btn":!0,"dcg-selected":e.selected(),"dcg-theme-mini":this.getTheme()==="mini","dcg-theme-default":this.getTheme()==="default","dcg-disabled":this.isDisabled(),[e.class?e.class():""]:!!e.class}),role:()=>{var o,i;return(i=(o=this.props).treatAsMultiSelect)!=null&&i.call(o)?"option":"radio"},tabIndex:()=>this.getTabIndexForOption(e),"aria-label":()=>this.getAriaLabel(e),style:()=>({"min-width":this.props.minButtonWidth?this.props.minButtonWidth()+"px":void 0}),"aria-checked":()=>{var o,i;return(i=(o=this.props).treatAsMultiSelect)!=null&&i.call(o)?void 0:e.selected()},"aria-selected":()=>{var o,i;return(i=(o=this.props).treatAsMultiSelect)!=null&&i.call(o)?e.selected():void 0},onTap:o=>{this.isDisabled()||e.onSelect(o.device)},didMount:o=>this.btnViews[t]=o,manageFocus:()=>{if(e.focusHelperOptions)return ct(e.focusHelperOptions)}},Kl.createElement(ze,{tooltip:()=>{var o;return((o=e.tooltip)==null?void 0:o.call(e))||""},gravity:()=>{var o;return((o=e.tooltipGravity)==null?void 0:o.call(e))||"s"},disabled:()=>!(e.tooltip&&e.tooltip())},Kl.createElement("div",{class:Kl.const("dcg-segmented-control-interior")},()=>e.label?e.label():"",Kl.createElement(Iue,{predicate:()=>!!e.icon},()=>Kl.createElement("i",{class:()=>e.icon?e.icon():""})))))))}getAriaLabel(e){return e.ariaLabel?e.ariaLabel():e.label?e.label():e.tooltip?e.tooltip():""}isDisabled(){var e,t;return!!((t=(e=this.props).disabled)!=null&&t.call(e))}getTheme(){return this.props.theme?this.props.theme():"default"}handleRadioKeydown(e){var s,l,c;let t=Be(e);if(t!=="Up"&&t!=="Down"&&t!=="Left"&&t!=="Right"&&t!=="Home"&&t!=="End"||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;e.preventDefault(),e.stopPropagation();let o=__dcg_shared_module_exports__['B'](this.config,d=>this.btnViews[d.key]===document.activeElement),i=this.config.length,n=o;t==="Home"&&(n=0),t==="End"&&(n=this.config.length-1),(t==="Up"||t==="Left")&&(n=(o-1+i)%i),(t==="Down"||t==="Right")&&(n=(o+1)%i);let a=this.config[n];a&&((s=this.btnViews[a.key])==null||s.focus(),!((c=(l=this.props).treatAsMultiSelect)!=null&&c.call(l))&&a.onSelect("keyboard"))}getTabIndexForOption(e){if(this.isDisabled())return-1;let t=e.key===this.config[0].key,o=this.config.find(i=>i.selected());return e.key===(o==null?void 0:o.key)||t&&!o?0:-1}};var La=__dcg_shared_module_exports__['e'](Z());var id=__dcg_shared_module_exports__['e'](Z()),Gt=class extends id.Class{template(){return id.createElement("div",{role:id.const("checkbox"),tabIndex:()=>this.props.disabled&&this.props.disabled()?-1:0,"aria-label":()=>{var e,t;return(t=(e=this.props).ariaLabel)==null?void 0:t.call(e)},"aria-labelledby":()=>{var e,t;return(t=(e=this.props).labelledBy)==null?void 0:t.call(e)},"aria-describedby":()=>{var e,t;return(t=(e=this.props).describedBy)==null?void 0:t.call(e)},"aria-disabled":()=>this.props.disabled&&this.props.disabled()?!0:void 0,"aria-checked":()=>this.props.checked(),"aria-required":()=>this.props.required?this.props.required():void 0,manageFocus:()=>{var e,t;return(t=(e=this.props).manageFocus)==null?void 0:t.call(e)},class:()=>({"dcg-component-checkbox":!0,"dcg-checked":this.props.checked(),"dcg-disabled":this.props.disabled&&this.props.disabled(),"dcg-small":this.props.small&&this.props.small(),[this.props.class===void 0?"":this.props.class()]:this.props.class!==void 0}),style:()=>this.props.style?this.props.style():{},onTap:this.bindFn(this.onChange)},id.createElement("span",{class:id.const("dcg-checkbox")},id.createElement("i",{class:id.const("dcg-icon-check"),"aria-hidden":id.const("true")})),id.createElement("span",{class:id.const("dcg-checkbox-children")},this.props.children))}onChange(e){let t=e.target;t&&t.getAttribute("href")||this.props.disabled&&this.props.disabled()||this.props.onChange(!this.props.checked())}};var{Input:Mue,IfElse:q3,IfDefined:Aue,If:TY}=La.Components,Pb=class extends La.Class{template(){return this.controller=this.props.controller(),La.createElement("div",{class:()=>({"dcg-label-visible":this.getShowLabel(),"dcg-label-input-visible":!this.getIsDisabled(),"dcg-label-container":!0,"dcg-do-blur":!0}),tapboundary:La.const("true"),handleEvent:La.const("true")},q3(()=>{var e,t;return!!((t=(e=this.props).forceEnabled)!=null&&t.call(e))},{true:()=>La.createElement("span",null,()=>this.controller.s("graphing-calculator-button-label")+":"),false:()=>La.createElement(Gt,{onChange:this.bindFn(this.onCheckboxInput),checked:this.bindFn(this.getShowLabel)},()=>this.controller.s("graphing-calculator-button-label")+(this.getIsDisabled()?"":":"))}),q3(this.bindFn(this.hasEditableLabel),{true:()=>La.createElement("div",{class:La.const("dcg-editable-mode-toggle")},La.createElement(Po,{theme:this.const("mini"),staticConfig:this.bindFn(this.getEditableLabelOptions),ariaGroupLabel:()=>this.controller.s("graphing-calculator-narration-editable-label-mode")})),false:()=>q3(()=>{var e,t;return!!((t=(e=this.props).displayComputedValue)!=null&&t.call(e))},{false:()=>La.createElement(TY,{predicate:()=>{var e,t;return!((t=(e=this.props).suppressInput)!=null&&t.call(e))}},()=>La.createElement(TY,{predicate:()=>!this.getIsDisabled()},()=>{var e;return La.createElement(Mue,{class:()=>({"dcg-label-input":!0,"dcg-readonly":this.getIsReadonly(),"dcg-disabled-editable-input":this.hasEditableLabel()}),disabled:this.bindFn(this.getIsReadonly),"aria-label":()=>this.controller.s("graphing-calculator-narration-label-text"),manageFocus:(e=this.props.manageInputFocus)!=null?e:()=>{},didMount:t=>{var o,i;this.inputNode=t,(i=(o=this.props).selectInputOnMount)!=null&&i.call(o)&&t.select()},"aria-disabled":()=>this.getIsDisabled()||this.hasEditableLabel()||this.getIsReadonly(),value:this.bindFn(this.getLabel),onInput:this.bindFn(this.onLabelInput)})})),true:()=>Aue(()=>{var e,t;return(t=(e=this.props).displayComputedValue)==null?void 0:t.call(e)},e=>La.createElement("div",{class:La.const("dcg-computed-label-value")},La.createElement(Et,{latex:e,config:()=>this.controller.getMathquillConfig({})})))})}))}getEditableLabelOptions(){return[{key:"math",label:()=>this.controller.s("graphing-calculator-button-editable-math"),selected:()=>this.model().editableLabelMode==="MATH",onSelect:()=>this.setEditableLabelMode("MATH")},{key:"text",label:()=>this.controller.s("graphing-calculator-button-editable-text"),selected:()=>this.model().editableLabelMode==="TEXT",onSelect:()=>this.setEditableLabelMode("TEXT")}]}setEditableLabelMode(e){this.controller.dispatch({type:"set-item-editable-label-mode",id:this.id(),editableLabelMode:e})}getIsReadonly(){return this.controller.isItemReadonly(this.model().id)}model(){return this.props.model()}id(){return this.model().id}getLabel(){return this.model().label||""}hasEditableLabel(){return gw(this.model())}getShowLabel(){var e,t;return Vl(this.model())&&!((t=(e=this.props).displayComputedValue)!=null&&t.call(e))}getIsDisabled(){var e,t;return(t=(e=this.props).forceEnabled)!=null&&t.call(e)||document.activeElement===this.inputNode?!1:this.getLabel().length===0&&!this.getShowLabel()}onLabelInput(e){let t=e;this.controller.dispatch({type:"set-item-label",id:this.id(),label:t}),this.controller.dispatch({type:"set-item-showlabel",id:this.id(),showLabel:!!t})}onCheckboxInput(){this.controller.dispatch({type:"set-item-showlabel",id:this.id(),showLabel:!this.getShowLabel()})}};var{If:Vue,IfElse:Lue,SwitchUnion:Pue}=Pa.Components,MI=class extends Pa.Class{init(){this.controller=this.props.controller(),this.updateSingleItemState()}willUpdate(){this.updateSingleItemState()}updateSingleItemState(){var o;let e=this.getSelectionLabelInfo();if(e.type==="multiple"){this.singleItemState=void 0;return}if(((o=this.singleItemState)==null?void 0:o.itemId)===e.model.id)return;let t;Vl(e.model)?t=e.model.label===""?"measurement":"text":t="text",this.singleItemState={itemId:e.model.id,mode:t}}sectionValues(){return this.props.sectionValues()}getSelectionLabelInfo(){var o,i;let t=this.sectionValues().singleLabelableExpressionModel;switch((i=(o=t==null?void 0:t.formula)==null?void 0:o.geometry)==null?void 0:i.valueType){case __dcg_shared_module_exports__['da']:return{type:"single",objectType:"point",model:t};case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:return{type:"single",objectType:"angle",model:t};case __dcg_shared_module_exports__['qa']:return{type:"single",objectType:"segment",model:t};default:return{type:"multiple",objectType:"point"}}}allowPointCoordinates(){return!!this.controller.getGraphSettings().showXAxis}getLabelMode(){var t;return this.getSelectionLabelInfo().type==="multiple"?this.sectionValues().pointLabels:(t=this.singleItemState)==null?void 0:t.mode}getSegmentedLabels(){switch(this.getSelectionLabelInfo().objectType){case"point":return{text:"A,B,C",measurement:"(x,y)"};case"angle":return{text:"Text",measurement:"Measure"};case"segment":return{text:"Text",measurement:"Length"}}}getSegmentedControlConfig(){let e=()=>this.getSelectionLabelInfo().objectType==="point"&&this.allowPointCoordinates()?"dcg-segmented-control-btn--point":"";return[{key:"text",label:()=>this.getSegmentedLabels().text,selected:()=>this.getLabelMode()==="text",onSelect:t=>{this.lastSelectionDevice=t,this.onSelectTextLabel()},class:e},{key:"measurements",label:()=>this.getSegmentedLabels().measurement,selected:()=>this.getLabelMode()==="measurement",onSelect:t=>{this.lastSelectionDevice=t,this.onSelectMeasurementLabel()},class:e}]}onSelectTextLabel(){var t;let e=this.getSelectionLabelInfo();if(e.type==="multiple"){this.controller.dispatch({type:"set-label-state-for-selected-points",state:this.getLabelMode()==="text"?"none":"auto"});return}if(!this.singleItemState)throw new Error("Expected singleItemState to be defined");this.getLabelMode()==="text"?(this.singleItemState.mode="none",this.controller.dispatch({type:"set-item-showlabel",id:e.model.id,showLabel:!1})):(this.singleItemState.mode="text",((t=e.model.formula.geometry)==null?void 0:t.valueType)===__dcg_shared_module_exports__['da']?this.controller.dispatch({type:"set-label-state-for-selected-points",state:"auto"}):this.controller.dispatch({type:"set-item-showlabel",id:e.model.id,showLabel:!1}))}onSelectMeasurementLabel(){let e=this.getSelectionLabelInfo();if(e.type==="multiple"){this.controller.dispatch({type:"set-label-state-for-selected-points",state:this.getLabelMode()==="measurement"?"none":"measurement"});return}if(!this.singleItemState)throw new Error("Expected singleItemState to be defined");this.getLabelMode()==="measurement"?(this.singleItemState.mode="none",this.controller.dispatch({type:"set-item-showlabel",id:e.model.id,showLabel:!1})):(this.singleItemState.mode="measurement",this.controller.dispatch({type:"set-item-showlabel",id:e.model.id,showLabel:!0}),this.controller.dispatch({type:"set-item-label",id:e.model.id,label:""}))}template(){return Pa.createElement("div",{class:()=>({"dcg-generic-options-menu":!0,"dcg-options-menu":!0,"dcg-multi-select-label-menu":!0}),role:Pa.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-label-menu")},Pa.createElement("div",{class:Pa.const("dcg-options-menu-section")},Pue("type",()=>this.getSelectionLabelInfo())({multiple:()=>Pa.createElement("div",null,Lue(this.bindFn(this.allowPointCoordinates),{true:()=>Pa.createElement("div",{class:Pa.const("dcg-multi-select-menu_margin-top-section")},()=>this.controller.s("graphing-calculator-button-geometry-label-points"),Pa.const(":")),false:()=>Pa.createElement(Gt,{checked:()=>this.getLabelMode()==="text",onChange:()=>this.onSelectTextLabel()},()=>this.controller.s("graphing-calculator-button-geometry-label-points"))})),single:e=>Pa.createElement("div",{class:Pa.const("dcg-multi-select-menu_margin-top-section")},Pa.createElement(Pb,{controller:this.props.controller,model:()=>e().model,forceEnabled:this.const(!0),displayComputedValue:()=>{if(this.getLabelMode()!=="measurement")return;let t=this.controller.getGrapher2d(),o=t.getGraphSketch(e().model.id);return o&&o.labels.length===1?tF(o.labels[0],t.getProjection()).text:""},selectInputOnMount:()=>this.lastSelectionDevice!=="keyboard",suppressInput:()=>this.getLabelMode()==="none",manageInputFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-label-menu-label-input"}}))}))}),Pa.createElement(Vue,{predicate:()=>this.getSelectionLabelInfo().objectType!=="point"||this.allowPointCoordinates()},()=>Pa.createElement(Po,{ariaGroupLabel:()=>this.controller.s("graphing-calculator-narration-geometry-label-options"),staticConfig:this.bindFn(this.getSegmentedControlConfig)}))))}};var Zo=__dcg_shared_module_exports__['e'](Z());var Zn=__dcg_shared_module_exports__['e'](Z());var{Input:Oue,If:z3}=Zn.Components,AI=class extends Zn.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.newFolderTitle=""}init(){this.cacheFolderList()}willUpdate(){this.cacheFolderList()}template(){return Zn.createElement(z3,{predicate:()=>this.getMovableItems().length>0},()=>Zn.createElement("div",{class:Zn.const("dcg-move-to-expression-list")},Zn.createElement("div",{class:Zn.const("dcg-move-to-expression-list-title"),role:()=>this.canMoveToExpressionList()?"button":void 0,tabIndex:()=>this.canMoveToExpressionList()?0:void 0,onTap:this.bindFn(this.moveToExpressionList)},Zn.createElement(z3,{predicate:()=>this.canMoveToExpressionList()},()=>Zn.createElement("i",{class:Zn.const("dcg-icon-insert"),"aria-hidden":Zn.const("true")})),Zn.createElement("span",null,this.bindFn(this.getMoveMessage))),Zn.createElement(z3,{predicate:()=>!this.canMoveToExpressionList()},()=>Zn.createElement("div",{class:Zn.const("dcg-move-to-expression-list-flex")},Zn.createElement(Oue,{"aria-label":this.bindFn(this.getMoveMessage),value:()=>this.newFolderTitle,onInput:e=>{this.newFolderTitle=e,this.update()},placeholder:()=>this.controller.s("graphing-calculator-label-geometry-move-to-folder-placeholder"),didMount:e=>{e.onkeydown=function(t){let o=Be(t);(o==="Backspace"||o==="Del")&&t.stopPropagation()}},onEnterPressed:this.bindFn(this.onEnterPressed)}),Zn.createElement("div",{class:()=>({"dcg-btn-purple":!0,"dcg-disabled":!this.newFolderTitle}),role:Zn.const("button"),tabIndex:()=>this.newFolderTitle?0:-1,onTap:this.bindFn(this.createNewFolder)},()=>this.controller.s("graphing-calculator-button-move-to-expression-list-action"))))))}getMovableItems(){return this.controller.getAllSelectedItems().filter(t=>!this.controller.isItemReadonly(t.id))}canMoveToExpressionList(){var n,a;let e=this.getMovableItems(),[t]=e;if(!(e.length===1&&t.type!=="folder"&&t.folderId===__dcg_shared_module_exports__['xb']))return!1;if(t.type!=="expression"||((a=(n=t.formula.geometry)==null?void 0:n.call)==null?void 0:a.symbol)!=="apply")return!0;let i=t.formula.geometry.call.parents[0];return i.type==="arbitrary-expression"?!0:this.controller.getItemsByIdentifier(__dcg_shared_module_exports__['fd'](i)).every(s=>s.folderId!==__dcg_shared_module_exports__['xb'])}getMoveMessage(){return`${this.controller.s("graphing-calculator-text-geometry-move-to-expression-list-message")}${this.canMoveToExpressionList()?"":":"}`}onEnterPressed(){let e=this.folderList.find(t=>t.title===this.newFolderTitle);e?this.chooseFolder(e.id):this.createNewFolder()}chooseFolder(e){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"folderId",value:e}})}createNewFolder(){this.newFolderTitle&&this.controller.dispatch({type:"update-all-selected-items",update:{prop:"folderId",value:this.newFolderTitle,createFolder:!0}})}cacheFolderList(){this.folderList=this.controller.getAllItemModels().filter(e=>e.type==="folder"&&!this.controller.isGeoFolder(e))}moveToExpressionList(){this.canMoveToExpressionList()&&this.controller.dispatch({type:"move-selected-item-to-expression-list"})}};var{If:$C}=Zo.Components,VI=class extends Zo.Class{constructor(){super(...arguments),this.controller=this.props.controller()}sectionValues(){return this.props.sectionValues()}template(){return Zo.createElement("div",{class:()=>({"dcg-generic-options-menu":!0,"dcg-options-menu":!0,"dcg-multi-select-options-menu":!0}),role:Zo.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-options-menu")},Zo.createElement("div",{class:Zo.const("dcg-options-menu-section")},Zo.createElement($C,{predicate:()=>this.hasSelectedAndEditableItems()},()=>Zo.createElement("div",{role:Zo.const("button"),handleEvent:Zo.const("true"),class:Zo.const("dcg-delete-btn dcg-btn-purple"),tabIndex:Zo.const("0"),onTap:this.bindFn(this.deleteSelected)},Zo.createElement("i",{class:Zo.const("dcg-icon-trashcan"),"aria-hidden":Zo.const("true")}),Zo.createElement("span",null,()=>this.getDeleteItemString()))),Zo.createElement($C,{predicate:()=>this.sectionValues().draggableFreePoint!==void 0},()=>Zo.createElement("div",{class:Zo.const("dcg-checkbox-section")},Zo.createElement(Gt,{checked:()=>!!this.sectionValues().draggableFreePoint,onChange:this.bindFn(this.onDraggableFreePointChanged)},()=>this.controller.s("graphing-calculator-button-draggable-points")))),Zo.createElement($C,{predicate:()=>this.sectionValues().graphInteractionDisabled!==void 0&&this.props.controller().shouldShowAuthorFeatures()},()=>Zo.createElement("div",{class:Zo.const("dcg-checkbox-section dcg-disable-graph-interactions")},Zo.createElement(Gt,{checked:()=>!!this.sectionValues().graphInteractionDisabled,onChange:()=>this.toggleGraphInteractionsDisabled()},()=>this.controller.s("graphing-calculator-label-disable-graph-interactions")))),Zo.createElement($C,{predicate:()=>this.sectionValues().arrowMode!==void 0},()=>Zo.createElement("div",null,()=>this.controller.s("graphing-calculator-text-geometry-arrow-mode",{mode:this.getArrowModeDisplayName()}))),Zo.createElement($C,{predicate:()=>this.controller.getGraphSettings().config.expressions},()=>Zo.createElement(AI,{controller:this.props.controller}))))}getSelectedAndEditableItems(){return this.controller.getAllSelectedItems().filter(t=>!this.controller.isItemReadonly(t.id))}hasSelectedAndEditableItems(){return this.getSelectedAndEditableItems().length>0}toggleGraphInteractionsDisabled(){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"disableGraphInteractions",value:!this.sectionValues().graphInteractionDisabled}})}onDraggableFreePointChanged(e){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"dragMode",value:e?"XY":"NONE"}})}getArrowModeDisplayName(){let e=this.sectionValues().arrowMode;if(!e)return"";switch(e){case"NONE":return this.controller.s("graphing-calculator-text-arrow-mode-none");case"DEFAULT":return this.controller.s("graphing-calculator-text-arrow-mode-default");case"POSITIVE":return this.controller.s("graphing-calculator-text-arrow-mode-positive");case"BOTH":return this.controller.s("graphing-calculator-text-arrow-mode-both")}}getSelectedCount(){return this.controller.getAllSelectedItems().length}getDeleteItemString(){let e=this.getSelectedCount(),t=this.getSelectedAndEditableItems().length;return e-t>0?this.controller.s("graphing-calculator-text-geometry-delete-selected-unlocked-objects",{count:__dcg_shared_module_exports__['kc'](t)}):this.controller.s("graphing-calculator-text-geometry-delete-selected-objects",{count:__dcg_shared_module_exports__['kc'](t)})}deleteSelected(){this.controller.dispatch({type:"delete-all-selected-items"})}};var Wl=__dcg_shared_module_exports__['e'](Z());var no=__dcg_shared_module_exports__['e'](Z());var jC=__dcg_shared_module_exports__['e'](Z());var cv=class extends jC.Class{template(){return jC.createElement(ze,{...this.props,customTooltipView:()=>jC.createElement(Et,{latex:this.props.tooltip,config:this.const({})}),theme:this.const("light"),noWrap:this.const(!0)},this.props.children)}};var{For:GY,If:LI}=no.Components,dv=class extends no.Class{init(){this.controller=this.props.controller()}template(){return no.createElement("div",{class:no.const("dcg-color-picker-container"),role:no.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-narration-color-picker-label"),onKeyDown:this.bindFn(this.handleKeydown)},no.createElement("div",{class:no.const("dcg-color-picker-menu dcg-do-not-blur"),role:no.const("listbox"),"aria-label":()=>this.controller.s("graphing-calculator-narration-color-picker-standard-colors-label")},no.createElement(GY,{each:()=>this.getColorValues()},e=>no.createElement("div",{class:no.const("dcg-color-tile"),handleEvent:no.const("true"),role:no.const("option"),"aria-label":()=>gu(this.controller,e),tabIndex:()=>this.isSelected(e)||this.isFirstAndNoneSelected(e)?0:-1,"aria-selected":()=>this.isSelected(e),manageFocus:()=>ct({controller:this.controller,location:{type:"color-picker-option",category:"standard",color:e}}),onTap:()=>this.props.onColorSelected(e)},no.createElement(Xh,{color:()=>({type:"single-color",value:e}),invertSwatches:()=>this.controller.invertSwatches()}),no.createElement(LI,{predicate:()=>this.isSelected(e)},()=>no.createElement("i",{class:no.const("dcg-icon-check"),"aria-hidden":no.const("true")}))))),no.createElement(LI,{predicate:()=>this.getUniqueCustomColors().length>0},()=>no.createElement("div",{class:no.const("dcg-color-picker-menu dcg-do-not-blur"),role:no.const("listbox"),"aria-label":()=>this.controller.s("graphing-calculator-narration-color-picker-custom-colors-label")},no.createElement(GY,{each:this.bindFn(this.getUniqueCustomColors),key:e=>e.assignmentLatex},e=>no.createElement(cv,{tooltip:()=>e.assignmentLatex},no.createElement("div",{class:no.const("dcg-color-tile"),handleEvent:no.const("true"),role:no.const("option"),"aria-label":()=>{let t=this.getColorValue(e);return t.type==="single-color"?gu(this.controller,t.value):Gi(e.assignmentLatex)},tabIndex:()=>this.props.colorLatex()===e.assignmentLatex?0:-1,"aria-selected":()=>this.props.colorLatex()===e.assignmentLatex,manageFocus:()=>ct({controller:this.controller,location:{type:"color-picker-option",category:"custom",color:e.assignmentLatex}}),onTap:()=>this.props.onCustomColorSelected(e.assignmentLatex)},no.createElement(Xh,{color:()=>this.getColorValue(e),invertSwatches:()=>this.controller.invertSwatches()}),no.createElement(LI,{predicate:()=>this.props.colorLatex()===e.assignmentLatex},()=>no.createElement("i",{class:()=>this.getCheckmarkClass(e),"aria-hidden":no.const("true")})),no.createElement(LI,{predicate:()=>{var t,o;return((o=(t=this.props).customColorVisibility)==null?void 0:o.call(t))==="suppressed"}},()=>no.createElement("i",{class:no.const("dcg-icon-lock")}))))))))}hideColorFunctions(){var e,t,o;return(o=(t=(e=this.props).hideColorFunctions)==null?void 0:t.call(e))!=null?o:!1}isFirstAndNoneSelected(e){return e===this.getColorValues()[0]&&!this.props.selectedColor()}isSelected(e){let t=this.props.colorLatex();return t&&__dcg_shared_module_exports__['q'](this.getUniqueCustomColors(),"assignmentLatex").indexOf(t)>=0?!1:this.props.selectedColor()===e}getColorValues(){return __dcg_shared_module_exports__['H'](this.controller.getColors())}getUniqueCustomColors(){if(this.props.customColorVisibility&&this.props.customColorVisibility()==="hidden")return[];let e=[];e.push(...this.controller.getAllColorAssignments()),this.hideColorFunctions()||e.push(...this.controller.getAllColorFunctionAssignments());let t=__dcg_shared_module_exports__['v'](e,o=>o.assignmentLatex);return e.filter(o=>t[o.assignmentLatex]===1)}getColorValue(e){switch(e.id){case"shader":return{type:e.id};default:let t=this.controller.getColorById(e.id);return Array.isArray(t)?{type:"color-array",value:t}:/^data:image/.test(t)?{type:"image",value:t}:{type:"single-color",value:t}}}getCheckmarkClass(e){return Ox(this.getColorValue(e),!1)?`dcg-icon-check ${w6(this.getColorValue(e),!1)?"dcg-light-color":"dcg-mixed-color"}`:"dcg-icon-check"}handleKeydown(e){let t=this.controller.getFocusLocation();if((t==null?void 0:t.type)!=="color-picker-option"||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;let o=Be(e);if(o!=="Up"&&o!=="Down"&&o!=="Left"&&o!=="Right"&&o!=="Home"&&o!=="End")return;e.preventDefault(),e.stopPropagation();let i=this.getColorValues(),n=this.getUniqueCustomColors().map(d=>d.assignmentLatex),a=i.length,s=t.category==="standard"?i.indexOf(t.color):a+n.indexOf(t.color),l=s,c=i.length+n.length-1;o==="Left"&&(l=s-1),o==="Right"&&(l=s+1),o==="Home"&&(l=0),o==="End"&&(l=1/0),o==="Up"&&s-a>=0&&(l=s-a),o==="Down"&&s+a<=c&&(l=s+a),l=__dcg_shared_module_exports__['wc'](l,0,c),l!==s&&(l<a?(this.props.onColorSelected(i[l]),this.controller.dispatch({type:"set-focus-location",location:{type:"color-picker-option",category:"standard",color:i[l]}})):(this.props.onCustomColorSelected(n[l-a]),this.controller.dispatch({type:"set-focus-location",location:{type:"color-picker-option",category:"custom",color:n[l-a]}})))}};var{If:Rue}=Wl.Components,PI=class extends Wl.Class{init(){this.controller=this.props.controller()}sectionValues(){return this.props.sectionValues()}getSelectedColor(){let e=this.sectionValues().color;return!(e!=null&&e.isUnique)||!(e!=null&&e.selectedColor)?"":e.selectedColor}template(){return Wl.createElement("div",{class:()=>({"dcg-generic-options-menu":!0,"dcg-options-menu":!0,"dcg-multi-select-style-menu":!0}),role:Wl.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-style-menu")},Wl.createElement("div",{class:Wl.const("dcg-options-menu-section")},Wl.createElement("div",{class:Wl.const("dcg-multi-select-color-picker")},Wl.createElement(dv,{controller:this.props.controller,colorLatex:()=>{var e,t;return(t=(e=this.sectionValues().color)==null?void 0:e.colorLatex)!=null?t:""},selectedColor:this.bindFn(this.getSelectedColor),onColorSelected:this.bindFn(this.onColorSelected),onCustomColorSelected:this.bindFn(this.onCustomColorSelected),customColorVisibility:this.bindFn(this.getCustomColorVisibility)})),Wl.createElement(Rue,{predicate:()=>this.sectionValues().arrowMode!==void 0},()=>Wl.createElement("div",null,()=>this.controller.s("graphing-calculator-text-geometry-arrow-mode",{mode:this.getArrowModeDisplayName()})))))}getArrowModeDisplayName(){let e=this.sectionValues().arrowMode;if(!e)return"";switch(e){case"NONE":return this.controller.s("graphing-calculator-text-arrow-mode-none");case"DEFAULT":return this.controller.s("graphing-calculator-text-arrow-mode-default");case"POSITIVE":return this.controller.s("graphing-calculator-text-arrow-mode-positive");case"BOTH":return this.controller.s("graphing-calculator-text-arrow-mode-both")}}onColorSelected(e){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"color",value:e}})}getCustomColorVisibility(){return this.controller.getGraphSettings().hideCustomColors?this.controller.shouldShowAuthorFeatures()?"suppressed":"hidden":"visible"}onCustomColorSelected(e){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"colorLatex",value:e}})}};var{If:Lm,Switch:IY}=jt.Components,OI=class extends jt.Class{init(){this.controller=this.props.controller(),this.cacheSectionValues(),this.cacheExistingTransformations()}willUpdate(){this.cacheSectionValues(),this.cacheExistingTransformations(),this.cachedConstructFromSelectionInfo=this.computeConstructFromSelectionInfo()}template(){return jt.createElement("div",{class:jt.const("dcg-multi-select-header dcg-animate-in-after-initial-load"),onKeyDown:this.bindFn(this.handleKeydown),role:jt.const("toolbar"),"aria-label":this.bindFn(this.getSelectedCountString)},jt.createElement(IY,{key:this.bindFn(this.getSelectedItemsKey)},()=>jt.createElement(Lm,{predicate:()=>this.isButtonVisible("multi-select-show-hide-icon")},()=>jt.createElement("div",{class:()=>({"dcg-btn-outline":!0,"dcg-show-hide-btn":!0,"dcg-any-visible-objects":this.anyVisible()}),handleEvent:jt.const("true"),tabIndex:jt.const("0"),role:jt.const("button"),onTap:this.bindFn(this.toggleItemsVisible),manageFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-show-hide-icon"}}))},jt.createElement("div",{"aria-hidden":()=>!this.anyVisible()},()=>this.controller.s("graphing-calculator-text-geometry-hide-objects"),()=>` (${this.getSelectedCount()})`),jt.createElement("div",{"aria-hidden":this.bindFn(this.anyVisible)},()=>this.controller.s("graphing-calculator-text-geometry-show-objects"),()=>` (${this.getSelectedCount()})`)))),jt.createElement("div",{class:()=>({"dcg-style-button":!0,"dcg-toolbar-dropdown-button":!0,"dcg-menu-open":this.isStyleMenuOpen()}),handleEvent:jt.const("true"),tabIndex:jt.const("-1"),role:jt.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-narration-geometry-style-menu"),"aria-expanded":this.bindFn(this.isStyleMenuOpen),"dcg-open-menu-guid":()=>H3(),onTap:this.bindFn(this.toggleStyleMenu),manageFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-style-icon"}}))},jt.createElement(Xh,{color:()=>this.getSelectedColor(),invertSwatches:()=>this.controller.invertSwatches()}),jt.createElement(Lb,{menuName:()=>this.controller.s("graphing-calculator-narration-geometry-style-menu"),ariaExpanded:this.bindFn(this.isStyleMenuOpen),controller:this.const(this.controller),openDropDown:()=>{}})),jt.createElement(Lm,{predicate:()=>this.isButtonVisible("multi-select-label-icon")},()=>jt.createElement("div",{class:()=>({"dcg-label-button":!0,"dcg-toolbar-dropdown-button":!0,"dcg-menu-open":this.isLabelMenuOpen()}),handleEvent:jt.const("true"),tabIndex:jt.const("-1"),role:jt.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-narration-label-menu"),"aria-expanded":this.bindFn(this.isLabelMenuOpen),"dcg-open-menu-guid":()=>K3(),onTap:this.bindFn(this.toggleLabelMenu),manageFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-label-icon"}}))},jt.createElement("div",{class:jt.const("dcg-label-button-icon")},jt.const("A")),jt.createElement(Lb,{menuName:()=>this.controller.s("graphing-calculator-narration-label-menu"),ariaExpanded:this.bindFn(this.isLabelMenuOpen),controller:this.const(this.controller),openDropDown:()=>{}}))),jt.createElement(Lm,{predicate:()=>this.isButtonVisible("multi-select-construct-icon")},()=>jt.createElement("div",{class:()=>({"dcg-construct-button":!0,"dcg-toolbar-dropdown-button":!0,"dcg-menu-open":this.isConstructMenuOpen()}),handleEvent:jt.const("true"),tabIndex:jt.const("-1"),role:jt.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-narration-geometry-construct-menu"),"aria-expanded":this.bindFn(this.isConstructMenuOpen),"dcg-open-menu-guid":()=>YC(),onTap:this.bindFn(this.toggleConstructMenu),manageFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-construct-icon"}}))},jt.createElement(DI,null),jt.createElement(Lb,{menuName:()=>this.controller.s("graphing-calculator-narration-geometry-construct-menu"),ariaExpanded:this.bindFn(this.isConstructMenuOpen),controller:this.const(this.controller),openDropDown:()=>{}}))),jt.createElement(Lm,{predicate:()=>this.isButtonVisible("multi-select-more-icon")},()=>jt.createElement(ze,{tooltip:this.bindFn(this.getMoreString)},jt.createElement("div",{"aria-label":this.bindFn(this.getMoreString),role:jt.const("button"),tabIndex:jt.const("-1"),handleEvent:jt.const("true"),"aria-expanded":this.bindFn(this.isMoreMenuOpen),class:()=>({"dcg-multi-select-icon-button dcg-more-options dcg-toolbar-dropdown-button":!0,"dcg-menu-open":this.isMoreMenuOpen()}),"dcg-open-menu-guid":()=>Ob(),manageFocus:this.const(ct({controller:this.controller,location:{type:"multi-select-more-icon"}})),onTap:this.bindFn(this.toggleMoreMenu)},jt.createElement(av,null)))),jt.createElement(Lm,{predicate:this.bindFn(this.isLabelMenuOpen)},()=>jt.createElement(IY,{key:()=>Object.keys(this.controller.getSelectedExpressionIds()).join(":")},()=>jt.createElement(zl,{controller:this.props.controller,shouldHandleTabAndEscape:this.const(!0),menuType:this.const("multi-select-label"),menuButtonFocusLocation:this.const({type:"multi-select-label-icon"}),rootElSelector:this.const(".dcg-multi-select-header")},jt.createElement(MI,{controller:this.props.controller,sectionValues:()=>this.sectionValues})))),jt.createElement(Lm,{predicate:this.bindFn(this.isStyleMenuOpen)},()=>jt.createElement(zl,{controller:this.props.controller,shouldHandleTabAndEscape:this.const(!0),menuType:this.const("multi-select-style"),menuButtonFocusLocation:this.const({type:"multi-select-style-icon"}),rootElSelector:this.const(".dcg-multi-select-header")},jt.createElement(PI,{controller:this.props.controller,sectionValues:()=>this.sectionValues}))),jt.createElement(Lm,{predicate:this.bindFn(this.isConstructMenuOpen)},()=>jt.createElement(zl,{controller:this.props.controller,shouldHandleTabAndEscape:this.const(!0),menuType:this.const("multi-select-construct"),menuButtonFocusLocation:this.const({type:"multi-select-construct-icon"}),rootElSelector:this.const(".dcg-multi-select-header")},jt.createElement(II,{controller:this.props.controller,constructFromSelectionInfo:()=>this.cachedConstructFromSelectionInfo,existingTransformations:()=>this.cachedExistingTransformations}))),jt.createElement(Lm,{predicate:this.bindFn(this.isMoreMenuOpen)},()=>jt.createElement(zl,{controller:this.props.controller,shouldHandleTabAndEscape:this.const(!0),menuType:this.const("multi-select-more"),menuButtonFocusLocation:this.const({type:"multi-select-more-icon"}),rootElSelector:this.const(".dcg-multi-select-header")},jt.createElement(VI,{controller:this.props.controller,sectionValues:()=>this.sectionValues}))))}getFocusOrder(){return["multi-select-show-hide-icon","multi-select-style-icon","multi-select-label-icon","multi-select-construct-icon","multi-select-more-icon"].filter(t=>this.isButtonVisible(t)).map(t=>({type:t}))}isButtonVisible(e){switch(e){case"multi-select-show-hide-icon":return this.hasSelectedAndEditableItems();case"multi-select-style-icon":return!0;case"multi-select-label-icon":return this.sectionValues.pointLabels!==void 0||this.sectionValues.singleLabelableExpressionModel!==void 0;case"multi-select-construct-icon":return this.isSomeRelevantToolEnabled();case"multi-select-more-icon":return this.controller.shouldShowAuthorFeatures()||this.hasSelectedAndEditableItems()||this.sectionValues.draggableFreePoint!==void 0;default:return!1}}cacheSectionValues(){this.sectionValues=this.computeSectionValues()}computeSectionValues(){var n;let e={pointLabels:[],singleLabelableExpressionModel:[],draggableFreePoint:[],arrowMode:[],graphInteractionDisabled:[],color:[]},t=this.controller.getAllSelectedItems();for(let a of t){if(e.graphInteractionDisabled.push(yc(a)),a.type!=="expression")continue;e.color.push({selectedColor:om(a),colorLatex:a.colorLatex});let s=(n=a.formula.geometry)==null?void 0:n.valueType;switch(__dcg_shared_module_exports__['bb'](s)&&(s=__dcg_shared_module_exports__['cb'](s)),s){case __dcg_shared_module_exports__['da']:a.showLabel?e.pointLabels.push(a.label?"text":"measurement"):e.pointLabels.push("none"),e.singleLabelableExpressionModel.push(a),a.formula.move_strategy&&e.draggableFreePoint.push(a.dragMode!=="NONE");break;case __dcg_shared_module_exports__['oa']:break;case __dcg_shared_module_exports__['ua']:e.arrowMode.push(a.arrowMode);break;case __dcg_shared_module_exports__['sa']:break;case __dcg_shared_module_exports__['wa']:break;case __dcg_shared_module_exports__['ya']:break;case __dcg_shared_module_exports__['Ga']:break;case __dcg_shared_module_exports__['qa']:e.singleLabelableExpressionModel.push(a),e.arrowMode.push(a.arrowMode);break;case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:e.singleLabelableExpressionModel.push(a);break;case __dcg_shared_module_exports__['Ea']:break;default:}}let o={},i=t.length;for(let a in e){let s=a;switch(s){case"singleLabelableExpressionModel":{let c=e[s];i===1&&c.length===1&&(o[s]=c[0])}break;case"pointLabels":{let c=e[s];if(c.length>0&&i>1){let d=__dcg_shared_module_exports__['z'](c);d.length===1?o[s]=d[0]:o[s]="none"}}break;case"draggableFreePoint":{let c=e[s];c.length>0&&(o[s]=__dcg_shared_module_exports__['o'](c))}break;case"arrowMode":break;case"graphInteractionDisabled":{o[s]=e[s].every(c=>c);break}case"color":{let c=e[s].map(p=>JSON.stringify(p)),d=new Set(c).size===1;o[s]={...e[s][0],isUnique:d};break}default:return s}}return o}cacheExistingTransformations(){this.cachedExistingTransformations=this.computeExistingTransformations()}computeConstructFromSelectionInfo(){let e=this.controller.getSelectedItem();if((e==null?void 0:e.type)==="expression"){let t=e.formula.typed_constant_value;if(!t||__dcg_shared_module_exports__['fb'](t.valueType,__dcg_shared_module_exports__['da']))return;let o=this.controller.getAllAvailableGeoTools(),i=[];for(let n of o){let a=this.controller.getGeoModel().getTool(n);a instanceof yo&&a.getMatchingWorkflow([t])&&i.push(n)}return{type:"single-selection",selected:[{referenceLatex:WC(e),typedValue:t}],relevantTools:i}}}computeExistingTransformations(){var t,o;let e=[];for(let i of this.controller.getAllItemModels()){if(i.type!=="expression"||!this.controller.isItemInGeoFolder(i.id))continue;let n=(t=i.formula.geometry)==null?void 0:t.call;if(!n||!__dcg_shared_module_exports__['gd'](n.symbol)||!n.parents.every((s,l)=>s.type!=="arbitrary-expression"||(n.symbol==="rotate"||n.symbol==="dilate")&&l===1))continue;let a=(o=i.formula.typed_constant_value)==null?void 0:o.valueType;a!==void 0&&__dcg_shared_module_exports__['fb'](a,__dcg_shared_module_exports__['Ea'])&&e.push(i)}return e.reverse()}handleKeydown(e){let t=Be(e);if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||t!=="Left"&&t!=="Right"&&t!=="Home"&&t!=="End")return;let o=this.controller.getFocusLocation();if(!o)return;let i=__dcg_shared_module_exports__['B'](this.getFocusOrder(),o);if(i===-1)return;e.preventDefault(),e.stopPropagation();let n=i;t==="Left"?n=Math.max(0,i-1):t==="Right"?n=Math.min(this.getFocusOrder().length-1,i+1):t==="Home"?n=0:t==="End"&&(n=this.getFocusOrder().length-1),n!==i&&(this.controller.dispatch({type:"close-item-settings-menu"}),this.controller.dispatch({type:"set-focus-location",location:this.getFocusOrder()[n]}))}getSelectedCountString(){return this.controller.getGrapherDimensions().width<450?"":this.controller.s("graphing-calculator-text-geometry-selected-objects",{count:__dcg_shared_module_exports__['kc'](this.getSelectedCount())})}getSelectedAndEditableItems(){return this.controller.getAllSelectedItems().filter(t=>!this.controller.isItemReadonly(t.id))}hasSelectedAndEditableItems(){return this.getSelectedAndEditableItems().length>0}isSomeRelevantToolEnabled(){var t,o;return[...(o=(t=this.cachedConstructFromSelectionInfo)==null?void 0:t.relevantTools)!=null?o:[],...nv].some(i=>this.controller.isGeoToolVisible(i))}getMoreString(){return this.controller.s("graphing-calculator-text-geometry-multi-select-more-dropdown")}getSelectedItemsKey(){let e=this.controller.getAllSelectedItems();return __dcg_shared_module_exports__['q'](e,"id").join("-")}toggleItemsVisible(){this.anyVisible()?this.hideSelected():this.showSelected()}anyVisible(){let e=this.controller.getAllSelectedItems();return __dcg_shared_module_exports__['o'](e,t=>!ma(t))}isFolderMenuOpen(){return this.controller.isItemSettingsMenuOpen(Fue())}isMoreMenuOpen(){return this.controller.isItemSettingsMenuOpen(Ob())}isConstructMenuOpen(){return this.controller.isItemSettingsMenuOpen(YC())}isStyleMenuOpen(){return this.controller.isItemSettingsMenuOpen(H3())}isLabelMenuOpen(){return this.controller.isItemSettingsMenuOpen(K3())}toggleMoreMenu(){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"multi-select-more",guid:Ob(),focusFirstOption:!0}})}toggleConstructMenu(){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"multi-select-construct",guid:YC(),focusFirstOption:!0}})}toggleStyleMenu(){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"multi-select-style",guid:H3(),focusFirstOption:!0}})}toggleLabelMenu(){var t;let e=this.sectionValues.singleLabelableExpressionModel;!this.isLabelMenuOpen()&&e&&!Vl(e)&&((t=e.formula.geometry)==null?void 0:t.valueType)===__dcg_shared_module_exports__['da']&&this.controller.dispatch({type:"set-label-state-for-selected-points",state:"auto"}),this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"multi-select-label",guid:K3(),focusFirstOption:!0}}),this.isLabelMenuOpen()&&e&&e.label!==""&&this.controller.dispatch({type:"set-focus-location",location:{type:"multi-select-label-menu-label-input"}})}getSelectedCount(){return this.controller.getAllSelectedItems().length}hideSelected(){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"visible",value:!1}})}showSelected(){this.controller.dispatch({type:"update-all-selected-items",update:{prop:"visible",value:!0}})}getSelectedColor(){var o;let e=this.sectionValues.color,t=e&&((o=this.controller.getAllColorAssignments().find(i=>i.assignmentLatex===e.colorLatex))==null?void 0:o.id);if(t){let i=this.controller.getColorById(t);return Array.isArray(i)?{type:"color-array",value:i}:{type:"single-color",value:i}}else if(e!=null&&e.selectedColor)return{type:"single-color",value:e.selectedColor};return{type:"single-color",value:this.controller.getColors().GRAY}}};function Fue(){return"**multi-select-folder**"}function Ob(){return"**multi-select-more**"}function YC(){return"**multi-select-construct**"}function H3(){return"**multi-select-style**"}function K3(){return"**multi-select-label**"}$t();$t();function Jr(){document.activeElement&&Gh(document.activeElement)&&re(document.activeElement).trigger("blur")}function pv(r){let e=[[r.x0,r.y0],[r.x1,r.y1],[r.x2,r.y2]],[t,o]=__dcg_shared_module_exports__['zc'](e),i=__dcg_shared_module_exports__['uc'](r.x0-t,r.y0-o);return{x:t,y:o,radius:i}}function RI(r){let e=[[r.x0,r.y0],[r.x1,r.y1],[r.x2,r.y2]],[t,o]=__dcg_shared_module_exports__['zc'](e);return{startAngle:Math.atan2(r.y0-o,r.x0-t),deltaAngle:__dcg_shared_module_exports__['Ac'](e)}}var Nue=Math.hypot&&Math.hypot(1/0,NaN)===1/0;function MY(r){return r===1/0||r===-1/0}var Pm=Nue?Math.hypot:function(r,e){if(MY(r)||MY(e))return 1/0;if(isNaN(r)||isNaN(e))return NaN;if(r===0&&e===0)return 0;if(Math.abs(r)>Math.abs(e)){let t=e/r;return Math.abs(r)*Math.sqrt(t*t+1)}else{let t=r/e;return Math.abs(e)*Math.sqrt(t*t+1)}};var AY=(r,e)=>({x:r.x-e.x,y:r.y-e.y}),Bue=(r,e)=>r.x*e.x+r.y*e.y;function NI(r,e){return Pm(r.x-e.x,r.y-e.y)}function VY(r,e){let t={x:r.x1,y:r.y1},o={x:r.x2,y:r.y2},i=AY(e,t),n=AY(o,t),a=NI(t,o),s=a*a;return Bue(i,n)/s}function $3(r){return[{x1:r.left,y1:r.top,x2:r.left,y2:r.bottom,extendStart:!1,extendEnd:!1},{x1:r.left,y1:r.top,x2:r.right,y2:r.top,extendStart:!1,extendEnd:!1},{x1:r.right,y1:r.top,x2:r.right,y2:r.bottom,extendStart:!1,extendEnd:!1},{x1:r.left,y1:r.bottom,x2:r.right,y2:r.bottom,extendStart:!1,extendEnd:!1}]}function Uue(r){let{angle:e,width:t,height:o,center:i}=r,n=i.x,a=i.y,s=Math.cos(-e),l=Math.sin(-e),c=t/2,d=o/2,p={x:n+s*-c-l*-d,y:a+l*-c+s*-d},u={x:n+s*c-l*-d,y:a+l*c+s*-d},h={x:n+s*c-l*d,y:a+l*c+s*d},m={x:n+s*-c-l*d,y:a+l*-c+s*d};return[{x1:p.x,y1:p.y,x2:u.x,y2:u.y,extendStart:!1,extendEnd:!1},{x1:u.x,y1:u.y,x2:h.x,y2:h.y,extendStart:!1,extendEnd:!1},{x1:h.x,y1:h.y,x2:m.x,y2:m.y,extendStart:!1,extendEnd:!1},{x1:m.x,y1:m.y,x2:p.x,y2:p.y,extendStart:!1,extendEnd:!1}]}function que(r,e){let t=$3(r);return!!(BI(e,t[0])||BI(e,t[1])||BI(e,t[2])||BI(e,t[3]))}function zue(r,e){let t=$3(r);return!!(Lu(e,t[0],!1)||Lu(e,t[1],!1)||Lu(e,t[2],!1)||Lu(e,t[3],!1)||Lu(e,t[0],!0)||Lu(e,t[1],!0)||Lu(e,t[2],!0)||Lu(e,t[3],!0))}function Hue(r,e){let t=$3(r);return!!(Om(e,t[0],!1)||Om(e,t[1],!1)||Om(e,t[2],!1)||Om(e,t[3],!1)||Om(e,t[0],!0)||Om(e,t[1],!0)||Om(e,t[2],!0)||Om(e,t[3],!0))}function Kue(r,e){return r.left<=e.left&&r.right>=e.right&&r.top<=e.top&&r.bottom>=e.bottom}function Wue(r,e){return r.left<=e.x&&e.x<=r.right&&r.top<=e.y&&e.y<=r.bottom}function UI(r,e){if(!e.extendStart){let t=r.left<=e.x1&&e.x1<=r.right,o=r.top<=e.y1&&e.y1<=r.bottom;if(t&&o)return!0}return que(r,e)}function NY(r,e){let t={x:e.x0,y:e.y0};return!!(Wue(r,t)||Hue(r,e))}function BY(r,e){let t={left:e.x-e.radius,right:e.x+e.radius,top:e.y-e.radius,bottom:e.y+e.radius};return!!(Kue(r,t)||zue(r,e))}function $ue(r,e){let t=r.x-e.center.x,o=r.y-e.center.y,i=Math.atan2(o,t),n=Pm(t,o),a={x:n*Math.cos(i+e.angle),y:n*Math.sin(i+e.angle)};return Math.abs(a.x)<=e.width/2&&Math.abs(a.y)<=e.height/2}function UY(r,e){if(e.length<4)return!1;let t={x1:NaN,y1:NaN,x2:e[0],y2:e[1],extendStart:!1,extendEnd:!1};for(let o=2;o<e.length;o+=2)if(t.x1=t.x2,t.y1=t.y2,t.x2=e[o],t.y2=e[o+1],UI(r,t))return!0;return!1}function qY(r,e){let t=Uue(e);for(let o of t)if(UI(r,o))return!0;return!!$ue({x:r.left,y:r.top},e)}function jue(r,e,t){let o=e.x1-r.x,i=e.x2-r.x,n=e.y1-r.y,a=e.y2-r.y,s=r.radius,l=i-o,c=a-n,d=l*l+c*c,p=o*a-i*n,u=Math.sqrt(s*s*d-p*p);if(u<0)return;let h=c>=0?1:-1,m=t?-1*h:1*h;return{x:r.x+(p*c+m*h*l*u)/d,y:r.y+(-p*l+m*Math.abs(c)*u)/d}}function Yue(r,e){let t=r.y2-r.y1,o=r.x1-r.x2,i=e.y2-e.y1,n=e.x1-e.x2,a=t*r.x1+o*r.y1,s=i*e.x1+n*e.y1,l=t*n-i*o;if(l!==0)return{x:(n*a-o*s)/l,y:(t*s-i*a)/l}}function W3(r,e){let t=VY(e,r);return!(isNaN(t)||t<0&&!e.extendStart||t>1&&!e.extendEnd)}function Xue(r,e){let{x:t,y:o}=pv(e),{startAngle:i,deltaAngle:n}=RI(e),a=Math.atan2(r.y-o,r.x-t);return __dcg_shared_module_exports__['Jb'](a,i,n)}function Lu(r,e,t){let o=jue(r,e,t);if(o!=null&&W3(o,e))return o}function Om(r,e,t){let o=Lu(pv(r),e,!1)||PY,i=OY(t,RY(r,o),FY(e));if(i||(o=Lu(pv(r),e,!0)||PY,i=OY(t,RY(r,o),FY(e))),i&&Xue(o,r))return o}var PY={x:NaN,y:NaN};function BI(r,e){let t=Yue(r,e);if(t!=null&&W3(t,r)&&W3(t,e))return t}function OY(r,e,t){let o=e.x*t.y-e.y*t.x;return o>0&&r||o<0&&!r}function RY(r,e){let{x:t,y:o}=pv(r),{deltaAngle:i}=RI(r);return i>0?{x:o-e.y,y:e.x-t}:{x:e.y-o,y:t-e.x}}function FY(r){return{x:r.x2-r.x1,y:r.y2-r.y1}}var Rb=class{constructor(){this.displayName="graphing-calculator-text-geometry-tool-box-selection-display-name";this.toolType="selection";this.icon=[{type:"stroked-path",color:"#aaa",path:[35,35,51,35,51,51,35,51,35,35]},{type:"filled-polygon",color:"#000",path:[50,50,63.5,62,58.25,62.75,62,72.5,59.75,74,55.25,64.25,50.75,68,50,50]}]}getNumberInputLatex(){return""}clearTentativeOutputs(){}canNextInputBePoint(){return!1}getAllValidNextInputTypes(){return __dcg_shared_module_exports__['_a'].filter(e=>this.isValidNextInputType(e))}isValidNextInputType(e){return e!==__dcg_shared_module_exports__['Ea']}getNonPointInputType(){}getHint(){return""}getExpressionEditHint(e){return this.getHint()}onNumberInput(e){}onMove(e){return!0}onFocus(e){}tryCommitResults(){return{committed:void 0}}shouldUseJitEdges(){return!1}shouldHighlightRelevantObjects(){return!1}};function zY(r,e){return r===void 0?e===void 0:!(e===void 0||r.calcId!==e.calcId||r.listIndex!==e.listIndex||r.polygonEdge!==e.polygonEdge)}var qI=class{constructor(e){this.poiController=e,this.controller=e.controller,this.grapher=e.manager}getKeyboardAttention(){return this.objectUnderAttention}setKeyboardAttention(e){this.objectUnderAttention=e}findNonGeometryTabTargetsInGraph(){let e=this.controller.getGrapher3d();if(e)return e.getOrderedTabTargets();let t=this.grapher.imageLayer.getOrderedTabTargets(),o=this.grapher.clickableObjectsLayer.getOrderedTabTargets(),i=this.grapher.movablePointsLayer.getOrderedTabTargets();return t.concat(o).concat(i)}findTabbableObjectsForCurrentTool(e){let t=e==null?void 0:e.calcId,o={};if(this.controller.isGeometry()){let d=this.controller.getGeoModel();d.getAllChoosableDefsUnordered({mode:"tab"},d.getCurrentTool()).forEach(u=>{var m;o[u.calcId]||(o[u.calcId]=[]);let h={calcId:u.calcId,listIndex:u.listIndex,polygonEdge:(m=u.polygonEdgeInfo)==null?void 0:m.edgeNumber,geoDef:{...u}};o[u.calcId].push(h)})}let i=this.controller.getGeoModel().getCurrentTool();(!this.controller.isGeometry()||i.isValidNextInputType(__dcg_shared_module_exports__['aa']))&&this.findNonGeometryTabTargetsInGraph().filter(p=>!(i instanceof Rb&&this.controller.isClickableId(p.calcId))).forEach(p=>{var h;let u=(h=p.listIndex)!=null?h:0;if(!o[p.calcId])o[p.calcId]=[];else if(u&&!(!this.controller.isGeometry()||this.controller.canExpandListForItem(p.calcId)))return;o[p.calcId][u]?o[p.calcId][u].description=p.description:o[p.calcId].push(p)});let n=[],a=-1,s=!1,l=this.controller.getGrapher3d(),c=l?l.getTabOrder():this.grapher.getTabOrder();for(let d of c){d===t&&(a=n.length);let p=o[d];if(p){p.sort((u,h)=>u.listIndex!==h.listIndex?u.listIndex===void 0?-1:h.listIndex===void 0?1:u.listIndex-h.listIndex:u.polygonEdge!==h.polygonEdge?u.polygonEdge===void 0?-1:h.polygonEdge===void 0?1:u.polygonEdge-h.polygonEdge:0);for(let u of p)d===t&&(s||(a=n.length),zY(u,e)&&(s=!0)),n.push(u)}}return{targets:n,currentTabIndex:a,currentIsTabbable:s}}findNextObjFromKeyboard(e,t){let{targets:o,currentIsTabbable:i,currentTabIndex:n}=this.findTabbableObjectsForCurrentTool(t);if(!o.length)return;if(n===-1)return e==="next"?{wrapped:!1,target:o[0]}:{wrapped:!1,target:o[o.length-1]};let a=!1,s=n;return e==="prev"?s-=1:i&&(s+=1),s===-1?(a=!0,s=o.length-1):s>=o.length&&(a=!0,s=0),{wrapped:a,target:o[s]}}focusNextObjFromKeyboard(e={}){let t={allowWrapping:!0,selectNonClickables:!1,direction:"next"},{direction:o,allowWrapping:i,selectNonClickables:n}={...t,...e},a=this.findNextObjFromKeyboard(o,this.getKeyboardAttention());return!a||!i&&a.wrapped?(n&&this.controller.dispatch({type:"set-none-selected"}),!1):(a.wrapped&&this.controller.isVirtualMouseAllowed()?this.resetBackToGeoKeyboardPt():(n&&(this.controller.isClickableId(a.target.calcId)||!this.controller.isGeoItem(a.target.calcId)?this.controller.dispatch({type:"set-none-selected"}):this.controller.dispatch({type:"set-selected-id",id:a.target.calcId,state:"selected"})),this.updateKeyboardAttention(a.target,{describe:!0})),!0)}updateKeyboardAttention(e,t){let o=this.getKeyboardAttention();zY(e,o)||(this.setKeyboardAttention(e),this.controller.isGeometry()&&this.controller.getGeoModel().onFocus(e==null?void 0:e.geoDef),this.poiController.moveGeoKeyboardPtToFocusedItem(t),t.describe&&this.poiController.describeFocusedItem({includeDetails:!0}))}clearAttentionIfNotTabbable(){let{currentIsTabbable:e}=this.findTabbableObjectsForCurrentTool(this.getKeyboardAttention());e||this.updateKeyboardAttention(void 0,{describe:!1})}handleGrapherGainedFocus(){if(this.controller.getGeoModel().speakCurrentGeoToolHint(),this.controller.isVirtualMouseAllowed())this.resetBackToGeoKeyboardPt();else{let t=this.findTabbableObjectsForCurrentTool(void 0).targets;t.length?(this.setKeyboardAttention(void 0),this.updateKeyboardAttention(t[0],{describe:!0})):Te(this.controller.s("graphing-calculator-narration-geometry-no-tool-inputs"))}}resetBackToGeoKeyboardPt(){this.updateKeyboardAttention(void 0,{describe:!0}),this.poiController.geoKeyboardPt.x=this.poiController.geoKeyboardPt.lastArrowedX,this.poiController.geoKeyboardPt.y=this.poiController.geoKeyboardPt.lastArrowedY,this.poiController.handleGeoKeyboardPtMove()}};function zI(r){if(!r)return 0;if(r.type==="image"&&r.listIndex)return r.listIndex;if("poi"in r)return r.poi.pointIdxOnBranch;if("branchInfo"in r&&r.branchInfo.sketch){let e=r.branchInfo.branch,t=r.branchInfo.sketch.branches[e];return"listIndex"in t&&t.listIndex||0}return 0}var Zue=0,HI=class r{constructor(e,t){this.geoKeyboardPt={x:NaN,y:NaN,lastArrowedX:NaN,lastArrowedY:NaN};this.canceledGeoToolplayWhilePressed=!1;this.manager=e,this.controller=e.controller,this.keyboardAttentionManager=new qI(this),this.graphSettings=t,this.elt=this.manager.elt,this.id=Zue++,this.graphSettings.config.observe("disableMouseInteractions",()=>{this.graphSettings.config.disableMouseInteractions?this.removeHandlers():this.graphSettings.config.graphpaper&&this.addHandlers()}),this.speakThrottledDescription=__dcg_shared_module_exports__['E']((o,i,n)=>{var l,c;let a=this.controller.getItemModel(o);if(!a||a.type!=="expression"&&a.type!=="image")return;let s=(c=(l=a.formula)==null?void 0:l.computed_description)==null?void 0:c[i];s&&s!==n&&Te(rn(s))},100,{leading:!1,trailing:!0}),!(!this.graphSettings.config.graphpaper||this.graphSettings.config.disableMouseInteractions)&&this.addHandlers()}remove(){this.removeHandlers()}addHandlers(){this.addTouchEventHandlers(),this.addHoverEventHandler(),this.addKeyboardEventHandlers(),this.addManualUnhoverListener(),this.addGeoEventHandlers()}removeHandlers(){this.removeAllGlobalMouseListeners(),this.removeManualUnhoverListener(),this.removeAllGeoListeners(),this.removeHoverEventHandler(),this.removeElementListeners()}removeElementListeners(){re(this.elt).off("touchstart"),re(this.elt).off("dcg-tapstart"),re(this.elt).off("mouseleave"),re(this.elt).off("keydown")}addGlobalMouseListener(e,t){let o=e.split(" ");for(let i of o){let n=i+".dcg-poiController-"+this.id;re(document).on(n,t)}}removeAllGeoListeners(){re(document).off(".dcg-poiController-geo-"+this.id)}removeAllGlobalMouseListeners(){re(document).off(".dcg-poiController-"+this.id)}getToleranceByDevice(e){return e==="touch"?20:10}addGeoEventHandlers(){re(document).on("mouseleave.dcg-poiController-geo-"+this.id,()=>{var e;if(this.controller.isGeoToolActive()&&!((e=this.pointerState)!=null&&e.isPressed)){let t=this.controller.getGeoModel();t.onMouseAction("move",{pt:{x:NaN,y:NaN},shift:!1,tolerance:0}),t.onPreviewChange()}}),re(document).on("dcg-tapend.dcg-poiController-geo-"+this.id,e=>{var i;let t=!!((i=this.pointerState)!=null&&i.isPressed),o=this.updatePointerState(e);this.controller.isGeoToolActive()&&t&&this.handleGeoTapEnd(o,e)})}removeHoverEventHandler(){re(document).off(".dcg-poiController-global-hover-"+this.id)}addHoverEventHandler(){let e="dcg-tapmove.dcg-poiController-global-hover-"+this.id;re(document).on(e,t=>this.handleTapmove(t))}handleTapmove(e){var T;let t=this.updatePointerState(e);if(this.controller.isGeoToolActive()&&this.handleGeoTapMove(t)||e.device==="touch")return;let o=document.elementFromPoint(e.clientX,e.clientY),i=!!o&&!!o.closest(".dcg-grapher"),n=!!o&&!!o.closest(".dcg-label"),a=!!o&&!!o.closest(".dcg-opened"),s=n&&!a,l=(T=this.controller.getGrapher3d())==null?void 0:T.webglLayer,c=this.manager.poiLabelsLayer,d=this.getMouseRelativeToGrapher(e),p=this.getToleranceByDevice(e.device);l&&(l==null||l.setMouse(i?d:void 0));let u;i&&!n&&(u=this.getFeatureUnderPoint(d,p)),!!((e==null?void 0:e.originalEvent)||e).buttons&&(u=void 0);let h;if(u&&u.type==="movable-point"){let I=u.poi,P=I&&I.getMovablePoint();h=P&&P.id}let m,y=0;u&&u.isClickable&&!this.isBoxSelectActive(e)&&!this.manager.movablePointsLayer.isMovingPoint()&&!this.manager.traceLayer.isTracing()&&(m=u.model,y=zI(u));let w=this.manager.clickableObjectsLayer,S={};m&&(S[m.id]={listIndexes:y===void 0?void 0:{[y]:!0}}),w.setHoveredObjects(S);let C;u&&"poi"in u&&u.poi&&(!u.poi.isAttachedToPlottedPoint()||u.poi.hasInteractiveLabel())&&(C=u.poi);let v=!C&&s;C!==c.getHoveredPOI()&&!v&&(this.controller.isTraceEnabled()?c.setHoveredPOI(C):c.setHoveredPOI(void 0),this.controller.requestRedrawGraph());let E=!1;if(u&&u.type==="image"){let I=hp(u.model),P=u.isClickable;E=I&&!P}let _=!1;u&&u.type==="draggable-label"&&(_=!0),E||_?this.manager.setLayerClass("extraMoveCursor","dcg-mouse-over-movable-point"):this.manager.setLayerClass("extraMoveCursor",""),this.manager.movablePointsLayer.setHoveredPointId(h)}addManualUnhoverListener(){let e=()=>{let t=this.manager;t.poiLabelsLayer.setHoveredPOI(void 0),t.clickableObjectsLayer.setHoveredObjects({}),this.controller.requestRedrawGraph()};re(window).on("blur.dcg-poiController-"+this.id,e),re(this.elt).on("mouseleave",e)}removeManualUnhoverListener(){re(window).off(".dcg-poiController-"+this.id)}getPickResults(e,t){let o=t.webglLayer,{x:i,y:n}=this.getMouseRelativeToGrapher(e);return o.setMouse({x:i,y:n}),o.pickAtMouseAndReadResults(),o.getPickResult()}isClickable(e){let t=this.controller.getItemModel(e);return uw(t)}add3DTouchEventHandlers(e){let t=e.elt;if(!t)return;let o=e.webglLayer;re(t).on("dcg-tapstart",i=>{if(i.touches.length>1)return;let n=this.getPickResults(i,e);if(n!=null&&n.id){let{id:a,index:s}=n;this.isClickable(a)?(o.setPressedAction({id:a,index:s}),i.stopPropagation(),i.preventDefault()):this.controller.dispatch({type:"set-selected-id",id:a,state:"selected"})}}),re(t).on("dcg-tapend dcg-tapcancel",()=>{let i=o.getPressedAction();i&&(o.setPressedAction(void 0),this.controller.dispatch({type:"clickable-item-clicked",id:i.id,listIndex:i.index})),o.isTrackingPressedAction=!1}),re(t).on("dcg-tapmove",i=>{if(o.isTrackingPressedAction){let n=this.getPickResults(i,e);if(n!=null&&n.id){let{id:a,index:s}=n;this.isClickable(a)?o.setPressedAction({id:a,index:s}):o.setPressedAction(void 0)}else o.setPressedAction(void 0)}})}addTouchEventHandlers(){re(this.elt).on("touchstart",e=>this.handleTouchstart(e)),re(this.elt).on("dcg-tapstart",e=>this.handleTapstart(e))}handleTouchstart(e){if(!this.isViewportLocked()){e.target.matches("input, textarea")||e.preventDefault();return}let t=this.getMouseRelativeToGrapher(e),o=this.getToleranceByDevice(e.device),i=this.getFeatureUnderPoint(t,o);i&&(i.type==="image"&&!Za(i.model)&&!hp(i.model)||i.type==="sketch-branch"&&this.graphSettings.config.onlyTraceSelected&&!i.sketch.selected||e.target.matches("input, textarea")||e.preventDefault())}handleTapstart(e){let t=this.updatePointerState(e);if(this.controller.isGeoToolActive()&&this.handleGeoTapStart(t,e)){e.handle();return}if(e.target.closest(".dcg-label")){e.handle("do-not-clear-poi-labels");return}let o=this.getMouseRelativeToGrapher(e),i=this.getToleranceByDevice(e.device),n=this.getFeatureUnderPoint(o,i);if(!n){this.isBoxSelectActive(e)||this.controller.dispatch({type:"set-none-selected"}),this.isBoxSelectActive(e)?this.startBoxSelect(e):this.manager.viewportController.beginPanning(e);return}if(n.isClickable&&!this.isBoxSelectActive(e)){let d="model"in n&&n.model;d?this.manager.clickableObjectsLayer.setPressedObject({id:d.id,listIndex:zI(n)}):this.manager.clickableObjectsLayer.setPressedObject(void 0)}else this.manager.clickableObjectsLayer.setPressedObject(void 0);if(n.type==="editable-label"){e.handle();return}else Jr();if(n.type==="draggable-label"){this.startMovingPoints({poiUnderMouse:void 0,evt:e,points:[{type:"draggable-label",label:n.label,model:n.model,startScreenPt:o}],originalTargetObjectId:n.model.id}),e.handle();return}if(n.type==="clickable-label"&&e.handle(),n.type==="image"&&hp(n.model)&&!this.isBoxSelectActive(e)){let d=!!n.isClickable;if(this.startMovingPoints({poiUnderMouse:void 0,evt:e,points:[{type:"image",image:n.model,startScreenPt:o,shouldDelayUntilRealMove:d}],originalTargetObjectId:n.model.id}),!d){e.handle();return}}let a=!1,s=n.model;if(this.controller.isGeometry()&&s&&s.type==="expression"&&s.formula.geometry){let d;"poi"in n&&(d=n.poi),a=this.startReverseDrag(s.id,e,d),a&&n.type!=="static-point"&&this.manager.clickableObjectsLayer.setPressedObject({id:s.id,listIndex:zI(n)}),!a&&n.isClickable&&this.controller.dispatch({type:"set-none-selected"})}if(n.type==="movable-point"&&(e.handle(),e.handle("do-not-clear-poi-labels"),!a)){this.startMovingPoints({poiUnderMouse:n.poi,evt:e,points:[{type:"poi",poi:n.poi,startScreenPt:o}],originalTargetObjectId:n.sketch.id});return}if(!a&&this._togglePOIUnderPoint(n)){e.handle(),e.handle("do-not-clear-poi-labels");return}if(!a&&n.type==="sketch-branch"&&!n.isClickable){let d=!this.controller.isTraceEnabled();if(this.graphSettings.config.onlyTraceSelected){if(e.handle("do-not-clear-poi-labels"),!d&&this.controller.getItemSelectedState(n.model.id)==="selected"&&!this.isBoxSelectActive(e)){this.startTracingBranch(n,o),e.handle();return}}else{let p=!this.controller.isListEnabled();if(d&&p||(this.selectItemIfNotSecret(n.model.id,{multiSelect:this.isBoxSelectActive(e),tentative:!1}),d))return;this.startTracingBranch(n,o),e.handle(),e.handle("do-not-clear-poi-labels");return}}(this.controller.shouldShowMultiSelectHeader()?"multi-select":"default")==="default"&&a||this.selectFeatureUnderMouse(n,{multiSelect:this.isBoxSelectActive(e),tentative:!0});let c=!1;this.addGlobalMouseListener("dcg-tapmove",d=>{c=!0,this.manager.clickableObjectsLayer.isAnObjectPressed()?o=this.getMouseRelativeToGrapher(d):a||(this.removeAllGlobalMouseListeners(),this.controller.isGeometry()&&(this.controller.dispatch({type:"clear-tentative-selection"}),this.addGlobalMouseListener("dcg-tapend",p=>{this.removeAllGlobalMouseListeners(),this.shouldTreatSmallDragAsClick(e,p)&&this.selectFeatureUnderMouse(n,{multiSelect:this.isBoxSelectActive(p),tentative:!1})})),this.manager.viewportController.beginPanning(d))}),this.addGlobalMouseListener("dcg-tapend dcg-tapcancel",d=>{this.removeAllGlobalMouseListeners();let p=this.manager.clickableObjectsLayer.getPressedObject(),u=p&&p.id;this.manager.clickableObjectsLayer.setPressedObject(void 0);let h=this.getFeatureUnderPoint(o,i);if(h&&h.isClickable){let m="model"in h&&h.model;m&&m.id===u&&!d.wasHandled("dragged-clickable-object")&&!this.isBoxSelectActive(d)&&this.controller.dispatch({type:"clickable-item-clicked",id:m.id,listIndex:zI(h)});return}(!c||this.shouldTreatSmallDragAsClick(e,d))&&(this.controller.hasTentativeSelection()?this.controller.dispatch({type:"commit-tentative-selection"}):this.selectFeatureUnderMouse(h,{multiSelect:this.isBoxSelectActive(d),tentative:!1}))})}shouldTreatSmallDragAsClick(e,t){var a,s,l,c;let o=((a=t.clientX)!=null?a:NaN)-((s=e.clientX)!=null?s:NaN),i=((l=t.clientY)!=null?l:NaN)-((c=e.clientY)!=null?c:NaN),n=this.getToleranceByDevice(t.device);return Math.abs(o)<n&&Math.abs(i)<n}selectFeatureUnderMouse(e,t){var i;if(!e)return;let o=(i=e.model)==null?void 0:i.id;o&&(this.controller.isItemSelected(o)&&!t.multiSelect||this.controller.isItemSelected(o)&&t.tentative||e.type==="movable-point"&&!this.controller.isGeometry()||e.isClickable||this.selectItemIfNotSecret(o,t))}isBoxSelectActive(e){if(!this.controller.isMultiSelectEnabled())return!1;let t=this.controller.getActiveTool();return t==="selection"&&e.shiftKey||t==="box-selection"}isViewportLocked(){return this.graphSettings.config.lockViewport||this.graphSettings.userLockedViewport}addKeyboardEventHandlers(){let e=`dcg-poiController-${this.id}`;re(document).on(`keyup.${e} keydown.${e}`,t=>{this.handleShiftKeyChange(t.shiftKey)}),re(this.elt).on("keydown",t=>{var l,c,d,p,u;let o=t;if(this.manager.getAudioTrace().getAudioTraceActive())return;let i=this.manager.movablePointsLayer.getPOIUnderAttention(),n=this.manager.imageLayer.getFocusedImage(),a=Be(o),s=Ho(o);if((a==="Up"||a==="Down"||a==="Left"||a==="Right")&&this.controller.isGraphPaperFocused()){o.stopPropagation(),o.preventDefault();let h=this.keyboardAttentionManager.getKeyboardAttention(),m=this.controller.getActiveTool();if(!h&&(m==="selection"||m==="box-selection")&&!o.altKey&&!o.ctrlKey&&!o.metaKey&&!o.shiftKey){this.manager.viewportController.panFromKeyboard(a);return}else if(h&&this.controller.shouldAllowMovingPointsWithKeyboard()){let y=n?n.centerId:h.calcId;if(!y)return;let w=this.getDraggablePointOrAncestors(y,o);this.movePointsFromKeyboard(w,o),this.controller.getEvaluator().notifyWhenSynced(()=>{this.describeFocusedItem({includeDetails:!0})})}else this.controller.isVirtualMouseAllowed()&&(this.keyboardAttentionManager.updateKeyboardAttention(void 0,{describe:!1}),this.moveGeoPointFromKeyboard(o))}else if(a==="Tab"&&this.controller.isGraphPaperFocused()){let h=o.shiftKey?"prev":"next",m=this.keyboardAttentionManager.getKeyboardAttention();if(!(this.controller.getActiveTool()!=="selection")&&!m&&h==="prev")return;this.handleTabEvent(h,o)}else if((a==="Enter"||a==="Space")&&this.controller.isGraphPaperFocused()&&this.controller.getActiveTool()==="selection"){let h=this.keyboardAttentionManager.getKeyboardAttention();if(h){let m=this.controller.getItemModel(h.calcId);if(m&&!this.isBoxSelectActive(o)){let y=m.type==="expression"&&xs(m),w=m.type==="image"&&ab(m);if(y||w){this.controller.dispatch({type:"clickable-item-clicked",id:h.calcId,listIndex:h.listIndex});let S=h.listIndex||0;this.speakThrottledDescription(h.calcId,S,(c=(l=m.formula)==null?void 0:l.computed_description)==null?void 0:c[S])}}}o.preventDefault(),o.stopPropagation();return}else if(this.controller.isGeometry()&&this.controller.isGraphPaperFocused()){let h=!1;if(o.ctrlKey&&o.shiftKey&&!o.altKey&&!o.metaKey){let m;if(s==="O"?m={type:"multi-select-more",guid:Ob(),focusFirstOption:!0,previousFocusLocation:{type:"graph-paper"}}:s==="A"&&(m={type:"multi-select-construct",guid:YC(),focusFirstOption:!0,previousFocusLocation:{type:"graph-paper"}}),m){o.preventDefault(),o.stopPropagation();let y=this.keyboardAttentionManager.getKeyboardAttention();this.controller.getActiveTool()!=="box-selection"&&y&&this.controller.getItemModel(y.calcId)&&this.controller.dispatch({type:"set-selected-id",id:y.calcId,state:"selected"}),this.controller.dispatch({type:"toggle-item-settings-menu",menu:m})}}else if(!o.altKey&&!o.ctrlKey&&!o.metaKey){if(a==="Enter"||a==="Space")if(o.preventDefault(),this.controller.getActiveTool()!=="selection"&&o.stopPropagation(),this.controller.getActiveTool()==="box-selection"){let m=((d=this.keyboardAttentionManager.getKeyboardAttention())==null?void 0:d.calcId)||"";this.controller.isClickableId(m)&&(m=""),this.selectItemIfNotSecret(m,{multiSelect:!0,tentative:!1}),this.describeFocusedItem({includeDetails:!1})}else{let m=this.keyboardAttentionManager.getKeyboardAttention();this.activateGeoObjectFromKeyboard(m,o)}else if(s==="?")o.preventDefault(),o.stopPropagation(),this.controller.getGeoModel().speakCurrentGeoToolHint();else if(s==="D")o.preventDefault(),o.stopPropagation(),this.describeFocusedItem({includeDetails:!0});else if(a==="Backspace"||a==="Del"){o.preventDefault(),o.stopPropagation();let m=this.keyboardAttentionManager.getKeyboardAttention();this.controller.getActiveTool()!=="box-selection"&&m&&this.controller.getItemModel(m.calcId)&&this.controller.dispatch({type:"set-selected-id",id:m.calcId,state:"selected"}),this.controller.dispatch({type:"delete-all-selected-items"}),h=!0}else if(s==="-"||s==="="){o.preventDefault(),o.stopPropagation();let m=this.controller.getAllVisibleGeoToolbarItems(),y=m.findIndex(w=>(w==null?void 0:w.current)===this.controller.getActiveTool());for(let w=1;w<m.length;w++){let S=y+(s==="-"?-w:w);S<0&&(S=m.length+S),S>m.length-1&&(S=S-m.length);let C=(p=m[S])==null?void 0:p.current;if(this.selectGeoTool(C)){h=!0;break}}}else if(s==="["||s==="]"){o.preventDefault(),o.stopPropagation();let y=this.controller.getAllVisibleGeoToolbarItems().find(C=>(C==null?void 0:C.current)===this.controller.getActiveTool());if(!y)return;let w=y.dropdown||[y.current];if(w.length===0)return;let S=w.indexOf(y.current);for(let C=1;C<w.length;C++){let v=S+(s==="["?-C:C);v<0&&(v=w.length+v),v>w.length-1&&(v=v-w.length);let E=w[v];if(this.selectGeoTool(E)){h=!0;break}}}else if(!o.shiftKey&&s!==void 0&&s>="0"&&s<="9"){let m=(u=this.controller.getAllVisibleGeoToolbarItems()[o.which-49])==null?void 0:u.current;h=this.selectGeoTool(m)}}h&&this.handleGeoKeyboardPtMove()}else i&&(s==="X"||s==="Y"||s==="L"||s==="C")?this.speakPoint(i,s):n&&(s==="X"||s==="Y"||s==="L")&&this.manager.imageLayer.speakImageAttribute(n,s)})}selectGeoTool(e){return e?this.controller.isGeoToolEnabled(e)?(this.controller.dispatch({type:"select-geo-tool",tool:e}),!0):(Te(this.controller.s("graphing-calculator-narration-geometry-tool-disabled",{tool:this.controller.getGeoModel().getDisplayNameForTool(e)})),!1):!1}getMouseRelativeToGrapher(e){let t=this.elt.getBoundingClientRect(),o=e.touches?e.touches[0]:e,i=o.clientX-t.left,n=o.clientY-t.top;return{x:i,y:n}}_getStyledPointRadiusAdjustments(){return{radiusMultiplier:this.graphSettings.getHighlightPropertyMultiplier("pointLineWidth",!1),selectedRadiusMultiplier:this.graphSettings.getHighlightPropertyMultiplier("pointLineWidth",!0)}}_getStyledPointRadiusForPOI(e,t){let o=e.getPointSize()/2,i=e.isSelected()?t.selectedRadiusMultiplier:t.radiusMultiplier;return o*i}handleTabEvent(e,t){let o=this.controller.getActiveTool()!=="selection";if(this.keyboardAttentionManager.focusNextObjFromKeyboard({direction:e,allowWrapping:o,selectNonClickables:this.controller.getActiveTool()==="selection"})){t==null||t.preventDefault(),t==null||t.stopPropagation();return}else if(!o){this.keyboardAttentionManager.updateKeyboardAttention(void 0,{describe:!1}),e==="prev"&&(t==null||t.preventDefault(),t==null||t.stopPropagation(),this.manager.speakGrapherFocusAriaLabel());return}}_getDistanceFromStyledPOI(e,t){let o=this._getStyledPointRadiusForPOI(e,t.adjustments),i=Math.max(0,t.tolerance-o),n=t.projection.map_pt(e),a=__dcg_shared_module_exports__['Lb'](n.x-t.screenPt.x,n.y-t.screenPt.y),s=Math.max(0,a-o);if(s<=i)return s}_getClosestPoint(e,t,o){let i=1/0,n,a={projection:this.manager.getProjection(),adjustments:this._getStyledPointRadiusAdjustments(),screenPt:t,tolerance:o};for(let s of e){let l=this._getDistanceFromStyledPOI(s,a);l!==void 0&&l<=i&&(i=l,n=s)}return n}findIdsThatIntersectBox(e){let t={};for(let o of this.manager.generateMergeDrawOrder()){let i=this.controller.getItemModel(o);if(i&&!this.controller.shouldIgnoreGraphInteractions(i)){if(i.type==="expression"){let n=this.manager.getGraphSketch(o);if(!n||xs(i)||this.controller.isItemNotSelectableBecauseItsSecret(o))continue;let a=n.branches;if(!a||!a.length)continue;for(let s=0;s<a.length;s++)if(this.doesBoxIntersectBranch(a[s],e)){t[i.id]=!0;break}}else if(i.type==="image"){let n=this.manager.getGraphImage(o);if(!n)continue;r.doesBoxIntersectAnyImage(n,e)&&(t[i.id]=!0)}}}return this.manager.poiDotsLayer.getDrawnPOI().forEach(o=>{let i=o.sketch.id,n=this.controller.getItemModel(i);n&&this.controller.shouldIgnoreGraphInteractions(n)||n&&n.type==="expression"&&xs(n)||this.controller.isItemNotSelectableBecauseItsSecret(i)||o.isBareLabel()||(o.isMovable()||o.isAttachedToPlottedPoint())&&r.doesBoxIntersectPOI(o,e)&&(t[i]=!0)}),t}_getStyledLineAdjustments(){return{thicknessMultiplier:this.graphSettings.getHighlightPropertyMultiplier("graphLineWidth",!1),selectedThicknessMultiplier:this.graphSettings.getHighlightPropertyMultiplier("graphLineWidth",!0)}}_getStyledLineThicknessForBranch(e,t,o){let i=Math.max(0,"lineWidth"in e&&e.lineWidth||0)/2;return t?i*o.selectedThicknessMultiplier:i*o.thicknessMultiplier}_getDistanceFromStyledBranch(e,t,o,i){let n=this._getStyledLineThicknessForBranch(e,t,i.adjustments),a=this.calculateDistanceFromBranch(e,i.screenPt,i.projection,o),s=Math.max(0,a-n),l=Math.max(0,i.tolerance-n);if(s<=l)return s}getLabelUnderPoint(e){let t=this.manager.poiLabelsLayer.getInteractiveLabelUnderPoint(e);if(t&&!this.controller.shouldIgnoreGraphInteractions(t.model))switch(t.type){case"editable":return{type:"label",stackingContext:-1/0,stackingLayer:t.layerNumber,distance:0,label:{type:"editable-label",model:t.model,isClickable:void 0}};case"draggable":return{type:"label",stackingContext:-1/0,stackingLayer:t.layerNumber,distance:0,label:{type:"draggable-label",label:t.label,model:t.model,isClickable:void 0}};case"clickable":return{type:"label",stackingContext:-1/0,stackingLayer:t.layerNumber,distance:0,label:{type:"clickable-label",model:t.model,poi:t.poi,isClickable:!0}}}}getFeatureUnderPointInLayer(e,t,o,i){var p,u,h,m;let n,a=e.layer,s=e.drawOrder,l=this.manager.getProjection(),c={adjustments:this._getStyledLineAdjustments(),projection:l,screenPt:t,tolerance:o},d=1;for(let y=s.length-1;y>=0;y--){let w=s[y],S=this.controller.getItemModel(w),C=d;if(i[w]={layerNumber:a,stackingContext:C},!S){let v=this.manager.getGraphSketch(w),E=(u=(p=v==null?void 0:v.branches)==null?void 0:p[0])==null?void 0:u.tableId;if(E){let _=this.controller.getItemModel(E);(_==null?void 0:_.type)==="table"&&((h=_.regression)==null?void 0:h.id)===w&&(S=_)}}if(S&&!this.controller.shouldIgnoreGraphInteractions(S)){if(S.type==="expression"||S.type==="table"&&((m=S.regression)==null?void 0:m.id)===w){let v=this.manager.getGraphSketch(w);if(!v)continue;let E=v.branches;if(!E||!E.length)continue;if(v.hoistToTop&&!this.controller.isGeometry()&&(C=-1/0,i[w]={layerNumber:1/0,stackingContext:C}),!n||n.stackingContext>=C){let _=S.type==="table"?!1:xs(S);for(let T=0;T<E.length;T++){let I=E[T],P=this._getDistanceFromStyledBranch(I,v.showHighlight,_,c);if(P!==void 0){let O=!1;n?(C<n.stackingContext||C===n.stackingContext&&P<n.distance-3.5)&&(O=!0):O=!0,O&&(n={type:"sketch-branch",model:S,sketch:v,distance:P,stackingContext:C,stackingLayer:a,branchInfo:{id:v.id,branch:T,sketch:v}})}}}}else if(S.type==="image"){let v=this.manager.getGraphImage(w);if(!v)continue;let E=this.getImageInfoUnderMouse(v,l.pixelsToMath.mapPoint(t),o);if(!E)continue;d+=1,C=d,i[w]={layerNumber:a,stackingContext:C},d+=1,(!n||n.stackingContext>C)&&(n={type:"image",model:v,distance:0,stackingContext:C,stackingLayer:a,listIndex:E.listIndex})}}}return n}getFeatureUnderPoint(e,t){var m;if(this.manager.scaleAxis)return;let o,i=this.getLabelUnderPoint(e);if(i){if(i.label.type==="editable-label")return i.label;o=i}let n={},a=this.manager.getDrawLayers();for(let y=a.length-1;y>=0;y--){let w=a[y],S=this.getFeatureUnderPointInLayer(w,e,t,n);S&&(o?S.stackingLayer>o.stackingLayer&&(o=S):o=S)}let s=[],l=[],c=[],d=[];this.manager.poiDotsLayer.getDrawnPOI().forEach(y=>{var C;if(y.isBareLabel())return;let w=y.sketch.id,S=this.controller.getItemModel(w);if(!(S&&this.controller.shouldIgnoreGraphInteractions(S))){if(!S&&y.sketch.branches.length>0){let v=y.sketch.branches[0].tableId,E=v!==void 0?this.controller.getItemModel(v):void 0,_=(E==null?void 0:E.type)==="table"&&vi(E,w);if(_&&this.controller.shouldIgnoreGraphInteractions(_))return}if(y.isMovable()){let v=S&&S.type==="expression"&&((C=S.formula.geometry)==null?void 0:C.call);(!o||o.stackingLayer<=n[y.sketch.id].layerNumber)&&(v&&v.symbol==="glider"?s.push(y):l.push(y))}else y.isAttachedToPlottedPoint()?(!o||o.stackingLayer<n[y.sketch.id].layerNumber||o.stackingLayer===n[y.sketch.id].layerNumber&&o.stackingContext>=n[y.sketch.id].stackingContext)&&c.push(y):d.push(y)}});let p=this._getClosestPoint(s,e,t);if(p||(p=this._getClosestPoint(l,e,t)),p)return{type:"movable-point",poi:p,isClickable:void 0,sketch:p.sketch,model:this.controller.getItemModel(p.sketch.id)};let u=this._getClosestPoint(d,e,t+2);if(u)return{type:"poi",poi:u,isClickable:!1,model:void 0};let h=this._getClosestPoint(c,e,t);if(h){let y=this.controller.getItemModel(h.sketch.id);return y&&y.type==="expression"&&xs(y)?{type:"static-point",poi:h,sketch:h.sketch,isClickable:!0,model:y}:{type:"static-point",poi:h,isClickable:!1,sketch:h.sketch,model:y}}if(o){if(o.type==="label")return o.label;if(o.type==="sketch-branch"){let y,w;if(o.model.type==="table")w=!0,y=!1;else{y=xs(o.model);let S=(m=o.model.formula.typed_constant_value)==null?void 0:m.valueType;w=!(this.controller.isGeometry()&&S&&__dcg_shared_module_exports__['db'](S))}return{type:"sketch-branch",branchInfo:o.branchInfo,sketch:o.sketch,model:o.model,isClickable:y,isTraceable:w,isSelected:this.controller.isItemSelected(o.model.id),selectionId:this.controller.isItemSelectable(o.model.id)?o.model.id:void 0}}else if(o.type==="image")return{type:"image",model:o.model,isClickable:ab(o.model),listIndex:o.listIndex,isSelected:this.controller.isItemSelected(o.model.id),selectionId:this.controller.isItemSelectable(o.model.id)?o.model.id:void 0}}}_togglePOIUnderPoint(e){if(!this.controller.isTraceEnabled())return;if(e.isClickable)return!1;let t="poi"in e&&e.poi;return!t||t.isBareLabel()||this.controller.isGeometry()&&e.type==="static-point"&&!t.hasInteractiveLabel()?!1:(this.manager.poiLabelsLayer.isOpenPOI(t)?(this.manager.poiLabelsLayer.closePOI(t),this.manager.poiLabelsLayer.setHoveredPOI(void 0)):(this.manager.poiLabelsLayer.openPOI(t),this.speakPoint(t)),this.controller.requestRedrawGraph(),!0)}getImageInfoUnderMouse(e,t,o){if(!e)return;let i=e.formula;if(!i)return;let n=i.dimensions;if(!(!n.x||!n.y||!n.width||!n.height||!n.radianAngle||!e.shouldGraph))for(let a=n.x.length-1;a>=0;a--){let s=n.x[a],l=n.y[a],c=n.radianAngle[a],d=s+Math.cos(c)*(t.x-s)-Math.sin(c)*(t.y-l),p=l+Math.sin(c)*(t.x-s)+Math.cos(c)*(t.y-l),u=.5*Math.abs(n.width[a]),h=.5*Math.abs(n.height[a]);if(d>s-u&&d<s+u&&p>l-h&&p<l+h)return{listIndex:a}}}doesBoxIntersectBranch(e,t){let o=!1,i=!1;switch(e.graphMode){case 5:case 8:case 2:break;case 6:o=!0;break;case 1:i=!0;break;case 18:case 17:case 19:case 24:return UI(t,{x1:e.segments[0][0],y1:e.segments[0][1],x2:e.segments[0][2],y2:e.segments[0][3],extendStart:e.graphMode===18,extendEnd:e.graphMode!==17});case 20:return BY(t,{x:e.segments[0][0],y:e.segments[0][1],radius:e.segments[0][2]});case 21:case 23:{let[a,s]=e.segments[0],[l,c,d]=e.graphMode===21?this.getBoxIntersectArgsForArc(e):this.getBoxIntersectArgsForAngleMarker(e),p=(d-c)/2+c;return NY(t,{x0:a+l*Math.cos(c),y0:s+l*Math.sin(c),x1:a+l*Math.cos(p),y1:s+l*Math.sin(p),x2:a+l*Math.cos(d),y2:s+l*Math.sin(d)})}default:return!1}let n=e.segments;for(let a=0;a<n.length;a++){let s=n[a];if(o){let l=s;s=[];for(let c=0;c<l.length;c+=2){let d=l[c],p=l[c+1];s.push(p*Math.cos(d),p*Math.sin(d))}}else if(i){let l=s;s=[];for(let c=0;c<l.length;c+=2)s.push(l[c+1],l[c])}if(UY(t,s))return!0}return!1}getBoxIntersectArgsForArc(e){return[e.segments[0][2],e.segments[0][3],e.segments[0][4]]}getBoxIntersectArgsForAngleMarker(e){let t=e.segments[0][3],o=this.manager.getProjection(),i=vm(t,o),n=o.pixelsToMath.dangerouslyGetXScaleFactor(),a=o.pixelsToMath.dangerouslyGetYScaleFactor();return[Math.abs(Math.min(n,a))*i,e.segments[0][2],e.segments[0][2]+t]}static doesBoxIntersectAnyImage(e,t){let o=e.formula;if(!o)return;let i=o.dimensions;if(!(!i.x||!i.y||!i.width||!i.height||!i.radianAngle||!e.shouldGraph)){for(let n=i.x.length-1;n>=0;n--)if(qY(t,{width:i.width[n],height:i.height[n],angle:i.radianAngle[n],center:{x:i.x[n],y:i.y[n]}}))return!0;return!1}}static doesBoxIntersectPOI(e,t){return t.left<=e.x&&e.x<=t.right&&t.top<=e.y&&e.y<=t.bottom}calculateDistanceFromBranch(e,t,o,i){let n=this.controller.isGeometry()&&e.graphMode===7;if(i||n){let l=[t.x,t.y],c=jR(o,e);for(let d of c)if(__dcg_shared_module_exports__['hc'](d,l))return 0}if(e.graphMode===7)return 1/0;let s=r.getBranchesDistanceInfo(e,t,o,i,this.controller.isGeometry());return s?s.minDistance:1/0}static getBranchesDistanceInfo(e,t,o,i,n){let a=t.x,s=t.y,{mathToPixels:l,pixelsToMath:c}=o;switch(e.graphMode){case 5:if(!n&&!i)return;break;case 8:if(!i)return;break;case 6:if(!i)return;break;case 2:case 1:break;case 23:{let[S,C,v,E]=e.segments[0],_=l.dangerouslyGetXScaleFactor(),T=l.dangerouslyGetYScaleFactor(),[I,P]=c.mapCoordinatePair([a,s]),O=vm(E,o),W=O/_,X=1/0,x=P-C,L=I-S,R=Math.atan2(x,L);if(__dcg_shared_module_exports__['Jb'](R,v,E))__dcg_shared_module_exports__['Lb'](x*T,L*_)<=O+7&&(X=0);else{let N=__dcg_shared_module_exports__['Ob'](I,P,S+W*Math.cos(v),C+W*Math.sin(v),S,C),z=__dcg_shared_module_exports__['Ob'](I,P,S+W*Math.cos(v+E),C+W*Math.sin(v+E),S,C),A=__dcg_shared_module_exports__['Lb'](_*(N[0]-I),T*(N[1]-P)),U=__dcg_shared_module_exports__['Lb'](_*(z[0]-I),T*(z[1]-P));X=Math.min(A,U)}return{closestPoint:{x:a,y:s},minDistance:X,secondDistance:X}}break;case 18:case 17:case 19:case 24:{if(!e.segments.length)return null;let S=l.mapX(e.segments[0][0]),C=l.mapY(e.segments[0][1]),v=l.mapX(e.segments[0][2]),E=l.mapY(e.segments[0][3]),_=e.graphMode===18,T=e.graphMode===18||e.graphMode===19,I=__dcg_shared_module_exports__['Pb'](a,s,S,C,v,E,_,T);if(!I)return null;let P=__dcg_shared_module_exports__['Lb'](I[0]-a,I[1]-s);return{closestPoint:{x:I[0],y:I[1]},minDistance:P,secondDistance:P}}case 21:case 20:{let S=e.segments[0][0],C=e.segments[0][1],v=e.segments[0][2],E=e.graphMode===21?e.segments[0][3]:0,_=e.graphMode===21?e.segments[0][4]:Math.PI*2,T=__dcg_shared_module_exports__['Qb'](c.mapX(a),c.mapY(s),S,C,v,E,_);if(!T)return null;let I=l.mapCoordinatePair(T),P=__dcg_shared_module_exports__['Lb'](I[0]-a,I[1]-s);return{closestPoint:{x:I[0],y:I[1]},minDistance:P,secondDistance:P}}default:return}let d=1/0,p=1/0,u,h;for(let S=0;S<e.segments.length;S++){let C=e.segments[S];for(let v=0;v<C.length-3;v+=2){let E=C[v],_=C[v+1],T=C[v+2],I=C[v+3];if(e.graphMode===6){let N=_,z=E;E=N*Math.cos(z),_=N*Math.sin(z);let A=I,U=T;T=A*Math.cos(U),I=A*Math.sin(U)}e.graphMode===1&&([E,_]=[_,E],[T,I]=[I,T]);let[P,O]=l.mapCoordinatePair([E,_]),[W,X]=l.mapCoordinatePair([T,I]),x=__dcg_shared_module_exports__['Ob'](0,0,P-a,O-s,W-a,X-s),L=__dcg_shared_module_exports__['Lb'](x[0],x[1]);x[e.graphMode===1?1:0]<0?L<d&&(d=L,u=x):L<p&&(p=L,h=x)}}let m=d<p?u:h;if(!m)return;let y=m[0]+a,w=m[1]+s;return{closestPoint:{x:y,y:w},minDistance:Math.min(d,p),secondDistance:Math.max(d,p)}}static getBranchesTracePoint(e,t,o,i){let n,a=o.pixelsToMath.mapPoint(t);switch(e.graphMode){case 20:case 21:{let O=e.graphMode===21?e.segments[0][3]:0,W=e.graphMode===21?e.segments[0][4]:Math.PI*2;n=__dcg_shared_module_exports__['Qb'](a.x,a.y,e.segments[0][0],e.segments[0][1],e.segments[0][2],O,W);break}case 18:case 19:case 17:n=__dcg_shared_module_exports__['Pb'](a.x,a.y,e.segments[0][0],e.segments[0][1],e.segments[0][2],e.segments[0][3],e.graphMode===18,e.graphMode!==17);break}if(n)return{x:n[0],y:n[1]};if(!e)return;let s="compiled"in e&&e.compiled,l=s&&s.fn;if(!l)return;let c=this.getBranchesDistanceInfo(e,t,o,!1,i);if(!c)return;let{mathToPixels:d,pixelsToMath:p}=o,u,h;e.graphMode===2?(h="x",u="y"):(h="y",u="x",d=new __dcg_shared_module_exports__['Nd'](d.yScale,d.xScale),p=d.inverse());let m=Math.pow(c.minDistance/c.secondDistance,2),y=c.closestPoint[h]*(1-m)+t[h]*m,w=.5,S=.5,C=d.mapY(l(p.mapX(y-w))),v=d.mapY(l(p.mapX(y))),E=d.mapY(l(p.mapX(y+w))),_=w*Math.min(1,S/Math.abs(C-v)),T=w*Math.min(1,S/Math.abs(E-v));isFinite(_)||(_=w),isFinite(T)||(T=w);let I=ni(p.mapX(y-_),p.mapX(y+T)),P=l(I);if(!isFinite(d.mapY(P))){let O=d.mapX(I)-w,W=d.mapX(I)+w,X=p.mapX(O),x=p.mapX(W),L=l(X),R=l(x),N=d.mapY(L),z=d.mapY(R);Math.abs(N-t[u])<Math.abs(z-t[u])?P=L:P=R}return{x:e.graphMode===2?I:P,y:e.graphMode===2?P:I}}getPointInfo(e){switch(e.type){case"movable-point":case"static-labeled-point":return HY(e);case"poi":return HY(e.poi.getMovablePoint());case"movable-point-parent":return{calcId:e.id,isReverseDrag:!0};case"image":return{calcId:e.image.formula.center_reference_id,isReverseDrag:!1};case"draggable-label":return{calcId:e.model.id,isReverseDrag:!1};default:return e}}getDraggablePointOrAncestors(e,t){if(!this.controller.isGeometry()){let l=this.controller.getItemModel(e);if(l&&l.type==="expression"&&YT(l)){let c=y7(l);return c?Ci(l)==="NONE"?[]:[{type:"movable-point-parent",id:e,shouldDelayUntilRealMove:!0,...c}]:[]}}let o=[e];(this.isBoxSelectActive(t)||this.controller.isItemSelected(e))&&o.push(...this.controller.getAllSelectedItems().map(l=>l.id).filter(l=>l!==e));let i=!1,n={},a=[];Mb({controller:this.controller},(l,c)=>{if(!c&&l.typedRuntimeValue.valueType===__dcg_shared_module_exports__['da']&&l.data.isMovablePoint){let[d,p]=l.typedRuntimeValue.value;n[l.calcId]={id:l.calcId,value:{x:d,y:p}}}});let s=this.controller.getGeoModel().getComputedBoard().computeReversibilityLineages(o);for(let l in s){let c=n[l];if(!c){i=!0;break}a.push({type:"movable-point-parent",id:l,x:c.value.x,y:c.value.y,shouldDelayUntilRealMove:!0,transformations:s[l]})}return i?[]:a}getFeatureCenterMathPoint(e){switch(e.type){case"poi":return e.poi;case"movable-point-parent":let t={x:e.x,y:e.y};if(e.transformations){let o=__dcg_shared_module_exports__['Uc'](e.transformations.forward,[t.x,t.y]);t={x:o[0],y:o[1]}}return t;case"image":return{x:e.image.formula.dimensions.x[0],y:e.image.formula.dimensions.y[0]};case"draggable-label":return{x:e.label.x,y:e.label.y}}}startReverseDrag(e,t,o){let i=this.getMouseRelativeToGrapher(t),n=this.getDraggablePointOrAncestors(e,t).map(a=>({...a,startScreenPt:i}));return n.length>0?(this.startMovingPoints({poiUnderMouse:o,evt:t,points:n,originalTargetObjectId:e}),!0):!1}startMovingPoints(e){let t=e.points,o=!1,i=t.map(this.getPointInfo),n=this.controller;function a(){o=!0,n.dispatch({type:"start-moving-points",points:i})}let s=!1;for(let u of t)if(u.shouldDelayUntilRealMove){s=!0;break}s||a();let l;e.poiUnderMouse&&e.poiUnderMouse.isMovable()&&(l=e.poiUnderMouse.getMovablePoint().id),this.manager.movablePointsLayer.setPressedPointId(l);let c=t.map(u=>{let h=this.manager.getProjection().map_pt(this.getFeatureCenterMathPoint(u));return{x:u.startScreenPt.x-h.x,y:u.startScreenPt.y-h.y}}),d,p=()=>{if(!d)return;this.shouldTreatSmallDragAsClick(e.evt,d)||this.controller.dispatch({type:"clear-tentative-selection"}),o||a();let u=this.manager.getProjection(),h=this.getMouseRelativeToGrapher(d);d=void 0,this.controller.dispatch({type:"on-move-points",points:t.map(this.getPointInfo),screenPts:c.map(m=>({x:h.x-m.x,y:h.y-m.y})),transform:t.map(m=>m.type==="movable-point-parent"?m.transformations:void 0),previousScreenPts:t.map(m=>m.startScreenPt),projection:u})};this.manager.registerMovablePointListener(p),this.addGlobalMouseListener("dcg-tapmove",u=>{d=u}),this.addGlobalMouseListener("dcg-tapend dcg-tapcancel",u=>{p(),this.manager.deregisterMovablePointListener(),this.removeAllGlobalMouseListeners(),this.manager.movablePointsLayer.setPressedPointId(void 0),o&&(u.handle("dragged-clickable-object"),this.controller.dispatch({type:"stop-moving-points",points:t.map(this.getPointInfo)}))})}startTracingBranch(e,t){if(!e.isTraceable)return;let o=e.branchInfo;this.manager.markLabelsDirty(),this.lastScreenPt=t;let i=this.manager.getProjection(),a=o.sketch.branches[o.branch],s=r.getBranchesTracePoint(a,t,i,this.controller.isGeometry());s&&this.speakPoint(s),this.manager.traceLayer.setTraceInfo({pt:s,branchInfo:o}),this.controller.requestRedrawGraph(),this.addGlobalMouseListener("dcg-tapmove",this.handleTraceUpdate.bind(this)),this.addGlobalMouseListener("dcg-tapend dcg-tapcancel",this.stopTracingBranch.bind(this))}stopTracingBranch(e){this.manager.markLabelsDirty();let t=this.manager.poiLabelsLayer.getHoveredPOI();t&&!this.manager.poiLabelsLayer.isOpenPOI(t)&&(this.manager.poiLabelsLayer.openPOI(t),this.speakPoint(t),this.controller.requestRedrawGraph()),this.lastScreenPt=void 0,this.manager.traceLayer.setTraceInfo(void 0),this.controller.requestRedrawGraph(),this.removeAllGlobalMouseListeners()}handleTraceUpdate(e){if(!this.manager.traceLayer.traceInfo)return;let t=this.manager.getProjection(),o;if(e)o=this.getMouseRelativeToGrapher(e),this.lastScreenPt=o,this.manager.markLabelsDirty();else if(this.lastScreenPt)o=this.lastScreenPt;else return;let i=1/0,n=-1,a=this.manager.traceLayer.traceInfo,s=this.manager.graphSketches[a.branchInfo.sketch.id];if(!s)return;a.branchInfo.sketch=s;let l=a.branchInfo.sketch.branches;for(let p=0;p<l.length;p++){let u=this.calculateDistanceFromBranch(l[p],o,t,!1);u<i&&(n=p,i=u)}let c=l[n],d=c?r.getBranchesTracePoint(c,o,t,this.controller.isGeometry()):void 0;d&&this.speakPoint(d),this.manager.traceLayer.traceInfo.branchInfo.branch=n,this.manager.traceLayer.traceInfo.pt=d,this.controller.requestRedrawGraph()}hasNonlinearMoveStrategy(e){if(!e||e.type!=="movable-point-parent")return!1;let t=this.controller.getItemModel(e.id);if(!t||t.type!=="expression"||!t.formula)return!1;let o=t.formula.move_strategy;return!o||!o[0]?!1:o[0].type==="updateSliderNonlinear"}movePointsFromKeyboard(e,t){if(!t)return;let o=this.manager.getProjection(),i=e.map(h=>{let{x:m,y}=o.map_pt(this.getFeatureCenterMathPoint(h));return{x:m,y}}),n=0,a=0,s=Be(t),l=(o.pixelCoordinates.right-o.pixelCoordinates.left)/40,c=(o.pixelCoordinates.bottom-o.pixelCoordinates.top)/40,d=s==="Up"||s==="Down"?c:l;d=t.shiftKey?d*5:d;let p,u;if(s==="Up"?(u="y",a-=d,p=t.shiftKey?"bigup":"up"):s==="Down"?(u="y",a+=d,p=t.shiftKey?"bigdown":"down"):s==="Left"?(u="x",n-=d,p=t.shiftKey?"bigdown":"down"):s==="Right"&&(u="x",n+=d,p=t.shiftKey?"bigup":"up"),p){let h=i.map(({x:y,y:w})=>({x:y+n,y:w+a})),m;u==="x"||e.some(y=>this.hasNonlinearMoveStrategy(y))?m={x:p}:u==="y"&&(m={y:p}),this.controller.dispatch({type:"on-move-points",points:e.map(y=>this.getPointInfo(y)),screenPts:h,previousScreenPts:i,transform:e.map(y=>y.type==="movable-point-parent"?y.transformations:void 0),projection:o,keyboardDirection:m})}}getGeoKeyboardPt(){return this.initGeoKeyboardPt(),this.geoKeyboardPt}setGeoKeyboardPt(e){this.geoKeyboardPt={...this.geoKeyboardPt,x:e.x,y:e.y},e.fromArrowKeys&&(this.geoKeyboardPt.lastArrowedX=e.x,this.geoKeyboardPt.lastArrowedY=e.y),this.controller.requestRedrawGraph()}initGeoKeyboardPt(){if(!isNaN(this.geoKeyboardPt.x)&&!isNaN(this.geoKeyboardPt.y))return;let e=this.manager.getProjection();if(!e)return;let t=e.viewport,o=od(e),i=o.minorStepX,n=o.minorStepY,a=Math.round((t.xmin+t.xmax)/2/i)*i,s=Math.round((t.ymin+t.ymax)/2/n)*n;this.setGeoKeyboardPt({x:a,y:s})}moveGeoPointFromKeyboard(e){if(!e)return;this.initGeoKeyboardPt();let t=this.manager.getProjection();if(!t)return;let o=t.viewport,i=od(t),n=i.minorStepX/4,a=i.minorStepY/4,s=this.geoKeyboardPt.x,l=this.geoKeyboardPt.y,c=Be(e);c==="Down"?e.ctrlKey?l=o.ymin:l=Math.max(Math.round((l-a)/a)*a,o.ymin):c==="Up"?e.ctrlKey?l=o.ymax:l=Math.min(Math.round((l+a)/a)*a,o.ymax):c==="Left"?e.ctrlKey?s=o.xmin:s=Math.max(Math.round((s-n)/n)*n,o.xmin):c==="Right"&&(e.ctrlKey?s=o.xmax:s=Math.min(Math.round((s+n)/n)*n,o.xmax)),!(s===this.geoKeyboardPt.x&&l===this.geoKeyboardPt.y)&&(this.setGeoKeyboardPt({x:s,y:l,fromArrowKeys:!0}),this.handleGeoKeyboardPtMove(e),this.controller.getEvaluator().notifyWhenSynced(()=>{Bt(Jc(this.controller,this.geoKeyboardPt.x,this.geoKeyboardPt.y));let d=this.manager.clickableObjectsLayer.getHoveredObjects(),p=[];for(let u in d){let h=this.controller.getItemModel(u,{includePreviewItems:!0});h!==void 0&&p.push(Bi(h,this.controller,{includeDetails:!1,depth:this.controller.isToolPreviewItem(u)?0:1}))}p.length&&Bt(this.controller.s("graphing-calculator-narration-geometry-near-item",{item:wu(this.controller.getLanguage(),p)})),Te()}))}handleGeoKeyboardPtMove(e){this.initGeoKeyboardPt();let t=this.controller.getGeoModel(),o=!!(e&&e.shiftKey);t.onMouseAction("move",{pt:this.geoKeyboardPt,shift:o,tolerance:this.getToleranceByDevice("keyboard")}),t.onPreviewChange()}activateGeoObjectFromKeyboard(e,t){e!=null&&e.geoDef?this.tapGeoObjectFromKeyboard(e.geoDef,t):this.tapGeoPointFromKeyboard(t)}tapGeoObjectFromKeyboard(e,t){var a;let o=this.controller.getGeoModel(),i=o.getCurrentTool();if(!i)return;i.onFocus(e);let n=i.tryCommitResults();n.committed&&this.controller.dispatch({type:"commit-geo-objects",shiftKey:t.shiftKey,...n}),o.updateNextObjectId(o.controller.findLastTokenNumber()+1),o.clearHoveredObjects(),o.onPreviewChange(),this.speakGeoReleaseAction(this.controller.getActiveTool(),(a=i.getSpec)==null?void 0:a.call(i),n.committed),this.keyboardAttentionManager.clearAttentionIfNotTabbable()}tapGeoPointFromKeyboard(e){var l;this.initGeoKeyboardPt();let t=this.controller.getGeoModel(),o=this.controller.getActiveTool(),i=t.getCurrentTool(),n=(l=i.getSpec)==null?void 0:l.call(i),a=!!e.shiftKey,s=t.onMouseAction("release",{pt:this.geoKeyboardPt,shift:a,tolerance:this.getToleranceByDevice("keyboard")});s.committed&&this.controller.dispatch({type:"commit-geo-objects",shiftKey:e.shiftKey,...s}),t.onMouseAction("move",{pt:this.geoKeyboardPt,shift:a,tolerance:this.getToleranceByDevice("keyboard")}),t.onPreviewChange(),this.speakGeoReleaseAction(o,n,s.committed),this.keyboardAttentionManager.clearAttentionIfNotTabbable()}speakGeoReleaseAction(e,t,o){var i;if(o!==void 0){let n=Object.keys(o);if(!n.length||!t)return;let a="";if(e==="point"||e==="expression-edit"){for(let s in o){let l=o[s];if(l){if(l.type==="point-reference"){a=this.controller.s("graphing-calculator-text-geometry-tool-point-display-name");break}else if(l.type==="intersection"){a=this.controller.s("graphing-calculator-text-geometry-intersection");break}else if(l.type==="glider"){a=this.controller.s("graphing-calculator-text-geometry-glider");break}else if(l.type==="vector-endpoint"){l.location==="start"?a=this.controller.s("graphing-calculator-text-geometry-tool-vector-start-point-display-name"):a=this.controller.s("graphing-calculator-text-geometry-tool-vector-end-point-display-name");break}}}a===""&&(a=this.controller.s("graphing-calculator-text-geometry-tool-point-display-name"))}else{let s=(i=t.outputs[0])==null?void 0:i.type;switch(s){case"arc":a=this.controller.s("graphing-calculator-text-geometry-tool-arc-display-name");break;case"circle":a=this.controller.s("graphing-calculator-text-geometry-tool-circle-display-name");break;case"line":a=this.controller.s("graphing-calculator-text-geometry-tool-line-display-name");break;case"segment":a=this.controller.s("graphing-calculator-text-geometry-tool-segment-display-name");break;case"ray":a=this.controller.s("graphing-calculator-text-geometry-tool-ray-display-name");break;case"vector-copy":a=this.controller.s("graphing-calculator-text-geometry-tool-vector-copy-display-name");break;case"vector":a=this.controller.s("graphing-calculator-text-geometry-tool-vector-display-name");break;case"parallel":a=this.controller.s("graphing-calculator-text-geometry-tool-parallel-display-name");break;case"perpendicular":a=this.controller.s("graphing-calculator-text-geometry-tool-perpendicular-display-name");break;case"anglebisector":a=this.controller.s("graphing-calculator-text-geometry-tool-angle-bisector-display-name");break;case"midpoint":a=this.controller.s("graphing-calculator-text-geometry-tool-midpoint-display-name");break;case"polygon":a=this.controller.s("graphing-calculator-text-geometry-tool-polygon-display-name");break;case"angle":a=this.controller.s("graphing-calculator-text-geometry-tool-angle-display-name");break;case"directedangle":a=this.controller.s("graphing-calculator-text-geometry-tool-directed-angle-display-name");break;case"reflect":a=this.controller.s("graphing-calculator-text-geometry-tool-reflect-display-name");break;case"translate":a=this.controller.s("graphing-calculator-text-geometry-tool-translate-display-name");break;case"dilate":a=this.controller.s("graphing-calculator-text-geometry-tool-dilate-display-name");break;case"rotate":a=this.controller.s("graphing-calculator-text-geometry-tool-rotate-display-name");break;case"vector-endpoint":case"expression-edit-preview-latex":case"point":case"intersection":case"glider":case"slider":case"polygon-angle":case"polygon-directedangle":case"compass":case"polygon-segment":case"point-reference":case void 0:a=this.controller.s("shared-calculator-narration-item-unknown");break;default:let l=s;throw new Error("Exhaustive Check failed"+l)}}n.length===1?Te(this.controller.s("graphing-calculator-narration-geometry-added-object-type",{type:a})):a!=="graphing-calculator-text-geometry-point"?n.length===2?Te(this.controller.s("graphing-calculator-narration-geometry-added-object-type-and-point",{type:a})):Te(this.controller.s("graphing-calculator-narration-geometry-added-object-type-and-points",{type:a,points:n.length-1})):Te(this.controller.s("graphing-calculator-narration-geometry-added-points",{points:n.length}))}else this.controller.getGeoModel().speakCurrentGeoToolHint()}describeFocusedItem(e){let t=this.keyboardAttentionManager.getKeyboardAttention(),o=this.controller.getItemModel((t==null?void 0:t.calcId)||"");this.controller.getEvaluator().notifyWhenSynced(()=>{var i,n;if(!this.controller.isGeometry()&&o&&o.type==="image"&&((i=this.manager.imageLayer.getFocusedImage())==null?void 0:i.id)===o.id){this.manager.imageLayer.speakAriaAlert();return}o&&((n=this.manager.movablePointsLayer.getPOIUnderAttention())==null?void 0:n.sketch.id)===o.id&&this.manager.movablePointsLayer.speakAriaAlert()||Te(Bi(o,this.controller,{includeDetails:e.includeDetails,description:t==null?void 0:t.description,poi:this.manager.movablePointsLayer.getPOIUnderAttention(),listIndex:t==null?void 0:t.listIndex,polygonEdge:t==null?void 0:t.polygonEdge,includeSelectionState:this.controller.isGeometry()&&(this.controller.getActiveTool()==="box-selection"||this.controller.getActiveTool()==="selection")}))})}getPointFromFocusedItem(){var d;let e=this.keyboardAttentionManager.getKeyboardAttention(),t=this.controller.getItemModel((e==null?void 0:e.calcId)||"");if(!t||t.type!=="expression"||!t.latex)return;let o=t.formula.typed_constant_value;if(!o||!this.manager.getProjection())return;let n=o.valueType,a=o.value;if(__dcg_shared_module_exports__['bb'](o.valueType)){let p=e==null?void 0:e.listIndex;p&&(n=__dcg_shared_module_exports__['cb'](n),a=a[p])}let s=e==null?void 0:e.polygonEdge;if(n===__dcg_shared_module_exports__['oa']&&s!==void 0&&s>=0&&a.length>s){let p=a[s],u=a[(s+1)%a.length];n=__dcg_shared_module_exports__['qa'],a=[p,u]}let l=NaN,c=NaN;return n===__dcg_shared_module_exports__['da']?(l=a[0],c=a[1]):n===__dcg_shared_module_exports__['wa']||n===__dcg_shared_module_exports__['ya']||n===__dcg_shared_module_exports__['qa']?(l=(a[0][0]+a[1][0])/2,c=(a[0][1]+a[1][1])/2):n===__dcg_shared_module_exports__['Ga']?(l=a[1][0]+a[0][0]/2,c=a[1][1]+a[0][1]/2):(d=a[0])!=null&&d.length&&(l=a[0][0],c=a[0][1]),{x:l,y:c}}moveGeoKeyboardPtToFocusedItem(e){let t=this.getPointFromFocusedItem();if(!t)return;let{x:o,y:i}=t,n=this.keyboardAttentionManager.getKeyboardAttention(),a=this.controller.getFocusLocation(),s=a&&a.type==="expression"&&a.isFakeGraphFocus;this.controller.getGeoModel().setObjectHovered({calcId:(n==null?void 0:n.calcId)||"",listIndex:void 0}),!isNaN(o)&&!isNaN(i)?(this.setGeoKeyboardPt({x:o,y:i}),!s&&this.controller.isVirtualMouseAllowed()&&e.describe&&Te(this.controller.s("graphing-calculator-narration-geometry-moved-to-coordinates",{x:Md(this.controller,o),y:Ad(this.controller,i)}))):!s&&this.controller.isVirtualMouseAllowed()&&e.describe&&Te(this.controller.s("graphing-calculator-narration-geometry-unable-to-move"))}speakPoint(e,t){if(!(!e||!this.manager.getAudioTrace()||!this.manager.getProjection()))switch(t){case"X":Te(Md(this.controller,e.x));break;case"Y":Te(Ad(this.controller,e.y));break;case"L":"ariaLabel"in e&&e.ariaLabel?Te(e.ariaLabel):Te(this.controller.s("graphing-calculator-narration-poi-graph-point"));break;case"C":"sketch"in e&&Te(gu(this.controller,e.sketch.color))}}selectItemIfNotSecret(e,t){this.controller.isItemNotSelectableBecauseItsSecret(e)||(!this.controller.isMultiSelectEnabled()||!t.multiSelect?this.controller.dispatch({type:"set-selected-id",id:e,state:t.tentative?"tentatively-selected":"selected"}):this.controller.dispatch({type:"toggle-selected-with-multi-select",id:e,state:t.tentative?"tentatively-selected":"selected"}))}convertTouchEventToMathPoint(e){let{clientX:t,clientY:o}=e.changedTouches[0],i=this.manager.elt.getBoundingClientRect();return this.controller.getGeoModel().convertCanvasPixelsToPoint({x:t-i.left,y:o-i.top})}handleGeoTapStart(e,t){let o=this.controller.getGeoModel();this.canceledGeoToolplayWhilePressed=!1;let i=e.shift;return o.onMouseAction("move",{pt:e.mathPoint,shift:i,tolerance:this.getToleranceByDevice(e.device)}).handled?(e.device==="mouse"?this.handleGeoTapMove(e):(o.onPreviewChange(),this.updateGeoHoveredObjects()),o.getToolMode()==="expression-edit"&&t.preventDefault(),!0):!1}updatePointerState(e){var n;let t=e.target&&e.target instanceof HTMLElement&&e.target.closest(".dcg-geometry-toolbar-view"),o=this.isEventWithinInstance(e),i;return e.type==="dcg-tapstart"?i=!0:e.type==="dcg-tapend"?i=!1:i=!!((n=this.pointerState)!=null&&n.isPressed),this.pointerState={mathPoint:this.convertTouchEventToMathPoint(e),device:e.device,shift:!!e.shiftKey,isPressed:i,isOnToolbar:t,isWithinInstance:o},(e.type==="dcg-tapmove"||e.type==="dcg-tapstart")&&this.updateClickToInsertMode(),this.pointerState}updateClickToInsertMode(){var o;let e=this.pointerState;if(!e||!this.controller.isGeometry()||((o=this.controller.getFocusLocation())==null?void 0:o.type)!=="expression")return;let t=this.controller.getGeoModel();t.getClickToInsertMode()!=="permissive"&&e.shift?t.getObjectDefUnderMouse(e.mathPoint,this.getToleranceByDevice(e.device),{shouldUseJitEdges:()=>!0,isValidNextInputType:()=>!0})&&this.controller.dispatch({type:"update-click-to-insert-mode",clickToInsertMode:"permissive"}):t.getClickToInsertMode()==="permissive"&&!e.shift&&this.controller.dispatch({type:"update-click-to-insert-mode",clickToInsertMode:"valid-type"})}handleShiftKeyChange(e){let t=this.pointerState;if(!(!t||t.shift===e)&&(t.shift=e,this.updateClickToInsertMode(),this.controller.isGeoToolActive())){let o=this.controller.getGeoModel();o.onMouseAction("move",{pt:t.mathPoint,shift:t.shift,tolerance:this.getToleranceByDevice("mouse")}),o.onPreviewChange()}}handleGeoTapMove(e){let t=this.controller.getGeoModel(),o;return!e.isOnToolbar&&(e.isWithinInstance||e.isPressed)?o=t.onMouseAction("move",{pt:e.mathPoint,shift:e.shift,tolerance:this.getToleranceByDevice(e.device)}).handled:(t.onMouseAction("move",{pt:{x:NaN,y:NaN},shift:!1,tolerance:0}),o=!0),t.onPreviewChange(),o}replayGeoTapMove(){let e=this.controller.getGeoModel(),t=this.pointerState;t&&(e.onMouseAction("move",{pt:{...t.mathPoint},shift:t.shift,tolerance:this.getToleranceByDevice("mouse")}),e.onPreviewChange())}handleGeoTapEnd(e,t){var l;let o=this.controller.getGeoModel(),i=this.canceledGeoToolplayWhilePressed?{committed:void 0}:o.onMouseAction("release",{pt:e.mathPoint,shift:e.shift,tolerance:this.getToleranceByDevice(e.device)});this.canceledGeoToolplayWhilePressed=!1,i.committed&&this.controller.dispatch({type:"commit-geo-objects",shiftKey:e.shift,...i}),e.isWithinInstance&&e.device==="mouse"?this.handleGeoTapMove(e):o.onPreviewChange();let n=this.controller.getActiveTool(),a=o.getCurrentTool(),s=(l=a.getSpec)==null?void 0:l.call(a);this.speakGeoReleaseAction(n,s,i.committed),o.getToolMode()==="expression-edit"&&t.preventDefault()}isEventWithinInstance(e){return e.target?this.manager.elt.contains(e.target):!1}updateGeoHoveredObjects(){let e=this.controller.getGeoModel(),t={};e.getHoveredItems().forEach(o=>{let i;if("tokenId"in o){let n=this.controller.getGeoTokenInfoFromIdentifier(__dcg_shared_module_exports__['ac'](o.tokenId));i=n&&n.calcId}else i=o.calcId;if(i!==void 0){let n=t[i];n?o.listIndex===void 0?n.listIndexes=void 0:n.listIndexes!==void 0&&(n.listIndexes[o.listIndex]=!0):t[i]={listIndexes:o.listIndex===void 0?void 0:{[o.listIndex]:!0}}}}),this.manager.clickableObjectsLayer.setHoveredObjects(t),this.manager.movablePointsLayer.setGeoHoveredObjects(this.controller.getActiveTool()==="point"?{}:t)}cancelGeoToolplay(){var e;this.canceledGeoToolplayWhilePressed=!!((e=this.pointerState)!=null&&e.isPressed),this.updateGeoHoveredObjects()}startBoxSelect(e){let t={};this.controller.getAllSelectedItems().forEach(n=>t[n.id]=!0);let o=this.manager.getProjection().reverse_map_pt(this.getMouseRelativeToGrapher(e)),i;this.addGlobalMouseListener("dcg-tapmove",n=>{i=this.manager.getProjection().reverse_map_pt(this.getMouseRelativeToGrapher(n));let a={left:Math.min(o.x,i.x),top:Math.min(o.y,i.y),right:Math.max(o.x,i.x),bottom:Math.max(o.y,i.y)};this.manager.setBoxSelectRectangle(a);let s=this.findIdsThatIntersectBox(a);this.controller.dispatch({type:"set-all-selected-ids",ids:{...t,...s}})}),this.addGlobalMouseListener("dcg-tapend dcg-tapcancel",n=>{this.removeAllGlobalMouseListeners(),this.manager.setBoxSelectRectangle(void 0),i||this.controller.dispatch({type:"set-none-selected"})})}};function HY(r){return{calcId:r.sketch.id,isReverseDrag:!1,scaleFactor:r.type==="movable-point"?r.scaleFactor:void 0,tableInfo:r.type==="movable-point"?r.tableInfo:void 0}}var KI=class{constructor(e){this.savedPOI=[],this.controller=e}redrawToCtx(e,t,o,i,n){let{ctx:a,projection:s}=e,l=[];for(let c of zC(n)){let d=t[c];if(!d)continue;if(d.hoistToTop&&!this.controller.isGeometry()){let u=d.showHighlight;u&&e.projection.settings.setProperty("highlight",!0),Su.drawSketchToCtx({sketch:d,drawContext:e,poiLabelsLayer:o,clickableObjectsLayer:i,geometryContext:this.controller.getGeoModel()}),u&&e.projection.settings.setProperty("highlight",!1)}let p=d.getPOI();(d.showPOI||p.length&&p[0].isAttachedToPlottedPoint())&&l.push.apply(l,this.drawPOIs(p,a,s))}this.savedPOI=l}getDrawnPOI(){return this.savedPOI}drawPOIs(e,t,o){t.lineWidth=o.settings.pointLineWidth,t.strokeStyle="#AAAAAA",t.fillStyle="#AAAAAA",t.lineJoin="round",t.lineCap="round";let i=[];if(e.length&&e[0].isAttachedToPlottedPoint())for(let n of e)Su.mapPointToScreen(o,n.x,n.y)&&i.push(n);else for(let n of e)Su.drawPointToCtx({ctx:t,projection:o,...n})&&i.push(n);return i}};tu();var Qh=__dcg_shared_module_exports__['e'](Z()),WI=class extends Qh.Class{template(){return Qh.createElement("div",{class:this.const(rx),style:()=>({width:this.props.width(),height:this.props.height(),position:"fixed",left:"0px",top:"0px"})},Qh.createElement("div",{class:Qh.const("dcg-container")},Qh.createElement("div",{class:Qh.const("dcg-grapher"),style:()=>({"font-size":this.props.concreteFontSize()})})))}};var D2e=__dcg_shared_module_exports__['e'](Z());var Ep=class extends Sp{generateDefaultName(){return"does not matter"}};var KY="graphing-calculator-text-geometry-tool-rotation-hint-center",ehe="graphing-calculator-text-geometry-tool-rotation-hint-angle",the="graphing-calculator-text-geometry-tool-rotation-hint-angle-start",rhe="graphing-calculator-text-geometry-tool-rotation-hint-angle-end",Fb=class extends Ep{constructor(t){super(t);this.model=t;this.displayName="graphing-calculator-text-geometry-tool-rotate-display-name",this.toolName="rotation",this.toolType="transformation"}getMode(){let{idMap:t}=this.model.getNonObjectsState().ui.currentTool;return t["2-number"]?"number":"directed-angle"}getExpressionEditHint(t){return t===0?this.s(KY):this.s(ehe)}onNumberInput(t){super.onNumberInput(t),this.clearTentativeOutputs()}onMove(t){return this.getMode()==="number"&&this.model.getNonObjectsState().ui.currentTool.inputIndex===1?!1:super.onMove(t)}getSpecIdToLockIn(t,o){if(o===1){let i=t.inputs[o];return this.getMode()==="number"?`${i.id}-number`:i.id}return super.getSpecIdToLockIn(t,o)}getPartialAnglePreviewInfo(){let{inputIndex:t,idMap:o}=this.model.getNonObjectsState().ui.currentTool;if(t>0){let i=this.model.findDefsForInputId(o[1])[0];if(!i)return;let n=[i.typedRuntimeValue],a=this.model.findDefsForInputId(o[2])[0],s=this.model.findDefsForInputId(o[3])[0];if(a&&s&&n.push(a.typedRuntimeValue,s.typedRuntimeValue),i)return{id:o["angle-output"],type:"rotation-with-incomplete-angle",args:n}}}getSpec(){let t={inputs:[{type:"point",id:"1",hint:KY},{type:"union",valueTypes:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['Ca']],id:"2",hint:the,numberInputInfo:{defaultLatex:"",sliderInfo:{value:this.model.controller.getDegreeMode()?"90":"1.57079632679",min:"0",max:this.model.controller.getDegreeMode()?"360":"2\\pi"}}}],outputs:[]},o={id:"number-output",type:"rotate",hidden:this.getMode()!=="number",name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"},{type:"reference-input",id:"2-number"}]};if(this.getMode()==="directed-angle"){let{idMap:i,inputIndex:n}=this.model.getNonObjectsState().ui.currentTool;n>1&&delete t.inputs[1].numberInputInfo;let a=i[2],s=!1,l=a&&this.model.findDefsForInputId(a)[0];s=!!(l&&l.typedRuntimeValue.valueType==__dcg_shared_module_exports__['da']),s?(t.inputs.push({type:"point",id:"3",hint:rhe}),t.outputs.push({id:"directed-angle",type:"directedangle",hidden:!1,showAngleLabel:!1,parents:[{type:"reference-input",id:"2"},{type:"reference-input",id:"1"},{type:"reference-input",id:"3"}]},{id:"angle-output",type:"rotate",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"},{type:"reference-input",id:"directed-angle"}]})):t.outputs.push({id:"angle-output",type:"rotate",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"},{type:"reference-input",id:"2"}]})}else t.outputs.push(o);return t}};var WY="graphing-calculator-text-geometry-tool-vector-hint-start",ohe="graphing-calculator-text-geometry-tool-vector-hint-end",ihe="graphing-calculator-text-geometry-tool-vector-copy-hint-end",nhe={name:"vector",displayName:"graphing-calculator-text-geometry-tool-vector-display-name",toolType:"simple",icon:[{type:"stroked-path",path:[32,68,65,35],lineWidth:"large",arrow:!0},{type:"point",x:32,y:68},{type:"point",x:68,y:32}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[WY,ohe]},output:[{type:"vector",parents:[0,1]}]},{input:{broadcast:!1,types:[__dcg_shared_module_exports__['Ga'],__dcg_shared_module_exports__['da']],hints:[WY,ihe]},output:[{type:"vector-copy",parents:[0,1]}]}]},XC=class extends yo{constructor(t){super(t,nhe);this.model=t}};function ahe(r){return Array.isArray(r)&&r.length===2&&r.every(e=>Array.isArray(e)&&e.length===2&&e.every(t=>!Array.isArray(t)&&!isNaN(t)))}function Nb(r){if(!ahe(r))return __dcg_shared_module_exports__['tc'](__dcg_shared_module_exports__['Ga']);let e=r[1][0],t=r[1][1],o=r[1][0]+r[0][0],i=r[1][1]+r[0][1];return[[e,t],[o,i]]}var she=14,$Y=2.5,lhe=40,che=15,dhe=.75,phe=1;function Rm(r){return r.valueType===__dcg_shared_module_exports__['da']?r.value:r.valueType===__dcg_shared_module_exports__['ia']?r.value[0]:void 0}function uhe(r){return r.valueType===__dcg_shared_module_exports__['Ga']?r.value:r.valueType===__dcg_shared_module_exports__['Ha']?r.value[0]:void 0}function hhe(r){return r.valueType===__dcg_shared_module_exports__['wa']||r.valueType===__dcg_shared_module_exports__['ya']||r.valueType===__dcg_shared_module_exports__['qa']||r.valueType===__dcg_shared_module_exports__['Ga']?{segment:r.valueType===__dcg_shared_module_exports__['qa'],value:r.value}:r.valueType===__dcg_shared_module_exports__['xa']||r.valueType===__dcg_shared_module_exports__['za']||r.valueType===__dcg_shared_module_exports__['ra']||r.valueType===__dcg_shared_module_exports__['Ha']?{segment:r.valueType===__dcg_shared_module_exports__['ra'],value:r.value[0]}:void 0}function jY(r){return r.valueType===__dcg_shared_module_exports__['ba']?r.value:r.valueType===__dcg_shared_module_exports__['ga']?r.value[0]:void 0}function YY(r){return r.valueType===__dcg_shared_module_exports__['Ca']?r.value:r.valueType===__dcg_shared_module_exports__['Da']?r.value[0]:void 0}var $I=class{constructor(e){this.controller=e.controller}getTransformationPreviewInfoFromItem(e,t){var n;if(e.type!=="expression"||e.hidden)return;let{translationsWithVisibleVectorParent:o}=t.transformationPreviewParentData;if(o.has(e.id))return;let i=(n=e.formula.geometry)==null?void 0:n.transformation_preview_info;if(i)return{...i,id:e.id}}getInprogressTransformation(e){let t=this.controller.getAllToolPreviewItems();for(let i of t){let n=this.getTransformationPreviewInfoFromItem(i,e);if(n)return n}let o=this.controller.getGeoModel().getCurrentTool();if(o instanceof Fb)return o.getPartialAnglePreviewInfo()}getHoveredOrSelectedTransformations(e){let t=this.controller.getAllSelectedItems(),o=this.controller.getHoveredOrFocusedTokenIdentifier(),i=o?this.controller.getItemsByIdentifier(o)[0]:void 0;i&&!t.some(a=>a.id===i.id)&&t.push(i);let n=[];return t.forEach(a=>{if(a.type!=="expression")return;let s=this.getTransformationPreviewInfoFromItem(a,e);s&&n.push(s)}),n}drawTranslationPreview(e,t,o,i){let n=t.mapx(o[0]),a=t.mapy(o[1]),s=t.mapx(i[0]),l=t.mapy(i[1]);e.save(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=5,e.moveTo(n,a),e.lineTo(s,l),bp(e,n,a,s,l,20),e.stroke(),e.restore()}drawReflectionPreview(e,t,o){let i=o.value,n=o.segment,[a,s,l,c]=yb([i[0][0],i[0][1],i[1][0],i[1][1]],t,18).clipped,d=(a+l)/2,p=(s+c)/2;if(n){let[C,v,E,_]=yb([i[0][0],i[0][1],i[1][0],i[1][1]],t,17).clipped;d=(C+E)/2,p=(v+_)/2}if(isNaN(d)&&isNaN(p))return;let u=40,h=u/__dcg_shared_module_exports__['Lb'](a-l,s-c),m=d+(c-s)*h,y=p-(l-a)*h,w=d-(c-s)*h,S=p+(l-a)*h;if(e.save(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=4,e.moveTo(a,s),e.lineTo(l,c),this.controller.getGraphSettings().config.reflectionArc){let C=Math.atan2(y-p,m-d),v=u,E=u*.7;e.moveTo(m,y),e.ellipse(d,p,v,E,C,0,Math.PI,!1);let _=.35,T=C+Math.PI/2+_,I=C+Math.PI/2-_;bp(e,m+Math.cos(T),y+Math.sin(T),m,y,10),bp(e,w+Math.cos(I),S+Math.sin(I),w,S,10)}else e.moveTo(m,y),e.lineTo(w,S),bp(e,d,p,m,y,10),bp(e,d,p,w,S,10);e.stroke(),e.restore()}drawDilationPreview(e,t,o,i){e.save(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=3;let n=i<.6||i>1.4&&i<2?6:10,a=t.pixelsToMath.mapX(25)-t.pixelsToMath.mapX(0);[[a,0],[0,a],[-a,0],[0,-a]].forEach(s=>{let l=[o[0]+s[0],o[1]+s[1]],c=__dcg_shared_module_exports__['Uc'](__dcg_shared_module_exports__['Rc'](o,i),l),[d,p]=t.map_xy_pairs(l),[u,h]=t.map_xy_pairs(c);e.moveTo(d,p),e.lineTo(u,h),bp(e,d,p,u,h,n)}),e.stroke(),e.restore()}drawRotationPreview(e,t,o,i,n,a){if(this.drawRotationCenterPreview(e,t,o),!(n===void 0||!isFinite(n))){if(a!==void 0&&a!==0&&isFinite(a)){if(i&&i[0]===o[0]&&i[1]===o[1])return;this.drawFullRotationAngle(e,t,o,n,a,!1)}else if(i){this.drawPlaceholderRotationAngle(e,t,i,n);return}}}drawFullRotationAngle(e,t,o,i,n,a){e.save(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=$Y;let s=lhe,l=-i,c=-n,d,p;if(a){let S=yb([o[0],o[1],o[0]+Math.cos(i),o[1]+Math.sin(i)],t,19).clipped;d=S[0],p=S[1];let C=yb([o[0],o[1],o[0]+Math.cos(i+n),o[1]+Math.sin(i+n)],t,19).clipped;e.moveTo(d,p),e.lineTo(S[2],S[3]),e.moveTo(d,p),e.lineTo(C[2],C[3]);let v=s*Math.abs(c),E=.5*(1-dhe)*v,_=Math.min(E,che),T=(c>0?1:-1)*_/s;l+=T,c-=2*T}else[d,p]=t.map_xy_pairs(o);let u=c<=0,h=d+s*Math.cos(l),m=p+s*Math.sin(l),y=d+s*Math.cos(l+c),w=p+s*Math.sin(l+c);e.moveTo(h,m),e.arc(d,p,s,l,l+c,u),YR(e,y,w,l,c,10,s),e.stroke(),e.restore()}drawPlaceholderRotationAngle(e,t,o,i){e.save(),e.beginPath(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=phe;let n=-i,[a,s]=t.map_xy_pairs(o);e.moveTo(a,s);let l=1.5*vm(0,t);e.lineTo(a+l*Math.cos(n),s+l*Math.sin(n)),e.stroke(),e.restore()}drawRotationCenterPreview(e,t,o){let[i,n]=t.map_xy_pairs(o);e.save(),e.strokeStyle="rgba(0,0,0,.2)",e.lineWidth=$Y,e.beginPath(),e.arc(i,n,she,0,2*Math.PI),e.stroke(),e.restore()}redrawToCtx(e){let{ctx:t,projection:o}=e,i=this.getInprogressTransformation(e),n=this.getHoveredOrSelectedTransformations(e);i&&n.push(i);for(let a=0;a<n.length;a++){let s=n[a],l=s.args;switch(s.type){case"translate":if(l.length===2){let c=Rm(l[0]),d=Rm(l[1]);c&&d&&this.drawTranslationPreview(t,o,c,d)}else if(l.length===1){let c=uhe(l[0]);if(c){let[d,p]=Nb(c);this.drawTranslationPreview(t,o,d,p)}}break;case"reflect":{let c=hhe(l[0]);c&&this.drawReflectionPreview(t,o,c)}break;case"dilate":{let c=Rm(l[0]),d=jY(l[1]);c&&d!==void 0&&isFinite(d)&&d!==1&&this.drawDilationPreview(t,o,c,d)}break;case"rotate":{let c=Rm(l[0]);if(!c)return;let d=jY(l[1]),p=YY(l[1]),u,h;if(d!==void 0)h=this.controller.getDegreeMode()?d*Math.PI/180:d,u=0;else if(p)u=p[1],h=p[2],e.transformationPreviewParentData.rotationsWithVisibleAndCenteredAngle.has(s.id)&&(h=void 0);else return;this.drawRotationPreview(t,o,c,p?p[0]:void 0,u,h)}break;case"rotation-with-incomplete-angle":{let c=Rm(l[0]);if(!c)return;let d,p;if(l.length>=3){let u=Rm(l[1]);if(d=Rm(l[2]),!c||!u||!d)return;let h=u[0]-d[0],m=u[1]-d[1];p=Math.atan2(m,h)}this.drawRotationPreview(t,o,c,d,p,void 0)}}}}};function XY(r){var c,d,p,u,h,m,y,w,S,C;let e=new Set,t=new Set,o=new Set,i=new Set,n={},a={};for(let v of[...r.getAllItemModels(),...r.getAllToolPreviewItems()]){if(v.type!=="expression"||ma(v))continue;let E=v.formula.typed_constant_value;if(!E)continue;if(__dcg_shared_module_exports__['fb'](E.valueType,__dcg_shared_module_exports__['Ga'])){let T=(c=xn(v))==null?void 0:c.identifier;T&&(n[T]=v.id)}let _=YY(E);if(_){let T=(d=xn(v))==null?void 0:d.identifier;T&&(a[T]={id:v.id,value:_})}}let s=r.getHoveredOrFocusedTokenIdentifier(),l=[...r.getAllItemModels().filter(v=>{var E;if(r.isItemSelected(v.id))return!0;if(v.type==="expression"&&s){let _=(E=xn(v))==null?void 0:E.identifier;return s===_}return!1}),...r.getAllToolPreviewItems()];for(let v of l){if(v.type!=="expression")continue;let E=v.formula.geometry,_=E==null?void 0:E.transformation_preview_info;if(((p=E==null?void 0:E.call)==null?void 0:p.symbol)==="translate"&&(_==null?void 0:_.args.length)===1&&__dcg_shared_module_exports__['fb'](_.args[0].valueType,__dcg_shared_module_exports__['Ga'])){let T=(m=(h=(u=v.formula.geometry)==null?void 0:u.call)==null?void 0:h.parents)==null?void 0:m[0];if(!T||T.type==="arbitrary-expression")continue;let I=n[__dcg_shared_module_exports__['fd'](T)];I&&(e.add(v.id),t.add(I))}if(((y=E==null?void 0:E.call)==null?void 0:y.symbol)==="rotate"&&(_!=null&&_.args)&&(_==null?void 0:_.args.length)>1&&__dcg_shared_module_exports__['fb'](_.args[1].valueType,__dcg_shared_module_exports__['Ca'])){let T=(C=(S=(w=v.formula.geometry)==null?void 0:w.call)==null?void 0:S.parents)==null?void 0:C[1];if(!T||T.type==="arbitrary-expression")continue;let I=a[__dcg_shared_module_exports__['fd'](T)];if(!I)continue;i.add(I.id);let P=Rm(_.args[0]);if(!P)continue;I.value[0][0]===P[0]&&I.value[0][1]===P[1]&&o.add(v.id)}}return{translationsWithVisibleVectorParent:e,translationPreviewVectorParents:t,rotationsWithVisibleAndCenteredAngle:o,rotationPreviewAngleMarkerParents:i}}var dl=class dl{constructor(e=0,t=0,o=1,i=o){this.tx=e,this.ty=t,this.sx=o,this.sy=i}toJSON(){return{tx:this.tx,ty:this.ty,sx:this.sx,sy:this.sy}}compose(e){return new dl(this.sx*e.tx+this.tx,this.sy*e.ty+this.ty,this.sx*e.sx,this.sy*e.sy)}translate(e,t){let o=t===void 0?e.x:t.x-e.x,i=t===void 0?e.y:t.y-e.y;return new dl(this.tx+o,this.ty+i,this.sx,this.sy)}scale(e,t){return dl.scale(e,t).compose(this)}scaleAtPoint(e,t,o=t){return dl.scaleAtPoint(e,t,o).compose(this)}mapX(e){return this.sx*e+this.tx}mapY(e){return this.sy*e+this.ty}mapPoint(e){return{x:this.mapX(e.x),y:this.mapY(e.y)}}mapRect(e){return{left:this.mapX(e.left),right:this.mapX(e.right),bottom:this.mapY(e.bottom),top:this.mapY(e.top)}}};dl.scale=function(e,t=e){return new dl(0,0,e,t)},dl.translate=function(e,t){return new dl().translate(e,t)},dl.scaleAtPoint=function(e,t,o=t){return o===void 0&&(o=t),new dl(e.x*(1-t),e.y*(1-o),t,o)},dl.fromRects=function(e,t){let o=(t.right-t.left)/(e.right-e.left),i=(t.top-t.bottom)/(e.top-e.bottom);return new dl(t.left-o*e.left,t.bottom-i*e.bottom,o,i)},dl.fromJSON=function(e){return new dl(e.tx,e.ty,e.sx,e.sy)};var Zh=dl;$t();var{log10:jI}=Math;function j3(r,e){let t=e.x-r.x,o=e.y-r.y,i=.5*(r.x+e.x),n=.5*(r.y+e.y),a=.5*__dcg_shared_module_exports__['Lb'](t,o);return{center:pl(i,n),radius:a}}function JY(r,e){let t={x:2*r.x-e.x,y:2*r.y-e.y};return j3(e,t)}function QY(r,e){let t=[];for(let o=0;o<r.length;o++)t.push(pl(r[o].pageX-e.left,r[o].pageY-e.top));return t}function pl(r,e){return{x:r,y:e}}function ZY(r){return pl(.5*(r.left+r.right),.5*(r.bottom+r.top))}var fhe=0,YI=class{constructor(e,t){this.s=Id(()=>this.grapher.settings.config.language);this.grapher=e,this.elt=e.elt,this.id=fhe++,this.controller=t,this.isScalingEnabled=!1,this.mousePt=pl(0,0),this.lastScrollZoom=Date.now(),this.preventScrollZoom=!1,this.addMouseWheelEventHandler(),this.addTouchEventHandler()}remove(){re(window).off(".viewportcontroller-"+this.id)}getViewport(){return this.grapher.getProjection().viewport}getProjection(){return this.grapher.getProjection()}isViewportLocked(){let e=this.getProjection().settings;return e.config.lockViewport||e.userLockedViewport}updateMouse(e){let t=this.elt.getBoundingClientRect();this.mousePt=pl(e.clientX-t.left,e.clientY-t.top)}updateScaleAxis(){this.isMouseInViewport()&&(this.isMouseNearYAxis()?this.grapher.scaleAxis="y":this.isMouseNearXAxis()?this.grapher.scaleAxis="x":this.grapher.scaleAxis="both"),this.updateCursor(),this.controller.requestRedrawGraph()}updateCursor(){this.elt.classList.toggle("dcg-scale-horizontal",this.grapher.scaleAxis==="x"),this.elt.classList.toggle("dcg-scale-vertical",this.grapher.scaleAxis==="y"),this.elt.classList.toggle("dcg-scale-both",this.grapher.scaleAxis==="both")}isMouseNearOrigin(){let t=this.getProjection().mathToPixels.mapPoint(pl(0,0));return Math.abs(this.mousePt.x-t.x)<50&&Math.abs(this.mousePt.y-t.y)<50}isMouseNearXAxis(){let e=this.getProjection(),t=e.pixelCoordinates,o=e.mathToPixels.mapY(0);return o=Math.min(Math.max(t.top,o),t.bottom),Math.abs(this.mousePt.y-o)<40&&e.settings.showXAxis}isMouseNearYAxis(){let e=this.getProjection(),t=e.pixelCoordinates,o=e.mathToPixels.mapX(0);return o=Math.min(Math.max(t.left,o),t.right),Math.abs(this.mousePt.x-o)<40&&e.settings.showYAxis}isMouseInViewport(){let e=this.getProjection(),t=e.mathCoordinates,o=e.pixelsToMath.mapPoint(this.mousePt);return o.x>=t.left&&o.x<=t.right&&o.y>=t.bottom&&o.y<=t.top}_setViewportWithoutCancellingAnimation(e){if(!e.isValid(this.controller.getAxisScaleSettings())||e.equals(this.getViewport()))return;let o=this.getProjection();this.grapher._setProjection(new kc(o.screen,e,o.settings))}setViewport(e){this.cancelAnimation(),this._setViewportWithoutCancellingAnimation(e)}setScreen(e){let t=this.getProjection(),o=t.settings.squareAxes?t.viewport.squareYAxis(e,t.settings):t.viewport,i=new kc(e,o,t.settings);this.grapher._setProjection(i)}getTransformedViewport(e){let{pixelCoordinates:t,mathCoordinates:o,settings:i}=this.getProjection(),{xAxisScale:n,yAxisScale:a}=i,s=e.mapRect(t),l=__dcg_shared_module_exports__['Nd'].fromRectsInverse(o,s,{xAxisScale:n,yAxisScale:a}).mapRect(t);return new Co(l.left,l.right,l.bottom,l.top)}transformViewport(e){this.setViewport(this.getTransformedViewport(e)),(this.grapher.scaleAxis==="x"||this.grapher.scaleAxis==="y")&&this.controller.markSquareAxesAfterUserEditedViewport()}animateToViewport(e){this.cancelAnimation();let t=this.getProjection(),o=t.viewport,i=t.mathToPixels,n=0,a,s=l=>{a||(a=l);let c=(l-a)/500;if(n+=c,n<1){this.__animationTimeout=requestAnimationFrame(s);let d=i.interpolateX(o.xmin,e.xmin,n),p=i.interpolateX(o.xmax,e.xmax,n),u=i.interpolateY(o.ymin,e.ymin,n),h=i.interpolateY(o.ymax,e.ymax,n);this._setViewportWithoutCancellingAnimation(new Co(d,p,u,h)),this.grapher.debounceUserRequestedViewportChange()}else this.setViewport(Co.fromObject(e)),this.grapher.debounceUserRequestedViewportChange(),this.controller.markSquareAxesAfterUserEditedViewport()};this.__animationTimeout=requestAnimationFrame(s)}cancelAnimation(){cancelAnimationFrame(this.__animationTimeout)}addMouseWheelEventHandler(){let e=!1,t,o;re(window).on("scroll.viewportcontroller-"+this.id,a=>{e=!0}),re(window).on("wheel.viewportcontroller-"+this.id,a=>{t=a.clientX,o=a.clientY}),re(window).on("mousemove.viewportcontroller-"+this.id,a=>{if(!e)return;let s=a.clientX-t,l=a.clientY-o;s*s+l*l<100||(e=!1)});let i=0,n=a=>{let s=a.originalEvent;if(s.deltaX===0&&s.deltaY===0)return;let l=Date.now(),c=l-this.lastScrollZoom;if(this.preventScrollZoom&&c>50&&(this.preventScrollZoom=!1),this.lastScrollZoom=l,this.preventScrollZoom)return;let d=this.getProjection();if(this.isViewportLocked())return;let p=d.mathToPixels;if(e)return;s.preventDefault(),this.updateMouse(s);let u=p.mapPoint(pl(0,0)),m=(s.deltaY===0?-s.deltaX:-s.deltaY)>0?1:-1,y=this.isMouseNearOrigin()&&m>0?u:this.mousePt;if(i>0)return;i+=1,requestAnimationFrame(()=>{i--});let{xAxisScale:w,yAxisScale:S}=d.settings,C=.0625;(w==="logarithmic"||S==="logarithmic")&&c<25&&(C*=Math.max(10,c)/25);let v=m>0?1+C:1/(1+C),E=this.grapher.scaleAxis,_=E==="x"||E==="both"||!E?v:1,T=E==="y"||E==="both"||!E?v:1,I=Zh.scaleAtPoint(y,_,T),P=this.getTransformedViewport(I);m==-1&&this.tooBig(P)||m==1&&this.tooSmall(P)||(this.transformViewport(I),this.grapher.debounceUserRequestedViewportChange())};re(this.elt).on("wheel",n)}applyPanTouchChanges(e,t){if(this.isViewportLocked()||this.isScalingEnabled)return;let o=pl(t[0].x-e[0].x,t[0].y-e[0].y);this.transformViewport(Zh.translate(o)),this.grapher.debounceUserRequestedViewportChange()}chooseDragScaleCenter(){let e=this.getProjection(),t=e.pixelCoordinates,o=e.mathToPixels.mapX(0),i=e.mathToPixels.mapY(0);return o=Math.min(Math.max(t.left,o),t.right),i=Math.min(Math.max(t.top,i),t.bottom),pl(o,i)}applyScaleTouchChanges(e,t){if(this.isViewportLocked())return;let o=this.grapher.scaleAxis,i,n;if(e.length===2&&t.length===2)i=j3(e[0],e[1]),n=j3(t[0],t[1]);else if(t.length===1){let p=this.chooseDragScaleCenter();i=JY(p,e[0]),n=JY(p,t[0])}else return;let a=n.radius/i.radius,s=o==="y"?1:a,l=o==="x"?1:a,c=Zh.scaleAtPoint(i.center,s,l).translate(i.center,n.center),d=this.getTransformedViewport(c);a<1&&this.tooBig(d)||a>1&&this.tooSmall(d)||(this.transformViewport(c),this.grapher.debounceUserRequestedViewportChange())}panFromKeyboard(e){if(this.isViewportLocked()||this.isScalingEnabled)return;let t=pl(0,0);e==="Up"?(Te(this.s("graphing-calculator-narration-viewport-pan-up")),t=pl(0,-5)):e==="Down"?(Te(this.s("graphing-calculator-narration-viewport-pan-down")),t=pl(0,5)):e==="Left"?(Te(this.s("graphing-calculator-narration-viewport-pan-left")),t=pl(-5,0)):e==="Right"&&(Te(this.s("graphing-calculator-narration-viewport-pan-right")),t=pl(5,0)),this.transformViewport(Zh.translate(t)),this.grapher.debounceUserRequestedViewportChange()}addTouchEventHandler(){let e=[],t=!1,o=!0,i=!0,n=h=>{t||this.isViewportLocked()||(this.updateMouse(h.originalEvent),this.isScalingEnabled&&this.updateScaleAxis())};re(window).on("mousemove.viewportcontroller-"+this.id,n),this.beginPanning=h=>{let m=this.getProjection();if(this.isViewportLocked()||t||h.touches.length!==h.changedTouches.length)return;t=!0,this.grapher.isDragging=!0,this.updateMouse(h);let y=m.mathToPixels.mapPoint(pl(0,0)),w=this.grapher.scaleAxis;(w==="x"||w==="both")&&(o=this.mousePt.x>y.x),(w==="y"||w==="both")&&(i=this.mousePt.y>y.y),this.controller.dispatch({type:"grapher/drag-start"}),re(document).on("dcg-tapmove.graphdrag",p),re(document).on("dcg-tapstart.graphdrag dcg-tapend.graphdrag dcg-tapcancel.graphdrag",u)};let a=h=>{if(h.length<2)return;let m=this.grapher.getProjection(),y=m.pixelCoordinates,w=m.mathToPixels.mapX(0),S=m.mathToPixels.mapY(0),C=40;w=Math.min(Math.max(y.left,w),y.right),S=Math.min(Math.max(y.top,S),y.bottom);let v=h[1].x-h[0].x,E=h[1].y-h[0].y;return Math.abs(h[0].x-w)<C&&Math.abs(h[1].x-w)<C&&Math.abs(E)>3*Math.abs(v)&&m.settings.showYAxis?"y":Math.abs(h[0].y-S)<C&&Math.abs(h[1].y-S)<C&&Math.abs(v)>3*Math.abs(E)&&m.settings.showXAxis?"x":"both"},s=h=>(this.grapher.scaleAxis||(this.grapher.scaleAxis=a(h)),this.grapher.scaleAxis),l=()=>{this.grapher.scaleAxis&&(this.grapher.scaleAxis=void 0,this.controller.requestRedrawGraph(),this.updateCursor())},c=()=>{this.isScalingEnabled=!1,this.preventScrollZoom=!0,l()},d=h=>h.altKey||h.ctrlKey||h.metaKey,p=h=>{let m=h;if(!t||this.isViewportLocked())return;let y=QY(m.touches,wi(this.elt));if(e.length===2&&y.length===2)s(y),this.applyScaleTouchChanges(e,y);else if(e.length===1&&this.isScalingEnabled){this.updateMouse(m);let w=this.grapher.scaleAxis,C=this.getProjection().mathToPixels.mapPoint(pl(0,0)),v,E,_=5,T=o?1:-1,I=i?1:-1;if((w==="x"||w==="both")&&(v=this.mousePt.x>C.x+_*T),(w==="y"||w==="both")&&(E=this.mousePt.y>C.y+_*I),w==="x"&&o!==v||w==="y"&&i!==E||w==="both"&&o!==v&&i!==E)return;this.applyScaleTouchChanges(e,y)}else l();e.length===1&&this.applyPanTouchChanges(e,y),this.controller.dispatch({type:"grapher/drag-move"}),e=y},u=h=>{let m=h;t&&(this.cancelAnimation(),e=QY(m.touches,wi(this.elt)),m.touches.length===0&&(t=!1,this.grapher.isDragging=!1,re(document).off(".graphdrag"),this.grapher.debounceUserRequestedViewportChange(),this.controller.dispatch({type:"grapher/drag-end"})),(m.touches.length===0||m.touches.length===1&&!this.isScalingEnabled)&&l())};re(window).on("keydown.viewportcontroller-"+this.id,h=>{this.controller.isGeoToolActive()||this.isViewportLocked()||(Be(h)===h0&&!d(h)&&this.shouldAllowShiftScaling()?(this.isScalingEnabled=!0,this.grapher.scaleAxis||this.updateScaleAxis()):c())}),re(window).on("keyup.viewportcontroller-"+this.id+" blur.viewportcontroller-"+this.id,c)}shouldAllowShiftScaling(){return!this.controller.isGeometry()}zoom(e){let t=this.getProjection().pixelCoordinates;if(e==="in"){let o=this.getTransformedViewport(Zh.scaleAtPoint(ZY(t),2));this.tooSmall(o)||this.animateToViewport(o),Te(this.s("graphing-calculator-narration-viewport-zoom-in"))}else if(e==="out"){let o=this.getTransformedViewport(Zh.scaleAtPoint(ZY(t),.5));this.tooBig(o)||this.animateToViewport(o),Te(this.s("graphing-calculator-narration-viewport-zoom-out"))}else if(e==="square"){let o=this.getSquareViewport();this.getProjection().settings.setProperty("squareAxes",!0),this.animateToViewport(o),Te(this.s("graphing-calculator-narration-viewport-zoom-square"))}else e==="default"&&this.setDefaultViewport()}tooBig(e){let t=this.getProjection(),{xAxisScale:o,yAxisScale:i}=t.settings,{xmin:n,xmax:a,ymin:s,ymax:l}=e;return o==="logarithmic"&&jI(a)-jI(n)>60||i==="logarithmic"&&jI(l)-jI(s)>60||this.controller.isGeometry()&&a-n>1e5}tooSmall(e){let{xmin:t,xmax:o}=e;return this.controller.isGeometry()&&o-t<1e-4}zoomSquareImmediately(){this.setViewport(this.getSquareViewport())}zoomCustom(e){this.animateToViewport(e),Te(this.s("graphing-calculator-narration-viewport-updated"))}setDefaultViewport(){let e=this.controller.getDefaultViewport();this.animateToViewport(e),Te(this.s("graphing-calculator-narration-viewport-default"))}isDefaultViewportRestored(){let e=this.getProjection(),{xAxisScale:t,yAxisScale:o}=e.settings,i=t==="linear",n=o==="linear",a=e.viewport,s=this.controller.getDefaultViewport(),l=i?a.xmax-a.xmin:Math.log(a.xmax/a.xmin),c=n?a.ymax-a.ymin:Math.log(a.ymax/a.ymin),d=i?a.xmin-s.xmin:Math.log(a.xmin/s.xmin),p=i?a.xmax-s.xmax:Math.log(a.xmax/s.xmax),u=n?a.ymin-s.ymin:Math.log(a.ymin/s.ymin),h=n?a.ymax-s.ymax:Math.log(a.ymax/s.ymax),m=.025;return Math.abs(d/l)<m&&Math.abs(p/l)<m&&Math.abs(u/c)<m&&Math.abs(h/c)<m}getSquareViewport(){let e=this.getProjection();return e.settings.lastChangedAxis==="y"?e.viewport.squareXAxis(e.screen,e.settings):e.viewport.squareYAxis(e.screen,e.settings)}};function bhe(){return new rd(1024,768)}function eX(r){let{xAxisScale:e,yAxisScale:t}=r;return new Co(...e==="linear"?[-ym,ym]:[10**-xm,10**xm],...t==="linear"?[-ym,ym]:[10**-xm,10**xm])}var yhe=document.createElement("canvas"),Bb=class r extends ov{constructor(t,o,i,n){super({elt:t,settings:o,controller:i,evaluator:n});this.type="2d";this.__screenRequested3D=new rd(768,768);this.lastActiveToken={selected:void 0,hovered:void 0};let a=bhe(),s=eX(o).squareYAxis(a,o);this.setUserRequestedViewport(s),this.__projection=new kc(a,s,o),this.markLabelsDirty=__dcg_shared_module_exports__['F'](()=>{this.evaluator.notifyWhenSynced(()=>{this.poiLabelsLayer.markLabelsDirty(),this.controller.requestRedrawGraph()})},300),this.poiController=new HI(this,o),this.viewportController=new YI(this,this.controller),this.showPOIDots=!0,this.graphSketches={},this.graphImages={},this.audioGraph=new YG(i,this),this.boxSelectLayer=new XG;let l=document.createElement("div");this.elt.appendChild(l),this.imageLayer=new KC(this),this.gridLayer=new yI,this.poiDotsLayer=new KI(this.controller),this.graphsLayer=new Su(this.controller,this.settings,p=>this.audioGraph.getExpressionAriaLabel(p)),this.transformationPreviewLayer=new $I(this),this.clickableObjectsLayer=new qC(this),this.movablePointsLayer=new CC(this);let c=document.createElement("div");this.elt.appendChild(c),this.poiLabelsLayer=JC.mountToNode(Pw,c,{grapher:()=>this});let d=document.createElement("div");this.elt.appendChild(d),this.geoKeyboardCursorLayer=JC.mountToNode(hI,d,{grapher:()=>this}),this.traceLayer=this.poiLabelsLayer,this.scaleAxis=void 0}privateGetGridLayer(){return this.gridLayer}static copyGraphProperties(t,o){t=__dcg_shared_module_exports__['nb'](hc,t);let i={...t};delete i.viewport;let n=o.validateSettings(i);for(let a in n)o.setProperty(a,n[a]);return t}remove(){this.elt.remove(),this.poiController.remove(),this.viewportController.remove(),this.audioGraph.remove()}tick(t){(this.__redrawRequested||this.poiLabelsLayer.areAnyLabelsAnimating())&&this._redrawAllLayers(),this.__movablePointListener&&this.__movablePointListener()}registerMovablePointListener(t){this.__movablePointListener=t}deregisterMovablePointListener(){this.__movablePointListener=void 0}clear(){this.graphSketches={},this.graphImages={}}getGraphSketch(t){return this.graphSketches[t]}getGraphImage(t){return this.graphImages[t]}addGraphSketch(t){this.graphSketches[t.id]=t}removeGraphSketch(t){delete this.graphSketches[t]}addGraphImage(t){t.imageObj.width&&t.imageObj.height?(this.graphImages[t.id]=t,this.controller.requestRedrawGraph()):re(t.imageObj).on("load.calc_load",()=>this.addGraphImage(t))}removeGraphImage(t){let o=this.graphImages[t];o&&re(o.imageObj).off("load.calc_load"),delete this.graphImages[t],this.controller.requestRedrawGraph()}setBoxSelectRectangle(t){this.boxSelectRectangle=t,this.controller.requestRedrawGraph()}getProjection(){return this.__projection}_setProjection(t){this.__projection=t,this.controller.requestRedrawGraph()}getAudioTrace(){return this.audioGraph}getDefaultViewport(){let t=this.getProjection();return eX(this.settings).squareYAxis(t.screen,this.settings)}_updateScreenSize(t,o){if(t<=0||o<=0)return;let n=this.getProjection().screen;if(n.width===t&&n.height===o)return;let a=new rd(t,o);this.viewportController.setScreen(a)}update(){let{top:t,left:o,width:i,height:n}=this.controller.computeMajorLayout().grapher,a=this.controller.isGraphPaperFocused()&&!this.poiController.keyboardAttentionManager.getKeyboardAttention()&&!this.controller.getSelectedGeoExpression()&&!this.geoKeyboardCursorLayer.showCursor()&&!this.controller.inAudioTraceMode()&&aH();this.elt.classList.toggle("dcg-grapher-focused",a),this.controller.isThreeDMode()&&({width:i,height:n}=this.__screenRequested3D),i>0&&n>0?(this._setIsVisible(!0),this._updateScreenSize(i,n),Yi(this.elt,{position:"absolute",left:o+"px",top:t+"px",width:i+"px",height:n+"px"})):this._setIsVisible(!1)}setActiveToken(t,o){let i=this.lastActiveToken[o];this.lastActiveToken[o]=t;let n=t&&this.getGraphSketch(t),a=i&&this.getGraphSketch(i);a!==n&&(a&&(o==="selected"?a.tokenSelected=!1:o==="hovered"&&(a.tokenHovered=!1)),n&&(o==="selected"?n.tokenSelected=!0:o==="hovered"&&(n.tokenHovered=!0))),this.controller.requestRedrawGraph()}deselectSketch(t){let o=this.getGraphSketch(t);o&&(o.selected=!1,o.showPOI=!1,o.showHighlight=!1)}selectSketch(t){let o=this.getGraphSketch(t);o&&(o.selected=!0,o.showPOI=this.controller.isTraceEnabled(),o.showHighlight=!0)}setSketchHoistedToTop(t,o){let i=this.getGraphSketch(t);i&&(i.hoistToTop=o)}updateSketch(t,o){let i=this.getGraphSketch(t);if(!o.length){this.removeGraphSketch(t);return}let n=new iv(t,o);o[0].graphMode!==15&&(n.color=o[0].color,o[0].style&&(n.style=o[0].style)),i&&n.updateFrom(i);let a=this.controller.getPropagatedSelectedIds(),s=!!a.selected[t],l=!!a.hoistedToTop[t];n.selected=s,n.tokenHovered=t===String(this.lastActiveToken.hovered),n.tokenSelected=t===String(this.lastActiveToken.selected),n.showPOI=s&&this.controller.isTraceEnabled(),n.showHighlight=s,n.hoistToTop=l,this.addGraphSketch(n)}updateIntersections(t,o){let i=this.getGraphSketch(t);i&&i.updateIntersections(o)}_clear(){let o=this.getProjection().screen;this.canvasLayer.resize(o.width,o.height),this.canvasLayer.ctx&&(this.canvasLayer.ctx.clearRect(0,0,o.width,o.height),this.controller.isThreeDMode()?this.controller.getInvertedColors()||(this.canvasLayer.ctx.fillStyle="rgba(255,255,255,0.001961)",this.canvasLayer.ctx.fillRect(0,0,o.width,o.height)):h_&&(this.controller.getInvertedColors()||(this.canvasLayer.ctx.fillStyle="rgb(0,0,0)",this.canvasLayer.ctx.fillRect(0,0,o.width,o.height))))}isDrawingPlaneFor3dMode(){return this.controller.showPlane3D()||this.controller.showNumbers3D()}createDrawContext(){if(this.canvasLayer.ctx)return{ctx:this.canvasLayer.ctx,projection:this.getProjection(),transformationPreviewParentData:XY(this.controller)}}_redrawAllLayers(){if(this.update(),!this.isVisible&&!this.isDrawingPlaneFor3dMode())return;this.__redrawRequested=!1;let t=Date.now();this._clear();let o=this.createDrawContext();this.audioGraph.recomputePoints(),this._redrawGrapher(o),this._redrawTransformationPreviewLayer(o),this._redrawBoxSelectLayer(o),this._redrawGeoKeyboardCursorLayer(),this._updateCanvasLayerAria(),this.events.triggerEvent("redraw",Date.now()-t);let i=this.controller.getGrapher3d();this.isDrawingPlaneFor3dMode()&&i&&i.webglLayer.updatePlaneMap()}_redrawTransformationPreviewLayer(t){t&&this.transformationPreviewLayer.redrawToCtx(t)}_redrawBoxSelectLayer(t){t&&this.boxSelectLayer.redrawToCtx(t,this.boxSelectRectangle)}_redrawGeoKeyboardCursorLayer(){this.geoKeyboardCursorLayer.update()}_updateCanvasLayerAria(){let t=0;for(let o in this.graphSketches)ed(this.controller,this.graphSketches[o])&&(t+=1);this.canvasLayer.updateAria(this.isVisible,t)}_redrawGrapher(t){if(!t)return;let o=this.controller.isThreeDMode();this.clickableObjectsLayer.recomputeClickableObjects(),o||(this.imageLayer.recomputeImages(t),this.movablePointsLayer.recomputeMovablePoints(t),this.poiLabelsLayer.recomputeLabels(t,this.size(),()=>this.drawLabelHitMask({projection:this.getProjection(),showMovablePoints:!0,includePillboxes:!0})));let i=n=>{this.graphsLayer.redrawToCtx(t,this.graphSketches,this.graphImages,n.drawOrder,this.poiLabelsLayer,this.clickableObjectsLayer),o||(this.poiLabelsLayer.copyToCtx(t.ctx,{filter:"canvas-labels",allowedSketches:n.drawSet}),this.movablePointsLayer.redrawToCtx(t.ctx,t.projection,n.drawOrder,{showMovablePoints:!0,renderForScreenshot:!1}))};for(let n of this.__drawLayers)n.layer<0&&i(n);this.gridLayer.redrawToCtx(t,this.scaleAxis);for(let n of this.__drawLayers)n.layer>=0&&i(n);!o&&this.showPOIDots&&this.poiDotsLayer.redrawToCtx(t,this.graphSketches,this.poiLabelsLayer,this.clickableObjectsLayer,this.__drawLayers)}size(){let t=this.canvasLayer.ctx;if(!t)return{width:0,height:0};let o=t.canvas.getBoundingClientRect();return{width:o.width,height:o.height}}_parseScreenshotOpts(t){return Y3(t,this.settings,this.getProjection().screen)}_syncScreenshotReturnCanvas(t){let o=document.createElement("canvas");if(t&&t.braille){let{embosserModel:i,brailleMode:n}=t.braille,a=_m[i];o.width=a.width,o.height=a.height,Zj(o,this,a,i,n,!!t.showMovablePoints)}else{let i=this._parseScreenshotOpts(t);o.width=i.width*i.targetPixelRatio,o.height=i.height*i.targetPixelRatio,this.screenshotToCanvas(o,t)}return o}screenshot(t){return t&&t.showLabels&&(t={...t,showLabels:!1}),this._syncScreenshotReturnCanvas(t).toDataURL("image/png")}asyncScreenshot(t,o){if(t&&t.format==="svg"){t.transparentBackground&&(t=__dcg_shared_module_exports__['i'](t),t.transparentBackground=!1);let{width:i,height:n,targetPixelRatio:a}=this._parseScreenshotOpts(t);i*=a,n*=a;let s=new m$(i,n),l={getContext:()=>s,width:i,height:n};this.screenshotToCanvas(l,t),o(s.getSerializedSvg())}else{let i=this._syncScreenshotReturnCanvas(t);o(i.toDataURL("image/png"))}}makeScreenshotProjection(t){let{width:o,height:i,settings:n}=this._parseScreenshotOpts(t),a=new rd(o,i),s=this.getProjection().viewport;return this.settings.squareAxes&&(s=s.squareCrop(a,this.settings)),new kc(a,s,n)}drawLabelHitMask(t){let o=t.projection,i=yhe;i.width=o.screen.width,i.height=o.screen.height;let n=i.getContext("2d");n.clearRect(0,0,o.screen.width,o.screen.height);let a={ctx:n,projection:o,transformationPreviewParentData:{translationPreviewVectorParents:new Set,translationsWithVisibleVectorParent:new Set,rotationPreviewAngleMarkerParents:new Set,rotationsWithVisibleAndCenteredAngle:new Set}},s=[...this.generateMergeDrawOrder()];if(this.gridLayer.redrawToCtx(a),this.graphsLayer.redrawToCtx(a,this.graphSketches,this.graphImages,s,this.poiLabelsLayer,this.clickableObjectsLayer),this.movablePointsLayer.redrawToCtx(a.ctx,a.projection,s,{showMovablePoints:t.showMovablePoints,renderForScreenshot:!0}),t.includePillboxes){let l=this.elt.getBoundingClientRect(),c=this.controller.findEl(".dcg-overgraph-pillbox-elements"),d=this.controller.findEl(".dcg-graphpaper-branding");__dcg_shared_module_exports__['k']([c,d],p=>{if(!p)return;let u=p.getBoundingClientRect();n.globalAlpha=1,n.fillStyle="black",n.fillRect(u.left-l.left,u.top-l.top,u.width,u.height)})}return n}screenshotToCanvas(t,o){let i=this._parseScreenshotOpts(o),{targetPixelRatio:n,transparentBackground:a}=i,s=t.getContext("2d");s.scale(n,n);let l=this.makeScreenshotProjection(o);l.settings.takingScreenshot=!0,Rl(s,"background"),Ui(s,"dcg-svg-background"),a?s.clearRect(0,0,l.screen.width,l.screen.height):(s.fillStyle="white",s.fillRect(0,0,l.screen.width,l.screen.height)),Si(s),Fl(s);let c={ctx:s,projection:l,transformationPreviewParentData:{translationPreviewVectorParents:new Set,translationsWithVisibleVectorParent:new Set,rotationPreviewAngleMarkerParents:new Set,rotationsWithVisibleAndCenteredAngle:new Set}};this.imageLayer.recomputeImages(c);let d;if(o&&"showLabels"in o&&o.showLabels){let u=l.screen.width,h=l.screen.height,m=l.settings.labelSize||15,y=1;(u<200||h<200)&&(y=.9);let w=m*y+"px",S=document.createElement("div");S.classList.add("dcg-calculator-screenshot-labels-container"),JC.mountToNode(WI,S,{concreteFontSize:()=>w,width:()=>`${l.screen.width}px`,height:()=>`${l.screen.height}px`}),document.body.append(S);let C=JC.mountToNode(Pw,S.querySelector(".dcg-grapher"),{grapher:()=>this});C.takingScreenshot=!0;let v={width:l.screen.width,height:l.screen.height};C.recomputeLabels({projection:l,ctx:s,transformationPreviewParentData:{translationPreviewVectorParents:new Set,translationsWithVisibleVectorParent:new Set,rotationPreviewAngleMarkerParents:new Set,rotationsWithVisibleAndCenteredAngle:new Set}},v,()=>this.drawLabelHitMask({projection:l,showMovablePoints:!!o.showMovablePoints,includePillboxes:!1})),d={labelsLayer:C,layersWrapper:S}}let p=u=>{this.graphsLayer.redrawToCtx(c,this.graphSketches,this.graphImages,u.drawOrder,this.poiLabelsLayer,this.clickableObjectsLayer),d&&d.labelsLayer.copyToCtx(s,{filter:"canvas-labels",allowedSketches:u.drawSet}),this.movablePointsLayer.redrawToCtx(c.ctx,c.projection,u.drawOrder,{showMovablePoints:!!(o!=null&&o.showMovablePoints),renderForScreenshot:!0})};for(let u of this.__drawLayers)u.layer<0&&p(u);this.gridLayer.redrawToCtx(c);for(let u of this.__drawLayers)u.layer>=0&&p(u);d&&(d.labelsLayer.copyToCtx(s,{filter:"above-canvas",allowedSketches:new Set([...this.generateMergeDrawOrder()])}),d.layersWrapper.remove())}speakGrapherFocusAriaLabel(){this.canvasLayer.speakAriaLabelAgain()}_afterViewportChange(){}setGrapherState(t,o){if((!o||!o.doNotClear)&&this.clear(),"complex"in t&&!this.controller.canEnableComplexMode()&&(t={...t,complex:!1}),t=r.copyGraphProperties(t,this.settings),"viewport"in t){let i=Co.fromObject(t.viewport);this.setUserRequestedViewport(i);let n=this.computeConcreteViewport(i);this.viewportController.setViewport(n)}this.controller.requestRedrawGraph()}computeConcreteViewport(t){let o=this.getProjection().screen;return this.settings.squareAxes&&!t.isSquare(o,this.controller.getAxisScaleSettings())?t.squareYAxis(o,this.settings):t}setCanvasSizeFor3D(t,o){this.__screenRequested3D=new rd(t,o)}getCanvasNode(){return this.canvasLayer.canvasNode}};function Y3(r,e,t){let o,i,n,a,s,l;return r?(o=r.width||r.height||t.width,i=r.height||r.width||t.height,n=r.targetPixelRatio||1,n<1&&(n=1),a=(o<256||i<256)&&!r.preserveAxisNumbers,s=qh.fromObject({...e,...r.settings}),l=!!r.transparentBackground):(o=t.width,i=t.height,n=1,a=!1,s=qh.fromObject(e),l=!1),a&&(s.setProperty("xAxisNumbers",!1),s.setProperty("yAxisNumbers",!1),s.setProperty("polarNumbers",!1)),{width:o,height:i,targetPixelRatio:n,settings:s,transparentBackground:l}}var ul=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var XI=Math.PI/180,X3=180/Math.PI;function Rd(){let r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,o=Math.random()*4294967295|0;return(ul[r&255]+ul[r>>8&255]+ul[r>>16&255]+ul[r>>24&255]+"-"+ul[e&255]+ul[e>>8&255]+"-"+ul[e>>16&15|64]+ul[e>>24&255]+"-"+ul[t&63|128]+ul[t>>8&255]+"-"+ul[t>>16&255]+ul[t>>24&255]+ul[o&255]+ul[o>>8&255]+ul[o>>16&255]+ul[o>>24&255]).toLowerCase()}function Ub(r,e,t){return Math.max(e,Math.min(t,r))}function J3(r){return(r&r-1)===0&&r!==0}function QC(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function uv(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var tX="155";var rX=0,Q3=1,oX=2;var ZC=0,qb=1,$s=2;var JI=0,Fm=1,Z3=2,eN=3,tN=4,QI=5,Pu=100,iX=101,nX=102,aX=103,sX=104,ZI=200,eM=201,lX=202,cX=203,tM=204,rM=205,dX=206,pX=207,uX=208,hX=209,gX=210,mX=0,fX=1,bX=2,eS=3,yX=4,xX=5,wX=6,vX=7;var rN=300;var tS=1e3,zb=1001,rS=1002,Ou=1003,CX=1004;var oN=1005;var nd=1006,SX=1007;var oS=1008;var ns=1009,EX=1010,DX=1011,hv=1012,oM=1013,Dp=1014,Fd=1015,gv=1016,iM=1017,nM=1018,Ru=1020,kX=1021,Fu=1023,_X=1024,TX=1025,tg=1026,Nm=1027,GX=1028,aM=1029,IX=1030,sM=1031,lM=1033,cM=33776,dM=33777,pM=33778,uM=33779,iN=35840,nN=35841,aN=35842,sN=35843,MX=36196,lN=37492,cN=37496,dN=37808,pN=37809,uN=37810,hN=37811,gN=37812,mN=37813,fN=37814,bN=37815,yN=37816,xN=37817,wN=37818,vN=37819,CN=37820,SN=37821,EN=36492,DN=36283,kN=36284,_N=36285,TN=36286;var mv="",Ii="srgb",hl="srgb-linear";var hM=7680;var AX=519,VX=512,LX=513,PX=514,OX=515,RX=516,FX=517,NX=518,BX=519,UX=35044;var GN="300 es",gM=1035,Nd=2e3,iS=2001;var Ae=class r{constructor(e=0,t=0,o=0){this.x=e,this.y=t,this.z=o}set(e,t,o){return o===void 0&&(o=this.z),this.x=e,this.y=t,this.z=o,this}clone(){return new r(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}applyMatrix3(e){let t=this.x,o=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*o+n[6]*i,this.y=n[1]*t+n[4]*o+n[7]*i,this.z=n[2]*t+n[5]*o+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,o=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*o+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*o+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*o+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*o+n[10]*i+n[14])*a,this}applyQuaternion(e){let t=this.x,o=this.y,i=this.z,n=e.x,a=e.y,s=e.z,l=e.w,c=l*t+a*i-s*o,d=l*o+s*t-n*i,p=l*i+n*o-a*t,u=-n*t-a*o-s*i;return this.x=c*l+u*-n+d*-s-p*-a,this.y=d*l+u*-a+p*-n-c*-s,this.z=p*l+u*-s+c*-a-d*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}transformDirection(e){let t=this.x,o=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*o+n[8]*i,this.y=n[1]*t+n[5]*o+n[9]*i,this.z=n[2]*t+n[6]*o+n[10]*i,this.normalize()}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return this.multiplyScalar(1/(this.length()||1))}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let o=e.x,i=e.y,n=e.z,a=t.x,s=t.y,l=t.z;return this.x=i*l-n*s,this.y=n*a-o*l,this.z=o*s-i*a,this}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,o=this.y-e.y,i=this.z-e.z;return t*t+o*o+i*i}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixColumn(e,t){let o=t*4,i=e.elements;return this.x=i[o],this.y=i[o+1],this.z=i[o+2],this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}};var ur=class r{constructor(e,t,o,i,n,a,s,l,c,d,p,u,h,m,y,w){this.isMatrix4=!0;this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,o,i,n,a,s,l,c,d,p,u,h,m,y,w)}set(e,t,o,i,n,a,s,l,c,d,p,u,h,m,y,w){let S=this.elements;return S[0]=e,S[4]=t,S[8]=o,S[12]=i,S[1]=n,S[5]=a,S[9]=s,S[13]=l,S[2]=c,S[6]=d,S[10]=p,S[14]=u,S[3]=h,S[7]=m,S[11]=y,S[15]=w,this}clone(){let e=new r,t=this.elements;for(let o=0;o<16;o++)e.elements[o]=t[o];return e}copy(e){let t=this.elements,o=e.elements;return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractRotation(e){let t=this.elements,o=e.elements,i=1/IN.setFromMatrixColumn(e,0).length(),n=1/IN.setFromMatrixColumn(e,1).length(),a=1/IN.setFromMatrixColumn(e,2).length();return t[0]=o[0]*i,t[1]=o[1]*i,t[2]=o[2]*i,t[3]=0,t[4]=o[4]*n,t[5]=o[5]*n,t[6]=o[6]*n,t[7]=0,t[8]=o[8]*a,t[9]=o[9]*a,t[10]=o[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,o=e.x,i=e.y,n=e.z,a=Math.cos(o),s=Math.sin(o),l=Math.cos(i),c=Math.sin(i),d=Math.cos(n),p=Math.sin(n);if(e.order==="XYZ"){let u=a*d,h=a*p,m=s*d,y=s*p;t[0]=l*d,t[4]=-l*p,t[8]=c,t[1]=h+m*c,t[5]=u-y*c,t[9]=-s*l,t[2]=y-u*c,t[6]=m+h*c,t[10]=a*l}else if(e.order==="YXZ"){let u=l*d,h=l*p,m=c*d,y=c*p;t[0]=u+y*s,t[4]=m*s-h,t[8]=a*c,t[1]=a*p,t[5]=a*d,t[9]=-s,t[2]=h*s-m,t[6]=y+u*s,t[10]=a*l}else if(e.order==="ZYX"){let u=a*d,h=a*p,m=s*d,y=s*p;t[0]=l*d,t[4]=m*c-h,t[8]=u*c+y,t[1]=l*p,t[5]=y*c+u,t[9]=h*c-m,t[2]=-c,t[6]=s*l,t[10]=a*l}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(xhe,e,whe)}lookAt(e,t,o){let i=this.elements;return ad.subVectors(e,t),ad.lengthSq()===0&&(ad.z=1),ad.normalize(),Bm.crossVectors(o,ad),Bm.lengthSq()===0&&(Math.abs(o.z)===1?ad.x+=1e-4:ad.z+=1e-4,ad.normalize(),Bm.crossVectors(o,ad)),Bm.normalize(),mM.crossVectors(ad,Bm),i[0]=Bm.x,i[4]=mM.x,i[8]=ad.x,i[1]=Bm.y,i[5]=mM.y,i[9]=ad.y,i[2]=Bm.z,i[6]=mM.z,i[10]=ad.z,this}multiply(e){return this.multiplyMatrices(this,e)}multiplyMatrices(e,t){let o=e.elements,i=t.elements,n=this.elements,a=o[0],s=o[4],l=o[8],c=o[12],d=o[1],p=o[5],u=o[9],h=o[13],m=o[2],y=o[6],w=o[10],S=o[14],C=o[3],v=o[7],E=o[11],_=o[15],T=i[0],I=i[4],P=i[8],O=i[12],W=i[1],X=i[5],x=i[9],L=i[13],R=i[2],N=i[6],z=i[10],A=i[14],U=i[3],pe=i[7],q=i[11],F=i[15];return n[0]=a*T+s*W+l*R+c*U,n[4]=a*I+s*X+l*N+c*pe,n[8]=a*P+s*x+l*z+c*q,n[12]=a*O+s*L+l*A+c*F,n[1]=d*T+p*W+u*R+h*U,n[5]=d*I+p*X+u*N+h*pe,n[9]=d*P+p*x+u*z+h*q,n[13]=d*O+p*L+u*A+h*F,n[2]=m*T+y*W+w*R+S*U,n[6]=m*I+y*X+w*N+S*pe,n[10]=m*P+y*x+w*z+S*q,n[14]=m*O+y*L+w*A+S*F,n[3]=C*T+v*W+E*R+_*U,n[7]=C*I+v*X+E*N+_*pe,n[11]=C*P+v*x+E*z+_*q,n[15]=C*O+v*L+E*A+_*F,this}determinant(){let e=this.elements,t=e[0],o=e[4],i=e[8],n=e[12],a=e[1],s=e[5],l=e[9],c=e[13],d=e[2],p=e[6],u=e[10],h=e[14],m=e[3],y=e[7],w=e[11],S=e[15];return m*(+n*l*p-i*c*p-n*s*u+o*c*u+i*s*h-o*l*h)+y*(+t*l*h-t*c*u+n*a*u-i*a*h+i*c*d-n*l*d)+w*(+t*c*p-t*s*h-n*a*p+o*a*h+n*s*d-o*c*d)+S*(-i*s*d-t*l*p+t*s*u+i*a*p-o*a*u+o*l*d)}invert(){let e=this.elements,t=e[0],o=e[1],i=e[2],n=e[3],a=e[4],s=e[5],l=e[6],c=e[7],d=e[8],p=e[9],u=e[10],h=e[11],m=e[12],y=e[13],w=e[14],S=e[15],C=p*w*c-y*u*c+y*l*h-s*w*h-p*l*S+s*u*S,v=m*u*c-d*w*c-m*l*h+a*w*h+d*l*S-a*u*S,E=d*y*c-m*p*c+m*s*h-a*y*h-d*s*S+a*p*S,_=m*p*l-d*y*l-m*s*u+a*y*u+d*s*w-a*p*w,T=t*C+o*v+i*E+n*_;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let I=1/T;return e[0]=C*I,e[1]=(y*u*n-p*w*n-y*i*h+o*w*h+p*i*S-o*u*S)*I,e[2]=(s*w*n-y*l*n+y*i*c-o*w*c-s*i*S+o*l*S)*I,e[3]=(p*l*n-s*u*n-p*i*c+o*u*c+s*i*h-o*l*h)*I,e[4]=v*I,e[5]=(d*w*n-m*u*n+m*i*h-t*w*h-d*i*S+t*u*S)*I,e[6]=(m*l*n-a*w*n-m*i*c+t*w*c+a*i*S-t*l*S)*I,e[7]=(a*u*n-d*l*n+d*i*c-t*u*c-a*i*h+t*l*h)*I,e[8]=E*I,e[9]=(m*p*n-d*y*n-m*o*h+t*y*h+d*o*S-t*p*S)*I,e[10]=(a*y*n-m*s*n+m*o*c-t*y*c-a*o*S+t*s*S)*I,e[11]=(d*s*n-a*p*n-d*o*c+t*p*c+a*o*h-t*s*h)*I,e[12]=_*I,e[13]=(d*y*i-m*p*i+m*o*u-t*y*u-d*o*w+t*p*w)*I,e[14]=(m*s*i-a*y*i-m*o*l+t*y*l+a*o*w-t*s*w)*I,e[15]=(a*p*i-d*s*i+d*o*l-t*p*l-a*o*u+t*s*u)*I,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],o=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,o,i))}makeTranslation(e,t,o){return this.set(1,0,0,e,0,1,0,t,0,0,1,o,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),o=Math.sin(e);return this.set(1,0,0,0,0,t,-o,0,0,o,t,0,0,0,0,1),this}makeRotationAxis(e,t){let o=Math.cos(t),i=Math.sin(t),n=1-o,a=e.x,s=e.y,l=e.z,c=n*a,d=n*s;return this.set(c*a+o,c*s-i*l,c*l+i*s,0,c*s+i*l,d*s+o,d*l-i*a,0,c*l-i*s,d*l+i*a,n*l*l+o,0,0,0,0,1),this}makeScale(e,t,o){return this.set(e,0,0,0,0,t,0,0,0,0,o,0,0,0,0,1),this}compose(e,t,o){let i=this.elements,n=t._x,a=t._y,s=t._z,l=t._w,c=n+n,d=a+a,p=s+s,u=n*c,h=n*d,m=n*p,y=a*d,w=a*p,S=s*p,C=l*c,v=l*d,E=l*p,_=o.x,T=o.y,I=o.z;return i[0]=(1-(y+S))*_,i[1]=(h+E)*_,i[2]=(m-v)*_,i[3]=0,i[4]=(h-E)*T,i[5]=(1-(u+S))*T,i[6]=(w+C)*T,i[7]=0,i[8]=(m+v)*I,i[9]=(w-C)*I,i[10]=(1-(u+y))*I,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}makePerspective(e,t,o,i,n,a,s=Nd){let l=this.elements,c=2*n/(t-e),d=2*n/(o-i),p=(t+e)/(t-e),u=(o+i)/(o-i),h,m;if(s===Nd)h=-(a+n)/(a-n),m=-2*a*n/(a-n);else if(s===iS)h=-a/(a-n),m=-a*n/(a-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return l[0]=c,l[4]=0,l[8]=p,l[12]=0,l[1]=0,l[5]=d,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,o,i,n,a,s=Nd){let l=this.elements,c=1/(t-e),d=1/(o-i),p=1/(a-n),u=(t+e)*c,h=(o+i)*d,m,y;if(s===Nd)m=(a+n)*p,y=-2*p;else if(s===iS)m=n*p,y=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=y,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){let t=this.elements,o=e.elements;for(let i=0;i<16;i++)if(t[i]!==o[i])return!1;return!0}fromArray(e,t=0){for(let o=0;o<16;o++)this.elements[o]=e[o+t];return this}toArray(e,t=0){let o=this.elements;return e[t]=o[0],e[t+1]=o[1],e[t+2]=o[2],e[t+3]=o[3],e[t+4]=o[4],e[t+5]=o[5],e[t+6]=o[6],e[t+7]=o[7],e[t+8]=o[8],e[t+9]=o[9],e[t+10]=o[10],e[t+11]=o[11],e[t+12]=o[12],e[t+13]=o[13],e[t+14]=o[14],e[t+15]=o[15],e}},IN=new Ae,xhe=new Ae(0,0,0),whe=new Ae(1,1,1),Bm=new Ae,mM=new Ae,ad=new Ae;var qX=new ur,_c=class{constructor(e=0,t=0,o=0,i="XYZ"){this._x=e,this._y=t,this._z=o,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,o,i=this._order){return this._x=e,this._y=t,this._z=o,this._order=i,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,o=!0){let i=e.elements,n=i[0],a=i[4],s=i[8],l=i[1],c=i[5],d=i[9],p=i[2],u=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(Ub(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-d,h),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ub(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-p,n),this._z=0);break;case"ZYX":this._y=Math.asin(-Ub(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(u,h),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-a,c));break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,o===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,o){return qX.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qX,t,o)}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};var Mi=class r{constructor(e,t,o,i,n,a,s,l,c){this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,o,i,n,a,s,l,c)}set(e,t,o,i,n,a,s,l,c){let d=this.elements;return d[0]=e,d[1]=i,d[2]=s,d[3]=t,d[4]=n,d[5]=l,d[6]=o,d[7]=a,d[8]=c,this}copy(e){let t=this.elements,o=e.elements;return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}multiplyMatrices(e,t){let o=e.elements,i=t.elements,n=this.elements,a=o[0],s=o[3],l=o[6],c=o[1],d=o[4],p=o[7],u=o[2],h=o[5],m=o[8],y=i[0],w=i[3],S=i[6],C=i[1],v=i[4],E=i[7],_=i[2],T=i[5],I=i[8];return n[0]=a*y+s*C+l*_,n[3]=a*w+s*v+l*T,n[6]=a*S+s*E+l*I,n[1]=c*y+d*C+p*_,n[4]=c*w+d*v+p*T,n[7]=c*S+d*E+p*I,n[2]=u*y+h*C+m*_,n[5]=u*w+h*v+m*T,n[8]=u*S+h*E+m*I,this}invert(){let e=this.elements,t=e[0],o=e[1],i=e[2],n=e[3],a=e[4],s=e[5],l=e[6],c=e[7],d=e[8],p=d*a-s*c,u=s*l-d*n,h=c*n-a*l,m=t*p+o*u+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);let y=1/m;return e[0]=p*y,e[1]=(i*c-d*o)*y,e[2]=(s*o-i*a)*y,e[3]=u*y,e[4]=(d*t-i*l)*y,e[5]=(i*n-s*t)*y,e[6]=h*y,e[7]=(o*l-c*t)*y,e[8]=(a*t-o*n)*y,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}equals(e){let t=this.elements,o=e.elements;for(let i=0;i<9;i++)if(t[i]!==o[i])return!1;return!0}toArray(e,t=0){let o=this.elements;return e[t]=o[0],e[t+1]=o[1],e[t+2]=o[2],e[t+3]=o[3],e[t+4]=o[4],e[t+5]=o[5],e[t+6]=o[6],e[t+7]=o[7],e[t+8]=o[8],e}clone(){let e=new r,t=this.elements;for(let o=0;o<9;o++)e.elements[o]=t[o];return e}};var Bd=class r{constructor(e=0,t=0,o=0,i=1){this.isQuaternion=!0;this._x=e,this._y=t,this._z=o,this._w=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,o,i){return this._x=e,this._y=t,this._z=o,this._w=i,this._onChangeCallback(),this}clone(){return new r(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let o=e._x,i=e._y,n=e._z,a=e._order,s=Math.cos,l=Math.sin,c=s(o/2),d=s(i/2),p=s(n/2),u=l(o/2),h=l(i/2),m=l(n/2);switch(a){case"XYZ":this._x=u*d*p+c*h*m,this._y=c*h*p-u*d*m,this._z=c*d*m+u*h*p,this._w=c*d*p-u*h*m;break;case"YXZ":this._x=u*d*p+c*h*m,this._y=c*h*p-u*d*m,this._z=c*d*m-u*h*p,this._w=c*d*p+u*h*m;break;case"ZYX":this._x=u*d*p-c*h*m,this._y=c*h*p+u*d*m,this._z=c*d*m-u*h*p,this._w=c*d*p+u*h*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,o=t[0],i=t[4],n=t[8],a=t[1],s=t[5],l=t[9],c=t[2],d=t[6],p=t[10],u=o+s+p;if(u>0){let h=.5/Math.sqrt(u+1);this._w=.25/h,this._x=(d-l)*h,this._y=(n-c)*h,this._z=(a-i)*h}else if(o>s&&o>p){let h=2*Math.sqrt(1+o-s-p);this._w=(d-l)/h,this._x=.25*h,this._y=(i+a)/h,this._z=(n+c)/h}else if(s>p){let h=2*Math.sqrt(1+s-o-p);this._w=(n-c)/h,this._x=(i+a)/h,this._y=.25*h,this._z=(l+d)/h}else{let h=2*Math.sqrt(1+p-o-s);this._w=(a-i)/h,this._x=(n+c)/h,this._y=(l+d)/h,this._z=.25*h}return this._onChangeCallback(),this}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let o=e._x,i=e._y,n=e._z,a=e._w,s=t._x,l=t._y,c=t._z,d=t._w;return this._x=o*d+a*s+i*c-n*l,this._y=i*d+a*l+n*s-o*c,this._z=n*d+a*c+o*l-i*s,this._w=a*d-o*s-i*l-n*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let o=this._x,i=this._y,n=this._z,a=this._w,s=a*e._w+o*e._x+i*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=o,this._y=i,this._z=n,this;let l=1-s*s;if(l<=Number.EPSILON){let h=1-t;return this._w=h*a+t*this._w,this._x=h*o+t*this._x,this._y=h*i+t*this._y,this._z=h*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),d=Math.atan2(c,s),p=Math.sin((1-t)*d)/c,u=Math.sin(t*d)/c;return this._w=a*p+this._w*u,this._x=o*p+this._x*u,this._y=i*p+this._y*u,this._z=n*p+this._z*u,this._onChangeCallback(),this}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};var $l=new Ae,js=class{constructor(e,t,o=!1){this.isBufferAttribute=!0;if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=o,this.usage=UX,this.updateRange={offset:0,count:-1},this.gpuType=Fd,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}applyMatrix4(e){for(let t=0,o=this.count;t<o;t++)$l.fromBufferAttribute(this,t),$l.applyMatrix4(e),this.setXYZ(t,$l.x,$l.y,$l.z);return this}applyNormalMatrix(e){for(let t=0,o=this.count;t<o;t++)$l.fromBufferAttribute(this,t),$l.applyNormalMatrix(e),this.setXYZ(t,$l.x,$l.y,$l.z);return this}transformDirection(e){for(let t=0,o=this.count;t<o;t++)$l.fromBufferAttribute(this,t),$l.transformDirection(e),this.setXYZ(t,$l.x,$l.y,$l.z);return this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=QC(t,this.array)),t}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=QC(t,this.array)),t}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=QC(t,this.array)),t}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=QC(t,this.array)),t}setXY(e,t,o){return e*=this.itemSize,this.normalized&&(t=uv(t,this.array),o=uv(o,this.array)),this.array[e+0]=t,this.array[e+1]=o,this}setXYZ(e,t,o,i){return e*=this.itemSize,this.normalized&&(t=uv(t,this.array),o=uv(o,this.array),i=uv(i,this.array)),this.array[e+0]=t,this.array[e+1]=o,this.array[e+2]=i,this}};var Um=class extends js{constructor(e,t,o){super(new Uint16Array(e),t,o)}};var qm=class extends js{constructor(e,t,o){super(new Uint32Array(e),t,o)}},qi=class extends js{constructor(e,t,o){super(new Float32Array(e),t,o)}};var Tc=class{hasEventListener(e,t){if(this._listeners===void 0)return!1;let o=this._listeners;return o[e]!==void 0&&o[e].indexOf(t)!==-1}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let o=this._listeners;o[e]===void 0&&(o[e]=[]),o[e].indexOf(t)===-1&&o[e].push(t)}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let o=this._listeners[e.type];if(o!==void 0){e.target=this;let i=o.slice(0);for(let n=0,a=i.length;n<a;n++)i[n].call(this,e);e.target=null}}};var fv=class{constructor(){this.mask=1}enable(e){this.mask|=1<<e|0}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}};var vhe=0,zX=new Ae,HX=new Bd,nS=new ur,MN=new Ae,AN=new Ae,Che=new Ae(1,0,0),She=new Ae(0,1,0),Ehe=new Ae(0,0,1),Dhe={type:"added"},khe={type:"removed"},zm=class zm extends Tc{constructor(){super();this.isObject3D=!0;Object.defineProperty(this,"id",{value:vhe++}),this.uuid=Rd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zm.DEFAULT_UP.clone();let t=new Ae,o=new _c,i=new Bd,n=new Ae(1,1,1);function a(){i.setFromEuler(o,!1)}function s(){o.setFromQuaternion(i,void 0,!1)}o._onChange(a),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:o},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ur},normalMatrix:{value:new Mi}}),this.matrix=new ur,this.matrixWorld=new ur,this.dcgModelMatrix=new ur,this.matrixAutoUpdate=zm.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=zm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new fv,this.visible=!0,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}setPickingColorArray(t){this.pickingColorArray=t;let{repeatColorCounts:o,colors:i}=t,n=[];for(let a=0;a<o.length;a++){let s=i[a],l=o[a];for(let c=0;c<l;c++)n.push(...s)}this.geometry&&this.geometry.setAttribute("vertexPickingColor",new js(new Float32Array(n),4))}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}translateOnAxis(t,o){return zX.copy(t).applyQuaternion(this.quaternion),this.position.add(zX.multiplyScalar(o)),this}translateX(t){return this.translateOnAxis(Che,t)}translateY(t){return this.translateOnAxis(She,t)}translateZ(t){return this.translateOnAxis(Ehe,t)}lookAt(t){MN.copy(t);let o=this.parent;this.updateWorldMatrix(!0,!1),AN.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nS.lookAt(AN,MN,this.up):nS.lookAt(MN,AN,this.up),this.quaternion.setFromRotationMatrix(nS),o&&(nS.extractRotation(o.matrixWorld),HX.setFromRotationMatrix(nS),this.quaternion.premultiply(HX.invert()))}add(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.add(arguments[o]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Dhe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let o=this.children.indexOf(t);return o!==-1&&(t.parent=null,this.children.splice(o,1),t.dispatchEvent(khe)),this}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,o){if(this[t]===o)return this;for(let i=0,n=this.children.length;i<n;i++){let s=this.children[i].getObjectByProperty(t,o);if(s!==void 0)return s}}getObjectsByProperty(t,o){let i=[];this[t]===o&&i.push(this);for(let n=0,a=this.children.length;n<a;n++){let s=this.children[n].getObjectsByProperty(t,o);s.length>0&&(i=i.concat(s))}return i}traverse(t){t(this);let o=this.children;for(let i=0,n=o.length;i<n;i++)o[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let o=this.children;for(let i=0,n=o.length;i<n;i++)o[i].traverseVisible(t)}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let o=this.children;for(let i=0,n=o.length;i<n;i++){let a=o[i];(a.matrixWorldAutoUpdate===!0||t===!0)&&a.updateMatrixWorld(t)}}updateWorldMatrix(t,o){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),o===!0){let n=this.children;for(let a=0,s=n.length;a<s;a++){let l=n[a];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}};zm.DEFAULT_UP=new Ae(0,1,0),zm.DEFAULT_MATRIX_AUTO_UPDATE=!0,zm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Nn=zm;var bv=class extends Nn{constructor(){super();this.isCamera=!0;this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ur,this.projectionMatrix=new ur,this.projectionMatrixInverse=new ur,this.coordinateSystem=Nd}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,o){super.updateWorldMatrix(t,o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}};var rg=class extends bv{constructor(e=-1,t=1,o=1,i=-1,n=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=o,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}setViewOffset(e,t,o,i,n,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=o,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=o-e,a=o+e,s=i+t,l=i-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=c*this.view.offsetX,a=n+c*this.view.width,s-=d*this.view.offsetY,l=s-d*this.view.height}this.projectionMatrix.makeOrthographic(n,a,s,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}};var Hm=class extends bv{constructor(e=50,t=1,o=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=o,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=X3*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(XI*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return X3*2*Math.atan(Math.tan(XI*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,o,i,n,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=o,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(XI*.5*this.fov)/this.zoom,o=2*t,i=this.aspect*o,n=-.5*i,a=this.view;if(a!==null&&a.enabled){let l=a.fullWidth,c=a.fullHeight;n+=a.offsetX*i/l,t-=a.offsetY*o/c,i*=a.width/l,o*=a.height/c}let s=this.filmOffset;s!==0&&(n+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-o,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}};var Hb=class{constructor(e=new Ae(1/0,1/0,1/0),t=new Ae(-1/0,-1/0,-1/0)){this.min=e,this.max=t}setFromBufferAttribute(e){this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0;for(let t=0,o=e.count;t<o;t++)VN.fromBufferAttribute(e,t),this.min.min(VN),this.max.max(VN);return this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},VN=new Ae;var yv=new Ae,LN=new Ae,og=class{constructor(e=new Ae,t=-1){this.center=e,this.radius=t}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(LN.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(yv.copy(e.center).add(LN)),this.expandByPoint(yv.copy(e.center).sub(LN))),this)}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;yv.subVectors(e,this.center);let t=yv.lengthSq();if(t>this.radius*this.radius){let o=Math.sqrt(t),i=(o-this.radius)*.5;yv.multiplyScalar(i/o),this.center.add(yv),this.radius+=i}return this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}};function fM(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function bM(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function _he(r){let e=r.getError();switch(e){case r.NO_ERROR:return"NO_ERROR";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";default:return typeof e=="number"?e.toString(16):e}}function qt(r,e,t){if(r==null){let o=`Expected ${e} to be defined and not null.`;throw t&&(o+=` GL Error: ${_he(t)}.`),new Error(o)}}var The=0,xv=new ur,KX=new Hb,Kb=new Ae,gl=class extends Tc{constructor(){super();this.isBufferGeometry=!0;Object.defineProperty(this,"id",{value:The++}),this.uuid=Rd(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.groups=[],this.boundingSphere=null,this.userData={}}setIndex(t){return Array.isArray(t)?this.index=new(fM(t)?qm:Um)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,o){return this.attributes[t]=o,this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,o,i=0){this.groups.push({start:t,count:o,materialIndex:i})}applyMatrix4(t){let o=this.attributes.position;o!==void 0&&(o.applyMatrix4(t),o.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let a=new Mi().getNormalMatrix(t);i.applyNormalMatrix(a),i.needsUpdate=!0}let n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingSphere!==null&&this.computeBoundingSphere(),this}rotateX(t){return xv.makeRotationX(t),this.applyMatrix4(xv),this}translate(t,o,i){return xv.makeTranslation(t,o,i),this.applyMatrix4(xv),this}scale(t,o,i){return xv.makeScale(t,o,i),this.applyMatrix4(xv),this}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new og);let t=this.attributes.position;if(t){let o=this.boundingSphere.center;KX.setFromBufferAttribute(t),KX.getCenter(o);let i=0;for(let n=0,a=t.count;n<a;n++)Kb.fromBufferAttribute(t,n),i=Math.max(i,o.distanceToSquared(Kb));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeVertexNormals(){let t=this.index,o=this.getAttribute("position");if(o!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new js(new Float32Array(o.count*3),3),this.setAttribute("normal",i);else for(let h=0,m=i.count;h<m;h++)i.setXYZ(h,0,0,0);let n=new Ae,a=new Ae,s=new Ae,l=new Ae,c=new Ae,d=new Ae,p=new Ae,u=new Ae;if(t)for(let h=0,m=t.count;h<m;h+=3){let y=t.getX(h+0),w=t.getX(h+1),S=t.getX(h+2);n.fromBufferAttribute(o,y),a.fromBufferAttribute(o,w),s.fromBufferAttribute(o,S),p.subVectors(s,a),u.subVectors(n,a),p.cross(u),l.fromBufferAttribute(i,y),c.fromBufferAttribute(i,w),d.fromBufferAttribute(i,S),l.add(p),c.add(p),d.add(p),i.setXYZ(y,l.x,l.y,l.z),i.setXYZ(w,c.x,c.y,c.z),i.setXYZ(S,d.x,d.y,d.z)}else for(let h=0,m=o.count;h<m;h+=3)n.fromBufferAttribute(o,h+0),a.fromBufferAttribute(o,h+1),s.fromBufferAttribute(o,h+2),p.subVectors(s,a),u.subVectors(n,a),p.cross(u),i.setXYZ(h+0,p.x,p.y,p.z),i.setXYZ(h+1,p.x,p.y,p.z),i.setXYZ(h+2,p.x,p.y,p.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let o=0,i=t.count;o<i;o++)Kb.fromBufferAttribute(t,o),Kb.normalize(),t.setXYZ(o,Kb.x,Kb.y,Kb.z)}dispose(){this.dispatchEvent({type:"dispose"})}};var Oa=class r{constructor(e=0,t=0,o=0,i=1){this.x=e,this.y=t,this.z=o,this.w=i}set(e,t,o,i){return this.x=e,this.y=t,this.z=o,this.w=i,this}clone(){return new r(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}};var Yt=class r{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}clone(){return new r(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}applyMatrix3(e){let t=this.x,o=this.y,i=e.elements;return this.x=i[0]*t+i[3]*o+i[6],this.y=i[1]*t+i[4]*o+i[7],this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){return this.multiplyScalar(1/(this.length()||1))}distanceTo(e){let t=this.x-e.x,o=this.y-e.y,i=t*t+o*o;return Math.sqrt(i)}equals(e){return e.x===this.x&&e.y===this.y}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}};var Ghe=0,yM=class{constructor(e){this.data=e;this.isSource=!0;this.uuid=Rd();this.version=0;Object.defineProperty(this,"id",{value:Ghe++})}set needsUpdate(e){e===!0&&this.version++}};var Nu=class{constructor(e,t,o){this.width=e;this.height=t;this.depth=o}},Ihe=0,wv=class wv extends Tc{constructor(e,t=wv.DEFAULT_MAPPING,o=zb,i=zb,n=nd,a=oS,s=Fu,l=ns,c=wv.DEFAULT_ANISOTROPY,d=mv){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ihe++}),this.uuid=Rd(),this.name="",this.source=new yM(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=o,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=l,this.offset=new Yt(0,0),this.repeat=new Yt(1,1),this.center=new Yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=void 0,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==rN)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case tS:e.x=e.x-Math.floor(e.x);break;case zb:e.x=e.x<0?0:1;break;case rS:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case tS:e.y=e.y-Math.floor(e.y);break;case zb:e.y=e.y<0?0:1;break;case rS:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};wv.DEFAULT_ANISOTROPY=1,wv.DEFAULT_MAPPING=rN;var Gc=wv;var xM=class extends Tc{constructor(t=1,o=1,i={}){super();this.isRenderTarget=!0;this.width=t,this.height=o,this.depth=1,this.scissor=new Oa(0,0,t,o),this.scissorTest=!1,this.viewport=new Oa(0,0,t,o);let n=new Nu(t,o,1);this.texture=new Gc(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:nd,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,o,i=1){if(this.width!==t||this.height!==o||this.depth!==i){this.width=t,this.height=o,this.depth=i;let n=this.texture.image;n.width=t,n.height=o,n.depth=i,this.dispose()}this.viewport.set(0,0,t,o),this.scissor.set(0,0,t,o)}dispose(){this.dispatchEvent({type:"dispose"})}};var Km=class{constructor(){this.arcLengthDivisions=200;this.needsUpdate=!1}getPointAt(e,t){let o=this.getUtoTmapping(e);return this.getPoint(o,t)}getPoints(e=5){let t=[];for(let o=0;o<=e;o++)t.push(this.getPoint(o/e));return t}getSpacedPoints(e=5){let t=[];for(let o=0;o<=e;o++)t.push(this.getPointAt(o/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],o,i=this.getPoint(0),n=0;t.push(0);for(let a=1;a<=e;a++)o=this.getPoint(a/e),n+=o.distanceTo(i),t.push(n),i=o;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let o=this.getLengths(),i=0,n=o.length,a;t?a=t:a=e*o[n-1];let s=0,l=n-1,c;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),c=o[i]-a,c<0)s=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,o[i]===a)return i/(n-1);let d=o[i],u=o[i+1]-d,h=(a-d)/u;return(i+h)/(n-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let a=this.getPoint(i),s=this.getPoint(n),l=t||new Yt;return l.copy(s).sub(a).normalize(),l}getTangentAt(e,t){let o=this.getUtoTmapping(e);return this.getTangent(o,t)}computeFrenetFrames(e,t){let o=new Ae,i=[],n=[],a=[],s=new Ae,l=new ur;for(let u=0;u<=e;u++){let h=u/e,m=this.getTangentAt(h,new Yt);i[u]=new Ae(m.x,m.y,0)}n[0]=new Ae,a[0]=new Ae;let c=Number.MAX_VALUE,d=Math.abs(i[0].x),p=Math.abs(i[0].y);d<=c&&(c=d,o.set(1,0,0)),p<=c&&(c=p,o.set(0,1,0)),s.crossVectors(i[0],o).normalize(),n[0].crossVectors(i[0],s),a[0].crossVectors(i[0],n[0]);for(let u=1;u<=e;u++){if(n[u]=n[u-1].clone(),a[u]=a[u-1].clone(),s.crossVectors(i[u-1],i[u]),s.length()>Number.EPSILON){s.normalize();let h=Math.acos(Ub(i[u-1].dot(i[u]),-1,1));n[u].applyMatrix4(l.makeRotationAxis(s,h))}a[u].crossVectors(i[u],n[u])}if(t===!0){let u=Math.acos(Ub(n[0].dot(n[e]),-1,1));u/=e,i[0].dot(s.crossVectors(n[0],n[e]))>0&&(u=-u);for(let h=1;h<=e;h++)n[h].applyMatrix4(l.makeRotationAxis(i[h],u*h)),a[h].crossVectors(i[h],n[h])}return{tangents:i,normals:n,binormals:a}}};var Wb=class extends Km{constructor(e=new Yt,t=new Yt){super(),this.v1=e,this.v2=t}getPoint(e,t=new Yt){let o=t;return e===1?o.copy(this.v2):(o.copy(this.v2).sub(this.v1),o.multiplyScalar(e).add(this.v1)),o}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Yt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}};var wM=class extends Km{constructor(){super(...arguments);this.curves=[];this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);t.equals(o)||this.curves.push(new Wb(o,t))}getPoint(t,o){let i=t*this.getLength(),n=this.getCurveLengths(),a=0;for(;a<n.length;){if(n[a]>=i){let s=n[a]-i,l=this.curves[a],c=l.getLength(),d=c===0?0:1-s/c;return l.getPointAt(d,o)}a++}}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=void 0,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],o=0;for(let i=0,n=this.curves.length;i<n;i++)o+=this.curves[i].getLength(),t.push(o);return this.cacheLengths=t,t}getSpacedPoints(t=40){let o=[];for(let i=0;i<=t;i++)o.push(this.getPoint(i/t));return this.autoClose&&o.push(o[0]),o}getPoints(t=12){let o=[],i;for(let n=0,a=this.curves;n<a.length;n++){let s=a[n],l=s instanceof Wb?1:t,c=s.getPoints(l);for(let d=0;d<c.length;d++){let p=c[d];i&&i.equals(p)||(o.push(p),i=p)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}};function Mhe(r,e){let t=1-r;return t*t*e}function Ahe(r,e){return 2*(1-r)*r*e}function Vhe(r,e){return r*r*e}function PN(r,e,t,o){return Mhe(r,e)+Ahe(r,t)+Vhe(r,o)}var vM=class extends Km{constructor(e=new Yt,t=new Yt,o=new Yt){super(),this.v0=e,this.v1=t,this.v2=o}getPoint(e,t=new Yt){let o=t,i=this.v0,n=this.v1,a=this.v2;return o.set(PN(e,i.x,n.x,a.x),PN(e,i.y,n.y,a.y)),o}};var $b=class extends wM{constructor(t){super();this.currentPoint=new Yt;t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let o=1,i=t.length;o<i;o++)this.lineTo(t[o].x,t[o].y);return this}moveTo(t,o){return this.currentPoint.set(t,o),this}lineTo(t,o){let i=new Wb(this.currentPoint.clone(),new Yt(t,o));return this.curves.push(i),this.currentPoint.set(t,o),this}quadraticCurveTo(t,o,i,n){let a=new vM(this.currentPoint.clone(),new Yt(t,o),new Yt(i,n));return this.curves.push(a),this.currentPoint.set(i,n),this}};var vv=class extends $b{constructor(){super(...arguments);this.uuid=Rd();this.holes=[]}getPointsHoles(t){let o=[];for(let i=0,n=this.holes.length;i<n;i++)o[i]=this.holes[i].getPoints(t);return o}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}};var zt=class r{constructor(e){this.isColor=!0;if(e instanceof r)this.copy(e);else if(typeof e=="number")this.setHex(e);else if(typeof e=="string"){let{r:t,g:o,b:i}=__dcg_shared_module_exports__['Vd'](e);this.setRGB(t/255,o/255,i/255)}else this.r=1,this.g=1,this.b=1}setHex(e){return e=Math.floor(e),this.setRGB((e>>16&255)/255,(e>>8&255)/255,(e&255)/255),this}setRGB(e,t,o){return this.r=__dcg_shared_module_exports__['Wd'](e),this.g=__dcg_shared_module_exports__['Wd'](t),this.b=__dcg_shared_module_exports__['Wd'](o),this}clone(){let e=new r;return e.r=this.r,e.g=this.g,e.b=this.b,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}getRGB(e,t){t===Ii?(e.r=__dcg_shared_module_exports__['Xd'](this.r),e.g=__dcg_shared_module_exports__['Xd'](this.g),e.b=__dcg_shared_module_exports__['Xd'](this.b)):(e.r=this.r,e.g=this.g,e.b=this.b)}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}};var $X={triangulate:function(r,e,t=2){let o=e&&e.length,i=o?e[0]*t:r.length,n=Lhe(r,0,i,t,!0),a=[];if(!n||n.next===n.prev)return a;let s,l,c,d,p,u,h;if(o)throw new Error("EarCut does not support holes");if(r.length>80*t){s=c=r[0],l=d=r[1];for(let m=t;m<i;m+=t)p=r[m],u=r[m+1],p<s&&(s=p),u<l&&(l=u),p>c&&(c=p),u>d&&(d=u);h=Math.max(c-s,d-l),h=h!==0?32767/h:0}return Phe(n,a,t,s,l,h,0),a}};function Lhe(r,e,t,o,i){let n,a;if(i===Uhe(r,e,t,o)>0)for(n=e;n<t;n+=o)a=WX(n,r[n],r[n+1],a);else for(n=t-o;n>=e;n-=o)a=WX(n,r[n],r[n+1],a);return a&&Bhe(a,a.next)&&(jX(a),a=a.next),a}function Phe(r,e,t,o,i,n,a){if(!r)return;!a&&n&&Fhe(r,o,i,n);let s=r,l,c;for(;r.prev!==r.next;){if(l=r.prev,c=r.next,n?Rhe(r,o,i,n):Ohe(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(c.i/t|0),jX(r),r=c.next,s=c.next;continue}if(r=c,r===s)throw new Error("EarCut does not expect ear === stop")}}function Ohe(r){let e=r.prev,t=r,o=r.next;if(jb(e,t,o)>=0)return!1;let i=e.x,n=t.x,a=o.x,s=e.y,l=t.y,c=o.y,d=i<n?i<a?i:a:n<a?n:a,p=s<l?s<c?s:c:l<c?l:c,u=i>n?i>a?i:a:n>a?n:a,h=s>l?s>c?s:c:l>c?l:c,m=o.next;for(;m!==e;){if(m.x>=d&&m.x<=u&&m.y>=p&&m.y<=h&&aS(i,s,n,l,a,c,m.x,m.y)&&jb(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Rhe(r,e,t,o){let i=r.prev,n=r,a=r.next;if(jb(i,n,a)>=0)return!1;let s=i.x,l=n.x,c=a.x,d=i.y,p=n.y,u=a.y,h=s<l?s<c?s:c:l<c?l:c,m=d<p?d<u?d:u:p<u?p:u,y=s>l?s>c?s:c:l>c?l:c,w=d>p?d>u?d:u:p>u?p:u,S=ON(h,m,e,t,o),C=ON(y,w,e,t,o),v=r.prevZ,E=r.nextZ;for(;v&&v.z>=S&&E&&E.z<=C;){if(v.x>=h&&v.x<=y&&v.y>=m&&v.y<=w&&v!==i&&v!==a&&aS(s,d,l,p,c,u,v.x,v.y)&&jb(v.prev,v,v.next)>=0||(v=v.prevZ,E.x>=h&&E.x<=y&&E.y>=m&&E.y<=w&&E!==i&&E!==a&&aS(s,d,l,p,c,u,E.x,E.y)&&jb(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;v&&v.z>=S;){if(v.x>=h&&v.x<=y&&v.y>=m&&v.y<=w&&v!==i&&v!==a&&aS(s,d,l,p,c,u,v.x,v.y)&&jb(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;E&&E.z<=C;){if(E.x>=h&&E.x<=y&&E.y>=m&&E.y<=w&&E!==i&&E!==a&&aS(s,d,l,p,c,u,E.x,E.y)&&jb(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Fhe(r,e,t,o){let i=r;do i.z===0&&(i.z=ON(i.x,i.y,e,t,o)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=void 0,i.prevZ=void 0,Nhe(i)}function Nhe(r){let e,t,o,i,n,a,s,l,c=1;do{for(t=r,r=void 0,n=void 0,a=0;t;){for(a++,o=t,s=0,e=0;e<c&&(s++,o=o.nextZ,!!o);e++);for(l=c;s>0||l>0&&o;)s!==0&&(l===0||!o||t.z<=o.z)?(i=t,t=t.nextZ,s--):(i=o,o=o.nextZ,l--),n?n.nextZ=i:r=i,i.prevZ=n,n=i;t=o}n.nextZ=void 0,c*=2}while(a>1);return r}function ON(r,e,t,o,i){return r=(r-t)*i|0,e=(e-o)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function aS(r,e,t,o,i,n,a,s){return(i-a)*(e-s)>=(r-a)*(n-s)&&(r-a)*(o-s)>=(t-a)*(e-s)&&(t-a)*(n-s)>=(i-a)*(o-s)}function jb(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Bhe(r,e){return r.x===e.x&&r.y===e.y}function WX(r,e,t,o){let i=new RN(r,e,t);return o?(i.next=o.next,i.prev=o,o.next.prev=i,o.next=i):(i.prev=i,i.next=i),i}function jX(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}var RN=class{constructor(e,t,o){this.i=e,this.x=t,this.y=o,this.z=0,this.prevZ=void 0,this.nextZ=void 0,this.steiner=!1}};function Uhe(r,e,t,o){let i=0;for(let n=e,a=t-o;n<t;n+=o)i+=(r[a]-r[n])*(r[n+1]+r[a+1]),a=n;return i}var Wm=class r{static area(e){let t=e.length,o=0;for(let i=t-1,n=0;n<t;i=n++)o+=e[i].x*e[n].y-e[n].x*e[i].y;return o*.5}static isClockWise(e){return r.area(e)<0}static triangulateShape(e,t){let o=[],i=[],n=[];YX(e),XX(o,e);let a=e.length;t.forEach(YX);for(let l=0;l<t.length;l++)i.push(a),a+=t[l].length,XX(o,t[l]);let s=$X.triangulate(o,i);for(let l=0;l<s.length;l+=3)n.push(s.slice(l,l+3));return n}};function YX(r){let e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function XX(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}var CM=class{constructor(){this.color=new zt;this.subPaths=[];this.currentPath=new $b}moveTo(e,t){return this.currentPath=new $b,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,o,i){return this.currentPath.quadraticCurveTo(e,t,o,i),this}toShapes(e=!1){function t(S){let C=[];for(let v=0,E=S.length;v<E;v++){let _=S[v],T=new vv;T.curves=_.curves,C.push(T)}return C}function o(S,C){let v=C.length,E=!1;for(let _=v-1,T=0;T<v;_=T++){let I=C[_],P=C[T],O=P.x-I.x,W=P.y-I.y;if(Math.abs(W)>Number.EPSILON){if(W<0&&(I=C[T],O=-O,P=C[_],W=-W),S.y<I.y||S.y>P.y)continue;if(S.y===I.y){if(S.x===I.x)return!0}else{let X=W*(S.x-I.x)-O*(S.y-I.y);if(X===0)return!0;if(X<0)continue;E=!E}}else{if(S.y!==I.y)continue;if(P.x<=S.x&&S.x<=I.x||I.x<=S.x&&S.x<=P.x)return!0}}return E}let i=Wm.isClockWise,n=this.subPaths;if(n.length===0)return[];let a,s,l,c=[];if(n.length===1)return s=n[0],l=new vv,l.curves=s.curves,c.push(l),c;let d=!i(n[0].getPoints());d=e?!d:d;let p=[],u=[],h=[],m=0,y;h[m]=[];for(let S=0,C=n.length;S<C;S++)if(s=n[S],y=s.getPoints(),a=i(y),a=e?!a:a,a){!d&&u[m]&&m++;let v={s:new vv,p:y};v.s.curves=s.curves,u[m]=v,d&&m++,h[m]=[]}else h[m].push({h:s,p:y[0]});if(!u[0])return t(n);if(u.length>1){let S=!1,C=0;for(let v=0,E=u.length;v<E;v++)p[v]=[];for(let v=0,E=u.length;v<E;v++){let _=h[v];for(let T=0;T<_.length;T++){let I=_[T],P=!0;for(let O=0;O<u.length;O++)o(I.p,u[O].p)&&(v!==O&&C++,P?(P=!1,p[O].push(I)):S=!0);P&&p[v].push(I)}}C>0&&S===!1&&(h=p)}let w;for(let S=0,C=u.length;S<C;S++){l=u[S].s,c.push(l),w=h[S];for(let v=0,E=w.length;v<E;v++)l.holes.push(w[v].h)}return c}};var Bu=class extends gl{constructor(e=1,t=1,o=1,i=32,n=1,a=!1,s=0,l=Math.PI*2){super(),this.type="CylinderGeometry";let c=this;i=Math.floor(i),n=Math.floor(n);let d=[],p=[],u=[],h=[],m=0,y=[],w=o/2,S=0;C(),a===!1&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(d),this.setAttribute("position",new qi(p,3)),this.setAttribute("normal",new qi(u,3)),this.setAttribute("uv",new qi(h,2));function C(){let E=new Ae,_=new Ae,T=0,I=(t-e)/o;for(let P=0;P<=n;P++){let O=[],W=P/n,X=W*(t-e)+e;for(let x=0;x<=i;x++){let L=x/i,R=L*l+s,N=Math.sin(R),z=Math.cos(R);_.x=X*N,_.y=-W*o+w,_.z=X*z,p.push(_.x,_.y,_.z),E.set(N,I,z).normalize(),u.push(E.x,E.y,E.z),h.push(L,1-W),O.push(m++)}y.push(O)}for(let P=0;P<i;P++)for(let O=0;O<n;O++){let W=y[O][P],X=y[O+1][P],x=y[O+1][P+1],L=y[O][P+1];d.push(W,X,L),d.push(X,x,L),T+=6}c.addGroup(S,T,0),S+=T}function v(E){let _=m,T=new Yt,I=new Ae,P=0,O=E===!0?e:t,W=E===!0?1:-1;for(let x=1;x<=i;x++)p.push(0,w*W,0),u.push(0,W,0),h.push(.5,.5),m++;let X=m;for(let x=0;x<=i;x++){let R=x/i*l+s,N=Math.cos(R),z=Math.sin(R);I.x=O*z,I.y=w*W,I.z=O*N,p.push(I.x,I.y,I.z),u.push(0,W,0),T.x=N*.5+.5,T.y=z*.5*W+.5,h.push(T.x,T.y),m++}for(let x=0;x<i;x++){let L=_+x,R=X+x;E===!0?d.push(R,R+1,L):d.push(R+1,R,L),P+=3}c.addGroup(S,P,E===!0?1:2),S+=P}}};var SM=class extends Bu{constructor(e=1,t=1,o=32,i=1,n=!1,a=0,s=Math.PI*2){super(0,e,t,o,i,n,a,s),this.type="ConeGeometry"}};var EM=class extends gl{constructor(e,t={}){super(),this.type="ExtrudeGeometry";let o=this,i=[],n=[];for(let s=0,l=e.length;s<l;s++){let c=e[s];a(c)}this.setAttribute("position",new qi(i,3)),this.setAttribute("uv",new qi(n,2)),this.computeVertexNormals();function a(s){let l=[],c=t.curveSegments!==void 0?t.curveSegments:12,d=t.steps!==void 0?t.steps:1,p=t.depth!==void 0?t.depth:1,u=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:h-.1,y=t.bevelOffset!==void 0?t.bevelOffset:0,w=t.bevelSegments!==void 0?t.bevelSegments:3,S=t.UVGenerator!==void 0?t.UVGenerator:qhe;u||(w=0,h=0,m=0,y=0);let C=s.extractPoints(c),v=C.shape,E=C.holes;if(!Wm.isClockWise(v)){v=v.reverse();for(let j=0,oe=E.length;j<oe;j++){let Y=E[j];Wm.isClockWise(Y)&&(E[j]=Y.reverse())}}let T=Wm.triangulateShape(v,E),I=v;for(let j=0,oe=E.length;j<oe;j++){let Y=E[j];v=v.concat(Y)}function P(j,oe,Y){return oe||console.error("THREE.ExtrudeGeometry: vec does not exist"),j.clone().addScaledVector(oe,Y)}let O=v.length,W=T.length;function X(j,oe,Y){let fe,ye,Ce,De=j.x-oe.x,Ge=j.y-oe.y,Ye=Y.x-j.x,Q=Y.y-j.y,ee=De*De+Ge*Ge,we=De*Q-Ge*Ye;if(Math.abs(we)>Number.EPSILON){let Me=Math.sqrt(ee),$e=Math.sqrt(Ye*Ye+Q*Q),me=oe.x-Ge/Me,rt=oe.y+De/Me,vt=Y.x-Q/$e,Re=Y.y+Ye/$e,Xt=((vt-me)*Q-(Re-rt)*Ye)/(De*Q-Ge*Ye);fe=me+De*Xt-j.x,ye=rt+Ge*Xt-j.y;let Ft=fe*fe+ye*ye;if(Ft<=2)return new Yt(fe,ye);Ce=Math.sqrt(Ft/2)}else{let Me=!1;De>Number.EPSILON?Ye>Number.EPSILON&&(Me=!0):De<-Number.EPSILON?Ye<-Number.EPSILON&&(Me=!0):Math.sign(Ge)===Math.sign(Q)&&(Me=!0),Me?(fe=-Ge,ye=De,Ce=Math.sqrt(ee)):(fe=De,ye=Ge,Ce=Math.sqrt(ee/2))}return new Yt(fe/Ce,ye/Ce)}let x=[];for(let j=0,oe=I.length,Y=oe-1,fe=j+1;j<oe;j++,Y++,fe++)Y===oe&&(Y=0),fe===oe&&(fe=0),x[j]=X(I[j],I[Y],I[fe]);let L=[],R,N=x.concat();for(let j=0,oe=E.length;j<oe;j++){let Y=E[j];R=[];for(let fe=0,ye=Y.length,Ce=ye-1,De=fe+1;fe<ye;fe++,Ce++,De++)Ce===ye&&(Ce=0),De===ye&&(De=0),R[fe]=X(Y[fe],Y[Ce],Y[De]);L.push(R),N=N.concat(R)}for(let j=0;j<w;j++){let oe=j/w,Y=h*Math.cos(oe*Math.PI/2),fe=m*Math.sin(oe*Math.PI/2)+y;for(let ye=0,Ce=I.length;ye<Ce;ye++){let De=P(I[ye],x[ye],fe);q(De.x,De.y,-Y)}for(let ye=0,Ce=E.length;ye<Ce;ye++){let De=E[ye];R=L[ye];for(let Ge=0,Ye=De.length;Ge<Ye;Ge++){let Q=P(De[Ge],R[Ge],fe);q(Q.x,Q.y,-Y)}}}let z=m+y;for(let j=0;j<O;j++){let oe=u?P(v[j],N[j],z):v[j];q(oe.x,oe.y,0)}for(let j=1;j<=d;j++)for(let oe=0;oe<O;oe++){let Y=u?P(v[oe],N[oe],z):v[oe];q(Y.x,Y.y,p/d*j)}for(let j=w-1;j>=0;j--){let oe=j/w,Y=h*Math.cos(oe*Math.PI/2),fe=m*Math.sin(oe*Math.PI/2)+y;for(let ye=0,Ce=I.length;ye<Ce;ye++){let De=P(I[ye],x[ye],fe);q(De.x,De.y,p+Y)}for(let ye=0,Ce=E.length;ye<Ce;ye++){let De=E[ye];R=L[ye];for(let Ge=0,Ye=De.length;Ge<Ye;Ge++){let Q=P(De[Ge],R[Ge],fe);q(Q.x,Q.y,p+Y)}}}A(),U();function A(){let j=i.length/3;if(u){let oe=0,Y=O*oe;for(let fe=0;fe<W;fe++){let ye=T[fe];F(ye[2]+Y,ye[1]+Y,ye[0]+Y)}oe=d+w*2,Y=O*oe;for(let fe=0;fe<W;fe++){let ye=T[fe];F(ye[0]+Y,ye[1]+Y,ye[2]+Y)}}else{for(let oe=0;oe<W;oe++){let Y=T[oe];F(Y[2],Y[1],Y[0])}for(let oe=0;oe<W;oe++){let Y=T[oe];F(Y[0]+O*d,Y[1]+O*d,Y[2]+O*d)}}o.addGroup(j,i.length/3-j,0)}function U(){let j=i.length/3,oe=0;pe(I,oe),oe+=I.length;for(let Y=0,fe=E.length;Y<fe;Y++){let ye=E[Y];pe(ye,oe),oe+=ye.length}o.addGroup(j,i.length/3-j,1)}function pe(j,oe){let Y=j.length;for(;--Y>=0;){let fe=Y,ye=Y-1;ye<0&&(ye=j.length-1);for(let Ce=0,De=d+w*2;Ce<De;Ce++){let Ge=O*Ce,Ye=O*(Ce+1),Q=oe+fe+Ge,ee=oe+ye+Ge,we=oe+ye+Ye,Me=oe+fe+Ye;ge(Q,ee,we,Me)}}}function q(j,oe,Y){l.push(j),l.push(oe),l.push(Y)}function F(j,oe,Y){ne(j),ne(oe),ne(Y);let fe=i.length/3,ye=S.generateTopUV(o,i,fe-3,fe-2,fe-1);ae(ye[0]),ae(ye[1]),ae(ye[2])}function ge(j,oe,Y,fe){ne(j),ne(oe),ne(fe),ne(oe),ne(Y),ne(fe);let ye=i.length/3,Ce=S.generateSideWallUV(o,i,ye-6,ye-3,ye-2,ye-1);ae(Ce[0]),ae(Ce[1]),ae(Ce[3]),ae(Ce[1]),ae(Ce[2]),ae(Ce[3])}function ne(j){i.push(l[j*3+0]),i.push(l[j*3+1]),i.push(l[j*3+2])}function ae(j){n.push(j.x),n.push(j.y)}}}},qhe={generateTopUV:function(r,e,t,o,i){let n=e[t*3],a=e[t*3+1],s=e[o*3],l=e[o*3+1],c=e[i*3],d=e[i*3+1];return[new Yt(n,a),new Yt(s,l),new Yt(c,d)]},generateSideWallUV:function(r,e,t,o,i,n){let a=e[t*3],s=e[t*3+1],l=e[t*3+2],c=e[o*3],d=e[o*3+1],p=e[o*3+2],u=e[i*3],h=e[i*3+1],m=e[i*3+2],y=e[n*3],w=e[n*3+1],S=e[n*3+2];return Math.abs(s-d)<Math.abs(a-c)?[new Yt(a,1-l),new Yt(c,1-p),new Yt(u,1-m),new Yt(y,1-S)]:[new Yt(s,1-l),new Yt(d,1-p),new Yt(h,1-m),new Yt(w,1-S)]}};var sS=class extends gl{constructor(e=1,t=1,o=1,i=1){super(),this.type="PlaneGeometry";let n=e/2,a=t/2,s=Math.floor(o),l=Math.floor(i),c=s+1,d=l+1,p=e/s,u=t/l,h=[],m=[],y=[],w=[];for(let S=0;S<d;S++){let C=S*u-a;for(let v=0;v<c;v++){let E=v*p-n;m.push(E,-C,0),y.push(0,0,1),w.push(v/s),w.push(1-S/l)}}for(let S=0;S<l;S++)for(let C=0;C<s;C++){let v=C+c*S,E=C+c*(S+1),_=C+1+c*(S+1),T=C+1+c*S;h.push(v,E,T),h.push(E,_,T)}this.setIndex(h),this.setAttribute("position",new qi(m,3)),this.setAttribute("normal",new qi(y,3)),this.setAttribute("uv",new qi(w,2))}};var Cv=class extends Nn{constructor(t,o=1){super();this.isLight=!0;this.type="Light",this.color=new zt(t),this.intensity=o}dispose(){}};var Sv=class extends Cv{constructor(t,o){super(t,o);this.isAmbientLight=!0;this.type="AmbientLight"}};var $m=class extends Cv{constructor(t,o){super(t,o);this.isDirectionalLight=!0;this.type="DirectionalLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.target=new Nn}dispose(){}};function jm(r){let e={};for(let t in r){e[t]={};for(let o in r[t]){let i=r[t][o];i&&(i instanceof zt||i instanceof Mi||i instanceof ur||i instanceof Yt||i instanceof Ae||i instanceof Oa||i instanceof Gc||i instanceof Bd)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][o]=null):e[t][o]=i.clone():Array.isArray(i)?e[t][o]=i.slice():e[t][o]=i}}return e}function JX(r){let e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function QX(r){return r.getRenderTarget()===null?r.outputColorSpace:hl}var zhe=0,Ud=class extends Tc{constructor(e){super(),Object.defineProperty(this,"id",{value:zhe++}),this.uuid=Rd(),this.name="",this.type="Material",this.blending=Fm,this.side=ZC,this.vertexColors=!1,this.useVertexPickingColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=tM,this.blendDst=rM,this.blendEquation=Pu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=eS,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AX,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hM,this.stencilZFail=hM,this.stencilZPass=hM,this.stencilWrite=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.userData={},this.version=0,this._alphaTest=0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="",this.fragmentShader="",this.wireframe=!1,this.lights=!1,this.forceSinglePass=!0,this.exprTooComplex=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}customProgramCacheKey(){return"no-custom-cache-key"}setValues(e){if(e!==void 0)for(let t in e){let o=t,i=e[o];if(i===void 0){console.warn(`THREE.Material: parameter '${o}' has value of undefined.`);continue}let n=this[o];if(n===void 0){console.warn(`THREE.Material: '${o}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n instanceof Ae&&i&&i instanceof Ae?n.copy(i):this[o]=i}}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.useVertexPickingColors=e.useVertexPickingColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=jm(e.uniforms),this.uniformsGroups=JX(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.lights=e.lights,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};var Ym=class extends js{constructor(e,t,o=!1,i=1){super(e,t,o),this.meshPerAttribute=i}};var Bn=class extends Nn{constructor(e,t){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t}};var ZX=new ur,eJ=new og,Un=class extends Bn{constructor(e,t,o){super(e,t),this.instanceMatrix=new Ym(new Float32Array(o*16),16),this.instanceColor=new Ym(new Float32Array(o*3),3),this.instancePickingColor=new Ym(new Float32Array(o*4),4),this.count=o}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getPickingColorAt(e,t){let o=this.instancePickingColor.array;e=e*4,t[0]=o[e+0],t[1]=o[e+1],t[2]=o[e+2],t[3]=o[e+3]}setColorAt(e,t){t.toArray(this.instanceColor.array,e*3)}setPickingColorAt(e,t){let o=this.instancePickingColor.array,i=e*4;o[i+0]=t[0],o[i+1]=t[1],o[i+2]=t[2],o[i+3]=t[3]}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}computeBoundingSphere(){var o,i;let e=this.geometry,t=this.count;this.boundingSphere||(this.boundingSphere=new og),e.boundingSphere||e.computeBoundingSphere(),(o=this.boundingSphere)==null||o.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,ZX),eJ.copy(e.boundingSphere).applyMatrix4(ZX),(i=this.boundingSphere)==null||i.union(eJ)}dispose(){this.dispatchEvent({type:"dispose"})}};var ig=class{constructor(e=new Ae(1,0,0),t=0){this.isPlane=!0;this.normal=e,this.constant=t}setComponents(e,t,o,i){return this.normal.set(e,t,o),this.constant=i,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}distanceToPoint(e){return this.normal.dot(e)+this.constant}};var lS=new og,DM=class{constructor(e=new ig,t=new ig,o=new ig,i=new ig,n=new ig,a=new ig){this.planes=[e,t,o,i,n,a]}setFromProjectionMatrix(e,t=Nd){let o=this.planes,i=e.elements,n=i[0],a=i[1],s=i[2],l=i[3],c=i[4],d=i[5],p=i[6],u=i[7],h=i[8],m=i[9],y=i[10],w=i[11],S=i[12],C=i[13],v=i[14],E=i[15];if(o[0].setComponents(l-n,u-c,w-h,E-S).normalize(),o[1].setComponents(l+n,u+c,w+h,E+S).normalize(),o[2].setComponents(l+a,u+d,w+m,E+C).normalize(),o[3].setComponents(l-a,u-d,w-m,E-C).normalize(),o[4].setComponents(l-s,u-p,w-y,E-v).normalize(),t===Nd)o[5].setComponents(l+s,u+p,w+y,E+v).normalize();else if(t===iS)o[5].setComponents(s,p,y,v).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){let t=e.geometry;return t?(e instanceof Un?(e.computeBoundingSphere(),lS.copy(e.boundingSphere).applyMatrix4(e.matrixWorld)):(t.boundingSphere||t.computeBoundingSphere(),lS.copy(t.boundingSphere),lS.applyMatrix4(e.dcgModelMatrix),lS.applyMatrix4(e.matrixWorld)),this.intersectsSphere(lS)):!1}intersectsSphere(e){let t=this.planes,o=e.center,i=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(o)<i)return!1;return!0}};var cS=class extends Nn{constructor(){super(),this.isGroup=!0,this.type="Group"}};var tJ=new Ae,rJ=new Ae,kM=class extends Nn{constructor(e,t){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,o=[0];for(let i=1,n=t.count;i<n;i++)tJ.fromBufferAttribute(t,i-1),rJ.fromBufferAttribute(t,i),o[i]=o[i-1],o[i]+=tJ.distanceTo(rJ);e.setAttribute("lineDistance",new qi(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var oJ=new Ae,iJ=new Ae,_M=class extends kM{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,o=[];for(let i=0,n=t.count;i<n;i+=2)oJ.fromBufferAttribute(t,i),iJ.fromBufferAttribute(t,i+1),o[i]=i===0?0:o[i-1],o[i+1]=o[i]+oJ.distanceTo(iJ);e.setAttribute("lineDistance",new qi(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var nJ=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}

vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
`;var aJ=`
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#define saturate( a ) clamp( a, 0.0, 1.0 )

float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }

#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif

struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};

struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};

struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
};

vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}

vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
`;var sJ=`
#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif

#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif
`;var lJ=`
#ifdef OPAQUE
  diffuseColor.a = 1.0;
#endif

gl_FragColor = vec4( outgoingLight, diffuseColor.a );
gl_FragColor = linearToOutputTexel( gl_FragColor );

#ifdef PREMULTIPLIED_ALPHA
	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
`;var cJ=`
#ifdef USE_MAP
	varying vec2 vMapUv;
	uniform sampler2D map;
#endif

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif

#if defined(USE_INSTANCING_PICKINGCOLOR) || defined(USE_VERTEX_PICKING_COLOR)
	varying vec4 vPickingColor;
#endif
`;var dJ=`
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif

#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif

#if defined(USE_INSTANCING_PICKINGCOLOR) || defined (USE_VERTEX_PICKING_COLOR)
	varying vec4 vPickingColor;
#endif
`;var pJ=`
#ifdef USE_MAP
	vMapUv = ( vec3( MAP_UV, 1 ) ).xy;
#endif

vec3 transformed = vec3( position );
vec4 mvPosition = vec4( transformed, 1.0 );

#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#else
	mvPosition = dcgModelMatrix * mvPosition;
#endif

mvPosition = modelViewMatrix * mvPosition;

gl_Position = projectionMatrix * mvPosition;

#ifdef USE_COLOR
	vColor = color;
#endif

#ifdef USE_INSTANCING_COLOR
  vColor = instanceColor;
#endif

#ifdef USE_INSTANCING_PICKINGCOLOR
	vPickingColor = instancePickingColor;
#endif

#ifdef USE_VERTEX_PICKING_COLOR
	vPickingColor = vertexPickingColor;
#endif

`;var uJ=`
PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );

vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );

material.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.
material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );

#ifdef IOR
	material.ior = ior;
	float specularIntensityFactor = 1.0;
	vec3 specularColorFactor = vec3( 1.0 );
	material.specularF90 = 1.0;
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif

GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

IncidentLight directLight;

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif

#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif

#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif

#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif
`;var hJ=`
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];

vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}

vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}

#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif

struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;

	#ifdef IOR
		float ior;
	#endif
};

vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );

float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}

float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1
	return RECIPROCAL_PI * a2 / pow2( denom );
}

vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness ); // UE4's roughness
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}

vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}

void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 Fr = specularColor;
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21
	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}

void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}

#define RE_Direct RE_Direct_Physical
#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular	RE_IndirectSpecular_Physical
`;var Ra={common:aJ,colorspace_pars_fragment:nJ,common_fragment_begin:sJ,common_fragment_end:lJ,common_pars_fragment:cJ,common_pars_vertex:dJ,common_vertex:pJ,lights_fragment:uJ,lights_pars_fragment:hJ};var FN={common:{diffuse:{value:new zt(16777215)},opacity:{value:1},map:{value:null},alphaTest:{value:0}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}}}};var TM=class{constructor(e,t){this.gl=e;this.info=t}setMode(e){this.mode=e}render(e,t){this.gl.drawArrays(this.mode,e,t),this.info.update(t,this.mode,1)}renderInstances(e,t,o){o!==0&&(this.gl.drawArraysInstanced(this.mode,e,t,o),this.info.update(t,this.mode,o))}};var GM=class{constructor(e,t,o){let i;function n(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){let I=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i||0}function a(I){if(I==="highp"){let P=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),O=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);if(P!==null&&P.precision>0&&O!==null&&O.precision>0)return"highp";I="mediump"}if(I==="mediump"){let P=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),O=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT);if(P!==null&&P.precision>0&&O!==null&&O.precision>0)return"mediump"}return"lowp"}let s=typeof WebGL2RenderingContext!="undefined"&&e.constructor.name==="WebGL2RenderingContext",l=o.precision!==void 0?o.precision:"highp",c=a(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);let d=s||t.has("WEBGL_draw_buffers"),p=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),m=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),y=e.getParameter(e.MAX_VERTEX_ATTRIBS),w=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),S=e.getParameter(e.MAX_VARYING_VECTORS),C=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,E=s||t.has("OES_texture_float"),_=v&&E,T=s?e.getParameter(e.MAX_SAMPLES):0;this.isWebGL2=s,this.drawBuffers=d,this.getMaxAnisotropy=n,this.getMaxPrecision=a,this.precision=l,this.maxTextures=p,this.maxVertexTextures=u,this.maxTextureSize=h,this.maxCubemapSize=m,this.maxAttributes=y,this.maxVertexUniforms=w,this.maxVaryings=S,this.maxFragmentUniforms=C,this.vertexTextures=v,this.floatFragmentTextures=E,this.floatVertexTextures=_,this.maxSamples=T}};var IM=class{constructor(e){let t={};function o(i){if(t[i]!==void 0)return t[i];let n;switch(i){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}this.has=function(i){return o(i)!==null},this.init=function(){o("EXT_color_buffer_float"),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float"),o("WEBGL_multisampled_render_to_texture")},this.get=function(i){let n=o(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}};var Ev=class extends gl{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}};var MM=class{constructor(e,t,o,i){let n={},a=new WeakMap;function s(u){let h=u.target;h.index!==null&&t.remove(h.index);for(let y in h.attributes)t.remove(h.attributes[y]);h.removeEventListener("dispose",s),delete n[h.id];let m=a.get(h);m&&(t.remove(m),a.delete(h)),i.releaseStatesOfGeometry(h),h instanceof Ev&&delete h._maxInstanceCount,o.memory.geometries--}function l(u,h){return n[h.id]===!0||(h.addEventListener("dispose",s),n[h.id]=!0,o.memory.geometries++),h}function c(u){let h=u.attributes;for(let m in h)t.update(h[m],e.ARRAY_BUFFER)}function d(u){let h=[],m=u.index,y=u.attributes.position,w=0;if(m!==null){let v=m.array;w=m.version;for(let E=0,_=v.length;E<_;E+=3){let T=v[E+0],I=v[E+1],P=v[E+2];h.push(T,I,I,P,P,T)}}else if(y!==void 0){let v=y.array;w=y.version;for(let E=0,_=v.length/3-1;E<_;E+=3){let T=E+0,I=E+1,P=E+2;h.push(T,I,I,P,P,T)}}else return;let S=new(fM(h)?qm:Um)(h,1);S.version=w;let C=a.get(u);C&&t.remove(C),a.set(u,S)}function p(u){let h=a.get(u);if(h){let y=u.index;y!==null&&h.version<y.version&&d(u)}else d(u);let m=a.get(u);return qt(m,"attribute"),m}this.get=l,this.update=c,this.getWireframeAttribute=p}};var AM=class{constructor(e,t){this.gl=e;this.info=t}setMode(e){this.mode=e}setIndex(e){this.type=e.type,this.bytesPerElement=e.bytesPerElement}render(e,t){this.gl.drawElements(this.mode,t,this.type,e*this.bytesPerElement),this.info.update(t,this.mode,1)}renderInstances(e,t,o){o!==0&&(this.gl.drawElementsInstanced(this.mode,t,this.type,e*this.bytesPerElement,o),this.info.update(t,this.mode,o))}};var VM=class{constructor(e){this.gl=e;this.autoReset=!0;this.programs=null;this.memory={geometries:0,textures:0},this.render={frame:0,calls:0,triangles:0,points:0,lines:0}}update(e,t,o){let i=this.gl,n=this.render;switch(n.calls++,t){case i.TRIANGLES:n.triangles+=o*(e/3);break;case i.LINES:n.lines+=o*(e/2);break;case i.LINE_STRIP:n.lines+=o*(e-1);break;case i.LINE_LOOP:n.lines+=o*e;break;case i.POINTS:n.points+=o*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t);break}}reset(){this.render.calls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}};var NN=class{constructor(){this.lights={}}get(e){let t=this.lights,o=t[e.id];if(o!==void 0)return o;let i={direction:new Ae,color:new zt};return t[e.id]=i,i}},Hhe=0,LM=class{constructor(){let e=new NN;this.state={version:0,hash:{directionalLength:-1},ambient:[0,0,0],directional:[]};let t=this.state,o=new Ae;function i(a){let s=0,l=0,c=0,d=0;for(let u=0,h=a.length;u<h;u++){let m=a[u],y=m.color,w=m.intensity;if(m instanceof Sv)s+=y.r*w,l+=y.g*w,c+=y.b*w;else if(m instanceof $m){let S=e.get(m);S.color.copy(m.color).multiplyScalar(m.intensity),t.directional[d]=S,d++}}t.ambient[0]=s,t.ambient[1]=l,t.ambient[2]=c;let p=t.hash;p.directionalLength!==d&&(t.directional.length=d,p.directionalLength=d,t.version=Hhe++)}function n(a,s){let l=0,c=s.matrixWorldInverse;for(let d=0,p=a.length;d<p;d++){let u=a[d];if(u instanceof $m){let h=t.directional[l];h.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),h.direction.sub(o),h.direction.transformDirection(c),l++}}}this.setup=i,this.setupView=n}};var PM=class{constructor(e,t,o,i){let n=new WeakMap;function a(c){let d=i.render.frame,p=c.geometry,u=t.get(c,p);return n.get(u)!==d&&(t.update(u),n.set(u,d)),c instanceof Un&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),n.get(c)!==d&&(o.update(c.instanceMatrix,e.ARRAY_BUFFER),c.instanceColor&&o.update(c.instanceColor,e.ARRAY_BUFFER),c.instancePickingColor&&o.update(c.instancePickingColor,e.ARRAY_BUFFER),n.set(c,d))),u}function s(){n=new WeakMap}function l(c){let d=c.target;d.removeEventListener("dispose",l),o.remove(d.instanceMatrix),d.instanceColor&&o.remove(d.instanceColor),d.instancePickingColor&&o.remove(d.instancePickingColor)}this.update=a,this.dispose=s}};Xa();function BN(r,e,t){let o=r.createShader(e);if(!o)throw new Error(`Error creating shader (type ${e}): ${t}`);return r.shaderSource(o,t),r.compileShader(o),o}var wJ=new Gc(new Nu(0,0));function Khe(r){return typeof r[0]=="number"}function ng(r){return!Array.isArray(r)&&"x"in r}var gJ=[],mJ=[],fJ=new Float32Array(16),bJ=new Float32Array(9),yJ=new Float32Array(4);function Dv(r,e,t){if(Khe(r))return r;let o=e*t,i=gJ[o];if(i===void 0&&(i=new Float32Array(o),gJ[o]=i),e!==0){r[0].toArray(i,0);for(let n=1,a=0;n!==e;++n)a+=t,r[n].toArray(i,a)}return i}function ml(r,e){if(r.length!==e.length)return!1;for(let t=0,o=r.length;t<o;t++)if(r[t]!==e[t])return!1;return!0}function fl(r,e){for(let t=0,o=e.length;t<o;t++)r[t]=e[t]}function Whe(r,e){let t=mJ[e];t===void 0&&(t=new Int32Array(e),mJ[e]=t);for(let o=0;o!==e;++o)t[o]=r.allocateTextureUnit();return t}function $he(r,e){let t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function jhe(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ml(t,e))return;r.uniform2fv(this.addr,e),fl(t,e)}}function Yhe(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e instanceof zt)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ml(t,e))return;r.uniform3fv(this.addr,e),fl(t,e)}}function Xhe(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ml(t,e))return;r.uniform4fv(this.addr,e),fl(t,e)}}function Jhe(r,e){let t=this.cache;if(Array.isArray(e)){if(ml(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),fl(t,e)}else{let o=e.elements;if(ml(t,o))return;yJ.set(o),r.uniformMatrix2fv(this.addr,!1,yJ),fl(t,o)}}function Qhe(r,e){let t=this.cache;if(Array.isArray(e)){if(ml(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),fl(t,e)}else{let o=e.elements;if(ml(t,o))return;bJ.set(o),r.uniformMatrix3fv(this.addr,!1,bJ),fl(t,o)}}function Zhe(r,e){let t=this.cache;if(Array.isArray(e)){if(ml(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),fl(t,e)}else{let o=e.elements;if(ml(t,o))return;fJ.set(o),r.uniformMatrix4fv(this.addr,!1,fJ),fl(t,o)}}function ege(r,e){let t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function tge(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ml(t,e))return;r.uniform2iv(this.addr,e),fl(t,e)}}function rge(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ml(t,e))return;r.uniform3iv(this.addr,e),fl(t,e)}}function oge(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ml(t,e))return;r.uniform4iv(this.addr,e),fl(t,e)}}function ige(r,e){let t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function nge(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ml(t,e))return;r.uniform2uiv(this.addr,e),fl(t,e)}}function age(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ml(t,e))return;r.uniform3uiv(this.addr,e),fl(t,e)}}function sge(r,e){let t=this.cache;if(ng(e))(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ml(t,e))return;r.uniform4uiv(this.addr,e),fl(t,e)}}function lge(r,e,t){let o=this.cache,i=t.allocateTextureUnit();o[0]!==i&&(r.uniform1i(this.addr,i),o[0]=i),t.setTexture2D(e||wJ,i)}function cge(r){switch(r){case 5126:return $he;case 35664:return jhe;case 35665:return Yhe;case 35666:return Xhe;case 35674:return Jhe;case 35675:return Qhe;case 35676:return Zhe;case 5124:case 35670:return ege;case 35667:case 35671:return tge;case 35668:case 35672:return rge;case 35669:case 35673:return oge;case 5125:return ige;case 36294:return nge;case 36295:return age;case 36296:return sge;case 35678:case 36198:case 36298:case 36306:return lge;case 35679:case 36299:case 36307:throw new Error("THREE.WebGLUniforms: sampler3D support is not implemented.");case 35680:case 36300:case 36308:throw new Error("THREE.WebGLUniforms: samplerCube support is not implemented.");case 36289:case 36303:case 36311:throw new Error("THREE.WebGLUniforms: sampler2DArray support is not implemented.")}throw new Error(`Unknown uniform type: ${r}`)}function dge(r,e){r.uniform1fv(this.addr,e)}function pge(r,e){let t=Dv(e,this.size,2);r.uniform2fv(this.addr,t)}function uge(r,e){let t=Dv(e,this.size,3);r.uniform3fv(this.addr,t)}function hge(r,e){let t=Dv(e,this.size,4);r.uniform4fv(this.addr,t)}function gge(r,e){let t=Dv(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function mge(r,e){let t=Dv(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function fge(r,e){let t=Dv(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function bge(r,e){r.uniform1iv(this.addr,e)}function yge(r,e){r.uniform2iv(this.addr,e)}function xge(r,e){r.uniform3iv(this.addr,e)}function wge(r,e){r.uniform4iv(this.addr,e)}function vge(r,e){r.uniform1uiv(this.addr,e)}function Cge(r,e){r.uniform2uiv(this.addr,e)}function Sge(r,e){r.uniform3uiv(this.addr,e)}function Ege(r,e){r.uniform4uiv(this.addr,e)}function Dge(r,e,t){let o=this.cache,i=e.length,n=Whe(t,i);ml(o,n)||(r.uniform1iv(this.addr,n),fl(o,n));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||wJ,n[a])}function kge(r){switch(r){case 5126:return dge;case 35664:return pge;case 35665:return uge;case 35666:return hge;case 35674:return gge;case 35675:return mge;case 35676:return fge;case 5124:case 35670:return bge;case 35667:case 35671:return yge;case 35668:case 35672:return xge;case 35669:case 35673:return wge;case 5125:return vge;case 36294:return Cge;case 36295:return Sge;case 36296:return Ege;case 35678:case 36198:case 36298:case 36306:return Dge;case 35679:case 36299:case 36307:throw new Error("THREE.WebGLUniforms: sampler3DArray support is not implemented.");case 35680:case 36300:case 36308:throw new Error("THREE.WebGLUniforms: samplerCube support is not implemented.");case 36289:case 36303:case 36311:throw new Error("THREE.WebGLUniforms: sampler2DArray support is not implemented.")}throw new Error(`Unrecognized uniform type: ${r}`)}var qN=class{constructor(e,t,o){this.id=e,this.addr=o,this.cache=[],this.setValue=cge(t.type)}},zN=class{constructor(e,t,o){this.id=e,this.addr=o,this.cache=[],this.size=t.size,this.setValue=kge(t.type)}},OM=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,o){let i=this.seq;for(let n=0,a=i.length;n!==a;++n){let s=i[n];s.setValue(e,t[s.id],o)}}},UN=/(\w+)(\])?(\[|\.)?/g;function xJ(r,e){r.seq.push(e),r.map[e.id]=e}function _ge(r,e,t){let o=r.name,i=o.length;for(UN.lastIndex=0;;){let n=UN.exec(o),a=UN.lastIndex;qt(n,"parseUniform match");let s=n[1],l=n[2]==="]",c=n[3];if(l&&(s=s|0),c===void 0||c==="["&&a+2===i){xJ(t,c===void 0?new qN(s,r,e):new zN(s,r,e));break}else{let p=t.map[s];if(p===void 0&&(p=new OM(s),xJ(t,p)),!(p instanceof OM))throw new Error(`THREE.WebGLUniforms: Programming error: expected ${s} to be a StructuredUniform`);t=p}}}var Xm=class{constructor(e,t){this.seq=[],this.map={};let o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<o;++i){let n=e.getActiveUniform(t,i);qt(n,"active info",e);let a=e.getUniformLocation(t,n.name);_ge(n,a,this)}}setValue(e,t,o,i){let n=this.map[t];n!==void 0&&n.setValue(e,o,i)}setOptional(e,t,o,i){let n=t[o];n!==void 0&&this.setValue(e,o,n,i)}static upload(e,t,o,i){for(let n=0,a=t.length;n!==a;++n){let s=t[n],l=o[s.id];l.needsUpdate!==!1&&s.setValue(e,l.value,i)}}static seqWithValue(e,t){let o=[];for(let i=0,n=e.length;i!==n;++i){let a=e[i];a.id in t&&o.push(a)}return o}};var Tge=0;function Gge(r,e){if(r===null)throw new Error("Shader source is undefined.");let t=r.split(`
`),o=[],i=Math.max(e-6,0),n=Math.min(e+6,t.length);for(let a=i;a<n;a++){let s=a+1;o.push(`${s===e?">":" "} ${s}: ${t[a]}`)}return o.join(`
`)}function Ige(r){switch(r){case hl:return["Linear","( value )"];case Ii:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),["Linear","( value )"]}}function vJ(r,e,t){let o=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e);qt(i,"shader info",r);let n=i.trim()||"";if(o&&n==="")return"";let a=/ERROR: 0:(\d+)/.exec(n);if(a){let s=parseInt(a[1]);return t.toUpperCase()+`

`+n+`

`+Gge(r.getShaderSource(e),s)}else return n}function Mge(r,e){let t=Ige(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Age(r){let e=[];for(let t in r){let o=r[t];o!==!1&&e.push("#define "+t+" "+o)}return e.join(`
`)}function Vge(r,e){let t={},o=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<o;i++){let n=r.getActiveAttrib(e,i);if(!n)throw new Error("THREE.WebGLProgram: Error fetching attribute info.");let a=n.name,s=1;n.type===r.FLOAT_MAT2&&(s=2),n.type===r.FLOAT_MAT3&&(s=3),n.type===r.FLOAT_MAT4&&(s=4),t[a]={type:n.type,location:r.getAttribLocation(e,a),locationSize:s}}return t}function CJ(r){return r!==""}function SJ(r,e){return r.replace(/NUM_DIR_LIGHTS/g,""+e.numDirLights)}var Lge=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function EJ(r){return r.replace(Lge,Pge)}function Pge(r,e,t,o){let i="";for(let n=parseInt(e);n<parseInt(t);n++)i+=o.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,""+n);return i}function DJ(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}var RM=class{constructor(e,t,o,i){var E,_,T;let n=e.getContext(),a=o.defines,s=o.vertexShader,l=o.fragmentShader,c=Age(a),d=n.createProgram();if(!d)throw new Error("THREE.WebGLProgram: Unable to create program.");let p,u,h=o.glslVersion?"#version "+o.glslVersion+`
`:"";p=[DJ(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,c,o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.instancingPickingColor?"#define USE_INSTANCING_PICKINGCOLOR":"",o.vertexPickingColor?"#define USE_VERTEX_PICKING_COLOR":"",o.map?"#define USE_MAP":"",o.mapUv?"#define MAP_UV "+o.mapUv:"",o.vertexColors?"#define USE_COLOR":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_PICKINGCOLOR","	attribute vec4 instancePickingColor;","#endif","#ifdef USE_VERTEX_PICKING_COLOR"," attribute vec4 vertexPickingColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif",`
`].filter(CJ).join(`
`),u=[DJ(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,c,o.map?"#define USE_MAP":"",o.alphaTest?"#define USE_ALPHATEST":"",o.vertexColors?"#define USE_COLOR":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.instancingPickingColor?"#define USE_INSTANCING_PICKINGCOLOR":"",o.vertexPickingColor?"#define USE_VERTEX_PICKING_COLOR":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.opaque?"#define OPAQUE":"",Ra.colorspace_pars_fragment,Mge("linearToOutputTexel",o.outputColorSpace),`
`].filter(CJ).join(`
`),s=SJ(s,o),l=SJ(l,o),s=EJ(s),l=EJ(l),h=`#version 300 es
`,p=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+p,u=["#define varying in",o.glslVersion===GN?"":"layout(location = 0) out highp vec4 pc_fragColor;",o.glslVersion===GN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+u;let m=h+p+s,y=h+u+l,w=BN(n,n.VERTEX_SHADER,m),S=BN(n,n.FRAGMENT_SHADER,y);if(n.attachShader(d,w),n.attachShader(d,S),o.index0AttributeName!==void 0&&n.bindAttribLocation(d,0,o.index0AttributeName),n.linkProgram(d),e.debug.checkShaderErrors){let I=(E=n.getProgramInfoLog(d))==null?void 0:E.trim(),P=(_=n.getShaderInfoLog(w))==null?void 0:_.trim(),O=(T=n.getShaderInfoLog(S))==null?void 0:T.trim();qt(I,"program lob",n),qt(P,"vertex log",n),qt(O,"fragment log",n);let W=!0,X=!0,x=!1;if(n.getProgramParameter(d,n.LINK_STATUS)===!1)if(W=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,d,w,S);else{let L=vJ(n,w,"vertex"),R=vJ(n,S,"fragment"),N=n.getError();x=R.includes("Expression too complex"),x||(console.error("THREE.WebGLProgram: Shader Error "+N+" - VALIDATE_STATUS "+n.getProgramParameter(d,n.VALIDATE_STATUS)+`

Program Info Log: `+I+`
`+L+`
`+R),N&&N!=1282||L||R||I&&N!=1282?Vo("Shader error",{metaData:{glError:N,glProgramParameter:n.getProgramParameter(d,n.VALIDATE_STATUS),glProgramLog:I,glVertexErrors:L,glFragmentError:R,vertexShader:m,fragmentShader:y}}):Vo("WebGL program link failure with no error reported",{metaData:{vertexShader:m,fragmentShader:y}}))}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(P===""||O==="")&&(X=!1);X&&(this.diagnostics={runnable:W,exprTooComplex:x,programLog:I,vertexShader:{log:P,prefix:p},fragmentShader:{log:O,prefix:u}})}n.deleteShader(w),n.deleteShader(S);let C;this.getUniforms=function(){return C===void 0&&(C=new Xm(n,d)),C};let v;this.getAttributes=function(){return v===void 0&&(v=Vge(n,d)),v},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(d),this.program=void 0},this.type=o.shaderType,this.name=o.shaderName,this.id=Tge++,this.cacheKey=t,this.usedTimes=1,this.program=d,this.vertexShader=w,this.fragmentShader=S}};var Oge=0,FM=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,o=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(o),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(n)===!1&&(a.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let o of t||[])o.usedTimes--,o.usedTimes===0&&this.shaderCache.delete(o.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,o=t.get(e);return o===void 0&&(o=new Set,t.set(e,o)),o}_getShaderStage(e){let t=this.shaderCache,o=t.get(e);return o===void 0&&(o=new HN(e),t.set(e,o)),o}},HN=class{constructor(e){this.id=Oge++,this.code=e,this.usedTimes=0}};var NM=class{constructor(e,t,o){let i=new fv,n=new FM,a=[],s=t.vertexTextures,l=t.precision;function c(C){return C===0?"uv":`uv${C}`}function d(C,v,E,_){var A,U,pe,q;let T=_.geometry;C.precision!==null&&(l=t.getMaxPrecision(C.precision),l!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",l,"instead."));let I=C.vertexShader,P=C.fragmentShader;n.update(C);let O=n.getVertexShaderID(C),W=n.getFragmentShaderID(C),X=e.getRenderTarget(),x=_ instanceof Un,L=!!T.attributes.uv1,R=!!T.attributes.uv2,N=!!T.attributes.uv3;return{shaderType:C.type,shaderName:C.name,vertexShader:I,fragmentShader:P,defines:C.defines,customVertexShaderID:O,customFragmentShaderID:W,glslVersion:C.glslVersion,precision:l,instancing:x,instancingColor:x&&!!_.instanceColor,instancingPickingColor:x&&!!_.instancePickingColor,vertexPickingColor:!!_.pickingColorArray,supportsVertexTextures:s,outputColorSpace:X===null?e.outputColorSpace:hl,map:!!C.map,opaque:C.transparent===!1&&C.blending===Fm,alphaTest:C.alphaTest>0,mapUv:!!C.map&&c(C.map.channel),vertexColors:C.vertexColors,vertexUv1s:L,vertexUv2s:R,vertexUv3s:N,numDirLights:v.directional.length,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===$s,flipSided:C.side===qb,index0AttributeName:C.index0AttributeName,extensionDerivatives:((A=C.extensions)==null?void 0:A.derivatives)===!0,extensionFragDepth:((U=C.extensions)==null?void 0:U.fragDepth)===!0,extensionDrawBuffers:((pe=C.extensions)==null?void 0:pe.drawBuffers)===!0,extensionShaderTextureLOD:((q=C.extensions)==null?void 0:q.shaderTextureLOD)===!0,rendererExtensionFragDepth:!0,rendererExtensionDrawBuffers:!0,rendererExtensionShaderTextureLod:!0,customProgramCacheKey:C.customProgramCacheKey()}}function p(C){let v=[];if(v.push(C.customVertexShaderID),v.push(C.customFragmentShaderID),C.defines!==void 0)for(let E in C.defines)v.push(E),v.push(C.defines[E]);return u(v,C),h(v,C),v.push(e.outputColorSpace),v.push(C.customProgramCacheKey),v.join()}function u(C,v){C.push(v.precision),C.push(v.outputColorSpace),C.push(v.mapUv),C.push(v.numDirLights)}function h(C,v){i.disableAll(),i.enable(0),v.instancing&&i.enable(2),v.instancingColor&&i.enable(3),v.instancingPickingColor&&i.enable(4),v.vertexPickingColor&&i.enable(5),v.supportsVertexTextures&&i.enable(1),v.alphaTest&&i.enable(10),v.vertexColors&&i.enable(11),v.vertexUv1s&&i.enable(13),v.vertexUv2s&&i.enable(14),v.vertexUv3s&&i.enable(15),C.push(i.mask),i.disableAll(),v.premultipliedAlpha&&i.enable(8),v.doubleSided&&i.enable(11),v.flipSided&&i.enable(12),v.opaque&&i.enable(17),C.push(i.mask)}function m(C,v){let E;for(let _=0,T=a.length;_<T;_++){let I=a[_];if(I.cacheKey===v){E=I,++E.usedTimes;break}}return E===void 0&&(E=new RM(e,v,C,o),a.push(E)),E}function y(C){if(--C.usedTimes===0){let v=a.indexOf(C);a[v]=a[a.length-1],a.pop(),C.destroy()}}function w(C){n.remove(C)}function S(){n.dispose()}this.getParameters=d,this.getProgramCacheKey=p,this.getUniforms=C=>C.uniforms,this.acquireProgram=m,this.releaseProgram=y,this.releaseShaderCache=w,this.programs=a,this.dispose=S}};var BM=class{constructor(){let e=new WeakMap;function t(a){let s=e.get(a);return s===void 0&&(s={},e.set(a,s)),s}function o(a){e.delete(a)}function i(a,s,l){e.get(a)[s]=l}function n(){e=new WeakMap}this.get=t,this.remove=o,this.update=i,this.dispose=n}};var UM=class{constructor(){let e=[],t=0,o=[],i=[];function n(){t=0,o.length=0,i.length=0}function a(p,u,h,m,y,w){let S=e[t];return S===void 0?(S={id:p.id,object:p,geometry:u,material:h,groupOrder:m,renderOrder:p.renderOrder,z:y,group:w},e[t]=S):(S.id=p.id,S.object=p,S.geometry=u,S.material=h,S.groupOrder=m,S.renderOrder=p.renderOrder,S.z=y,S.group=w),t++,S}function s(p,u,h,m,y,w){let S=a(p,u,h,m,y,w);h.transparent===!0?i.push(S):o.push(S)}function l(p,u,h,m,y,w){let S=a(p,u,h,m,y,w);h.transparent===!0?i.unshift(S):o.unshift(S)}function c(p,u){o.length>1&&o.sort(p||Rge),i.length>1&&i.sort(u||Fge)}function d(){for(let p=t,u=e.length;p<u;p++){let h=e[p];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}this.opaque=o,this.transparent=i,this.init=n,this.push=s,this.unshift=l,this.finish=d,this.sort=c}},qM=class{constructor(){let e=new WeakMap;function t(i,n){let a=e.get(i),s;return a===void 0?(s=new UM,e.set(i,[s])):n>=a.length?(s=new UM,a.push(s)):s=a[n],s}function o(){e=new WeakMap}this.get=t,this.dispose=o}};function Rge(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Fge(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}var zM=class{constructor(e){function t(){let de=!1,se=new Oa,He=null,xe=new Oa(0,0,0,0);return{setMask:function(at){He!==at&&!de&&(e.colorMask(at,at,at,at),He=at)},setLocked:function(at){de=at},setClear:function(at,We,to,Dt,sa){sa===!0&&(at*=Dt,We*=Dt,to*=Dt),se.set(at,We,to,Dt),xe.equals(se)===!1&&(e.clearColor(at,We,to,Dt),xe.copy(se))},reset:function(){de=!1,He=null,xe.set(-1,0,0,0)}}}function o(){let de=!1,se=null,He=null,xe=null;return{setTest:function(at){at?j(e.DEPTH_TEST):oe(e.DEPTH_TEST)},setMask:function(at){se!==at&&!de&&(e.depthMask(at),se=at)},setFunc:function(at){if(He!==at){switch(at){case mX:e.depthFunc(e.NEVER);break;case fX:e.depthFunc(e.ALWAYS);break;case bX:e.depthFunc(e.LESS);break;case eS:e.depthFunc(e.LEQUAL);break;case yX:e.depthFunc(e.EQUAL);break;case xX:e.depthFunc(e.GEQUAL);break;case wX:e.depthFunc(e.GREATER);break;case vX:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}He=at}},setLocked:function(at){de=at},setClear:function(at){xe!==at&&(e.clearDepth(at),xe=at)},reset:function(){de=!1,se=null,He=null,xe=null}}}function i(){let de=!1,se=null,He=null,xe=null,at=null,We=null,to=null,Dt=null,sa=null;return{setTest:function(No){de||(No?j(e.STENCIL_TEST):oe(e.STENCIL_TEST))},setMask:function(No){se!==No&&!de&&(e.stencilMask(No),se=No)},setFunc:function(No,bi,tt){(He!==No||xe!==bi||at!==tt)&&(e.stencilFunc(No,bi,tt),He=No,xe=bi,at=tt)},setOp:function(No,bi,tt){(We!==No||to!==bi||Dt!==tt)&&(e.stencilOp(No,bi,tt),We=No,to=bi,Dt=tt)},setLocked:function(No){de=No},setClear:function(No){sa!==No&&(e.clearStencil(No),sa=No)},reset:function(){de=!1,se=null,He=null,xe=null,at=null,We=null,to=null,Dt=null,sa=null}}}let n=t(),a=o(),s=i(),l=new WeakMap,c=new WeakMap,d={},p={},u=new WeakMap,h=[],m=null,y=!1,w=null,S=null,C=null,v=null,E=null,_=null,T=null,I=!1,P=null,O=null,W=null,X=null,x=null,L=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),R=!1,N=0,z=e.getParameter(e.VERSION);if(z.indexOf("WebGL")!==-1){let de=/^WebGL (\d)/.exec(z);qt(de,"webgl version match",e),N=parseFloat(de[1]),R=N>=1}else if(z.indexOf("OpenGL ES")!==-1){let de=/^OpenGL ES (\d)/.exec(z);qt(de,"opengl es version match",e),N=parseFloat(de[1]),R=N>=2}let A=null,U={},pe=e.getParameter(e.SCISSOR_BOX),q=e.getParameter(e.VIEWPORT),F=new Oa().fromArray(pe),ge=new Oa().fromArray(q);function ne(de,se,He,xe){let at=new Uint8Array(4),We=e.createTexture();e.bindTexture(de,We),e.texParameteri(de,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(de,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let to=0;to<He;to++)de===e.TEXTURE_3D||de===e.TEXTURE_2D_ARRAY?(qt(xe,"dimensions"),e.texImage3D(se,0,e.RGBA,1,1,xe,0,e.RGBA,e.UNSIGNED_BYTE,at)):e.texImage2D(se+to,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,at);return We}let ae={[e.TEXTURE_2D]:ne(e.TEXTURE_2D,e.TEXTURE_2D,1),[e.TEXTURE_CUBE_MAP]:ne(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),[e.TEXTURE_2D_ARRAY]:ne(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),[e.TEXTURE_3D]:ne(e.TEXTURE_3D,e.TEXTURE_3D,1,1)};n.setClear(0,0,0,1),a.setClear(1),s.setClear(0),j(e.DEPTH_TEST),a.setFunc(eS),Q(!1),ee(Q3),j(e.CULL_FACE),Ge(JI);function j(de){d[de]!==!0&&(e.enable(de),d[de]=!0)}function oe(de){d[de]!==!1&&(e.disable(de),d[de]=!1)}function Y(de,se){return p[de]!==se?(e.bindFramebuffer(de,se),p[de]=se,de===e.DRAW_FRAMEBUFFER&&(p[e.FRAMEBUFFER]=se),de===e.FRAMEBUFFER&&(p[e.DRAW_FRAMEBUFFER]=se),!0):!1}function fe(de,se){let He=h,xe=!1;de?(qt(se,"framebuffer",e),He=u.get(se),He===void 0&&(He=[],u.set(se,He)),He[0]!==e.COLOR_ATTACHMENT0&&(He[0]=e.COLOR_ATTACHMENT0,xe=!0)):He[0]!==e.BACK&&(He[0]=e.BACK,xe=!0),xe&&e.drawBuffers(He)}function ye(de){return m!==de?(qt(de,"program",e),e.useProgram(de),m=de,!0):!1}let Ce={[Pu]:e.FUNC_ADD,[iX]:e.FUNC_SUBTRACT,[nX]:e.FUNC_REVERSE_SUBTRACT,[aX]:e.MIN,[sX]:e.MAX},De={[ZI]:e.ZERO,[eM]:e.ONE,[lX]:e.SRC_COLOR,[tM]:e.SRC_ALPHA,[gX]:e.SRC_ALPHA_SATURATE,[uX]:e.DST_COLOR,[dX]:e.DST_ALPHA,[cX]:e.ONE_MINUS_SRC_COLOR,[rM]:e.ONE_MINUS_SRC_ALPHA,[hX]:e.ONE_MINUS_DST_COLOR,[pX]:e.ONE_MINUS_DST_ALPHA};function Ge(de,se,He,xe,at,We,to,Dt){if(de===JI){y===!0&&(oe(e.BLEND),y=!1);return}if(y===!1&&(j(e.BLEND),y=!0),de!==QI){if(de!==w||Dt!==I){if((S!==Pu||E!==Pu)&&(e.blendEquation(e.FUNC_ADD),S=Pu,E=Pu),Dt)switch(de){case Fm:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Z3:e.blendFunc(e.ONE,e.ONE);break;case eN:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case tN:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",de);break}else switch(de){case Fm:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Z3:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case eN:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case tN:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",de);break}C=null,v=null,_=null,T=null,w=de,I=Dt}return}at=at||se,We=We||He,to=to||xe,(se!==S||at!==E)&&(qt(se,"blendEquation"),qt(at,"blendEquationAlpha"),e.blendEquationSeparate(Ce[se],Ce[at]),S=se,E=at),(He!==C||xe!==v||We!==_||to!==T)&&(qt(He,"blendSrc"),qt(xe,"blendDst"),qt(We,"blendSrcAlpha"),qt(to,"blendDstAlpha"),e.blendFuncSeparate(De[He],De[xe],De[We],De[to]),C=He,v=xe,_=We,T=to),w=de,I=!1}function Ye(de,se){de.side===$s?oe(e.CULL_FACE):j(e.CULL_FACE);let He=de.side===qb;se&&(He=!He),Q(He),de.blending===Fm&&de.transparent===!1?Ge(JI):Ge(de.blending,de.blendEquation,de.blendSrc,de.blendDst,de.blendEquationAlpha,de.blendSrcAlpha,de.blendDstAlpha,de.premultipliedAlpha),a.setFunc(de.depthFunc),a.setTest(de.depthTest),a.setMask(de.depthWrite),n.setMask(de.colorWrite);let xe=de.stencilWrite;s.setTest(xe),xe&&(s.setMask(de.stencilWriteMask),s.setFunc(de.stencilFunc,de.stencilRef,de.stencilFuncMask),s.setOp(de.stencilFail,de.stencilZFail,de.stencilZPass)),Me(de.polygonOffset,de.polygonOffsetFactor,de.polygonOffsetUnits),de.alphaToCoverage===!0?j(e.SAMPLE_ALPHA_TO_COVERAGE):oe(e.SAMPLE_ALPHA_TO_COVERAGE)}function Q(de){P!==de&&(de?e.frontFace(e.CW):e.frontFace(e.CCW),P=de)}function ee(de){de!==rX?(j(e.CULL_FACE),de!==O&&(de===Q3?e.cullFace(e.BACK):de===oX?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):oe(e.CULL_FACE),O=de}function we(de){de!==W&&(R&&e.lineWidth(de),W=de)}function Me(de,se,He){de?(j(e.POLYGON_OFFSET_FILL),(X!==se||x!==He)&&(qt(se,"factor"),qt(He,"units"),e.polygonOffset(se,He),X=se,x=He)):oe(e.POLYGON_OFFSET_FILL)}function $e(de){de?j(e.SCISSOR_TEST):oe(e.SCISSOR_TEST)}function me(de){de===void 0&&(de=e.TEXTURE0+L-1),A!==de&&(e.activeTexture(de),A=de)}function rt(de,se,He){He===void 0&&(A===null?He=e.TEXTURE0+L-1:He=A);let xe=U[He];xe===void 0&&(xe={type:void 0,texture:void 0},U[He]=xe),(xe.type!==de||xe.texture!==se)&&(A!==He&&(e.activeTexture(He),A=He),e.bindTexture(de,se||ae[de]),xe.type=de,xe.texture=se)}function vt(){if(A===null)throw new Error("THREE.WebGLState: Trying to unbind a texture that was never bound");let de=U[A];de!==void 0&&de.type!==void 0&&(e.bindTexture(de.type,null),de.type=void 0,de.texture=void 0)}this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.compressedTexImage3D=function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texSubImage2D=function(){try{e.texSubImage2D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texSubImage3D=function(){try{e.texSubImage3D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.compressedTexSubImage2D=function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.compressedTexSubImage3D=function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texStorage2D=function(){try{e.texStorage2D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texStorage3D=function(){try{e.texStorage3D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}},this.texImage3D=function(){try{e.texImage3D.apply(e,arguments)}catch(se){console.error("THREE.WebGLState:",se)}};function Re(de){F.equals(de)===!1&&(e.scissor(de.x,de.y,de.z,de.w),F.copy(de))}function Xt(de){ge.equals(de)===!1&&(e.viewport(de.x,de.y,de.z,de.w),ge.copy(de))}function Ft(de,se){let He=c.get(se);He===void 0&&(He=new WeakMap,c.set(se,He));let xe=He.get(de);xe===void 0&&(xe=e.getUniformBlockIndex(se,de.name),He.set(de,xe))}function Nt(de,se){let xe=c.get(se).get(de);l.get(se)!==xe&&(e.uniformBlockBinding(se,xe,de.__bindingPointIndex),l.set(se,xe))}function Br(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},A=null,U={},p={},u=new WeakMap,h=[],m=null,y=!1,w=null,S=null,C=null,v=null,E=null,_=null,T=null,I=!1,P=null,O=null,W=null,X=null,x=null,F.set(0,0,e.canvas.width,e.canvas.height),ge.set(0,0,e.canvas.width,e.canvas.height),n.reset(),a.reset(),s.reset()}this.buffers={color:n,depth:a,stencil:s},this.enable=j,this.disable=oe,this.bindFramebuffer=Y,this.drawBuffers=fe,this.useProgram=ye,this.setBlending=Ge,this.setMaterial=Ye,this.setFlipSided=Q,this.setCullFace=ee,this.setLineWidth=we,this.setPolygonOffset=Me,this.setScissorTest=$e,this.activeTexture=me,this.bindTexture=rt,this.unbindTexture=vt,this.updateUBOMapping=Ft,this.uniformBlockBinding=Nt,this.scissor=Re,this.viewport=Xt,this.reset=Br}};var Yb=class extends Gc{constructor(t,o,i,n,a,s,l,c,d,p){if(p=p!==void 0?p:tg,p!==tg&&p!==Nm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&p===tg&&(i=Dp),i===void 0&&p===Nm&&(i=Ru);let u=new Nu(t,o);super(u,n,a,s,l,c,p,i,d);this.isDepthTexture=!0;this.isDepthTexture=!0,this.image=u,this.magFilter=l!==void 0?l:Ou,this.minFilter=c!==void 0?c:Ou,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}};var HM=class{constructor(e,t,o,i,n,a,s){let l=n.maxTextures,c=n.maxTextureSize,d=n.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator=="undefined"?!1:/OculusBrowser/g.test(navigator.userAgent),h,m=new WeakMap,y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(Q){}function w(Q,ee){return y?new OffscreenCanvas(Q,ee):bM("canvas")}function S(Q,ee){let we=1;if((Q.width>ee||Q.height>ee)&&(we=ee/Math.max(Q.width,Q.height)),we<1)if(typeof HTMLImageElement!="undefined"&&Q instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&Q instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&Q instanceof ImageBitmap){let Me=Math.floor(we*Q.width),$e=Math.floor(we*Q.height);h===void 0&&(h=w(Me,$e)),h.width=Me,h.height=$e;let me=h.getContext("2d");if(qt(me,"2d context"),!(me instanceof OffscreenCanvasRenderingContext2D||me instanceof CanvasRenderingContext2D))throw new Error("Expected a 2d rendering context");return me.drawImage(Q,0,0,Me,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Q.width+"x"+Q.height+") to ("+Me+"x"+$e+")."),h}else return"data"in Q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Q.width+"x"+Q.height+")."),Q;return Q}function C(Q){return J3(Q.width)&&J3(Q.height)}function v(Q){return Q.generateMipmaps&&Q.minFilter!==Ou&&Q.minFilter!==nd}function E(Q){e.generateMipmap(Q)}function _(Q,ee,we,Me,$e=!1){if(Q!==null){if(e[Q]!==void 0)return e[Q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Q+"'")}let me=ee;return ee===e.RED&&(we===e.FLOAT&&(me=e.R32F),we===e.HALF_FLOAT&&(me=e.R16F),we===e.UNSIGNED_BYTE&&(me=e.R8)),ee===e.RED_INTEGER&&(we===e.UNSIGNED_BYTE&&(me=e.R8UI),we===e.UNSIGNED_SHORT&&(me=e.R16UI),we===e.UNSIGNED_INT&&(me=e.R32UI),we===e.BYTE&&(me=e.R8I),we===e.SHORT&&(me=e.R16I),we===e.INT&&(me=e.R32I)),ee===e.RG&&(we===e.FLOAT&&(me=e.RG32F),we===e.HALF_FLOAT&&(me=e.RG16F),we===e.UNSIGNED_BYTE&&(me=e.RG8)),ee===e.RGBA&&(we===e.FLOAT&&(me=e.RGBA32F),we===e.HALF_FLOAT&&(me=e.RGBA16F),we===e.UNSIGNED_BYTE&&(me=Me===Ii&&$e===!1?e.SRGB8_ALPHA8:e.RGBA8),we===e.UNSIGNED_SHORT_4_4_4_4&&(me=e.RGBA4),we===e.UNSIGNED_SHORT_5_5_5_1&&(me=e.RGB5_A1)),(me===e.R16F||me===e.R32F||me===e.RG16F||me===e.RG32F||me===e.RGBA16F||me===e.RGBA32F)&&t.get("EXT_color_buffer_float"),me}function T(Q,ee){return v(Q)===!0?Math.log2(Math.max(ee.width,ee.height))+1:Q.mipmaps!==void 0&&Q.mipmaps.length>0?Q.mipmaps.length:1}function I(Q){let ee=Q.target;ee.removeEventListener("dispose",I),O(ee)}function P(Q){let ee=Q.target;ee.removeEventListener("dispose",P),X(ee)}function O(Q){let ee=i.get(Q);if(ee.__webglInit===void 0)return;let we=Q.source,Me=m.get(we);if(Me){let $e=Me[ee.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&W(Q),Object.keys(Me).length===0&&m.delete(we)}i.remove(Q)}function W(Q){let ee=i.get(Q);e.deleteTexture(ee.__webglTexture);let we=Q.source,Me=m.get(we);qt(Me,"webglTextures"),delete Me[ee.__cacheKey],s.memory.textures--}function X(Q){let ee=Q.texture,we=i.get(Q),Me=i.get(ee);Me.__webglTexture!==void 0&&(e.deleteTexture(Me.__webglTexture),s.memory.textures--),Q.depthTexture&&Q.depthTexture.dispose();let $e=we.__webglFramebuffer;if(Array.isArray($e))for(let me=0;me<$e.length;me++)e.deleteFramebuffer($e[me]);else $e&&e.deleteFramebuffer($e);if(we.__webglDepthbuffer&&e.deleteRenderbuffer(we.__webglDepthbuffer),we.__webglMultisampledFramebuffer&&e.deleteFramebuffer(we.__webglMultisampledFramebuffer),we.__webglColorRenderbuffer)for(let me=0;me<we.__webglColorRenderbuffer.length;me++)we.__webglColorRenderbuffer[me]&&e.deleteRenderbuffer(we.__webglColorRenderbuffer[me]);we.__webglDepthRenderbuffer&&e.deleteRenderbuffer(we.__webglDepthRenderbuffer),i.remove(ee),i.remove(Q)}let x=0;function L(){x=0}function R(){let Q=x;return Q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+Q+" texture units while this GPU supports only "+l),x+=1,Q}function N(Q){let ee=[];return ee.push(Q.wrapS),ee.push(Q.wrapT),ee.push(Q.magFilter),ee.push(Q.minFilter),ee.push(Q.anisotropy),ee.push(Q.internalFormat),ee.push(Q.format),ee.push(Q.type),ee.push(Q.generateMipmaps),ee.push(Q.premultiplyAlpha),ee.push(Q.flipY),ee.push(Q.unpackAlignment),ee.push(Q.colorSpace),ee.join()}function z(Q,ee){let we=i.get(Q);if(Q.isRenderTargetTexture===!1&&Q.version>0&&we.__version!==Q.version)if(Q.image.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ge(we,Q,ee);return}o.bindTexture(e.TEXTURE_2D,we.__webglTexture,e.TEXTURE0+ee)}let A={[tS]:e.REPEAT,[zb]:e.CLAMP_TO_EDGE,[rS]:e.MIRRORED_REPEAT},U={[Ou]:e.NEAREST,[CX]:e.NEAREST_MIPMAP_NEAREST,[oN]:e.NEAREST_MIPMAP_LINEAR,[nd]:e.LINEAR,[SX]:e.LINEAR_MIPMAP_NEAREST,[oS]:e.LINEAR_MIPMAP_LINEAR},pe={[VX]:e.NEVER,[BX]:e.ALWAYS,[LX]:e.LESS,[OX]:e.LEQUAL,[PX]:e.EQUAL,[NX]:e.GEQUAL,[RX]:e.GREATER,[FX]:e.NOTEQUAL};function q(Q,ee){if(e.texParameteri(Q,e.TEXTURE_WRAP_S,A[ee.wrapS]),e.texParameteri(Q,e.TEXTURE_WRAP_T,A[ee.wrapT]),e.texParameteri(Q,e.TEXTURE_MAG_FILTER,U[ee.magFilter]),e.texParameteri(Q,e.TEXTURE_MIN_FILTER,U[ee.minFilter]),ee.compareFunction&&(e.texParameteri(Q,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(Q,e.TEXTURE_COMPARE_FUNC,pe[ee.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){let we=t.get("EXT_texture_filter_anisotropic");if(ee.magFilter===Ou||ee.minFilter!==oN&&ee.minFilter!==oS||ee.type===Fd&&t.has("OES_texture_float_linear")===!1)return;(ee.anisotropy>1||i.get(ee).__currentAnisotropy)&&(e.texParameterf(Q,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ee.anisotropy,n.getMaxAnisotropy())),i.get(ee).__currentAnisotropy=ee.anisotropy)}}function F(Q,ee){let we=!1;Q.__webglInit===void 0&&(Q.__webglInit=!0,ee.addEventListener("dispose",I));let Me=ee.source,$e=m.get(Me);$e===void 0&&($e={},m.set(Me,$e));let me=N(ee);if(me!==Q.__cacheKey){$e[me]===void 0&&($e[me]={texture:e.createTexture()||void 0,usedTimes:0},s.memory.textures++,we=!0),$e[me].usedTimes++;let rt=Q.__cacheKey?$e[Q.__cacheKey]:void 0;rt!==void 0&&($e[Q.__cacheKey].usedTimes--,rt.usedTimes===0&&W(ee)),Q.__cacheKey=me,Q.__webglTexture=$e[me].texture}return we}function ge(Q,ee,we){let Me=e.TEXTURE_2D,$e=F(Q,ee),me=ee.source;o.bindTexture(Me,Q.__webglTexture,e.TEXTURE0+we);let rt=i.get(me);if(me.version!==rt.__version||$e===!0){o.activeTexture(e.TEXTURE0+we),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,ee.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,ee.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);let vt=S(ee.image,c);vt=Ye(ee,vt);let Re=C(vt),Xt=a.convert(ee.format,ee.colorSpace),Ft=a.convert(ee.type),Nt=_(ee.internalFormat,Xt,Ft,ee.colorSpace);q(Me,ee);let Br,de=ee.mipmaps,se=rt.__version===void 0||$e===!0,He=T(ee,vt);if(ee instanceof Yb)Nt=e.DEPTH_COMPONENT,ee.type===Fd?Nt=e.DEPTH_COMPONENT32F:ee.type===Dp?Nt=e.DEPTH_COMPONENT24:ee.type===Ru?Nt=e.DEPTH24_STENCIL8:Nt=e.DEPTH_COMPONENT16,ee.format===tg&&Nt===e.DEPTH_COMPONENT&&ee.type!==hv&&ee.type!==Dp&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ee.type=Dp,Ft=a.convert(ee.type)),ee.format===Nm&&Nt===e.DEPTH_COMPONENT&&(Nt=e.DEPTH_STENCIL,ee.type!==Ru&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ee.type=Ru,Ft=a.convert(ee.type))),se&&o.texStorage2D(e.TEXTURE_2D,1,Nt,vt.width,vt.height);else if(de.length>0&&Re){se&&o.texStorage2D(e.TEXTURE_2D,He,Nt,de[0].width,de[0].height);for(let xe=0,at=de.length;xe<at;xe++)Br=de[xe],o.texSubImage2D(e.TEXTURE_2D,xe,0,0,Xt,Ft,Br);ee.generateMipmaps=!1}else{if(se&&o.texStorage2D(e.TEXTURE_2D,He,Nt,vt.width,vt.height),vt instanceof Nu)throw new Error("Texture does not have any image data to upload.");o.texSubImage2D(e.TEXTURE_2D,0,0,0,Xt,Ft,vt)}v(ee)&&E(Me),rt.__version=me.version,ee.onUpdate&&ee.onUpdate(ee)}Q.__version=ee.version}function ne(Q,ee,we,Me,$e,me){if(!Q||Array.isArray(Q))throw new Error("THREE.WebGLTextures: expected non-array framebuffer");let rt=a.convert(we.format,we.colorSpace),vt=a.convert(we.type),Re=_(we.internalFormat,rt,vt,we.colorSpace);if(!i.get(ee).__hasExternalTextures){let Ft=Math.max(1,ee.width>>me),Nt=Math.max(1,ee.height>>me);o.texImage2D($e,me,Re,Ft,Nt,0,rt,vt,null)}if(o.bindFramebuffer(e.FRAMEBUFFER,Q),Ge(ee))p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,Me,$e,i.get(we).__webglTexture,0,De(ee));else if($e===e.TEXTURE_2D||$e>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z){let Ft=i.get(we).__webglTexture;qt(Ft,"webglTexture"),e.framebufferTexture2D(e.FRAMEBUFFER,Me,$e,Ft,me)}o.bindFramebuffer(e.FRAMEBUFFER,null)}function ae(Q,ee,we){if(e.bindRenderbuffer(e.RENDERBUFFER,Q||null),ee.depthBuffer&&!ee.stencilBuffer){let Me=e.DEPTH_COMPONENT16;if(we||Ge(ee)){let $e=ee.depthTexture;$e&&$e.isDepthTexture&&($e.type===Fd?Me=e.DEPTH_COMPONENT32F:$e.type===Dp&&(Me=e.DEPTH_COMPONENT24));let me=De(ee);Ge(ee)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,me,Me,ee.width,ee.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,me,Me,ee.width,ee.height)}else e.renderbufferStorage(e.RENDERBUFFER,Me,ee.width,ee.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,Q||null)}else if(ee.depthBuffer&&ee.stencilBuffer){let Me=De(ee);we&&Ge(ee)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,Me,e.DEPTH24_STENCIL8,ee.width,ee.height):Ge(ee)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Me,e.DEPTH24_STENCIL8,ee.width,ee.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,ee.width,ee.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,Q||null)}else{let Me=[ee.texture];for(let $e=0;$e<Me.length;$e++){let me=Me[$e],rt=a.convert(me.format,me.colorSpace),vt=a.convert(me.type),Re=_(me.internalFormat,rt,vt,me.colorSpace),Xt=De(ee);we&&Ge(ee)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,Xt,Re,ee.width,ee.height):Ge(ee)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Xt,Re,ee.width,ee.height):e.renderbufferStorage(e.RENDERBUFFER,Re,ee.width,ee.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function j(Q,ee){if(o.bindFramebuffer(e.FRAMEBUFFER,Q),!(ee.depthTexture&&ee.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(ee.depthTexture).__webglTexture||ee.depthTexture.image.width!==ee.width||ee.depthTexture.image.height!==ee.height)&&(ee.depthTexture.image.width=ee.width,ee.depthTexture.image.height=ee.height,ee.depthTexture.needsUpdate=!0),z(ee.depthTexture,0);let we=i.get(ee.depthTexture).__webglTexture;qt(we,"webglDepthTexture");let Me=De(ee);if(ee.depthTexture.format===tg)Ge(ee)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,we,0,Me):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,we,0);else if(ee.depthTexture.format===Nm)Ge(ee)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,we,0,Me):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,we,0);else throw new Error("Unknown depthTexture format")}function oe(Q){let ee=i.get(Q),we=KN(ee);Q.depthTexture&&!ee.__autoAllocateDepthBuffer?j(we,Q):(o.bindFramebuffer(e.FRAMEBUFFER,we),ee.__webglDepthbuffer=e.createRenderbuffer()||void 0,ae(ee.__webglDepthbuffer,Q,!1)),o.bindFramebuffer(e.FRAMEBUFFER,null)}function Y(Q,ee,we){let Me=i.get(Q),$e=KN(Me);ee!==void 0&&ne($e,Q,Q.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),we!==void 0&&oe(Q)}function fe(Q){let ee=Q.texture,we=i.get(Q),Me=i.get(ee);if(Q.addEventListener("dispose",P),Me.__webglTexture===void 0&&(Me.__webglTexture=e.createTexture()||void 0),Me.__version=ee.version,s.memory.textures++,ee.mipmaps&&ee.mipmaps.length>0){let me=[];we.__webglFramebuffer=me;for(let rt=0;rt<ee.mipmaps.length;rt++){let vt=e.createFramebuffer();qt(vt,"framebuffer",e),me[rt]=vt}}else{let me=e.createFramebuffer();we.__webglFramebuffer=me||void 0}if(Q.samples>0&&Ge(Q)===!1){let me=[ee],rt=e.createFramebuffer();qt(rt,"framebuffer",e),we.__webglMultisampledFramebuffer=rt,we.__webglColorRenderbuffer=[],o.bindFramebuffer(e.FRAMEBUFFER,we.__webglMultisampledFramebuffer);for(let vt=0;vt<me.length;vt++){let Re=me[vt],Xt=e.createRenderbuffer();qt(Xt,"renderbuffer",e),we.__webglColorRenderbuffer[vt]=Xt,e.bindRenderbuffer(e.RENDERBUFFER,we.__webglColorRenderbuffer[vt]);let Ft=a.convert(Re.format,Re.colorSpace),Nt=a.convert(Re.type),Br=_(Re.internalFormat,Ft,Nt,Re.colorSpace,!1),de=De(Q);e.renderbufferStorageMultisample(e.RENDERBUFFER,de,Br,Q.width,Q.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+vt,e.RENDERBUFFER,we.__webglColorRenderbuffer[vt])}if(e.bindRenderbuffer(e.RENDERBUFFER,null),Q.depthBuffer){let vt=e.createRenderbuffer();qt(vt,"renderbuffer",e),we.__webglDepthRenderbuffer=vt,ae(we.__webglDepthRenderbuffer,Q,!0)}o.bindFramebuffer(e.FRAMEBUFFER,null)}let $e=e.TEXTURE_2D;if(o.bindTexture($e,Me.__webglTexture),q($e,ee),ee.mipmaps&&ee.mipmaps.length>0){let me=Nge(we);for(let rt=0;rt<ee.mipmaps.length;rt++)ne(me[rt],Q,ee,e.COLOR_ATTACHMENT0,$e,rt)}else ne(we.__webglFramebuffer,Q,ee,e.COLOR_ATTACHMENT0,$e,0);v(ee)&&E($e),o.unbindTexture(),Q.depthBuffer&&oe(Q)}function ye(Q){let ee=[Q.texture];for(let we=0,Me=ee.length;we<Me;we++){let $e=ee[we];if(v($e)){let me=e.TEXTURE_2D,rt=i.get($e).__webglTexture;o.bindTexture(me,rt),E(me),o.unbindTexture()}}}function Ce(Q){if(Q.samples>0&&Ge(Q)===!1){let ee=[Q.texture],we=Q.width,Me=Q.height,$e=e.COLOR_BUFFER_BIT,me=[],rt=Q.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,vt=i.get(Q);qt(vt.__webglMultisampledFramebuffer,"__webglMultisampledFramebuffer"),o.bindFramebuffer(e.READ_FRAMEBUFFER,vt.__webglMultisampledFramebuffer),o.bindFramebuffer(e.DRAW_FRAMEBUFFER,KN(vt));for(let Re=0;Re<ee.length;Re++){me.push(e.COLOR_ATTACHMENT0+Re),Q.depthBuffer&&me.push(rt);let Xt=vt.__ignoreDepthValues!==void 0?vt.__ignoreDepthValues:!1;Xt===!1&&(Q.depthBuffer&&($e|=e.DEPTH_BUFFER_BIT),Q.stencilBuffer&&($e|=e.STENCIL_BUFFER_BIT)),Xt===!0&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[rt]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[rt])),e.blitFramebuffer(0,0,we,Me,0,0,we,Me,$e,e.NEAREST),u&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,me)}o.bindFramebuffer(e.READ_FRAMEBUFFER,null),o.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),o.bindFramebuffer(e.DRAW_FRAMEBUFFER,vt.__webglMultisampledFramebuffer)}}function De(Q){return Math.min(d,Q.samples)}function Ge(Q){let ee=i.get(Q);return Q.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&ee.__useRenderToTexture!==!1}function Ye(Q,ee){let we=Q.colorSpace,Me=Q.format,$e=Q.type;return Q.format===gM||we!==hl&&we!==mv&&(we===Ii?(Me!==Fu||$e!==ns)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",we)),ee}this.allocateTextureUnit=R,this.resetTextureUnits=L,this.setTexture2D=z,this.rebindTextures=Y,this.setupRenderTarget=fe,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=Ce,this.useMultisampledRTT=Ge}};function KN(r){let e=r.__webglFramebuffer;if(!e||Array.isArray(e))throw new Error("THREE.WebGLTextures: expected non-array framebuffer");return e}function Nge(r){let e=r.__webglFramebuffer;if(!e||!Array.isArray(e))throw new Error("THREE.WebGLTextures: expected array framebuffer");return e}var KM=class{constructor(e,t,o){let i={},n={},a=[],s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(C,v){let E=v.program;qt(E,"webglProgram"),o.uniformBlockBinding(C,E)}function c(C,v){let E=i[C.id];E===void 0&&(m(C),E=d(C),i[C.id]=E,C.addEventListener("dispose",w));let _=v.program;qt(_,"webglProgram"),o.updateUBOMapping(C,_);let T=t.render.frame;n[C.id]!==T&&(u(C),n[C.id]=T)}function d(C){let v=p();C.__bindingPointIndex=v;let E=e.createBuffer(),_=C.__size,T=C.usage;return e.bindBuffer(e.UNIFORM_BUFFER,E),e.bufferData(e.UNIFORM_BUFFER,_,T),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,v,E),E}function p(){for(let C=0;C<s;C++)if(a.indexOf(C)===-1)return a.push(C),C;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(C){let v=i[C.id],E=C.uniforms,_=C.__cache;if(v===void 0)throw new Error("THREE.WebGLUniformsGroups: buffer is undefined");e.bindBuffer(e.UNIFORM_BUFFER,v);for(let T=0,I=E.length;T<I;T++){let P=E[T];if(h(P,T,_)===!0){let O=P.__offset,W=Array.isArray(P.value)?P.value:[P.value],X=0;for(let x=0;x<W.length;x++){let L=W[x],R=y(L);typeof L=="number"?(P.__data[0]=L,e.bufferSubData(e.UNIFORM_BUFFER,O+X,P.__data)):L instanceof Mi?(P.__data[0]=L.elements[0],P.__data[1]=L.elements[1],P.__data[2]=L.elements[2],P.__data[3]=L.elements[0],P.__data[4]=L.elements[3],P.__data[5]=L.elements[4],P.__data[6]=L.elements[5],P.__data[7]=L.elements[0],P.__data[8]=L.elements[6],P.__data[9]=L.elements[7],P.__data[10]=L.elements[8],P.__data[11]=L.elements[0]):(L.toArray(P.__data,X),X+=R.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,O,P.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function h(C,v,E){let _=C.value;if(E[v]===void 0){if(typeof _=="number")E[v]=_;else{let T=Array.isArray(_)?_:[_],I=[];for(let P=0;P<T.length;P++){let O=T[P];I.push(typeof O=="number"?O:O.clone())}E[v]=I}return!0}else if(typeof _=="number"){if(E[v]!==_)return E[v]=_,!0}else{let T=E[v],I=Array.isArray(T)?T:[T],P=Array.isArray(_)?_:[_];for(let O=0;O<I.length;O++){let W=I[O];if(W.equals(P[O])===!1)return W.copy(P[O]),!0}}return!1}function m(C){let v=C.uniforms,E=0,_=16,T=0;for(let I=0,P=v.length;I<P;I++){let O=v[I],W={boundary:0,storage:0},X=Array.isArray(O.value)?O.value:[O.value];for(let x=0,L=X.length;x<L;x++){let R=X[x],N=y(R);W.boundary+=N.boundary,W.storage+=N.storage}if(O.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=E,I>0){T=E%_;let x=_-T;T!==0&&x-W.boundary<0&&(E+=_-T,O.__offset=E)}E+=W.storage}T=E%_,T>0&&(E+=_-T),C.__size=E,C.__cache={}}function y(C){let v={boundary:0,storage:0};return typeof C=="number"?(v.boundary=4,v.storage=4):C instanceof Yt?(v.boundary=8,v.storage=8):C instanceof Ae||C instanceof zt?(v.boundary=16,v.storage=12):C instanceof Oa?(v.boundary=16,v.storage=16):C instanceof Mi?(v.boundary=48,v.storage=48):C instanceof ur?(v.boundary=64,v.storage=64):C instanceof Gc?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),v}function w(C){let v=C.target;v.removeEventListener("dispose",w);let E=a.indexOf(v.__bindingPointIndex);a.splice(E,1);let _=i[v.id];_!==void 0&&e.deleteBuffer(_),delete i[v.id],delete n[v.id]}function S(){for(let C in i){let v=i[C];v!==void 0&&e.deleteBuffer(v)}a=[],i={},n={}}this.bind=l,this.update=c,this.dispose=S}};var WM=class{constructor(e,t){function o(i,n=mv){let a;if(i===ns)return e.UNSIGNED_BYTE;if(i===iM)return e.UNSIGNED_SHORT_4_4_4_4;if(i===nM)return e.UNSIGNED_SHORT_5_5_5_1;if(i===EX)return e.BYTE;if(i===DX)return e.SHORT;if(i===hv)return e.UNSIGNED_SHORT;if(i===oM)return e.INT;if(i===Dp)return e.UNSIGNED_INT;if(i===Fd)return e.FLOAT;if(i===gv)return e.HALF_FLOAT;if(i===kX)return e.ALPHA;if(i===Fu)return e.RGBA;if(i===_X)return e.LUMINANCE;if(i===TX)return e.LUMINANCE_ALPHA;if(i===tg)return e.DEPTH_COMPONENT;if(i===Nm)return e.DEPTH_STENCIL;if(i===gM)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(i===GX)return e.RED;if(i===aM)return e.RED_INTEGER;if(i===IX)return e.RG;if(i===sM)return e.RG_INTEGER;if(i===lM)return e.RGBA_INTEGER;if(i===cM||i===dM||i===pM||i===uM)if(n===Ii)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(i===cM)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===dM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===pM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===uM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(i===cM)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===dM)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===pM)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===uM)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===iN||i===nN||i===aN||i===sN)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(i===iN)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===nN)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===aN)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===sN)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===MX)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===lN||i===cN)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(i===lN)return n===Ii?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(i===cN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===dN||i===pN||i===uN||i===hN||i===gN||i===mN||i===fN||i===bN||i===yN||i===xN||i===wN||i===vN||i===CN||i===SN)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(i===dN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===pN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===uN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===hN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===gN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===mN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===fN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===bN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===yN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===xN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===wN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===vN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===CN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===SN)return n===Ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===EN)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(i===EN)return n===Ii?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(i===DN||i===kN||i===_N||i===TN)if(a=t.get("EXT_texture_compression_rgtc"),a!==null){if(i===DN)return a.COMPRESSED_RED_RGTC1_EXT;if(i===kN)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===_N)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===TN)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Ru?e.UNSIGNED_INT_24_8:e[i]!==void 0?e[i]:null}this.convert=o}};var ag=class extends Nn{constructor(){super();this.isScene=!0;this.isScene=!0,this.type="Scene",this.background=null,this.overrideMaterial=null}};var $M=class{constructor(e){let t=new WeakMap;function o(l,c){let d=l.array,p=l.usage,u=e.createBuffer();e.bindBuffer(c,u),e.bufferData(c,d,p),l.onUploadCallback();let h;if(d instanceof Float32Array)h=e.FLOAT;else if(d instanceof Uint16Array)h=e.UNSIGNED_SHORT;else if(d instanceof Int16Array)h=e.SHORT;else if(d instanceof Uint32Array)h=e.UNSIGNED_INT;else if(d instanceof Int32Array)h=e.INT;else if(d instanceof Int8Array)h=e.BYTE;else if(d instanceof Uint8Array)h=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:u,type:h,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version}}function i(l,c,d){let p=c.array,u=c.updateRange;e.bindBuffer(d,l),u.count===-1?e.bufferSubData(d,0,p):(e.bufferSubData(d,u.offset*p.BYTES_PER_ELEMENT,p,u.offset,u.count),u.count=-1),c.onUploadCallback()}function n(l){return t.get(l)}function a(l){let c=t.get(l);c&&(e.deleteBuffer(c.buffer),t.delete(l))}function s(l,c){let d=t.get(l);d===void 0?t.set(l,o(l,c)):d.version<l.version&&(i(d.buffer,l,c),d.version=l.version)}this.get=n,this.remove=a,this.update=s}};var jM=new zt(0),YM=class{constructor(e,t,o,i,n){let a=new zt(0),s=i===!0?0:1;function l(d,p){let u=!1,h=p.isScene===!0?p.background:null;h===null?c(a,s):h&&h.isColor&&(c(h,1),u=!0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}function c(d,p){d.getRGB(jM,QX(e)),t.buffers.color.setClear(jM.r,jM.g,jM.b,p,n)}this.getClearColor=function(){return a},this.setClearColor=function(d,p=1){a.copy(d),s=p,c(a,s)},this.getClearAlpha=function(){return s},this.setClearAlpha=function(d){s=d,c(a,s)},this.render=l}};var XM=class{constructor(e,t){let o=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=!0,n={},a=m(null),s=a,l=!1;function c(x,L,R,N,z){let A=!1;if(i){let U=h(N,R,L);s!==U&&(s=U,p(s.object)),A=y(x,N,R,z),A&&w(x,N,R,z)}else{let U=L.wireframe===!0;(s.geometry!==N.id||s.program!==R.id||s.wireframe!==U)&&(s.geometry=N.id,s.program=R.id,s.wireframe=U,A=!0)}if(z!==null&&t.update(z,e.ELEMENT_ARRAY_BUFFER),(A||l)&&(l=!1,T(x,L,R,N),z!==null)){let U=t.get(z);qt(U,"indexAttributes"),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,U.buffer)}}function d(){return e.createVertexArray()}function p(x){e.bindVertexArray(x)}function u(x){return e.deleteVertexArray(x)}function h(x,L,R){let N=R.wireframe===!0?"true":"false",z=n[x.id];z===void 0&&(z={},n[x.id]=z);let A=z[L.id];A===void 0&&(A={},z[L.id]=A);let U=A[N];return U===void 0&&(U=m(d()),A[N]=U),U}function m(x){let L=[],R=[],N=[];for(let z=0;z<o;z++)L[z]=0,R[z]=0,N[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:R,attributeDivisors:N,object:x,attributes:{},index:null}}function y(x,L,R,N){let z=s.attributes,A=L.attributes,U=0,pe=R.getAttributes();for(let q in pe)if(pe[q].location>=0){let ge=z[q],ne=A[q];if(ne===void 0&&x instanceof Un&&(q==="instanceMatrix"&&x.instanceMatrix&&(ne=x.instanceMatrix),q==="instanceColor"&&x.instanceColor&&(ne=x.instanceColor),q==="instancePickingColor"&&x.instancePickingColor&&(ne=x.instancePickingColor)),ge===void 0||ge.attribute!==ne||ne&&ge.data!==ne.data)return!0;U++}return s.attributesNum!==U||s.index!==N}function w(x,L,R,N){let z={},A=L.attributes,U=0,pe=R.getAttributes();for(let q in pe)if(pe[q].location>=0){let ge=A[q];ge===void 0&&x instanceof Un&&(q==="instanceMatrix"&&x.instanceMatrix&&(ge=x.instanceMatrix),q==="instanceColor"&&x.instanceColor&&(ge=x.instanceColor),q==="instancePickingColor"&&x.instancePickingColor&&(ge=x.instancePickingColor));let ne={attribute:ge};ge&&"data"in ge&&ge.data&&(ne.data=ge.data),z[q]=ne,U++}s.attributes=z,s.attributesNum=U,s.index=N}function S(){let x=s.newAttributes;for(let L=0,R=x.length;L<R;L++)x[L]=0}function C(x){v(x,0)}function v(x,L){let R=s.newAttributes,N=s.enabledAttributes,z=s.attributeDivisors;R[x]=1,N[x]===0&&(e.enableVertexAttribArray(x),N[x]=1),z[x]!==L&&(e.vertexAttribDivisor(x,L),z[x]=L)}function E(){let x=s.newAttributes,L=s.enabledAttributes;for(let R=0,N=L.length;R<N;R++)L[R]!==x[R]&&(e.disableVertexAttribArray(R),L[R]=0)}function _(x,L,R,N,z,A,U){U===!0?e.vertexAttribIPointer(x,L,R,z,A):e.vertexAttribPointer(x,L,R,N,z,A)}function T(x,L,R,N){S();let z=N.attributes,A=R.getAttributes(),U=L.defaultAttributeValues;for(let pe in A){let q=A[pe];if(q.location>=0){let F=z[pe];if(F===void 0&&x instanceof Un&&(pe==="instanceMatrix"&&x.instanceMatrix&&(F=x.instanceMatrix),pe==="instanceColor"&&x.instanceColor&&(F=x.instanceColor),pe==="instancePickingColor"&&x.instancePickingColor&&(F=x.instancePickingColor)),F!==void 0){let ge=F.normalized,ne=F.itemSize,ae=t.get(F);if(ae===void 0)continue;let j=ae.buffer,oe=ae.type,Y=ae.bytesPerElement,fe=oe===e.INT||oe===e.UNSIGNED_INT||F.gpuType===oM;if(F instanceof Ym){for(let ye=0;ye<q.locationSize;ye++)v(q.location+ye,F.meshPerAttribute);!(x instanceof Un)&&N._maxInstanceCount===void 0&&(N._maxInstanceCount=F.meshPerAttribute*F.count)}else for(let ye=0;ye<q.locationSize;ye++)C(q.location+ye);e.bindBuffer(e.ARRAY_BUFFER,j);for(let ye=0;ye<q.locationSize;ye++)_(q.location+ye,ne/q.locationSize,oe,ge,ne*Y,ne/q.locationSize*ye*Y,fe)}else if(U!==void 0){let ge=U[pe];if(ge!==void 0)switch(ge.length){case 2:e.vertexAttrib2fv(q.location,ge);break;case 3:e.vertexAttrib3fv(q.location,ge);break;case 4:e.vertexAttrib4fv(q.location,ge);break;default:e.vertexAttrib1fv(q.location,ge)}}}}E()}function I(){W();for(let x in n){let L=n[x];for(let R in L){let N=L[R];for(let z in N){let A=N[z];qt(A,"state"),u(A.object),delete N[z]}delete L[R]}delete n[x]}}function P(x){if(n[x.id]===void 0)return;let L=n[x.id];for(let R in L){let N=L[R];for(let z in N){let A=N[z];qt(A,"state"),u(A.object),delete N[z]}delete L[R]}delete n[x.id]}function O(x){for(let L in n){let R=n[L];if(qt(R,"programMap"),R[x.id]===void 0)continue;let N=R[x.id];for(let z in N){let A=N[z];qt(A,"state"),u(A.object),delete N[z]}delete R[x.id]}}function W(){X(),l=!0,s!==a&&(s=a,p(s.object))}function X(){a.geometry=null,a.program=null,a.wireframe=!1}this.setup=c,this.reset=W,this.resetDefaultState=X,this.dispose=I,this.releaseStatesOfGeometry=P,this.releaseStatesOfProgram=O,this.initAttributes=S,this.enableAttribute=C,this.disableUnusedAttributes=E}};var JM=class{constructor(){let e=new LM,t=[];function o(){t.length=0}function i(s){t.push(s)}function n(){e.setup(t)}function a(s){e.setupView(t,s)}this.state={lightsArray:t,lights:e},this.init=o,this.pushLight=i,this.setupLights=n,this.setupLightsView=a}},QM=class{constructor(){let e=new WeakMap;this.get=function(o,i=0){let n=e.get(o),a;return n===void 0?(a=new JM,e.set(o,[a])):i>=n.length?(a=new JM,n.push(a)):a=n[i],a},this.dispose=function(){e=new WeakMap}}};function kJ(r){return r instanceof Oa}function _J(r){return r.isLight}function Bge(r){return r.isScene}function ZM(r){return r.isMesh}function WN(r){return r.isLine}function Uge(r){return r.isLineSegments}function qge(){let r=bM("canvas");return r.style.display="block",r}var kv=class{constructor(e={}){let{canvas:t=qge(),context:o=null,depth:i=!0,stencil:n=!0,alpha:a=!1,antialias:s=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:p=!1}=e;this.isWebGLRenderer=!0;let u;o!==null?u=o.getContextAttributes().alpha:u=a;let h=new Uint32Array(4),m=new Int32Array(4),y=null,w=null,S=[],C=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.outputColorSpace=Ii;let v=this,E=!1,_=0,T=0,I=null,P=-1,O=null,W=new Oa,X=new Oa,x=null,L=t.width,R=t.height,N=1,z=null,A=null,U=new Oa(0,0,L,R),pe=new Oa(0,0,L,R),q=!1,F=new DM,ge=new ur,ne=new Ae,ae=new ag;function j(){return I===null?N:1}let oe={alpha:!0,depth:i,stencil:n,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:d,failIfMajorPerformanceCaveat:p};"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${tX}`),t.addEventListener("webglcontextlost",de,!1),t.addEventListener("webglcontextrestored",se,!1),t.addEventListener("webglcontextcreationerror",He,!1);let Y=(()=>{let ce=o||t.getContext("webgl2",oe);if(ce===null)throw new Error("THREE.WebGLRenderer: Error creating WebGL context with your selected attributes.");return ce})(),fe,ye,Ce,De,Ge,Ye,Q,ee,we,Me,$e,me,rt,vt,Re,Xt,Ft,Nt;function Br(){qt(Y,"gl context"),fe=new IM(Y),ye=new GM(Y,fe,e),fe.init(),Xt=new WM(Y,fe),Ce=new zM(Y),De=new VM(Y),Ge=new BM,Ye=new HM(Y,fe,Ce,Ge,ye,Xt,De),Q=new $M(Y),Ft=new XM(Y,Q),ee=new MM(Y,Q,De,Ft),we=new PM(Y,ee,Q,De),Me=new NM(v,ye,Ft),$e=new qM,me=new QM,rt=new YM(v,Ce,we,u,l),Nt=new KM(Y,De,Ce),vt=new TM(Y,De),Re=new AM(Y,De),De.programs=Me.programs,v.capabilities=ye,v.extensions=fe,v.properties=Ge,v.renderLists=$e,v.state=Ce,v.info=De}Br(),this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){let ce=fe.get("WEBGL_lose_context");ce&&ce.loseContext()},this.forceContextRestore=function(){let ce=fe.get("WEBGL_lose_context");ce&&ce.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(ce){ce!==void 0&&(N=ce,this.setSize(L,R,!1))},this.getSize=function(ce){return ce.set(L,R)},this.setSize=function(ce,Se,Qe=!0){L=ce,R=Se,t.width=Math.floor(ce*N),t.height=Math.floor(Se*N),Qe===!0&&(t.style.width=ce+"px",t.style.height=Se+"px"),this.setViewport(0,0,ce,Se)},this.getDrawingBufferSize=function(ce){return ce.set(L*N,R*N).floor()},this.setDrawingBufferSize=function(ce,Se,Qe){L=ce,R=Se,N=Qe,t.width=Math.floor(ce*Qe),t.height=Math.floor(Se*Qe),this.setViewport(0,0,ce,Se)},this.getCurrentViewport=function(ce){return ce.copy(W)},this.getViewport=function(ce){return ce.copy(U)},this.setViewport=function(ce,Se,Qe,Fe){kJ(ce)?U.set(ce.x,ce.y,ce.z,ce.w):U.set(ce,Se,Qe,Fe),Ce.viewport(W.copy(U).multiplyScalar(N).floor())},this.getScissor=function(ce){return ce.copy(pe)},this.setScissor=function(ce,Se,Qe,Fe){kJ(ce)?pe.set(ce.x,ce.y,ce.z,ce.w):pe.set(ce,Se,Qe,Fe),Ce.scissor(X.copy(pe).multiplyScalar(N).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(ce){Ce.setScissorTest(q=ce)},this.setOpaqueSort=function(ce){z=ce},this.setTransparentSort=function(ce){A=ce},this.getClearColor=function(ce){return ce.copy(rt.getClearColor())},this.setClearColor=function(...ce){rt.setClearColor.apply(rt,ce)},this.getClearAlpha=function(){return rt.getClearAlpha()},this.setClearAlpha=function(...ce){rt.setClearAlpha.apply(rt,ce)},this.clear=function(ce=!0,Se=!0,Qe=!0){let Fe=0;if(ce){let kt=!1;if(I!==null){let It=I.texture.format;kt=It===lM||It===sM||It===aM}if(kt){qt(I,"render target");let It=I.texture.type,Kt=It===ns||It===Dp||It===hv||It===Ru||It===iM||It===nM,hr=rt.getClearColor(),rr=rt.getClearAlpha(),ir=hr.r,Rt=hr.g,yr=hr.b;Kt?(h[0]=ir,h[1]=Rt,h[2]=yr,h[3]=rr,Y.clearBufferuiv(Y.COLOR,0,h)):(m[0]=ir,m[1]=Rt,m[2]=yr,m[3]=rr,Y.clearBufferiv(Y.COLOR,0,m))}else Fe|=Y.COLOR_BUFFER_BIT}Se&&(Fe|=Y.DEPTH_BUFFER_BIT),Qe&&(Fe|=Y.STENCIL_BUFFER_BIT),Y.clear(Fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",de,!1),t.removeEventListener("webglcontextrestored",se,!1),t.removeEventListener("webglcontextcreationerror",He,!1),$e.dispose(),me.dispose(),Ge.dispose(),we.dispose(),Ft.dispose(),Nt.dispose(),Me.dispose()};function de(ce){ce.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function se(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;let ce=De.autoReset;Br(),De.autoReset=ce}function He(ce){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ce.statusMessage)}function xe(ce){let Se=ce.target;Se.removeEventListener("dispose",xe),at(Se)}function at(ce){We(ce),Ge.remove(ce)}function We(ce){let Se=Ge.get(ce).programs;Se!==void 0&&(Se.forEach(Qe=>{Me.releaseProgram(Qe)}),Me.releaseShaderCache(ce))}this.renderBufferDirect=function(ce,Se,Qe,Fe,kt,It){Se===null&&(Se=ae);let Kt=!!ZM(kt)&&kt.matrixWorld.determinant()<0,hr=St(ce,Se,Fe,kt);Ce.setMaterial(Fe,Kt);let rr=Qe.index,ir=1;if(Fe.wireframe===!0){if(rr=ee.getWireframeAttribute(Qe),rr===void 0)return;ir=2}let Rt=Qe.attributes.position,yr=0,_r=1/0*ir;It!==null&&(yr=Math.max(yr,It.start*ir),_r=Math.min(_r,(It.start+It.count)*ir)),rr!==null?(yr=Math.max(yr,0),_r=Math.min(_r,rr.count)):Rt!=null&&(yr=Math.max(yr,0),_r=Math.min(_r,Rt.count));let Fi=_r-yr;if(Fi<0||Fi===1/0)return;qt(hr,"program"),Ft.setup(kt,Fe,hr,Qe,rr);let $n,la=vt;if(rr!==null&&($n=Q.get(rr),la=Re,qt($n,"attribute"),Re.setIndex($n)),ZM(kt)?Fe.wireframe===!0?(Ce.setLineWidth(j()),la.setMode(Y.LINES)):la.setMode(Y.TRIANGLES):WN(kt)&&(Ce.setLineWidth(j()),Uge(kt)?la.setMode(Y.LINES):la.setMode(Y.LINE_STRIP)),kt instanceof Un)la.renderInstances(yr,Fi,kt.count);else if(Qe instanceof Ev){let Wi=Qe._maxInstanceCount!==void 0?Qe._maxInstanceCount:1/0,yi=Math.min(Qe.instanceCount,Wi);la.renderInstances(yr,Fi,yi)}else la.render(yr,Fi)},this.compile=function(ce,Se){function Qe(Fe,kt,It){Fe.transparent===!0&&Fe.side===$s&&Fe.forceSinglePass===!1?(Fe.side=qb,Fe.needsUpdate=!0,bi(Fe,kt,It),Fe.side=ZC,Fe.needsUpdate=!0,bi(Fe,kt,It),Fe.side=$s):bi(Fe,kt,It)}w=me.get(ce),w.init(),C.push(w),ce.traverseVisible(Fe=>{qt(w,"render state"),_J(Fe)&&Fe.layers.test(Se.layers)&&w.pushLight(Fe)}),w.setupLights(),ce.traverse(Fe=>{let kt=Fe.material;if(kt){if(!ZM(Fe)&&!WN(Fe))throw new Error(`THREE.WebGLRenderer: Object of type ${Fe.type} has material but no geometry.`);if(Array.isArray(kt))for(let It=0;It<kt.length;It++){let Kt=kt[It];Qe(Kt,ce,Fe)}else Qe(kt,ce,Fe)}}),C.pop(),w=null},this.render=function(ce,Se){if(Se!==void 0&&Se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}E!==!0&&(ce.matrixWorldAutoUpdate===!0&&ce.updateMatrixWorld(),Se.parent===null&&Se.matrixWorldAutoUpdate===!0&&Se.updateMatrixWorld(),w=me.get(ce,C.length),w.init(),C.push(w),ge.multiplyMatrices(Se.projectionMatrix,Se.matrixWorldInverse),F.setFromProjectionMatrix(ge),y=$e.get(ce,S.length),y.init(),S.push(y),to(ce,Se,0,v.sortObjects),y.finish(),v.sortObjects===!0&&y.sort(z,A),this.info.render.frame++,this.info.autoReset===!0&&this.info.reset(),rt.render(y,ce),w.setupLights(),Dt(y,ce,Se),I!==null&&(Ye.updateMultisampleRenderTarget(I),Ye.updateRenderTargetMipmap(I)),Ft.resetDefaultState(),P=-1,O=null,C.pop(),C.length>0?w=C[C.length-1]:w=null,S.pop(),S.length>0?y=S[S.length-1]:y=null)};function to(ce,Se,Qe,Fe){if(ce.visible===!1)return;if(ce.layers.test(Se.layers)){if(qt(w,"render state"),ce.isGroup)Qe=ce.renderOrder;else if(_J(ce))w.pushLight(ce);else if((ZM(ce)||WN(ce))&&(qt(y,"render list"),!ce.frustumCulled||F.intersectsObject(ce))){let Kt=we.update(ce),hr=ce.material;if(qt(hr,"material"),Fe&&(Kt.boundingSphere===null&&Kt.computeBoundingSphere(),ne.copy(Kt.boundingSphere.center),ne.applyMatrix4(ce.matrixWorld).applyMatrix4(ge)),Array.isArray(hr)){let rr=Kt.groups;for(let ir=0,Rt=rr.length;ir<Rt;ir++){let yr=rr[ir],_r=yr.materialIndex&&hr[yr.materialIndex];_r&&_r.visible&&y.push(ce,Kt,_r,Qe,ne.z,yr)}}else hr.visible&&y.push(ce,Kt,hr,Qe,ne.z,null)}}let It=ce.children;for(let Kt=0,hr=It.length;Kt<hr;Kt++)to(It[Kt],Se,Qe,Fe)}function Dt(ce,Se,Qe,Fe){let kt=ce.opaque,It=ce.transparent;qt(w,"render state"),w.setupLightsView(Qe),Fe&&Ce.viewport(W.copy(Fe)),kt.length>0&&sa(kt,Se,Qe),It.length>0&&sa(It,Se,Qe),Ce.buffers.depth.setTest(!0),Ce.buffers.depth.setMask(!0),Ce.buffers.color.setMask(!0),Ce.setPolygonOffset(!1)}function sa(ce,Se,Qe){let Fe=Bge(Se)?Se.overrideMaterial:null;for(let kt=0,It=ce.length;kt<It;kt++){let Kt=ce[kt],hr=Kt.object,rr=Kt.geometry,ir=Fe===null?Kt.material:Fe,Rt=Kt.group;hr.layers.test(Qe.layers)&&No(hr,Se,Qe,rr,ir,Rt)}}function No(ce,Se,Qe,Fe,kt,It){ce.modelViewMatrix.multiplyMatrices(Qe.matrixWorldInverse,ce.matrixWorld),ce.normalMatrix.getNormalMatrix(ce.modelViewMatrix),kt.transparent===!0&&kt.side===$s&&kt.forceSinglePass===!1?(kt.side=qb,kt.needsUpdate=!0,v.renderBufferDirect(Qe,Se,Fe,kt,ce,It),kt.side=ZC,kt.needsUpdate=!0,v.renderBufferDirect(Qe,Se,Fe,kt,ce,It),kt.side=$s):v.renderBufferDirect(Qe,Se,Fe,kt,ce,It)}function bi(ce,Se,Qe){Se.isScene!==!0&&(Se=ae);let Fe=Ge.get(ce);qt(w,"render state");let kt=w.state.lights,It=kt.state.version,Kt=Me.getParameters(ce,kt.state,Se,Qe),hr=Me.getProgramCacheKey(Kt),rr=Fe.programs;rr===void 0&&(ce.addEventListener("dispose",xe),rr=new Map,Fe.programs=rr);let ir=rr.get(hr);if(ir!==void 0){if(Fe.currentProgram===ir&&Fe.lightsStateVersion===It)return tt(ce,Kt),ir}else Kt.uniforms=Me.getUniforms(ce),ir=Me.acquireProgram(Kt,hr),rr.set(hr,ir),Fe.uniforms=Kt.uniforms;let Rt=Fe.uniforms;qt(Rt,"uniforms"),tt(ce,Kt),Fe.needsLights=_e(ce),Fe.lightsStateVersion=It,Fe.needsLights&&(Rt.ambientLightColor.value=kt.state.ambient,Rt.directionalLights.value=kt.state.directional);let yr=ir.getUniforms(),_r=Xm.seqWithValue(yr.seq,Rt);return Fe.currentProgram=ir,Fe.uniformsList=_r,ir}function tt(ce,Se){let Qe=Ge.get(ce);Qe.outputColorSpace=Se.outputColorSpace,Qe.instancing=Se.instancing,Qe.instancingColor=Se.instancingColor,Qe.instancingPickingColor=Se.instancingPickingColor}function St(ce,Se,Qe,Fe){var la;Se.isScene!==!0&&(Se=ae),Ye.resetTextureUnits();let kt=I===null?v.outputColorSpace:hl,It=Ge.get(Qe);qt(w,"render state");let Kt=w.state.lights,hr=!1;Qe.version===It.__version?(It.needsLights&&It.lightsStateVersion!==Kt.state.version||It.outputColorSpace!==kt||Fe instanceof Un!=!!It.instancing)&&(hr=!0):(hr=!0,It.__version=Qe.version);let rr=It.currentProgram;hr===!0&&(rr=bi(Qe,Se,Fe)),Qe.exprTooComplex=((la=rr==null?void 0:rr.diagnostics)==null?void 0:la.exprTooComplex)===!0;let ir=!1,Rt=!1,yr=!1;qt(rr,"program");let _r=rr.getUniforms(),Fi=It.uniforms;if(Ce.useProgram(rr.program)&&(ir=!0,Rt=!0,yr=!0),Qe.id!==P&&(P=Qe.id,Rt=!0),ir||O!==ce){_r.setValue(Y,"projectionMatrix",ce.projectionMatrix,Ye),O!==ce&&(O=ce,Rt=!0,yr=!0);let Wi=_r.map.cameraPosition;Wi!==void 0&&Wi.setValue(Y,ne.setFromMatrixPosition(ce.matrixWorld),Ye),_r.setValue(Y,"isOrthographic",ce instanceof rg,Ye),_r.setValue(Y,"viewMatrix",ce.matrixWorldInverse,Ye)}Rt&&(It.needsLights&&(qt(Fi,"m_uniforms"),Vt(Fi,yr)),Qe.uniformsNeedUpdate=!1,qt(It.uniformsList,"uniformsList"),qt(Fi,"m_uniforms"),Xm.upload(Y,It.uniformsList,Fi,Ye)),Qe.uniformsNeedUpdate===!0&&(qt(It.uniformsList,"uniformsList"),qt(Fi,"m_uniforms"),Xm.upload(Y,It.uniformsList,Fi,Ye),Qe.uniformsNeedUpdate=!1),_r.setValue(Y,"dcgModelMatrix",Fe.dcgModelMatrix,Ye),_r.setValue(Y,"modelViewMatrix",Fe.modelViewMatrix,Ye),_r.setValue(Y,"pickingColor",Fe.pickingColor||[0,0,0,0],Ye),_r.setValue(Y,"normalMatrix",Fe.normalMatrix,Ye);let $n=Qe.uniformsGroups;for(let Wi=0,yi=$n.length;Wi<yi;Wi++){let hn=$n[Wi];Nt.update(hn,rr),Nt.bind(hn,rr)}return rr}function Vt(ce,Se){ce.ambientLightColor.needsUpdate=Se,ce.directionalLights.needsUpdate=Se}function _e(ce){return ce.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return I},this.setRenderTarget=function(ce,Se=0,Qe=0){I=ce,_=Se,T=Qe;let Fe=!0,kt=null;if(ce){let Kt=Ge.get(ce);Kt.__useDefaultFramebuffer!==void 0?(Ce.bindFramebuffer(Y.FRAMEBUFFER,null),Fe=!1):Kt.__webglFramebuffer===void 0?Ye.setupRenderTarget(ce):Kt.__hasExternalTextures&&ce.depthTexture&&Ye.rebindTextures(ce,Ge.get(ce.texture).__webglTexture,Ge.get(ce.depthTexture).__webglTexture);let hr=Ge.get(ce).__webglFramebuffer;ce.samples>0&&Ye.useMultisampledRTT(ce)===!1?kt=Ge.get(ce).__webglMultisampledFramebuffer:Array.isArray(hr)?kt=hr[Qe]:kt=hr,W.copy(ce.viewport),X.copy(ce.scissor),x=ce.scissorTest}else W.copy(U).multiplyScalar(N).floor(),X.copy(pe).multiplyScalar(N).floor(),x=q;Ce.bindFramebuffer(Y.FRAMEBUFFER,kt)&&ye.drawBuffers&&Fe&&Ce.drawBuffers(ce,kt),Ce.viewport(W),Ce.scissor(X),Ce.setScissorTest(x),P=-1},this.readRenderTargetPixels=function(ce,Se,Qe,Fe,kt,It,Kt){if(!(ce&&ce.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let hr=Ge.get(ce).__webglFramebuffer;if(hr){Ce.bindFramebuffer(Y.FRAMEBUFFER,hr);try{let rr=ce.texture,ir=rr.format,Rt=rr.type;if(ir!==Fu&&Xt.convert(ir)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let yr=Rt===gv&&(fe.has("EXT_color_buffer_half_float")||fe.has("EXT_color_buffer_float"));if(Rt!==ns&&Xt.convert(Rt)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_TYPE)&&Rt!==Fd&&!yr){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Se>=0&&Se<=ce.width-Fe&&Qe>=0&&Qe<=ce.height-kt&&Y.readPixels(Se,Qe,Fe,kt,Xt.convert(ir),Xt.convert(Rt),It)}finally{let rr=I!==null?Ge.get(I).__webglFramebuffer:null;Ce.bindFramebuffer(Y.FRAMEBUFFER,rr||null)}}},this.copyFramebufferToTexture=function(ce,Se,Qe=0){let Fe=Math.pow(2,-Qe),kt=Math.floor(Se.image.width*Fe),It=Math.floor(Se.image.height*Fe);Ye.setTexture2D(Se,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,Qe,0,0,ce.x,ce.y,kt,It),Ce.unbindTexture()},this.copyTextureToTexture=function(ce,Se,Qe,Fe=0){let kt=Xt.convert(Qe.format),It=Xt.convert(Qe.type);Ye.setTexture2D(Qe,0),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,Qe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Qe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,Qe.unpackAlignment),Y.texSubImage2D(Y.TEXTURE_2D,Fe,ce.x,ce.y,kt,It,Se.image),Fe===0&&Qe.generateMipmaps&&Y.generateMipmap(Y.TEXTURE_2D),Ce.unbindTexture()},this.initTexture=function(ce){Ye.setTexture2D(ce,0),Ce.unbindTexture()},this.resetState=function(){_=0,T=0,I=null,Ce.reset(),Ft.reset()}}get coordinateSystem(){return Nd}};var bl=class extends xM{constructor(t=1,o=1,i={}){super(t,o,i);this.isWebGLRenderTarget=!0}};var eA=class extends Gc{constructor(t,o,i,n,a,s,l,c,d){super(t,o,i,n,a,s,l,c,d);this.isCanvasTexture=!0;this.needsUpdate=!0}};var dS=class extends EM{constructor(e,t){let i=t.font.generateShapes(e,t.size),n={...t,depth:t.height!==void 0?t.height:50};n.bevelThickness===void 0&&(n.bevelThickness=10),n.bevelSize===void 0&&(n.bevelSize=8),n.bevelEnabled===void 0&&(n.bevelEnabled=!1),super(i,n)}};var pS=class{constructor(e){this.data=e}generateShapes(e,t=100){let o=[],i=zge(e,t,this.data);for(let n=0,a=i.length;n<a;n++)o.push(...i[n].toShapes());return o}};function zge(r,e,t){let o=Array.from(r),i=e/t.resolution,n=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,a=[],s=0,l=0;for(let c=0;c<o.length;c++){let d=o[c];if(d===`
`)s=0,l-=n;else{let p=Hge(d,i,s,l,t);s+=p.offsetX,a.push(p.path)}}return a}function Hge(r,e,t,o,i){let n=i.glyphs[r]||i.glyphs["?"];if(!n)throw new Error('THREE.Font: character "'+r+'" does not exists in font family '+i.familyName+".");let a=new CM,s,l,c,d,p,u;if(n.o){let h=n._cachedOutline||(n._cachedOutline=n.o.split(" "));for(let m=0,y=h.length;m<y;){let w=h[m++];switch(w){case"m":s=h[m++]*e+t,l=h[m++]*e+o,a.moveTo(s,l);break;case"l":s=h[m++]*e+t,l=h[m++]*e+o,a.lineTo(s,l);break;case"q":c=h[m++]*e+t,d=h[m++]*e+o,p=h[m++]*e+t,u=h[m++]*e+o,a.quadraticCurveTo(p,u,c,d);break;default:if(w)throw new Error("unrecognized action: "+w)}}}return{offsetX:n.ha*e,path:a}}$t();var{abs:TJ,PI:GJ}=Math;function VJ(r,e,t,o){let i=IJ(r,t,o),n=IJ(e,t,o);return PJ(i,n)}function IJ(r,e,t){let o={x:(r.x-e.x)/t,y:-(r.y-e.y)/t},i=o.x*o.x+o.y*o.y,n=Math.sqrt(i);return i<1?new Ae(o.x,-o.y,Math.sqrt(1-i)):new Ae(o.x/n,-o.y/n,0)}function LJ(r,e,t){let o=MJ(r,t),i=MJ(e,t);return PJ(o,i)}function MJ(r,e){let t={x:r.x-e.x,y:r.y-e.y},o=Math.hypot(t.x,t.y);return o===0?new Ae(1,0,0):new Ae(t.x/o,t.y/o,0)}function Kge(r){let e=r.elements,t=new Ae(e[3],e[4],e[5]).normalize(),o=new Ae(e[6],e[7],e[8]),i=new Ae().crossVectors(t,o).normalize();o.crossVectors(i,t).normalize();let n=new Mi;return n.set(i.x,t.x,o.x,i.y,t.y,o.y,i.z,t.z,o.z),n}function _v(r,e){let t=r.clone().transpose(),o=new Mi().multiplyMatrices(t,e),i=new Mi().multiplyMatrices(o,r);return Kge(i)}function PJ(r,e){let t=e.clone();t.cross(r);let o=t.length(),i=e.dot(r),n=1-i;o>0&&(t.x=t.x/o,t.y=t.y/o,t.z=t.z/o);let a=new Mi;return a.set(n*t.z*t.z+i,n*t.z*t.x-o*t.y,n*t.y*t.z+o*t.x,n*t.z*t.x+o*t.y,n*t.x*t.x+i,n*t.y*t.x-o*t.z,n*t.y*t.z-o*t.x,n*t.y*t.x+o*t.z,n*t.y*t.y+i),a}var{sin:uS,cos:tA}=Math;function Uu(){let r=Tv(-(11*Math.PI)/16);return Xb(Math.PI/8).multiply(r)}function rA(){let r=Tv(-Math.PI/2);return Xb(Math.PI/2).multiply(r)}function Tv(r){let e=new Mi;return e.set(tA(r),-uS(r),0,uS(r),tA(r),0,0,0,1),e}function Xb(r){let e=new Mi;return e.set(tA(r),0,-uS(r),0,1,0,uS(r),0,tA(r)),e}function $N(r){let e=r.elements,t=e[0]+e[4]+e[8];if(t<3){let o=Math.acos(.5*(t-1)),i=2*uS(o),n=(e[5]-e[7])/i,a=(e[6]-e[2])/i,s=(e[1]-e[3])/i;return{axis:new Ae(n,a,s),angle:o}}return{axis:new Ae(0,0,-1),angle:0}}function OJ(r,e){let t=__dcg_shared_module_exports__['Hd'](r,e),o=new Mi;return o.elements=t,o}function AJ(r,e){return e*Math.floor(r/e+.5)}function oA(r){let e=gc?.06:.03,t=new ur().setFromMatrix3(r),{y:o,z:i}=new _c(0,0,0,"YXZ").setFromRotationMatrix(t),n=AJ(o,GJ/2),a=AJ(i,GJ/2),s=TJ(o-n)<e,l=TJ(i-a)<e,c;if(s||l){let d=s?n:o,p=l?a:i,u=new _c(0,d,p,"YXZ"),h=new ur().makeRotationFromEuler(u);c=new Mi().setFromMatrix4(h)}else c=r;return{matrix:c,isXYsnapped:l,isZsnapped:s}}$t();var Wge=.1,nA=class{constructor(e,t){this.viewport=e;this.grapher3d=t;this.s=Id(()=>this.grapher3d.settings.config.language)}isDefaultViewportRestored(){return this.grapher3d.isDefaultDomain()}getCurrentDomain(){var e,t;return{xmin:this.viewport.xmin,xmax:this.viewport.xmax,ymin:this.viewport.ymin,ymax:this.viewport.ymax,zmin:(e=this.viewport.zmin)!=null?e:__dcg_shared_module_exports__['ub'].zmin,zmax:(t=this.viewport.zmax)!=null?t:__dcg_shared_module_exports__['ub'].zmax}}animateToDomain(e){let t=this.getCurrentDomain(),o=this.grapher3d.transition;o.isZooming||(o.isZooming=!0,o.startTime=window.performance.now(),o.duration=150,o.zoom0=t,o.zoom1=e,this.grapher3d.startZoom())}setDefaultViewport(){this.animateToDomain(new __dcg_shared_module_exports__['ee']),Te(this.s("graphing-calculator-narration-viewport-default"))}setViewport(e){var n,a;if(!e.isValid({xAxisScale:"linear",yAxisScale:"linear"})||!e.isZValid())return;let o=e.toObject();e=Co.fromObject(Yge({...o,zmin:(n=o.zmin)!=null?n:__dcg_shared_module_exports__['ub'].zmin,zmax:(a=o.zmax)!=null?a:__dcg_shared_module_exports__['ub'].zmax})),this.grapher3d.controller.getGrapher2d().viewportController.setViewport(e),this.viewport=e,this.grapher3d.controller.requestRedrawGraph()}getViewport(){return this.viewport}setScreen(){}zoom(e){let t=this.getCurrentDomain(),o=this.grapher3d.transition;switch(e){case"in":{if(o.isZooming)return;o.isZooming=!0,o.startTime=window.performance.now(),o.duration=150,o.zoom0=t,o.zoom1=hS(t,1/2),this.grapher3d.startZoom(),Te(this.s("graphing-calculator-narration-viewport-zoom-in"))}break;case"out":{if(o.isZooming)return;o.isZooming=!0,o.startTime=window.performance.now(),o.duration=150,o.zoom0=t,o.zoom1=YN(t,2,Wge),this.grapher3d.startZoom(),Te(this.s("graphing-calculator-narration-viewport-zoom-out"))}break;case"square":this.grapher3d.settings.setProperty("squareAxes",!0),this.animateToDomain($ge(this.getCurrentDomain())),Te(this.s("graphing-calculator-narration-viewport-zoom-square"));break;case"default":this.setDefaultViewport();break;case"default3dOrientation":this.animateToOrientation(Uu()),Te(this.s("graphing-calculator-narration-viewport-zoom-3d-default"));break;case"xy3dOrientation":this.animateToOrientation(rA()),Te(this.s("graphing-calculator-narration-viewport-zoom-3d-xy"));break;case"recenter":this.animateToDomain(jge(this.getCurrentDomain())),Te(this.s("graphing-calculator-narration-viewport-zoom-recenter"));break;default:}}animateToOrientation(e){this.grapher3d.settings.setProperty("speed3D",0),this.grapher3d.settings.setProperty("worldRotation3D",[...e.elements]),this.grapher3d.controls.animateToOrientation(e)}zoomSquareImmediately(){}remove(){}beginPanning(){}zoomCustom(e){}getProjection(){return this.grapher3d.getProjection()}panFromKeyboard(e){}};function hS(r,e,t){let{xwidth:o,ywidth:i,zwidth:n}=Xge(r);return RJ(r,{xwidth:o*e,ywidth:i*e,zwidth:n*e},t)}function YN(r,e,t,o=new Ae(0,0,0)){let i=new Ae((r.xmax+r.xmin)/2,(r.ymax+r.ymin)/2,(r.zmax+r.zmin)/2),n=new Ae(o.x<i.x?r.xmax:r.xmin,o.y<i.y?r.ymax:r.ymin,o.z<i.z?r.zmax:r.zmin),a=0;for(let d of["x","y","z"])Math.abs(n[d]-o[d])>Math.abs(a)&&i[d]!==o[d]&&(a=(n[d]-o[d])/(i[d]-o[d]));let s=i.clone().sub(o).multiplyScalar(a).add(o);s.lerp(i,1-t);for(let d of["x","y","z"]){let p=r[`${d}min`],u=r[`${d}max`];p===0||u===0?s[d]=0:p===-u&&(s[d]=i[d])}let l=hS(r,e,s),c=new Ae((l.xmax+l.xmin)/2,(l.ymax+l.ymin)/2,(l.zmax+l.zmin)/2);return c.x<o.x!=i.x<o.x&&(l.xmax=.5*(l.xmax-l.xmin),l.xmin=-l.xmax),c.y<o.y!=i.y<o.y&&(l.ymax=.5*(l.ymax-l.ymin),l.ymin=-l.ymax),c.z<o.z!=i.z<o.z&&(l.zmax=.5*(l.zmax-l.zmin),l.zmin=-l.zmax),l}function $ge(r){let e=r.xmax-r.xmin;return RJ(r,{xwidth:e,ywidth:e,zwidth:e})}function RJ(r,{xwidth:e,ywidth:t,zwidth:o},i){let n=new __dcg_shared_module_exports__['ee'];return[n.xmin,n.xmax]=jN(r.xmin,r.xmax,e,i==null?void 0:i.x),[n.ymin,n.ymax]=jN(r.ymin,r.ymax,t,i==null?void 0:i.y),[n.zmin,n.zmax]=jN(r.zmin,r.zmax,o,i==null?void 0:i.z),n}function jge(r){let e=new __dcg_shared_module_exports__['ee'];return e.xmax=.5*(r.xmax-r.xmin),e.xmin=-e.xmax,e.ymax=.5*(r.ymax-r.ymin),e.ymin=-e.ymax,e.zmax=.5*(r.zmax-r.zmin),e.zmin=-e.zmax,e}function Yge(r){let e=new __dcg_shared_module_exports__['ee'];return[e.xmin,e.xmax]=iA(r.xmin,r.xmax),[e.ymin,e.ymax]=iA(r.ymin,r.ymax),[e.zmin,e.zmax]=iA(r.zmin,r.zmax),e}var kp=134e3,FJ=134e-6;function NJ(r,e,t,o){return t=__dcg_shared_module_exports__['wc'](t,FJ,kp),o=o!=null?o:r===0||e===0?0:(r+e)/2,r=o+(r-o)/(e-r)*t,e=r+t,[r,e]}function jN(r,e,t,o){return[r,e]=NJ(r,e,t,o),iA(r,e)}function iA(r,e){r<-kp/2&&(e<-kp/4&&(e+=-kp/2-r,e=Math.min(kp/2,e)),r=-kp/2),e>kp/2&&(r>kp/4&&(r+=kp/2-e,r=Math.max(-kp/2,r)),e=kp/2);let t=FJ*Math.max(1,Math.abs(r),Math.abs(e));return e-r<t?NJ(r,e,t):[r,e]}function Xge(r){let{xmin:e,xmax:t,ymin:o,ymax:i,zmin:n,zmax:a}=r;return{xwidth:t-e,ywidth:i-o,zwidth:a-n}}var{abs:_p,min:zJ,acos:BJ,hypot:HJ,PI:Tp}=Math,Jge=1e3,Qge=.2,sg={NONE:-1,ROTATE:0},Zge={type:"start"},eme={type:"end"},UJ=50,tme=5*Math.PI/180,aA=class extends Tc{constructor(t,o,i){super();this.worldRotation3D=Uu();this.unsnappedRotation=new Mi;this.axis3D=[0,0,1];this.speed3D=0;this.touches=[];this.spinningWorld=t,this.copyWorldRotationToWorld(),this.domElement=i!==void 0?i:document,this.grapher3d=o,this.state=sg.NONE,this.lastMovedTime=0,this.lastRotateTime=0,this.lastWheelEventTime=0,this.keyStillDown=!1,this.lastAngle=0,this.useVirtualSphere=!1,this.startedOutsideVirtualSphere=!1,this.isXYsnapped=!1,this.isZsnapped=!1,this.dimensions=()=>{let a=this.domElement===document?this.domElement.body:this.domElement,s=a.clientWidth,l=a.clientHeight,c=new Yt(s/2,l/2),d=Math.min(s,l)/2;return{center:c,radius:d,height:l,width:s}},this.onContextMenu=a=>{this.grapher3d.controller.dispatch({type:"blur-focus-location",location:this.grapher3d.controller.getFocusLocation()})},this.onTapStart=a=>{var C,v;let s=a,l=Object.keys(this.touches).length;this.touches=XN(s.touches);let c=Object.keys(this.touches).length,d=o.webglLayer.getPressedAction()!==void 0;if(l<2&&c===2&&!d){this.startPinchZoom();return}if(c>1)return;let{top:p,left:u}=wi(this.grapher3d.elt),h=this.touches[0].pageX-u,m=this.touches[0].pageY-p;if(this.isPinchZooming()||(C=this.grapher3d)!=null&&C.transition.isOrienting)return;this.grapher3d.controller.dispatch({type:"set-none-selected"}),o.webglLayer.setMouse({x:h,y:m}),o.webglLayer.pickAtMouseAndReadResults();let y=(v=o.webglLayer.getPickResult())==null?void 0:v.id;if(y){let E=o.controller.getItemModel(y);if(E&&E.type==="expression"&&xs(E))return}this.state=sg.ROTATE,this.speed3D=0,this.invert=void 0;let{center:w,radius:S}=this.dimensions();this.startedOutsideVirtualSphere=HJ(h-w.x,m-w.y)>=S,this.unsnappedRotation.copy(this.worldRotation3D),this.useVirtualSphere=s.shiftKey&&this.grapher3d.settings.config.beta3d||!this.isHorizonLevel(),this.state!==sg.NONE&&(this.grapher3d.isDragging=!0,re(document).on("dcg-tapmove",this.onTapMove),re(document).on("dcg-tapend",this.onTapUp),re(document).on("dcg-tapcancel",this.onTapUp),this.dispatchEvent(Zge))},this.onTapMove=a=>{var S;let s=a,l=s.changedTouches[0].identifier,c=s.changedTouches[0],d=this.touches.find(C=>C.identifier===l)||c;this.touches=XN(s.touches);let{top:p,left:u}=wi(this.grapher3d.elt),h=new Yt(d.pageX-u,d.pageY-p),m=new Yt(c.pageX-u,c.pageY-p);if(this.isPinchZooming()){this.updatePinchZoom();return}if((S=this.grapher3d)!=null&&S.transition.isOrienting||this.state!=sg.ROTATE)return;let y=m.x-h.x,w=m.y-h.y;if(y!==0||w!==0){let C,{center:v,radius:E,height:_,width:T}=this.dimensions();if(this.useVirtualSphere)C=this.startedOutsideVirtualSphere?LJ(m,h,v):VJ(m,h,v,E),C=_v(this.worldRotation3D,C),this.setWorldRotation(this.worldRotation3D.multiply(C));else{if(this.invert===void 0){this.invert=m.y>v.y?1:-1;let pe=new Ae(0,0,1).applyMatrix3(this.worldRotation3D);pe.x>.7&&(this.invert*=-1),_p(pe.x)<.7&&(this.invert=pe.z<-.7?-1:1)}let x=y/T*Tp*this.invert,L=w/_*Tp,R=Tv(x),N=Xb(L);N=_v(this.unsnappedRotation,N),_p(w)>2*_p(y)?this.unsnappedRotation.multiply(N):_p(y)>2*_p(w)?this.unsnappedRotation.multiply(R):this.unsnappedRotation.multiply(N).multiply(R);let{matrix:z,isXYsnapped:A,isZsnapped:U}=oA(this.unsnappedRotation);this.setWorldRotation(z),this.isXYsnapped=A,this.isZsnapped=U,N=Xb(L),N=_v(this.worldRotation3D,N),C=_p(w)>_p(y)?N:R}let{axis:I,angle:P}=$N(C),O=s.timeStamp,W=(O-this.lastMovedTime)*.001;this.axis3D=[I.x,I.y,I.z],this.useVirtualSphere&&this.snapSpinAxisIfClose();let X=240*(Tp/180);this.speed3D=__dcg_shared_module_exports__['wc'](P/W,-X,X),this.lastAngle=0,this.lastMovedTime=O,_p(this.speed3D)<tme&&(this.speed3D=0)}else this.lastMovedTime+UJ<s.timeStamp&&(this.speed3D=0)},this.onTapUp=a=>{var d;let s=a,l=Object.keys(this.touches).length;this.touches=XN(s.touches);let c=Object.keys(this.touches).length;l===2&&c<2&&this.isPinchZooming()&&this.stopPinchZoom(),!((d=this.grapher3d)!=null&&d.transition.isOrienting)&&(c>0||(this.lastMovedTime+UJ<s.timeStamp&&!this.isPinchZooming()&&(this.speed3D=0),this.grapher3d.isDragging=!1,re(document).off("dcg-tapmove",this.onTapMove),re(document).off("dcg-tapend",this.onTapUp),re(document).off("dcg-tapcancel",this.onTapUp),this.dispatchEvent(eme),this.grapher3d.debounceUserRequestedRotationChange(),this.state=sg.NONE,this.grapher3d.controller.dispatch({type:"render"})))},this.onMouseWheel=a=>{var E,_;let s=a;if(this.state!==sg.NONE||this.isLocked()||s.deltaY===0)return;s.preventDefault(),this.lastWheelEventTime===0&&this.grapher3d.startZoom(),this.lastWheelEventTime=window.performance.now();let l=this.grapher3d.webglLayer.domain(),c=this.grapher3d.webglLayer.getMouse(),d=Date.now(),p=this.speed3D!==0,u=s.deltaY<0?"in":"out",h=this.currentZoomAction&&d-this.currentZoomAction.lastChangeTime>Jge;if(!this.currentZoomAction||this.currentZoomAction.input.type!=="pointer"||this.currentZoomAction.input.x!==(c==null?void 0:c.x)||this.currentZoomAction.input.y!==(c==null?void 0:c.y)||this.currentZoomAction.isSpinning!==p||u==="in"&&this.currentZoomAction.initialDirection==="out"||h){let T=u==="in"?(E=this.grapher3d.webglLayer.getZoomScrollWheelPickResult())==null?void 0:E.point:void 0;this.currentZoomAction={lastChangeTime:d,start:l,input:{type:"pointer",...c},isSpinning:p,center:T==null?void 0:T.clone(),initialDirection:u}}else this.currentZoomAction&&(this.currentZoomAction.lastChangeTime=d);let m=(_=this.currentZoomAction)==null?void 0:_.center,y=this.currentZoomAction.start.xmax-this.currentZoomAction.start.xmin,w=l.xmax-l.xmin;if(this.currentZoomAction.initialDirection==="in"&&u==="out"&&w>=y){let T=this.currentZoomAction.start;delete this.currentZoomAction,l=T,m=void 0}if(!m){let T=l.xmin<=0&&l.xmax>=0,I=l.ymin<=0&&l.ymax>=0,P=l.zmin<=0&&l.zmax>=0;T&&I&&P&&(m=new Ae(0,0,0))}let S=1.05,C;u==="out"&&(!m||m.lengthSq()===0)?C=YN(l,S,Qge):C=hS(l,s.deltaY<0?1/S:S,m);let v=new Co(C.xmin,C.xmax,C.ymin,C.ymax,C.zmin,C.zmax);this.updateViewport(v),this.copyWorldRotationToWorld(),this.grapher3d.webglLayer.updateAxes(),this.grapher3d.controller.dispatch({type:"render"})};let n={passive:!1};this.onTouchStart=a=>{a.preventDefault()},this.domElement.addEventListener("touchstart",this.onTouchStart,n),re(this.domElement).on("dcg-tapstart",this.onTapStart),re(this.domElement).on("contextmenu",this.onContextMenu),this.domElement.addEventListener("wheel",this.onMouseWheel)}keyUp(){this.keyStillDown=!1,this.speed3D&&Te(this.grapher3d.controller.s("graphing-calculator-narration-3d-rotation-speed",{speed:Math.ceil(this.speed3D*180/Tp)}))}applyTiltFromKeyboard(t,o){var d;if(this.isPinchZooming()||(d=this.grapher3d)!=null&&d.transition.isOrienting)return;this.grapher3d.controller.dispatch({type:"set-none-selected"});let i={Up:this.grapher3d.controller.s("graphing-calculator-narration-3d-rotate-up"),Down:this.grapher3d.controller.s("graphing-calculator-narration-3d-rotate-down"),Left:this.grapher3d.controller.s("graphing-calculator-narration-3d-rotate-left"),Right:this.grapher3d.controller.s("graphing-calculator-narration-3d-rotate-right")},n=p=>{let u=Xb(p);u=_v(this.unsnappedRotation,u),this.unsnappedRotation.multiply(u)},a=p=>{this.unsnappedRotation.multiply(Tv(p))},s=p=>{let u=Xb(p);return _v(this.worldRotation3D,u)},l=p=>Tv(p);if(t===this.lastKeyboardDirection&&this.keyStillDown)if(this.speed3D===0){let p,u=2*Tp/180;switch(t){case"Up":p=s(-u);break;case"Down":p=s(+u);break;case"Left":p=l(-u);break;case"Right":p=l(+u);break}let{axis:h,angle:m}=$N(p);this.axis3D=[h.x,h.y,h.z],this.speed3D=m}else{let p=240*(Tp/180);this.speed3D=__dcg_shared_module_exports__['wc'](this.speed3D*1.1,-p,p)}else if(this.speed3D)this.lastKeyboardDirection=void 0,this.keyStillDown=!0,this.speed3D=0,Te(this.grapher3d.controller.s("graphing-calculator-narration-3d-rotation-stopped"));else{this.lastKeyboardDirection=t,this.keyStillDown=!0,Te(i[t]);let p=Tp/180;switch(t){case"Up":n(-p);break;case"Down":n(+p);break;case"Left":a(-p);break;case"Right":a(+p);break}let{matrix:u,isXYsnapped:h,isZsnapped:m}=oA(this.unsnappedRotation);this.setWorldRotation(u),this.isXYsnapped=h,this.isZsnapped=m,this.lastAngle=0}}isPinchZooming(){var t;return((t=this.currentZoomAction)==null?void 0:t.input.type)==="pinch"}startPinchZoom(){if(this.isLocked()||this.isPinchZooming())return;let t=__dcg_shared_module_exports__['i'](this.touches);this.grapher3d.controller.dispatch({type:"set-none-selected"}),this.grapher3d.startZoom(),this.currentZoomAction={lastChangeTime:Date.now(),start:this.grapher3d.webglLayer.domain(),center:void 0,input:{type:"pinch",pinchZoomStartPositions:t},isSpinning:this.speed3D!==0,initialDirection:void 0}}stopPinchZoom(){this.isPinchZooming()&&(this.currentZoomAction=void 0,this.grapher3d.endZoom(),this.grapher3d.controller.dispatch({type:"render"}))}updatePinchZoom(){var s;if(((s=this.currentZoomAction)==null?void 0:s.input.type)!=="pinch")return;let t=qJ(this.currentZoomAction.input.pinchZoomStartPositions),i=qJ(this.touches)/t;if(!isFinite(i))return;let n=hS(this.currentZoomAction.start,1/i),a=new Co(n.xmin,n.xmax,n.ymin,n.ymax,n.zmin,n.zmax);this.updateViewport(a),this.copyWorldRotationToWorld()}snapSpinAxisIfClose(){if(!this.grapher3d.settings.showAxis3D)return;let[t,o,i]=this.axis3D,n=.97;t>n&&(this.axis3D=[1,0,0]),o>n&&(this.axis3D=[0,1,0]),i>n&&(this.axis3D=[0,0,1]),t<-n&&(this.axis3D=[-1,0,0]),o<-n&&(this.axis3D=[0,-1,0]),i<-n&&(this.axis3D=[0,0,-1])}copyWorldRotationToWorld(){this.spinningWorld.setRotationFromMatrix(new ur().setFromMatrix3(this.worldRotation3D))}update(){return!0}dispose(){re(this.domElement).off("dcg-tapstart",this.onTapStart),re(document).off("dcg-tapmove",this.onTapMove),re(document).off("dcg-tapend",this.onTapUp),re(document).off("dcg-tapcancel",this.onTapUp),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("touchstart",this.onTouchStart)}setWorldRotation(t){this.worldRotation3D=t,this.copyWorldRotationToWorld();let{isXYsnapped:o,isZsnapped:i}=oA(t);this.isXYsnapped=o,this.isZsnapped=i}isHorizonLevel(){let t=new Ae(0,0,1).applyMatrix3(this.worldRotation3D);return _p(t.y)<1e-4}compareWorldRotationTo(t){let o=new ur().setFromMatrix3(this.worldRotation3D),i=new ur().setFromMatrix3(t),n=new _c(0,0,0,"YXZ").setFromRotationMatrix(o),a=new _c().setFromRotationMatrix(i),s=new Bd().setFromEuler(n).normalize(),l=new Bd().setFromEuler(a).normalize(),c=zJ(_p(s.dot(l)),1);return 2*BJ(c)*(180/Tp)}isDefaultOrientation(){let t=this.compareWorldRotationTo(Uu());return this.speed3D===0&&t<1}isXYPlaneOrientation(){let t=this.compareWorldRotationTo(rA());return this.speed3D===0&&t<.001}animateToOrientation(t){let o=this.grapher3d;this.speed3D=0;let i=o.transition,n=new ur().setFromMatrix3(this.worldRotation3D),a=new ur().setFromMatrix3(t),s=new _c().setFromRotationMatrix(a),l=new _c(0,0,0,"YXZ").setFromRotationMatrix(n);i.q0.setFromEuler(l),i.q1.setFromEuler(s);let c=i.q0.clone().normalize(),d=i.q1.clone().normalize(),p=2*BJ(_p(c.dot(d)))*(180/Tp);i.isOrienting=!0,i.startTime=window.performance.now(),i.duration=150*__dcg_shared_module_exports__['wc'](p/30,1,3)}updateViewport(t){let o=this.grapher3d,i=o.controller.getGrapher2d();o.viewportController.setViewport(t),o.debounceUserRequestedViewportChange(),i.viewportController.setViewport(t),i.redrawAllLayersSynchronously(),o.webglLayer.updatePlaneMap(),o.webglLayer.updateDomainObjects()}isLocked(){return this.grapher3d.controller.getGraphSettings().userLockedViewport}},sA=class{constructor(){this.isZooming=!1;this.zoom0=new __dcg_shared_module_exports__['ee'];this.zoom1=new __dcg_shared_module_exports__['ee'];this.isOrienting=!1;this.q0=new Bd;this.q1=new Bd;this.objectIdExtendingTo3D=void 0;this.startTime=0;this.duration=0}};function KJ(r){let e=r.grapher3d,t=e.transition;if(e.settings.threeDMode){if(r.lastWheelEventTime!=0&&(window.performance.now()-r.lastWheelEventTime)*.001>.1&&(r.lastWheelEventTime=0,e.endZoom()),t.isZooming){let{zoom0:o,zoom1:i}=t,n=window.performance.now(),a=zJ(1,(n-t.startTime)/t.duration),s=new Co(a*i.xmin+(1-a)*o.xmin,a*i.xmax+(1-a)*o.xmax,a*i.ymin+(1-a)*o.ymin,a*i.ymax+(1-a)*o.ymax,a*i.zmin+(1-a)*o.zmin,a*i.zmax+(1-a)*o.zmax);a>=1&&(e.endZoom(),t.isZooming=!1),r.updateViewport(s)}if(t.isOrienting){let i=(window.performance.now()-t.startTime)/t.duration;if(i>=1){let n=new ur().makeRotationFromQuaternion(t.q1);r.setWorldRotation(new Mi().setFromMatrix4(n)),t.isOrienting=!1,e.controller.dispatch({type:"render"})}else{let n=t.q0.clone().slerp(t.q1,i),a=new ur().makeRotationFromQuaternion(n);r.setWorldRotation(new Mi().setFromMatrix4(a)),r.unsnappedRotation.copy(r.worldRotation3D)}}if(t.objectIdExtendingTo3D&&t.startTime>0){let o=r.grapher3d.webglLayer,i=t.objectIdExtendingTo3D,n=o.domain(),{zmin:a,zmax:s}=n,c=(window.performance.now()-t.startTime)/t.duration;c>=1?(o.setZboundsOnSurfaces(i,-1/0,1/0),t.objectIdExtendingTo3D=void 0):o.setZboundsOnSurfaces(i,c*a,c*s),e.controller.requestRedrawGraph()}if(r.speed3D===0)r.lastRotateTime=window.performance.now();else{let o=window.performance.now(),i=(o-r.lastRotateTime)*.001,n=r.lastRotateTime!=0&&i<2?i*r.speed3D:0;if(n>20*Tp/180&&(n=20*Tp/180),r.state===sg.NONE){let a=r.axis3D,s=new Ae(a[0],a[1],a[2]),l=OJ(s,n);r.setWorldRotation(r.worldRotation3D.multiply(l)),r.unsnappedRotation.copy(r.worldRotation3D)}r.lastRotateTime=o,r.lastAngle=n}}}function qJ(r){return r.length!==2?NaN:HJ(r[0].pageX-r[1].pageX,r[0].pageY-r[1].pageY)}function XN(r){return __dcg_shared_module_exports__['i'](r)}function WJ(r,e=.01*(r.xmax-r.xmin)){return e*=2,Math.abs(r.xmin+r.xmax)<=e&&Math.abs(r.ymin+r.ymax)<=e&&Math.abs(r.zmin+r.zmax)<=e}Xa();var JN=[];function $J(r){return JN[r]===void 0&&(JN[r]=rme(r)),JN[r]}function rme(r){let e=Math.SQRT1_2,t=[0,0,1,0,0,-1,-e,-e,0,e,-e,0,e,e,0,-e,e,0],o=[0,3,4,0,4,5,0,5,2,0,2,3,1,4,3,1,5,4,1,2,5,1,3,2];function i(n){let a=t.length/3;for(let s=0;s<a;s++)if(n.x===t[3*s+0]&&n.y===t[3*s+1]&&n.z===t[3*s+2])return s;return t.push(n.x,n.y,n.z),a}for(let n=0;n<r;n++){let a=o.length/3;for(let s=0;s<a;s++){let l=o[3*s+0],c=o[3*s+1],d=o[3*s+2],p=new __dcg_shared_module_exports__['Gd'](t[3*l+0],t[3*l+1],t[3*l+2]),u=new __dcg_shared_module_exports__['Gd'](t[3*c+0],t[3*c+1],t[3*c+2]),h=new __dcg_shared_module_exports__['Gd'](t[3*d+0],t[3*d+1],t[3*d+2]),m=new __dcg_shared_module_exports__['Gd']().addVectors(p,u).multiply(.5).normalize(),y=new __dcg_shared_module_exports__['Gd']().addVectors(u,h).multiply(.5).normalize(),w=new __dcg_shared_module_exports__['Gd']().addVectors(h,p).multiply(.5).normalize(),S=i(m),C=i(y),v=i(w);o.push(l,S,v,S,c,C,C,d,v),o[3*s+0]=S,o[3*s+1]=C,o[3*s+2]=v}}return{vertices:new Float32Array(t),indices:new Uint16Array(o)}}var jJ={name:"FillShader",defines:{},uniforms:{color:{value:new zt(16777215)},opacity:{value:1}},vertexShader:`
		void main() {
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform vec3 color;
		uniform float opacity;
		void main() {
			gl_FragColor = vec4( color, opacity );
		}`};var lA=class{constructor(){}setSize(e,t){}dispose(){}},ome=new rg(-1,1,1,-1,0,1),cA=class{constructor(e){let t=new gl;t.setAttribute("position",new qi([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new qi([0,2,0,0,2,0],2)),this._mesh=new Bn(t,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ome)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}};var sd=class extends lA{constructor(t,o={},i="tDiffuse"){super();this.inputTextureName=i;this.uniforms=jm(t.uniforms),this.defines=t.defines?{...t.defines}:{},this.material=new Ud({...o,name:t.name!==void 0?t.name:"unspecified",defines:this.defines,uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsTriangle=new cA(this.material)}render(t,o,i){this.renderFromTexture(t,o,i.texture)}renderFromTexture(t,o,i){this.uniforms[this.inputTextureName]&&(this.uniforms[this.inputTextureName].value=i),this.fsTriangle.material=this.material,t.setRenderTarget(o),this.fsTriangle.render(t)}dispose(){this.material.dispose(),this.fsTriangle.dispose()}};function dA(r,e,t=0,o=0,i=e.width,n=e.height,a=new Uint8ClampedArray(4*i*n)){return r.readRenderTargetPixels(e,t,o,i,n,a),a}function mS(r,e,t,o){let i=4*(o*e+t);return[r[i],r[i+1],r[i+2],r[i+3]]}var gS=new Uint8Array(4),ime=new Float32Array(gS.buffer);function pA([r,e,t,o]){return gS[0]=o,gS[1]=t,gS[2]=e,gS[3]=r,ime[0]}function nme(r){let e=r.getContext();if(!(e instanceof WebGL2RenderingContext))throw new Error("WebGL2 is required for waitForFullFlush");return e}async function YJ(r){let e=nme(r),t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(!t)throw new Error("Failed to create sync object");e.flush();let o=await XJ(e,t,0,0);return e.deleteSync(t),o}function XJ(r,e,t,o){let i=performance.now();return new Promise((n,a)=>{function s(){let l=r.clientWaitSync(e,t,0);if(l===r.WAIT_FAILED){a();return}if(l===r.TIMEOUT_EXPIRED){i=performance.now(),setTimeout(s,o);return}n([i,performance.now()])}s()})}async function ame(r,e,t,o,i,n,a){let s=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);if(!s)throw new Error("Failed to create sync object");r.flush(),await XJ(r,s,0,10),r.deleteSync(s),r.bindBuffer(e,t),r.getBufferSubData(e,o,i,n,a),r.bindBuffer(e,null)}async function JJ(r,e,t,o,i,n,a,s){let l=r.createBuffer();if(!l)throw new Error("Failed to create buffer");return r.bindBuffer(r.PIXEL_PACK_BUFFER,l),r.bufferData(r.PIXEL_PACK_BUFFER,s.byteLength,r.STREAM_READ),r.readPixels(e,t,o,i,n,a,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),await ame(r,r.PIXEL_PACK_BUFFER,l,0,s),r.deleteBuffer(l),s}var QN;function QJ(){if(QN)return QN;let r=new sd(jJ),e=1,t=1,o=1,i=0,n=r.material;n.uniforms.color.value=new zt().setRGB(e,t,o),n.uniforms.opacity.value=i,n.blending=QI,n.blendEquation=Pu,n.blendSrc=eM,n.blendDst=ZI;let a=new kv,s=a.getContext(),l=[Fd,gv,ns],c=[s.FLOAT,s.HALF_FLOAT,s.UNSIGNED_BYTE],d=[new Float32Array(4),new Uint16Array(4),new Uint8Array(4)],p=[1,15360,255],u=[];for(let h=0;h<l.length;h++){let m=new bl(1,1,{minFilter:Ou,magFilter:Ou,type:l[h],format:Fu,stencilBuffer:!1,depthBuffer:!0});r.render(a,m,new bl),s.readPixels(0,0,1,1,s.RGBA,c[h],d[h]);let y=[...d[h]];y[0]/=p[h],y[1]/=p[h],y[2]/=p[h],y[3]/=p[h];let w=(C,v,E=.01)=>C<v+E&&C>v-E,S=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;S=S&&w(y[0],e),S=S&&w(y[1],t),S=S&&w(y[2],o),S=S&&w(y[3],i),S=S||h===l.length-1,m.dispose(),S&&u.push(l[h])}return r.dispose&&r.dispose(),QN=u,u}var ZN;function sme(){if(!ZN){let r=document.createElement("div");r.className="dcg-3d-debug-root",document.body.appendChild(r),ZN=r}return ZN}var uA=class{constructor({filter:e}){this.canvases={};e?(this.enabled=!0,this.filter=new RegExp(e)):this.enabled=!1}removeUnused(){for(let e in this.canvases)this.canvases[e].used?this.canvases[e].used=!1:(this.canvases[e].container.remove(),delete this.canvases[e])}get(e,t){let o=t?`${e} ${t}`:e;if(!(!this.enabled||!this.filter.test(o)))return this.canvases[e]||(this.canvases[e]=new eB),this.canvases[e].setLabel(o),this.canvases[e].used=!0,this.canvases[e]}},eB=class{constructor(){this.container=document.createElement("div"),this.container.className="dcg-3d-debug-container",this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),sme().appendChild(this.container)}setLabel(e){this.container.setAttribute("dcg-label",e)}renderRawData(e,t,o,i){var a;let n=new ImageData(e,t,o);this.canvas.width=t,this.canvas.height=o,this.container.style.width=t*i+"px",this.container.style.height=o*i+"px",(a=this.canvas.getContext("2d"))==null||a.putImageData(n,0,0)}renderFromTarget(e,t,o){this.renderRawData(dA(e,t),t.width,t.height,o)}};var ZJ=`{
  "glyphs": {
    "x": {
      "x_min": 0,
      "x_max": 675,
      "ha": 764,
      "o": "m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "
    },
    "y": {
      "x_min": 0,
      "x_max": 684.78125,
      "ha": 771,
      "o": "m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "
    },
    "z": {
      "x_min": -0.015625,
      "x_max": 613.890625,
      "ha": 697,
      "o": "m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "
    }
  },
  "cssFontWeight": "normal",
  "ascender": 1189,
  "underlinePosition": -100,
  "cssFontStyle": "normal",
  "boundingBox": { "yMin": -334, "xMin": -111, "yMax": 1189, "xMax": 1672 },
  "resolution": 1000,
  "original_font_information": {
    "postscript_name": "Helvetiker-Regular",
    "version_string": "Version 1.00 2004 initial release",
    "vendor_url": "http://www.magenta.gr/",
    "full_font_name": "Helvetiker",
    "font_family_name": "Helvetiker",
    "copyright": "Copyright (c) \u039Cagenta ltd, 2004",
    "description": "",
    "trademark": "",
    "designer": "",
    "designer_url": "",
    "unique_font_identifier": "\u039Cagenta ltd:Helvetiker:22-10-104",
    "license_url": "http://www.ellak.gr/fonts/MgOpen/license.html",
    "license_description": "Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\\r\\n\\r\\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license (\\"Fonts\\") and associated documentation files (the \\"Font Software\\"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \\r\\n\\r\\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\\r\\n\\r\\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word \\"MgOpen\\", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\\r\\n\\r\\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the \\"MgOpen\\" name.\\r\\n\\r\\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \\r\\n\\r\\nTHE FONT SOFTWARE IS PROVIDED \\"AS IS\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.",
    "manufacturer_name": "\u039Cagenta ltd",
    "font_sub_family_name": "Regular"
  },
  "descender": -334,
  "familyName": "Helvetiker",
  "lineHeight": 1522,
  "underlineThickness": 50
}
`;var eQ=`// License: MIT License (c) 2014 Mikola Lysenko
// https://github.com/mikolalysenko/glsl-read-float/blob/master/index.glsl

#define FLOAT_MAX  1.70141184e38
#define FLOAT_MIN  1.17549435e-38

lowp vec4 encode_float(highp float v) {
  highp float av = abs(v);

  //Handle special cases
  if(av < FLOAT_MIN) {
    return vec4(0.0, 0.0, 0.0, 0.0);
  } else if(v > FLOAT_MAX) {
    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;
  } else if(v < -FLOAT_MAX) {
    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;
  }

  highp vec4 c = vec4(0,0,0,0);

  //Compute exponent and mantissa
  highp float e = floor(log2(av));
  highp float m = av * pow(2.0, -e) - 1.0;

  //Unpack mantissa
  c[1] = floor(128.0 * m);
  m -= c[1] / 128.0;
  c[2] = floor(32768.0 * m);
  m -= c[2] / 32768.0;
  c[3] = floor(8388608.0 * m);

  //Unpack exponent
  highp float ebias = e + 127.0;
  c[0] = floor(ebias / 2.0);
  ebias -= c[0] * 2.0;
  c[1] += floor(ebias) * 128.0;

  //Unpack sign bit
  c[0] += 128.0 * step(0.0, -v);

  //Scale back to range
  return c / 255.0;
}
`;var Gv=`
uniform int uDepthPeel; // 1 or 0
uniform vec2 uInverseScreenSize;
uniform highp sampler2D uOpaqueDepthTexture;
uniform highp sampler2D uPrevDepthTexture;
uniform int uDepthPeelLayer;
uniform float uDepthOffset;
`,Iv=`
  if (uDepthPeel != 0) {
    vec2 screenPos = gl_FragCoord.xy * uInverseScreenSize;
    float opaqueDepth = texture2D(uOpaqueDepthTexture, screenPos).x;
    if (opaqueDepth + uDepthOffset - gl_FragCoord.z < 0.0) {
      discard;
    }

    if(uDepthPeelLayer != 0){
      vec4 texel = texture2D(uPrevDepthTexture,screenPos);
      float prevDepth = texel.x;
      if(prevDepth + uDepthOffset - gl_FragCoord.z >= 0. ){
        discard;
      }
    }
  }
`;var jl={Default:0,PickingObjectId:1,PickingX:2,PickingY:3,PickingZ:4,Depth:5};function hA(){return{zMinForAnimation:{value:-1/0},zMaxForAnimation:{value:1/0},clip_x:{value:!0},clip_y:{value:!0},clip_z:{value:!0},NaN:{value:NaN},Infinity:{value:1/0}}}var tB=`
#ifdef DCG_SUPPORTS_PICKING
  uniform vec4 pickingColor;
  ${eQ}
#endif
`,gA=`#ifdef DCG_SUPPORTS_PICKING
if (dcgRenderMode == ${jl.PickingObjectId}) {
  #if defined(USE_INSTANCING_PICKINGCOLOR) || defined(USE_VERTEX_PICKING_COLOR)
  gl_FragColor = vPickingColor;
  #else
  gl_FragColor = pickingColor;
  #endif
  return;
} else if (dcgRenderMode == ${jl.PickingX}) {
  gl_FragColor = encode_float(vPosition.x);
  return;
} else if (dcgRenderMode == ${jl.PickingY}) {
  gl_FragColor = encode_float(vPosition.y);
  return;
} else if (dcgRenderMode == ${jl.PickingZ}) {
  gl_FragColor = encode_float(vPosition.z);
  return;
}
#endif
`,dme=`  varying vec3 vPosition;
  uniform bool clip_x;
  uniform bool clip_y;
  uniform bool clip_z;
  uniform float xMin;
  uniform float xMax;
  uniform float yMin;
  uniform float yMax;
  uniform float zMin;
  uniform float zMax;
  uniform float zMinForAnimation;
  uniform float zMaxForAnimation;
  uniform int dcgRenderMode;

  ${tB}
`,pme=`  if (clip_x && (vPosition.x < xMin || vPosition.x > xMax)) {discard;}
  if (clip_y && (vPosition.y < yMin || vPosition.y > yMax)) {discard;}
  if (clip_z && (vPosition.z < zMin || vPosition.z > zMax)) {discard;}
  if ((vPosition.z < zMinForAnimation) || (vPosition.z > zMaxForAnimation)) {discard;}
`,Jm=`  gl_FragColor = LinearTosRGB( gl_FragColor );
`;function mA({variant:r,uvArgs:e,extraMeshArgs:t,restrictionShader:o}){let i;r.type==="colorFunc"?i=`      vec3 color = getColor();
      if (isnan(color.x) || isnan(color.y) || isnan(color.z)) {discard;}
      vec4 diffuseColor = vec4(color.x, color.y, color.z, opacity );`:i="vec4 diffuseColor = vec4( diffuse, opacity );";let n=r.type==="colorFunc"?__dcg_shared_module_exports__['jd']`vec3 getColor() {
            ${tQ(e,r.colorShader.source)}
            ${rQ(t,r.colorShader.source)}
            ${r.colorShader.source}
            }\n`:"",a=[o].concat(r.type==="colorFunc"?[r.colorShader]:[]),s=__dcg_shared_module_exports__['kd'](...a.map(_=>_==null?void 0:_.shaderFunctions))+`
`+n+ume(o,tQ(e,o==null?void 0:o.source),t),l=hme(o)+Iv+i,c=/\bvUV\b/.test(s)||/\bvUV\b/.test(l),d=[void 0,"float","vec2","vec3"][t.length],p=d&&(/\bvExtras\b/.test(s)||/\bvExtras\b/.test(l)),u=__dcg_shared_module_exports__['ld'](o==null?void 0:o.shaderUniforms),h=u.uniforms,m=u.declarations,y=`    ${__dcg_shared_module_exports__['id']}
    ${m}
    ${c?`varying vec2 vUV;
`:""}
    ${p?`varying ${d} vExtras;
`:""}
    ${Gv}
    ${s}
`,w=(c?`varying vec2 vUV;
`:"")+(p?`attribute ${d} extras;
`:"")+(p?`varying ${d} vExtras;
`:"")+`varying vec3 vPosition;
uniform mat4 dcgModelMatrix;
`,S=`    ${p?"  vExtras = extras; ":""}
    ${c?"  vUV = uv; ":""}
    #ifdef USE_INSTANCING
      vPosition = (instanceMatrix * vec4( position, 1.0 )).xyz;
    #else
      vPosition = (dcgModelMatrix * vec4( position, 1.0 )).xyz;
    #endif
  `,C=r.type==="colorFunc"?"color::"+r.colorCacheKey+"::"+e.join(","):r.type,v=o?"::"+o.source:"",E=C+v;return{fragmentDeclarations:dme+y,fragmentColorChunk:pme+l,vertexDeclarations:w,vertexPositionChunk:S,cacheKey:E,glslUniforms:h}}function tQ(r,e){let t=c=>c==="x"||c==="y"||c==="z",o=r[0],i=r[1],n=new RegExp(`\\b${o}\\b`),a=new RegExp(`\\b${i}\\b`),s=o!==void 0&&!t(o)&&e&&n.test(e),l=i!==void 0&&!t(i)&&e&&a.test(e);return(s?[`float ${o} = vUV.x;`]:[]).concat(l?[`float ${i} = vUV.y;`]:[]).join(`
`)}function rQ(r,e){let t=o=>new RegExp(`\\b${o}\\b`).test(e);return["float x = vPosition.x;","float y = vPosition.y;","float z = vPosition.z;"].concat(r.length===1?t(r[0])?`float ${r[0]} = vExtras;`:"":r.map((o,i)=>t(o)?`float ${o} = vExtras.${"xyz"[i]};`:"")).join(`
`)}function ume(r,e,t){return r?__dcg_shared_module_exports__['jd']`bool restriction() {
      ${e}
      ${rQ(t,r.source)}
      ${r.source}
      }\n`:""}function hme(r){return r?"if (!restriction()) {discard;}":""}function oQ(r){let{cacheKey:e,vertexPositionChunk:t,vertexDeclarations:o,fragmentColorChunk:i,fragmentDeclarations:n,glslUniforms:a}=mA(r),s=`
varying vec3 vViewPosition;
varying vec3 vNormal;

${Ra.common}
${Ra.common_pars_vertex}

${o}

void main() {

	${Ra.common_vertex}

	vViewPosition = - mvPosition.xyz;
	vec3 transformedNormal = vec3( normal );

	#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	#else
	mat3 m = mat3( dcgModelMatrix );
	#endif
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;

	transformedNormal = normalMatrix * transformedNormal;

	#ifdef FLIP_SIDED
		transformedNormal = - transformedNormal;
	#endif
	vNormal = normalize( transformedNormal );

  ${t}
}
`,l=`
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
varying vec3 vNormal;

#ifdef IOR
	uniform float ior;
#endif

varying vec3 vViewPosition;

${Ra.common}
${Ra.common_pars_fragment}
${Ra.lights_pars_fragment}

${n}

void main() {

  ${i}

	#if defined( USE_COLOR  ) || defined( USE_INSTANCING_COLOR  )
		diffuseColor.rgb = vColor;
	#endif

	${r.disableLighting.value?"vec4 dcgRawColor = diffuseColor;":""}

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	${Ra.common_fragment_begin}
	float roughnessFactor = roughness;
	float metalnessFactor = metalness;
	float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif

	// non perturbed normal for clearcoat among others
	vec3 geometryNormal = normal;

	// accumulation
	${Ra.lights_fragment}

	// modulation

	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

	${gA}

	${Ra.common_fragment_end}

	${r.disableLighting.value?"gl_FragColor.rgb = dcgRawColor.rgb;":""}

	${Jm}

	if (uDepthPeel == 1) {
		// When depth peeling, we render with transparent: false, which causes <opaque_fragment> to set gl_FragColor.a = 1.
		// We need to set it back to the correct value so that it can be respsected in compositing.
		gl_FragColor.a = opacity;
	}
}
`;return{vertex:s,fragment:l,cacheKey:e,glslUniforms:a}}var gme={...jm(FN.common),...jm(FN.lights),roughness:{value:.4},metalness:{value:0},emissive:{value:new zt(0)}},Qm=class extends Ud{constructor(t){let{vertex:o,fragment:i,cacheKey:n,glslUniforms:a}=oQ({...t,disableLighting:t.globalUniforms.disableLighting}),s=typeof t.color=="string"&&__dcg_shared_module_exports__['de'](t.color)?"#808080":t.color,l={...jm(gme),...hA(),...t.graphUniforms,...t.globalUniforms,opacity:{value:t.opacity},diffuse:{value:new zt(s)},map:{value:t.map},...a};super({name:"GraphSurfaceMaterial",wireframe:t.wireframe,vertexShader:o,fragmentShader:i,opacity:t.opacity,side:$s,lights:!0,uniforms:l});this.defines={DCG_SUPPORTS_PICKING:!1};this.vertexColors=t.vertexColors,this.useVertexPickingColors=t.useVertexPickingColors,this.map=t.map,this.defines.DCG_SUPPORTS_PICKING=!0,this.cacheKey=n}setEmissiveIntensity(t){let o=new zt(16777215);o.multiplyScalar(t),this.uniforms.emissive.value.copy(o)}customProgramCacheKey(){return this.cacheKey}};function iQ(r){let{cacheKey:e,vertexPositionChunk:t,vertexDeclarations:o,fragmentColorChunk:i,fragmentDeclarations:n,glslUniforms:a}=mA(r),s=`
  ${Ra.common}
  ${Ra.common_pars_vertex}

  ${o}

void main() {
  ${Ra.common_vertex}

  ${t}
}
`,l=`
uniform vec3 diffuse;
uniform float opacity;
varying vec3 vNormal;

${Ra.common}
${Ra.common_pars_fragment}

${n}

void main() {

  ${i}

  ${Ra.common_fragment_begin}
  float specularStrength = 1.0;

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	// accumulation (baked indirect lighting only)
	reflectedLight.indirectDiffuse += vec3( 1.0 );

	// modulation

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

  ${Ra.common_fragment_end}

	${Jm}
}
`;return{vertex:s,fragment:l,cacheKey:e,glslUniforms:a}}var fA=class extends Ud{constructor(e){let{vertex:t,fragment:o,cacheKey:i,glslUniforms:n}=iQ({extraMeshArgs:[],restrictionShader:void 0,uvArgs:[],variant:{type:"zClip"},disableLighting:e.globalUniforms.disableLighting}),a=typeof e.color=="string"&&__dcg_shared_module_exports__['de'](e.color)?"#808080":e.color,s={...hA(),...e.graphUniforms,...e.globalUniforms,roughness:{value:.4},metalness:{value:0},opacity:{value:e.opacity},diffuse:{value:new zt(a)},...n};super({name:"LineMaterial",vertexShader:t,fragmentShader:o,opacity:e.opacity,side:$s,uniforms:s}),this.cacheKey=i}setColor(e){this.uniforms.diffuse.value.copy(e)}setOpacity(e){this.opacity=this.uniforms.opacity.value=e}customProgramCacheKey(){return this.cacheKey}};var{abs:Mv,min:nQ,max:sQ}=Math,lQ=11184810,mme=3355443,bA="#444444",yA="#bbbbbb",fme=1e-4;function cQ(r){let e=new zt(lQ),t=new zt(mme);return{axisMaterial:aQ(e,r),tickMaterial:aQ(t,r)}}function rB(r,e,t){return new wA(new Hb(new Ae(r.xmin,r.ymin,r.zmin),new Ae(r.xmax,r.ymax,r.zmax)),new zt(e),t)}function dQ(r,e){let t=r.box;t.min.x=e.xmin,t.max.x=e.xmax,t.min.y=e.ymin,t.max.y=e.ymax,t.min.z=e.zmin,t.max.z=e.zmax,r.updateMatrixWorld()}function oB(r){r.dispose()}var bme=new pS(JSON.parse(ZJ));function aQ(r,e){let t=new Qm({color:r,extraMeshArgs:[],map:void 0,opacity:1,restrictionShader:void 0,uvArgs:[],variant:{type:"zClip"},wireframe:!1,vertexColors:!1,useVertexPickingColors:!1,globalUniforms:e,graphUniforms:{clip_x:{value:!1},clip_y:{value:!1},clip_z:{value:!1}}});return t.customProgramCacheKey=()=>"axis-material",t}function pQ(r,e){let{xmin:t,xmax:o,ymin:i,ymax:n,zmin:a,zmax:s}=r,l=nQ(e.width,e.height),c=.05*(l>360?1:l>120?360/l:4-l/120),d=4,p=d*c/.08,u=__dcg_shared_module_exports__['wc'](0,t,o),h=__dcg_shared_module_exports__['wc'](0,i,n),m=__dcg_shared_module_exports__['wc'](0,a,s),y=o-t,w=n-i,S=s-a,C=4*((u-t)/y-.5),v=4*((h-i)/w-.5),E=4*((m-a)/S-.5),_=s<=0?-4:nQ(4*s/S,4);return{textSize:c,scale:d,delta:p,zLen:_,x:C,y:v,z:E}}var uQ=.02,qu=7*uQ;function hQ(r,e,t,{axisMaterial:o}){let{xmin:i,xmax:n,ymin:a,ymax:s,zmin:l,zmax:c}=r,d=n-i,p=s-a,u=c-l,h=(n+i)/2,m=(s+a)/2,y=(c+l)/2,w=new Nn,S=Math.PI,C=uQ,{textSize:v,scale:E,delta:_,zLen:T,x:I,y:P,z:O}=pQ(r,e);function W(R){return new Bn(new Bu(.8*C,.8*C,R,10),o)}function X(){return new Bn(new SM(2*C,qu,16),o)}function x(R,N,z,A=1){return R.position.set(z[0],z[1],z[2]),R.setRotationFromEuler(Qb(N[0],N[1],N[2])),R.scale.set(A,A,A),R.name="axes",w.add(R),R}function L(R,N,z=1){let A=Cme(R,o);A.translateX(-N[0]*_),A.translateY(-N[1]*_),A.scale.set(z,z,z),A.name="axes";let U=yQ(A);U.name=R,w.add(U)}return x(W(4-6*C),[0,0,S/2],[-qu/2,P,O]),x(W(4-6*C),[0,0,0],[I,-qu/2,O]),x(W(4-6*C),[-S/2,0,0],[I,P,-qu/2]),x(X(),[0,0,-S/2],[2-qu/2,P,O]),x(X(),[0,0,0],[I,2-qu/2,O]),x(X(),[S/2,0,0],[I,P,O+sQ(T,0)-qu/2]),t&&(L("x",[.027,.03],v*E),L("y",[.025,.02],v*E),L("z",[.025,.03],v*E)),w.scale.set(d/4,p/4,u/4),w.position.set(h,m,y),w}function iB(r){for(let e of r.getObjectsByProperty("name","axes"))e.geometry.dispose()}function gQ(r){r.axisMaterial.dispose(),r.tickMaterial.dispose()}function mQ({axes:r,plane:e,domain:t,screen:o,controls:i,invertedColors:n,isDepthPeelingActive:a}){let s=i.worldRotation3D,{xmax:l,ymax:c,zmax:d}=t,{scale:p,delta:u,zLen:h,x:m,y,z:w}=pQ(t,o);if(r===void 0)return;let S=Math.PI,C=r.getObjectByName("x"),v=r.getObjectByName("y"),E=r.getObjectByName("z"),_=new Ae(1,0,0).applyMatrix3(s),T=new Ae(0,1,0).applyMatrix3(s),I=new Ae(0,0,1).applyMatrix3(s);function P(De,Ge,Ye){De==null||De.setRotationFromEuler(Qb(Ge[0],Ge[1],Ge[2])),De==null||De.position.set(Ye[0],Ye[1],Ye[2])}function O(De){return Math.acos(__dcg_shared_module_exports__['wc'](De,-1,1))}let W=l<=0?-1:1,X=c<=0?-1:1,x=d<=0?-1:1,L=[W*(.5*p+.05*u),y,w],R=[m,X*(.5*p+.05*u),w],N=[m,y,x*(w+sQ(h,0)+.04*u)],z=i.speed3D===0||i.grapher3d.isDragging,A=Mv(i.axis3D[0])>.99,U=Mv(i.axis3D[1])>.99,pe=Mv(i.axis3D[2])>.99,q=z||A,F=z||U,ge=z||pe,{isXYsnapped:ne,isZsnapped:ae}=i,j=Mv(_.y)>.99&&ne&&q,oe=Mv(T.y)>.99&&ne&&F;if(Mv(I.z)<.001&&ae&&ge)P(C,[S,0,S],L),P(v,[S,S,S],R),P(E,[S/2,0,0],N);else{let De=I.z<0?1:-1,Ge=T.y<0?1:-1,Ye=-De*(S/2),ee=(T.x*_.y<0?1:-1)*O(T.z),we=-De*O(-Ge*_.z),Me=j?ee:S/2,$e=oe?we:Ye,me=(T.y<0?-1:1)*O(_.y)+S,rt=Ge*S/2;P(C,[Me,0,0],L),P(v,[$e,0,rt],R),P(E,[Ye,0,me],N);let vt=e==null?void 0:e.getObjectByName("z plane");vt==null||vt.setRotationFromEuler(Qb(S/2,0,me))}let ye=new Ae(0,0,1).applyMatrix3(i.worldRotation3D).x;e==null||e.updateZOffsets(ye<0);let Ce;e!=null&&e.xyPlane&&(Ce=e.xyPlane.material,Ce.uniforms.diffuse.value=new zt(n?0:16777215)),vme({invertedColors:n,obliqueness:ye,domainPlaneMaterial:Ce,isDepthPeelingActive:a})}var xA=class extends cS{constructor(e,t,o,i,n){super();let{showNumbers3D:a,showPlane3D:s}=o.settings,{xmin:l,xmax:c,ymin:d,ymax:p,zmin:u,zmax:h}=e,[m,y,w]=[c-l,p-d,h-u],S=__dcg_shared_module_exports__['wc'](0,u,h);this.basePosition=new Ae((c+l)/2,(p+d)/2,S),this.zOffset=fme*(h-u);let C=new sS(m,y);if(this.xyNumbersPlane=new Bn(C,t.xyNumbersMaterial),this.xyNumbersPlane.name="xy numbers plane",this.xyPlane=new Bn(C,t.xyPlaneMaterial),this.xyPlane.name="xy plane",s){this.add(this.xyPlane);let v=new wA(new Hb(new Ae(l,d,S),new Ae(c,p,S)),new zt(lQ),n);v.name="xy border",this.add(v)}if(a){this.add(this.xyNumbersPlane),this.add(wme(o,e,i));let v=new sS(4,4),E=new Bn(v,t.zMaterial),_=yQ(E),[T,I]=[__dcg_shared_module_exports__['wc'](0,l,c),__dcg_shared_module_exports__['wc'](0,d,p)];E.setRotationFromEuler(Qb(Math.PI/2,0,0)),E.name="z plane",_.scale.set(m/4,y/4,w/4),_.position.set(T,I,(h+u)/2),yme(t.zCanvas,o,e),t.zMaterial.uniforms.map.value.needsUpdate=!0,this.add(_)}}updateZOffsets(e){var a,s;let{x:t,y:o,z:i}=this.basePosition,n=e?this.zOffset:-this.zOffset;this.xyPlane&&((a=this.xyPlane)==null||a.position.set(t,o,i-n),this.xyPlane.renderOrder=0),this.xyNumbersPlane&&((s=this.xyNumbersPlane)==null||s.position.set(t,o,i+2*n),this.xyNumbersPlane.renderOrder=2)}};function yme(r,e,t){let o=r.getContext("2d");if(o===null)return;let i=fQ(e,t),n=e.settings.labelSize,{xmin:a,xmax:s,zmin:l,zmax:c}=t,d=[];for(let v of i){let E=__dcg_shared_module_exports__['dc'].value(v,c-l);d.push(new cl(E,n))}o.save(),o.scale(window.devicePixelRatio,window.devicePixelRatio),o.clearRect(0,0,e.screen.width,e.screen.height),o.fillStyle=`rgba(${e.settings.config.invertedColors?"0,0,0":"255,255,255"},0.001961)`,o.fillRect(0,0,e.screen.width,e.screen.height),o.lineWidth=1.5,o.miterLimit=2,o.strokeStyle=e.settings.getBackgroundColor({invertWhite:!0});let p=5,u=e.settings.getTextColor({invertBlack:!0}),h=e.screen.width,m=e.screen.height,y={left:3,top:3,right:h-3,bottom:m-3},w=new Co(a,s,l,c,l,c),S=new kc(e.screen,w,e.settings),C=r.width/window.devicePixelRatio/2;for(let v of d){let E={x:C-p-v.getRect().right,y:S.mapy(v.getValue())},_=v.clampBoundsWithinRect(E,y);o.fillStyle=u,v.drawCenteredAt(o,_,"")}o.restore()}function fQ(r,e){let{zmin:t,zmax:o}=e,i={...r.viewport,ymin:t,ymax:o},n={...r,viewport:i},{majorStepY:a}=od(n),s=ql(t,o,a);return o>0&&(s=s.filter(l=>l!=0)),s}function xme(r,e){let{zmin:t,zmax:o}=e;return fQ(r,e).filter(n=>n<=o-qu/4*(o-t))}function wme(r,e,{tickMaterial:t}){let{xmin:o,xmax:i,ymin:n,ymax:a,zmin:s,zmax:l}=e,c=__dcg_shared_module_exports__['wc'](0,o,i),d=__dcg_shared_module_exports__['wc'](0,n,a),p=__dcg_shared_module_exports__['wc'](0,s,l),u=Math.PI,h=.004,m=h*(i-o),y=h*(a-n),w=h*(l-s),S=new cS,C=.4;for(let _ of xme(r,e)){let T=new Bu,I=new Bn(T,t);I.position.set(c,d,_),I.scale.set(m,C*w,y),I.setRotationFromEuler(Qb(u/2,0,0)),I.name="ticks",S.add(I)}let{majorStepX:v,majorStepY:E}=od(r);for(let _ of ql(o,i,v)){if(_>i-qu/4*(i-o))continue;let T=new Bu,I=new Bn(T,t);I.position.set(_,d,p),I.scale.set(y,C*m,w),I.setRotationFromEuler(Qb(0,0,u/2)),I.name="ticks",S.add(I)}for(let _ of ql(n,a,E)){if(_>a-qu/4*(a-n))continue;let T=new Bu,I=new Bn(T,t);I.position.set(c,_,p),I.scale.set(w,C*y,m),I.setRotationFromEuler(Qb(0,u/2,0)),I.name="ticks",S.add(I)}return S}function vme({obliqueness:r,domainPlaneMaterial:e,invertedColors:t}){if(!e)return;e.uniforms.obliqueness.value=Math.abs(r);let o=t?__dcg_shared_module_exports__['Ud'](bA):bA,i=t?__dcg_shared_module_exports__['Ud'](yA):yA;e.setGridColors({major:o,minor:i})}function bQ(r){var o,i,n,a;let e=s=>r.getObjectByName(s);(o=e("xy numbers plane"))==null||o.geometry.dispose(),(i=e("xy plane"))==null||i.geometry.dispose(),(n=e("z plane"))==null||n.geometry.dispose(),(a=e("xy border"))==null||a.dispose();let t=r.getObjectsByProperty("name","ticks");for(let s of t)s.geometry.dispose()}function nB(r){r.uniforms.map.value.dispose(),r.dispose()}function yQ(r){let e=new Nn;return e.add(r),e}function Cme(r,e){let t=new dS(r,{font:bme,size:1,height:.02,curveSegments:12,bevelEnabled:!0,bevelThickness:.04,bevelSize:.04,bevelOffset:0,bevelSegments:5});return new Bn(t,e)}var Qb=(r,e,t)=>new _c(r,e,t,"ZYX"),wA=class extends _M{constructor(t,o,i){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new gl;s.setIndex(new js(n,1)),s.setAttribute("position",new qi(a,3));super(s,new fA({color:o,opacity:1,graphUniforms:{clip_x:{value:!1},clip_y:{value:!1},clip_z:{value:!1}},globalUniforms:i}));this.type="Box3Helper";this.box=t,this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let o=this.box;o.isEmpty()||(o.getCenter(this.position),o.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}};var Zb=class extends Ud{constructor(e,t){super({name:"DomainPlaneMaterial",side:$s,transparent:e.transparent,vertexShader:`
        varying vec3 vPosition;
        void main() {
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          vPosition = position;
        }
      `,fragmentShader:`
        uniform mat4 projectionMatrix;
        uniform mat4 modelViewMatrix;

        varying vec3 vPosition;
        uniform int dcgRenderMode;
        uniform vec2 uScreenSize;
        uniform float xMin;
        uniform float xMax;
        uniform float yMin;
        uniform float yMax;

        uniform vec3 diffuse;
        uniform float opacity;

        uniform float xMinorStep;
        uniform float yMinorStep;
        uniform float xMajorStep;
        uniform float yMajorStep;
        uniform vec3 majorGridColor;
        uniform vec3 minorGridColor;
        uniform float obliqueness;

        ${Gv}
        ${tB}

        float getNearestStep(float t, float step) {
          float prev = step * floor(t / step);
          float next = prev + step;
          return abs(t - prev) < abs(t - next) ? prev : next;
        }

        vec2 projectToScreen(vec3 p) {
          vec4 pNDC = projectionMatrix * modelViewMatrix * vec4(p, 1.0);
          pNDC /= pNDC.w;
          return 0.5 * (pNDC.xy + 1.0) * uScreenSize;
        }

        bool isMajorStep(float s, float minorStep, float majorStep) {
          return mod(s, majorStep) < minorStep * 0.125;
        }

        void main() {
          ${Iv}
          ${gA}
          // the xyPlane geometry is shifted in domain3d-objects to reduce cancellation error
          float x0 = (xMin + xMax) / 2.;
          float y0 = (yMin + yMax) / 2.;
          float xNearest = getNearestStep(vPosition.x + x0, xMinorStep);
          float yNearest = getNearestStep(vPosition.y + y0, yMinorStep);
          bool xIsMajor = isMajorStep(xNearest, xMinorStep, xMajorStep);
          bool yIsMajor = isMajorStep(yNearest, yMinorStep, yMajorStep);
          vec2 xNearestScreen = projectToScreen(vec3(xNearest - x0, vPosition.y, vPosition.z));
          vec2 yNearestScreen = projectToScreen(vec3(vPosition.x, yNearest - y0, vPosition.z));
          float xDist = distance(gl_FragCoord.xy, xNearestScreen);
          float yDist = distance(gl_FragCoord.xy, yNearestScreen);
          float minDist = xDist < yDist ? xDist : yDist;
          bool isMajor = xDist < yDist ? xIsMajor : yIsMajor;

          vec4 grid = vec4(0.0);
          float baseWidth = 0.0;
          float feather = 2.0;
          if (obliqueness < FADE_THRESHOLD) {
            baseWidth = 3.0 * (1.0 - obliqueness / FADE_THRESHOLD);
            feather = 2.0 * obliqueness / FADE_THRESHOLD;
          }
          if (minDist <= baseWidth + feather) {
            vec3 gridColor = isMajor ? majorGridColor : minorGridColor;
            // We want integral of blurFactor to be 1.0 over the whole region
            //
            //   baseWidth
            //   --------------
            //   |            |            //   |            |             // h |            |              //   |            |               //   |            |                //   -------------|-----
            //               feather (2.0)
            // h * baseWidth + h * feather / 2 = 1
            // h = 1 / (baseWidth + feather / 2)
            float h = 1.0 / (baseWidth + feather / 2.0);
            float blurFactor = h - max(0.0, (minDist - baseWidth)) / feather;
            grid = vec4(gridColor, blurFactor);
          }

          // Composite the grid color ("grid") onto the domain plane color (diffuse, opacity)
          float composedAlpha = mix(opacity, grid.a, grid.a);
          vec3 composedColor = mix(diffuse*opacity, grid.rgb*grid.a, grid.a) / composedAlpha;
          gl_FragColor = vec4(composedColor, composedAlpha);

          ${Jm}
        }
      `,defines:{DCG_SUPPORTS_PICKING:!0,FADE_THRESHOLD:.4},uniforms:{opacity:{value:e.opacity},diffuse:{value:e.color},majorGridColor:{value:new zt(bA)},minorGridColor:{value:new zt(yA)},obliqueness:{value:1},...t}})}setGridColors({major:e,minor:t}){this.uniforms.majorGridColor.value=new zt(e),this.uniforms.minorGridColor.value=new zt(t)}};var ey=class extends Ud{constructor(e,t){let o=new eA(e.canvas);super({name:"DomainPlaneNumbersMaterial",side:$s,transparent:e.transparent,vertexShader:`
        varying vec2 vUv;

        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
      `,fragmentShader:`

        uniform sampler2D map;
        uniform float opacity;
        varying vec2 vUv;
        uniform int dcgRenderMode;

        ${Gv}

        uniform float alphaTest;

        void main() {
          ${Iv}

          vec4 sampleColor = texture2D( map, vUv );

          // When we're only showing numbers, we clear the canvas with a low alpha and discard it here.
          if ( sampleColor.a < alphaTest ) {
            discard;
          }

          #ifdef OPAQUE
          if (uDepthPeel == 0) {
            sampleColor.a = 1.0;
          }
          #endif

          gl_FragColor = sampleColor;

          ${Jm}
        }
      `,uniforms:{map:{value:o},alphaTest:{value:.1},...t}}),this.canvas=e.canvas,this.texture=o}dispose(){super.dispose(),this.texture.dispose()}};var Sme={name:"DepthPeelLayerAddJittersShader",uniforms:{uCompositeType:{value:0},uTextureA:{value:null},uTextureB:{value:null},weight:{value:1}},defines:{},vertexShader:`
    varying vec2 vUv;
    void main(){
      vUv = uv;
      gl_Position = vec4(position.xy,0.,1.);
    }
  `,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D uTextureA;
    uniform sampler2D uTextureB;
    uniform int uCompositeType;
    uniform float weight;
    void main() {
      vec4 src = texture2D(uTextureA,vUv);
      src.a *= weight;
      vec4 dst = uCompositeType == 1 ? texture2D(uTextureB,vUv) : vec4(0.0);
      // Convert src, dst to premultiplied, and do the addition in premultiplied space.
      // We don't want to store the buffers premultiplied since that loses dynamic range.
      src.rgb *= src.a;
      dst.rgb *= dst.a;
      gl_FragColor = src + dst;
      // Convert output back to non-premultiplied
      // Don't need to check for division by zero, since it gets converted to a buffer 0-255 (an integer, not NaN),
      // which we will then multiply by 0 (the alpha).
      gl_FragColor.rgb /= gl_FragColor.a;
    }
  `},vA=class{constructor(){this.shaderPass=new sd(Sme,{depthTest:!1,depthWrite:!1,transparent:!1},"uTextureA")}dispose(){this.shaderPass.dispose()}addInPremultiplied(e,t,o,i,n){this.shaderPass.uniforms.weight.value=i,n instanceof zt?(this.shaderPass.uniforms.uCompositeType.value=0,this.shaderPass.uniforms.uTextureB.value=null):(this.shaderPass.uniforms.uTextureB.value=n.texture,this.shaderPass.uniforms.uCompositeType.value=1),this.shaderPass.renderFromTexture(e,t,o.texture)}};var Eme={name:"DepthPeelLayerCompositeShader",uniforms:{uTopTexture:{value:null},uBottomTexture:{value:null},uBackgroundColor:{value:new zt(0)},uCompositeType:{value:0}},defines:{},vertexShader:`
    varying vec2 vUv;
    void main(){
      vUv = uv;
      gl_Position = vec4(position.xy,0.,1.);
    }
  `,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D uTopTexture;
    uniform sampler2D uBottomTexture;
    uniform vec3 uBackgroundColor;
    uniform int uCompositeType;
    void main() {
      vec4 top = texture2D(uTopTexture,vUv);
      vec4 bot = uCompositeType == 1 ? texture2D(uBottomTexture,vUv) : vec4(uBackgroundColor, 1.0);
      // Convert top, bot to premultiplied, and do the addition in premultiplied space.
      // We don't want to store the buffers premultiplied since that loses dynamic range.
      top.rgb *= top.a;
      bot.rgb *= bot.a;
      gl_FragColor = top + bot * (1. - top.a);
      // Convert output back to non-premultiplied
      gl_FragColor.rgb /= gl_FragColor.a;
    }
  `},CA=class{constructor(){this.shaderPass=new sd(Eme,{depthTest:!1,depthWrite:!1,transparent:!1},"uTopTexture")}dispose(){this.shaderPass.dispose()}composite(e,t,o,i){i instanceof zt?(this.shaderPass.uniforms.uCompositeType.value=0,this.shaderPass.uniforms.uBackgroundColor.value=i,this.shaderPass.uniforms.uBottomTexture.value=null):(this.shaderPass.uniforms.uCompositeType.value=1,this.shaderPass.uniforms.uBackgroundColor.value=new zt(0),this.shaderPass.uniforms.uBottomTexture.value=i.texture),this.shaderPass.renderFromTexture(e,t,o.texture)}};var fS=4,Dme={name:"MaxWindow",uniforms:{tDiffuse:{value:null},sourcePixelSize:{value:new Yt(1,1)},destPixelSize:{value:new Yt(1,1)}},defines:{},vertexShader:`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }`,fragmentShader:`
  uniform float weight;
  uniform sampler2D tDiffuse;
  uniform vec2 sourcePixelSize;
  uniform vec2 destPixelSize;
  varying vec2 vUv;

  void main() {
    vec2 demi = vec2(0.5,0.5);
    vec2 xy = destPixelSize * vUv - demi;
    vec4 maxAccum = vec4(0.);
    for (float i=0.; i < ${fS}.0; i+=1.) {
      for (float j=0.; j < ${fS}.0; j+=1.) {
        vec2 xySample = min(
          xy * ${fS}.0 + vec2(i,j) + demi,
          sourcePixelSize
        );
        vec2 uvSample = xySample / sourcePixelSize;
        vec4 val = texture2D(tDiffuse, uvSample);
        maxAccum = max(maxAccum, val);
      }
    }
    gl_FragColor = maxAccum;
  }`},aB=class{constructor(){this.shaderPass=new sd(Dme,{depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){this.shaderPass.dispose()}render(e,t,o){this.shaderPass.uniforms.sourcePixelSize={value:new Yt(o.width,o.height)},this.shaderPass.uniforms.destPixelSize={value:new Yt(t.width,t.height)},e.setRenderTarget(t),e.setClearColor(new zt(0),0),e.clear(),this.shaderPass.render(e,t,o)}},SA=class{constructor(e,t){this.targetType=t;this.maxPass=new aB;this.maxMipmapTargets=[];let o=e.x,i=e.y;for(let n=0;o=Math.ceil(o/fS),i=Math.ceil(i/fS),o>1||i>1;n++)this.maxMipmapTargets[n]=this.createTarget(o,i)}dispose(){for(let e of this.maxMipmapTargets)e.dispose();this.maxPass.dispose()}createTarget(e,t){return new bl(e,t,{minFilter:nd,magFilter:nd,type:this.targetType,colorSpace:hl})}renderMax(e,t,o,i,n,a){var s;for(let l=0;l<=this.maxMipmapTargets.length;l++){let c=l===0?o:this.maxMipmapTargets[l-1],d=l<this.maxMipmapTargets.length?this.maxMipmapTargets[l]:t;this.maxPass.render(e,d,c)}for(let l=0;l<this.maxMipmapTargets.length;l++){let c=this.maxMipmapTargets[l];(s=i.get(`max-mm-p${n}-${l}`,`${c.width}x${c.height}`))==null||s.renderFromTarget(e,c,a*Math.min(o.width/c.width,o.height/c.height))}}};var EA=class{constructor(e,t,o,i,n,a){this.controller=e;this.renderer=t;this.materialManager=o;this.scene=i;this.camera=n;this.debug=a;this.triangles=0;this.pixelRatio=t.getPixelRatio();let s=t.getSize(new Yt).multiplyScalar(this.pixelRatio);this.size=s,this.init()}init(){this.samples=1;let e=this.controller.getGraphSettings().config.peelUpsample;e?this.samples=e:this.pixelRatio<1.5?this.samples=3:this.pixelRatio<2.5?this.samples=2:this.samples=1;let t=this.controller.getGraphSettings().config.peelFloatTexture?QJ()[0]:ns,o=()=>new bl(this.size.x,this.size.y,{minFilter:nd,magFilter:nd,type:t,colorSpace:hl});this.peelSampleTargets=[],this.peelResultTarget=o(),this.secondPeelResultTarget=o(),this.compositingTargets=[o(),o()],this.maxPass=new SA(this.size,t),this.finalMipmapTargets=[this.maxPass.createTarget(1,1),this.maxPass.createTarget(1,1)],this.opaqueBackgroundTargets=[];for(let n=0;n<this.samples;n++){let a=o();a.depthTexture=new Yb(this.size.x,this.size.y),this.opaqueBackgroundTargets.push(a)}this.combinedOpaqueBackgroundTarget=o();let i=2*this.samples;for(let n=0;n<i;n++){let a=o();a.depthTexture=new Yb(this.size.x,this.size.y),this.peelSampleTargets.push(a)}this.compositePass=new CA,this.addPremultipliedPass=new vA,this.materialManager.setScreenSize(this.size.x,this.size.y)}dispose(){this.peelSampleTargets.forEach(e=>e.dispose()),this.compositingTargets.forEach(e=>e.dispose()),this.peelResultTarget.dispose(),this.compositePass.dispose(),this.addPremultipliedPass.dispose(),this.maxPass.dispose()}getDebugScale(){return this.controller.getGraphSettings().config.debugScale}render(e){var y;let t=this.renderer,o=t.getPixelRatio(),i=t.getSize(new Yt).multiplyScalar(o);(o!==this.pixelRatio||this.size.x!==i.x||this.size.y!==i.y)&&(this.size.copy(i),this.dispose(),this.init());let n=t.getClearColor(new zt),a=t.autoClear;t.autoClear=!1,t.setClearColor(new zt(0),1),t.clear(),this.materialManager.setGlobalUniform("dcgRenderMode",jl.Default);let s=kme(this.scene);Tme(this.scene),this.renderOpaqueBackground(),vQ(this.scene,s),this.materialManager.setGlobalUniform("uDepthPeel",1),this.materialManager.setGlobalUniform("uDepthPeelLayer",0),this.materialManager.setGlobalUniform("uPrevDepthTexture",null);let l,c=this.peelSampleTargets.slice(0,this.samples),d=this.peelSampleTargets.slice(this.samples,2*this.samples),p=this.compositingTargets[0],u=this.compositingTargets[1];Gme(this.scene);let h=[];this.renderTransparentLayer(c,void 0,0,p),e===1&&h.push(this.queryNonemptyPixels(0,p,this.finalMipmapTargets[0])),l=p;for(let w=0;w<e;w++){let S=w+1;this.renderTransparentLayer(d,c,S,this.peelResultTarget),this.compositePass.composite(this.renderer,u,p,this.peelResultTarget),(y=this.debug.get(`peel-c${S}`))==null||y.renderFromTarget(this.renderer,u,this.getDebugScale()),w>=e-2&&h.push(this.queryNonemptyPixels(S,this.peelResultTarget,this.finalMipmapTargets[w===e-2?0:1])),l=u,[d,c]=[c,d],[u,p]=[p,u]}let m=this.renderer.info.render.frame;Promise.all(h).then(w=>{if(w.length!==2)throw new Error(`Programming error: expected 2 nonempty pixel query results, got ${w.length}`);let S=w[0][3]>0,v=w[1][3]>0?1:S?2:0;this.controller.setAdaptiveDepthPeelingInfo({frame:m,peelLayers:e,status:v})}),vQ(this.scene,s),this.compositePass.composite(this.renderer,null,l,this.combinedOpaqueBackgroundTarget),t.setClearColor(n),t.autoClear=a,this.materialManager.setGlobalUniform("uPrevDepthTexture",null),this.materialManager.setGlobalUniform("uDepthPeel",0)}renderOpaqueBackground(){this.materialManager.setGlobalUniform("uDepthPeel",0),this.materialManager.setGlobalUniform("uOpaqueDepthTexture",null);let e=this.combinedOpaqueBackgroundTarget,t=this.secondPeelResultTarget;this.samples%2===0&&([t,e]=[e,t]);for(let o=0;o<this.samples;o++){let i=this.opaqueBackgroundTargets[o];this.renderer.setRenderTarget(i),this.setJitterOffset(o),this.renderer.setClearColor(new zt(0),0),this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.addPremultipliedPass.addInPremultiplied(this.renderer,e,i,xQ(this.samples,o),o===0?new zt(0):t),[e,t]=[t,e]}this.camera.clearViewOffset()}renderTransparentLayer(e,t,o,i){var a,s;let n=this.secondPeelResultTarget;e.length%2===0&&([n,i]=[i,n]);for(let l=0;l<e.length;l++){let c=e[l];this.materialManager.setGlobalUniform("uOpaqueDepthTexture",this.opaqueBackgroundTargets[l].depthTexture),t&&this.materialManager.setGlobalUniform("uPrevDepthTexture",t[l].depthTexture),this.setJitterOffset(l),this.materialManager.setGlobalUniform("uDepthPeelLayer",o),this.materialManager.setGlobalUniform("dcgRenderMode",jl.Default),this.renderer.setClearColor(new zt(0),0),this.renderer.setRenderTarget(c),this.renderer.clear(!0,!0);let d=this.scene.background;this.scene.background=null,this.renderer.render(this.scene,this.camera),this.scene.background=d,this.triangles=this.renderer.info.render.triangles,(a=this.debug.get(`peel-p${o}-s${l}`))==null||a.renderFromTarget(this.renderer,c,this.getDebugScale()),this.addPremultipliedPass.addInPremultiplied(this.renderer,i,c,xQ(this.samples,l),l===0?new zt(0):n),(s=this.debug.get(`peel-p${o}-s${l}-combined`))==null||s.renderFromTarget(this.renderer,i,this.getDebugScale()),[i,n]=[n,i]}this.camera.clearViewOffset()}setJitterOffset(e){if(!wQ[this.samples])throw new Error(`Unsupported sample count: ${this.samples}`);let t=wQ[this.samples];this.camera.setViewOffset(this.size.x,this.size.y,t[e][0]*.0625,t[e][1]*.0625,this.size.x,this.size.y)}queryNonemptyPixels(e,t,o){var s,l;(s=this.debug.get(`max-mm-p${e}-start`))==null||s.renderFromTarget(this.renderer,t,this.getDebugScale()),this.maxPass.renderMax(this.renderer,o,t,this.debug,e,this.getDebugScale());let i=this.renderer.getContext(),n=new Uint8Array(4*o.width*o.height),a=JJ(i,0,0,o.width,o.height,i.RGBA,i.UNSIGNED_BYTE,n).then(()=>[...n]);return(l=this.debug.get(`max-mm-p${e}-end`,`${o.width}x${o.height}`))==null||l.renderFromTarget(this.renderer,o,this.getDebugScale()*Math.min(t.width/o.width,t.height/o.height)),a}};function xQ(r,e){let t=1/r,o=1/32,i=-.5+(e+.5)/r;return t+o*i}var wQ={1:[[0,0]],2:[[4,4],[-4,-4]],3:[[3.323,3.323],[-4.54,1.216],[1.216,-4.54]],4:[[-2,-6],[6,-2],[-6,2],[2,6]]};function kme(r){let e=new Map;return r.traverse(t=>{e.set(t,t.visible)}),e}function vQ(r,e){r.traverse(t=>{t.visible=e.get(t)})}var _me=.999;function Tme(r){r.traverse(e=>{CQ(e)==="transparent"&&(e.visible=!1)})}function Gme(r){r.traverse(e=>{CQ(e)==="opaque"&&(e.visible=!1)})}function CQ(r){let e=r.material;if(e)return e instanceof Zb||e instanceof ey||e.opacity<_me?"transparent":"opaque"}var DA=class{constructor(){this.materialCache={};this.globalUniforms={dcgRenderMode:jl.Default,xMin:0,xMax:0,yMin:0,yMax:0,zMin:0,zMax:0,xMajorStep:0,xMinorStep:0,yMajorStep:0,yMinorStep:0,uDepthPeel:0,uDepthPeelLayer:0,uOpaqueDepthTexture:null,uPrevDepthTexture:null,uScreenSize:new Yt(1,1),uInverseScreenSize:new Yt(1,1),uDepthOffset:1e-6,disableLighting:!0}}setGlobalUniform(e,t){this.globalUniforms[e]=t}disposeAllMaterials(){this.disposeMaterialsNotInScene(new ag)}disposeMaterialsNotInScene(e){var o;let t={};e.traverse(i=>{if("material"in i){let n=i.material,a;Array.isArray(i.material)?a=n:a=[n],a.forEach(s=>{EQ(s)&&(t[s.dcgMaterialCacheKey]=!0)})}});for(let i in this.materialCache)if(!t[i]){let n=this.materialCache[i];n.dispose(),(o=n.map)==null||o.dispose(),delete this.materialCache[i]}}getOrMakeMaterial(e){let t=Ime(e.spec),o=this.materialCache[t];if(o)switch(e.type){case"surface-graph":SQ(o.uniforms,e.uniforms);break;case"domain-plane":break;default:throw new Error(`Unexpected type ${e.type}`)}else{switch(e.type){case"surface-graph":o=this._buildSurfaceMaterial(e.spec,e.uniforms);break;case"domain-plane":o=this.buildDomainPlaneMaterial(e.spec);break;default:throw new Error(`Unexpected type ${e.type}`)}this.materialCache[t]=o,o.dcgMaterialCacheKey=t}return o}setScreenSize(e,t){this.globalUniforms.uScreenSize.set(e,t),this.globalUniforms.uInverseScreenSize.set(1/e,1/t)}setDomain(e,t){let{xmin:o,xmax:i,ymin:n,ymax:a,zmin:s,zmax:l}=e,c=1e-5,d=(i-o)*c,p=(a-n)*c,u=(l-s)*c;this.globalUniforms.xMin=o-d,this.globalUniforms.xMax=i+d,this.globalUniforms.yMin=n-p,this.globalUniforms.yMax=a+p,this.globalUniforms.zMin=s-u,this.globalUniforms.zMax=l+u;let h=od(t);this.globalUniforms.xMinorStep=h.minorStepX,this.globalUniforms.xMajorStep=h.majorStepX,this.globalUniforms.yMinorStep=h.minorStepY,this.globalUniforms.yMajorStep=h.majorStepY}setDisableLighting(e){this.globalUniforms.disableLighting=e}setZBoundsUniform(e,t){if(!EQ(e))throw new Error("Cannot update zBoundsForAnimation on a material that is not managed by MaterialManager");e instanceof Zb||e instanceof ey||DQ(e.uniforms,t)}_buildSurfaceMaterial(e,t){var d,p;let o=e.color,i=(d=e.uvArgs)!=null?d:[],n=(p=e.extraMeshArgs)!=null?p:[],a=e.restrictionShader,s=o.startsWith("wireframe:");s&&(o=o.slice(10));let l=this.getVariant(o,e.colorShader),c=new Qm({color:__dcg_shared_module_exports__['de'](o)?"#808080":o,wireframe:s,opacity:e.opacity,extraMeshArgs:n,map:void 0,variant:l,vertexColors:e.vertexColors||!1,useVertexPickingColors:e.useVertexPickingColors||!1,restrictionShader:a,uvArgs:i,globalUniforms:this.getGlobalUniforms()});return SQ(c.uniforms,t),c}buildDomainPlaneMaterial(e){let t;return e.type==="domain-plane-numbers-material"?t=new ey(e,this.getGlobalUniforms()):t=new Zb(e,this.getGlobalUniforms()),this.setupGlobalUniforms(t.uniforms),t}getVariant(e,t){return e.startsWith("shader:")?!t||!t.source?{type:"zClip"}:{type:"colorFunc",colorShader:t,colorCacheKey:JSON.stringify(t)}:{type:"zClip"}}getGlobalUniforms(){let e={};return this.setupGlobalUniforms(e),e}setupGlobalUniforms(e){let t=this;for(let o in this.globalUniforms){let i=o;e[i]={get value(){return t.globalUniforms[i]}}}}};function SQ(r,e){let{clip:t,zBoundsForAnimation:o}=e;DQ(r,o),r.clip_x={value:t.x},r.clip_y={value:t.y},r.clip_z={value:t.z},r.NaN={value:NaN},r.Infinity={value:1/0}}function DQ(r,e){r.zMinForAnimation={value:e.zMinForAnimation},r.zMaxForAnimation={value:e.zMaxForAnimation}}function Ime(r){return r.type==="domain-plane-numbers-material"?(r.canvas.hasAttribute("dcg-material-manager-id")||r.canvas.setAttribute("dcg-material-manager-id",Math.random()+""),JSON.stringify({...r,canvas:r.canvas.getAttribute("dcg-material-manager-id")})):JSON.stringify(r)}function EQ(r){return"dcgMaterialCacheKey"in r}function kQ(r,e,t){var N,z,A;let o=__dcg_shared_module_exports__['wc'](Math.floor(8+30*e),8,20),{xmin:i,xmax:n,ymin:a,ymax:s,zmin:l,zmax:c}=t,d=(n-i)/2,p=(s-a)/2,u=(c-l)/2,h=30,m={xmin:i-h*d,xmax:n+h*d,ymin:a-h*p,ymax:s+h*p,zmin:l-h*u,zmax:c+h*u};function y(U,pe,q){return m.xmin<=U&&U<=m.xmax&&m.ymin<=pe&&pe<=m.ymax&&m.zmin<=q&&q<=m.zmax}for(let U=0;U<r.length/3;U++){let pe=r[3*U+0],q=r[3*U+1],F=r[3*U+2];if(y(pe,q,F)||!X(U))continue;let ne=U===r.length/3-1||!X(U+1)?U-1:U+1;if(!X(ne))continue;let ae=r[3*ne+0]-pe,j=r[3*ne+1]-q,oe=r[3*ne+2]-F,Y=Mme(m,pe,q,F,ae,j,oe);r[3*U+0]=(N=Y==null?void 0:Y.x)!=null?N:NaN,r[3*U+1]=(z=Y==null?void 0:Y.y)!=null?z:NaN,r[3*U+2]=(A=Y==null?void 0:Y.z)!=null?A:NaN}for(let U=0;U<r.length/3-1;U++)if(X(U)&&X(U+1)){r=r.slice(3*U);break}if(!(X(0)&&X(1)))return[[],[],[]];let S=r.length/3-1,C=new Ae,v=new Ae,E=[],_=[],T=[],I=R();for(let U=0;U<=S;U++)P(U);return O(),[E,_,T];function P(U){v.x=r[3*U+0],v.y=r[3*U+1],v.z=r[3*U+2];let pe=I.normals[U],q=I.binormals[U];if(L(U))for(let F=0;F<=o;F++){let ge=F/o*Math.PI*2,ne=Math.sin(ge),ae=-Math.cos(ge);C.x=d*e*(ae*pe.x+ne*q.x),C.y=p*e*(ae*pe.y+ne*q.y),C.z=u*e*(ae*pe.z+ne*q.z),E.push(v.x+C.x,v.y+C.y,v.z+C.z),C.normalize(),_.push(C.x,C.y,C.z)}else for(let F=0;F<=o;F++)E.push(0,0,0),_.push(0,0,0)}function O(){for(let U=1;U<=S;U++)if(L(U-1)&&L(U))for(let pe=1;pe<=o;pe++){let q=(o+1)*(U-1)+(pe-1),F=(o+1)*U+(pe-1),ge=(o+1)*U+pe,ne=(o+1)*(U-1)+pe;T.push(q,F,ne,F,ge,ne)}}function W(U){return new Ae(r[3*U+0],r[3*U+1],r[3*U+2])}function X(U){return isFinite(Math.fround(r[3*U+0]))&&isFinite(Math.fround(r[3*U+1]))&&isFinite(Math.fround(r[3*U+2]))}function x(U){return isFinite(U.x)&&isFinite(U.y)&&isFinite(U.z)}function L(U){return X(U)&&x(I.normals[U])&&x(I.binormals[U])}function R(){let U=new Ae,pe=[],q=[],F=[],ge=new Ae,ne=new ur;for(let ae=0;ae<=S;ae++){let[j,oe]=ae<S?[ae+1,ae]:[ae,ae-1],Y=W(j).sub(W(oe)).normalize();x(Y)?pe[ae]=Y:ae>0&&(pe[ae]=pe[ae-1])}for(let ae=0;ae<=S;ae++)if(ae===0||!X(ae-1)){q[ae]=new Ae,F[ae]=new Ae;let j=Number.MAX_VALUE,oe=Math.abs(pe[ae].x),Y=Math.abs(pe[ae].y),fe=Math.abs(pe[ae].z);oe<=j&&(j=oe,U.set(1,0,0)),Y<=j&&(j=Y,U.set(0,1,0)),fe<=j&&U.set(0,0,1),ge.crossVectors(pe[ae],U).normalize(),q[ae].crossVectors(pe[ae],ge),F[ae].crossVectors(pe[ae],q[ae])}else{if(q[ae]=q[ae-1].clone(),F[ae]=F[ae-1].clone(),ge.crossVectors(pe[ae-1],pe[ae]),ge.length()>Number.EPSILON){ge.normalize();let oe=Math.acos(__dcg_shared_module_exports__['wc'](pe[ae-1].dot(pe[ae]),-1,1));q[ae].applyMatrix4(ne.makeRotationAxis(ge,oe))}let j=ae>0&&pe[ae-1].dot(pe[ae])>-.999999*pe[ae-1].length()*pe[ae].length()?pe[ae].clone().add(pe[ae-1]).normalize():pe[ae];F[ae].crossVectors(j,q[ae]).normalize()}return{normals:q,binormals:F}}}function Mme(r,e,t,o,i,n,a){let s,l,c,d,p,u,h=1/i,m=1/n,y=1/a;if(h>=0?(s=(r.xmin-e)*h,l=(r.xmax-e)*h):(s=(r.xmax-e)*h,l=(r.xmin-e)*h),m>=0?(c=(r.ymin-t)*m,d=(r.ymax-t)*m):(c=(r.ymax-t)*m,d=(r.ymin-t)*m),s>d||c>l||((c>s||isNaN(s))&&(s=c),(d<l||isNaN(l))&&(l=d),y>=0?(p=(r.zmin-o)*y,u=(r.zmax-o)*y):(p=(r.zmax-o)*y,u=(r.zmin-o)*y),s>u||p>l)||((p>s||s!==s)&&(s=p),(u<l||l!==l)&&(l=u),l<0))return;let w=s>=0?s:l;return{x:e+w*i,y:t+w*n,z:o+w*a}}Xa();var _Q=new Set;_Q.add("(0,0,0,0)");var kA=class{constructor(){this.pickingColorToData=new Map;this.idToPickingColor=new Map;this.testingLastHashCollisionCount=0}setPickingColorForMesh(e){let{mesh:t,branchId:o}=e;if(t instanceof Un)for(let i=0;i<t.count;i++){let n=o+":"+i,a=this._getOrCreatePickingColor({mesh:t,index:i,isPoint:e.isPoint,blocksPicking:e.blocksPicking,forceOpaque:!1,pickingId:n});t.setPickingColorAt(i,a)}else if(e.pickingColorVertexCounts){let i=[],{pickingColorVertexCounts:n}=e;for(let a=0;a<n.length;a++){let l=lB(o)+":"+a,c=this._getOrCreatePickingColor({mesh:t,index:a,isPoint:e.isPoint,blocksPicking:e.blocksPicking,forceOpaque:!1,pickingId:l});i.push(c)}t.setPickingColorArray({colors:i,repeatColorCounts:n})}else{let i=o;t.pickingColor=this._getOrCreatePickingColor({mesh:t,index:0,isPoint:e.isPoint,blocksPicking:e.blocksPicking,forceOpaque:e.forceOpaque,pickingId:i})}}_getOrCreatePickingColor(e){let t=e.pickingId,o=this.idToPickingColor.get(t);if(o){let l=o.key;return this.pickingColorToData.set(l,e),o.color}let i=Lme(e.pickingId),n,a,s=0;for(;;){let l=i+s**2,c=l>>24&255,d=l>>16&255,p=l>>8&255,u=e.forceOpaque?255:l&255;if(n=`(${c},${d},${p},${u})`,a=[c/255,d/255,p/255,u/255],!_Q.has(n)&&!this.pickingColorToData.has(n))break;if(s++,s>100){Vo(new Error(`PickingColorManager.getOrCreatePickingColor: too many collisions for id ${t}`)),n="(0,0,0,0)",a=[0,0,0,0];break}}return this.testingLastHashCollisionCount=s,this.pickingColorToData.set(n,e),this.idToPickingColor.set(t,{key:n,color:a}),a}getDataForPickingColor(e){let t=`(${e.join(",")})`;return this.pickingColorToData.get(t)}disposeColorsNotInScene(e){let t=new Set;e.traverse(o=>{if(o instanceof Un){let i=[0,0,0,0];for(let n=0;n<o.count;n++)o.getPickingColorAt(n,i),t.add(sB(i))}else if(o.pickingColorArray){let i=o.pickingColorArray.colors;if(i)for(let n of i)t.add(sB(n))}else{let i=o.pickingColor;i&&t.add(sB(i))}});for(let o of this.pickingColorToData.keys())if(!t.has(o)){let i=this.pickingColorToData.get(o);this.idToPickingColor.delete(i.pickingId),this.pickingColorToData.delete(o)}}};function sB(r){return"("+Math.round(r[0]*255)+","+Math.round(r[1]*255)+","+Math.round(r[2]*255)+","+Math.round(r[3]*255)+")"}var Ame=2166136261,Vme=16777619;function Lme(r){let e=Ame;for(let t=0;t<r.length;t++)e^=r.charCodeAt(t),e*=Vme;return e>>>0}var TQ={name:"ConcatShader",uniforms:{t0:{value:null},t1:{value:null},t2:{value:null},t3:{value:null}},defines:{},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform sampler2D t0;
		uniform sampler2D t1;
		uniform sampler2D t2;
		uniform sampler2D t3;

		uniform float opacity;
		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {
      int index = int(vUv.x * 4.0);
      float x = vUv.x * 4.0 - float(index);
      vec2 uv = vec2(x, vUv.y);
      if (index == 0) {
        gl_FragColor = texture2D( t0, uv );
      } else if (index == 1) {
        gl_FragColor = texture2D( t1, uv );
      } else if (index == 2) {
        gl_FragColor = texture2D( t2, uv );
      } else if (index == 3) {
        gl_FragColor = texture2D( t3, uv );
      }
		}`};var GQ={name:"CopyShader",uniforms:{tDiffuse:{value:null},weight:{value:1}},defines:{SRGB_COLOR_SPACE:!0},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform float weight;
		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {
			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = weight * texel;
      #ifdef SRGB_COLOR_SPACE
      gl_FragColor = LinearTosRGB( gl_FragColor );
      #endif
		}`};var{abs:cB,floor:Pme,sin:IQ,cos:MQ}=Math;function AQ(r,e,t,o){if(!R(r)||!R(e)||!isFinite(t)||r.equals(e)||t===0)return[[],[],[]];let i=e.clone().sub(r).normalize(),n=i.clone().negate(),a=new Ae,s=new Ae,l=new Ae,c=Number.MAX_VALUE,d=cB(i.x),p=cB(i.y),u=cB(i.z);d<=c&&(c=d,a.set(1,0,0)),p<=c&&(c=p,a.set(0,1,0)),u<=c&&a.set(0,0,1),l.crossVectors(i,a).normalize(),a.crossVectors(i,l),s.crossVectors(i,a);let h=new Ae,m=(o.xmax-o.xmin)/2,y=(o.ymax-o.ymin)/2,w=(o.zmax-o.zmin)/2,S=[],C=[],v=[],E=e.clone().sub(r),T=new Ae(E.x/m,E.y/y,E.z/w).length();t>T/6&&(t=T/6);let I=6*t,P=1-Math.min(1,I/T),O=r.clone().add(E.clone().multiplyScalar(P)),W=__dcg_shared_module_exports__['wc'](Pme(8+80*t),8,30);x(r,t),x(O,t),L();let X=S.length/3;S.push(r.x,r.y,r.z),C.push(n.x,n.y,n.z),x(r,t,n);for(let N=1;N<=W;N++)v.push(X,X+N,X+N+1);X=S.length/3,S.push(O.x,O.y,O.z),C.push(n.x,n.y,n.z),x(O,2*t,n);for(let N=1;N<=W;N++)v.push(X,X+N,X+N+1);X=S.length/3;for(let N=0;N<=W;N++){let z=N/W*Math.PI*2,A=IQ(z),U=-MQ(z);h.x=m*2*t*(U*a.x+A*s.x),h.y=y*2*t*(U*a.y+A*s.y),h.z=w*2*t*(U*a.z+A*s.z),S.push(O.x+h.x,O.y+h.y,O.z+h.z),S.push(e.x,e.y,e.z);let pe=1/3,q=new Ae(U*a.x+A*s.x+pe*i.x,U*a.y+A*s.y+pe*i.y,U*a.z+A*s.z+pe*i.z).normalize();C.push(q.x,q.y,q.z,q.x,q.y,q.z)}for(let N=0;N<W;N++)v.push(X+2*N,X+2*N+1,X+2*N+2);return[S,C,v];function x(N,z,A){for(let U=0;U<=W;U++){let pe=U/W*Math.PI*2,q=IQ(pe),F=-MQ(pe);h.x=m*z*(F*a.x+q*s.x),h.y=y*z*(F*a.y+q*s.y),h.z=w*z*(F*a.z+q*s.z),S.push(N.x+h.x,N.y+h.y,N.z+h.z),h.normalize(),A===void 0?C.push(h.x,h.y,h.z):C.push(A.x,A.y,A.z)}}function L(){for(let N=1;N<=W;N++){let z=N-1,A=W+N,U=W+N+1,pe=N;v.push(z,A,pe,A,U,pe)}}function R(N){return isFinite(N.x)&&isFinite(N.y)&&isFinite(N.z)}}var{abs:GA,min:_A,max:bS,sqrt:Ume,round:PQ,log10:OQ,tan:pB,atan:RQ,PI:qme}=Math,AA=50,FQ=6.75,ld=1,Av=1,yS=.002,Vv=30,xS=class{constructor(e,t){this.pickingColorManager=new kA;this.perspective=1;this.lastFrameExpressionTooComplexIDs=new Set;this.debugOnlyMeasureGPUTiming=!1;this.lastRenderInfo={peelLayers:0,triangles:0,bufferUploads:0,bufferUploadItems:0,startTimeCPU:0,durationCPU:0};this.mainCopyOutputPass=new sd(GQ);this.concatPass=new sd(TQ);this.pickingPassCacheKey="";this.pickResult={pickingReadCacheKey:""};this.worldViewCacheKeyInfo={math:[new Ae(0,0,0),new Ae(1,0,0),new Ae(0,1,0),new Ae(0,0,1)],clip:[new Ae(0,0,0),new Ae(1,0,0),new Ae(0,1,0),new Ae(0,0,1)]};this.domainObjectUpdates=0;var l,c;let{config:o}=t.getGraphSettings();this.debug=new uA({filter:(l=o.debug3dRender)!=null?l:null}),(c=o.debug3dRender)!=null&&c.includes("pick")&&(Av=5,ld=5),this.surfaces={},this.renderedTabTargets={},this.renderedTabTargetOrder=[],this.isTrackingPressedAction=!1,this.scene=new ag,this.spinningWorld=new Nn,this.world=new Nn,this.spinningWorld.add(this.world),this.scene.add(this.spinningWorld),this.controller=t,this.materialManager=new DA,this.cameraDistance=AA,this.camera=new Hm,this.axesMaterials=cQ(this.materialManager.getGlobalUniforms()),this.setBackgroundColor(t.getGraphSettings().backgroundColor3d),this.canvas=e,this.renderer=zme(this.canvas),this.mainRenderTarget=new bl(this.canvas.width,this.canvas.height,{colorSpace:hl,samples:4}),this.mainCopyOutputPass.defines.SRGB_COLOR_SPACE=!1;let i=new Sv(4210752,Math.PI);this.scene.add(i);let n=2.8,a=new $m(16777215,n);a.position.set(-1,1,1),this.scene.add(a);let s=new $m(16777215,n);s.position.set(-1,-1,0),this.scene.add(s),this.controller.getGraphSettings().config.observeAndSync("disableLighting",()=>{this.materialManager.setDisableLighting(this.controller.getGraphSettings().config.disableLighting)}),this.initDepthPeel(),this.updateDomainObjects(),this.initPickingTargets()}getNumberOfSurfaces(){return Object.keys(this.surfaces).length}showPlane(e){this.domainPlane!==void 0&&(e?this.world.add(this.domainPlane):this.world.remove(this.domainPlane))}showBox(e){e?this.world.add(this.domainBox):this.world.remove(this.domainBox);for(let t in this.surfaces)this.deleteSurface(t)}showAxes(e){e?this.world.add(this.domainAxes):this.world.remove(this.domainAxes)}updateCamera(){let e=this.canvas.width/this.canvas.height,t=this.controller.getPerspectiveDistortion();if(t===0&&!(this.camera instanceof rg)?this.depthPeel.camera=this.camera=new rg:t!==0&&!(this.camera instanceof Hm)&&(this.depthPeel.camera=this.camera=new Hm),this.camera instanceof Hm){let o=qme/360,i=FQ/_A(e,1);this.cameraDistance=AA/t,this.camera.position.set(-this.cameraDistance,0,0),this.camera.fov=RQ(t*pB(o*i))/o}else this.cameraDistance=50,this.camera.position.set(-this.cameraDistance,0,0),e>1?(this.camera.left=-2.95*e,this.camera.right=2.95*e,this.camera.bottom=-2.95,this.camera.top=2.95):(this.camera.left=-2.95,this.camera.right=2.95,this.camera.bottom=-2.95/e,this.camera.top=2.95/e);this.camera.up.set(0,0,1),this.camera.lookAt(new Ae(0,0,0)),this.camera.updateProjectionMatrix(),this.perspective=t}initDepthPeel(){this.depthPeel=new EA(this.controller,this.renderer,this.materialManager,this.scene,this.camera,this.debug)}initPickingTargets(){let e=ld,t=Av;this.pickingTargets={id:new bl(e,t,{type:ns}),x:new bl(e,t,{type:ns}),y:new bl(e,t,{type:ns}),z:new bl(e,t,{type:ns}),combined:new bl(e*4,t,{type:ns})}}debugOnlyTrackBufferUploads(){let e=this;js.prototype.onUploadCallback=function(){e.lastRenderInfo.bufferUploads++,e.lastRenderInfo.bufferUploadItems+=this.array.length}}debugGetPrograms(){return this.renderer.info.programs||[]}getClipAxes(e){return this.controller.getGraphSettings().showBox3D?{x:!0,y:!0,z:!0}:e!=null?e:{x:!1,y:!1,z:!1}}setBackgroundColor(e){this.backgroundColor=new zt(e),this.updateBackgroundColor()}updateBackgroundColor(){if(this.controller.invertSwatches()){let{r:e,g:t,b:o}=this.backgroundColor;this.scene.background=new zt,this.scene.background.setRGB(1-e,1-t,1-o)}else this.scene.background=this.backgroundColor}domain(){var t,o;let e=this.controller.getGrapher3d();if(e){let i=e.viewportController.getViewport(),n=i.xmin,a=i.xmax,s=i.ymin,l=i.ymax,c=(t=i.zmin)!=null?t:-2,d=(o=i.zmax)!=null?o:2;return{xmin:n,xmax:a,ymin:s,ymax:l,zmin:c,zmax:d}}else return new __dcg_shared_module_exports__['ee']}updateAxes(){this.domainAxes!==void 0&&(this.world.remove(this.domainAxes),iB(this.domainAxes)),this.domainAxes=hQ(this.domain(),this.controller.get2dProjection().screen,this.controller.getGraphSettings().showAxisLabels3D,this.axesMaterials),this.controller.getGraphSettings().showAxis3D&&this.world.add(this.domainAxes)}updateBox(){let e=this.domain();this.domainBox?(this.updateDomainBoxColor(),dQ(this.domainBox,e)):this.domainBox=rB(e,this.getDomainBoxColor(),this.materialManager.getGlobalUniforms());let t=this.controller.getGraphSettings().showBox3D,o=this.domainBox.parent===this.world;t!==o&&(t?this.world.add(this.domainBox):this.world.remove(this.domainBox))}getDomainBoxColor(){var t;return this.controller.isGraphPaperFocused()&&!((t=this.controller.getGrapher3d())!=null&&t.isDragging)&&this.controller.getGrapher2d().poiController.keyboardAttentionManager.getKeyboardAttention()===void 0?this.controller.getInvertedColors()?16777215:0:11184810}updateDomainBoxColor(){let{showBox3D:e}=this.controller.getGraphSettings();if(!e||!this.domainBox)return;let t=this.getDomainBoxColor();t!==this.domainBoxColor&&(this.domainBoxColor=t,this.world.remove(this.domainBox),oB(this.domainBox),this.domainBox=rB(this.domain(),t,this.materialManager.getGlobalUniforms()),this.world.add(this.domainBox))}updatePlaneMap(){this.disposePlaneTextureIfResized(),this.domainPlaneMaterials!==void 0&&(this.domainPlaneMaterials.xyNumbersMaterial.uniforms.map.value.needsUpdate=!0,this.domainPlaneMaterials.zMaterial.uniforms.map.value.needsUpdate=!0)}disposePlaneTextureIfResized(){let e=this.controller.getGrapher2d().getCanvasNode();this.domainPlaneMaterials&&(e.width!==this.domainPlaneMaterials.width||e.height!==this.domainPlaneMaterials.height)&&(nB(this.domainPlaneMaterials.xyNumbersMaterial),nB(this.domainPlaneMaterials.zMaterial),this.domainPlaneMaterials=void 0)}disposePlane(){this.domainPlane!==void 0&&(this.world.remove(this.domainPlane),bQ(this.domainPlane),this.domainPlane=void 0)}updatePlane(){this.disposePlaneTextureIfResized(),this.disposePlane(),this.domainPlaneMaterials=this.constructDomainMaterials(),this.domainPlaneMaterials&&(this.domainPlane=new xA(this.domain(),this.domainPlaneMaterials,this.controller.getGrapher2d().getProjection(),this.axesMaterials,this.materialManager.getGlobalUniforms()),this.domainPlane.xyPlane&&this.pickingColorManager.setPickingColorForMesh({mesh:this.domainPlane.xyPlane,isPoint:!1,blocksPicking:!0,forceOpaque:!0,branchId:"**dcg_domain_plane_picking_id**"}),(this.controller.showPlane3D()||this.controller.showNumbers3D())&&this.world.add(this.domainPlane))}constructDomainMaterials(){var p,u,h,m,y;let{showNumbers3D:e,showPlane3D:t}=this.controller.getGraphSettings(),o=this.computeDepthPeelLayers()>0;if(this.domainPlaneMaterials!==void 0&&this.domainPlaneMaterials.showPlane3D===t&&this.domainPlaneMaterials.showNumbers3D===e&&this.domainPlaneMaterials.depthPeelingActive===o)return this.domainPlaneMaterials;(u=(p=this.domainPlaneMaterials)==null?void 0:p.xyNumbersMaterial)==null||u.dispose(),(h=this.domainPlaneMaterials)==null||h.xyPlaneMaterial.dispose(),(y=(m=this.domainPlaneMaterials)==null?void 0:m.zMaterial)==null||y.dispose();let i=this.controller.getGrapher2d().getCanvasNode();if(i.width===0||i.height===0)return;let n=this.materialManager.getOrMakeMaterial({type:"domain-plane",spec:{type:"domain-plane-numbers-material",canvas:i,showNumbers:e,transparent:t&&!o}}),a=document.createElement("canvas");a.width=i.width,a.height=i.height;let s=this.materialManager.getOrMakeMaterial({type:"domain-plane",spec:{type:"domain-plane-numbers-material",canvas:a,showNumbers:e,transparent:!1}}),l=this.controller.getGraphSettings().plane3dOpacity,c=Number(l);if((l===""||isNaN(c))&&(c=.5),c=__dcg_shared_module_exports__['wc'](c,0,1),c<yS)return;let d=this.materialManager.getOrMakeMaterial({type:"domain-plane",spec:{type:"domain-plane-material",opacity:c,transparent:!o,color:new zt(16777215)}});return{zCanvas:a,zMaterial:s,xyNumbersMaterial:n,xyPlaneMaterial:d,width:i.width,height:i.height,showNumbers3D:e,showPlane3D:t,depthPeelingActive:o}}computeDepthPeelLayers(){let e=this.computeDesiredDepthPeelLayersFromGeometry(),t=_A(e,Vv);if(e===0)return 0;if(!this.getConfig().adaptivePeeling)return t;let o=this.controller.getAdaptiveDepthPeelingInfo(),i=e;if(o){let{peelLayers:n,status:a}=o;if(a===1){let s=Math.ceil(Vv/3);i=(Math.floor(n/s)+1)*s}else a===0?i=n-1:i=n}return __dcg_shared_module_exports__['wc'](i,1,t)}getConfig(){return this.controller.getGraphSettings().config}computeDesiredDepthPeelLayersFromGeometry(){let{debugPeelLayers:e}=this.getConfig();if(e!==void 0)return e;let t=1,o=0;for(let n in this.surfaces){let a=this.surfaces[n];if(a.isTransparent){let s=__dcg_shared_module_exports__['wc'](a.mesh.material.opacity,0,1);if(s<yS)continue;s<t&&(t=s),a.shape==="plane"?o+=1:a.shape==="sphere"?o+=2:o+=PQ(-2/OQ(1-s))}}if(t===1)return 0;let i=_A(o,PQ(-2/OQ(1-t)));return this.controller.showPlane3D()&&(i+=1),bS(1,i)}updateDomainObjects(){this.domainObjectUpdates++,this.updateAxes(),this.updateBox(),this.updatePlane();let e=this.domain(),{xmin:t,xmax:o,ymin:i,ymax:n,zmin:a,zmax:s}=e;this.spinningWorld.scale.set(4/(o-t),4/(n-i),4/(s-a)),this.world.position.set(-(o+t)/2,-(n+i)/2,-(s+a)/2),this.materialManager.setDomain(e,this.controller.getGrapher2d().getProjection()),this.updateDomainObjectsFromCamera()}getZBoundsForAnimationForNewSurface(e){var s;let t=(s=this.controller.getGrapher3d())==null?void 0:s.transition,o=t==null?void 0:t.objectIdExtendingTo3D,{zmin:i,zmax:n}=this.domain(),a=window.performance.now();if(o&&e.startsWith(o+":")){t.startTime<0&&(t.startTime=a);let l=(a-t.startTime)/t.duration;return l>=1?Zm:{zMinForAnimation:l*i,zMaxForAnimation:l*n}}return Zm}setZboundsOnSurfaces(e,t,o){for(let i in this.surfaces)if(i.startsWith(e+":")){let a=this.surfaces[i].mesh.material;this.materialManager.setZBoundsUniform(a,{zMinForAnimation:t,zMaxForAnimation:o})}}deleteSurface(e){let t=this.surfaces[e];if(!t)return;this.world.remove(t.mesh);let o=t.mesh.geometry;Hme(o)||o.dispose(),delete this.surfaces[e]}getColorShader(e){if(e.startsWith("shader:"))return this.controller.getShader(e.slice(7))}renderPoint3D(e,t,o){let{position:i,radius:n,guid:a}=e;if(n<=0||!isFinite(n))return;let s=this.domain(),{xmin:l,xmax:c,ymin:d,ymax:p,zmin:u,zmax:h}=s,m=this.makeCacheKey(a,s);this.surfaces[t]&&(this.surfaces[t].cacheKey!==m||this.surfaces[t].materialColor!=o)&&this.deleteSurface(t);let[y,w,S]=i,C=n*(c-l)/4,v=n*(p-d)/4,E=n*(h-u)/4;if(!this.surfaces[t]){let _=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:t,color:o,opacity:1,colorShader:this.getColorShader(o)},uniforms:{domain:s,clip:this.getClipAxes(),zBoundsForAnimation:Zm}}),T=TA(n),I=new Bn(T,_);I.dcgModelMatrix=new ur().makeTranslation(y,w,S).multiply(new ur().makeScale(C,v,E)),this.surfaces[t]={mesh:I,cacheKey:m,isNotInSketchOrder:!1,materialColor:o,isTransparent:!1,isPoint:!0},this.world.add(I)}this.surfaces[t].isNotInSketchOrder=!1}makeCacheKey(e,t){return e+":"+JSON.stringify(t)}renderPointList3D(e,t){let o=this.domain(),{xmin:i,xmax:n,ymin:a,ymax:s,zmin:l,zmax:c}=o,{pressedId:d}=this.pressedActionData(),p=this.highlightedIndex(e),u=t.map(m=>m.color+"_"+m.guid).join(":")+`:${p}:${e===d}`,h=this.makeCacheKey(u,o);if(this.surfaces[e]&&this.surfaces[e].cacheKey!==h&&this.deleteSurface(e),!this.surfaces[e]){let m="",y=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:e,color:m,opacity:1,colorShader:this.getColorShader(m)},uniforms:{domain:o,clip:this.getClipAxes(),zBoundsForAnimation:Zm}}),w=t[0];if(w.graphMode!==114)return;let S=TA(w.radius),C=new Un(S,y,t.length);for(let v=0;v<t.length;v++){let E=t[v];if(E.graphMode!==114)return;let[_,T,I]=E.position,P=E.radius,O=this.needsHighlighting(e,v)?ty(E.color,this.highlightAmount(e,v)):E.color,W=P*(n-i)/4,X=P*(s-a)/4,x=P*(c-l)/4;if(P<=0||!isFinite(P)||TA(P)!==S)return;let R=new ur().makeTranslation(_,T,I).multiply(new ur().makeScale(W,X,x));C.setMatrixAt(v,R),C.setColorAt(v,new zt(O))}this.surfaces[e]={mesh:C,cacheKey:h,isNotInSketchOrder:!1,materialColor:m,isTransparent:!1,isPoint:!0},this.world.add(C)}return this.surfaces[e].isNotInSketchOrder=!1,this.surfaces[e]}renderSphere3D(e,t,o){var W,X;let{position:i,radius:n,restrictionShader:a,guid:s}=e,l=e.surfaceOpacity;if(!this.getConfig().beta3d&&!this.controller.getTranslucentSurfaces()&&(l=1),l<yS)return;let c=((W=this.getColorShader(o))==null?void 0:W.source)||"";this.surfaces[t]&&(this.surfaces[t].cacheKey!==s||this.surfaces[t].materialColor!=o||c!=((X=this.surfaces[t].shader)!=null?X:""))&&this.deleteSurface(t);let[d,p,u]=i,[h,m,y]=[GA(n[0]),GA(n[1]),GA(n[2])],{xmin:w,xmax:S,ymin:C,ymax:v,zmin:E,zmax:_}=this.domain(),[T,I,P]=[S-w,v-C,_-E],O=2*bS(h/T,m/I,y/P);if(!this.surfaces[t]){let x=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:t,color:o,opacity:l,colorShader:this.getColorShader(o),restrictionShader:a},uniforms:{domain:this.domain(),clip:this.getClipAxes(),zBoundsForAnimation:Zm}}),L=TA(O),R=new Bn(L,x);R.dcgModelMatrix=new ur().makeTranslation(d,p,u).multiply(new ur().makeScale(h,m,y)),this.surfaces[t]={mesh:R,material:x,cacheKey:s,isNotInSketchOrder:!1,materialColor:o,isTransparent:l<1,shape:"sphere",shader:c},this.world.add(R)}this.surfaces[t].isNotInSketchOrder=!1}renderCurve3D(e,t,o){var u,h;let{points:i,thickness:n,guid:a}=e,s=uB(e.graphMode);if(n<0||!isFinite(n))return;let l=this.domain(),c=a+":"+JSON.stringify(n)+":"+JSON.stringify(l),d=this.surfaces[t],p=((u=this.getColorShader(o))==null?void 0:u.source)||"";if(d&&(d.cacheKey!==c||d.materialColor!=o||p!=((h=d.shader)!=null?h:""))&&this.deleteSurface(t),!(i===void 0||i.length===0||n===0)){if(!this.surfaces[t]){let m=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:t,color:o,opacity:1,colorShader:this.getColorShader(o)},uniforms:{domain:l,clip:this.getClipAxes(s),zBoundsForAnimation:Zm}}),y=.01*n,[w,S,C]=kQ(i,y,l),v=IA(new Float32Array(w),new Float32Array(S),new Uint32Array(C)),E=new Bn(v,m);this.surfaces[t]={mesh:E,cacheKey:c,isNotInSketchOrder:!1,isTransparent:!1,materialColor:o},this.world.add(E)}this.surfaces[t].isNotInSketchOrder=!1}}renderVector3D(e,t,o,i){var T,I;let n=this.isClickable(t),a=t===this.pressedActionData().pressedId,s=this.highlightedIndex(t),l=t+`:${o}`,{points:c,thickness:d,guid:p}=e,u=uB(e.graphMode),h=this.domain(),m=JSON.stringify(h),y=`${p}:${m}:${d}:${s}:${a}`,w=this.surfaces[l],S=((T=this.getColorShader(i))==null?void 0:T.source)||"";if(w&&(w.cacheKey!==y||w.materialColor!=i||S!=((I=w.shader)!=null?I:""))&&this.deleteSurface(l),c===void 0||c.length<6||c.length%6!=0)return;this.needsHighlighting(t,o)&&c.length===6&&(i=ty(i,this.highlightAmount(t,o)));let C=s!==void 0&&c.length>6,v=ty(i,this.highlightAmount(t,s)),E=__dcg_shared_module_exports__['Yd'](i),_=__dcg_shared_module_exports__['Yd'](v);if(!this.surfaces[l]){let P=c.length>6&&n,O=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:l,color:i,opacity:1,colorShader:this.getColorShader(i),vertexColors:C,useVertexPickingColors:P},uniforms:{domain:h,clip:this.getClipAxes(u),zBoundsForAnimation:Zm}}),W=P?[]:void 0,X=.01*d,x=[],L=[],R=[],N=[];for(let U=0;U<c.length;U+=6){let pe=new Ae(c[U],c[U+1],c[U+2]),q=new Ae(c[U+3],c[U+4],c[U+5]),[F,ge,ne]=AQ(pe,q,X,h),ae=x.length/3;if(x.push(...F),L.push(...ge),R.push(...ne.map(j=>j+ae)),W==null||W.push(F.length/3),C){let j=U/6===s?_:E;for(let oe=0;oe<F.length/3;oe++)N.push(j[0],j[1],j[2])}}let z=IA(new Float32Array(x),new Float32Array(L),new Uint32Array(R));C&&z.setAttribute("color",new js(new Float32Array(N),3));let A=new Bn(z,O);this.surfaces[l]={mesh:A,cacheKey:y,isNotInSketchOrder:!1,isTransparent:!1,materialColor:i,pickingColorVertexCounts:W},this.world.add(A)}this.surfaces[l].isNotInSketchOrder=!1}renderTriangle3D(e,t,o,i){if(e.surfaceOpacity<yS)return;let n=this.isClickable(t),a=t+`:${o}`,s=t===this.pressedActionData().pressedId,l=this.highlightedIndex(t),c=`:${l}:${s}`,d=e.meshData.faces.length/3,{meshData:p}=e,u=ty(i,this.highlightAmount(t,l)),h=__dcg_shared_module_exports__['Yd'](i),m=__dcg_shared_module_exports__['Yd'](u),y=[],w=d>1&&n;if(this.needsHighlighting(t,o)&&d===1&&(i=ty(i,this.highlightAmount(t,o))),l!==void 0&&d>1)if(p.colors&&l!=null){let v=p.colors,E=new Float32Array(v),_=9*l,T=255*__dcg_shared_module_exports__['Xd'](v[_]),I=255*__dcg_shared_module_exports__['Xd'](v[_+1]),P=255*__dcg_shared_module_exports__['Xd'](v[_+2]),O=__dcg_shared_module_exports__['Td'](T,I,P),W=ty(O,this.highlightAmount(t,o)),X=__dcg_shared_module_exports__['Yd'](W);E.set([...X,...X,...X],_),e={...e,meshData:{...e.meshData,colors:E}}}else{for(let E=0;E<p.faces.length;E+=3){let _=E/3===l?m:h;y.push(_[0],_[1],_[2],_[0],_[1],_[2],_[0],_[1],_[2])}let v=new Float32Array(y);e={...e,meshData:{...e.meshData,colors:v}}}let C=this.renderSurface(e,a,i,w,c);if(w){let v=[];for(let E=0;E<d;E++)v.push(3);C&&(C.pickingColorVertexCounts=v)}}renderSurface(e,t,o,i=!1,n=""){var y,w,S;this.getConfig().wireframe&&(o="wireframe:"+o);let{meshData:a,surfaceOpacity:s}=e;if(!this.getConfig().beta3d&&!this.controller.getTranslucentSurfaces()&&(s=1),s<yS)return;let{uvArgs:l,restrictionShader:c}=e,d=(y=e.extraMeshArgs)!=null?y:[],p=uB(e.graphMode),u=((w=this.getColorShader(o))==null?void 0:w.source)||"",h=this.domain(),m=a.guid+n;if(this.surfaces[t]&&(this.surfaces[t].cacheKey!==m||this.surfaces[t].materialColor!=o||u!=((S=this.surfaces[t].shader)!=null?S:"")||a.isDomainCube&&!Kme(h,this.surfaces[t].domain))&&this.deleteSurface(t),!this.surfaces[t]){let C=this.materialManager.getOrMakeMaterial({type:"surface-graph",spec:{type:"surface-material",objectId:t,color:o,opacity:s,colorShader:this.getColorShader(o),vertexColors:!!a.colors,useVertexPickingColors:i,restrictionShader:c,uvArgs:l,extraMeshArgs:d},uniforms:{domain:h,clip:this.getClipAxes(p),zBoundsForAnimation:a.isDomainCube?Zm:this.getZBoundsForAnimationForNewSurface(t)}});if(a.isDomainCube){let _=h,I=this.controller.getGrapher3d().transition;if(I.objectIdExtendingTo3D&&I.startTime>0){let P=I.objectIdExtendingTo3D;if(P&&t.startsWith(P+":")){let O=this.domain(),{zmin:W,zmax:X}=O,L=(window.performance.now()-I.startTime)/I.duration;L<1&&(_.zmin=L*W,_.zmax=L*X)}}a.positions=__dcg_shared_module_exports__['ce'](_).positions}let v=IA(a.positions,a.normals,a.faces);v.setAttribute("uv",new qi(a.uvs,2)),d.length>0&&v.setAttribute("extras",new qi(a.extraAttrs,d.length)),a.colors&&v.setAttribute("color",new js(a.colors,3));let E=new Bn(v,C);this.surfaces[t]={mesh:E,material:C,cacheKey:m,isNotInSketchOrder:!1,materialColor:o,shader:u,isTransparent:s<1,shape:Wme(a,h)?"plane":void 0,domain:h},this.world.add(E)}return this.surfaces[t].isNotInSketchOrder=!1,this.surfaces[t]}projectMathCoordinates(e,t=new Ae){return t.copy(e).applyMatrix4(this.world.matrixWorld).project(this.camera)}finalizeSurface(e){let{branchId:t,surface:o,renderOrder:i,isSurfaceSelected:n}=e;this.pickingColorManager.setPickingColorForMesh({branchId:t,mesh:o.mesh,isPoint:!!o.isPoint,blocksPicking:!1,forceOpaque:!1,pickingColorVertexCounts:o.pickingColorVertexCounts});let a=o==null?void 0:o.mesh.material;o&&a instanceof Qm&&(o.mesh.renderOrder=i,a.setEmissiveIntensity(n?.015:0))}needsHighlighting(e,t){if(!this.isClickable(e))return!1;let{keyboardFocusId:o,keyboardFocusIndex:i}=this.getKeyboardFocus(),{pressedId:n,pressedIndex:a}=this.pressedActionData(),s=this.getPickResult(),l=s==null?void 0:s.id,c=s==null?void 0:s.index;return e===l&&t===c||e===o&&t===i||e===n&&t===a}highlightedIndex(e){if(!this.isClickable(e))return;let{keyboardFocusId:t,keyboardFocusIndex:o}=this.getKeyboardFocus(),{pressedId:i,pressedIndex:n}=this.pressedActionData(),a=this.getPickResult(),s=a==null?void 0:a.id,l=a==null?void 0:a.index;if(e===s)return l;if(e===t)return o;if(e===i)return n}highlightAmount(e,t){let{pressedId:o,pressedIndex:i}=this.pressedActionData();return e===o&&t===i?.16:.24}redraw(e,t){var x,L,R;(x=this.debug)==null||x.removeUnused();let o=this.controller.getGrapher3d();if(o===void 0)return;this.renderedTabTargets={},this.renderedTabTargetOrder=[];let i=this.canvas,n=performance.now(),a=this.lastRenderInfo={peelLayers:0,bufferUploadItems:0,bufferUploads:0,triangles:0,startTimeCPU:n,durationCPU:0},s=this.renderer;s.setRenderTarget(this.mainRenderTarget),this.updateBackgroundColor(),this.updateDomainObjectsFromCamera(),this.updateCamera();let l=window.devicePixelRatio||1;l!==s.getPixelRatio()&&(s.setPixelRatio(l),o.controls.updateViewport(o.viewportController.getViewport())),this.camera.setViewOffset(i.width/l,i.height/l,0,0,i.width/l,i.height/l),s.setSize(i.width/l,i.height/l);for(let N in this.surfaces)this.surfaces[N].isNotInSketchOrder=!0;let c=this.getPickResult();this.isClickable(c==null?void 0:c.id)?o.setLayerClass("clickableObjects","dcg-mouse-over-clickable-object"):o.setLayerClass("clickableObjects",void 0);let d=0;for(let N of zC(t)){let z=e[N];if(!z||!z.branches)continue;let A=this.controller.isItemSelected(N),U=this.controller.getItemModel(N),pe=this.isClickable(N);if((U==null?void 0:U.type)==="expression"&&(hb(U)||um(U))){let q=this.renderPointList3D(N,z.branches);if(q){if(d+=1,this.finalizeSurface({branchId:N,surface:q,renderOrder:d,isSurfaceSelected:A}),pe)for(let F=0;F<z.branches.length;F++)this.addTabTarget(U,F);continue}}for(let q in z.branches){d+=1;let F=z.branches[q],ge=N+":"+q,ne=F.color,ae=parseInt(q);this.needsHighlighting(N,ae)&&(ne=ty(ne,this.highlightAmount(N,ae))),F.graphMode===130||F.graphMode===103||F.graphMode===106||F.graphMode===107||F.graphMode===108||F.graphMode===109||F.graphMode===110||F.graphMode===111||F.graphMode===112||F.graphMode===113||F.graphMode===210?this.renderSurface(F,ge,ne):F.graphMode===100||F.graphMode===119||F.graphMode===128?this.renderCurve3D(F,ge,ne):F.graphMode===114?this.renderPoint3D(F,ge,ne):F.graphMode===118?this.renderSphere3D(F,ge,ne):F.graphMode===117?this.renderTriangle3D(F,N,ae,F.color):F.graphMode===129&&this.renderVector3D(F,N,ae,F.color);let j=this.surfaces[ge];if(j&&(this.finalizeSurface({branchId:ge,surface:j,renderOrder:d,isSurfaceSelected:A}),pe))if(F.graphMode===117){let oe=F.meshData.faces.length/3;for(let Y=0;Y<oe;Y++)this.addTabTarget(U,Y)}else if(F.graphMode===129&&ae===0){let oe=F.points.length/6;for(let Y=0;Y<oe;Y++)this.addTabTarget(U,Y)}else this.addTabTarget(U,ae)}}let p=2.0001*Ume(3),{xmin:u,xmax:h,ymin:m,ymax:y,zmin:w,zmax:S}=this.domain(),C=new Ae((h+u)/2,(y+m)/2,(S+w)/2),v=4/bS(h-u,y-m,S-w);for(let N in this.surfaces)if(this.surfaces[N].isNotInSketchOrder)this.deleteSurface(N);else if(!this.controller.getGraphSettings().showBox3D){let z=this.surfaces[N].mesh.geometry;z.boundingSphere===null&&z.computeBoundingSphere();let A=z.boundingSphere;if(A===null)continue;let pe=(new Ae().subVectors(C,A.center).length()+A.radius)*v;p=bS(p,pe)}let E=this.computeDepthPeelLayers();E>0!==((L=this.domainPlaneMaterials)==null?void 0:L.depthPeelingActive)&&this.updateDomainObjects();let T=this.controller.getPerspectiveDistortion(),I=1e3/(0<T&&T<1?T:1),P=bS(.001,this.cameraDistance-p),O=_A(I,this.cameraDistance+p);this.camera.near=P,this.camera.far=O,this.camera.updateProjectionMatrix(),this.materialManager.setGlobalUniform("dcgRenderMode",jl.Default),this.mainRenderTarget.setSize(i.width,i.height),this.renderer.setRenderTarget(this.mainRenderTarget),this.materialManager.setScreenSize(i.width,i.height),a.peelLayers=E,E>0?(this.depthPeel.render(E),a.triangles=this.depthPeel.triangles):(s.render(this.scene,this.camera),a.triangles=this.renderer.info.render.triangles),E==0&&this.mainCopyOutputPass.render(s,null,this.mainRenderTarget),this.debugOnlyMeasureGPUTiming&&YJ(this.renderer).then(N=>{a.endTimeGPU=N}),a.durationCPU=performance.now()-n,this.materialManager.disposeMaterialsNotInScene(this.scene),this.pickingColorManager.disposeColorsNotInScene(this.scene);let W=new Set;for(let N in this.surfaces)(R=this.surfaces[N].material)!=null&&R.exprTooComplex&&W.add(lB(N));let X=[];for(let N of this.lastFrameExpressionTooComplexIDs)W.has(N)||X.push(N);(W.size>0||X.length>0)&&this.controller.dispatch({type:"mark-too-complex-for-gl",errors:W,fixed:X}),this.lastFrameExpressionTooComplexIDs=W,this.onRenderSpy&&this.onRenderSpy()}updateDomainObjectsFromCamera(){let e=this.controller.getGrapher3d();e&&mQ({axes:this.domainAxes,plane:this.domainPlane,domain:this.domain(),screen:this.controller.get2dProjection().screen,controls:e.controls,invertedColors:this.controller.getInvertedColors(),isDepthPeelingActive:this.computeDepthPeelLayers()>0})}pickAtMouseAndReadResults(){this.pickingPass(),this.readPickingOutputFromGPU()}getAllSurfaceGeoemtriesCacheKey(){let e="";for(let t in this.surfaces){let o=this.surfaces[t];e+=o.cacheKey}return e+="|domainUpdates:"+this.domainObjectUpdates,e}getPickingCacheKey(){var e,t;return`world:${this.getWorldViewCacheKey()}:mouse:${(e=this.mouse)==null?void 0:e.x},${(t=this.mouse)==null?void 0:t.y}:surfaces:${this.getAllSurfaceGeoemtriesCacheKey()}`}pickingPass(){if(this.controller.getGrapher3d()===void 0)return;let t=this.mouse;if(!t)return;let o=this.pickingPassCacheKey,i=this.getPickingCacheKey();if(o===i)return;this.pickingPassCacheKey=i;let n=this.scene.background,a=this.renderer.getClearColor(new zt),s=new Map;this.world.children.forEach(h=>{var m;if(s.set(h,h.visible),h instanceof Bn){let y=h.material;h.visible=!!((m=y.defines)!=null&&m.DCG_SUPPORTS_PICKING)}else h.visible=!1}),this.domainPlane&&s.get(this.domainPlane)&&(this.domainPlane.visible=!0,this.domainPlane.children.forEach(h=>{s.set(h,h.visible),h.visible=h.name==="xy plane"}));let l=window.devicePixelRatio,c=Math.floor(ld/2),d=Math.floor(Av/2),[p,u]=[Math.floor(t.x*l)-c,Math.floor(t.y*l)-d];this.camera.setViewOffset(this.renderer.domElement.width,this.renderer.domElement.height,p,u,ld,Av),this.renderer.setClearColor(new zt(0),0),this.scene.background=null,this.materialManager.setGlobalUniform("dcgRenderMode",jl.PickingObjectId),this.renderer.setRenderTarget(this.pickingTargets.id),this.renderer.clearColor(),this.renderer.render(this.scene,this.camera),this.materialManager.setGlobalUniform("dcgRenderMode",jl.PickingX),this.renderer.setRenderTarget(this.pickingTargets.x),this.renderer.clearColor(),this.renderer.render(this.scene,this.camera),this.materialManager.setGlobalUniform("dcgRenderMode",jl.PickingY),this.renderer.setRenderTarget(this.pickingTargets.y),this.renderer.clearColor(),this.renderer.render(this.scene,this.camera),this.materialManager.setGlobalUniform("dcgRenderMode",jl.PickingZ),this.renderer.setRenderTarget(this.pickingTargets.z),this.renderer.clearColor(),this.renderer.render(this.scene,this.camera),this.concatPass.uniforms.t0={value:this.pickingTargets.id.texture},this.concatPass.uniforms.t1={value:this.pickingTargets.x.texture},this.concatPass.uniforms.t2={value:this.pickingTargets.y.texture},this.concatPass.uniforms.t3={value:this.pickingTargets.z.texture},this.camera.clearViewOffset(),this.renderer.setClearColor(a),this.scene.background=n,s.forEach((h,m)=>{m.visible=h}),this.concatPass.render(this.renderer,this.pickingTargets.combined,this.pickingTargets.combined)}readPickingOutputFromGPU(){var C,v,E;let e=this.getPickingCacheKey();if(this.pickResult.pickingReadCacheKey===e)return;let t=Math.floor(ld/2),o=Math.floor(Av/2),i=dA(this.renderer,this.pickingTargets.combined,0,0,ld*4,Av),n=mS(i,ld*4,t,o),a=mS(i,ld*4,ld+t,o),s=mS(i,ld*4,2*ld+t,o),l=mS(i,ld*4,3*ld+t,o),c=pA(a),d=pA(s),p=pA(l);if((C=this.debug.get("pick-combined"))==null||C.renderFromTarget(this.renderer,this.pickingTargets.combined,10),n.every(_=>_===0)){this.pickResult={pickingReadCacheKey:e};return}let u=this.pickingColorManager.getDataForPickingColor(n);if(!u){Vo(`Failed to find id for picking color ${n}`),this.pickResult={pickingReadCacheKey:e};return}if(u.blocksPicking){this.pickResult={pickingReadCacheKey:e};return}let h=(E=(v=this.pickResult.result)==null?void 0:v.point)!=null?E:new Ae;if(h.set(c,d,p),u.isPoint){let _=u.mesh,T;_ instanceof Un?(T=new ur,_.getMatrixAt(u.index,T)):T=u.mesh.dcgModelMatrix,h=new Ae(0,0,0).applyMatrix4(T)}let m=u.pickingId.split(":"),y=m.length,w=m[0],S=y>1?parseInt(m[y-1]):-1;this.pickResult={pickingReadCacheKey:e,result:{point:h,id:w,index:S}}}isClickable(e){if(e===void 0)return!1;let t=this.controller.getItemModel(e);return!!uw(t)}getPickResult(){return this.pickResult.result}getKeyboardFocus(){let e=this.controller.getGrapher2d().poiController.keyboardAttentionManager.getKeyboardAttention(),t=e==null?void 0:e.calcId,o=e==null?void 0:e.listIndex;return{keyboardFocusId:t,keyboardFocusIndex:o}}pressedActionData(){var o,i;let e=(o=this.pressedAction)==null?void 0:o.id,t=(i=this.pressedAction)==null?void 0:i.index;return{pressedId:e,pressedIndex:t}}getZoomScrollWheelPickResult(){if(this.controller.getGrapher3d().controls.speed3D===0)return this.getPickResult()}getMouse(){return this.mouse}setMouse(e){this.mouse=e}getWorldViewCacheKey(){let{math:e,clip:t}=this.worldViewCacheKeyInfo,o="";for(let i=0;i<e.length;i++)this.projectMathCoordinates(e[i],t[i]),o+=`:${t[i].x},${t[i].y}`;return o}baseplaneMultiplier(){let e=FQ*(Math.PI/360),t=this.camera instanceof Hm?RQ(this.perspective*pB(e)):e;return 2/(pB(t)*-this.camera.position.x)}mathCoordinatesToBufferCoordinates(e){let t=new Ae(e.x,e.y,e.z).applyMatrix4(this.world.matrixWorld).project(this.camera),o=this.canvas,i=o.width/2,n=o.height/2,a=Math.round(t.x*i+i),s=Math.round(t.y*n+n);return{x:a,y:s}}mathCoordinatesToScreenCoordinates(e,t){let o=new Ae(e.x,e.y,e.z).applyMatrix4(this.world.matrixWorld).project(this.camera),i=this.canvas,n=window.devicePixelRatio,a=i.width/n/2,s=i.height/n/2,l=o.x*a+a,c=-o.y*s+s;return(!t||!t.skipRounding)&&(l=Math.round(l),c=Math.round(c)),{x:l,y:c}}_testingGetMeshById(e){let t=this.surfaces[e];return t?t.mesh:void 0}remove(){this.materialManager.disposeAllMaterials(),this.pickingColorManager.disposeColorsNotInScene(new ag),this.domainBox&&oB(this.domainBox),this.domainAxes&&(iB(this.domainAxes),gQ(this.axesMaterials)),this.renderer.dispose(),this.renderer.forceContextLoss()}addTabTarget(e,t){let o=E3(e.id,t);this.renderedTabTargetOrder.indexOf(o)!==-1||this.renderedTabTargets[o]!==void 0||(this.renderedTabTargetOrder.push(o),this.renderedTabTargets[o]={type:e.type,id:e.id,listIndex:t,description:this.getComputedDescription(e,t)})}getOrderedTabTargets(){return this.renderedTabTargetOrder.map(e=>{let t=this.renderedTabTargets[e];return{calcId:t.id,listIndex:t.listIndex,polygonEdge:void 0,description:t.description}})}setPressedAction(e){this.pressedAction=e,e!==void 0&&(this.isTrackingPressedAction=!0);let t=this.controller.getGrapher3d();t&&(t.controls.state=sg.NONE,t.redrawAllLayers())}getPressedAction(){return this.pressedAction}getComputedDescription(e,t){let o=e.formula&&e.formula.computed_description&&e.formula.computed_description[t];return o&&o!==""?rn(o):this.getDescription(e)}getDescription(e){switch(e.formula.expression_type){case"SURFACE":case"SURFACE_AMBIGUOUS":case"SURFACE_CONSTANT_AMBIGUOUS":case"SURFACE_r_\u03B8z":case"SURFACE_r_\u03B8z_AMBIGUOUS":case"SURFACE_z_r\u03B8":case"SURFACE_r_\u03B8\u03C6":case"SURFACE_xyz_uv":case"IMPLICIT_SURFACE":case"IMPLICIT_SURFACE_AMBIGUOUS":return this.controller.raw("surface");case"CURVE3D_xyz_t":case"SLICE":case"SLICE_r\u03B8z_at_z":case"SLICE_zr\u03B8_at_r":case"SLICE_zr\u03B8_at_\u03B8":case"SLICE_zr\u03B8_at_xyz":case"SLICE_r\u03B8\u03C6_at_\u03B8":case"SLICE_r\u03B8\u03C6_at_\u03C6":case"SLICE_r\u03B8\u03C6_at_xyz":case"SLICE_xyz_uv":return this.controller.raw("curve");case"SEGMENT3D":return this.controller.raw("segment");case"VECTOR3D":return this.controller.raw("vector");case"SPHERE3D":return this.controller.raw("sphere");case"POINT3D":case"POINT3D_LIST":return this.controller.raw("point");case"TRIANGLE3D":return this.controller.raw("triangle")}return this.controller.raw("3d object")}};function zme(r){let e=new kv({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,canvas:r});return e.setPixelRatio(window.devicePixelRatio||1),e}function uB(r){switch(r){case 106:return{x:!0,y:!0,z:!1};case 107:return{x:!1,y:!0,z:!0};case 108:return{x:!0,y:!1,z:!0};case 110:return{x:!1,y:!1,z:!0};case 112:case 113:case 210:case 128:return{x:!0,y:!0,z:!0};default:return{x:!1,y:!1,z:!1}}}var Zm={zMinForAnimation:-1/0,zMaxForAnimation:1/0};function IA(r,e,t){let o=new gl;return o.setIndex(r.length<65536?new Um(t,1):new qm(t,1)),o.setAttribute("position",new qi(r,3)),o.setAttribute("normal",new qi(e,3)),o}var MA=[];function TA(r){let e=r<.02?1:r<.05?2:r<.2?3:r<.8?4:5;if(MA[e]===void 0){let t=$J(e);MA[e]=IA(t.vertices,t.vertices,t.indices)}return MA[e]}function Hme(r){return MA.includes(r)}function Kme(r,e){return e!==void 0&&r.xmin===e.xmin&&r.xmax===e.xmax&&r.ymin===e.ymin&&r.ymax===e.ymax&&r.zmin===e.zmin&&r.zmax===e.zmax}function ty(r,e){return __dcg_shared_module_exports__['de'](r)?r:__dcg_shared_module_exports__['Sd'](r,e)}function Wme(r,e){let t=r.faces.length/3,o=r.positions.length/3,{xmin:i,xmax:n,ymin:a,ymax:s,zmin:l,zmax:c}=e,d=h=>(h-i)/(n-i),p=h=>(h-a)/(s-a),u=h=>(h-l)/(c-l);if(t===1)return!0;if(t===2&&o===4){let h=r.positions,m=new Ae(d(h[0]),p(h[1]),u(h[2])),y=new Ae(d(h[3]),p(h[4]),u(h[5])),w=new Ae(d(h[6]),p(h[7]),u(h[8])),S=new Ae(d(h[9]),p(h[10]),u(h[11])),C=new Ae().subVectors(y,m),v=new Ae().subVectors(w,m),E=new Ae().subVectors(S,m),_=C.cross(v);return GA(_.dot(E)/(_.length()*E.length()))<.01}return!1}function lB(r){return r.split(":")[0]}var $me=1e3;function jme(){return new rd(1024,768)}function $Q(){return new Co(__dcg_shared_module_exports__['ub'].xmin,__dcg_shared_module_exports__['ub'].xmax,__dcg_shared_module_exports__['ub'].ymin,__dcg_shared_module_exports__['ub'].ymax,__dcg_shared_module_exports__['ub'].zmin,__dcg_shared_module_exports__['ub'].zmax)}var VA=class extends ov{constructor(t,o,i,n){super({elt:t,settings:o,controller:i,evaluator:n});this.type="3d";this.screen=jme();this.redrawTickCount=0;let a=$Q();this.setUserRequestedViewport(a),this.viewportController=new nA(a,this),this.graphSketches={};let s=document.createElement("canvas");s.className="dcg-webgl-canvas",this.getDebugPixelRatio()!==1&&(s.style.imageRendering="pixelated"),this.webglLayer=new xS(s,i),this.elt.appendChild(s),this.transition=new sA,this.controls=new aA(this.webglLayer.spinningWorld,this,this.canvasLayer.canvasNode),this.controls.setWorldRotation(Uu()),this.controls.unsnappedRotation.copy(this.controls.worldRotation3D),this.addKeydownEventHandler()}isDefaultDomain(){let t=this.viewportController.getViewport(),o=this.getDefaultViewport();return t.xmin===o.xmin&&t.xmax===o.xmax&&t.ymin===o.ymin&&t.ymax===o.ymax&&t.zmin===o.zmin&&t.zmax===o.zmax}getDebugPixelRatio(){var t;return(t=this.settings.config.debugPixelRatio)!=null?t:1}startZoom(){this.settings.config.disableWorkerOnZoom&&this.evaluator.setTicksEnabled(!1)}endZoom(){this.settings.config.disableWorkerOnZoom&&this.evaluator.setTicksEnabled(!0)}remove(){this.controls.dispose(),this.elt.remove(),this.viewportController.remove(),this.webglLayer.remove()}tick(t){this.redrawTickCount+=1,this.controller.getGrapher2d().tick(t),KJ(this.controls);let o=this.webglLayer.getPickResult();this.webglLayer.pickAtMouseAndReadResults();let i=this.webglLayer.getPickResult();__dcg_shared_module_exports__['J'](o,i)||(this.__redrawRequested=!0),(!this.lastRenderedWorldRotation||!this.lastRenderedWorldRotation.equals(this.controls.worldRotation3D))&&(this.__redrawRequested=!0,this.lastRenderedWorldRotation=this.controls.worldRotation3D.clone()),this.__redrawRequested&&this._redrawAllLayers()}clear(){this.graphSketches={},this.controller.getGrapher2d().clear()}getGraphSketch(t){return this.graphSketches[t]}addGraphSketch(t){this.graphSketches[t.id]=t}removeGraphSketch(t){t in this.graphSketches&&delete this.graphSketches[t]}flatWorldRotation3D(){return[...this.controls.worldRotation3D.elements]}debounceUserRequestedRotationChange(){this.__debouncedRotationCommit||(this.__debouncedRotationCommit=__dcg_shared_module_exports__['F'](()=>{if(this.isDragging)return;let t=this.flatWorldRotation3D();(this.settings.worldRotation3D.length===0&&this.controls.worldRotation3D.equals(Uu())||__dcg_shared_module_exports__['J'](this.settings.worldRotation3D,t))&&this.settings.axis3D===this.controls.axis3D&&this.settings.speed3D===this.controls.speed3D||this.controller.dispatch({type:"commit-user-requested-rotation",worldRotation3D:t,axis3D:this.controls.axis3D,speed3D:this.controls.speed3D})},$me)),this.__debouncedRotationCommit()}getDefaultViewport(){return $Q()}_updateScreenSize(t,o){if(t<=0||o<=0)return;let i=this.screen;i.width===t&&i.height===o||(this.screen=new rd(t,o),this.viewportController.setScreen(this.screen))}getProjection(){return new kc(this.screen,this.viewportController.getViewport(),this.settings)}size(){let t=this.canvasLayer.ctx;if(!t)return this.controller.getGrapher2d().size();let{width:o,height:i}=t.canvas.getBoundingClientRect();return o===0||i===0?this.controller.getGrapher2d().size():{width:o,height:i}}update(){let{top:t,left:o,width:i,height:n}=this.controller.computeMajorLayout().grapher,a=this.baseplaneWidth(),s=this.controller.getGrapher2d();s.setCanvasSizeFor3D(a,a),s.update(),this.webglLayer.updateDomainObjects(),i>0&&n>0?(this._setIsVisible(!0),this._updateScreenSize(i,n),Yi(this.elt,{position:"absolute",left:o+"px",top:t+"px",width:i+"px",height:n+"px"})):this._setIsVisible(!1)}deselectSketch(t){let o=this.getGraphSketch(t);o&&(o.selected=!1,o.showHighlight=!1)}selectSketch(t){let o=this.getGraphSketch(t);o&&(o.selected=!0,o.showHighlight=!0)}setSketchHoistedToTop(t,o){let i=this.getGraphSketch(t);i&&(i.hoistToTop=o)}updateSketch(t,o){if(!o.length){this.removeGraphSketch(t);return}let i=new Yw(t,o);i.color=o[0].color;let n=this.getGraphSketch(t);n&&i.updateFrom(n);let a=this.controller.getPropagatedSelectedIds(),s=!!a.selected[t],l=!!a.hoistedToTop[t];i.selected=s,i.showHighlight=s,i.hoistToTop=l,this.addGraphSketch(i)}_redrawAllLayers(){if(!this.isVisible)return;let t=Date.now();this.__redrawRequested=!1,this.canvasLayer.resize(this.screen.width,this.screen.height),this.controls.update(),this._redrawWebglLayer(),this.events.triggerEvent("redraw",Date.now()-t),this.canvasLayer.updateAria(this.isVisible,0)}_redrawWebglLayer(){let t=this.getDebugPixelRatio();this.webglLayer.canvas.width=this.canvasLayer.canvasNode.width/t,this.webglLayer.canvas.height=this.canvasLayer.canvasNode.height/t,t!==1&&(this.webglLayer.canvas.style.transform=`scale(${t})`,this.webglLayer.canvas.style.transformOrigin="0 0"),this.webglLayer.redraw(this.graphSketches,this.__drawLayers)}_parseScreenshotOpts(t){return Y3(t,this.settings,this.screen)}screenshot(t){let o=document.createElement("canvas"),i=this._parseScreenshotOpts(t);o.width=i.width*i.targetPixelRatio,o.height=i.height*i.targetPixelRatio;let n=this.screenshotToCanvas(o),a=o.toDataURL("image/png");return n&&n(),a}asyncScreenshot(t,o){t.format==="svg"&&__dcg_shared_module_exports__['g'].warn("Unsupported format 'svg' for 3d screenshot. Assuming 'png' format instead.");for(let i of["showLabels","showMovablePoints","mathBounds","mode"])t.hasOwnProperty(i)&&__dcg_shared_module_exports__['g'].warn(`Property ${i} is ignored for 3d screenshot.`);o(this.screenshot(t))}screenshotToCanvas(t){let o=new xS(t,this.controller);return o.spinningWorld.setRotationFromMatrix(new ur().setFromMatrix3(this.controls.worldRotation3D)),o.redraw(this.graphSketches,this.__drawLayers),()=>o.remove()}_afterViewportChange(){this.webglLayer!==void 0&&this.webglLayer.updateDomainObjects()}computeConcreteViewport(t){return t}setGrapherState(t,o){t=__dcg_shared_module_exports__['nb'](hc,t),"complex"in t&&!this.controller.canEnableComplexMode()&&(t={...t,complex:!1}),(!o||!o.doNotClear)&&this.clear();for(let i in hc)hc.hasOwnProperty(i)&&this.settings.setProperty(i,t[i]);if("viewport"in t){let i=Co.fromObject(t.viewport);this.setUserRequestedViewport(i),this.viewportController.setViewport(i),this.webglLayer!==void 0&&this.webglLayer.updateDomainObjects()}if("speed3D"in t&&(this.controls.speed3D=t.speed3D),"worldRotation3D"in t){let i=t.worldRotation3D;if(i.length===9){let n=new Mi;n.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]),this.controls.setWorldRotation(n),this.controls.unsnappedRotation.copy(this.controls.worldRotation3D),!this.controls.isHorizonLevel()&&!this.controller.getGraphSettings().config.beta3d&&(this.controls.setWorldRotation(Uu()),this.controls.unsnappedRotation.copy(this.controls.worldRotation3D),this.controls.speed3D=0)}else this.controls.setWorldRotation(Uu()),this.controls.unsnappedRotation.copy(this.controls.worldRotation3D)}"axis3D"in t&&(this.controls.axis3D=t.axis3D),this.controller.requestRedrawGraph()}baseplaneWidth(){let t=this.controller.computeMajorLayout().grapher,{width:o,height:i}=t;return o<360&&(i=360*(i/o),o=360),i<360&&(o=360*(o/i),i=360),Math.ceil(Math.min(o,i)*this.webglLayer.baseplaneMultiplier())}mathCoordinatesToScreenCoordinates(t){return this.webglLayer.mathCoordinatesToScreenCoordinates(t)}addKeydownEventHandler(){re(this.elt).on("keydown",t=>{if(!this.controller.isGraphPaperFocused())return;let o=t;if(o.altKey||o.ctrlKey||o.metaKey)return;let i=Be(o);if(i==="Tab"){let a=o.shiftKey?"prev":"next";this.handleTabEvent(a,o),this.redrawAllLayers();return}let n=this.controller.getGrapher2d().poiController.keyboardAttentionManager.getKeyboardAttention();if(n){if(i==="Enter"||i==="Space"){let a=this.controller.getItemModel(n.calcId);uw(a)&&this.controller.dispatch({type:"clickable-item-clicked",id:n.calcId,listIndex:n.listIndex})}return}i!=="Up"&&i!=="Down"&&i!=="Left"&&i!=="Right"||(o.stopPropagation(),o.preventDefault(),this.controls.applyTiltFromKeyboard(i,o.shiftKey),this.debounceUserRequestedRotationChange())}),re(this.elt).on("keyup",()=>{this.controller.isGraphPaperFocused()&&this.controls.keyUp()})}getCanvasNode(){return this.webglLayer.canvas}getOrderedTabTargets(){return this.webglLayer.getOrderedTabTargets()}handleTabEvent(t,o){let n=this.controller.getGrapher2d().poiController.keyboardAttentionManager,s=n.getKeyboardAttention()!==void 0;if(t==="prev"&&!s){n.updateKeyboardAttention(void 0,{describe:!1}),this.webglLayer.updateDomainObjects();return}if(n.focusNextObjFromKeyboard({direction:t,allowWrapping:!1,selectNonClickables:!1})){o==null||o.preventDefault(),o==null||o.stopPropagation(),this.webglLayer.updateDomainObjects();return}else{n.updateKeyboardAttention(void 0,{describe:!1}),t==="prev"&&s&&(this.controller.dispatch({type:"set-focus-location",location:{type:"graph-paper"}}),this.speakGrapherFocusAriaLabel(),o==null||o.preventDefault(),o==null||o.stopPropagation()),this.webglLayer.updateDomainObjects();return}}speakGrapherFocusAriaLabel(){let o=this.elt.getElementsByClassName("dcg-graph-outer")[0].getAttribute("aria-label");o&&Te(o)}};tu();var Er=__dcg_shared_module_exports__['e'](Z());var fr=__dcg_shared_module_exports__['e'](Z());var it=__dcg_shared_module_exports__['e'](Z());var lg=__dcg_shared_module_exports__['e'](Z()),Vr=class extends lg.Class{template(){return lg.createElement("div",{class:()=>{var e,t,o,i,n;return{"dcg-keypad-btn-container":!0,"dcg-disabled":this.isDisabled(),[(o=(t=(e=this.props).additionalClass)==null?void 0:t.call(e))!=null?o:""]:!!((n=(i=this.props).additionalClass)!=null&&n.call(i))}},style:()=>{var e;return{"flex-grow":(e=this.getColSpan())==null?void 0:e.toString()}}},lg.createElement("span",{role:lg.const("button"),class:this.bindFn(this.getClasses),"dcg-command":this.props.command,"aria-label":this.bindFn(this.getAriaLabel),"aria-disabled":this.bindFn(this.isDisabled),"aria-controls":this.props.ariaControls?this.props.ariaControls:this.const(void 0),"aria-expanded":this.props.ariaExpanded?this.bindFn(this.getAriaExpanded):this.const(void 0),onTap:()=>{this.isDisabled()||this.props.onTap()}},lg.createElement("span",{class:lg.const("dcg-keypad-btn-content")},this.props.children)))}getClasses(){let e={"dcg-keypad-btn":!0,"dcg-keypad-btn-active":this.isActive()},t=this.props.style();switch(t){case"default":e["dcg-btn-light-on-gray"]=!0;break;case"highlight":e["dcg-btn-dark-on-gray"]=!0;break;case"popover":e["dcg-btn-light-gray"]=!0;break;case"blue":e["dcg-btn-short-blue"]=!0;break;case"tall-blue":e["dcg-btn-tall-blue"]=!0;break;default:return t}return e}isActive(){return this.props.active?this.props.active():!1}getAriaLabel(){return this.props.ariaLabel?this.props.ariaLabel():this.props.command()}getColSpan(){if(this.props.colspan)return this.props.colspan()}isDisabled(){return this.props.disabled&&this.props.disabled()}getAriaExpanded(){return this.props.ariaExpanded?this.props.ariaExpanded():void 0}};var LA=__dcg_shared_module_exports__['e'](Z());var jQ=__dcg_shared_module_exports__['e'](Z()),oy=class extends jQ.Class{init(){this.controller=this.props.controller()}};var xo=class extends oy{template(){return LA.createElement("div",{class:LA.const("dcg-basic-keypad dcg-do-not-blur")},this.props.children)}};var ue=__dcg_shared_module_exports__['e'](Z());var{IfElse:JQ,If:YQ,Switch:Yme}=ue.Components;function qr(r,e){return r===void 0?ue.const(e):typeof r=="function"?r:ue.const(r)}function Pv(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command||r.typedText||r.keys[0]),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):r.typedText||r.keys[0],colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>t({type:"keypad/type-text",text:r.typedText||r.keys[0]})},JQ(()=>r.keys[0]==="{"||r.keys[0]==="[",{true:()=>ue.createElement("span",{class:ue.const("dcg-mq-math-mode"),style:ue.const("font-size: 120%")},ue.const(r.keys[0]),ue.const("\xA0"),ue.createElement("span",{style:ue.const("color: #999")},ue.const(r.keys[1]))),false:()=>ue.createElement("span",{class:ue.const("dcg-either-or-btn")},ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.keys[0])}),ue.createElement("span",{style:ue.const("color: #999")},ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.keys[1])})))}))}function Ov(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command||r.typedText||r.keys[1]),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):r.typedText||r.keys[0],colspan:qr(o.colspan,1),style:qr(o.style,"default"),onTap:()=>t({type:"keypad/type-text",text:r.typedText||r.keys[1]})},JQ(()=>r.keys[1]==="}"||r.keys[1]==="]",{true:()=>ue.createElement("span",{class:ue.const("dcg-mq-math-mode"),style:ue.const("font-size: 120%")},ue.createElement("span",{style:ue.const("color: #999")},ue.const(r.keys[0])),ue.const("\xA0"),ue.const(r.keys[1])),false:()=>ue.createElement("span",null,ue.createElement("span",{style:ue.const("color: #999")},ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.keys[0])})),ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.keys[1])}))}))}function Xme(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):e,colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>{t({type:"keypad/audio-trace",command:r.command})}},ue.createElement(YQ,{predicate:ue.const(r.iconClass!==void 0)},()=>ue.createElement("span",{class:()=>({"dcg-button-icon":!0,"dcg-icon-only":r.contentKey===void 0})},ue.createElement("i",{class:ue.const(r.iconClass),"aria-hidden":ue.const("true")}))),ue.createElement(YQ,{predicate:ue.const(r.contentKey!==void 0)},()=>ue.createElement("span",null,()=>i(r.contentKey)||e)))}function Ke(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command||e),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):e,colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>t({type:"keypad/type-text",text:r.typedText||e})},ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.content||e)}))}function XQ(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command||e),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):e,colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>t({type:"keypad/type-text",text:r.typedText||e})},ue.createElement("span",{class:ue.const("dcg-mq-math-mode")},ue.const(r.content||e)))}function je(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(e),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):e,colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>t({type:"keypad/type-text",text:e+"("})},ue.createElement(Yme,{key:()=>!!e.match(/^[a-z]{2,}$/)},n=>n?ue.createElement("span",{class:ue.const("dcg-mq-math-mode dcg-static-mathquill-view")},ue.createElement("span",{class:ue.const("dcg-mq-root-block")},ue.createElement("span",{class:ue.const("dcg-mq-operator-name")},()=>e))):ue.createElement(Et,{config:ue.const({}),latex:ue.const(e)})))}function as(r){return(e,t,o={},i)=>ue.createElement(Vr,{command:ue.const(r.command),ariaLabel:()=>r.ariaLabelKey?i(r.ariaLabelKey):r.command,colspan:qr(o.colspan,1),style:()=>o.style||"default",onTap:()=>{t({type:"keypad/custom-command",command:r.command})}},ue.createElement(Et,{config:ue.const({}),latex:ue.const(r.content)}))}var Jme={"{":XQ({ariaLabelKey:"shared-calculator-narration-keypad-key-left-bracket"}),"}":XQ({ariaLabelKey:"shared-calculator-narration-keypad-key-right-bracket"}),"(":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-left-paren"}),")":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-right-paren"}),sqrt:Ke({content:"\\sqrt{}",ariaLabelKey:"shared-calculator-narration-keypad-key-sqrt"}),"/":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-divide"}),division:Ke({content:"\xF7",typedText:"/",command:"/",ariaLabelKey:"shared-calculator-narration-keypad-key-divide"}),obelus:Ke({content:"\xF7",typedText:"\xF7",ariaLabelKey:"shared-calculator-narration-keypad-key-divide"}),"*":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-times"}),multiplication:Ke({content:"\xD7",typedText:"*",command:"*",ariaLabelKey:"shared-calculator-narration-keypad-key-times"}),"\xB1":Ke({ariaLabelKey:"shared-calculator-narration-keypad-plus-minus"}),"-":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-minus"}),"+":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-plus"}),".":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-decimal"}),ans:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-ans"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/type-text",text:r})},ue.const("ans")),enter:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-enter"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/press-key",key:"Enter",source:"keypad"})},ue.createElement("i",{class:ue.const("dcg-icon-arrow-enter"),"aria-hidden":ue.const("true")})),undo:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-enter"),colspan:qr(t.colspan,1),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"undo",source:"button-tap"})},ue.createElement("i",{class:ue.const("dcg-icon-undo"),"aria-hidden":ue.const("true")})),redo:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-enter"),colspan:qr(t.colspan,1),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"redo",source:"button-tap"})},ue.createElement("i",{class:ue.const("dcg-icon-redo"),"aria-hidden":ue.const("true")})),shift:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-shift"),colspan:qr(t.colspan,1),style:()=>t.style||"default",active:qr(t.active,!1),onTap:()=>e({type:"keypad/shift"})},ue.createElement("i",{class:ue.const("dcg-icon-shift"),"aria-hidden":ue.const("true")})),left:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-left-arrow"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/press-key",key:"Left",source:"keypad"})},ue.createElement("i",{class:ue.const("dcg-icon-arrow-left"),"aria-hidden":ue.const("true")})),right:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-right-arrow"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/press-key",key:"Right",source:"keypad"})},ue.createElement("i",{class:ue.const("dcg-icon-arrow-right"),"aria-hidden":ue.const("true")})),123:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-toggle-numbers"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/123"})},ue.const("1 2 3")),ABC:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-toggle-letters"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/abc"})},ue.const("A B C")),Audio:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-toggle-audio-trace"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"on"})},ue.createElement("i",{class:ue.const("dcg-icon-volume"),"aria-hidden":ue.const("true")})),backspace:(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("shared-calculator-narration-keypad-key-backspace"),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/press-key",key:"Backspace",source:"keypad"})},ue.createElement("i",{class:ue.const("dcg-icon-delete"),"aria-hidden":ue.const("true")})),pi:Ke({content:"\\pi",ariaLabelKey:"shared-calculator-narration-keypad-key-pi"}),alpha:Ke({content:"\\alpha",ariaLabelKey:"shared-calculator-narration-keypad-key-alpha"}),beta:Ke({content:"\\beta",ariaLabelKey:"shared-calculator-narration-keypad-key-beta"}),theta:Ke({content:"\\theta",ariaLabelKey:"shared-calculator-narration-keypad-key-theta"}),tau:Ke({content:"\\tau",ariaLabelKey:"shared-calculator-narration-keypad-key-tau"}),phi:Ke({content:"\\phi",ariaLabelKey:"shared-calculator-narration-keypad-key-phi"}),rho:Ke({content:"\\rho",ariaLabelKey:"shared-calculator-narration-keypad-key-rho"}),"a^2":as({command:"a^2",content:"a^2",ariaLabelKey:"shared-calculator-narration-keypad-key-squared"}),"a^3":as({command:"a^3",content:"a^3",ariaLabelKey:"shared-calculator-narration-keypad-key-cubed"}),"x^3":as({command:"a^3",content:"x^3",ariaLabelKey:"shared-calculator-narration-keypad-key-cubed"}),"a^b":Ke({content:"a^b",typedText:"^",ariaLabelKey:"shared-calculator-narration-keypad-key-superscript"}),a_b:Ke({content:"a_b",typedText:"_",ariaLabelKey:"shared-calculator-narration-keypad-key-subscript"}),"a/b":as({content:"\\frac{a}{b}",command:"a/b",ariaLabelKey:"shared-calculator-narration-keypad-key-fraction"}),"x^2":as({command:"a^2",content:"x^2",ariaLabelKey:"shared-calculator-narration-keypad-key-squared"}),"x^y":Ke({content:"x^y",typedText:"^",ariaLabelKey:"shared-calculator-narration-keypad-key-superscript"}),"x/y":Ke({content:"\\frac{x}{y}",typedText:"/",ariaLabelKey:"shared-calculator-narration-keypad-key-fraction"}),nthroot:as({command:"nthroot",content:"\\sqrt[n]{}",ariaLabelKey:"shared-calculator-narration-keypad-key-nthroot"}),ythroot:as({command:"nthroot",content:"\\sqrt[y]{}",ariaLabelKey:"shared-calculator-narration-keypad-key-ythroot"}),sin:je({ariaLabelKey:"shared-calculator-narration-keypad-key-sin"}),cos:je({ariaLabelKey:"shared-calculator-narration-keypad-key-cos"}),tan:je({ariaLabelKey:"shared-calculator-narration-keypad-key-tan"}),tone:je({ariaLabelKey:"shared-calculator-narration-keypad-key-tone"}),sec:je({ariaLabelKey:"shared-calculator-narration-keypad-key-sec"}),csc:je({ariaLabelKey:"shared-calculator-narration-keypad-key-csc"}),cot:je({ariaLabelKey:"shared-calculator-narration-keypad-key-cot"}),sinh:je({ariaLabelKey:"shared-calculator-narration-keypad-key-sinh"}),cosh:je({ariaLabelKey:"shared-calculator-narration-keypad-key-cosh"}),tanh:je({ariaLabelKey:"shared-calculator-narration-keypad-key-tanh"}),sech:je({ariaLabelKey:"shared-calculator-narration-keypad-key-csch"}),csch:je({ariaLabelKey:"shared-calculator-narration-keypad-key-csch"}),coth:je({ariaLabelKey:"shared-calculator-narration-keypad-key-coth"}),arcsin:as({command:"arcsin",content:"sin^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arcsin"}),arccos:as({command:"arccos",content:"cos^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arccos"}),arctan:as({command:"arctan",content:"tan^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arctan"}),arccsc:as({command:"arccsc",content:"csc^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arccsc"}),arcsec:as({command:"arcsec",content:"sec^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arcsec"}),arccot:as({command:"arccot",content:"cot^{-1}",ariaLabelKey:"shared-calculator-narration-keypad-key-arccot"}),"|a|":Ke({typedText:"|",ariaLabelKey:"shared-calculator-narration-keypad-key-abs"}),"|x|":Ke({typedText:"|",ariaLabelKey:"shared-calculator-narration-keypad-key-abs"}),ln:je({ariaLabelKey:"shared-calculator-narration-keypad-key-ln"}),midpoint:je({ariaLabelKey:"shared-calculator-narration-keypad-key-midpoint"}),segment:je({ariaLabelKey:"shared-calculator-narration-keypad-key-segment"}),line:je({ariaLabelKey:"shared-calculator-narration-keypad-key-line"}),ray:je({ariaLabelKey:"shared-calculator-narration-keypad-key-ray"}),parallel:je({ariaLabelKey:"shared-calculator-narration-keypad-key-parallel"}),perpendicular:je({ariaLabelKey:"shared-calculator-narration-keypad-key-perpendicular"}),circle:je({ariaLabelKey:"shared-calculator-narration-keypad-key-circle"}),arc:je({ariaLabelKey:"shared-calculator-narration-keypad-key-arc"}),angle:je({ariaLabelKey:"shared-calculator-narration-keypad-key-angle"}),directedangle:je({ariaLabelKey:"shared-calculator-narration-keypad-key-directed-angle"}),glider:je({ariaLabelKey:"shared-calculator-narration-keypad-key-glider"}),coterminal:je({ariaLabelKey:"shared-calculator-narration-keypad-key-coterminal"}),supplement:je({ariaLabelKey:"shared-calculator-narration-keypad-key-supplement"}),dilate:je({ariaLabelKey:"shared-calculator-narration-keypad-key-dilate"}),rotate:je({ariaLabelKey:"shared-calculator-narration-keypad-key-rotate"}),translate:je({ariaLabelKey:"shared-calculator-narration-keypad-key-translate"}),reflect:je({ariaLabelKey:"shared-calculator-narration-keypad-key-reflect"}),vertices:je({ariaLabelKey:"shared-calculator-narration-keypad-key-vertices"}),angles:je({ariaLabelKey:"shared-calculator-narration-keypad-key-angles"}),directedangles:je({ariaLabelKey:"shared-calculator-narration-keypad-key-directed-angles"}),segments:je({ariaLabelKey:"shared-calculator-narration-keypad-key-segments"}),radius:je({ariaLabelKey:"shared-calculator-narration-keypad-key-radius"}),center:je({ariaLabelKey:"shared-calculator-narration-keypad-key-center"}),intersection:je({ariaLabelKey:"shared-calculator-narration-keypad-key-intersection"}),area:je({ariaLabelKey:"shared-calculator-narration-keypad-key-area"}),perimeter:je({ariaLabelKey:"shared-calculator-narration-keypad-key-perimeter"}),log:je({ariaLabelKey:"shared-calculator-narration-keypad-key-log"}),quantile:je({ariaLabelKey:"shared-calculator-narration-keypad-key-quantile"}),quartile:je({ariaLabelKey:"shared-calculator-narration-keypad-key-quartile"}),var:je({}),varp:je({}),nCr:je({}),loga:as({command:"loga",content:"log_a",ariaLabelKey:"shared-calculator-narration-keypad-key-loga"}),stdev:je({ariaLabelKey:"shared-calculator-narration-keypad-key-stdev"}),mad:je({}),nPr:je({}),total:je({}),count:je({}),length:je({}),for:je({}),min:je({}),max:je({}),cov:je({ariaLabelKey:"shared-calculator-narration-keypad-key-cov"}),covp:je({ariaLabelKey:"shared-calculator-narration-keypad-key-covp"}),corr:je({ariaLabelKey:"shared-calculator-narration-keypad-key-corr"}),spearman:je({ariaLabelKey:"shared-calculator-narration-keypad-key-spearman"}),stats:je({ariaLabelKey:"shared-calculator-narration-keypad-key-stats"}),polygon:je({ariaLabelKey:"shared-calculator-narration-keypad-key-polygon"}),distance:je({ariaLabelKey:"shared-calculator-narration-keypad-key-distance"}),triangle:je({ariaLabelKey:"shared-calculator-narration-keypad-key-triangle"}),sphere:je({ariaLabelKey:"shared-calculator-narration-keypad-key-sphere"}),vector:je({ariaLabelKey:"shared-calculator-narration-keypad-key-vector"}),mean:je({ariaLabelKey:"shared-calculator-narration-keypad-key-mean"}),stdevp:je({ariaLabelKey:"shared-calculator-narration-keypad-key-stdevp"}),mod:je({}),"e^x":Ke({typedText:"e^",ariaLabelKey:"shared-calculator-narration-keypad-key-exp"}),"10^n":Ke({content:"\\times10^{n}",typedText:"*10^",ariaLabelKey:"shared-calculator-narration-keypad-key-10-n"}),"a^{-1}":Ke({typedText:"^-1",ariaLabelKey:"shared-calculator-narration-keypad-key-reciprocal"}),sum:Ke({content:"\\sum",ariaLabelKey:"shared-calculator-narration-keypad-key-sum"}),prod:Ke({content:"\\prod",ariaLabelKey:"shared-calculator-narration-keypad-key-product"}),floor:je({ariaLabelKey:"shared-calculator-narration-keypad-key-floor"}),ceil:je({ariaLabelKey:"shared-calculator-narration-keypad-key-ceil"}),round:je({ariaLabelKey:"shared-calculator-narration-keypad-key-round"}),abs:je({ariaLabelKey:"shared-calculator-narration-keypad-key-abs"}),"!":Ke({ariaLabelKey:"shared-calculator-narration-keypad-key-factorial"}),"n!":Ke({typedText:"!",ariaLabelKey:"shared-calculator-narration-keypad-key-factorial"}),median:je({ariaLabelKey:"shared-calculator-narration-keypad-key-median"}),lcm:je({}),gcd:je({}),gcf:je({}),ddx:as({command:"ddx",content:"\\frac{d}{dx}"}),integral:as({command:"integral",content:"\\int",ariaLabelKey:"shared-calculator-narration-keypad-key-int"}),"%":Ke({content:"\\%",ariaLabelKey:"shared-calculator-narration-keypad-key-percent-of"}),"->":Ke({content:"\\to",ariaLabelKey:"shared-calculator-narration-keypad-key-action-to"}),with:Ke({typedText:"with",content:"with",ariaLabelKey:"shared-calculator-narration-keypad-key-action-with"}),prime:Ke({typedText:"'",content:"f'",ariaLabelKey:"shared-calculator-narration-keypad-key-prime"}),exp:je({}),sign:je({}),normaldist:je({ariaLabelKey:"shared-calculator-narration-keypad-key-normaldist"}),poissondist:je({ariaLabelKey:"shared-calculator-narration-keypad-key-poissondist"}),binomialdist:je({ariaLabelKey:"shared-calculator-narration-keypad-key-binomialdist"}),uniformdist:je({ariaLabelKey:"shared-calculator-narration-keypad-key-uniformdist"}),erf:je({ariaLabelKey:"shared-calculator-narration-keypad-key-erf"}),histogram:je({ariaLabelKey:"shared-calculator-narration-keypad-key-histogram"}),boxplot:je({ariaLabelKey:"shared-calculator-narration-keypad-key-boxplot"}),dotplot:je({ariaLabelKey:"shared-calculator-narration-keypad-key-dotplot"}),tscore:je({ariaLabelKey:"shared-calculator-narration-keypad-key-tscore"}),ittest:je({ariaLabelKey:"shared-calculator-narration-keypad-key-ittest"}),ttest:je({ariaLabelKey:"shared-calculator-narration-keypad-key-ttest"}),tdist:je({ariaLabelKey:"shared-calculator-narration-keypad-key-tdist"}),pdf:je({ariaLabelKey:"shared-calculator-narration-keypad-key-pdf"}),cdf:je({ariaLabelKey:"shared-calculator-narration-keypad-key-pdf"}),random:je({ariaLabelKey:"shared-calculator-narration-keypad-key-random"}),inversecdf:je({ariaLabelKey:"shared-calculator-narration-keypad-key-inversecdf"}),hsv:je({}),rgb:je({}),sort:je({}),shuffle:je({}),unique:je({}),join:je({}),"A^-1":as({command:"A^-1",content:"A^{-1}",ariaLabelKey:"matrix-calculator-narration-keypad-key-inverse"}),"A^T":as({command:"A^T",content:"A^T",ariaLabelKey:"matrix-calculator-narration-keypad-key-transpose"}),"A^2":as({command:"A^2",content:"A^2",ariaLabelKey:"shared-calculator-narration-keypad-key-squared"}),"A^n":Ke({content:"A^n",typedText:"^",ariaLabelKey:"shared-calculator-narration-keypad-key-exp"}),det:je({ariaLabelKey:"matrix-calculator-narration-keypad-key-det"}),trace:je({ariaLabelKey:"matrix-calculator-narration-keypad-key-trace"}),rref:je({ariaLabelKey:"matrix-calculator-narration-keypad-key-rref"}),a:Ke({}),b:Ke({}),c:Ke({}),d:Ke({}),e:Ke({}),f:Ke({}),g:Ke({}),h:Ke({}),i:Ke({}),j:Ke({}),k:Ke({}),l:Ke({}),m:Ke({}),n:Ke({}),o:Ke({}),p:Ke({}),q:Ke({}),r:Ke({}),s:Ke({}),t:Ke({}),u:Ke({}),v:Ke({}),w:Ke({}),x:Ke({}),boldX:Ke({content:"x",typedText:"x"}),y:Ke({}),boldY:Ke({content:"y",typedText:"y"}),z:Ke({}),boldZ:Ke({content:"z",typedText:"z"}),A:Ke({}),B:Ke({}),C:Ke({}),D:Ke({}),E:Ke({}),F:Ke({}),G:Ke({}),H:Ke({}),I:Ke({}),J:Ke({}),K:Ke({}),L:Ke({}),M:Ke({}),N:Ke({}),O:Ke({}),P:Ke({}),Q:Ke({}),R:Ke({}),S:Ke({}),T:Ke({}),U:Ke({}),V:Ke({}),W:Ke({}),X:Ke({}),Y:Ke({}),Z:Ke({}),0:Ke({}),1:Ke({}),2:Ke({}),3:Ke({}),4:Ke({}),5:Ke({}),6:Ke({}),7:Ke({}),8:Ke({}),9:Ke({}),",":Ke({}),"=":Ke({}),"[":Ke({}),"]":Ke({}),"{}_left":Pv({keys:["{","}"]}),"{}_right":Ov({keys:["{","}"]}),"()_left":Pv({keys:["(",")"]}),"()_right":Ov({keys:["(",")"]}),"[]_left":Pv({keys:["[","]"]}),"[]_right":Ov({keys:["[","]"]}),",'_left":Pv({keys:[",","\u2032"]}),",'_right":Ov({keys:[",","\u2032"],typedText:"'"}),'"':Ke({}),"'":Ke({}),"~":Ke({}),":":Ke({}),">":Ke({}),"<":Ke({}),">=":Ke({content:"\\ge"}),"<=":Ke({content:"\\le"}),"!%_left":Pv({keys:["!","{}^{%}"]}),"!%_right":Ov({keys:["!","{}^{%}"],typedText:"%"}),"~:_left":Pv({keys:["~","{}^{:}"]}),"~:_right":Ov({keys:["~","{}^{:}"],typedText:":"}),real:je({ariaLabelKey:"shared-calculator-narration-keypad-key-real"}),imag:je({ariaLabelKey:"shared-calculator-narration-keypad-key-imag"}),conj:je({ariaLabelKey:"shared-calculator-narration-keypad-key-conj"}),arg:je({ariaLabelKey:"shared-calculator-narration-keypad-key-arg"}),"audio-trace-off":Xme({contentKey:"graphing-calculator-button-keypad-audio-trace-off",command:"off"}),"hear-graph":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:qr(t.style,"blue"),ariaLabel:ue.const(void 0),onTap:()=>{e({type:"keypad/audio-trace",command:"hear-graph"})}},ue.createElement("span",{class:ue.const("dcg-play-icon-container")},ue.createElement("i",{class:ue.const("dcg-icon-play"),"aria-hidden":ue.const("true")})),ue.createElement("span",null,()=>o("graphing-calculator-button-audio-trace-hear-graph"))),"stop-graph":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:qr(t.style,"blue"),onTap:()=>{e({type:"keypad/audio-trace",command:"stop-graph"})}},ue.createElement("span",{class:ue.const("dcg-stop-icon-container")},ue.createElement("span",{class:ue.const("dcg-stop-icon")})),ue.createElement("span",null,()=>o("graphing-calculator-button-audio-trace-stop-graph"))),"volume-down":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("graphing-calculator-narration-keypad-key-volume-down"),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"volume-down"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-volume-down"),"aria-hidden":ue.const("true")}))),"volume-up":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("graphing-calculator-narration-keypad-key-volume-up"),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"volume-up"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-volume-up"),"aria-hidden":ue.const("true")}))),"speed-down":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("graphing-calculator-narration-keypad-key-speed-down"),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"speed-down"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-hide"),"aria-hidden":ue.const("true")}))),"speed-up":(r,e,t={},o)=>ue.createElement(Vr,{command:ue.const(r),ariaLabel:()=>o("graphing-calculator-narration-keypad-key-speed-up"),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"speed-up"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-show"),"aria-hidden":ue.const("true")}))),"previous-point":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-previous-point"),command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"previous-point"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-thin-arrow-left"),"aria-hidden":ue.const("true")}))),"next-point":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-next-point"),command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"next-point"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-thin-arrow-right"),"aria-hidden":ue.const("true")}))),"previous-poi":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-previous-poi"),command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"previous-poi"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-hide"),"aria-hidden":ue.const("true")}))),"next-poi":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-next-poi"),command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"next-poi"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-show"),"aria-hidden":ue.const("true")}))),"previous-curve":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-previous-curve"),command:ue.const(r),disabled:qr(t.disabled,!1),colspan:qr(t.colspan,1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"previous-curve"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-caret-up"),"aria-hidden":ue.const("true")}))),"next-curve":(r,e,t={},o)=>ue.createElement(Vr,{ariaLabel:()=>o("graphing-calculator-narration-keypad-key-next-curve"),command:ue.const(r),disabled:qr(t.disabled,!1),style:()=>t.style||"default",onTap:()=>e({type:"keypad/audio-trace",command:"next-curve"})},ue.createElement("span",{class:ue.const("dcg-button-icon dcg-icon-only")},ue.createElement("i",{class:ue.const("dcg-icon-caret-down"),"aria-hidden":ue.const("true")})))};function G(r,e,t={}){let o=r.dispatch;return Jme[e](e,o,t,r.s)}function Ko(r=1){return ue.createElement("div",{style:ue.const(`flex-grow:${r}`)})}var QQ=__dcg_shared_module_exports__['e'](Z());var hB=class hB extends QQ.Class{init(){this.controller=this.props.controller(),this.dispatch=this.controller.dispatch,this.s=this.controller.s}};hB.uuid=Ld();var on=hB;var{IfElse:Qme}=it.Components,PA=460,OA=class extends on{template(){return it.createElement(xo,{controller:this.props.controller},it.createElement("div",{class:it.const("dcg-audio-keypad-container")},it.createElement("div",{class:it.const("dcg-audio-keypad-column dcg-playback-column")},it.createElement(ze,{tooltip:this.bindFn(this.getDisabledTooltipText),gravity:this.const("s")},it.createElement("div",{class:it.const("dcg-btn-playback")},Qme(()=>this.controller.isAudioTracing(),{true:()=>G(this,"stop-graph",{disabled:this.bindFn(this.isAudioDisabled)}),false:()=>G(this,"hear-graph",{disabled:this.bindFn(this.isAudioDisabled)})}))),it.createElement("div",{class:it.const("dcg-key-nav-section-container")},it.createElement(ze,{tooltip:this.bindFn(this.getDisabledTooltipText),gravity:this.const("s")},it.createElement("div",{class:it.const("dcg-key-nav-section")},G(this,"volume-down",{disabled:this.bindFn(this.isVolumeDownDisabled)}),it.createElement("div",{role:it.const("heading"),"aria-level":it.const("2"),class:()=>({"dcg-key-nav-section-title-container":!0,"dcg-disabled":this.isAudioDisabled()})},it.createElement("span",{class:it.const("dcg-key-nav-section-title")},()=>this.controller.s("graphing-calculator-label-audio-trace-volume")),it.createElement("span",{class:it.const("dcg-keypad-volume-value dcg-key-nav-section-value")},()=>this.getAudioTraceVolume())),G(this,"volume-up",{disabled:this.bindFn(this.isVolumeUpDisabled)})))),it.createElement("div",{class:it.const("dcg-key-nav-section-container")},it.createElement(ze,{tooltip:this.bindFn(this.getDisabledTooltipText),gravity:this.const("s")},it.createElement("div",{class:it.const("dcg-key-nav-section")},G(this,"speed-down",{disabled:this.bindFn(this.isSpeedDownDisabled)}),it.createElement("div",{class:()=>({"dcg-key-nav-section-title-container":!0,"dcg-disabled":this.isAudioDisabled()}),role:it.const("heading"),"aria-level":it.const("2")},it.createElement("span",{class:it.const("dcg-key-nav-section-title")},()=>this.controller.s("graphing-calculator-label-audio-trace-speed")),it.createElement("span",{class:it.const("dcg-keypad-speed-value dcg-key-nav-section-value")},()=>this.getAudioTraceSpeed())),G(this,"speed-up",{disabled:this.bindFn(this.isSpeedUpDisabled)})))),G(this,"audio-trace-off",{style:"highlight"})),it.createElement("div",{class:it.const("dcg-audio-keypad-spacer")}),it.createElement("div",{class:it.const("dcg-audio-keypad-column dcg-navigation-column")},it.createElement("span",{class:it.const("dcg-key-section-title dcg-center-col"),role:it.const("heading"),"aria-level":it.const("2")},()=>this.controller.s("graphing-calculator-heading-audio-trace-navigation")),it.createElement("div",{class:it.const("dcg-key-nav-section dcg-center-col")},G(this,"previous-point",{disabled:this.bindFn(this.isPrevPointDisabled)}),it.createElement("div",{class:it.const("dcg-key-nav-section-title-container"),role:it.const("heading"),"aria-level":it.const("2")},()=>this.controller.s("graphing-calculator-label-audio-trace-point")),G(this,"next-point",{disabled:this.bindFn(this.isNextPointDisabled)})),it.createElement("div",{class:it.const("dcg-key-nav-section")},G(this,"previous-poi",{disabled:this.bindFn(this.isPrevPOIDisabled)}),it.createElement("div",{class:it.const("dcg-key-nav-section-title-container dcg-poi-section-container"),role:it.const("heading"),"aria-level":it.const("2")},it.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-heading-keypad-audio-trace-point-of-interest")},it.createElement("span",{class:it.const("dcg-key-nav-section-value")},it.const("Point")),it.createElement("span",{class:it.const("dcg-key-nav-section-title")},it.const("of Interest")))),G(this,"next-poi",{disabled:this.bindFn(this.isNextPOIDisabled)})),it.createElement("div",{class:it.const("dcg-key-nav-section dcg-center-col")},G(this,"previous-curve",{disabled:this.bindFn(this.isPrevCurveDisabled)}),it.createElement("div",{class:it.const("dcg-key-nav-section-title-container"),role:it.const("heading"),"aria-level":it.const("2")},()=>this.controller.s("graphing-calculator-label-audio-trace-curve")),G(this,"next-curve",{disabled:this.bindFn(this.isNextCurveDisabled)}))),it.createElement("div",{class:it.const("dcg-audio-keypad-spacer")}),it.createElement("div",{class:it.const("dcg-audio-keypad-column dcg-screenreader-options")},it.createElement("span",{class:it.const("dcg-key-section-title"),role:it.const("heading"),"aria-level":it.const("2")},()=>this.layoutWidth()<=PA?this.controller.s("graphing-calculator-heading-audio-trace-describe"):this.controller.s("graphing-calculator-heading-audio-trace-screen-reader"),it.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-audio-trace-need-screen-reader"),gravity:this.const("s"),sticky:this.const(!0)},it.createElement("i",{class:it.const("dcg-icon-question-sign"),"aria-hidden":it.const("true")}))),it.createElement(Vr,{command:it.const("describe-point"),colspan:this.const(1),style:this.const("default"),onTap:()=>{this.dispatch({type:"keypad/audio-trace",command:"describe-point"})}},it.createElement("span",null,()=>this.layoutWidth()<=PA?this.controller.s("graphing-calculator-button-keypad-describe-point-short"):this.controller.s("graphing-calculator-button-keypad-describe-point"))),it.createElement(Vr,{command:it.const("describe-curve"),colspan:this.const(1),style:this.const("default"),onTap:()=>{this.dispatch({type:"keypad/audio-trace",command:"describe-curve"})}},it.createElement("span",null,()=>this.layoutWidth()<=PA?this.controller.s("graphing-calculator-button-keypad-describe-curve-short"):this.controller.s("graphing-calculator-button-keypad-describe-curve"))),it.createElement(Vr,{command:it.const("describe-axes"),colspan:this.const(1),style:this.const("default"),onTap:()=>{this.dispatch({type:"keypad/audio-trace",command:"describe-axes"})}},it.createElement("span",null,()=>this.layoutWidth()<=PA?this.controller.s("graphing-calculator-label-axes"):this.controller.s("graphing-calculator-button-keypad-describe-axes"))))))}layoutWidth(){return this.controller.getLayoutMeasurements().width}isPrevPointDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToPrevPoint():!0}isNextPointDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToNextPoint():!0}isPrevPOIDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToPrevPOI():!0}isNextPOIDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToNextPOI():!0}isPrevCurveDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToPrevCurve():!0}isNextCurveDisabled(){let r=this.controller.getAudioGraph();return r?!r.agNavigator.canMoveToNextCurve():!0}isAudioDisabled(){return!this.controller.getAudio()}getAudioTraceVolume(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?"0%":`${r.getAudioVolume()*100}%`}isVolumeDownDisabled(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?!0:r.getAudioVolume()<=0}isVolumeUpDisabled(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?!0:r.getAudioVolume()>=1}getAudioTraceSpeed(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?"0":PC[r.getAudioSpeedIndex()].displayedSpeed}isSpeedDownDisabled(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?!0:r.getAudioSpeedIndex()<=0}isSpeedUpDisabled(){let r=this.controller.getAudioGraph();return!r||this.isAudioDisabled()?!0:r.getAudioSpeedIndex()===PC.length-1}getDisabledTooltipText(){return this.isAudioDisabled()?this.controller.s("graphing-calculator-narration-audio-trace-sound-effects-disabled"):""}};var mo=__dcg_shared_module_exports__['e'](Z());var{If:RA,For:ZQ}=mo.Components,FA=class extends on{template(){return mo.createElement("div",{class:()=>({"dcg-functions-popover":!0,"dcg-popover":!0,"dcg-top":!0,"dcg-two-column":this.shouldRenderWithTwoColumns()}),id:this.const(`dcg-functions-popover-${on.uuid}`),role:mo.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-button-functions")},mo.createElement("div",{class:mo.const("dcg-popover-interior")},mo.createElement("div",{class:mo.const("dcg-interior-buttons")},mo.createElement("div",{class:mo.const("dcg-basic-keypad dcg-do-not-blur")},mo.createElement(ZQ,{each:this.bindFn(this.getKeypadKeys),key:r=>r.id},r=>mo.createElement("div",{class:mo.const("dcg-keypad-keys-section")},mo.createElement(RA,{predicate:()=>r.title!==void 0},()=>mo.createElement("div",{class:mo.const("dcg-section-heading"),role:mo.const("heading"),"aria-level":mo.const("2")},()=>r.title,mo.createElement(RA,{predicate:()=>!!r.beta},()=>mo.createElement("span",{class:mo.const("dcg-beta-tag")},()=>this.controller.s("shared-calculator-narration-keypad-key-beta"))),mo.createElement(RA,{predicate:()=>!!r.helpLink},()=>mo.createElement("a",{href:()=>r.helpLink.url,target:mo.const("_blank"),"aria-label":()=>r.helpLink.tooltip},mo.createElement("i",{class:mo.const("dcg-icon-question-sign"),"aria-hidden":mo.const("true")}))))),mo.createElement(RA,{predicate:()=>r.title===void 0},()=>mo.createElement("div",{class:mo.const("dcg-popover-section-separator"),role:mo.const("separator")})),mo.createElement("div",{class:mo.const("dcg-keypad-keys-buttons")},mo.createElement(ZQ,{each:()=>r.keys},e=>this.b(e)))))))),mo.createElement("div",{class:mo.const("dcg-arrow")}))}shouldRenderWithTwoColumns(){let r=this.controller.getGraphSettings().config.projectorMode?410:375;return this.controller.getLayoutMeasurements().width<r}getInverseTrigSection(){let r=this.controller.areFunctionsRestricted()?["arcsin","arccos","arctan"]:["arcsin","arccos","arctan","arccsc","arcsec","arccot"];return{id:"inversetrig",title:this.controller.s("graphing-calculator-heading-inverse-trig"),keys:r}}getGeometryTools(){let r=["midpoint","intersection","segment","line","ray","vector","parallel","perpendicular","circle","arc","angle","directedangle","polygon","glider"];return{id:"geometry-tools",title:this.controller.s("graphing-calculator-heading-geometry-tools"),keys:r}}getGeometryTransformations(){let r=["dilate","rotate","reflect","translate"];return{id:"geometry-transformations",title:this.controller.s("graphing-calculator-heading-geometry-transformations"),keys:r}}getGeometryMeasurements(){let r=["distance","length","area","perimeter","vertices","angles","directedangles","segments","radius","center","coterminal","supplement"];return{id:"geometry-measurements",title:this.controller.s("graphing-calculator-heading-geometry-measurements"),keys:r}}getCalculatorGeometryMethods(){let r=!this.controller.areFunctionsRestricted()||this.controller.areGeometryFunctionsForceEnabled(),e=this.controller.isThreeDMode()?["segment","triangle","sphere","vector"]:["polygon"],t=this.controller.isThreeDMode()?["length","distance","midpoint"]:["distance","midpoint"],o=r?t:[];return{id:"geometry",title:this.controller.s("graphing-calculator-heading-geometry"),keys:[...e,...o]}}getTrigSection(){let r=this.controller.areFunctionsRestricted()?["sin","cos","tan"]:["sin","cos","tan","csc","sec","cot"];return{id:"trig",title:this.controller.s("graphing-calculator-heading-trig"),keys:r}}getHyperbolicTrigSection(){let r=this.controller.areFunctionsRestricted()?["sinh","cosh","tanh"]:["sinh","cosh","tanh","csch","sech","coth"];return{id:"hyperbtrig",title:this.controller.s("graphing-calculator-heading-hyperbolic-trig"),keys:r}}getListFunctions(){return{id:"lists",title:this.controller.s("graphing-calculator-heading-lists"),keys:["join","sort","shuffle","unique","for"]}}getStatTests(){return{id:"stat-tests",title:this.controller.s("graphing-calculator-heading-stat-tests"),keys:["ttest","tscore","ittest"]}}getStatsSection(){let r=["mean","median","min","max","quartile","quantile","stdev","stdevp","var"];return this.controller.areFunctionsRestricted()||(r=r.concat(["mad","cov","covp"])),r=r.concat(["corr","spearman","stats","count","total"]),{id:"stats",title:this.controller.s("graphing-calculator-heading-stats"),keys:r}}getMiscSection(){return{title:this.controller.s("graphing-calculator-button-functions-menu-number-theory"),id:"misc",keys:["lcm","gcd","mod","ceil","floor","round","sign","nthroot","nPr","nCr"]}}getVisualizationsSection(){return{title:this.controller.s("graphing-calculator-heading-dist-tab-visualizations"),id:"visualizations",keys:["histogram","dotplot","boxplot"],helpLink:{url:"https://help.kiavash.com/hc/en-us/articles/360022405991-Data-Visualizations",tooltip:this.controller.s("graphing-calculator-narration-dist-tab-visualizations")}}}getCalculusSection(){return{title:this.controller.s("graphing-calculator-heading-calculus"),id:"calculus",keys:["exp","ln","log","loga","ddx","prime","integral","sum","prod"]}}getDistributionsSection(){return{title:this.controller.s("graphing-calculator-heading-dist-tab-distributions"),id:"distributions",keys:["normaldist","tdist","poissondist","binomialdist","uniformdist","pdf","cdf","inversecdf","random"],helpLink:{url:"https://help.kiavash.com/hc/en-us/articles/360022401451-Distributions",tooltip:this.controller.s("graphing-calculator-narration-dist-tab-distributions")}}}getColorsSection(){return{title:this.controller.s("graphing-calculator-button-functions-menu-custom-colors"),id:"colors",keys:["rgb","hsv"],helpLink:{url:"https://help.kiavash.com/hc/en-us/articles/4406795899533-Custom-Colors",tooltip:this.controller.s("graphing-calculator-button-functions-menu-custom-colors")}}}getAdvancedSection(){return{title:this.controller.s("graphing-calculator-heading-functions-menu-advanced"),id:"advanced",keys:["->","with"],helpLink:{url:"https://help.kiavash.com/hc/en-us/sections/4406370087053-Advanced-Features",tooltip:this.controller.s("graphing-calculator-heading-functions-menu-advanced")}}}getPolarSection(){return{title:this.controller.s("graphing-calculator-heading-functions-menu-polar"),id:"polar",keys:["rho","theta","phi"],helpLink:{url:"https://help.kiavash.com/hc/en-us/articles/15824510769805",tooltip:this.controller.s("graphing-calculator-heading-functions-menu-polar")}}}getSoundSection(){return{title:this.controller.s("graphing-calculator-heading-functions-menu-sound"),id:"sound",keys:["tone"],helpLink:{url:"https://help.kiavash.com/hc/en-us/articles/21373904717197-Tone",tooltip:this.controller.s("graphing-calculator-heading-functions-menu-sound")}}}getComplexSection(){return{title:this.controller.s("graphing-calculator-heading-functions-menu-complex"),id:"complex",keys:["real","imag","conj","arg"]}}getKeypadKeys(){let r=[this.getTrigSection(),this.getInverseTrigSection(),this.getStatsSection(),this.getListFunctions()];return this.controller.areDistributionsEnabled()&&(this.controller.isThreeDMode()||r.push(this.getVisualizationsSection()),r.push(this.getDistributionsSection()),r.push(this.getStatTests())),r.push(this.getCalculusSection()),r.push(this.getHyperbolicTrigSection()),this.controller.is3dProduct()&&r.push(this.getPolarSection()),this.controller.isGeometry()?(r.push(this.getGeometryTools()),r.push(this.getGeometryMeasurements()),r.push(this.getGeometryTransformations())):r.push(this.getCalculatorGeometryMethods()),r.push(this.getColorsSection()),this.controller.toneAllowed()&&r.push(this.getSoundSection()),r.push(this.getMiscSection()),this.controller.isComplexModeEnabled()&&r.push(this.getComplexSection()),this.controller.areActionsEnabled()&&r.push(this.getAdvancedSection()),r}b(r){return G(this,r,{style:"popover"})}};var tf=__dcg_shared_module_exports__['e'](Z());var Rv=__dcg_shared_module_exports__['e'](Z()),dt=class extends Rv.Class{template(){return Rv.createElement("div",{class:Rv.const("dcg-keypad-row")},this.props.children)}};var NA=class extends on{template(){return tf.createElement(xo,{controller:this.props.controller},tf.createElement(dt,null,G(this,"a"),G(this,"b"),G(this,"c"),G(this,"d"),G(this,"e"),G(this,"f"),G(this,"g"),G(this,"h"),G(this,"i"),G(this,"j")),tf.createElement(dt,null,G(this,"k"),G(this,"l"),G(this,"m"),G(this,"n"),G(this,"o"),G(this,"p"),G(this,"q"),G(this,"r"),G(this,"s"),G(this,"t")),tf.createElement(dt,null,G(this,"shift",{style:"highlight"}),G(this,"u"),G(this,"v"),G(this,"w"),G(this,"x"),G(this,"y"),G(this,"z"),G(this,"theta"),G(this,"backspace",{colspan:2,style:"highlight"})),tf.createElement(dt,null,G(this,"123",{colspan:2,style:"highlight"}),G(this,"a_b"),G(this,"!%_left"),G(this,"[]_left"),G(this,"{}_left"),G(this,this.controller.getGraphSettings().config.customRegressions?"~:_left":":"),tf.const(" "),G(this,",'_left"),G(this,"enter",{colspan:2,style:"blue"})))}};var Fv=__dcg_shared_module_exports__['e'](Z());var BA=class extends on{template(){return Fv.createElement(xo,{controller:this.props.controller},Fv.createElement(dt,null,G(this,"A"),G(this,"B"),G(this,"C"),G(this,"D"),G(this,"E"),G(this,"F"),G(this,"G"),G(this,"H"),G(this,"I"),G(this,"J")),Fv.createElement(dt,null,G(this,"K"),G(this,"L"),G(this,"M"),G(this,"N"),G(this,"O"),G(this,"P"),G(this,"Q"),G(this,"R"),G(this,"S"),G(this,"T")),Fv.createElement(dt,null,G(this,"shift",{style:"highlight"}),G(this,"U"),G(this,"V"),G(this,"W"),G(this,"X"),G(this,"Y"),G(this,"Z"),G(this,"tau"),G(this,"backspace",{colspan:2,style:"highlight"})),Fv.createElement(dt,null,G(this,"123",{colspan:2,style:"highlight"}),G(this,"a^b"),G(this,"!%_right"),G(this,"[]_right"),G(this,"{}_right"),G(this,this.controller.getGraphSettings().config.customRegressions?"~:_right":":"),G(this,",'_right"),G(this,"enter",{colspan:2,style:"blue"})))}};var Ys=__dcg_shared_module_exports__['e'](Z());var{IfElse:Zme}=Ys.Components,UA=class extends on{template(){return Ys.createElement(xo,{controller:this.props.controller},Ys.createElement(dt,null,G(this,"boldX"),G(this,"boldY"),Zme(()=>this.props.controller().isComplexModeEnabled(),{false:()=>G(this,"a^2"),true:()=>G(this,"i")}),G(this,"a^b"),Ko(.5),G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"division"),Ko(.5),Ys.createElement(Vr,{command:this.const("functions"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-functions"),colspan:this.const(2),style:this.const("highlight"),active:()=>this.controller.isKeypadFunctionsPopoverOpen(),onTap:()=>this.dispatch({type:"keypad/functions"}),ariaControls:this.const(`dcg-functions-popover-${on.uuid}`),ariaExpanded:()=>this.controller.isKeypadFunctionsPopoverOpen()},this.bindFn(this.getFuncsBtnText))),Ys.createElement(dt,null,G(this,"("),G(this,")"),G(this,"<"),G(this,">"),Ko(.5),G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"multiplication"),Ko(.5),G(this,"left",{style:"highlight"}),G(this,"right",{style:"highlight"})),Ys.createElement(dt,null,G(this,"|a|"),G(this,","),G(this,"<="),G(this,">="),Ko(.5),G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"-"),Ko(1),G(this,"backspace",{colspan:1.5,style:"highlight"})),Ys.createElement(dt,null,Ys.createElement(Vr,{command:Ys.const("ABC"),colspan:this.const(1),additionalClass:this.const("dcg-abc-button--one-column"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-toggle-letters"),style:this.const("highlight"),onTap:()=>{this.dispatch({type:"keypad/abc"})}},()=>this.controller.getLayoutMeasurements().width<=600?this.controller.raw("ABC"):this.controller.raw("A B C")),Ys.createElement(Vr,{command:Ys.const("Audio"),disabled:()=>!this.controller.canAudioTrace(),ariaLabel:()=>this.controller.s("graphing-calculator-narration-toggle-audio-trace"),colspan:this.const(1),style:()=>"highlight",onTap:()=>this.dispatch({type:"keypad/audio-trace",command:"on"})},Ys.createElement("i",{class:Ys.const("dcg-icon-volume"),"aria-hidden":Ys.const("true")})),G(this,"sqrt"),G(this,"pi"),Ko(.5),G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight"}),G(this,"="),G(this,"+"),Ko(.5),G(this,"enter",{colspan:2,style:"blue"})))}getFuncsBtnText(){return this.controller.isNarrow()?this.controller.s("graphing-calculator-button-funcs"):this.controller.s("graphing-calculator-button-functions")}};var cd=__dcg_shared_module_exports__['e'](Z());var{If:efe}=cd.Components,qA=class extends on{template(){return cd.createElement(xo,{controller:this.props.controller},cd.createElement(dt,null,G(this,"boldX"),G(this,"boldY"),G(this,"boldZ"),G(this,"a^b"),Ko(.5),G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"division"),Ko(.5),cd.createElement(Vr,{command:this.const("functions"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-functions"),colspan:this.const(2),style:this.const("highlight"),active:()=>this.controller.isKeypadFunctionsPopoverOpen(),onTap:()=>this.dispatch({type:"keypad/functions"}),ariaControls:this.const(`dcg-functions-popover-${on.uuid}`),ariaExpanded:()=>this.controller.isKeypadFunctionsPopoverOpen()},this.bindFn(this.getFuncsBtnText))),cd.createElement(dt,null,G(this,"("),G(this,")"),G(this,"<"),G(this,">"),Ko(.5),G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"multiplication"),Ko(.5),G(this,"left",{style:"highlight"}),G(this,"right",{style:"highlight"})),cd.createElement(dt,null,G(this,"|a|"),G(this,","),G(this,"<="),G(this,">="),Ko(.5),G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"-"),Ko(1),G(this,"backspace",{colspan:1.5,style:"highlight"})),cd.createElement(dt,null,cd.createElement(Vr,{command:cd.const("ABC"),colspan:()=>this.controller.isComplexModeEnabled()?1:2,additionalClass:()=>this.controller.isComplexModeEnabled()?"dcg-abc-button--one-column":void 0,ariaLabel:()=>this.controller.s("graphing-calculator-narration-toggle-letters"),style:this.const("highlight"),onTap:()=>{this.dispatch({type:"keypad/abc"})}},()=>this.controller.isComplexModeEnabled()&&this.controller.getLayoutMeasurements().width<=600?this.controller.raw("ABC"):this.controller.raw("A B C")),cd.createElement(efe,{predicate:()=>this.controller.isComplexModeEnabled()},()=>G(this,"i")),G(this,"sqrt"),G(this,"pi"),Ko(.5),G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight"}),G(this,"="),G(this,"+"),Ko(.5),G(this,"enter",{colspan:2,style:"blue"})))}getFuncsBtnText(){return this.controller.isNarrow()?this.controller.s("graphing-calculator-button-funcs"):this.controller.s("graphing-calculator-button-functions")}};var Nv=__dcg_shared_module_exports__['e'](Z());var zA=class extends on{template(){return Nv.createElement(xo,{controller:this.props.controller},Nv.createElement(dt,null,G(this,"q"),G(this,"w"),G(this,"e"),G(this,"r"),G(this,"t"),G(this,"y"),G(this,"u"),G(this,"i"),G(this,"o"),G(this,"p")),Nv.createElement(dt,null,G(this,"a"),G(this,"s"),G(this,"d"),G(this,"f"),G(this,"g"),G(this,"h"),G(this,"j"),G(this,"k"),G(this,"l"),G(this,"theta")),Nv.createElement(dt,null,G(this,"shift",{colspan:1.364,style:"highlight"}),Ko(.136),G(this,"z"),G(this,"x"),G(this,"c"),G(this,"v"),G(this,"b"),G(this,"n"),G(this,"m"),Ko(.136),G(this,"backspace",{colspan:1.364,style:"highlight"})),Nv.createElement(dt,null,G(this,"123",{colspan:1.818,style:"highlight"}),Ko(.182),G(this,"a_b"),G(this,"!%_left"),G(this,"[]_left"),G(this,"{}_left"),G(this,this.controller.getGraphSettings().config.customRegressions?"~:_left":":"),G(this,",'_left"),Ko(.182),G(this,"enter",{colspan:1.818,style:"blue"})))}};var Bv=__dcg_shared_module_exports__['e'](Z());var HA=class extends on{template(){return Bv.createElement(xo,{controller:this.props.controller},Bv.createElement(dt,null,G(this,"Q"),G(this,"W"),G(this,"E"),G(this,"R"),G(this,"T"),G(this,"Y"),G(this,"U"),G(this,"I"),G(this,"O"),G(this,"P")),Bv.createElement(dt,null,G(this,"A"),G(this,"S"),G(this,"D"),G(this,"F"),G(this,"G"),G(this,"H"),G(this,"J"),G(this,"K"),G(this,"L"),G(this,"tau")),Bv.createElement(dt,null,G(this,"shift",{colspan:1.364,active:!0,style:"highlight"}),Ko(.136),G(this,"Z"),G(this,"X"),G(this,"C"),G(this,"V"),G(this,"B"),G(this,"N"),G(this,"M"),Ko(.136),G(this,"backspace",{colspan:1.364,style:"highlight"})),Bv.createElement(dt,null,G(this,"123",{colspan:1.818,style:"highlight"}),Ko(.182),G(this,"a^b"),G(this,"!%_right"),G(this,"[]_right"),G(this,"{}_right"),G(this,this.controller.getGraphSettings().config.customRegressions?"~:_right":":"),G(this,",'_right"),Ko(.182),G(this,"enter",{colspan:1.818,style:"blue"})))}};var{SwitchUnion:tfe,If:gB}=fr.Components,KA=class extends on{template(){return fr.createElement("div",{class:fr.const("dcg-keypad"),role:fr.const("region"),"aria-label":()=>this.controller.s("shared-calculator-narration-keypad")},fr.createElement("div",{class:()=>({"dcg-keys-container":!0,"dcg-smaller-functions-text":this.controller.getLayoutMeasurements().width<650,"dcg-small-ABC":this.controller.getLayoutMeasurements().width<490,"dcg-smaller-ABC":this.controller.getLayoutMeasurements().width<420,"dcg-smallest-ABC":this.controller.getLayoutMeasurements().width<380}),style:this.bindFn(this.computeStyles),didMount:this.bindFn(this.didMountContainer),"aria-hidden":()=>!this.controller.isKeypadOpen()},fr.createElement("div",{class:fr.const("dcg-keys-background dcg-do-not-blur")},fr.createElement("div",{class:fr.const("dcg-keys")},tfe(()=>this.controller.getKeypadLayout(),{letters:()=>fr.createElement(zA,{controller:this.props.controller}),capitalLetters:()=>fr.createElement(HA,{controller:this.props.controller}),mainNumbers:()=>fr.createElement(UA,{controller:this.props.controller}),mainNumbers3D:()=>fr.createElement(qA,{controller:this.props.controller}),noQwertyLetters:()=>fr.createElement(NA,{controller:this.props.controller}),noQwertyCapitalLetters:()=>fr.createElement(BA,{controller:this.props.controller}),audio:()=>fr.createElement(OA,{controller:this.props.controller})}),fr.createElement(gB,{predicate:()=>this.controller.isKeypadFunctionsPopoverOpen()},()=>fr.createElement(FA,{controller:this.props.controller}))),fr.createElement(gB,{predicate:()=>this.controller.isHideKeypadButtonVisible()},()=>fr.createElement("div",{class:fr.const("dcg-minimize-keypad-container")},fr.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-hide-keypad"),gravity:this.const("n"),offset:this.const({left:6})},fr.createElement("div",{role:fr.const("button"),"aria-expanded":fr.const("true"),"aria-controls":this.const(on.uuid),"aria-label":()=>this.controller.s("graphing-calculator-label-hide-keypad"),class:fr.const("dcg-minimize-keypad"),onTap:()=>{this.controller.dispatch({type:"keypad/set-minimized",minimized:!0})}},fr.createElement("i",{class:fr.const("dcg-icon-keyboard"),"aria-hidden":fr.const("true")}),fr.createElement("i",{class:fr.const("dcg-icon-caret-down"),"aria-hidden":fr.const("true")}))))))),fr.createElement(gB,{predicate:this.bindFn(this.isShowKeypadButtonVisible)},()=>fr.createElement("div",{class:fr.const("dcg-show-keypad-container")},fr.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-show-keypad"),gravity:this.const("n")},fr.createElement("div",{role:fr.const("button"),"aria-expanded":fr.const("false"),"aria-controls":this.const(on.uuid),"aria-label":()=>this.controller.s("graphing-calculator-label-show-keypad"),class:fr.const("dcg-btn-flat-gray dcg-show-keypad dcg-do-not-blur"),onTap:()=>{this.controller.dispatch({type:"keypad/set-minimized",minimized:!1})}},fr.createElement("i",{class:fr.const("dcg-icon-keyboard"),"aria-hidden":fr.const("true")}),fr.createElement("i",{class:fr.const("dcg-icon-caret-up dcg-do-not-blur"),"aria-hidden":fr.const("true")}))))))}didMountContainer(r){this.containerElt=r}isShowKeypadButtonVisible(){return this.controller.getBrailleMode()!=="none"?!1:!this.controller.isKeypadOpen()&&!this.controller.isNarrow()&&!this.controller.isInEditListMode()&&(this.controller.isListVisible()||this.controller.inAudioTraceMode())}didMount(){this.updatePopoverPosition()}didUpdate(){this.updatePopoverPosition()}computeStyles(){let r={};return this.controller.isNarrow()||(r.transition="transform .3s, opacity .3s"),this.controller.isKeypadOpen()||(r.opacity="0",r.transform="translate3d(0, 255px, 0)"),r}updatePopoverPosition(){if(!this.controller.isKeypadFunctionsPopoverOpen()){this.__popoverCache=void 0;return}let r=this.controller.computeMajorLayout(),e={keypadTop:r.keypad.top,keypadWidth:r.keypad.width,keypadHeight:r.keypad.height,showToLeft:r.grapher.height<525};if(__dcg_shared_module_exports__['J'](e,this.__popoverCache))return;this.__popoverCache=e;let t=this.containerElt,o=t.querySelector("[dcg-command=functions]"),i=t.querySelector(".dcg-functions-popover"),n=t.querySelector(".dcg-arrow");if(e.showToLeft){i.classList.remove("dcg-top"),i.classList.add("dcg-left");let s=e.keypadHeight-(wi(o).top-wi(t).top)-o.offsetHeight/2-2-10;n.style.left="auto",n.style.bottom=`${s}px`}else i.classList.remove("dcg-left"),i.classList.add("dcg-top"),n.style.left=`${i.offsetWidth-o.offsetWidth/2}px`,n.style.bottom="auto"}};$t();$t();var rfe=function(){{let o=!1,i=function(){n(document),o=!0},n=function(a){o||re(a).bind("touchstart",s=>{let l=re(s.target),c=0,d=null;if(!l[0].closest("[disablescroll]"))for(;c===0&&l.length&&l[0].tagName!==void 0;){let p=getComputedStyle(l[0]).overflow,u=getComputedStyle(l[0]).overflowY;if(p!=="hidden"&&p!=="visible"&&u!=="hidden"&&u!=="hidden"){let h=l.scrollTop();h!==0&&(c=2),l.scrollTop(h+1),l.scrollTop()!==h&&(c=1|c,l.scrollTop(h))}l=re(l[0].parentElement)}if(c!==0){d=[];let p=s.originalEvent.touches;for(let u=0;u<p.length;u++){let h={};for(let m in p[u])p[u].hasOwnProperty(m)&&(h[m]=p[u][m]);d.push(h)}}re(document).on("touchmove.scrollfix",p=>{if(d){let u=d[0],m=p.originalEvent.touches[0].screenY-u.screenY;(m>0&&!(c&2)||m<0&&!(c&1))&&(c=0),m&&(d=null)}c===0&&p.preventDefault()}),re(document).on("touchend.scrollfix",()=>{re(document).off(".scrollfix")})})};return{limitScrollOnElement:n,limitScrollOnDocument:i}}}();var{limitScrollOnElement:WA,limitScrollOnDocument:eZ}=rfe;$t();function wS(r){re(r).on("drag dragend dragenter dragover dragleave drop",t=>{t.preventDefault(),t.stopPropagation()})}var $o=__dcg_shared_module_exports__['e'](Z());var Di=__dcg_shared_module_exports__['e'](Z());var Mc=__dcg_shared_module_exports__['e'](Z());var Es=__dcg_shared_module_exports__['e'](Z());function tZ(r){if(!r)return;let e=[];for(let t of r.split(" ")){let o=t.indexOf("|"),i=o!==-1?t.slice(0,o):t;e.push(i)}return e}function Uv(r,e,t){let o=tZ(t);return e==="nemeth"?Hh(r,{operatorNames:o}):e==="ueb"?Kh(r,{operatorNames:o}):{isError:!0,error:"Braille mode should be 'nemeth' or 'ueb'"}}function $A(r,e,t){let o=tZ(t);return e==="nemeth"?w3(r,{operatorNames:o}):e==="ueb"?v3(r,{operatorNames:o}):{isError:!0,error:"Braille mode should be 'nemeth' or 'ueb'"}}var qv=__dcg_shared_module_exports__['e'](Z());$t();var{Input:ofe}=qv.Components,iy=class extends qv.Class{init(){this.ASCIICharacters=` A1B'K2L@CIF/MSP"E3H9O6R^DJG>NTQ,*5<-U8V.%[$+X!&;:4\\0Z7(_?W]#Y)=`,this.ASCIITable=[],this.HomeRowCharacters="FDSJKL",this.charCodes=[],this.sixKeyModel={keysDown:0,stickyKeysDown:0};let e;for(e=0;e<this.ASCIICharacters.length;e++)this.ASCIITable.push(this.ASCIICharacters.charCodeAt(e));for(e=0;e<this.HomeRowCharacters.length;e++)this.charCodes.push(this.HomeRowCharacters.charCodeAt(e))}template(){return qv.createElement(ofe,{class:this.const("dcg-braille-input dcg-do-blur"),tabIndex:()=>this.props.tabIndex?this.props.tabIndex():0,readOnly:()=>this.props.isStatic()?!0:void 0,autocomplete:this.const("off"),autocorrect:this.const("off"),autocapitalize:this.const("off"),spellcheck:this.const("false"),onKeyDown:this.bindFn(this.onKeydown),onKeyUp:this.bindFn(this.onKeyUp),onInput:this.bindFn(this.props.onInput),value:()=>this.props.value(),"aria-label":()=>this.props.ariaLabel()||Bs(""),didMount:this.bindFn(this.didMount),didUnmount:this.bindFn(this.props.didUnmount),placeholder:()=>this.props.placeholder?this.props.placeholder():"",size:()=>this.props.size&&this.props.size()})}didMount(e){this.rootNode=e,re(this.rootNode).on("focus",t=>{this.props.shouldFocus()||this.props.onFocusedChanged(!0,t.originalEvent||t)}).on("blur",t=>{this.props.shouldFocus()&&this.props.onFocusedChanged(!1,t.originalEvent||t)}),this.props.didMount(e),this.updateFocus()}didUpdate(){this.updateFocus()}updateFocus(){this.rootNode&&(this.props.shouldFocus()&&document.activeElement!==this.rootNode&&this.rootNode.focus(),!this.props.shouldFocus()&&document.activeElement===this.rootNode&&this.rootNode.blur())}onKeydown(e){let t=this.charCodes.indexOf(e.which);!this.props.isStatic()&&this.isSixKeyInput()&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&t!==-1?(this.sixKeyModel={...this.sixKeyModel,keysDown:this.addKey(this.sixKeyModel.keysDown,t),stickyKeysDown:this.addKey(this.sixKeyModel.stickyKeysDown,t)},e.preventDefault()):this.props.onKeyDown&&this.props.onKeyDown(e)}onKeyUp(e){let t=this.charCodes.indexOf(e.which),o=!1;return!this.props.isStatic()&&this.isSixKeyInput()&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&t!==-1?(this.sixKeyModel={...this.sixKeyModel,keysDown:this.removeKey(this.sixKeyModel.keysDown,t)},this.sixKeyModel.keysDown===0&&(this.addCharacter(this.bitsToASCII(this.sixKeyModel.stickyKeysDown)),this.sixKeyModel={...this.sixKeyModel,stickyKeysDown:0})):o=!0,o||e.preventDefault(),o}addKey(e,t){return e|1<<t}removeKey(e,t){return e&~(1<<t)}bitsToASCII(e){return String.fromCharCode(this.ASCIITable[e])}addCharacter(e){this.rootNode&&!this.props.isStatic()&&(this.rootNode.setRangeText(e,this.rootNode.selectionStart,this.rootNode.selectionEnd,"end"),this.props.onInput(this.rootNode.value))}isSixKeyInput(){return typeof this.props.sixKeyInput=="function"&&this.props.sixKeyInput()}};var{If:fB}=Es.Components,Ai=class extends Es.Class{init(){this.currentBrailleValue=this.getBrailleFromLatex(this.props.latex()),this.currentBrailleMode=this.props.mode(),this.hasTranslationError=!1,this.currentLatex=this.props.latex()}isFocused(){return this.brailleInput!==void 0&&document.activeElement==this.brailleInput}getBrailleShouldFocus(){return this.props.mode()!=="none"&&this.props.brailleShouldFocus&&this.props.brailleShouldFocus()}isStatic(){return!!this.props.isStatic&&this.props.isStatic()}isInline(){return!!this.props.isInline&&this.props.isInline()}hasError(){return!!this.props.hasError&&this.props.hasError()}willUpdate(){let e=this.currentLatex!==this.props.latex(),t=this.props.mode(),o=t!==this.currentBrailleMode&&t!=="none";this.isFocused()&&!e&&!o||(this.currentLatex=this.props.latex(),(o||!this.hasTranslationError||e||this.isStatic())&&(this.currentBrailleValue=this.getBrailleFromLatex(this.props.latex()),this.hasTranslationError=!1),this.currentBrailleMode=t)}onBrailleInput(e){if(!this.props.onBrailleInput)return;let t=this.getLatexFromBraille(e);this.hasTranslationError=t.isError;let o=this.props.capExpressionSize&&this.props.capExpressionSize();if(!t.isError&&o&&o.exceedsLimit(t.value)){o.onExpressionSizeExceeded();return}this.currentBrailleValue=e,t.isError||(this.currentLatex=t.value,this.props.onBrailleInput(t.value))}getBrailleFromLatex(e,t=!1){let o=Uv(e,this.props.mode(),this.props.operatorNames&&this.props.operatorNames());return o.isError?"":t?o.value:Ks.toExpandedBrailleAscii(o.value)}getLatexFromBraille(e){return $A(Ks.coerceToSixDotCells(e),this.props.mode(),this.props.operatorNames&&this.props.operatorNames())}getBrailleLabel(e){return this.getBrailleFromLatex(e.replace(/\s/,"\\ "))}shouldShowBraille(){let e=this.props.mode();return e==="nemeth"||e==="ueb"}isOverflowingLeft(){return this.brailleInput?this.brailleInput.scrollLeft>0:!1}isOverflowingRight(){if(!this.brailleInput)return!1;let e=this.brailleInput.getBoundingClientRect().width,t=this.brailleInput.scrollWidth,o=this.brailleInput.scrollLeft;return t>e+o+2}didMountBrailleInput(e){this.brailleInput=e}didUnmountBrailleInput(){this.brailleInput=void 0}handleBrailleFocusChanged(e,t){this.props.onBrailleFocusedChanged&&this.props.onBrailleFocusedChanged(e,t),this.brailleInput&&(e&&this.props.selectOnFocus&&this.props.selectOnFocus()&&this.brailleInput.select(),this.isStatic()&&this.brailleInput.scrollTo(0,0))}getTooltipText(){let e=this.props.placeholder&&!this.isFocused()?this.props.placeholder():"";return Bs(this.props.latex()||e)}template(){return Es.createElement("div",{class:Es.const("dcg-mathquill-wrapper")},Es.createElement(fB,{predicate:()=>this.shouldShowBraille()},()=>Es.createElement("div",{class:()=>({"dcg-mathquill-braille":!0,"dcg-text-selectable":this.isStatic(),"dcg-focus":this.getBrailleShouldFocus(),"dcg-invalid":this.hasError(),"dcg-mathquill-static-braille":this.isStatic(),"dcg-mathquill-braille-overflow-left":this.isOverflowingLeft(),"dcg-mathquill-braille-overflow-right":this.isOverflowingRight()}),"data-dcg-label":()=>this.props.dataLabelAttributeValue?this.props.dataLabelAttributeValue():void 0},Es.createElement(cv,{tooltip:()=>this.getTooltipText(),gravity:this.const("s"),delay:this.const(0),showOnTapstart:this.const(!0)},Es.createElement(fB,{predicate:()=>this.isInline()},()=>Es.createElement("span",{class:Es.const("dcg-inline-braille")},()=>Bs(this.getBrailleFromLatex(this.props.latex(),!0)))),Es.createElement(fB,{predicate:()=>!this.isInline()},()=>Es.createElement(iy,{ariaLabel:()=>Bs(this.props.ariaLabel?this.getBrailleLabel(this.props.ariaLabel()):""),didMount:this.bindFn(this.didMountBrailleInput),didUnmount:this.bindFn(this.didUnmountBrailleInput),onFocusedChanged:this.bindFn(this.handleBrailleFocusChanged),shouldFocus:this.bindFn(this.getBrailleShouldFocus),onKeyDown:this.props.onBrailleKeydown,onInput:this.bindFn(this.onBrailleInput),sixKeyInput:this.props.sixKeyInput,value:()=>this.currentBrailleValue,placeholder:()=>Bs(this.props.placeholder?this.getBrailleFromLatex(this.props.placeholder()):""),tabIndex:()=>this.props.tabIndex?this.props.tabIndex():0,isStatic:this.bindFn(this.isStatic),size:()=>this.currentBrailleValue&&this.currentBrailleValue.length||1}))))),Es.createElement("div",{class:Es.const("dcg-typeset-math"),style:()=>({display:this.shouldShowBraille()&&!this.isInline()?"none":void 0}),"aria-hidden":()=>this.shouldShowBraille()},this.props.children))}};function Yl(){if(!(!document.activeElement||!document.activeElement.classList.contains("dcg-braille-input")))return document.activeElement}function zv(r){return!r||r.value===""}var So=__dcg_shared_module_exports__['e'](Z());var rZ=__dcg_shared_module_exports__['e'](Z());function ife(r){let e=r.target;return e.classList.contains("dcg-exp-action-button")||e.classList.contains("dcg-icon-duplicate")||e.classList.contains("dcg-icon-remove")||e.classList.contains("dcg-icon-lock")||e.classList.contains("dcg-icon-pencil")}var Xl=class extends rZ.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id,this._isFirstRender=!0,this._isDragCopy=this.props.isDragCopy()}onItemViewMounted(e){this._isDragCopy||(this.model.rootViewNode=e),this._isFirstRender=!1}onItemViewUnmounted(){this._isDragCopy||(this.model.rootViewNode=void 0)}isFirstRender(){return this._isFirstRender}onMouseSelect(e){if(this.controller.isInEditListMode()&&!ife(e)){this.exitEditListMode();return}this.controller.isItemReadonly(this.id)||e.type==="dcg-tap"&&e.device==="mouse"||e.type==="dcg-tapstart"&&e.device==="touch"||e.wasHandled()||(e.handle(),this.controller.dispatch({type:"set-selected-id",id:this.id,state:"selected"}))}onDragPending(e){this.controller.isItemReadonly(this.model.id)||this.props.onDragPending(e)}exitEditListMode(){this.controller.dispatch({type:"set-edit-list-mode",isEditListMode:!1,focusExpressionList:!0})}};var Cr=__dcg_shared_module_exports__['e'](Z());var{If:bB}=Cr.Components,qd=class extends Cr.Class{init(){this.controller=this.props.controller()}template(){return Cr.createElement(bB,{predicate:this.bindFn(this.shouldShowOptions)},()=>Cr.createElement("span",{class:()=>({"dcg-expression-edit-actions":!0,"dcg-limited-height":this.limitedHeight()}),didMount:()=>{this.controller.isInEditListMode()&&Te(this.controller.s("graphing-calculator-narration-edit-list-mode-on"))},didUnmount:()=>{this.controller.isInEditListMode()||Te(this.controller.s("graphing-calculator-narration-edit-list-mode-off"))}},Cr.createElement("span",{class:Cr.const("dcg-graphic"),handleEvent:Cr.const("true")}),Cr.createElement(bB,{predicate:()=>tb(this.model())!==void 0},()=>Cr.createElement(ze,{tooltip:this.bindFn(this.getConvertTooltip),gravity:this.const("s")},Cr.createElement("span",{class:Cr.const("dcg-action-createtable dcg-exp-action-button"),handleEvent:Cr.const("true"),role:Cr.const("button"),tabIndex:Cr.const("0"),"aria-label":()=>Lo(this.model(),"create_table"),onTap:this.bindFn(this.onCreateTable)},Cr.createElement("i",{class:Cr.const("dcg-icon-table"),"aria-hidden":Cr.const("true")})))),Cr.createElement(bB,{predicate:()=>this.controller.shouldShowAuthorFeatures()},()=>Cr.createElement(ze,{tooltip:this.bindFn(this.getReadonlyToggleLabel),gravity:this.const("s")},Cr.createElement("span",{class:()=>({"dcg-action-lock":!0,"dcg-exp-action-button":!0,"dcg-selected":this.isReadonly()}),handleEvent:Cr.const("true"),role:Cr.const("button"),tabIndex:Cr.const("0"),"aria-label":this.bindFn(this.getReadonlyToggleLabel),onTap:this.bindFn(this.onToggleReadonly)},Cr.createElement("i",{class:Cr.const("dcg-icon-lock"),"aria-hidden":Cr.const("true")})))),Cr.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-duplicate-expression-tooltip"),gravity:this.const("s")},Cr.createElement("span",{class:Cr.const("dcg-duplicate-btn dcg-exp-action-button"),handleEvent:Cr.const("true"),role:Cr.const("button"),tabIndex:Cr.const("0"),"aria-label":()=>Lo(this.model(),"duplicate"),onTap:this.bindFn(this.onDuplicateWithoutFocus)},Cr.createElement("i",{class:Cr.const("dcg-icon-duplicate"),"aria-hidden":Cr.const("true")}))),Cr.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-expression-delete-tooltip"),gravity:this.const("s")},Cr.createElement("span",{class:Cr.const("dcg-delete-btn dcg-exp-action-button"),handleEvent:Cr.const("true"),role:Cr.const("button"),tabIndex:Cr.const("0"),"aria-label":()=>Lo(this.model(),"delete"),onTap:this.bindFn(this.onDelete)},Cr.createElement("i",{class:Cr.const("dcg-icon-remove"),"aria-hidden":Cr.const("true")})))))}shouldShowOptions(){return this.controller.isInEditListMode()&&(this.controller.shouldShowAuthorFeatures()||!this.controller.isItemReadonly(this.props.id()))}model(){return this.controller.getItemModel(this.props.id())}getConvertTooltip(){return k_(this.model())?this.controller.s("graphing-calculator-label-create-table"):this.controller.s("graphing-calculator-label-convert-to-table-tooltip")}limitedHeight(){let e=this.model();return e&&(e.type==="image"||this.isSlider())}isSlider(){let e=this.model();return e&&e.type==="expression"&&e.sliderExists}onCreateTable(){let e=this.model();e&&this.controller.dispatch({type:"convert-or-create-table",index:e.index})}onDelete(e){this.controller.dispatch({type:"delete-item-and-animate-out",id:this.props.id(),setFocusAfterDelete:e.device==="keyboard"})}onDuplicateWithoutFocus(){let e=this.model();e&&(e.type==="folder"?this.controller.dispatch({type:"duplicate-folder",id:this.props.id()}):this.controller.dispatch({type:"duplicate-expression",id:this.props.id()}))}isReadonly(){return this.controller.isItemMarkedReadonly(this.props.id())}onToggleReadonly(){let e=this.model();e&&this.controller.dispatch({type:"set-item-readonly",id:this.props.id(),readonly:!e.readonly})}getReadonlyIcon(){return this.isReadonly()?"dcg-icon-lock":"dcg-icon-pencil"}getReadonlyToggleLabel(){return this.isReadonly()?this.controller.s("graphing-calculator-label-unlock-expression-tooltip"):this.controller.s("graphing-calculator-label-lock-expression-tooltip")}};var ei=__dcg_shared_module_exports__['e'](Z());var nn=__dcg_shared_module_exports__['e'](Z());var{If:nfe}=nn.Components,ny=class extends nn.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return nn.createElement("div",{class:nn.const("dcg-action-info"),handleEvent:nn.const("true")},nn.createElement("span",{class:nn.const("dcg-action-label")},nn.const("Run ")),nn.createElement(Ai,{isStatic:this.const(!0),latex:()=>this.model.clickableInfo.latex,operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.controller.s("graphing-calculator-label-ticker-min-step"),brailleShouldFocus:this.const(!1),...wn(this.controller)},nn.createElement(Et,{latex:()=>this.model.clickableInfo.latex,config:this.bindFn(this.getMQConfig),tokenController:this.props.controller})),nn.createElement("span",{class:nn.const("dcg-action-label")},nn.const(" on click")),nn.createElement(nfe,{predicate:()=>!this.controller.isItemReadonly(this.model.id)},()=>nn.createElement("span",{class:nn.const("dcg-click-edit"),role:nn.const("button"),tabIndex:nn.const("0"),"aria-label":()=>this.controller.s("graphing-calculator-narration-edit-action"),onTap:this.bindFn(this.editAction)},nn.createElement("i",{class:nn.const("dcg-icon-pencil"),"aria-hidden":nn.const("true")}))))}editAction(){this.model.type==="expression"?this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"expression",model:this.model,guid:this.getMenuGUID(),focusFirstOption:!1}}):this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"image",model:this.model,guid:this.getMenuGUID(),focusFirstOption:!1}}),this.controller.dispatch({type:"set-focus-location",location:{type:"expression-menu",id:this.model.id,location:"updaterule"}})}getMenuGUID(){return this.model.guid}getMQConfig(){return this.controller.getMathquillConfig({additionalOperators:["index"]})}};var dd=__dcg_shared_module_exports__['e'](Z());var qn=__dcg_shared_module_exports__['e'](Z());var Ei=__dcg_shared_module_exports__['e'](Z());var jA=__dcg_shared_module_exports__['e'](Z());$t();var Hv=class extends jA.Class{template(){return jA.createElement(Et,{latex:this.props.latex,config:this.props.config,getAriaLabel:this.props.getAriaLabel,tokenController:this.props.tokenController,onUserPressedKey:this.props.onUserPressedKey,didMountMathquill:e=>this.didMountMathquill(e)})}didMountMathquill(e){var t,o;this.mathquillFocus=new Dx(e,re(e.el()),this.props),this.didUpdate(),(o=(t=this.props).didMountMathquill)==null||o.call(t,e)}willUnmount(){var e;(e=this.mathquillFocus)==null||e.willUnmount()}didUpdate(){var e;(e=this.mathquillFocus)==null||e.updateMathquillFocused()}};var{If:oZ,SwitchUnion:afe}=Ei.Components,ay=class extends Ei.Class{init(){this.controller=this.props.controller()}template(){return Ei.createElement("div",{class:Ei.const("dcg-evaluation-container")},Ei.createElement(oZ,{predicate:this.bindFn(this.displaySlowEvaluation)},()=>Ei.createElement(ze,{tooltip:()=>this.controller.s("shared-calculator-error-slow-evaluation"),sticky:this.const(!0),gravity:this.const("n")},Ei.createElement("span",{class:Ei.const("dcg-spinner"),"aria-hidden":Ei.const("true")}))),Ei.createElement("div",{class:()=>({"dcg-evaluation":!0,"dcg-do-blur":!0,"dcg-hidden":this.props.controller().isInEditListMode(),"dcg-slow-evaluation":this.displaySlowEvaluation()}),handleEvent:Ei.const("true"),onTap:this.bindFn(this.selectMQIfNothingSelected),tabIndex:()=>this.controller.getBrailleMode()==="none"&&this.getEvaluationRHS().type!=="number"?"0":"-1"},Ei.createElement(Ai,{latex:this.bindFn(this.getBrailleEvaluation),ariaLabel:this.const(""),brailleShouldFocus:()=>this.isFocused(),onBrailleInput:()=>{},onBrailleKeydown:e=>{e.stopPropagation();let t=Be(e);t&&this.handlePressedKey(t)},isStatic:this.const(!0),onBrailleFocusedChanged:e=>this.handleMQFocusedChanged(e),...wn(this.controller)},Ei.createElement("div",{class:Ei.const("dcg-evaluation-label-container")},Ei.createElement(oZ,{predicate:this.bindFn(this.shouldShowEquals)},()=>Ei.createElement("span",{class:Ei.const("dcg-equals")},Ei.createElement(Et,{latex:this.const("="),config:this.const({})})))),Ei.createElement("span",{class:()=>({"dcg-evaluation-html":!0,"dcg-color-evaluation":this.getEvaluationRHS().type==="rgbcolor"}),didMount:e=>{this.firstLineEvalNode=e}},afe("type",()=>this.getEvaluationRHS())({list:e=>Ei.createElement("span",{class:Ei.const("dcg-evaluation-list")},()=>this.controller.s("graphing-calculator-label-evaluation-list",{count:e().count})),number:e=>Ei.createElement(Hv,{latex:()=>e().valueLatex,config:this.const({tabbable:!0}),didMountMathquill:t=>this.staticMQ=t,isFocused:()=>this.isFocused(),onFocusedChanged:t=>this.handleMQFocusedChanged(t),onUserPressedKey:this.bindFn(this.handlePressedKey)}),undefined:()=>Ei.createElement("span",null,Ei.const("undefined")),rgbcolor:e=>Ei.createElement(Xh,{color:()=>e().colorValue,isEvaluation:this.const(!0),invertSwatches:()=>this.controller.invertSwatches(),ariaLabel:()=>e().ariaLabel})})))))}selectMQIfNothingSelected(){var t,o;if(this.getEvaluationRHS().type!=="number"||!this.staticMQ)return;let e=this.staticMQ.selection();e.startIndex===e.endIndex&&((t=this.staticMQ)==null||t.blur(),(o=this.staticMQ)==null||o.focus())}handlePressedKey(e){switch(e){case"Up":return this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.props.id()}}),!0;case"PageUp":case"PageDown":case"Down":case"Enter":return this.controller.dispatch({type:"on-special-key-pressed",key:e}),!0;case"Esc":return Jr(),!0}return!1}shouldShowEquals(){return this.getEvaluationRHS().type==="number"}getColorLabel(){let e=this.controller.getItemModel(this.props.id());if(!(!e||e.type!=="expression"))return aG(e,this.controller)}getEvaluationRHS(){var i,n,a;let e=(n=(i=this.props).val)==null?void 0:n.call(i),t=this.props.valueType();if(e===void 0||t===void 0)return{type:"undefined"};let o={valueType:t,value:e};switch(o.valueType){case __dcg_shared_module_exports__['Ka']:let s=__dcg_shared_module_exports__['cc'](o.value,{...__dcg_shared_module_exports__['Wb'],displayAsFraction:this.shouldDisplayAsFraction()});return s==="undefined"?{type:"undefined"}:{type:"number",valueLatex:s};case __dcg_shared_module_exports__['ma']:case __dcg_shared_module_exports__['na']:return{type:"rgbcolor",colorValue:Array.isArray(o.value)?{type:"color-array",value:o.value}:{type:"single-color",value:o.value},val:o.value,ariaLabel:this.getColorLabel()};case __dcg_shared_module_exports__['ba']:return __dcg_shared_module_exports__['Yb'](o.value,{...__dcg_shared_module_exports__['Vb'],displayAsFraction:this.shouldDisplayAsFraction()}).type==="undefined"?{type:"undefined"}:{type:"number",valueLatex:(a=__dcg_shared_module_exports__['_b'](o.value,{...__dcg_shared_module_exports__['Vb'],displayAsFraction:this.shouldDisplayAsFraction()}))!=null?a:""};default:return Array.isArray(o.value)?{type:"list",count:o.value.length}:{type:"undefined"}}}shouldDisplayAsFraction(){return this.props.controller().shouldEvaluationForItemDisplayAsFraction(this.props.id())}getBrailleEvaluation(){let e="";this.shouldShowEquals()&&(e+="=");let t=this.getEvaluationRHS();switch(t.type){case"list":e+=this.controller.s("graphing-calculator-label-evaluation-list",{count:t.count});break;case"number":e+=t.valueLatex;break;case"undefined":e="undefined";break;case"rgbcolor":e+=t.val;break;default:return t}return e}displaySlowEvaluation(){return this.controller.shouldShowProgressUpdateIcons()&&this.controller.isItemSlowInEvaluator(this.props.id())}isFocused(){let e=this.controller.getFocusLocation();return(e==null?void 0:e.type)==="expression-evaluation"&&e.id===this.props.id()}handleMQFocusedChanged(e){let t={type:"expression-evaluation",id:this.props.id()};e?this.controller.dispatch({type:"set-focus-location",location:t}):this.controller.dispatch({type:"blur-focus-location",location:t})}};var{If:iZ}=qn.Components,vS=class extends qn.Class{constructor(){super(...arguments),this.focusedValues={}}template(){return this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id,qn.createElement("div",{class:qn.const("dcg-cdf-footer-container dcg-do-blur"),tapboundary:qn.const("true"),handleEvent:qn.const("true")},qn.createElement(Gt,{checked:()=>mp(this.model),disabled:()=>kR(this.model)||this.controller.isItemReadonly(this.model.id),onChange:e=>{this.controller.dispatch({type:"set-show-cdf",id:this.model.id,showCDF:e})}},()=>this.controller.s("graphing-calculator-button-find-cdf")),qn.createElement(iZ,{predicate:()=>mp(this.model)},()=>qn.createElement("div",null,qn.createElement("span",{class:qn.const("dcg-cdf-limit-name")},()=>this.controller.s("graphing-calculator-label-cdf-minimum")),qn.createElement(zr,{handleFocusChanged:e=>this.handleFocusedChanged("min",e),latex:()=>aC(this.model),hasError:()=>!lC(this.model),isFocused:()=>this.isInputFocused("min"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-cdf-minimum"),placeholder:()=>c7(this.model),handlePressedKey:(e,t)=>this.handlePressedKey(e,t,"min"),controller:this.props.controller,handleLatexChanged:this.bindFn(this.updateCDFMin),readonly:()=>this.controller.isItemReadonly(this.model.id)}),qn.createElement("span",{class:qn.const("dcg-cdf-limit-name")},()=>this.controller.s("graphing-calculator-label-cdf-maximum")),qn.createElement(zr,{handleFocusChanged:e=>this.handleFocusedChanged("max",e),latex:()=>sC(this.model),hasError:()=>!cC(this.model),isFocused:()=>this.isInputFocused("max"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-cdf-maximum"),placeholder:()=>d7(this.model),handlePressedKey:(e,t)=>this.handlePressedKey(e,t,"max"),controller:this.props.controller,handleLatexChanged:this.bindFn(this.updateCDFMax),readonly:()=>this.controller.isItemReadonly(this.model.id)}),qn.createElement(iZ,{predicate:this.bindFn(this.showEvaluation)},()=>qn.createElement("div",{class:qn.const("dcg-cdf-evaluation-container")},qn.createElement(ay,{val:()=>jT(this.model),controller:this.props.controller,id:()=>this.model.id,valueType:this.const(__dcg_shared_module_exports__['ba'])}))))))}handlePressedKey(e,t,o){if(e==="Esc"){this.controller.dispatch({type:"set-focus-location",location:void 0});return}if(e==="Enter")return this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"});let i=Ze.getFocusedMathquill();i&&(i.keystroke(e,t),o==="min"&&aC(this.model)!==i.latex()&&this.updateCDFMin(i.latex()),o==="max"&&sC(this.model)!==i.latex()&&this.updateCDFMax(i.latex()))}updateCDFMax(e){this.controller.dispatch({type:"set-cdf-max",id:this.model.id,latex:e})}updateCDFMin(e){this.controller.dispatch({type:"set-cdf-min",id:this.model.id,latex:e})}showEvaluation(){return MT(this.model)}isInputFocused(e){let t=this.controller.getFocusLocation();return!t||t.type!=="cdf-limit"||t.id!==this.id?!1:t.location===e}handleFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"cdf-limit",id:this.id,location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"cdf-limit",id:this.id,location:e}})}};var ss=__dcg_shared_module_exports__['e'](Z());var{If:sfe,For:nZ,SwitchUnion:lfe}=ss.Components,Kv=class extends ss.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return lfe(this.bindFn(this.getSuggestionType),{list:()=>ss.createElement("div",{class:()=>({"dcg-parameter-suggestion-container":!0,"dcg-parameter-suggestion-braille":this.controller.getBrailleMode()!=="none"})},ss.createElement(nZ,{each:this.bindFn(this.getListOfParameters)},e=>ss.createElement("span",{class:ss.const("dcg-parameter-name")},()=>this.getParamName(e)))),listWithDefault:()=>ss.createElement("div",{class:()=>({"dcg-parameter-suggestion-container":!0,"dcg-parameter-suggestion-braille":this.controller.getBrailleMode()!=="none"}),onTap:this.bindFn(this.fillInDefaults)},ss.createElement(nZ,{each:this.bindFn(this.getListOfParameters)},e=>ss.createElement("span",{class:ss.const("dcg-parameter-name")},()=>this.getParamName(e),ss.createElement(sfe,{predicate:()=>this.shouldShowDefaultValue(e)},()=>ss.createElement("span",{class:ss.const("dcg-default-marker")},ss.const("= "),()=>this.getDefaultValue(e)))))),individual:()=>ss.createElement("div",{class:()=>({"dcg-parameter-suggestion-container":!0,"dcg-parameter-suggestion-braille":this.controller.getBrailleMode()!=="none"})},this.bindFn(this.getMissingRequiredParamText)),none:()=>{}})}getExtractedAndDefaultArgString(e){let{params:t,values:o,defaults:i}=e;return t.map((a,s)=>{let l=o[a],c=i[s];return l||c||""}).join(",")}fillInDefaults(){let e=Yc(this.model);if(!e)return;let{symbol:t,span:o}=e,{input:i,start:n,end:a}=o,s=this.getExtractedAndDefaultArgString(e),l=`\\operatorname{${t}}\\left(${s}\\right)`,c=`${i.slice(0,n)}${l}${i.slice(a)}`;this.controller.dispatch({type:"set-item-latex",id:this.id,latex:c}),this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.id}}),this.controller.dispatch({type:"keypad/press-key",key:"Left"})}isMissingDefault(){if(!nC(this.model))return!1;let e=Yc(this.model);if(!e)return!1;for(let t=0;t<e.params.length;t++)if(this.shouldShowDefaultValue(e.params[t]))return!0;return!1}getSuggestionType(){return this.getListOfParameters().length>1?this.isMissingDefault()?"listWithDefault":"list":this.missingRequiredParam()?"individual":"none"}missingRequiredParam(){let e=Yc(this.model);if(!e||e.params.length!==1)return;let t=e.params[0];if(!this.getDefaultValue(t)&&!this.getParameterExtractedValue(t))return t}getMissingRequiredParamText(){let e=this.missingRequiredParam();return e?this.controller.s("graphing-calculator-text-enter-pareneter",{param:this.getParamName(e)}):""}getDefaultValue(e){let t=Yc(this.model);if(!t||!t.params)return"";for(let o=0;o<t.params.length;o++)if(t.params[o]===e)return t.defaults[o]||"";return""}getParameterExtractedValue(e){let t=Yc(this.model);return t&&t.values[e]||""}shouldShowDefaultValue(e){return!this.getParameterExtractedValue(e)&&!!this.getDefaultValue(e)}getListOfParameters(){let e=Yc(this.model);return e?e.params:[]}getParamName(e){switch(e){case"mean":return this.controller.s("graphing-calculator-text-parameter-name-mean");case"stdev":return this.controller.s("graphing-calculator-text-parameter-name-stddev");case"dof":return this.controller.s("graphing-calculator-text-parameter-name-dof");case"probsuccess":return this.controller.s("graphing-calculator-text-parameter-name-probsuccess");case"trials":return this.controller.s("graphing-calculator-text-parameter-name-trials");case"data":return this.controller.s("graphing-calculator-text-parameter-name-data");case"binwidth":return this.controller.s("graphing-calculator-text-parameter-name-binwidth");case"min":return this.controller.s("graphing-calculator-text-parameter-name-min");case"max":return this.controller.s("graphing-calculator-text-parameter-name-max");case"height":return this.controller.s("graphing-calculator-text-parameter-name-height");case"offset":return this.controller.s("graphing-calculator-text-parameter-name-offset");default:return e}}};var{If:cfe}=dd.Components,CS=class extends dd.Class{template(){return this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id,dd.createElement("div",{class:dd.const("dcg-distribution-parameters-container dcg-do-blur"),tapboundary:dd.const("true"),handleEvent:dd.const("true")},dd.createElement(Kv,{model:this.props.model,controller:this.props.controller}),dd.createElement(cfe,{predicate:()=>DR(this.model)},()=>dd.createElement(vS,{model:this.props.model,controller:this.props.controller})))}};var an=__dcg_shared_module_exports__['e'](Z());var Gp=__dcg_shared_module_exports__['e'](Z());var zu=class extends Gp.Class{template(){return Gp.createElement(ze,{tooltip:()=>this.props.controller().s("shared-calculator-label-toast-learn-more")},Gp.createElement("a",{"aria-label":()=>this.props.controller().s("shared-calculator-label-toast-learn-more"),class:Gp.const("dcg-learn-more-link"),href:this.props.href,target:Gp.const("_blank")},Gp.createElement("i",{class:Gp.const("dcg-icon-question-sign"),"aria-hidden":Gp.const("true")})))}};var{If:yB}=an.Components,YA=class extends an.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}handlePressedKey(e,t,o){if(!this.controller.isInEditListMode()){if(t==="Esc"){this.controller.dispatch({type:"set-focus-location",location:void 0});return}if(t==="Enter")return this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"})}let i=Ze.getFocusedMathquill(),n=Yl();if(t==="Left"||t==="Right"||t==="Down"||t==="Up"){let a;i?a=Ze.applyArrowKeyAndReturnIfWasAtBounds(i,t,o):n&&(n.selectionStart===0&&t==="Left"||n.selectionStart===n.value.length&&t==="Right"||t==="Up"||t==="Down")?a=!0:a=!1,a&&(o&&o.preventDefault(),t==="Left"?e==="max"+this.getDomainVariableString()&&this.controller.dispatch({type:"set-focus-location",location:{type:"domain-limit",id:this.model.id,location:"min"+this.getDomainVariableString()}}):t==="Right"?e==="min"+this.getDomainVariableString()&&this.controller.dispatch({type:"set-focus-location",location:{type:"domain-limit",id:this.model.id,location:"max"+this.getDomainVariableString()}}):t==="Down"?this.controller.dispatch({type:"on-special-key-pressed",key:"Down"}):t==="Up"&&this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.model.id}}));return}i&&(i.keystroke(t,o),e==="min"+this.getDomainVariableString()?this.dispatchMinLatexIfChanged(i.latex()):e==="max"+this.getDomainVariableString()&&this.dispatchMaxLatexIfChanged(i.latex()))}getDomainVariable(){var o,i;let e=this.props.domainIndex(),t=(i=(o=this.model.formula.domains)==null?void 0:o[e])==null?void 0:i.variable;if(!t)throw new Error("Programming Error: could not find domain variable in index "+e);return t}handleFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"domain-limit",id:this.id,location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"domain-limit",id:this.id,location:e}})}dispatchMinLatexIfChanged(e){this.getMinLatex()!==e&&this.controller.dispatch({type:"set-domain-minlatex",variable:this.getDomainVariable(),id:this.id,latex:e})}dispatchMaxLatexIfChanged(e){this.getMaxLatex()!==e&&this.controller.dispatch({type:"set-domain-maxlatex",variable:this.getDomainVariable(),id:this.id,latex:e})}getFocusedInput(){let e=this.controller.getFocusLocation();if(!(!e||e.type!=="domain-limit"||e.id!==this.id))return e.location}getMinLatex(){return QW(this.model,this.getDomainVariable())}getMaxLatex(){return ZW(this.model,this.getDomainVariable())}getDomainVariableString(){let e=this.getDomainVariable();return e==="theta"?e="\\theta":e==="phi"&&(e="\\phi"),e}getDomainVariableDisplayLatex(){return"\\le "+this.getDomainVariableString()+" \\le"}getPlaceholder(e){return __dcg_shared_module_exports__['Tb'](e).string.replace("\u03C0","\\pi")}template(){return an.createElement("div",{class:an.const("dcg-domain dcg-do-blur"),handleEvent:an.const("true")},an.createElement("div",{class:an.const("dcg-display-domain dcg-do-blur"),handleEvent:an.const("true")},an.createElement(zr,{readonly:()=>this.controller.isItemReadonly(this.id),latex:()=>this.getMinLatex(),isFocused:()=>this.getFocusedInput()==="min"+this.getDomainVariableString(),placeholder:()=>this.getPlaceholder(MW(this.model,this.getDomainVariable())),ariaLabel:()=>this.controller.s("graphing-calculator-narration-domain3d-minimum",{term:this.getDomainVariableString()}),brailleLabel:()=>this.controller.raw("dmin"),handleFocusChanged:e=>this.handleFocusedChanged("min"+this.getDomainVariableString(),e),hasError:()=>!VW(this.model,this.getDomainVariable()),controller:this.props.controller,handlePressedKey:(e,t)=>this.handlePressedKey("min"+this.getDomainVariableString(),e,t),handleLatexChanged:e=>this.dispatchMinLatexIfChanged(e),dataLabelAttributeValue:this.const("domain-min")}),an.createElement("span",{class:an.const("dcg-interval-interior")},an.createElement(Et,{latex:()=>this.getDomainVariableDisplayLatex(),config:this.const({})})),an.createElement(zr,{readonly:()=>this.controller.isItemReadonly(this.id),latex:()=>this.getMaxLatex(),isFocused:()=>this.getFocusedInput()==="max"+this.getDomainVariableString(),placeholder:()=>this.getPlaceholder(AW(this.model,this.getDomainVariable())),ariaLabel:()=>this.controller.s("graphing-calculator-narration-domain3d-maximum",{term:this.getDomainVariableString()}),brailleLabel:()=>this.controller.raw("dmax"),handleFocusChanged:e=>this.handleFocusedChanged("max"+this.getDomainVariableString(),e),hasError:()=>!LW(this.model,this.getDomainVariable()),controller:this.props.controller,handlePressedKey:(e,t)=>this.handlePressedKey("max"+this.getDomainVariableString(),e,t),handleLatexChanged:e=>this.dispatchMaxLatexIfChanged(e),dataLabelAttributeValue:this.const("domain-max")}),an.createElement(yB,{predicate:()=>this.getDomainVariableString()==="\\phi"},()=>an.createElement(zu,{href:this.const("https://help.kiavash.com/hc/en-us/articles/15824510769805"),controller:this.props.controller}))))}},SS=class extends an.Class{constructor(){super(...arguments),this.model=this.props.model()}hasFirstDomainIndex(){return pm(this.model)||Ph(this.model)&&!t7(this.model)}hasSecondDomainIndex(){return Ph(this.model)?!r7(this.model):!1}template(){return an.createElement("div",null,an.createElement(yB,{predicate:this.bindFn(this.hasFirstDomainIndex)},()=>an.createElement(YA,{controller:this.props.controller,model:this.props.model,domainIndex:this.const(0)})),an.createElement(yB,{predicate:this.bindFn(this.hasSecondDomainIndex)},()=>an.createElement(YA,{controller:this.props.controller,model:this.props.model,domainIndex:this.const(1)})))}};var Wo=__dcg_shared_module_exports__['e'](Z());var{Switch:dfe}=Wo.Components,ES=class extends Wo.Class{init(){this.controller=this.props.controller()}template(){return Wo.createElement("div",{class:Wo.const("dcg-expression-warning dcg-text-selectable"),handleEvent:Wo.const("true"),role:Wo.const("note")},Wo.createElement("i",{class:Wo.const("dcg-icon-error"),"aria-hidden":Wo.const("true")}),Wo.createElement(dfe,{key:()=>this.props.warning()},e=>{switch(e==null?void 0:e.type){case"unresolved":return Wo.createElement("span",null,()=>this.controller.s("graphing-calculator-error-equation-contains-unresolved-details"),Wo.createElement("a",{href:Wo.const("https://help.kiavash.com/hc/en-us/articles/202529079-Unresolved-Detail-In-Plotted-Functions"),target:Wo.const("_blank")},()=>this.controller.s("graphing-calculator-link-learn-more")));case"expressionTooComplex":return Wo.createElement("span",null,()=>this.controller.s("shared-calculator-error-gpu-expression-too-complex"),Wo.createElement("a",{href:Wo.const("https://help.kiavash.com/hc/en-us/articles/26801641850893-GPU-Error-while-Plotting-an-Expression"),target:Wo.const("_blank")},()=>this.controller.s("graphing-calculator-link-learn-more")));case"tone-out-of-range":return Wo.createElement("span",null,()=>this.controller.s("graphing-calculator-error-tone-frequency-out-of-range",{min:lw,max:cw}));case"recursive-depth-plotting-error":return Wo.createElement("span",null,()=>this.controller.s("graphing-calculator-error-reached-maximum-recursion-depth"));case"nan-blame-complex-coercion":return Wo.createElement("span",null,()=>this.controller.s("graphing-calculator-error-nan-blame-complex-coercion"));case"legacy-random-seed-behavior":return Wo.createElement("span",null,()=>this.controller.s("graphing-calculator-error-legacy-random-seed-behavior"),Wo.createElement("a",{href:Wo.const("https://help.kiavash.com/hc/en-us/articles/25261997911181-Change-to-Random-Seeds-in-Function-Definitions"),target:Wo.const("_blank"),class:Wo.const("dcg-warning-footer-learn-more")},()=>this.controller.s("graphing-calculator-link-learn-more")),Wo.createElement("button",{onTap:()=>{this.controller.dispatch({type:"update-legacy-random-seed-behavior"})},class:Wo.const("dcg-btn-light-gray dcg-update-behavior-btn dcg-unstyled-button")},()=>this.controller.s("graphing-calculator-label-update-to-new-behavior")));case"evaluation":return Wo.createElement("span",null,()=>e.message);case void 0:return}}))}};var yl=__dcg_shared_module_exports__['e'](Z());var DS=class extends yl.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.id=this.props.id()}template(){return yl.createElement("div",{class:yl.const("dcg-prompt-rename"),handleEvent:yl.const("true")},()=>fa("graphing-calculator-label-rename"),yl.createElement("span",{class:yl.const("dcg-btn-light-gray"),onTap:this.bindFn(this.handleRename),tabIndex:yl.const(0),role:yl.const("button")},yl.createElement(Et,{latex:()=>`${this.getRenameIdentifierFrom()} \\to ${this.getRenameIdentifierTo()}`,config:this.const({})},yl.createElement("span",{style:yl.const("pointer-events:none")}))),yl.createElement("span",{class:yl.const("dcg-reference-count")},()=>fa(this.getRenameIdentifierFolderId()!==void 0?"graphing-calculator-label-reference-count-in-folder":"graphing-calculator-label-reference-count",{count:__dcg_shared_module_exports__['kc'](this.getRenameCountOfChanges())})))}getRenameIdentifierFrom(){let e=this.controller.getSuggestedIdentifierRenameInfo(this.id);return e&&e.from||""}getRenameIdentifierTo(){let e=this.controller.getSuggestedIdentifierRenameInfo(this.id);return e&&e.to||""}getRenameCountOfChanges(){let e=this.controller.getSuggestedIdentifierRenameInfo(this.id);return e&&e.countOfChanges||0}getRenameIdentifierFolderId(){let e=this.controller.getSuggestedIdentifierRenameInfo(this.id);return e==null?void 0:e.folderId}handleRename(){let e={search:this.getRenameIdentifierFrom(),replace:this.getRenameIdentifierTo()},t=this.getRenameIdentifierFolderId();t===void 0?this.controller.dispatch({type:"rename-identifier-global",...e}):this.controller.dispatch({type:"rename-identifier-in-item",id:t,...e})}};var sn=__dcg_shared_module_exports__['e'](Z());var{For:pfe,If:ufe}=sn.Components,Ip=class extends sn.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.promptGroupId=`prompt-slider-${Ld()}`}template(){return sn.createElement("div",{class:sn.const("dcg-create-sliders"),handleEvent:sn.const("true"),role:sn.const("group"),"aria-labelledby":this.const(this.promptGroupId)},sn.createElement("span",{class:sn.const("dcg-msg"),id:this.const(this.promptGroupId)},this.bindFn(this.getPromptMsg)),sn.createElement("span",{class:sn.const("btns")},sn.createElement("span",null,sn.createElement(pfe,{each:this.bindFn(this.getMissingVariables)},e=>sn.createElement("div",{class:sn.const("dcg-slider-btn-container")},sn.createElement("button",{class:()=>({"dcg-btn-slider":!0,"dcg-btn-blue":this.getMissingVariables().length===1,"dcg-base-case-btn":this.getMissingBaseCases().length>0,"dcg-btn-light-gray":this.getMissingVariables().length!==1}),onTap:t=>this.onCreateSlider(t,[e])},sn.createElement(Et,{config:this.const({}),latex:()=>e}))))),sn.createElement(ufe,{predicate:()=>this.getMissingVariables().length>1},()=>sn.createElement("div",{class:sn.const("dcg-slider-btn-container dcg-all")},sn.createElement("button",{class:sn.const("dcg-btn-slider dcg-btn-blue"),onTap:e=>this.onCreateSlider(e,this.getMissingVariables())},()=>this.controller.s("graphing-calculator-button-slider-add-all-variables"))))))}getPromptMsg(){return this.getMissingBaseCases().length>0?this.controller.s("graphing-calculator-label-add-base-case"):this.controller.s("graphing-calculator-label-add-slider")}onCreateSlider(e,t){this.model.type==="ticker"?this.controller.dispatch({type:"create-sliders-for-ticker",variables:t}):this.controller.dispatch({type:"create-sliders-for-item",id:this.model.id,variables:t}),e.device==="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.model.id}})}getMissingBaseCases(){return this.model.type!=="expression"?[]:Vh(this.model)}getMissingVariables(){let e=this.getMissingBaseCases();return e.length>0?e:(this.model.type==="ticker"?O0(this.model):q0(this.model)).slice(0,tC)}};var st=__dcg_shared_module_exports__['e'](Z());var kS=__dcg_shared_module_exports__['e'](Z());var pd=class extends kS.Class{init(){this.controller=this.props.controller()}template(){return kS.createElement(Ai,{latex:this.props.latex,brailleShouldFocus:this.bindFn(this.shouldFocus),onBrailleFocusedChanged:this.bindFn(this.onFocusChange),isStatic:this.const(!0),ariaLabel:this.props.brailleAriaLabel||this.props.ariaLabel,...wn(this.controller),onBrailleKeydown:e=>{var t,o;return(o=(t=this.props).onKeypress)==null?void 0:o.call(t,e)},tabIndex:()=>this.props.tabbable()?0:-1},kS.createElement(Hv,{latex:this.props.latex,config:this.const({tabbable:this.props.tabbable()}),isFocused:this.bindFn(this.shouldFocus),onFocusedChanged:this.bindFn(this.onFocusChange),getAriaLabel:this.props.ariaLabel,onUserPressedKey:(e,t)=>{t&&this.props.onKeypress&&this.props.onKeypress(t)}}))}shouldFocus(){return __dcg_shared_module_exports__['J'](this.props.focusLocation(),this.controller.getFocusLocation())}onFocusChange(e){e?this.controller.dispatch({type:"set-focus-location",location:this.props.focusLocation()}):this.controller.dispatch({type:"blur-focus-location",location:this.props.focusLocation()})}};function XA(r,e){let t=xB(r.parameters[e]),o=Math.max(6,r.displayPrecision,t+3);return __dcg_shared_module_exports__['_b'](r.parameters[e],{digits:o,scientificNotationDigits:o-1,smallCutoff:1e-6,bigCutoff:1e9})}function xB(r){let e=Math.abs(r);return 1<=e&&e<1e9?Math.floor(Math.log10(e))+1:0}function sy(r){return __dcg_shared_module_exports__['_b'](r,{zeroCutoff:1e-15,digits:4,smallCutoff:1e-6,bigCutoff:1e9})}var Jl=__dcg_shared_module_exports__['e'](Z());var{If:hfe}=Jl.Components,JA=class extends Jl.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Jl.createElement(hfe,{predicate:()=>this.controller.showResidualsZoomFitButton(this.model)},()=>Jl.createElement("div",{class:Jl.const("dcg-residuals-zoom-view dcg-do-blur"),handleEvent:Jl.const(!0)},Jl.createElement(ze,{tooltip:this.bindFn(this.getZoomText),gravity:()=>"e"},Jl.createElement("i",{onTap:this.bindFn(this.onZoom),role:Jl.const("button"),tabIndex:Jl.const("0"),"aria-label":this.bindFn(this.getZoomText),class:Jl.const("dcg-icon-zoom-fit"),manageFocus:this.const(ct({controller:this.controller,location:{type:"regression-output",id:this.props.model().id,parameter:"residual-zoom"}}))}))))}getZoomText(){return this.controller.s("graphing-calculator-text-zoom-fit")}onZoom(e){this.controller.dispatch({type:"expression-zoom-fit-residuals",id:this.model.id,focusAfterTap:e.device==="keyboard"})}};var{If:rf,For:aZ,IfElse:gfe}=st.Components,QA=class extends st.Class{template(){return st.createElement("div",{class:st.const("dcg-parameter-warning dcg-text-selectable"),role:st.const("note")},st.createElement("i",{class:st.const("dcg-icon-error"),"aria-hidden":st.const("true")}),st.const("\xA0"),()=>this.props.controller().s("graphing-calculator-text-regression-potentially-inaccurate-parameters"),st.const("\xA0"),st.createElement("a",{href:st.const("https://help.kiavash.com/hc/en-us/articles/360042942771"),target:st.const("_blank")},()=>this.props.controller().s("graphing-calculator-link-learn-more")))}},Wv=class extends st.Class{template(){return st.createElement(ze,{tooltip:this.props.tooltip,gravity:this.const("s")},st.createElement("a",{class:st.const("dcg-expression-footer-title-help"),target:st.const("_blank"),href:this.props.helpURL,"aria-label":this.props.tooltip},st.createElement("i",{class:st.const("dcg-icon-question-sign"),"aria-hidden":st.const("true")})))}},$v=class extends st.Class{template(){return this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id,st.createElement("div",{class:st.const("dcg-regression-footer-view")},st.createElement("div",{class:st.const("dcg-handle-event"),handleEvent:st.const("true")},st.createElement(rf,{predicate:()=>{var e,t;return this.hasParameterWarning()&&!!((t=(e=this.props).hideParameters)!=null&&t.call(e))}},()=>st.createElement(QA,{...this.props})),st.createElement(rf,{predicate:this.bindFn(this.getShouldSuggestLogMode)},()=>st.createElement("div",{class:st.const("dcg-log-mode-toggle")},gfe(()=>this.areLogModeRegressionsForced(),{true:()=>st.createElement("div",{class:st.const("dcg-action-log-mode-toggle dcg-no-hover-styling")},()=>this.controller.s("graphing-calculator-button-regression-log-mode")),false:()=>st.createElement("div",null,st.createElement(Gt,{class:this.const("dcg-action-log-mode-toggle dcg-log-mode-checkbox"),onChange:this.bindFn(this.onTapLogMode),checked:()=>this.getIsLogModeRegression()},()=>this.controller.s("graphing-calculator-button-regression-log-mode")),st.createElement(Wv,{helpURL:this.const("https://help.kiavash.com/hc/en-us/articles/204349605"),tooltip:()=>this.controller.s("graphing-calculator-label-regression-log-mode-help-tooltip")}))}))),st.createElement(rf,{predicate:()=>this.shouldShowParameters()&&Object.keys(this.getRegression().parameters).length>0},()=>st.createElement(wB,{controller:this.props.controller,id:this.const(this.id),regression:()=>this.getRegression()})),st.createElement("div",{class:st.const("dcg-statistics"),role:st.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-heading-regression-statistics")},st.createElement("div",{class:st.const("dcg-expression-footer-title")},()=>this.controller.s("graphing-calculator-heading-regression-statistics"),st.createElement(rf,{predicate:this.bindFn(this.showRMSENotice)},()=>st.createElement(Wv,{helpURL:this.const("https://help.kiavash.com/hc/en-us/articles/202529129-What-is-RMSE-"),tooltip:()=>this.controller.s("graphing-calculator-label-regression-what-is-rmse-tooltip")})),st.createElement(rf,{predicate:this.bindFn(this.showNegativeRSquaredWarning)},()=>st.createElement(Wv,{helpURL:this.const("https://help.kiavash.com/hc/en-us/articles/202529139-Why-am-I-seeing-a-negative-R-2-value-"),tooltip:()=>this.controller.s("graphing-calculator-label-regression-why-is-negative-tooltip")}))),st.createElement("div",{class:st.const("dcg-statistics-values")},st.createElement(aZ,{each:this.bindFn(this.getStatisticsSections),key:e=>e.type+":"+e.value},e=>{let t=e.value;return t===void 0?st.createElement("div",null,st.createElement(Bl,{mqConfig:this.const({}),content:()=>this.controller.s("graphing-calculator-text-undefined-parameter",{parameter:"`"+e.type+"`"})})):st.createElement("div",{class:()=>({"dcg-indented-r-value":e.type==="r"})},st.createElement(pd,{latex:()=>`\\operatorname{${e.type}}=`+sy(t),ariaLabel:this.const(""),tabbable:this.const(!0),focusLocation:this.const({type:"regression-output",id:this.id,parameter:e.type}),controller:this.props.controller}))}))),st.createElement("div",{role:st.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-heading-regression-residuals"),class:st.const("dcg-residuals")},st.createElement("div",{class:st.const("dcg-expression-footer-title")},()=>this.controller.s("graphing-calculator-heading-regression-residuals")),st.createElement(pd,{latex:this.bindFn(this.getResidualVariable),ariaLabel:this.const(""),tabbable:this.const(!0),focusLocation:this.const({type:"regression-output",id:this.id,parameter:this.getResidualVariable()}),controller:this.props.controller}),st.createElement(rf,{predicate:this.bindFn(this.getResidualSuggestionVisible)},()=>st.createElement("div",{class:st.const("dcg-residual-suggestion dcg-action-plot-residual dcg-btn dcg-btn-light-gray"),role:st.const("button"),tabIndex:st.const("0"),onTap:this.bindFn(this.onTapResidualsSuggestion)},()=>this.controller.s("graphing-calculator-button-regression-plot-residuals"))),st.createElement(JA,{model:this.props.model,controller:this.props.controller})),st.createElement("div",{class:st.const("dcg-clear")}),st.createElement(rf,{predicate:()=>{var e,t;return this.hasParameterWarning()&&!((t=(e=this.props).hideParameters)!=null&&t.call(e))}},()=>st.createElement(QA,{...this.props}))))}showNegativeRSquaredWarning(){let e=this.getStatisticsSections();return __dcg_shared_module_exports__['o'](e,t=>t.type==="R^2"&&t.value!==void 0&&t.value<0)}showRMSENotice(){let e=this.getStatisticsSections();return __dcg_shared_module_exports__['o'](e,t=>t.type==="RMSE")}getStatisticsSections(){var o,i,n,a,s,l;let e=[],t=this.getRegression().statistics;return t.RMSE!==void 0&&((i=(o=this.props).suppressRMSE)!=null&&i.call(o)?e.push({type:"R^2",value:void 0}):e.push({type:"RMSE",value:t.RMSE})),t.Rsquared!==void 0&&e.push({type:"R^2",value:t.Rsquared}),t.rsquared!==void 0&&e.push({type:"R^2",value:t.rsquared}),t.r!==void 0&&((a=(n=this.props).showRValue)==null?void 0:a.call(n))!=="never"?e.push({type:"r",value:t.r}):((l=(s=this.props).showRValue)==null?void 0:l.call(s))==="always"&&e.push({type:"r",value:void 0}),e}shouldShowParameters(){return!this.props.hideParameters||!this.props.hideParameters()}onTapResidualsSuggestion(){this.controller.dispatch({type:"plot-residuals",id:this.id})}onTapLogMode(){this.controller.dispatch({type:"toggle-logmode",id:this.id})}getRegression(){return this.props.regression()}getResidualVariable(){return this.getRegression().residualVariable||""}getResidualSuggestionVisible(){return this.getRegression().residualSuggestionId!==void 0}areLogModeRegressionsForced(){return this.controller.areLogModeRegressionsForced()}getShouldSuggestLogMode(){var e,t;return(t=(e=this.props).suppressLogModeCheckbox)!=null&&t.call(e)?!1:!!this.getRegression().shouldSuggestLogMode}hasParameterWarning(){return!!this.getRegression().parameterWarning}getIsLogModeRegression(){var e;return this.model.type==="expression"?!!this.model.isLogModeRegression:!!((e=this.model.regression)!=null&&e.isLogMode)}},wB=class extends st.Class{init(){this.controller=this.props.controller(),this.id=this.props.id()}template(){return st.createElement("div",{class:st.const("dcg-parameters-container")},st.createElement("div",{class:st.const("dcg-expression-footer-title")},()=>this.controller.s("graphing-calculator-heading-regression-parameters"),st.createElement(rf,{predicate:()=>!this.props.regression().isLinear},()=>st.createElement(Wv,{helpURL:this.const("https://help.kiavash.com/hc/en-us/articles/360042428612"),tooltip:()=>this.controller.s("graphing-calculator-label-regression-parameters-not-exact")}))),st.createElement("div",{role:st.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-heading-regression-parameters"),class:st.const("dcg-parameters")},st.createElement(aZ,{each:()=>Object.keys(this.props.regression().parameters)},e=>st.createElement(pd,{latex:()=>this.getParameterEquationLatex(e),ariaLabel:this.const(""),tabbable:this.const(!0),focusLocation:this.const({type:"regression-output",id:this.id,parameter:e}),controller:this.props.controller}))))}getParameterEquationLatex(e){return e+"="+XA(this.props.regression(),e)}};var Sn=__dcg_shared_module_exports__['e'](Z());var vn=__dcg_shared_module_exports__['e'](Z());$t();$t();var jv=class{constructor(){this._eventBus=new Jn;this.dragging=!1;this.guid=__dcg_shared_module_exports__['P']("dragdrop-class")}_evt2pt(e){return{x:e.changedTouches[0].pageX-this._offsetPt.x,y:e.changedTouches[0].pageY-this._offsetPt.y}}_dispatch(e,t){if(this._destroyed)return;let o=this._evt2pt(t);this._eventBus.triggerEvent(e,{x:o.x,y:o.y,dx:o.x-this._startPt.x,dy:o.y-this._startPt.y,evt:t})}destroy(){re(document).off(`.${this.guid}`),this._destroyed=!0}startDrag(e,t={}){if(!this.dragging)return re(document).on(`dcg-tapmove.${this.guid}`,o=>{(o.originalEvent||o).preventDefault(),cancelAnimationFrame(this.frameThrottle),this.frameThrottle=requestAnimationFrame(()=>this.doDrag(o))}),re(document).on(`dcg-tapend.${this.guid} dcg-tapcancel.${this.guid}`,o=>this.endDrag(o)),this._offsetPt={x:0,y:0},t.origin&&(this._offsetPt={x:this._evt2pt(e).x-t.origin.x,y:this._evt2pt(e).y-t.origin.y}),this._startPt=this._evt2pt(e),this.dragging=!0,this._dispatch("onGrab",e)}doDrag(e){this.dragging&&this._dispatch("onDrag",e)}endDrag(e){this.dragging&&(re(document).off(`.${this.guid}`),this.doDrag(e),this.dragging=!1,this._dispatch("onDrop",e))}observeEvent(e,t){return this._eventBus.observeEvent(e,t)}};var{If:mfe}=vn.Components,ly=class extends vn.Class{template(){return vn.createElement("div",{class:()=>({"dcg-slider-interior":!0,"dcg-disable-slider":this.shouldDisableSlider()}),didMount:this.bindFn(this.didMountRoot),onTapStart:this.bindFn(this.onStartDrag)},vn.createElement("div",{class:vn.const("dcg-track")},vn.createElement("div",{class:vn.const("dcg-ticks"),onMount:this.bindFn(this.didMountTickMarks)}),vn.createElement("div",{class:vn.const("dcg-graphic")})),vn.createElement(mfe,{predicate:this.bindFn(this.shouldShowZeroMarker)},()=>vn.createElement("div",{class:vn.const("dcg-zeroMarker"),style:()=>({left:this.getZeroMarkerPercent()+"%"})})),vn.createElement("div",{class:()=>({"dcg-thumb":!0,"dcg-down":this.isDragging}),role:vn.const("slider"),tabIndex:vn.const("0"),disablescroll:vn.const("true"),style:()=>({left:this.getThumbPercent()+"%"}),onKeyDown:this.bindFn(this.onKeyDown),"aria-label":this.props.ariaLabel,"aria-valuemin":()=>{var e,t;return(t=(e=this.props).ariaPercent)!=null&&t.call(e)?0:this.props.min()},"aria-valuemax":()=>{var e,t;return(t=(e=this.props).ariaPercent)!=null&&t.call(e)?100:this.props.max()},"aria-valuenow":()=>{var e,t;return(t=(e=this.props).ariaPercent)!=null&&t.call(e)?void 0:this.props.value()},"aria-valuetext":()=>{var e,t;return(t=(e=this.props).ariaPercent)!=null&&t.call(e)?`${Math.floor(this.getThumbPercent())}%`:void 0},manageFocus:this.buildFocusManager()},vn.createElement("div",{class:vn.const("dcg-graphic")}),vn.createElement("div",{class:vn.const("dcg-center")})))}willUnmount(){this.dragDrop.destroy()}didMountRoot(e){this.rootNode=e,this.dragDrop=new jv,this.isMounted=!0,this.dragDrop.observeEvent("onDrop",()=>{this.isDragging=!1,this.update(),this.props.onDrop&&this.props.onDrop()}),this.dragDrop.observeEvent("onGrab",()=>{this.isDragging=!0,this.update(),this.props.onGrab&&this.props.onGrab()}),this.dragDrop.observeEvent("onDrag",(t,o)=>{this.props.onDragUpdate(this.valueFromPixels(o.x))})}didMountTickMarks(e){this.tickMarksNode=e,this.renderTickMarks()}didUpdate(){this.renderTickMarks()}shouldDisableSlider(){return this.props.min()===this.props.max()}renderTickMarks(){if(!this.tickMarksNode)return;let e=this.props.step(),t=this.props.min(),o=this.props.max(),i;if(e===void 0?i=0:i=100*e/(o-t),i<3&&(i=0),i>100&&(i=0),isNaN(i)&&(i=0),this.lastTickMarksPercent===i)return;this.lastTickMarksPercent=i;let n="";if(i>0&&i<100)for(let a=i;a<100;a+=i)n+='<div class="dcg-tick" style="left:'+a+'%"></div>';this.tickMarksNode.innerHTML=n}shouldShowZeroMarker(){return this.props.min()<=0&&this.props.max()>=0}getZeroMarkerPercent(){let e=this.props.min(),t=this.props.max();return 100*(0-e)/(t-e)}getThumbPercent(){return 100*this.percentFromValue(this.props.value())}valueFromPixels(e){if(!this.isMounted)return 0;let t=this.props.min(),o=this.props.max(),i=this.rootNode.getBoundingClientRect().width,n=__dcg_shared_module_exports__['wc'](e/i,0,1),a=t+(o-t)*n,s=(o-t)/i;return ni(a-s,a+s)}percentFromValue(e){let t=this.props.min(),o=this.props.max();return __dcg_shared_module_exports__['wc']((e-t)/(o-t),0,1)}pixelsFromValue(e){if(!this.isMounted)return 0;let t=this.percentFromValue(e);return this.rootNode.getBoundingClientRect().width*t}onKeyDown(e){switch(Be(e)){case Ia:this.props.onUpPress&&(this.props.onUpPress(),e.preventDefault(),e.stopPropagation());break;case On:this.props.onDownPress&&(this.props.onDownPress(),e.preventDefault(),e.stopPropagation());break;case Dh:this.props.onEnterPress&&(this.props.onEnterPress(),e.preventDefault(),e.stopPropagation());break;case Pn:document.activeElement&&re(document.activeElement).trigger("blur");break;case su:this.props.onKeyboardUpdate("down"),e.preventDefault(),e.stopPropagation();break;case lu:this.props.onKeyboardUpdate("up"),e.preventDefault(),e.stopPropagation();break;case jg:this.props.onKeyboardUpdate("bigdown"),e.preventDefault(),e.stopPropagation();break;case $g:this.props.onKeyboardUpdate("bigup"),e.preventDefault(),e.stopPropagation();break;case kh:this.props.onKeyboardUpdate("min"),e.preventDefault(),e.stopPropagation();break;case lp:this.props.onKeyboardUpdate("max"),e.preventDefault(),e.stopPropagation();break}}onStartDrag(e){if(e.device==="keyboard"||!e.target)return;e.preventDefault(),Jr();let t={x:0,y:0};e.target.closest(".dcg-thumb")?t.x=this.pixelsFromValue(this.props.value()):t.x=e.changedTouches[0].clientX-this.rootNode.getBoundingClientRect().left,this.dragDrop.startDrag(e,{origin:t})}buildFocusManager(){return!this.props.onFocusedChanged||!this.props.isFocused?this.const(void 0):this.const({shouldBeFocused:this.props.isFocused,onFocusedChanged:this.props.onFocusedChanged})}};var Cn=__dcg_shared_module_exports__['e'](Z());var{If:ffe}=Cn.Components,_S=class extends Cn.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return Cn.createElement("div",{class:Cn.const("dcg-slider_menu dcg-do-blur"),handleEvent:Cn.const("true"),didMount:e=>this.node=e},Cn.createElement("div",{class:Cn.const("dcg-editable-mathquill-container")},Cn.createElement(ffe,{predicate:()=>!this.shouldOnlyShowStep()},()=>Cn.createElement("span",null,Cn.createElement(zr,{readonly:()=>this.controller.isItemReadonly(this.id),latex:()=>this.model.slider.hardMin?this.model.slider.min:"",isFocused:()=>this.getFocusedInput()==="min",ariaLabel:()=>this.controller.s("graphing-calculator-narration-slider-minimum"),brailleLabel:()=>this.controller.raw("sldrmin"),handleFocusChanged:(e,t)=>this.handleFocusedChanged("min",e,t),hasError:()=>!VT(this.model),controller:this.props.controller,handlePressedKey:(e,t)=>this.handlePressedKey("min",e,t),handleLatexChanged:e=>this.handleLatexChanged("min",e),dataLabelAttributeValue:this.const("slidermin")}),Cn.createElement("span",{class:Cn.const("dcg-interval-interior")},Cn.createElement(Et,{latex:this.bindFn(this.getDependentLatex),config:this.const({})},Cn.createElement("span",null))),Cn.createElement(zr,{readonly:()=>this.controller.isItemReadonly(this.id),latex:()=>this.model.slider.hardMax?this.model.slider.max:"",isFocused:()=>this.getFocusedInput()==="max",ariaLabel:()=>this.controller.s("graphing-calculator-narration-slider-maximum"),brailleLabel:()=>this.controller.raw("sldrmax"),handleFocusChanged:(e,t)=>this.handleFocusedChanged("max",e,t),hasError:()=>!LT(this.model),controller:this.props.controller,handlePressedKey:(e,t)=>this.handlePressedKey("max",e,t),handleLatexChanged:e=>this.handleLatexChanged("max",e),dataLabelAttributeValue:this.const("slidermax")}))),Cn.createElement("span",{class:()=>({"dcg-slider-step-container":!this.shouldOnlyShowStep()})},Cn.createElement("span",{class:Cn.const("dcg-slider-step-label"),"aria-hidden":Cn.const("true")},()=>this.controller.s("graphing-calculator-label-slider-step")),Cn.createElement(zr,{readonly:()=>this.controller.isItemReadonly(this.id),latex:()=>this.model.slider.step,isFocused:()=>this.getFocusedInput()==="step",ariaLabel:()=>this.controller.s("graphing-calculator-narration-slider-step"),brailleLabel:()=>this.controller.raw("sldrstep"),handleFocusChanged:(e,t)=>this.handleFocusedChanged("step",e,t),hasError:()=>!PT(this.model),controller:this.props.controller,handlePressedKey:(e,t)=>this.handlePressedKey("step",e,t),handleLatexChanged:e=>this.handleLatexChanged("step",e),dataLabelAttributeValue:this.const("sliderstep")}))))}handlePressedKey(e,t,o){if(!this.controller.isInEditListMode()&&!this.shouldOnlyShowStep()&&(t==="Esc"||t==="Enter")){this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.id}});return}let i=Ze.getFocusedMathquill(),n=Yl();if(t==="Left"||t==="Right"||t==="Down"||t==="Up"){let a;i?a=Ze.applyArrowKeyAndReturnIfWasAtBounds(i,t,o):n&&(n.selectionStart===0&&t==="Left"||n.selectionStart===n.value.length&&t==="Right"||t==="Up"||t==="Down")?a=!0:a=!1,a&&(o&&o.preventDefault(),t==="Left"&&!this.shouldOnlyShowStep()?e==="max"?this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:"min"}}):e==="step"&&this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:"max"}}):t==="Right"&&!this.shouldOnlyShowStep()?e==="min"?this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:"max"}}):e==="max"&&this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:"step"}}):t==="Down"?this.controller.dispatch({type:"on-special-key-pressed",key:"Down"}):t==="Up"&&this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.id}}));return}i&&(i.keystroke(t,o),this.handleLatexChanged(e,i.latex()))}shouldOnlyShowStep(){return this.model.slider.loopMode==="PLAY_INDEFINITELY"}handleLatexChanged(e,t){e==="min"?this.dispatchMinLatexIfChanged(t):e==="max"?this.dispatchMaxLatexIfChanged(t):e==="step"&&this.dispatchStepLatexIfChanged(t)}handleFocusedChanged(e,t,o){t&&this.getFocusedInput()!==e?this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:e}}):this.getFocusedInput()===e&&this.controller.getBrailleMode()==="none"&&(!o.relatedTarget||!this.node.contains(o.relatedTarget))&&this.controller.dispatch({type:"blur-focus-location",location:{type:"slider-limit",id:this.id,location:e}})}dispatchMinLatexIfChanged(e){this.model.slider.min!==e&&this.controller.dispatch({type:"set-slider-minlatex",id:this.id,latex:e})}dispatchMaxLatexIfChanged(e){this.model.slider.max!==e&&this.controller.dispatch({type:"set-slider-maxlatex",id:this.id,latex:e})}dispatchStepLatexIfChanged(e){this.model.slider.step!==e&&this.controller.dispatch({type:"set-slider-steplatex",id:this.id,latex:e})}getDependentLatex(){let e=Ns(this.model)||"";return" \\le "+__dcg_shared_module_exports__['$b'](e)+" \\le "}getFocusedInput(){let e=this.controller.getFocusLocation();if(!(!e||e.type!=="slider-limit"||e.id!==this.id))return e.location}};var{If:sZ}=Sn.Components,TS=class extends Sn.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return Sn.createElement("div",{class:Sn.const("dcg-slider-container"),tapboundary:Sn.const("true"),onKeyDown:e=>{if(Be(e)==="Tab"&&!e.altKey&&!e.metaKey&&!e.ctrlKey)if(e.shiftKey)if(this.isSliderMinFocused()&&this.controller.isInEditListMode()){if(e.target){let t=e.target.closest(".dcg-expressionitem");if(t){let o=Array.from(t.querySelectorAll('[tabindex="0"]')).filter(cp)[0];o==null||o.focus()}}e.preventDefault(),e.stopPropagation()}else this.isSliderThumbFocused()&&(this.controller.isItemReadonly(this.model.id)||(this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:"step"}}),e.preventDefault(),e.stopPropagation()));else!e.shiftKey&&this.isSliderStepFocused()&&(this.controller.isInEditListMode()?this.controller.dispatch({type:"set-focus-location",location:{type:"slider-icon",id:this.id}}):this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.id}}),e.preventDefault(),e.stopPropagation())}},Sn.createElement(sZ,{predicate:this.bindFn(this.shouldShowSlider)},()=>Sn.createElement("div",{class:Sn.const("dcg-do-blur dcg-slider"),handleEvent:Sn.const("true")},Sn.createElement("div",{class:Sn.const("dcg-minLabel dcg-template-minlabelhtml"),role:Sn.const("button"),"aria-label":this.bindFn(this.getMinAriaLabel),onTap:()=>this.onEditLimit("min")},Sn.createElement(Et,{latex:()=>sR(this.model),config:this.const({}),tokenController:this.props.controller})),Sn.createElement(ly,{min:()=>jc(this.model),max:()=>gp(this.model),step:()=>Td(this.model),value:()=>Ll(this.model),ariaLabel:()=>this.controller.getBrailleMode()==="none"?'"'+Ns(this.model)+'"':""+Ns(this.model),onGrab:this.bindFn(this.onGrab),onDrop:this.bindFn(this.onDrop),onDragUpdate:this.bindFn(this.onDragUpdate),onKeyboardUpdate:this.bindFn(this.onKeyboardUpdate),onUpPress:()=>this.controller.dispatch({type:"on-special-key-pressed",key:"Up"}),onDownPress:()=>this.controller.dispatch({type:"on-special-key-pressed",key:"Down"}),onEnterPress:()=>this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"}),isFocused:this.bindFn(this.isSliderThumbFocused),onFocusedChanged:e=>{e?this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.id}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"slider-thumb",id:this.id}})}}),Sn.createElement("div",{class:Sn.const("dcg-maxLabel dcg-template-maxlabelhtml"),onTap:()=>this.onEditLimit("max"),role:Sn.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-narration-slider-maximum")+" "+rn(lR(this.model))},Sn.createElement(Et,{latex:()=>lR(this.model),config:this.const({}),tokenController:this.props.controller})))),Sn.createElement(sZ,{predicate:this.bindFn(this.shouldShowLimitInputs)},()=>Sn.createElement(_S,{model:this.props.model,controller:this.props.controller})))}getMinAriaLabel(){return this.controller.isItemReadonly(this.model.id)?this.controller.s("graphing-calculator-narration-slider-minimum")+" "+rn(sR(this.model)):this.controller.s("graphing-calculator-narration-edit-slider-variable-limits",{variable:this.controller.getBrailleMode()==="none"?'"'+Ns(this.model)+'"':""+Ns(this.model)})}onGrab(){this.dispatchIsDraggingIfChanged(!0)}onDrop(){this.controller.dispatch({type:"set-none-selected"}),this.dispatchIsPlayingIfChanged(!1),this.dispatchIsDraggingIfChanged(!1)}onKeyboardUpdate(e){this.controller.dispatch({type:"adjust-slider-by-keyboard",id:this.id,adjustment:e})}onDragUpdate(e){this.controller.dispatch({type:"adjust-slider-by-dragging-thumb",id:this.model.id,target:e})}onEditLimit(e){this.controller.dispatch({type:"set-focus-location",location:{type:"slider-limit",id:this.id,location:e}})}dispatchIsPlayingIfChanged(e){this.model.slider.isPlaying!==e&&this.controller.dispatch({type:"set-slider-isplaying",id:this.id,isPlaying:e})}dispatchIsDraggingIfChanged(e){this.model.sliderDragging!==e&&this.controller.dispatch({type:"set-slider-dragging",id:this.id,dragging:e})}shouldShowLimitInputs(){if(this.controller.isInEditListMode())return!0;if(this.controller.isItemReadonly(this.model.id))return!1;if(!VT(this.model)||!LT(this.model)||!PT(this.model)||this.model.slider.loopMode==="PLAY_INDEFINITELY")return!0;let e=this.controller.getFocusLocation();return!!(e&&(e.type==="slider-limit"||e.type==="expression"||e.type==="top-level-icon"||e.type==="readonly-expression")&&e.id===this.id)}shouldShowSlider(){return!this.shouldShowLimitInputs()}isSliderThumbFocused(){let e=this.controller.getFocusLocation();return!!(e&&e.type==="slider-thumb"&&e.id===this.id)}isSliderMinFocused(){let e=this.controller.getFocusLocation();return!!(e&&e.type==="slider-limit"&&e.id===this.id&&e.location==="min")}isSliderStepFocused(){let e=this.controller.getFocusLocation();return!!(e&&e.type==="slider-limit"&&e.id===this.id&&e.location==="step")}};var ls=__dcg_shared_module_exports__['e'](Z());var{For:bfe}=ls.Components,GS=class extends ls.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return ls.createElement("div",{class:ls.const("dcg-stats-footer-container dcg-do-blur"),handleEvent:ls.const("true")},ls.createElement("ul",{class:ls.const("dcg-unstyled-list")},ls.createElement(bfe,{each:this.bindFn(this.getValues),key:e=>e.parameter+":"+e.label+":"+e.value},e=>{let t=this.controller.s(e.label);return ls.createElement("li",{class:ls.const("dcg-value")},ls.createElement("div",{class:ls.const("dcg-row-header dcg-text-selectable")},()=>t),ls.createElement("div",{class:ls.const("dcg-evaluation")},ls.createElement(pd,{latex:()=>e.value,ariaLabel:()=>t,tabbable:this.const(!0),focusLocation:this.const({type:"stats-output",id:this.id,parameter:e.parameter}),controller:this.props.controller,onKeypress:this.bindFn(this.handlePressedKey)})))})))}getValues(){let e=wW(this.model);return e?[{parameter:"min",label:"graphing-calculator-label-stats-minimum",value:this.getStatValue(e.min)},{parameter:"q1",label:"graphing-calculator-label-stats-first-quartile",value:this.getStatValue(e.q1)},{parameter:"median",label:"graphing-calculator-label-stats-median",value:this.getStatValue(e.median)},{parameter:"q3",label:"graphing-calculator-label-stats-third-quartile",value:this.getStatValue(e.q3)},{parameter:"max",label:"graphing-calculator-label-stats-maximum",value:this.getStatValue(e.max)}]:[]}handlePressedKey(e){let t=Be(e);if(t)switch(t){case"Up":this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.id}}),e.preventDefault();break;case"PageUp":case"PageDown":case"Down":case"Enter":this.controller.dispatch({type:"on-special-key-pressed",key:t}),e.preventDefault();break;case"Esc":Jr(),e.preventDefault();break}}getStatValue(e){var t;return(t=__dcg_shared_module_exports__['_b'](e,{...__dcg_shared_module_exports__['Vb']}))!=null?t:""}};var Wr=__dcg_shared_module_exports__['e'](Z());var IS=class extends Wr.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return Wr.createElement("div",{class:Wr.const("dcg-ttest-footer-container dcg-do-blur"),handleEvent:Wr.const("true")},Wr.createElement("ul",{class:Wr.const("dcg-unstyled-list")},Wr.createElement("li",{class:Wr.const("dcg-value"),role:Wr.const("textbox"),"aria-readonly":Wr.const("true"),tabIndex:Wr.const("0"),"aria-label":()=>"Less than: "+this.getLessThan()},Wr.createElement("div",{class:Wr.const("dcg-operator")},Wr.createElement(Et,{config:this.const({}),latex:this.const("<")})),Wr.createElement("div",{class:Wr.const("dcg-evaluation")},Wr.createElement(Et,{config:this.const({}),latex:()=>this.getLessThan()}))),Wr.createElement("li",{class:Wr.const("dcg-value"),role:Wr.const("textbox"),"aria-readonly":Wr.const("true"),tabIndex:Wr.const("0"),"aria-label":()=>"Greater than: "+this.getGreaterThan()},Wr.createElement("div",{class:Wr.const("dcg-operator")},Wr.createElement(Et,{config:this.const({}),latex:this.const(">")})),Wr.createElement("div",{class:Wr.const("dcg-evaluation")},Wr.createElement(Et,{config:this.const({}),latex:()=>this.getGreaterThan()}))),Wr.createElement("li",{class:Wr.const("dcg-value"),role:Wr.const("textbox"),"aria-readonly":Wr.const("true"),tabIndex:Wr.const("0"),"aria-label":()=>"Not equal: "+this.getNotEqual()},Wr.createElement("div",{class:Wr.const("dcg-operator")},Wr.createElement(Et,{config:this.const({}),latex:this.const("\u2260")})),Wr.createElement("div",{class:Wr.const("dcg-evaluation")},Wr.createElement(Et,{config:this.const({}),latex:()=>this.getNotEqual()})))))}getLessThan(){let e=dw(this.model);return e?__dcg_shared_module_exports__['le'](e.lessThan,5):""}getGreaterThan(){let e=dw(this.model);return e?__dcg_shared_module_exports__['le'](e.greaterThan,5):""}getNotEqual(){let e=dw(this.model);return e?__dcg_shared_module_exports__['le'](e.notEqual,5):""}};var Tr=__dcg_shared_module_exports__['e'](Z());var{SwitchUnion:yfe,If:lZ}=Tr.Components,Yv=class extends Tr.Class{template(){return Tr.createElement("div",{class:Tr.const("dcg-toggle-container")},Tr.createElement("div",{class:Tr.const("dcg-expression-footer-title")},this.props.title,Tr.createElement(lZ,{predicate:()=>!!this.props.helpLink},()=>Tr.createElement("a",{"aria-label":()=>this.props.controller().s("account-shell-link-help"),class:Tr.const("dcg-expression-footer-title-help"),target:Tr.const("_blank"),href:this.props.helpLink},Tr.createElement("i",{class:Tr.const("dcg-icon-question-sign"),"aria-hidden":Tr.const("true")})))),Tr.createElement(Po,{staticConfig:this.bindFn(this.getSegmentedControlOptions),ariaGroupLabel:this.props.title,disabled:this.bindFn(this.isReadonly),theme:this.const("mini"),minButtonWidth:this.const(65)}))}isReadonly(){return this.props.controller().isItemReadonly(this.props.model().id)}getSegmentedControlOptions(){return this.props.options().map(e=>({key:e.name,label:()=>e.displayName,selected:()=>this.isSelected(e.name),onSelect:()=>{this.props.controller().dispatch({type:"set-visualization-prop",id:this.props.model().id,prop:this.props.vizProp(),value:e.name})}}))}isSelected(e){return Lh(this.props.model(),this.props.vizProp())===e}},MS=class extends Tr.Class{template(){return this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id,Tr.createElement("div",{class:Tr.const("dcg-visualization-parameters-container dcg-do-blur"),tapboundary:Tr.const("true"),handleEvent:Tr.const("true")},Tr.createElement(Kv,{...this.props}),Tr.createElement("div",{class:Tr.const("dcg-smaller-font")},yfe(()=>this.getVisualizationType(),{boxplot:()=>Tr.createElement("div",null,Tr.createElement("div",{class:Tr.const("dcg-expression-footer-title")},()=>this.controller.s("graphing-calculator-heading-visual-parameters-display-properties")),this.makeMQInput({prop:"axisOffset",siblingProps:["breadth"],default:"1",name:()=>this.controller.s("graphing-calculator-narration-visual-parameters-offset")}),this.makeMQInput({prop:"breadth",siblingProps:["axisOffset"],default:"1",name:()=>Lh(this.model,"alignedAxis")==="y"?this.controller.s("graphing-calculator-narration-visual-parameters-width"):this.controller.s("graphing-calculator-narration-visual-parameters-height")}),Tr.createElement(Gt,{checked:()=>!!Lh(this.model,"showBoxplotOutliers"),disabled:()=>this.controller.isItemReadonly(this.model.id),onChange:this.bindFn(this.onToggleOutliers)},Tr.createElement("span",{class:Tr.const("dcg-parameter-name")},()=>this.controller.s("graphing-calculator-button-visual-parameters-exclude-outliers")))),dotplot:()=>Tr.createElement(lZ,{predicate:()=>IW(this.model)},()=>Tr.createElement("div",{class:Tr.const("dcg-toggles-container")},Tr.createElement(Yv,{...this.props,vizProp:()=>"dotplotXMode",options:()=>[{name:"exact",displayName:this.controller.s("graphing-calculator-button-visual-parameters-exact")},{name:"bin",displayName:this.controller.s("graphing-calculator-button-visual-parameters-binned")}],title:()=>this.controller.s("graphing-calculator-heading-visual-parameters-x-values")}),Tr.createElement(Yv,{...this.props,vizProp:()=>"binAlignment",options:()=>[{name:"center",displayName:this.controller.s("graphing-calculator-button-visual-parameters-center")},{name:"left",displayName:this.controller.s("graphing-calculator-button-visual-parameters-left")}],title:()=>this.controller.s("graphing-calculator-heading-visual-parameters-bin-alignment")}))),histogram:()=>Tr.createElement("div",{class:Tr.const("dcg-toggles-container")},Tr.createElement(Yv,{...this.props,vizProp:()=>"histogramMode",options:()=>[{name:"",displayName:this.controller.s("graphing-calculator-button-visual-parameters-count")},{name:"relative",displayName:this.controller.s("graphing-calculator-button-visual-parameters-relative")},{name:"density",displayName:this.controller.s("graphing-calculator-button-visual-parameters-density")}],title:()=>this.controller.s("graphing-calculator-heading-visual-parameters-bar-heights"),helpLink:this.const("https://help.kiavash.com/hc/en-us/articles/360022405991")}),Tr.createElement(Yv,{...this.props,vizProp:()=>"binAlignment",options:()=>[{name:"center",displayName:this.controller.s("graphing-calculator-button-visual-parameters-center")},{name:"left",displayName:this.controller.s("graphing-calculator-button-visual-parameters-left")}],title:()=>this.controller.s("graphing-calculator-heading-visual-parameters-bin-alignment")})),none:()=>Tr.createElement("span",null)})))}makeMQInput(e){return Tr.createElement("span",null,Tr.createElement("span",{class:Tr.const("dcg-parameter-name")},e.name,Tr.const(":")),Tr.createElement(zr,{latex:()=>this.getPropLatex(e),ariaLabel:e.name,placeholder:()=>e.default,isFocused:()=>this.isInputFocused(e.prop),hasError:()=>!_W(this.model,e.prop),handleFocusChanged:t=>this.handleFocusedChanged(e.prop,t),handlePressedKey:(t,o)=>this.handlePressedKey(t,o,e.prop),handleLatexChanged:t=>this.handleLatexChanged(e.prop,t),readonly:()=>this.controller.isItemReadonly(this.model.id),controller:this.props.controller}))}handlePressedKey(e,t,o){if(e==="Esc"){this.controller.dispatch({type:"set-focus-location",location:void 0});return}if(e==="Enter")return this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"});let i=Ze.getFocusedMathquill();i&&(i.keystroke(e,t),this.handleLatexChanged(o,i.latex()))}isInputFocused(e){let t=this.controller.getFocusLocation();return!t||t.type!=="visualization-prop"||t.id!==this.id?!1:t.location===e}handleFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"visualization-prop",id:this.id,location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"visualization-prop",id:this.id,location:e}})}getPropLatex({prop:e}){let t=Lh(this.model,e);return typeof t=="string"?t:""}handleLatexChanged(e,t){Lh(this.model,e)!==t&&this.controller.dispatch({type:"set-visualization-prop",id:this.id,prop:e,value:t})}onToggleOutliers(){let e=Lh(this.model,"showBoxplotOutliers");this.controller.dispatch({type:"set-visualization-prop",id:this.id,prop:"showBoxplotOutliers",value:!e})}getVisualizationType(){return nC(this.model)?hm(this.model)?"boxplot":Oh(this.model)?"dotplot":gb(this.model)?"histogram":"none":"none"}};var{If:xfe,SwitchUnion:wfe,Each:vfe}=ei.Components,Cfe=["warning","regression","slider","domain","ttest","stats","action-info","label","distribution","visualization","rename-prompt","extend-to-3d","slider-prompt","evaluation","braille-error"],ZA=class extends ei.Class{constructor(){super(...arguments),this.model=this.props.model(),this.controller=this.props.controller()}id(){return this.model.id}getFooterComponents(){return Cfe.filter(e=>this.hasFooterComponent(e))}hasFooterComponent(e){switch(e){case"action-info":return this.shouldShowActionInfo();case"braille-error":return this.shouldShowBrailleError();case"distribution":return Rh(this.model);case"domain":return!this.model.sliderExists&&(pm(this.model)||Ph(this.model));case"evaluation":return this.controller.shouldShowEvaluationForItem(this.model.id);case"extend-to-3d":return this.shouldShowExtendTo3D();case"label":return aw(this.model)&&!this.controller.isThreeDMode();case"regression":return!!this.model.formula.regression;case"rename-prompt":return this.shouldShowRenamePrompt();case"slider":return!!this.model.sliderExists;case"slider-prompt":return this.controller.shouldShowSliderPrompt(this.model);case"stats":return KT(this.model);case"ttest":return ww(this.model);case"visualization":return HT(this.model);case"warning":return!!this.getFooterWarning();default:let t=e;throw new Error(`Unexpected footer type ${t}`)}}template(){return ei.createElement(xfe,{predicate:()=>this.getFooterComponents().length>0},()=>ei.createElement("div",{class:this.getFooterClass()},vfe(()=>this.getFooterComponents(),{item:e=>wfe(()=>e,{regression:()=>ei.createElement($v,{model:this.props.model,controller:this.props.controller,regression:()=>this.props.model().formula.regression}),label:()=>ei.createElement(Pb,{model:this.props.model,controller:this.props.controller}),slider:()=>ei.createElement(TS,{model:this.props.model,controller:this.props.controller}),"slider-prompt":()=>ei.createElement(Ip,{model:this.props.model,controller:this.props.controller}),"braille-error":()=>ei.createElement("div",{tabIndex:ei.const(0),class:ei.const("dcg-expression-braille-error"),role:ei.const("button"),"aria-roledescription":ei.const("error"),"aria-label":()=>this.controller.unpack(this.model.error)},ei.createElement("i",{class:ei.const("dcg-icon-error"),"aria-hidden":ei.const("true")}),()=>this.controller.unpack(this.model.error)),domain:()=>ei.createElement(SS,{model:this.props.model,controller:this.props.controller}),evaluation:()=>ei.createElement(ay,{id:()=>this.props.model().id,val:()=>this.controller.getEvaluationValueForItem(this.id()),controller:this.props.controller,valueType:()=>this.controller.getEvaluationValueTypeForItem(this.id())}),distribution:()=>ei.createElement(CS,{model:this.props.model,controller:this.props.controller}),visualization:()=>ei.createElement(MS,{model:this.props.model,controller:this.props.controller}),"rename-prompt":()=>ei.createElement(DS,{controller:this.props.controller,id:this.bindFn(this.id)}),ttest:()=>ei.createElement(IS,{model:this.props.model,controller:this.props.controller}),stats:()=>ei.createElement(GS,{model:this.props.model,controller:this.props.controller}),"action-info":()=>ei.createElement(ny,{model:this.props.model,controller:this.props.controller}),"extend-to-3d":()=>ei.createElement("div",{handleEvent:ei.const("true")},ei.createElement(Gt,{onChange:t=>{this.controller.dispatch({type:"set-item-extend-to-3D",id:this.model.id,extendTo3D:t})},checked:()=>this.model.extendTo3D,class:this.const("dcg-extend-to-3d-checkbox")},()=>this.controller.s("graphing-calculator-label-extend-to-3d"))),warning:()=>ei.createElement(ES,{controller:this.props.controller,warning:()=>this.getFooterWarning()})})})))}getFooterClass(){let e=!this.props.isFirstRender()&&!this.model.expressionTooComplex;return this.const({"dcg-expression-bottom":!0,"dcg-indent-in-folder":!0,"dcg-fadein-bottom":e})}shouldShowRenamePrompt(){let e=this.controller.getSuggestedIdentifierRenameInfo(this.model.id);return!!(e&&e.countOfChanges)}shouldShowActionInfo(){return!!(this.controller.areActionsEnabled()&&this.model.clickableInfo&&this.model.clickableInfo.enabled&&this.model.clickableInfo.latex)}shouldShowBrailleError(){return this.controller.getBrailleMode()!=="none"&&this.hasError()}hasError(){return!!this.model.error&&!al(this.model)}shouldShowExtendTo3D(){return this.controller.isThreeDMode()?qT(this.model)&&!this.model.expressionTooComplex&&this.model.shouldGraph:!1}getFooterWarning(){let e=this.model.formula;if(e.warning!==void 0)return{type:"evaluation",message:this.controller.unpack(e.warning)};if(!this.controller.getIncludeFunctionParametersInRandomSeed()&&e.depends_on_random_seed&&e.function_definition)return{type:"legacy-random-seed-behavior"};if(this.model.expressionTooComplex)return{type:"expressionTooComplex"};if(this.model.unresolved)return{type:"unresolved"};if(EW(this.model))return{type:"tone-out-of-range"};if(this.model.nanBlame===__dcg_shared_module_exports__['fe'].ComplexCoercion)return{type:"nan-blame-complex-coercion"};if(this.model.recursiveDepthPlottingError)return{type:"recursive-depth-plotting-error"}}};Xa();var wa=__dcg_shared_module_exports__['e'](Z());var cg=__dcg_shared_module_exports__['e'](Z());var zn=class extends cg.Class{template(){return cg.createElement(ze,{tooltip:this.props.error,sticky:this.const(!0),gravity:this.props.gravity,additionalClass:this.const("dcg-tooltipped-error-container")},cg.createElement("div",{class:()=>{var e,t,o,i;return{"dcg-tooltipped-error":!0,"dcg-small":((t=(e=this.props).size)==null?void 0:t.call(e))==="small","dcg-white":this.props.isWhite&&this.props.isWhite(),"dcg-tooltipped-error__instant":(i=(o=this.props).instant)==null?void 0:i.call(o)}}},cg.createElement("i",{class:cg.const("dcg-icon-error"),"aria-hidden":cg.const("true")})))}};var Hu=__dcg_shared_module_exports__['e'](Z());var cs=__dcg_shared_module_exports__['e'](Z());var Vi=__dcg_shared_module_exports__['e'](Z()),eV=class extends Vi.Class{template(){return Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon")},Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}),Vi.createElement("div",{class:Vi.const("dcg-slow-plotting-icon__dot")}))}};var{If:AS}=cs.Components,Ji=class extends cs.Class{template(){return cs.createElement("span",{class:()=>({"dcg-do-not-blur":!0,"dcg-forced-color-none":!0,"dcg-circular-icon":!0,"dcg-thick-outline":this.isThickOutline(),"dcg-white-icon":!!this.props.whiteIcon&&this.props.whiteIcon(),"dcg-hidden":this.isHidden(),"dcg-semi-transparent":this.props.semiTransparent&&this.props.semiTransparent(),"dcg-colored-icon":this.isColoredIcon(),"dcg-has-background-image":this.hasBackgroundImage(),[this.iconModifier()]:this.iconModifier().length>0}),style:this.bindFn(this.getIconStyle)},cs.createElement(AS,{predicate:this.bindFn(this.hasBackgroundImage)},()=>cs.createElement("span",{class:cs.const("dcg-background-image"),style:()=>({"background-image":this.props.backgroundImage&&this.props.backgroundImage(),opacity:this.props.backgroundOpacity&&this.props.backgroundOpacity().toString()})})),cs.createElement(AS,{predicate:()=>!!this.backgroundIcon()},()=>cs.createElement("i",{class:()=>({[this.backgroundIcon()]:!0,"dcg-layered-icon":!0}),style:()=>({opacity:this.backgroundOpacity().toString()})})),cs.createElement(AS,{predicate:()=>!!this.primaryIcon()},()=>cs.createElement("i",{class:()=>({[this.primaryIcon()]:!0,"dcg-layered-icon":!0}),style:()=>({color:this.props.foregroundColor&&this.props.foregroundColor()})})),cs.createElement(AS,{predicate:()=>this.props.iconType()==="loading"},()=>cs.createElement("span",{class:cs.const("dcg-spinner")})),cs.createElement(AS,{predicate:()=>this.props.iconType()==="slow-plotting"},()=>cs.createElement(eV,null)))}isColoredIcon(){return!this.isThickOutline()&&!this.isHidden()&&!this.hasBackgroundImage()&&this.props.iconType()!=="loading"}iconModifier(){if(!this.props.iconModifier)return"";switch(this.props.iconModifier()){case"medium":return"dcg-modifier-size-medium";case"large":return"dcg-modifier-size-large";case"small":return"dcg-modifier-size-small";case"rotated":return"dcg-modifier-rotated";case"fade-in":return"dcg-modifier-fade-in";case"none":return""}}getIconStyle(){let e=!this.isHidden()&&this.props.backgroundColor?Rx(this.props.backgroundColor()):void 0;return e?{background:e}:{}}isHidden(){return this.props.iconType()==="hidden"}isThickOutline(){let e=this.props.iconType();return e==="folder"||e==="pause"||e==="play"||e==="fraction"||e==="action"||e==="metronome"||e==="sound"}hasBackgroundImage(){return!!this.props.backgroundImage&&!this.isHidden()&&!!this.props.backgroundImage()}primaryIcon(){let e=this.props.iconType();switch(e){case"sound":return"dcg-icon-sound-wave";case"folder":return"dcg-icon-folder";case"pause":return"dcg-icon-pause";case"play":return"dcg-icon-play";case"polygon-dashed":case"polygon-dashed-filled":return"dcg-icon-polygon-dashed";case"polygon-dotted":case"polygon-dotted-filled":return"dcg-icon-polygon-dotted";case"polygon-default":case"polygon-default-filled":return"dcg-icon-polygon-solid";case"graph-dashed":case"parametric-dashed-filled":return"dcg-icon-parametric-dashed";case"graph-dotted":case"parametric-dotted-filled":return"dcg-icon-parametric-dotted";case"graph-default":case"parametric-default-filled":return"dcg-icon-parametric-solid";case"movable-vertical":return"dcg-icon-move-vertical";case"movable-both":return"dcg-icon-move";case"movable-horizontal":return"dcg-icon-move-horizontal";case"point-open":return"dcg-icon-open";case"point-cross":return"dcg-icon-cross";case"point-default":return"dcg-icon-point";case"table-points":case"table-points-and-lines":return"dcg-icon-points";case"table-lines":return"dcg-icon-lines-solid";case"shaded-inequality":case"inequality":return"dcg-icon-shaded-inequality-dash";case"check":return"dcg-icon-check";case"none":case"background":case"hidden":case"polygon-none-filled":case"parametric-none-filled":case"loading":case"slow-plotting":return"";case"fraction":return"dcg-icon-fraction";case"boxplot":return"dcg-icon-boxplot";case"dotplot-cross":return"dcg-icon-dotplot-cross";case"dotplot-default":return"dcg-icon-dotplot-default";case"dotplot-open":return"dcg-icon-dotplot-open";case"histogram":return"dcg-icon-histogram";case"unfilled-distribution":case"filled-distribution":return"dcg-icon-distribution";case"action":return"dcg-icon-chevron-right";case"metronome":return"dcg-icon-metronome-2";case"arrow-right":return"dcg-icon-arrow-right";default:return e}}backgroundOpacity(){let e=this.backgroundIcon();return e==="dcg-icon-polygon-filled"||e==="dcg-icon-parametric-filled"||e==="dcg-icon-shaded-inequality-shade2"||e==="dcg-icon-distribution-fill"||e==="dcg-icon-histogram-fill"?.5:1}backgroundIcon(){let e=this.props.iconType();return e==="filled-distribution"?"dcg-icon-distribution-fill":e==="histogram"?"dcg-icon-histogram-fill":e==="polygon-dashed-filled"||e==="polygon-dotted-filled"||e==="polygon-default-filled"||e==="polygon-none-filled"?"dcg-icon-polygon-filled":e==="parametric-dashed-filled"||e==="parametric-dotted-filled"||e==="parametric-default-filled"||e==="parametric-none-filled"?"dcg-icon-parametric-filled":e==="table-points-and-lines"?"dcg-icon-lines-solid":e==="shaded-inequality"?"dcg-icon-shaded-inequality-shade2":e==="action"?"dcg-icon-minus":""}};var tV=class extends Hu.Class{constructor(){super(...arguments),this.isAnimating=!1}init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Hu.createElement("div",{class:()=>({"dcg-action-icon-view":!0,"dcg-action-icon-view-animating":this.isAnimating})},Hu.createElement("div",{class:Hu.const("dcg-circular-icon-container"),"aria-label":()=>this.controller.s("graphing-calculator-narration-run-action-icon"),role:Hu.const("button"),tabIndex:Hu.const("0"),onTap:e=>{e.wasHandled("dragdrop")||this.runActionOnce()},manageFocus:this.const(ct({controller:this.props.controller(),location:{type:"action-icon",id:this.model.id}}))},Hu.createElement(Ji,{iconType:this.const("action"),whiteIcon:()=>!this.controller.isInEditListMode()&&this.controller.isItemSelected(this.model.id)||this.controller.isItemBeingDragged(this.model.id)})))}runActionOnce(){this.isAnimating=!0,this.controller.dispatch({type:"action-single-step",id:this.model.id}),setTimeout(this.bindIfMounted(()=>{this.isAnimating=!1,this.update()}),150)}};var Ds=__dcg_shared_module_exports__['e'](Z());var rV=class extends Ds.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Ds.createElement("div",{class:Ds.const("dcg-play-pause-icon-view")},Ds.createElement(ze,{gravity:this.const("s"),tooltip:()=>this.controller.s("graphing-calculator-label-slider-disabled-while-ticker-playing"),disabled:()=>!this.controller.getTickerPlaying(),sticky:this.const(!0)},Ds.createElement("div",{class:()=>({"dcg-circular-icon-container":!0,"dcg-disabled":this.controller.getTickerPlaying()}),"aria-label":this.bindFn(this.getAriaLabel),"aria-disabled":()=>this.controller.getTickerPlaying(),role:Ds.const("button"),tabIndex:()=>this.controller.getTickerPlaying()?"-1":"0",onTap:e=>{this.controller.getTickerPlaying()||e.wasHandled("dragdrop")||this.toggleSliderIsPlaying()},"dcg-open-menu-guid":()=>this.model.guid,manageFocus:this.const(ct({controller:this.controller,location:{type:"slider-icon",id:this.model.id}}))},Ds.createElement(Ji,{iconType:()=>this.getIconType(),whiteIcon:()=>!this.controller.isInEditListMode()&&this.controller.isItemSelected(this.model.id)||this.controller.isItemBeingDragged(this.model.id)}))),Ds.createElement("div",{class:Ds.const("dcg-slider-menu-container")},Ds.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-animation-properties-tooltip"),gravity:this.const("e")},Ds.createElement("div",{class:()=>({"dcg-slider-menu-opener":!0,"dcg-menu-open":this.myOptionsOpen()}),tabIndex:Ds.const(0),"dcg-open-menu-guid":()=>this.getMenuGUID(),role:Ds.const("button"),"aria-label":()=>this.myOptionsOpen()?this.controller.s("graphing-calculator-narration-hide-animation-properties"):this.controller.s("graphing-calculator-narration-show-animation-properties"),onTap:e=>{e.wasHandled("dragdrop")||e.wasLongheld()||this.toggleOptions(e)},manageFocus:this.const(ct({controller:this.controller,location:{type:"slider-animation-properties-icon",id:this.model.id}}))},Ds.createElement("i",{class:this.bindFn(this.getIcon),"aria-hidden":Ds.const("true")})))))}getIcon(){return __dcg_shared_module_exports__['pb'](this.model.slider.loopMode)}getIconType(){return!this.model.slider.isPlaying||cR(this.model)?"play":"pause"}getMenuGUID(){return"slider-"+this.model.guid}myOptionsOpen(){return this.controller.isItemSettingsMenuOpen(this.getMenuGUID())}toggleOptions(e){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"slider",model:this.model,guid:this.getMenuGUID(),focusFirstOption:e.device==="keyboard"}})}getAriaLabel(){if(!this.model.sliderExists)return"";let e=Ns(this.model);return e?this.model.slider.isPlaying?this.controller.s("graphing-calculator-narration-pause-variable-animation",{variable:e}):this.controller.s("graphing-calculator-narration-play-variable-animation",{variable:e}):""}toggleSliderIsPlaying(){if(this.model.sliderExists){let e="",t=Ns(this.model);cR(this.model)?(typeof t=="string"&&(e=this.controller.s("graphing-calculator-narration-slider-variable-restarted",{variable:t})),this.controller.dispatch({type:"play-slider-from-min",id:this.model.id})):this.model.slider.isPlaying?(typeof t=="string"&&(e=this.controller.s("graphing-calculator-narration-slider-variable-paused",{variable:t})),this.controller.dispatch({type:"set-slider-isplaying",id:this.model.id,isPlaying:!1})):(typeof t=="string"&&(e=this.controller.s("graphing-calculator-narration-slider-variable-playing",{variable:t})),this.controller.dispatch({type:"set-slider-isplaying",id:this.model.id,isPlaying:!0})),e!==""&&Te(e)}}};var VS=__dcg_shared_module_exports__['e'](Z());var oV=class extends VS.Class{init(){this.model=this.props.model(),this.controller=this.props.controller()}toggleMuted(){this.controller.dispatch({type:"toggle-item-hidden",id:this.model.id})}showAsTurnedOff(){return Z0(this.model)}template(){return VS.createElement("button",{class:()=>{var e;return{"dcg-unstyled-button":!0,"dcg-circular-icon-container":!0,"dcg-show-globally-muted":((e=this.controller.toneController)==null?void 0:e.isGlobalMuted())&&!this.showAsTurnedOff()}},onTap:e=>{e.wasHandled("dragdrop")||this.toggleMuted()},"aria-label":this.props.ariaLabel},VS.createElement(Ji,{iconType:()=>this.showAsTurnedOff()?"hidden":"sound",whiteIcon:()=>!this.controller.isInEditListMode()&&this.controller.isItemSelected(this.model.id)||this.controller.isItemBeingDragged(this.model.id)}))}};var{SwitchUnion:Sfe,If:Efe}=wa.Components,Dfe="#6A93D2",cZ="#000",dZ="#fff",LS=class extends wa.Class{init(){this.model=this.props.model(),this.controller=this.props.controller()}template(){return wa.createElement("div",{class:wa.const("dcg-expression-icon-container")},Sfe(this.bindFn(this.getIconMode),{error:()=>wa.createElement(zn,{error:this.bindFn(this.getErrorMsg),isWhite:this.bindFn(this.renderAsSelected)}),none:()=>wa.createElement("span",null),slider:()=>wa.createElement(rV,{controller:this.props.controller,model:this.props.model}),action:()=>wa.createElement(tV,{controller:this.props.controller,model:this.props.model}),icon:()=>wa.createElement("div",{class:wa.const("dcg-circular-icon-container"),role:wa.const("button"),tabIndex:wa.const("0"),"dcg-open-menu-guid":()=>this.getMenuGUID(),"aria-label":this.bindFn(this.getIconAriaLabel),onTap:e=>{if(!e.wasHandled("dragdrop")&&!e.wasLongheld()){if(this.myOptionsOpen())return this.toggleOptions(e);if((this.controller.isInEditListMode()||e.shiftKey)&&!this.isFraction())return this.toggleOptions(e);if(this.isFraction())return this.onToggleFractionDisplay();this.toggleGraphShown()}},onLongHold:e=>{e.handle("dcg-longhold"),e.handle("dcg-tap"),!(this.isFraction()||this.displaySlowPlotting()&&!Ah(this.model))&&this.toggleOptions(e)},manageFocus:this.const(ct({controller:this.controller,location:{type:"expression-icon",id:this.model.id}}))},wa.createElement(Ji,{iconType:this.bindFn(this.getIconType),backgroundColor:this.bindFn(this.getBackgroundColor),whiteIcon:this.bindFn(this.renderAsSelected),foregroundColor:this.bindFn(this.getForegroundColor),iconModifier:this.bindFn(this.getIconModifier),backgroundImage:this.bindFn(this.backgroundImage),backgroundOpacity:this.const(1)}),wa.createElement(Efe,{predicate:()=>this.model.disableGraphInteractions},()=>wa.createElement("i",{class:wa.const("dcg-graph-interaction-disabled dcg-icon-lock")}))),tone:()=>wa.createElement(oV,{controller:this.props.controller,model:this.props.model,ariaLabel:this.bindFn(this.getIconAriaLabel)})}))}backgroundImage(){let e=this.getBackgroundColor();return e.type==="image"?`url("${e.value}")`:""}getErrorMsg(){return this.colorError()?this.controller.s("shared-calculator-error-color-not-assigned"):this.controller.unpack(this.model.error)}getMenuGUID(){return this.model.guid}myOptionsOpen(){return this.controller.isItemSettingsMenuOpen(this.getMenuGUID())}toggleOptions(e){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"expression",model:this.model,guid:this.getMenuGUID(),focusFirstOption:e.device==="keyboard"}})}renderAsSelected(){return this.controller.isItemBeingDragged(this.model.id)?!0:this.controller.isItemSelected(this.model.id)&&!this.controller.isInEditListMode()}displaySlowPlotting(){return this.controller.shouldShowProgressUpdateIcons()&&this.controller.isItemGraphing(this.model.id)&&this.controller.isItemSlowInEvaluator(this.model.id)&&!ma(this.model)}isFraction(){return this.controller.canDisplayEvaluationForItemAsFraction(this.model.id)}getIconMode(){return this.displaySlowPlotting()?"icon":this.hasError()?"error":this.controller.getGraphSettings().config.graphpaper?Ah(this.model)?"icon":this.hasSlider()?"slider":this.isFraction()?"icon":this.isNonemptyAction()?"action":this.isToneExpression()&&this.controller.toneEnabled()?"tone":"none":"none"}isToneExpression(){return vc(this.model)}toggleGraphShown(){this.controller.dispatch({type:"toggle-item-hidden",id:this.model.id})}colorError(){return!!this.model.formula.rgb_value&&!this.model.formula.assignment}hasError(){return this.colorError()?!0:!!this.model.error&&!al(this.model)&&this.controller.getBrailleMode()==="none"}hasSlider(){return!!this.model.sliderExists}isNonemptyAction(){return fw(this.model)}getDisplayProps(){let{points:e,lines:t,fill:o}=this.model;return __dcg_shared_module_exports__['vd'](this.model.formula.expression_type,{points:e,lines:t,fill:o},i=>{Vo("getReconciledExpressionProps [Chrome Switch Bug]",{metaData:{method:"getDisplayProps",type:i}})})}getBackgroundColor(){if(!this.isFraction())return A0(this.model);let e=this.renderAsSelected();return this.controller.shouldEvaluationForItemDisplayAsFraction(this.model.id)?{type:"single-color",value:e?dZ:cZ}:{type:"single-color",value:""}}getForegroundColor(){if(!this.isFraction())return"";let e=this.renderAsSelected(),t=this.controller.shouldEvaluationForItemDisplayAsFraction(this.model.id);return e!==t?dZ:e?Dfe:cZ}onToggleFractionDisplay(){this.controller.dispatch({type:"toggle-fraction-evaluation",id:this.model.id})}getIconModifier(){return hm(this.model)&&Lh(this.model,"alignedAxis")==="y"?"rotated":this.displaySlowPlotting()&&this.model.formula.is_graphable===void 0?"fade-in":"none"}getIconType(){if(this.isFraction())return"fraction";if(this.displaySlowPlotting())return"slow-plotting";if(!this.model.shouldGraph)return"hidden";if(this.controller.isInEditListMode())return"none";let e=this.model.pointStyle,t=this.model.lineStyle,o=this.getDisplayProps(),i=this.model.formula;if(hm(this.model))return"boxplot";if(Oh(this.model)){if(this.model.pointStyle==="POINT")return"dotplot-default";if(this.model.pointStyle==="CROSS")return"dotplot-cross";if(this.model.pointStyle==="OPEN")return"dotplot-open"}if(gb(this.model))return"histogram";if(Rh(this.model))return mp(this.model)?"filled-distribution":"unfilled-distribution";if(Ci(this.model)==="X")return"movable-horizontal";if(Ci(this.model)==="Y")return"movable-vertical";if(Ci(this.model)==="XY")return"movable-both";if(nl(this.model))return e==="OPEN"?"point-open":e==="CROSS"?"point-cross":"point-default";if(yw(this.model))return"point-default";if(hb(this.model)||um(this.model))return o.lines&&o.points?"table-points-and-lines":o.lines?"table-lines":"table-points";if(UT(this.model))return"polygon-default-filled";let n=this.getDisplayProps().fill;if(nw(this.model))return n?o.lines?t==="DASHED"?"polygon-dashed-filled":t==="DOTTED"?"polygon-dotted-filled":"polygon-default-filled":"polygon-none-filled":o.lines?t==="DASHED"?"polygon-dashed":t==="DOTTED"?"polygon-dotted":"polygon-default":"none";if(ub(this.model))return n?o.lines?t==="DASHED"?"parametric-dashed-filled":t==="DOTTED"?"parametric-dotted-filled":"parametric-default-filled":"parametric-none-filled":o.lines?t==="DASHED"?"graph-dashed":t==="DOTTED"?"graph-dotted":"graph-default":"none";let a=i.operator,s=__dcg_shared_module_exports__['Xc'][a].direction!==0,l=__dcg_shared_module_exports__['Xc'][a].inclusive===!1;return i.is_shade_between||!l&&s?"shaded-inequality":l&&!s?"inequality":l&&s?"shaded-inequality":t==="DASHED"?"graph-dashed":t==="DOTTED"?"graph-dotted":"graph-default"}getIconAriaLabel(){return this.displaySlowPlotting()?this.controller.s("shared-calculator-label-slow-plotting"):this.isFraction()?cm(this.model)?this.controller.s("shared-calculator-narration-display-as-decimal"):this.controller.s("shared-calculator-narration-display-as-fraction"):this.myOptionsOpen()?Lo(this.model,"hide-options"):this.controller.isInEditListMode()?Lo(this.model,"show-options"):vc(this.model)?this.model.hidden?Lo(this.model,"unmute"):Lo(this.model,"mute"):this.model.hidden?Lo(this.model,"show"):Lo(this.model,"hide")}};var Ql=__dcg_shared_module_exports__['e'](Z());var{If:kfe}=Ql.Components,iV=class extends Ql.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Ql.createElement(kfe,{predicate:this.bindFn(this.shouldShow)},()=>Ql.createElement("div",{class:Ql.const("dcg-generate-table-view dcg-do-blur"),handleEvent:Ql.const(!0)},Ql.createElement(ze,{tooltip:this.bindFn(this.getTooltip),gravity:()=>"s"},Ql.createElement("i",{onTap:()=>this.controller.dispatch({type:"convert-or-create-table",index:this.model.index}),role:Ql.const("button"),tabIndex:Ql.const("0"),"aria-label":()=>Lo(this.model,"create_table"),class:Ql.const("dcg-icon-create-table")}))))}shouldShow(){return tb(this.model)!=="recursive-function"||!this.model||this.model.type!=="expression"?!1:!this.controller.hasTableHeaderWithIdentifier(this.model.formula.function_definition)}getTooltip(){return this.controller.s("graphing-calculator-label-create-table")}};var Zl=__dcg_shared_module_exports__['e'](Z());var{If:_fe}=Zl.Components,Xv=class extends Zl.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Zl.createElement(_fe,{predicate:()=>this.controller.showExpressionZoomFitButton(this.model)},()=>Zl.createElement("div",{class:Zl.const("dcg-suggested-zoom-view dcg-do-blur"),handleEvent:Zl.const(!0)},Zl.createElement(ze,{tooltip:this.bindFn(this.getZoomText),gravity:()=>"e"},Zl.createElement("i",{onTap:this.bindFn(this.onZoom),role:Zl.const("button"),tabIndex:Zl.const("0"),"aria-label":this.bindFn(this.getZoomText),class:Zl.const("dcg-icon-zoom-fit")}))))}getZoomText(){return this.controller.s("graphing-calculator-text-zoom-fit")}onZoom(e){this.controller.dispatch({type:"expression-zoom-fit",id:this.model.id,focusAfterTap:e.device==="keyboard"})}};var Fa=__dcg_shared_module_exports__['e'](Z());var{If:Tfe,Switch:Gfe}=Fa.Components,zd=class extends Fa.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}iconType(){return this.controller.shouldShowReplaceIcon()?"rename":this.controller.isItemMarkedReadonly(this.model.id)?"lock":"delete"}getAriaLabel(){switch(this.iconType()){case"none":case"lock":return;case"rename":return Lo(this.model,"rename");case"delete":return Lo(this.model,"delete")}}onIconTap(){this.iconType()==="delete"?this.controller.dispatch({type:"delete-item-and-animate-out",id:this.model.id,setFocusAfterDelete:!this.controller.isInEditListMode()}):this.iconType()==="rename"&&this.controller.dispatch({type:"rename-identifier-in-item",search:this.controller.getExpressionSearchStr(),replace:this.controller.getExpressionReplaceStr(),id:this.model.id})}isIconTappable(){let e=this.iconType();return e!=="none"&&e!=="lock"}template(){return Fa.createElement(Tfe,{predicate:()=>!this.controller.isInEditListMode()},()=>Fa.createElement("div",{class:()=>({"dcg-top-level-icon":!0,"dcg-tappable":this.isIconTappable()}),tabIndex:()=>this.isIconTappable()?0:-1,"aria-label":this.bindFn(this.getAriaLabel),handleEvent:this.bindFn(this.isIconTappable),onTap:this.bindFn(this.onIconTap),role:Fa.const("button"),manageFocus:this.const({shouldBeFocused:()=>vb({controller:this.controller,location:{type:"top-level-icon",id:this.model.id}}),onFocusedChanged:(e,t)=>{var o;e?this.controller.dispatch({type:"set-focus-location",location:{type:"top-level-icon",id:this.model.id}}):t.relatedTarget&&!((o=t.relatedTarget)!=null&&o.closest("[data-dcg-label]"))&&this.controller.dispatch({type:"blur-focus-location",location:{type:"top-level-icon",id:this.model.id}})}})},Fa.createElement(Gfe,{key:()=>this.iconType()},e=>{switch(e){case"delete":return Fa.createElement("i",{class:Fa.const("dcg-icon-remove dcg-top-level-delete"),"aria-hidden":Fa.const("true")});case"lock":return Fa.createElement("i",{class:Fa.const("dcg-icon-lock dcg-lock-indicator"),"aria-hidden":Fa.const("true")});case"rename":return Fa.createElement("i",{class:Fa.const("dcg-icon-replace"),"aria-hidden":Fa.const("true")});case"none":return Fa.createElement("span",null)}})))}};var{If:pZ}=So.Components,cy=class extends Xl{didMountRootNode(e){this.rootNode=e,this.onItemViewMounted(e),this.lastBrailleMode=this.controller.getBrailleMode()}willUnmount(){this.onItemViewUnmounted()}template(){return So.createElement("div",{class:()=>({"dcg-do-not-blur":!0,"dcg-expressionitem":!0,"dcg-mathitem":!0,"dcg-inFolder":!!this.model.folderId,"dcg-readonly":this.controller.isItemReadonly(this.id),"dcg-selected":this.controller.isItemSelected(this.id)&&!this.controller.isInEditListMode(),"dcg-dragging":this.controller.isItemBeingDragged(this.id),"dcg-hasSlider":this.hasSlider(),"dcg-hasEvaluation":!!this.controller.shouldShowEvaluationForItem(this.id),"dcg-hasRegression":this.hasRegression(),"dcg-hasDomain":this.hasDomain()||this.hasDomain3d()}),"expr-id":()=>this.model.id,didMount:this.bindFn(this.didMountRootNode)},So.createElement("div",{class:So.const("dcg-fade-container"),onTapStart:this.bindFn(this.onMouseSelect),onTap:this.bindFn(this.onMouseSelect)},So.createElement("div",{class:So.const("dcg-main")},So.createElement(pZ,{predicate:()=>!this.controller.isInEditListMode()&&!this.isReadonly()},()=>So.createElement(Ai,{latex:()=>rC(this.model),operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.getAriaLabel("braille"),brailleShouldFocus:()=>this.isFocused(),onBrailleInput:e=>this.handleLatexChanged(e),onBrailleFocusedChanged:(e,t)=>this.handleMQFocusedChanged(e,t),onBrailleKeydown:this.bindFn(this.handleBraillePressedKey),...wn(this.controller)},So.createElement(Ze,{latex:()=>rC(this.model),getAriaLabel:()=>this.getAriaLabel("speech"),getAriaPostLabel:this.bindFn(this.getFormulaAria),isFocused:()=>this.isFocused(),noFadeout:()=>this.controller.isItemMarkedReadonly(this.model.id),tokenController:this.props.controller,capExpressionSize:()=>this.controller.getCapExpressionSize(),config:this.bindFn(this.getMQConfig),hasError:this.const(!1),onUserPressedKey:(e,t)=>this.handlePressedKey(e,t),onUserChangedLatex:e=>this.handleLatexChanged(e),onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:(e,t)=>this.handleMQFocusedChanged(e,t),onSelectionChanged:()=>{this.controller.runAfterDispatch(()=>{this.controller.dispatch({type:"render"})})},needsSystemKeypad:()=>!this.controller.isKeypadEnabled()}))),So.createElement(pZ,{predicate:()=>this.controller.isInEditListMode()||this.isReadonly()},()=>So.createElement("div",{class:So.const("dcg-edit-list-mathquill"),onTap:()=>this.controller.isInEditListMode()?this.exitEditListMode():{},onKeyDown:this.bindFn(this.handleReadonlyPressedKey)},So.createElement(Ai,{latex:()=>rC(this.model),operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.getAriaLabel("braille"),isStatic:this.const(!0),brailleShouldFocus:()=>{let e=this.controller.getFocusLocation();return!e||e.type!=="readonly-expression"?!1:e.id===this.id},onBrailleFocusedChanged:(e,t)=>{e?this.controller.dispatch({type:"set-focus-location",location:{type:"readonly-expression",id:this.model.id}}):this.doesNodeBelongToSliderLimit(t.relatedTarget)||this.controller.dispatch({type:"blur-focus-location",location:{type:"readonly-expression",id:this.model.id}})},...wn(this.controller)},So.createElement(Et,{latex:()=>rC(this.model),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.getAriaLabel("speech"),tokenController:this.props.controller},So.createElement("span",{class:So.const("dcg-focusable-readonly-mathquill"),tabIndex:So.const("0"),role:So.const("textbox"),"aria-readonly":So.const("true"),manageFocus:this.const({shouldBeFocused:()=>this.controller.getBrailleMode()!=="none"?!1:vb({controller:this.controller,location:{type:"readonly-expression",id:this.model.id}}),onFocusedChanged:(e,t)=>{this.controller.getBrailleMode()==="none"&&(e?this.controller.dispatch({type:"set-focus-location",location:{type:"readonly-expression",id:this.model.id}}):this.doesNodeBelongToSliderLimit(t.relatedTarget)||this.controller.dispatch({type:"blur-focus-location",location:{type:"readonly-expression",id:this.model.id}}))}})})))))),So.createElement(zd,{controller:this.props.controller,model:this.props.model}),So.createElement(ZA,{controller:this.props.controller,model:this.props.model,isFirstRender:this.bindFn(this.isFirstRender)})),So.createElement("span",{class:()=>({"dcg-tab":!0,"dcg-action-drag":!0,"dcg-action-icon-touch":!0,...this.debugProgressClassMap()}),handleEvent:So.const("true"),tapboundary:So.const("true"),disablescroll:So.const("true"),onTapStart:this.bindFn(this.onDragPending)},So.createElement("span",{class:So.const("dcg-num")},()=>this.model.displayIndex),So.createElement("div",{class:So.const("dcg-tab-interior dcg-action-icon-mouse")},So.createElement(LS,{model:this.props.model,controller:this.props.controller})),So.createElement(Xv,{model:this.props.model,controller:this.props.controller}),So.createElement(iV,{model:this.props.model,controller:this.props.controller})),So.createElement(qd,{controller:this.props.controller,id:()=>this.model.id}))}debugProgressClassMap(){if(!this.controller.shouldShowProgressUpdateColors())return{};let e=this.controller.getEvaluatorStateForItem(this.model.id);switch(e){case void 0:case"IDLE":case"RESOLVED":return{};case"UNPUBLISHED":return{"dcg-progress-unpublished":!0};case"ANALYZING":return{"dcg-progress-analyzing":!0};case"GRAPHING":return{"dcg-progress-graphing":!0};default:throw new Error(`Unexpected analysis state: ${e}`)}}didUpdate(){this.lastBrailleMode=this.controller.getBrailleMode()}shouldShowLabelView(){return aw(this.model)&&!this.controller.isThreeDMode()}hasRegression(){return!!this.model.formula.is_regression}hasDomain(){return pm(this.model)}hasDomain3d(){return Ph(this.model)}isTTest(){return ww(this.model)}hasSlider(){return!!this.model.sliderExists}getLabelOptions(){return this.controller.getEvaluationLabelOptionsForItem(this.model.id)}getAriaLabel(e){if(this.shouldShowLabelView()){let t;this.model.label&&this.model.label!==""?t=this.model.label:e==="speech"?t=this.controller.s("graphing-calculator-narration-expression-label"):t=this.controller.raw("lbl");let o;return Vl(this.model)?o=t:e==="speech"?o=this.controller.s("graphing-calculator-narration-expression-hidden-label",{label:t}):o=this.controller.raw("h __label__",{label:t}),o}if(e==="speech"){let t=this.controller.s("shared-calculator-narration-expression-index",{index:this.model.displayIndex});if(this.controller.shouldShowProgressUpdateIcons()){let o=this.controller.getEvaluatorStateForItem(this.model.id);if(o)return`${t} - ${o}`}return t}else return this.controller.raw("eq__index__",{index:this.model.displayIndex})}getFormulaAria(){let e=this.model.formula,t="";if(this.controller.isItemSlowInEvaluator(this.model.id))return this.controller.shouldShowEvaluationForItem(this.id)?this.controller.s("graphing-calculator-narration-slow-evaluation"):this.controller.s("graphing-calculator-narration-slow-compute");if(!e||al(this.model))return t;if(this.controller.shouldShowEvaluationForItem(this.model.id))t=`equals ${aG(this.model,this.controller,this.getLabelOptions())}`;else if(e.error&&!this.controller.shouldShowSliderPrompt(this.model))t=this.controller.unpack(e.error);else if(this.controller.shouldShowSliderPrompt(this.model)){let o=Vh(this.model).length;if(o>0)t=this.controller.s("graphing-calculator-narration-add-base-case-prompt",{count:__dcg_shared_module_exports__['kc'](o)});else{let i=[],n=ew(this.model);for(let a=0;a<n.length;a++)i.push(Gi(n[a]));t=this.controller.s("graphing-calculator-narration-add-slider-prompt",{vars:wu(this.controller.getLanguage(),i)})}}else Rh(this.model)?t=this.controller.s("graphing-calculator-narration-expression-evaluation-is-distribution"):this.isTTest()&&(t=this.controller.s("graphing-calculator-narration-expression-evaluation-is-t-test"));if(this.model.shouldGraph&&(e.is_graphable||e.is_regression)){e.is_graphable&&e.is_regression?t+=" "+this.controller.s("graphing-calculator-narration-expression-evaluation-has-graph-and-regression"):e.is_regression?t+=" "+this.controller.s("graphing-calculator-narration-expression-evaluation-has-regression"):t+=" "+this.controller.s("graphing-calculator-narration-expression-evaluation-has-graph");let o=this.controller.getAudioGraph();o&&o.agNavigator.canTrace(this.model)&&(qo?t+=" "+this.controller.s("graphing-calculator-narration-expression-audio-trace-mac"):t+=" "+this.controller.s("graphing-calculator-narration-expression-audio-trace-windows"))}return this.controller.toneEnabled()&&vc(this.model)&&(this.model.hidden?t+=" "+this.controller.s("graphing-calculator-narration-expression-tone-muted"):t+=" "+this.controller.s("graphing-calculator-narration-expression-tone-unmuted")),t}handleBraillePressedKey(e){let t=Be(e);if(t){if(t==="Esc")Jr(),this.hasSlider()&&this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.model.id}});else if(t==="Up"||t==="Down"||t==="Enter")this.controller.dispatch({type:"on-special-key-pressed",key:t});else if(t==="Del"||t==="Backspace"){let o=Yl();al(this.model)&&zv(o)&&(this.controller.dispatch({type:"on-special-key-pressed",key:t==="Del"?"Delete":t}),e.preventDefault(),e.stopPropagation())}}}handleReadonlyPressedKey(e){if(this.controller.isInEditListMode())return;let t=Be(e);!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&(t==="Esc"?(e.preventDefault(),e.stopPropagation(),Jr(),this.hasSlider()&&this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.model.id}})):(t==="Up"||t==="Down"||t==="Enter")&&(e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"on-special-key-pressed",key:t})))}handlePressedKey(e,t){var i;let o=Ze.getFocusedMathquill();if(o){if(t&&this.controller.isGraphPaperFocused()){let n=(i=this.controller.getGrapher2d())==null?void 0:i.poiController;if(!n)return;let a=n.keyboardAttentionManager;if(e==="Tab"||e==="Shift-Tab"){t.stopPropagation(),t.preventDefault(),a.focusNextObjFromKeyboard({direction:t.shiftKey?"prev":"next"});return}else if(e==="Left"||e==="Right"||e==="Up"||e==="Down"||e==="Shift-Left"||e==="Shift-Right"||e==="Shift-Up"||e==="Shift-Down"){t.stopPropagation(),t.preventDefault(),t&&n.moveGeoPointFromKeyboard(t);return}else if(e==="Enter"){t.stopPropagation(),t.preventDefault();let s=a.getKeyboardAttention();n.activateGeoObjectFromKeyboard(s,t),this.controller.getEvaluator().notifyWhenSynced(()=>{let l=this.controller.getValidCursorContext(),c=this.model.formula.cursor_context;if(l&&__dcg_shared_module_exports__['J'](l,c)){let d=this.controller.getFocusLocation();if(d&&d.type==="expression"&&d.id===this.model.id&&!d.isFakeGraphFocus&&this.controller.dispatch({type:"set-focus-location",location:{...d,isFakeGraphFocus:!0}}),s){let p=a.findTabbableObjectsForCurrentTool(s);p.currentIsTabbable&&a.updateKeyboardAttention(p.targets[p.currentTabIndex],{describe:!1})}}});return}else if(e==="Esc"){t.stopPropagation(),t.preventDefault(),this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.model.id}});return}}if(e==="Esc"){Jr(),this.hasSlider()&&this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:this.model.id}});return}else{if(e==="Up"||e==="Down")return Ze.applyArrowKeyAndReturnIfWasAtBounds(o,e,t)?this.controller.dispatch({type:"on-special-key-pressed",key:e}):void 0;if(e==="Delete"||e==="Backspace"){if(al(this.model))return this.controller.dispatch({type:"on-special-key-pressed",key:e})}else if(e==="Enter")return t&&(t.preventDefault(),t.stopPropagation()),this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"})}o.keystroke(e,t),this.handleLatexChanged(o.latex())}}handleLatexChanged(e){e!==this.model.latex&&this.controller.dispatch({type:"set-item-latex",id:this.id,latex:e,source:"user-edit"})}doesNodeBelongToSliderLimit(e){return!e||!this.rootNode.contains(e)?!1:!!e.closest("[data-dcg-label]")}handleMQFocusedChanged(e,t){e?this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.id}}):!this.doesNodeBelongToSliderLimit(t.relatedTarget)&&this.lastBrailleMode===this.controller.getBrailleMode()&&this.controller.dispatch({type:"blur-focus-location",location:{type:"expression",id:this.id}})}onMouseSelect(e){this.isReadonly()||e.device!=="keyboard"&&(e.type==="dcg-tap"&&e.device==="mouse"||e.type==="dcg-tapstart"&&e.device==="touch"||e.wasHandled()||(e.handle(),this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:this.id}})))}isReadonly(){return this.controller.isItemReadonly(this.id)}isFocused(){let e=this.controller.getFocusLocation();return!e||e.type!=="expression"?!1:e.id===this.id}hasError(){return!!this.model.error&&!al(this.model)}getMQConfig(){return this.controller.getMathquillConfig({})}};function wn(r){return{sixKeyInput:()=>r.getSixKeyInput(),mode:()=>r.getBrailleMode(),capExpressionSize:()=>r.getCapExpressionSize()?{exceedsLimit:e=>e.length>zw,onExpressionSizeExceeded:()=>r.dispatch({type:"expression-size-exceeded"})}:void 0}}var{SwitchUnion:Ife}=Mc.Components,zr=class extends Mc.Class{init(){this.controller=this.props.controller()}template(){return Mc.createElement("div",{class:this.bindFn(this.getContainerClass)},Ife(()=>String(this.props.readonly()),{true:()=>Mc.createElement(Ai,{latex:this.bindFn(this.getStaticLatex),operatorNames:()=>this.getMQConfig().autoOperatorNames,brailleShouldFocus:this.props.isFocused,isStatic:this.const(!0),onBrailleFocusedChanged:this.props.handleFocusChanged,ariaLabel:this.bindFn(this.getBrailleLabel),dataLabelAttributeValue:this.props.dataLabelAttributeValue,...wn(this.props.controller())},Mc.createElement(Et,{latex:this.bindFn(this.getStaticLatex),config:this.bindFn(this.getMQConfig),getAriaLabel:this.props.ariaLabel,tokenController:this.props.controller},Mc.createElement("span",{class:Mc.const("dcg-math-field"),"data-dcg-label":()=>this.props.dataLabelAttributeValue?this.props.dataLabelAttributeValue():void 0,manageFocus:this.const({shouldBeFocused:()=>this.props.isFocused()&&this.controller.getBrailleMode()==="none",onFocusedChanged:(e,t)=>this.props.handleFocusChanged(e,t)}),tabIndex:Mc.const("0")}))),false:()=>Mc.createElement(Ai,{latex:this.props.latex,operatorNames:()=>this.getMQConfig().autoOperatorNames||"",brailleShouldFocus:this.props.isFocused,selectOnFocus:this.const(!0),onBrailleInput:this.props.handleLatexChanged,onBrailleFocusedChanged:this.props.handleFocusChanged,onBrailleKeydown:this.bindFn(this.onBrailleKeydown),hasError:this.props.hasError,placeholder:this.props.placeholder,ariaLabel:this.bindFn(this.getBrailleLabel),dataLabelAttributeValue:this.props.dataLabelAttributeValue,...wn(this.props.controller())},Mc.createElement(Ze,{latex:this.props.latex,getAriaPostLabel:()=>{var t,o;let e=((o=(t=this.props).ariaPostLabel)==null?void 0:o.call(t))||"";return this.props.hasError()&&e===""&&(e=this.controller.s("shared-calculator-narration-math-input-error-message")),e},tokenController:this.props.controller,isFocused:()=>this.props.isFocused()&&this.controller.getBrailleMode()==="none",placeholder:this.props.placeholder,capExpressionSize:()=>this.controller.getCapExpressionSize(),selectOnFocus:this.const(!0),config:this.bindFn(this.getMQConfig),getAriaLabel:this.props.ariaLabel,hasError:this.props.hasError,dataLabelAttributeValue:this.props.dataLabelAttributeValue,onUserPressedKey:this.props.handlePressedKey,onUserChangedLatex:this.props.handleLatexChanged,onSelectionChanged:this.props.handleSelectionChanged,onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:this.props.handleFocusChanged,needsSystemKeypad:()=>!this.controller.isKeypadEnabled()}))}))}getStaticLatex(){return this.props.latex()?this.props.latex():this.props.placeholder?this.props.placeholder():""}getContainerClass(){let e=this.props.containerClass?this.props.containerClass():{};return e["dcg-inline-math-input-view"]=!0,this.props.fullWidth&&this.props.fullWidth()&&(e["dcg-full-width-inline-math-input"]=!0),this.props.fontSize&&this.props.fontSize()==="large"&&(e["dcg-large-font-inline-math-input"]=!0),this.props.noBorder&&this.props.noBorder()&&(e["dcg-no-border-inline-math-input"]=!0),e}onBrailleKeydown(e){if(!this.props.handlePressedKey)return;let t=Be(e);t&&this.props.handlePressedKey(t,e)}getMQConfig(){return this.controller.getMathquillConfig({})}getBrailleLabel(){return this.props.brailleLabel?this.props.brailleLabel():this.props.ariaLabel()}};var Hd=__dcg_shared_module_exports__['e'](Z());var nV=class extends Hd.Class{template(){return Hd.createElement("span",{class:Hd.const("dcg-navigate-back"),onTap:this.props.onBack,"aria-label":this.props.ariaLabel,role:Hd.const("button"),tabIndex:Hd.const("0"),handleEvent:Hd.const("true"),manageFocus:this.const(ct({controller:this.props.controller(),location:{type:"geo-header-back-link"}}))},Hd.createElement("i",{class:Hd.const("dcg-icon-chevron-left"),"aria-hidden":Hd.const("true")}))}};var{Each:Mfe,SwitchUnion:Afe,If:Vfe}=Di.Components,aV=class extends Di.Class{init(){this.controller=this.props.controller()}template(){return Di.createElement("div",{role:Di.const("toolbar"),"aria-label":()=>this.controller.s("graphing-calculator-label-geometry-tools"),class:Di.const("dcg-geo-basic-tools dcg-animate-in-after-initial-load dcg-complex-tool-instruction-view")},Di.createElement(nV,{ariaLabel:()=>this.controller.s("account-shell-button-mygraphs-cancel"),controller:this.props.controller,onBack:this.bindFn(this.onCancel)}),Mfe(()=>this.getInputIndexes(),{item:e=>Di.createElement(vB,{activeStep:this.bindFn(this.getInputIndex),controller:this.props.controller,toolSpec:()=>this.getToolSpec(),stepIdx:()=>e})}))}onCancel(){this.controller.dispatch({type:"select-geo-tool",tool:"selection"}),this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:"selection"}})}getInputIndex(){return this.controller.getGeoModel().getNonObjectsState().ui.currentTool.inputIndex}getInputIndexes(){return this.getToolSpec().inputs.map((e,t)=>t)}getToolSpec(){return this.controller.getGeoModel().getCurrentTool().getSpec()}},vB=class extends Di.Class{init(){this.controller=this.props.controller()}template(){return Afe(()=>this.getInputType(),{completed:()=>Di.createElement("span",null),upcoming:()=>Di.createElement("span",{class:Di.const("dcg-step-upcoming")},Di.createElement("span",null)),active:()=>Di.createElement("span",{class:Di.const("dcg-active-step")},Di.createElement("span",{class:Di.const("dcg-step-active-icon")},Di.createElement("span",null,()=>this.props.stepIdx()+1)),Di.createElement("span",{class:Di.const("dcg-active-step-text")},this.bindFn(this.getActiveString)),Di.createElement(Vfe,{predicate:this.bindFn(this.isNumberInputStep)},()=>Di.createElement("span",{class:Di.const("dcg-input-flex-container"),didMount:this.bindFn(this.didMountNumberInput)},Di.createElement(zr,{containerClass:()=>({"dcg-suffix-degree":this.getNumberUnits()==="\xB0","dcg-suffix-radian":this.getNumberUnits()==="rad"}),readonly:()=>!1,latex:()=>this.getNumberInputLatex(),ariaLabel:this.bindFn(this.getActiveString),isFocused:()=>this.isNumberInputFocused(),handleFocusChanged:(e,t)=>this.handleFocusedChanged(e,t),hasError:this.bindFn(this.doesNumberInputHaveError),controller:this.props.controller,handlePressedKey:(e,t)=>{this.handlePressedKey(e,t)},handleLatexChanged:e=>{this.handleLatexChanged(e)},handleSelectionChanged:e=>{this.handleLatexChanged(e.latex,!0)},dataLabelAttributeValue:this.const("transformation-number")}),Di.createElement("span",{class:()=>({"dcg-action-submit":!0,"dcg-disabled":this.isSubmitNumberDisabled(),"dcg-btn-purple":!0}),role:Di.const("button"),tabIndex:()=>this.isSubmitNumberDisabled()?-1:0,"aria-disabled":this.bindFn(this.isSubmitNumberDisabled),onTap:e=>this.submitNumberInput({device:e.device})},()=>this.controller.s("shared-calculator-button-go")))))})}getNumberUnits(){return this.controller.getActiveTool()==="rotate"?this.controller.getDegreeMode()?"\xB0":"rad":""}didMountNumberInput(){this.controller.dispatch({type:"set-focus-location",location:{type:"new-transformation-number"}})}isNumberInputFocused(){let e=this.controller.getFocusLocation();return!!(e&&e.type==="new-transformation-number")}doesNumberInputHaveError(){var l;if(!this.getNumberInputLatex()||this.getNumberInputLatex()===((l=this.getStep().numberInputInfo)==null?void 0:l.defaultLatex))return!1;let t=this.props.toolSpec().outputs[0].id,{idMap:o}=this.controller.getGeoModel().getNonObjectsState().ui.currentTool,i=o[t];if(!i)return!0;let n=Xx(this.controller.getListModel()).filter(c=>{var d;if(c.type==="expression")return i===((d=xn(c))==null?void 0:d.latex)}),a=n[0];if(!a||n.length===0||n.length>1||a.error)return!0;let s=a.formula.typed_constant_value;if(!s)return!0;if(__dcg_shared_module_exports__['fb'](s.valueType,__dcg_shared_module_exports__['Ea'])){let c=__dcg_shared_module_exports__['bb'](s.valueType)?s.value:[s.value];for(let d of c){let[[p,u],[h,m]]=d;if(isNaN(p)||isNaN(u)||isNaN(h)||isNaN(m))return!0}return!1}return!0}handlePressedKey(e,t){let o=Ze.getFocusedMathquill();if(e==="Enter"){this.submitNumberInput({device:"keyboard"});return}o&&(o.keystroke(e,t),this.handleLatexChanged(o.latex()))}getNumberInputLatex(){return this.controller.getGeoModel().getCurrentTool().getNumberInputLatex()}isSubmitNumberDisabled(){return!!(this.doesNumberInputHaveError()||!this.getNumberInputLatex())}submitNumberInput(e){var s,l;if(this.isSubmitNumberDisabled())return;let t=this.controller.getGeoModel(),o=this.controller.getActiveTool(),i=t.getCurrentTool(),n=(s=i.getSpec)==null?void 0:s.call(i),a=i.tryCommitResults();a.committed&&(this.controller.dispatch({type:"commit-geo-objects",...a}),(l=this.controller.get2dPOIController())==null||l.speakGeoReleaseAction(o,n,a.committed),e.device==="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"graph-paper"}}))}handleLatexChanged(e,t){(this.getNumberInputLatex()!==e||t)&&(this.controller.getGeoModel().getCurrentTool().onNumberInput(e),this.controller.getGeoModel().onPreviewChange())}handleFocusedChanged(e,t){e&&!this.isNumberInputFocused()?this.controller.dispatch({type:"set-focus-location",location:{type:"new-transformation-number"}}):this.isNumberInputFocused()&&this.controller.dispatch({type:"blur-focus-location",location:{type:"new-transformation-number"}})}getActiveString(){let e=this.props.controller(),t=this.getStep().hint;return t?e.s(t):e.s("shared-calculator-narration-item-unknown")}isNumberInputStep(){return!!this.getStep().numberInputInfo}getStep(){return this.props.toolSpec().inputs[this.props.stepIdx()]}getInputType(){let e=this.props.activeStep(),t=this.props.stepIdx();return t<e?"completed":t>e?"upcoming":"active"}};var{SwitchUnion:Lfe,If:uZ}=$o.Components,sV=class extends $o.Class{constructor(){super(...arguments),this.afterInitialLoad=!1}init(){this.controller=this.props.controller()}template(){return $o.createElement("div",{class:()=>({"dcg-geometry-toolbar-view":!0,"dcg-after-initial-load":this.afterInitialLoad}),style:()=>({left:`${this.controller.computeMajorLayout().grapher.left}px`}),onTapStart:this.bindFn(this.onTapStart)},$o.createElement("div",{class:$o.const("dcg-header-left dcg-do-blur")},$o.createElement(uZ,{predicate:this.bindFn(this.showHamburger)},()=>$o.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-tooltip-open-graph"),gravity:this.const("s")},$o.createElement("div",{role:$o.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-open-graph"),tabIndex:$o.const("0"),class:$o.const("dcg-action-opendrawer dcg-icon-btn dcg-in-api-action-opendrawer"),onTap:()=>this.controller.dispatch({type:"open-drawer"})},$o.createElement("i",{class:$o.const("dcg-icon-hamburger"),"aria-hidden":$o.const("true")})))),$o.createElement(uZ,{predicate:this.bindFn(this.showOpenExpressionsButton)},()=>$o.createElement("div",{class:$o.const("dcg-show-expressions-tab dcg-icon-btn"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-show-list"),role:$o.const("button"),tabIndex:$o.const("0"),onTap:e=>{this.controller.dispatch({type:"show-expressions-list",focusHideIcon:e.device==="keyboard"})},manageFocus:this.const(ct({controller:this.controller,location:{type:"show-expression-list-btn"}}))},$o.createElement("i",{class:$o.const("dcg-icon-show"),"aria-hidden":$o.const("true")})))),$o.createElement("div",{class:$o.const("dcg-flex-spacer dcg-do-blur")}),Lfe(this.bindFn(this.getViewToShow),{tools:()=>$o.createElement(_I,{controller:this.props.controller}),selectedItems:()=>$o.createElement(OI,{controller:this.props.controller}),complexToolInstructions:()=>$o.createElement(aV,{controller:this.props.controller})}),$o.createElement("div",{class:$o.const("dcg-flex-spacer dcg-do-blur")}))}showHamburger(){return this.controller.getGraphSettings().config.showHamburger?!this.controller.isListEnabled()||!this.controller.isListVisible()||this.controller.isNarrow():!1}showOpenExpressionsButton(){return this.controller.isListEnabled()&&!this.controller.isListVisible()&&!this.controller.isNarrow()}willUpdate(){this.afterInitialLoad||this.getViewToShow()==="selectedItems"&&(this.afterInitialLoad=!0)}onTapStart(e){e.target.classList.contains("dcg-do-blur")&&(this.controller.dispatch({type:"set-none-selected"}),this.controller.dispatch({type:"select-geo-tool",tool:"selection"}))}getViewToShow(){let e=this.controller.getActiveTool();return __dcg_shared_module_exports__['gd'](e)?"complexToolInstructions":this.controller.shouldShowMultiSelectHeader()?"selectedItems":"tools"}};var di=__dcg_shared_module_exports__['e'](Z());var ec=__dcg_shared_module_exports__['e'](Z());var Jv=class extends ec.Class{init(){this.controller=this.props.controller()}template(){return ec.createElement("div",{class:()=>({"dcg-btn-flat-gray":this.props.isPillbox(),"dcg-btn-flat-gray-group":this.props.isPillbox(),"dcg-group-horizontal":this.props.isPillbox()})},ec.createElement(ze,{tooltip:()=>this.controller.getshowKeyboardShortcutsInTooltips()?this.controller.s("graphing-calculator-label-undo-with-shortcut-tooltip"):this.controller.s("graphing-calculator-label-undo-tooltip"),gravity:this.const("s"),disabled:()=>!this.controller.canUndo(),displayBlock:this.props.isPillbox},ec.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-action-undo":!0,"dcg-icon-btn":!0,"dcg-pillbox-btn-interior":this.props.isPillbox(),"dcg-disabled":!this.controller.canUndo()}),tabIndex:()=>this.controller.canUndo()?0:-1,"aria-label":()=>this.controller.s("graphing-calculator-narration-undo"),onTap:this.bindFn(this.undo),"aria-disabled":()=>!this.controller.canUndo()},ec.createElement("i",{class:ec.const("dcg-icon-undo"),"aria-hidden":ec.const("true")}))),ec.createElement(ze,{tooltip:()=>this.controller.getshowKeyboardShortcutsInTooltips()?this.controller.s("graphing-calculator-label-redo-with-shortcut-tooltip"):this.controller.s("graphing-calculator-label-redo-tooltip"),gravity:this.const("s"),disabled:()=>!this.controller.canRedo(),displayBlock:this.props.isPillbox},ec.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-action-redo":!0,"dcg-icon-btn":!0,"dcg-pillbox-btn-interior":this.props.isPillbox(),"dcg-disabled":!this.controller.canRedo()}),tabIndex:()=>this.controller.canRedo()?0:-1,"aria-label":()=>this.controller.s("graphing-calculator-narration-redo"),onTap:()=>this.controller.dispatch({type:"redo"}),"aria-disabled":()=>!this.controller.canRedo()},ec.createElement("i",{class:ec.const("dcg-icon-redo"),"aria-hidden":ec.const("true")}))))}undo(){this.controller.hasVisibleAndUndoableToast()?this.controller.toastUndo():this.controller.dispatch({type:"undo"})}};var ks=__dcg_shared_module_exports__['e'](Z());var{If:Pfe}=ks.Components,of=class extends ks.Class{init(){this.controller=this.props.controller()}template(){return ks.createElement(ze,{tooltip:this.bindFn(this.getTooltip),gravity:this.const("w")},ks.createElement("div",{class:()=>({"dcg-action-settings":!0,"dcg-pillbox-btn-interior":!0,"dcg-icon-btn":!0,"dcg-btn-flat-gray":this.isPillbox(),"dcg-settings-pillbox":this.isPillbox()}),role:ks.const("button"),tabIndex:ks.const("0"),"aria-haspopup":ks.const("true"),"aria-expanded":()=>this.controller.isGraphSettingsOpen(),"aria-label":this.bindFn(this.getTooltip),onTap:this.bindFn(this.onTapSettingsButton),manageFocus:this.const(ct({controller:this.controller,location:{type:"settings",location:"icon"}}))},ks.createElement("i",{class:ks.const("dcg-icon-wrench"),"aria-hidden":ks.const("true")}),ks.createElement(Pfe,{predicate:()=>this.controller.getLockViewportUserSetting()},()=>ks.createElement("i",{class:ks.const("dcg-icon-lock"),"aria-hidden":ks.const("true")}))))}getTooltip(){return this.controller.isGeometry()?this.controller.s("graphing-calculator-label-tooltip-geometry-settings"):this.controller.s("graphing-calculator-label-tooltip-graph-settings")}isPillbox(){return this.props.isPillbox&&this.props.isPillbox()}onTapSettingsButton(e){this.controller.dispatch({type:"toggle-graph-settings",focusOnOpen:e.device==="keyboard"})}};var si=__dcg_shared_module_exports__['e'](Z()),{SwitchUnion:Ofe}=si.Components,PS=class extends si.Class{template(){return this.controller=this.props.controller(),Ofe(()=>this.controller.getBrandingMode(),{"static-edit-link":()=>si.createElement("div",{class:si.const("dcg-graphpaper-branding")},si.createElement("a",{href:()=>this.controller.getEditLink(),target:si.const("_blank")},si.createElement("span",{class:si.const("dcg-powered-by"),"aria-label":()=>this.controller.s("graphing-calculator-narration-edit-on-kiavash")},()=>this.controller.s("graphing-calculator-link-edit-on-kiavash")),si.createElement("i",{class:si.const("dcg-icon-kiavash"),"aria-hidden":si.const("true")}))),"edit-link":()=>si.createElement("div",{class:si.const("dcg-graphpaper-branding")},si.createElement("span",{class:si.const("dcg-edit-branding"),onTap:()=>this.controller.dispatch({type:"open-on-web"})},si.createElement("span",{class:si.const("dcg-powered-by"),"aria-label":()=>this.controller.s("graphing-calculator-narration-edit-on-kiavash")},()=>this.controller.s("graphing-calculator-link-edit-on-kiavash")),si.createElement("i",{class:si.const("dcg-icon-kiavash"),"aria-hidden":si.const("true")}))),"powered-by":()=>si.createElement("div",{class:si.const("dcg-graphpaper-branding dcg-unclickable")},si.createElement("span",{class:si.const("dcg-powered-by"),"aria-label":()=>this.controller.s("graphing-calculator-narration-powered-by-kiavash")},()=>this.controller.s("graphing-calculator-label-powered-by")),si.createElement("i",{class:si.const("dcg-icon-kiavash"),"aria-hidden":si.const("true")}))})}};var Ac=__dcg_shared_module_exports__['e'](Z());var OS=class extends Ac.Class{init(){this.controller=this.props.controller()}template(){return Ac.createElement("div",{class:Ac.const("dcg-reset-container")},Ac.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-tooltip-reset"),gravity:this.props.tooltipGravity},Ac.createElement("div",{class:Ac.const("dcg-reset-pillbox dcg-action-reset dcg-btn-flat-gray dcg-pillbox-btn-interior"),role:Ac.const("button"),tabIndex:Ac.const("0"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-reset"),onTap:this.bindFn(this.reset)},Ac.createElement("i",{class:Ac.const("dcg-icon-reset"),"aria-hidden":Ac.const("true")}))))}reset(){this.controller.dispatch({type:"reset-graph"})}};var _s=__dcg_shared_module_exports__['e'](Z());var RS=class extends _s.Class{init(){this.controller=this.props.controller()}template(){return _s.createElement("div",{class:()=>({"dcg-3d-orientation-pillbox":!0,"dcg-btn-flat-gray":!0,"dcg-btn-flat-gray-group":!0,"dcg-group-horizontal":this.props.layout()==="horizontal","dcg-group-vertical":this.props.layout()==="vertical"}),role:_s.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-narration-3d-orientation-options-label")},_s.createElement(ze,{disabled:this.bindFn(this.isDefaultOrientation),tooltip:this.bindFn(this.getDefaultOrientationLabel),gravity:this.bindFn(this.getTooltipGravity),displayBlock:this.const(!0)},_s.createElement("div",{class:()=>({"dcg-action-defaultorientation":!0,"dcg-pillbox-btn-interior":!0,"dcg-disabled":this.isDefaultOrientation()}),role:_s.const("button"),"aria-disabled":this.bindFn(this.isDefaultOrientation),tabIndex:()=>this.isDefaultOrientation()?-1:0,"aria-label":this.bindFn(this.getDefaultOrientationLabel),onTap:this.bindFn(this.rotateToDefaultOrientation)},_s.createElement("i",{class:_s.const("dcg-icon-3d-cube"),"aria-hidden":_s.const("true")}))),_s.createElement(ze,{tooltip:this.bindFn(this.getXYOrientationLabel),gravity:this.bindFn(this.getTooltipGravity),disabled:this.bindFn(this.isXYPlaneOrientation),displayBlock:this.const(!0)},_s.createElement("div",{class:()=>({"dcg-action-xyorientation":!0,"dcg-pillbox-btn-interior":!0,"dcg-disabled":this.isXYPlaneOrientation()}),role:_s.const("button"),"aria-disabled":this.bindFn(this.isXYPlaneOrientation),tabIndex:()=>this.isXYPlaneOrientation()?-1:0,"aria-label":this.bindFn(this.getXYOrientationLabel),onTap:this.bindFn(this.rotateToXyOrientation)},_s.createElement("i",{class:_s.const("dcg-icon-xy-plane"),"aria-hidden":_s.const("true")}))))}getTooltipGravity(){return this.props.layout()==="horizontal"?"s":"w"}rotateToDefaultOrientation(){this.controller.dispatch({type:"zoom",direction:"default3dOrientation"})}rotateToXyOrientation(){this.controller.dispatch({type:"zoom",direction:"xy3dOrientation"})}isDefaultOrientation(){var t;let e=(t=this.controller.getGrapher3d())==null?void 0:t.controls;return!!(e!=null&&e.isDefaultOrientation())}isXYPlaneOrientation(){var t;let e=(t=this.controller.getGrapher3d())==null?void 0:t.controls;return!!(e!=null&&e.isXYPlaneOrientation())}getDefaultOrientationLabel(){return this.controller.s("graphing-calculator-label-tooltip-zoom-default-orientation")}getXYOrientationLabel(){return this.controller.s("graphing-calculator-label-tooltip-zoom-xy-orientation")}};var Oe=__dcg_shared_module_exports__['e'](Z());$t();var Vc=function(r,e,t){if(r===void 0||e===void 0)return!1;let o,i=e.getBoundingClientRect().height,n=r.getBoundingClientRect().height,a=wi(r),s=wi(e);if(!a||!s)return!1;let l=e.scrollTop,c=a.top+l-s.top,d=c-t,p=n+c+t-i;return d>=p?o=Math.min(Math.max(l,p),d):o=.5*(d+p),o!==l?(e.scrollTop=o,e.scrollTop!=l):!1};var li=__dcg_shared_module_exports__['e'](Z());var nf=__dcg_shared_module_exports__['e'](Z());var dy=class extends nf.Class{template(){return nf.createElement("div",{class:nf.const("dcg-checkbox-title dcg-lock-viewport-option")},nf.createElement(Gt,{ariaLabel:()=>this.props.controller().s("graphing-calculator-label-settings-lock-viewport"),onChange:()=>{this.props.controller().dispatch({type:"toggle-lock-viewport"})},checked:()=>this.props.controller().getLockViewportUserSetting()},()=>this.props.controller().s("graphing-calculator-label-settings-lock-viewport")),nf.createElement(zu,{href:this.const("https://help.kiavash.com/hc/en-us/articles/4405296853517#h_01FZX4DBWKD83TZVMH615XF3QA"),controller:this.props.controller}))}};var{If:lV}=li.Components,cV=class extends li.Class{init(){this.controller=this.props.controller(),this.isOpen=this.getAxisScale("x")==="logarithmic"||this.getAxisScale("y")==="logarithmic"||this.controller.getLockViewportUserSetting()}template(){return li.createElement("div",{class:li.const("dcg-advanced-graph-settings-view")},li.createElement(lV,{predicate:()=>this.shouldShowLogScalesOption()},()=>li.createElement("div",null,li.createElement("div",{class:()=>({"dcg-advanced-toggle":!0,"dcg-margin-top":!0,"dcg-opened":this.isOpen}),onTap:this.bindFn(this.toggleOpen),tabIndex:li.const(0),role:li.const("button"),"aria-pressed":()=>this.isOpen},li.createElement("div",{class:li.const("dcg-caret-container")},li.createElement("i",{class:li.const("dcg-icon-caret-down"),"aria-hidden":li.const("true")})),()=>this.controller.s("graphing-calculator-label-more-viewport-options")),li.createElement(lV,{predicate:()=>this.isOpen},()=>li.createElement("div",{class:li.const("dcg-advanced-contents")},li.createElement("div",{class:li.const("dcg-log-axes-container")},li.createElement("div",null,()=>this.getAxisScaleLabel("x")),li.createElement(Po,{ariaGroupLabel:()=>this.getAxisScaleLabel("x"),theme:this.const("mini"),staticConfig:this.const(this.getStaticConfigForAxis("x"))}),li.createElement("div",null,()=>this.getAxisScaleLabel("y")),li.createElement(Po,{ariaGroupLabel:()=>this.getAxisScaleLabel("y"),theme:this.const("mini"),staticConfig:this.const(this.getStaticConfigForAxis("y"))})),li.createElement(lV,{predicate:()=>!this.controller.getLockViewportConfigSetting()},()=>li.createElement(dy,{...this.props})))))),li.createElement(lV,{predicate:()=>!this.controller.getLockViewportConfigSetting()&&!this.shouldShowLogScalesOption()},()=>li.createElement(dy,{...this.props})))}toggleOpen(){this.isOpen=!this.isOpen,this.update()}getAxisScaleLabel(e){return e==="x"?this.controller.s("graphing-calculator-label-settings-x-axis")+":":this.controller.s("graphing-calculator-label-settings-y-axis")+":"}getStaticConfigForAxis(e){return[{key:"linear",label:()=>"Linear",selected:()=>this.getAxisScale(e)==="linear",onSelect:()=>this.setAxisScale({axis:e,scale:"linear"})},{key:"logarithmic",label:()=>"Logarithmic",selected:()=>this.getAxisScale(e)==="logarithmic",onSelect:()=>this.setAxisScale({axis:e,scale:"logarithmic"})}]}shouldShowLogScalesOption(){return this.controller.getGraphSettings().config.logScales&&!this.controller.isThreeDMode()}getAxisScale(e){return this.controller.getGraphSettings()[e==="x"?"xAxisScale":"yAxisScale"]}setAxisScale({axis:e,scale:t}){return this.controller.dispatch({type:"set-graph-settings",[e==="x"?"xAxisScale":"yAxisScale"]:t})}};var Na=__dcg_shared_module_exports__['e'](Z());var{If:Rfe}=Na.Components,af=class extends Na.Class{init(){this.controller=this.props.controller()}template(){return Na.createElement("div",null,Na.createElement("div",{class:Na.const("dcg-braille-options-buttons")},Na.createElement(Po,{ariaGroupLabel:()=>this.controller.s("shared-calculator-narration-braille-mode"),staticConfig:this.bindFn(this.getBrailleOptions)})),Na.createElement("div",{class:Na.const("dcg-six-key-checkbox")},Na.createElement(Gt,{onChange:e=>this.controller.dispatch({type:"set-six-key-input",useSixKeyInput:e}),checked:()=>this.controller.getSixKeyInput()},()=>this.controller.s("graphing-calculator-label-settings-six-key-braille")),Na.createElement(zu,{href:this.const("https://www.desmos.com/accessibility#braille"),controller:this.props.controller})),Na.createElement(Rfe,{predicate:this.props.showBrailleNote},()=>Na.createElement("div",{class:Na.const("dcg-refreshable-braille-note")},()=>this.controller.s("graphing-calculator-text-refreshable-braille-display-note")+" ",Na.createElement("a",{href:()=>"https://www.desmos.com/braille-examples?"+this.controller.getBrailleMode(),class:Na.const("dcg-blue-link"),target:Na.const("_blank")},()=>this.controller.s("graphing-calculator-link-view-braille-examples")))))}getBrailleOptions(){return[{key:"nemeth",label:()=>this.controller.s("shared-calculator-button-braille-mode-nemeth"),selected:()=>this.controller.getBrailleMode()==="nemeth",onSelect:()=>this.setBrailleMode("nemeth")},{key:"ueb",label:()=>this.controller.s("shared-calculator-button-braille-mode-ueb"),selected:()=>this.controller.getBrailleMode()==="ueb",onSelect:()=>this.setBrailleMode("ueb")}]}setBrailleMode(e){this.controller.dispatch({type:"set-braille-mode",mode:e})}};var Ba=__dcg_shared_module_exports__['e'](Z());var Mp=__dcg_shared_module_exports__['e'](Z()),ci=class extends Mp.Class{template(){return Mp.createElement("div",{class:()=>({"dcg-toggle-view":!0,"dcg-toggled":this.props.toggled()}),"aria-label":()=>this.props.ariaLabel(),role:Mp.const("checkbox"),tabIndex:Mp.const("0"),"aria-checked":()=>this.props.toggled(),toggled:()=>this.props.toggled(),onTap:this.bindFn(this.props.onChange)},Mp.createElement("div",{class:Mp.const("dcg-toggle-track")},Mp.createElement("div",{class:Mp.const("dcg-toggle-switch")})))}};var{If:hZ}=Ba.Components,sf=class extends Ba.Class{init(){this.controller=this.props.controller()}toggleComplexMode(){this.controller.logEvent({category:"settings",action:this.props.isComplexModeEnabled()?"disable-complex":"enable-complex"}),this.props.toggleComplexMode()}template(){return Ba.createElement("div",{class:Ba.const("dcg-options-menu-section dcg-complex-container")},Ba.createElement("div",{class:Ba.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-label-settings-complex-mode"),Ba.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-label-settings-complex-mode"),onChange:this.bindFn(this.toggleComplexMode),toggled:this.props.isComplexModeEnabled})),Ba.createElement(hZ,{predicate:this.props.isComplexModeEnabled},()=>Ba.createElement("div",{class:Ba.const("dcg-complex-options-section")},Ba.createElement("div",{class:Ba.const("dcg-complex-enabled-note")},Ba.createElement(Bl,{content:()=>this.controller.s("shared-calculator-text-complex-enabled-note",{eq1:"`i^2`",eq2:"`\\sqrt{-4}`"}),mqConfig:this.const({})}),Ba.createElement(hZ,{predicate:()=>this.props.product()==="graphing"||this.props.product()==="graphing-3d"},()=>Ba.createElement("div",{class:Ba.const("dcg-complex-plotting-note")},()=>this.controller.s("graphing-calculator-text-complex-plotting-note")))))))}};var Ap=__dcg_shared_module_exports__['e'](Z());var{IfElse:Ffe}=Ap.Components,Kd=class extends Ap.Class{init(){this.controller=this.props.setup().controller}getGravity(){return this.props.setup().type==="basic"?"s":this.controller.isNarrow()?"n":"w"}template(){return Ap.createElement("div",{class:Ap.const("dcg-options-menu-section dcg-radiangroup")},Ffe(()=>this.controller.isComplexModeEnabled(),{true:()=>Ap.createElement(ze,{tooltip:()=>this.controller.s("shared-calculator-text-complex-radian-mode"),gravity:this.bindFn(this.getGravity),sticky:this.const(!0),displayBlock:this.const(!0),additionalClass:this.const("dcg-cursor-default")},Ap.createElement(Po,{ariaGroupLabel:()=>this.controller.s("graphing-calculator-narration-settings-angle"),theme:()=>this.props.setup().type==="basic"?"mini":"default",staticConfig:this.bindFn(this.getAngleModeOptions),disabled:()=>this.controller.isComplexModeEnabled()})),false:()=>this.renderControl()}))}renderControl(){return Ap.createElement(Po,{ariaGroupLabel:()=>this.controller.s("graphing-calculator-narration-settings-angle"),theme:()=>this.props.setup().type==="basic"?"mini":"default",staticConfig:this.bindFn(this.getAngleModeOptions),disabled:()=>this.controller.isComplexModeEnabled()})}getAngleModeOptions(){let e=this.props.setup();return[{key:"radians",label:()=>e.type==="basic"?this.controller.s("basic-calculator-label-controlbar-rad"):this.controller.s("graphing-calculator-button-settings-radians"),selected:()=>!this.getDegreeMode(),onSelect:()=>this.setDegreeMode(!1),focusHelperOptions:e.type==="advanced"?{controller:e.controller,location:{type:"settings",location:"radian-mode"}}:void 0},{key:"degrees",label:()=>e.type==="basic"?this.controller.s("basic-calculator-label-controlbar-deg"):this.controller.s("graphing-calculator-button-settings-degrees"),selected:()=>this.getDegreeMode(),onSelect:()=>this.setDegreeMode(!0),focusHelperOptions:e.type==="advanced"?{controller:e.controller,location:{type:"settings",location:"degree-mode"}}:void 0}]}getDegreeMode(){return this.controller.getDegreeMode()}setDegreeMode(e){this.controller.dispatch({type:"update-degree-mode",mode:e})}};var dg=__dcg_shared_module_exports__['e'](Z());var Qv=class extends dg.Class{init(){this.controller=this.props.controller()}template(){return dg.createElement("div",null,dg.createElement("div",{class:dg.const("dcg-displaysizegroup")},dg.createElement(Po,{ariaGroupLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size"),staticConfig:this.bindFn(this.getProjectorModeOptions)})),dg.createElement(Gt,{onChange:this.bindFn(this.toggleInvertedColors),checked:()=>this.controller.getInvertedColors(),manageFocus:this.const(ct({controller:this.controller,location:{type:"settings",location:"reverse-contrast"}}))},()=>this.controller.s("graphing-calculator-label-settings-reverse-contrast")))}getProjectorModeOptions(){return[{key:"default",label:()=>"A",ariaLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size-default"),class:()=>"dcg-displaysize-default",selected:()=>!this.getProjectorMode(),onSelect:()=>this.onSelectProjectorModeOption(!1),focusHelperOptions:{controller:this.controller,location:{type:"settings",location:"default-size"}}},{key:"large",label:()=>"A",ariaLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size-large"),class:()=>"dcg-displaysize-large",selected:()=>this.getProjectorMode(),onSelect:()=>this.onSelectProjectorModeOption(!0),focusHelperOptions:{controller:this.controller,location:{type:"settings",location:"large-size"}}}]}onSelectProjectorModeOption(e){this.controller.dispatch({type:"set-projector-mode",value:e})}getProjectorMode(){return!!this.controller.getGraphSettings().config.projectorMode}toggleInvertedColors(){this.controller.dispatch({type:"set-inverted-colors",value:!this.controller.getInvertedColors()})}};var{Input:gZ,If:ud,IfElse:mZ}=Oe.Components,lf=class extends Oe.Class{template(){return Oe.createElement(zr,{isFocused:()=>this.props.parent().getFocusedLimit()===this.props.limit(),latex:()=>this.props.parent().getLimitLatex(this.props.limit()),ariaLabel:this.props.ariaLabel,handleLatexChanged:e=>this.props.parent().setLimitLatex(this.props.limit(),e),handleFocusChanged:e=>this.props.parent().onFocusedChanged(this.props.limit(),e),hasError:()=>this.props.parent().isLimitInvalid(this.props.limit()),dataLabelAttributeValue:this.props.limit,controller:this.props.controller,readonly:this.const(!1),containerClass:()=>({"dcg-log-scale":this.props.axisScale()==="logarithmic"})})}},dV=class extends Oe.Class{init(){this.controller=this.props.controller(),this.uuid=Ld()}template(){return Oe.createElement("div",{class:Oe.const("dcg-settings-view-container")},Oe.createElement(of,{...this.props,isPillbox:this.const(!0)}),Oe.createElement(ud,{predicate:()=>this.controller.isGraphSettingsOpen()},()=>Oe.createElement("div",{class:Oe.const("dcg-settings-container dcg-left dcg-popover dcg-constrained-height-popover"),style:this.bindFn(this.getContainerStyle),didMount:this.bindFn(this.didMountContainer),didUnmount:this.bindFn(this.didUnmountContainer)},Oe.createElement("div",{class:Oe.const("dcg-popover-interior"),role:Oe.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-graph-settings")},Oe.createElement("div",{class:Oe.const("dcg-visual-settings")},Oe.createElement(Qv,{controller:this.props.controller}),Oe.createElement(ud,{predicate:()=>this.controller.getBrailleControls()},()=>Oe.createElement("div",{class:Oe.const("dcg-braille-container dcg-braille-mode")},Oe.createElement(Gt,{onChange:this.bindFn(this.toggleBrailleMode),checked:()=>this.controller.getBrailleMode()!=="none"},()=>this.controller.s("shared-calculator-narration-braille-mode")),Oe.createElement(ud,{predicate:()=>this.controller.getBrailleMode()!=="none"},()=>Oe.createElement("div",{class:Oe.const("dcg-braille-options-container")},Oe.createElement(af,{controller:this.props.controller,showBrailleNote:this.const(!0)})))))),Oe.createElement("div",{class:Oe.const("dcg-top-section-flex dcg-grid-settings-container")},Oe.createElement("div",{class:Oe.const("dcg-grid-settings")},Oe.createElement(Gt,{class:this.const("dcg-settings-grid-toggle"),onChange:this.bindFn(this.toggleGrid),checked:this.bindFn(this.getShowGrid)},()=>this.controller.s("graphing-calculator-label-settings-grid")),Oe.createElement(ud,{predicate:this.bindFn(this.getShowGrid)},()=>Oe.createElement("div",{class:Oe.const("dcg-circle-icon-group dcg-grid-group")},Oe.createElement("div",{class:()=>({"dcg-circle-icon":!0,"dcg-action-cartesian":!0,"dcg-selected":!this.getPolarMode()}),role:Oe.const("button"),tabIndex:Oe.const("0"),"aria-pressed":()=>!this.getPolarMode(),"aria-label":()=>this.controller.s("graphing-calculator-narration-settings-cartesian-grid"),onTap:this.bindFn(this.setCartesianMode)},Oe.createElement("i",{class:Oe.const("dcg-icon-cartesian")})),Oe.const("\xA0"),Oe.createElement("div",{class:()=>({"dcg-circle-icon":!0,"dcg-action-polar":!0,"dcg-selected":this.getPolarMode()}),role:Oe.const("button"),tabIndex:Oe.const("0"),"aria-pressed":()=>this.getPolarMode(),"aria-label":()=>this.controller.s("graphing-calculator-narration-settings-polar-grid"),onTap:this.bindFn(this.setPolarMode)},Oe.createElement("i",{class:Oe.const("dcg-icon-polar")})))),Oe.createElement(Gt,{onChange:this.bindFn(this.toggleArrows),checked:()=>this.getAxisArrowMode()!=="NONE"},()=>this.controller.s("graphing-calculator-label-settings-arrows")),Oe.createElement(ud,{predicate:()=>this.getAxisArrowMode()!=="NONE"},()=>Oe.createElement("div",{class:Oe.const("dcg-circle-icon-group dcg-arrow-group")},Oe.createElement("div",{role:Oe.const("button"),tabIndex:Oe.const("0"),class:()=>({"dcg-circle-icon":!0,"dcg-arrows":!0,"dcg-selected":this.getAxisArrowMode()==="BOTH"}),"dcg-arrows":Oe.const("BOTH"),"aria-label":()=>this.controller.s("graphing-calculator-narration-settings-show-both"),"aria-pressed":()=>this.getAxisArrowMode()==="BOTH",onTap:()=>this.setAxisArrowMode("BOTH")},Oe.createElement("i",{class:Oe.const("dcg-icon-arrows-two"),"aria-hidden":Oe.const("true")})),Oe.const("\xA0"),Oe.createElement("div",{role:Oe.const("button"),tabIndex:Oe.const("0"),class:()=>({"dcg-circle-icon":!0,"dcg-arrows":!0,"dcg-selected":this.getAxisArrowMode()==="POSITIVE"}),"dcg-arrows":Oe.const("POSITIVE"),"aria-label":()=>this.controller.s("graphing-calculator-narration-settings-show-positive"),"aria-pressed":()=>this.getAxisArrowMode()==="POSITIVE",onTap:()=>this.setAxisArrowMode("POSITIVE")},Oe.createElement("i",{class:Oe.const("dcg-icon-arrows-one"),"aria-hidden":Oe.const("true")}))))),Oe.createElement("div",{class:Oe.const("dcg-top-checkboxes-container")},Oe.createElement(Gt,{onChange:this.bindFn(this.toggleAxisNumbers),checked:this.bindFn(this.getAxisNumbers),small:this.const(!0)},()=>this.controller.s("graphing-calculator-label-settings-axis-numbers")),Oe.createElement(ud,{predicate:()=>this.getShowGrid()&&!this.getPolarMode()},()=>Oe.createElement(Gt,{onChange:this.bindFn(this.toggleMinorGridlines),checked:this.bindFn(this.getMinorGridlines),small:this.const(!0)},()=>this.controller.s("graphing-calculator-label-settings-minor-gridlines"))),Oe.createElement(ud,{predicate:()=>this.controller.canUseAdvancedStyling()&&!this.getPolarMode()},()=>Oe.createElement(Gt,{checked:()=>this.controller.getGraphSettings().restrictGridToFirstQuadrant,onChange:e=>this.controller.dispatch({type:"set-graph-settings",restrictGridToFirstQuadrant:e}),small:this.const(!0)},()=>this.controller.s("graphing-calculator-label-settings-one-quadrant"))),Oe.createElement(ud,{predicate:this.bindFn(this.showZoomSquareButton)},()=>Oe.createElement("div",{role:Oe.const("button"),tabIndex:Oe.const("0"),class:Oe.const("dcg-action-zoom-square dcg-btn-light-gray"),onTap:this.bindFn(this.zoomSquare)},()=>this.controller.s("graphing-calculator-button-settings-zoom-square"))))),Oe.createElement("div",{class:Oe.const("dcg-axes-settings-container")},Oe.createElement("div",{class:Oe.const("dcg-checkbox-title dcg-x-axis-title")},Oe.createElement(Gt,{onChange:this.bindFn(this.toggleXAxis),checked:this.bindFn(this.getShowXAxis)},Oe.createElement("span",{id:this.const(`x-axis-description-${this.uuid}`)},()=>this.controller.s("graphing-calculator-label-settings-x-axis"))),Oe.createElement(ud,{predicate:this.bindFn(this.getShowXAxis)},()=>Oe.createElement("div",{class:Oe.const("dcg-axis-label")},Oe.createElement("label",{for:this.const(`x-axis-label-${this.uuid}`)},()=>this.controller.s("graphing-calculator-button-label")),Oe.createElement(gZ,{class:this.const("dcg-x-axis-label"),disabled:()=>this.getShowXAxis()?void 0:!0,onInput:this.bindFn(this.onXAxisLabelInput),value:this.bindFn(this.getXAxisLabel),"aria-describedby":this.const(`x-axis-description-${this.uuid}`),id:this.const(`x-axis-label-${this.uuid}`),placeholder:()=>this.controller.s("graphing-calculator-narration-settings-x-axis-label-placeholder")})))),Oe.createElement("div",{class:Oe.const("dcg-editable-mathquill-container dcg-x-axis-options")},Oe.createElement(lf,{limit:this.const("xmin"),axisScale:()=>this.getAxisScale("x"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-x-axis-min"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),Oe.createElement(Et,{config:this.const({}),latex:this.const("\\le x\\le")},Oe.createElement("span",{class:Oe.const("dcg-interval-interior")})),Oe.createElement(lf,{limit:this.const("xmax"),axisScale:()=>this.getAxisScale("x"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-x-axis-max"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),Oe.createElement(ud,{predicate:()=>!this.getPolarMode()},()=>mZ(()=>this.getAxisScale("x")==="linear",{true:()=>Oe.createElement("span",{class:Oe.const("dcg-step-container")},Oe.createElement("span",{class:Oe.const("dcg-step-label"),"aria-hidden":Oe.const("true")},()=>this.controller.s("graphing-calculator-label-settings-step")),Oe.createElement(lf,{limit:this.const("xstep"),axisScale:this.const("linear"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-x-axis-step"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller})),false:()=>Oe.createElement("span",{style:Oe.const("display: none")})}))),Oe.createElement("div",{class:Oe.const("dcg-checkbox-title dcg-y-axis-title")},Oe.createElement(Gt,{onChange:this.bindFn(this.toggleYAxis),checked:this.bindFn(this.getShowYAxis)},Oe.createElement("span",{id:this.const(`y-axis-description-${this.uuid}`)},()=>this.controller.s("graphing-calculator-label-settings-y-axis"))),Oe.createElement(ud,{predicate:this.bindFn(this.getShowYAxis)},()=>Oe.createElement("div",{class:Oe.const("dcg-axis-label")},Oe.createElement("label",{for:this.const(`y-axis-label-${this.uuid}`)},()=>this.controller.s("graphing-calculator-button-label")),Oe.createElement(gZ,{class:this.const("dcg-y-axis-label"),onInput:this.bindFn(this.onYAxisLabelInput),value:this.bindFn(this.getYAxisLabel),"aria-describedby":this.const(`y-axis-description-${this.uuid}`),id:this.const(`y-axis-label-${this.uuid}`),placeholder:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-label-placeholder")})))),Oe.createElement("div",{class:Oe.const("dcg-editable-mathquill-container dcg-y-axis-options")},Oe.createElement(lf,{limit:this.const("ymin"),axisScale:()=>this.getAxisScale("y"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-min"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),Oe.createElement(Et,{config:this.const({}),latex:this.const("\\le y\\le")},Oe.createElement("span",{class:Oe.const("dcg-interval-interior")})),Oe.createElement(lf,{limit:this.const("ymax"),axisScale:()=>this.getAxisScale("y"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-max"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),Oe.createElement(ud,{predicate:()=>!this.getPolarMode()},()=>mZ(()=>this.getAxisScale("y")==="linear",{true:()=>Oe.createElement("span",{class:Oe.const("dcg-step-container")},Oe.createElement("span",{class:Oe.const("dcg-step-label"),"aria-hidden":Oe.const("true")},()=>this.controller.s("graphing-calculator-label-settings-step")),Oe.createElement(lf,{limit:this.const("ystep"),axisScale:this.const("linear"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-step"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller})),false:()=>Oe.createElement("span",{style:Oe.const("display: none")})})))),Oe.createElement(cV,{controller:this.props.controller}),Oe.createElement(ud,{predicate:()=>this.controller.canEnableComplexMode()},()=>Oe.createElement(sf,{...this.props,isComplexModeEnabled:()=>this.controller.isComplexModeEnabled(),toggleComplexMode:()=>this.controller.dispatch({type:"toggle-complex-mode"}),product:()=>this.controller.getProduct()})),Oe.createElement(Kd,{setup:this.const({controller:this.controller,type:"advanced"})}),Oe.createElement("div",{class:Oe.const("dcg-arrow")})))))}toggleBrailleMode(){this.controller.dispatch({type:"set-braille-mode",mode:this.controller.getBrailleMode()==="none"?"nemeth":"none"})}didMountContainer(e){this.node=e,re(document.documentElement).on("dcg-tapstart.settings-view wheel.settings-view",t=>{this.eventShouldClosePopover(t)&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:t.device==="keyboard"})}),re(document.documentElement).on("keydown.settings-view",t=>{let o=Be(t);if(o==="Esc"&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:!0}),this.controller.isGraphSettingsOpen()&&o==="Tab"&&!t.altKey&&!t.metaKey&&!t.ctrlKey){let i=this.controller.getFocusLocation();if(!i||i.type!=="settings")return;let n=!!this.controller.getGraphSettings().config.projectorMode,a=!!this.controller.getGraphSettings().degreeMode;t.shiftKey?t.shiftKey&&(n&&i.location==="large-size"||!n&&i.location==="default-size"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation()):i.location==="icon"&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:a?"degree-mode":"radian-mode"}}),t.preventDefault(),t.stopPropagation())):i.location==="icon"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:n?"large-size":"default-size"}}),t.preventDefault(),t.stopPropagation()):(!a&&i.location==="radian-mode"||a&&i.location==="degree-mode")&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation())}})}didUnmountContainer(){re(document.documentElement).off(".settings-view")}didUpdate(){if(!this.controller.isGraphSettingsOpen())return;let e=this.controller.getKeypadHeight();e!==this.cachedKeypadHeight&&document.activeElement&&this.node.contains(document.activeElement)&&Vc(document.activeElement,this.node.querySelector(".dcg-popover-interior"),50),this.cachedKeypadHeight=e}eventShouldClosePopover(e){let t=e.target,o=this.node.contains(t),i=!!t.closest(".dcg-action-settings"),n=this.isMathquillFocused()&&!!t.closest(".dcg-keypad"),a=!!t.closest(".dcg-action-undo")||!!t.closest(".dcg-action-redo");return!(o||i||n||a)}isMathquillFocused(){return this.getFocusedLimit()!==void 0}getLimitLatex(e){return this.controller.getSettingsViewModel().limitLatex[e]||""}setLimitLatex(e,t){t!==this.controller.getSettingsViewModel().limitLatex[e]&&this.controller.dispatch({type:"set-axis-limit-latex",limit:e,latex:t})}getFocusedLimit(){let e=this.controller.getFocusLocation();if(e&&e.type==="settings")return e.location}getInvalidLimits(){let e=!!this.controller.getGraphSettings().degreeMode,t=Qo(this.getLimitLatex("xmin"),e),o=Qo(this.getLimitLatex("xmax"),e),i=Qo(this.getLimitLatex("ymin"),e),n=Qo(this.getLimitLatex("ymax"),e),a=this.getLimitLatex("xstep")===""?0:Qo(this.getLimitLatex("xstep"),e),s=this.getLimitLatex("ystep")===""?0:Qo(this.getLimitLatex("ystep"),e),l={},c=new Co(t,o,i,n);return isFinite(t)&&isFinite(o)?(l.xmin=!c.isXValid(this.controller.getGraphSettings().xAxisScale),l.xmax=l.xmin):(l.xmin=!isFinite(t),l.xmax=!isFinite(o)),isFinite(i)&&isFinite(n)?(l.ymin=!c.isYValid(this.controller.getGraphSettings().yAxisScale),l.ymax=l.ymin):(l.ymin=!isFinite(i),l.ymax=!isFinite(n)),l.xstep=!Yy(a),l.ystep=!Yy(s),l}isLimitInvalid(e){return this.getInvalidLimits()[e]}onFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"settings",location:e}})}onXAxisLabelInput(e){this.controller.dispatch({type:"set-graph-settings",xAxisLabel:e})}onYAxisLabelInput(e){this.controller.dispatch({type:"set-graph-settings",yAxisLabel:e})}getXAxisLabel(){return this.controller.getGraphSettings().xAxisLabel}getYAxisLabel(){return this.controller.getGraphSettings().yAxisLabel}getShowXAxis(){return!!this.controller.getGraphSettings().showXAxis}toggleXAxis(){this.controller.dispatch({type:"set-graph-settings",showXAxis:!this.getShowXAxis()})}getShowYAxis(){return!!this.controller.getGraphSettings().showYAxis}toggleYAxis(){this.controller.dispatch({type:"set-graph-settings",showYAxis:!this.getShowYAxis()})}getAxisNumbers(){return!!this.controller.getGraphSettings().xAxisNumbers}toggleAxisNumbers(){let e=this.getAxisNumbers();this.controller.dispatch({type:"set-graph-settings",xAxisNumbers:!e,yAxisNumbers:!e,polarNumbers:!e})}getMinorGridlines(){return this.controller.getGraphSettings().xAxisMinorSubdivisions===0}toggleMinorGridlines(){let e=this.getMinorGridlines()?1:0;this.controller.dispatch({type:"set-graph-settings",yAxisMinorSubdivisions:e,xAxisMinorSubdivisions:e})}getPolarMode(){return!!this.controller.getGraphSettings().polarMode}setPolarMode(){this.controller.dispatch({type:"set-polar-mode",polarMode:!0})}setCartesianMode(){this.controller.dispatch({type:"set-polar-mode",polarMode:!1})}getAxisScale(e){return this.controller.getGraphSettings()[e==="x"?"xAxisScale":"yAxisScale"]}getAxisArrowMode(){return this.controller.getGraphSettings().xAxisArrowMode}setAxisArrowMode(e){this.controller.dispatch({type:"set-graph-settings",xAxisArrowMode:e,yAxisArrowMode:e})}getShowGrid(){return this.controller.getGraphSettings().showGrid}toggleGrid(){this.controller.dispatch({type:"set-graph-settings",showGrid:!this.getShowGrid()})}toggleArrows(){let e=this.getAxisArrowMode()==="NONE"?"BOTH":"NONE";this.controller.dispatch({type:"set-graph-settings",xAxisArrowMode:e,yAxisArrowMode:e})}showZoomSquareButton(){let e=this.controller.getAxisScaleSettings();return e.xAxisScale===e.yAxisScale&&!this.controller.getGraphSettings().squareAxes}getContainerStyle(){return this.controller.getKeypadHeight()?"bottom: 0":""}zoomSquare(){this.controller.dispatch({type:"zoom",direction:"square"})}};var ao=__dcg_shared_module_exports__['e'](Z());$t();var xl=__dcg_shared_module_exports__['e'](Z());var{If:fZ}=xl.Components,Zv=class extends xl.Class{init(){this.controller=this.props.controller()}template(){return xl.createElement(fZ,{predicate:this.bindFn(this.shouldShowBrailleSection)},()=>xl.createElement("div",{class:xl.const("dcg-options-menu-section")},xl.createElement("div",{class:xl.const("dcg-options-menu-section-title")},()=>this.controller.s("shared-calculator-narration-braille-mode"),xl.createElement(ci,{ariaLabel:()=>this.controller.s("shared-calculator-narration-braille-mode"),onChange:this.bindFn(this.toggleBrailleMode),toggled:()=>this.controller.getBrailleMode()!=="none"})),xl.createElement(fZ,{predicate:()=>this.controller.getBrailleMode()!=="none"},()=>xl.createElement("div",{class:xl.const("dcg-braille-options-container")},xl.createElement(af,{controller:this.props.controller,showBrailleNote:this.const(!0)})))))}shouldShowBrailleSection(){return this.controller.getBrailleControls()&&this.controller.getGraphSettings().config.expressions}toggleBrailleMode(){this.controller.dispatch({type:"set-braille-mode",mode:this.controller.getBrailleMode()==="none"?"nemeth":"none"})}};var zi=__dcg_shared_module_exports__['e'](Z());var{If:bZ}=zi.Components,CB=0,FS=AA/8,pV=class extends zi.Class{init(){this.controller=this.props.controller()}template(){return zi.createElement("div",{class:zi.const("dcg-options-menu-section")},zi.createElement("div",{class:zi.const("dcg-options-menu-section-title dcg-local-display-preferences-title")},()=>this.controller.s("graphing-calculator-label-display-properties"),zi.createElement(zu,{href:this.const("https://help.kiavash.com/hc/en-us/articles/20301369699981-3D-Graph-Settings#h_01HCFSXHM8S59ETFXB55Y8CZQ5\u2019"),controller:this.props.controller})),zi.createElement(Gt,{onChange:this.bindFn(this.toggleInvertedColors),checked:()=>this.controller.getInvertedColors(),manageFocus:this.const(ct({controller:this.controller,location:{type:"settings",location:"reverse-contrast"}}))},()=>this.controller.s("graphing-calculator-label-settings-reverse-contrast")),zi.createElement(bZ,{predicate:()=>this.controller.getGraphSettings().config.beta3d},()=>zi.createElement(Gt,{onChange:()=>{this.controller.dispatch({type:"set-graph-settings",showBox3D:!this.controller.getGraphSettings().showBox3D})},checked:()=>this.controller.getGraphSettings().showBox3D},()=>this.controller.raw("Clip to box"))),zi.createElement(bZ,{predicate:()=>!this.controller.getGraphSettings().config.beta3d},()=>zi.createElement(Gt,{class:()=>"dcg-translucent-surfaces-checkbox",onChange:this.bindFn(this.toggleTranslucentSurfaces),checked:()=>this.controller.getTranslucentSurfaces(),ariaLabel:()=>this.controller.s("graphing-calculator-label-settings-translucent-surfaces"),manageFocus:this.const(ct({controller:this.controller,location:{type:"settings",location:"translucent-surfaces"}}))},()=>this.controller.s("graphing-calculator-label-settings-translucent-surfaces"))),zi.createElement("div",{class:zi.const("dcg-perspective-slider")},zi.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-settings-3d-perspective-min")},zi.createElement("i",{class:zi.const("dcg-icon-3d-cube"),"aria-hidden":zi.const("true")})),zi.createElement(ly,{min:()=>CB-1,max:()=>FS-1,step:()=>{},value:()=>this.getPerspectiveValue(),ariaLabel:()=>this.controller.s("graphing-calculator-label-settings-3d-perspective-distortion-ratio"),ariaPercent:this.const(!0),onDragUpdate:this.bindFn(this.onDragUpdate),onKeyboardUpdate:this.bindFn(this.onKeyboardUpdate)}),zi.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-settings-3d-perspective-max")},zi.createElement("i",{class:zi.const("dcg-icon-3d-perspective"),"aria-hidden":zi.const("true")}))))}toggleTranslucentSurfaces(){this.controller.dispatch({type:"set-translucent-surfaces",value:!this.controller.getTranslucentSurfaces()})}toggleInvertedColors(){this.controller.dispatch({type:"set-inverted-colors",value:!this.controller.getInvertedColors()})}getPerspectiveValue(){return this.controller.getPerspectiveDistortion()-1}onKeyboardUpdate(e){let o=this.getPerspectiveValue();switch(e){case"up":o+=.1;break;case"down":o-=.1;break;case"bigup":o+=.3;break;case"bigdown":o-=.3;break;case"min":o=CB-1;break;case"max":o=FS-1;break}o=__dcg_shared_module_exports__['wc'](o+1,CB,FS),this.controller.dispatch({type:"set-perspective-distortion",value:o})}onDragUpdate(e){this.controller.dispatch({type:"set-perspective-distortion",value:e+1})}};var yt=__dcg_shared_module_exports__['e'](Z());var{If:cf}=yt.Components,df=class extends yt.Class{template(){return yt.createElement(zr,{isFocused:()=>this.props.parent().getFocusedLimit()===this.props.limit(),latex:()=>this.props.parent().getLimitLatex(this.props.limit()),ariaLabel:this.props.ariaLabel,handleLatexChanged:e=>this.props.parent().setLimitLatex(this.props.limit(),e),handleFocusChanged:e=>this.props.parent().onFocusedChanged(this.props.limit(),e),hasError:()=>this.props.parent().isLimitInvalid(this.props.limit()),dataLabelAttributeValue:this.props.limit,controller:this.props.controller,readonly:this.const(!1)})}},uV=class extends yt.Class{init(){this.controller=this.props.controller(),this.isOpen=this.mustBeOpen()}willUpdate(){this.mustBeOpen()&&(this.isOpen=!0)}mustBeOpen(){var t;let e=(t=this.controller.getGrapher3d())==null?void 0:t.viewportController.getViewport();return e?e.xmin!==e.ymin||e.xmin!==e.zmin||e.xmax!==e.ymax||e.xmax!==e.zmax:!1}template(){return yt.createElement("div",{class:yt.const("dcg-three-d-domain dcg-advanced-graph-settings-view dcg-options-menu-section")},yt.createElement("div",{class:yt.const("dcg-options-menu-section-title dcg-flex-container")},yt.createElement("div",null,()=>this.controller.s("graphing-calculator-label-edit-graph-bounds")),yt.createElement("div",null,yt.createElement(cf,{predicate:this.bindFn(this.showRecenterButton)},()=>yt.createElement("div",{role:yt.const("button"),tabIndex:yt.const("0"),class:yt.const("dcg-action-zoom-recenter dcg-btn-light-gray"),onTap:this.bindFn(this.zoomRecenter)},()=>this.controller.s("graphing-calculator-label-recenter"))))),yt.createElement("div",{class:yt.const("dcg-three-d-domain-toggle-container")},yt.createElement("div",{class:()=>({"dcg-advanced-toggle":!0,"dcg-opened":this.isOpen,"dcg-disabled":this.mustBeOpen()}),onTap:this.bindFn(this.toggleOpen),tabIndex:()=>this.mustBeOpen()?-1:0,"aria-disabled":()=>this.mustBeOpen(),role:yt.const("button"),"aria-expanded":()=>this.isOpen,"aria-label":()=>this.controller.s("graphing-calculator-label-edit-graph-bounds")},yt.createElement("div",{class:yt.const("dcg-caret-container")},yt.createElement("i",{class:yt.const("dcg-icon-caret-down"),"aria-hidden":yt.const("true")})),yt.createElement(cf,{predicate:()=>this.isOpen},()=>yt.createElement("span",{class:yt.const("dcg-axis-label")},yt.createElement(Et,{config:this.const({}),latex:this.const("x")}),yt.const("-axis:"))),yt.createElement(cf,{predicate:()=>!this.isOpen},()=>yt.createElement("span",{class:yt.const("dcg-axis-label")},()=>this.controller.s("graphing-calculator-label-settings-all-axes")))),yt.createElement("div",{class:yt.const("dcg-editable-mathquill-container dcg-x-axis-options")},yt.createElement(df,{limit:this.const("xmin"),ariaLabel:()=>this.isOpen?this.controller.s("graphing-calculator-narration-settings-x-axis-min"):this.controller.s("graphing-calculator-narration-settings-all-axes-min"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),yt.createElement(cf,{predicate:()=>this.isOpen},()=>yt.createElement(Et,{config:this.const({}),latex:this.const("\\le x\\le")},yt.createElement("span",{class:yt.const("dcg-interval-interior")}))),yt.createElement(cf,{predicate:()=>!this.isOpen},()=>yt.createElement("span",{class:yt.const("dcg-axis-label-to")},()=>this.controller.s("shared-label-to"))),yt.createElement(df,{limit:this.const("xmax"),ariaLabel:()=>this.isOpen?this.controller.s("graphing-calculator-narration-settings-x-axis-max"):this.controller.s("graphing-calculator-narration-settings-all-axes-max"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}))),yt.createElement(cf,{predicate:()=>this.isOpen},()=>yt.createElement("div",{class:yt.const("dcg-advanced-contents")},yt.createElement("div",{class:yt.const("dcg-editable-mathquill-container dcg-y-axis-options")},yt.createElement("span",{class:yt.const("dcg-axis-label")},yt.createElement(Et,{config:this.const({}),latex:this.const("y")}),yt.const("-axis:")),yt.createElement(df,{limit:this.const("ymin"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-min"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),yt.createElement(Et,{config:this.const({}),latex:this.const("\\le y\\le")},yt.createElement("span",{class:yt.const("dcg-interval-interior")})),yt.createElement(df,{limit:this.const("ymax"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-y-axis-max"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller})),yt.createElement("div",null,yt.createElement("div",{class:yt.const("dcg-editable-mathquill-container dcg-z-axis-options")},yt.createElement("span",{class:yt.const("dcg-axis-label")},yt.createElement(Et,{config:this.const({}),latex:this.const("z")}),yt.const("-axis:")),yt.createElement(df,{limit:this.const("zmin"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-z-axis-min"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}),yt.createElement(Et,{config:this.const({}),latex:this.const("\\le z\\le")},yt.createElement("span",{class:yt.const("dcg-interval-interior")})),yt.createElement(df,{limit:this.const("zmax"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-settings-z-axis-max"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled(),parent:this.const(this),controller:this.props.controller}))),yt.createElement(cf,{predicate:this.bindFn(this.showZoomSquareButton)},()=>yt.createElement("div",null,yt.createElement("div",{role:yt.const("button"),tabIndex:yt.const("0"),class:yt.const("dcg-action-zoom-square-3d dcg-btn-blue"),onTap:this.bindFn(this.zoomSquare)},()=>this.controller.s("graphing-calculator-button-settings-zoom-square")))))),yt.createElement(cf,{predicate:()=>!this.controller.getLockViewportConfigSetting()},()=>yt.createElement(Gt,{ariaLabel:()=>this.props.controller().s("graphing-calculator-label-disable-zoom"),onChange:()=>{this.props.controller().dispatch({type:"toggle-lock-viewport"})},checked:()=>this.props.controller().getLockViewportUserSetting()},()=>this.props.controller().s("graphing-calculator-label-disable-zoom"))))}showRecenterButton(){var t;let e=(t=this.controller.getGrapher3d())==null?void 0:t.webglLayer.domain();return!!e&&!WJ(e,0)}zoomRecenter(e){this.controller.dispatch({type:"zoom",direction:"recenter"}),e.device==="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"xmin"}})}getFocusedLimit(){let e=this.controller.getFocusLocation();if(e&&e.type==="settings")return e.location}getLimitLatex(e){return this.controller.getSettingsViewModel().limitLatex[e]||""}setLimitLatex(e,t){t!==this.controller.getSettingsViewModel().limitLatex[e]&&this.controller.dispatch({type:"set-axis-limit-latex",limit:e,latex:t,updateYZAlso:!this.isOpen&&(e==="xmin"||e==="xmax")})}getInvalidLimits(){let e=!!this.controller.getGraphSettings().degreeMode,t=Qo(this.getLimitLatex("xmin"),e),o=Qo(this.getLimitLatex("xmax"),e),i=Qo(this.getLimitLatex("ymin"),e),n=Qo(this.getLimitLatex("ymax"),e),a=Qo(this.getLimitLatex("zmin"),e),s=Qo(this.getLimitLatex("zmax"),e),l={},c=new Co(t,o,i,n,a,s);return isFinite(t)&&isFinite(o)?(l.xmin=!c.isXValid(this.controller.getGraphSettings().xAxisScale),l.xmax=l.xmin):(l.xmin=!isFinite(t),l.xmax=!isFinite(o)),isFinite(i)&&isFinite(n)?(l.ymin=!c.isYValid(this.controller.getGraphSettings().yAxisScale),l.ymax=l.ymin):(l.ymin=!isFinite(i),l.ymax=!isFinite(n)),isFinite(a)&&isFinite(s)?(l.zmin=!c.isZValid(),l.zmax=l.zmin):(l.zmin=!isFinite(a),l.zmax=!isFinite(s)),l}isLimitInvalid(e){return this.getInvalidLimits()[e]}onFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"settings",location:e}})}toggleOpen(){this.mustBeOpen()||(this.isOpen=!this.isOpen,this.update())}showZoomSquareButton(){return!this.controller.getGraphSettings().squareAxes}zoomSquare(e){this.controller.dispatch({type:"zoom",direction:"square"}),e.device==="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"zmax"}})}};var{If:SB}=ao.Components,hV=class extends ao.Class{init(){this.controller=this.props.controller()}template(){return ao.createElement("div",{class:ao.const("dcg-settings-view-container dcg-settings-view-3d-container")},ao.createElement("div",{class:ao.const("dcg-3d-settings-flex-container")},ao.createElement(of,{...this.props,isPillbox:this.const(!0)})),ao.createElement(SB,{predicate:()=>this.controller.isGraphSettingsOpen()},()=>ao.createElement("div",{class:ao.const("dcg-settings-container dcg-left dcg-popover dcg-constrained-height-popover"),style:this.bindFn(this.getContainerStyle),didMount:this.bindFn(this.didMountContainer),didUnmount:this.bindFn(this.didUnmountContainer)},ao.createElement("div",{class:ao.const("dcg-popover-interior dcg-generic-options-menu"),role:ao.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-graph-settings")},ao.createElement(pV,{controller:this.props.controller}),ao.createElement(uV,{controller:this.props.controller}),ao.createElement("div",{class:ao.const("dcg-options-menu-section")},ao.createElement("div",{class:ao.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-label-axes"),ao.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-label-axes"),onChange:()=>{this.controller.dispatch({type:"set-graph-settings",showAxis3D:!this.controller.getGraphSettings().showAxis3D})},toggled:()=>!!this.controller.getGraphSettings().showAxis3D})),ao.createElement(SB,{predicate:()=>this.controller.getGraphSettings().showAxis3D},()=>ao.createElement("div",{class:ao.const("dcg-show-axis-labels-section")},ao.createElement("div",null,ao.createElement(Gt,{onChange:()=>{this.controller.dispatch({type:"set-graph-settings",showPlane3D:!this.controller.getGraphSettings().showPlane3D})},checked:()=>!!this.controller.getGraphSettings().showPlane3D},()=>this.controller.s("graphing-calculator-label-settings-domain-plane"))),ao.createElement("div",null,ao.createElement(Gt,{onChange:()=>{this.controller.dispatch({type:"set-graph-settings",showNumbers3D:!this.controller.getGraphSettings().showNumbers3D})},checked:()=>!!this.controller.getGraphSettings().showNumbers3D},()=>this.controller.s("graphing-calculator-label-settings-numbers-3d"))),ao.createElement("div",null,ao.createElement(Gt,{onChange:()=>{this.controller.dispatch({type:"set-graph-settings",showAxisLabels3D:!this.controller.getGraphSettings().showAxisLabels3D})},checked:()=>!!this.controller.getGraphSettings().showAxisLabels3D},()=>this.controller.s("graphing-calculator-label-settings-axis-labels-3d")))))),ao.createElement(SB,{predicate:()=>this.controller.canEnableComplexMode()},()=>ao.createElement(sf,{...this.props,isComplexModeEnabled:()=>this.controller.isComplexModeEnabled(),toggleComplexMode:()=>this.controller.dispatch({type:"toggle-complex-mode"}),product:this.const("graphing-3d")})),ao.createElement(Zv,{controller:this.props.controller}),ao.createElement(Kd,{setup:this.const({controller:this.controller,type:"advanced"})}),ao.createElement("div",{class:ao.const("dcg-arrow")})))))}didMountContainer(e){this.node=e,re(document.documentElement).on("dcg-tapstart.settings-view wheel.settings-view",t=>{this.eventShouldClosePopover(t)&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:t.device==="keyboard"})}),re(document.documentElement).on("keydown.settings-view",t=>{let o=Be(t);if(o==="Esc"&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:!0}),this.controller.isGraphSettingsOpen()&&o==="Tab"&&!t.altKey&&!t.metaKey&&!t.ctrlKey){let i=this.controller.getFocusLocation();if(!i||i.type!=="settings")return;let n=!!this.controller.getGraphSettings().degreeMode;t.shiftKey?t.shiftKey&&(i.location==="reverse-contrast"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation()):i.location==="icon"&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:n?"degree-mode":"radian-mode"}}),t.preventDefault(),t.stopPropagation())):i.location==="icon"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"reverse-contrast"}}),t.preventDefault(),t.stopPropagation()):(!n&&i.location==="radian-mode"||n&&i.location==="degree-mode")&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation())}})}didUnmountContainer(){re(document.documentElement).off(".settings-view")}didUpdate(){if(!this.controller.isGraphSettingsOpen())return;let e=this.controller.getKeypadHeight();e!==this.cachedKeypadHeight&&document.activeElement&&this.node.contains(document.activeElement)&&Vc(document.activeElement,this.node.querySelector(".dcg-popover-interior"),50),this.cachedKeypadHeight=e}eventShouldClosePopover(e){let t=e.target,o=this.node.contains(t),i=!!t.closest(".dcg-action-settings"),n=this.isMathquillFocused()&&t.closest(".dcg-keypad"),a=!!t.closest(".dcg-action-undo")||!!t.closest(".dcg-action-redo");return!(o||i||n||a)}isMathquillFocused(){let e=this.controller.getFocusLocation();return(e==null?void 0:e.type)==="settings"}getContainerStyle(){return this.controller.getKeypadHeight()?"bottom: 0":""}};var Vp=__dcg_shared_module_exports__['e'](Z());var gV=class extends Vp.Class{init(){this.controller=this.props.controller()}template(){return Vp.createElement(ze,{tooltip:this.bindFn(this.getZoomRestoreLabel),gravity:this.const("w")},Vp.createElement("div",{class:()=>({"dcg-btn-flat-gray":!0,"dcg-pillbox-btn-interior":!0,"dcg-action-zoomrestore":!0}),role:Vp.const("button"),tabIndex:Vp.const("0"),"aria-label":this.bindFn(this.getZoomRestoreLabel),onTap:this.bindFn(this.setDefaultViewport),manageFocus:this.const(ct({controller:this.controller,location:{type:"zoom-restore-btn"}}))},Vp.createElement("i",{class:Vp.const("dcg-icon-home"),"aria-hidden":Vp.const("true")})))}setDefaultViewport(){this.controller.dispatch({type:"zoom",direction:"default"}),this.controller.dispatch({type:"set-focus-location",location:{type:"zoom-in-btn"}})}getZoomRestoreLabel(){return this.controller.s("graphing-calculator-label-tooltip-viewport-default")}};var ln=__dcg_shared_module_exports__['e'](Z());var mV=class extends ln.Class{init(){this.controller=this.props.controller()}template(){return ln.createElement("div",{class:ln.const("dcg-zoom-container")},ln.createElement("div",{class:ln.const("dcg-zoominout-pillbox dcg-btn-flat-gray dcg-btn-flat-gray-group dcg-group-vertical"),role:ln.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-narration-zoom-options-label")},ln.createElement(ze,{tooltip:this.bindFn(this.getZoomInLabel),displayBlock:this.const(!0),gravity:this.const("w")},ln.createElement("div",{class:ln.const("dcg-action-zoomin dcg-pillbox-btn-interior"),role:ln.const("button"),tabIndex:ln.const("0"),"aria-label":this.bindFn(this.getZoomInLabel),onTap:this.bindFn(this.zoomIn),manageFocus:this.const(ct({controller:this.controller,location:{type:"zoom-in-btn"}}))},ln.createElement("i",{class:ln.const("dcg-icon-plus"),"aria-hidden":ln.const("true")}))),ln.createElement(ze,{tooltip:this.bindFn(this.getZoomOutLabel),displayBlock:this.const(!0),gravity:this.const("w")},ln.createElement("div",{class:ln.const("dcg-action-zoomout dcg-pillbox-btn-interior"),role:ln.const("button"),tabIndex:ln.const("0"),"aria-label":this.bindFn(this.getZoomOutLabel),onTap:this.bindFn(this.zoomOut)},ln.createElement("i",{class:ln.const("dcg-icon-minus"),"aria-hidden":ln.const("true")})))))}zoomIn(){this.controller.dispatch({type:"zoom",direction:"in"})}zoomOut(){this.controller.dispatch({type:"zoom",direction:"out"})}getZoomInLabel(){return this.controller.s("graphing-calculator-label-tooltip-zoom-in")}getZoomOutLabel(){return this.controller.s("graphing-calculator-label-tooltip-zoom-out")}};var{Each:Nfe,If:NS}=di.Components,fV=class extends di.Class{init(){this.controller=this.props.controller()}template(){return di.createElement("div",null,di.createElement(NS,{predicate:this.bindFn(this.shouldShowLeftPillboxes)},()=>di.createElement("div",{class:()=>({"dcg-left-pillboxes":!0,"dcg-geometry-toolbar-present":this.controller.shouldShowGeoToolbar()})},di.createElement(NS,{predicate:this.bindFn(this.shouldShowUndoRedo)},()=>di.createElement(Jv,{controller:this.props.controller,isPillbox:this.const(!0)})),di.createElement(NS,{predicate:this.bindFn(this.shouldShowGeoReset)},()=>di.createElement(OS,{controller:this.props.controller,tooltipGravity:this.const("s")})))),di.createElement("div",{class:()=>({"dcg-pillbox-container":!0,"dcg-geometry-toolbar-present":this.controller.shouldShowGeoToolbar()}),role:()=>this.controller.isGeoUIActive()?void 0:"region","aria-label":()=>this.controller.isGeoUIActive()?void 0:this.controller.s("graphing-calculator-narration-graph-settings-controls")},di.createElement("div",{class:di.const("dcg-overgraph-pillbox-elements"),style:this.bindFn(this.getContainerStyle)},di.createElement(NS,{predicate:()=>this.shouldShowOrientationPillbox()&&!this.onSmallScreen()},()=>di.createElement("div",{class:di.const("dcg-left-pillbox-elements")},di.createElement(RS,{controller:this.props.controller,layout:this.const("horizontal")}))),di.createElement(NS,{predicate:()=>this.getRightPillboxElements().length>0},()=>di.createElement("div",{class:di.const("dcg-right-pillbox-elements")},Nfe(()=>this.getRightPillboxElements(),{item:e=>{switch(e){case"settings2d":return di.createElement(dV,{controller:this.props.controller});case"settings3d":return di.createElement(hV,{controller:this.props.controller});case"settings-geo":return di.createElement(of,{...this.props,isPillbox:this.const(!0)});case"reset":return di.createElement(OS,{controller:this.props.controller,tooltipGravity:this.const("w")});case"zoom-in-out":return di.createElement(mV,{controller:this.props.controller});case"orientation":return di.createElement(RS,{layout:this.const("vertical"),controller:this.props.controller});case"zoom-home":return di.createElement(gV,{controller:this.props.controller})}}}))))),di.createElement(PS,{controller:()=>this.props.controller()}))}shouldShowLeftPillboxes(){return this.shouldShowGeoReset()||this.shouldShowUndoRedo()}shouldShowGeoReset(){return this.controller.isGeometry()&&this.shouldShowResetButton()&&!this.controller.isListEnabled()}shouldShowUndoRedo(){return this.controller.isGeometry()&&!this.controller.isListEnabled()&&!(this.controller.getGeoToolbarSuppressedByAuthor()||this.controller.getGraphSettings().config.hideGeoUI)}getRightPillboxElements(){let e=[];return this.shouldShowGraphSettings()&&e.push("settings2d"),this.shouldShow3DGraphSettings()&&e.push("settings3d"),this.shouldShowGeometrySettings()&&e.push("settings-geo"),this.shouldShowResetButton()&&!this.shouldShowGeoReset()&&e.push("reset"),this.shouldShowZoomInOutButtons()&&e.push("zoom-in-out"),this.shouldShowOrientationPillbox()&&this.onSmallScreen()&&e.push("orientation"),this.shouldShowZoomHomeButton()&&e.push("zoom-home"),e}shouldShowOrientationPillbox(){return this.controller.is3dProduct()&&this.controller.getGraphSettings().config.orientationButtons}getContainerStyle(){let e=this.controller.isKeypadOpen()?this.controller.getKeypadHeight():0;return this.controller.isGraphSettingsOpen()?`bottom: ${e}px;`:"bottom: auto"}shouldShow3DGraphSettings(){return this.controller.getGraphSettings().config.settingsMenu&&this.controller.is3dProduct()}shouldShowGraphSettings(){return this.controller.getGraphSettings().config.settingsMenu&&!this.controller.isGeometry()&&!this.controller.is3dProduct()}shouldShowGeometrySettings(){return this.controller.getGraphSettings().config.settingsMenu?this.controller.isGeometry():!1}zoomEnabled(){return this.controller.getGraphSettings().config.zoomButtons&&!this.isViewportLocked()}onSmallScreen(){let e=this.controller.getLayoutMeasurements();return e.width<450||e.height<450}shouldShowZoomInOutButtons(){return gc&&this.onSmallScreen()?!1:this.zoomEnabled()}shouldShowZoomHomeButton(){return this.zoomEnabled()&&!this.controller.isDefaultViewportRestored()}isViewportLocked(){return this.controller.getGraphSettings().config.lockViewport||this.controller.getGraphSettings().userLockedViewport}shouldShowResetButton(){return this.controller.getGraphSettings().config.showResetButtonOnGraphpaper&&this.controller.hasDefaultState()}};var $r=__dcg_shared_module_exports__['e'](Z()),{If:BS}=$r.Components,EB=class extends $r.Class{init(){this.controller=this.props.controller()}template(){return $r.createElement("span",{class:$r.const("dcg-toast")},$r.createElement("i",{class:$r.const("dcg-icon-error"),"aria-hidden":$r.const("true")}),$r.createElement(BS,{predicate:()=>!this.showUndo()},()=>$r.createElement("i",{class:$r.const("dcg-icon-remove"),onTap:()=>this.controller.dispatch({type:"toast/close"}),role:$r.const("link"),tabIndex:$r.const(0),"aria-label":$r.const("Dismiss Notice")})),$r.createElement("span",{class:$r.const("dcg-msg"),"aria-atomic":()=>this.shouldLiveUpdateAria(),"aria-live":()=>this.shouldLiveUpdateAria()?"assertive":""},()=>this.controller.toastData.message),$r.createElement(BS,{predicate:this.bindFn(this.showUndo)},()=>$r.createElement("a",{role:$r.const("link"),tabIndex:$r.const(0),class:$r.const("dcg-undo"),onTap:()=>this.controller.dispatch({type:"toast/undo"})},()=>this.controller.s("shared-calculator-label-toast-undo"))),$r.createElement(BS,{predicate:this.bindFn(this.showLearnMore)},()=>$r.createElement("a",{role:$r.const("link"),tabIndex:$r.const(0),target:$r.const("_blank"),onTap:()=>this.controller.dispatch({type:"toast/learn-more"})},()=>this.controller.s("shared-calculator-label-toast-learn-more"))),$r.createElement(BS,{predicate:()=>!!this.controller.toastData.link},()=>$r.createElement("a",{role:$r.const("link"),tabIndex:$r.const(0),target:$r.const("_blank"),href:()=>{var e;return((e=this.controller.toastData.link)==null?void 0:e.url)||""}},()=>{var e;return((e=this.controller.toastData.link)==null?void 0:e.text)||""})))}showUndo(){return!!this.controller.toastData.undoCallback}showLearnMore(){return!!this.controller.toastData.learnMoreCallback}shouldUpdate(){return!!this.controller.toastData.message}shouldLiveUpdateAria(){return!this.controller.toastData.noAria}},bV=class extends $r.Class{template(){return $r.createElement("div",{class:()=>({"dcg-toast-view":!0,"dcg-visible":!!this.props.controller().toastData.message,"dcg-below-geo-toolbar":this.isGeometryInCalculator()}),"toast-style":()=>this.props.controller().toastData.toastStyle},$r.createElement(BS,{predicate:()=>!!this.props.controller().toastData.message},()=>$r.createElement("div",{class:$r.const("dcg-toast-wrapper")},$r.createElement("div",{class:$r.const("dcg-toast-cover")}),$r.createElement(EB,{...this.props}))))}isGeometryInCalculator(){var t;let e=this.props.controller();return(t=e.isGeometry)==null?void 0:t.call(e)}};var xt=__dcg_shared_module_exports__['e'](Z());$t();function yZ(r){if(window.clipboardData&&window.clipboardData.getData)return window.clipboardData.getData("Text");if(r&&r.clipboardData&&r.clipboardData.getData)return r.clipboardData.getData("text/plain")}Xa();function DB(r){let e;if(typeof r=="number")e=r+"";else if(typeof r=="string")e=r;else return!1;return e.trim().match(/^-?[0-9]*\.?[0-9]*$/)}var Ku={delimiter:"",header:!1,dynamicTyping:!1,preview:0,step:void 0,encoding:"",comments:!1,complete:void 0,error:void 0,download:!1,chunk:void 0,keepEmptyRows:!1},ds={};ds.parse=Bfe;ds.RECORD_SEP="";ds.UNIT_SEP="";ds.BYTE_ORDER_MARK="\uFEFF";ds.BAD_DELIMITERS=["\r",`
`,'"',ds.BYTE_ORDER_MARK];ds.LocalChunkSize=1024*1024*10;ds.RemoteChunkSize=1024*1024*5;ds.DefaultDelimiter=",";ds.Parser=yV;ds.ParserHandle=xZ;function Bfe(r,e){var t=Ufe(e),o=new xZ(t),i=o.parse(r);return i}function xZ(r){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,t=this,o,i,n=!1,a,s=[],l={data:[],errors:[],meta:{}};r=kB(r),this.parse=function(w){if(a=!1,!r.delimiter){var S=h(w);S.successful?r.delimiter=S.bestDelimiter:(a=!0,r.delimiter=ds.DefaultDelimiter),l.meta.delimiter=r.delimiter}if(e1(r.step)){var C=r.step;r.step=function(v){l=v,d()?c():C(c(),t)}}return r.preview&&r.header&&r.preview++,o=w,i=new yV(r),l=i.parse(o),c(),e1(r.complete)&&!n&&r.complete(l),n?{meta:{paused:!0}}:l},this.pause=function(){n=!0,i.abort(),o=o.substr(i.getCharIndex())},this.resume=function(){n=!1,i=new yV(r),i.parse(o),e1(r.complete)&&!n&&r.complete(l)},this.abort=function(){i.abort(),e1(r.complete)&&r.complete(l),o=""};function c(){return l&&a&&(y("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+ds.DefaultDelimiter+"'"),a=!1),d()&&p(),u()}function d(){return r.header&&s.length==0}function p(){if(l){for(var w=0;d()&&w<l.data.length;w++)for(var S=0;S<l.data[w].length;S++)s.push(l.data[w][S]);l.data.splice(0,1)}}function u(){if(!l||!r.header&&!r.dynamicTyping)return l;for(var w=0;w<l.data.length;w++){for(var S={},C=0;C<l.data[w].length;C++){if(r.dynamicTyping){var v=l.data[w][C];v=="true"?l.data[w][C]=!0:v=="false"?l.data[w][C]=!1:l.data[w][C]=m(v)}r.header&&(C>=s.length?(S.__parsed_extra||(S.__parsed_extra=[]),S.__parsed_extra.push(l.data[w][C])):S[s[C]]=l.data[w][C])}r.header&&(l.data[w]=S,C>s.length?y("FieldMismatch","TooManyFields","Too many fields: expected "+s.length+" fields but parsed "+C,w):C<s.length&&y("FieldMismatch","TooFewFields","Too few fields: expected "+s.length+" fields but parsed "+C,w))}return r.header&&l.meta&&(l.meta.fields=s),l}function h(w){for(var S=[",","	","|",";",ds.RECORD_SEP,ds.UNIT_SEP],C,v,E,_=0;_<S.length;_++){var T=S[_],I=0,P=0;E=void 0;for(var O=new yV({delimiter:T,preview:10}).parse(w),W=0;W<O.data.length;W++){var X=O.data[W].length;if(P+=X,typeof E=="undefined"){E=X;continue}else X>1&&(I+=Math.abs(X-E),E=X)}P/=O.data.length,(typeof v=="undefined"||I<v)&&P>1.99&&(v=I,C=T)}return r.delimiter=C,{successful:!!C,bestDelimiter:C}}function m(w){var S=e.test(w);return S?parseFloat(w):w}function y(w,S,C,v){l.errors.push({type:w,code:S,message:C,row:v})}}function yV(r){var e=/^\s*$/,t,o,i,n,a,s,l,c,d,p,u,h,m,y,w,S=!1;r=r||{},o=r.delimiter,i=r.comments,n=r.step,s=r.preview,(typeof o!="string"||o.length!=1||ds.BAD_DELIMITERS.indexOf(o)>-1)&&(o=","),i===!0?i="#":(typeof i!="string"||i.length!=1||ds.BAD_DELIMITERS.indexOf(i)>-1||i==o)&&(i=!1),this.parse=function(ae){if(typeof ae!="string")throw"Input must be a string";return F(ae),C()},this.abort=function(){S=!0},this.getCharIndex=function(){return c};function C(){for(;c<t.length&&!(S||s>0&&w>=s);)l=='"'?_():d?T():I(),v();return E()}function v(){c++,l=t[c]}function E(){if(S&&q("Abort","ParseAbort","Parsing was aborted by the user's step function"),d&&q("Quotes","MissingQuotes","Unescaped or mismatched quotes"),L(),!e1(n))return ne()}function _(){U()&&!A()?d=!d:(W(),d&&A()?c++:q("Quotes","UnexpectedQuotes","Unexpected quotes"))}function T(){(N(c)||z(c))&&p++,W()}function I(){l==o?X():N(c)?(x(),v()):z(c)?x():P()?O():W()}function P(){if(!i)return!1;var ae=c==0||z(c-1)||N(c-2);return ae&&t[c]===i}function O(){for(;!N(c)&&!z(c)&&c<t.length;)v()}function W(){u[m][y]+=l}function X(){u[m].push(""),y=u[m].length-1}function x(){L(),p++,w++,u.push([]),m=u.length-1,X()}function L(){R(),e1(n)&&(u[m]&&n(ne()),ge())}function R(){u[m].length==1&&e.test(u[m][0])&&(r.keepEmptyRows?u[m].splice(0,1):u.splice(m,1),m=u.length-1)}function N(ae){return ae<t.length-1&&(t[ae]=="\r"&&t[ae+1]==`
`||t[ae]==`
`&&t[ae+1]=="\r")}function z(ae){return t[ae]=="\r"||t[ae]==`
`}function A(){return!U()&&c<t.length-1&&t[c+1]=='"'}function U(){return!d&&pe(c-1)||pe(c+1)}function pe(ae){typeof ae!="number"&&(ae=c);var j=t[ae];return ae<=-1||ae>=t.length||j==o||j=="\r"||j==`
`}function q(ae,j,oe){h.push({type:ae,code:j,message:oe,line:p,row:m,index:c})}function F(ae){t=ae,d=!1,c=0,w=0,p=1,ge(),u=[[""]],l=t[c]}function ge(){u=[],h=[],m=0,y=0}function ne(){return{data:u,errors:h,meta:{lines:p,delimiter:o,aborted:S,truncated:s>0&&c<t.length}}}}function Ufe(r){typeof r!="object"&&(r={});var e=kB(r);return(typeof e.delimiter!="string"||e.delimiter.length!=1||ds.BAD_DELIMITERS.indexOf(e.delimiter)>-1)&&(e.delimiter=Ku.delimiter),typeof e.header!="boolean"&&(e.header=Ku.header),typeof e.dynamicTyping!="boolean"&&(e.dynamicTyping=Ku.dynamicTyping),typeof e.preview!="number"&&(e.preview=Ku.preview),typeof e.step!="function"&&(e.step=Ku.step),typeof e.complete!="function"&&(e.complete=Ku.complete),typeof e.error!="function"&&(e.error=Ku.error),typeof e.encoding!="string"&&(e.encoding=Ku.encoding),typeof e.download!="boolean"&&(e.download=Ku.download),typeof e.keepEmptyRows!="boolean"&&(e.keepEmptyRows=Ku.keepEmptyRows),e}function kB(r){if(typeof r!="object")return r;var e=r instanceof Array?[]:{};for(var t in r)e[t]=kB(r[t]);return e}function e1(r){return typeof r=="function"}var{parse:wZ}=ds;function vZ(r){let e=r.split(/\r?\n/),t=[],o=!1;if(!(e.length<2)){for(let i=0;i<e.length;i++){let n=e[i];if(!n.trim())continue;i>0&&!DB(n.replace(/,(\d{3})/g,"$1"))&&(o=!0);let a={content:n};t.push(a)}if(!o){let i=__dcg_shared_module_exports__['q'](t,"content").map(n=>n.replace(/,(\d{3})/g,"$1"));return DB(i[0])||(i=i.slice(1)),[{content:"\\left["+i.join(",")+"\\right]",numberList:!0}]}return t}}function CZ(r){if(/^\s*$/.test(r))return;let e=wZ(r,{preview:1e4}),t=e.data,o=[];if(e.errors.length&&!e.data.length){Vo("PapaParse.parse returned errors.",{metaData:{input:r,output:e.errors}});return}if(!e.data.length||e.data.length<2)return;let i=t[0].length;for(let n=0;n<i;n++)o.push([]);for(let n=0;n<e.data.length;n++)if(!(n===0&&isNaN(parseFloat(t[n][0])))){if(t[n].length<2)return;if(!(!t[n][0]&&!t[n][1]))for(let a=0;a<i;a++){let s=(t[n][a]||"").replace(/,(\d{3})/g,"$1");if(s&&isNaN(parseFloat(s)))return;o[a].push(s)}}if(!(o[0].length<2))return o}function SZ(r){let e=__dcg_shared_module_exports__['i'](vp(r));return e.graph.product="geometry-calculator",e}function xV(r){return/^\s*(https?:\/\/)?([-a-zA-Z0-9]*\.)?kiavash\.com(:[0-9]+)?\/calculator\/./.test(r)}function _B(r){return/^\s*(https?:\/\/)?([-a-zA-Z0-9]*\.)?kiavash\.com(:[0-9]+)?\/(geometry|geometry-beta)\/./.test(r)}function TB(r){return/^\s*(https?:\/\/)?([-a-zA-Z0-9]*\.)?kiavash\.com(:[0-9]+)?\/3d\/./.test(r)}function GB(r){return/^\s*(https?:\/\/)?([-a-zA-Z0-9]*\.)?kiavash\.com(:[0-9]+)?\/geometry-legacy\/./.test(r)}function EZ(r){return xV(r)?"graphing":_B(r)?"geometry-calculator":GB(r)?"geometry":TB(r)?"graphing-3d":void 0}function DZ(r,e){if(!r||!e)return"";switch(e){case"graphing":return`https://www.desmos.com/calculator/${r}`;case"geometry-calculator":return`https://www.desmos.com/geometry/${r}`;case"graphing-3d":return`https://www.desmos.com/3d/${r}`}}function IB(r){return/^\s*https?:\/\/([-a-zA-Z0-9]*\.)?kiavash\.com(:[0-9]+)?\/geo-states\/./.test(r)}async function wV(r,e,t){let o=!1;r.dispatch({type:"toast/show",toast:{message:r.s("graphing-calculator-text-toast-importing-graph"),hideAfter:0,toastStyle:"cover",onHide:()=>{o=!0}}});let i=()=>{o||r.dispatch({type:"toast/show",toast:{message:r.s("graphing-calculator-text-toast-error-importing-graph"),toastStyle:"error",hideAfter:12e3}})},n=()=>{r.dispatch({type:"toast/show",toast:{message:r.s("graphing-calculator-text-toast-error-no-folders"),toastStyle:"error",hideAfter:12e3}})},a=(l,c)=>{r.dispatch({type:"set-state",state:l,opts:{forceUnsavedChanges:!0}}),r.dispatch({type:"toast/show",toast:{message:r.s("graphing-calculator-text-toast-imported-graph"),undoCallback:()=>{r.dispatch({type:"set-state",state:c,opts:{forceUnsavedChanges:!0}})}}})},s=(l,c,d)=>{if(o)return;let p=r.getSelectedItem();if(!p)return;let u=p.type==="folder",h=p.type!=="folder"&&!!p.folderId,m=u||h,y={},w=r.getState(),S=w.expressions.list;if(S.length===1&&!u&&!r.isGeometry()){a(l,w);return}if(r.isGeometry()&&d!=="graphing"){a(l,w);return}let C=l.expressions.list;d==="graphing"&&Array.isArray(C)&&(C=C.filter(I=>I.id!==__dcg_shared_module_exports__['xb']));for(let I=0;I<C.length;I++){let P=r.generateId(),O=C[I];if(O.type==="folder")if(m){n();return}else{y[O.id]=P,O.id=P;continue}O.folderId?O.folderId=y[O.folderId]:u?O.folderId=p.id:h&&(O.folderId=p.folderId),O.id=P}let v=__dcg_shared_module_exports__['i'](w),E=0;for(;E<S.length;){if(S[E].id===p.id){u&&(S[E].title=c);break}E+=1}let _=u?E+1:E,T=u?0:1;S.splice(_,T,...C),a(w,v)};try{let l=await fetch(`${e}?${new URLSearchParams(gm)}`,{headers:{Accept:"application/json"}});if(!l.ok)throw void 0;let c=await l.json(),d=c.state,p=EZ(e);r.isGeometry()&&(p==="geometry"?d=zh(d):p==="graphing"&&(d=SZ(d))),d=vp(d),t(d,(u,h)=>{u||!h||!p?i():s(h,c.title||"",p)})}catch(l){i()}}var t1=__dcg_shared_module_exports__['e'](Z()),US=class extends t1.Class{init(){this.controller=this.props.controller()}template(){return t1.createElement("div",{class:t1.const("dcg-drag-container"),style:()=>({top:this.getTopPx(),left:this.getLeftPx()})},this.props.children)}getTopPx(){let e=this.controller.getRawDragState();if(e)return e.itemTop+"px"}getLeftPx(){let e=this.controller.getRawDragState();if(e)return e.itemLeft+"px"}};var pg=__dcg_shared_module_exports__['e'](Z());$t();var{If:zfe}=pg.Components,vV=class extends pg.Class{init(){this.guid=__dcg_shared_module_exports__['P']("dcg-exp-list-resize")}template(){return pg.createElement(zfe,{predicate:this.bindFn(this.isVisible)},()=>pg.createElement("div",{class:pg.const("dcg-exp-list-resizer"),onTapStart:this.bindFn(this.onTapStart)}))}isVisible(){return this.props.controller().expressionsAreFullWidth()?!1:this.props.controller().isListVisible()}onTapStart(e){this.initialWidth=this.props.controller().getExpListWidth(),this.initialLeft=e.changedTouches[0].clientX,re(document).on(`dcg-tapmove.${this.guid}`,t=>{if(this.initialLeft===void 0||this.initialWidth===void 0)return;let o=t.changedTouches[0].clientX-this.initialLeft+this.initialWidth;this.props.controller().dispatch({type:"resize-exp-list",expListWidth:o})}),re(document).on(`dcg-tapend.${this.guid}`,this.bindFn(this.onTapEnd)),re(document).on(`dcg-tapcancel.${this.guid}`,this.bindFn(this.onTapEnd))}onTapEnd(){re(document).off(`.${this.guid}`),this.initialLeft=void 0,this.initialWidth=void 0}};Xa();var En=__dcg_shared_module_exports__['e'](Z());$t();var so=__dcg_shared_module_exports__['e'](Z());var Gr=__dcg_shared_module_exports__['e'](Z());var Wd=__dcg_shared_module_exports__['e'](Z());$t();var ug=class extends Wd.Class{init(){this.controller=this.props.controller()}template(){return Wd.createElement("div",{class:Wd.const("dcg-do-not-blur"),onTap:this.bindFn(this.newImage),handleEvent:Wd.const("true"),role:Wd.const("button"),tabIndex:()=>this.props.readonly()?-1:0,"aria-label":this.props.ariaLabel,"aria-disabled":()=>this.props.readonly(),manageFocus:this.const(this.props.location?ct({controller:this.controller,location:this.props.location()}):void 0)},this.props.children,Wd.createElement("input",{type:Wd.const("file"),accept:Wd.const("image/*"),style:Wd.const("display: none"),didMount:this.bindFn(this.didMountFileInput)}))}didMountFileInput(e){this.fileInputNode=e,re(e).on("change",()=>{this.props.onFileChange(e.files),e.value=""})}newImage(){this.props.readonly()||this.fileInputNode.click()}};var{If:kZ,Switch:_Z}=Gr.Components,CV=class extends Gr.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return Gr.createElement("div",{class:Gr.const("dcg-clickable-image-info-view"),role:Gr.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-clickable-image-options")},Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state-container")},Gr.createElement(ze,{tooltip:()=>this.tooltip("hovered"),gravity:this.const("s")},Gr.createElement(ug,{controller:()=>this.controller,ariaLabel:()=>this.tooltip("hovered"),onFileChange:e=>this.updateImage("hovered",e),readonly:()=>this.controller.isItemReadonly(this.id)},Gr.createElement(_Z,{key:this.bindFn(this.hoveredStatus)},()=>Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state"),style:()=>this.getStyleForState("hovered")})))),Gr.createElement(kZ,{predicate:()=>!!this.model.clickableInfo.hoveredImage},()=>Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state-close"),onTap:()=>this.removeImageState("hovered"),ariaLabel:()=>this.controller.s("graphing-calculator-label-remove-hovered-image"),role:Gr.const("button"),tabIndex:Gr.const(0)},Gr.createElement("i",{class:Gr.const("dcg-icon-remove"),"aria-hidden":Gr.const("true")}))),Gr.createElement("div",{role:Gr.const("heading"),"aria-level":Gr.const("2"),class:Gr.const("dcg-clickable-image-label")},()=>this.controller.s("graphing-calculator-label-hovered"))),Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state-container")},Gr.createElement(ze,{tooltip:()=>this.tooltip("depressed"),gravity:this.const("s")},Gr.createElement(ug,{controller:()=>this.controller,ariaLabel:()=>this.tooltip("depressed"),onFileChange:e=>this.updateImage("depressed",e),readonly:()=>this.controller.isItemReadonly(this.id)},Gr.createElement(_Z,{key:this.bindFn(this.depressedStatus)},()=>Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state"),style:()=>this.getStyleForState("depressed")})))),Gr.createElement(kZ,{predicate:()=>!!this.model.clickableInfo.depressedImage},()=>Gr.createElement("div",{class:Gr.const("dcg-clickable-image-state-close"),onTap:()=>this.removeImageState("depressed"),ariaLabel:()=>this.controller.s("graphing-calculator-label-remove-depressed-image"),role:Gr.const("button"),tabIndex:Gr.const(0)},Gr.createElement("i",{class:Gr.const("dcg-icon-remove"),"aria-hidden":Gr.const("true")}))),Gr.createElement("div",{role:Gr.const("heading"),"aria-level":Gr.const("2"),class:Gr.const("dcg-clickable-image-label")},()=>this.controller.s("graphing-calculator-label-depressed"))))}hoveredStatus(){return this.hoveredUploading?"loading":"background"}depressedStatus(){return this.depressedUploading?"loading":"background"}tooltip(e){return(e==="hovered"?this.model.clickableInfo.hoveredImage:this.model.clickableInfo.depressedImage)?e==="depressed"?this.controller.s("graphing-calculator-label-change-depressed-image-tooltip"):this.controller.s("graphing-calculator-label-change-hovered-image-tooltip"):e==="depressed"?this.controller.s("graphing-calculator-label-add-depressed-image-tooltip"):this.controller.s("graphing-calculator-label-add-hovered-image-tooltip")}getImageURLForState(e){let t;if(e==="hovered"){if(this.hoveredStatus()!=="background")return"";t="hoveredImage"}else{if(this.depressedStatus()!=="background")return"";t="depressedImage"}let o=this.model.clickableInfo[t];return o?`url(${o})`:`url(${this.model.image_url})`}getStyleForState(e){let t={"background-image":this.getImageURLForState(e),opacity:"1"};return e==="hovered"&&!this.model.clickableInfo.hoveredImage&&(t.opacity="0.5"),t}removeImageState(e){e==="hovered"?this.controller.dispatch({type:"set-hovered-image",id:this.model.id,url:""}):this.controller.dispatch({type:"set-depressed-image",id:this.model.id,url:""})}updateImage(e,t){if(!t||!t[0])return;let o=t[0];e==="hovered"&&(this.hoveredUploading=!0),e==="depressed"&&(this.depressedUploading=!0),this.controller.getGraphSettings().config.imageUploadCallback(o,(i,n)=>{e==="hovered"&&(this.hoveredUploading=!1),e==="depressed"&&(this.depressedUploading=!1),!i&&n&&(e==="hovered"?this.controller.dispatch({type:"set-hovered-image",id:this.model.id,url:n}):this.controller.dispatch({type:"set-depressed-image",id:this.model.id,url:n}))})}};function Hn(r,e,t){return Hfe(r,e)===t}function Hfe(r,e){let t=r.getFocusLocation();if(!(!t||t.type!=="expression-menu"||t.id!==e))return t.location}function Kn(r,e,t,o){let i=e;t?r.dispatch({type:"set-focus-location",location:{type:"expression-menu",id:i,location:o}}):r.dispatch({type:"blur-focus-location",location:{type:"expression-menu",id:i,location:o}})}var{If:SV,IfDefined:Kfe,Textarea:Wfe}=so.Components,r1=class extends so.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return so.createElement("div",{class:so.const("dcg-options-menu-section dcg-clickable-section")},so.createElement("div",{class:so.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-clickable"),so.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-make-clickable"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleClickable)})),so.createElement(SV,{predicate:this.props.isOpen},()=>so.createElement("div",{class:so.const("dcg-options-menu-content")},so.createElement("div",{class:so.const("dcg-clickable-menu-row")},so.createElement("span",{class:so.const("dcg-input-label")},()=>this.controller.s("graphing-calculator-label-update-on-click")),so.createElement(Ai,{latex:()=>this.model.clickableInfo.latex,operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.controller.s("graphing-calculator-narration-click-action"),brailleShouldFocus:()=>Hn(this.controller,this.model.id,"updaterule"),onBrailleInput:e=>this.dispatchUpdateRuleLatexIfChanged(e),onBrailleFocusedChanged:e=>Kn(this.controller,this.model.id,e,"updaterule"),...wn(this.controller)},so.createElement(Ze,{latex:()=>this.model.clickableInfo.latex,placeholder:this.const(""),isFocused:()=>Hn(this.controller,this.model.id,"updaterule"),capExpressionSize:()=>!!this.controller.getGraphSettings().config.capExpressionSize,tokenController:this.props.controller,selectOnFocus:this.const(!0),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.controller.s("graphing-calculator-narration-click-action"),getAriaPostLabel:this.const(""),hasError:()=>this.hasError(),onUserChangedLatex:e=>this.dispatchUpdateRuleLatexIfChanged(e),onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:e=>Kn(this.controller,this.model.id,e,"updaterule"),dataLabelAttributeValue:this.const("click-handler"),needsSystemKeypad:()=>!this.controller.isKeypadEnabled()})),Kfe(()=>this.packedError(),e=>so.createElement("span",{class:so.const("dcg-clickable-info-error-container")},so.createElement(zn,{error:()=>this.controller.unpack(e()),size:this.const("small")})))),so.createElement(SV,{predicate:this.bindFn(this.isList)},()=>so.createElement("div",{class:so.const("dcg-clickable-list-index-notice")},so.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-label-list-index")},so.const("Use"),so.const(" "),so.createElement("span",{class:()=>({"dcg-index-variable-marker":!0,"dcg-btn":!0,"dcg-btn-light-gray":!0,"dcg-mathquill-has-focus":Hn(this.controller,this.model.id,"updaterule"),"dcg-do-not-blur":!0}),onTap:this.bindFn(this.insertIndex)},so.const("index")),so.const(" "),so.const("to reference the clicked index in the list.")))),so.createElement(SV,{predicate:()=>this.model.type!=="image"},()=>so.createElement(Wfe,{placeholder:()=>this.controller.s("graphing-calculator-text-add-screen-reader-label-placeholder"),value:()=>this.model.description,onInput:e=>this.controller.dispatch({type:"set-item-description",id:this.model.id,description:e})})),so.createElement(SV,{predicate:()=>this.model.type==="image"},()=>so.createElement("div",{class:so.const("dcg-clickable-menu-row")},so.createElement(CV,{controller:()=>this.controller,model:()=>this.model}))))))}insertIndex(){this.controller.dispatch({type:"keypad/type-text",text:"index"})}isList(){return this.model.formula?!!this.model.formula.is_concrete_list:!1}hasError(){return this.packedError()!==void 0}packedError(){if(this.model.formula.click_handler&&this.model.formula.click_handler.status==="error")return this.model.formula.click_handler.error}toggleClickable(){this.controller.dispatch({type:"set-clickableinfo-prop",id:this.model.id,prop:"enabled",value:!this.model.clickableInfo.enabled}),this.model.clickableInfo.enabled&&Kn(this.controller,this.model.id,!0,"updaterule")}dispatchUpdateRuleLatexIfChanged(e){this.model.clickableInfo.latex!==e&&this.controller.dispatch({type:"set-clickableinfo-rule-latex",id:this.model.id,latex:e})}getMQConfig(){return this.controller.getMathquillConfig({additionalOperators:["index"]})}};var hg=__dcg_shared_module_exports__['e'](Z());var pf=class extends hg.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return hg.createElement("div",{class:hg.const("dcg-options-menu-section")},hg.createElement("div",{class:hg.const("dcg-options-menu-content")},hg.createElement(dv,{controller:this.props.controller,colorLatex:this.bindFn(this.getColorLatex),selectedColor:this.bindFn(this.getModelColor),onColorSelected:this.bindFn(this.onColorSelected),onCustomColorSelected:this.bindFn(this.onCustomColorSelected),hideColorFunctions:this.bindFn(this.hideColorFunctions),customColorVisibility:this.bindFn(this.customColorVisibility)})))}hideColorFunctions(){return this.model.type!=="expression"?!1:yw(this.model)||um(this.model)}customColorVisibility(){return this.model.type==="expression"&&bw(this.model)||this.model.type==="table"?"hidden":"visible"}onColorSelected(e){this.model.type!=="image"&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-color",id:this.model.id,color:e}):this.model.type==="table"?this.controller.dispatch({type:"set-tableregression-color",color:e,tableId:this.model.id}):this.controller.dispatch({type:"set-tablecolumn-color",color:e,tableId:this.model.table.id,columnId:this.model.id}))}onCustomColorSelected(e){this.model.type!=="image"&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-colorlatex",id:this.model.id,colorLatex:e}):this.model.type==="table-column"&&this.controller.dispatch({type:"set-tablecolumn-colorlatex",tableId:this.model.table.id,columnId:this.model.id,colorLatex:e}))}getColorLatex(){var e,t;return this.model.type==="image"?"":this.model.type==="table"?(t=(e=this.model.regression)==null?void 0:e.color)!=null?t:"":this.model.colorLatex}getModelColor(){var e,t;return this.model.type==="image"?"":this.model.type==="table"?(t=(e=this.model.regression)==null?void 0:e.color)!=null?t:"":om(this.model)}};var va=__dcg_shared_module_exports__['e'](Z());var{If:$fe,For:jfe}=va.Components,o1=class extends va.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return va.createElement("div",{class:va.const("dcg-options-menu-section")},va.createElement("div",{class:va.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-drag"),va.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-menu-drag-enabled"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleDragEnabled)})),va.createElement($fe,{predicate:this.props.isOpen},()=>va.createElement("div",{class:va.const("dcg-options-menu-content")},va.createElement("div",{class:va.const("dcg-style-icons"),role:va.const("radiogroup")},va.createElement(jfe,{each:()=>["X","Y","XY"]},e=>va.createElement("div",{class:()=>({"dcg-style-icon-container":!0,"dcg-disabled":this.isDisabled(e)}),onTap:()=>this.onDragModeSelected(e),role:va.const("radio"),tabIndex:()=>this.isDisabled(e)?-1:0,"aria-label":()=>e==="X"?this.controller.s("graphing-calculator-narration-drag-mode-x"):e==="Y"?this.controller.s("graphing-calculator-narration-drag-mode-y"):e==="XY"?this.controller.s("graphing-calculator-narration-drag-mode-xy"):this.controller.raw(""),"aria-checked":()=>this.getDragMode()===e},va.createElement(Ji,{backgroundColor:()=>({type:"single-color",value:"#000"}),semiTransparent:()=>this.getDragMode()!==e,iconType:()=>e==="X"?"movable-horizontal":e==="Y"?"movable-vertical":"movable-both"})))))))}isDisabled(e){let t=this.controller.getEnabledDragModesForItem(this.model.id);return!__dcg_shared_module_exports__['p'](t,e)}onDragModeSelected(e){if(this.model.type==="expression"){if(this.isDisabled(e))return;this.controller.dispatch({type:"set-item-dragmode",id:this.model.id,dragMode:e})}else{let t=this.model.id,o=this.model.table.id;this.controller.dispatch({type:"set-tablecolumn-dragmode",tableId:o,columnId:t,dragMode:e})}}getDragMode(){return this.model.type==="expression"?Ci(this.model)||this.model.dragMode:this.model.dragMode}toggleDragEnabled(){let e=this.getDragMode()!=="NONE"?"NONE":"XY";this.model.type==="expression"?this.controller.dispatch({type:"set-item-dragmode",id:this.model.id,dragMode:e}):this.onDragModeSelected(e)}};var ea=__dcg_shared_module_exports__['e'](Z());var{If:TZ}=ea.Components,EV=class extends ea.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return ea.createElement("div",{class:ea.const("dcg-options-menu-section")},ea.createElement("div",{class:ea.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-fill"),ea.createElement(TZ,{predicate:()=>!this.isInequality()},()=>ea.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-fill-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleFillVisible)}))),ea.createElement(TZ,{predicate:this.props.isOpen},()=>ea.createElement("div",{class:ea.const("dcg-options-menu-content")},ea.createElement("div",{class:ea.const("dcg-iconed-mathquill-row dcg-fill-opacity-row")},ea.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-opacity-tooltip")},ea.createElement("i",{class:ea.const("dcg-icon-opacity"),"aria-hidden":ea.const("true")})),ea.createElement(zr,{latex:()=>this.model.fillOpacity,placeholder:this.bindFn(this.getFillOpacity),isFocused:()=>Hn(this.controller,this.model.id,"opacity"),ariaPostLabel:()=>_R(this.model)?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-fill-opacity"),hasError:()=>!_R(this.model),handleLatexChanged:this.bindFn(this.dispatchOpacityLatexIfChanged),dataLabelAttributeValue:this.const("fill-opacity"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"opacity")})))))}getFillOpacity(){return""+.4}isInequality(){return xu(this.model)}toggleFillVisible(){this.controller.dispatch({type:"set-item-fill",id:this.model.id,fill:!this.props.isOpen()})}dispatchOpacityLatexIfChanged(e){this.model.fillOpacity!==e&&this.controller.dispatch({type:"set-item-fillopacity",id:this.model.id,fillOpacity:e})}};var $d=__dcg_shared_module_exports__['e'](Z());var{If:Xfe}=$d.Components,uf=class extends $d.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return $d.createElement(Xfe,{predicate:()=>this.isVisible()},()=>$d.createElement("div",{class:$d.const("dcg-options-menu-section dcg-interactivity-section dcg-section-without-title")},$d.createElement("div",{class:$d.const("dcg-options-menu-content")},$d.createElement(Gt,{checked:()=>yc(this.model),onChange:()=>this.toggleGraphInteractionsDisabled(),ariaLabel:()=>this.controller.s("graphing-calculator-label-disable-graph-interactions")},()=>this.controller.s("graphing-calculator-label-disable-graph-interactions")))))}isVisible(){return this.controller.shouldShowAuthorFeatures()}toggleGraphInteractionsDisabled(){this.model.type==="table-column"?this.controller.dispatch({type:"set-tablecolumn-disable-graph-interactions",tableId:this.model.table.id,columnId:this.model.id,disableGraphInteractions:!yc(this.model)}):this.controller.dispatch({type:"set-item-disable-graph-interactions",id:this.model.id,disableGraphInteractions:!yc(this.model)})}};var Ar=__dcg_shared_module_exports__['e'](Z());var Ts=__dcg_shared_module_exports__['e'](Z());var{For:Jfe}=Ts.Components,Qfe=[{orientation:"default",cssClass:"dcg-label-orientation-center",description:"graphing-calculator-text-label-orientation-default"},{orientation:"above",cssClass:"dcg-label-orientation-above",description:"graphing-calculator-text-label-orientation-above"},{orientation:"above_right",cssClass:"dcg-label-orientation-above-right",description:"graphing-calculator-text-label-orientation-above-right"},{orientation:"right",cssClass:"dcg-label-orientation-right",description:"graphing-calculator-text-label-orientation-right"},{orientation:"below_right",cssClass:"dcg-label-orientation-below-right",description:"graphing-calculator-text-label-orientation-below-right"},{orientation:"below",cssClass:"dcg-label-orientation-below",description:"graphing-calculator-text-label-orientation-below"},{orientation:"below_left",cssClass:"dcg-label-orientation-below-left",description:"graphing-calculator-text-label-orientation-below-left"},{orientation:"left",cssClass:"dcg-label-orientation-left",description:"graphing-calculator-text-label-orientation-left"},{orientation:"above_left",cssClass:"dcg-label-orientation-above-left",description:"graphing-calculator-text-label-orientation-above-left"}],DV=class extends Ts.Class{init(){this.controller=this.props.controller(),this.model=this.props.model(),this.id=this.model.id}template(){return Ts.createElement("div",{class:Ts.const("dcg-label-orientation-view"),style:()=>`transform: rotate(${this.getCSSRotationValue()});`},Ts.createElement("span",{class:Ts.const("dcg-vertical-orientation-indicator")}),Ts.createElement("div",{class:Ts.const("dcg-label-orientations"),role:Ts.const("radiogroup"),"aria-label":()=>this.controller.s("graphing-calculator-heading-label-orientation")},Ts.createElement(Jfe,{each:()=>Qfe,key:e=>e.orientation},e=>Ts.createElement("div",{class:()=>({[e.cssClass]:!0,"dcg-orientation-option":!0,"dcg-selected":this.isSelected(e.orientation),"dcg-orientation-disabled":this.isDisabled(e.orientation)}),role:Ts.const("radio"),tabIndex:Ts.const("0"),"aria-label":()=>this.controller.s(e.description),"aria-checked":()=>this.getOrientation()===e.orientation,onTap:()=>this.onTapOrientation(e.orientation)},Ts.createElement("i",{class:()=>({"dcg-icon-chevron-left":e.orientation!=="default"})})))))}isDisabled(e){return e!=="default"?!1:this.isPointVisible()?!0:this.model.labelOrientation==="default"}isSelected(e){return e==="default"&&e===this.model.labelOrientation?!this.isPointVisible():e===this.model.labelOrientation}isPointVisible(){return this.model.hidden?!1:nl(this.model)?!this.model.hidden:this.model.points}getCSSRotationValue(){let e=f7(this.model);return`${Array.isArray(e)?0:e}rad`}getOrientation(){return this.props.model().labelOrientation}onTapOrientation(e){e===this.getOrientation()&&(e="default"),this.controller.dispatch({type:"set-item-label-orientation",id:this.id,labelOrientation:e})}};var Lp=__dcg_shared_module_exports__['e'](Z());var i1=class extends Lp.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Lp.createElement("div",{class:Lp.const("dcg-iconed-mathquill-row dcg-point-opacity-row")},Lp.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-opacity-tooltip")},Lp.createElement("i",{class:Lp.const("dcg-icon-opacity"),"aria-hidden":Lp.const("true")})),Lp.createElement(zr,{latex:()=>this.model.pointOpacity,placeholder:this.bindFn(this.getPointOpacityPlaceholder),isFocused:()=>Hn(this.controller,this.model.id,"pointopacity"),ariaPostLabel:()=>this.isPointOpacityValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-line-opacity"),hasError:()=>!this.isPointOpacityValid(),handleLatexChanged:this.bindFn(this.dispatchPointOpacityLatexIfChanged),dataLabelAttributeValue:this.const("point-opacity"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"pointopacity")}))}isPointOpacityValid(){return this.model.type==="expression"?h7(this.model):this.model.type==="table-column"?KH(this.model):!1}dispatchPointOpacityLatexIfChanged(e){this.model.pointOpacity!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-pointopacity",id:this.model.id,pointOpacity:e}):this.controller.dispatch({type:"set-tablecolumn-pointopacity",columnId:this.model.id,tableId:this.model.table.id,pointOpacity:e}))}getPointOpacityPlaceholder(){return`${1}`}};var{If:qS}=Ar.Components,kV=class extends Ar.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Ar.createElement("div",{class:Ar.const("dcg-options-menu-section")},Ar.createElement("div",{class:Ar.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-label"),Ar.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-label-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleLabelVisible)})),Ar.createElement(qS,{predicate:this.props.isOpen},()=>Ar.createElement("div",{class:Ar.const("dcg-options-menu-content")},Ar.createElement("div",{class:Ar.const("dcg-options-flex-container")},Ar.createElement("div",{class:Ar.const("dcg-options-left-side")},Ar.createElement(qS,{predicate:this.props.showPointOpacity},()=>Ar.createElement(i1,{...this.props})),Ar.createElement("div",{class:Ar.const("dcg-iconed-mathquill-row dcg-label-size-row")},Ar.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-label-size-tooltip")},Ar.createElement("span",{class:Ar.const("dcg-font-size")},Ar.const("A"))),Ar.createElement(zr,{latex:()=>this.model.labelSize,placeholder:()=>"1",isFocused:()=>Hn(this.controller,this.model.id,"labelsize"),ariaPostLabel:()=>GR(this.model)?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-label-size"),hasError:()=>!GR(this.model),handleLatexChanged:this.bindFn(this.dispatchLabelSizeIfChanged),dataLabelAttributeValue:this.const("label-size"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"labelsize")})),Ar.createElement("div",{class:()=>({"dcg-iconed-mathquill-row":!0,"dcg-label-angle-row":!0,"dcg-suffix-degree":this.props.controller().getGraphSettings().degreeMode,"dcg-suffix-radian":!this.props.controller().getGraphSettings().degreeMode})},Ar.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-angle-tooltip")},Ar.createElement("i",{class:Ar.const("dcg-icon-angle"),"aria-hidden":Ar.const("true")})),Ar.createElement(zr,{latex:()=>this.model.labelAngle,placeholder:()=>"0",isFocused:()=>Hn(this.controller,this.model.id,"labelangle"),ariaPostLabel:()=>IR(this.model)?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-label-angle"),hasError:()=>!IR(this.model),handleLatexChanged:this.bindFn(this.dispatchLabelAngleIfChanged),dataLabelAttributeValue:this.const("label-angle"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"labelangle")}))),Ar.createElement("div",{class:Ar.const("dcg-options-right-side")},Ar.createElement(DV,{controller:()=>this.controller,model:()=>this.model}))),Ar.createElement(qS,{predicate:()=>this.controller.canUseAdvancedStyling()},()=>Ar.createElement("div",{class:Ar.const("dcg-label-advanced")},Ar.createElement(Gt,{checked:this.bindFn(this.getWhiteTextOutline),onChange:this.bindFn(this.setWhiteTextOutline),disabled:()=>this.getEditable()},()=>this.controller.s("graphing-calculator-button-label-text-outline")),Ar.createElement("div",{role:Ar.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-heading-advanced")},Ar.createElement(qS,{predicate:()=>this.shouldShowHoverLabelCheckbox()},()=>Ar.createElement(Gt,{checked:this.bindFn(this.getInteractiveLabel),onChange:this.bindFn(this.setInteractiveLabel)},()=>this.controller.s("graphing-calculator-button-label-show-on-hover"))),Ar.createElement(qS,{predicate:this.bindFn(this.shouldShowEditableLabelToggle)},()=>Ar.createElement(Gt,{checked:this.bindFn(this.getEditable),onChange:this.bindFn(this.setEditable)},()=>this.controller.s("graphing-calculator-button-label-editable")))))))))}getWhiteTextOutline(){return this.getEditable()?!1:!this.model.suppressTextOutline}setWhiteTextOutline(e){this.controller.dispatch({type:"set-suppress-text-outline",id:this.model.id,suppressTextOutline:!e})}setInteractiveLabel(e){this.controller.dispatch({type:"set-item-interactive-label",id:this.model.id,interactiveLabel:e})}getInteractiveLabel(){return!!this.model.interactiveLabel}setEditable(e){if(e){let t=__dcg_shared_module_exports__['oe'](this.model.label)==="latex"?"MATH":"TEXT";this.controller.dispatch({type:"set-item-editable-label-mode",id:this.model.id,editableLabelMode:t})}else this.controller.dispatch({type:"set-item-editable-label-mode",id:this.model.id,editableLabelMode:"NONE"})}getEditable(){return this.model.editableLabelMode!=="NONE"}shouldShowEditableLabelToggle(){return nl(this.model)}shouldShowHoverLabelCheckbox(){return Ci(this.model)==="NONE"}dispatchLabelAngleIfChanged(e){this.model.labelAngle!==e&&this.controller.dispatch({type:"set-item-labelangle",id:this.model.id,labelAngle:e})}dispatchLabelSizeIfChanged(e){this.model.labelSize!==e&&this.controller.dispatch({type:"set-item-labelSize",id:this.model.id,labelSize:e})}toggleLabelVisible(){this.controller.dispatch({type:"set-item-showlabel",id:this.model.id,showLabel:!this.props.isOpen()})}};var Eo=__dcg_shared_module_exports__['e'](Z());var{If:GZ}=Eo.Components,n1=class extends Eo.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Eo.createElement("div",{class:Eo.const("dcg-options-menu-section")},Eo.createElement("div",{class:Eo.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-lines"),Eo.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-lines-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleLinesVisible)})),Eo.createElement(GZ,{predicate:()=>this.props.isOpen()},()=>Eo.createElement("div",{class:Eo.const("dcg-options-menu-content")},Eo.createElement("div",{class:Eo.const("dcg-options-flex-container")},Eo.createElement("div",{class:Eo.const("dcg-options-left-side")},Eo.createElement("div",{class:Eo.const("dcg-iconed-mathquill-row dcg-line-opacity-row")},Eo.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-opacity-tooltip")},Eo.createElement("i",{class:Eo.const("dcg-icon-opacity"),"aria-hidden":Eo.const("true")})),Eo.createElement(zr,{latex:()=>this.model.lineOpacity,placeholder:this.bindFn(this.getLineOpacity),isFocused:()=>Hn(this.controller,this.model.id,"lineopacity"),ariaPostLabel:()=>this.isLineOpacityValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-line-opacity"),hasError:()=>!this.isLineOpacityValid(),handleLatexChanged:this.bindFn(this.dispatchLineOpacityLatexIfChanged),dataLabelAttributeValue:this.const("line-opacity"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"lineopacity")})),Eo.createElement("div",{class:Eo.const("dcg-iconed-mathquill-row dcg-line-thickness-row")},Eo.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-line-thickness-tooltip")},Eo.createElement("i",{class:Eo.const("dcg-icon-line-thickness"),"aria-hidden":Eo.const("true")})),Eo.createElement(zr,{latex:()=>this.model.lineWidth,placeholder:this.bindFn(this.getLineWidth),isFocused:()=>Hn(this.controller,this.model.id,"linewidth"),ariaPostLabel:()=>this.isLineWidthValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-label-line-thickness-tooltip"),hasError:()=>!this.isLineWidthValid(),handleLatexChanged:this.bindFn(this.dispatchLineWidthLatexIfChanged),dataLabelAttributeValue:this.const("line-width"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"linewidth")}))),Eo.createElement("div",{class:Eo.const("dcg-options-right-side")},Eo.createElement(GZ,{predicate:this.bindFn(this.shouldShowLineStyles)},()=>Eo.createElement(Po,{staticConfig:this.bindFn(this.getPointStyleOptions),ariaGroupLabel:()=>this.controller.s("graphing-calculator-heading-style"),theme:this.const("mini")})))))))}getLineWidth(){return""+2.5}getLineOpacity(){return""+1}getPointStyleOptions(){return["SOLID","DASHED","DOTTED"].map(t=>({key:t,icon:()=>this.getStyleIcon(t),ariaLabel:()=>this.getStyleAria(t),selected:()=>this.model.lineStyle===t,class:()=>"dcg-line-segmented-option",onSelect:()=>{this.onLineStyleSelected(t)}}))}getStyleIcon(e){switch(e){case"SOLID":return"dcg-icon-line-solid";case"DASHED":return"dcg-icon-line-dashed";case"DOTTED":return"dcg-icon-line-dotted"}}getStyleAria(e){let t=this.controller.s;switch(e){case"SOLID":return t("graphing-calculator-narration-line-style-solid");case"DASHED":return t("graphing-calculator-narration-line-style-dashed");case"DOTTED":return t("graphing-calculator-narration-line-style-dotted")}}isLineOpacityValid(){return this.model.type==="expression"?u7(this.model):this.model.type==="table-column"?qH(this.model):!1}isLineWidthValid(){return this.model.type==="expression"?$T(this.model):this.model.type==="table-column"?zH(this.model):!1}dispatchLineOpacityLatexIfChanged(e){this.model.lineOpacity!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-lineopacity",id:this.model.id,lineOpacity:e}):this.controller.dispatch({type:"set-tablecolumn-lineopacity",tableId:this.model.table.id,columnId:this.model.id,lineOpacity:e}))}shouldShowLineStyles(){return!(this.model.type==="expression"&&xu(this.model))}onLineStyleSelected(e){this.model.lineStyle!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-linestyle",id:this.model.id,lineStyle:e}):this.controller.dispatch({type:"set-tablecolumn-linestyle",tableId:this.model.table.id,columnId:this.model.id,lineStyle:e}))}dispatchLineWidthLatexIfChanged(e){this.model.lineWidth!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-linewidth",id:this.model.id,lineWidth:e}):this.controller.dispatch({type:"set-tablecolumn-linewidth",tableId:this.model.table.id,columnId:this.model.id,lineWidth:e}))}toggleLinesVisible(){this.model.type==="expression"?this.controller.dispatch({type:"set-item-lines",id:this.model.id,lines:!this.props.isOpen()}):this.controller.dispatch({type:"set-tablecolumn-lines",tableId:this.model.table.id,columnId:this.model.id,bool:!this.props.isOpen()})}};var Ca=__dcg_shared_module_exports__['e'](Z());var{If:ebe}=Ca.Components,TV=class extends Ca.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Ca.createElement("div",{class:Ca.const("dcg-options-menu-section")},Ca.createElement("div",{class:Ca.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-lines"),Ca.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-lines-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleLinesVisible)})),Ca.createElement(ebe,{predicate:()=>this.props.isOpen()},()=>Ca.createElement("div",{class:Ca.const("dcg-options-menu-content")},Ca.createElement("div",{class:Ca.const("dcg-iconed-mathquill-row dcg-line-thickness-row-3d")},Ca.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-line-thickness-3d-tooltip")},Ca.createElement("i",{class:Ca.const("dcg-icon-line-thickness"),"aria-hidden":Ca.const("true")})),Ca.createElement(zr,{latex:()=>this.model.lineWidth,placeholder:()=>`${1}`,isFocused:()=>Hn(this.controller,this.model.id,"linewidth"),ariaPostLabel:()=>this.isLineWidthValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-label-line-thickness-3d-tooltip"),hasError:()=>!this.isLineWidthValid(),handleLatexChanged:this.bindFn(this.dispatchLineWidthLatexIfChanged),dataLabelAttributeValue:this.const("line-width"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"linewidth")})))))}toggleLinesVisible(){this.controller.dispatch({type:"set-item-lines",id:this.model.id,lines:!this.props.isOpen()})}isLineWidthValid(){return this.model.type==="expression"?$T(this.model):!1}dispatchLineWidthLatexIfChanged(e){this.model.lineWidth!==e&&this.model.type==="expression"&&this.controller.dispatch({type:"set-item-linewidth",id:this.model.id,lineWidth:e})}};var pi=__dcg_shared_module_exports__['e'](Z());var{If:AB}=pi.Components,a1=class extends pi.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return pi.createElement("div",{class:pi.const("dcg-options-menu-section")},pi.createElement("div",{class:pi.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-points"),pi.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-points-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.togglePointsVisible)})),pi.createElement(AB,{predicate:this.props.isOpen},()=>pi.createElement("div",{class:pi.const("dcg-options-menu-content")},pi.createElement("div",{class:pi.const("dcg-options-flex-container")},pi.createElement("div",{class:pi.const("dcg-options-left-side")},pi.createElement(i1,{...this.props}),pi.createElement(AB,{predicate:()=>this.model.type==="expression"||!this.isDraggable()},()=>pi.createElement("div",{class:pi.const("dcg-iconed-mathquill-row dcg-point-size-row")},pi.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-point-size-tooltip")},pi.createElement("i",{class:pi.const("dcg-icon-line-thickness"),"aria-hidden":pi.const("true")})),pi.createElement(zr,{latex:this.bindFn(this.getPointSize),placeholder:this.bindFn(this.getDefaultPointSize),isFocused:()=>Hn(this.controller,this.model.id,"pointsize"),ariaPostLabel:()=>this.isPointSizeValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-point-size"),hasError:()=>!this.isPointSizeValid(),handleLatexChanged:e=>this.dispatchPointSizeLatexIfChanged(e),dataLabelAttributeValue:this.const("point-size"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"pointsize")})))),pi.createElement("div",{class:pi.const("dcg-options-right-side")},pi.createElement(AB,{predicate:()=>!this.isDraggable()},()=>pi.createElement(Po,{staticConfig:this.bindFn(this.getPointStyleOptions),ariaGroupLabel:()=>this.controller.s("graphing-calculator-heading-style"),theme:this.const("mini")})))))))}getPointSize(){return this.isDraggable()&&this.model.type==="expression"?this.model.movablePointSize:this.model.pointSize}getPointStyleOptions(){return["POINT","OPEN","CROSS"].map(t=>({key:t,icon:()=>this.getStyleIcon(t),ariaLabel:()=>this.getStyleAria(t),selected:()=>this.model.pointStyle===t,class:()=>"dcg-point-segmented-option",onSelect:()=>{this.onPointStyleSelected(t)}}))}getStyleIcon(e){switch(e){case"POINT":return"dcg-icon-point";case"OPEN":return"dcg-icon-open";case"CROSS":return"dcg-icon-cross"}}getStyleAria(e){let t=this.controller.s;switch(e){case"POINT":return t("graphing-calculator-narration-point-style-point");case"OPEN":return t("graphing-calculator-narration-point-style-open");case"CROSS":return t("graphing-calculator-narration-point-style-cross")}}isPointSizeValid(){return this.model.type==="expression"?this.isDraggable()?g7(this.model):WT(this.model):this.model.type==="table-column"?HH(this.model):!1}onPointStyleSelected(e){this.model.pointStyle!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-pointstyle",id:this.model.id,pointStyle:e}):this.controller.dispatch({type:"set-tablecolumn-pointstyle",columnId:this.model.id,tableId:this.model.table.id,pointStyle:e}))}dispatchPointSizeLatexIfChanged(e){this.getPointSize()!==e&&(this.model.type==="expression"?this.controller.dispatch({type:"set-item-pointsize",id:this.model.id,pointSize:e}):this.controller.dispatch({type:"set-tablecolumn-pointsize",columnId:this.model.id,tableId:this.model.table.id,pointSize:e}))}isDraggable(){return this.getDragMode()!=="NONE"}togglePointsVisible(){this.model.type==="expression"&&nl(this.model)?this.controller.dispatch({type:"toggle-item-hidden",id:this.model.id}):this.model.type==="expression"?this.controller.dispatch({type:"set-item-points",id:this.model.id,points:!this.props.isOpen()}):this.controller.dispatch({type:"set-tablecolumn-points",columnId:this.model.id,tableId:this.model.table.id,bool:!this.props.isOpen()})}getDragMode(){return this.model.type==="expression"?Ci(this.model)||this.model.dragMode:this.model.dragMode}getDefaultPointSize(){return this.model.type==="expression"&&Oh(this.model)?`${14}`:`${8}`}};var Sa=__dcg_shared_module_exports__['e'](Z());var{If:obe}=Sa.Components,GV=class extends Sa.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Sa.createElement("div",{class:Sa.const("dcg-options-menu-section")},Sa.createElement("div",{class:Sa.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-points"),Sa.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-points-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.togglePointsVisible)})),Sa.createElement(obe,{predicate:()=>this.props.isOpen()},()=>Sa.createElement("div",{class:Sa.const("dcg-options-menu-content")},Sa.createElement("div",{class:Sa.const("dcg-iconed-mathquill-row dcg-line-thickness-row-3d")},Sa.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-point-size-3d-tooltip")},Sa.createElement("i",{class:Sa.const("dcg-icon-line-thickness"),"aria-hidden":Sa.const("true")})),Sa.createElement(zr,{latex:()=>this.model.pointSize,placeholder:this.bindFn(this.getDefaultPointSize),isFocused:()=>Hn(this.controller,this.model.id,"pointsize"),ariaPostLabel:()=>this.isPointSizeValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-point-size"),hasError:()=>!this.isPointSizeValid(),handleLatexChanged:e=>this.dispatchPointSizeLatexIfChanged(e),dataLabelAttributeValue:this.const("point-size"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"pointsize")})))))}togglePointsVisible(){this.controller.dispatch({type:"set-item-points",id:this.model.id,points:!this.props.isOpen()})}isPointSizeValid(){return this.model.type==="expression"?WT(this.model):!1}dispatchPointSizeLatexIfChanged(e){this.model.pointSize!==e&&this.model.type==="expression"&&this.controller.dispatch({type:"set-item-pointsize",id:this.model.id,pointSize:e})}getDefaultPointSize(){return`${3}`}};var Qi=__dcg_shared_module_exports__['e'](Z());var{If:VB}=Qi.Components,IV=class extends Qi.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return Qi.createElement("div",{class:Qi.const("dcg-options-menu-section")},Qi.createElement("div",{class:Qi.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-surfaces"),Qi.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-narration-surfaces-visible"),toggled:this.props.isOpen,onChange:this.bindFn(this.toggleSurfacesVisible)})),Qi.createElement(VB,{predicate:()=>this.props.isOpen()},()=>Qi.createElement("div",{style:Qi.const("font-size:85%; margin-top:8px")},Qi.createElement(VB,{predicate:()=>this.usesResolution()&&this.controller.getGraphSettings().config.beta3d},()=>Qi.createElement("div",null,Qi.const("Resolution:"),Qi.createElement(zr,{latex:()=>this.model.resolution,placeholder:()=>this.getDefaultResolution(),isFocused:()=>Hn(this.controller,this.model.id,"resolution"),ariaPostLabel:()=>this.isResolutionValid()?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-label-resolution-tooltip"),hasError:()=>!this.isResolutionValid(),handleLatexChanged:this.bindFn(this.dispatchResolutionLatexIfChanged),dataLabelAttributeValue:this.const("resolution"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"resolution")}))),Qi.createElement(VB,{predicate:this.bindFn(this.shouldShowOpacity)},()=>Qi.createElement("div",{class:Qi.const("dcg-iconed-mathquill-row dcg-surface-opacity-row")},Qi.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-opacity-tooltip"),sticky:this.const(!0),gravity:this.const("s")},Qi.createElement("i",{class:Qi.const("dcg-icon-opacity"),"aria-hidden":Qi.const("true")})),Qi.createElement(zr,{latex:()=>this.model.surfaceOpacity,isFocused:()=>Hn(this.controller,this.model.id,"opacity"),placeholder:this.const("1"),ariaPostLabel:()=>TR(this.model)?this.controller.raw(""):this.controller.s("shared-calculator-narration-input-error"),ariaLabel:()=>this.controller.s("graphing-calculator-narration-surface-opacity"),hasError:()=>!TR(this.model),handleLatexChanged:this.bindFn(this.dispatchOpacityLatexIfChanged),dataLabelAttributeValue:this.const("surface-opacity"),controller:this.props.controller,readonly:()=>this.controller.isItemReadonly(this.model.id),handleFocusChanged:e=>Kn(this.controller,this.model.id,e,"opacity")}))))))}shouldShowOpacity(){return this.controller.getGraphSettings().config.beta3d?this.model.formula.is_inequality!==!0:!1}toggleSurfacesVisible(){this.controller.dispatch({type:"set-item-lines",id:this.model.id,lines:!this.props.isOpen()})}usesResolution(){return!UT(this.model)&&!o7(this.model)}dispatchResolutionLatexIfChanged(e){this.model.resolution!==e&&this.model.type==="expression"&&this.controller.dispatch({type:"set-item-resolution",id:this.model.id,resolution:e})}isResolutionValid(){return this.model.type==="expression"?m7(this.model):!1}getDefaultResolution(){return this.model.type==="expression"&&i7(this.model)?`${__dcg_shared_module_exports__['Od']}`:`${__dcg_shared_module_exports__['Pd']}`}dispatchOpacityLatexIfChanged(e){this.model.surfaceOpacity!==e&&this.controller.dispatch({type:"set-item-surfaceopacity",id:this.model.id,surfaceOpacity:e})}};var{For:ibe,If:nbe}=En.Components;function Lc(r,e){e.runAfterDispatch(()=>{if(!r)return;let t=r.closest(".dcg-options-menu-container"),o=e.findEl(".dcg-container"),i=e.getOpenMenuIcon(),n=!!r.closest(".dcg-table-column-menu");if(!t||!o||!i)return;let a=e.computeMajorLayout(),s=a.list.top+a.list.height,l=a.keypad.top,c=Math.min(s,l),d=o.getBoundingClientRect(),p=i.getBoundingClientRect(),u=c+d.top-p.top,h=t.offsetHeight,m=0;h>u&&(m=+u-h);let y=n?!m:-m<h-38;t.style.marginTop=`${n&&m<0?m-34:m}px`,r.style.marginTop=`${-m}px`,r.style.display=y?"":"none"})}function gg(r,e){requestAnimationFrame(()=>{let t=e.getExppanelElt(),o=e.getOpenMenuIcon();r&&t&&o&&t.contains(o)&&re(t).on(`scroll.${r}`,()=>{re(t).off(`scroll.${r}`);let i=e.getFocusLocation(),n=e.getOpenItemMenu();i&&n&&i.type==="expression-menu"&&"model"in n&&i.id===n.model.id&&e.dispatch({type:"blur-focus-location",location:i}),e.dispatch({type:"close-item-settings-menu"})})})}function mg(r,e){let t=e.getExppanelElt();t&&r&&re(t).off(`scroll.${r}`)}var s1=class extends En.Class{init(){var e;this.controller=this.props.controller(),this.guid=(e=this.controller.getOpenItemMenu())==null?void 0:e.guid}didMount(){gg(this.guid,this.controller)}willUnmount(){mg(this.guid,this.controller)}didUpdate(){Lc(this.arrowElt,this.controller)}template(){let e=this.props.model();return En.createElement("div",{class:()=>({"dcg-expressions-options-menu":!0,"dcg-options-menu":!0}),role:En.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-options-menu")},En.createElement("div",null,En.createElement(ibe,{each:this.bindFn(this.getSectionsWithColorAfterFirstOpen)},t=>{switch(t){case"points":return En.createElement(a1,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("points")});case"label":return En.createElement(kV,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("label"),showPointOpacity:()=>this.isFirstOpenSection("label")});case"drag":return En.createElement(o1,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("drag")});case"lines":return En.createElement(n1,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("lines")});case"fill":return En.createElement(EV,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("fill")});case"colors":return En.createElement(pf,{model:()=>e,controller:this.bindFn(this.props.controller)});case"points3d":return En.createElement(GV,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("points3d")});case"lines3d":return En.createElement(TV,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("lines3d")});case"surfaces":return En.createElement(IV,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>this.isSectionOpen("surfaces")})}})),En.createElement(nbe,{predicate:this.bindFn(this.shouldShowClickableSection)},()=>En.createElement(r1,{model:()=>e,controller:this.bindFn(this.props.controller),isOpen:()=>!!e.clickableInfo.enabled})),En.createElement(uf,{model:()=>e,controller:()=>this.props.controller()}),En.createElement("div",{class:En.const("dcg-triangle"),didMount:this.bindFn(this.didMountArrow),didUnmount:()=>this.arrowElt=void 0}))}didMountArrow(e){this.arrowElt=e,Lc(this.arrowElt,this.controller)}shouldShowClickableSection(){let e=this.props.model();return this.controller.areActionsEnabled()&&MR(e)&&!this.controller.isItemReadonly(e.id)&&(this.controller.shouldShowAuthorFeatures()||!yc(e))}shouldShowDragSection(){let e=this.props.model();return this.controller.shouldShowAuthorFeatures()||!yc(e)}getSectionsWithColorAfterFirstOpen(){let e=this.getSections(),t=[],o=!1;for(let i of e)t.push(i),i==="colors"&&(o=!0),!o&&this.canColorComeAfterSection(i)&&this.isSectionOpen(i)&&(t.push("colors"),o=!0);return t}getSections(){let e=this.props.model();if(this.controller.isThreeDMode()){if(qT(e))return e.extendTo3D?["surfaces"]:["lines3d"];if(vR(e))return["surfaces"];if(ub(e)||wR(e)||l7(e)||SR(e)||ER(e))return["lines3d"];if(nl(e)||yw(e))return["points3d"];if(hb(e)||um(e))return["points3d","lines3d"]}return gb(e)||hm(e)||bw(e)||s7(e)||sm(e)?["colors"]:Rh(e)?["lines"]:Oh(e)?["points"]:hb(e)?["points","label","lines"]:nl(e)?e.formula.move_strategy&&this.shouldShowDragSection()?["points","label","drag"]:["points","label"]:ub(e)||nw(e)?["lines","fill"]:xu(e)?xw(e)||zT(e)||CR(e)?["lines"]:["lines","fill"]:["lines"]}canColorComeAfterSection(e){switch(e){case"colors":case"drag":return!1;case"fill":case"label":case"lines":case"lines3d":case"points":case"points3d":case"surfaces":return!0;default:return e}}isFirstOpenSection(e){return this.getSections().find(t=>this.isSectionOpen(t))===e}isSectionOpen(e){let t=this.props.model(),{points:o,lines:i,fill:n}=t,a=__dcg_shared_module_exports__['vd'](t.formula.expression_type,{points:o,lines:i,fill:n},s=>{Vo("getReconciledExpressionProps [Chrome Switch Bug]",{metaData:{method:"isSectionOpen",type:s}})});switch(e){case"lines":return t.hidden?!1:a.lines;case"label":return Vl(t);case"fill":return t.hidden?!1:xu(t)?!0:a.fill;case"points":return t.hidden?!1:nl(t)?!t.hidden:a.points;case"drag":return Ci(t)!=="NONE";case"colors":return!0;case"points3d":return t.hidden?!1:a.points;case"lines3d":case"surfaces":return t.hidden?!1:a.lines}}};var Ea=__dcg_shared_module_exports__['e'](Z());var{For:abe,If:sbe}=Ea.Components,MV=class extends Ea.Class{init(){var e;this.controller=this.props.controller(),this.model=this.props.model(),this.guid=(e=this.controller.getOpenItemMenu())==null?void 0:e.guid}didMount(){gg(this.guid,this.controller)}willUnmount(){mg(this.guid,this.controller)}didMountArrow(e){this.arrowElt=e,Lc(this.arrowElt,this.controller)}didUpdate(){Lc(this.arrowElt,this.controller)}template(){let e=this.model;return Ea.createElement("div",{class:()=>({"dcg-table-column-menu":!0,"dcg-options-menu":!0}),role:Ea.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-options-menu")},Ea.createElement("div",null,Ea.createElement(abe,{each:this.bindFn(this.getSectionsWithColorAfterFirstOpen)},t=>{switch(t){case"points":return Ea.createElement(a1,{model:()=>e,controller:this.props.controller,isOpen:()=>this.isSectionOpen("points")});case"drag":return Ea.createElement(o1,{model:()=>e,controller:this.props.controller,isOpen:()=>this.isSectionOpen("drag")});case"lines":return Ea.createElement(n1,{model:()=>e,controller:this.props.controller,isOpen:()=>this.isSectionOpen("lines")});case"colors":return Ea.createElement(pf,{model:()=>e,controller:this.props.controller})}})),Ea.createElement(uf,{model:()=>e,controller:()=>this.props.controller()}),Ea.createElement(sbe,{predicate:this.bindFn(this.shouldShowRegressionButton)},()=>Ea.createElement("div",{class:Ea.const("dcg-options-menu-section dcg-options-menu__regression-btn-container")},Ea.createElement("button",{class:()=>({"dcg-btn-light-gray":!0,"dcg-disabled":this.isRegressionButtonDisabled()}),onTap:this.bindFn(this.addRegression)},()=>this.controller.s("graphing-calculator-button-add-table-regression")))),Ea.createElement("div",{class:Ea.const("dcg-triangle"),didMount:this.bindFn(this.didMountArrow),didUnmount:()=>this.arrowElt=void 0}))}shouldShowRegressionButton(){return this.controller.shouldShowRegressionButton(this.model.table)?up(this.model):!1}getSectionsWithColorAfterFirstOpen(){let e=this.getSections(),t=[],o=!1;for(let i of e)t.push(i),i==="colors"&&(o=!0),!o&&this.canColorComeAfterSection(i)&&this.isSectionOpen(i)&&(t.push("colors"),o=!0);return t}canColorComeAfterSection(e){switch(e){case"colors":case"drag":return!1;case"lines":case"points":return!0;default:return e}}getSections(){return this.model.draggable&&!this.controller.isThreeDMode()&&!this.controller.shouldIgnoreGraphInteractions(this.model)?["points","lines","drag"]:["points","lines"]}isSectionOpen(e){switch(e){case"drag":return this.model.dragMode!=="NONE";case"lines":return!!this.model.lines;case"points":return!!this.model.points;case"colors":return!0}}addRegression(){this.isRegressionButtonDisabled()||(this.controller.dispatch({type:"close-item-settings-menu"}),this.controller.dispatch({type:"create-table-regression",tableId:this.model.table.id,regressionType:"linear",columnIds:{y:this.model.id,x:this.model.table.columnModels[0].id}}))}isRegressionButtonDisabled(){return!rm(this.model)}};var fg=__dcg_shared_module_exports__['e'](Z());var AV=class extends fg.Class{init(){var e;this.controller=this.props.controller(),this.model=this.props.model(),this.guid=(e=this.controller.getOpenItemMenu())==null?void 0:e.guid}didMount(){gg(this.guid,this.controller)}willUnmount(){mg(this.guid,this.controller)}didMountArrow(e){this.arrowElt=e,Lc(this.arrowElt,this.controller)}didUpdate(){Lc(this.arrowElt,this.controller)}template(){let e=this.model;return fg.createElement("div",{class:()=>({"dcg-table-column-menu":!0,"dcg-options-menu":!0}),role:fg.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-options-menu")},fg.createElement(pf,{model:()=>e,controller:this.props.controller}),fg.createElement("div",{class:fg.const("dcg-triangle"),didMount:this.bindFn(this.didMountArrow),didUnmount:()=>this.arrowElt=void 0}))}};var Or=__dcg_shared_module_exports__['e'](Z());var{If:zS}=Or.Components,VV=class extends Or.Class{constructor(){super(...arguments),this.justGlobalReplaced=!1}init(){this.controller=this.props.controller()}template(){return Or.createElement("div",{class:()=>({"dcg-expression-search-bar":!0,"dcg-expressions-scrolled":this.props.expsScrolled()&&!this.controller.getTickerOpen()}),role:Or.const("search")},Or.createElement("div",{class:Or.const("dcg-search-row")},Or.createElement("div",{class:Or.const("dcg-search-mathquill-container")},Or.createElement(Ze,{hasError:this.const(!1),getAriaLabel:()=>this.controller.s("graphing-calculator-label-search-expressions"),getAriaPostLabel:()=>this.controller.getExpressionSearchStr().length===0?this.controller.raw(""):this.shouldShowReplaceError()?this.controller.s("graphing-calculator-error-expression-replacement"):this.shouldShowSearchError()?this.controller.s("graphing-calculator-error-expression-search"):this.controller.s("shared-calculator-text-search-results",{count:__dcg_shared_module_exports__['kc'](this.controller.getExpressionSearchCount())}),capExpressionSize:this.const(!1),onUserChangedLatex:this.bindFn(this.onSearchChange),latex:()=>this.controller.getRawExpressionSearchStr(),isFocused:this.bindFn(this.isSearchFocused),config:this.bindFn(this.getMQConfig),onFocusedChanged:this.bindFn(this.onSearchFocusChanged),noFadeout:this.const(!0),onUserPressedKey:(e,t)=>{if(e==="Esc")t&&t.preventDefault(),this.closeSearch();else if(e==="Enter")t&&t.preventDefault(),this.onEnter();else if(e==="Down"){let o=Ze.getFocusedMathquill();return!o||!Ze.applyArrowKeyAndReturnIfWasAtBounds(o,e,t)?void 0:this.controller.dispatch({type:"on-special-key-pressed",key:e})}else{let o=Ze.getFocusedMathquill();if(!o)return;o.keystroke(e,t),this.controller.getRawExpressionSearchStr()!==o.latex()&&(this.justGlobalReplaced=!1,this.onSearchChange(o.latex()))}}}),Or.createElement("i",{class:Or.const("dcg-icon-search"),"aria-hidden":Or.const("true")}),Or.createElement(zS,{predicate:()=>this.controller.getRawExpressionSearchStr().length===0},()=>Or.createElement("span",{class:Or.const("dcg-search-placeholder")},()=>this.controller.s("graphing-calculator-label-search-expressions"))),Or.createElement(zS,{predicate:()=>this.shouldShowSearchError()},()=>Or.createElement("span",{class:Or.const("dcg-search-replace-icon-container")},Or.createElement(zn,{error:()=>this.controller.s("graphing-calculator-error-expression-search"),size:this.const("small")}))),Or.createElement(zS,{predicate:()=>this.controller.isSearchReplaceValid()&&!this.justGlobalReplaced},()=>Or.createElement("span",{class:Or.const("dcg-search-replace-icon-container")},Or.createElement("i",{class:Or.const("dcg-icon-replace"),role:Or.const("button"),tabIndex:Or.const("0"),"aria-label":()=>this.controller.s("graphing-calculator-button-replace"),onTap:this.bindFn(this.onGlobalReplace)}))),Or.createElement(zS,{predicate:()=>this.justGlobalReplaced},()=>Or.createElement("span",{class:Or.const("dcg-search-replace-icon-container")},Or.createElement("i",{class:Or.const("dcg-icon-check"),"aria-hidden":Or.const("true")}))),Or.createElement(zS,{predicate:()=>this.shouldShowReplaceError()},()=>Or.createElement("span",{class:Or.const("dcg-search-replace-icon-container")},Or.createElement(zn,{error:()=>this.controller.s("graphing-calculator-error-expression-replacement"),size:this.const("small")})))),Or.createElement("i",{onTap:()=>this.closeSearch(),tabIndex:Or.const("0"),"aria-label":()=>this.controller.s("account-shell-button-cancel"),role:Or.const("button"),class:Or.const("dcg-icon-remove dcg-do-not-blur")})))}onGlobalReplace(){this.justGlobalReplaced=!0,setTimeout(this.bindIfMounted(()=>{this.justGlobalReplaced=!1,this.update()}),1500),this.controller.dispatch({type:"rename-identifier-global",search:this.controller.getExpressionSearchStr(),replace:this.controller.getExpressionReplaceStr()})}onEnter(){this.controller.isSearchReplaceValid()?this.onGlobalReplace():this.controller.dispatch({type:"update-expression-search-str",str:this.controller.getRawExpressionSearchStr()})}shouldShowSearchError(){return!this.controller.getIsExpressionSearchStrValidForReplace()&&this.controller.getExpressionReplaceStr().length>0}shouldShowReplaceError(){return!this.shouldShowSearchError()&&!this.controller.getIsExpressionReplaceStrValidForReplace()&&this.controller.getExpressionReplaceStr().length>0}closeSearch(){this.controller.dispatch({type:"close-expression-search"})}onSearchChange(e){this.controller.dispatch({type:"update-expression-search-str",str:e})}onSearchFocusChanged(e){e?this.controller.dispatch({type:"set-focus-location",location:{type:"search-expressions"}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"search-expressions"}})}isSearchFocused(){let e=this.controller.getFocusLocation();return!!e&&e.type==="search-expressions"}onReplaceChange(e){this.controller.dispatch({type:"update-expression-replace-str",str:e})}onReplaceFocusChanged(e){e?this.controller.dispatch({type:"set-focus-location",location:{type:"replace-expressions"}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"replace-expressions"}})}isReplaceFocused(){let e=this.controller.getFocusLocation();return!!e&&e.type==="replace-expressions"}getMQConfig(){return this.controller.getMathquillConfig({additionalOperators:["label","rename","image"]})}};var Zt=__dcg_shared_module_exports__['e'](Z());var At=__dcg_shared_module_exports__['e'](Z());$t();var{If:HS}=At.Components,KS=class extends At.Class{init(){this.controller=this.props.controller()}template(){return At.createElement("div",{class:At.const("dcg-add-expression-container")},At.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-add-item-tooltip"),gravity:this.const("s")},At.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-icon-btn":!0,"dcg-add-expression-btn":!0,"dcg-action-add-expression":!0,"dcg-do-blur":!0,"dcg-active":this.controller.isAddExpressionOpen()}),handleEvent:At.const("true"),"aria-haspopup":At.const("true"),"aria-expanded":()=>this.controller.isAddExpressionOpen(),"aria-label":()=>this.controller.s("graphing-calculator-label-add-item-tooltip"),didMount:e=>{this.toggleButtonNode=e},onTap:this.bindFn(this.toggleAddExpression),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-item-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-plus"),"aria-hidden":At.const("true")}))),At.createElement(HS,{predicate:()=>this.controller.isAddExpressionOpen()},()=>At.createElement("div",{class:()=>({"dcg-add-expression-dropdown":!0,"dcg-popover":!0,"dcg-bottom":!this.controller.isNarrow(),"dcg-right":this.controller.isNarrow()}),role:At.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-item-menu"),didMount:this.bindFn(this.didMountPopover),didUnmount:this.bindFn(this.didUnmountPopover)},At.createElement("div",{class:At.const("dcg-popover-interior")},At.createElement("div",{class:At.const("dcg-new-item dcg-do-not-blur dcg-action-newexpression"),role:At.const("button"),tabIndex:At.const(0),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-expression"),onTap:this.bindFn(this.newExpression),handleEvent:At.const("true"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-expression-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-new-expression dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-expression-lowercase")),At.createElement(HS,{predicate:()=>this.controller.areNotesEnabled()},()=>At.createElement("div",{class:At.const("dcg-new-item dcg-do-not-blur dcg-action-newtext"),role:At.const("button"),tabIndex:At.const(0),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-note"),onTap:this.bindFn(this.newText),handleEvent:At.const("true"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-note-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-new-text dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-note-lowercase"))),At.createElement("div",{class:At.const("dcg-new-item dcg-do-not-blur dcg-action-newtable"),role:At.const("button"),tabIndex:At.const(0),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-table"),onTap:this.bindFn(this.newTable),handleEvent:At.const("true"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-table-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-table dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-table-lowercase")),At.createElement(HS,{predicate:()=>this.controller.areFoldersEnabled()},()=>At.createElement("div",{class:At.const("dcg-new-item dcg-do-not-blur dcg-action-newfolder"),role:At.const("button"),tabIndex:At.const(0),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-folder"),onTap:this.bindFn(this.newFolder),handleEvent:At.const("true"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-folder-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-new-folder dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-folder-lowercase"))),At.createElement(HS,{predicate:()=>this.controller.areImagesEnabled()},()=>At.createElement(ug,{controller:()=>this.controller,ariaLabel:()=>this.controller.s("graphing-calculator-narration-add-image"),onFileChange:e=>this.insertFiles(e),location:this.const({type:"add-image-btn"}),readonly:this.const(!1)},At.createElement("div",{class:At.const("dcg-new-item dcg-action-newimage")},At.createElement("i",{class:At.const("dcg-icon-new-image dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-image-lowercase")))),At.createElement(HS,{predicate:this.bindFn(this.showAddTicker)},()=>At.createElement("div",{class:At.const("dcg-new-item dcg-do-not-blur dcg-action-ticker"),role:At.const("button"),tabIndex:At.const(0),"aria-label":()=>this.controller.s("graphing-calculator-narration-add-ticker"),onTap:this.bindFn(this.addTicker),handleEvent:At.const("true"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-ticker-btn"}}))},At.createElement("i",{class:At.const("dcg-icon-metronome dcg-expression-icon"),"aria-hidden":At.const("true")}),()=>this.controller.s("graphing-calculator-label-ticker-lowercase")))),At.createElement("span",{class:At.const("dcg-arrow")}))))}showAddTicker(){return this.controller.areActionsEnabled()&&!this.controller.getTickerOpen()}didMountPopover(e){this.popoverNode=e,re(document).on("dcg-tapstart.add-expression-view wheel.add-expression-view",t=>{this.eventShouldClosePopover(t)&&this.controller.dispatch({type:"close-add-expression",focusIconAfterClose:t.device==="keyboard"})}),re(document).on("keydown.add-expression-view",t=>{if(Be(t)==="Esc"&&this.controller.dispatch({type:"close-add-expression",focusIconAfterClose:!0}),Be(t)==="Tab"&&!t.altKey&&!t.metaKey&&!t.ctrlKey){let o=this.controller.getFocusLocation();if(!o)return;let i;this.showAddTicker()?i={type:"add-ticker-btn"}:this.controller.areImagesEnabled()?i={type:"add-image-btn"}:this.controller.areFoldersEnabled()?i={type:"add-folder-btn"}:i={type:"add-table-btn"},!t.shiftKey&&o.type===i.type?(this.controller.dispatch({type:"set-focus-location",location:{type:"add-item-btn"}}),t.preventDefault(),t.stopPropagation()):t.shiftKey&&o.type==="add-item-btn"&&(this.controller.dispatch({type:"set-focus-location",location:i}),t.preventDefault(),t.stopPropagation())}}),Rs&&Eh&&re(e).on("dcg-tapstart",t=>t.preventDefault()),re(e.querySelector(".dcg-new-item")).on("touchstart",t=>t.preventDefault())}didUnmountPopover(){re(document).off(".add-expression-view")}toggleAddExpression(e){this.controller.dispatch({type:"toggle-add-expression",focusOnOpen:e.device==="keyboard"})}newExpression(){this.controller.dispatch({type:"new-expression"})}newText(){this.controller.dispatch({type:"new-text"})}newFolder(){this.controller.dispatch({type:"new-folder"})}addTicker(){this.controller.dispatch({type:"open-ticker"})}newTable(){this.controller.dispatch({type:"new-table"})}insertFiles(e){this.controller.dispatch({type:"new-images",files:e})}eventShouldClosePopover(e){let t=!!this.popoverNode.contains(e.target),o=!!this.toggleButtonNode.contains(e.target);return!(t||o)}};var Wu=__dcg_shared_module_exports__['e'](Z());var LV=class extends Wu.Class{init(){this.controller=this.props.controller()}template(){return Wu.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-constructions-count-link":!0,"dcg-icon-btn":!0,"dcg-active":this.controller.getShowConstructionsOpen(),"dcg-do-not-blur":!0}),handleEvent:Wu.const("true"),"aria-expanded":()=>this.controller.getShowConstructionsOpen(),manageFocus:this.const(ct({controller:this.controller,location:{type:"geo-show-constructions-icon"}})),onTap:this.bindFn(this.showAllConstructions)},Wu.createElement("i",{class:Wu.const("dcg-icon-geometry"),"aria-label":()=>this.controller.s("graphing-calculator-narration-geometry-construction-icon-label")}),Wu.createElement("span",{class:Wu.const("dcg-construction-count")},()=>this.controller.getGeometryTokenCount()))}showAllConstructions(){this.controller.dispatch({type:"set-show-constructions-open",open:!this.controller.getShowConstructionsOpen(),setFocus:!1})}};var $u=__dcg_shared_module_exports__['e'](Z());$t();var PV=class extends $u.Class{init(){this.controller=this.props.controller()}toggleMuted(){var e;(e=this.controller.toneController)!=null&&e.isGlobalMuted()?this.controller.dispatch({type:"unmute-global"}):this.controller.dispatch({type:"mute-global"})}getMutedState(){return!this.controller.toneController||this.controller.toneController.isGlobalMuted()?"muted":"playing"}getAriaLabel(){switch(this.getMutedState()){case"playing":return this.controller.s("graphing-calculator-narration-mute-all");case"muted":return this.controller.s("graphing-calculator-narration-unmute-all")}}template(){return $u.createElement(ze,{gravity:this.const("s"),tooltip:this.bindFn(this.getAriaLabel)},$u.createElement("button",{class:()=>{var e;return{"dcg-global-mute-button":!0,"dcg-unstyled-button":!0,"dcg-icon-btn":!0,"dcg-is-muted":this.getMutedState()==="muted","dcg-has-never-interacted":!((e=this.controller.toneController)!=null&&e.getHasEverInteractedWithMute())}},didMount:e=>re(e).on("tipsyshow",()=>{var t;(t=this.controller.toneController)==null||t.registerMuteInteraction(),this.update()}),onTap:()=>this.toggleMuted(),manageFocus:this.const(ct({controller:this.controller,location:{type:"global-mute-button"}})),"aria-label":this.bindFn(this.getAriaLabel)},$u.createElement("span",{class:$u.const("dcg-first-time-animation")}),$u.createElement("i",{class:$u.const("dcg-icon-volume")})))}};var{If:ju}=Zt.Components,WS=class extends Zt.Class{init(){this.controller=this.props.controller()}template(){return Zt.createElement("div",{class:()=>({"dcg-expression-top-bar":!0,"dcg-expressions-scrolled":this.showShadow()}),role:Zt.const("toolbar"),"aria-label":()=>this.controller.s("graphing-calculator-narration-expression-bar"),didMount:e=>{this.node=e},onTapStart:this.bindFn(this.clearSelectionOnMobile)},Zt.createElement(ju,{predicate:this.bindFn(this.showHamburger)},()=>Zt.createElement("button",{class:Zt.const("dcg-unstyled-button dcg-action-opendrawer dcg-tooltip dcg-icon-btn dcg-in-api-action-opendrawer"),handleEvent:Zt.const("true"),tooltip:this.bindFn(this.getHamburgerLabel),"aria-label":this.bindFn(this.getHamburgerLabel),onTap:()=>this.controller.dispatch({type:"open-drawer"})},Zt.createElement("i",{class:Zt.const("dcg-icon-hamburger"),"aria-hidden":Zt.const("true")}))),Zt.createElement(ju,{predicate:()=>!this.controller.isInEditListMode()},()=>Zt.createElement(KS,{controller:()=>this.props.controller()})),Zt.createElement(ju,{predicate:()=>this.controller.isGeoUIActive()&&!this.controller.isInEditListMode()},()=>Zt.createElement(LV,{controller:this.props.controller})),Zt.createElement(ju,{predicate:this.bindFn(this.showMuteButton)},()=>Zt.createElement(PV,{controller:this.props.controller})),Zt.createElement(ju,{predicate:this.bindFn(this.showRerandomize)},()=>Zt.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-randomize-tooltip"),gravity:this.const("s")},Zt.createElement("button",{class:Zt.const("dcg-unstyled-button dcg-icon-btn"),handleEvent:Zt.const("true"),"aria-label":()=>this.controller.s("graphing-calculator-label-randomize-tooltip"),onTap:()=>this.controller.dispatch({type:"re-randomize"})},Zt.createElement("i",{class:Zt.const("dcg-icon-randomize"),"aria-hidden":Zt.const("true")})))),Zt.createElement(ju,{predicate:()=>this.controller.isInEditListMode()&&!this.controller.hasDefaultState()},()=>Zt.createElement("button",{class:Zt.const("dcg-btn-red dcg-action-clearall"),onTap:()=>this.controller.dispatch({type:"clear-graph"})},()=>this.controller.s("graphing-calculator-button-clear-graph"))),Zt.createElement(ju,{predicate:()=>this.controller.isInEditListMode()&&this.controller.hasDefaultState()},()=>Zt.createElement("button",{class:Zt.const("dcg-btn-red dcg-action-reset"),onTap:()=>this.controller.dispatch({type:"reset-graph"})},()=>this.controller.s("graphing-calculator-button-reset-graph"))),Zt.createElement("div",{class:Zt.const("dcg-center-buttons")},Zt.createElement(Jv,{...this.props,isPillbox:this.const(!1)})),Zt.createElement(ju,{predicate:()=>!this.controller.isInEditListMode()},()=>Zt.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-edit-list-tooltip"),gravity:this.const("s")},Zt.createElement("button",{class:Zt.const("dcg-unstyled-button dcg-icon-btn dcg-action-toggle-edit"),handleEvent:Zt.const("true"),"aria-label":()=>this.controller.s("graphing-calculator-narration-edit-expression-list"),onTap:this.bindFn(this.toggleEditListMode),manageFocus:this.const(ct({controller:this.controller,location:{type:"edit-list-toggle"}}))},Zt.createElement("i",{class:Zt.const("dcg-icon-settings"),"aria-hidden":Zt.const("true")})))),Zt.createElement(ju,{predicate:()=>this.controller.isInEditListMode()},()=>Zt.createElement("button",{class:Zt.const("dcg-btn-blue dcg-action-toggle-edit dcg-do-not-blur"),handleEvent:Zt.const("true"),onTap:this.bindFn(this.toggleEditListMode),manageFocus:this.const(ct({controller:this.controller,location:{type:"edit-list-toggle"}}))},()=>this.controller.s("graphing-calculator-button-done"))),Zt.createElement(ju,{predicate:()=>!this.controller.isInEditListMode()&&this.controller.getGraphSettings().config.graphpaper},()=>Zt.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-hide-expression-list-tooltip"),gravity:this.const("s")},Zt.const(" "),Zt.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-resize-list-btn":!0,"dcg-action-hideexpressions":!0,"dcg-icon-btn":!0,"dcg-rotated":this.controller.isNarrow()}),"aria-label":()=>this.controller.s("graphing-calculator-label-hide-expression-list-tooltip"),onTap:e=>{this.controller.dispatch({type:"hide-expressions-list",focusShowIcon:e.device==="keyboard"})},manageFocus:this.const(ct({controller:this.controller,location:{type:"hide-expression-list-btn"}}))},Zt.createElement("i",{class:Zt.const("dcg-icon-hide"),"aria-hidden":Zt.const("true")})))))}showShadow(){return this.controller.getTickerOpen()||this.controller.getExpressionSearchOpen()?!1:this.props.expsScrolled()}showRerandomize(){return this.controller.isInEditListMode()?!1:this.controller.anyItemDependsOnRandomSeed()}showHamburger(){return!this.controller.getGraphSettings().config.showHamburger||this.controller.isInEditListMode()?!1:!this.controller.isNarrow()}getHamburgerLabel(){return this.controller.getshowKeyboardShortcutsInTooltips()?this.controller.s("graphing-calculator-label-open-graph-with-shortcut-tooltip"):this.controller.s("graphing-calculator-label-open-graph-tooltip")}clearSelectionOnMobile(e){e.wasHandled()||this.controller.dispatch({type:"set-none-selected"})}toggleEditListMode(e){this.controller.dispatch({type:"set-edit-list-mode",isEditListMode:!this.controller.isInEditListMode(),focusExpressionList:!1}),e.device==="keyboard"&&this.controller.dispatch({type:"set-focus-location",location:{type:"edit-list-toggle"}})}showMuteButton(){return this.controller.isInEditListMode()?!1:this.controller.toneItemsExist()}};var Yr=__dcg_shared_module_exports__['e'](Z());var Pp=__dcg_shared_module_exports__['e'](Z());$t();var{Textarea:lbe}=Pp.Components,bg=class extends Pp.Class{template(){return Pp.createElement("div",{class:Pp.const("dcg-smart-textarea-container")},Pp.createElement("div",{class:Pp.const("dcg-displayTextarea dcg-fixed-width-element"),didMount:this.bindFn(this.didMountDisplay)}),Pp.createElement(lbe,{class:()=>({"dcg-do-blur":!0,"dcg-fixed-width-element":!0,"dcg-smart-textarea":!0,"dcg-empty":!this.props.text()}),"aria-label":()=>{var e,t;return(t=(e=this.props).ariaLabel)==null?void 0:t.call(e)},placeholder:this.bindFn(this.getPlaceholder),readOnly:()=>this.props.readonly()?!0:void 0,value:this.props.text,onInput:this.props.onInput,didMount:this.bindFn(this.didMountTextarea),onKeyDown:this.bindFn(this.onKeydownEvent)}))}getDisplayTextHTML(){let e=this.props.text()||"",t=(n,a)=>e.slice(n,a).replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=0,i="";if(this.props.showLinks()){let n=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,a=null;for(;(a=n.exec(e))!==null;){let[s]=a;i+=t(o,a.index),i+=`<a rel='nofollow ugc' href='${s}' target ='_blank'>${s}</a>`,o=n.lastIndex}}return i+=t(o),i}willUnmount(){this.textareaNode=void 0}didMountDisplay(e){this.displayNode=e,re(e).on("touchend",t=>{t.preventDefault()}),re(e).on("dcg-tap dcg-tapstart",t=>{t.target.closest("a")&&t.handle()}),this.renderDisplayText()}didMountTextarea(e){this.textareaNode=e,re(e).on("dcg-tapstart",t=>{t.handle()}),re(e).on("focusin focusout",()=>this.onFocusEvent()),this.updateFocused()}didUpdate(){this.updateFocused(),this.renderDisplayText()}onFocusEvent(){if(!this.textareaNode)return;let e=document.activeElement===this.textareaNode;this.shouldBeFocused()!==e&&this.props.onFocusChange(e)}renderDisplayText(){if(!this.displayNode)return;let e=this.getDisplayTextHTML();this.lastDisplayTextHTML!==e&&(this.lastDisplayTextHTML=e,this.displayNode.innerHTML=e)}isFocused(){return document.activeElement===this.textareaNode}shouldBeFocused(){return this.props.shouldFocus()}updateFocused(){if(!this.textareaNode)return;let e=this.isFocused(),t=this.shouldBeFocused();if(e!==t)if(!t)this.textareaNode.blur();else{if(Rs&&Eh)return;this.textareaNode.focus(),this.textareaNode.selectionStart=this.textareaNode.selectionEnd=this.textareaNode.value.length}}onKeydownEvent(e){let t=this.textareaNode;if(!t)return;let o=Be(e),i=this.props.readonly(),n=this.props.readonlyAction&&this.props.readonlyAction();if(i&&n!==void 0&&n.predicate()){!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&(o==="Enter"||o==="Space")&&(e.preventDefault(),n.action());return}o==="Enter"&&!e.shiftKey?(e.preventDefault(),this.props.onSpecialKey("Enter")):o==="Esc"?Jr():o==="Up"?(i||t.selectionStart===0&&t.selectionEnd===0)&&!(e.altKey||e.metaKey)&&(e.preventDefault(),this.props.onSpecialKey("Up")):o==="Down"?(i||t.selectionStart===t.value.length&&t.selectionEnd===t.value.length)&&!(e.altKey||e.metaKey)&&(e.preventDefault(),this.props.onSpecialKey("Down")):o==="Backspace"&&!(i&&n!==void 0&&n.predicate())?t.value.length===0&&(e.preventDefault(),this.props.onSpecialKey("Backspace")):o==="Del"&&!(i&&n!==void 0&&n.predicate())&&t.value.length===0&&(e.preventDefault(),this.props.onSpecialKey("Delete")),this.props.onKeydown&&this.props.onKeydown(e)}getPlaceholder(){var e,t;if(!this.props.text())return(t=(e=this.props).placeholder)==null?void 0:t.call(e)}};var{If:cbe}=Yr.Components,$S=class extends Xl{didMountRoot(e){this.onItemViewMounted(e)}willUnmount(){this.onItemViewUnmounted()}template(){return Yr.createElement("div",{class:()=>({"dcg-do-not-blur":!0,"dcg-expressionitem":!0,"dcg-readonly":this.controller.isItemReadonly(this.id),"dcg-expressionfolder":!0,"dcg-inFolder":!1,"dcg-selected":this.renderAsSelected(),"dcg-dragging":!!this.controller.isItemBeingDragged(this.id),"dcg-collapsed":!!this.model.collapsed,"dcg-hidden":!!this.model.hidden,"dcg-has-items":this.controller.getNumberOfItemsInFolder(this.id)>0,"dcg-secretFolder":this.model.secret&&!this.controller.shouldShowAuthorFeatures()}),"expr-id":()=>this.model.id,onTapStart:this.bindFn(this.onMouseSelect),onTap:this.bindFn(this.onMouseSelect),didMount:this.bindFn(this.didMountRoot)},Yr.createElement("div",{class:Yr.const("dcg-fade-container")},Yr.createElement("div",{class:Yr.const("dcg-main")},Yr.createElement("div",{role:Yr.const("button"),tabIndex:Yr.const("0"),"aria-pressed":()=>this.model.collapsed,"aria-label":()=>this.model.collapsed?Lo(this.model,"expand"):Lo(this.model,"collapse"),class:Yr.const("dcg-caret-container dcg-action-toggle-folder-collapsed dcg-do-not-blur"),handleEvent:Yr.const("true"),onTap:this.bindFn(this.toggleCollapsed)},Yr.createElement("i",{class:Yr.const("dcg-icon-caret-down"),"aria-hidden":Yr.const("true")})),Yr.createElement(bg,{shouldFocus:this.bindFn(this.isFocused),text:()=>this.model.title,showLinks:()=>this.controller.areLinksEnabled(),onInput:this.bindFn(this.onInput),onFocusChange:this.bindFn(this.onFocusChange),onSpecialKey:this.bindFn(this.onSpecialKey),ariaLabel:this.bindFn(this.getAriaLabel),readonly:()=>this.controller.isInEditListMode()||this.controller.isItemReadonly(this.id),readonlyAction:this.const({predicate:()=>this.controller.isInEditListMode(),action:()=>this.exitEditListMode()}),placeholder:()=>this.controller.s("graphing-calculator-text-folder-placeholder")}),Yr.createElement(Gt,{checked:()=>this.model.secret,class:()=>{let e="dcg-action-toggle-secret-folder dcg-do-not-blur";return this.controller.canUseAdvancedStyling()?e:e+" dcg-last-folder-checkbox"},style:()=>({display:this.controller.shouldShowAuthorFeatures()?void 0:"none"}),onChange:this.bindFn(this.toggleSecret)},Yr.createElement("span",{class:Yr.const("dcg-checkbox-label")},()=>this.controller.s("graphing-calculator-button-hide-folder-from-students-2"))),Yr.createElement(cbe,{predicate:()=>this.controller.canUseAdvancedStyling()},()=>Yr.createElement(Gt,{checked:()=>this.model.inFrontOfEverything,class:this.const("dcg-action-toggle-in-front-of-everything dcg-do-not-blur dcg-last-folder-checkbox"),onChange:this.bindFn(this.toggleinFrontOfEverything)},Yr.createElement("span",{class:Yr.const("dcg-checkbox-label")},()=>this.controller.s("graphing-calculator-button-in-front-of-everything"))))),Yr.createElement(zd,{controller:this.props.controller,model:this.props.model})),Yr.createElement("span",{class:Yr.const("dcg-tab dcg-action-drag"),handleEvent:Yr.const("true"),tapboundary:Yr.const("true"),disablescroll:Yr.const("true"),onTapStart:this.bindFn(this.onDragPending)},Yr.createElement("span",{class:Yr.const("dcg-num")},()=>this.model.displayIndex),Yr.createElement("div",{class:Yr.const("dcg-tab-interior")},Yr.createElement("span",{role:Yr.const("button"),tabIndex:Yr.const("0"),"aria-pressed":()=>!!this.model.hidden,"aria-label":()=>this.model.hidden?Lo(this.model,"show"):Lo(this.model,"hide"),class:Yr.const("dcg-circular-icon-container dcg-expression-icon-container"),onTap:this.bindFn(this.toggleHidden)},Yr.createElement(Ji,{iconType:()=>this.model.hidden?"hidden":"folder",whiteIcon:()=>this.renderAsSelected()||this.controller.isItemBeingDragged(this.model.id)})))),Yr.createElement(qd,{controller:this.props.controller,id:()=>this.model.id}))}renderAsSelected(){return this.controller.isItemSelected(this.model.id)||this.model.collapsedChildIsSelected}toggleHidden(){this.controller.dispatch({type:"toggle-item-hidden",id:this.id})}toggleSecret(){this.controller.dispatch({type:"set-item-secret",id:this.id,isSecret:!this.model.secret})}toggleinFrontOfEverything(){this.controller.dispatch({type:"set-item-in-front-of-everything",id:this.id,inFrontOfEverything:!this.model.inFrontOfEverything})}toggleCollapsed(){this.controller.dispatch({type:"set-folder-collapsed",id:this.id,isCollapsed:!this.model.collapsed})}onInput(e){this.controller.dispatch({type:"set-folder-title",id:this.id,title:e})}onFocusChange(e){e?this.controller.dispatch({type:"set-focus-location",location:{type:"folder",id:this.id}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"folder",id:this.id}})}onSpecialKey(e){return this.controller.dispatch({type:"on-special-key-pressed",key:e})}isFocused(){let e=this.controller.getFocusLocation();return!(!e||e.type!=="folder"||e.id!==this.id)}getAriaLabel(){let e="",t="";switch((this.model.hidden?1:0)+(this.model.collapsed?16:0)+(this.model.secret?256:0)+(this.model.readonly?4096:0)){case 0:t=this.controller.s("graphing-calculator-narration-description-folder");break;case 1:t=this.controller.s("graphing-calculator-narration-description-hidden-folder");break;case 16:t=this.controller.s("graphing-calculator-narration-description-collapsed-folder");break;case 256:t=this.controller.s("graphing-calculator-narration-description-secret-folder");break;case 4096:t=this.controller.s("graphing-calculator-narration-description-readonly-folder");break;case 17:t=this.controller.s("graphing-calculator-narration-description-hidden-collapsed-folder");break;case 257:t=this.controller.s("graphing-calculator-narration-description-hidden-secret-folder");break;case 4097:t=this.controller.s("graphing-calculator-narration-description-hidden-readonly-folder");break;case 272:t=this.controller.s("graphing-calculator-narration-description-collapsed-secret-folder");break;case 4352:t=this.controller.s("graphing-calculator-narration-description-secret-readonly-folder");break;case 4112:t=this.controller.s("graphing-calculator-narration-description-collapsed-readonly-folder");break;case 273:t=this.controller.s("graphing-calculator-narration-description-hidden-collapsed-secret-folder");break;case 4113:t=this.controller.s("graphing-calculator-narration-description-hidden-collapsed-readonly-folder");break;case 4353:t=this.controller.s("graphing-calculator-narration-description-hidden-secret-readonly-folder");break;case 4368:t=this.controller.s("graphing-calculator-narration-description-collapsed-secret-readonly-folder");break;case 4369:t=this.controller.s("graphing-calculator-narration-description-hidden-collapsed-secret-readonly-folder");break}let c=this.controller.getNumberOfItemsInFolder(this.id);return c>0?e=this.controller.s("graphing-calculator-narration-folder-has-items",{folder:t,count:c}):e=t,e}};var Ua=__dcg_shared_module_exports__['e'](Z());var{For:MZ,If:dbe}=Ua.Components,OV=class extends Ua.Class{init(){this.controller=this.props.controller(),this.currentlyInspectedDepth=1/0,this.cachedTokenDepths={depths:{},isInvalid:!1},this.updateCachedTokenDepthInfo()}willUpdate(){this.updateCachedTokenDepthInfo()}updateCachedTokenDepthInfo(){let e="",t=!1,o=this.controller.getFocusLocation();if(o&&o.type==="expression"){let n=this.controller.getFocusedItem();(n==null?void 0:n.type)==="expression"&&(e=n.id,t=!!n.error&&n.latex!==""||!!n.formula.variables.length)}if(this.cachedTokenDepths.focusedExpressionBeforeError==e&&t){this.cachedTokenDepths.isInvalid=!0;return}this.cachedTokenDepths={depths:this.controller.cachedGeoTokenDepths,isInvalid:!1,focusedExpressionBeforeError:t?void 0:e}}template(){return Ua.createElement("div",{class:()=>({"dcg-geo-show-constructions-pane":!0,"dcg-transient-error":this.cachedTokenDepths.isInvalid,"dcg-cant-drag-item":!!this.controller.getDraggedItemId()&&!this.controller.canDraggedItemBeMovedIntoTokenPane()}),"aria-label":()=>this.controller.s("graphing-calculator-narration-geometry-token-navigator-label"),role:Ua.const("region"),didUnmount:()=>this.lastFocusedIdentifier=void 0,onKeyDown:this.bindFn(this.handleKeydown)},Ua.createElement(dbe,{predicate:()=>this.controller.getGeometryTokenCount()===0},()=>Ua.createElement("div",{class:Ua.const("dcg-empty-constructions")},()=>this.controller.s("graphing-calculator-text-geometry-no-constructed-objects"))),Ua.createElement("div",{class:Ua.const("dcg-displayed-sections-container")},Ua.createElement(MZ,{each:this.bindFn(this.getObjectDepths)},e=>Ua.createElement("div",{class:()=>({"dcg-displayed-section-level":!0,"dcg-selected-level":parseInt(e)===this.getCurrentlyInspectedDepth(),"dcg-below-the-line":parseInt(e)>this.getCurrentlyInspectedDepth()})},Ua.createElement("span",{role:Ua.const("listbox"),"aria-label":()=>this.controller.s("graphing-calculator-narration-geometry-token-navigator-depth",{depth:e})},Ua.createElement(MZ,{each:()=>this.getTokensForDepth(e),key:(t,o)=>o},(t,o)=>Ua.createElement("span",{class:()=>({"dcg-token-being-dragged-container":this.isTokenBeingDragged(e,o)}),onTapStart:i=>{let n=this.getCalcIdForDepth(e,o),a=this.controller.getItemModel(n);!a||a.type!=="expression"||this.controller.isItemInGeoFolder(a.id)&&this.props.onDragPending(i,{type:"token",calcId:n,originalIndex:a.index})}},Ua.createElement(_u,{showParentChildrenHover:this.const(!0),controller:this.props.controller,identifier:()=>this.getIdentifierForDepth(e,o),insideMQ:this.const(!1),insideGroup:this.const(!0),focusLocation:()=>({type:"geo-token",identifier:this.getIdentifierForDepth(e,o)}),putInTabOrder:()=>{if(this.lastFocusedIdentifier===void 0){let i=this.getObjectDepths();this.lastFocusedIdentifier=this.getIdentifierForDepth(i[0],0)}return this.lastFocusedIdentifier===this.getIdentifierForDepth(e,o)}}))))))))}isTokenBeingDragged(e,t){let o=this.controller.getDraggedItemId();if(!o)return!1;if(this.controller.isItemInGeoFolder(o))return o==this.getCalcIdForDepth(e,t)}getCurrentlyInspectedDepth(){return Math.min(this.currentlyInspectedDepth,this.getObjectDepths().length-1)}getIdentifierForDepth(e,t){let o=this.getTokensForDepth(e)[t];return o?o.identifier:""}getCalcIdForDepth(e,t){let o=this.getTokensForDepth(e)[t];return o?o.calcId:""}getTokensForDepth(e){let{depths:t}=this.cachedTokenDepths,o=t[e];return o||[]}getObjectDepths(){let e=Object.keys(this.cachedTokenDepths.depths);return e.sort((t,o)=>{let i=parseInt(t),n=parseInt(o);return isFinite(i)?isFinite(n)?i-n:1:-1}),e}selectItemIfNecessary(){if(this.controller.hasAnyItemsSelected())return;let e=this.controller.getFocusLocation();if((e==null?void 0:e.type)!=="geo-token")return;let{calcId:t}=this.controller.cachedGeoTokenInfo[e.identifier];!t||!this.controller.getItemModel(t)||this.controller.dispatch({type:"set-selected-id",id:t,state:"selected"})}handleKeydown(e){let t=this.controller.getFocusLocation(),o=Be(e),i=Ho(e);if(e.ctrlKey&&e.shiftKey&&!e.altKey&&!e.metaKey&&i==="O"){e.preventDefault(),e.stopPropagation(),this.selectItemIfNecessary(),this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"multi-select-more",guid:Ob(),focusFirstOption:!0,previousFocusLocation:t}});return}if(e.altKey&&!e.ctrlKey&&!e.metaKey&&e.shiftKey&&i==="T"){if(e.preventDefault(),e.stopPropagation(),(t==null?void 0:t.type)!=="geo-token")return;let{calcId:u}=this.controller.cachedGeoTokenInfo[t.identifier];if(!u)return;let h=this.controller.getItemModel(u);if(!$c(h))return;this.controller.convertToNamedAssignment(h),Qa(h,""),this.controller.dispatch({type:"set-none-selected"}),this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:h.id}});return}if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;if(o==="Esc"){e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"set-show-constructions-open",open:!1,setFocus:!0});return}if(o!=="Up"&&o!=="Down"&&o!=="Left"&&o!=="Right")return;e.preventDefault(),e.stopPropagation();let n=this.getObjectDepths();if(n.length===0)return;let a="";if(t&&t.type==="geo-token")a=t.identifier;else{let u=this.getTokensForDepth(n[0])[0];if(!u)return;a=u.identifier}if(a==="")return;let s,l=-1,c=[];for(s=0;s<n.length;s++){let u=n[s];if(c=this.getTokensForDepth(u),!!c&&(l=__dcg_shared_module_exports__['B'](c,{identifier:a}),l!==-1))break}if(s===-1||l===-1)return;o==="Up"?s=Math.max(s-1,0):o==="Down"?s=Math.min(s+1,n.length-1):o==="Left"?l=Math.max(l-1,0):o==="Right"&&(l=Math.min(l+1,c.length-1));let d=this.getTokensForDepth(n[s]);if(!d)return;l=Math.min(l,d.length-1);let p=d[l].identifier;this.controller.dispatch({type:"set-focus-location",location:{type:"geo-token",identifier:p}}),this.lastFocusedIdentifier=p}};var Sr=__dcg_shared_module_exports__['e'](Z());function RV(r){let e=document.createElement("a");return e.href=r,e.href}var{For:pbe,If:jS,Textarea:ube}=Sr.Components,FV=class extends Sr.Class{template(){return Sr.createElement("div",{class:Sr.const("dcg-image-aria-container")},Sr.createElement(ube,{placeholder:()=>this.props.controller().s("graphing-calculator-text-add-screen-reader-label-placeholder"),value:()=>this.props.model().description,onInput:e=>this.props.controller().dispatch({type:"set-item-description",id:this.props.model().id,description:e})}))}},NV=class extends Sr.Class{init(){var e;this.controller=this.props.controller(),this.model=this.props.model(),this.guid=(e=this.controller.getOpenItemMenu())==null?void 0:e.guid}didMountArrow(e){this.arrowElt=e,Lc(this.arrowElt,this.controller)}didMount(){gg(this.guid,this.controller)}willUnmount(){mg(this.guid,this.controller)}didUpdate(){Lc(this.arrowElt,this.controller)}template(){let e=this.model;return Sr.createElement("div",{class:Sr.const("dcg-image-options-menu dcg-options-menu")},Sr.createElement("div",{class:Sr.const("dcg-opacities-menu dcg-options-menu-section")},Sr.createElement("div",{role:Sr.const("heading"),"aria-level":Sr.const("2"),class:Sr.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-heading-image-opacity")),Sr.createElement("div",{class:Sr.const("dcg-opacities-menu-flex"),role:Sr.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-heading-image-opacity")},Sr.createElement(pbe,{each:()=>this.controller.getImageOpacities()},t=>Sr.createElement("span",{class:Sr.const("dcg-opacity-option"),role:Sr.const("button"),tabIndex:Sr.const(0),"aria-label":()=>`opacity: ${t}`,"aria-pressed":()=>this.isOpacitySelected(t),handleEvent:Sr.const("true"),onTap:()=>this.onSelectOpacity(t)},Sr.createElement(Ji,{backgroundImage:this.bindFn(this.getBackgroundImage),iconType:()=>this.isOpacitySelected(t)?"check":"none",backgroundOpacity:()=>parseFloat(t)}))))),Sr.createElement("div",{class:Sr.const("dcg-styles-div dcg-options-menu-section dcg-section-without-title")},Sr.createElement(jS,{predicate:()=>this.shouldShowBackgroundCheckbox()},()=>Sr.createElement("div",{class:Sr.const("dcg-styles-menu"),role:Sr.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-narration-image-styles")},Sr.createElement(Gt,{checked:()=>!e.foreground,onChange:this.bindFn(this.onToggleForeground)},()=>this.controller.s("graphing-calculator-button-place-image-behind-graphs")))),Sr.createElement(jS,{predicate:()=>this.shouldShowDraggableCheckbox()},()=>Sr.createElement("div",{class:Sr.const("dcg-draggable-checkbox-container")},Sr.createElement(Gt,{checked:()=>hp(e),onChange:this.bindFn(this.onToggleDraggable)},()=>this.controller.s("graphing-calculator-button-draggable"))))),Sr.createElement(jS,{predicate:()=>hp(e)},()=>Sr.createElement(FV,{...this.props})),Sr.createElement(jS,{predicate:this.bindFn(this.shouldShowClickable)},()=>Sr.createElement(r1,{controller:this.props.controller,model:()=>e,isOpen:()=>!!e.clickableInfo.enabled})),Sr.createElement(jS,{predicate:()=>!!e.clickableInfo.enabled&&!hp(e)},()=>Sr.createElement(FV,{...this.props})),Sr.createElement(uf,{model:()=>e,controller:()=>this.props.controller()}),Sr.createElement("div",{class:Sr.const("dcg-triangle"),didMount:this.bindFn(this.didMountArrow),didUnmount:()=>this.arrowElt=void 0}))}onToggleDraggable(){Ux(this.model)?this.controller.dispatch({type:"set-image-draggable",id:this.model.id,draggable:!this.model.draggable}):this.makeDraggable()}onToggleForeground(e){this.controller.dispatch({type:"set-image-in-foreground",id:this.model.id,foreground:!e})}onSelectOpacity(e){this.controller.dispatch({type:"set-image-opacity",id:this.model.id,opacity:e})}isOpacitySelected(e){return this.model.opacity===e}getBackgroundImage(){return this.model.image_url===this.lastURL?this.lastEncodedURL:(this.lastURL=this.model.image_url,this.lastEncodedURL='url("'+RV(this.model.image_url)+'")',this.lastEncodedURL)}shouldShowClickable(){return this.controller.shouldIgnoreGraphInteractions(this.model)?!1:this.controller.areActionsEnabled()}makeDraggable(){this.controller.dispatch({type:"convert-image-to-draggable",id:this.model.id})}shouldShowDraggableCheckbox(){if(this.controller.isThreeDMode()||this.controller.shouldIgnoreGraphInteractions(this.model))return!1;let e=Ux(this.model);return e?YT(e):Y6(this.model)}shouldShowBackgroundCheckbox(){let e=this.controller.getItemModel(this.model.folderId);return!(e&&e.type==="folder"&&e.inFrontOfEverything)}};var ft=__dcg_shared_module_exports__['e'](Z());var ps=__dcg_shared_module_exports__['e'](Z());var{SwitchUnion:hbe,If:gbe}=ps.Components,py=class extends ps.Class{init(){this.model=this.props.model(),this.controller=this.props.controller()}template(){return ps.createElement("div",{class:ps.const("dcg-expression-icon-container dcg-image-icon-container")},hbe(this.bindFn(this.typeOfIcon),{error:()=>ps.createElement(zn,{error:()=>this.controller.unpack(this.model.error),isWhite:this.bindFn(this.isSelected)}),failed:()=>ps.createElement("span",null),loading:()=>ps.createElement(Ji,{iconType:this.const("loading")}),hidden:()=>this.buildIconView(),image:()=>this.buildIconView()}))}buildIconView(){return ps.createElement("div",{class:ps.const("dcg-circular-icon-container"),role:ps.const("button"),tabIndex:ps.const("0"),"dcg-open-menu-guid":()=>this.getMenuGUID(),"aria-label":this.bindFn(this.getIconAriaLabel),onTap:e=>{if(!e.wasHandled("dragdrop")&&!e.wasLongheld()){if(this.myOptionsOpen())return this.toggleOptions(e);if(this.controller.isInEditListMode()||e.shiftKey)return this.toggleOptions(e);this.toggleImageShown()}},onLongHold:e=>{e.handle("dcg-longhold"),e.handle("dcg-tap"),this.toggleOptions(e)},manageFocus:this.const(ct({controller:this.controller,location:{type:"image-icon",id:this.model.id}}))},ps.createElement(Ji,{iconType:()=>this.typeOfIcon()==="hidden"?"hidden":"background",backgroundImage:this.bindFn(this.getBackgroundImage),backgroundOpacity:this.const(1),whiteIcon:this.bindFn(this.isSelected)}),ps.createElement(gbe,{predicate:()=>this.model.disableGraphInteractions},()=>ps.createElement("i",{class:ps.const("dcg-graph-interaction-disabled dcg-icon-lock")})))}isSelected(){return this.controller.isItemSelected(this.model.id)||this.controller.isItemBeingDragged(this.model.id)}typeOfIcon(){return this.model.loadStatus==="loading"?"loading":this.model.loadStatus==="failed"?"failed":this.hasError()?"error":this.model.shouldGraph?"image":"hidden"}getMenuGUID(){return this.model.guid}myOptionsOpen(){return this.controller.isItemSettingsMenuOpen(this.getMenuGUID())}toggleOptions(e){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"image",model:this.model,guid:this.getMenuGUID(),focusFirstOption:e.device==="keyboard"}})}hasError(){return!!this.model.error&&this.controller.getBrailleMode()==="none"}getBackgroundImage(){return this.model.image_url===this.lastURL?this.lastEncodedURL:(this.lastURL=this.model.image_url,this.lastEncodedURL='url("'+RV(this.model.image_url)+'")',this.lastEncodedURL)}toggleImageShown(){this.controller.dispatch({type:"toggle-item-hidden",id:this.model.id}),this.controller.dispatch({type:"set-focus-location",location:{type:"image-icon",id:this.model.id}})}getIconAriaLabel(){return this.myOptionsOpen()?Lo(this.model,"hide-options"):this.controller.isInEditListMode()?Lo(this.model,"show-options"):this.model.hidden?Lo(this.model,"show"):Lo(this.model,"hide")}};var{If:YS,SwitchUnion:mbe}=ft.Components,uy=class extends ft.Class{init(){this.model=this.props.model(),this.controller=this.props.controller()}template(){return ft.createElement(zr,{containerClass:()=>({"dcg-image-input-mathquill":!0,"dcg-suffix-degree":this.props.name()==="angle"&&this.props.controller().getGraphSettings().degreeMode,"dcg-suffix-radian":this.props.name()==="angle"&&!this.props.controller().getGraphSettings().degreeMode}),fontSize:this.const("large"),fullWidth:this.const(!0),readonly:this.props.readonly,latex:()=>this.model[this.props.name()],isFocused:()=>this.props.focusedInput()===this.props.name(),ariaLabel:()=>this.controller.raw(this.props.name()),handleFocusChanged:this.bindFn(this.handleMQFocusedChanged),hasError:()=>eK(this.model,this.props.name()),controller:this.props.controller,handlePressedKey:this.bindFn(this.handlePressedKey),handleLatexChanged:this.bindFn(this.handleLatexChanged),noBorder:()=>!this.props.focusedInput()})}getInputs(){return["center","width","angle","height","opacity"]}handlePressedKey(e,t){let o=this.props.name(),i=Ze.getFocusedMathquill(),n=this.getInputs(),a=n.indexOf(o);if(!this.controller.isInEditListMode()){if(e==="Enter")return this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"});if(e==="Esc"){Jr();return}}let s=-1;e==="Up"&&(s=a===1?4:a-2),e==="Down"&&(s=a===4?1:a+2),e==="Left"&&(s=a-1),e==="Right"&&(s=a+1);let l=e;if(s>=0&&s<n.length){let c=!1;if(i)c=Ze.applyArrowKeyAndReturnIfWasAtBounds(i,l,t);else if(e==="Up"||e==="Down")c=!0;else{let d=Yl();c=d&&(e==="Left"&&d.selectionStart===0||e==="Right"&&d.selectionStart===d.value.length)}c&&(this.focusInput(n[s]),t&&t.preventDefault());return}i&&(i.keystroke(e,t),this.handleLatexChanged(i.latex()))}focusInput(e){this.controller.dispatch({type:"set-focus-location",location:{type:"image",id:this.model.id,location:e}})}handleLatexChanged(e){let t=this.props.name();this.model.draggingOnGraphpaper||W6(this.model,t)!==e&&this.controller.dispatch({type:"set-image-mq-attribute",id:this.model.id,attribute:t,latex:e})}handleMQFocusedChanged(e){let t=this.props.name();e?this.props.focusedInput()!==t&&this.controller.dispatch({type:"set-focus-location",location:{type:"image",id:this.model.id,location:t}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"image",id:this.model.id,location:t}})}},XS=class extends Xl{didMountRoot(e){this.onItemViewMounted(e)}willUnmount(){this.onItemViewUnmounted()}template(){return ft.createElement("div",{class:()=>({"dcg-do-not-blur":!0,"dcg-expressionitem":!0,"dcg-readonly":this.controller.isItemMarkedReadonly(this.id),"dcg-expressionimage":!0,"dcg-inFolder":!!this.model.folderId,"dcg-selected":this.controller.isItemSelected(this.id),"dcg-dragging":!!this.controller.isItemBeingDragged(this.id),"dcg-input-focused":this.getFocusedInput()&&this.getFocusedInput()!=="name"}),"expr-id":()=>this.model.id,onTapStart:this.bindFn(this.onMouseSelect),onTap:this.bindFn(this.onMouseSelect),didMount:this.bindFn(this.didMountRoot)},ft.createElement("div",{class:ft.const("dcg-fade-container")},ft.createElement("div",{class:ft.const("dcg-main")},mbe(()=>this.model.loadStatus,{failed:()=>ft.createElement("div",null,ft.createElement("div",{class:ft.const("dcg-image-failed")},()=>this.controller.s("graphing-calculator-error-failed-to-load-image")),ft.createElement("div",{role:ft.const("button"),tabIndex:ft.const(0),class:ft.const("dcg-retry-loading-image"),onTap:this.bindFn(this.onRetryLoad)},()=>this.controller.s("graphing-calculator-button-load-image-retry"))),loading:()=>ft.createElement("div",null,ft.createElement("div",{class:ft.const("dcg-image-loading")},()=>this.controller.s("graphing-calculator-text-loading-image")),ft.createElement("div",{role:ft.const("button"),tabIndex:ft.const(0),class:ft.const("dcg-retry-loading-image"),onTap:this.bindFn(this.onRetryLoad)},()=>this.controller.s("graphing-calculator-button-load-image-retry"))),loaded:()=>ft.createElement("div",{class:ft.const("dcg-image-loaded")},ft.createElement("div",{class:ft.const("dcg-image-title-row")},ft.createElement(bg,{shouldFocus:()=>this.getFocusedInput()==="name",text:()=>this.model.name,ariaLabel:()=>Lo(this.model,"edit_title"),placeholder:()=>this.controller.s("graphing-calculator-text-image-placeholder"),showLinks:()=>this.controller.areLinksEnabled(),onInput:this.bindFn(this.onNameInput),onFocusChange:this.bindFn(this.onNameFocusChange),onSpecialKey:this.bindFn(this.onNameSpecialKey),readonly:()=>this.controller.isInEditListMode()||this.isReadonly()}),ft.createElement(YS,{predicate:()=>this.controller.areImagesEnabled()},()=>ft.createElement(ug,{controller:()=>this.controller,ariaLabel:()=>this.controller.s("graphing-calculator-button-change-image"),onFileChange:e=>this.insertFiles(e),location:this.const({type:"change-image-btn",id:this.id}),readonly:this.bindFn(this.isReadonly)},ft.createElement(YS,{predicate:()=>!this.isReadonly()},()=>ft.createElement("div",{class:ft.const("dcg-action-changeimage")},()=>this.controller.s("graphing-calculator-button-change-image")))))),ft.createElement("div",{class:()=>({"dcg-do-blur":!0,"dcg-image-input-grid":!0}),handleEvent:ft.const("true")},ft.createElement("div",{class:ft.const("dcg-image-input-name")},()=>this.controller.s("graphing-calculator-label-image-center")),ft.createElement(uy,{name:this.const("center"),controller:()=>this.controller,model:()=>this.model,focusedInput:this.bindFn(this.getFocusedInput),readonly:this.bindFn(this.isReadonly)}),ft.createElement("div",{class:ft.const("dcg-image-input-name")},()=>this.controller.s("graphing-calculator-label-image-width")),ft.createElement(uy,{name:this.const("width"),controller:()=>this.controller,model:()=>this.model,focusedInput:this.bindFn(this.getFocusedInput),readonly:this.bindFn(this.isReadonly)}),ft.createElement("div",{class:ft.const("dcg-image-input-name")},()=>this.controller.s("graphing-calculator-label-image-angle")),ft.createElement(uy,{name:this.const("angle"),controller:()=>this.controller,model:()=>this.model,focusedInput:this.bindFn(this.getFocusedInput),readonly:this.bindFn(this.isReadonly)}),ft.createElement("div",{class:ft.const("dcg-image-input-name")},()=>this.controller.s("graphing-calculator-label-image-height")),ft.createElement(uy,{name:this.const("height"),controller:()=>this.controller,model:()=>this.model,focusedInput:this.bindFn(this.getFocusedInput),readonly:this.bindFn(this.isReadonly)}),ft.createElement("div",{class:ft.const("dcg-image-input-name")},()=>this.controller.s("graphing-calculator-label-image-opacity")),ft.createElement(uy,{name:this.const("opacity"),controller:()=>this.controller,model:()=>this.model,focusedInput:this.bindFn(this.getFocusedInput),readonly:this.bindFn(this.isReadonly)})))})),ft.createElement("span",{class:ft.const("dcg-fadeout")}),ft.createElement(zd,{controller:this.props.controller,model:this.props.model}),ft.createElement(YS,{predicate:this.bindFn(this.shouldShowBrailleError)},()=>ft.createElement("div",{class:this.getFooterClass()},ft.createElement("div",{tabIndex:ft.const(0),class:ft.const("dcg-expression-braille-error"),"aria-roledescription":ft.const("error"),"aria-label":()=>this.controller.unpack(this.model.error)},ft.createElement("i",{class:ft.const("dcg-icon-error"),"aria-hidden":ft.const("true")}),()=>this.controller.unpack(this.model.error)))),ft.createElement(YS,{predicate:()=>oT(this.model).length>0&&this.controller.areSlidersEnabled()},()=>ft.createElement("div",{class:this.getFooterClass()},ft.createElement(Ip,{model:this.props.model,controller:this.props.controller}))),ft.createElement(YS,{predicate:this.bindFn(this.shouldShowActionInfo)},()=>ft.createElement("div",{class:this.getFooterClass()},ft.createElement(ny,{model:this.props.model,controller:this.props.controller})))),ft.createElement("span",{class:ft.const("dcg-tab dcg-action-drag dcg-action-icon-touch"),handleEvent:ft.const("true"),tapboundary:ft.const("true"),disablescroll:ft.const("true"),onTapStart:this.bindFn(this.onDragPending)},ft.createElement("span",{class:ft.const("dcg-num")},()=>this.model.displayIndex),ft.createElement("div",{class:ft.const("dcg-tab-interior dcg-action-icon-mouse")},ft.createElement(py,{model:this.props.model,controller:this.props.controller}))),ft.createElement(qd,{controller:this.props.controller,id:()=>this.model.id}))}isReadonly(){return this.controller.isItemReadonly(this.id)}shouldShowActionInfo(){return!!(this.model.clickableInfo&&this.model.clickableInfo.enabled&&this.model.clickableInfo.latex)}getFooterClass(){return this.isFirstRender()?this.const("dcg-expression-bottom dcg-indent-in-folder"):this.const("dcg-expression-bottom dcg-fadein-bottom dcg-indent-in-folder")}onNameInput(e){this.controller.dispatch({type:"set-image-name",id:this.id,name:e})}onNameFocusChange(e){e?this.controller.dispatch({type:"set-focus-location",location:{type:"image",id:this.id,location:"name"}}):this.getFocusedInput()==="name"&&this.controller.dispatch({type:"blur-focus-location",location:{type:"image",id:this.id,location:"name"}})}onNameSpecialKey(e){return this.controller.dispatch({type:"on-special-key-pressed",key:e})}getFocusedInput(){let e=this.controller.getFocusLocation();if(e&&e.type==="image"&&e.id===this.model.id)return e.location}onRetryLoad(){this.controller.dispatch({type:"image-retry-loading",id:this.id})}shouldShowBrailleError(){return this.controller.getBrailleMode()!=="none"&&!!this.model.error}insertFiles(e){this.controller.dispatch({type:"change-image",files:e,id:this.id})}onMouseSelect(e){e.type==="dcg-tap"&&e.device==="mouse"||e.type==="dcg-tapstart"&&e.device==="touch"||e.wasHandled()||(e.handle(),this.controller.dispatch({type:"set-selected-id",id:this.id,state:"selected"}))}};var wl=__dcg_shared_module_exports__['e'](Z()),JS=class extends wl.Class{template(){return this.controller=this.props.controller(),wl.createElement("div",{class:wl.const("dcg-expressionitem dcg-new-expression dcg-opened")},wl.createElement("div",{class:wl.const("dcg-new-math-div dcg-do-not-blur dcg-action-newmath"),onTap:this.bindFn(this.newMath)},wl.createElement("div",{class:wl.const("dcg-new-expression-fade")})),wl.createElement("span",{class:wl.const("dcg-tab")},wl.createElement("span",{class:wl.const("dcg-num dcg-variable-index")},this.bindFn(this.getIndex)),wl.createElement("div",{class:wl.const("dcg-tab-interior")})))}getIndex(){return this.controller.getNextDisplayIndex()}newMath(){this.controller.dispatch({type:"new-expression-at-end"})}};var fo=__dcg_shared_module_exports__['e'](Z()),QS=class extends fo.Class{init(){this.controller=this.props.controller()}template(){return fo.createElement("section",{class:fo.const("dcg-progress-update-legend")},fo.createElement("h2",{class:fo.const("dcg-sr-only")},fo.const("Progress Update Legend")),fo.createElement("button",{onTap:()=>this.hideLegend(),class:fo.const("dcg-hide-progress")},fo.const("Hide Legend")),fo.createElement("ul",{class:fo.const("dcg-unstyled-list")},fo.createElement("li",{class:fo.const("dcg-legend-section")},fo.createElement("span",{class:fo.const("dcg-progress-unpublished dcg-progress-swatch"),"aria-label":fo.const("light yellow swatch"),role:fo.const("img")}),fo.createElement("span",null,fo.const("unpublished"))),fo.createElement("li",{class:fo.const("dcg-legend-section")},fo.createElement("span",{class:fo.const("dcg-progress-analyzing dcg-progress-swatch"),"aria-label":fo.const("light blue swatch"),role:fo.const("img")}),fo.createElement("span",null,fo.const("analyzing"))),fo.createElement("li",{class:fo.const("dcg-legend-section")},fo.createElement("span",{class:fo.const("dcg-progress-graphing dcg-progress-swatch"),"aria-label":fo.const("light red swatch"),role:fo.const("img")}),fo.createElement("span",null,fo.const("computing plot")))))}hideLegend(){this.controller.dispatch({type:"hide-progress-update-legend"})}};var ZS=__dcg_shared_module_exports__['e'](Z());var eE=class extends Xl{didMountRoot(e){this.onItemViewMounted(e)}willUnmount(){this.onItemViewUnmounted()}template(){let e="";return this.model.cachedRenderHeight&&(e="height:"+this.model.cachedRenderHeight+"px"),ZS.createElement("div",{class:ZS.const("dcg-do-not-blur dcg-expressionitem dcg-shell"),"expr-id":this.const(this.model.id),onTap:this.bindFn(this.onMouseSelect),style:ZS.const(e),didMount:this.bindFn(this.didMountRoot)})}};var Hi=__dcg_shared_module_exports__['e'](Z());var qa=__dcg_shared_module_exports__['e'](Z());var BV=[.05,.1,.15,.2,.35,.5,.75,1,1.5,2,3.5,5,7.5,10,15,20],fbe=__dcg_shared_module_exports__['s'](BV),bbe=__dcg_shared_module_exports__['r'](BV),tE=class extends qa.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return qa.createElement("div",{class:qa.const("dcg-slider-speed-container dcg-do-not-blur"),handleEvent:qa.const("true")},qa.createElement("span",{class:()=>({"dcg-action-slower":!0,"dcg-disabled":this.isSlowerDisabled()}),onTap:()=>this.animateSlower(),role:qa.const("button"),"aria-label":()=>this.getSlowerAriaLabel(),tabIndex:()=>this.isSlowerDisabled()?-1:0,"aria-disabled":()=>this.isSlowerDisabled()},qa.createElement("i",{class:qa.const("dcg-icon-show"),"aria-hidden":qa.const("true")})),qa.createElement("span",{class:qa.const("dcg-variable-speed")},this.bindFn(this.computeSpeed),qa.const("x")),qa.createElement("span",{class:()=>({"dcg-action-faster":!0,"dcg-disabled":this.isFasterDisabled()}),onTap:()=>this.animateFaster(),role:qa.const("button"),"aria-label":()=>this.getFasterAriaLabel(),tabIndex:()=>this.isFasterDisabled()?-1:0,"aria-disabled":()=>this.isFasterDisabled()},qa.createElement("i",{class:qa.const("dcg-icon-show"),"aria-hidden":qa.const("true")})))}computeSpeed(){let e=__dcg_shared_module_exports__['yb']/this.model.slider.animationPeriod;return e=Number(e.toFixed(3)),e}isSlowerDisabled(){return fbe>=this.computeSpeed()}isFasterDisabled(){return bbe<=this.computeSpeed()}animateSlower(){let e=this.computeSpeed(),t=__dcg_shared_module_exports__['m'](BV,o=>o<e);t.length!==0&&this.setPeriodFromSpeed(__dcg_shared_module_exports__['r'](t))}animateFaster(){let e=this.computeSpeed(),t=__dcg_shared_module_exports__['m'](BV,o=>o>e);t.length!==0&&this.setPeriodFromSpeed(__dcg_shared_module_exports__['s'](t))}setPeriodFromSpeed(e){let t=__dcg_shared_module_exports__['yb']/e;this.controller.dispatch({type:"set-slider-animationperiod",id:this.model.id,animationPeriod:t}),Te(this.controller.s("graphing-calculator-narration-slider-animating-at-speed",{speed:e+""}))}getSlowerAriaLabel(){return this.controller.s("graphing-calculator-narration-slider-animate-slower")}getFasterAriaLabel(){return this.controller.s("graphing-calculator-narration-slider-animate-faster")}};var UV=class extends Hi.Class{init(){var e;this.controller=this.props.controller(),this.model=this.props.model(),this.guid=(e=this.controller.getOpenItemMenu())==null?void 0:e.guid}didMount(){gg(this.guid,this.controller)}willUnmount(){mg(this.guid,this.controller)}didMountArrow(e){this.arrowElt=e,Lc(this.arrowElt,this.controller)}didUpdate(){Lc(this.arrowElt,this.controller)}template(){let e=this.model;return Hi.createElement("div",{class:Hi.const("dcg-slider-options-view dcg-options-menu")},Hi.createElement("div",{class:Hi.const("dcg-triangle"),didMount:this.bindFn(this.didMountArrow),didUnmount:()=>this.arrowElt=void 0}),Hi.createElement("div",{class:Hi.const("dcg-slider-menu")},Hi.createElement("div",{role:Hi.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-heading-slider-animation-mode")},Hi.createElement("div",{role:Hi.const("heading"),"aria-level":Hi.const("2"),class:Hi.const("dcg-title")},()=>this.controller.s("graphing-calculator-heading-slider-animation-mode")),Hi.createElement(Po,{ariaGroupLabel:()=>this.controller.s("graphing-calculator-heading-slider-animation-mode"),staticConfig:this.bindFn(this.getAnimationOptions),theme:this.const("mini")}))),Hi.createElement("div",{class:Hi.const("dcg-slider-menu dcg-slider-speed-menu"),role:Hi.const("group"),"aria-label":()=>this.controller.s("graphing-calculator-heading-slider-speed")},Hi.createElement("div",{role:Hi.const("heading"),"aria-level":Hi.const("2"),class:Hi.const("dcg-title")},()=>this.controller.s("graphing-calculator-heading-slider-speed")),Hi.createElement("div",{class:Hi.const("dcg-slider-speed-container")},Hi.createElement(tE,{model:()=>e,controller:this.props.controller}))))}getAnimationOptions(){let e=this.model;return["LOOP_FORWARD_REVERSE","LOOP_FORWARD","PLAY_ONCE","PLAY_INDEFINITELY"].map(o=>({key:o,icon:()=>__dcg_shared_module_exports__['pb'](o),tooltip:()=>this.getTooltip(o),tooltipGravity:this.const("s"),selected:()=>this.isSelected(o),onSelect:()=>{this.controller.dispatch({type:"set-slider-loopmode",id:e.id,loopMode:o})}}))}getTooltip(e){let t=this.controller.s;switch(e){case"LOOP_FORWARD_REVERSE":return t("graphing-calculator-narration-slider-loop-forwards-and-backwards");case"LOOP_FORWARD":return t("graphing-calculator-narration-slider-repeat-one-direction");case"PLAY_ONCE":return t("graphing-calculator-narration-slider-play-once");case"PLAY_INDEFINITELY":return t("graphing-calculator-narration-slider-play-indefinitely")}}isSelected(e){return this.model.slider.loopMode===e}};var Lr=__dcg_shared_module_exports__['e'](Z());function AZ(r){let e=[],t=r.getAllItemModels();for(let o of t){let i=r.getItemRootNodeById(o.id);i&&e.push(i)}return e}function ybe(r){let e=r.getAllItemModels();for(let t=e.length-1;t>=0;t--){let o=e[t];if(o.rootViewNode)return o.id}}function VZ(r,e){let t=AZ(r),o=0,i=t.length-1;for(;o<=i;){let n=o+Math.floor((i-o)/2),a=t[n],s=a.getBoundingClientRect();if(s.top>e)i=n-1;else if(s.bottom<e)o=n+1;else return a}}function xbe(r,e){let t=AZ(r),o=0,i=t.length-1,n;for(;o<=i;){let a=o+Math.floor((i-o)/2),s=t[a];s.getBoundingClientRect().top>e?(i=a-1,n=s):o=a+1}return n}function LZ(r,e){let t=hy(r);if(!t)return;if(e){let i=r.getItemRootNodeById(e);if(i){let n=i.getBoundingClientRect();if(n.height>0&&n.top<=t.top&&n.bottom>=t.top)return e}}let o=VZ(r,t.top);return o?o.getAttribute("expr-id"):LB(r)}function PZ(r,e){let t=hy(r);if(!t)return;let o=ybe(r);if(!o)return;if(e){let n=r.getItemRootNodeById(e);if(n){let a=n.getBoundingClientRect();if(a.height>0&&a.top<=t.bottom&&a.bottom>=t.bottom||e===o&&a.bottom<=t.bottom)return e}}let i=VZ(r,t.bottom);return i&&i.getAttribute("expr-id")||o}function LB(r){let e=hy(r);if(!e)return;let t=xbe(r,e.top-2);if(t)return t.getAttribute("expr-id")}function rE(r){return r.findEl(".dcg-exppanel")}function hy(r){let e=rE(r);if(e)return e.getBoundingClientRect()}function OZ(r){let e=r.findEl(".dcg-exppanel-container");if(!e)return;let t=e.getBoundingClientRect(),o=e.scrollTop;return t.top-o}function RZ(r){let e=r.findEl(".dcg-expressionlist");if(!e)return;let t=e.getBoundingClientRect();return{width:t.width,height:t.height}}function FZ(r){let e=rE(r);if(!e)return;let t=e.querySelector(".dcg-drag-container > *");if(!t)return;let o=t.getBoundingClientRect();return{width:o.width,height:o.height}}$t();var tc=__dcg_shared_module_exports__['e'](Z());var{If:wbe}=tc.Components,qV=class extends tc.Class{init(){this.controller=this.props.controller(),this.model=this.props.model()}template(){return tc.createElement(wbe,{predicate:()=>this.controller.shouldShowRegressionButton(this.model)},()=>tc.createElement("div",{class:tc.const("dcg-add-regression-view dcg-do-blur"),handleEvent:tc.const(!0)},tc.createElement(ze,{tooltip:this.bindFn(this.getTooltipText),gravity:()=>"e"},tc.createElement("i",{onTap:()=>{this.controller.dispatch({type:"create-table-regression",tableId:this.model.id,regressionType:"linear"})},role:tc.const("button"),tabIndex:tc.const("0"),"aria-label":this.bindFn(this.getTooltipText),class:tc.const("dcg-icon-points"),manageFocus:this.const(ct({controller:this.controller,location:{type:"add-table-regression-btn",id:this.model.id}}))}))))}getTooltipText(){return this.controller.s("graphing-calculator-button-add-table-regression")}};var gt=__dcg_shared_module_exports__['e'](Z());var ta=__dcg_shared_module_exports__['e'](Z());$t();var vbe='a, input, button:not([disabled]), textarea, select [role="textbox"], [tabIndex="0"], [role="option"], [role="button"], [role="link"], summary',hf=class{constructor({isOpen:e,closeMenu:t,anchorSelector:o,popoverSelector:i,itemNavigationKey:n}){this.handleKeydown=e=>{switch(this.itemNavigationKey){case"arrow":return this.onKeydownWithArrowTrapping(e);case"tab":return this.onKeydownWithTabTrapping(e)}};this.handleTap=e=>{let t=document.querySelector(this.popoverSelector);if(!t)return;let{target:o}=e,i=this.anchorSelector;i&&o.closest(i)||t.contains(o)||Array.from(document.querySelectorAll(".dcg-keypad,.dcg-show-keypad-container")).some(a=>a.contains(o))||this.closeMenu()};this.isOpen=e,this.closeMenu=t,this.anchorSelector=o,this.popoverSelector=i,this.itemNavigationKey=n}getFocusableItems(){let e=document.querySelector(this.popoverSelector);return e?Array.from(e.querySelectorAll(vbe)).filter(o=>o.getAttribute("tabIndex")!=="-1").filter(o=>cp(o)):[]}focusAnchor(){var e;(e=document.querySelector(this.anchorSelector))==null||e.focus()}focusItemAtIdx(e){let t=this.getFocusableItems();return t.length&&t.length>e?(t[e].focus(),!0):!1}focusFirstItem(){this.focusItemAtIdx(0)}focusLastItem(){this.focusItemAtIdx(this.getFocusableItems().length-1)}getFocusedElement(){return this.getFocusableItems().find(e=>e.matches(":focus"))}moveFocusInDirection(e){let t=this.getFocusableItems(),o=t.findIndex(a=>a.matches(":focus"));if(o===-1)return!1;let i=o+e;if(i==-1||i==t.length)return!0;let n=t[i];return n?(n.focus(),!0):!1}isAnchorFocused(){var e;return(e=document.querySelector(this.anchorSelector))==null?void 0:e.matches(":focus")}isFirstItemFocused(){var t;let e=this.getFocusableItems();return e.length>0&&((t=e[0])==null?void 0:t.matches(":focus"))}isLastItemFocused(){var t;let e=this.getFocusableItems();return e.length>0&&((t=e[e.length-1])==null?void 0:t.matches(":focus"))}onKeydownWithArrowTrapping(e){if(this.isOpen())switch(Be(e)){case Ia:this.moveFocusInDirection(-1)&&e.preventDefault();break;case On:this.moveFocusInDirection(1)&&e.preventDefault();break;case lp:e.preventDefault(),this.focusLastItem();break;case _l:e.preventDefault(),this.closeMenu();break;case Pn:e.preventDefault(),e.stopPropagation(),this.closeMenu(),this.focusAnchor();break}}onKeydownWithTabTrapping(e){if(!this.isOpen())return;let t=Be(e);if(t===Pn){e.preventDefault(),e.stopPropagation(),this.focusAnchor(),this.closeMenu();return}if(t==="Tab"&&!e.altKey&&!e.ctrlKey&&!e.metaKey){if(this.isAnchorFocused()){e.shiftKey?this.focusLastItem():this.focusFirstItem(),e.preventDefault(),e.stopPropagation();return}if(this.isLastItemFocused()&&!e.shiftKey){this.focusAnchor(),e.preventDefault(),e.stopPropagation();return}if(this.isFirstItemFocused()&&e.shiftKey){this.focusAnchor(),e.preventDefault(),e.stopPropagation();return}}}};var{IfDefined:Cbe,If:Sbe}=ta.Components,Ebe=-7,zV=9,oE=class extends ta.Class{didMountPopover(e){var o,i,n,a;(i=(o=this.props).didMount)==null||i.call(o,e);let t=(a=(n=this.props).focusHelper)==null?void 0:a.call(n);t&&(document.addEventListener("keydown",t.handleKeydown),t.focusFirstItem())}didUnmountPopover(){var t,o;let e=(o=(t=this.props).focusHelper)==null?void 0:o.call(t);e&&document.removeEventListener("keydown",e.handleKeydown)}isVisible(){return this.props.visible?this.props.visible():!0}getPositionClasses(){let e=this.props.position();return{"dcg-left":e==="left","dcg-right":e==="right","dcg-bottom":e==="bottom-left"||e==="bottom-right","dcg-top":e==="top-left"||e==="top-right"}}template(){return ta.createElement("div",{class:()=>{var e,t,o,i,n,a;return{"dcg-dropdown-popover":!0,"dcg-dropdown-popover--with-arrow":!((t=(e=this.props).hideArrow)!=null&&t.call(e)),"dcg-dropdown-popover--constrain-height":(i=(o=this.props).constrainHeight)==null?void 0:i.call(o),...this.getPositionClasses(),[((a=(n=this.props).className)==null?void 0:a.call(n))||""]:!!this.props.className}},role:ta.const("region"),style:()=>{var e,t;return{display:this.isVisible()?void 0:"none",...((t=(e=this.props).style)==null?void 0:t.call(e))||{}}},didMount:this.bindFn(this.didMountPopover),didUnmount:this.bindFn(this.didUnmountPopover)},ta.createElement("div",{class:ta.const("dcg-dropdown-popover__interior")},Cbe(()=>{var e,t;return(t=(e=this.props).title)==null?void 0:t.call(e)},e=>ta.createElement("h2",{class:ta.const("dcg-unstyled-heading dcg-dropdown-popover__title")},()=>e())),this.props.children),ta.createElement(Sbe,{predicate:()=>{var e,t;return!((t=(e=this.props).hideArrow)!=null&&t.call(e))}},()=>ta.createElement("div",{class:ta.const("dcg-arrow"),style:()=>{var e,t;return((t=(e=this.props).arrowStyle)==null?void 0:t.call(e))||{}}})))}},iE=class extends ta.Class{constructor(){super(...arguments),this.showDropdown=!1,this.guid=this.props.guid(),this.dropdownStyle={},this.arrowStyle=void 0,this.debouncedPositionDynamically=__dcg_shared_module_exports__['F'](this.bindFn(this.positionDynamically),200)}init(){var t,o;let e=(o=(t=this.props).manageFocus)==null?void 0:o.call(t);e&&(this.focusHelper=new hf({anchorSelector:`.dcg-popover-with-anchor__anchor--${this.guid}`,popoverSelector:`.dcg-popover-with-anchor__popover--${this.guid}`,isOpen:()=>this.isDropdownOpen(),closeMenu:()=>this.setDropdownOpen(!1),itemNavigationKey:e.itemNavigationKey}))}isDropdownOpen(){return this.props.controlled?this.props.controlled().isOpen:this.showDropdown}setDropdownOpen(e){var t,o,i;(o=(t=this.props).disabled)!=null&&o.call(t)||(this.props.controlled?this.props.controlled().setDropdownOpen(e):(this.showDropdown=e,this.update()),e&&(this.resetPosition(),this.positionDynamically(),(i=this.focusHelper)==null||i.focusFirstItem()))}didMountWrapper(e){var o,i;this.rootNode=e,window.addEventListener("resize",this.debouncedPositionDynamically);let t=(i=(o=this.props).boundingParentElement)==null?void 0:i.call(o);t&&(this.resizeObserver=new ResizeObserver(this.debouncedPositionDynamically),this.resizeObserver.observe(t)),re(document.body).on(`dcg-tapstart.${this.guid}`,n=>{if(!(n.target===e||re.contains(e,n.target))&&this.isDropdownOpen()){let a=e.querySelector(".dcg-popover-with-anchor__popover");if(re.contains(a,n.target))return;let s=a.getBoundingClientRect();if(n.clientX!==void 0&&n.clientY!==void 0&&n.clientX>s.left&&n.clientX<s.right&&n.clientY>s.top&&n.clientY<s.bottom)return;this.setDropdownOpen(!1);return}})}didUnmountWrapper(){this.showDropdown=!1,re(document.body).off(`.${this.guid}`),re(document).off(`.${this.guid}`),window.removeEventListener("resize",this.debouncedPositionDynamically),this.resizeObserver&&this.resizeObserver.disconnect()}didMountDropdown(e){var o,i,n;this.dropdownNode=e,((o=this.rootNode)==null?void 0:o.querySelector(".dcg-arrow"))&&(this.arrowStyle={}),this.resetPosition(),this.positionDynamically(),(n=(i=this.props.dropdownProps()).didMount)==null||n.call(i,e)}getDropdownOffset(){var e,t;return((t=(e=this.props).dropdownOffset)==null?void 0:t.call(e))||Ebe}resetPosition(){var i;let e=this.props.dropdownProps().position();this.dropdownStyle={},((i=this.rootNode)==null?void 0:i.querySelector(".dcg-arrow"))?this.arrowStyle={}:this.arrowStyle=void 0;let o=this.getDropdownOffset();switch(e){case"left":case"right":this.dropdownStyle.top=`${o}px`,this.arrowStyle&&(this.arrowStyle.top=`${zV}px`);break;case"top-right":case"bottom-right":this.dropdownStyle.left=`${o}px`,this.arrowStyle&&(this.arrowStyle.left=`${zV}px`);break;case"top-left":case"bottom-left":this.dropdownStyle.right=`${o}px`,this.arrowStyle&&(this.arrowStyle.right=`${zV}px`);break}this.update()}positionDynamically(){var y,w,S,C;let e=this.dropdownNode,t=this.rootNode;if(!t||!e||!this.isDropdownOpen())return;let o=e.getBoundingClientRect(),i=(S=(w=(y=this.props).boundingParentElement)==null?void 0:w.call(y))==null?void 0:S.getBoundingClientRect(),n=i?i.x+i.width:window.innerWidth,a=i?i.y+i.height:window.innerHeight,s=(C=i==null?void 0:i.left)!=null?C:0,l=o.bottom>a,c=o.right>n,d=o.left<s,p=this.props.dropdownProps().position(),u=t.getBoundingClientRect(),h=15,m=zV+this.getDropdownOffset();if((p==="left"||p==="right")&&l){let v=a-u.y-h,E=o.height-v;this.dropdownStyle.top=`${-1*E}px`,this.arrowStyle&&(this.arrowStyle.top=`${E+m}px`)}else if((p==="bottom-right"||p==="top-right")&&c){let v=n-u.x-h,E=o.width-v;this.dropdownStyle.left=`${-1*E}px`,this.arrowStyle&&(this.arrowStyle.left=`${E+m}px`)}else if((p==="bottom-left"||p==="top-left")&&d){let v=u.x+u.width-h-s,E=o.width-v;this.dropdownStyle.right=`${-1*E}px`,this.arrowStyle&&(this.arrowStyle.right=`${E+m}px`)}this.update()}getDropdownClassNames(){var t,o;let e=((o=(t=this.props.dropdownProps()).className)==null?void 0:o.call(t))||"";return`dcg-popover-with-anchor__popover dcg-popover-with-anchor__popover--${this.guid} ${e}`}template(){return ta.createElement("div",{class:()=>{var e,t;return{"dcg-popover-with-anchor":!0,[((t=(e=this.props).containerClassName)==null?void 0:t.call(e))||""]:!!this.props.containerClassName}},didMount:this.bindFn(this.didMountWrapper),didUnmount:this.bindFn(this.didUnmountWrapper)},ta.createElement("div",{role:ta.const("link"),tabIndex:ta.const(0),"aria-label":()=>{var e,t;return(t=(e=this.props).anchorAriaLabel)==null?void 0:t.call(e)},"aria-expanded":this.bindFn(this.isDropdownOpen),"aria-haspopup":ta.const("true"),class:()=>({"dcg-popover-with-anchor__anchor":!0,[`dcg-popover-with-anchor__anchor--${this.guid}`]:!0,"dcg-popover-with-anchor__open":this.isDropdownOpen()}),onTap:()=>{this.setDropdownOpen(!this.isDropdownOpen())}},this.props.anchor()),ta.createElement(oE,{...this.props.dropdownProps(),className:this.bindFn(this.getDropdownClassNames),visible:this.bindFn(this.isDropdownOpen),focusHelper:()=>this.focusHelper,didMount:e=>this.didMountDropdown(e),arrowStyle:()=>this.arrowStyle,style:()=>this.dropdownStyle},this.props.children))}};var Gs=__dcg_shared_module_exports__['e'](Z());$t();var Hr=__dcg_shared_module_exports__['e'](Z());var{For:NZ,If:HV,IfDefined:Dbe,Switch:kbe}=Hr.Components,l1=class extends Hr.Class{template(){var e,t;return Hr.createElement("div",{role:Hr.const("list"),class:()=>{var o,i;return{"dcg-shared-options-dropdown":!0,[((i=(o=this.props).class)==null?void 0:i.call(o))||""]:!!this.props.class}}},Hr.createElement(NZ,{each:this.props.options,key:o=>`${o.key?o.key:o.title()}${o.disabled?"-disabled":""}`},o=>Hr.createElement("div",{role:Hr.const("listitem"),class:Hr.const("dropdown-option-container")},Hr.createElement(kbe,{key:()=>o},i=>"href"in i?Hr.createElement("a",{"aria-disabled":()=>i.disabled,"aria-selected":()=>{var n;return(n=i.selected)==null?void 0:n.call(i)},id:this.const(i.key),tabIndex:()=>this.getTabIndex(i),class:()=>{var n;return{[i.class||""]:!!i.class,"dcg-standard-link-styling":!i.class,"dcg-dropdown-choice":!0,"dcg-disabled":i.disabled,"dcg-selected":(n=i.selected)==null?void 0:n.call(i)}},onTap:()=>!i.disabled&&this.props.onTap(i),href:()=>i.href,target:()=>i.target!==void 0?i.target:"",rel:()=>i.noreferrer?"noreferrer noopener":""},Hr.createElement(HV,{predicate:()=>i.icon!=null},()=>Hr.createElement("div",{class:Hr.const("dcg-option-icon-container")},Hr.createElement("i",{"aria-hidden":Hr.const("true"),class:()=>`${i.icon} dcg-option-icon`}))),Hr.createElement(Bl,{content:i.title,mqConfig:this.const({})})):Hr.createElement("div",{role:Hr.const("link"),tabIndex:()=>this.getTabIndex(i),"aria-disabled":()=>i.disabled,"aria-selected":()=>{var n;return(n=i.selected)==null?void 0:n.call(i)},id:this.const(i.key),class:()=>{var n;return{[i.class||""]:!!i.class,"dcg-standard-link-styling":!i.class,"dcg-dropdown-choice":!0,"dcg-disabled":i.disabled,"dcg-selected":(n=i.selected)==null?void 0:n.call(i)}},onTap:()=>!i.disabled&&this.props.onTap(i)},Hr.createElement(HV,{predicate:()=>i.icon!=null},()=>Hr.createElement("div",{class:Hr.const("dcg-option-icon-container")},Hr.createElement("i",{"aria-hidden":Hr.const("true"),class:()=>`${i.icon} dcg-option-icon`}))),Hr.createElement("span",{class:Hr.const("option-title")},Hr.createElement(Bl,{content:i.title,mqConfig:this.const({})})),Dbe(()=>i.subtitle&&i.subtitle(),n=>Hr.createElement("span",{class:Hr.const("dcg-option-subtitle")},n)))),Hr.createElement(HV,{predicate:()=>!!o.explanations},()=>Hr.createElement("div",{class:Hr.const("dcg-dropdown-explanations")},Hr.createElement(NZ,{each:()=>o.explanations||[],key:i=>i.flag},i=>Hr.createElement("div",{class:Hr.const("dcg-explanation")},()=>i.explanation,Hr.const(" "),Hr.createElement(HV,{predicate:()=>!!i.link},()=>Hr.createElement("a",{class:Hr.const("learn-more"),href:()=>i.link!==void 0?i.link:"",target:Hr.const("_blank")},()=>i.linkText?i.linkText:fa("shared-button-learn-more-capitalized"))))))))),(t=(e=this.props).buildFooter)==null?void 0:t.call(e))}getTabIndex(e){var t;return e.disabled&&!((t=e.selected)!=null&&t.call(e))?-1:0}};var{If:_be,IfElse:Tbe}=Gs.Components,gf=class extends Gs.Class{init(){var e,t;this.i18n=this.props.controller(),this.filter=(t=(e=this.props).defaultValue)==null?void 0:t.call(e),this.shouldShowResults=!1,this.uuid=Ld(),this.focusHelper=new hf({anchorSelector:`#dcg-select-dropdown-container-${this.props.id()} .dcg-dropdown-input`,popoverSelector:`#dcg-select-dropdown-container-${this.props.id()} .dcg-select-dropdown-list`,isOpen:()=>this.isOpen(),closeMenu:()=>this.setResultsOpen(!1),itemNavigationKey:"arrow"})}handleKeyDown(e){var t;switch(Be(e)){case On:if(!this.isOpen()){this.setResultsOpen(!0),e.preventDefault();return}break;case _l:if(this.isOpen()){let o=this.focusHelper.getFocusedElement();o&&(this.selectOptionById((t=o.getAttribute("id"))!=null?t:void 0),e.preventDefault());return}break}this.focusHelper.handleKeydown(e)}template(){return Gs.createElement("div",{class:Gs.const("dcg-select-dropdown-container"),onKeyDown:this.bindFn(this.handleKeyDown),didMount:this.bindFn(this.attachTapListener),didUnmount:this.bindFn(this.unmountTapListener),id:()=>`dcg-select-dropdown-container-${this.props.id()}`},Gs.createElement("button",{class:()=>({"dcg-dropdown-input":!0,"dcg-results-hidden":!this.isOpen()}),"aria-haspopup":this.const("listbox"),"aria-expanded":()=>this.isOpen(),onTap:this.bindFn(this.toggleResultsOpen),didMount:e=>{var t,o;(o=(t=this.props).focusOnMount)!=null&&o.call(t)&&e.focus()},id:this.props.id,manageFocus:()=>{var e,t;return(t=(e=this.props).manageFocus)==null?void 0:t.call(e)}},Gs.createElement(Bl,{content:this.bindFn(this.getFilterString),mqConfig:this.const({})}),Tbe(()=>this.isOpen(),{true:()=>Gs.createElement("i",{class:Gs.const("dcg-icon-caret-up dcg-open-options"),"aria-label":()=>this.i18n.s("shared-calculator-button-hide-options")}),false:()=>Gs.createElement("i",{class:Gs.const("dcg-icon-caret-down dcg-open-options"),"aria-label":()=>this.i18n.s("shared-calculator-button-show-options")})})),Gs.createElement(_be,{predicate:()=>this.isOpen()},()=>Gs.createElement("div",{class:Gs.const("dcg-options-dropdown__padded-bottom-container")},Gs.createElement(l1,{options:()=>this.getOptions(),onTap:e=>this.selectOptionById(e.key),class:this.const("dcg-select-dropdown-list"),buildFooter:this.props.buildFooter}))))}getOptions(){return this.props.options().map(e=>({key:e.id,title:()=>e.label,selected:()=>e.label===this.getFilterString(),disabled:e.disabled,class:"dcg-select-dropdown-option"}))}isOpen(){return!!this.shouldShowResults}setResultsOpen(e){var t,o;if(this.shouldShowResults=e,this.update(),(o=(t=this.props).onOpenChange)==null||o.call(t,e),e)if(this.filter){let i=this.props.options().find(n=>n.id===this.filter);this.focusOption(i)}else if(this.props.externalControl){let i=this.props.externalControl().getValue(),n=this.props.options().find(a=>a.id===i);this.focusOption(n)}else this.focusHelper.focusFirstItem()}toggleResultsOpen(){this.setResultsOpen(!this.shouldShowResults)}focusOption(e){if(!e)return;let t=document.querySelector(`#dcg-select-dropdown-container-${this.props.id()} .dcg-select-dropdown-list #${e.id}`);t==null||t.focus()}onInputChange(e){this.props.externalControl?this.props.externalControl().onValueChange(e):this.filter=e,this.update()}getFilterString(){let t=this.props.options().find(o=>o.id===(this.props.externalControl?this.props.externalControl().getValue():this.filter));return(t==null?void 0:t.label)||""}selectOptionById(e){var i,n;let o=this.props.options().find(a=>a.id===e);o&&(this.onInputChange(o.id),this.setResultsOpen(!1),this.focusHelper.focusAnchor(),(n=(i=this.props).onChange)==null||n.call(i,o.id))}unmountTapListener(){re(document.body).off(`dcg-tapstart.dcg-select-dropdown-container-${this.uuid}`)}attachTapListener(){re(document.body).on(`dcg-tapstart.dcg-select-dropdown-container-${this.uuid}`,this.bindFn(this.tapListener))}tapListener(e){e.target.closest(`#dcg-select-dropdown-container-${this.props.id()}`)||this.setResultsOpen(!1)}};Xa();function BZ(r){switch(r){case void 0:case"IDLE":case"UNPUBLISHED":case"RESOLVED":return!1;case"ANALYZING":case"GRAPHING":return!0;default:throw new Error(`Unexpected progress status: ${r}`)}}var Oee=__dcg_shared_module_exports__['e'](Z());$t();var nE=class{constructor(e){this.active=!1,this.controller=e;let t=this.controller.getExppanelElt();t&&(this.exppanel=t)}startDragging(e){this.active=!0,this.mousePt=e,this.setupEventListeners()}applyDrag(){var v;let t=this.controller.getListModel().dragState;if(!t)return;this.scheduleUpdateScroll();let o=this.measureDOM(t);if(!o)return;let{floatingPreviewRect:i,dragState:n,visibleRects:a}=o,s=this.controller.getItemModel(n.firstItemId);if(!s)return;let l=s.index,c=a[0];if(c&&c.id!==s.id){let E=this.controller.getItemModel(c.id);E&&E.index>l&&(l=E.index-1)}let{cachedNamedAssignmentLatex:d,cachedTokenAssignmentLatex:p}=n;for(let{id:E,rect:_}of a){if(E===s.id)continue;let T=this.controller.getItemModel(E);if(!T)return;if(T.index<s.index){if(i.top<_.top+_.height/2){l=T.index;break}}else i.bottom>_.top+_.height/2&&(l=T.index,T.type==="folder"&&T.collapsed&&(l+=this.controller.getNumberOfItemsInFolder(T.id)))}let u,h;l>s.index?(u=l,h=l+1):l<s.index?(u=l-1,h=l):(u=l-1,h=l+1);let m=this.controller.getItemModelByIndex(u),y=this.controller.getItemModelByIndex(h),w="",S="";m&&(m.type==="folder"?w=m.id:w=m.folderId),y&&(y.type==="folder"?S=y.id:S=y.folderId);let C="";if(w&&(S===w?s.type==="folder"?l=s.index:C=w:s.type!=="folder"&&this.isPreviewTopContainedInFolder(o,w)&&(C=w)),s.type==="expression")if(n.renderType==="token"){if(t.renderType==="expression"&&(d=s.latex,this.controller.convertToTokenAssignment(s,p)),n.dragTarget.type==="token")l=n.dragTarget.originalIndex,C=((v=this.controller.getGeometryFolder())==null?void 0:v.id)||"";else if(n.dragTarget.type==="expression"){let E=this.controller.getGeometryFolder();if(E){let _=this.controller.getNumberOfItemsInFolder(E.id);s.type==="expression"&&s.folderId===E.id&&(_-=1),l=E.index+_+1,C=E.id}}}else n.renderType==="expression"&&t.renderType==="token"&&(p=s.latex,this.controller.convertToNamedAssignment(s,d));return{dragState:{...n,cachedNamedAssignmentLatex:d,cachedTokenAssignmentLatex:p},newIndex:l,folderId:C}}measureDOM(e){var I;let t={x:((I=hy(this.controller))==null?void 0:I.left)||0,y:OZ(this.controller)},o=RZ(this.controller),i=FZ(this.controller);if(t.y===void 0||!o||!i)return;let n=o.height,a=i.height,s=!1,l=this.controller.getExppanelElt(),c=l==null?void 0:l.querySelector(".dcg-template-expressioneach"),d=c==null?void 0:c.getBoundingClientRect();d&&d.top<=e.mousePt.y&&(s=!0);let p=!1,u=l==null?void 0:l.querySelector(".dcg-geo-show-constructions-pane"),h=u==null?void 0:u.getBoundingClientRect();h&&h.bottom>e.mousePt.y&&(p=!0);let m=!1;(e.dragTarget.type==="token"&&!s||e.dragTarget.type==="expression"&&p&&!s&&this.controller.canDraggedItemBeMovedIntoTokenPane())&&(m=!0);let y=e.grabOffset;m?y={x:i.width/2+2.5,y:i.height/2}:e.dragTarget.type==="token"&&(y={x:0,y:i.height/2});let w=e.mousePt.y-y.y,S=__dcg_shared_module_exports__['wc'](w-t.y,-a/2,n-a),C=0;m&&(C=__dcg_shared_module_exports__['wc'](e.mousePt.x-y.x-t.x,0,o.width-i.width-4),S=Math.max(S,2));let v={left:C,top:w,bottom:w+a,height:a},E=this.controller.findFirstVisibleItem(),_=this.controller.findLastVisibleItem(),T=[];if(E&&_)for(let P=E.index;P<=_.index;P++){let O=this.controller.getItemModelByIndex(P);if(!O)continue;let W=this.controller.getItemRootNodeById(O.id);if(W&&O.id!==e.firstItemId){let X=W.getBoundingClientRect();T.push({id:O.id,rect:X})}}return{dragState:{...e,itemTop:S,itemLeft:C,renderType:m?"token":"expression"},floatingPreviewRect:v,visibleRects:T}}isPreviewTopContainedInFolder(e,t){let{visibleRects:o,floatingPreviewRect:i}=e;for(let{id:n,rect:a}of o)if(a.top<=i.top&&a.bottom>=i.top){let s=this.controller.getItemModel(n);if(!s)return!1;if(s.type==="folder"&&s.id===t||s.type!=="folder"&&s.folderId===t)return!0}return!1}scheduleUpdateScroll(){this.updateScrollScheduled||(this.updateScrollScheduled=!0,requestAnimationFrame(()=>{this.updateScroll(),this.updateScrollScheduled=!1}))}stop(){this.active=!1,this.tearDownEventListeners(),this.controller.dispatch({type:"stop-dragdrop"})}setupEventListeners(){re(document).on("dcg-tapmove.dragdrop",e=>{this.mousePt.x=e.changedTouches[0].clientX,this.mousePt.y=e.changedTouches[0].clientY,this.controller.dispatch({type:"update-dragdrop",mousePt:this.mousePt})}),re(document).on("dcg-tapend.dragdrop",e=>{this.stop(),e.handle("dragdrop")})}tearDownEventListeners(){re(document).off(".dragdrop")}updateScroll(){if(!this.active)return;let e=this.exppanel.getBoundingClientRect(),t=0;t=Math.min(t,this.mousePt.y-e.top),t=Math.max(t,this.mousePt.y-e.bottom+30),t=t*e.height/900,t&&(this.exppanel.scrollTop=this.exppanel.scrollTop+t)}};function UZ(r,e,t){let i=.5/(2*t*e);return ni(r-i,r+i)}function aE(r,e,t,o,i=0){let n=__dcg_shared_module_exports__['Nb'](r.x,r.y,0,t[0],t[1],0,o[0],o[1],0);i&&(n+=i);let s=.5/(__dcg_shared_module_exports__['yc'](t,o)*e);return ni(n-s,n+s)}function Op(r,e){for(let t of e)t&&(t.min!==void 0&&r<t.min?r=t.min:t.max!==void 0&&r>t.max&&(r=t.max));return r}function KV(r,e,t,o){if(!t)return 0;let i=r.mapx(1)-r.mapx(0);switch(t.valueType){case __dcg_shared_module_exports__['sa']:{let a=e.x-t.value[0][0],s=e.y-t.value[0][1],l=Math.atan2(s,a)/(2*Math.PI);l<0&&(l+=1),l=UZ(l,i,t.value[1]);let c=Op(0,[o]),d=Op(1,[o]);if(l>=c&&l<=d)return l;{let p=__dcg_shared_module_exports__['Ec'](t.value,c),u=__dcg_shared_module_exports__['Ec'](t.value,d),h=__dcg_shared_module_exports__['yc'](p,[e.x,e.y]),m=__dcg_shared_module_exports__['yc'](u,[e.x,e.y]);return h<=m?c:d}}case __dcg_shared_module_exports__['ua']:{let a=__dcg_shared_module_exports__['Hc'](t.value);if(!a)return 0;if(a.type==="segment"){let s=aE(e,i,a.start,a.end);return Op(s,[{min:0,max:1},o])}else if(a.type==="rays"){let s=__dcg_shared_module_exports__['yc'](a.start1,[e.x,e.y]),l=__dcg_shared_module_exports__['yc'](a.start2,[e.x,e.y]),c=!o||o.min===void 0?-1/0:o.min,d=!o||o.max===void 0?1/0:o.max;return s<l?c>0?d>=1?1:c:Op(-aE(e,i,a.start1,a.end1),[{min:void 0,max:0},o]):d<1?c<=0?0:d:Op(aE(e,i,a.start2,a.end2,1),[{min:1,max:void 0},o])}else if(a.type=="arc"){let[s,l]=a.center,{radius:c,startAngle:d}=a,p=__dcg_shared_module_exports__['Ac'](t.value),u=e.x-s,h=e.y-l,m=__dcg_shared_module_exports__['Ib'](Math.atan2(h,u),d,p);if(m>=0&&m<=1)m=UZ(m,i,c);else{let S=NI(e,{x:s+c*Math.cos(d),y:l+c*Math.sin(d)}),C=NI(e,{x:s+c*Math.cos(d+p),y:l+c*Math.sin(d+p)});S<=C?m=0:m=1}let y=Op(0,[o]),w=Op(1,[o]);if(m>=y&&m<=w)return m;{let S=__dcg_shared_module_exports__['Fc'](t.value,y),C=__dcg_shared_module_exports__['Fc'](t.value,w),v=__dcg_shared_module_exports__['yc'](S,[e.x,e.y]),E=__dcg_shared_module_exports__['yc'](C,[e.x,e.y]);return v<=E?y:w}}return Op(0,[o])}case __dcg_shared_module_exports__['ya']:case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['wa']:{let a=aE(e,i,t.value[0],t.value[1]);return Op(a,[{min:t.valueType===__dcg_shared_module_exports__['wa']?void 0:0,max:t.valueType!==__dcg_shared_module_exports__['qa']?void 0:1},o])}case __dcg_shared_module_exports__['oa']:{let a=t.value,s=1/0,l=Op(0,[o]),c=o&&o.min!==void 0?o.min:-1/0,d=o&&o.max!==void 0?o.max:1/0,p=Math.floor(Math.max(c,0)),u=Math.ceil(Math.min(d,a.length));for(let h=p;h<u;h++){let m=a[h],y=a[(h+1)%a.length],w=Op(aE(e,i,m,y,h),[{min:h,max:h+1},o]),S=__dcg_shared_module_exports__['Gc'](t.value,w),C=__dcg_shared_module_exports__['yc'](S,[e.x,e.y]);C<s&&(s=C,l=w)}return l}case __dcg_shared_module_exports__['da']:case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:case __dcg_shared_module_exports__['Ea']:case __dcg_shared_module_exports__['Ga']:return 0;default:return t}}function qZ(r,e){switch(r.valueType){case __dcg_shared_module_exports__['sa']:return __dcg_shared_module_exports__['Ec'](r.value,e);case __dcg_shared_module_exports__['ua']:return __dcg_shared_module_exports__['Fc'](r.value,e);case __dcg_shared_module_exports__['ya']:return __dcg_shared_module_exports__['Dc'](r.value,e);case __dcg_shared_module_exports__['qa']:return __dcg_shared_module_exports__['Cc'](r.value,e);case __dcg_shared_module_exports__['wa']:return __dcg_shared_module_exports__['Bc'](r.value,e);case __dcg_shared_module_exports__['oa']:return __dcg_shared_module_exports__['Gc'](r.value,e);case __dcg_shared_module_exports__['da']:case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:case __dcg_shared_module_exports__['Ea']:case __dcg_shared_module_exports__['Ga']:return[NaN,NaN];default:return r}}function Gbe(r,e){if(!e)return!1;let{left:t,right:o,top:i,bottom:n}=r.pixelCoordinates,{x:a,y:s}=e.mathPoint;if(e.transform){let l=e.model.formula.typed_constant_value;if((l==null?void 0:l.valueType)!==__dcg_shared_module_exports__['da'])throw new Error(`Expected movable point to be a Point but found ${l?__dcg_shared_module_exports__['$a'](l.valueType):void 0} instead`);a=a!=null?a:l.value[0],s=s!=null?s:l.value[1],[a,s]=__dcg_shared_module_exports__['Uc'](e.transform.forward,[a,s])}if(a!==void 0){let l=r.mathToPixels.mapX(a);if(l<t-.5||l>o+.5)return!1}if(s!==void 0){let l=r.mathToPixels.mapY(s);if(l<i-.5||l>n+.5)return!1}return!0}function zZ(r,e){if(e.length===1&&!Gbe(r,e[0]))return!1;let t=!1;for(let o of e){if(o.newPointLatex){let i=o.model.latex;Al(o.model,o.newPointLatex),t=t||i!==o.model.latex}for(let i in o.sliderUpdates){let{value:n,model:a}=o.sliderUpdates[i];o.commitSliderSoftLimits&&hw(a);let s=a.latex;AT(a,n),t=t||s!==a.latex}}return t}function HZ({projection:r,transform:e,controller:t,strategy:o,mode:i,clampToViewport:n}){var E;let a=t.getItemModel(o.id);if(!a||a.type!=="expression")throw new Error(`Programming error: updateSliderNonlinear move strategy should point to an expression item, but found ${a==null?void 0:a.type}`);let s=i==="up"||i==="bigup",l=((E=a.slider)==null?void 0:E.step)!==""&&(s&&!a.slider.hardMax||!s&&!a.slider.hardMin);o.compiled.fn||__dcg_shared_module_exports__['$c'](o.compiled);let c=o.compiled.fn;e&&(c=_=>__dcg_shared_module_exports__['Uc'](e.forward,o.compiled.fn(_)));let d=_=>{let[T,I]=c(_);return{x:T,y:I}=r.mathToPixels.mapPoint({x:T,y:I}),[T,I]},p=Ll(a),[u,h]=d(p),m=aR(a,i,{ignoreSoftLimits:l}),y=m,[w,S]=d(y),C=__dcg_shared_module_exports__['Lb'](w-u,S-h);if(C<1){let _=__dcg_shared_module_exports__['gc'](d,[u+(w-u)/C,h+(S-h)/C],y,y>p?y:o.min,y<p?y:o.max,1);if(_){let T=ni(_[0],_[1]);(i==="bigup"||i==="bigdown")&&(T=p+(T-p)*5);let I=_d(a,__dcg_shared_module_exports__['fc'](T,o.min,o.max),{ignoreSoftLimits:l}),[P,O]=d(I);__dcg_shared_module_exports__['Lb'](P-u,O-h)>C&&(m=I)}}n&&(m=WZ(r,Ll(a),m,c));let v=c(m);return{mathPoint:{x:v[0],y:v[1]},sliderUpdates:{[o.id]:{model:a,value:m}}}}function KZ({controller:r,projection:e,transform:t,strategy:o,targetScreenPoint:i,clampToViewport:n}){let a={mathPoint:{},sliderUpdates:{}},s=r.getItemModel(o.id);if(!s||s.type!=="expression")throw new Error(`Programming error: updateSliderNonlinear move strategy should point to an expression item, but found ${s==null?void 0:s.type}`);o.compiled.fn||__dcg_shared_module_exports__['$c'](o.compiled);let l=o.compiled.fn;t&&(l=v=>__dcg_shared_module_exports__['Uc'](t.forward,o.compiled.fn(v)));let c=v=>{let[E,_]=l(v);return{x:E,y:_}=e.mathToPixels.mapPoint({x:E,y:_}),[E,_]},d=o.initialValue,p=o.min,u=o.max,h=[i.x,i.y],m=__dcg_shared_module_exports__['gc'](c,h,d,p,u,1);if(!m)return a;let y=ni(m[0],m[1]);p!==void 0&&y<p&&(y=p),u!==void 0&&y>u&&(y=u);let w=_d(s,y,{ignoreSoftLimits:!0});n&&(w=WZ(e,Ll(s),w,l));let[S,C]=l(w);return a.mathPoint.x=S,a.mathPoint.y=C,a.sliderUpdates[s.id]={value:w,model:s},a}function OB({controller:r,projection:e,transform:t,strategy:o,targetScreenPoint:i}){let n=e.reverse_map_pt(i);if(t){let d=__dcg_shared_module_exports__['Uc'](t.inverse,[n.x,n.y]);n={x:d[0],y:d[1]}}let a=o.type==="updateSliderForGlider"?{min:o.min,max:o.max}:void 0,s=KV(e,n,o.movesOn,a);if(!isFinite(s))return;let l=qZ(o.movesOn,s),c={mathPoint:{x:l[0],y:l[1]},newPointLatex:void 0,sliderUpdates:{}};if(o.type==="updateGliderParameter"){let d=o.span;c.newPointLatex=d.input.slice(0,d.start)+__dcg_shared_module_exports__['ke'](s)+d.input.slice(d.end)}else if(o.type==="updateSliderForGlider"){let d=r.getItemModel(o.id);d&&d.type==="expression"&&(c.sliderUpdates[d.id]={value:s,model:d})}return c}function WZ(r,e,t,o){let i=d=>{let[p,u]=o(d);return r.mathToPixels.mapPoint({x:p,y:u})},n=({x:d,y:p})=>{let{left:u,right:h,top:m,bottom:y}=r.pixelCoordinates;return d>=u&&d<=h&&p>=m&&p<=y},a=e,s=i(e),l=t,c=i(t);if(n(c)||!n(s))return t;for(;;){let d=s.x-c.x,p=s.y-c.y;if(d*d+p*p<.5)break;let u=__dcg_shared_module_exports__['ec'](a,l);if(u===a||u===l){[a,l]=n(s)?[a,a]:[l,l];break}let h=i(u);n(h)!==n(s)?[l,c]=[u,h]:[a,s]=[u,h]}return ni(a,l)}function RB({controller:r,projection:e,transform:t,formula:o,moveStrategy:i,dragMode:n,targetScreenPoint:a,clampToViewport:s}){if(t){let{x:h,y:m}=e.pixelsToMath.mapPoint(a),[y,w]=__dcg_shared_module_exports__['Uc'](t.inverse,[h,m]);a=e.mathToPixels.mapPoint({x:y,y:w})}let l=e.pixelsToMath.mapRect({left:a.x-.5,right:a.x+.5,top:a.y+.5,bottom:a.y-.5}),c=[{min:l.left,max:l.right},{min:l.top,max:l.bottom}],d={mathPoint:{},sliderUpdates:{}},[p,u]=i;if(p.type==="updateCoordinate"||u.type==="updateCoordinate"){let h=Ibe(o,c,n);if(h){let{latex:m,x:y,y:w}=h;(y!==void 0||w!==void 0)&&(d.newPointLatex=m,d.mathPoint.x=y!=null?y:d.mathPoint.x,d.mathPoint.y=w!=null?w:d.mathPoint.y)}}for(let h of[0,1]){let m=i[h];if(sE(h,n)&&m.type==="updateSlider"){let y=r.getItemModel(m.id);if(!y||y.type!=="expression")continue;let[w,S]=m.coefficients,C=ni(S*c[h].min+w,S*c[h].max+w),v=_d(y,C,{ignoreSoftLimits:!0}),E=(v-w)/S;if(!s||t){d.mathPoint[h===0?"x":"y"]=E,d.sliderUpdates[y.id]={value:v,model:y};continue}let[_,T]=h===0?[e.mathCoordinates.left,e.mathCoordinates.right]:[e.mathCoordinates.bottom,e.mathCoordinates.top],I=E<_?_:E>T?T:void 0;I!==void 0&&Td(y)===void 0?(d.mathPoint[h===0?"x":"y"]=I,d.sliderUpdates[y.id]={value:S*I+w,model:y}):(d.mathPoint[h===0?"x":"y"]=E,d.sliderUpdates[y.id]={value:v,model:y})}}return d}function Ibe(r,e,t){var u;if(!r.move_strategy)throw new Error("Programming error: expected move_strategy to be defined.");let o=ni(e[0].min,e[0].max),i=ni(e[1].min,e[1].max),[n,a]=r.move_strategy;if(((u=r.typed_constant_value)==null?void 0:u.valueType)===__dcg_shared_module_exports__['Ka']&&n.type==="updateCoordinate"&&a.type==="updateCoordinate"){let[h,m]=r.typed_constant_value.value,y=sE(0,t),w=sE(1,t),S=y?o:h,C=w?i:m,v=n.inputSpan;return{latex:v.input.slice(0,v.start)+__dcg_shared_module_exports__['cc']([S,C],{alwaysEmitImaginary:!0})+v.input.slice(v.end),x:y?o:void 0,y:w?i:void 0}}let s=!1,l=!1,c,d="",p=0;if(n.type==="updateCoordinate"&&sE(0,t)&&(c=n.inputSpan.input,s=!0,d+=c.slice(p,n.inputSpan.start),d+=__dcg_shared_module_exports__['ke'](o),p=n.inputSpan.end),a.type==="updateCoordinate"&&sE(1,t)&&(c=a.inputSpan.input,l=!0,d+=c.slice(p,a.inputSpan.start),d+=__dcg_shared_module_exports__['ke'](i),p=a.inputSpan.end),c!==void 0)return d+=c.slice(p),{latex:d,x:s?o:void 0,y:l?i:void 0}}function sE(r,e){switch(e){case"X":return r===0;case"Y":return r===1;case"XY":return!0;default:return!1}}function $Z(r,e,t){t.forEach(o=>{Mbe(r,e,o)})}function jZ(r,e,t,o,i,n,a){var d;let s=!1,l=e.length===1,c=[];for(let p=0;p<e.length;p++){let u=e[p];if(u.tableInfo){Vbe(r,u,o[p],i),s=!0;continue}let h=r.getItemModel(u.calcId);if(h){if(h.type==="image")s=s||Obe(r,h,u,o[p],i);else if(h.type==="expression"){let m=Rbe({controller:r,movedExpr:h,dragMode:(d=Ci(h,{isReverseDrag:u.isReverseDrag}))!=null?d:"NONE",currentScreenPoint:t[p],targetScreenPoint:o[p],projection:i,transform:n&&n[p],isOnlyPoint:l,keyboardDirection:a});m&&c.push(m)}}}return s=s||zZ(i,c),s}function YZ(r,e){e.forEach(t=>{Abe(r,t)})}function Mbe(r,e,t){if(t.tableInfo){vo(e,void 0);let o=r.getItemModel(t.tableInfo.tableId);if(!o||o.type!=="table")return;M2(o,!0)}else{let o=r.getItemModel(t.calcId);if(!o||!(o.type==="expression"||o.type==="image")||!o.formula||!o.formula.move_strategy)return;let i=o.formula.move_strategy;for(let n=0;n<i.length;n++){let a=i[n];if(i[n].type==="updateCoordinate"||i[n].type==="updateGliderParameter")o.type==="image"?z2(o,!0):o.type==="expression"&&dR(o,!0);else if(a.type==="updateSlider"||a.type==="updateSliderNonlinear"||a.type==="updateSliderForGlider"){let s=r.getItemModel(a.id);if(!s||s.type!=="expression")continue;let l;if(o.type==="expression"?l=Ci(o,{isReverseDrag:t.isReverseDrag}):l=void 0,l==="NONE"||n===0&&l==="Y"||n===1&&l==="X")continue;oC(s,!0)}}}}function Abe(r,e){for(let t of r.getAllItemModels())t.type==="table"?t.draggingOnGraphpaper&&M2(t,!1):t.type==="expression"?(t.sliderDragging&&oC(t,!1),t.draggingOnGraphpaper&&dR(t,!1)):t.type==="image"&&t.draggingOnGraphpaper&&z2(t,!1)}function Vbe(r,e,t,o){let i=e.tableInfo.tableId,n=e.tableInfo.rowIndex,a=e.tableInfo.columnId,s=e.tableInfo.dragX,l=e.tableInfo.dragY,c=r.getItemModel(i);if(!c||c.type!=="table")return;let d=vi(c,a);if(!d)return;let p=o.closestPointOnScreen(t),u=o.pixelsToMath.mapRect(XZ(p,.5)),h={x:__dcg_shared_module_exports__['je'](ni(u.left,u.right)),y:__dcg_shared_module_exports__['je'](ni(u.top,u.bottom))};if(s&&Ih(c,{row:n+1,column:0},h.x),l){let m=d.index;Ih(c,{row:n+1,column:m},h.y)}}function XZ(r,e){return{left:r.x-e,right:r.x+e,top:r.y+e,bottom:r.y-e}}function Lbe(r,e,t){if(t[0]===0&&t[1]===0)return{x:e.x,y:e.y,width:r.width,height:r.height};let o=Math.cos(r.radianAngle),i=Math.sin(r.radianAngle),n=e.x-r.x,a=e.y-r.y;if(t[0]===0)return{x:r.x,y:r.y,width:r.width,height:2*t[1]*(o*a+i*n)};if(t[1]===0)return{x:r.x,y:r.y,width:2*t[0]*(o*n-i*a),height:r.height};let s=2*(r.width*t[0]*(o*n-i*a)+r.height*t[1]*(i*n+o*a))/(r.width*r.width+r.height*r.height);return{x:r.x,y:r.y,width:s*r.width,height:s*r.height}}function Pbe(r,e,t){let o=[{x:e.left,y:e.bottom},{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom}],i=["x","y","width","height"],n={x:1/0,y:1/0,width:1/0,height:1/0},a={x:-1/0,y:-1/0,width:-1/0,height:-1/0};for(let s of o){let l=Lbe(r,s,t);for(let c of i)n[c]=Math.min(n[c],l[c]),a[c]=Math.max(a[c],l[c])}return{min:n,max:a}}function lE(r){return r===void 0?NaN:r[0]}function Obe(r,e,t,o,i){var _;let n=e.formula;if(!n||((_=n.move_strategy)==null?void 0:_.length)!==4)return!1;let a=n.dimensions,s={x:lE(a.x),y:lE(a.y),width:lE(a.width),height:lE(a.height),radianAngle:lE(a.radianAngle)},l=t.scaleFactor||[0,0],c=l[0]!==0&&l[1]!==0,d=i.closestPointOnScreen(o),p=i.pixelsToMath.mapRect(XZ(d,c?.05:.5)),u=Pbe(s,p,l),h=i.mathToPixels.mapRect({left:s.x-.5*s.width,right:s.x+.5*s.width,top:s.y-.5*s.height,bottom:s.y+.5*s.height}),m=Math.abs(h.right-h.left),y=Math.abs(h.bottom-h.top),w=i.mathToPixels.mapRect({left:u.min.x-.5*u.min.width,right:u.min.x+.5*u.min.width,top:u.min.y-.5*u.min.height,bottom:u.min.y+.5*u.min.height}),S=Math.abs(w.right-w.left),C=Math.abs(w.bottom-w.top);if(S<m&&S<1||C<y&&C<1)return!1;let v=["width","height","x","y"],E=!1;for(let T=0;T<v.length;T++){let I=v[T],P=n.move_strategy[T];switch(P.type){case"updateCoordinate":let O=ni(u.min[I],u.max[I]),W=P.inputSpan.input,X=__dcg_shared_module_exports__['je'](O);switch(I){case"width":case"height":xc(e,I,X);break;case"x":if(n.move_strategy[3].type==="updateCoordinate"){let L=n.move_strategy[3],R=ni(u.min.y,u.max.y),N=__dcg_shared_module_exports__['je'](R),z=W.slice(0,P.inputSpan.start)+X+W.slice(P.inputSpan.end,L.inputSpan.start)+N+W.slice(L.inputSpan.end);xc(e,"center",z)}else{let L=W.slice(0,P.inputSpan.start)+X+W.slice(P.inputSpan.end);xc(e,"center",L)}break;case"y":if(n.move_strategy[2].type!=="updateCoordinate"){let L=W.slice(0,P.inputSpan.start)+X+W.slice(P.inputSpan.end);xc(e,"center",L)}break;default:return I}E=!0;break;case"updateSlider":{let x=r.getItemModel(P.id);if(!x||x.type!=="expression")continue;let L=P.coefficients[0],R=P.coefficients[1],N=R*u.min[I]+L,z=R*u.max[I]+L,A=ni(N,z),U=x.latex;AT(x,A),x.latex!==U&&(E=!0)}break}}return E}function Rbe({controller:r,movedExpr:e,dragMode:t,currentScreenPoint:o,targetScreenPoint:i,projection:n,transform:a,isOnlyPoint:s,keyboardDirection:l}){var m,y;let c=e.formula;if(!c||((m=c.move_strategy)==null?void 0:m.length)!==2)return;let[d,p]=c.move_strategy;if(s&&d.type==="updateCoordinate"&&p.type==="updateCoordinate"){let w=n.reverse_map_pt(i),S=FB(n,w);S&&(i=n.map_pt(S))}let u=s?n.closestPointOnScreen(i):i;if(!l){let w;switch(d.type){case"updateSliderNonlinear":w=KZ({controller:r,projection:n,transform:a,strategy:d,targetScreenPoint:u,clampToViewport:s});break;case"updateGliderParameter":case"updateSliderForGlider":w=OB({controller:r,projection:n,transform:a,strategy:d,targetScreenPoint:u});break;default:w=RB({controller:r,projection:n,transform:a,formula:c,moveStrategy:c.move_strategy,dragMode:t,targetScreenPoint:u,clampToViewport:s})}return w&&{...w,commitSliderSoftLimits:!1,transform:a,model:e}}let h;if(d.type==="updateSliderNonlinear"){if(!(l!=null&&l.x))return;h=HZ({projection:n,transform:a,controller:r,strategy:d,mode:l.x,clampToViewport:s})}else if(d.type==="updateGliderParameter"||d.type==="updateSliderForGlider")h=OB({controller:r,projection:n,transform:a,strategy:d,targetScreenPoint:u});else{let w=l.x?0:1,S=l.x?u.x-o.x:u.y-o.y,C=c.move_strategy[w];if(C.type==="updateSlider"){let v=r.getItemModel(C.id);if((v==null?void 0:v.type)!=="expression")throw new Error(`Programming error: updateSlider move strategy should point to an expression item, but found ${v==null?void 0:v.type}`);let E=Td(v);if(E){let _=n.mathToPixels.mapPoint({x:0,y:0}),T=C.coefficients[1],I=Math.abs(w===0?n.mathToPixels.mapX(E/T)-_.x:n.mathToPixels.mapY(E/T)-_.y),P=Math.ceil(1/I);S=I*P*(S>0?1:-1);let O=(y=l.x)!=null?y:l.y;(O==="bigup"||O==="bigdown")&&(S*=5)}}h=RB({controller:r,projection:n,transform:a,formula:c,moveStrategy:c.move_strategy,dragMode:t,targetScreenPoint:{x:o.x+(w===0?S:0),y:o.y+(w===1?S:0)},clampToViewport:s})}return h&&{...h,commitSliderSoftLimits:!0,transform:a,model:e}}function FB(r,e){if(!r.settings.showGrid)return;let t=od(r),o=t.minorStepX,i=t.minorStepY,n=r.map_pt(e),a=Math.round(e.x/o)*o,s=Math.round(e.y/i)*i,l=5,c={x:a,y:s},d=r.map_pt(c);if(__dcg_shared_module_exports__['Lb'](d.x-n.x,d.y-n.y)<=l)return c}function Fbe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var Nbe="ID_",Yu=function(){function r(){Fbe(this,r),this._callbacks={},this._isDispatching=!1,this._isHandled={},this._isPending={},this._lastID=1}return r.prototype.register=function(t){var o=Nbe+this._lastID++;return this._callbacks[o]=t,o},r.prototype.unregister=function(t){this._callbacks[t]||cE(!1,"Dispatcher.unregister(...): `%s` does not map to a registered callback.",t),delete this._callbacks[t]},r.prototype.waitFor=function(t){this._isDispatching||cE(!1,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var o=0;o<t.length;o++){var i=t[o];if(this._isPending[i]){this._isHandled[i]||cE(!1,"Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",i);continue}this._callbacks[i]||cE(!1,"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",i),this._invokeCallback(i)}},r.prototype.dispatch=function(t){this._isDispatching&&cE(!1,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."),this._startDispatching(t);try{for(var o in this._callbacks)this._isPending[o]||this._invokeCallback(o)}finally{this._stopDispatching()}},r.prototype.isDispatching=function(){return this._isDispatching},r.prototype._invokeCallback=function(t){this._isPending[t]=!0,this._callbacks[t](this._pendingPayload),this._isHandled[t]=!0},r.prototype._startDispatching=function(t){for(var o in this._callbacks)this._isPending[o]=!1,this._isHandled[o]=!1;this._pendingPayload=t,this._isDispatching=!0},r.prototype._stopDispatching=function(){delete this._pendingPayload,this._isDispatching=!1},r}();function cE(r,e,t,o,i,n,a,s){if(e===void 0)throw new Error("invariant requires an error message argument");if(!r){var l;if(e===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[t,o,i,n,a,s],d=0;l=new Error(e.replace(/%s/g,function(){return c[d++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}}Xa();function Rp(r){return __dcg_shared_module_exports__['I'](r)}function Fp(r){this.setState(r)}Fp.prototype.setState=function(r){this.state=r};Fp.prototype.getState=function(){return this.state};Fp.prototype.set=function(r,e){if(arguments.length===1){this.state=r;return}else if(typeof r=="string"){this.state=Rp(this.state),this.state[r]=e;return}let t=r.length-2,o=r[t+1],i;this.state=i=Rp(this.state);for(let n=0;n<=t;n++){let a=r[n];i=i[a]=Rp(i[a])}i[o]=e};Fp.prototype.deepMutate=function(r,e){if(arguments.length===1){e=r,this.state=__dcg_shared_module_exports__['i'](this.state),e(this.state);return}else if(typeof r=="string"){this.state=Rp(this.state),this.state[r]=__dcg_shared_module_exports__['i'](this.state[r]),e(this.state[r]);return}let t=r.length-2,o=r[t+1],i=this.state=Rp(this.state);for(let n=0;n<=t;n++){let a=r[n];i=i[a]=Rp(i[a])}i=i[o]=__dcg_shared_module_exports__['i'](i[o]),e(i)};Fp.prototype.shallowMutate=function(r,e){if(arguments.length===1){e=r,this.state=Rp(this.state),e(this.state);return}else if(typeof r=="string"){this.state=Rp(this.state),this.state[r]=Rp(this.state[r]),e(this.state[r]);return}let t=r.length-1,o=this.state=Rp(this.state);for(let i=0;i<=t;i++){let n=r[i];o=o[n]=Rp(o[n])}e(o)};Fp.areShallowEqual=function(r,e){};Fp.areDeepEqual=function(r,e){};var JZ=[{key:"compass",objects:"Segment + Point"},{key:"midpoint",objects:"Segment"},{key:"parallel",objects:"Line + Point"},{key:"perpendicular",objects:"Line + Point"},{key:"image",objects:"2 Points"}];function Bbe(r,e){var a;if(e.typedRuntimeValue.valueType===__dcg_shared_module_exports__['Ea']||e.typedRuntimeValue.valueType===__dcg_shared_module_exports__['Fa'])return[];let t=e.data.call;if(!t||!t.parents)return[];let o=t.symbol,i=t.parents.map(c1),n;switch(o){case"circle":{let[s,l]=i,c=l&&((a=r[l])==null?void 0:a.typedRuntimeValue.valueType);c&&__dcg_shared_module_exports__['fb'](c,__dcg_shared_module_exports__['qa'])?n=[s]:n=[s,l];break}case"apply":{n=[i[1]];break}case"parallel":case"perpendicular":{n=[i[1]];break}case"polygon":{n=i.every(s=>s!==void 0)?i:[];break}default:n=i}return n.filter(ZZ)}var Ube=[[1,0],[0,0],!1],dE=class dE{constructor(e,t){let o=(e==null?void 0:e.list)||[];t&&(o=o.concat(t)),this.list=o;let i=(e==null?void 0:e.forward)||Ube;t&&(i=__dcg_shared_module_exports__['Sc'](i,t.value)),this.forward=i,this.inverse=__dcg_shared_module_exports__['Tc'](i)}add(e){return new dE(this,e)}equals(e){if(this.list.length!==e.list.length)return!1;for(let t=this.list.length-1;t>=0;t--){let o=this.list[t],i=e.list[t];if(!__dcg_shared_module_exports__['J'](o,i))return!1}return!0}isCompletelyRigid(){return this.list.length===0}};dE.COMPLETELY_RIGID=new dE(void 0);var WV=dE;function qbe(r){var o,i;let e={},t={};for(let n in r){let a=r[n];if(!a)continue;for(let l of((o=a.data.call)==null?void 0:o.parents)||[]){let c=c1(l);c&&(e[c]||(e[c]=[]),(i=e[c])==null||i.push(a.assignment))}let s=Bbe(r,a);t[a.assignment]=s}return{parentToChildren:e,childToReversibilityParents:t}}function QZ(r){let e=[],t={};function a(s){var l;t[s]!==2&&(t[s]=1,(l=r[s])==null||l.forEach(a),t[s]=2,e.unshift(s))}for(let s in r)t[s]===void 0&&a(s);return e}function NB(r,e){var p,u,h,m,y,w,S,C,v,E;let t={},o={},i={},n={},a={};for(let _ of e)a[_]=!0,i[_]=WV.COMPLETELY_RIGID;let{parentToChildren:s,childToReversibilityParents:l}=qbe(r);for(let _ of QZ(l)){let T=r[_];if(!T)continue;let I=(p=T.data.call)==null?void 0:p.symbol,P=(((u=T.data.call)==null?void 0:u.parents)||[]).map(c1).filter(ZZ);if(i[T.assignment])if(T.typedRuntimeValue.valueType===__dcg_shared_module_exports__['da']&&!I)t[T.assignment]=i[T.assignment];else if(I==="glider"&&P.length&&!a[P[0]])o[T.assignment]=i[T.assignment];else{let O=i[T.assignment];if(I==="apply"){let X=(h=r[P[0]])==null?void 0:h.typedRuntimeValue;if((X==null?void 0:X.valueType)===__dcg_shared_module_exports__['Fa'])return{};if((X==null?void 0:X.valueType)!==__dcg_shared_module_exports__['Ea'])continue;O=O.add(X)}let W=(m=l[T.assignment])!=null?m:[];for(let X of W)i[X]?O.equals(i[X])||(i[X]=WV.COMPLETELY_RIGID,n[X]=!0):i[X]=O}}let c={};for(let _ in i)c[_]=!0;for(let _ of QZ(s))if(c[_]){for(let T of s[_]||[])c[T]=!0;if(i[_]){let T=l[_]||[];for(let I of T)n[I]&&(n[_]=!0)}}for(let _ in o){let I=(((w=(y=r[_])==null?void 0:y.data.call)==null?void 0:w.parents)||[]).map(c1)[0];I&&c[I]&&(n[I]=!0)}for(let _ in r){if(!c[_])continue;let T=r[_],I=(S=T==null?void 0:T.data.call)==null?void 0:S.symbol,P=(((C=T==null?void 0:T.data.call)==null?void 0:C.parents)||[]).map(c1);if(I==="apply"&&i[_]){let O=P[1],W=P[0];if(!O||!W)continue;let X=(((E=(v=r[W])==null?void 0:v.data.call)==null?void 0:E.parents)||[]).map(c1),x=X.some(R=>R&&c[R]);if(i[_].isCompletelyRigid()&&(!(O in i)||i[O].isCompletelyRigid())||x){n[O]=!0;for(let R of X)R&&(n[R]=!0)}}}let d=[];for(let _ in n)a[_]||d.push(_);return d.length?NB(r,e.concat(d)):{...t,...o}}function c1(r){if(r.type==="arbitrary-expression")return;let e=__dcg_shared_module_exports__['fd'](r);return e?__dcg_shared_module_exports__['$b'](e):void 0}function ZZ(r){return r!==void 0}var pE=class{constructor(){this._nextId=0;this._defs={}}clear(){this._nextId=0,this._defs={}}add(e,t){let o;t?(o=e.assignment,e.listIndex!==void 0&&(o+="\\left["+e.listIndex+"\\right]")):o="**geo-internal-id-"+this._nextId++,this._defs[o]=e}computeReversibilityLineages(e){var s;let t=this.buildAssignmentMap(),o={};for(let l in t){let c=t[l];c&&(o[c.calcId]=c)}let i=[];for(let l of e){let c=o[l];if(!c)return{};i.push(c.assignment)}let n=NB(this.buildAssignmentMap(),i),a={};for(let l in n){let c=(s=t[l])==null?void 0:s.calcId;c&&(a[c]=n[l])}return a}buildAssignmentMap(){let e={};for(let t in this._defs){let o=this._defs[t];o&&(e[o.assignment]=o)}return e}getDepthValues(){let e={},t={},o=this.buildAssignmentMap();for(let l in o){let c=o[l];if(!c)continue;let d=__dcg_shared_module_exports__['ac'](c.assignment),p=[];for(let u of c.data.parentDependencies)p.push(u),t[u]||(t[u]=[]),t[u].push(d);e[d]=p}let i=l=>{if(n[l]!==void 0)return n[l];let c=-1,d=e[l]||[];for(let u=0;u<d.length;u++){let h=i(d[u]);h>c&&(c=h)}let p=c+1;return n[l]=p,p},n={};for(let l in e)n[l]=i(l);let a={},s={};for(let l in t){let c=n[l],d=1/0;t[l].forEach(p=>{let u=n[p];u>c&&(c=u),u<d&&(d=u)}),a[l]=c,s[l]=d}return{createdDepth:n,lastReferencedDepth:a,firstReferencedDepth:s}}};function gy(r){return r?!!(zbe(r)&&r!=="Vector"||r==="Circle"||r==="Arc"||r==="Polygon"):!1}function zbe(r){if(!r)return!1;switch(r){case"Line":case"Ray":case"Vector":case"Segment":return!0}return!1}function ree(r,e){let t={i:0,x:NaN,y:NaN},o={i:1,x:NaN,y:NaN};if(!r||!e)return[t,o];let i=eee(r.typedRuntimeValue),n=eee(e.typedRuntimeValue);if(!i||!n)return[t,o];let a=tee(i,n);return t.x=a[0],t.y=a[1],a=tee(n,i),o.x=a[0],o.y=a[1],[t,o]}function eee(r){switch(r.valueType){case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['wa']:case __dcg_shared_module_exports__['ya']:return{type:"straight",def:r.value};case __dcg_shared_module_exports__['Ga']:return{type:"straight",def:Nb(r.value)};case __dcg_shared_module_exports__['sa']:return{type:"circle",def:r.value};case __dcg_shared_module_exports__['ua']:return{type:"arc",def:r.value}}}function tee(r,e){switch(r.type){case"straight":switch(e.type){case"straight":return __dcg_shared_module_exports__['Lc'](r.def,e.def);case"circle":return __dcg_shared_module_exports__['Jc'](r.def,e.def);case"arc":return __dcg_shared_module_exports__['Nc'](r.def,e.def)}case"circle":switch(e.type){case"straight":return __dcg_shared_module_exports__['Kc'](r.def,e.def);case"circle":return __dcg_shared_module_exports__['Ic'](r.def,e.def);case"arc":return __dcg_shared_module_exports__['Mc'](r.def,e.def)}case"arc":switch(e.type){case"straight":return __dcg_shared_module_exports__['Pc'](r.def,e.def);case"circle":return __dcg_shared_module_exports__['Oc'](r.def,e.def);case"arc":return __dcg_shared_module_exports__['Qc'](r.def,e.def)}}return[NaN,NaN]}var mf=class extends Sp{constructor(t){super(t);this.model=t;this.displayName="graphing-calculator-text-geometry-tool-expression-edit-display-name",this.toolType="custom",this.toolName="expression-edit"}getHint(){let t=this.model.controller.getValidCursorContext();if((t==null?void 0:t.type)!=="expression-arguments"||!t.functionSymbol)return this.getGenericHint();let o=this.model.getTool(t.functionSymbol);if(!o)return this.getGenericHint();let i=t.argIndex;if(t.positionWithinArg==="end"&&(i+=1),o.toolType==="transformation"){if(t.argCount===0)return fa("graphing-calculator-text-geometry-tool-expression-edit-starting-transformation-hint");i>0&&(i-=1)}return o.getExpressionEditHint(i)}getGenericHint(){let t=this.getAllValidNextInputTypes();if(t.some(i=>i===__dcg_shared_module_exports__['aa']||i===__dcg_shared_module_exports__['fa']))return fa("graphing-calculator-text-geometry-tool-expression-edit-generic-hint-any-object");let o=t.filter(i=>!(__dcg_shared_module_exports__['bb'](i)&&t.find(n=>__dcg_shared_module_exports__['cb'](i)===n))).map(i=>Ec(__dcg_shared_module_exports__['ab'](i),mC()));return o.length===0?fa("graphing-calculator-text-geometry-tool-expression-edit-generic-hint-0"):o.length===1?fa("graphing-calculator-text-geometry-tool-expression-edit-generic-hint-1",{type:o[0]}):o.length===2?fa("graphing-calculator-text-geometry-tool-expression-edit-generic-hint-2",{type1:o[0],type2:o[1]}):fa("graphing-calculator-text-geometry-tool-expression-edit-generic-hint-many",{types:wu(fm(),o)})}getExpressionEditHint(t){return this.getHint()}getSpec(){let t=this.model.controller.getSelectedItem(),o=BB(this.model.controller.getValidCursorContext());return!o||!t||t.type!=="expression"?{inputs:[],outputs:[]}:{inputs:[{type:"union",valueTypes:o,id:"1"}],outputs:[{type:"expression-edit-preview-latex",rhsLatex:this.buildPreviewLatex(),hidden:!1,color:t.color,id:"2",parents:[]}]}}onMove(t){super.onMove(t);let{idMap:o,inputIndex:i}=this.model.getNonObjectsState().ui.currentTool,n=this.getSpec().inputs[i];return!!(n&&o[n.id])}buildPreviewLatex(){let t="",o="",i=this.model.controller.getValidCursorContext(),n=(i==null?void 0:i.type)==="permissive"?i.cursorContext:i;if((n==null?void 0:n.type)==="empty")return"";(n==null?void 0:n.type)==="expression-arguments"&&((n==null?void 0:n.positionWithinArg)==="end"?t=",":(n==null?void 0:n.positionWithinArg)==="start"&&(o=","));let s=this.model.getNonObjectsState().ui.currentTool.idMap[1];if(!s)return"";let l=this.model.controller.getSelectedItem();if((l==null?void 0:l.type)!=="expression")return"";let c=Ze.getFocusedMathquill(),d=c==null?void 0:c.selection();if((d==null?void 0:d.latex)!==l.latex)return"";let p=l.latex.slice(0,d.startIndex)+t+s+o+l.latex.slice(d.endIndex);return xn(l)?p.slice(l.latex.indexOf("=")+1):p}canNextInputBePoint(){let t=this.model.controller.getValidCursorContext();if((t==null?void 0:t.type)!=="expression-arguments"||t.expressionType!=="FunctionCall"&&t.expressionType!=="List")return!1;let o=BB(t);if(!o)return!1;let i=!1;for(let n of o){if(__dcg_shared_module_exports__['fb'](n,__dcg_shared_module_exports__['aa']))return!1;__dcg_shared_module_exports__['fb'](n,__dcg_shared_module_exports__['da'])&&(i=!0)}return i}shouldHighlightRelevantObjects(){let t=this.model.controller.getValidCursorContext();if((t==null?void 0:t.type)==="empty"||(t==null?void 0:t.type)==="permissive")return!1;let o=BB(t);return!(!o||o.some(i=>__dcg_shared_module_exports__['fb'](i,__dcg_shared_module_exports__['aa']))||o.every(i=>__dcg_shared_module_exports__['fb'](i,__dcg_shared_module_exports__['ba'])||__dcg_shared_module_exports__['fb'](i,__dcg_shared_module_exports__['Aa'])||__dcg_shared_module_exports__['fb'](i,__dcg_shared_module_exports__['Ca'])))}};function BB(r){if((r==null?void 0:r.type)==="permissive")return[__dcg_shared_module_exports__['aa']];if((r==null?void 0:r.type)==="empty")return[__dcg_shared_module_exports__['Aa'],__dcg_shared_module_exports__['Ca'],__dcg_shared_module_exports__['Ba'],__dcg_shared_module_exports__['Da'],__dcg_shared_module_exports__['Ga']];if((r==null?void 0:r.type)==="expression-arguments"&&r.expressionType==="FunctionCall"&&r.functionSymbol&&!__dcg_shared_module_exports__['Wc'][r.functionSymbol])return;let e=(r==null?void 0:r.type)==="expression-arguments"?r.allowedTypesForInsertedArg:r==null?void 0:r.allowedTypes;return e==null?void 0:e.filter(t=>!__dcg_shared_module_exports__['fb'](t,__dcg_shared_module_exports__['Oa']))}var UB="graphing-calculator-text-geometry-tool-angle-hint-1",qB="graphing-calculator-text-geometry-tool-angle-hint-2",zB="graphing-calculator-text-geometry-tool-angle-hint-3",HB="graphing-calculator-text-geometry-tool-angles-hint-1",Hbe={name:"angle",displayName:"graphing-calculator-text-geometry-tool-angle-display-name",toolType:"complex",icon:[{type:"stroked-path",path:[40,30,30,70,70,70],color:"#bbb"},{type:"angle",x:30,y:70,radius:20,startAngle:-1.325817,deltaAngle:1.325817,isDirected:!1},{type:"point",x:30,y:70},{type:"point",x:40,y:30},{type:"point",x:70,y:70}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[UB,qB,zB]},output:[{type:"angle",parents:[0,1,2]}]},{input:{broadcast:!1,types:[__dcg_shared_module_exports__['oa']],hints:[HB]},output:({inputs:r})=>{if(r.length!==1||r[0].valueType!==__dcg_shared_module_exports__['oa'])throw new Error(`Programming error: expected a single polygon input, got ${JSON.stringify(r)}`);return r[0].value.map((t,o)=>({type:"polygon-angle",angleIndex:o+1,parents:[0]}))}}]},uE=class extends yo{constructor(t){super(t,Hbe);this.model=t}};var Kbe="graphing-calculator-text-geometry-tool-angle-bisector-hint-angle",Wbe={name:"anglebisector",displayName:"graphing-calculator-text-geometry-tool-angle-bisector-display-name",toolType:"complex",icon:[{type:"stroked-path",color:"#ccc",path:[40,30,30,70,70,70]},{type:"angle",x:30,y:70,radius:20,startAngle:-1.325817,deltaAngle:1.325817,isDirected:!1},{type:"stroked-path",lineWidth:"large",path:[31,69,70,38.8]}],workflows:[{input:{broadcast:!1,types:[__dcg_shared_module_exports__['Za'].of([__dcg_shared_module_exports__['Aa'],__dcg_shared_module_exports__['Ca']])],hints:[Kbe]},output:[{type:"anglebisector",parents:[0]}]}]},hE=class extends yo{constructor(t){super(t,Wbe);this.model=t}};var $be="graphing-calculator-text-geometry-tool-arc-hint-1",jbe="graphing-calculator-text-geometry-tool-arc-hint-2",Ybe="graphing-calculator-text-geometry-tool-arc-hint-3",my=50,$V=80,jV=80,KB=-3,oee=-2.6,WB=-1.7,Xbe=[{type:"arc",x:$V,y:jV,radius:my,startAngle:KB,endAngle:WB},{type:"point",x:$V+my*Math.cos(KB),y:jV+my*Math.sin(KB)},{type:"point",x:$V+my*Math.cos(oee),y:jV+my*Math.sin(oee)},{type:"point",x:$V+my*Math.cos(WB),y:jV+my*Math.sin(WB)}],Jbe={name:"arc",displayName:"graphing-calculator-text-geometry-tool-arc-display-name",toolType:"complex",icon:Xbe,workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[$be,jbe,Ybe]},output:[{type:"arc",parents:[0,1,2]}]}]},gE=class extends yo{constructor(t){super(t,Jbe);this.model=t}};var Qbe="graphing-calculator-text-geometry-tool-circle-hint-center",Zbe="graphing-calculator-text-geometry-tool-circle-hint-radius",eye={name:"circle",displayName:"graphing-calculator-text-geometry-tool-circle-display-name",toolType:"simple",icon:[{type:"circle",x:50,y:50,radius:26},{type:"point",x:50,y:50},{type:"point",x:68,y:32}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[Qbe,Zbe]},output:[{type:"circle",parents:[0,1]}]}]},mE=class extends yo{constructor(t){super(t,eye);this.model=t}};var tye="graphing-calculator-text-geometry-tool-compass-hint-segment",rye="graphing-calculator-text-geometry-tool-compass-hint-center",oye={name:"compass",displayName:"graphing-calculator-text-geometry-tool-circle-by-length-display-name",toolType:"complex",icon:[{type:"ellipse",x:50,y:65,rx:26,ry:11,color:__dcg_shared_module_exports__['Zd'].GRAY,lineWidth:2},{type:"stroked-path",path:[50,65,78,65]},{type:"stroked-path",path:[50,65,62,36],lineWidth:"large",color:r=>__dcg_shared_module_exports__['Sd'](r.circle,.3)},{type:"stroked-path",path:[78,65,66,36],lineWidth:"large",color:r=>__dcg_shared_module_exports__['Sd'](r.circle,.3)},{type:"circle",radius:6,x:64,y:31,lineWidth:5,color:r=>__dcg_shared_module_exports__['Sd'](r.circle,.3)},{type:"stroked-path",path:[64,24,64,18],lineWidth:"large",color:r=>__dcg_shared_module_exports__['Sd'](r.circle,.3)},{type:"point",x:50,y:65},{type:"point",x:78,y:65}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['qa'],__dcg_shared_module_exports__['da']],hints:[tye,rye]},output:[{type:"circle",parents:[1,0]}]}]},fE=class extends yo{constructor(t){super(t,oye);this.model=t}};var iee="graphing-calculator-text-geometry-tool-dilation-hint-center",nee="graphing-calculator-text-geometry-tool-dilation-hint-scale-factor",bE=class extends Ep{constructor(t){super(t);this.model=t;this.displayName="graphing-calculator-text-geometry-tool-dilate-display-name",this.toolName="dilation",this.toolType="transformation"}getExpressionEditHint(t){return t===0?this.s(iee):this.s(nee)}getSpecIdToLockIn(t,o){return o===1?"2-number":super.getSpecIdToLockIn(t,o)}getSpec(){return{inputs:[{type:"point",id:"1",hint:iee},{type:"union",valueTypes:[],id:"2",hint:nee,numberInputInfo:{defaultLatex:"2",sliderInfo:{value:"2",min:"0",max:"5"}}}],outputs:[{id:"3",type:"dilate",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"},{type:"reference-input",id:"2-number"}]}]}}};var iye={name:"directedangle",displayName:"graphing-calculator-text-geometry-tool-directedangle-display-name",toolType:"complex",icon:[{type:"stroked-path",path:[40,30,30,70,70,70],color:"#bbb"},{type:"angle",x:30,y:70,radius:20,isDirected:!0,startAngle:-1.325817,deltaAngle:1.325817},{type:"stroked-path",path:[35,50,41,50,37,55,35,50],color:"#000",lineWidth:"medium"},{type:"point",x:30,y:70},{type:"point",x:40,y:30},{type:"point",x:70,y:70}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[UB,qB,zB]},output:[{type:"directedangle",parents:[0,1,2]}]},{input:{broadcast:!1,types:[__dcg_shared_module_exports__['oa']],hints:[HB]},output:({inputs:r})=>{if(r.length!==1||typeof r[0]!="object"||r[0].valueType!==__dcg_shared_module_exports__['oa'])throw new Error(`Programming error: expected a single polygon input, got ${JSON.stringify(r)}`);return r[0].value.map((t,o)=>({type:"polygon-directedangle",angleIndex:o+1,parents:[0]}))}}]},yE=class extends yo{constructor(t){super(t,iye);this.model=t}};var nye="graphing-calculator-text-geometry-tool-line-hint-start",aye="graphing-calculator-text-geometry-tool-line-hint-end",sye={name:"line",displayName:"graphing-calculator-text-geometry-tool-line-display-name",toolType:"simple",icon:[{type:"stroked-path",path:[78,22,22,78],lineWidth:"large"},{type:"point",x:68,y:32},{type:"point",x:32,y:68}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[nye,aye]},output:[{type:"line",parents:[0,1]}]}]},xE=class extends yo{constructor(t){super(t,sye);this.model=t}};var aee="graphing-calculator-text-geometry-tool-midpoint-hint",lye={name:"midpoint",displayName:"graphing-calculator-text-geometry-tool-midpoint-display-name",toolType:"simple",icon:[{type:"stroked-path",path:[32,32,68,68]},{type:"point",x:50,y:50,size:"large"},{type:"point",x:32,y:32,size:"medium"},{type:"point",x:68,y:68,size:"medium"}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[aee]},output:[{type:"midpoint",parents:[0,1]}]},{input:{broadcast:!0,types:[__dcg_shared_module_exports__['qa']],hints:[aee]},output:[{type:"midpoint",parents:[0]}]}]},wE=class extends yo{constructor(t){super(t,lye);this.model=t}};var cye="graphing-calculator-text-geometry-tool-parallel-hint-straight-line",dye="graphing-calculator-text-geometry-tool-parallel-hint-point",pye={name:"parallel",displayName:"graphing-calculator-text-geometry-tool-parallel-display-name",toolType:"complex",icon:[{type:"stroked-path",color:"light",path:[25,50,75,30],lineWidth:"large"},{type:"stroked-path",path:[25,70,75,50],lineWidth:"large"},{type:"point",x:50,y:60,size:"medium"}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['eb'],__dcg_shared_module_exports__['da']],hints:[cye,dye]},output:[{type:"parallel",parents:[0,1]}]}]},vE=class extends yo{constructor(t){super(t,pye);this.model=t}};var uye="graphing-calculator-text-geometry-tool-perpendicular-hint-straight-line",hye="graphing-calculator-text-geometry-tool-perpendicular-hint-point",gye={name:"perpendicular",displayName:"graphing-calculator-text-geometry-tool-perpendicular-display-name",toolType:"complex",icon:[{type:"stroked-path",color:"light",path:[40,25,60,75],lineWidth:"large"},{type:"stroked-path",path:[25,60,75,40],lineWidth:"large"},{type:"point",x:50,y:50,size:"medium"}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['eb'],__dcg_shared_module_exports__['da']],hints:[uye,hye]},output:[{type:"perpendicular",parents:[0,1]}]}]},CE=class extends yo{constructor(t){super(t,gye);this.model=t}};var mye="graphing-calculator-text-geometry-tool-point-hint",fye={name:"point",displayName:"graphing-calculator-text-geometry-tool-point-display-name",toolType:"simple",icon:[{type:"point",x:50,y:50,size:"large"}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da']],hints:[mye]},output:[]}]},SE=class extends yo{constructor(t){super(t,fye);this.model=t}};var bye="graphing-calculator-text-geometry-tool-polygon-hint-first-point",yye="graphing-calculator-text-geometry-tool-polygon-hint-next-point",xye="graphing-calculator-text-geometry-tool-polygon-hint-finish-point",wye={name:"polygon",displayName:"graphing-calculator-text-geometry-tool-polygon-display-name",toolType:"complex",icon:[{type:"filled-polygon",path:[55,30,30,30,35,70,70,60,55,30]},{type:"stroked-path",path:[55,30,30,30,35,70,70,60,55,30]},{type:"point",x:55,y:30},{type:"point",x:30,y:30},{type:"point",x:35,y:70},{type:"point",x:70,y:60}],isDegenerateInput:({previousInputs:r,proposedInput:e})=>!!(r.length===1&&__dcg_shared_module_exports__['J'](r[0],e)),workflows:[{input:{broadcast:!0,types:{type:"variadic",initial:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],rest:__dcg_shared_module_exports__['da']},hints:r=>r===0?bye:r<3?yye:xye},output:({inputs:r,isCommitting:e})=>((e||__dcg_shared_module_exports__['J'](r[r.length-1],r[r.length-2]))&&(r=r.slice(0,-1)),[{type:"polygon",hidden:!1,parents:r.map((t,o)=>o)}]),canCommit:r=>{if(r.length<2)return!1;let e=r[r.length-1],t=r[r.length-2],o=r[0];return __dcg_shared_module_exports__['J'](e,o)||__dcg_shared_module_exports__['J'](e,t)}}]},EE=class extends yo{constructor(t){super(t,wye);this.model=t}};var vye="graphing-calculator-text-geometry-tool-ray-hint-start",Cye="graphing-calculator-text-geometry-tool-ray-hint-end",Sye={name:"ray",displayName:"graphing-calculator-text-geometry-tool-ray-display-name",toolType:"simple",icon:[{type:"stroked-path",path:[78,22,32,68],lineWidth:"large"},{type:"point",x:68,y:32},{type:"point",x:32,y:68}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[vye,Cye]},output:[{type:"ray",parents:[0,1]}]}]},DE=class extends yo{constructor(t){super(t,Sye);this.model=t}};var see="graphing-calculator-text-geometry-tool-reflection-hint-choose-line",kE=class extends Ep{constructor(t){super(t);this.model=t;this.displayName="graphing-calculator-text-geometry-tool-reflect-display-name",this.toolName="reflection",this.toolType="transformation"}getExpressionEditHint(t){return this.s(see)}getSpec(){return{inputs:[{type:"straight",id:"1",hint:see}],outputs:[{id:"2",type:"reflect",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"}]}]}}};var Eye="graphing-calculator-text-geometry-tool-segment-hint-start",Dye="graphing-calculator-text-geometry-tool-segment-hint-end",kye={name:"segment",displayName:"graphing-calculator-text-geometry-tool-segment-display-name",toolType:"simple",icon:[{type:"stroked-path",path:[68,32,32,68],lineWidth:"large"},{type:"point",x:68,y:32},{type:"point",x:32,y:68}],workflows:[{input:{broadcast:!0,types:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['da']],hints:[Eye,Dye]},output:[{type:"segment",parents:[0,1]}]}]},_E=class extends yo{constructor(t){super(t,kye);this.model=t}};var TE=class{constructor(){this.displayName="graphing-calculator-text-geometry-tool-selection-display-name";this.toolType="selection";this.icon=[{type:"filled-polygon",color:"#000",path:[40,30,58,46,51,47,56,60,53,62,47,49,41,54,40,30]}]}getNumberInputLatex(){return""}clearTentativeOutputs(){}canNextInputBePoint(){return!1}getAllValidNextInputTypes(){return __dcg_shared_module_exports__['_a'].filter(e=>this.isValidNextInputType(e))}isValidNextInputType(e){return e!==__dcg_shared_module_exports__['Ea']}getNonPointInputType(){}getHint(){return""}getExpressionEditHint(e){return this.getHint()}onNumberInput(e){}onMove(e){return!0}onFocus(e){}tryCommitResults(){return{committed:void 0}}shouldUseJitEdges(){return!1}shouldHighlightRelevantObjects(){return!1}};var $B="graphing-calculator-text-geometry-tool-translation-hint-from-with-vector",lee="graphing-calculator-text-geometry-tool-translation-hint-to",GE=class extends Ep{constructor(t){super(t);this.model=t;this.displayName="graphing-calculator-text-geometry-tool-translate-display-name",this.toolName="translation",this.toolType="transformation"}getExpressionEditHint(t){return t===0?this.s($B):this.s(lee)}firstInputIsVector(){let{idMap:t}=this.model.getNonObjectsState().ui.currentTool,o=t[1],i=o&&this.model.findDefsForInputId(o)[0];return i&&i.typedRuntimeValue.valueType===__dcg_shared_module_exports__['Ga']}getSpec(){return this.firstInputIsVector()?{inputs:[{type:"union",valueTypes:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['Ga']],id:"1",hint:$B}],outputs:[{id:"3",type:"translate",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"}]}]}:{inputs:[{type:"union",valueTypes:[__dcg_shared_module_exports__['da'],__dcg_shared_module_exports__['Ga']],id:"1",hint:$B},{type:"point",id:"2",hint:lee}],outputs:[{id:"3",type:"translate",hidden:!1,name:this.generateDefaultName(),parents:[{type:"reference-input",id:"1"},{type:"reference-input",id:"2"}]}]}}};var _ye={selection:TE,point:SE,line:xE,segment:_E,ray:DE,vector:XC,circle:mE,arc:gE,parallel:vE,perpendicular:CE,midpoint:wE,polygon:EE,compass:fE,angle:uE,directedangle:yE,reflect:kE,translate:GE,rotate:Fb,dilate:bE,anglebisector:hE,"box-selection":Rb,"expression-edit":mf},jB=_ye;var Tye=!0,Gye=!1,dee="**dcg_geo_tool_output_slider**";function Iye(){return{point:__dcg_shared_module_exports__['Zd'].PURPLE,line:__dcg_shared_module_exports__['Zd'].BLUE,circle:__dcg_shared_module_exports__['Zd'].GREEN,polygon:__dcg_shared_module_exports__['Zd'].BLUE,angle:__dcg_shared_module_exports__['Zd'].BLACK}}function Mye(r,e){let t=[],o=r.parents;for(let i=0;i<o.length;i++){let n=o[i];n.type==="hardcoded"?t[i]=n.id:t[i]=e[n.id]}return t}var IE=class{constructor(e){this.availableInputTypes=new Set;this._nextObjectId=0;this.clear(),this.controller=e,this.s=this.controller.s,this._tools={};for(let t in jB)this._tools[t]=new jB[t](this)}onPreviewChange(){var n;let e=this.controller.getToolPreviewJSONState(),t=this.getUncommittedObjects();if(this.getCurrentTool()instanceof mf&&!this.controller.getValidCursorContext()){t={...t};for(let a in e){let s=e[a];s.type==="expression-edit-preview-latex"&&(t[a]=s)}}let i=this.getNonObjectsState().ui.currentTool.lockedIds;for(let a in t){let s=t[a];s.type==="polygon-segment"&&(!i[a]||Object.keys(t).some(l=>!i[l]&&t[l].parents.includes(a)))&&(t[a]={...s,showAsSepratePreviewObject:!0})}__dcg_shared_module_exports__['J'](e,t)?this.controller.dispatch({type:"render"}):this.controller.dispatch({type:"set-tool-preview-state",state:t}),(n=this.controller.get2dPOIController())==null||n.updateGeoHoveredObjects()}peekNextObjectId(){return"\\token{"+this._nextObjectId.toString()+"}"}generateObjectId(){let e=this.peekNextObjectId();return this._nextObjectId+=1,e}updateNextObjectId(e){e>this._nextObjectId&&(this._nextObjectId=e)}clear(){let e={objects:{},ui:{currentTool:{name:"selection",idMap:{},reusableInputIdMap:{},lockedIds:{},inputIndex:0,outputHistory:{},forceSingleUse:!1},colors:Iye(),clickToInsertMode:"valid-type"},hoveredObjects:[],uncommittedIds:{},selectedIds:{},nextSelectionNumber:1,fadeAnimations:{},maxAnimationEndTime:0};this.store?this.store.set(e):this.store=new Fp(e)}onFocus(e){this.clearHoveredObjects(),this.getCurrentTool().onFocus(e),this.onPreviewChange()}onMouseAction(e,t){let o=this.getCurrentTool();if(o instanceof mf&&!this.controller.getValidCursorContext())return{committed:void 0,handled:!1};switch(this.updateNextObjectId(this.controller.findLastTokenNumber()+1),this.clearHoveredObjects(),e){case"move":return{committed:void 0,handled:o.onMove(t)};case"release":o.onMove(t);let i=o.tryCommitResults();return i.committed?{...i,handled:!0}:{committed:void 0,handled:!1}}}generatePureToolOutput(e,t){let o=this.getTool(e);if(!(o instanceof yo))return;let i=t.map(d=>d.typedValue),n=o.getMatchingWorkflow(i);if(!n)return;let a=F3(n.firstMatch,i,!1),s={},l={};for(let d=0;d<t.length;d++)l[d]=t[d].referenceLatex;this.updateNextObjectId(this.controller.findLastTokenNumber()+1),this.generateIdsForNewToolOutputs(a);let{ui:c}=this.getNonObjectsState();for(let d of a){let p=c.currentTool.idMap[d.id];s[p]={...d,color:this.defaultColorForObject(c,d),id:p,parents:d.parents.map((u,h)=>{var m;return(m=l[h])!=null?m:""})}}return{canCommit:n.canCommit,outputs:s}}getNonObjectsState(){return{...this.store.getState(),objects:void 0}}getCurrentTool(){return this.getTool(this.getToolMode())}getTool(e){return this._tools[e]}getClickToInsertMode(){return this.store.getState().ui.clickToInsertMode}setClickToInsertMode(e){this.store.set(["ui","clickToInsertMode"],e)}defaultColorForObject(e,t){switch(t.type){case"point":case"point-reference":case"midpoint":case"glider":case"intersection":case"vector-endpoint":return e.colors.point;case"polygon-segment":return t.polygonColor||e.colors.line;case"line":case"segment":case"ray":case"vector":case"vector-copy":case"perpendicular":case"parallel":case"anglebisector":return e.colors.line;case"circle":case"compass":case"arc":return e.colors.circle;case"polygon":return e.colors.polygon;case"angle":case"polygon-angle":case"directedangle":case"polygon-directedangle":return e.colors.angle;case"dilate":case"reflect":case"rotate":case"translate":return __dcg_shared_module_exports__['Zd'].GRAY;case"slider":return __dcg_shared_module_exports__['Zd'].BLACK;case"expression-edit-preview-latex":return t.color||__dcg_shared_module_exports__['Zd'].BLACK;default:return t}}_deselectAll(){this.store.shallowMutate(e=>{e.nextSelectionNumber=1,e.selectedIds={}})}_modifySelection(e){let t=this.getNonObjectsState().nextSelectionNumber;this.store.shallowMutate("selectedIds",o=>{for(let i in e)e[i]?o[i]||(o[i]=t,t+=1):delete o[i]}),this.store.set("nextSelectionNumber",t)}_addObjects(e){this.store.shallowMutate("objects",t=>{for(let o of e)t[o.id]=o})}_deleteObjects(e){if(!e.length)return;let t={};this.store.shallowMutate("objects",o=>{for(let i of e)t[i]=Gye,delete o[i]}),this._modifySelection(t),this.store.shallowMutate("uncommittedIds",o=>{for(let i of e)delete o[i]})}createCustomToolOutput(e){var n;this.generateIdsForNewToolOutputs(e.outputs);let{idMap:t}=this.getNonObjectsState().ui.currentTool,o=[],i=this.getNonObjectsState().ui;for(let a of e.outputs){let s;a.type==="polygon-segment"?s=a.polygonColor:s=this.defaultColorForObject(i,a);let l={...a,id:t[a.id],color:s,parents:Mye(a,t)};o.push(l)}for(let a of e.inputs)if((n=a.numberInputInfo)!=null&&n.sliderInfo){let s=a.numberInputInfo.sliderInfo,l=t[`${a.id}-number`];if(ol(l)){let c=mH(l);if(c&&c in __dcg_shared_module_exports__['Wc'])continue;this.controller.getItemsByIdentifier(__dcg_shared_module_exports__['ac'](l)).length||o.push({type:"slider",lhsLatex:l,rhsLatex:s.value,sliderInfo:s,id:dee,parents:[],hidden:!1,color:"#000"})}}this._shouldNewObjectsBeMarkedUncommitted()&&this.store.shallowMutate("uncommittedIds",a=>{for(let s of o)a[s.id]=!0}),this._addObjects(o)}_getReusableIdForCurrentInput(e){let t=this.getCurrentTool();if(!t.getSpec)return;let{inputIndex:o,reusableInputIdMap:i}=this.getNonObjectsState().ui.currentTool,a=t.getSpec().inputs[o];if(!a)return;let s=a.id;return e!==void 0&&(s+="-"+e),i[s]}_createInputObject(e,t){let o,i=this._shouldNewObjectsBeMarkedUncommitted();i?o=this._getReusableIdForCurrentInput(t)||this.generateObjectId():o=this.generateObjectId(),i&&this.store.set(["uncommittedIds",o],!0);let n=this.defaultColorForObject(this.getNonObjectsState().ui,e),a={hidden:e.type==="point"&&!!e.previewOnly,...e,id:o,color:n};return this._addObjects([a]),o}attemptLockToolInputIn(e){let{inputIndex:t,idMap:o}=this.getNonObjectsState().ui.currentTool,i=this.getCurrentTool();if(!(i instanceof Sp))return;let n=i.getSpecIdToLockIn(e,t);if(!n)return;let a=o[n];if(!a){this.getCurrentTool().canNextInputBePoint()||this.controller.dispatch({type:"select-geo-tool",tool:"selection"});return}let s=a&&this.store.getState().objects[a];if(s&&s.type==="point"&&s.previewOnly){this.controller.dispatch({type:"select-geo-tool",tool:"selection"});return}this.store.set(["ui","currentTool","inputIndex"],t+1),this.store.set(["ui","currentTool","lockedIds",a],!0);for(let l=0;l<2;l++){let c=n+"-"+l,d=o[c];d&&this.store.set(["ui","currentTool","lockedIds",d],!0)}i.didLockInput(e),this.updateFadeAnimations()}generateIdsForNewToolOutputs(e){let{idMap:t}=this.getNonObjectsState().ui.currentTool,o=!1,i={};for(let n of e)t[n.id]||(o=!0,i[n.id]=this.generateObjectId());o&&this.store.set(["ui","currentTool","idMap"],{...t,...i})}tentativelyMatchToolInput(e,t){let{currentTool:o}=this.getNonObjectsState().ui,i=o.inputIndex,n=e.inputs[i];if(!n)return;let a=n.id;this.store.set(["ui","currentTool","idMap",a],t)}storeNumberInputLatex(e,t){let{currentTool:o}=this.getNonObjectsState().ui,i=o.inputIndex,n=e.inputs[i];if(!(n!=null&&n.numberInputInfo))return;let a=n.id;this.store.set(["ui","currentTool","idMap",`${a}-number`],t)}createToolInputDependency(e,t,o){let i=this._createInputObject(e,o),{currentTool:n}=this.getNonObjectsState().ui,a=n.inputIndex,s=t.inputs[a];if(!s)throw Vo("geo tool could not find input in spec",{metaData:{fnArgs:{objectDef:e,toolSpec:t,depIndex:o},localVars:{newObjectId:i,currentTool:n,inputIndex:a,input:s},toolState:this.store.getState()}}),new Error("programming error: could not find input "+a+" in spec");let l=s.id;return this.store.set(["ui","currentTool","idMap",l+"-"+o],i),i}isObjectALockedToolInput(e){return!!this.getNonObjectsState().ui.currentTool.lockedIds[e]}isDegenerateInput(e){let t=this.getCurrentTool();return t instanceof Sp?t.isDegenerateInput(e):!1}getEnabledAdditionalTools(){return JZ.filter(e=>!0)}getAdditionalTools(){return this.getEnabledAdditionalTools()}isAnyAdditionalToolEnabled(){return this.getAdditionalTools().length>0}setObjectSelected(e){let t={};t[e]=Tye,this._modifySelection(t)}setObjectsSelected(e){__dcg_shared_module_exports__['k'](e,t=>{this.setObjectSelected(t)})}deleteSelectedObjects(){let e=this.getSelectedObjectIdsUnsorted();this._deleteObjects(e)}isObjectUncommitted(e){return!!this.getNonObjectsState().uncommittedIds[e]}getUncommittedObjectIds(){return Object.keys(this.getNonObjectsState().uncommittedIds)}getUncommittedObjects(){let e={},t=this.store.getState().objects,o=this.getUncommittedObjectIds();for(let i of o)e[i]=t[i];return e}isValidNextInputType(e){let t=this.getCurrentTool(),o=t.getNonPointInputType();return e&&__dcg_shared_module_exports__['bb'](e)&&(e=__dcg_shared_module_exports__['cb'](e)),!!(o&&e&&vI(e,o)||t.canNextInputBePoint()&&e&&vI(e,"point"))}recordCommittedOutput(e){this.store.shallowMutate(["ui","currentTool","outputHistory"],t=>{t[e]=!0})}updateFadeAnimations(){let e=this.controller.getAllItemModels(),t=Date.now(),o=-1/0;this.store.shallowMutate(["fadeAnimations"],i=>{var s,l;if(this.getCurrentTool().shouldHighlightRelevantObjects())for(let c of e){if(c.type!=="expression"||!c.latex)continue;let d=c.id,p=(s=c.formula)==null?void 0:s.geometry,u,h=p==null?void 0:p.valueType;p!=null&&p.unconstructable||this.controller.shouldIgnoreGraphInteractions(c)?u="fade-out":this.isValidNextInputType(__dcg_shared_module_exports__['da'])&&(gy(wI(h))||__dcg_shared_module_exports__['bb'](h)&&gy(wI(__dcg_shared_module_exports__['cb'](h))))||h&&__dcg_shared_module_exports__['fb'](h,__dcg_shared_module_exports__['oa'])&&this.isValidNextInputType(__dcg_shared_module_exports__['qa'])||this.isValidNextInputType(h)||this.store.getState().ui.currentTool.outputHistory[d]?u="fade-in":u="fade-out";let m=this.store.getState().fadeAnimations[d];if(m&&m.type!==u){let y=__dcg_shared_module_exports__['wc'](t-m.start,0,150),w=t+y-150;i[d]={type:u,start:w},o=Math.max(o,w)}else if(u==="fade-out"){let y=(l=m==null?void 0:m.start)!=null?l:t;i[d]={type:"fade-out",start:y},o=Math.max(o,y)}}else{for(let c in i)i[c]={type:"fade-in",start:t-150};o=t-150}}),isFinite(o)&&this.store.set("maxAnimationEndTime",o+150)}getToolFadeOpacity(e){let t=this.controller.getItemModel(e);if((t==null?void 0:t.type)!=="expression")return 1;let o=this.store.getState().fadeAnimations[t.id];if(!o)return 1;let i=Date.now(),n=__dcg_shared_module_exports__['wc']((i-o.start)/150,0,1),a=o.type==="fade-in"?.2:1,s=o.type==="fade-in"?1:.2;return a*(1-n)+s*n}updateAvailableInputTypes(){let e=this.controller.getAllItemModels();this.availableInputTypes=Lye(e)}isToolActuallyUsable(e){let t=this.controller.getGeoModel().getTool(e);if(t instanceof yo){let o=t.getWorkflows();for(let i of this.availableInputTypes)if(o.some(n=>n.signature.matches([i])))return!0;return!1}return!0}isFading(){return Date.now()<=this.store.getState().maxAnimationEndTime}isObjectSelected(e){return!!this.getNonObjectsState().selectedIds[e]}getSelectedObjectIdsUnsorted(){return Object.keys(this.getNonObjectsState().selectedIds)}getSelectedObjectIdsSorted(){let e=this.getNonObjectsState().selectedIds,t=this.getSelectedObjectIdsUnsorted();return __dcg_shared_module_exports__['u'](t,i=>e[i])}deselectAllObjects(){this._deselectAll()}getToolMode(){return this.getNonObjectsState().ui.currentTool.name}setToolMode(e){let t=this.getToolMode(),o=this.getNonObjectsState().ui.currentTool;this.store.set(["ui","currentTool"],{name:e,idMap:{},reusableInputIdMap:{},lockedIds:{},inputIndex:0,outputHistory:e!==t?{}:o.outputHistory,forceSingleUse:e!==t?!1:o.forceSingleUse}),this.updateFadeAnimations(),e!==t&&this.controller.isGraphPaperFocused()&&(e!=="expression-edit"&&Bt(this.getCurrentToolDisplayName()+"."),this.speakCurrentGeoToolHint())}resetToolMode(){this.setToolMode(this.getToolMode())}markCurrentToolSingleUse(){this.store.set(["ui","currentTool","forceSingleUse"],!0)}areAnyObjectsHovered(){return!!this.getNonObjectsState().hoveredObjects.length}setObjectHovered(e){this.store.deepMutate(t=>{t.hoveredObjects.push(e)})}objectIsInstanceOf(e,t){let o=e==null?void 0:e.typedRuntimeValue.valueType;if(o)return vI(o,t)}getSelectionBox(){return this.getTool("selection").getSelectionBox()}commitObjects(){this.store.set("uncommittedIds",{}),this.store.set("objects",{})}applyTransformation(e){}getProjection(){return this.controller.get2dProjection()}_getPixelsAwayFromDef(e,t,o){let i=o.typedRuntimeValue;switch(i.valueType){case __dcg_shared_module_exports__['da']:{let a=t.mapx(i.value[0]),s=t.mapy(i.value[1]);return __dcg_shared_module_exports__['Lb'](e.x-a,e.y-s)-6}case __dcg_shared_module_exports__['wa']:case __dcg_shared_module_exports__['qa']:case __dcg_shared_module_exports__['ya']:case __dcg_shared_module_exports__['Ga']:{let n,a,s,l;if(i.valueType===__dcg_shared_module_exports__['Ga']){let[[u,h],[m,y]]=Nb(i.value);n=t.mapx(u),s=t.mapy(h),a=t.mapx(m),l=t.mapy(y)}else n=t.mapx(i.value[0][0]),s=t.mapy(i.value[0][1]),a=t.mapx(i.value[1][0]),l=t.mapy(i.value[1][1]);let c=i.valueType===__dcg_shared_module_exports__['wa'],d=i.valueType===__dcg_shared_module_exports__['wa']||i.valueType===__dcg_shared_module_exports__['ya'],p=__dcg_shared_module_exports__['Pb'](e.x,e.y,n,s,a,l,c,d);return p?__dcg_shared_module_exports__['Lb'](p[0]-e.x,p[1]-e.y):1/0}case __dcg_shared_module_exports__['sa']:{let n=i.value[0][0],a=i.value[0][1],s=i.value[1],l=0,c=Math.PI*2,d=t.reverse_mapx(e.x),p=t.reverse_mapy(e.y),u=__dcg_shared_module_exports__['Qb'](d,p,n,a,s,l,c);return u?t.screen.width/(t.viewport.xmax-t.viewport.xmin)*__dcg_shared_module_exports__['Lb'](u[0]-d,u[1]-p):1/0}case __dcg_shared_module_exports__['ua']:{let n=__dcg_shared_module_exports__['Hc'](i.value);if(!n)return 1/0;let a=(s,l,c,d)=>{let p=t.mapx(s[0]),u=t.mapy(s[1]),h=t.mapx(l[0]),m=t.mapy(l[1]),y=__dcg_shared_module_exports__['Pb'](e.x,e.y,p,u,h,m,c,d);return y?__dcg_shared_module_exports__['Lb'](y[0]-e.x,y[1]-e.y):1/0};if(n.type==="arc"){let s=t.reverse_mapx(e.x),l=t.reverse_mapy(e.y),c=__dcg_shared_module_exports__['Qb'](s,l,n.center[0],n.center[1],n.radius,n.startAngle,n.endAngle);return c?t.screen.width/(t.viewport.xmax-t.viewport.xmin)*__dcg_shared_module_exports__['Lb'](c[0]-s,c[1]-l):1/0}else return n.type==="segment"?a(n.start,n.end,!1,!1):Math.min(a(n.start1,n.end1,!1,!0),a(n.start2,n.end2,!1,!0))}case __dcg_shared_module_exports__['oa']:{let n=[];return i.value.forEach(a=>{n.push(t.mapx(a[0]),t.mapy(a[1]))}),__dcg_shared_module_exports__['hc'](n,[e.x,e.y])?0:1/0}case __dcg_shared_module_exports__['Aa']:case __dcg_shared_module_exports__['Ca']:{let n=t.screen.width/(t.viewport.xmax-t.viewport.xmin),a=t.screen.height/(t.viewport.ymax-t.viewport.ymin),[[s,l],c,d]=i.value,p=vm(d,t),u=p/n,h=t.reverse_mapx(e.x),m=t.reverse_mapy(e.y),y=1/0,w=m-l,S=h-s,C=Math.atan2(w,S);if(__dcg_shared_module_exports__['Jb'](C,c,d))__dcg_shared_module_exports__['Lb'](w*a,S*n)<=p+7&&(y=0);else{let v=__dcg_shared_module_exports__['Ob'](h,m,s+u*Math.cos(c),l+u*Math.sin(c),s,l),E=__dcg_shared_module_exports__['Ob'](h,m,s+u*Math.cos(c+d),l+u*Math.sin(c+d),s,l),_=__dcg_shared_module_exports__['Lb'](n*(v[0]-h),a*(v[1]-m)),T=__dcg_shared_module_exports__['Lb'](n*(E[0]-h),a*(E[1]-m));y=Math.min(_,T)}return y}case __dcg_shared_module_exports__['Ea']:return 1/0;default:return 1/0}}getAllChoosableDefsUnordered(e,t){var u;if(!this.controller.isGeometry())return[];let o=[],i=e.mode==="tab",n=e.mode==="mouse",a=i&&this.controller.getActiveTool()==="box-selection",s=!1,l=!1;(u=t.isValidNextInputType)!=null&&u.call(t,__dcg_shared_module_exports__['da'])&&(s=!0),t.shouldUseJitEdges()&&(t.isValidNextInputType(__dcg_shared_module_exports__['qa'])||t.isValidNextInputType(__dcg_shared_module_exports__['wa'])||t.isValidNextInputType(__dcg_shared_module_exports__['ya']))&&(l=!0);let c=n&&s;c&&(l=!0);let{lockedIds:d,reusableInputIdMap:p}=this.store.getState().ui.currentTool;return Mb({controller:this.controller},(h,m)=>{var w,S;if(!h.isGraphableAndInteractive)return;let y=h.assignment;for(let C in p)if(p[C]===y&&!d[y])return;if(!h.hidden&&!h.data.unconstructable&&!(this.getToolMode()==="expression-edit"&&((w=h.data)!=null&&w.depends_on_selected))&&!(a&&this.controller.isClickableId(h.calcId))&&!(i&&this.isDegenerateInput(h==null?void 0:h.assignment))&&!(i&&m)){if(h.typedRuntimeValue.valueType===__dcg_shared_module_exports__['oa'])if(h.typedRuntimeValue.value.length){if(l){let C=h;if(C.typedRuntimeValue.valueType===__dcg_shared_module_exports__['oa']){let v=C.typedRuntimeValue.value;for(let E=0;E<v.length;E++){let _=v[E],T=v[(E+1)%v.length],I=C.referenceLatex+".\\operatorname{segments}\\left["+(E+1)+"\\right]",P={calcId:C.calcId,listIndex:C.listIndex,hidden:C.hidden,isGraphableAndInteractive:!1,assignment:I,referenceLatex:I,data:C.data,typedRuntimeValue:{valueType:__dcg_shared_module_exports__['qa'],value:[_,T]},polygonEdgeInfo:{edgeNumber:E,polygonDef:C}};o.push(P)}}}}else return;if(c&&!__dcg_shared_module_exports__['fb'](h.typedRuntimeValue.valueType,__dcg_shared_module_exports__['oa'])){o.push(h);return}if((S=t.isValidNextInputType)!=null&&S.call(t,h.typedRuntimeValue.valueType)){o.push(h);return}}}),o}_getObjectsUnderMouse(e,t,o){let i=this.getAllChoosableDefsUnordered({mode:"mouse"},o),n=this.getProjection(),a=[];i.forEach(c=>{let d=this._getPixelsAwayFromDef(e,n,c),p=c.polygonEdgeInfo?-1:0;if(d<=t){let u={def:c,layerNumber:p,pixelsAway:d};a.push(u)}});let s=this.controller.get2dSketchOrder(),l={};for(let c=0;c<s.length;c++)l[s[c]]=c;return a.sort((c,d)=>{let p=d.layerNumber-c.layerNumber;if(p!==0)return p;let u=c.pixelsAway-d.pixelsAway;if(u!==0)return u;let h=l[c.def.calcId];return l[d.def.calcId]-h}),a}convertCanvasPixelsToPoint(e){return this.getProjection().reverse_map_pt(e)}convertPointToCanvasPixels(e){return this.getProjection().map_pt(e)}deleteObjectsAndRememberReusableId(e){for(let t in e)this._deleteObjects([e[t]]);this._deleteObjects([dee]),this.store.shallowMutate(["ui","currentTool"],t=>t.reusableInputIdMap=e)}getObjectDefUnderMouse(e,t,o){let i=this.convertPointToCanvasPixels(e),n=this._getObjectsUnderMouse(i,t,o);return n.length>0?n[0].def:void 0}getOrCreatePointNearMouse(e,t){let o=this.convertPointToCanvasPixels(e),i=this._getObjectsUnderMouse(o,t,this.getCurrentTool()),n=[];for(let u of i){let h=u.def,m=sY(h);m==="Point"?n.push({def:h,type:m}):(gy(m)||m==="Vector")&&n.push({def:h,type:m})}let{def:a,type:s}=n[0]||{},{def:l,type:c}=n[1]||{},d=this.controller.isGeoToolEnabled("point");if(s==="Point")return{type:"def",def:a};if(gy(s)&&gy(c)){let u=ree(a,l).map(h=>({x:h.x,y:h.y,i:h.i,pixelsFromPoint:pee(this.getProjection(),Pm(h.x-e.x,h.y-e.y))}));if(u.sort((h,m)=>h.pixelsFromPoint-m.pixelsFromPoint),u=u.filter(h=>h.pixelsFromPoint<5),u[0]){let h=u[0].i===0?[a,l]:[l,a],m=this.findIncidentPointDef(a,l);if(m!=null&&m.hidden){let y=!1,w;if(O3(m.typedRuntimeValue,(S,C)=>{let[v,E]=S.value,_=this.getProjection().mathToPixels.mapPoint({x:v,y:E});Pm(_.x-o.x,_.y-o.y)<t&&(y=!0,w=C)}),y)return w!==void 0&&(m=R3(m,w)),{type:"spec",spec:{type:"point-reference",targetSpec:{type:"intersection",parentDefs:h},parentDefs:[m]}}}return{type:"spec",spec:{type:"intersection",parentDefs:h}}}else if(d)return uee(this.getProjection(),e,a)}else{if(d&&gy(s))return uee(this.getProjection(),e,a);if(s==="Vector"){let h=Nb(a.typedRuntimeValue.value).map((m,y)=>({index:y,point:{x:m[0],y:m[1]},pixelsFromPoint:pee(this.getProjection(),Pm(m[0]-e.x,m[1]-e.y))})).sort((m,y)=>m.pixelsFromPoint-y.pixelsFromPoint).filter(m=>m.pixelsFromPoint<5);if(h.length>0)return Vye(a,h[0].index===1?1:0)}}let p=Aye(this.getProjection(),e);return{type:"spec",spec:{type:"point",x:p.x,y:p.y,parentDefs:[],previewOnly:!d}}}findIncidentPointDef(e,t){let o=e.typedRuntimeValue.valueType,i=t.typedRuntimeValue.valueType,n={};Mb({controller:this.controller,expandLists:!1},l=>{if(l.data.identifier&&__dcg_shared_module_exports__['fb'](l.typedRuntimeValue.valueType,__dcg_shared_module_exports__['da'])){let c=l.data.identifier;n[c]=l}});let a=__dcg_shared_module_exports__['hd']({getGeometryTree:l=>l.data.call,isPointOrListOfPoints:l=>__dcg_shared_module_exports__['fb'](l.typedRuntimeValue.valueType,__dcg_shared_module_exports__['da']),lookup:l=>n[l],resolvesTo:(l,c)=>l===c.data.identifier},e,o,t,i),s=a&&__dcg_shared_module_exports__['fd'](a);if(s){let l=n[s],c=a&&__dcg_shared_module_exports__['ed'](a);return c===void 0?l:R3(l,c)}}_shouldNewObjectsBeMarkedUncommitted(){return this.getToolMode()!=="selection"}clearHoveredObjects(){this.store.set("hoveredObjects",[])}getHoveredItems(){return this.store.getState().hoveredObjects}cancelToolplay(){this._deleteObjects(this.getUncommittedObjectIds()),this.clearHoveredObjects(),this.resetToolMode()}isToolplayActive(){return this.getNonObjectsState().ui.currentTool.inputIndex>0}getComputedBoard(){let e=new pE;return Mb({controller:this.controller},(t,o)=>{e.add(t,o)}),e}findDefsForInputId(e){let t=[];return Mb({controller:this.controller},o=>{(o.assignment===e||o.referenceLatex===e)&&t.push(o)}),t}isCreatingNewTransform(){return this.getCurrentTool().toolType==="transformation"}getCurrentToolDisplayName(){return this.controller.s(this.getCurrentTool().displayName)}isCurrentToolComplex(){return this.getCurrentTool().toolType==="complex"}isCurrentToolSingleUse(){return this.getCurrentTool().toolType==="transformation"||this.getNonObjectsState().ui.currentTool.forceSingleUse}getIconInstructionsForTool(e){let t=this.getTool(e);return t?t.icon:[]}getDisplayNameForTool(e){let t=this.getTool(e);return t?this.controller.s(t.displayName):""}speakCurrentGeoToolHint(){Te(this.getCurrentTool().getHint())}};function Aye(r,e){let t=FB(r,e);t&&(e=t);let o=.5/hee(r);return{x:ni(e.x-o,e.x+o),y:ni(e.y-o,e.y+o)}}function hee(r){return r.mapx(1)-r.mapx(0)}function pee(r,e){return hee(r)*e-6}function uee(r,e,t){return{type:"spec",spec:{type:"glider",t:KV(r,e,t.typedRuntimeValue),parentDefs:[t]}}}function Vye(r,e){return{type:"spec",spec:{type:"vector-endpoint",location:e?"end":"start",parentDefs:[r]}}}function Lye(r){let e=new Set;e.add(__dcg_shared_module_exports__['da']);for(let t of r){if(t.type!=="expression"||!t.formula.typed_constant_value||t.hidden)continue;let o=t.formula.typed_constant_value.valueType,i=__dcg_shared_module_exports__['bb'](o)?__dcg_shared_module_exports__['cb'](o):o;__dcg_shared_module_exports__['db'](i)&&e.add(i),i===__dcg_shared_module_exports__['oa']&&e.add(__dcg_shared_module_exports__['qa'])}return e}function Dn(r,e,t){let o=Pye(r,e,t);Do(r,o)}function Do(r,e){if(r.focusLocation=e,!e||(e.type==="ticker"&&(r.getListModel().ticker.playing=!1,vo(r.getListModel(),void 0)),e.type==="settings"||e.type==="generic-menu"||e.type==="editable-label"||e.type==="add-item-btn"||e.type==="add-expression-btn"||e.type==="add-note-btn"||e.type==="add-table-btn"||e.type==="add-folder-btn"||e.type==="add-ticker-btn"||e.type==="add-image-btn"||e.type==="edit-list-toggle"||e.type==="hide-expression-list-btn"||e.type==="show-expression-list-btn"||e.type==="zoom-in-btn"||e.type==="zoom-restore-btn"||e.type==="search-expressions"||e.type==="replace-expressions"||e.type==="ticker"||e.type==="geo-token"||e.type==="geo-show-constructions-icon"||e.type==="geo-basic-tool"||e.type==="geo-basic-tool-menu-item"||e.type==="geo-construct-menu-existing-transformations"||e.type==="multi-select-more-icon"||e.type==="multi-select-construct-icon"||e.type==="multi-select-style-icon"||e.type==="multi-select-label-icon"||e.type==="geo-header-back-link"||e.type==="multi-select-show-hide-icon"||e.type==="new-transformation-number"||e.type==="label-points-icon"||e.type==="graph-paper"||e.type==="quest"||e.type==="global-mute-button"||e.type==="color-picker-option"||e.type==="multi-select-label-menu-label-input"))return;let t=r.getItemModel(e.id);if(e.type==="expression-menu"){vo(r.getListModel(),void 0);return}else vo(r.getListModel(),t);t&&t.type==="expression"&&Cc(t,!1)}function Pye(r,e,t){let o=r.getItemModel(e);if(!o)return;let i=r.isInEditListMode()||r.isItemReadonly(o.id);switch(o.type){case"expression":return{type:i?"readonly-expression":o.type,id:e};case"folder":case"text":return{type:o.type,id:e};case"table":{let a={row:1,column:0},s=!1;return t&&(t.location==="cell"?a={row:t.row,column:t.column}:t==="end"?a={row:Kc(o),column:0}:t==="start"?a={row:0,column:0}:t==="container"&&(s=!0)),s?{type:"table-container",id:e}:{type:o.type,id:e,location:a}}case"image":return{type:o.type,id:e,location:"name"};default:return o}}function gee(r){let e=r.getSelectedItem();if(e&&e.type==="expression"&&!e.readonly){Dn(r,e.id);return}if(e&&e.type==="table"&&r.focusLocation&&!e.readonly)return;let t=r.getFirstFullyVisibleItem(),o=r.getListModel();for(;t&&(t.type!=="expression"||t.readonly);)t=F0(o,t.index);if(t){Dn(r,t.id);return}let i=r.createItemModel({type:"expression",id:r.generateId(),color:r.getNextColor()});Wc(r.getListModel(),i),Dn(r,i.id)}function mee(r){let e=r.focusLocation;if(e&&!(e.type==="settings"||e.type==="generic-menu"||e.type==="editable-label"||e.type==="add-item-btn"||e.type==="add-expression-btn"||e.type==="add-note-btn"||e.type==="add-table-btn"||e.type==="add-ticker-btn"||e.type==="add-folder-btn"||e.type==="add-image-btn"||e.type==="edit-list-toggle"||e.type==="hide-expression-list-btn"||e.type==="show-expression-list-btn"||e.type==="zoom-in-btn"||e.type==="zoom-restore-btn"||e.type==="search-expressions"||e.type==="replace-expressions"||e.type==="ticker"||e.type==="geo-token"||e.type==="geo-show-constructions-icon"||e.type==="geo-basic-tool"||e.type==="geo-basic-tool-menu-item"||e.type==="geo-construct-menu-existing-transformations"||e.type==="multi-select-more-icon"||e.type==="multi-select-construct-icon"||e.type==="multi-select-style-icon"||e.type==="multi-select-label-icon"||e.type==="geo-header-back-link"||e.type==="multi-select-show-hide-icon"||e.type==="new-transformation-number"||e.type==="label-points-icon"||e.type==="graph-paper"||e.type==="quest"||e.type==="global-mute-button"||e.type==="color-picker-option"||e.type==="multi-select-label-menu-label-input"))return r.getItemModel(e.id)}function p1(r,e,t){Do(r,{type:"table",id:e,location:t})}function bee(r,e,t){let o=r.getItemModel(e);if(!o||o.type!=="table")return;let i=o,n=ys(i),a=n?n.row:-1,s=n?n.column:-1,l=i.columnModels,c=Kc(i),d=l.length,p=(y,w)=>{y===-1?YV(r):y>c?XV(r):(w===-1?(w=d-1,y--):w===d&&(y++,w=0),p1(r,e,{row:y,column:w}))},u=y=>{c>2&&YH(i,a-1),p1(r,e,{row:y,column:s})},h=y=>{s===0||d<=2||(_0(i,s),p1(r,e,{row:a,column:y}))},m=!!Lx(i.columnModels[0]);switch(t){case"Left":p(a,s-1);break;case"Right":p(a,s+1);break;case"Up":p(a-1,s);break;case"Down":p(a+1,s);break;case"PageUp":return YV(r);case"PageDown":return XV(r);case"Enter":if(a>=c)return JB(r);if(s>0||m)return p(a+1,s);if(a===c-1){let y=XH(i,a);I2(i,a);for(let w=0;w<y.length;w++)Ih(i,{row:a+1,column:w},y[w]);p1(r,e,{row:a+1,column:s});return}I2(i,a),p1(r,e,{row:a+1,column:s});break;case"Backspace":a===0?s===0?YB(r):s===d-1||s===1&&d===3?p(0,s-1):h(s-1):s!==0?p(a,s-1):a===c||m?p(a-1,s):u(a-1);break;case"Delete":a===0?s===0?XB(r):s<d-1&&h(s):a>=c||m||u(a);break}}function YV(r){if(r.inAudioTraceMode())return;let e=r.getFocusLocation(),t=r.getListModel();if((e==null?void 0:e.type)==="ticker"&&r.getExpressionSearchOpen())return Do(r,{type:"search-expressions"});let o=r.getSelectedItem();if(!o)return;if(xT(t)){if(o=r.getSelectedItem(),!o)return;Dn(r,o.id,r.isInEditListMode()&&o.type==="table"?"container":"end")}else r.getTickerVisible()?Do(r,{type:"ticker",location:"handler"}):r.getExpressionSearchOpen()&&Do(r,{type:"search-expressions"})}function XV(r){if(r.inAudioTraceMode())return;let e=r.getFocusLocation(),t=r.getListModel();if((e==null?void 0:e.type)==="search-expressions"&&r.getTickerVisible())return Do(r,{type:"ticker",location:"handler"});if((e==null?void 0:e.type)==="ticker"||(e==null?void 0:e.type)==="search-expressions"){let i=jx(t);if(i)return Dn(r,i.id,r.isInEditListMode()&&i.type==="table"?"container":"start")}if(!wT(t)&&!r.isInEditListMode()){let i=r.createItemModel({type:"expression",id:r.generateId(),color:r.getNextColor()});Wc(t,i),vo(t,i)}let o=r.getSelectedItem();if(o)return Dn(r,o.id,r.isInEditListMode()&&o.type==="table"?"container":"start")}function YB(r){if(r.isInEditListMode())return;let e=r.getSelectedItem();if(!e||r.getItemCount()===1&&e.type==="expression")return;let t=e.type==="text",o=il(e);if(o){let i=r.getNumberOfItemsInFolder(o.id);if(e.index===o.index+i){Qa(e,"");return}}if(QB(r,{moveSelection:!0}),t&&Rs&&Eh){vo(r.getListModel(),void 0);return}e=r.getSelectedItem(),e&&Dn(r,e.id,"end")}function XB(r){if(r.isInEditListMode())return;let e=r.getSelectedItem();e&&(r.getItemCount()===1&&e.type==="expression"||(ZB(r,{moveSelection:!0}),e=r.getSelectedItem(),e&&Dn(r,e.id,"start")))}function JB(r){if(r.isInEditListMode())return;let e=r.getSelectedItem();if(!e)return;if(e.type==="text"&&Rs&&Eh){Jr(),vo(r.getListModel(),void 0);return}if(e.type==="expression"&&Vh(e).length>0)return r.createSlidersForItem(e.id,Vh(e).concat(""));let t=q0(e);if(t.length>0&&t.length<=tC&&r.areSlidersEnabled())return r.createSlidersForItem(e.id,q0(e).concat(""));let o=r.createItemModel({type:"expression",id:r.generateId(),color:r.getNextColor()}),i=e.index+1;e.type==="folder"&&e.collapsed&&(i+=r.getNumberOfItemsInFolder(e.id)),wc(r.getListModel(),o,i),vo(r.getListModel(),o),e.type==="folder"&&!e.collapsed?Qa(o,e.id):e.type!=="folder"&&e.folderId&&Qa(o,e.folderId),e=r.getSelectedItem(),e&&Dn(r,e.id)}function QB(r,{moveSelection:e}){let t=r.getSelectedItem(),o=r.getListModel();if(!t||r.isItemReadonly(t.id))return;let i=R0(o,t.index);if(r._removeExpressionSynchronously(t),e){if(!i){let n=jx(o);n&&(i=n)}vo(o,i)}else vo(o,void 0)}function ZB(r,{moveSelection:e}){let t=r.getSelectedItem(),o=r.getListModel();if(!t||r.isItemReadonly(t.id))return;let i=F0(o,t.index);if(r._removeExpressionSynchronously(t),e){if(!i){let n=gT(o);n&&(i=n)}vo(o,i)}else vo(o,void 0)}$t();var Rye={loga:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\log_{}\\left(\\right)")&&(r.write("\\log_{}"),r.typedText("("),r.keystroke("Left"),r.keystroke("Down"))},nthroot:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\sqrt[]{}")&&(r.write("\\sqrt[]{}"),r.keystroke("Left"),r.keystroke("Left"))},ddx:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\frac{d}{dx}")&&r.write("\\frac{d}{dx}")},arcsin:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\sin^{-1}\\left(\\right)")&&(r.write("sin^{-1}"),r.typedText("("))},arccos:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\cos^{-1}\\left(\\right)")&&(r.write("cos^{-1}"),r.typedText("("))},arctan:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\tan^{-1}\\left(\\right)")&&(r.write("tan^{-1}"),r.typedText("("))},arcsec:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\sec^{-1}\\left(\\right)")&&(r.write("sec^{-1}"),r.typedText("("))},arccsc:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\csc^{-1}\\left(\\right)")&&(r.write("csc^{-1}"),r.typedText("("))},arccot:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\cot^{-1}\\left(\\right)")&&(r.write("cot^{-1}"),r.typedText("("))},"A^T":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"^{T}")&&(r.typedText("^T"),r.keystroke("Right"))},"A^-1":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"^{-1}")&&(r.typedText("^-1"),r.keystroke("Right"))},"A^2":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"^{2}")&&(r.typedText("^2"),r.keystroke("Right"))},"a^2":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"^{2}")&&(r.typedText("^2"),r.keystroke("Right"))},"a^3":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"^{3}")&&(r.typedText("^3"),r.keystroke("Right"))},"a/b":(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\frac{}{}")&&(r.write("\\frac{}{}"),r.keystroke("Left"))},integral:(r,e)=>{Ze.canAcceptText(r,e.capExpressionSize,"\\int_{}^{}")&&r.cmd("integral")}};function JV(r,e,t){Rye[e](r,t)}var e5=r=>({value:r.degreeMode?"30":"0.5",min:"0",max:r.degreeMode?"360":"2\\pi"}),xee={min:"0",max:"5",value:"1"},u1=r=>({min:"0",max:"1",value:`${r}`}),Fye={latex:void 0,polarDomainMin:void 0,polarDomainMax:void 0,parametricDomainMin:void 0,parametricDomainMax:void 0,parametricDomain3DuMin:void 0,parametricDomain3DuMax:void 0,parametricDomain3DvMin:void 0,parametricDomain3DvMax:void 0,parametricDomain3DrMin:void 0,parametricDomain3DrMax:void 0,parametricDomain3DphiMin:void 0,parametricDomain3DphiMax:void 0,clickableInfoLatex:void 0,colorLatex:void 0,tableColumnColorLatex:void 0,cdfMin:()=>({value:"0",min:"-10",max:"10"}),cdfMax:()=>({value:"0",min:"-10",max:"10"}),pointSize:()=>({value:8+"",min:"0",max:"20"}),movablePointSize:()=>({value:8+"",min:"0",max:"20"}),tableColumnPointSize:()=>({value:8+"",min:"0",max:"20"}),labelAngle:e5,labelSize:()=>({value:"1",min:"0",max:"5"}),lineWidth:()=>({value:2.5+"",min:"0",max:"10"}),resolution:()=>({value:"50",min:"2",max:"100",step:"1"}),tableColumnLineWidth:()=>({value:2.5+"",min:"0",max:"10"}),fillOpacity:()=>({value:.4+"",min:"0",max:"1"}),surfaceOpacity:()=>({value:"0.9",min:"0",max:"1"}),lineOpacity:()=>({value:1+"",min:"0",max:"1"}),tableColumnLineOpacity:()=>u1(1),pointOpacity:()=>u1(1),tableColumnPointOpacity:()=>u1(1),sliderMin:void 0,sliderMax:void 0,sliderStep:void 0,residualVariable:void 0,tableHeader:void 0,tableCellValue:void 0,imageOpacity:()=>({value:"1",min:"0",max:"1"}),imageCenter:void 0,imageHeight:()=>({value:"10",min:"-10",max:"10"}),imageWidth:()=>({value:"10",min:"-10",max:"10"}),imageAngle:e5,tickerMinStep:()=>({value:"0",min:"0"}),tickerHandler:void 0},wee={tone:{paramBounds:r=>r===0?{value:"440",min:"110",max:"880"}:u1(.5)},glider:{paramBounds:r=>{if(r!==0)return u1(.5)}},dilate:{paramBounds:r=>{if(!(r<2))return{value:"2",min:"0",max:"5"}}},rotate:{paramBounds:(r,e)=>{if(!(r<2))return e5(e)}},circle:{paramBounds:r=>{if(r===1)return xee}},normaldist:{paramBounds:r=>{if(r===0)return{min:"-5",max:"5",value:"0"};if(r===1)return xee}},rgb:{paramBounds:r=>({value:"0",min:"0",max:"255",step:"1"})},hsv:{paramBounds:r=>r===0?{value:"0",min:"0",max:"360",step:"1"}:u1(.5)}};function vee(r,e,t){let o=r.map(n=>({location:n.location,parsed:__dcg_shared_module_exports__['sd'](n.latex)})),i={};for(let n of e)for(let a of o){let s=Nye(n,a,t);s&&s.length&&(i[n]=s[0])}return i}function Nye(r,{parsed:e,location:t},o){let i=__dcg_shared_module_exports__['ac'](r);if(e.type==="Identifier"&&e._symbol===i){let a=Fye[t];return a?[a(o)]:void 0}e.type==="Assignment"&&(e=e._expression);let n=[];switch(e.type){case"FunctionCall":{let a=e._symbol;if(wee.hasOwnProperty(a)){let s=wee[a];e.args.forEach((l,c)=>{if(l.type==="Identifier"&&l._symbol===i){let d=s.paramBounds(c,o);d&&n.push(d)}})}break}default:return}return n}var yg=class r{constructor(e=100){this.clear(),this._sizeLimit=e}clone(){let e=new r(this._sizeLimit);return e._stack=this._stack.slice(),e._stackPointer=this._stackPointer,e}clear(){this._stack=[],this._stackPointer=-1}getState(){return this._stack[this._stackPointer]}serializeForBugsnag(){function e(t){try{return JSON.stringify(t,null,2)}catch(o){return"[[could not jsonify]]"}}return{currentState:e(this._stack[this._stackPointer]),undoState:e(this._stack[this._stackPointer-1]),redoState:e(this._stack[this._stackPointer+1])}}addState(e){this.canRedo()&&this._stack.splice(this._stackPointer+1),this._stack.push(e),this._stack.length>this._sizeLimit&&this._stack.shift(),this._stackPointer=this._stack.length-1}replaceState(e){this.canRedo()&&this._stack.splice(this._stackPointer+1),this.replaceInteriorState(e)}replaceInteriorState(e){this._stack.length===0?(this._stack.push(e),this._stackPointer=0):this._stack[this._stackPointer]=e}canUndo(){return this._stackPointer>0}canRedo(){return this._stackPointer<this._stack.length-1}undo(){this.canUndo()&&(this._stackPointer-=1)}redo(){this.canRedo()&&(this._stackPointer+=1)}};function Uye(r){switch(r){case"histogram":case"dotplot":return 12;case"boxplot":return 40}return 1/0}function qye(r){return r==="boxplot"||r==="dotplot"||r=="histogram"}function zye(r){return r==="boxplot"?3:.5}function Hye(r,e){if(r.type==="dotplot"||r.type==="histogram"){let i=Math.max(1,r.xmax-r.xmin)*80/(r.binWidth?r.binWidth:1),n=.5*(e.screen.width-i)/i;return Math.max(.2,n)}return .5}function Kye(r,e,t){r=__dcg_shared_module_exports__['i'](r);let o=1.2;return e&&r.xmax<0&&r.xmin<0&&r.xmax/(r.xmin-r.xmax)<o&&(r.xmax=0),e&&r.xmax>0&&r.xmin>0&&r.xmin/(r.xmax-r.xmin)<o&&(r.xmin=0),t&&r.ymax<0&&r.ymin<0&&r.ymax/(r.ymin-r.ymax)<o&&(r.ymax=0),t&&r.ymax>0&&r.ymin>0&&r.ymin/(r.ymax-r.ymin)<o&&(r.ymin=0),r}function Wye(r,e,t,o){let i=r.type,n=Hye(r,e),a=zye(i),s,l,c,d;if(r.xmin===r.xmax&&(t?(r.xmin-=.5,r.xmax+=.5):(r.xmin*=.5,r.xmax/=.5)),r.ymin===r.ymax&&(o?(r.ymin-=.5,r.ymax+=.5):(r.ymin*=.5,r.ymax/=.5)),t){let p=(r.xmax-r.xmin)*n;s=r.xmin-p,l=r.xmax+p}else{let p=(r.xmax/r.xmin)**n;s=r.xmin/p,l=r.xmax*p}if(o){let p=(r.ymax-r.ymin)*a;c=r.ymin-p,d=r.ymax+p}else{let p=(r.ymax/r.ymin)**a;c=r.ymin/p,d=r.ymax*p}if(qye(i)){let p=e.screen.height/e.screen.width,u=(l-s)*p;if(u>r.ymax-r.ymin&&u<Uye(i)*(r.ymax-r.ymin)){let h=.5*(r.ymax+r.ymin);d=h+.5*u,c=h-.5*u}}return{xmin:s,xmax:l,ymin:c,ymax:d}}function QV(r,e){let t=ME(r,e);if(!t)return!1;let{xAxisScale:o,yAxisScale:i}=e.settings;if(!Co.fromObject(t).isValid({xAxisScale:o,yAxisScale:i}))return!1;let a=e.mapx(t.xmin),s=e.mapx(t.xmax),l=e.mapy(t.ymin),c=e.mapy(t.ymax),d=10;return!(Math.abs(a)<=d&&Math.abs(c)<=d&&Math.abs(s-e.screen.width)<=d&&Math.abs(l-e.screen.height)<=d)}function ME(r,e){let t=1/0,o=-1/0,i=1/0,n=-1/0,a=0,s=r.length,l=e.settings.xAxisScale==="linear",c=e.settings.yAxisScale==="linear";for(let d=0;d<s;d++){let p=Kye(r[d],l,c);if(!isFinite(p.xmax-p.xmin)||!isFinite(p.ymax-p.ymin)){a+=1;continue}if(!l&&!(p.xmax>0&&p.xmin>0)||!c&&!(p.ymax>0&&p.ymin>0)){a+=1;continue}let u=Wye(p,e,l,c);u.xmin<t&&(t=u.xmin),u.xmax>o&&(o=u.xmax),u.ymin<i&&(i=u.ymin),u.ymax>n&&(n=u.ymax)}if(a!==s)return{xmin:t,xmax:o,ymin:i,ymax:n}}function $ye(r){var o,i;let e=r&&r.id,t=[];if(r&&r.type==="table"){r.columnModels.forEach(a=>{t.push(a.id)}),(o=r.regression)!=null&&o.id&&t.push(r.regression.id);let n=ys(r);if(!n){let a=r.controller.getFocusLocation();if((a==null?void 0:a.type)==="table-icon"){let s=r.columnModels.findIndex(l=>l.id===a.columnId);s>=0&&(n={row:0,column:s})}}if(n){let a=r.columnModels[n.column];e=a?a.id:void 0}else e=(i=r.regression)==null?void 0:i.id;return{selected:e?[e]:[],hoistedToTop:t}}return e?{selected:[e],hoistedToTop:[e]}:{selected:[],hoistedToTop:[]}}function Cee(r,e,t){let o={},i={},n=r.getAllSelectedItems();for(let a of n){let s=$ye(a);for(let l of s.selected)o[l]=!0,t.selected[l]||e.selectSketch(l);for(let l of s.hoistedToTop)i[l]=!0,t.hoistedToTop[l]||e.setSketchHoistedToTop(l,!0)}for(let a in t.selected)o[a]||e.deselectSketch(a);for(let a in t.hoistedToTop)i[a]||e.setSketchHoistedToTop(a,!1);return{selected:o,hoistedToTop:i}}function jye(r){for(let e in r)return!1;return!0}function Yye(r){var o;if(r.type!=="expression")return;let e=r.formula.assignment;return e||((o=r.formula.geometry)==null?void 0:o.identifier)}function Xye(r){var t,o,i;let e={lookupIdentifier:{},lookupCalcId:{}};for(let n of r){let a={calcId:n.id,identifier:Yye(n),referencesTheseIdentifiers:{},referencedByTheseCalcIds:{}};e.lookupCalcId[a.calcId]=a,a.identifier&&(e.lookupIdentifier[a.identifier]=a)}for(let n of r){let a=e.lookupCalcId[n.id];if(a){if(n.type==="expression"){n.folderId===__dcg_shared_module_exports__['xb']&&(a.isGarbageCollectable=!n.readonly,(((o=(t=n.formula.geometry)==null?void 0:t.call)==null?void 0:o.symbol)==="segments"||pp(n))&&(a.deleteIfNotReferenced=!0));for(let s of((i=n.formula.geometry)==null?void 0:i.parentDependencies)||[])See(e,a,s)}Kx(n,s=>{let l=s.match(/(\\token{[0-9]+})/g);if(l)for(let c of l){let d=__dcg_shared_module_exports__['ac'](c);d!==a.identifier&&See(e,a,d)}})}}return e}function See(r,e,t){e.referencesTheseIdentifiers[t]=!0;let o=r.lookupIdentifier[t];o&&(o.referencedByTheseCalcIds[e.calcId]=!0)}function Jye(r,e,t){var a;let o=[];for(let s of e){let l=r.lookupCalcId[s];if(!l)continue;o.push(l);let c=l.referencesTheseIdentifiers;for(let d in c){let p=r.lookupIdentifier[d];p&&delete p.referencedByTheseCalcIds[l.calcId]}}let i={};for(let s in t)for(let l of t[s]){let c=r.lookupIdentifier[l];c&&delete c.referencedByTheseCalcIds[s],i[l]=!0}let n={};for(let s of o){let l=s.referencesTheseIdentifiers;for(let d in l)i[d]=!0;let c=s.identifier;if(c){let d=(a=r.lookupIdentifier[c])==null?void 0:a.referencedByTheseCalcIds;if(d)for(let p in d){let u=r.lookupCalcId[p];u&&u.isGarbageCollectable&&(n[p]=!0)}}}for(let s in i){let l=r.lookupIdentifier[s];if(l&&l.deleteIfNotReferenced){let c=l.referencedByTheseCalcIds;l.calcId&&l.isGarbageCollectable&&jye(c)&&(n[l.calcId]=!0)}}for(let s of o)delete r.lookupCalcId[s.calcId],s.identifier&&delete r.lookupIdentifier[s.identifier];return Object.keys(n)}function Eee(r,e,t){var c;let o=r.getAllItemModels(),i=e.map(d=>d.id),n=Xye(o.concat(e)),a={},s={};for(let d in t){let{nextLatex:p}=t[d],u=r.getItemModel(d);if((u==null?void 0:u.type)!=="expression")continue;let h={};for(let y of((c=u.formula.geometry)==null?void 0:c.parentDependencies)||[])h[y]=!0;for(let y in h)kd(p,__dcg_shared_module_exports__['$b'](y))&&delete h[y];let m=Object.keys(h);m.length&&(s[d]=m)}let l=Object.keys(s).length>0;for(;i.length||l;){l=!1,i=Jye(n,i,s);for(let d of i)a[d]=!0}return Object.keys(a)}var Dee=Symbol("privateHistoryProperty"),ZV=class{constructor(e,t){this.currentState=e;this.__historyThatShouldNotBeSerialized=Symbol("__historyThatShouldNotBeSerialized");Object.defineProperty(this,Dee,{value:t.clone(),enumerable:!1,configurable:!1,writable:!1})}toJSON(){throw new Error("Operation unsupported: history should not be serialized.")}};function kee(r){let e=r;return{currentState:e.currentState,history:e[Dee]}}var _ee={version:Od,randomSeed:"",graph:{product:"graphing-3d",threeDMode:!0,viewport:{...__dcg_shared_module_exports__['ub']}},expressions:{list:[{id:"1",type:"expression"}]}};function Tee(r){switch(r){case"letters":return"capitalLetters";case"noQwertyLetters":return"noQwertyCapitalLetters";case"noQwertyCapitalLetters":return"noQwertyLetters";default:return"letters"}}function Gee(r){switch(r){case"mainNumbers":return"mainNumbers3D";default:return r}}function t5(r){return{keypadMinimized:!i2,keypadLayout:"mainNumbers",keypadFunctionsOpen:!1,graphSettingsOpen:!1,addExpressionOpen:!1,expressionsVisible:!!r.expressions,inEditListMode:!1,isFileDraggedOver:!1,expressionsHiddenTime:void 0}}var Zi=__dcg_shared_module_exports__['e'](Z()),eL=class extends Zi.Class{template(){return Zi.createElement("form",{name:Zi.const("open_graph_on_web"),target:Zi.const("_blank"),method:Zi.const("POST"),action:()=>this.props.saveURL(),style:()=>({display:"none"})},Zi.createElement("input",{type:Zi.const("text"),name:Zi.const("is_open_on_web"),value:Zi.const("true")}),Zi.createElement("input",{type:Zi.const("text"),name:Zi.const("my_graphs"),value:Zi.const("false")}),Zi.createElement("input",{type:Zi.const("text"),name:Zi.const("is_update"),value:Zi.const("false")}),Zi.createElement("input",{type:Zi.const("text"),name:Zi.const("calc_state"),value:()=>this.props.stateData()}),Zi.createElement("input",{type:Zi.const("text"),name:Zi.const("thumb_data"),value:()=>this.props.thumbData()}))}};var Mee={xmin:"",xmax:"",xstep:"",ymin:"",ymax:"",ystep:"",zmin:"",zmax:""};function Aee(r){return r in Mee}function Qye(r){let e=r.split("\xD7");return(e.length>1&&e[0]==="1"?e.slice(1):e).join("\\cdot")}function fy(r,e){let t=__dcg_shared_module_exports__['Tb'](r,e),o="";if(t.mantissa)o=Qye(t.mantissa)+"^{"+t.superscript+"}";else{let i=t.string.split("/");i.length===2?i[0][0]==="-"?o="-\\frac{"+i[0].slice(1)+"}{"+i[1]+"}":o="\\frac{"+i[0]+"}{"+i[1]+"}":o=t.string}return o=o.replace(//,"\\pi"),o}function Zye(r,e){let t=e.xAxisScale==="linear"?r.xmax-r.xmin:void 0,o=e.yAxisScale==="linear"?r.ymax-r.ymin:void 0,i={xmin:fy(r.xmin,t),xmax:fy(r.xmax,t),ymin:fy(r.ymin,o),ymax:fy(r.ymax,o)};return r.zmin!==void 0&&r.zmax!==void 0&&(i.zmin=fy(r.zmin,r.zmax-r.zmin),i.zmax=fy(r.zmax,r.zmax-r.zmin)),i}function Iee(r,e){return r===0?"":fy(r,e)}function Vee(r,e){return{...Zye(r,e.scales),xstep:Iee(e.steps.xAxisStep,r.xmax-r.xmin),ystep:Iee(e.steps.yAxisStep,r.ymax-r.ymin)}}function r5(){return{limitLatex:{...Mee}}}function Lee(r){var e;switch(r.type){case"tick":case"tick-ticker":case"evaluator-progress-update":return!1;case"on-evaluator-changes":return!!((e=r.eventUpdates)!=null&&e.userAction);default:return!0}}var by=class{constructor(e){this.__nextItemId=0;this.__pendingImageUploads={};this.__lastSelectedIdsForPropagation={selected:{},hoistedToTop:{}};this.nextSubscription=0;this.subscriptions={};this._queuedCallbacks=[];this._hasUnsavedChanges=!1;this.shouldScrollSelectedItemIntoViewAfterDispatch=!1;this.lastParsableObjects={};this.isExpressionSearchStrValidForReplace=!1;this.isExpressionReplaceStrValidForReplace=!1;this.expressionSearchCount=0;this.expressionSearchOpen=!1;this.geoUIActive=!1;this.showConstructionsOpen=!1;this.activeTool="selection";this.geometryGettingStartedMessageState="pick-a-tool";this.activeTokens={selected:void 0,hovered:void 0};this.apiMethodCallStackInfo={apiMethodCallDepth:0,withHistoryReplacementDepth:0};this.canShowKeyboardShortcuts=!1;this.progressUpdateLegendHidden=!1;this.shellViews={};this.toastData={};this.s=Id(()=>this.graphSettings.config.language);this.raw=(e,t)=>Bs(e,t);this.hasTranslation=e=>{let t=this.graphSettings.config.language;return iG(e,t)};this.unpack=e=>{let t=this.graphSettings.config.language;return Ec(e,t)};this.dispatch=e=>{if(e.type==="blur-focus-location"&&this.dispatcher.isDispatching()){this.runAfterDispatch(()=>{this.dispatch(e)});return}if(e.type==="set-focus-location"&&this.dispatcher.isDispatching()){this.runAfterDispatch(()=>{this.dispatch(e)});return}if(e.type==="tick"&&this.dispatcher.isDispatching()){this.runAfterDispatch(()=>{this.dispatch(e)});return}e.type==="tick"||Hg("dispatch::"+this.bugsnagContext,{type:e.type}),this.dispatcher.isDispatching()&&Hg("dispatch-in-dispatch::"+this.bugsnagContext,{type:e.type}),this.dispatcher.dispatch(e),this.onEventsEmitted&&this.onEventsEmitted(this.enqueuedEvents),this.logEventsFromDispatch(e);let t;for(;t=this._queuedCallbacks.shift();)t()};this._requiresTickNextFrame=!1;this.cachedGeoTokenDepths={};this.cachedGeoTokenInfo={};this.toolPreviewJSONState={};this.updateViews=()=>{for(let e in this.subscriptions)this.subscriptions[e]()};this.bugsnagContext="";this.inPrintMode=!1;this.lastInfiniteScrollFirstDOM=void 0;this.lastInfiniteScrollLastDOM=void 0;this.hasDispatchSinceLastInfiniteScrollUpdate=!1;this.stateStack=new yg;this.isCurrentlyDoingSetState=!1;this.isCurrentlyDoingRestoreState=!1;this.expressionActionsToRestartIfSlow=new Array;this.getQuestIsActive=()=>!1;this.logEvent=e=>{};this.logEventsFromDispatch=e=>{};var t,o;this.graphSettings=e,(o=(t=this.graphSettings).setController)==null||o.call(t,this),this.listModel=DK(this),this.layoutModel=t5(this.graphSettings.config),this.layoutMeasurements={width:0,height:0},this.settingsViewModel=r5(),this.geometryToolbarModel=F6(),this.imageRetryState={lastAttemptTime:0,attempts:0},this.makeGeoAPI(),this.setupDispatcher(),this.toneAllowed()&&(this.toneController=new Q0(this)),this.graphSettings.config.observe("tone",()=>this._updateToneAvailability()),this.graphSettings.config.observe("audio",()=>this._updateToneAvailability())}setShellView(e,t){if(this.shellViews[e])throw new Error(`Shell view is already set: '${e}'.`);this.shellViews[e]=t}getShellView(e){var t;return(t=this.shellViews)==null?void 0:t[e]}hasUnsavedChanges(){return this._hasUnsavedChanges}getExpressionSearchOpen(){return this.expressionSearchOpen}getShowConstructionsOpen(){return this.showConstructionsOpen}getGeoToolbarSuppressedByAuthor(){return this.geometryToolbarModel.toolbar==="none"&&!this.shouldShowAuthorFeatures()}shouldShowGeoToolbar(){return this.isGeoUIActive()&&!this.getGeoToolbarSuppressedByAuthor()}isGeoUIActive(){return this.geoUIActive}isGeoToolActive(){return this.activeTool!=="selection"&&this.activeTool!=="box-selection"}getActiveTool(){return this.activeTool}canExpandListForItem(e){let t=this.getItemModel(e);return t?!this.isGeometry()||this.activeTool!=="selection"&&this.activeTool!=="box-selection"||this.isClickableId(e)||"label"in t&&t.label!=="":!1}getGeoModel(){return this.geoModel}getGeoToolbarGroupKeys(){return L0(this.geometryToolbarModel,this.shouldShowAuthorFeatures()).groups}getGeoToolbarItemsForGroup(e){let{items:t}=L0(this.geometryToolbarModel,this.shouldShowAuthorFeatures());return t[e]}getAllAvailableGeoTools(){let e=L0(this.geometryToolbarModel,this.shouldShowAuthorFeatures()),t=[];for(let o of e.groups){let i=e.items[o];i&&(i.dropdown?t.push(...i.dropdown):t.push(i.current))}return t}getAllVisibleGeoToolbarItems(){let e=this.getGeoToolbarGroupKeys(),t=[];for(let o of e){let i=this.getGeoToolbarItemsForGroup(o);i&&t.push(i)}return t}getTickerOpen(){return this.areActionsEnabled()?this.listModel.ticker.open:!1}getTickerVisible(){return this.getTickerOpen()&&!this.getTicker().filteredBySearch}getTickerPlaying(){return this.areActionsEnabled()?this.listModel.ticker.playing:!1}hasVisibleToast(){return!__dcg_shared_module_exports__['K'](this.toastData)}hasVisibleAndUndoableToast(){return typeof this.toastData.undoCallback=="function"}toastUndo(){typeof this.toastData.undoCallback=="function"&&(this.toastData.undoCallback(),this.dispatch({type:"toast/close"}))}runAfterDispatch(e){this.dispatcher.isDispatching()?this._queuedCallbacks.push(e):e()}enqueueEvent(e,t){var n;let o=this.apiMethodCallStackInfo.apiMethodCallDepth>0,i=t&&!o&&Lee(t)||!!((n=this.enqueuedEvents[e])!=null&&n.isUserInitiated)||e==="userMovedPoint";this.enqueuedEvents[e]={isUserInitiated:i}}getLanguage(){return this.graphSettings.config.language}pushWithHistoryReplacement(){this.apiMethodCallStackInfo.withHistoryReplacementDepth++}popWithHistoryReplacement(){if(this.apiMethodCallStackInfo.withHistoryReplacementDepth--,this.apiMethodCallStackInfo.withHistoryReplacementDepth<0)throw new Error("Programming Error: withHistoryReplacementDepth < 0")}pushAPIMethodCall(){this.apiMethodCallStackInfo.apiMethodCallDepth++}popAPIMethodCall(){this.apiMethodCallStackInfo.apiMethodCallDepth--}getGrapherDimensions(){let e=this.getGrapher();if(!e)return{width:0,height:0};let{width:t,height:o}=e.getProjection().screen;return{width:t,height:o}}setRandomSeed(e){this.graphSettings.setProperty("randomSeed",e)}getRandomSeed(){return this.graphSettings.randomSeed}setIncludeFunctionParametersInRandomSeed(e){this.graphSettings.setProperty("includeFunctionParametersInRandomSeed",e)}getIncludeFunctionParametersInRandomSeed(){return this.graphSettings.includeFunctionParametersInRandomSeed}shouldDispatchTickNextFrame(){return!!this._requiresTickNextFrame}markTickRequiredNextFrame(){this._requiresTickNextFrame=!0}handleTick(e){let t=this.handlePossiblySlowEvaluator();this.areActionsEnabled()&&vK(this.listModel.ticker,{currentFrameTime:e,previousFrameTime:this.lastFrameTime})?this.dispatch({type:"tick-ticker",time:e}):this.shouldDispatchTickNextFrame()?this.dispatch({type:"tick",time:e}):t&&this.dispatch({type:"render"}),this.getGeoModel().isFading()&&this.requestRedrawGraph(),this.lastFrameTime=e}setupDispatcher(){this.dispatcher=new Yu,this.dispatcher.register(e=>{var l;let t=this.getFirstSelectedItem(),o=this.getFocusLocation();this.shouldScrollSelectedItemIntoViewAfterDispatch=!1;let i;this.enqueuedEvents={change:void 0,graphReset:void 0,clearUnsavedChanges:void 0,openDrawer:void 0,showHotkeysModal:void 0,userMovedPoint:void 0,userClickedObject:void 0,userEditedLabel:void 0},e.type==="tick"&&(this._requiresTickNextFrame=!1),this.isCurrentlyDoingSetState=!1,this.isCurrentlyDoingRestoreState=!1,this.handleDispatchedAction(e),this.constrainMultiSelect(),this.updateTheComputedWorld();let n=this.getImageToRetry();(this.getPlayingSliders().length>0||this.isDragDropActive()||n)&&this.markTickRequiredNextFrame(),n&&this.retryLoadingFailedImage(n),this.updateGeometryGettingStartedMessageState(),e.type!=="undo"&&e.type!=="redo"&&e.type!=="restore-history"&&!this.isDragDropActive()&&this.commitUndoRedoSynchronously(e),this.requestParseForAllItems(),this.isCurrentlyDoingSetState=!1,this.isCurrentlyDoingRestoreState=!1,this.enqueuedEvents.change&&((l=this.getGrapher2d())==null||l.markLabelsDirty()),this.enqueuedEvents.clearUnsavedChanges?this._hasUnsavedChanges=!1:this.enqueuedEvents.change&&(this._hasUnsavedChanges=!0);let a=this.getFirstSelectedItem();a?(!t||t.guid!==a.guid)&&(this.shouldScrollSelectedItemIntoViewAfterDispatch=!0):this.shouldScrollSelectedItemIntoViewAfterDispatch=!1;let s=this.getFocusLocation();s&&!__dcg_shared_module_exports__['J'](s,o)&&this.getFocusedItem()==a&&(this.shouldScrollSelectedItemIntoViewAfterDispatch=!0),o&&t&&t.type==="table"&&o.type==="table"&&(!s||s.type!=="table"||o.id!==s.id)&&t.isExpanded&&(Mx(t,!1),s||(i=t)),s&&a&&a.type==="table"&&FH(a),(e.type==="adjust-slider-by-dragging-thumb"||e.type==="adjust-slider-by-keyboard")&&(i=this.getItemModel(e.id)),this.updateRenderShellsBeforePaint(),this.updateViews(),i?this.scrollItemIntoView(i):this.shouldScrollSelectedItemIntoViewAfterDispatch&&this.scrollSelectedItemIntoView(),this.updateDragDrop(),this.updateRenderShellsAfterDispatch()})}updateGeometryGettingStartedMessageState(){if(!this.isGeometry())return;let e=this.geometryGettingStartedMessageState,t=this.getActiveTool(),o=t==="selection"||t==="box-selection"||t==="expression-edit";if(e==="hidden")return;if(this.isGraphSettingsOpen()||this.getGraphSettings().showGrid||this.getGraphSettings().showYAxis){this.geometryGettingStartedMessageState="hidden";return}let i=this.getItemModelByIndex(1);if(this.getItemCount()>2||!i||i.type!=="expression"||i.latex!==""||this.geoModel.getNonObjectsState().ui.currentTool.inputIndex>0){this.geometryGettingStartedMessageState="hidden";return}o||(this.geometryGettingStartedMessageState="construct")}getGeometryGettingStartedMessageState(){return this.geometryGettingStartedMessageState}handleDispatchedAction(e){var t,o,i,n,a,s,l,c,d,p,u,h,m,y,w,S,C,v,E,_;switch(e.type){case"render":break;case"undo":this.isGeoToolActive()&&this.cancelGeoToolplay(),this.undo();break;case"redo":this.isGeoToolActive()&&this.cancelGeoToolplay(),this.redo();break;case"clear-undoredo-history":this.clearUndoRedoHistory();break;case"on-special-key-pressed":e.key==="Enter"?JB(this):e.key==="Up"||e.key==="PageUp"?YV(this):e.key==="Down"||e.key==="PageDown"?XV(this):e.key==="Backspace"?YB(this):e.key==="Delete"&&XB(this);break;case"select-previous-expression":xT(this.listModel);break;case"select-next-expression":wT(this.listModel);break;case"toggle-label-for-all-selected-points":this.toggleLabelForAllSelectedObjects();break;case"set-label-state-for-selected-points":{let x=[];for(let L of this.getAllSelectedItems())L.type==="expression"&&pp(L)&&x.push(L);this.setLabelStateForObjects(x,e.state);break}case"move-selected-item-to-expression-list":{let x=this.getSelectedItem();if(!x||x.type==="folder"||this.isItemReadonly(x.id))return;if(x.type==="expression"){let N=RT(x);N&&mu(this.listModel,N,this.getAutonameLatexForExpression(x,this.findLastSubscriptForLetters()))}db(this.listModel,x.id),"folderId"in x&&x.folderId===__dcg_shared_module_exports__['xb']&&(x.folderId="");let L=this.getItemCount()-1,R=sb(this.listModel,L);if(R&&R.type==="expression"&&R.latex===""){this._toplevelReplaceItemAt(L,x,!1);return}Wc(this.listModel,x)}break;case"update-all-selected-items":{let x=e.update;if(e.update.prop==="folderId"){let L;if(e.update.createFolder){L=this.generateId();let F=this.createItemModel({type:"folder",id:L,title:e.update.value}),ge=this.getItemCount()-1,ne=sb(this.listModel,ge);ne&&ne.type==="expression"&&ne.latex===""?this._toplevelReplaceItemAt(this.getItemCount()-1,F,!1):Wc(this.listModel,F)}else L=e.update.value;let R=this.getItemModel(L);if(!R||R.type!=="folder")return;let N={},z={};this.getAllSelectedItems().forEach(F=>{var ge;if(!(F.type==="folder"||F.folderId===L)&&!this.isItemReadonly(F.id)&&(N[F.id]=F,F.type==="expression")){let ne=(ge=F.formula.geometry)==null?void 0:ge.call;if(ne&&ne.symbol==="apply"){let ae=ne.parents[0],j=ae.type!=="arbitrary-expression"?__dcg_shared_module_exports__['fd'](ae):void 0;j&&(z[j]=!0)}}});for(let F in z){let ge=im(this.listModel,F);ge.length===1&&ge[0].folderId!==L&&(N[ge[0].id]=ge[0])}let A={},U=[];for(let F in N){let ge=N[F];U.push(ge)}U.forEach(F=>{if(F.type==="expression"){let ge=RT(F);ge&&(A[F.id]=ge)}}),U.sort((F,ge)=>F.index-ge.index);let pe=this.findLastSubscriptForLetters();U.forEach(F=>{if(F.type==="expression"){let ge=A[F.id];if(ge){let ne=this.getAutonameLatexForExpression(F,pe);mu(this.listModel,ge,ne)}}}),U.forEach(F=>{db(this.listModel,F.id)});let q=R.index+this.getNumberOfItemsInFolder(L)+1;U.forEach(F=>{wc(this.listModel,F,q),q+=1}),U.forEach(F=>{Qa(F,L)})}else if(x.prop==="visible")this.getAllSelectedItems().forEach(L=>{this.isItemReadonly(L.id)||(this._setItemHidden(L.id,!x.value),x.value===!1&&L.type==="expression"&&dm(L,!1))});else if(e.update.prop==="color"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&FT(R,L)})}else if(e.update.prop==="colorLatex"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&X0(R,L)})}else if(e.update.prop==="showLabel"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&dm(R,L)})}else if(e.update.prop==="label"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&bu(R,L)})}else if(e.update.prop==="dragMode"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&pb(R,L)})}else if(e.update.prop==="lineWidth"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&iw(R,L)})}else if(e.update.prop==="lineOpacity"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&ow(R,L)})}else if(e.update.prop==="lineStyle"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&NT(R,L)})}else if(e.update.prop==="strictIntersection"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"&&YW(R,L)})}else if(e.update.prop==="disableGraphInteractions"){let L=e.update.value;this.getAllSelectedItems().forEach(R=>{R.type==="expression"?AR(R,L):R.type==="image"&&K2(R,L)})}}break;case"delete-all-selected-items":{let{deletedItems:x,readonlyItemsNotDeleted:L}=this.removeListOfItems(this.getSelectedExpressionIds());this.garbageCollectGeo(x,{}),this.ensureAtLeastOneVisibleItem(),x.length>0&&Bt(this.s("graphing-calculator-narration-items-deleted",{count:__dcg_shared_module_exports__['kc'](x.length)})),L>0&&Bt(this.s("graphing-calculator-narration-locked-items-not-deleted",{count:__dcg_shared_module_exports__['kc'](L)})),Te();break}case"upward-delete-selected-expression":QB(this,{moveSelection:!1});break;case"downward-delete-selected-expression":ZB(this,{moveSelection:!1});break;case"table-show-more-rows":{let x=this.getItemModel(e.id);if(!x||x.type!=="table")return;let L=ib(x);if(!L)return;vo(this.listModel,x),Mx(x,!0),Do(this,{type:"table",id:x.id,location:{row:L.min,column:0}})}break;case"navigate-table-by-key":bee(this,e.id,e.key);break;case"delete-item-and-animate-out":this._deleteItemAndAnimateOut(e.id,e.setFocusAfterDelete);break;case"finish-deleting-item-after-animation":this._finishDeletingItemAfterAnimation(e.id,e.setFocusAfterDelete);break;case"expression-zoom-fit":this._expressionZoomFit(e.id,{focusAfterTap:e.focusAfterTap,synchronous:!1,justResiduals:!1});break;case"expression-zoom-fit-residuals":this._expressionZoomFit(e.id,{focusAfterTap:e.focusAfterTap,synchronous:!1,justResiduals:!0});break;case"set-expression-properties-from-api":this._setExpressionPropertiesFromAPI(e.id,e.properties);break;case"add-item-to-end-from-api":this._addItemToEndFromAPI(this.createItemModel(e.state));break;case"duplicate-expression":{let x=this.getItemModel(e.id);if(!x||x.type==="folder")return;this.copyExpressionToIndex(x,x.index+1)}break;case"duplicate-folder":{let{id:x}=e,L=this.getItemModel(x);if(!L||L.type!=="folder")return;let R=this.createItemModel({...j_(L,{stripDefaults:!1}),id:this.generateId()}),N=this.getNumberOfItemsInFolder(x),z=N+1;this._toplevelInsertItemAt(L.index+z,R,!1,void 0);let A=L.index+1,U=A+N;for(let pe=A;pe<=U;pe++){let q=sb(this.listModel,pe);if(!q||q.type==="folder")return;this.copyExpressionToIndex(q,pe+z,R.id)}}break;case"insert-item-at-index":{let x=this.createItemModel(e.state);this._toplevelInsertItemAt(e.index,x,e.focus,e.folderId)}break;case"new-expression-at-end":{this.setGeoTool("selection");let x=this.createItemModel({type:"expression",id:this.generateId(),color:this.getNextColor()});this.setEditListMode(!1),Wc(this.listModel,x),Dn(this,x.id)}break;case"new-expression":{let x=this.createItemModel({type:"expression",id:this.generateId(),color:this.getNextColor()});this.setEditListMode(!1),this._toplevelNewItemAtSelection(x,{shouldFocus:!0}),this._closeAddExpression()}break;case"new-text":{let x=this.createItemModel({id:this.generateId(),type:"text"});this._toplevelNewItemAtSelection(x,{shouldFocus:!0}),this._closeAddExpression()}break;case"new-folder":{let x=this.createItemModel({type:"folder",id:this.generateId()});this._toplevelNewItemAtSelection(x,{shouldFocus:!0}),this._closeAddExpression()}break;case"new-images":this._uploadImagesAndWaitForThemToLoad({files:e.files}),this._closeAddExpression();break;case"change-image":this._uploadImagesAndWaitForThemToLoad({files:e.files,id:e.id});break;case"new-table":{let x=this._createTableItem();this._toplevelNewItemAtSelection(x,{shouldFocus:!0}),this._closeAddExpression()}break;case"paste-table":this._pasteTable(e.data);break;case"convert-or-create-table":this._convertOrCreateTable(e.index);break;case"insert-several-expressions":this.shouldScrollSelectedItemIntoViewAfterDispatch=!0,this._insertSeveralExpressions(e.expressions);break;case"append-number-list":this._appendNumberList(e.latex);break;case"remove-item-by-id":db(this.listModel,e.id);break;case"replace-item-at-index":{let x=this.createItemModel(e.state);this._toplevelReplaceItemAt(e.index,x,e.focus)}break;case"create-sliders-for-item":this.createSlidersForItem(e.id,e.variables);break;case"create-sliders-for-ticker":this.createSlidersForTicker(e.variables);break;case"convert-image-to-draggable":this.convertImageToDraggable(e.id);break;case"start-dragdrop":{let x=this.getItemModel(e.dragTarget.calcId);if(!x)return;let L={x:0,y:0},R=this.getItemRootNodeById(x.id);if(R){let A=R.getBoundingClientRect();L.y=e.grabPt.y-A.top,L.x=e.grabPt.x-A.left}this.isItemSelected(x.id)?vo(this.listModel,x):vo(this.listModel,void 0),this.setGeoTool("selection");let N=!1,z=1;x.type==="folder"&&(z+=this.getNumberOfItemsInFolder(x.id),x.collapsed||(N=!0,Fx(x,!0))),U0(this.listModel,{firstItemId:x.id,numberOfItems:z,expandFolder:N,grabOffset:L,mousePt:e.mousePt,dragTarget:e.dragTarget,renderType:e.dragTarget.type,itemTop:0,itemLeft:0}),this.dragdrop_expressions.startDragging(e.mousePt)}break;case"update-dragdrop":{let x=this.listModel.dragState;if(!x)return;U0(this.listModel,{...x,mousePt:e.mousePt})}break;case"stop-dragdrop":{let x=this.listModel.dragState;if(!x)return;let L=this.getItemModel(x.firstItemId);if(!L)return;L.type==="folder"&&x.expandFolder&&Fx(L,!1),U0(this.listModel,void 0),this.ensureAtLeastOneVisibleItem()}break;case"set-selected-id":{let x=this.getItemModel(e.id);x?e.state==="selected"?vo(this.listModel,x):(e.state,iW(this.listModel,x)):vo(this.listModel,void 0)}break;case"set-all-selected-ids":Q2(this.listModel,e.ids);break;case"toggle-selected-with-multi-select":J2(this.listModel,e.id,e.state);break;case"set-selected-index":{let x=this.getItemModelByIndex(e.index);vo(this.listModel,x)}break;case"set-none-selected":vo(this.listModel,void 0);break;case"commit-tentative-selection":{nW(this.listModel);break}case"clear-tentative-selection":{aW(this.listModel);break}case"set-focus-location":{let x=e.location?e.location.type:"";if(x==="expression"&&this.setGeoTool("selection"),x==="table"&&(this.layoutModel={...this.layoutModel,inEditListMode:!1}),x==="graph-paper"){this.setGraphPaperFocus({isFocused:!0});break}Do(this,e.location)}break;case"focus-first-expression":{this.focusFirstExpression();break}case"move-focus-to-item":Dn(this,e.id,e.where);break;case"blur-focus-location":this.isFocusLocationFocused(e.location)&&Do(this,void 0),((t=e.location)==null?void 0:t.type)==="graph-paper"&&this.setGraphPaperFocus({isFocused:!1});break;case"set-folder-collapsed":{let x=this.getItemModel(e.id);if(!x||x.type!=="folder")return;Fx(x,e.isCollapsed)}break;case"set-all-folders-collapsed":hW(this.listModel,e.isCollapsed);break;case"set-item-secret":{let x=this.getItemModel(e.id);if(!x)return;H_(x,e.isSecret)}break;case"set-item-in-front-of-everything":{let x=this.getItemModel(e.id);if(!x||x.type!=="folder")return;T6(x,e.inFrontOfEverything)}break;case"set-item-readonly":{let{id:x,readonly:L}=e,R=this.getItemModel(x);if(!R)return;if(M0(R,L),R.type==="folder")for(let N of IK(this.listModel,x))M0(N,L)}break;case"set-item-disable-graph-interactions":{let{id:x,disableGraphInteractions:L}=e,R=this.getItemModel(x);if(!R)return;switch(R.type){case"expression":AR(R,L);break;case"image":K2(R,L);break}break}case"set-tablecolumn-disable-graph-interactions":{let{tableId:x,columnId:L,disableGraphInteractions:R}=e,N=this.getItemModel(x);if(!N||N.type!=="table")return;let z=vi(N,L);if(!z)return;b6(z,R);break}case"set-tablecolumn-color":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;s6(x,e.columnId,e.color)}break;case"set-tableregression-color":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;l6(x,e.color)}break;case"set-tablecolumn-colorlatex":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;R_(x,e.columnId,e.colorLatex)}break;case"set-show-cdf":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;p7(x,e.showCDF)}break;case"set-cdf-min":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;kT(x,e.latex)}break;case"set-cdf-max":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;_T(x,e.latex)}break;case"toggle-item-hidden":this._toggleItemHidden(e.id);break;case"toggle-tablecolumn-hidden":this._toggleTableColumnHidden(e.tableId,e.columnId);break;case"toggle-item-settings-menu":this.isItemSettingsMenuOpen(e.menu.guid)?this.closeItemSettingsMenu():(this.listModel.openItemMenu=e.menu,e.menu.focusFirstOption&&(e.menu.type==="geo-tool-dropdown"?Do(this,{type:"geo-basic-tool-menu-item",tool:e.menu.tools[0]}):e.menu.type==="multi-select-more"||e.menu.type==="multi-select-construct"||e.menu.type==="multi-select-style"||e.menu.type==="multi-select-label"?Do(this,{type:"generic-menu",where:"start"}):Do(this,{type:"expression-menu",id:e.menu.model.id,location:"start"})));break;case"close-item-settings-menu":this.closeItemSettingsMenu();break;case"toggle-fraction-evaluation":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;let L=cm(x);qW(x,!L)}break;case"set-item-label":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;bu(x,e.label),this.enqueueEvent("userEditedLabel",e)}break;case"set-item-showlabel":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;dm(x,e.showLabel),!e.showLabel&&!sm(x)&&(iC(x,!1),BT(x,"NONE"))}break;case"set-item-color":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;FT(x,e.color)}break;case"set-item-description":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression"&&x.type!=="image")return;x.type==="expression"?zW(x,e.description):x.type==="image"&&$6(x,e.description)}break;case"set-item-fill":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;mR(x,e.fill),this._setItemHidden(x.id,mw(x))}break;case"set-image-opacity":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;X6(x,e.opacity),this._setItemHidden(x.id,!1)}break;case"set-image-in-foreground":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;q2(x,e.foreground)}break;case"image-upload-error":this.__pendingImageUploads[e.token]&&(delete this.__pendingImageUploads[e.token],this._showToast({message:this.s("graphing-calculator-text-toast-image-upload-failed")}));break;case"image-upload-success":{if(this.__pendingImageUploads[e.token])if(delete this.__pendingImageUploads[e.token],e.id){let x=this.getItemModel(e.id);x&&x.type==="image"&&J6(x,e.url)}else{let x=this.createItemModel({type:"image",id:this.generateId(),width:e.width,height:e.height,image_url:e.url,name:e.name});this._toplevelNewItemAtSelection(x,{shouldFocus:!1})}this.isUploadingImages()||(this.toastData={})}break;case"image-load-success":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;nT(x,"loaded"),this.imageRetryState={lastAttemptTime:0,attempts:0}}break;case"image-load-error":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;nT(x,"failed")}break;case"image-retry-loading":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;H2(x)}break;case"set-item-dragmode":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;pb(x,e.dragMode)}break;case"set-tablecolumn-dragmode":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;a6(x,e.columnId,e.dragMode),e.dragMode!=="NONE"&&this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-points":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;V2(x,e.columnId,e.bool),this._setTableColumnHidden(e.tableId,e.columnId,F_(x,e.columnId))}break;case"set-tablecolumn-lines":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;o6(x,e.columnId,e.bool),this._setTableColumnHidden(e.tableId,e.columnId,F_(x,e.columnId))}break;case"set-tablecolumn-linestyle":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;i6(x,e.columnId,e.lineStyle),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-linewidth":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;V_(x,e.columnId,e.lineWidth),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-lineopacity":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;L_(x,e.columnId,e.lineOpacity),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-pointsize":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;P_(x,e.columnId,e.pointSize),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-pointopacity":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;O_(x,e.columnId,e.pointOpacity),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-tablecolumn-pointstyle":{let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;r6(x,e.columnId,e.pointStyle),this._setTableColumnHidden(e.tableId,e.columnId,!1)}break;case"set-item-points":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;fR(x,e.points),this._setItemHidden(e.id,mw(x)),!e.points&&x.dragMode!=="NONE"&&pb(x,"NONE")}break;case"set-item-pointstyle":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;bR(x,e.pointStyle),this._setItemHidden(e.id,!1)}break;case"set-item-lines":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;yR(x,e.lines),this._setItemHidden(e.id,mw(x))}break;case"set-item-extend-to-3D":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;KW(x,e.extendTo3D),this._setItemHidden(e.id,!1);let L=(o=this.grapher3d)==null?void 0:o.transition;L&&e.extendTo3D&&(L.objectIdExtendingTo3D&&((i=this.grapher3d)==null||i.webglLayer.setZboundsOnSurfaces(L.objectIdExtendingTo3D,-1/0,1/0)),L.objectIdExtendingTo3D=x.id,L.startTime=-1,L.duration=150)}break;case"set-item-linestyle":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;NT(x,e.lineStyle),this._setItemHidden(e.id,!1)}break;case"set-item-arrow-mode":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;WW(x,e.value),this._setItemHidden(e.id,!1);break}case"set-item-label-dropdown-open":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;HW(x,e.open)}break;case"set-item-fillopacity":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;W0(x,e.fillOpacity),this._setItemHidden(e.id,!1)}break;case"set-item-surfaceopacity":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;$0(x,e.surfaceOpacity),this._setItemHidden(e.id,!1)}break;case"set-item-lineopacity":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;ow(x,e.lineOpacity),this._setItemHidden(e.id,!1)}break;case"set-item-pointopacity":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;j0(x,e.pointOpacity),x.showLabel||this._setItemHidden(e.id,!1)}break;case"set-item-pointsize":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;Y0(x,e.pointSize),this._setItemHidden(e.id,!1)}break;case"set-item-linewidth":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;iw(x,e.lineWidth),this._setItemHidden(e.id,!1)}break;case"set-item-resolution":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;ET(x,e.resolution),this._setItemHidden(e.id,!1)}break;case"set-item-colorlatex":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;X0(x,e.colorLatex)}break;case"set-item-labelSize":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;J0(x,e.labelSize)}break;case"set-item-labelangle":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;DT(x,e.labelAngle)}break;case"set-item-label-orientation":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;xR(x,e.labelOrientation)}break;case"set-suppress-text-outline":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;$W(x,e.suppressTextOutline)}break;case"set-item-interactive-label":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;iC(x,e.interactiveLabel),e.interactiveLabel&&BT(x,"NONE")}break;case"set-item-editable-label-mode":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;x.editableLabelMode!=="NONE"&&e.editableLabelMode!=="NONE"&&x.editableLabelMode!==e.editableLabelMode&&bu(x,""),BT(x,e.editableLabelMode),e.editableLabelMode!=="NONE"&&iC(x,!1)}break;case"plot-residuals":{let x=this.getItemModel(e.id);if(!x)return;let L;if(x.type==="expression"?L=x.formula.regression:x.type==="table"&&((a=(n=x.formula)==null?void 0:n.table_regression)==null?void 0:a.status)==="success"&&(L=x.formula.table_regression.result),!L)return;let R=L.residualSuggestionId;if(!R)return;let N=this.getItemModel(R);if(!N)return;A_(N,{latex:L.residualVariable,columnIndex:N.columnModels.length-1}),Do(this,{type:"regression-output",id:e.id,parameter:"residual-zoom"})}break;case"toggle-logmode":{let x=this.getItemModel(e.id);if(!x)return;let L;x.type==="expression"?(L=x.isLogModeRegression,gR(x,!L)):x.type==="table"&&x.regression&&(L=x.regression.isLogMode,c6(x,!L)),L!==void 0&&this.logEvent({category:"regressions",action:L?"disable-log-mode":"enable-log-mode"})}break;case"set-item-latex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;let L=e.latex,R=x.latex;if(this.garbageCollectGeo([],{[x.id]:{prevLatex:R,nextLatex:L}}),(L==='"'||L==="note")&&this.areNotesEnabled()){let N=this.createItemModel({id:this.generateId(),type:"text"});this._toplevelReplaceItemAt(x.index,N,!0)}else if(L==="")b7(x);else if(L==="ticker"&&this.canAddTicker())this.listModel.ticker.open=!0,this.focusLocation={type:"ticker",location:"handler"},this._removeExpressionSynchronously(x);else if(L==="folder"&&this.areFoldersEnabled()){let N=this.createItemModel({id:this.generateId(),type:"folder"});il(x)?(this._toplevelNewItemAtSelection(N,{shouldFocus:!0}),Al(x,"")):this._toplevelReplaceItemAt(x.index,N,!0)}else if(L==="table"){let N=this._createTableItem();this._toplevelReplaceItemAt(x.index,N,!0)}else!this.isGeometry()&&(L==="betchacant"||L==="pride"||L==="teapot"&&this.is3dProduct())?this.runAfterDispatch(()=>{this.triggerEasterEgg&&this.triggerEasterEgg(L)}):(Al(x,L),e.source==="user-edit"&&this.trackActionForPotentialEvaluatorRestart("edit",e.id))}break;case"set-visualization-prop":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;TW(x,e.prop,e.value)}break;case"set-clickableinfo-prop":{let x=this.getItemModel(e.id);if(!x)return;x.type==="expression"?GW(x,e.prop,e.value):x.type==="image"&&aT(x,e.prop,e.value)}break;case"set-clickableinfo-rule-latex":{let x=this.getItemModel(e.id);if(!x)return;x.type==="expression"?vT(x,e.latex):x.type==="image"&&iK(x,e.latex)}break;case"set-folder-title":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="folder")return;D6(x,e.title)}break;case"set-image-mq-attribute":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;xc(x,e.attribute,e.latex)}break;case"set-image-name":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;j6(x,e.name)}break;case"set-image-draggable":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;let L=Ux(x);if(!L)return;U2(x,e.draggable),e.draggable&&(Ci(L)==="NONE"||L.dragMode==="AUTO")&&pb(L,"XY")}break;case"update-degree-mode":{if(this.isComplexModeEnabled())return;this.graphSettings.setProperty("degreeMode",e.mode);break}case"set-graph-settings":{for(let x in e)x!=="type"&&(x==="xAxisScale"?this.switchAxisScale("xAxisScale",e.xAxisScale):x==="yAxisScale"?this.switchAxisScale("yAxisScale",e.yAxisScale):this.graphSettings.setProperty(x,e[x]));this.grapher3d&&this.isThreeDMode()&&(this.grapher2d.redrawAllLayersSynchronously(),"backgroundColor3d"in e&&this.grapher3d.webglLayer.setBackgroundColor(e.backgroundColor3d),this.apply3dProps(e))}break;case"set-polar-mode":if(this.graphSettings.setProperty("polarMode",e.polarMode),e.polarMode){let x=this.graphSettings.xAxisScale==="logarithmic"||this.graphSettings.yAxisScale==="logarithmic",L=this.getGrapher2d();x&&L&&(this.graphSettings.setProperty("xAxisScale","linear"),this.graphSettings.setProperty("yAxisScale","linear"),L.viewportController.setViewport(L.getDefaultViewport()),L.getProjection().updateScalePairs())}break;case"set-domain-minlatex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;Gl(x,e.latex,e.variable)}break;case"set-domain-maxlatex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;Il(x,e.latex,e.variable)}break;case"set-note-text":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="text")return;W2(x,e.text)}break;case"set-edit-list-mode":{let x=cb(this.listModel);if(this.setEditListMode(e.isEditListMode),e.focusExpressionList){if(x===void 0&&(x=this.getItemModelByIndex(0)),!x)return;Dn(this,x.id,x.type==="table"&&e.isEditListMode?"container":"start")}else vo(this.listModel,void 0),Do(this,void 0)}break;case"set-ghost-mode":this.getGraphSettings().config.setProperty("ghostMode",e.value);break;case"set-projector-mode":this.getGraphSettings().config.setProperty("projectorMode",e.value),this.isThreeDMode()&&this.grapher2d.redrawAllLayersSynchronously();break;case"set-inverted-colors":this.getGraphSettings().config.setProperty("invertedColors",e.value);break;case"set-tablecell-latex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.tableId);if(!x||x.type!=="table")return;Ih(x,e.cell,e.latex)}break;case"set-state":this.externalSetState(e.state,e.opts);break;case"set-blank":this.externalSetState(this.getBlankState({degreeMode:e.degreeMode}),e.opts);break;case"restore-history":{let{currentState:x,history:L}=kee(e.history);this.setState(x),this.stateStack=L.clone()}break;case"clear-unsaved-changes":this.enqueueEvent("clearUnsavedChanges",e);break;case"reset-graph":{let x=this.getState();this.externalSetState(this.graphSettings.defaultState,{allowUndo:!0}),this.setGeoTool("selection"),this.graphSettings.config.expressions?this.focusFirstExpression():this.setGraphPaperFocus({isFocused:!0}),this._showToast({message:this.s("graphing-calculator-text-toast-graph-reset"),undoCallback:()=>this.dispatch({type:"set-state",state:x,opts:{allowUndo:!0}})}),this.enqueueEvent("graphReset",e)}break;case"clear-graph":{if(this.triggerClearGraph){this.runAfterDispatch(()=>this.triggerClearGraph());return}let x=this.getState();this.externalSetState(this.getBlankState(),{allowUndo:!0});let L=this.getItemModelByIndex(0);L&&Dn(this,L.id,"end"),this._showToast({message:this.s("graphing-calculator-text-toast-graph-cleared"),undoCallback:()=>this.dispatch({type:"set-state",state:x,opts:{allowUndo:!0}})}),this.enqueueEvent("graphReset",e)}break;case"hide-progress-update-legend":this.progressUpdateLegendHidden=!0;break;case"evaluator-progress-update":this.handleEvaluatorProgressUpdates();break;case"on-evaluator-changes":{if(this.onEvaluatorChangesSpy&&this.onEvaluatorChangesSpy(e.changes,e.timingData,e.graphData,e.eventUpdates),this.clearSlowEvaluatorTracking(),this.evaluator.cancelRestartWorker(),rW(this.listModel,e.changes,e.dependencyOrder),(s=this.toneController)==null||s.recomputeAudio(),e.type==="on-evaluator-changes"&&!this.getIncludeFunctionParametersInRandomSeed()&&!lW(this.listModel)&&this.stateStack.getState()&&this.setIncludeFunctionParametersInRandomSeed(!0),!e.graphData)break;for(let x in e.graphData.addedGraphs){let L=e.graphData.addedGraphs[x];if(__dcg_shared_module_exports__['Zc'](L)){let R=L.filter(z=>!__dcg_shared_module_exports__['Dd'](z.graphMode)),N=L.filter(z=>__dcg_shared_module_exports__['Dd'](z.graphMode));(l=this.grapher2d)==null||l.updateSketch(x,R),(c=this.grapher3d)==null||c.updateSketch(x,N),tW(this.listModel,x,L)}}for(let x in e.graphData.removedGraphs)(d=this.grapher2d)==null||d.removeGraphSketch(x),(p=this.grapher3d)==null||p.removeGraphSketch(x);if(this.isThreeDMode())(u=this.grapher2d)==null||u.redrawAllLayersSynchronously();else{for(let x in e.graphData.intersections){let L=e.graphData.intersections[x];__dcg_shared_module_exports__['Zc'](L)&&((h=this.grapher2d)==null||h.updateIntersections(x,L))}(m=this.get2dPOIController())==null||m.handleTraceUpdate(),(y=this.getAudioGraph())==null||y.handleEvaluatorChange(e.graphData)}if(e.eventUpdates){let x=!1;for(let L in e.eventUpdates.updates)if(this.doesIdentifierBlockActionUpdate(L)){x=!0;break}if(!x){for(let L in e.eventUpdates.updates)this.updateLatexForIdentifier(L,e.eventUpdates.updates[L]);e.eventUpdates.objectClicked&&this.enqueueEvent("userClickedObject",e),this.onActionUpdatesAppliedSpy&&this.onActionUpdatesAppliedSpy(e.eventUpdates)}}}break;case"add-helper-expression":zK(this.listModel,e.state);break;case"tick":this._tickSliders(e.time);break;case"tick-ticker":this.tickTicker(e.time);break;case"adjust-slider-by-keyboard":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;vW(x,e.adjustment)}break;case"adjust-slider-by-dragging-thumb":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;CW(x,e.target)}break;case"set-slider-minlatex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;tw(x,e.latex)}break;case"set-slider-maxlatex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;rw(x,e.latex)}break;case"set-slider-steplatex":{this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;K0(x,e.latex)}break;case"set-slider-dragging":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;oC(x,e.dragging)}break;case"play-slider-from-min":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;let L=jc(x);if(isNaN(L))return;let R=lm(x.latex,L);Cc(x,!1),Al(x,R),Cc(x,!0)}break;case"set-slider-isplaying":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;Cc(x,e.isPlaying)}break;case"set-slider-loopmode":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;BW(x,e.loopMode)}break;case"set-slider-animationperiod":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression")return;UW(x,e.animationPeriod)}break;case"show-expressions-list":this._showExpressions(e.focusHideIcon);break;case"hide-expressions-list":this._hideExpressions(e.focusShowIcon);break;case"open-drawer":this.enqueueEvent("openDrawer",e);break;case"re-randomize":this.setRandomSeed(eu());break;case"resize-exp-list":this._setExpListWidth(e.expListWidth);break;case"toast/show":this._showToast(e.toast);break;case"toast/close":this.closeToast();break;case"toast/undo":let T=this.toastData.undoCallback;T&&this.runAfterDispatch(T),this.toastData={};break;case"toast/learn-more":let I=this.toastData.learnMoreCallback;I&&this.runAfterDispatch(I),this.toastData={};break;case"start-moving-points":$Z(this,this.listModel,e.points);break;case"stop-moving-points":YZ(this,e.points);break;case"on-move-points":jZ(this,e.points,e.previousScreenPts,e.screenPts,e.projection,e.transform,e.keyboardDirection)&&this.enqueueEvent("userMovedPoint",e);break;case"commit-user-requested-viewport":this._commitUserRequestedViewport(e.viewport);break;case"commit-user-requested-rotation":this.graphSettings.setProperty("worldRotation3D",e.worldRotation3D),this.graphSettings.setProperty("axis3D",e.axis3D),this.graphSettings.setProperty("speed3D",e.speed3D);break;case"toggle-lock-viewport":this.graphSettings.setProperty("userLockedViewport",!this.graphSettings.userLockedViewport);break;case"toggle-complex-mode":{let x=this.getState({avoidBackMigration:!0});x.graph.complex=!x.graph.complex,x.graph.degreeMode=!1,this.setState(x,{allowUndo:!0});break}case"set-axis-limit-latex":this._setAxisLimitLatex(e.limit,e.latex),e.updateYZAlso&&(this._setAxisLimitLatex(e.limit==="xmin"?"ymin":"ymax",e.latex),this._setAxisLimitLatex(e.limit==="xmin"?"zmin":"zmax",e.latex)),this.lastDirectlyEditedViewport=(w=this.getGrapher())==null?void 0:w.getCurrentViewport();break;case"toggle-graph-settings":this.layoutModel={...this.layoutModel,graphSettingsOpen:!this.layoutModel.graphSettingsOpen},vo(this.listModel,void 0),e.focusOnOpen&&(this.layoutModel.graphSettingsOpen?this.is3dProduct()?Do(this,{type:"settings",location:"reverse-contrast"}):this.getGraphSettings().config.projectorMode?Do(this,{type:"settings",location:"large-size"}):Do(this,{type:"settings",location:"default-size"}):Do(this,{type:"settings",location:"icon"}));break;case"close-graph-settings":this.layoutModel={...this.layoutModel,graphSettingsOpen:!1},e.focusIconAfterClose&&Do(this,{type:"settings",location:"icon"});break;case"toggle-add-expression":this.layoutModel={...this.layoutModel,addExpressionOpen:!this.layoutModel.addExpressionOpen},e.focusOnOpen&&this.layoutModel.addExpressionOpen&&Do(this,{type:"add-expression-btn"});break;case"close-add-expression":this._closeAddExpression(),e.focusIconAfterClose&&Do(this,{type:"add-item-btn"});break;case"ui/container-resized":this.layoutMeasurements={width:e.size.width,height:e.size.height},this.shouldScrollSelectedItemIntoViewAfterDispatch=!0;break;case"enter-printmode":this.inPrintMode=!0;break;case"exit-printmode":this.inPrintMode=!1;break;case"expression-size-exceeded":this._showToast({message:this.s("graphing-calculator-text-toast-expression-size-limit")});break;case"keypad/set-layout":this.layoutModel={...this.layoutModel,keypadLayout:e.layout,keypadFunctionsOpen:!1};break;case"keypad/set-minimized":this.layoutModel={...this.layoutModel,keypadMinimized:e.minimized,keypadLayout:"mainNumbers"},this.shouldScrollSelectedItemIntoViewAfterDispatch=!0,this.needsFakeKeypad()||gee(this),Te(e.minimized?this.s("graphing-calculator-narration-keypad-hidden"):this.s("graphing-calculator-narration-keypad-visible"));break;case"keypad/type-text":this.layoutModel={...this.layoutModel,keypadFunctionsOpen:!1},this.runAfterDispatch(()=>{let x=Ze.getFocusedMathquill();x&&Ze.canAcceptText(x,this.getCapExpressionSize(),e.text)&&(x.typedText(e.text),Ze.simulateUserChangedLatex(x))});break;case"keypad/press-key":this.layoutModel={...this.layoutModel,keypadFunctionsOpen:!1},this.runAfterDispatch(()=>{let x=Ze.getFocusedMathquill();x&&Ze.simulateKeypressFromKeypad(x,e.key)});break;case"keypad/audio-trace":this.handleAudioTraceCommand(e.command);break;case"set-audio-trace-speed":this.setAudioTraceSpeed(e.speed);break;case"keypad/custom-command":this.layoutModel={...this.layoutModel,keypadFunctionsOpen:!1},this.runAfterDispatch(()=>{let x=Ze.getFocusedMathquill();x&&(JV(x,e.command,{capExpressionSize:this.getCapExpressionSize()}),Ze.simulateUserChangedLatex(x))});break;case"keypad/shift":this.layoutModel={...this.layoutModel,keypadLayout:Tee(this.getKeypadLayout()),keypadFunctionsOpen:!1};break;case"keypad/123":this.layoutModel={...this.layoutModel,keypadLayout:"mainNumbers",keypadFunctionsOpen:!1};break;case"keypad/abc":this.isQwertyKeyboardEnabled()?this.layoutModel={...this.layoutModel,keypadLayout:"letters",keypadFunctionsOpen:!1}:this.layoutModel={...this.layoutModel,keypadLayout:"noQwertyLetters",keypadFunctionsOpen:!1};break;case"keypad/audio":this.layoutModel={...this.layoutModel,keypadMinimized:!1,keypadLayout:"audio",keypadFunctionsOpen:!1};break;case"keypad/functions":this.layoutModel={...this.layoutModel,keypadFunctionsOpen:!this.isKeypadFunctionsPopoverOpen()};break;case"grapher/drag-start":break;case"grapher/drag-move":break;case"grapher/drag-end":break;case"open-on-web":this._openOnWeb();break;case"file-is-dragged-over":this.listModel.openItemMenu=void 0,this.layoutModel={...this.layoutModel,isFileDraggedOver:!0};break;case"file-is-not-dragged-over":this.layoutModel={...this.layoutModel,isFileDraggedOver:!1};break;case"zoom":(S=this.getGrapher())==null||S.viewportController.zoom(e.direction);break;case"set-hovered-image":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;aT(x,"hoveredImage",e.url)}break;case"set-depressed-image":{let x=this.getItemModel(e.id);if(!x||x.type!=="image")return;aT(x,"depressedImage",e.url)}break;case"clickable-item-clicked":this.handleClickableItemClicked(e.id,e.listIndex);break;case"action-single-step":{let x=this.getItemModel(e.id);if(!x||x.type!=="expression"||!x.formula.action_value)return;this.evaluator.addActionStepEvent(x.id)}break;case"update-expression-search-str":this.updateExpressionSearchStr(e.str);break;case"update-expression-replace-str":this.updateExpressionReplaceStr(e.str);break;case"rename-identifier-global":mu(this.listModel,e.search,e.replace);break;case"rename-identifier-in-item":let P=this.getItemModel(e.id);P&&P.type==="folder"?mu(this.listModel,e.search,e.replace,{limitToFolder:e.id}):mu(this.listModel,e.search,e.replace,{limitToItem:e.id});break;case"update-ticker-handlerlatex":this.updateTickerHandlerLatex(e.latex);break;case"update-ticker-minsteplatex":this.updateTickerMinStepLatex(e.latex);break;case"set-braille-mode":this.setBrailleMode(e.mode);break;case"set-six-key-input":this.setSixKeyInput(e.useSixKeyInput);break;case"set-show-constructions-open":if(this.showConstructionsOpen=e.open,e.setFocus)if(!e.open)Do(this,{type:"geo-show-constructions-icon"});else for(let x in this.cachedGeoTokenInfo){let{calcId:L}=this.cachedGeoTokenInfo[x];if(this.getItemModel(L)){Do(this,{type:"geo-token",identifier:x});break}}break;case"select-geo-tool":this.listModel.openItemMenu=void 0,this.setGeoTool(e.tool),e.forceSingleUse&&this.geoModel.markCurrentToolSingleUse(),__dcg_shared_module_exports__['gd'](e.tool)||e.tool==="selection"||vo(this.listModel,void 0),e.focusGraphPaper&&this.setGraphPaperFocus({isFocused:!0}),this.closeToast();break;case"cancel-geo-toolplay":this.cancelGeoToolplay(),this.geoModel.getNonObjectsState().ui.currentTool.forceSingleUse&&this.setGeoTool("selection");break;case"update-click-to-insert-mode":this.getGeoModel().setClickToInsertMode(e.clickToInsertMode);break;case"commit-geo-objects":{let x=[],L=[],R=this.findLastSubscriptForLetters(),N={},z=ne=>{let ae=N[ne];if(ae)return ae.assignmentLatex;let j=this.getItemModel(ne);if(!j||j.type!=="expression")return ne;let oe=this._autoNameExpression(j,R);return ae=N[ne]={model:j,assignmentLatex:oe},ae.assignmentLatex},A=[],U=P3(e.committed,{isBeingCommitted:!0,getVariableNameForId:z});for(let ne in e.committed){let ae=e.committed[ne];__dcg_shared_module_exports__['gd'](ae.type)&&A.push(ne);let j=U[ne];(j==null?void 0:j.type)==="assignment"&&(j.sliderInfo?L.push({latex:j.latex,color:j.color,sliderInfo:j.sliderInfo}):x.push({...j,tokenId:ne}))}let pe=this.listModel.__toolPreviewIdToModel;if(x.length){let ne=this.getGeometryFolder(),ae=ne?ne.index+this.getNumberOfItemsInFolder(ne.id)+1:0;x.forEach(j=>{var Y;let oe;for(let fe in pe){let ye=pe[fe];if(((Y=xn(ye))==null?void 0:Y.latex)===j.tokenId){oe=ye;break}}oe?(oe.latex=j.latex,oe.color=j.color,oe.showLabel=!!j.showLabel,oe.showAngleLabel=j.showAngleLabel!==!1,ne&&(oe.folderId=ne.id)):oe=this.createItemModel({id:this.generateId(),type:"expression",showLabel:j.showLabel,showAngleLabel:j.showAngleLabel,latex:j.latex,folderId:ne&&ne.id,color:j.color}),ne?(wc(this.listModel,oe,ae),ae+=1):Wc(this.listModel,oe),this.getGeoModel().recordCommittedOutput(oe.id)})}L.forEach(ne=>{let ae;for(let j in pe){let oe=pe[j];if(oe.latex===ne.latex){ae=oe;break}}ae?(ae.latex=ne.latex,ae.color=ne.color,tw(ae,ne.sliderInfo.min),rw(ae,ne.sliderInfo.max)):ae=this.createItemModel({id:this.generateId(),type:"expression",latex:ne.latex,color:ne.color,slider:{hardMin:!0,hardMax:!0,min:ne.sliderInfo.min,max:ne.sliderInfo.max}}),wc(this.listModel,ae,0),this.getGeoModel().recordCommittedOutput(ae.id)}),A.length===1&&this.transformAllSelectedItemsByAssignmentLatex(A[0]),(this.geoModel.isCurrentToolSingleUse()||e.clearToolAndSelection)&&this.setGeoTool("selection"),e.clearToolAndSelection&&vo(this.listModel,void 0);let q=e.toolIdToLatex[1],F=U[q],ge=(F==null?void 0:F.type)==="inline"?F.rhs:q;if(this.geoModel.getToolMode()==="expression-edit"&&ge){let ne=L3(ge,z);this.writeIdentifierIntoCurrentMathquill(ne)}this.isGeometry()&&this.getGeoModel().updateFadeAnimations()}break;case"rename-identifier":{let x=e.from,L=e.to,R=__dcg_shared_module_exports__['ac'](x),N=this.getGeometryFolder();N&&this.getItemsByIdentifier(R).forEach(z=>{e.geoFolder&&z.folderId!==N.id?(Qa(z,N.id),am(this.listModel,z.index,N.index+1,1)):!e.geoFolder&&z.folderId===N.id&&(am(this.listModel,z.index,N.index+this.getNumberOfItemsInFolder(N.id),1),Qa(z,""))}),mu(this.listModel,x,L)}break;case"set-active-token":this.activeTokens[e.style]=e.identifier;break;case"unset-active-token":this.activeTokens[e.style]===e.identifier&&(this.activeTokens[e.style]=void 0);break;case"select-expression-that-defines-token":{let x=this.getExpressionIdForIdentifier(e.identifier);if(!x||(this.setGeoTool("selection"),this.isItemNotSelectableBecauseItsSecret(x)))return;e.multiSelectMode||e.toggle?J2(this.listModel,x,"selected"):this.tryInsertTokenIntoMathquill(x,void 0)||vo(this.listModel,this.getItemModel(x))}break;case"close-expression-search":this.closeExpressionsSearch();break;case"open-expression-search":this.expressionSearchOpen=!0,this.focusLocation={type:"search-expressions"};let O=e.latex;e.rename&&!ol(O)&&(O="");let W=e.rename?O?`\\operatorname{rename}\\ ${O}\\to`:"\\operatorname{rename}\\ ":O;this.updateExpressionSearchStr(W);break;case"open-ticker":this.listModel.ticker.open=!0,this.focusLocation={type:"ticker",location:"handler"},this._closeAddExpression();break;case"close-ticker":this.listModel.ticker.open=!1,this.listModel.ticker.playing=!1,this.listModel.ticker.minStepLatex="",this.listModel.ticker.handlerLatex="";break;case"toggle-ticker":this.listModel.ticker.playing=!this.listModel.ticker.playing,this.listModel.ticker.lastTickTime=void 0,this.pauseAllSliders();break;case"set-tool-preview-state":this.setToolPreviewState(e.state);break;case"apply-transformation-to-selected":this.transformAllSelectedItemsByAssignmentLatex(e.assignmentLatex),this.closeItemSettingsMenu();break;case"set-geometry-toolbar":{N6(this.geometryToolbarModel,e.toolbar);break}case"set-geometry-custom-toolbar-setting":{X_(this.geometryToolbarModel,e.tool,e.value);break}case"set-author-mode":{this.setAuthorMode(e.enabled);break}case"set-translucent-surfaces":{this.getGraphSettings().config.setProperty("translucentSurfaces",e.value);break}case"set-perspective-distortion":{this.getGraphSettings().config.setProperty("perspectiveDistortion",e.value),(C=this.grapher3d)==null||C.redrawAllLayers();break}case"mute-global":case"unmute-global":{e.type==="unmute-global"&&this.runAfterDispatch(()=>{var x;(x=this.getAudioGraph())==null||x.exitAudioTrace()}),(v=this.toneController)==null||v.handleAction(e),this.getGraphSettings().config.setProperty("muted",e.type==="mute-global");break}case"mark-too-complex-for-gl":{for(let x of e.errors){let L=this.getItemModel(x);L&&L.type==="expression"&&(L.expressionTooComplex=!0)}for(let x of e.fixed){let L=this.getItemModel(x);L&&L.type==="expression"&&(L.expressionTooComplex=!1)}break}case"update-legacy-random-seed-behavior":{this.setIncludeFunctionParametersInRandomSeed(!0),this.setState(this.getState(),{allowUndo:!0});break}case"add-poi-expression":{let x=this.getNextColor();x===Px&&(x=this.getNextColor());let L=this.createItemModel({type:"expression",id:this.generateId(),latex:e.latex,color:x});this.setEditListMode(!1),Wc(this.listModel,L),Dn(this,L.id);break}case"create-table-regression":{let x=this.getItemModel(e.tableId);if((x==null?void 0:x.type)==="table"&&this.areTableRegressionsEnabled()){let L=e.columnIds;if(!L){let R=x.columnModels.slice(1).filter(N=>up(N)&&rm(N));if(R.length===0)break;L={x:x.columnModels[0].id,y:R[0].id}}I0(x,{type:e.regressionType,columnIds:L,id:this.generateId(),color:this.getNextColor(),lineStyle:"SOLID",hidden:!1,isLogMode:!1,residualVariable:void 0}),Do(this,{type:"table-regression-type-dropdown",id:e.tableId})}break}case"remove-table-regression":{let x=this.getItemModel(e.tableId);if((x==null?void 0:x.type)==="table"){if(((_=(E=x.formula)==null?void 0:E.table_regression)==null?void 0:_.status)==="success"){let R=x.formula.table_regression.result.residualVariable;if(R){let N=x.columnModels.findIndex(z=>z.latex===R);N>=0&&_0(x,N)}}I0(x,void 0),Do(this,{type:"add-table-regression-btn",id:e.tableId})}break}case"update-table-regression":{let x=this.getItemModel(e.tableId);if((x==null?void 0:x.type)==="table"&&x.regression){let L={...x.regression,...e.update};I0(x,L)}break}case"export-table-regression":{this.exportTableRegression(e.mode,e.tableId);break}default:return e}}areTableRegressionsEnabled(){return this.getGraphSettings().config.tableRegressions}switchAxisScale(e,t){var i;if(!t||t===this.graphSettings[e])return;this.graphSettings.setProperty("polarMode",!1);let o;this.getAllItemModels().forEach(n=>{if(this.isExpressionZoomFit(n)){if(!this.getBoundingBoxesForZoomFit(n))return;o=n.id}}),this.graphSettings.setProperty(e,t),(i=this.getGrapher2d())==null||i.getProjection().updateScalePairs(),!(o&&this._expressionZoomFit(o,{focusAfterTap:!1,synchronous:!0,justResiduals:!1}))&&this.enforceAxisLimitsForScale(e)}enforceAxisLimitsForScale(e){let t=this.getGrapher2d();if(!t)return;let o=t.getDefaultViewport();if(!o)return;e==="xAxisScale"?(this._setAxisLimitLatex("xmin",__dcg_shared_module_exports__['_b'](o.xmin)),this._setAxisLimitLatex("xmax",__dcg_shared_module_exports__['_b'](o.xmax))):(this._setAxisLimitLatex("ymin",__dcg_shared_module_exports__['_b'](o.ymin)),this._setAxisLimitLatex("ymax",__dcg_shared_module_exports__['_b'](o.ymax))),this.graphSettings.xAxisScale===this.graphSettings.yAxisScale&&(this.graphSettings.setProperty("lastChangedAxis",e==="xAxisScale"?"y":"x"),t.viewportController.zoomSquareImmediately(),this.markSquareAxesAfterUserEditedViewport());let i=t.viewportController.getViewport(),n=t.getProjection(),{xmin:a,xmax:s,ymin:l,ymax:c}=i,d=this.getGraphSettings().config.logScales;if(e==="xAxisScale"&&d){let p=n.mapx(a),u=n.mapx(s),h=ni(n.reverse_mapx(p-.25),n.reverse_mapx(p+.25)),m=ni(n.reverse_mapx(u-.25),n.reverse_mapx(u+.25));this._setAxisLimitLatex("xmin",__dcg_shared_module_exports__['_b'](h)),this._setAxisLimitLatex("xmax",__dcg_shared_module_exports__['_b'](m))}if(e==="yAxisScale"&&d){let p=n.mapy(l),u=n.mapy(c),h=ni(n.reverse_mapy(p-.25),n.reverse_mapy(p+.25)),m=ni(n.reverse_mapy(u-.25),n.reverse_mapy(u+.25));this._setAxisLimitLatex("ymin",__dcg_shared_module_exports__['_b'](h)),this._setAxisLimitLatex("ymax",__dcg_shared_module_exports__['_b'](m))}this.lastDirectlyEditedViewport=t.getCurrentViewport()}_convertOrCreateTable(e){let t=this.getItemModelByIndex(e),o=tb(t),i=k_(t);if((t==null?void 0:t.type)!=="expression")return;let n=this.isInEditListMode(),a;switch(o){case"point-list":a=fH(t);break;case"point-list-reference":a=bH(t);break;case"anonymous-function":a=yH(t);break;case"function-reference":a=vH(t);break;case"recursive-function":a=wH(t);break}if(n&&this.setEditListMode(!1),!o||!a){this._showToast({message:this.s("graphing-calculator-text-table-creation-error")}),Vo("Convert to table bug",{metaData:{latex:t.latex,type:o}});return}let s={id:this.generateId(),type:"table",readonly:t.readonly,columns:[{...ob,id:this.generateId(),latex:a.headers[0],values:a.values[0]},{...ob,id:this.generateId(),latex:a.headers[1],values:a.values[1],color:t.color,lines:!i&&!!t.lines}]},l=this.createItemModel(s);if(i){let d=t.index+1;if(o==="recursive-function"){let p=t.formula.function_definition;for(;this.isBaseCaseItem(d,p);)d++}this._toplevelInsertItemAt(d,l,!0,t.folderId)}else this._toplevelReplaceItemAt(t.index,l,!0);let c=()=>{this.dispatch({type:"undo"}),n&&this.dispatch({type:"set-edit-list-mode",isEditListMode:!0,focusExpressionList:!1})};this._showToast({message:this.s("graphing-calculator-text-table-created"),undoCallback:c}),this.logEvent({category:"convert-to-table",action:o})}isBaseCaseItem(e,t){var i;let o=this.getItemModelByIndex(e);return!o||o.type!=="expression"||!t?!1:((i=o.formula.recursion_base_case)==null?void 0:i.symbol)===t}hasTableHeaderWithIdentifier(e){return!!e&&PK(this.listModel,e)}updateGraphSettingsViewportLimitsLatex(e){this._setAxisLimitLatex("xmin",e.xmin+""),this._setAxisLimitLatex("xmax",e.xmax+""),this._setAxisLimitLatex("ymin",e.ymin+""),this._setAxisLimitLatex("ymax",e.ymax+""),this._setAxisLimitLatex("zmin",e.zmin+""),this._setAxisLimitLatex("zmax",e.zmax+"")}transformAllSelectedItemsByAssignmentLatex(e){var c,d;let t=yT(this.listModel),o=this.findLastTokenNumber()+1,i=this.findLastSubscriptForLetters(),n=this.getGeometryFolder(),a=n?n.index+this.getNumberOfItemsInFolder(n.id)+1:0,s={};for(let p of t){if(p.type!=="expression"||!p.formula.geometry)continue;let h=(c=p.formula.typed_constant_value)==null?void 0:c.valueType;if(!h||__dcg_shared_module_exports__['fb'](h,__dcg_shared_module_exports__['Ea']))continue;let m=(d=xn(p))==null?void 0:d.latex;m||(m=this._autoNameExpression(p,i));let y=`\\token{${o}}`;o+=1;let w=`${y}=${e}\\left(${m}\\right)`,S=this.createItemModel({id:this.generateId(),type:"expression",showLabel:p.showLabel&&!p.label,showAngleLabel:p.showAngleLabel&&!p.label,latex:w,folderId:n&&n.id,color:p.color});s[S.id]=!0,n?(wc(this.listModel,S,a),a+=1):Wc(this.listModel,S)}let l=Object.keys(s);if(l.length&&Q2(this.listModel,s),l.length===1){let p=l[0];this.runAfterDispatch(()=>{this.getItemModel(p)&&this.get2dPOIController().keyboardAttentionManager.updateKeyboardAttention({calcId:p,listIndex:void 0,polygonEdge:void 0},{describe:!1})})}}convertToTokenAssignment(e,t=""){var n;let o=(n=xn(e))==null?void 0:n.latex,i=t?S0(t)||"":"\\token{"+(this.findLastTokenNumber()+1)+"}";o?mu(this.listModel,o,i):Al(e,i+"="+e.latex)}convertToNamedAssignment(e,t=""){let o=RT(e);if(!o)return;let i=t?S0(t):this.getAutonameLatexForExpression(e);i?mu(this.listModel,o,i):Al(e,t)}getAutonameLatexForExpression(e,t){if(t||(t=this.findLastSubscriptForLetters()),uR(e)==="point"&&e.label&&ol(e.label)&&this.countGlobalIdentifierOccurences(e.label)===0)return e.label;let o=OW(e),i=(t[o]||0)+1;return t[o]=i,o+"_{"+i+"}"}_autoNameExpression(e,t){let o=this.getAutonameLatexForExpression(e,t);return Al(e,o+"="+e.latex),o}isGeoToolVisible(e,{ignoreAuthorMode:t}={ignoreAuthorMode:!1}){return!t&&this.shouldShowAuthorFeatures()?!0:nb(this.geometryToolbarModel,e)}isGeoToolEnabled(e,{ignoreAuthorMode:t}={ignoreAuthorMode:!1}){return!t&&this.shouldShowAuthorFeatures()?!0:Bx(this.geometryToolbarModel,e)}setGeoTool(e){if(!this.geoUIActive||this.activeTool===e||!this.isGeoToolEnabled(e))return;B6(this.geometryToolbarModel,e,this.shouldShowAuthorFeatures()),this.activeTool=e,this.getGeoModel().setToolMode(e),this.cancelGeoToolplay()}cancelGeoToolplay(){var t;let e=this.getGeoModel();e.cancelToolplay(),e.deselectAllObjects(),this.setToolPreviewState({}),(t=this.get2dPOIController())==null||t.cancelGeoToolplay()}setToolPreviewState(e){var i;this.toolPreviewJSONState=e;let t=this.listModel.__toolPreviewIdToModel;this.listModel.__toolPreviewIdToModel={};let o=P3(e,{isBeingCommitted:!1});for(let n in e){let a=e[n],s=o[n];if(!s||s.type!=="assignment")continue;let l;for(let c in t){let d=t[a.type==="expression-edit-preview-latex"?$x:c];if(((i=xn(d))==null?void 0:i.latex)===n){l=d;break}}if(l)l.latex=s.latex,l.color=s.color,l.showAngleLabel=!!s.showAngleLabel,l.hidden=a.hidden;else{let c=a.type==="expression-edit-preview-latex"?this.getSelectedItem():void 0,d=(c==null?void 0:c.type)==="expression"?H0(c,{stripDefaults:!0}):void 0;l=CT({...d,id:a.type==="expression-edit-preview-latex"?$x:this.generateId(),type:"expression",color:s.color,latex:s.latex,showAngleLabel:!!s.showAngleLabel,hidden:a.hidden},this)}this.listModel.__toolPreviewIdToModel[l.id]=l}}isGeoItem(e){let t=this.getItemModel(e);return t&&t.type==="expression"&&t.formula&&t.formula.geometry&&!t.formula.error}getSelectedGeoExpression(){let e=this.getSelectedItem();if(e&&this.isGeoItem(e.id)&&e.type==="expression")return e}getGeometryFolder(){let e=this.getItemModel(__dcg_shared_module_exports__['xb']);return e&&e.type==="folder"?e:void 0}isItemInGeoFolder(e){let t=this.getItemModel(e);return!t||t.type==="folder"?!1:t.folderId===__dcg_shared_module_exports__['xb']}isGeoFolder(e){return e.id===__dcg_shared_module_exports__['xb']}isItemNotSelectableBecauseItsSecret(e){return!(this.shouldShowAuthorFeatures()||this.isItemInGeoFolder(e)||!this.isItemSecret(e))}pauseAllSliders(){this.getPlayingSliders().forEach(e=>{Cc(e,!1)})}countGlobalIdentifierOccurences(e){return P0(this.listModel,e)}handleClickableItemClicked(e,t){let o=this.getItemModel(e);Zx(o)&&this.evaluator.addClickEvent(o.id,t)}canAddTicker(){return!this.getTickerOpen()}doesIdentifierBlockActionUpdate(e){let t=this.getFocusLocation(),o=im(this.listModel,e);for(let i of o)if((t==null?void 0:t.type)==="expression"&&t.id===i.id||NW(i))return!0;return!1}getItemsByIdentifier(e){return im(this.listModel,e)}isAtLeastOnePointSelected(){let e=this.getAllSelectedItems();for(let t=0;t<e.length;t++){let o=e[t];if(o.type==="expression"&&pp(o))return!0}return!1}toggleLabelForAllSelectedObjects(){let e=[],t=[];this.getAllSelectedItems().forEach(o=>{o.type==="expression"&&pp(o)&&(o.showLabel?t.push(o):e.push(o))}),e.length?this.setLabelStateForObjects(e,"measurement"):t.length&&this.setLabelStateForObjects(t,"none")}setLabelStateForObjects(e,t){let o=/^([A-Z])([0-9]*)$/;if(t==="auto"){let i=0;this.getAllItemModels().forEach(n=>{if(n.type!=="expression"||!n.showLabel||!n.label)return;let a=n.label.match(o);if(!a)return;let s=a[1].charCodeAt(0)-65;a[2]&&(s+=parseInt(a[2])*26),s>=i&&(i=s+1)}),e.forEach(n=>{if(!n.label){let a=i;i++;let s=String.fromCharCode(a%26+65),l=Math.floor(a/26),c=l>0?l+"":"";bu(n,s+c)}dm(n,!0)})}else if(t==="measurement")for(let i of e)bu(i,""),dm(i,!0);else if(t==="none")for(let i of e)o.test(i.label)&&bu(i,""),dm(i,!1)}updateLatexForIdentifier(e,t){let o=im(this.listModel,e);if(o.length===1){let i=o[0];i.slider.isPlaying?(Cc(i,!1),Al(i,t),Cc(i,!0)):Al(i,t)}}updateExpressionSearchStr(e){this.rawExpressionSearchStr=e;let t="\\operatorname{rename}";if(e.indexOf(t)===0){let i=e.slice(t.length).replace(/\\ /g,"").split(/\\to(?![a-zA-Z])/);i.length===2?(this.expressionSearchStr=i[0],this.isExpressionSearchStrValidForReplace=ol(this.expressionSearchStr),this.updateExpressionReplaceStr(i[1])):(this.expressionSearchStr=i[0],this.isExpressionSearchStrValidForReplace=!1,this.updateExpressionReplaceStr(""));let n=OK(this.listModel,this.getExpressionSearchStr());this.expressionSearchCount=this.expressionSearchOpen?n:0}else this.expressionSearchStr=e.length>1&&"rename".indexOf(e)===0?"":e,this.isExpressionSearchStrValidForReplace=!1,this.updateExpressionReplaceStr(""),this.filterItemsBySearch()}closeExpressionsSearch(){var o;if(this.expressionSearchOpen=!1,this.updateExpressionSearchStr(""),((o=this.getFocusLocation())==null?void 0:o.type)==="ticker")return;let e=this.getFirstSelectedItem(),t=this.getItemModelByIndex(0);!e&&t&&Dn(this,t.id,"end"),e&&this.getSelectedItem()&&!this.getFocusedItem()&&Dn(this,e.id,"end"),(e||t)&&(this.shouldScrollSelectedItemIntoViewAfterDispatch=!0)}filterItemsBySearch(){if(!this.getExpressionReplaceStr()){let e=RK(this.listModel,this.getExpressionSearchStr());this.expressionSearchCount=this.expressionSearchOpen?e:0}}updateExpressionReplaceStr(e){this.expressionReplaceStr=e,this.isExpressionReplaceStrValidForReplace=ol(e)}getIsExpressionSearchStrValidForReplace(){return this.isExpressionSearchStrValidForReplace}getIsExpressionReplaceStrValidForReplace(){return this.isExpressionReplaceStrValidForReplace}isSearchReplaceValid(){return this.getIsExpressionSearchStrValidForReplace()&&this.getIsExpressionReplaceStrValidForReplace()}shouldShowReplaceIcon(){return this.isSearchReplaceValid()}updateTickerHandlerLatex(e){this.listModel.ticker.handlerLatex=e}updateTickerMinStepLatex(e){this.listModel.ticker.minStepLatex=e}getRawExpressionSearchStr(){return this.rawExpressionSearchStr||""}getExpressionSearchStr(){return this.expressionSearchStr||""}getExpressionReplaceStr(){return this.expressionReplaceStr||""}getExpressionSearchCount(){return this.expressionSearchCount||0}getTicker(){return this.listModel.ticker}getTickerHandlerLatex(){return this.listModel.ticker.handlerLatex||""}getTickerMinStepLatex(){return this.listModel.ticker.minStepLatex||""}getTickerAvgDelta(){return this.listModel.ticker.avgDelta}getBrailleMode(){return this.graphSettings.config.brailleMode}setBrailleMode(e){this.graphSettings.config.setProperty("brailleMode",e)}getSixKeyInput(){return this.graphSettings.config.sixKeyInput}setSixKeyInput(e){this.graphSettings.config.setProperty("sixKeyInput",e)}getBrailleControls(){return this.graphSettings.config.brailleControls}setBrailleControls(e){this.graphSettings.config.setProperty("brailleControls",e)}getAudio(){return this.graphSettings.config.audio}setAudio(e){this.graphSettings.config.setProperty("audio",e)}setEditListMode(e){this.layoutModel={...this.layoutModel,inEditListMode:e}}generateTableXSubscript(){return fT(this.listModel)}findLastTokenNumber(){return FK(this.listModel)}findLastSubscriptForLetters(){return NK(this.listModel)}_createTableItem(){let e=this.generateTableXSubscript(),t=A2(e,[[],[]],this);return this.createItemModel(t)}_populateSettingsViewLimitLatex(){let e=this.getGrapher();if(!e)return;let t=e.getCurrentViewport();this.isGraphSettingsOpen()&&__dcg_shared_module_exports__['J'](t,this.lastDirectlyEditedViewport)||(this.settingsViewModel={...this.settingsViewModel,limitLatex:Vee(t,{steps:this.getAxisStepSettings(),scales:this.getAxisScaleSettings()})})}getAxisStepSettings(){return{xAxisStep:this.graphSettings.xAxisStep,yAxisStep:this.graphSettings.yAxisStep}}getAxisScaleSettings(){return{xAxisScale:this.graphSettings.xAxisScale,yAxisScale:this.graphSettings.yAxisScale}}getDefaultAxisScaleSettings(){var t,o;let{defaultState:e}=this.graphSettings;return{xAxisScale:((t=e==null?void 0:e.graph)==null?void 0:t.xAxisScale)||"linear",yAxisScale:((o=e==null?void 0:e.graph)==null?void 0:o.yAxisScale)||"linear"}}getSettingsViewModel(){return this.settingsViewModel}getListModel(){return this.listModel}getGeometryToolbarModel(){return this.geometryToolbarModel}hasBackgroundColor(){return this.getBackgroundColor()!=="#ffffff"}getBackgroundColor(){return this.getGraphSettings().getConfiguredBackgroundColor()}hasTextColor(){return this.getTextColor()!=="#000000"}getTextColor(){return this.getGraphSettings().getConfiguredTextColor()}getPillboxBackgroundColor(){return __dcg_shared_module_exports__['Sd'](this.getBackgroundColor(),-.07)}subscribeToChanges(e){let t=this.nextSubscription;return this.nextSubscription+=1,this.subscriptions[t]=e,()=>{delete this.subscriptions[t]}}updateTheComputedWorld(){var d,p,u,h,m,y,w,S,C;lb(this.listModel);let t=this.getSelectedItem()&&this.activeTool==="expression-edit"&&this.listModel.__toolPreviewIdToModel[$x]&&((d=this.getGrapher())!=null&&d.graphSketches[$x])?"preview":"actual";BK(this.listModel,t),(p=this.grapher2d)==null||p.setTabOrder(this.listModel.tabOrder),(u=this.grapher3d)==null||u.setTabOrder(this.listModel.tabOrder),(h=this.grapher2d)==null||h.setDrawLayers(this.listModel.drawLayers),(m=this.grapher3d)==null||m.setDrawLayers(this.listModel.drawLayers);let o={},i=v=>{var _;let E=(_=xn(v))==null?void 0:_.identifier;E&&(E[0]==="$"||v.formula.geometry)&&E&&(o[E]?o[E].multiple=!0:o[E]={model:v,multiple:!1})};for(let v of this.getAllToolPreviewItems())hR(v),i(v);for(let v of this.getAllItemModels())switch(v.type){case"expression":hR(v),i(v);break;case"image":Q6(v);break;case"table":$H(v);break;case"folder":S6(v);break;case"text":cK(v);break;default:return v}this.geoUIActive=this.isGeometry()&&!this.getGraphSettings().config.hideGeoUI,this.cachedGeoTokenInfo={};for(let v in o){let{multiple:E,model:_}=o[v],T="blue",I="unknown",P="unknown",O=!1,W=!1,X=!1,x=ma(_);!E&&_?(T=om(_),O=PW(_),P=FW(_),I=uR(_),_.error&&(W=!0,T="#")):(I="error",W=!0),I&&_?this.isItemSelected(_.id)&&(X=!0):W=!0;let L=(_==null?void 0:_.label)||"";this.cachedGeoTokenInfo[v]={groupType:I,iconType:P,isList:O,hasError:W,color:T,isSelected:X,isHidden:x,label:L,calcId:_&&_.id||""}}this.cachedGeoTokenDepths={};let{createdDepth:n,firstReferencedDepth:a}=this.geoModel.getComputedBoard().getDepthValues();for(let v in this.cachedGeoTokenInfo){let{calcId:E}=this.cachedGeoTokenInfo[v],_=this.getItemModel(E);if(!_)continue;let T=v;if(!(v in n)&&_.type==="expression"&&(E===this.getDraggedItemId()||_===this.getFocusedItem())){let L=_.formula.assignment;L&&L in n&&(T=L)}let I=n[T]||0,P=a[T];P=isFinite(P)?P:0;let O=Math.max(I,P-1)+"",W=this.cachedGeoTokenDepths[O];W||(W=[],this.cachedGeoTokenDepths[O]=W);let X=this.cachedGeoTokenInfo[v];!this.isItemInGeoFolder(_.id)&&(_.readonly||yc(_))||W.push({color:X.color,groupType:X.groupType,identifier:v,calcId:E})}wK(this.listModel.ticker);let s=this.getFocusLocation();if(s&&s.type==="expression"&&s.isFakeGraphFocus&&(this.getValidCursorContext()||Do(this,{...s,isFakeGraphFocus:void 0})),this.isCurrentFocusLocationValid()||Do(this,void 0),this.listModel.openItemMenu){let v=this.getOpenMenuIcon();document.body&&v&&document.body.contains(v)||(this.listModel.openItemMenu=void 0)}let l=this.getSelectedItem();l&&!this.getItemModel(l.id)&&vo(this.listModel,void 0),this._populateSettingsViewLimitLatex(),this.propagateSelection(),this.propagateActiveTokens(),this.isKeypadOpen()||(this.layoutModel={...this.layoutModel,keypadFunctionsOpen:!1}),uW(this.listModel),this.isGeometry()&&l&&l.type==="expression"?this.getValidCursorContext()?(this.setGeoTool("expression-edit"),this.geoModel.updateFadeAnimations()):this.geoModel.getToolMode()==="expression-edit"&&this.setGeoTool("selection"):this.geoModel.getToolMode()==="expression-edit"&&this.setGeoTool("selection"),this.isGeometry()&&this.getGeoModel().updateAvailableInputTypes();let c=this.getValidCursorContext();this.isGeometry()&&this.getGeoModel().getToolMode()==="expression-edit"&&!__dcg_shared_module_exports__['J'](c,this.lastCursorContext)&&this.runAfterDispatch(()=>{var v;(v=this.get2dPOIController())==null||v.replayGeoTapMove()}),this.lastCursorContext=c,(w=(y=this.grapher2d)==null?void 0:y.poiController)!=null&&w.keyboardAttentionManager.getKeyboardAttention()&&!this.isGraphPaperFocused()&&((C=(S=this.grapher2d)==null?void 0:S.poiController)==null||C.keyboardAttentionManager.setKeyboardAttention(void 0)),this.isGeometry()&&(L6(this.geometryToolbarModel),this.isGeoToolEnabled(this.getActiveTool())||this.setGeoTool("selection")),this.runAfterDispatch(()=>{var v,E;this.isThreeDMode()||((v=this.grapher2d)==null||v.audioGraph.checkIfSelectedItemChanged(l?l.id:void 0),this.focusLocation&&this.focusLocation.type!=="graph-paper"&&((E=this.grapher2d)==null||E.audioGraph.exitAudioTrace()))})}getOpenMenuIconSelector(){let e=this.getOpenItemMenu();return e?`[dcg-open-menu-guid="${e.guid}"]`:void 0}getOpenMenuIcon(){let e=this.getOpenMenuIconSelector();return e?this.findEl(e):void 0}propagateSelection(){let e=this.getGrapher();e?this.__lastSelectedIdsForPropagation=Cee(this,e,this.__lastSelectedIdsForPropagation):this.__lastSelectedIdsForPropagation={selected:{},hoistedToTop:{}}}propagateActiveTokens(){var e,t;this.isThreeDMode()||((e=this.grapher2d)==null||e.setActiveToken(this.getExpressionIdForIdentifier(this.activeTokens.selected),"selected"),(t=this.grapher2d)==null||t.setActiveToken(this.getExpressionIdForIdentifier(this.activeTokens.hovered),"hovered"))}getHoveredOrFocusedTokenIdentifier(){if(this.activeTokens.hovered)return this.activeTokens.hovered;let e=this.getFocusLocation();if(e&&e.type==="geo-token")return e.identifier}doesLatexContainToken(e){return RW(e)}getToolPreviewJSONState(){return this.toolPreviewJSONState}removeListOfItems(e){let t={},o=[],i=new Set;return e.forEach(n=>{if(this.isItemReadonly(n))i.add(n);else{let a=db(this.listModel,n);for(let s of a)t[s.id]||(t[s.id]=!0,o.push(s))}}),{deletedItems:o,readonlyItemsNotDeleted:i.size}}garbageCollectGeo(e,t){if(!this.isGeometry())return;let o=Eee(this,e,t);o.length&&this.removeListOfItems(o)}ensureAtLeastOneVisibleItem(){if($K(this.listModel)){let e=this.createItemModel({type:"expression",id:this.generateId(),color:this.getNextColor()});Wc(this.listModel,e)}}getExpressionIdForIdentifier(e){if(!e)return;let t=this.getItemsByIdentifier(e);if(t.length===1)return t[0].id}getValidCursorContext(){var n;let e=this.getSelectedItem();if(!e||e.type!=="expression")return;let t=e.formula.cursor_context,o=(n=Ze.getFocusedMathquill())==null?void 0:n.selection(),i=(e==null?void 0:e.type)==="expression"&&e.latex===(t==null?void 0:t.selection.input)&&(o==null?void 0:o.startIndex)===(t==null?void 0:t.selection.start)&&(o==null?void 0:o.endIndex)===(t==null?void 0:t.selection.end)&&(o==null?void 0:o.latex)===(t==null?void 0:t.selection.input);if(this.getGeoModel().getClickToInsertMode()==="permissive")return{type:"permissive",allowedTypes:[__dcg_shared_module_exports__['aa']],cursorContext:i?t:void 0};if(i){if((t==null?void 0:t.type)==="expression-arguments"){let{argIndex:a,positionWithinArg:s}=t;if(!(a===t.argCount-1&&s==="end"||t.positionWithinArg==="start-to-end"&&(o==null?void 0:o.startIndex)!==void 0&&(o==null?void 0:o.startIndex)===(o==null?void 0:o.endIndex)))return}return t}}tryInsertTokenIntoMathquill(e,t){if(!this.isGeometry()||!e)return!1;let o=this.getItemModel(e);if(!o||o.type!=="expression")return!1;let i=o.formula.typed_constant_value;t===0&&(!i||!__dcg_shared_module_exports__['bb'](i.valueType))&&(t=void 0);let n,a,s=Ns(o);if(s?a=__dcg_shared_module_exports__['$b'](s):o.formula.geometry&&(a=this.getAutonameLatexForExpression(o),n=a),!a)return!1;t!==void 0&&(a+="\\left["+(t+1)+"\\right]");let l=this.getFocusLocation();return!l||!this.seemsLikeInsertingTokenWillImproveThings(i==null?void 0:i.valueType)?!1:l.type==="expression"?(n&&(Ci(o)==="NONE"&&o.dragMode==="AUTO"&&pb(o,"NONE"),Al(o,n+"="+o.latex)),this.writeIdentifierIntoCurrentMathquill(a),!0):!1}seemsLikeInsertingTokenWillImproveThings(e){let t=this.getValidCursorContext();if(t){if(!e)return!1;let o=__dcg_shared_module_exports__['bb'](e)?__dcg_shared_module_exports__['cb'](e):e;return t.type==="empty"&&__dcg_shared_module_exports__['db'](o)?!1:(t.type==="expression-arguments"?t.allowedTypesForInsertedArg:t.allowedTypes).some(n=>__dcg_shared_module_exports__['_'](o,n))}return!1}writeIdentifierIntoCurrentMathquill(e){this.runAfterDispatch(()=>{let t=Ze.getFocusedMathquill();if(!t)return;let o=this.getValidCursorContext(),i=(o==null?void 0:o.type)==="permissive"?o.cursorContext:o,n="",a="";(i==null?void 0:i.type)==="expression-arguments"&&((i==null?void 0:i.positionWithinArg)==="end"?n=",":(i==null?void 0:i.positionWithinArg)==="start"&&(a=","));let s=`${n}${e}${a}`,l=!1;if((i==null?void 0:i.type)==="expression-arguments"&&i.polygonVertices){let{argIndex:c,polygonVertices:d,positionWithinArg:p}=i;(e===d.firstLatex||e===d.lastLatex)&&(p==="end"||p==="start-to-end")&&c===i.argCount-1&&(s="",l=!0)}else(i==null?void 0:i.type)==="expression-arguments"&&(l=i.isLastValidArg);Ze.canAcceptText(t,this.getCapExpressionSize(),s)&&(t.write(s),Ze.simulateUserChangedLatex(t),l&&t.keystroke("Right"))})}getSelectedExpressionIds(){return YK(this.listModel)}hasTentativeSelection(){return oW(this.listModel)}getPropagatedSelectedIds(){return this.__lastSelectedIdsForPropagation}areParsableObjectsEqual(e,t){return e===t?!0:__dcg_shared_module_exports__['J']({...e,regressionParameters:void 0},{...t,regressionParameters:void 0})}requestParseForAllItems(){var i,n,a;(this.isCurrentlyDoingSetState||this.isCurrentlyDoingRestoreState)&&(this.lastParsableObjects={},this.evaluator.clearStatementsAndStartCompleteState(),this.isCurrentlyDoingRestoreState&&this.evaluator.markUndoRedoState());let e={},t=this.lastParsableObjects;for(let s of this.getAllItemModels())switch(s.type){case"expression":case"image":case"table":e[s.guid]=s.cachedParsableState;break;case"folder":case"text":break;default:return s}for(let s of VK(this.listModel))e[s.guid]=s.cachedParsableState;for(let s of Xx(this.listModel)){let l=this.getSelectedItem(),c=this.activeTool==="polygon";if(this.activeTool==="expression-edit"&&(l==null?void 0:l.type)==="expression"&&((n=(i=l.formula.geometry)==null?void 0:i.call)==null?void 0:n.symbol)==="polygon"&&((a=l.formula.cursor_context)==null?void 0:a.type)==="expression-arguments"){let{positionWithinArg:d,argIndex:p}=l.formula.cursor_context;c=(d==="end"||d==="start-to-end")&&p===l.formula.geometry.call.parents.length-1}e[s.guid]={...s.cachedParsableState,shouldOmitLastPolygonSegment:c}}let o=this.getFocusedItem();if((o==null?void 0:o.type)==="expression"){let s=Ze.getFocusedMathquill(),l=s==null?void 0:s.selection();(l==null?void 0:l.latex)===o.latex&&this.shouldEvaluateSelection()&&(e[o.guid]={...o.cachedParsableState,latexSelection:{start:l.startIndex,end:l.endIndex}})}if(this.is3dProduct()&&this.getTranslucentSurfaces())for(let s in e){let l=e[s];l.type==="statement"&&(e[s]={...l,surfaceOpacity:this.getGraphSettings().config.translucentOpacity})}this.listModel.ticker.cachedParsableState&&(e[this.listModel.ticker.guid]=this.listModel.ticker.cachedParsableState);for(let s of P6(this.geometryToolbarModel))e[s.id]=s;for(let s in t){let l=t[s],c=e[s];if(l.type==="image"&&(!c||c.type!==l.type||c.guid!==l.guid)&&this.grapher2d&&this.grapher2d.removeGraphImage(l.id),!c&&(this.evaluator.removeStatement(l.id),l.type==="table"))for(let d of l.columns)this.evaluator.removeStatement(d.id)}for(let s in e){let l=e[s],c=t[s];if(l.type==="image"&&(!c||l.type!==c.type||l.guid!==c.guid)&&this.grapher2d){let d=this.getItemModel(l.id);d&&d.type==="image"&&this.grapher2d.addGraphImage(d)}this.areParsableObjectsEqual(l,c)||(this.grapher2d&&l.type==="statement"&&l.latex===""&&this.grapher2d.removeGraphSketch(l.id),this.evaluator.addStatement(l))}this.lastParsableObjects=e}getViewState(){let e=this.getGrapher();if(e){let t=e.getProjection();return{viewport:t.viewport.toObject(),screen:t.screen,xAxisScale:t.settings.xAxisScale,yAxisScale:t.settings.yAxisScale,degreeMode:t.settings.degreeMode,complex:t.settings.complex}}else return}getTokenRenderInfoByIdentifier(e){let t=this.cachedGeoTokenInfo[e];return t||(t={iconType:"unknown",isList:!1,hasError:!0,isSelected:!1,groupType:"unknown",color:"",isHidden:!1,label:"",calcId:""}),t}setEvaluator(e){this.evaluator=e,e.clearSlowEvaluatorTracking=this.clearSlowEvaluatorTracking.bind(this)}getEvaluator(){return this.evaluator}setGrapher2d(e){this.grapher2d=e}setGrapher3d(e){this.grapher3d=e,this.grapher2d.poiController.add3DTouchEventHandlers(e)}getGrapher(){return this.isThreeDMode()?this.grapher3d:this.grapher2d}getGrapher2d(){return this.grapher2d}getGrapher3d(){return this.grapher3d}get2dPOIController(){var e;return(e=this.grapher2d)==null?void 0:e.poiController}isDefaultViewportRestored(){var e;return!!((e=this.getGrapher())!=null&&e.viewportController.isDefaultViewportRestored())}requestRedrawGraph(){var e,t;(e=this.grapher2d)==null||e.redrawAllLayers(),this.isThreeDMode()&&((t=this.grapher3d)==null||t.redrawAllLayers())}get2dProjection(){var e;return(e=this.grapher2d)==null?void 0:e.getProjection()}get2dSketchOrder(){return this.grapher2d?[...this.grapher2d.generateMergeDrawOrder()]:[]}getBoundingBoxesForZoomFit(e){if(!(!this.grapher2d&&!this.grapher3d)&&this.isZoomFitEnabled()&&!(e.type!=="expression"&&e.type!=="table")&&!(e.type==="expression"&&(e.error||!e.shouldGraph||!e.formula.is_graphable)))return e.boundingBoxes}getBoundingBoxForResidualsZoomFit(e){var t,o;if(!(!this.grapher2d&&!this.grapher3d)&&this.isZoomFitEnabled()&&!(e.type!=="expression"&&e.type!=="table")&&!(e.type==="expression"&&(e.error||!e.formula.is_graphable))){if(e.type==="table"&&((o=(t=e.formula)==null?void 0:t.table_regression)==null?void 0:o.status)==="success"&&e.boundingBoxes){let i=e.formula.table_regression.result.residualVariable;for(let n of e.boundingBoxes)if(n.symbol&&__dcg_shared_module_exports__['$b'](n.symbol)===i)return[n]}if(e.type==="expression"&&e.formula.regression){let i=e.formula.regression.residualVariable;for(let n of this.getAllItemModels())if(n.type==="table"&&n.boundingBoxes){for(let a of n.boundingBoxes)if(a.symbol&&__dcg_shared_module_exports__['$b'](a.symbol)===i)return[a]}}}}isExpressionZoomFit(e){if(this.isThreeDMode())return!1;let t=this.getBoundingBoxesForZoomFit(e),o=this.get2dProjection();return!o||!t?!1:!QV(t,o)&&!!ME(t,o)}viewportIsLocked(){return this.getLockViewportConfigSetting()||this.getLockViewportUserSetting()}showExpressionZoomFitButton(e){if(this.viewportIsLocked()||this.isGeometry()||this.is3dProduct())return!1;let t=this.getBoundingBoxesForZoomFit(e),o=this.get2dProjection();return!!(o&&t&&QV(t,o))}showResidualsZoomFitButton(e){if(this.viewportIsLocked()||this.isGeometry()||this.is3dProduct())return!1;let t=this.getBoundingBoxForResidualsZoomFit(e),o=this.get2dProjection();return!!(o&&t&&QV(t,o))}setBugsnagContext(e){this.bugsnagContext=e}getItemRootNodeById(e){let t=this.getItemModel(e);return t==null?void 0:t.rootViewNode}getItemNodeById(e){return this.getItemRootNodeById(e)}generateId(){let e=this.__nextItemId;return this.__nextItemId+=1,e+""}getNextColor(){return _K(this.listModel)}getNextDisplayIndex(){return this.listModel.nextDisplayIndex}_clearPendingImageUploads(){this.__pendingImageUploads={}}isUploadingImages(){return Object.keys(this.__pendingImageUploads).length>0}getExpressionAnalysis(){return this.listModel.expressionAnalysis}getHelperExpressions(){return qK(this.listModel).map(e=>e.proxy)}createItemModel(e){return Wx(this.listModel,e)}getItemModel(e,t){return fu(this.listModel,e,t)}getHiddenGeoItemCount(){return WK(this.listModel)}getColorById(e){let t=this.getItemModel(e);return!t||t.type!=="expression"?"":nR(t)}getAllColorAssignments(){let e=[];for(let t of this.getAllItemModels()){if(t.type!=="expression")continue;let o=Ns(t);if(!o)continue;let i=this.getEvaluationValueForItem(t.id);(typeof i=="string"||Array.isArray(i)&&typeof i[0]=="string")&&e.push({id:t.id,assignmentLatex:__dcg_shared_module_exports__['$b'](o)})}return e}getAllColorFunctionAssignments(){let e=[];if(!this.isBeta3DMode())return e;for(let t of this.getAllItemModels()){if(t.type!=="expression")continue;let o=Ns(t),i=pR(t);!o||!i||e.push({id:"shader",assignmentLatex:"shader:"+__dcg_shared_module_exports__['$b'](o)})}return e}getShader(e){for(let t of this.getAllItemModels()){if(t.type!=="expression")continue;let o=Ns(t);if(o&&__dcg_shared_module_exports__['$b'](o)===e){let i=pR(t);if(i)return i}}return{source:"",shaderFunctions:{},shaderUniforms:[]}}getItemModelByIndex(e){return sb(this.listModel,e)}getItemCount(){return B0(this.listModel)}getItemEditableLabelMode(e){let t=this.getItemModel(e);if(!(!t||t.type!=="expression"))return jW(t)}isItemSecret(e){let t=this.getItemModel(e);return t?Hx(t):!1}isItemMarkedReadonly(e){let t=this.getItemModel(e);return t?!this.isListEnabled()&&!this.isItemInGeoFolder(e)?!0:MK(t):!1}isItemReadonly(e){return this.isItemMarkedReadonly(e)&&!this.shouldShowAuthorFeatures()}isItemSelected(e){let t=this.getItemModel(e);return!!t&&Za(t)}getItemSelectedState(e){return pW(this.listModel,e)}isItemGraphing(e){return this.getEvaluatorStateForItem(e)==="GRAPHING"}getEvaluatorStateForItem(e){return this.evaluator.evaluationProgressById.get(e)}hasAnyItemsSelected(){return this.getAllSelectedItems().length>0}hasMultipleItemsSelected(){return this.getAllSelectedItems().length>1}isItemSelectable(e){let t=this.getItemModel(e);return t?Yx(t):!1}anyItemDependsOnRandomSeed(){return sW(this.listModel)}areActionsEnabled(){return this.graphSettings.config.actions==="auto"?cW(this.listModel):!!this.graphSettings.config.actions}getAllItemModels(){return mT(this.listModel)}getAllToolPreviewItems(){return Xx(this.listModel)}isToolPreviewItem(e){return UK(this.listModel,e)}getAllModelsWithSliders(){return jK(this.listModel)}getGraphSettings(){return this.graphSettings}getAudioGraph(){var e;if(!this.isThreeDMode())return(e=this.grapher2d)==null?void 0:e.audioGraph}inAudioTraceMode(){let e=this.getAudioGraph();return!!(e&&e.audioTraceActive)}canAudioTrace(){let e=this.getAudioGraph();return e?e.canAudioTraceCurrentExp():!1}isAudioTracing(){let e=this.getAudioGraph();return e?e.isAudioTracing():!1}expressionsAreFullWidth(){return this.isNarrow()||this.graphSettings.config.graphpaper===!1}getExpListWidthString(){return this.expressionsAreFullWidth()?"100%":this.rootElt?this._getExpListWidth()+"px":"0"}getExpListWidth(){return this.rootElt?this._getExpListWidth():0}findFirstVisibleItem(){let e=LZ(this,this._previousFirstVisibleId);if(this._previousFirstVisibleId=e,e)return this.getItemModel(e)}findLastVisibleItem(){let e=PZ(this,this._previousLastVisibleId);if(this._previousLastVisibleId=e,e)return this.getItemModel(e)}updateRenderShellsAfterDispatch(){if(!this.rootElt||!this.isListVisible())return;let e=this.findFirstVisibleItem(),t=this.findLastVisibleItem(),o=e&&this.getItemRootNodeById(e.id),i=t&&this.getItemRootNodeById(t.id);if(o===this.lastInfiniteScrollFirstDOM&&i===this.lastInfiniteScrollLastDOM&&!this.hasDispatchSinceLastInfiniteScrollUpdate)return;this.lastInfiniteScrollFirstDOM=o,this.lastInfiniteScrollLastDOM=i,this.hasDispatchSinceLastInfiniteScrollUpdate=!1;let n=!1,a=e?e.index:1/0,s=t?t.index:1/0,l=this.listModel.dragState&&this.listModel.dragState.firstItemId,c,d=this.getOpenItemMenu();d&&d.type!=="multi-select-more"&&d.type!=="multi-select-construct"&&d.type!=="multi-select-style"&&d.type!=="multi-select-label"&&d.type!=="geo-tool-dropdown"&&(c=d.model.id);for(let p of this.getAllItemModels()){let u=(p.index<a||p.index>s||p.isHiddenFromUI)&&!(p.type==="expression"&&p.sliderDragging);if(l==p.id&&(u=!1),c===p.id&&(u=!1),p.renderShell!==u&&(p.renderShell=u,n=!0,u)){let h=this.getItemRootNodeById(p.id);if(h){let m=h.getBoundingClientRect().height;m>0&&(p.cachedRenderHeight=m)}}}n&&this.markTickRequiredNextFrame()}updateRenderShellsBeforePaint(){if(this.hasDispatchSinceLastInfiniteScrollUpdate=!0,this.inPrintMode){for(let t of this.getAllItemModels())t.renderShell=!1;return}for(let t of this.getAllItemModels())t.isHiddenFromUI&&(t.renderShell=!0),t.type==="expression"&&t.sliderDragging&&(t.renderShell=!1);let e=this.getSelectedItem();e&&!this.isGeoItem(e.id)&&(e.renderShell=!1)}updateDragDrop(){let e=this.listModel.dragState;if(!e)return;let t=this.getItemModel(e.firstItemId);if(!t)return;let o=this.dragdrop_expressions.applyDrag();o&&(U0(this.listModel,o.dragState),Qa(t,o.folderId),t.index!==o.newIndex&&am(this.listModel,t.index,o.newIndex,e.numberOfItems))}_tickSliders(e){this.getPlayingSliders().forEach(t=>{SW(t,e)})}tickTicker(e){let t=this.listModel.ticker.lastTickTime===void 0;this.evaluator.addClockTickEvent(this.listModel.ticker.id,t),CK(this.listModel.ticker,e)}stopAllSliders(){for(let e of this.getAllItemModels())e.type==="expression"&&e.slider.isPlaying&&Cc(e,!1)}getPlayingSliders(){let e=this.getAllItemModels(),t=[];for(let o of e)o.type==="expression"&&o.sliderExists&&o.slider.isPlaying&&t.push(o);return t}areAnyImagesLoading(){return kK(this.listModel)}_commitUserRequestedViewport(e){var t;(t=this.getGrapher())==null||t.setUserRequestedViewport(e)}_setAxisLimitLatex(e,t){this.settingsViewModel={...this.settingsViewModel,limitLatex:{...this.settingsViewModel.limitLatex,[e]:t}};let i=t===""&&(e==="xstep"||e==="ystep")?0:Qo(t,this.graphSettings.degreeMode),n=this.getGrapher();switch(e){case"xstep":{if(!Yy(i))return;this.graphSettings.setProperty("xAxisStep",i)}break;case"ystep":{if(!Yy(i))return;this.graphSettings.setProperty("yAxisStep",i)}break;case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":{if(!n)return;let a=n.viewportController.getViewport(),s="xmin";e==="xmin"&&(s="xmax"),e==="ymax"&&(s="ymin"),e==="ymin"&&(s="ymax"),e==="zmax"&&(s="zmin"),e==="zmin"&&(s="zmax");let l=Qo(this.settingsViewModel.limitLatex[s]||"",this.graphSettings.degreeMode),c=Co.fromObject({...a.toObject(),[e]:i,[s]:l});if(!c.isValid(this.getAxisScaleSettings()))return;n.viewportController.setViewport(c);let p;switch(e){case"xmin":case"xmax":p="x";break;case"ymin":case"ymax":p="y";break;case"zmin":case"zmax":p="z";break;default:let u=e;throw new Error(`Invalid limit: ${u}`)}this.graphSettings.setProperty("lastChangedAxis",p),this.markSquareAxesAfterUserEditedViewport()}break}if(n){let a=n.viewportController.getViewport().toObject();this._commitUserRequestedViewport(a)}}unmarkLastChangedAxis(){this.graphSettings.setProperty("lastChangedAxis",void 0)}markSquareAxesAfterUserEditedViewport(){let e=this.getGrapher();if(!e)return;let t=e.viewportController.getViewport(),o=this.isThreeDMode()?t.isSquare3D():t.isSquare(e.getProjection().screen,this.getAxisScaleSettings());this.graphSettings.setProperty("squareAxes",o)}getLockViewportConfigSetting(){return this.graphSettings.config.lockViewport}getLockViewportUserSetting(){return this.graphSettings.userLockedViewport}canUserAddExpressions(){return!!this.graphSettings.config.expressions}areNotesEnabled(){return!!this.graphSettings.config.notes}areSlidersEnabled(){return!!this.graphSettings.config.sliders}areLinksEnabled(){return!!this.graphSettings.config.links}areImagesEnabled(){let e=window.FileReader,t=Rs&&Ch&&Ch[0]===8&&Ch[1]===0&&Ch[2]===0;return!!(this.graphSettings.config.images&&e&&!t&&!this.is3dProduct())}areFoldersEnabled(){return!!this.graphSettings.config.folders}isDecimalToFractionEnabled(){return!!this.graphSettings.config.decimalToFraction}isTraceEnabled(){return!!this.graphSettings.config.trace}areFunctionsRestricted(){return!!this.graphSettings.config.restrictedFunctions}areGeometryFunctionsForceEnabled(){return!!this.graphSettings.config.forceEnableGeometryFunctions}isQwertyKeyboardEnabled(){return!!this.graphSettings.config.qwertyKeyboard}isZoomFitEnabled(){return!!this.graphSettings.config.zoomFit}canEditOnWeb(){return!!this.graphSettings.config.editOnWeb}hasTransparentBackground(){return!!this.graphSettings.config.transparentBackground}shouldAudioTraceReverseExpressions(){return!!this.graphSettings.config.audioTraceReverseExpressions}hasDefaultState(){return!!this.graphSettings.defaultState}getDefaultViewport(){var t;let e=this.graphSettings.defaultState;return e&&e.graph?e.graph.viewport:(t=this.getGrapher())==null?void 0:t.getDefaultViewport()}getColors(){return this.isThreeDMode()?__dcg_shared_module_exports__['_d']:this.graphSettings.config.colors}getImageOpacities(){return["0.2","0.4","0.6","0.8","1"]}getUIDragModes(){return["X","Y","XY"]}getNumberOfItemsInFolder(e){return TK(this.listModel,e)}getEnabledDragModesForItem(e){let t=this.getItemModel(e);if(!t||t.type!=="expression")return[];let o=t.formula,i=[];if(!o.move_strategy)return i;let n=o.move_strategy[0].type!=="none",a=o.move_strategy[1].type!=="none",s=n&&a;return n&&i.push("X"),a&&i.push("Y"),s&&i.push("XY"),i}shouldShowEvaluationForItem(e){let t=this.getItemModel(e);return!t||t.type!=="expression"?!1:iR(t)}shouldShowCDFEvaluationForItem(e){let t=this.getItemModel(e);return!t||t.type!=="expression"?!1:MT(t)}getEvaluationValueForItem(e){let t=this.getItemModel(e);return t?t.type!=="expression"?NaN:nR(t):NaN}getEvaluationValueTypeForItem(e){var o;let t=this.getItemModel(e);if(t&&t.type==="expression")return(o=t.formula.typed_constant_value)==null?void 0:o.valueType}canDisplayEvaluationForItemAsFraction(e){if(!this.isDecimalToFractionEnabled())return!1;let t=this.getItemModel(e);if(!t||t.type!=="expression"||Ah(t))return!1;let o=this.getEvaluationValueForItem(e);return typeof o!="number"?!1:__dcg_shared_module_exports__['Xb'](o)}shouldEvaluationForItemDisplayAsFraction(e){if(!this.isDecimalToFractionEnabled())return!1;let t=this.getItemModel(e);return!t||t.type!=="expression"?!1:cm(t)}getEvaluationLabelOptionsForItem(e){return{...__dcg_shared_module_exports__['Vb'],displayAsFraction:this.shouldEvaluationForItemDisplayAsFraction(e)}}isInEditListMode(){return this.layoutModel.inEditListMode}authorFeaturesAvailable(){return!!this.graphSettings.config.authorFeatures}shouldShowAuthorFeatures(){return this.authorFeaturesAvailable()&&!!this.graphSettings.config.authorMode}shouldIgnoreGraphInteractions(e){return this.shouldShowAuthorFeatures()?!1:yc(e)}toolWillBeHiddenOrDisabled(e){return this.shouldShowAuthorFeatures()&&(!this.isGeoToolVisible(e,{ignoreAuthorMode:!0})||!this.isGeoToolEnabled(e,{ignoreAuthorMode:!0}))}setAuthorMode(e){this.graphSettings.config.setProperty("authorMode",e)}getInvertedColors(){return!!this.graphSettings.config.invertedColors}invertSwatches(){return this.isThreeDMode()&&this.getInvertedColors()}canUseAdvancedStyling(){return this.graphSettings.config.advancedStyling}getDegreeMode(){return this.graphSettings.degreeMode}isThreeDMode(){return this.graphSettings.threeDMode}showPlane3D(){let{threeDMode:e,showAxis3D:t,showPlane3D:o}=this.graphSettings;return e&&t&&o}showNumbers3D(){let{threeDMode:e,showAxis3D:t,showNumbers3D:o}=this.graphSettings;return e&&t&&o}getTranslucentSurfaces(){return!!this.graphSettings.config.translucentSurfaces}getPerspectiveDistortion(){let e=this.graphSettings.config.perspectiveDistortion;return isNaN(e)?1:e<1e-4?0:__dcg_shared_module_exports__['wc'](e,0,FS)}isBeta3DMode(){return this.isThreeDMode()&&this.getGraphSettings().config.beta3d}areLogModeRegressionsForced(){return this.graphSettings.config.forceLogModeRegressions}areLogModeRegressionsDefault(){return this.graphSettings.config.defaultLogModeRegressions}setAllRegressionsToLogMode(){for(let e of this.getAllItemModels())e.type==="expression"&&e.formula&&e.formula.is_regression&&gR(e,!0)}isGraphSettingsOpen(){return this.layoutModel.graphSettingsOpen}isAddExpressionOpen(){return this.layoutModel.addExpressionOpen}shouldRenderList(){if(this.layoutModel.expressionsVisible)return!0;let e=this.layoutModel.expressionsHiddenTime;return e===void 0?!1:Date.now()-e<=500}isListVisible(){return this.layoutModel.expressionsVisible}isGrapherEnabled(){return this.graphSettings.config.graphpaper!==!1}isListEnabled(){return this.graphSettings.config.expressions!==!1}areDistributionsEnabled(){return this.graphSettings.config.distributions===!0}isExpressionListFocused(){let e=this.getFocusLocation();if(!e)return!1;switch(e.type){case"settings":case"generic-menu":case"expression-menu":case"editable-label":case"geo-token":case"multi-select-more-icon":case"multi-select-construct-icon":case"multi-select-label-icon":case"multi-select-style-icon":case"geo-header-back-link":case"multi-select-show-hide-icon":case"new-transformation-number":case"label-points-icon":case"geo-show-constructions-icon":case"geo-basic-tool":case"geo-basic-tool-menu-item":case"geo-construct-menu-existing-transformations":case"regression-output":case"stats-output":case"graph-paper":case"zoom-in-btn":case"zoom-restore-btn":case"quest":case"global-mute-button":case"color-picker-option":case"multi-select-label-menu-label-input":return!1;case"distribution-param":case"cdf-limit":case"slider-limit":case"domain-limit":case"expression":case"visualization-prop":case"search-expressions":case"replace-expressions":case"ticker":case"table":case"image":case"readonly-expression":case"add-table-regression-btn":case"table-regression-delete-btn":case"table-regression-type-dropdown":case"table-container":case"text":case"folder":case"add-item-btn":case"add-expression-btn":case"add-note-btn":case"add-table-btn":case"add-folder-btn":case"add-ticker-btn":case"add-image-btn":case"change-image-btn":case"edit-list-toggle":case"expression-icon":case"expression-evaluation":case"image-icon":case"slider-icon":case"slider-animation-properties-icon":case"slider-thumb":case"table-icon":case"table-regression-icon":case"action-icon":case"hide-expression-list-btn":case"show-expression-list-btn":case"top-level-icon":return!0;default:return e}}needsFakeKeypad(){if(this.inAudioTraceMode()&&this.isKeypadEnabled())return!0;let e=this.getFocusLocation();if(!e||this.getBrailleMode()!=="none"&&Yl())return!1;switch(e.type){case"settings":return Aee(e.location);case"new-transformation-number":case"distribution-param":case"cdf-limit":case"slider-limit":case"domain-limit":case"expression":case"visualization-prop":case"search-expressions":case"replace-expressions":case"ticker":return!0;case"expression-menu":return e.location==="opacity"||e.location==="linewidth"||e.location==="lineopacity"||e.location==="pointopacity"||e.location==="pointsize"||e.location==="labelsize"||e.location==="labelangle"||e.location==="updaterule";case"table":{if(this.isInEditListMode())return!1;let o=e.location;if(o.row===0)return!0;let i=this.getItemModel(e.id);if(!i||i.type!=="table")return!1;let n=i.columnModels[o.column];return n?!Lx(n):!1}case"image":return e.location!=="name";case"readonly-expression":case"add-table-regression-btn":case"table-regression-delete-btn":case"table-regression-type-dropdown":case"regression-output":case"stats-output":case"graph-paper":case"table-container":case"text":case"folder":case"add-item-btn":case"add-expression-btn":case"add-note-btn":case"add-table-btn":case"add-folder-btn":case"add-ticker-btn":case"add-image-btn":case"change-image-btn":case"edit-list-toggle":case"hide-expression-list-btn":case"show-expression-list-btn":case"geo-token":case"multi-select-more-icon":case"multi-select-construct-icon":case"multi-select-label-icon":case"multi-select-style-icon":case"geo-header-back-link":case"multi-select-show-hide-icon":case"label-points-icon":case"geo-show-constructions-icon":case"geo-basic-tool":case"geo-basic-tool-menu-item":case"geo-construct-menu-existing-transformations":case"generic-menu":case"zoom-in-btn":case"zoom-restore-btn":case"quest":case"global-mute-button":case"color-picker-option":case"multi-select-label-menu-label-input":return!1;case"expression-icon":case"expression-evaluation":case"image-icon":case"slider-icon":case"action-icon":case"slider-animation-properties-icon":case"slider-thumb":case"table-icon":case"table-regression-icon":case"top-level-icon":return!1;case"editable-label":return this.getItemEditableLabelMode(e.id)==="MATH";default:return e}}isIdentifierRenameValid(e){return ol(e)?!LK(this.listModel,e):!1}getBrandingMode(){return this.getEditLink()?"static-edit-link":this.getGraphSettings().config.editOnWeb?"edit-link":"powered-by"}getEditLink(){return window.iframeEmbedBrandingLink}_expressionZoomFit(e,t){let o=this.getItemModel(e);if(this.isThreeDMode()||!this.grapher2d||!this.isZoomFitEnabled()||!o||o.type!=="expression"&&o.type!=="table"||(!o.boundingBoxes||!o.boundingBoxes.length)&&!t.justResiduals)return!1;let i=this.grapher2d.viewportController;if(!("zoomCustom"in i))return!1;let n=o.boundingBoxes;if(t.justResiduals){let s=this.getBoundingBoxForResidualsZoomFit(o);s!==void 0&&(n=s)}if(n===void 0)return!1;let a=ME(n,i.getProjection());return a?(t.synchronous?i.setViewport(Co.fromObject(a)):i.zoomCustom(a),t.focusAfterTap&&Do(this,{type:"zoom-restore-btn"}),!0):!1}_deleteItemAndAnimateOut(e,t){let i=this.getItemNodeById(e);i&&(Yi(i,{transition:.2+"s",opacity:"0",transform:"scale(.1, .1)"}),setTimeout(()=>{this.dispatch({type:"finish-deleting-item-after-animation",id:e,setFocusAfterDelete:t})},1e3*.2))}_finishDeletingItemAfterAnimation(e,t){let o=this.getItemModel(e);if(!o)return;let i=this.getItemNodeById(e),n=i&&document.activeElement&&i.contains(document.activeElement),a=R0(this.listModel,o.index);if(this._removeExpressionSynchronously(o),!(!t||!n)){if(!a){let s=jx(this.listModel);s&&(a=s)}a&&Dn(this,a.id,"end")}}_removeExpressionSynchronously(e){var o;if(e.type==="expression"){let i=(o=e.formula.regression)==null?void 0:o.residualVariable;if(i){for(let n of this.getAllItemModels())if(n.type==="table"){let a=n.columnModels.findIndex(s=>s.latex===i);if(a>=0){_0(n,a);break}}}}let t=Qx(this.listModel,e.index);this.trackActionForPotentialEvaluatorRestart("remove",e.id),t.forEach(i=>this.trackActionForPotentialEvaluatorRestart("remove",i.id)),this.garbageCollectGeo(t,{}),this.ensureAtLeastOneVisibleItem()}setRootElt(e){this.rootElt=e,this.dragdrop_expressions=new nE(this)}getRootElt(){return this.rootElt}_hideExpressions(e){this.graphSettings.config.expressions&&(vo(this.listModel,void 0),this.layoutModel={...this.layoutModel,expressionsVisible:!1,expressionsHiddenTime:Date.now()},e?Do(this,{type:"show-expression-list-btn"}):Jr())}_showExpressions(e){this.graphSettings.config.expressions&&(this.layoutModel={...this.layoutModel,expressionsVisible:!0},e?Do(this,{type:"hide-expression-list-btn"}):Jr())}_showToast(e){this.toastData=e,clearTimeout(this._hideToastTimeout);let t=typeof e.hideAfter=="number"?e.hideAfter:6e3;t>0&&(this._hideToastTimeout=setTimeout(()=>{this.dispatch({type:"toast/close",onHide:this.toastData.onHide})},t))}_setExpressionPropertiesFromAPI(e,t){let o=this.getItemModel(e);if(o)if(o.type==="table"&&t.columns){t=__dcg_shared_module_exports__['i'](t);let i=t6(o,t),n=Wx(this.listModel,i);this._toplevelReplaceItemAt(o.index,n,!1)}else if(o.type==="text"){let i=this.getItemModel(e);if(!i)return;for(let n in t)if(t.hasOwnProperty(n))switch(n){case"text":W2(i,t.text);break;case"secret":H_(i,t.secret);break;case"readonly":M0(i,t.readonly);break}}else{let i=this.getItemModel(e);if(!i)return;for(let n in t)if(t.hasOwnProperty(n))switch(n){case"slider":{if(i.type!=="expression")continue;let a=t[n];a.hasOwnProperty("min")&&tw(i,a.min),a.hasOwnProperty("max")&&rw(i,a.max),a.hasOwnProperty("step")&&K0(i,a.step),a.hasOwnProperty("isPlaying")&&Cc(i,a.isPlaying)}break;case"polarDomain":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.polarDomain.min),"theta"),Il(i,__dcg_shared_module_exports__['je'](t.polarDomain.max),"theta")}break;case"parametricDomain":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.parametricDomain.min),"t"),Il(i,__dcg_shared_module_exports__['je'](t.parametricDomain.max),"t")}break;case"parametricDomain3Du":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Du.min),"u"),Il(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Du.max),"u")}break;case"parametricDomain3Dv":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dv.min),"v"),Il(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dv.max),"v")}break;case"parametricDomain3Dr":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dr.min),"r"),Il(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dr.max),"r")}break;case"parametricDomain3Dphi":{if(i.type!=="expression")continue;Gl(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dphi.min),"phi"),Il(i,__dcg_shared_module_exports__['je'](t.parametricDomain3Dphi.max),"phi")}break;case"hidden":this._setItemHidden(e,t.hidden);break;case"secret":H_(i,t.secret);break;case"readonly":M0(i,t.readonly);break;case"color":{if(i.type!=="expression")continue;FT(i,t.color)}break;case"dragMode":{if(i.type!=="expression")continue;pb(i,t.dragMode)}break;case"label":{if(i.type!=="expression")continue;bu(i,t.label)}break;case"showLabel":{if(i.type!=="expression")continue;dm(i,t.showLabel)}break;case"labelSize":{if(i.type!=="expression")continue;J0(i,t.labelSize)}break;case"labelOrientation":{if(i.type!=="expression")continue;xR(i,t.labelOrientation)}break;case"latex":if(i.type!=="expression")continue;Al(i,t.latex);break;case"points":if(i.type!=="expression")continue;fR(i,!!t.points);break;case"lines":if(i.type!=="expression")continue;yR(i,!!t.lines);break;case"pointStyle":if(i.type!=="expression")continue;bR(i,t.pointStyle);break;case"pointSize":case"movablePointSize":if(i.type!=="expression")continue;Y0(i,t.pointSize);break;case"pointOpacity":if(i.type!=="expression")continue;j0(i,t.pointOpacity);break;case"lineStyle":if(i.type!=="expression")continue;NT(i,t.lineStyle);break;case"lineWidth":if(i.type!=="expression")continue;iw(i,t.lineWidth);break;case"lineOpacity":if(i.type!=="expression")continue;ow(i,t.lineOpacity);break;case"fill":if(i.type!=="expression")continue;mR(i,t.fill);break;case"fillOpacity":if(i.type!=="expression")continue;W0(i,t.fillOpacity);break;case"surfaceOpacity":if(i.type!=="expression")continue;$0(i,t.surfaceOpacity);break;case"id":case"type":case"domain":break;default:throw new Error("trying to call setProperty for: "+n)}}}_isParentFolderHidden(e){let t=this.getItemModel(e);if(!t)return!1;let o=il(t);return o?o.hidden:!1}_toggleItemHidden(e){var t;if(this._isParentFolderHidden(e))this._setItemHidden(e,!1);else{let o=this.getItemModel(e);if(!o)return;switch(o.type){case"expression":this._setItemHidden(e,!ma(o));break;case"image":case"folder":this._setItemHidden(e,!o.hidden);break;case"table":case"text":break;default:return o}vc(o)&&(ma(o)||this.logEvent({category:"tone",action:ma(o)?"mute-local":"unmute-local"}),(t=this.toneController)==null||t.recomputeAudio())}}_toggleTableColumnHidden(e,t){if(this._isParentFolderHidden(e))this._setTableColumnHidden(e,t,!1);else{let o=this.getItemModel(e);if(!o||o.type!=="table")return;let i=vi(o,t);if(!i)return;this._setTableColumnHidden(e,t,!i.hidden)}}_setTableColumnHidden(e,t,o){let i=this.getItemModel(e);if(!i||i.type!=="table")return;let n=F_(i,t);!o&&this._isParentFolderHidden(e)&&this._setItemHidden(i.folderId,!1),d6(i,t,o),!o&&n&&V2(i,t,!0)}_setItemHidden(e,t){let o=this.getItemModel(e);if(!o)return;!t&&o.type!=="folder"&&this._isParentFolderHidden(o.id)&&this._setItemHidden(o.folderId,!1);let i;switch(o.type){case"expression":{i=ma(o),JW(o,t);break}case"folder":i=_6(o),k6(o,t);break;case"image":K6(o,t);break;case"table":case"text":break;default:return o}i!==void 0&&t&&!i&&(o.type==="expression"?this.trackActionForPotentialEvaluatorRestart("hide",o.id):o.type==="folder"&&this.getAllItemModels().filter(n=>n.type==="expression"&&n.folderId===o.id).forEach(n=>this.trackActionForPotentialEvaluatorRestart("hide",n.id)))}_addItemToEndFromAPI(e){let t=gT(this.listModel);!e.secret&&t&&t.type==="expression"&&t.latex===""&&Qx(this.listModel,t.index),Wc(this.listModel,e)}copyExpressionToIndex(e,t,o){let i={stripDefaults:!1},n;switch(e.type){case"expression":n=H0(e,i);break;case"table":n=Vx(e,i);let s={};n.columns&&n.columns.forEach(l=>{let c=this.generateId();s[l.id]=c,l.id=c}),n.regression&&(n.regression={...n.regression,id:this.generateId(),columnIds:{x:s[n.regression.columnIds.x],y:s[n.regression.columnIds.y]}});break;case"image":n=iT(e,i);break;case"text":n=lT(e,i);break;default:return}let a=this.createItemModel({...n,id:this.generateId()});this._toplevelInsertItemAt(t,a,!1,o||e.folderId)}_toplevelInsertItemAt(e,t,o,i){let n=t;wc(this.listModel,n,e),i&&Qa(n,i),o&&Dn(this,n.id)}_toplevelNewItemAtSelection(e,t){this.setGeoTool("selection");let o=this.getSelectedItem();if(o){let s=o.type==="expression"&&!o.latex;if(s&&!o.folderId&&(e.type!=="expression"||e.latex))return this._toplevelReplaceItemAt(o.index,e,t.shouldFocus);if(s&&o.folderId&&e.type!=="expression"&&e.type!=="folder")return this._toplevelReplaceItemAt(o.index,e,t.shouldFocus);if(o.type!=="folder"&&!o.folderId)return this._toplevelInsertItemAt(o.index+1,e,t.shouldFocus,void 0);if(o.type!=="folder"&&o.folderId&&e.type!=="folder")return this._toplevelInsertItemAt(o.index+1,e,t.shouldFocus,o.folderId);if(o.type==="folder"&&!o.collapsed&&e.type!=="folder")return this._toplevelInsertItemAt(o.index+1,e,t.shouldFocus,o.id)}let i=this.getFirstFullyVisibleItem();for(i&&i.type==="folder"&&(i=this.getItemModelByIndex(i.index+1));i&&i.type!=="folder"&&i.folderId;)i=this.getItemModelByIndex(i.index+1);let n=i?i.index:this.getItemCount();return this._toplevelInsertItemAt(n,e,t.shouldFocus,void 0)}getFirstFullyVisibleItem(){let e=LB(this);if(e)return fu(this.listModel,e)}findEl(e){if(this.rootElt)return this.rootElt.querySelector(e)||void 0}getExppanelElt(){return rE(this)}scrollItemIntoView(e){if(!this.rootElt||!this.isListVisible())return;let t=this.getItemNodeById(e.id),o=rE(this);if(!(!t||!o)){if(e.type==="table"){let i=t.querySelector(".dcg-select-dropdown-list");if(i){Vc(i,o,60);return}let n=t.querySelector(".dcg-row .dcg-selected");if(n){Vc(n,o,60);return}}Vc(t,o,90)}}scrollSelectedItemIntoView(){let e=this.getFirstSelectedItem();if(e){if(e&&e.type!=="folder"&&e.folderId){let t=this.getItemModel(e.folderId);t&&t.type==="folder"&&t.collapsedChildIsSelected&&(e=t)}this.scrollItemIntoView(e)}}_pasteTable(e){let t=this.getGrapher();if(!t)return;let o=fT(this.listModel),i=A2(o,e,this),n=this.createItemModel(i);this._toplevelNewItemAtSelection(n,{shouldFocus:!0}),this._closeAddExpression();let a=t.getProjection(),s=a.viewport,l=__dcg_shared_module_exports__['l'](e[0],p=>parseFloat(p)),c=__dcg_shared_module_exports__['l'](e[1],p=>parseFloat(p));if(this.is3dProduct())return;let d={xmin:__dcg_shared_module_exports__['s'](l),xmax:__dcg_shared_module_exports__['r'](l),ymin:__dcg_shared_module_exports__['s'](c),ymax:__dcg_shared_module_exports__['r'](c),type:"table"};if(isFinite(d.xmin)&&isFinite(d.xmax)&&isFinite(d.ymin)&&isFinite(d.ymax)&&(d.xmax>s.xmax||d.xmin<s.xmin||d.ymax>s.ymax||d.ymin<s.ymin)){let p=ME([d],a);if(p&&!this.viewportIsLocked()){let u=new Co(p.xmin,p.xmax,p.ymin,p.ymax);t.viewportController.setViewport(u),this._showToast({message:this.s("graphing-calculator-text-toast-zoom-to-fit"),undoCallback:()=>{this.dispatch({type:"undo"})}}),this.markSquareAxesAfterUserEditedViewport()}}}_insertSeveralExpressions(e){for(let t=0;t<e.length;t++){let o=this.createItemModel(e[t]);this._toplevelNewItemAtSelection(o,{shouldFocus:!0})}}_appendNumberList(e){let t=this.getSelectedItem();if(t&&t.type==="expression"){let o=t.latex,i=this.createItemModel({type:"expression",id:this.generateId(),latex:o+e});return this._toplevelReplaceItemAt(t.index,i,!0)}}_openOnWeb(){this.runAfterDispatch(()=>{let e=this.getGrapher();if(!e)return;let t=JSON.stringify(this.getState()),o=e.screenshot({width:100,height:100}),a=(this.getGraphSettings().config.crossOriginSaveTest?"/":"https://www.desmos.com/")+"api/v1/calculator/cross_origin_save",s=document.createElement("div");Oee.mountToNode(eL,s,{stateData:()=>t,thumbData:()=>o,saveURL:()=>a}),this.rootElt.append(s);let l=s.querySelector("form[name=open_graph_on_web]");re(l).trigger("submit"),s.remove()})}notifyBugsnagAboutMissingSelectedItem(e,t){let o=cb(this.listModel),i="";try{o?i=JSON.stringify(o.cachedUndoRedoFullState,null,2):i="undefined"}catch(s){i="[[could not stringify]]"}let n="";try{if(!o)n="undefined";else{let s={id:o.id,index:o.index,displayIndex:o.index,secretIndex:o.secretIndex,guid:o.guid,renderShell:o.renderShell,isHiddenFromUI:o.isHiddenFromUI,hasDCGView:!!o.rootViewNode,cachedRenderHeight:o.cachedRenderHeight};n=JSON.stringify(s,null,2)}}catch(s){n="[[could not stringify]]"}let a="";try{a=JSON.stringify(X2(this.listModel),null,2)}catch(s){a="[[could not stringify]]"}Vo("ReplaceItemAtError: no item at index",{metaData:{index:e,shouldFocus:t,selectedModelJSON:n,selectedItemJSON:i,listStateJSON:a}})}_toplevelReplaceItemAt(e,t,o){let i=t,n=this.getItemModelByIndex(e);n||this.notifyBugsnagAboutMissingSelectedItem(e,o);let a=n.type!=="folder"&&n.folderId;Qx(this.listModel,e),wc(this.listModel,i,e),a&&Qa(i,a),o&&Dn(this,i.id)}convertImageToDraggable(e){let t=this.getItemModel(e);if(!t||t.type!=="image")return;let o=t.folderId,i=t.index+1,n=t.center,a=fT(this.listModel),s=__dcg_shared_module_exports__['$b']("C_"+a),l=this.createItemModel({id:this.generateId(),type:"expression",latex:s+"="+n,dragMode:"XY",hidden:!0});wc(this.listModel,l,i),o&&Qa(l,o),xc(t,"center",s),U2(t,!0),q2(t,!0)}createSlidersForItem(e,t){let o=this.getItemModel(e);if(!o)return;let i=o.type!=="folder"&&o.folderId;return this.createSliders({model:o,folderId:i,index:o.index+1},t)}createSlidersForTicker(e){return this.createSliders({model:this.listModel.ticker,folderId:!1,index:0,doNotChangeFocus:!0},e)}createSliders({model:e,folderId:t,index:o,doNotChangeFocus:i},n){let a=[];e.type==="ticker"?pT(e,(p,u)=>{a.push({latex:p,location:u})}):Kx(e,(p,u)=>{a.push({latex:p,location:u.location})});let s=vee(a,n,{degreeMode:this.graphSettings.degreeMode}),l=e.formula?e.formula.action_value:void 0,c=n.map(p=>{let u=s[p],h="1";u&&u.value!==void 0&&(h=u.value);let m,y=__dcg_shared_module_exports__['ac'](p);p===""?m="":l&&l.hasOwnProperty(y)?m=l[y]:m=p+"="+h;let w={type:"expression",id:this.generateId(),latex:m,color:this.getNextColor(),hidden:!!m};return u&&(u.min!==void 0&&(w.slider||(w.slider={}),w.slider.hardMin=!0,w.slider.min=u.min),u.max!==void 0&&(w.slider||(w.slider={}),w.slider.hardMax=!0,w.slider.max=u.max),u.step!==void 0&&(w.slider||(w.slider={}),w.slider.step=u.step)),w});for(let p=c.length-1;p>=0;p--){let u=this.createItemModel(c[p]);wc(this.listModel,u,o),t&&Qa(u,t)}if(i)return;let d=c[c.length-1];d.latex===""?Dn(this,d.id):Do(this,void 0)}_uploadImagesAndWaitForThemToLoad(e){let{files:t,id:o}=e;if(!t||t.length===0){this._showToast({message:this.s("graphing-calculator-text-toast-no-file-selected")});return}if(o&&t.length>1){this._showToast({message:this.s("graphing-calculator-text-toast-choose-one-file")});return}let i=oK({controller:this,files:t,id:o}),n=i.errors[0];n&&this._showToast({message:n});for(let a of i.tokens)this.__pendingImageUploads[a]=!0;this.isUploadingImages()&&this._showToast({message:this.s("graphing-calculator-text-toast-uploading-images"),onHide:()=>{this._clearPendingImageUploads()}})}getImageToRetry(){let e;for(let t of this.getAllItemModels())t.type==="image"&&t.loadStatus==="failed"&&(!e||e.failures>t.failures)&&(e=t);return e}retryLoadingFailedImage(e){let t=Date.now(),o=t-this.imageRetryState.lastAttemptTime,i=1e3*Math.pow(2,this.imageRetryState.attempts);this.imageRetryState.attempts>0&&o<i||(H2(e),this.imageRetryState={lastAttemptTime:t,attempts:this.imageRetryState.attempts+1})}getSelectedItem(){return cb(this.listModel)}getFirstSelectedItem(){let e=this.getAllSelectedItems(),t=e[0];if(t){for(let o=1;o<e.length;o++){let i=e[o];i.index<t.index&&(t=i)}return t}}getAllSelectedItems(){return yT(this.listModel)}getOpenItemMenu(){return this.listModel.openItemMenu}isItemSettingsMenuOpen(e){let t=this.listModel.openItemMenu;return t?t.guid===e:!1}closeItemSettingsMenu(){let e=this.getOpenItemMenu();e!==void 0&&(e.focusFirstOption&&(e.previousFocusLocation!==void 0?Do(this,e.previousFocusLocation):this.focusOpenMenuIcon()),this.listModel.openItemMenu=void 0)}focusOpenMenuIcon(){let e=this.getOpenItemMenu();e&&(e.type==="slider"?this.dispatch({type:"set-focus-location",location:{type:"slider-animation-properties-icon",id:e.model.id}}):e.type==="image"?this.dispatch({type:"set-focus-location",location:{type:"image-icon",id:e.model.id}}):e.type==="table-column"?this.dispatch({type:"set-focus-location",location:{type:"table-icon",id:e.model.table.id,columnId:e.model.id}}):e.type==="table-regression"?this.dispatch({type:"set-focus-location",location:{type:"table-regression-icon",id:e.model.id}}):e.type==="geo-tool-dropdown"?this.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:e.tools[0]}}):e.type==="multi-select-more"?this.dispatch({type:"set-focus-location",location:{type:"multi-select-more-icon"}}):e.type==="multi-select-construct"?this.dispatch({type:"set-focus-location",location:{type:"multi-select-construct-icon"}}):e.type==="multi-select-style"?this.dispatch({type:"set-focus-location",location:{type:"multi-select-style-icon"}}):e.type==="multi-select-label"?this.dispatch({type:"set-focus-location",location:{type:"multi-select-label-icon"}}):this.dispatch({type:"set-focus-location",location:{type:"expression-icon",id:e.model.id}}))}getFocusedItem(){return mee(this)}getFocusLocation(){return this.focusLocation}isFocusLocationFocused(e){let t=this.focusLocation,o=e;return!t||!o?!1:__dcg_shared_module_exports__['J'](t,o)}isCurrentFocusLocationValid(){var i;let e=this.focusLocation;if(!e)return!0;if(e.type==="settings")return e.location==="icon"||this.isGraphSettingsOpen();if(e.type==="add-item-btn"||e.type==="edit-list-toggle"||e.type==="hide-expression-list-btn"||e.type==="show-expression-list-btn")return this.isListEnabled();if(e.type==="add-expression-btn"||e.type==="add-table-btn")return this.layoutModel.addExpressionOpen;if(e.type==="add-note-btn")return this.layoutModel.addExpressionOpen&&this.areNotesEnabled();if(e.type==="add-folder-btn")return this.layoutModel.addExpressionOpen&&this.areFoldersEnabled();if(e.type==="add-ticker-btn")return this.layoutModel.addExpressionOpen&&this.areActionsEnabled();if(e.type==="add-image-btn")return this.layoutModel.addExpressionOpen&&this.areImagesEnabled();if(e.type==="zoom-in-btn"||e.type==="zoom-restore-btn")return!0;if(e.type==="search-expressions"||e.type==="replace-expressions")return this.expressionSearchOpen;if(e.type==="ticker")return this.listModel.ticker.open;if(e.type==="generic-menu")return!!this.getOpenItemMenu();if(e.type==="graph-paper"){let n=this.getGrapher();return!!(n&&n.getIsVisible()&&n.settings.config.graphpaper)}if(e.type==="geo-show-constructions-icon"||e.type==="geo-token"||e.type==="multi-select-more-icon"||e.type==="multi-select-construct-icon"||e.type==="multi-select-style-icon"||e.type==="multi-select-label-icon"||e.type==="label-points-icon")return this.isGeoUIActive();if(e.type==="new-transformation-number"){let n=this.getGeoModel(),a=n.getCurrentTool(),s=n.getNonObjectsState().ui.currentTool.inputIndex,l=a.getSpec&&a.getSpec();return!!l&&!!l.inputs[s]&&!!l.inputs[s].numberInputInfo}if(e.type==="geo-header-back-link"||e.type==="multi-select-show-hide-icon")return this.isGeoUIActive()&&this.hasAnyItemsSelected();if(e.type==="geo-basic-tool")return this.isGeoUIActive()&&e.tool!=="expression-edit";if(e.type==="regression-output")return!!this.getItemModel(e.id)&&e.parameter!=="";if(e.type==="stats-output"){let n=this.getItemModel(e.id);return!!(n&&n.type==="expression"&&KT(n)&&e.parameter!=="")}if(e.type==="quest")return this.getQuestIsActive();let t=this.getOpenItemMenu();if(e.type==="geo-basic-tool-menu-item")return this.isGeoUIActive()&&e.tool!==""&&t!==void 0&&(t.type==="geo-tool-dropdown"||t.type==="multi-select-construct");if(e.type==="geo-construct-menu-existing-transformations")return this.isGeoUIActive()&&(t==null?void 0:t.type)==="multi-select-construct";if(e.type==="multi-select-label-menu-label-input")return this.isGeoUIActive()&&this.hasAnyItemsSelected()&&(t==null?void 0:t.type)==="multi-select-label";if(e.type==="global-mute-button")return!!((i=this.toneController)!=null&&i.someExpressionsShouldPlayTones());if(e.type==="color-picker-option")return!0;let o;if(t&&t.type==="table-column"?o=t.model.table:o=this.getItemModel(e.id),!o)return!1;if(e.type==="change-image-btn")return this.listModel&&o.type==="image"&&this.areImagesEnabled();if(e.type==="expression-menu"){let n=this.getOpenItemMenu();if(!n||(n.type==="expression"||n.type==="image"||n.type==="table-column")&&n.model.id!==e.id)return!1;if(e.location==="start"||e.location==="end"||e.location==="updaterule"||e.location==="anywhere"||o.type==="table")return!0;if(o.type!=="expression")return!1;let{points:a,lines:s,fill:l}=o;xu(o)&&(l=!0);let c=__dcg_shared_module_exports__['vd'](o.formula.expression_type,{points:a,lines:s,fill:l},d=>{Vo("getReconciledExpressionProps [Chrome Switch Bug]",{metaData:{method:"isCurrentFocusLocationValid",type:d}})});return!(!c.fill&&!c.points&&!c.lines&&!o.showLabel)}if(e.type==="add-table-regression-btn")return this.areTableRegressionsEnabled()&&o.type==="table"&&!o.regression;if(e.type==="table-regression-delete-btn"||e.type==="table-regression-type-dropdown")return this.areTableRegressionsEnabled()&&o.type==="table"&&!!o.regression;if(!this.isItemSelected(e.id)&&e.type!=="editable-label")return!1;switch(e.type){case"domain-limit":return!(o.type!=="expression"||!pm(o)&&!Ph(o));case"expression-icon":case"top-level-icon":return!0;case"expression-evaluation":return this.shouldShowEvaluationForItem(o.id)||this.shouldShowCDFEvaluationForItem(o.id);case"image-icon":return o.type==="image"&&o.loadStatus!=="loading"&&o.loadStatus!=="failed"&&!o.error;case"action-icon":return!(o.type!=="expression"||!fw(o));case"slider-icon":case"slider-animation-properties-icon":case"slider-thumb":case"slider-limit":return!(o.type!=="expression"||!e7(o));case"table-icon":return o.type==="table"&&this.getGraphSettings().config.graphpaper;case"table-regression-icon":return this.areTableRegressionsEnabled()&&o.type==="table"&&!!o.regression;case"visualization-prop":return!(o.type!=="expression"||!HT(o));case"distribution-param":if(o.type!=="expression")return!1;let n=Yc(o);return n?e.location in n.values:!1;case"cdf-limit":return o.type!=="expression"?!1:mp(o);case"image":return o.type==="image";case"folder":return o.type==="folder";case"text":return o.type==="text";case"expression":return!(o.type!=="expression"||this.isInEditListMode()||e.isFakeGraphFocus&&!this.getValidCursorContext());case"readonly-expression":return this.isItemReadonly(o.id)||o.type==="expression"&&this.isInEditListMode();case"table":return o.type!=="table"?!1:g6(o,e.location);case"table-container":return o.type==="table"&&this.isInEditListMode();case"editable-label":return o.type!=="expression"?!1:gw(o);default:return e}}shouldAllowMovingPointsWithKeyboard(){let e=this.getActiveTool();return e==="selection"||e==="box-selection"}isDragDropActive(){return!!this.listModel.dragState}isItemBeingDragged(e){let t=this.listModel.dragState;return!(!t||t.firstItemId!==e)}shouldRenderDraggedItemAsToken(){let e=this.listModel.dragState;return e?e.renderType==="token":!1}canDraggedItemBeMovedIntoTokenPane(){var i,n,a;let e=this.getDraggedItemId();if(!e)return!1;let t=this.getItemModel(e);if(!t||t.type!=="expression"||this.isItemMarkedReadonly(t.id))return!1;let o=(i=t.formula.geometry)==null?void 0:i.valueType;return o===void 0||(n=t.formula.geometry)!=null&&n.unconstructable||t.formula.recursion_base_case||t.formula.function_definition&&!__dcg_shared_module_exports__['fb'](o,__dcg_shared_module_exports__['Ea'])?!1:!!((a=t.formula.geometry)!=null&&a.parentDependencies)}getDraggedItemId(){let e=this.listModel.dragState;return e&&e.firstItemId}getDraggedIdentifier(){var o;let e=this.getRawDragState();if(!e)return;let t=this.getItemModel(e.dragTarget.calcId);if(!(!t||t.type!=="expression"))return(o=xn(t))==null?void 0:o.identifier}getRawDragState(){return this.listModel.dragState}initStateStack(){this.stateStack=new yg,this.stateStack.addState({diffState:this.getUndoRedoDiffState(),fullState:this.getUndoRedoFullState()})}getUndoRedoDiffState(){var e;return{randomSeed:this.getRandomSeed(),includeFunctionParametersInRandomSeed:this.getIncludeFunctionParametersInRandomSeed(),layoutModel:this.layoutModel,settingsViewModel:this.settingsViewModel,graph:(e=this.getGrapher())==null?void 0:e.getUndoRedoDiffState(),expressions:XK(this.listModel),geometryToolbar:O2(this.geometryToolbarModel),wasCompleteSetState:this.isCurrentlyDoingSetState}}getUndoRedoFullState(){var e;return{randomSeed:this.getRandomSeed(),includeFunctionParametersInRandomSeed:this.getIncludeFunctionParametersInRandomSeed(),layoutModel:this.layoutModel,settingsViewModel:this.settingsViewModel,graph:(e=this.getGrapher())==null?void 0:e.getUndoRedoFullState(),expressions:X2(this.listModel),geometryToolbar:O2(this.geometryToolbarModel),wasCompleteSetState:this.isCurrentlyDoingSetState}}getState(e){var a,s;let t={stripDefaults:!0};e&&e.hasOwnProperty("stripDefaults")&&(t.stripDefaults=!!e.stripDefaults);let o=(s=(a=this.getGrapher())==null?void 0:a.getState(t))!=null?s:{...this.getBlankState().graph,degreeMode:this.graphSettings.degreeMode},i={version:Od,randomSeed:this.getRandomSeed(),graph:o,expressions:JK(this.listModel,t)},n=this.getIncludeFunctionParametersInRandomSeed();if((!n||!t.stripDefaults)&&(i.includeFunctionParametersInRandomSeed=n),this.isGeometry()){let l=V6(this.geometryToolbarModel,t);l&&(i.geometryToolbar=l)}return e&&e.avoidBackMigration?__dcg_shared_module_exports__['i'](i):L$(__dcg_shared_module_exports__['i'](i))}getHistory(){return new ZV(this.getState(),this.stateStack)}getProduct(){return this.graphSettings.config.product}isGeometry(){return this.getProduct()==="geometry-calculator"}is3dProduct(){return this.getProduct()==="graphing-3d"}isMultiSelectEnabled(){return this.isGeometry()}shouldEvaluateSelection(){return this.isGeometry()}canLoadPastedLink(e){return this.graphSettings.config.pasteGraphLink?this.isGeometry()?xV(e)||_B(e)||GB(e):this.is3dProduct()?TB(e):xV(e):!1}getBlankState(e){if(this.isGeometry())return $w;if(this.is3dProduct())return _ee;let t;(e==null?void 0:e.degreeMode)!==void 0?t=e.degreeMode:t=this.graphSettings.config.clearIntoDegreeMode;let o={...Eb.graph};return t&&(o.degreeMode=!0),{...Eb,graph:o}}externalSetState(e,t){var s;this._clearPendingImageUploads(),this.rootElt&&document.activeElement&&this.rootElt.contains(document.activeElement)&&re(document.activeElement).trigger("blur"),t||(t={}),e||(e=this.getBlankState()),typeof e=="string"&&(e=JSON.parse(e));let o=vp(e);!this.canEnableComplexMode()&&((s=o==null?void 0:o.graph)!=null&&s.complex)&&(o.graph.complex=!1,o.graph.degreeMode=e.graph.degreeMode);let i=this.graphSettings.config.product,n;if(!o.graph||o.graph.product===void 0?n="graphing":n=o.graph.product,n!==i)throw new Error(`Data Error: state appears to have been saved in the '${n}' product and cannot be opened in the '${i}' product.`);i==="geometry-calculator"&&(this.showConstructionsOpen=!1),gx&&i==="graphing-3d"&&o.graph.speed3D&&delete o.graph.speed3D;let a=this.layoutModel;this.setState(o,t),KK(this.listModel),bT(this.listModel),this.layoutModel={...t5(this.graphSettings.config),keypadMinimized:a.keypadMinimized,keypadLayout:a.keypadLayout,keypadFunctionsOpen:a.keypadFunctionsOpen,expressionsVisible:!!this.graphSettings.config.expressions&&(this.isListVisible()||!!t.forceExpressionsOpen)},this.settingsViewModel=r5(),Do(this,void 0),t.forceUnsavedChanges?this.enqueueEvent("change"):this.enqueueEvent("clearUnsavedChanges")}setState(e,t){var o;if(this.isCurrentlyDoingSetState=!0,"graph"in e&&e.graph!==void 0){if("threeDMode"in e.graph&&e.graph.threeDMode&&this.grapher3d){if("showBox3D"in e.graph&&this.grapher3d.webglLayer.showBox(e.graph.showBox3D),"showAxis3D"in e.graph&&this.grapher3d.webglLayer.showAxes(!!e.graph.showAxis3D),"showAxisLabels3D"in e.graph&&this.grapher3d.webglLayer.updateAxes(),"showPlane3D"in e.graph||"showAxis3D"in e.graph){let a=("showPlane3D"in e.graph?!!e.graph.showPlane3D:this.graphSettings.showPlane3D)&&("showAxis3D"in e.graph?!!e.graph.showAxis3D:this.graphSettings.showAxis3D);this.grapher3d.webglLayer.showPlane(a)}let n=this.grapher3d.baseplaneWidth();this.grapher2d.setCanvasSizeFor3D(n,n),this.grapher3d.webglLayer.setBackgroundColor(e.graph.backgroundColor3d)}let i=this.getGrapher();i?i.setGrapherState(e.graph):Bb.copyGraphProperties(e.graph,this.graphSettings),"threeDMode"in e.graph&&e.graph.threeDMode&&this.grapher3d&&this.grapher3d.controls.copyWorldRotationToWorld()}if("expressions"in e){vo(this.listModel,void 0);let i=QK(e.expressions);i>=this.__nextItemId&&(this.__nextItemId=i+1),ZK(this.listModel,e.expressions,t||{})}if(e.layoutModel&&(this.layoutModel=e.layoutModel),e.settingsViewModel&&(this.settingsViewModel=e.settingsViewModel),(!t||!t.allowUndo)&&this.clearUndoRedoHistory(),this.setRandomSeed(e.randomSeed||eu()),this.setIncludeFunctionParametersInRandomSeed((o=e.includeFunctionParametersInRandomSeed)!=null?o:hc.includeFunctionParametersInRandomSeed),"geometryToolbar"in e){let i=e.geometryToolbar;this.geometryToolbarModel=Y_(i)}}updateToState(e){if(this.isCurrentlyDoingRestoreState=!0,"graph"in e&&(e.graph.threeDMode?this.grapher3d&&this.grapher3d.setGrapherState(e.graph):this.grapher2d&&this.grapher2d.setGrapherState(e.graph,{doNotClear:!0})),"expressions"in e&&eW(this.listModel,e.expressions),e.layoutModel&&(this.layoutModel=e.layoutModel),e.settingsViewModel&&(this.settingsViewModel=e.settingsViewModel),"geometryToolbar"in e){let t=e.geometryToolbar;this.geometryToolbarModel=Y_(t)}}commitUndoRedoSynchronously(e){let t=this.stateStack.getState(),o=t&&t.diffState,i=this.getUndoRedoDiffState();if(txe(o,i))return;let n=this.apiMethodCallStackInfo.withHistoryReplacementDepth>0,a={diffState:i,fullState:this.getUndoRedoFullState()};if(!n&&Lee(e))this.stateStack.addState(a),this.enqueueEvent("change",e);else{let s=t&&t.fullState.wasCompleteSetState||a.fullState.wasCompleteSetState,l={diffState:{...a.diffState,wasCompleteSetState:s},fullState:{...a.fullState,wasCompleteSetState:s}};this.stateStack.replaceInteriorState(l)}}undo(){if(!this.canUndo())return;this.closeToast(),this.stateStack.undo();let e=this.stateStack.getState().fullState;e.wasCompleteSetState?this.setState(e,{allowUndo:!0}):this.updateToState(e),this.enqueueEvent("change",{type:"undo"})}redo(){if(!this.canRedo())return;this.stateStack.redo();let e=this.stateStack.getState().fullState;e.wasCompleteSetState?this.setState(e,{allowUndo:!0}):this.updateToState(e),this.enqueueEvent("change",{type:"undo"})}clearUndoRedoHistory(){this.stateStack.clear()}canUndo(){return this.stateStack.canUndo()}canRedo(){return this.stateStack.canRedo()}closeToast(){let e=this.toastData.onHide;e&&this.runAfterDispatch(e),this.toastData={}}_closeAddExpression(){this.layoutModel={...this.layoutModel,addExpressionOpen:!1}}doesDOMHaveSize(){return this.layoutMeasurements.width>0&&this.layoutMeasurements.height>0}_getExpListWidth(){let e;if(this.userSpecifiedExpListWidth!==void 0){let o=this.isGeometry()?320:200;e=Math.max(320,Math.min(this.layoutMeasurements.width-o,this.userSpecifiedExpListWidth))}else{if(e=this.layoutMeasurements.width,!e)return 356;let o=.2*e+160;e=Math.min(500,Math.max(280,o))}let t=this.layoutMeasurements.width-this.getGrapherHeight();return Math.abs(t-e)<=10?t:e}_setExpListWidth(e){this.userSpecifiedExpListWidth!==e&&(this.userSpecifiedExpListWidth=e)}getKeypadHeight(){return this.computeMajorLayout().keypad.height}isKeypadEnabled(){return!!this.graphSettings.config.keypad}isKeypadOpen(){if(!this.isKeypadEnabled())return!1;let e=this.layoutModel.keypadMinimized&&!this.isNarrow();return this.needsFakeKeypad()&&!e}isHideKeypadButtonVisible(){return this.getBrailleMode()==="none"&&this.isKeypadOpen()&&(!this.isNarrow()||this.inAudioTraceMode())}isKeypadFunctionsPopoverOpen(){return!!this.layoutModel.keypadFunctionsOpen}getKeypadLayout(){let e=this.layoutModel.keypadLayout;return this.isThreeDMode()?Gee(e):e}isLetterKeypadOpen(){let e=this.getKeypadLayout();return this.isKeypadOpen()&&(e==="letters"||e==="noQwertyLetters"||e==="capitalLetters"||e==="noQwertyCapitalLetters")}isFileDraggedOver(){return this.layoutModel.isFileDraggedOver}getGeoToolbarHeight(){return this.shouldShowGeoToolbar()?48:0}isNarrowGeometryHeader(){return this.computeMajorLayout().grapher.width<450}shouldShowMultiSelectHeader(){return this.getSelectedGeoExpression()||this.hasMultipleItemsSelected()}getGrapherHeight(){return this.layoutMeasurements.height-this.getGeoToolbarHeight()}computeMajorLayout(){let e=this.layoutMeasurements.width,t=this.layoutMeasurements.height,o=this.isNarrow(),i=this.isListVisible(),n=this.isKeypadOpen(),a=!this.isGrapherEnabled(),s=!this.isListEnabled(),l=!!this.getGraphSettings().config.projectorMode,c={left:0,top:0,width:0,height:0},d={left:0,top:0,width:0,height:0,paddingTop:0},p={left:0,top:t,width:e,height:l?o?185:193:169};s?(d.width=e,d.height=t):a?(c.width=e,c.height=t):i?o?(c.width=e,c.height=Math.round(.58*t),c.top=t-c.height,d.width=e,d.height=t-c.height):(c.width=this.getExpListWidth(),c.height=t,d.left=c.width,d.width=e-d.left,d.height=t):i||(o?(c.width=e,c.height=Math.round(.58*t),c.top=t,d.width=e,d.height=t):(c.width=this.getExpListWidth(),c.height=t,c.left=-c.width,d.width=e,d.height=t)),n&&(p.top-=p.height,s||(c.height-=p.height));let u=this.getGeoToolbarHeight();return u&&(d.top+=u,d.height-=u),{list:c,grapher:d,keypad:p}}isNarrow(){return this.isGeometry()?this.layoutMeasurements.width<600:this.layoutMeasurements.width<450}getLayoutMeasurements(){return this.layoutMeasurements}getCapExpressionSize(){return!!this.getGraphSettings().config.capExpressionSize}handleAudioTraceCommand(e){let t=this.getAudioGraph();if(t===void 0)return;let o=t.agNavigator;switch(e){case"on":this.runAfterDispatch(()=>{t.enterAudioTrace({fromKeypad:!0})});break;case"off":this.runAfterDispatch(()=>{t.exitAudioTrace()});break;case"hear-graph":t.hearGraph();break;case"stop-graph":t.stopGraph();break;case"volume-down":t.adjustVolume("down");break;case"volume-up":t.adjustVolume("up");break;case"speed-down":t.speedDown();break;case"speed-up":t.speedUp();break;case"previous-point":this.runAfterDispatch(()=>{t.reportAndMoveToPrevPoint()});break;case"next-point":this.runAfterDispatch(()=>{t.reportAndMoveToNextPoint()});break;case"previous-poi":this.runAfterDispatch(()=>{t.reportAndMoveToPrevPOI()});break;case"next-poi":this.runAfterDispatch(()=>{t.reportAndMoveToNextPOI()});break;case"previous-curve":this.runAfterDispatch(()=>{o.prevCurve()});break;case"next-curve":this.runAfterDispatch(()=>{o.nextCurve()});break;case"describe-point":t.describePoint();break;case"describe-curve":t.describeCurve();break;case"describe-axes":t.describeAxes();break;case"keyboard-shortcuts":this.enqueueEvent("showHotkeysModal",{type:"keypad/audio-trace",command:e});break;default:return e}}setAudioTraceSpeed(e){let t=this.getAudioGraph();t&&t.adjustPlaybackSpeed(e)}setGraphPaperFocus(e){var t;Do(this,e.isFocused?{type:"graph-paper"}:void 0),(t=this.get2dPOIController())==null||t.keyboardAttentionManager.setKeyboardAttention(void 0),this.requestRedrawGraph(),e.isFocused&&this.isGeoToolActive()&&this.runAfterDispatch(()=>{var o;(o=this.get2dPOIController())==null||o.keyboardAttentionManager.handleGrapherGainedFocus()})}isGraphPaperFocused(){let e=this.getFocusLocation();return e?!!(e.type==="graph-paper"||e.type==="expression"&&e.isFakeGraphFocus):!1}isVirtualMouseAllowed(){return!(!this.isGeometry()||!this.isGraphPaperFocused()||!this.geoModel.getCurrentTool().canNextInputBePoint())}isClickableId(e){return Zx(this.getItemModel(e))}setCanShowKeyboardShortcuts(e){this.canShowKeyboardShortcuts=e}getCanShowKeyboardShortcuts(){return this.canShowKeyboardShortcuts}apply3dProps(e){if(!this.isThreeDMode()||!this.grapher3d)return;let t=this.grapher3d.webglLayer;for(let o in e)switch(o){case"showPlane3D":t.showPlane(this.showPlane3D());break;case"showBox3D":t.showBox(!!e[o]);break;case"showAxis3D":t.showAxes(!!e[o]),t.showPlane(this.showPlane3D());break;case"showAxisLabels3D":t.updateAxes();break;default:break}}getGeometryTokenCount(){if(!this.cachedGeoTokenDepths)return 0;let e=0;return __dcg_shared_module_exports__['l'](__dcg_shared_module_exports__['H'](this.cachedGeoTokenDepths),t=>e+=t?t.length:0),e}getAllGeometryConstructionIds(){return GK(this.listModel,__dcg_shared_module_exports__['xb'])}makeGeoAPI(){this.geoModel=new IE(this)}getGeoTokenInfoFromIdentifier(e){if(e)return this.cachedGeoTokenInfo[e]}getGhostMode(){return this.getGraphSettings().config.getProperty("ghostMode")}getshowKeyboardShortcutsInTooltips(){return!!this.getGraphSettings().config.showKeyboardShortcutsInTooltips}isDispatching(){return this.dispatcher.isDispatching()}getSuggestedIdentifierRenameInfo(e){return this.listModel.renamePrompt.suggestionForId(e)}getMathquillConfig(e){let t=e.additionalOperators||[];return this.toneAllowed()&&t.push("tone"),{...Sx({additionalOperators:t,includeGeometryFunctions:this.isGeometry(),include3DFunctions:this.is3dProduct()}),autoCommands:Qg({additionalCommands:this.isGeometry()?[]:["int"],disallowAns:this.isGeometry()})}}constrainMultiSelect(){if(this.isMultiSelectEnabled())return;let e=yT(this.listModel);e.length>1&&vo(this.listModel,e[0])}focusFirstExpression(){if(!this.getGraphSettings().config.expressions)return;let e=jx(this.listModel);e&&Dn(this,e.id,"end")}_updateToneAvailability(){let e=this.toneAllowed();e&&!this.toneController?this.toneController=new Q0(this):!e&&this.toneController&&(this.toneController=void 0)}toneItemsExist(){return this.toneEnabled()?this.getAllItemModels().some(e=>vc(e)):!1}toneAllowed(){return!!(this.graphSettings.config.audio&&this.graphSettings.config.tone)}toneEnabled(){return!!this.toneController}isAdaptivePeelingSettled(){let e=this.adaptiveDepthPeelingInfo;return(e==null?void 0:e.status)===2||(e==null?void 0:e.status)===1&&(e==null?void 0:e.peelLayers)>=Vv}setAdaptiveDepthPeelingInfo(e){let t=this.adaptiveDepthPeelingInfo;this.adaptiveDepthPeelingInfo=e,this.isAdaptivePeelingSettled()||this.requestRedrawGraph(),(t==null?void 0:t.peelLayers)!==e.peelLayers&&this.dispatch({type:"render"})}getAdaptiveDepthPeelingInfo(){return this.adaptiveDepthPeelingInfo}handleEvaluatorProgressUpdates(){this.checkSlowAnalysis=!0,this.requestedEvaluatorRestart=!1}clearSlowEvaluatorTracking(){this.expressionActionsToRestartIfSlow=[],this.checkSlowAnalysis=!1,this.requestedEvaluatorRestart=!1}handlePossiblySlowEvaluator(){if(!this.isEvaluatorSlow())return!1;let e=!1;return this.expressionActionsToRestartIfSlow.some(({action:t,id:o})=>this.shouldRestartForAction(t,o))?(this.requestEvaluatorRestart(),e=!0):this.checkSlowAnalysis&&(e=!0,this.checkSlowAnalysis=!1),e}shouldRestartForAction(e,t){switch(e){case"edit":case"remove":return this.isActivelyComputing(t);case"hide":return this.getEvaluatorStateForItem(t)==="GRAPHING";default:return e}}isEvaluatorSlow(){return!this.requestedEvaluatorRestart&&this.evaluator.isCurrentlySlow()}requestEvaluatorRestart(){this.evaluator.requestRestartWorker(),this.clearSlowEvaluatorTracking(),this.requestedEvaluatorRestart=!0}shouldShowProgressUpdateLegend(){return this.getGraphSettings().config.debugProgressUpdates&&!this.progressUpdateLegendHidden}isItemSlowInEvaluator(e){return this.isActivelyComputing(e)&&this.isEvaluatorSlow()}isActivelyComputing(e){return BZ(this.getEvaluatorStateForItem(e))}trackActionForPotentialEvaluatorRestart(e,t){this.expressionActionsToRestartIfSlow.push({action:e,id:t})}shouldShowProgressUpdateColors(){return this.shouldShowProgressUpdateLegend()}shouldShowProgressUpdateIcons(){return this.getGraphSettings().config.debugProgressUpdates}isComplexModeEnabled(){return this.canEnableComplexMode()&&this.graphSettings.complex}canEnableComplexMode(){return this.graphSettings.config.allowComplex}shouldShowSliderPrompt(e){let t=Vh(e);return t.length>0&&t.length<=4?!0:this.areSlidersEnabled()?ew(e).length>0:!1}shouldShowRegressionButton(e){return this.is3dProduct()||!this.areTableRegressionsEnabled()||e.type!=="table"||e.regression||e.columnModels.length<2?!1:up(e.columnModels[0])&&rm(e.columnModels[0])&&e.columnModels.slice(1).some(t=>up(t)&&rm(t))}renameTableColumnsForGlobalExport(e,t){let o=this.getExportedVariables();for(let i of t){let n=vi(e,i);if(!n)continue;let a=n.latex;if(!ol(a))continue;let s=__dcg_shared_module_exports__['ac'](a);if(o.isMultiplyDefined(s,{includeRegressionExports:!0})){let l=s.split("_")[0],c=o.getLastSubscriptForName(l,{includeRegressionExports:!0}),d=`${l}_{${c+1}}`;mu(this.listModel,a,d,{limitToItem:e.id}),o.optimisticallyRegisterColumnName(__dcg_shared_module_exports__['ac'](d))}}}exportTableRegression(e,t){var l,c;let o=this.getItemModel(t);if((o==null?void 0:o.type)!=="table")return;let i=o.regression;if(!i)return;let n="";if(e==="regression"){this.renameTableColumnsForGlobalExport(o,[i.columnIds.x,i.columnIds.y]);let d=x6(o);if(!d)return;n=__dcg_shared_module_exports__['se'](i.type,{operator:"~",variables:d});let p=__dcg_shared_module_exports__['ue'](n),u=Z2(this.listModel),h;p.some(m=>u.isDefined(m,{includeRegressionExports:!1}))&&(h=1+Math.max(...p.map(m=>u.getLastSubscriptForName(m,{includeRegressionExports:!1})))),n=n.replace(__dcg_shared_module_exports__['te'],(m,y)=>h!==void 0?`${y}_{${h}}`:y)}else{let d=((c=(l=o.formula)==null?void 0:l.table_regression)==null?void 0:c.status)==="success"?o.formula.table_regression.result:void 0;if(!d)return;n=__dcg_shared_module_exports__['se'](i.type,{operator:"=",variables:["x","y"],parameterValues:o5(d)})}let a=this.createItemModel({type:"expression",id:this.generateId(),latex:Ze.normalizeLatex(n,this.getMathquillConfig({})),color:this.getNextColor(),hidden:!1}),s=1+o.index;wc(this.listModel,a,s),this.setEditListMode(!1),Dn(this,a.id)}getExportedVariables(){return Z2(this.listModel)}};function o5(r){let e=r.displayPrecision,t={};for(let[o,i]of Object.entries(r.parameters)){let n=Math.abs(i)>=1e9?6:4,a=xB(i),s=Math.max(e,n,a+3);t[o]=parseFloat(i.toPrecision(s))}return t}function Pee(r){return r&&{...r,wasCompleteSetState:void 0,layoutModel:void 0,settingsViewModel:void 0}}function txe(r,e){return __dcg_shared_module_exports__['J'](Pee(r),Pee(e))}var{SwitchUnion:rxe,If:tL,IfDefined:i5,IfElse:oxe}=gt.Components,rL=class extends gt.Class{init(){this.model=this.props.table(),this.controller=this.props.controller(),this.dropdownOpen=!1}customRegressionsEnabled(){return this.controller.getGraphSettings().config.customRegressions}template(){return i5(()=>this.getRegression(),e=>gt.createElement("div",{class:()=>({"dcg-table-regression":!0,"dcg-do-not-blur":!0}),handleEvent:gt.const("true"),onKeyDown:this.bindFn(this.handleKeyDown)},gt.createElement("div",{class:()=>({"dcg-dropdown-row":!0,"dcg-dropdown-row__has-column-picker":this.shouldShowColumnDropdown()})},gt.createElement("div",{class:gt.const("dcg-dropdown-row__plot-and-model")},gt.createElement("div",{class:gt.const("dcg-icon-container")},rxe("status",()=>e().evaluated)({error:t=>gt.createElement(zn,{instant:this.const(!0),error:()=>this.controller.unpack(t().error)}),success:()=>gt.createElement("div",{class:gt.const("dcg-circular-icon-container"),role:gt.const("button"),tabIndex:gt.const("0"),"dcg-open-menu-guid":()=>this.getGuid(),"aria-label":this.bindFn(this.getIconAriaLabel),onTap:t=>{if(!t.wasLongheld()){if(t.shiftKey||this.optionsOpen()||this.controller.isInEditListMode())return this.toggleOptions();this.setHidden(!e().spec.hidden)}},onLongHold:t=>{t.handle("dcg-longhold"),t.handle("dcg-tap"),this.toggleOptions()},manageFocus:this.const(ct({controller:this.controller,location:{type:"table-regression-icon",id:this.model.id}}))},gt.createElement(Ji,{iconType:()=>e().spec.hidden?"hidden":"graph-default",backgroundColor:()=>{var t;return{type:"single-color",value:(t=e().spec.color)!=null?t:""}},whiteIcon:this.const(!1),foregroundColor:this.const(""),iconModifier:this.const("none"),backgroundOpacity:this.const(1)}))})),gt.createElement(gf,{id:()=>`regression-model-${this.model.id}`,controller:()=>this.controller,options:()=>this.getModelOptions(),onOpenChange:this.bindFn(this.onDropdownOpenChange),externalControl:this.const({getValue:()=>this.getRegressionType(),onValueChange:t=>{this.controller.dispatch({type:"update-table-regression",tableId:this.model.id,update:{type:t}})}}),manageFocus:this.const(ct({controller:this.controller,location:{type:"table-regression-type-dropdown",id:this.model.id}})),buildFooter:()=>this.customRegressionsEnabled()?gt.createElement("div",{class:gt.const("dcg-table-regression-view__custom-model-notice")},gt.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-text-make-custom-regression")},gt.const("Make a custom regression model in a new line using"),gt.const(" "),gt.createElement("span",{class:gt.const("dcg-tilde")},gt.const("~")),gt.const("."),gt.const(" "),gt.createElement("a",{class:gt.const("dcg-blue-link"),href:gt.const("https://help.kiavash.com/hc/en-us/articles/4406972958733-Regressions"),target:gt.const("_blank")},gt.const("Learn how")),gt.const("."))):[]})),gt.createElement("div",{class:gt.const("dcg-dropdown-row__breakable")},gt.createElement(tL,{predicate:()=>this.shouldShowColumnDropdown()},()=>gt.createElement("div",{class:gt.const("dcg-table-regression__dropdown-separator")},()=>this.controller.s("shared-calculator-label-for"))),gt.createElement(tL,{predicate:()=>this.shouldShowColumnDropdown()},()=>gt.createElement("div",{class:gt.const("dcg-dropdown-row__column-selector")},gt.createElement(gf,{id:()=>`regression-data-${this.model.id}`,controller:()=>this.controller,options:()=>this.getColumnOptions(),onOpenChange:this.bindFn(this.onDropdownOpenChange),externalControl:this.const({getValue:()=>`id-${e().spec.columnIds.y}`,onValueChange:t=>{this.controller.dispatch({type:"update-table-regression",tableId:this.model.id,update:{columnIds:{x:e().spec.columnIds.x,y:t.substring(3)}}})}})}))),oxe(this.bindFn(this.customRegressionsEnabled),{true:()=>gt.createElement(iE,{anchor:()=>gt.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-text-view-regression-options")},gt.createElement(av,null)),anchorAriaLabel:()=>this.controller.s("graphing-calculator-text-view-regression-options"),controlled:()=>({isOpen:this.dropdownOpen,setDropdownOpen:this.bindFn(this.setDropdownOpen)}),guid:()=>`view-source-regression-${this.model.id}`,dropdownProps:this.const({position:this.const("bottom-left")}),dropdownOffset:()=>-15,manageFocus:this.const({itemNavigationKey:"tab"})},gt.createElement("div",{class:gt.const("dcg-generic-options-menu")},gt.createElement("div",{class:gt.const("dcg-options-menu-section")},gt.createElement("div",{class:gt.const("dcg-expression-footer-title")},()=>this.controller.s("graphing-calculator-heading-table-regression-model-structure")),gt.createElement("div",{class:gt.const("dcg-regression-model")},gt.createElement(pd,{controller:this.props.controller,latex:this.bindFn(this.buildLatexForRegressionModel),ariaLabel:()=>this.controller.s("graphing-calculator-heading-table-regression-model-structure"),focusLocation:this.const({type:"regression-output",id:this.model.id,parameter:"model"}),tabbable:this.const(!1)})),i5(()=>this.getExportErrorReason(),t=>gt.createElement("div",{class:gt.const("dcg-regression-popover__unexportable-warning dcg-text-selectable")},gt.createElement(Bl,{content:()=>this.controller.unpack(t()),mqConfig:()=>this.controller.getMathquillConfig({})})))),gt.createElement("div",{class:gt.const("dcg-options-menu-section")},gt.createElement(tL,{predicate:()=>!this.getExportErrorReason()},()=>gt.createElement("button",{class:gt.const("dcg-btn-light-gray dcg-regression-popover__export-to-list"),onTap:()=>this.copyToExpressionList("regression")},()=>this.controller.s("graphing-calculator-button-copy-table-regression-model-to-expression-list"))),gt.createElement("button",{class:gt.const("dcg-btn-red dcg-regression-popover__delete"),onTap:()=>{this.setDropdownOpen(!1),this.controller.dispatch({type:"remove-table-regression",tableId:this.model.id})},manageFocus:this.const(ct({controller:this.controller,location:{type:"table-regression-delete-btn",id:this.model.id}}))},()=>this.controller.s("graphing-calculator-button-delete-table-regression"))))),false:()=>gt.createElement("i",{class:gt.const("dcg-icon-remove"),role:gt.const("button"),tabIndex:gt.const("0"),"aria-label":()=>this.controller.s("graphing-calculator-button-delete-table-regression"),onTap:()=>this.controller.dispatch({type:"remove-table-regression",tableId:this.model.id}),manageFocus:this.const(ct({controller:this.controller,location:{type:"table-regression-delete-btn",id:this.model.id}}))})}))),gt.createElement(tL,{predicate:()=>e().evaluated.status==="success"},()=>gt.createElement("div",null,gt.createElement("div",{class:gt.const("dcg-expression-footer-title dcg-expression-footer-title__equation")},()=>this.controller.s("graphing-calculator-heading-regression-equation"),gt.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-text-export-snapshot")},gt.createElement("button",{class:gt.const("dcg-unstyled-button dcg-copy-regression-button"),onTap:()=>this.copyToExpressionList("equation"),"aria-label":()=>this.controller.s("graphing-calculator-text-export-snapshot")},gt.createElement("i",{class:gt.const("dcg-icon-insert"),"aria-hidden":gt.const("true")})))),gt.createElement("div",{class:gt.const("dcg-regression-equation dcg-do-not-blur"),onTap:this.bindFn(this.ensureTableSelected),didMount:this.bindFn(this.didMountRegressionEquation),didUnmount:this.bindFn(this.didUnmountRegressionEquation)},gt.createElement(pd,{controller:this.props.controller,latex:this.bindFn(this.buildLatexForRegressionEquation),ariaLabel:()=>this.controller.s("graphing-calculator-narration-table-regression-equation"),focusLocation:this.const({type:"regression-output",id:this.model.id,parameter:"equation"}),tabbable:this.const(!0)})),i5(()=>this.getRegressionDetails(),t=>gt.createElement($v,{controller:()=>this.controller,model:()=>this.model,hideParameters:this.const(!0),regression:t,suppressRMSE:this.const(!0),suppressLogModeCheckbox:()=>!__dcg_shared_module_exports__['re'](this.getRegressionType()),showRValue:()=>this.getRegressionType()==="linear"?"always":"never"}))))))}getExportErrorReason(){let e=this.getRegression();if(e){if(e.evaluated.status==="error")return e.evaluated.error;if(e.evaluated.export_info.status==="unexportable")return e.evaluated.export_info.reason}}buildLatexForRegressionEquation(){let e=this.getRegression();return!e||e.evaluated.status!=="success"?"":__dcg_shared_module_exports__['se'](e.spec.type,{operator:"=",variables:["x","y"],parameterValues:o5(e.evaluated.result)})}buildLatexForRegressionModel(){let e=this.getRegression();return!e||e.evaluated.status!=="success"?"":__dcg_shared_module_exports__['se'](e.spec.type,{operator:"~",variables:["x","y"],parameterValues:"canonical"})}didMountRegressionEquation(e){this.regEqNode=e}didUnmountRegressionEquation(){this.cachedRegEqLatex="",this.regEqNode=void 0}addLineBreaks(){if(!this.regEqNode)return;let e=this.buildLatexForRegressionEquation();e!==this.cachedRegEqLatex&&(this.cachedRegEqLatex=e,this.regEqNode.querySelectorAll(".dcg-mq-binary-operator").forEach(t=>{var o,i;t.textContent!=="+"&&t.textContent!=="\u2212"||(i=(o=t.parentNode)==null?void 0:o.classList)!=null&&i.contains("dcg-mq-root-block")&&t.classList.add("dcg-break-before")}))}didUpdate(){this.addLineBreaks()}onDropdownOpenChange(e){e&&this.controller.scrollItemIntoView(this.model)}getRegressionType(){var e,t;return(t=(e=this.getRegression())==null?void 0:e.spec.type)!=null?t:"linear"}ensureTableSelected(){let e=this.model.id;this.controller.isItemSelected(e)||this.controller.dispatch({type:"set-selected-id",id:e,state:"selected"})}getRegressionDetails(){var e,t;if(((t=(e=this.model.formula)==null?void 0:e.table_regression)==null?void 0:t.status)==="success")return this.model.formula.table_regression.result}hasAnyNonPositiveXValues(){let e=this.model.regression;if(!e)return!1;let t=vi(this.model,e.columnIds.x);return __dcg_shared_module_exports__['o']((t==null?void 0:t.computedValues)||[],o=>parseFloat(o)<=0)}getRegression(){var o;if(!this.controller.areTableRegressionsEnabled())return;let e=this.model.regression,t=(o=this.model.formula)==null?void 0:o.table_regression;if(e){let i=vi(this.model,e.columnIds.x),n=vi(this.model,e.columnIds.y);!i||!n||i.hasNanOrErrorValue||n.hasNanOrErrorValue?t={status:"error",error:__dcg_shared_module_exports__['nc']().getError()}:!up(i)||!up(n)?t={status:"error",error:__dcg_shared_module_exports__['nc']().getError()}:e.type==="logarithmic"&&this.hasAnyNonPositiveXValues()&&(t={status:"error",error:__dcg_shared_module_exports__['oc']().getError()})}return e&&t?{spec:e,evaluated:t}:void 0}shouldShowColumnDropdown(){return this.getColumnOptions().length>1}getColumnOptions(){let e=new Set,t=this.model.regression;return t&&(e.add(t.columnIds.x),e.add(t.columnIds.y)),this.model.columnModels.slice(1).filter(o=>e.has(o.id)||up(o)).map(o=>({label:"`"+o.latex+"`",id:"id-"+o.id,disabled:!rm(o)||!up(o)}))}setDropdownOpen(e){this.dropdownOpen=e,e&&this.controller.logEvent({category:"regressions",action:"view-regression-options",name:this.getRegressionType()}),this.update()}getModelOptions(){return[{id:"linear",label:this.controller.s("graphing-calculator-label-table-regression-type-linear")},{id:"quadratic",label:this.controller.s("graphing-calculator-label-table-regression-type-quadratic")},{id:"cubic",label:this.controller.s("graphing-calculator-label-table-regression-type-cubic")},{id:"quartic",label:this.controller.s("graphing-calculator-label-table-regression-type-quartic")},{id:"exponential",label:this.controller.s("graphing-calculator-label-table-regression-type-exponential")},{id:"logarithmic",label:this.controller.s("graphing-calculator-label-table-regression-type-logarithmic")},{id:"power",label:this.controller.s("graphing-calculator-label-table-regression-type-power")},{id:"logistic",label:this.controller.s("graphing-calculator-label-table-regression-type-logistic")},{id:"sinusoidal",label:this.controller.s("graphing-calculator-label-table-regression-type-sinusoidal")}]}copyToExpressionList(e){this.setDropdownOpen(!1),this.controller.dispatch({type:"export-table-regression",tableId:this.model.id,mode:e,regressionType:this.getRegressionType()})}getGuid(){return`table-regression-${this.model.guid}`}toggleOptions(){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"table-regression",model:this.model,guid:this.getGuid(),focusFirstOption:!0}})}setHidden(e){this.controller.dispatch({type:"update-table-regression",tableId:this.model.id,update:{hidden:e}})}optionsOpen(){return this.controller.isItemSettingsMenuOpen(this.getGuid())}getIconAriaLabel(){var e;return this.optionsOpen()?this.controller.s("graphing-calculator-narration-hide-options"):(e=this.model.regression)!=null&&e.hidden?this.controller.s("graphing-calculator-narration-show-table-regression"):this.controller.s("graphing-calculator-narration-hide-table-regression")}handleKeyDown(e){let t=Ho(e);if(!e.altKey&&e.ctrlKey&&!e.metaKey&&e.shiftKey&&t==="O"){if(e.preventDefault(),e.stopPropagation(),this.controller.getOpenItemMenu()!==void 0)return;this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"table-regression",model:this.model,guid:this.getGuid(),focusFirstOption:!0}})}}};var za=__dcg_shared_module_exports__['e'](Z());$t();var{If:ixe,Switch:nxe}=za.Components,AE=class extends za.Class{init(){this.column=this.props.column(),this.controller=this.props.controller(),this.table=this.column.table}template(){return za.createElement("td",{class:()=>({"dcg-cell":!0,"dcg-do-not-blur":!0,"dcg-empty":this.isEmpty(),"dcg-non-editable":!!this.isDisabled(),"dcg-computed-cell":this.isComputed(),"dcg-error":!!this.hasError(),"dcg-selected":this.shouldFocus()&&!this.controller.isItemReadonly(this.table.id)}),onTapStart:this.bindFn(this.focusThisCell)},za.createElement("div",{class:za.const("dcg-inner-border")}),za.createElement("div",null,za.createElement(ixe,{predicate:this.bindFn(this.hasError)},()=>za.createElement("span",{class:za.const("dcg-table-icon-error-container")},za.createElement(zn,{error:this.bindFn(this.getErrorMessage),size:this.const("small")}))),za.createElement(nxe,{key:this.bindFn(this.getType)},e=>{switch(e){case"editable":return za.createElement(Ai,{latex:()=>this.getValue(),operatorNames:()=>this.getMQConfig().autoOperatorNames,brailleShouldFocus:this.bindFn(this.shouldFocusEditableCell),ariaLabel:()=>this.getAriaLabel("braille"),onBrailleInput:t=>this.handleLatexChanged(t),onBrailleFocusedChanged:this.bindFn(this.handleFocusedChanged),onBrailleKeydown:this.bindFn(this.handleKeydownOnBrailleInput),selectOnFocus:this.const(!0),...wn(this.props.controller())},za.createElement(Ze,{latex:()=>this.getValue(),isFocused:()=>this.shouldFocusEditableCell()&&!this.isBraille(),capExpressionSize:()=>this.controller.getCapExpressionSize(),tokenController:this.props.controller,noFadeout:this.const(!0),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.getAriaLabel("speech"),getAriaPostLabel:this.bindFn(this.getErrorMessage),hasError:this.const(!1),onUserPressedKey:(t,o)=>this.handlePressedKey(t,o),onUserChangedLatex:t=>this.handleLatexChanged(t),onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:this.bindFn(this.handleFocusedChanged),selectOnFocus:this.const(!0),needsSystemKeypad:()=>!this.controller.isKeypadEnabled()}));case"tabbable":case"untabbable":return za.createElement(pd,{controller:()=>this.controller,latex:this.bindFn(this.getValue),ariaLabel:()=>this.getAriaLabel("speech"),brailleAriaLabel:()=>this.getAriaLabel("braille"),onKeypress:t=>(this.handleKeydownOnReadonlyCell(t),!0),tabbable:()=>e==="tabbable",focusLocation:this.const({type:"table",id:this.table.id,location:this.lookupCellPosition()})})}})),za.createElement("div",{class:za.const("dcg-empty-line")}))}getType(){return this.controller.isInEditListMode()||this.column===this.table.columnModels[this.table.columnModels.length-1]?"untabbable":this.isColumnEditable()?"editable":"tabbable"}isBraille(){return this.controller.getBrailleMode()!=="none"}isDisabled(){return Lx(this.column)}isComputed(){return f6(this.column)}focusThisCell(e){e.wasHandled()||this.controller.isItemReadonly(this.table.id)||(e.handle(),!this.shouldFocus()&&this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}}))}handlePressedKey(e,t){let o=Ze.getFocusedMathquill();if(o){let i=Ze.handleKeystrokeAndDecideIfSpecialEvent(o,e,t);e===Pn&&(Jr(),t==null||t.preventDefault()),i?(this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:e}),t==null||t.preventDefault()):this.handleLatexChanged(o.latex())}}handleKeydownOnBrailleInput(e){let t=Be(e);if(!t)return;t===Pn&&Jr();let o=t==="Enter"||t==="Up"||t==="Down",i=Yl(),n=i&&t==="Left"&&i.selectionStart===0||t==="Right"&&i.selectionStart===i.value.length;(o||n||(t==="Del"||t==="Backspace")&&this.getValue().length===0)&&(this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:t==="Del"?"Delete":t}),e.preventDefault())}handleKeydownOnReadonlyCell(e){let t=Be(e);switch(t){case"Up":case"Down":case"Left":case"Right":case"Backspace":case"Del":case"Enter":return this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:t}),!0;case"Esc":return Jr(),!0}return!1}handleLatexChanged(e){this.getValue()!==e&&this.controller.dispatch({type:"set-tablecell-latex",tableId:this.table.id,cell:this.lookupCellPosition(),latex:e})}shouldFocus(){return __dcg_shared_module_exports__['J'](this.lookupCellPosition(),ys(this.table))}shouldFocusReadonlyCell(){return!this.controller.isInEditListMode()&&(this.controller.isItemReadonly(this.table.id)||!!this.isDisabled())&&this.shouldFocus()}shouldFocusEditableCell(){return!this.isDisabled()&&this.shouldFocus()}isNodeWithinTableCell(e){if(!e||!e.closest(".dcg-cell"))return!1;let t=this.controller.getItemRootNodeById(this.table.id);return t?re.contains(t,e):!1}handleFocusedChanged(e,t){e?this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}}):this.isNodeWithinTableCell(t.relatedTarget)||this.controller.dispatch({type:"blur-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}})}lookupCellPosition(){return{row:this.props.rowIdx(),column:this.column.index}}getPackedError(){return this.column.packedErrors[this.props.rowIdx()-1]}hasError(){return!!this.getPackedError()}getErrorMessage(){let e=this.getPackedError();return e?this.controller.unpack(e):""}getValue(){let e=this.props.rowIdx()-1,t=this.column.index;return G0(this.table,e,t)}isEmpty(){let e=Yl();return this.getValue()===""&&zv(e)}getAriaLabel(e){if(e==="speech"&&this.isComputed())return this.controller.s("graphing-calculator-narration-computed-cell-role-description");if(e==="braille"){let t=this.lookupCellPosition(),o=t.row,i=t.column+1;return this.controller.raw("r__row__c__column__",{row:o.toString(),column:i.toString()})}return" "}isColumnEditable(){return!this.isDisabled()&&!this.controller.isItemReadonly(this.table.id)&&!this.controller.isInEditListMode()}getMQConfig(){return this.controller.getMathquillConfig({})}};var ti=__dcg_shared_module_exports__['e'](Z());$t();var Ha=__dcg_shared_module_exports__['e'](Z());var{SwitchUnion:axe,If:sxe}=Ha.Components,VE=class extends Ha.Class{init(){this.model=this.props.model(),this.controller=this.props.controller()}template(){return Ha.createElement("div",{class:Ha.const("dcg-table-icon-container")},axe(this.bindFn(this.typeOfIcon),{error:()=>Ha.createElement(zn,{error:()=>this.controller.unpack(this.model.error)}),none:()=>Ha.createElement("span",null),icon:()=>Ha.createElement("div",{"aria-hidden":()=>!this.shouldIconBeFocused(),class:Ha.const("dcg-circular-icon-container"),role:Ha.const("button"),tabIndex:Ha.const("0"),"aria-label":this.bindFn(this.getIconAriaLabel),handleEvent:Ha.const("true"),"dcg-open-menu-guid":()=>this.getMenuGUID(),onTap:e=>{if(!e.wasHandled("dragdrop")&&!e.wasLongheld()){if(this.myOptionsOpen())return this.toggleOptions();if(this.controller.isInEditListMode()||e.shiftKey)return this.toggleOptions();this.toggleGraphShown()}},onLongHold:e=>{e.handle("dcg-longhold"),e.handle("dcg-tap"),this.toggleOptions()},manageFocus:this.const(ct({controller:this.controller,location:{type:"table-icon",id:this.model.table.id,columnId:this.model.id}}))},Ha.createElement(Ji,{iconType:this.bindFn(this.getIcon),backgroundColor:this.bindFn(this.getModelColor)}),Ha.createElement(sxe,{predicate:()=>this.model.disableGraphInteractions},()=>Ha.createElement("i",{class:Ha.const("dcg-graph-interaction-disabled dcg-icon-lock"),"aria-hidden":Ha.const("true")})))}))}getModelColor(){return A0(this.model)}getMenuGUID(){return this.model.guid}myOptionsOpen(){return this.controller.isItemSettingsMenuOpen(this.getMenuGUID())}toggleOptions(){this.controller.dispatch({type:"toggle-item-settings-menu",menu:{type:"table-column",model:this.model,guid:this.getMenuGUID(),focusFirstOption:!1}})}toggleGraphShown(){this.controller.dispatch({type:"toggle-tablecolumn-hidden",tableId:this.model.table.id,columnId:this.model.id})}hasError(){return!!this.model.error}getIcon(){return this.model.shouldGraph?this.controller.isInEditListMode()?"none":this.model.points&&this.model.lines?"table-points-and-lines":this.model.points&&!this.model.lines?"table-points":!this.model.points&&this.model.lines?"table-lines":"none":"hidden"}typeOfIcon(){return this.model.latex===""||!this.controller.getGraphSettings().config.graphpaper?"none":this.model.error?"error":this.model.suppressIcon||this.model.index===0?"none":"icon"}getIconAriaLabel(){return this.myOptionsOpen()?this.controller.s("graphing-calculator-narration-hide-options"):this.controller.isInEditListMode()?this.controller.s("graphing-calculator-narration-show-options"):this.model.shouldGraph?this.controller.s("graphing-calculator-narration-hide-table-column"):this.controller.s("graphing-calculator-narration-show-table-column")}shouldIconBeFocused(){let e=this.controller.getFocusLocation();return __dcg_shared_module_exports__['J'](e,{type:"table-icon",id:this.model.table.id,columnId:this.model.id})}};var{If:LE}=ti.Components,PE=class extends ti.Class{init(){this.model=this.props.model(),this.controller=this.props.controller(),this.table=this.model.table}isRightSide(){return this.lookupCellPosition().column>=this.table.columnModels.length-1}template(){return ti.createElement("th",{class:()=>({"dcg-cell":!0,"dcg-table-header":!0,"dcg-do-not-blur":!0,"dcg-left":this.model.index===0,"dcg-right":this.isRightSide(),"dcg-selected":this.shouldFocus()&&!this.table.readonly,"dcg-error":!!this.model.error&&!!this.model.latex,"dcg-leave-space-for-icon":this.leaveSpaceForIcon(),"dcg-leave-space-for-drag-icon":this.hasDragIcon(),"dcg-could-have-icon":!this.controller.is3dProduct()&&!this.isRightSide()&&this.model.index>0}),index:()=>this.model.index,onTapStart:this.bindFn(this.focusThisCell)},ti.createElement("div",{class:ti.const("dcg-inner-border")}),ti.createElement(LE,{predicate:()=>!this.isRightSide()&&(!this.controller.is3dProduct()||!!this.model.error)},()=>ti.createElement(VE,{model:this.props.model,controller:this.props.controller})),ti.createElement("div",null,ti.createElement(LE,{predicate:()=>!this.controller.isInEditListMode()&&!this.controller.isItemReadonly(this.table.id)},()=>ti.createElement(Ai,{latex:()=>this.model.latex||"",operatorNames:()=>this.getMQConfig().autoOperatorNames,brailleShouldFocus:this.bindFn(this.shouldFocus),ariaLabel:()=>this.getAriaLabel("braille"),onBrailleInput:e=>this.handleLatexChanged(e),onBrailleFocusedChanged:this.bindFn(this.handleMQFocusedChanged),selectOnFocus:this.const(!0),onBrailleKeydown:this.bindFn(this.handleKeydownOnBrailleInput),...wn(this.props.controller())},ti.createElement(Ze,{latex:()=>this.model.latex||"",isFocused:()=>this.shouldFocus()&&this.controller.getBrailleMode()==="none",capExpressionSize:()=>this.controller.getCapExpressionSize(),tokenController:this.props.controller,noFadeout:this.const(!0),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.getAriaLabel("speech"),getAriaPostLabel:this.bindFn(this.getAriaPostLabel),hasError:this.const(!1),onUserPressedKey:(e,t)=>this.handlePressedKey(e,t),onUserChangedLatex:e=>this.handleLatexChanged(e),onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:this.bindFn(this.handleMQFocusedChanged),selectOnFocus:this.const(!0),needsSystemKeypad:()=>!this.controller.isKeypadEnabled()}))),ti.createElement(LE,{predicate:()=>this.controller.isInEditListMode()||this.controller.isItemReadonly(this.table.id)},()=>ti.createElement(Ai,{latex:()=>this.model.latex||"",operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.getAriaLabel("braille"),onBrailleInput:e=>this.handleLatexChanged(e),tabIndex:this.const(-1),isStatic:this.const(!0),brailleShouldFocus:this.bindFn(this.shouldFocusReadonlyCell),onBrailleFocusedChanged:this.bindFn(this.handleMQFocusedChanged),...wn(this.props.controller())},ti.createElement(Et,{latex:()=>this.model.latex||"",config:this.bindFn(this.getMQConfig),tokenController:this.props.controller,getAriaLabel:()=>this.getAriaLabel("speech")},ti.createElement("span",{class:ti.const("dcg-math-field dcg-cell-math-content"),role:ti.const("textbox"),"aria-readonly":ti.const("true"),tabIndex:()=>this.controller.isInEditListMode()?-1:0,onKeyDown:this.bindFn(this.handleKeydownOnReadonlyCell),manageFocus:this.const({shouldBeFocused:()=>this.shouldFocusReadonlyCell()&&this.controller.getBrailleMode()==="none",onFocusedChanged:this.bindFn(this.handleFocusedChanged)})})))),ti.createElement(LE,{predicate:this.bindFn(this.hasDragIcon)},()=>ti.createElement("span",{class:ti.const("dcg-drag-icon"),"dcg-drag-mode":()=>this.model.dragMode,style:()=>({color:this.model.color})},ti.createElement("i",{class:()=>({"dcg-icon-move":this.model.dragMode==="XY","dcg-icon-move-horizontal":this.model.dragMode==="X","dcg-icon-move-vertical":this.model.dragMode==="Y"}),"aria-hidden":ti.const("true")})))),ti.createElement("div",{class:ti.const("dcg-empty-line")}),ti.createElement(LE,{predicate:()=>this.isRightSide()},()=>ti.createElement("span",{class:ti.const("dcg-fade-right")})))}hasDragIcon(){return this.model.dragMode!=="NONE"&&!this.model.error}leaveSpaceForIcon(){if(this.model.error||this.controller.is3dProduct()||this.model.suppressIcon)return!1;let{column:e}=this.lookupCellPosition(),t=Ax(this.table);return e>0&&e<t-1}focusThisCell(e){e.wasHandled()||(e.handle(),!this.controller.isItemReadonly(this.table.id)&&(this.shouldFocus()||this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}})))}handleFocusedChanged(e,t){e?this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}}):this.isNodeWithinTableCell(t.relatedTarget)||this.controller.dispatch({type:"blur-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}})}lookupCellPosition(){return{row:0,column:this.model.index}}getAriaLabel(e){let t=this.lookupCellPosition();return e==="speech"?" ":this.controller.raw("h__column__",{column:t.column+1})}getAriaPostLabel(){let e="",t=this.model;return t.shouldGraph&&(t.points||t.lines)&&!m6(t)&&(e=this.controller.s("graphing-calculator-narration-expression-evaluation-has-graph"),qo?e+=" "+this.controller.s("graphing-calculator-narration-expression-audio-trace-mac"):e+=" "+this.controller.s("graphing-calculator-narration-expression-audio-trace-windows")),e}handlePressedKey(e,t){let o=Ze.getFocusedMathquill();o&&(Ze.handleKeystrokeAndDecideIfSpecialEvent(o,e,t)?this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:e}):this.handleLatexChanged(o.latex()))}handleKeydownOnBrailleInput(e){let t=Be(e);if(!t)return;let o=t==="Enter"||t==="Up"||t==="Down",i=Yl(),n=i&&t==="Left"&&i.selectionStart===0||t==="Right"&&i.selectionStart===i.value.length,a=this.model.latex.length===0&&zv(i);(o||n||(t==="Del"||t==="Backspace")&&a)&&(this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:t==="Del"?"Delete":t}),e.preventDefault())}handleKeydownOnReadonlyCell(e){let t=Be(e);t!=="Tab"&&(t==="Esc"&&Jr(),t&&this.controller.dispatch({type:"navigate-table-by-key",id:this.table.id,key:t}),e.preventDefault())}handleLatexChanged(e){this.model.latex!==e&&this.controller.dispatch({type:"set-tablecell-latex",tableId:this.table.id,cell:this.lookupCellPosition(),latex:e})}shouldFocus(){return!this.controller.isInEditListMode()&&__dcg_shared_module_exports__['J'](this.lookupCellPosition(),ys(this.table))}shouldFocusReadonlyCell(){return __dcg_shared_module_exports__['J'](this.lookupCellPosition(),ys(this.table))}isNodeWithinTableCell(e){if(!e||!e.closest(".dcg-cell"))return!1;let t=this.controller.getItemRootNodeById(this.table.id);return t?re.contains(t,e):!1}handleMQFocusedChanged(e,t){e?this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}}):this.isNodeWithinTableCell(t.relatedTarget)||this.controller.dispatch({type:"blur-focus-location",location:{type:"table",id:this.table.id,location:this.lookupCellPosition()}})}getMQConfig(){return this.controller.getMathquillConfig({})}};var{For:n5}=Lr.Components,OE=class extends Xl{didMountRoot(e){this.onItemViewMounted(e),this.didMountContainer(e)}willUnmount(){this.onItemViewUnmounted()}template(){return Lr.createElement("div",{class:()=>({"dcg-expressionitem":!0,"dcg-expressiontable":!0,"dcg-readonly":this.controller.isItemReadonly(this.id),"dcg-inFolder":!!this.model.folderId,"dcg-selected":!!this.controller.isItemSelected(this.id),"dcg-dragging":!!this.controller.isItemBeingDragged(this.id),"dcg-faded-h":this.shouldFadeLastColumn(),"dcg-faded-v":this.shouldFadeLastRow()}),"expr-id":()=>this.model.id,didMount:this.bindFn(this.didMountRoot),onKeyDown:this.bindFn(this.onKeydown)},Lr.createElement("div",{class:Lr.const("dcg-fade-container dcg-disable-horizontal-scroll-to-cursor")},Lr.createElement("div",{class:Lr.const("dcg-main")},Lr.createElement("div",{class:Lr.const("dcg-table-container"),tabIndex:()=>this.controller.isInEditListMode()?0:-1,"aria-label":()=>this.controller.getBrailleMode()==="none"?this.controller.s("graphing-calculator-narration-expression-index-table",{index:this.model.displayIndex}):this.controller.s("graphing-calculator-narration-expression-index-table",{index:this.model.displayIndex}),didMount:this.bindFn(this.didMountContainer),manageFocus:this.const({shouldBeFocused:this.shouldBeFocused.bind(this),onFocusedChanged:this.onFocusedChanged.bind(this)})},Lr.createElement("div",{class:Lr.const("dcg-table-sliding-container"),style:()=>({transform:`translateX(${this.computeScrolledX()}px)`})},Lr.createElement("table",{class:Lr.const("dcg-tabledata")},Lr.createElement(n5,{each:()=>this.getVisibleRows(),key:e=>this.getRowGUID(e)},e=>e.type==="show-more"?Lr.createElement("tr",{class:Lr.const("dcg-show-more-row")},Lr.createElement("td",{colSpan:this.bindFn(this.getColSpan)},this.bindFn(this.missingRowMessage),Lr.createElement("button",{class:Lr.const("dcg-show-more dcg-blue-link dcg-unstyled-button"),onTap:()=>this.controller.dispatch({type:"table-show-more-rows",id:this.id})},()=>this.controller.s("graphing-calculator-button-show-all-table-rows")))):e.type==="spacer-row"?Lr.createElement("tr",{class:Lr.const("dcg-blank-row")},Lr.createElement("td",{colSpan:this.bindFn(this.getColSpan),style:()=>({height:(e.endIdx-e.startIdx+1)*this.getRowHeight()+"px"})})):e.type==="header"?Lr.createElement("tr",{"aria-rowindex":Lr.const("0"),class:()=>({"dcg-row":!!e,"dcg-braille-row":this.controller.getBrailleMode()!=="none"})},Lr.createElement(n5,{each:()=>this.model.columnModels,key:t=>t.guid},t=>Lr.createElement(PE,{controller:this.props.controller,model:this.const(t)}))):Lr.createElement("tr",{"aria-rowindex":()=>e.index,class:()=>({"dcg-row":!!e,"dcg-braille-row":this.controller.getBrailleMode()!=="none"})},Lr.createElement(n5,{each:()=>this.model.columnModels,key:t=>t.guid},t=>Lr.createElement(AE,{controller:this.props.controller,column:this.const(t),rowIdx:()=>e.index}))))))),Lr.createElement(rL,{controller:this.props.controller,table:this.props.model})),Lr.createElement(zd,{controller:this.props.controller,model:this.props.model})),Lr.createElement("span",{class:Lr.const("dcg-tab dcg-action-drag"),handleEvent:Lr.const("true"),tapboundary:Lr.const("true"),disablescroll:Lr.const("true"),onTapStart:this.bindFn(this.onDragPending)},Lr.createElement("span",{class:Lr.const("dcg-num")},()=>this.model.displayIndex),Lr.createElement("div",{class:Lr.const("dcg-tab-interior")}),Lr.createElement(qV,{model:this.props.model,controller:this.props.controller}),Lr.createElement(Xv,{model:this.props.model,controller:this.props.controller})),Lr.createElement(qd,{controller:this.props.controller,id:()=>this.model.id}))}getRowGUID(e){switch(e.type){case"header":return"header";case"show-more":return"show-more";case"spacer-row":return`spacer-${e.startIdx}-${e.endIdx}`;case"standard-row":return`row-${e.index}`}}getColSpan(){return this.model.columnModels.length-1}getRowHeight(){return this.controller.getGraphSettings().config.projectorMode?38:33}getVisibleRows(){var u,h,m;let e=[{type:"header"}],t=Kc(this.model)+1;if(t<=25){for(let y=1;y<t;y++)e.push({type:"standard-row",index:y});return e}let o=ib(this.model);if(o!==void 0){for(let y=1;y<o.min;y++)e.push({type:"standard-row",index:y});e.push({type:"show-more"});for(let y=o.max;y<t;y++)e.push({type:"standard-row",index:y});return e}let i=hy(this.controller),n=i?i.height:0,a=re(this.node).offset(),s=(a?a.top:0)-(i?i.top:0),l=(m=(h=(u=this.node)==null?void 0:u.querySelector(".dcg-row"))==null?void 0:h.getBoundingClientRect().height)!=null?m:0,c=this.getRowHeight();if(n/c>t){for(let y=1;y<t;y++)e.push({type:"standard-row",index:y});return e}let d=(-s-l)/c,p=(n-s)/c;for(let y=1;y<t;y++){let w=ys(this.model);if(y===t-2||w&&w.row===y)e.push({type:"standard-row",index:y});else if(y>p||y<d){let S=e[e.length-1];S&&S.type==="spacer-row"?S.endIdx=y:e.push({type:"spacer-row",startIdx:y,endIdx:y})}else e.push({type:"standard-row",index:y})}return e}missingRowMessage(){let e=ib(this.model);return e===void 0?"":this.controller.s("graphing-calculator-text-table-more-rows",{rowCount:e.max-e.min})}didMountContainer(e){this.node=e,re(e).on("scroll",()=>e.scrollLeft=0)}getSelectedCell(){return ys(this.model)}computeScrolledX(){if(!this.getSelectedCell()||!this.node)return 0;let e=this.node.children[0],t=this.node.querySelector(".dcg-selected");if(e===null||t===null)return 0;let o=this.node.getBoundingClientRect(),i=t.getBoundingClientRect(),n=i.left-e.getBoundingClientRect().left,a=o.width-n-i.width-80,s=Math.min(0,o.width-e.scrollWidth-30);return a=Math.max(a,s),Math.min(0,a)}shouldFadeLastRow(){return y6(this.model)&&!this.isBottomFocused()}shouldFadeLastColumn(){return!this.isRightFocused()}isBottomFocused(){let e=this.getSelectedCell();return!!e&&e.row===Kc(this.model)}isRightFocused(){let e=this.getSelectedCell();return!!e&&e.column===this.model.columnModels.length-1}isReadonly(){return this.controller.isItemReadonly(this.id)}isFocused(){return!!this.getSelectedCell()}onKeydown(e){this.controller.isInEditListMode()||e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey&&(Be(e)==="Up"?(e.preventDefault(),e.stopPropagation(),this.moveToFirstCellInColumn()):Be(e)==="Down"?(e.preventDefault(),e.stopPropagation(),this.moveToLastCellInColumn()):Be(e)==="Left"?(e.preventDefault(),e.stopPropagation(),this.moveToFirstCellInRow()):Be(e)==="Right"?(e.preventDefault(),e.stopPropagation(),this.moveToLastCellInRow()):Ho(e)==="H"&&(e.preventDefault(),e.stopPropagation(),this.speakColumnHeader()))}moveToFirstCellInColumn(){let e=this.getSelectedCell();e&&this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.id,location:{row:0,column:e.column}}})}moveToLastCellInColumn(){let e=this.getSelectedCell();e&&this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.id,location:{row:Kc(this.model),column:e.column}}})}moveToFirstCellInRow(){let e=this.getSelectedCell();e&&this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.id,location:{row:e.row,column:0}}})}moveToLastCellInRow(){let e=this.getSelectedCell();e&&this.controller.dispatch({type:"set-focus-location",location:{type:"table",id:this.id,location:{row:e.row,column:Kc(this.model)-1}}})}speakColumnHeader(){let e=this.controller.s("graphing-calculator-narration-table-no-column-header"),t=this.getSelectedCell();if(t){let o=this.model.columnModels[t.column].latex;o&&(e=Hc.StaticMath(document.createElement("span")).latex(o).mathspeak())}Te(e)}focusHelperOptions(){return{controller:this.controller,location:{type:"table-container",id:this.model.id}}}shouldBeFocused(){return vb(this.focusHelperOptions())}onFocusedChanged(e){if(this.controller.isInEditListMode())return oF(this.focusHelperOptions(),e)}};var ra=__dcg_shared_module_exports__['e'](Z());var RE=class extends Xl{didMountRoot(e){this.onItemViewMounted(e)}willUnmount(){this.onItemViewUnmounted()}template(){return ra.createElement("div",{class:()=>({"dcg-do-not-blur":!0,"dcg-expressionitem":!0,"dcg-readonly":this.controller.isItemReadonly(this.id),"dcg-expressiontext":!0,"dcg-inFolder":!!this.model.folderId,"dcg-selected":!!this.controller.isItemSelected(this.id),"dcg-dragging":!!this.controller.isItemBeingDragged(this.id)}),"expr-id":()=>this.model.id,onTapStart:this.bindFn(this.onMouseSelect),onTap:this.bindFn(this.onMouseSelect),didMount:this.bindFn(this.didMountRoot)},ra.createElement("div",{class:ra.const("dcg-fade-container")},ra.createElement("div",{class:ra.const("dcg-main")},ra.createElement(bg,{shouldFocus:this.bindFn(this.isFocused),text:()=>this.model.text,showLinks:()=>this.controller.areLinksEnabled(),onInput:this.bindFn(this.onInput),onFocusChange:this.bindFn(this.onFocusChange),onSpecialKey:this.bindFn(this.onSpecialKey),readonly:()=>this.controller.isInEditListMode()||this.controller.isItemReadonly(this.id),readonlyAction:this.const({predicate:()=>this.controller.isInEditListMode(),action:()=>this.exitEditListMode()}),ariaLabel:()=>Lo(this.model,"edit_title"),placeholder:()=>this.controller.s("graphing-calculator-text-note-placeholder")})),ra.createElement(zd,{controller:this.props.controller,model:this.props.model})),ra.createElement("span",{class:ra.const("dcg-tab dcg-action-drag"),handleEvent:ra.const("true"),tapboundary:ra.const("true"),disablescroll:ra.const("true"),onTapStart:this.bindFn(this.onDragPending)},ra.createElement("span",{class:ra.const("dcg-num")},()=>this.model.displayIndex),ra.createElement("div",{class:ra.const("dcg-tab-interior")}),ra.createElement("i",{class:ra.const("dcg-icon-text"),"aria-hidden":ra.const("true")})),ra.createElement(qd,{controller:this.props.controller,id:()=>this.model.id}))}onInput(e){this.controller.dispatch({type:"set-note-text",id:this.id,text:e})}onFocusChange(e){e?this.controller.dispatch({type:"set-focus-location",location:{type:"text",id:this.id}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"text",id:this.id}})}onSpecialKey(e){return this.controller.dispatch({type:"on-special-key-pressed",key:e})}isFocused(){let e=this.controller.getFocusLocation();return!(!e||e.type!=="text"||e.id!==this.id)}};var Ir=__dcg_shared_module_exports__['e'](Z());var{If:Ree,IfDefined:lxe}=Ir.Components,oL=class extends Ir.Class{init(){this.controller=this.props.controller()}template(){return Ir.createElement("div",{class:()=>({"dcg-ticker":!0,"dcg-expressions-scrolled":this.props.expsScrolled()})},Ir.createElement("div",{class:Ir.const("dcg-ticker-settings-container")},Ir.createElement("div",{class:Ir.const("dcg-ticker-settings-internal")},Ir.createElement("div",{class:Ir.const("dcg-editable-mathquill-container dcg-action-definition")},Ir.createElement("span",{class:Ir.const("dcg-ticker-label")},()=>this.controller.raw("Run")),Ir.createElement(Ai,{latex:()=>this.getHandlerLatex(),operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.controller.s("graphing-calculator-narration-tick-action"),brailleShouldFocus:()=>this.getFocusedInput()==="handler",onBrailleInput:e=>this.dispatchHandlerLatexIfChanged(e),onBrailleFocusedChanged:e=>this.handleFocusedChanged("handler",e),onBrailleKeydown:e=>this.handlePressedKey("handler",e.key,e),...wn(this.controller)},Ir.createElement(Ze,{hasError:()=>!!this.getHandlerErrorString(),getAriaPostLabel:()=>{let e=this.getHandlerErrorString();return e?this.controller.unpack(e):""},tokenController:this.props.controller,capExpressionSize:this.const(!1),onUserChangedLatex:e=>this.dispatchHandlerLatexIfChanged(e),latex:()=>this.getHandlerLatex(),getAriaLabel:()=>this.controller.s("graphing-calculator-narration-tick-action"),isFocused:()=>this.getFocusedInput()==="handler",config:()=>this.getMQConfig(),onFocusedChanged:e=>this.handleFocusedChanged("handler",e),selectOnFocus:this.const(!0),noFadeout:this.const(!0),onUserPressedKey:(e,t)=>{this.handlePressedKey("handler",e,t)}})),lxe(()=>this.getHandlerErrorString(),e=>Ir.createElement("span",{class:Ir.const("dcg-clickable-info-error-container")},Ir.createElement(zn,{error:()=>this.controller.unpack(e()),size:this.const("small")})))),Ir.createElement("div",{class:Ir.const("dcg-editable-mathquill-container dcg-action-frequency")},Ir.createElement("span",{class:Ir.const("dcg-ticker-label")},()=>this.controller.raw("every")),Ir.createElement(Ai,{latex:()=>this.getMinStepLatex(),operatorNames:()=>this.getMQConfig().autoOperatorNames,ariaLabel:()=>this.controller.s("graphing-calculator-label-ticker-min-step"),brailleShouldFocus:()=>this.getFocusedInput()==="minstep",onBrailleInput:e=>this.dispatchMinStepLatexIfChanged(e),onBrailleFocusedChanged:e=>this.handleFocusedChanged("minstep",e),onBrailleKeydown:e=>this.handlePressedKey("minstep",e.key,e),...wn(this.controller)},Ir.createElement(Ze,{hasError:()=>!!this.getMinStepErrorString(),getAriaPostLabel:()=>{let e=this.getMinStepErrorString();return e?this.controller.unpack(e):""},capExpressionSize:this.const(!1),onUserChangedLatex:e=>this.dispatchMinStepLatexIfChanged(e),latex:()=>this.getMinStepLatex(),getAriaLabel:()=>this.controller.s("graphing-calculator-label-ticker-min-step"),isFocused:()=>this.getFocusedInput()==="minstep",config:this.bindFn(this.getMQConfig),onFocusedChanged:e=>this.handleFocusedChanged("minstep",e),tokenController:this.props.controller,selectOnFocus:this.const(!0),placeholder:this.const("0"),noFadeout:this.const(!0),onUserPressedKey:(e,t)=>{this.handlePressedKey("minstep",e,t)}})),()=>this.controller.raw("ms"),Ir.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-ticker-help-tooltip"),gravity:this.const("s")},Ir.createElement("a",{"aria-label":()=>this.controller.s("graphing-calculator-label-ticker-help-tooltip"),class:Ir.const("dcg-ticker-toggle-help"),target:Ir.const("_blank"),href:Ir.const("https://help.kiavash.com/hc/en-us/articles/4407725009165#h_01FB2RZQRYM62C3EB94H2TRRAX")},Ir.createElement("i",{class:Ir.const("dcg-icon-question-sign"),"aria-hidden":Ir.const("true")})))),Ir.createElement(Ree,{predicate:this.bindFn(this.shouldShowSliderPrompt)},()=>Ir.createElement(Ip,{model:()=>this.props.controller().getTicker(),controller:this.props.controller}))),Ir.createElement("div",{class:()=>({"dcg-circular-icon-container":!0,"dcg-disabled":this.iconDisabled()}),"aria-label":this.bindFn(this.getIconAriaLabel),role:Ir.const("button"),tabIndex:()=>this.iconDisabled()?-1:0,"aria-disabled":this.bindFn(this.iconDisabled),"aria-pressed":()=>this.controller.getTickerPlaying()&&!this.iconDisabled(),onTap:this.bindFn(this.toggleTicker),onTapStart:()=>{Jr()}},Ir.createElement(Ji,{iconType:this.const("metronome")}),Ir.createElement("div",{class:()=>({"dcg-metronome-bar":!0,"dcg-metronome-playing":this.controller.getTickerPlaying()&&!this.iconDisabled()})}),Ir.createElement(Ree,{predicate:()=>!this.iconDisabled()},()=>Ir.createElement("div",{class:Ir.const("dcg-mini-play-pause")},Ir.createElement(Ji,{iconType:this.bindFn(this.getPlayIcon)}))))),Ir.createElement("i",{onTap:this.bindFn(this.closeTicker),tabIndex:()=>this.controller.isInEditListMode()?0:-1,"aria-label":()=>this.controller.s("graphing-calculator-label-ticker-close"),role:Ir.const("link"),class:Ir.const("dcg-icon-remove dcg-do-not-blur")}))}iconDisabled(){return!!(this.getMinStepErrorString()||this.getHandlerErrorString()||!this.isHandlerMaybeValid())}isHandlerMaybeValid(){var t;return((t=this.controller.getTicker().formula)==null?void 0:t.handler.status)==="maybe-valid"}closeTicker(){this.controller.dispatch({type:"close-ticker"})}toggleTicker(){this.iconDisabled()||this.controller.dispatch({type:"toggle-ticker"})}getPlayIcon(){return this.controller.getTickerPlaying()?"pause":"play"}getIconAriaLabel(){return this.controller.getTickerPlaying()?this.controller.s("graphing-calculator-label-ticker-pause"):this.controller.s("graphing-calculator-label-ticker-play")}getFocusedInput(){let e=this.controller.getFocusLocation();if(!(!e||e.type!=="ticker"))return e.location}handlePressedKey(e,t,o){let i=Ze.getFocusedMathquill();if(i){if(t==="PageUp"||t==="PageDown")return o==null||o.preventDefault(),o==null||o.stopPropagation(),this.controller.dispatch({type:"on-special-key-pressed",key:t});if(t==="Enter"&&this.shouldShowSliderPrompt()&&this.controller.dispatch({type:"create-sliders-for-ticker",variables:O0(this.props.controller().getTicker())}),t==="Esc"&&this.controller.getExpressionSearchOpen()&&this.controller.dispatch({type:"close-expression-search"}),t==="Right"&&e==="handler"||t==="Left"&&e==="minstep"||t==="Down"||t==="Up"){if(!Ze.applyArrowKeyAndReturnIfWasAtBounds(i,t,o))return;if(t==="Down"||t==="Up")return this.controller.dispatch({type:"on-special-key-pressed",key:t});if(t==="Right"){this.handleFocusedChanged("minstep",!0);return}else if(t==="Left"){this.handleFocusedChanged("handler",!0);return}}i.keystroke(t,o),e==="handler"?this.dispatchHandlerLatexIfChanged(i.latex()):e==="minstep"&&this.dispatchMinStepLatexIfChanged(i.latex())}}handleFocusedChanged(e,t){t?this.controller.dispatch({type:"set-focus-location",location:{type:"ticker",location:e}}):this.controller.dispatch({type:"blur-focus-location",location:{type:"ticker",location:e}})}dispatchHandlerLatexIfChanged(e){this.getHandlerLatex()!==e&&this.controller.dispatch({type:"update-ticker-handlerlatex",latex:e})}dispatchMinStepLatexIfChanged(e){this.getMinStepLatex()!==e&&this.controller.dispatch({type:"update-ticker-minsteplatex",latex:e})}getHandlerLatex(){return this.controller.getTickerHandlerLatex()}getMinStepLatex(){return this.controller.getTickerMinStepLatex()}getMQConfig(){return this.controller.getMathquillConfig({additionalOperators:["dt"]})}getHandlerErrorString(){return this.getHandlerLatex()?SK(this.controller.getTicker()):void 0}getMinStepErrorString(){return EK(this.controller.getTicker())}shouldShowSliderPrompt(){return this.controller.areSlidersEnabled()?O0(this.controller.getTicker()).length>0:!1}};var{If:Pc,IfDefined:h1,For:cxe,Switch:Fee,SwitchUnion:dxe,IfElse:pxe}=xt.Components,FE=class extends xt.Class{constructor(){super(...arguments),this.guid=__dcg_shared_module_exports__['P']("listView")}init(){this.controller=this.props.controller()}template(){return xt.createElement("div",{didMount:this.bindFn(this.didMountContainer)},xt.createElement("div",{class:xt.const("dcg-exppanel-outer"),onDrop:this.bindFn(this.onDrop),style:()=>this.computeExppanelOuterStyle()},xt.createElement(Pc,{predicate:()=>this.controller.isFileDraggedOver()},()=>xt.createElement("div",{class:xt.const("dcg-drop-image")},xt.createElement("span",null,()=>this.controller.s("graphing-calculator-label-drop-image-here")))),xt.createElement("div",{class:()=>{var e;return{"dcg-exppanel-container":!0,"dcg-add-shadow":this.controller.shouldRenderList(),"dcg-global-mute-on":!!((e=this.controller.toneController)!=null&&e.isGlobalMuted())}},style:()=>({transform:this.controller.isListVisible()?void 0:this.controller.isNarrow()?"translate(0, 100%)":"translate(-100%, 0)"})},xt.createElement(Pc,{predicate:()=>this.controller.shouldRenderList()},()=>xt.createElement(WS,{controller:this.props.controller,expsScrolled:()=>!!this.exppanel&&this.exppanel.scrollTop>0})),xt.createElement(Pc,{predicate:()=>this.controller.getExpressionSearchOpen()},()=>xt.createElement(VV,{controller:this.props.controller,expsScrolled:()=>!!this.exppanel&&this.exppanel.scrollTop>0})),xt.createElement(Pc,{predicate:()=>this.controller.getTickerVisible()},()=>xt.createElement(oL,{controller:this.props.controller,expsScrolled:()=>!!this.exppanel&&this.exppanel.scrollTop>0})),xt.createElement(Pc,{predicate:()=>this.controller.shouldRenderList()},()=>xt.createElement("div",{class:()=>({"dcg-exppanel":!0,"dcg-disable-horizontal-scroll-to-cursor":!0,"dcg-isDragging":this.controller.isDragDropActive(),"dcg-has-background-color":this.controller.hasBackgroundColor(),"dcg-edit-list-mode":this.controller.isInEditListMode()}),onPaste:this.bindFn(this.onPaste),onTapStart:this.bindFn(this.onExppanelTapstart),didMount:this.bindFn(this.didMountExppanel)},xt.createElement("div",{class:xt.const("dcg-expressionlist"),role:xt.const("region"),"aria-label":()=>this.controller.s("shared-calculator-narration-expression-list")},xt.createElement(Pc,{predicate:()=>this.controller.getShowConstructionsOpen()},()=>xt.createElement(OV,{controller:this.props.controller,onDragPending:(e,t)=>this.onDragPending(e,t)})),xt.createElement("span",{class:xt.const("dcg-template-expressioneach")},xt.createElement(Pc,{predicate:()=>this.controller.shouldShowProgressUpdateLegend()},()=>xt.createElement(QS,{controller:()=>this.props.controller()})),xt.createElement(cxe,{each:()=>this.controller.getAllItemModels(),key:e=>e.guid},e=>dxe(()=>K_(e),{shell:()=>this.makeShellViewForModel(e),render:()=>this.makeViewForModel(e),none:()=>{}}))),xt.createElement(JS,{controller:()=>this.props.controller()}),xt.createElement(Fee,{key:()=>this.controller.getDraggedItemId()},e=>{if(e){let t=this.controller.getItemModel(e);return xt.createElement(US,{controller:this.props.controller},this.makeDragCopyViewForModel(t))}else return}),xt.createElement("span",{style:xt.const("flex:1")}),h1(()=>this.controller.getShellView("notice"),e=>xt.createElement(Pc,{predicate:()=>!this.controller.isKeypadOpen()},()=>{let t=e();return xt.createElement(t,null)})),xt.createElement(Pc,{predicate:()=>!this.controller.isKeypadOpen()},()=>xt.createElement("div",{class:xt.const("dcg-expressions-branding")},pxe(()=>this.controller.canEditOnWeb(),{true:()=>xt.createElement("span",{role:xt.const("link"),tabIndex:xt.const(0),class:xt.const("dcg-edit-branding"),onTap:()=>this.controller.dispatch({type:"open-on-web"})},xt.createElement("div",{class:xt.const("dcg-powered-by"),"aria-label":()=>this.controller.s("graphing-calculator-narration-edit-graph-on-kiavash")},()=>this.controller.s("graphing-calculator-button-edit-graph-on-kiavash-logo")),xt.createElement("i",{class:xt.const("dcg-icon-kiavash"),"aria-hidden":xt.const("true")})),false:()=>xt.createElement("div",null,xt.createElement("div",{class:xt.const("dcg-powered-by"),"aria-label":()=>this.controller.s("graphing-calculator-narration-powered-by-kiavash")},()=>this.controller.s("graphing-calculator-label-powered-by")),xt.createElement("i",{class:xt.const("dcg-icon-kiavash"),"aria-hidden":xt.const("true")}))}))))))),xt.createElement(vV,{controller:this.props.controller})),xt.createElement(Pc,{predicate:()=>this.isOptionsViewOpen("expression")},()=>xt.createElement(zl,{menuType:this.const("expression"),menuButtonFocusLocation:()=>{let e=this.getActiveExpressionModelForOptionsView();return e?{type:"expression-icon",id:e.id}:void 0},...this.getSharedDropdownWrapperProps()},h1(this.bindFn(this.getActiveExpressionModelForOptionsView),e=>xt.createElement(s1,{controller:this.props.controller,model:e})))),xt.createElement(Pc,{predicate:()=>this.isOptionsViewOpen("image")},()=>xt.createElement(zl,{menuType:this.const("image"),menuButtonFocusLocation:()=>{let e=this.getActiveImageModelForOptionsView();return e?{type:"image-icon",id:e.id}:void 0},...this.getSharedDropdownWrapperProps()},h1(this.bindFn(this.getActiveImageModelForOptionsView),e=>xt.createElement(NV,{controller:this.props.controller,model:e})))),xt.createElement(Pc,{predicate:()=>this.isOptionsViewOpen("slider")},()=>xt.createElement(zl,{menuType:this.const("slider"),menuButtonFocusLocation:()=>{let e=this.getActiveSliderModelForOptionsView();return e?{type:"slider-icon",id:e.id}:void 0},...this.getSharedDropdownWrapperProps()},h1(this.bindFn(this.getActiveSliderModelForOptionsView),e=>xt.createElement(UV,{controller:this.props.controller,model:e})))),xt.createElement(Pc,{predicate:()=>this.isOptionsViewOpen("table-column")},()=>xt.createElement(zl,{menuType:this.const("table-column"),menuButtonFocusLocation:()=>{let e=this.getActiveColumnModelForOptionsView();return e?{type:"table-icon",id:e.table.id,columnId:e.id}:void 0},...this.getSharedDropdownWrapperProps()},h1(this.bindFn(this.getActiveColumnModelForOptionsView),e=>xt.createElement(MV,{controller:this.props.controller,model:e})))),xt.createElement(Pc,{predicate:()=>this.isOptionsViewOpen("table-regression")},()=>xt.createElement(zl,{menuType:this.const("table-regression"),menuButtonFocusLocation:()=>{let e=this.getActiveTableModelForOptionsView();return e?{type:"table-regression-icon",id:e.id}:void 0},...this.getSharedDropdownWrapperProps()},h1(this.bindFn(this.getActiveTableModelForOptionsView),e=>xt.createElement(AV,{controller:this.props.controller,model:e})))))}getSharedDropdownWrapperProps(){return{rootElSelector:this.const(".dcg-container"),openAriaAlert:this.const(this.controller.s("graphing-calculator-narration-options-menu-open")),closeAriaAlert:this.const(this.controller.s("graphing-calculator-narration-options-menu-closed")),focusOnOpen:this.bindFn(this.optionsViewFocusLocation),shouldHandleTabAndEscape:this.const(!0),controller:this.props.controller}}optionsViewFocusLocation(){let e=this.controller.getOpenItemMenu();if(!e||!("model"in e))return"none";let{model:t}=e;if(!t)return"none";let o=this.controller.getFocusLocation();if(!o||o.type!=="expression-menu"||o.id!==t.id)return"none";switch(o.location){case"start":return"first";case"end":return"last";default:return"none"}}getActiveSliderModelForOptionsView(){let e=this.controller.getOpenItemMenu();return e&&e.type==="slider"&&"model"in e?e.model:void 0}getActiveImageModelForOptionsView(){let e=this.controller.getOpenItemMenu();return e&&e.type==="image"&&"model"in e?e.model:void 0}getActiveExpressionModelForOptionsView(){let e=this.controller.getOpenItemMenu();return e&&e.type==="expression"&&"model"in e?e.model:void 0}getActiveColumnModelForOptionsView(){let e=this.controller.getOpenItemMenu();return e&&e.type==="table-column"&&"model"in e?e.model:void 0}getActiveTableModelForOptionsView(){let e=this.controller.getOpenItemMenu();return e&&e.type==="table-regression"&&"model"in e?e.model:void 0}isOptionsViewOpen(e){let t=this.controller.getOpenItemMenu();return!!t&&t.type===e}makeShellViewForModel(e){return xt.createElement(eE,{controller:this.props.controller,model:()=>e,onDragPending:()=>{},isDragCopy:()=>!1})}computeExppanelOuterStyle(){this.getListBottomAndUpdateLastExpressionPadding();let{list:e}=this.controller.computeMajorLayout(),t=0,o=e.top;return e.top>0&&!this.controller.isListVisible()&&(o-=e.height),{position:"absolute",left:t+"px",top:o+"px",width:e.width+"px",height:e.height+"px"}}makeDragCopyViewForModel(e){return this.makeViewForModel(e,!0)}makeViewForModel(e,t=!1){let o;if(e.type==="table")o=xt.createElement(OE,{controller:this.props.controller,model:()=>e,onDragPending:i=>this.onDragPending(i,{type:"expression",calcId:e.id}),isDragCopy:()=>t});else if(e.type==="folder")o=xt.createElement($S,{controller:this.props.controller,model:()=>e,onDragPending:i=>this.onDragPending(i,{type:"expression",calcId:e.id}),isDragCopy:()=>t});else if(e.type==="text")o=xt.createElement(RE,{controller:this.props.controller,model:()=>e,onDragPending:i=>this.onDragPending(i,{type:"expression",calcId:e.id}),isDragCopy:()=>t});else if(e.type==="image")o=xt.createElement(XS,{controller:this.props.controller,model:()=>e,onDragPending:i=>this.onDragPending(i,{type:"expression",calcId:e.id}),isDragCopy:()=>t});else if(e.type==="expression")o=xt.createElement(Fee,{key:()=>t&&this.controller.shouldRenderDraggedItemAsToken()},i=>i?xt.createElement(_u,{showParentChildrenHover:this.const(!1),controller:this.props.controller,identifier:()=>this.controller.getDraggedIdentifier(),insideMQ:this.const(!1),insideGroup:this.const(!1),putInTabOrder:()=>!1}):xt.createElement(cy,{controller:this.props.controller,model:()=>e,onDragPending:n=>this.onDragPending(n,{type:"expression",calcId:e.id}),isDragCopy:()=>t}));else return;return o}didUnmount(){re(document.documentElement).off("."+this.guid)}didMountContainer(e){this.node=e,re(document.documentElement).on("keydown."+this.guid,this.bindFn(this.handleKeyDown))}didMountExppanel(e){this.exppanel=e,e.onscroll=()=>this.controller.markTickRequiredNextFrame()}getListBottomAndUpdateLastExpressionPadding(){let e=this.controller.getKeypadHeight(),t=this.__listBottom||0;return this.__listBottom=e,e===0&&t!==0&&y2()&&this.padLastExpressionUntilTapEnd(t),e}padLastExpression(e){let t=this.node.querySelector(".dcg-expressionitem.dcg-new-expression");t.style.marginBottom=e+"px"}unpadLastExpression(){let e=this.node.querySelector(".dcg-expressionitem.dcg-new-expression");e.style.marginBottom="0"}padLastExpressionUntilTapEnd(e){this.padLastExpression(e),re(document).on("dcg-tap.animating-bottom",()=>{this.unpadLastExpression(),re(document).off("dcg-tap.animating-bottom")})}handleKeyDown(e){var a;if(this.controller.inAudioTraceMode())return;let t=Be(e),o=Ho(e),i=this.controller.getSelectedItem();if(!i){(t==="Backspace"||t==="Del")&&!this.controller.needsFakeKeypad()&&this.controller.hasMultipleItemsSelected()&&this.controller.dispatch({type:"delete-all-selected-items"});return}if(e.altKey&&!e.ctrlKey&&!e.metaKey&&e.shiftKey&&o==="T"&&i){if(!this.controller.isGeometry()||!$c(i))return;e.preventDefault(),e.stopPropagation(),this.controller.convertToTokenAssignment(i);let s=this.controller.getGeometryFolder();if(s){let c=s.index+this.controller.getNumberOfItemsInFolder(s.id);Qa(i,s.id),i.index!==c&&am(this.controller.getListModel(),i.index,c,1)}this.controller.ensureAtLeastOneVisibleItem();let l=(a=xn(i))==null?void 0:a.identifier;l&&this.controller.getShowConstructionsOpen()&&this.controller.dispatch({type:"set-focus-location",location:{type:"geo-token",identifier:l}});return}let n=this.controller.getFocusLocation();if(e.ctrlKey&&e.shiftKey&&!e.metaKey&&!e.altKey&&n!==void 0){if(o==="O"){if(e.preventDefault(),e.stopPropagation(),this.controller.getOpenItemMenu()!==void 0)return;let s;if(i.type==="expression")!i.sliderExists&&!fw(i)?(s={type:"expression",model:i,guid:i.guid,focusFirstOption:!0,previousFocusLocation:n},this.controller.dispatch({type:"set-focus-location",location:{type:"expression-icon",id:i.id}})):i.sliderExists&&(s={type:"slider",model:i,guid:"slider-"+i.guid,focusFirstOption:!0,previousFocusLocation:n},this.controller.dispatch({type:"set-focus-location",location:{type:"slider-animation-properties-icon",id:i.id}}));else if(i.type==="image")s={type:"image",model:i,guid:i.guid,focusFirstOption:!0,previousFocusLocation:n},this.controller.dispatch({type:"set-focus-location",location:{type:"image-icon",id:i.id}});else if(i.type==="table"&&(n.type==="table"||n.type==="table-icon")){let l;if(n.type==="table"){let c=n.location;if(!c)return;l=i.columnModels[c.column]}else l=vi(i,n.columnId);if(!l||l.latex===""||!this.controller.getGraphSettings().config.graphpaper||l.error||l.index===0)return;s={type:"table-column",model:l,guid:l.guid,focusFirstOption:!0,previousFocusLocation:n},this.controller.dispatch({type:"set-focus-location",location:{type:"table-icon",id:i.id,columnId:l.id}})}if(!s)return;this.controller.dispatch({type:"toggle-item-settings-menu",menu:s});return}else if(o==="D"){if(this.controller.isItemReadonly(i.id)&&!this.controller.isInEditListMode())return;e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"delete-item-and-animate-out",id:i.id,setFocusAfterDelete:!0});return}}if(this.controller.isInEditListMode()&&!e.altKey&&!e.ctrlKey&&!e.metaKey){if(t==="Tab"&&n!==void 0){let s=this.controller.getItemModelByIndex(0);if(!s)return;let l=(n.type==="readonly-expression"&&s.type==="expression"||n.type==="table-container"&&s.type==="table"||n.type===s.type)&&n.id===s.id,c={type:"edit-list-toggle"},d=this.controller.isFocusLocationFocused(c);e.shiftKey&&l?(e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"set-focus-location",location:c})):!e.shiftKey&&d&&(e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"move-focus-to-item",id:s.id,where:s.type==="table"?"container":void 0}))}else(t==="Up"||t==="Down"||t==="PageUp"||t==="PageDown")&&this.controller.dispatch({type:"on-special-key-pressed",key:t==="Up"||t==="PageUp"?"PageUp":"PageDown"});return}if(t==="Esc"&&this.controller.getExpressionSearchOpen()&&this.controller.dispatch({type:"close-expression-search"}),!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&(t==="PageUp"||t==="PageDown")){this.controller.dispatch({type:"on-special-key-pressed",key:t}),e.preventDefault();return}if(!(document.activeElement&&re.contains(document.body,document.activeElement))&&!this.exppanel.contains(e.target)&&re.contains(document.documentElement,e.target))switch(t){case"Up":e.preventDefault(),this.controller.dispatch({type:"select-previous-expression"});break;case"Down":e.preventDefault(),this.controller.dispatch({type:"select-next-expression"});break;case"Esc":e.preventDefault(),this.controller.dispatch({type:"set-none-selected"});break;case"Right":e.preventDefault(),i&&(i.type==="expression"&&i.sliderExists?(this.controller.dispatch({type:"adjust-slider-by-keyboard",id:i.id,adjustment:"up"}),this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:i.id}})):this.controller.dispatch({type:"move-focus-to-item",id:i.id,where:"start"}));break;case"Tab":e.preventDefault(),i&&this.controller.dispatch({type:"move-focus-to-item",id:i.id,where:"start"});break;case"Left":e.preventDefault(),i&&(i.type==="expression"&&i.sliderExists?(this.controller.dispatch({type:"adjust-slider-by-keyboard",id:i.id,adjustment:"down"}),this.controller.dispatch({type:"set-focus-location",location:{type:"slider-thumb",id:i.id}})):this.controller.dispatch({type:"move-focus-to-item",id:i.id,where:"end"}));break;case"Backspace":e.preventDefault(),i&&!this.controller.isItemReadonly(i.id)&&this.controller.dispatch({type:"upward-delete-selected-expression"});break;case"Del":e.preventDefault(),i&&!this.controller.isItemReadonly(i.id)&&this.controller.dispatch({type:"downward-delete-selected-expression"});break;case"Enter":e.wasHandled("create-expression-with-keyboard")||(e.preventDefault(),e.handle("create-expression-with-keyboard"),i&&this.controller.dispatch({type:"on-special-key-pressed",key:"Enter"}));break;default:if(e.metaKey||e.ctrlKey||t==="Shift"||t==="Space")return;i&&(i.type==="table"||this.controller.dispatch({type:"move-focus-to-item",id:i.id,where:"end"}))}}onDragPending(e,t){e.preventDefault(),Jr();let o={x:e.touches[0].clientX,y:e.touches[0].clientY},i={x:o.x,y:o.y},n=setTimeout(()=>{re(document).off(".dragpending"),this.onDragStart(e,t,o,i)},500);re(document).on("dcg-tapmove.dragpending",a=>{i={x:a.touches[0].clientX,y:a.touches[0].clientY},(Math.abs(i.y-o.y)>3||Math.abs(i.x-o.x)>3)&&(clearTimeout(n),re(document).off(".dragpending"),this.onDragStart(e,t,o,i))}),re(document).on("dcg-tapend.dragpending",()=>{clearTimeout(n),re(document).off(".dragpending")})}onDragStart(e,t,o,i){e.touches.length===1&&(e.wasHandled("dcg-longhold")||this.controller.dispatch({type:"start-dragdrop",dragTarget:t,grabPt:o,mousePt:i}))}onExppanelTapstart(e){e.device!=="mouse"&&(e.target.closest(".dcg-expressionitem")||Jr())}onPaste(e){let t=this.controller.getGraphSettings().config,o=yZ(e);if(!o)return;let i=this.controller.getSelectedItem();if(this.controller.canLoadPastedLink(o)&&i&&i.type==="folder"&&i.title===""){e.stopPropagation(),e.preventDefault(),wV(this.controller,o,(a,s)=>s(null,a));return}if(i&&(i.type==="text"||i.type==="folder"))return;if(this.controller.canLoadPastedLink(o)){e.stopPropagation(),e.preventDefault();let a=t.pasteGraphLinkCallback?t.pasteGraphLinkCallback:(s,l)=>l(null,s);wV(this.controller,o,a);return}if(t.pasteTableData){let a=CZ(o);if(a!==void 0)return e.stopPropagation(),e.preventDefault(),this.controller.dispatch({type:"paste-table",data:a})}let n=vZ(o);if(n!==void 0){e.stopPropagation(),e.preventDefault();let a=[];n.length===1&&n[0].numberList?this.controller.dispatch({type:"append-number-list",latex:n[0].content}):(n.forEach(s=>{a.push({type:"expression",id:this.controller.generateId(),latex:s.content})}),this.controller.dispatch({type:"insert-several-expressions",expressions:a}));return}}onDrop(e){if(!this.controller.areImagesEnabled())return;let t=e.dataTransfer&&e.dataTransfer.files;t&&t.length&&this.controller.dispatch({type:"new-images",files:t})}};var jd=__dcg_shared_module_exports__['e'](Z());var{If:uxe}=jd.Components,hxe=3e3,iL=class extends jd.Class{willUpdate(){let e=this.props.controller(),t=e.getAdaptiveDepthPeelingInfo();(t==null?void 0:t.status)===1&&t.peelLayers===Vv&&(this.visible=!0,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.visible=!1,e.dispatch({type:"render"})},hxe))}template(){return jd.createElement(uxe,{predicate:()=>this.visible},()=>jd.createElement("div",{class:jd.const("dcg-adaptive-peeling-warning"),style:()=>({left:`${this.props.controller().computeMajorLayout().grapher.left}px`})},jd.createElement("span",{class:jd.const("dcg-warning-content"),tabIndex:jd.const("0")},()=>this.props.controller().s("graphing-calculator-label-adaptive-peel-warning"))))}};var lo=__dcg_shared_module_exports__['e'](Z());$t();$t();var a5=class{constructor(){this.handlers=[],re(document).on("keydown.delegator",e=>this.handleEvent(e))}push(e){let t=__dcg_shared_module_exports__['P']("delegator_");return this.handlers.push({token:t,handler:e}),()=>this.handlers=__dcg_shared_module_exports__['m'](this.handlers,o=>o.token!=t)}handleEvent(e){if(!e.isDefaultPrevented()&&this.handlers.length){let t=!1,o=()=>t=!0;for(let{handler:i}of this.handlers.slice().reverse())if(i(e,o),t)return}}},nL=new a5;var oa=__dcg_shared_module_exports__['e'](Z());var Xr=__dcg_shared_module_exports__['e'](Z());var Qr=__dcg_shared_module_exports__['e'](Z());var{If:s5}=Qr.Components,kn=class extends Qr.Class{constructor(){super(...arguments),this.i18n=this.props.i18n(),this.isMounted=!1,this.isTitleStuck=!1}template(){return Qr.createElement("div",{class:()=>({"dcg-shared-modal-container":!0,[this.props.class?this.props.class():""]:!!this.props.class}),didMount:this.bindFn(this.didMountRoot)},Qr.createElement("div",{class:()=>({"dcg-shared-modal-cover":!0,"dcg-shared-has-close-button":this.showX(),"dcg-shared-modal-fullscreen":this.props.size()==="fullscreen","dcg-shared-modal-wide":this.props.size()==="wide","dcg-shared-modal-medium":this.props.size()==="medium","dcg-shared-modal-narrow":this.props.size()==="narrow","dcg-shared-modal-tiny":this.props.size()==="tiny"})},Qr.createElement("div",{class:Qr.const("dcg-shared-modal-background"),onTap:this.props.onClose}),Qr.createElement("div",{class:Qr.const("dcg-shared-modal-transition-container")},Qr.createElement("div",{class:Qr.const("dcg-shared-modal"),role:Qr.const("dialog"),"aria-modal":Qr.const("true"),"aria-label":()=>{let e="";return this.props.ariaLabel?e=this.props.ariaLabel():this.props.title&&(e=this.props.title()),e}},Qr.createElement(s5,{predicate:()=>this.showX()},()=>Qr.createElement("div",{class:Qr.const("dcg-shared-close-cross-container")},Qr.createElement(ze,{tooltip:()=>this.i18n.s("shared-button-close-dialog")},Qr.createElement("div",{role:Qr.const("button"),tabIndex:Qr.const("0"),"aria-label":()=>this.i18n.s("shared-button-close-dialog"),class:Qr.const("dcg-shared-close-cross"),onTap:this.props.onClose},Qr.createElement("i",{class:Qr.const("dcg-icon-remove"),"aria-hidden":Qr.const("true")}))))),Qr.createElement("div",{class:Qr.const("dcg-shared-modal-contents-wrapper")},Qr.createElement(s5,{predicate:()=>!!this.props.title&&!!this.props.title()},()=>Qr.createElement("h1",{class:()=>{var e,t;return{"dcg-shared-modal-title":!0,"dcg-shared-left-align-title":this.leftAlignTitle(),"dcg-shared-modal-title--sticky":!!((t=(e=this.props).withStickyTitle)!=null&&t.call(e)),"dcg-shared-modal-title--stuck":this.isTitleStuck}}},Qr.createElement(s5,{predicate:()=>{var e,t;return!!((t=(e=this.props).withBackButton)!=null&&t.call(e))}},()=>Qr.createElement("button",{class:Qr.const("dcg-shared-back-button"),"aria-label":()=>this.i18n.s("shared-button-back"),tabIndex:Qr.const(0),onTap:this.props.onBack},Qr.createElement("i",{class:Qr.const("dcg-icon-chevron-left dcg-shared-back-button__icon"),"aria-hidden":Qr.const("true")}))),()=>this.props.title())),Qr.createElement("div",{class:Qr.const("dcg-shared-modal-scrollable-content")},this.props.children))))))}showX(){var e,t;return!!((t=(e=this.props).showX)!=null&&t.call(e))}leftAlignTitle(){return!!this.props.leftAlignTitle&&this.props.leftAlignTitle()}didMountRoot(e){var u,h,m,y;if(this.isMounted)return;this.isMounted=!0;let t=e.querySelector(".dcg-shared-modal-contents-wrapper"),o=e.querySelector(".dcg-shared-modal-title");if((h=(u=this.props).withStickyTitle)!=null&&h.call(u)&&t&&o){let w=()=>{this.intersectionObserver&&this.intersectionObserver.disconnect();let S=getComputedStyle(t).getPropertyValue("--dcg-modal-padding").trim();this.intersectionObserver=new IntersectionObserver(([C])=>{this.isTitleStuck=C.intersectionRatio<1,this.update()},{root:t,rootMargin:p_||S===""?void 0:`-${S} 0px 0px 0px`,threshold:[1]}),this.intersectionObserver.observe(o)};w(),this.resizeObserver=new ResizeObserver(w),this.resizeObserver.observe(t)}let i=()=>{var w;(w=e.querySelector(".dcg-shared-close-cross"))==null||w.focus()},n=()=>e.querySelector(".dcg-shared-modal-scrollable-content"),a=()=>{let w=n();w&&(w.tabIndex=w.tabIndex>=0?w.tabIndex:0,w.focus())},s=n(),l=(y=(m=this.props).setFocus)==null?void 0:y.call(m),c=l==="close"&&this.showX(),d=l==="content"||l==="close"&&!this.showX()&&s;c&&i(),d&&a();let p=F9(e);this.unsub=nL.push((w,S)=>{var v,E,_,T;Be(w)==Pn&&(this.onClose(),S());let C=w.altKey||w.shiftKey||w.metaKey||w.ctrlKey;Be(w)===su&&!C&&((E=(v=this.props).onArrowKey)==null||E.call(v,"Left")),Be(w)===lu&&!C&&((T=(_=this.props).onArrowKey)==null||T.call(_,"Right")),p(w)})}onClose(){this.props.onClose&&this.props.onClose()}didUnmount(){var e,t;this.isMounted&&(this.isMounted=!1,(e=this.intersectionObserver)==null||e.disconnect(),(t=this.resizeObserver)==null||t.disconnect(),this.unsub())}};var{If:aL,Each:Nee}=Xr.Components,sL=class extends Xr.Class{init(){this.controller=this.props.controller()}template(){return Xr.createElement(aL,{predicate:this.props.visible},()=>Xr.createElement(kn,{size:this.const("medium"),onClose:this.props.onClose,i18n:this.const(this.controller),class:this.const("dcg-custom-toolbar-settings-modal")},Xr.createElement("div",{class:Xr.const("dcg-btn-blue dcg-done-btn"),"aria-role":Xr.const("button"),tabIndex:Xr.const(0),didMount:e=>e.focus(),onTap:this.props.onClose},()=>this.controller.s("graphing-calculator-button-done")),Xr.createElement("h1",{class:Xr.const("dcg-shared-left-align-title")},()=>this.controller.s("shared-calculator-text-customize-toolbar")),Nee(this.bindFn(this.getToolGroups),{key:e=>e.group,item:e=>Xr.createElement("div",null,Xr.createElement("div",{class:Xr.const("dcg-configuration-heading-row dcg-configuration-grid-row")},Xr.createElement("div",{class:Xr.const("dcg-first-column")},()=>e.group,Xr.const(" Tools")),Xr.createElement("div",{class:Xr.const("dcg-second-column")},Xr.const("Disabled when:"))),Nee(()=>e.dropdown||[e.current],{item:t=>Xr.createElement("div",{class:Xr.const("dcg-configuration-grid-row"),"dcg-geo-tool":this.const(t)},Xr.createElement("div",{class:Xr.const("dcg-first-column")},Xr.createElement(Gt,{disabled:()=>!this.isToolCustomizable(t),checked:()=>this.getToolInfo(t).visible,onChange:o=>{this.controller.dispatch({type:"set-geometry-custom-toolbar-setting",tool:t,value:{...this.getToolInfo(t),visible:o}})}},()=>t)),Xr.createElement("div",{class:()=>({"dcg-disabled":!this.getToolInfo(t).visible||!this.isToolCustomizable(t),"dcg-mathquill-condition-container":!0,"dcg-second-column":!0})},Xr.createElement(aL,{predicate:()=>!!this.getToolLatexError(t)&&this.getToolInfo(t).visible},()=>Xr.createElement("div",{class:Xr.const("dcg-latex-error-container")},Xr.createElement(zn,{error:()=>this.getToolLatexError(t)||""}))),Xr.createElement(aL,{predicate:()=>this.isToolCustomizable(t)&&this.getToolInfo(t).visible},()=>Xr.createElement(Ai,{latex:()=>this.getToolLatex(t),operatorNames:this.bindFn(this.autoOperatorNames),ariaLabel:()=>this.getToolAria(t),brailleShouldFocus:()=>this.focusedLatexTool===t,onBrailleInput:o=>{this.controller.dispatch({type:"set-geometry-custom-toolbar-setting",tool:t,value:{...this.getToolInfo(t),disabledLatex:o}})},onBrailleFocusedChanged:o=>{this.focusedLatexTool===t&&!o?this.focusedLatexTool=void 0:o&&(this.focusedLatexTool=t)},onBrailleKeydown:()=>{},...wn(this.controller)},Xr.createElement(Ze,{latex:()=>this.getToolLatex(t),getAriaLabel:()=>this.getToolAria(t),noFadeout:this.const(!0),getAriaPostLabel:()=>this.getToolLatexError(t)||"",isFocused:()=>this.focusedLatexTool===t,tokenController:this.props.controller,capExpressionSize:()=>this.controller.getCapExpressionSize(),config:()=>this.controller.getMathquillConfig({}),hasError:()=>!!this.getToolLatexError(t),onUserChangedLatex:o=>{this.controller.dispatch({type:"set-geometry-custom-toolbar-setting",tool:t,value:{...this.getToolInfo(t),disabledLatex:o}})},onExpressionSizeExceeded:()=>this.controller.dispatch({type:"expression-size-exceeded"}),onFocusedChanged:o=>{this.focusedLatexTool===t&&!o?this.focusedLatexTool=void 0:o&&(this.focusedLatexTool=t)},onSelectionChanged:()=>{this.controller.runAfterDispatch(()=>{this.controller.dispatch({type:"render"})})},needsSystemKeypad:()=>!this.controller.isKeypadEnabled()}))),Xr.createElement(aL,{predicate:()=>!this.getToolInfo(t).visible},()=>Xr.createElement("div",{class:Xr.const("dcg-disabled-condition-wrapper")},Xr.createElement(Ai,{latex:()=>this.getToolLatex(t),operatorNames:this.bindFn(this.autoOperatorNames),ariaLabel:()=>this.getToolAria(t),isStatic:this.const(!0),brailleShouldFocus:this.const(!1),onBrailleFocusedChanged:()=>{},...wn(this.controller)},Xr.createElement(Et,{latex:()=>this.getToolLatex(t),config:()=>this.controller.getMathquillConfig({}),getAriaLabel:()=>this.getToolAria(t)}))))))}))})))}getToolAria(e){return this.controller.s("shared-calculator-narration-disable-tool",{tool:e})}autoOperatorNames(){return this.props.controller().getMathquillConfig({}).autoOperatorNames}getToolLatex(e){return this.getToolInfo(e).disabledLatex||""}isToolCustomizable(e){return e!=="selection"&&e!=="box-selection"}getToolGroups(){let e={group:"transformation",current:"translate",dropdown:nv};return[...R2(),e]}getToolLatexError(e){let t=this.controller.getGeometryToolbarModel(),o=O6(t,e);if(o)return this.controller.unpack(o)}getToolInfo(e){let t=this.controller.getGeometryToolbarModel();return{tool:e,...t.toolbarState[e]}}};var{If:Bee}=oa.Components,lL=class extends oa.Class{init(){this.controller=this.props.controller()}template(){return oa.createElement(Bee,{predicate:()=>this.shouldShowAuthorFeaturesSection()},()=>oa.createElement("div",{class:oa.const("dcg-options-menu-section dcg-author-mode-section")},oa.createElement("div",{class:oa.const("dcg-options-menu-section-title")},()=>this.controller.s("shared-calculator-narration-author-mode"),oa.createElement(ci,{ariaLabel:()=>this.controller.s("shared-calculator-narration-author-mode"),toggled:this.bindFn(this.isAuthorMode),onChange:()=>{this.controller.dispatch({type:"set-author-mode",enabled:!this.isAuthorMode()})}})),oa.createElement(Bee,{predicate:()=>this.isAuthorMode()},()=>oa.createElement("div",{class:oa.const("dcg-author-features-container")},oa.createElement("div",{class:oa.const("dcg-toolbar-customization")},oa.createElement("span",null,oa.const("Geometry Tools:")),oa.createElement(Po,{theme:this.const("mini"),ariaGroupLabel:()=>this.controller.s("graphing-calculator-narration-configure-toolbar"),staticConfig:this.bindFn(this.getConfigurationOptions)})),oa.createElement(Gt,{checked:()=>this.controller.getGraphSettings().hideCustomColors,onChange:e=>this.controller.dispatch({type:"set-graph-settings",hideCustomColors:e})},()=>this.controller.s("shared-calculator-label-hide-custom-colors")),oa.createElement(sL,{controller:this.props.controller,onClose:()=>{this.customGeometryToolsSettingsModal=!1,this.controller.dispatch({type:"render"})},visible:()=>this.customGeometryToolsSettingsModal})))))}getToolbar(){return this.controller.getGeometryToolbarModel().toolbar}setToolbar(e){e==="custom"&&(this.customGeometryToolsSettingsModal=!0),this.controller.dispatch({type:"set-geometry-toolbar",toolbar:e})}getConfigurationOptions(){return[{key:"all",label:()=>this.controller.raw("All"),selected:()=>this.getToolbar()==="all",onSelect:()=>this.setToolbar("all")},{key:"none",label:()=>this.controller.raw("None"),selected:()=>this.getToolbar()==="none",onSelect:()=>this.setToolbar("none")},{key:"custom",label:()=>this.controller.raw("Custom"),selected:()=>this.getToolbar()==="custom",onSelect:()=>this.setToolbar("custom")}]}shouldShowAuthorFeaturesSection(){return this.controller.authorFeaturesAvailable()}isAuthorMode(){return this.controller.shouldShowAuthorFeatures()}};var{If:cL}=lo.Components,NE=class extends lo.Class{init(){this.controller=this.props.controller()}template(){return lo.createElement("div",{class:()=>({"dcg-geometry-settings-container":!0,"dcg-popover":!0,"dcg-left":!0,"dcg-constrained-height-popover":!0,"dcg-generic-options-menu":!0,"dcg-no-geometry-header":!this.controller.shouldShowGeoToolbar()}),style:this.bindFn(this.getContainerStyle),didMount:this.bindFn(this.didMountContainer),didUnmount:this.bindFn(this.didUnmountContainer)},lo.createElement("div",{class:lo.const("dcg-popover-interior"),role:lo.const("region"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-geometry-settings")},lo.createElement("div",{class:lo.const("dcg-options-menu-section")},lo.createElement(Qv,{controller:this.props.controller}),lo.createElement(cL,{predicate:()=>!this.controller.getLockViewportConfigSetting()},()=>lo.createElement(dy,{controller:this.props.controller})),lo.createElement(cL,{predicate:()=>this.controller.getHiddenGeoItemCount()>0},()=>lo.createElement(Gt,{onChange:this.bindFn(this.toggleGhostMode),checked:()=>this.controller.getGhostMode(),manageFocus:this.const(ct({controller:this.controller,location:{type:"settings",location:"hidden-objects"}}))},()=>this.controller.s("graphing-calculator-label-settings-hidden-objects",{count:this.controller.getHiddenGeoItemCount()})))),lo.createElement("div",{class:lo.const("dcg-options-menu-section")},lo.createElement("div",{class:lo.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-label-settings-grid"),lo.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-label-settings-grid"),toggled:this.bindFn(this.getShowGrid),onChange:this.bindFn(this.toggleGrid)})),lo.createElement(cL,{predicate:this.bindFn(this.getShowGrid)},()=>lo.createElement(Gt,{onChange:this.bindFn(this.toggleMinorGridlines),checked:this.bindFn(this.getMinorGridlines)},()=>this.controller.s("graphing-calculator-label-settings-minor-gridlines")))),lo.createElement("div",{class:lo.const("dcg-options-menu-section")},lo.createElement("div",{class:lo.const("dcg-options-menu-section-title")},()=>this.controller.s("graphing-calculator-label-axes"),lo.createElement(ci,{ariaLabel:()=>this.controller.s("graphing-calculator-label-axes"),toggled:this.bindFn(this.getShowAxes),onChange:this.bindFn(this.toggleAxes)})),lo.createElement(cL,{predicate:this.bindFn(this.getShowAxes)},()=>lo.createElement("div",null,lo.createElement(Gt,{onChange:this.bindFn(this.toggleAxisNumbers),checked:this.bindFn(this.getAxisNumbers)},()=>this.controller.s("graphing-calculator-label-settings-axis-numbers")),lo.createElement("div",null,lo.createElement(Gt,{onChange:this.bindFn(this.toggleArrows),checked:()=>this.getAxisArrowMode()!=="NONE"},()=>this.controller.s("graphing-calculator-label-settings-arrows")))))),lo.createElement(Zv,{controller:this.props.controller}),lo.createElement(lL,{controller:this.props.controller}),lo.createElement(Kd,{setup:this.const({controller:this.controller,type:"advanced"})}),lo.createElement("div",{class:lo.const("dcg-arrow")})))}toggleGhostMode(){this.controller.dispatch({type:"set-ghost-mode",value:!this.controller.getGhostMode()})}didMountContainer(e){this.node=e,re(document.documentElement).on("dcg-tapstart.geometry-settings-view wheel.geometry-settings-view",t=>{this.eventShouldClosePopover(t)&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:t.device==="keyboard"})}),this.unsub=nL.push(t=>{let o=Be(t);if(o==="Esc"&&this.controller.dispatch({type:"close-graph-settings",focusIconAfterClose:!0}),this.controller.isGraphSettingsOpen()&&o==="Tab"&&!t.altKey&&!t.metaKey&&!t.ctrlKey){let i=this.controller.getFocusLocation();if(!i||i.type!=="settings")return;t.shiftKey?t.shiftKey&&(i.location==="default-size"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation()):i.location==="icon"&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"degree-mode"}}),t.preventDefault(),t.stopPropagation())):i.location==="icon"?(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"default-size"}}),t.preventDefault(),t.stopPropagation()):i.location==="degree-mode"&&(this.controller.dispatch({type:"set-focus-location",location:{type:"settings",location:"icon"}}),t.preventDefault(),t.stopPropagation())}})}didUnmountContainer(){re(document.documentElement).off(".geometry-settings-view"),this.unsub()}didUpdate(){if(!this.controller.isGraphSettingsOpen())return;let e=this.controller.getKeypadHeight();e!==this.cachedKeypadHeight&&document.activeElement&&this.node.contains(document.activeElement)&&Vc(document.activeElement,this.node.querySelector(".dcg-popover-interior"),50),this.cachedKeypadHeight=e}eventShouldClosePopover(e){let t=e.target,o=this.node.contains(t),i=!!t.closest(".dcg-action-settings"),n=this.isMathquillFocused()&&!!t.closest(".dcg-keypad"),a=!!t.closest(".dcg-action-undo")||!!t.closest(".dcg-action-redo");return!(o||i||n||a)}isMathquillFocused(){return this.getFocusedLimit()!==void 0}getFocusedLimit(){let e=this.controller.getFocusLocation();if(e&&e.type==="settings")return e.location}getShowXAxis(){return!!this.controller.getGraphSettings().showXAxis}toggleAxes(){this.controller.dispatch({type:"set-graph-settings",showXAxis:!this.getShowXAxis(),showYAxis:!this.getShowXAxis()})}getShowAxes(){return!!this.controller.getGraphSettings().showXAxis}getAxisNumbers(){return!!this.controller.getGraphSettings().xAxisNumbers}toggleAxisNumbers(){let e=this.getAxisNumbers();this.controller.dispatch({type:"set-graph-settings",xAxisNumbers:!e,yAxisNumbers:!e,polarNumbers:!e})}getMinorGridlines(){return this.controller.getGraphSettings().xAxisMinorSubdivisions===0}toggleMinorGridlines(){let e=this.getMinorGridlines()?1:0;this.controller.dispatch({type:"set-graph-settings",yAxisMinorSubdivisions:e,xAxisMinorSubdivisions:e})}getAxisArrowMode(){return this.controller.getGraphSettings().xAxisArrowMode}getShowGrid(){return this.controller.getGraphSettings().showGrid}toggleGrid(){this.controller.dispatch({type:"set-graph-settings",showGrid:!this.getShowGrid()})}toggleArrows(){let e=this.getAxisArrowMode()==="NONE"?"BOTH":"NONE";this.controller.dispatch({type:"set-graph-settings",xAxisArrowMode:e,yAxisArrowMode:e})}getContainerStyle(){return this.controller.getKeypadHeight()?"bottom: 0":""}};var Xu=__dcg_shared_module_exports__['e'](Z()),{Switch:gxe}=Xu.Components,uL=class extends Xu.Class{constructor(){super(...arguments),this.frames=0,this.prevTime=0}init(){var t;this.current=0,this.panels={},this.panels.fps=new UE({name:"fps",yMax:120,fg:"#0ff",bg:"#002"}),this.panels.evaluator=new UE({name:"eval",yMax:250,fg:"#f80",bg:"#210"}),this.panels.mem=new UE({name:"MB",yMax:this.getMemory().jsHeapSizeLimit/2**20,fg:"#f08",bg:"#201"}),this.list=Object.keys(this.panels),this.props.controller().onEvaluatorChangesSpy=(o,i)=>{var n;this.props.controller().isThreeDMode()||this.frame(),this.panels.evaluator.update((n=i.timeInWorker)!=null?n:NaN)};let e=(t=this.props.controller().getGrapher3d())==null?void 0:t.webglLayer;e&&(e.debugOnlyMeasureGPUTiming=!0,e.onRenderSpy=()=>{this.frame()})}willUnmount(){this.props.controller().onEvaluatorChangesSpy=void 0}template(){return Xu.createElement("div",{class:Xu.const("dcg-performance-meter"),onTap:()=>{this.current=(this.current+1)%this.list.length,this.update()}},Xu.createElement(gxe,{key:()=>this.list[this.current]},e=>Xu.createElement("div",{didMount:t=>{t.appendChild(this.panels[e].dom)}})))}frame(){this.frames++;let e=(performance||Date).now();return e>=this.prevTime+1e3&&(this.panels.fps.update(this.frames*1e3/(e-this.prevTime)),this.prevTime=e,this.frames=0,this.panels.mem.update(this.getMemory().usedJSHeapSize/2**20)),e}getMemory(){if(self.performance&&"memory"in self.performance){let e=self.performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}}else return{usedJSHeapSize:NaN,totalJSHeapSize:NaN,jsHeapSizeLimit:NaN}}},Oc=Math.round(window.devicePixelRatio||1),l5=80*Oc,Uee=48*Oc,qee=3*Oc,zee=2*Oc,dL=3*Oc,BE=15*Oc,c5=74*Oc,pL=30*Oc,UE=class{constructor(e){this.values=[],this.minValue=1/0,this.maxValue=0,this.dom=document.createElement("canvas"),this.name=e.name,this.yMax=e.yMax,this.fg=e.fg,this.bg=e.bg,this.dom.width=l5,this.dom.height=Uee,this.dom.style.cssText="width:80px;height:48px";let t=this.dom.getContext("2d");if(!t)throw new Error("Could not get context");this.context=t,t.font="bold "+9*Oc+"px Helvetica,Arial,sans-serif",t.textBaseline="top",t.fillStyle=this.bg,t.fillRect(0,0,l5,Uee),t.fillStyle=this.fg,t.fillText(this.name,qee,zee),t.fillRect(dL,BE,c5,pL),t.fillStyle=this.bg,t.globalAlpha=.9,t.fillRect(dL,BE,c5,pL)}update(e){this.values.push(e),this.values.length>c5/Oc&&this.values.shift(),this.minValue=Math.min(this.minValue,e),this.maxValue=Math.max(this.maxValue,e),this.draw()}draw(){this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,l5,BE),this.context.fillStyle=this.fg,this.context.fillText(Math.round(this.values[this.values.length-1])+" "+this.name+" ("+Math.round(this.minValue)+"-"+Math.round(this.maxValue)+")",qee,zee),this.context.fillStyle=this.fg,this.context.fillRect(dL+Oc,BE,this.values.length*Oc,pL),this.context.fillStyle=this.bg,this.context.globalAlpha=.9;for(let e=0;e<this.values.length;e++){let t=this.values[e];this.context.fillRect(dL+(e+1)*Oc,BE,Oc,Math.round((1-t/this.yMax)*pL))}}};var{If:ff}=Er.Components,qE=class extends Er.Class{init(){this.controller=this.props.controller()}settings(){return this.controller.getGraphSettings()}template(){return Er.createElement("div",{class:this.const(rx),style:Er.const("width: 100%; height: 100%; position: relative;")},Er.createElement("div",{class:()=>({"dcg-container":!0,"dcg-fullscreen":!this.controller.isListVisible(),"dcg-narrow":this.controller.isNarrow(),"dcg-projector-mode":this.settings().config.projectorMode,"dcg-inverted-colors":!!this.settings().config.invertedColors,"dcg-inverted-swatches":this.controller.invertSwatches(),"dcg-EDIT-LIST-MODE":this.controller.isInEditListMode(),"dcg-no-graphpaper":!this.settings().config.graphpaper,"dcg-no-branding":!this.settings().config.branding,"dcg-no-expression-topbar":!this.settings().config.expressionsTopbar,"dcg-default-border":!!this.settings().config.border,"dcg-no-hyperlinks":!this.settings().config.links,"dcg-has-background-color":this.controller.hasBackgroundColor(),"dcg-is-interactive":this.settings().config.expressions||!(this.settings().config.lockViewport||this.settings().userLockedViewport)}),style:()=>({"font-size":this.settings().config.fontSize+"px",background:this.controller.hasTransparentBackground()?"none":void 0,"--dcg-custom-background-color":this.controller.hasBackgroundColor()?this.controller.getBackgroundColor():void 0,"--dcg-custom-background-color-shaded":this.controller.hasBackgroundColor()?this.controller.getPillboxBackgroundColor():void 0,"--dcg-custom-text-color":this.controller.hasTextColor()?this.controller.getTextColor():void 0}),role:Er.const("application"),"aria-label":()=>this.controller.isGeometry()?this.controller.s("graphing-calculator-narration-main-kiavash-geometry"):this.controller.s("graphing-calculator-narration-main-kiavash-graphing-calculator"),"x-ms-format-detection":Er.const("none"),didMount:this.bindFn(this.didMountRoot)},Er.createElement(ff,{predicate:()=>this.controller.getGraphSettings().config.expressions},()=>Er.createElement(FE,{controller:this.props.controller})),Er.createElement(ff,{predicate:()=>this.controller.isListEnabled()&&!this.controller.isListVisible()&&(!this.controller.isGeometry()||this.controller.isNarrow())},()=>Er.createElement("div",{class:()=>({"dcg-overgraph-icon-container":!0,"dcg-bottom-right":this.controller.isNarrow()})},Er.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-tooltip-show-list"),gravity:()=>this.controller.isNarrow()?"n":"s"},Er.createElement("div",{class:()=>({"dcg-show-expressions-tab":!0,"dcg-overgraph-icon":!0,"dcg-rotated":this.controller.isNarrow()}),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-show-list"),role:Er.const("button"),tabIndex:Er.const("0"),onTap:e=>{this.controller.dispatch({type:"show-expressions-list",focusHideIcon:e.device==="keyboard"})},manageFocus:this.const(ct({controller:this.controller,location:{type:"show-expression-list-btn"}}))},Er.createElement("i",{class:Er.const("dcg-icon-show"),"aria-hidden":Er.const("true")}))))),Er.createElement(ff,{predicate:this.bindFn(this.showHamburger)},()=>Er.createElement("div",{class:Er.const("dcg-overgraph-icon-container")},Er.createElement(ze,{tooltip:()=>this.controller.s("graphing-calculator-label-tooltip-open-graph"),gravity:this.const("s")},Er.createElement("div",{role:Er.const("button"),"aria-label":()=>this.controller.s("graphing-calculator-label-tooltip-open-graph"),class:Er.const("dcg-action-opendrawer dcg-in-api-action-opendrawer dcg-overgraph-icon"),onTap:()=>this.controller.dispatch({type:"open-drawer"})},Er.createElement("i",{class:Er.const("dcg-icon-hamburger"),"aria-hidden":Er.const("true")}))))),Er.createElement(fV,{controller:this.props.controller}),Er.createElement(iL,{controller:this.props.controller}),Er.createElement(ff,{predicate:()=>this.controller.isGeoUIActive()&&this.controller.getGraphSettings().config.settingsMenu&&this.controller.isGraphSettingsOpen()},()=>Er.createElement(NE,{controller:this.props.controller})),Er.createElement(ff,{predicate:()=>this.controller.shouldShowGeoToolbar()},()=>Er.createElement(sV,{controller:this.props.controller})),Er.createElement(bV,{controller:this.props.controller}),Er.createElement("div",{class:Er.const("dcg-grapher dcg-grapher-2d"),style:()=>({visibility:this.controller.isThreeDMode()?"hidden":"visible","pointer-events":this.controller.isThreeDMode()?"none":"auto"})}),Er.createElement(ff,{predicate:()=>this.controller.is3dProduct()},()=>Er.createElement("div",{class:Er.const("dcg-grapher dcg-grapher-3d"),style:()=>({visibility:this.controller.isThreeDMode()?"visible":"hidden","pointer-events":this.controller.isThreeDMode()?"auto":"none"})})),Er.createElement(ff,{predicate:()=>this.settings().config.showPerformanceMeter&&!!this.props.controller().getGrapher()},()=>Er.createElement(uL,{controller:this.props.controller})),Er.createElement(ff,{predicate:()=>this.controller.getGraphSettings().config.keypad},()=>Er.createElement(KA,{controller:this.props.controller}))))}showHamburger(){return!this.controller.getGraphSettings().config.showHamburger||this.controller.isGeometry()?!1:this.controller.isNarrow()}didMountRoot(e){Zf(e),this.controller.getGraphSettings().config.disableScrollFix||WA(e),this.setupFileDragDrop(e)}setupFileDragDrop(e){wS(e);let t=new Set,o=this;function i(){t=new Set,re(e).off(".filedraggedover"),o.controller.dispatch({type:"file-is-not-dragged-over"})}re(e).on("dragenter",n=>{this.controller.areImagesEnabled()&&(n.target.closest(".dcg-notice")||(t.size===0&&re(e).on("dcg-tapstart.filedraggedover",i),t=t.add(n.target),this.controller.dispatch({type:"file-is-dragged-over"})))}).on("dragleave",n=>{t.delete(n.target),t.size===0&&i()}).on("drop",i)}};$t();function Hee(r){let e={},t=new __dcg_shared_module_exports__['we'](o);function o(i,n){r({type:i,payload:n})}return e.postMessage=function(i){setTimeout(()=>{t.processChangeSet(i)},0)},e}var Kee=Pz("workerThrottle"),d5=0;function Wee(r){return Kee?function(e){var o,i;let t=((i=(o=e.data)==null?void 0:o.originalMessage)==null?void 0:i.type)==="evaluatorProgressUpdate"?0:Kee;d5=Math.max(Date.now(),d5)+t,setTimeout(r,d5-Date.now(),e)}:r}var g1=class{constructor(e=1/0){this.workers=[],this.maxWorkers=e}allowedToSpawnWorker(){return!!__dcg_worker_source_exports__['createWorker']&&this.workers.length<this.maxWorkers}killWorker(e){__dcg_shared_module_exports__['C'](this.workers,e)!==-1&&(e.terminate(),this.workers=__dcg_shared_module_exports__['y'](this.workers,e),__dcg_shared_module_exports__['t'](__dcg_shared_module_exports__['H'](e.__connections)).forEach(o=>{o&&o.onWorkerKilled&&o.onWorkerKilled()}))}spawnWorker(){if(!__dcg_worker_source_exports__['createWorker'])return null;try{let e=__dcg_worker_source_exports__['createWorker']();return e.__connections={},e.__isFake=!1,e.onerror=function(t){__dcg_shared_module_exports__['g'].log(t)},e.addEventListener("message",Wee(t=>{let o=t.data;if(!(o&&o.log)&&o&&o.connectionId){let i=e.__connections[o.connectionId];i&&i.onResponse(o.originalMessage)}})),this.workers.push(e),e}catch(e){return null}}spawnFakeWorker(){let e=Hee(Wee(t=>{let o=__dcg_shared_module_exports__['H'](e.__connections)[0];o&&o.onResponse(t)}));return e.__isFake=!0,e.__connections={},e}findLeastUsedWorker(){let e=function(o){return __dcg_shared_module_exports__['w'](o.__connections)};return __dcg_shared_module_exports__['u'](this.workers,e)[0]}allocateWorker(){let e=null;return this.allowedToSpawnWorker()&&(e=this.spawnWorker()),e||(e=this.findLeastUsedWorker()),e||(e=this.spawnFakeWorker()),e}};var gL=class{constructor(e){this.workerPool=e,this.guid=__dcg_shared_module_exports__['P']("worker-pool-connection"),this.worker=e.allocateWorker(),this.worker.__connections[this.guid]=this}destroy(){this.sendMessage({type:"destroy"}),delete this.worker.__connections[this.guid]}killWorker(){this.worker.__isFake||this.workerPool.killWorker(this.worker)}onWorkerKilled(){}onResponse(e){}sendMessage(e){this.worker.__isFake?this.worker.postMessage(e):this.worker.postMessage({connectionId:this.guid,originalMessage:e})}};var mL=class{constructor(e){this.onChangeSetChanged=e;this.changeSet=null;this.cumulativeChangeSet={};this.changed=!1}hasPendingChanges(){return!!this.changeSet}pendingChangesAreCompleteState(){return!!this.changeSet&&this.changeSet.isCompleteState}pendingChangesSyncId(){var e;return(e=this.changeSet)==null?void 0:e.syncId}popChangeSet(){let e=this.changeSet;return this.changeSet=null,this.changed=!1,e}applyToChangeSets(e){this.changed=!0,this.changeSet||(this.changeSet={}),this.cumulativeChangeSet||(this.cumulativeChangeSet={}),e(this.changeSet),e(this.cumulativeChangeSet),this.onChangeSetChanged()}_clearStatementsAndStartCompleteState(){this.applyToChangeSets(e=>{e.isCompleteState=!0,delete e.statements})}markDroppedJob(){this.changeSet=__dcg_shared_module_exports__['i'](this.cumulativeChangeSet),this.changed=!0}markWorkerKilledWhileIdle(){this.changeSet=__dcg_shared_module_exports__['i'](this.cumulativeChangeSet),this.changed=!1}markSyncId(e){this.applyToChangeSets(t=>{t.syncId=e})}markUndoRedoState(){this.applyToChangeSets(e=>{e.isUndoRedoState=!0})}addStatement(e){this.applyToChangeSets(t=>{t.statements||(t.statements={}),t.statements[e.id]=__dcg_shared_module_exports__['i'](e)})}removeStatement(e){this.applyToChangeSets(t=>{t.statements||(t.statements={}),t.removes||(t.removes={}),delete t.statements[e],t.removes[e]=!0})}addActionStepEvent(e){this.applyToChangeSets(t=>{t.events||(t.events=[]),t.events.push({type:"step",expressionId:e})})}addClockTickEvent(e,t){this.applyToChangeSets(o=>{o.events||(o.events=[]),o.events.push({type:"clock-tick",id:e,isFirstTick:t})})}addClickEvent(e,t){this.applyToChangeSets(o=>{o.events||(o.events=[]),t===void 0&&(t=0),o.events.push({type:"click",expressionId:e,indexVar:t})})}_applyIfChanged(e,t){let o=this.cumulativeChangeSet&&this.cumulativeChangeSet[t],i=e[t];__dcg_shared_module_exports__['J'](o,i)||this.applyToChangeSets(n=>{n[t]=i})}};var mxe=4e3,fxe=250,bxe=500,bf=class extends mL{constructor(t){super(()=>this.processChangeSet());this.droppedMessage=!1;this.__hasBufferedProgressUpdates=!1;this.evaluationProgressById=new Map;this.lastProgressUpdateTime=-1;this.requestedIntentionalRestart=!1;this.debouncedRestart=__dcg_shared_module_exports__['F'](()=>{this.requestedIntentionalRestart=!0,this.restartWorker()},fxe);this.__ticksEnabled=!0;this.listeners={evaluatorProgressUpdate(t){this.lastProgressUpdateTime=Date.now(),t.ids.forEach(o=>this.evaluationProgressById.set(o,t.update)),this.__hasBufferedProgressUpdates=!0},processChangeSet(t){this.clearProgressUpdates();let o={},i={};for(let l in t.graphChanges){let c=t.graphChanges[l];c===void 0?i[l]=!0:(__dcg_shared_module_exports__['_c'](c),o[l]=c)}let n={};for(let l in t.intersectionChanges)i[l]||(n[l]=t.intersectionChanges[l]);let a=this.hasPendingChanges();this.onEvaluatorResults({evaluationStates:t.statusChanges,graphData:{addedGraphs:o,removedGraphs:i,intersections:n},renderSlowly:!!t.isCompleteState,timingData:t.timingData,eventUpdates:t.eventUpdates,dependencyOrder:t.dependencyOrder});let s=t.syncId;for(;this.syncRequests.length&&s!==void 0&&this.syncRequests[0].id<=s;)this.syncRequests.shift().callback();this.markJobFinished(),a&&this._processChangeSet()}};this.syncId=1,this.syncRequests=[],this.workerPool=t!=null?t:new g1,this.createWorkerPoolConnection()}privateGetWorkerPool(){return this.workerPool}privateGetWorkerPoolConnection(){return this.workerPoolConnection}createWorkerPoolConnection(){this.workerPoolConnection&&(this.workerPoolConnection.onResponse=function(){},this.workerPoolConnection.onWorkerKilled=function(){}),this.workerPoolConnection=new gL(this.workerPool),this.markJobFinished(),this.workerPoolConnection.onResponse=t=>{this.shouldIgnoreWorkerMessage(t)?t.type==="processChangeSet"&&(this.markJobFinished(),this._processChangeSet()):this.listeners[t.type].call(this,t.payload)},this.workerPoolConnection.onWorkerKilled=()=>{this.cancelRestartWorker();let t=this.hasJobInWorker();this.createWorkerPoolConnection(),t?(this.markDroppedJob(),this.droppedMessage=!this.requestedIntentionalRestart):this.markWorkerKilledWhileIdle(),this.clearProgressUpdates(),this.processChangeSet(),this.requestedIntentionalRestart=!1}}destroy(){this.workerPoolConnection&&(this.workerPoolConnection.onResponse=function(){},this.workerPoolConnection.onWorkerKilled=function(){},this.workerPoolConnection.destroy())}restartWorker(){this.workerPoolConnection.killWorker()}requestRestartWorker(){this.debouncedRestart()}cancelRestartWorker(){this.debouncedRestart.cancel()}shouldIgnoreWorkerMessage(t){return this.__suspendUntilSyncId?!t||!t.payload?!0:!(t.payload.syncId>=this.__suspendUntilSyncId):!1}suspend(){this.clearProgressUpdates(),this.pendingChangesSyncId()===void 0&&(this.syncId++,this.markSyncId(this.syncId)),this.__suspendUntilSyncId=this.pendingChangesSyncId()}markJobFinished(){this.droppedMessage=!1,this.__jobStartTime=-1,this.__suspendUntilSyncId=void 0}startJobTimer(){this.__jobStartTime=Date.now()}hasJobInWorker(){return this.__jobStartTime!==-1}getJobElapsedTime(){return this.hasJobInWorker()?Date.now()-this.__jobStartTime:NaN}setTicksEnabled(t){this.__ticksEnabled=t}tick(){var t;this.__ticksEnabled&&(this.__hasBufferedProgressUpdates&&((t=this.onEvaluatorProgressUpdate)==null||t.call(this)),this.__hasBufferedProgressUpdates=!1,this._processChangeSet())}processChangeSet(){this.__processChangeSetRequested=!0}_processChangeSet(){var o;if(this._syncEvaluatorConfig(),!this.__processChangeSetRequested)return;let t=this.getJobElapsedTime()>=mxe;if(this.droppedMessage&&t){this.restartWorker();return}this.changed&&this.hasPendingChanges()&&(this.pendingChangesSyncId()===void 0&&(this.syncId++,this.markSyncId(this.syncId)),this.hasJobInWorker()?this.pendingChangesAreCompleteState()&&t&&this.restartWorker():(this.startJobTimer(),this.workerPoolConnection.sendMessage(this.popChangeSet()),this.__processChangeSetRequested=!1,(o=this.clearSlowEvaluatorTracking)==null||o.call(this)))}notifyWhenSynced(t){if(this._syncEvaluatorConfig(),!this.hasJobInWorker()&&!this.hasPendingChanges()){setTimeout(t,0);return}this.syncId++,this.syncRequests.push({id:this.syncId,callback:t}),this.markSyncId(this.syncId)}clearStatementsAndStartCompleteState(){this.hasJobInWorker()&&this.suspend(),this._clearStatementsAndStartCompleteState()}_syncEvaluatorConfig(){if(!this.readEvaluatorConfig)return;let t=this.readEvaluatorConfig();for(let o in t)this._applyIfChanged(t,o)}clearProgressUpdates(){this.evaluationProgressById=new Map,this.__hasBufferedProgressUpdates=!1}isCurrentlySlow(){return this.lastProgressUpdateTime>-1&&Date.now()-this.lastProgressUpdateTime>=bxe}};$t();var zE=class{constructor(e){this.previousPaneFocusLocations={main:void 0,quest:void 0};this.controller=e}markKeyDownAsHandled(e){e.stopPropagation(),e.preventDefault()}handleKeydown(e){var o,i,n,a,s;let t=Ho(e);if(Jf(e))this.markKeyDownAsHandled(e),this.controller.hasVisibleAndUndoableToast()?this.controller.toastUndo():this.controller.dispatch({type:"undo"});else if(Qf(e))this.markKeyDownAsHandled(e),this.controller.dispatch({type:"redo"});else if(e.altKey&&!e.ctrlKey&&!e.metaKey&&e.shiftKey&&t==="Z"){let l=this.controller.getSelectedItem();l&&l.id&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"expression-zoom-fit",id:l.id,focusAfterTap:!1}))}else if(e.altKey!==qo&&e.metaKey===qo&&!e.ctrlKey&&e.shiftKey&&t==="A"&&this.controller.isDecimalToFractionEnabled()){let l=this.controller.getSelectedItem();l&&l.type==="expression"&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"toggle-fraction-evaluation",id:l.id}),this.controller.runAfterDispatch(()=>{cm(l)?Te(this.controller.s("shared-calculator-narration-show-as-fraction")):Te(this.controller.s("shared-calculator-narration-show-as-decimal"))}))}else if(!e.altKey&&e.ctrlKey!==qo&&e.metaKey===qo&&t==="F"){if(this.controller.isExpressionListFocused()){let l=Ze.getFocusedMathquill(),c="";try{c=l.__controller.cursor.selection.join("latex")||""}catch(d){}this.controller.dispatch({type:"open-expression-search",rename:!!e.shiftKey,latex:c}),this.markKeyDownAsHandled(e)}}else if((e.altKey||e.metaKey)&&!e.ctrlKey&&!e.shiftKey&&t===void 0){if(Be(e)===Ia){let l=this.controller.getSelectedItem();l&&l.type==="folder"&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-folder-collapsed",id:l.id,isCollapsed:!0}),Te(this.controller.s("graphing-calculator-narration-folder-collapsed")))}else if(Be(e)===On){let l=this.controller.getSelectedItem();l&&l.type==="folder"&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-folder-collapsed",id:l.id,isCollapsed:!1}),Te(this.controller.s("graphing-calculator-narration-folder-expanded")))}}else if(e.shiftKey&&(e.altKey||e.metaKey)&&!e.ctrlKey){if(Be(e)===Ia)this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-all-folders-collapsed",isCollapsed:!0}),Te(this.controller.s("graphing-calculator-narration-all-folders-collapsed"));else if(Be(e)===On)this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-all-folders-collapsed",isCollapsed:!1}),Te(this.controller.s("graphing-calculator-narration-all-folders-expanded"));else if(t==="H"){let l=this.controller.getSelectedItem();l&&"hidden"in l&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"toggle-item-hidden",id:l.id}),this.controller.runAfterDispatch(()=>{l.hidden?Te(this.controller.s("graphing-calculator-narration-item-hidden")):Te(this.controller.s("graphing-calculator-narration-item-visible"))}))}else if(t==="O"){if(!this.controller.authorFeaturesAvailable())return;this.controller.dispatch({type:"set-author-mode",enabled:!this.controller.shouldShowAuthorFeatures()}),Te(this.controller.shouldShowAuthorFeatures()?this.controller.s("shared-calculator-narration-author-mode-on"):this.controller.s("shared-calculator-narration-author-mode-off")),this.markKeyDownAsHandled(e)}else if(t==="E"){if(!this.controller.isListEnabled())return;this.controller.isListVisible()?(this.controller.dispatch({type:"hide-expressions-list",focusShowIcon:!1}),Te(this.controller.s("graphing-calculator-narration-hide-expression-list"))):(this.controller.dispatch({type:"show-expressions-list",focusHideIcon:!1}),this.focusExpressionList()),this.markKeyDownAsHandled(e)}}else if(e.ctrlKey&&(e.altKey||e.metaKey)&&!e.shiftKey){if(t==="E"){if(!this.controller.isListEnabled())return;this.markKeyDownAsHandled(e),this.focusExpressionList()}else if(t==="X"){if(!this.controller.isListEnabled())return;this.markKeyDownAsHandled(e),this.controller.canUserAddExpressions()?(Te(this.controller.s("graphing-calculator-narration-add-expression")),this.controller.dispatch({type:"new-expression"})):Te(this.controller.s("graphing-calculator-narration-unable-to-add-expression"))}else if(t==="O"){if(!this.controller.isListEnabled())return;this.markKeyDownAsHandled(e),this.controller.canUserAddExpressions()&&this.controller.areNotesEnabled()?(Te(this.controller.s("graphing-calculator-narration-add-note")),this.controller.dispatch({type:"new-text"})):Te(this.controller.s("graphing-calculator-narration-unable-to-add-note"))}else if(t==="F"&&this.controller.canUserAddExpressions()&&this.controller.areFoldersEnabled())this.markKeyDownAsHandled(e),Te(this.controller.s("graphing-calculator-narration-add-folder")),this.controller.dispatch({type:"new-folder"});else if(t==="I"&&this.controller.canUserAddExpressions()&&this.controller.areImagesEnabled())this.markKeyDownAsHandled(e),this.controller.dispatch({type:"toggle-add-expression",focusOnOpen:!1}),this.controller.runAfterDispatch(()=>{let l=this.controller.findEl(".dcg-add-expression-container input[type=file]");l&&(re(l).trigger("click"),Te(this.controller.s("graphing-calculator-narration-add-image")))});else if(t==="T")this.markKeyDownAsHandled(e),this.controller.canUserAddExpressions()?(Te(this.controller.s("graphing-calculator-narration-add-table")),this.controller.dispatch({type:"new-table"})):Te(this.controller.s("graphing-calculator-narration-unable-to-add-table"));else if(t==="R"){let l=this.controller.getSelectedItem();if(!this.controller.isListEnabled())return;this.markKeyDownAsHandled(e),this.controller.canUserAddExpressions()&&l&&this.controller.shouldShowRegressionButton(l)?(Te(this.controller.s("graphing-calculator-button-add-table-regression")),this.controller.dispatch({type:"create-table-regression",tableId:l.id,regressionType:"linear"})):Te(this.controller.s("graphing-calculator-narration-unable-to-add-table-regression"))}else if(t==="M"&&this.controller.isGeoUIActive())if(this.markKeyDownAsHandled(e),this.controller.getGeoToolbarGroupKeys().length>0){let l=this.controller.getActiveTool();if(this.controller.shouldShowMultiSelectHeader()){let c=this.controller.getAllSelectedItems().filter(d=>!this.controller.isItemReadonly(d.id)).length>0;this.controller.dispatch({type:"set-focus-location",location:{type:c?"multi-select-show-hide-icon":"multi-select-style-icon"}})}else l==="expression-edit"&&(l="selection"),this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:l}})}else Te(this.controller.s("graphing-calculator-narration-no-geometry-tools-available"));else if(t==="C"&&this.controller.isGeoUIActive())this.markKeyDownAsHandled(e),this.controller.getGeometryTokenCount()>0?this.controller.dispatch({type:"set-show-constructions-open",open:!0,setFocus:!0}):Te(this.controller.raw("Object navigator has no items."));else if(t==="G")this.markKeyDownAsHandled(e),this.controller.dispatch({type:"toggle-graph-settings",focusOnOpen:!0});else if(t==="P"){if(this.markKeyDownAsHandled(e),this.controller.isGeometry()){let l=this.controller.getFocusLocation(),c=this.controller.getValidCursorContext();if(l&&l.type==="expression"&&c&&c.type!=="empty"){this.controller.dispatch({type:"set-focus-location",location:{type:"expression",id:l.id,isFakeGraphFocus:!0}}),(i=(o=this.controller.getGrapher2d())==null?void 0:o.poiController)==null||i.keyboardAttentionManager.handleGrapherGainedFocus();return}}this.controller.dispatch({type:"set-focus-location",location:{type:"graph-paper"}})}else if(t==="Z"){let l=this.controller.getSelectedItem();l&&l.id&&this.controller.dispatch({type:"expression-zoom-fit",id:l.id,focusAfterTap:!1})}else if(t==="D"&&this.controller.canUserAddExpressions()){this.markKeyDownAsHandled(e);let l=!this.controller.isInEditListMode();this.controller.dispatch({type:"set-edit-list-mode",isEditListMode:l,focusExpressionList:!0})}}else if(a2(e)&&this.controller.getQuestIsActive()){((n=this.controller.focusLocation)==null?void 0:n.type)==="quest"?(this.previousPaneFocusLocations.quest=this.controller.focusLocation,this.previousPaneFocusLocations.main?this.controller.dispatch({type:"set-focus-location",location:this.previousPaneFocusLocations.main}):this.focusExpressionList()):(this.previousPaneFocusLocations.main=this.controller.focusLocation,this.controller.dispatch({type:"set-focus-location",location:(a=this.previousPaneFocusLocations.quest)!=null?a:{type:"quest",location:"quest-pane"}})),this.markKeyDownAsHandled(e);return}else if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey){if(Be(e)===Wg)(!document.activeElement||!Gh(document.activeElement))&&e.preventDefault();else if(Be(e)===Pn&&!this.controller.getOpenItemMenu()&&!this.controller.isGraphSettingsOpen()){if(this.controller.isGeoUIActive()){let l=!1,c=this.controller.getGeoModel();if(this.controller.hasAnyItemsSelected()&&(this.controller.dispatch({type:"set-none-selected"}),l=!0),c.isToolplayActive()&&(this.controller.dispatch({type:"cancel-geo-toolplay"}),Te(this.controller.s("graphing-calculator-narration-geometry-tool-cancelled")),l=!0),this.controller.isGraphPaperFocused()&&(this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:this.controller.getActiveTool()}}),l=!0),this.controller.getActiveTool()!=="selection"&&!l){this.controller.dispatch({type:"select-geo-tool",tool:"selection"});let d=this.controller.getFocusLocation();d&&d.type==="geo-basic-tool"&&this.controller.dispatch({type:"set-focus-location",location:{type:"geo-basic-tool",tool:this.controller.getActiveTool()}}),l=!0}if(l){this.markKeyDownAsHandled(e);return}}this.controller.isInEditListMode()&&!this.controller.findEl(".dcg-options-menu")&&(this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-edit-list-mode",isEditListMode:!1,focusExpressionList:!0}))}}else if(!e.metaKey&&!e.shiftKey&&e.ctrlKey===qo&&e.altKey===!qo){if(t==="N"){if(!this.controller.getBrailleControls())return;this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-braille-mode",mode:"nemeth"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-nemeth"))}else if(t==="U"){if(!this.controller.getBrailleControls())return;this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-braille-mode",mode:"ueb"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-ueb"))}else if(t==="Q"||t==="X"){if(!this.controller.getBrailleControls())return;this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-braille-mode",mode:"none"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-off"))}else if(t==="6"){if(!this.controller.getBrailleControls())return;this.markKeyDownAsHandled(e);let l=!this.controller.getSixKeyInput();this.controller.dispatch({type:"set-six-key-input",useSixKeyInput:l}),Te(l?this.controller.s("shared-calculator-narration-six-key-mode-on"):this.controller.s("shared-calculator-narration-six-key-mode-off"))}else if(t==="D"){if(this.controller.isComplexModeEnabled()){Te(this.controller.s("shared-calculator-text-complex-radian-mode"));return}this.markKeyDownAsHandled(e),this.controller.dispatch({type:"set-graph-settings",degreeMode:!this.controller.getGraphSettings().degreeMode}),Te(this.controller.getGraphSettings().degreeMode?this.controller.s("graphing-calculator-button-settings-degrees"):this.controller.s("graphing-calculator-button-settings-radians"))}else if(t==="K"){if(!this.controller.isKeypadEnabled()||this.controller.inAudioTraceMode())return;this.markKeyDownAsHandled(e),this.controller.dispatch({type:"keypad/set-minimized",minimized:this.controller.isHideKeypadButtonVisible()})}else t==="M"&&((s=this.controller.toneController)==null||s.handleMuteKeyShortcut(),this.markKeyDownAsHandled(e));if(t==="+"||t==="="){this.zoom("in"),this.markKeyDownAsHandled(e);return}else if(t==="-"){this.zoom("out"),this.markKeyDownAsHandled(e);return}else if(t==="0"&&!e.shiftKey){this.setDefaultViewport(),this.markKeyDownAsHandled(e);return}}}focusExpressionList(){let e=this.controller.getSelectedItem();e?this.controller.dispatch({type:"move-focus-to-item",id:e.id}):this.controller.dispatch({type:"focus-first-expression"})}zoom(e){var t;(t=this.controller.getGrapher())==null||t.viewportController.zoom(e)}setDefaultViewport(){var e;(e=this.controller.getGrapher())==null||e.viewportController.setDefaultViewport()}};function $ee(r){let{left:e,right:t,bottom:o,top:i}=r;return{left:e,right:t,bottom:o,top:i,xmin:e,xmax:t,ymin:o,ymax:i,width:Math.abs(t-e),height:Math.abs(i-o)}}var yxe=0,HE=class{constructor(e,t,o,i){e||(e=document.createElement("div"));let n=document.createElement("div");n.className="dcg-dom-change-wrapper",n.style.width="100%",n.style.height="100%",e.appendChild(n),this.__id=yxe++;let a=new qh;this.graphSettings=a;for(let h in o)a.config.setProperty(h,o[h]);let s=new by(a);this.controller=s,i&&s.dispatch({type:"ui/container-resized",size:i}),this.rootElt=n,this.view=m1.mountToNode(qE,this.rootElt,{controller:m1.const(s)});let l=new bf(t);this.controller.setEvaluator(l),this.controller.setRootElt(this.rootElt);let c=this.controller.findEl(".dcg-grapher-2d"),d=new Bb(c,a,this.controller,l);if(this.controller.setGrapher2d(d),this.controller.is3dProduct()){let h=this.controller.findEl(".dcg-grapher-3d"),m=new VA(h,a,this.controller,l);this.controller.setGrapher3d(m),this.grapher=m}else this.grapher=d;this.controller.initStateStack(),l.readEvaluatorConfig=()=>({product:a.config.product,beta3d:a.config.beta3d,evaluationMode:s.isGeometry()?"geometry":this.controller.isThreeDMode()?"graphing_3d":"graphing",globalRandomSeed:a.randomSeed,includeFunctionParametersInRandomSeed:a.includeFunctionParametersInRandomSeed,degreeMode:a.degreeMode,viewState:s.getViewState(),selectedIds:s.getPropagatedSelectedIds().selected,restrictedFunctions:a.config.restrictedFunctions,forceEnableGeometryFunctions:a.config.forceEnableGeometryFunctions,distributions:a.config.distributions,pointsOfInterest:a.config.pointsOfInterest,plotSingleVariableImplicitEquations:a.config.plotSingleVariableImplicitEquations,plotImplicits:a.config.plotImplicits,plotInequalities:a.config.plotInequalities,sliders:a.config.sliders,actions:!!a.config.actions,substitutions:a.config.substitutions,intervalComprehensions:a.config.intervalComprehensions,recursion:a.config.recursion,recursionDepthLimit:a.config.recursionDepthLimit,dimensions:s.getGrapherDimensions(),logInternalErrors:a.config.logInternalErrors,complex:a.complex,customRegressions:a.config.customRegressions}),l.onEvaluatorProgressUpdate=()=>{this.controller.dispatch({type:"evaluator-progress-update"})},l.onEvaluatorResults=h=>{this.controller.dispatch({type:"on-evaluator-changes",changes:h.evaluationStates,timingData:h.timingData,graphData:h.graphData,eventUpdates:h.eventUpdates,dependencyOrder:h.dependencyOrder}),this.controller.requestRedrawGraph()},this.unsubFunc=this.controller.subscribeToChanges(()=>{this.controller.doesDOMHaveSize()&&(this.view.update(),this.grapher=this.controller.isThreeDMode()?this.controller.getGrapher3d()||this.controller.getGrapher2d():this.controller.getGrapher2d(),this.grapher.update());let h=!1;u()&&(h=!0),h&&this.controller.doesDOMHaveSize()&&(this.view.update(),this.grapher.update())});let p=new Hs({pixelCoordinates:{top:0,bottom:0,left:0,right:0,width:0,height:0},mathCoordinates:$ee({top:0,bottom:0,left:0,right:0})});this.graphpaperBounds=p;let u=()=>{let h=!1,m=s.computeMajorLayout(),y={left:m.grapher.left,right:m.grapher.left+m.grapher.width,width:m.grapher.width,top:m.grapher.top,bottom:m.grapher.top+m.grapher.height,height:m.grapher.height},w=this.grapher.getCurrentViewport(),S={...$ee({left:w.xmin,right:w.xmax,bottom:w.ymin,top:w.ymax}),zmin:w.zmin,zmax:w.zmax};return __dcg_shared_module_exports__['J'](S,p.mathCoordinates)||(p.setProperty("mathCoordinates",S),h=!0),y.height>0&&y.width>0&&!__dcg_shared_module_exports__['J'](y,p.pixelCoordinates)&&(p.setProperty("pixelCoordinates",y),h=!0),h};re(this.rootElt).on("keydown.calculator-"+this.__id,h=>{this.grapher instanceof Bb&&this.grapher.audioGraph.handleKeydown(h),this.instanceHotkeys.handleKeydown(h)}),re(document.documentElement).on("dcg-tapstart.calculator-"+this.__id,h=>{var v;let m=h.target,y=!!this.rootElt.contains(m),w=h.wasHandled("create-expression-with-keyboard"),S=!!m.classList.contains("dcg-shell");!y&&!S&&!w&&s.dispatch({type:"set-none-selected"});let C=(v=this.controller.getGrapher2d())==null?void 0:v.traceLayer;if(!h.wasHandled("do-not-clear-poi-labels")&&C&&(C.clearOpenedPOI(),this.controller.requestRedrawGraph()),s.isInEditListMode()){let E=!m.closest(".dcg-exppanel")&&!m.closest(".dcg-options-menu")&&!m.closest(".dcg-expression-top-bar")&&!m.closest(".dcg-keypad");(!y||E)&&s.dispatch({type:"set-edit-list-mode",isEditListMode:!1,focusExpressionList:!1})}}),this.evaluator=l,this.controller.dispatch({type:"set-blank",degreeMode:!!o.degreeMode}),a.config.expressionsCollapsed&&this.setOptions({expressionsCollapsed:!0}),a.config.capExpressionSize&&this.setOptions({capExpressionSize:!0}),a.config.hasOwnProperty("pointsOfInterest")&&this.setOptions({pointsOfInterest:a.config.pointsOfInterest}),a.config.hasOwnProperty("backgroundColor")&&this.setOptions({backgroundColor:a.config.backgroundColor}),a.config.hasOwnProperty("textColor")&&this.setOptions({textColor:a.config.textColor}),a.config.observe("language",()=>{let h=this.controller.getState();this.controller.dispatch({type:"set-state",state:h})}),a.config.observe("forceLogModeRegressions",()=>{a.config.forceLogModeRegressions&&this.controller.setAllRegressionsToLogMode()}),this.instanceHotkeys=new zE(s)}setOption(e,t){this.controller.getGraphSettings().config.setProperty(e,t)}setOptions(e){let t,o=this.controller.getGraphSettings().config,i={...e};e.hasOwnProperty("backgroundColor")&&(__dcg_shared_module_exports__['Rd'](e.backgroundColor)||(__dcg_shared_module_exports__['g'].warn("Invalid backgroundColor. Background color must be a 3- or 6-character hex color (e.g. #cde or #ffaaaa)"),delete i.backgroundColor)),e.hasOwnProperty("textColor")&&(__dcg_shared_module_exports__['Rd'](e.textColor)||(__dcg_shared_module_exports__['g'].warn("Invalid textColor. Text color must be a 3- or 6-character hex color (e.g. #000 or #001111)"),delete i.textColor)),e.hasOwnProperty("menus")&&(__dcg_shared_module_exports__['g'].warn("Deprecated option: menus. Setting settingsMenu and expressionsTopbar instead."),e.hasOwnProperty("settingsMenu")||(i.settingsMenu=!!e.menus),e.hasOwnProperty("expressionsTopbar")||(i.expressionsTopbar=!!e.menus),delete i.menus),e.hasOwnProperty("solutions")&&(__dcg_shared_module_exports__['g'].warn("Deprecated option: solutions. Setting pointsOfInterest instead."),e.hasOwnProperty("pointsOfInterest")||(i.pointsOfInterest=!!e.solutions),delete i.solutions),e.hasOwnProperty("administerSecretFolders")&&(__dcg_shared_module_exports__['g'].warn("Deprecated option: administerSecretFolders. Setting authorFeatures instead."),e.hasOwnProperty("authorFeatures")||(i.authorFeatures=!!e.administerSecretFolders),delete i.administerSecretFolders),e.hasOwnProperty("singleVariableSolutions")&&(__dcg_shared_module_exports__['g'].warn("Deprecated option: singleVariableSolutions has been removed."),delete i.singleVariableSolutions),e.graphpaper===!1&&(e.expressionsCollapsed&&(i.expressionsCollapsed=!1,__dcg_shared_module_exports__['g'].warn("Cannot set graphpaper: false with expressionsCollapsed: true. Proceeding with expressionsCollapsed: false.")),o.expressionsCollapsed&&(i.expressionsCollapsed=!1,__dcg_shared_module_exports__['g'].warn("Disabling the graphpaper with the expressions list collapsed is not supported.Setting expressionsCollapsed: false.")),e.zoomButtons&&(i.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("Cannot set graphpaper: false with zoomButtons: true. Proceeding with zoomButtons: false.")),e.showResetButtonOnGraphpaper&&(i.showResetButtonOnGraphpaper=!1,__dcg_shared_module_exports__['g'].warn("Cannot set graphpaper: false with showResetButtonOnGraphpaper: true. Proceeding with showResetButtonOnGraphpaper: false.")),o.zoomButtons&&(i.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("Disabling the graphpaper with the zoomButtons visible is not supported. Setting zoomButtons: false.")),o.showResetButtonOnGraphpaper&&(i.showResetButtonOnGraphpaper=!1,__dcg_shared_module_exports__['g'].warn("Disabling the graphpaper with the reset button visible is not supported. Setting showResetButtonOnGraphpaper: false."))),o.graphpaper===!1&&(e.expressionsCollapsed||e.zoomButtons||e.showResetButtonOnGraphpaper)&&(i.graphpaper=!0,__dcg_shared_module_exports__['g'].warn("Must have visible graphpaper to proceed. Setting graphpaper: true.")),e.lockViewport&&e.zoomButtons&&(i.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("Cannot set zoomButtons: true and lockViewport: true. Proceeding with zoomButtons: false.")),o.lockViewport&&e.zoomButtons&&(i.lockViewport=!1,__dcg_shared_module_exports__['g'].warn("Cannot set zoomButtons: true while the viewport is locked. Setting lockViewport: false.")),o.zoomButtons&&e.lockViewport&&(i.zoomButtons=!1,__dcg_shared_module_exports__['g'].warn("Cannot lock the viewport without hiding the zoom buttons. Setting zoomButtons: false."));function n(d){let{notes:p,folders:u,images:h}=d;return p===!1||u===!1||h===!1}let a=n(e),s=n({...o,...e}),l=o.pasteGraphLink,c=e.pasteGraphLink;a?(c||l)&&(i.pasteGraphLink=!1,__dcg_shared_module_exports__['g'].warn("Cannot disable creating note, folder, or image expressions without disabling graph link pasting. Setting pasteGraphLink: false.")):c&&s&&(i.notes=!0,i.folders=!0,i.images=!0,__dcg_shared_module_exports__['g'].warn("Cannot enable graph link pasting while the creation of notes, folders, or images is disable. Setting notes: true, folders: true, images: true.")),e.language&&(i.language=Tu(e.language)),this.controller.isGeometry()&&(e.logScales&&(__dcg_shared_module_exports__['g'].warn("Cannot set logScales: true in the geometry calculator"),delete i.logScales),e.allowComplex&&(__dcg_shared_module_exports__['g'].warn("Cannot set allowComplex: true in the geometry calculator"),delete i.allowComplex));for(t in i)if(i.hasOwnProperty(t))switch(t){case"expressionsCollapsed":this.setOption("expressionsCollapsed",!!i.expressionsCollapsed),i.expressionsCollapsed?this.controller.dispatch({type:"hide-expressions-list",focusShowIcon:!1}):this.controller.dispatch({type:"show-expressions-list",focusHideIcon:!1});break;case"qwertyKeyboard":this.setOption("qwertyKeyboard",!!i.qwertyKeyboard),this.controller.isLetterKeypadOpen()&&this.controller.dispatch({type:"keypad/abc"});break;case"degreeMode":this.setOption("degreeMode",!!i.degreeMode),this.controller.dispatch({type:"set-graph-settings",degreeMode:!!i.degreeMode});break;case"actions":{let p=i[t];if(p===void 0||p===this.controller.getGraphSettings().config.actions)break;this.setOption(t,p),this.setState(this.getState(),{allowUndo:!0});break}case"substitutions":{let p=i[t];if(p===void 0||p===this.controller.getGraphSettings().config.substitutions)break;this.setOption(t,p),this.setState(this.getState(),{allowUndo:!0});break}case"intervalComprehensions":{let p=i[t];if(p===void 0||p===this.controller.getGraphSettings().config.intervalComprehensions)break;this.setOption(t,p),this.setState(this.getState(),{allowUndo:!0});break}case"recursion":{let p=i[t];if(p===void 0||p===this.controller.getGraphSettings().config.recursion)break;this.setOption(t,p),this.setState(this.getState(),{allowUndo:!0});break}case"product":case"beta3d":{__dcg_shared_module_exports__['g'].warn(`Cannot update '${t}' setting.`);break}case"logScales":{let p=i[t];p!==void 0&&(p===!1&&this.controller.dispatch({type:"set-graph-settings",xAxisScale:"linear",yAxisScale:"linear"}),this.setOption(t,p));break}case"graphDescription":{let p=i[t];typeof p=="string"||typeof p=="undefined"?this.setOption(t,p):__dcg_shared_module_exports__['g'].warn("Invalid graphDescription. graphDescription must be of type string or undefined.");break}case"muted":{let p=i[t];if(p===void 0||p===this.controller.getGraphSettings().config.muted)break;p?this.controller.dispatch({type:"mute-global"}):this.controller.dispatch({type:"unmute-global"});break}case"adaptivePeeling":case"advancedStyling":case"allowComplex":case"audio":case"audioTraceSimult":case"audioTraceReverseExpressions":case"authorFeatures":case"authorMode":case"autosize":case"backgroundColor":case"border":case"brailleControls":case"brailleMode":case"branding":case"cacheRenderedSvgs":case"capExpressionSize":case"clearIntoDegreeMode":case"colors":case"crossOriginSaveTest":case"customRegressions":case"decimalToFraction":case"debug3dRender":case"debugPeelLayers":case"debugPixelRatio":case"disableLighting":case"disableWorkerOnZoom":case"defaultLogModeRegressions":case"disableMouseInteractions":case"disableScrollFix":case"distributions":case"editOnWeb":case"enableTabindex":case"expressions":case"expressionsTopbar":case"folders":case"fontSize":case"forceEnableGeometryFunctions":case"forceLogModeRegressions":case"functionDefinition":case"ghostMode":case"graphpaper":case"hideGeoUI":case"imageUploadCallback":case"images":case"invertedColors":case"keypad":case"language":case"links":case"lockViewport":case"nativeOnscreenKeypad":case"notes":case"onlyTraceSelected":case"orientationButtons":case"pasteGraphLink":case"pasteGraphLinkCallback":case"pasteTableData":case"pauseWhenOffscreen":case"peelFloatTexture":case"peelUpsample":case"debugScale":case"perspectiveDistortion":case"plaidMode":case"plotImplicits":case"plotInequalities":case"plotSingleVariableImplicitEquations":case"pointsOfInterest":case"projectorMode":case"restrictedFunctions":case"settingsMenu":case"showHamburger":case"showKeyboardShortcutsInTooltips":case"showPerformanceMeter":case"showResetButtonOnGraphpaper":case"sixKeyInput":case"sliders":case"tableRegressions":case"textColor":case"tone":case"trace":case"translucentSurfaces":case"transparentBackground":case"translucentOpacity":case"wireframe":case"zoomButtons":case"recursionDepthLimit":case"debugProgressUpdates":case"logInternalErrors":case"reflectionArc":case"zoomFit":{let p=i[t];p!==void 0&&this.setOption(t,p);break}default:return t}}setViewport(e){let t=new Co(e.xmin,e.xmax,e.ymin,e.ymax,e.zmin,e.zmax);this.grapher.viewportController.setViewport(t),this.controller.dispatch({type:"commit-user-requested-viewport",viewport:t})}resize(e){e&&this.controller.dispatch({type:"ui/container-resized",size:e})}destroy(){var t;re(document.documentElement).off(".calculator-"+this.__id),re(this.rootElt).off(".calculator-"+this.__id),this.unsubFunc(),this.graphSettings.unobserveAll(),this.controller&&((t=this.controller.toneController)==null||t.unload()),this.evaluator&&this.evaluator.destroy(),this.grapher&&this.grapher.remove(),m1.unmountFromNode(this.rootElt),this.rootElt.remove()}tick(e,t){t||(this.controller.handleTick(e),this.controller.updateRenderShellsAfterDispatch()),this.evaluator.tick(),this.grapher&&this.grapher.tick(e)}getState(e){return this.controller.getState(e)}setBlank(e){this.controller.dispatch({type:"set-blank",opts:e||{}})}setState(e,t){this.controller.dispatch({type:"set-state",state:e,opts:t||{}})}};function xxe(r){function e(t){requestAnimationFrame(e),r(t)}requestAnimationFrame(e)}function wxe(r){function e(){setTimeout(e,f1),r(Date.now())}setTimeout(e,f1)}var jee=Xn("timeoutLoop"),f1=0;typeof jee=="string"&&(f1=parseFloat(jee),isNaN(f1)&&(f1=1e3/60));var Yee=f1>0?wxe:xxe;var u5=new Jn;Yee(r=>{u5.triggerEvent("tick",r)});var p5=0;function hd(r){return p5+=1,u5.observeEvent("tick."+p5,(e,t)=>{r(t)}),p5}function rc(r){u5.unobserveEvent("tick."+r)}var Xee=Xn("nworkers"),Jee=4;Xee&&(Jee=parseInt(Xee,10));var y1=new g1(Jee);function Qee(r,e){let t={},o={};for(let i in r)bF(i)?t[i]=r[i]:qq(i)?o[i]=r[i]:e||__dcg_shared_module_exports__['g'].warn("Unrecognized setting: "+i+". Ignoring.");return{configOptions:t,settingsOptions:o}}function Zee(r,e){let t={};return e.hasOwnProperty("x")&&(t.x=r.mapX(e.x)),e.hasOwnProperty("y")&&(t.y=r.mapY(e.y)),t}var tte=[],h5=!1,ete=new Map;function vxe(r){let e=ete.get(r);return e||(e=new r,ete.set(r,e)),e}function rte(r){if(!r||h5)return;let e;for(;(e=tte.shift())&&e.api._destroyed;);if(!e)return;let t=e;h5=!0;let{options:o,mathBounds:i,state:n,callback:a,api:s}=t,l=vxe(r),c=s._calc.controller.getGraphSettings().config,d={};Object.keys(c).forEach(y=>{bF(y)&&y!=="product"&&y!=="beta3d"&&y!=="projectorMode"&&(d[y]=c[y])}),l.updateSettings(d),l.setState(n),l.setMathBounds(i);let p=l._calc.evaluator,u=()=>{l._calc.grapher.asyncScreenshot(o,y=>{h5=!1,rte(r),a(y)})},h=t.api._calc.controller,m=hd(()=>{h.areAnyImagesLoading()||(rc(m),p.notifyWhenSynced(u))})}var Yd=class extends Hs{constructor(t,o,i){super();this._eventBus=new Jn;this._destroyed=!1;this.isOffscreen=!1;let n=Qee(o||{},!0),a=PG(n.configOptions),s=n.settingsOptions;this._calc=new HE(t,y1,a),this.controller=this._calc.controller,this.controller.onEventsEmitted=l=>{let c=this.controller.getSelectedItem();this.setProperty("isAnyExpressionSelected",!!c),this.setProperty("selectedExpressionId",c?c.id:void 0),this.setProperty("expressionAnalysis",this.controller.getExpressionAnalysis());let d=Ze.getFocusedMathquill();this.setProperty("focusedMathQuill",d?new GG(d):void 0);for(let p in l){if(!l.hasOwnProperty(p))continue;let u=l[p];u&&this._eventBus.triggerEvent(p,u)}},this._calc.graphpaperBounds.observeAndSync("mathCoordinates",this._syncGraphpaperBounds.bind(this)),this._calc.graphpaperBounds.observeAndSync("pixelCoordinates",this._syncGraphpaperBounds.bind(this)),this.colors=this.controller.getColors(),this._initGraphSettings(),this.updateSettings(s),this._sharedClockBusToken=hd(l=>this.withControllerInAPIMode(()=>{let c=this._calc.grapher.settings.config.pauseWhenOffscreen&&this.isOffscreen;this._calc.tick(l,c)})),this.domChangeDetector=new Sb(t,l=>this.withControllerInAPIMode(()=>{switch(this.isOffscreen=l.isOffscreen,l.type){case"offscreen-noop":break;case"added":this._calc.resize(l.size);break;case"removed":break;case"resized":this._calc.resize(l.size);break}})),a.autosize?this.domChangeDetector.startWatching():this.domChangeDetector.checkForChanges(),typeof i=="function"&&i(this)}destroy(){this.controller.onEventsEmitted=function(){},this._calc.destroy(),rc(this._sharedClockBusToken),this.domChangeDetector.destroy();function t(n){__dcg_shared_module_exports__['g'].warn("You've destroyed this API instance. You can no longer call ."+n+"()")}let o={},i=this;for(;i;)Object.getOwnPropertyNames(i).forEach(a=>o[a]=!0),i=Object.getPrototypeOf(i);for(let n in o)typeof this[n]=="function"?this[n]=t.bind(this,n):this.hasOwnProperty(n)&&delete this[n];this.destroy=function(){},this._destroyed=!0}withHistoryReplacement(t){try{this.controller.pushWithHistoryReplacement(),t()}finally{this.controller.popWithHistoryReplacement()}}withControllerInAPIMode(t){try{return this.controller.pushAPIMethodCall(),t()}finally{this.controller.popAPIMethodCall()}}_syncGraphpaperBounds(){return this.withControllerInAPIMode(()=>{this.controller.runAfterDispatch(()=>{this.setProperty("graphpaperBounds",{mathCoordinates:this._calc.graphpaperBounds.mathCoordinates,pixelCoordinates:this._calc.graphpaperBounds.pixelCoordinates})})})}observeEvent(t,o){return this._eventBus.observeEvent(t,o)}unobserveEvent(t){this._eventBus.unobserveEvent(t)}_initGraphSettings(){return this.withControllerInAPIMode(()=>{let t=new Hs;this.settings=this.graphSettings=t,Uq.forEach(o=>{this._calc.grapher.settings.observeAndSync(o,()=>{this.controller.runAfterDispatch(()=>{t.setProperty(o,this._calc.grapher.settings[o])})})}),d$.forEach(o=>{this._calc.grapher.settings.config.observeAndSync(o,()=>{this.controller.runAfterDispatch(()=>{t.setProperty(o,this._calc.grapher.settings.config[o])})})})})}updateSettings(t){return this.withControllerInAPIMode(()=>{let o=Qee(t,!1),i=o.configOptions,n=o.settingsOptions;__dcg_shared_module_exports__['K'](i)||this._calc.setOptions(i),__dcg_shared_module_exports__['K'](n)||this.controller.dispatch({type:"set-graph-settings",...this.controller.getGraphSettings().validateSettings(n)}),this.notifyControllerOfAPICall()})}setGraphSettings(t){return this.withControllerInAPIMode(()=>{__dcg_shared_module_exports__['g'].warn("As of API v0.8 the 'setGraphSettings' method is deprecated and has been renamed 'updateSettings.'"),this.updateSettings(t),this.setGraphSettings=this.updateSettings,this.notifyControllerOfAPICall()})}setDefaultState(t){return this.withControllerInAPIMode(()=>{this._calc.grapher.settings.setProperty("defaultState",t),this.notifyControllerOfAPICall()})}mathToPixels(t){return this.withControllerInAPIMode(()=>{let o=__dcg_shared_module_exports__['Nd'].fromRects(this.graphpaperBounds.mathCoordinates,this.graphpaperBounds.pixelCoordinates,{xAxisScale:this._calc.grapher.settings.xAxisScale,yAxisScale:this._calc.grapher.settings.yAxisScale});return Zee(o,t)})}pixelsToMath(t){return this.withControllerInAPIMode(()=>{let o=__dcg_shared_module_exports__['Nd'].fromRects(this.graphpaperBounds.mathCoordinates,this.graphpaperBounds.pixelCoordinates,{xAxisScale:this._calc.grapher.settings.xAxisScale,yAxisScale:this._calc.grapher.settings.yAxisScale}).inverse();return Zee(o,t)})}notifyControllerOfAPICall(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"render"})})}setExpression(t){return this.withControllerInAPIMode(()=>{let i=this.controller.getItemModel(t.id),n=i&&i.type,a=MG(t,n,this.controller);if(a)if(n)this.controller.dispatch({type:"set-expression-properties-from-api",id:a.id,properties:a});else{if(a.type==="image")return;this.controller.dispatch({type:"add-item-to-end-from-api",state:a})}})}setExpressions(t){return this.withControllerInAPIMode(()=>{t.forEach(this.setExpression.bind(this))})}removeExpression(t){return this.withControllerInAPIMode(()=>{let o=t.id.toString();this.controller.dispatch({type:"remove-item-by-id",id:o})})}removeExpressions(t){return this.withControllerInAPIMode(()=>{t.forEach(this.removeExpression.bind(this))})}removeSelected(){return this.withControllerInAPIMode(()=>{let t=this.controller.getSelectedItem();if(!t)return;let{id:o}=t;return this.controller.dispatch({type:"remove-item-by-id",id:o}),o})}setMathBounds(t){return this.withControllerInAPIMode(()=>{var u,h,m,y;let o=t,i=(u=o.xmin)!=null?u:o.left,n=(h=o.xmax)!=null?h:o.right,a=(m=o.ymin)!=null?m:o.bottom,s=(y=o.ymax)!=null?y:o.top,{zmin:l,zmax:c}=o,d,p;l===void 0&&c===void 0?(d=!0,p=!1):l===void 0||c===void 0?(d=!1,p=!0):(d=l<c,p=!0),i<n&&a<s&&d?(this._calc.setViewport({xmin:i,xmax:n,ymin:a,ymax:s,zmin:l,zmax:c}),this._calc.controller.unmarkLastChangedAxis(),this._calc.controller.markSquareAxesAfterUserEditedViewport()):__dcg_shared_module_exports__['g'].warn("Invalid bounds argument. "+p?"Expected a bounds object with bounds.xmin < bounds.xmax, bounds.ymin < bounds.ymax, and bounds.zmin < bounds.zmax. ":"Expected a bounds object with bounds.xmin < bounds.xmax, and bounds.ymin < bounds.ymax. Got "+JSON.stringify(t)),this.notifyControllerOfAPICall()})}setViewport(t){let[o,i,n,a]=t;return this.withControllerInAPIMode(()=>{t.length==4&&t[1]>t[0]&&t[3]>t[2]?(this._calc.setViewport({xmin:o,xmax:i,ymin:n,ymax:a}),this._calc.controller.markSquareAxesAfterUserEditedViewport()):__dcg_shared_module_exports__['g'].warn("Invalid viewport.  Expected [xmin, xmax, ymin, ymax].  Got "+t),this.notifyControllerOfAPICall()})}resize(){return this.withControllerInAPIMode(()=>{this.domChangeDetector.checkForChanges()})}getState(t){return this.withControllerInAPIMode(()=>this.controller.getState(t))}getExpressions(){return this.withControllerInAPIMode(()=>this.getState({stripDefaults:!1}).expressions.list.map(IG))}setBlank(t){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"set-blank",opts:t||{}})})}setState(t,o){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"set-state",state:t,opts:o||{}})})}undo(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"undo"})})}redo(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"redo"})})}clearHistory(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"clear-undoredo-history"})})}getHistory(){return this.withControllerInAPIMode(()=>this.controller.getHistory())}restoreHistory(t){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"restore-history",history:t})})}newRandomSeed(){return this.withControllerInAPIMode(()=>{this.updateSettings({randomSeed:eu()})})}screenshot(t){return this.withControllerInAPIMode(()=>(t||(t={}),t=this._validateBrailleScreenshotOptions(t),this._calc.grapher.screenshot(t)))}_getMathAspectRatio(){return this.withControllerInAPIMode(()=>{let t=this.graphpaperBounds.mathCoordinates,o=this._calc.grapher.getProjection().pixelCoordinates,i=o.right-o.left,n=o.bottom-o.top,a=t.width/i,s=t.height/n;return a/s})}isProjectionUniform(){return this.withControllerInAPIMode(()=>!!this._calc.grapher.getProjection().settings.squareAxes)}_validateBrailleScreenshotOptions(t){return this.withControllerInAPIMode(()=>{t=__dcg_shared_module_exports__['i'](t);let o=t.braille;if(o){let i=o.embosserModel;if(!i)return __dcg_shared_module_exports__['g'].warn("Screenshot braille options requires an embosser model to be specified. "),__dcg_shared_module_exports__['g'].warn("Continuing with non-braille screenshot."),delete t.braille,t;if(i==="etc"&&(o.embosserModel="etc11"),i==="vpmax"&&(o.embosserModel="vpmax11"),o.embosserModel!=="etc8"&&o.embosserModel!=="etc11"&&o.embosserModel!=="vpmax8"&&o.embosserModel!=="vpmax11")return __dcg_shared_module_exports__['g'].warn('Unknown screenshot braille embosser model. Valid models are "etc" and "vpmax".'),__dcg_shared_module_exports__['g'].warn("Continuing with non-braille screenshot."),delete t.braille,t;o.brailleMode!=="nemeth"&&o.brailleMode!=="ueb"&&(__dcg_shared_module_exports__['g'].warn("Screenshot options braille.brailleMode must be nemeth or ueb. Proceeding with nemeth."),o.brailleMode="nemeth"),t.width&&(__dcg_shared_module_exports__['g'].warn("Screenshot width option is ignored when exporting Braille."),delete t.width),t.height&&(__dcg_shared_module_exports__['g'].warn("Screenshot height option is ignored when exporting Braille."),delete t.height),t.targetPixelRatio&&(__dcg_shared_module_exports__['g'].warn("Screenshot targetPixelRatio option is ignored when exporting Braille."),delete t.targetPixelRatio),t.preserveAxisNumbers&&(__dcg_shared_module_exports__['g'].warn("Screenshot preserveAxisNumbers option is ignored when exporting Braille."),delete t.preserveAxisNumbers)}return t})}_validateAsyncScreenshotOpts(t){return this.withControllerInAPIMode(()=>{t=__dcg_shared_module_exports__['i'](t);let o=t.mode||(this.controller.getGraphSettings().squareAxes?"preserveX":"stretch"),i=t.width||t.height||this.graphpaperBounds.pixelCoordinates.width,n=t.height||t.width||this.graphpaperBounds.pixelCoordinates.height,a=t.targetPixelRatio||1;a<1&&(a=1);let s=t.preserveAxisNumbers;t.hasOwnProperty("format")||(t.svg?(t.format="svg",delete t.svg):t.format="png");let l=t.mathBounds||{},c=this._getMathAspectRatio(),d=this.graphpaperBounds.pixelCoordinates.width/this.graphpaperBounds.pixelCoordinates.height,p=n$({mode:o,width:i,height:n,currentBounds:this.graphpaperBounds.mathCoordinates,graphpaperAspectRatio:d,mathAspectRatio:c,mathBounds:l});return{opts:{...t,width:i,height:n,targetPixelRatio:a,preserveAxisNumbers:s},mathBounds:p}})}asyncScreenshot(...t){var n;if(!t.length){__dcg_shared_module_exports__['g'].warn("asyncScreenshot expects a callback");return}let o,i;if(t.length===1)if(typeof t[0]!="function"){__dcg_shared_module_exports__['g'].warn("asyncScreenshot expects a callback");return}else i=t[0],o={};else i=t[1],o=(n=t[0])!=null?n:{};return this.withControllerInAPIMode(()=>{o=this._validateBrailleScreenshotOptions(o);let{opts:a,mathBounds:s}=this._validateAsyncScreenshotOpts(o);tte.push({api:this,options:a,mathBounds:s,state:this.getState(),callback:i}),rte(this.constructor)})}setOptions(t){return this.withControllerInAPIMode(()=>{let o=this._calc.setOptions(t);return this.notifyControllerOfAPICall(),o})}focusFirstExpression(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"focus-first-expression"})})}openKeypad(){return this.withControllerInAPIMode(()=>{this.controller.dispatch({type:"keypad/set-minimized",minimized:!1})})}HelperExpression(t){return this.withControllerInAPIMode(()=>{let o=(t==null?void 0:t.latex)||"",i=new Hs({latex:o});return this.controller.dispatch({type:"add-helper-expression",state:{type:"helper-expression",id:this.controller.generateId(),latex:o,proxy:i}}),i})}getHelperExpressions(){return this.withControllerInAPIMode(()=>this.controller.getHelperExpressions())}};var Ju=class extends Yd{constructor(e,t,o){super(e,{...t,product:"graphing"},o)}};$t();var xg=re(document.body).data("load-data");var ote=["i18nKey","title","thumbURL","stateURL","hash","parentHash","recovery","recoveryParentHash","graphData","created","example","draft","easterEgg","isMigratedFromLegacyGeometry","questHash"],Da=class r extends Hs{constructor(t){super();this.isMigratedFromLegacyGeometry=!1;t&&ote.forEach(o=>{t.hasOwnProperty(o)&&this.setProperty(o,t[o])}),this.example||this.setProperty("example",!1),this.draft||this.setProperty("draft",!1),this.now=new Date}copy(){return new r(this)}getCollectionKey(){let t="";return this.example?t="example-":this.draft&&(t="draft-"),t+this.hash}displayDate(){let i=(Date.now()-this.created.getTime())/1e3/60,n=i/60,a=n/24,s=a/7,l=[__dcg_shared_module_exports__['$']("account-shell-label-month-jan"),__dcg_shared_module_exports__['$']("account-shell-label-month-feb"),__dcg_shared_module_exports__['$']("account-shell-label-month-mar"),__dcg_shared_module_exports__['$']("account-shell-label-month-apr"),__dcg_shared_module_exports__['$']("account-shell-label-month-may"),__dcg_shared_module_exports__['$']("account-shell-label-month-jun"),__dcg_shared_module_exports__['$']("account-shell-label-month-jul"),__dcg_shared_module_exports__['$']("account-shell-label-month-aug"),__dcg_shared_module_exports__['$']("account-shell-label-month-sep"),__dcg_shared_module_exports__['$']("account-shell-label-month-oct"),__dcg_shared_module_exports__['$']("account-shell-label-month-nov"),__dcg_shared_module_exports__['$']("account-shell-label-month-dec")];return s>=5?__dcg_shared_module_exports__['$']("account-shell-label-created-on-date",{month:l[this.created.getMonth()],day:this.created.getDate(),year:this.created.getFullYear()}):s>=2?__dcg_shared_module_exports__['$']("account-shell-label-created-weeks-ago",{number:String(Math.floor(s))}):a>=7?__dcg_shared_module_exports__['$']("account-shell-label-created-last-week"):a>=2?__dcg_shared_module_exports__['$']("account-shell-label-created-days-ago",{number:String(Math.floor(a))}):n>=24?__dcg_shared_module_exports__['$']("account-shell-label-created-yesterday"):n>=2?__dcg_shared_module_exports__['$']("account-shell-label-created-hours-ago",{number:String(Math.floor(n))}):i>=60?__dcg_shared_module_exports__['$']("account-shell-label-created-one-hour-ago"):i>=2?__dcg_shared_module_exports__['$']("account-shell-label-created-minutes-ago",{number:String(Math.floor(i))}):i>=1?__dcg_shared_module_exports__['$']("account-shell-label-created-one-minute-ago"):__dcg_shared_module_exports__['$']("account-shell-label-created-seconds-ago")}plainObject(){let t={};return ote.forEach(o=>{t[o]=this[o]}),t}getFullTopLevelURL(){let t;if(window.location.protocol==="file:"){let o="/calculator";if(!mb())return o;t=mb()+o}else{let o="/"+document.location.pathname.split("/")[1];t=window.location.href.split(o)[0]+o}return t}getURL(){return this.getFullTopLevelURL()+(this.hash?"/"+this.hash:"")}static fromAjax(t){return new r({i18nKey:t.i18nKey,title:t.title,thumbURL:t.thumbUrl,stateURL:t.stateUrl,graphData:t.state,hash:t.hash,parentHash:t.parent_hash,recoveryParentHash:t.recovery_parent_hash,created:new Date(t.created),example:!!t.example,draft:!!t.draft,easterEgg:t.easterEgg,isMigratedFromLegacyGeometry:!!t.isMigratedFromLegacyGeometry})}static toAjax(t){return{title:t.title,thumbUrl:t.thumbURL,stateUrl:t.stateURL,state:t.graphData,hash:t.hash,parent_hash:t.parentHash,recovery_parent_hash:t.recoveryParentHash,created:t.created.toString(),isMigratedFromLegacyGeometry:t.isMigratedFromLegacyGeometry}}static updateFromSync(t,o){t.setProperty("title",o.title),t.setProperty("hash",o.hash),t.setProperty("parentHash",o.parent_hash),t.setProperty("recoveryParentHash",o.recovery_parent_hash),t.setProperty("graphData",t.graphData),t.setProperty("thumbURL",o.thumbUrl),t.setProperty("stateURL",o.stateUrl),t.setProperty("created",new Date(o.created)),t.setProperty("questHash",o.questHash)}};var ite=`[
  {
    "hash": "2rnqgoa6a4",
    "parent_hash": "89ndqgh5id",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/2rnqgoa6a4.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/2rnqgoa6a4",
    "title": "Lines: Slope Intercept Form",
    "access": "link",
    "created": "2015-08-18T19:24:05.378Z",
    "i18nKey": "graphing-calculator-label-example-graph-lines-slope-intercept-form",
    "example": true
  },
  {
    "hash": "onfy0dzx2o",
    "parent_hash": "kha6fgxhaf",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/onfy0dzx2o.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/onfy0dzx2o",
    "title": "Lines: Point Slope Form",
    "access": "link",
    "created": "2015-08-18T20:21:16.780Z",
    "i18nKey": "graphing-calculator-label-example-graph-lines-point-slope-form",
    "example": true
  },
  {
    "hash": "md6buy4efz",
    "parent_hash": "fi71u8ej0q",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/md6buy4efz.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/md6buy4efz",
    "title": "Lines: Two Point Form",
    "access": "link",
    "created": "2015-08-18T20:21:39.575Z",
    "i18nKey": "graphing-calculator-label-example-graph-lines-two-point-form",
    "example": true
  },
  {
    "hash": "zukjgk9iry",
    "parent_hash": "jv9fmw2qz8",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/zukjgk9iry.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/zukjgk9iry",
    "title": "Parabolas: Standard Form",
    "access": "link",
    "created": "2015-08-18T20:22:02.411Z",
    "i18nKey": "graphing-calculator-label-example-graph-parabolas-standard-form",
    "example": true
  },
  {
    "hash": "8keeh1pt5l",
    "parent_hash": "klodq5d0ph",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/8keeh1pt5l.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/8keeh1pt5l",
    "title": "Parabolas: Vertex Form",
    "access": "link",
    "created": "2015-08-18T20:22:22.626Z",
    "i18nKey": "graphing-calculator-label-example-graph-parabolas-vertex-form",
    "example": true
  },
  {
    "hash": "dxkknajdqb",
    "parent_hash": "t6auzqijzl",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/dxkknajdqb.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/dxkknajdqb",
    "title": "Parabolas: Standard Form + Tangent",
    "access": "link",
    "created": "2015-08-18T20:24:05.891Z",
    "i18nKey": "graphing-calculator-label-example-graph-parabolas-standard-form-plus-tangent",
    "example": true
  },
  {
    "hash": "kihjluohq9",
    "parent_hash": "vpnnmvncdb",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/kihjluohq9.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/kihjluohq9",
    "title": "Trigonometry: Period and Amplitude",
    "access": "link",
    "created": "2015-08-18T20:24:32.570Z",
    "i18nKey": "graphing-calculator-label-example-graph-trig-period-and-amplitude",
    "example": true
  },
  {
    "hash": "l3u8133jwj",
    "parent_hash": "51d9lso1ia",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/l3u8133jwj.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/l3u8133jwj",
    "title": "Trigonometry: Phase",
    "access": "link",
    "created": "2015-08-18T20:24:53.936Z",
    "i18nKey": "graphing-calculator-label-example-graph-trig-phase",
    "example": true
  },
  {
    "hash": "7eeumgl7it",
    "parent_hash": "7rnv0erick",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/7eeumgl7it.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/7eeumgl7it",
    "title": "Trigonometry: Wave Interference",
    "access": "link",
    "created": "2019-12-03T18:14:54.000Z",
    "i18nKey": "graphing-calculator-label-example-graph-trig-wave-interference",
    "example": true
  },
  {
    "hash": "qmzx2skkzy",
    "parent_hash": "s9myfmvujr",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qmzx2skkzy.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qmzx2skkzy",
    "title": "Trigonometry: Unit Circle",
    "access": "link",
    "created": "2015-08-18T20:26:18.276Z",
    "i18nKey": "graphing-calculator-label-example-graph-trig-unit-circle",
    "example": true
  },
  {
    "hash": "ivud1auwvw",
    "parent_hash": "8dsmqe5ycc",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/ivud1auwvw.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/ivud1auwvw",
    "title": "Conic Sections: Circle",
    "access": "link",
    "created": "2015-08-18T20:27:04.445Z",
    "i18nKey": "graphing-calculator-label-example-graph-conic-sections-circle",
    "example": true
  },
  {
    "hash": "djcrjdfiif",
    "parent_hash": "0jwlvn9hcs",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/djcrjdfiif.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/djcrjdfiif",
    "title": "Conic Sections: Parabola and Focus",
    "access": "link",
    "created": "2015-08-18T20:27:50.487Z",
    "i18nKey": "graphing-calculator-label-example-graph-conic-sections-parabola-and-focus",
    "example": true
  },
  {
    "hash": "afja7ee9mh",
    "parent_hash": "duajwxdopa",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/afja7ee9mh.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/afja7ee9mh",
    "title": "Conic Sections: Ellipse with Foci",
    "access": "link",
    "created": "2015-08-18T20:28:08.499Z",
    "i18nKey": "graphing-calculator-label-example-graph-conic-sections-ellipse-with-foci",
    "example": true
  },
  {
    "hash": "vgfqbejegx",
    "parent_hash": "k6xcbueze5",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/vgfqbejegx.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/vgfqbejegx",
    "title": "Conic Sections: Hyperbola",
    "access": "link",
    "created": "2015-08-18T20:28:27.874Z",
    "i18nKey": "graphing-calculator-label-example-graph-conic-sections-hyperbola",
    "example": true
  },
  {
    "hash": "0ovfwwmfrb",
    "parent_hash": "scuci1750d",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/0ovfwwmfrb.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/0ovfwwmfrb",
    "title": "Polar: Rose",
    "access": "link",
    "created": "2015-08-18T20:28:48.832Z",
    "i18nKey": "graphing-calculator-label-example-graph-polar-rose",
    "example": true
  },
  {
    "hash": "qlbdlxyrza",
    "parent_hash": "nicremwert",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qlbdlxyrza.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qlbdlxyrza",
    "title": "Polar: Logarithmic Spiral",
    "access": "link",
    "created": "2015-08-18T20:29:08.282Z",
    "i18nKey": "graphing-calculator-label-example-graph-polar-logarithmic-spiral",
    "example": true
  },
  {
    "hash": "rayzacuktw",
    "parent_hash": "21pbohd07u",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/rayzacuktw.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/rayzacuktw",
    "title": "Polar: Limacon",
    "access": "link",
    "created": "2015-08-18T20:29:25.878Z",
    "i18nKey": "graphing-calculator-label-example-graph-polar-limacon",
    "example": true
  },
  {
    "hash": "gxnu7fbgks",
    "parent_hash": "kk3axf8oon",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/gxnu7fbgks.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/gxnu7fbgks",
    "title": "Polar: Conic Sections",
    "access": "link",
    "created": "2015-08-18T20:29:42.487Z",
    "i18nKey": "graphing-calculator-label-example-graph-polar-conic-sections",
    "example": true
  },
  {
    "hash": "rnyjcjpouf",
    "parent_hash": "ogvj2tzgjj",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/rnyjcjpouf.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/rnyjcjpouf",
    "title": "Parametric: Introduction",
    "access": "link",
    "created": "2015-08-18T20:30:31.353Z",
    "i18nKey": "graphing-calculator-label-example-graph-parametric-introduction",
    "example": true
  },
  {
    "hash": "eg5he4xpg9",
    "parent_hash": "pwjl3pe4da",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/eg5he4xpg9.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/eg5he4xpg9",
    "title": "Parametric: Cycloid",
    "access": "link",
    "created": "2015-08-18T20:30:46.372Z",
    "i18nKey": "graphing-calculator-label-example-graph-parametric-cycloid",
    "example": true
  },
  {
    "hash": "nyterjs0uf",
    "parent_hash": "nqxx2mhknn",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/nyterjs0uf.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/nyterjs0uf",
    "title": "Transformations: Translating a Function",
    "access": "link",
    "created": "2017-09-29T00:47:36.436Z",
    "i18nKey": "graphing-calculator-label-example-graph-transformations-translating-a-function",
    "example": true
  },
  {
    "hash": "vdkjrpznnu",
    "parent_hash": "doxva7ciht",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/vdkjrpznnu.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/vdkjrpznnu",
    "title": "Transformations: Scaling a Function",
    "access": "link",
    "created": "2015-08-18T21:23:20.484Z",
    "i18nKey": "graphing-calculator-label-example-graph-transformations-scaling-a-function",
    "example": true
  },
  {
    "hash": "fcjhdt1xdw",
    "parent_hash": "tif5liedlj",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/fcjhdt1xdw.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/fcjhdt1xdw",
    "title": "Transformations: Inverse of a Function",
    "access": "link",
    "created": "2015-08-18T21:23:36.776Z",
    "i18nKey": "graphing-calculator-label-example-graph-transformations-inverse-of-a-function",
    "example": true
  },
  {
    "hash": "jwquvmikhr",
    "parent_hash": "2l0r87hkmq",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/jwquvmikhr.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/jwquvmikhr",
    "title": "Statistics: Linear Regression",
    "access": "link",
    "created": "2015-08-18T21:24:01.998Z",
    "i18nKey": "graphing-calculator-label-example-graph-stats-linear-regression",
    "example": true
  },
  {
    "hash": "qrdbrcfnsl",
    "parent_hash": "paknt6oneh",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qrdbrcfnsl.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qrdbrcfnsl",
    "title": "Statistics: Anscombe's Quartet",
    "access": "link",
    "created": "2020-07-13T20:40:16.000Z",
    "i18nKey": "graphing-calculator-label-example-graph-stats-anscombes-quartet",
    "example": true
  },
  {
    "hash": "sanlujpfmc",
    "parent_hash": "tyszvsmelo",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/sanlujpfmc.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/sanlujpfmc",
    "title": "Statistics: 4th Order Polynomial",
    "access": "link",
    "created": "2015-08-18T21:25:02.018Z",
    "i18nKey": "graphing-calculator-label-example-graph-stats-fourth-order-polynomial",
    "example": true
  },
  {
    "hash": "iwfjdrhdyr",
    "parent_hash": "4n11jtzki0",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/iwfjdrhdyr.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/iwfjdrhdyr",
    "title": "Lists: Family of sin Curves",
    "access": "link",
    "created": "2015-08-18T21:25:30.069Z",
    "i18nKey": "graphing-calculator-label-example-graph-lists-family-of-sin-curves",
    "example": true
  },
  {
    "hash": "ib4qkln029",
    "parent_hash": "1flkupc1yt",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/ib4qkln029.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/ib4qkln029",
    "title": "Lists: Curve Stitching",
    "access": "link",
    "created": "2016-05-05T06:33:59.891Z",
    "i18nKey": "graphing-calculator-label-example-graph-lists-curve-stitching",
    "example": true
  },
  {
    "hash": "zdv2kras4n",
    "parent_hash": "fqhp5hq3ka",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/zdv2kras4n.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/zdv2kras4n",
    "title": "Lists: Plotting a List of Points",
    "access": "link",
    "created": "2015-08-18T21:27:01.962Z",
    "i18nKey": "graphing-calculator-label-example-graph-lists-plotting-a-list-of-points",
    "example": true
  },
  {
    "hash": "qtzamwcdrk",
    "parent_hash": "aqgbwm3qfd",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qtzamwcdrk.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qtzamwcdrk",
    "title": "Calculus: Derivatives",
    "access": "link",
    "created": "2015-08-18T21:27:17.187Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-derivatives",
    "example": true
  },
  {
    "hash": "mekfho0w38",
    "parent_hash": "irip8pnpdf",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/mekfho0w38.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/mekfho0w38",
    "title": "Calculus: Secant Line",
    "access": "link",
    "created": "2015-08-18T21:27:32.274Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-secant-line",
    "example": true
  },
  {
    "hash": "fs3lx8gptb",
    "parent_hash": "dlzhsldcgo",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/fs3lx8gptb.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/fs3lx8gptb",
    "title": "Calculus: Tangent Line",
    "access": "link",
    "created": "2015-08-18T21:27:46.455Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-tangent-line",
    "example": true
  },
  {
    "hash": "noanuckuli",
    "parent_hash": "gkjridbqfj",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/noanuckuli.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/noanuckuli",
    "title": "Calculus: Taylor Expansion of sin(x)",
    "access": "link",
    "created": "2015-08-18T21:28:02.855Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-taylor-expansion-of-sin-x",
    "example": true
  },
  {
    "hash": "qigfpckugc",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qigfpckugc.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qigfpckugc",
    "title": "Calculus: Integrals",
    "access": "link",
    "created": "2016-04-19T14:03:33.013Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-integrals",
    "example": true
  },
  {
    "hash": "u2qz73ufju",
    "parent_hash": "o3pwn3vkgh",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/u2qz73ufju.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/u2qz73ufju",
    "title": "Calculus: Integral with adjustable bounds",
    "access": "link",
    "created": "2016-04-19T14:12:40.336Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-integral-with-adjustable-bounds",
    "example": true
  },
  {
    "hash": "gaa5aqyb5s",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/gaa5aqyb5s.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/gaa5aqyb5s",
    "title": "Calculus: Fundamental Theorem of Calculus",
    "access": "link",
    "created": "2016-04-19T14:15:45.211Z",
    "i18nKey": "graphing-calculator-label-example-graph-calculus-fundamental-theorem-of-calculus",
    "example": true
  },
  {
    "hash": "8hxtdephtf",
    "parent_hash": "xova2bfhj5",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/8hxtdephtf.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/8hxtdephtf",
    "title": "hungry pac-man",
    "access": "link",
    "created": "2015-04-20T14:47:01.468Z",
    "i18nKey": "graphing-calculator-label-example-graph-pac-man",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "qbaliml2om",
    "parent_hash": "8mmk4hrmqg",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/qbaliml2om.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/qbaliml2om",
    "title": "PRIDE flag",
    "access": "link",
    "created": "2021-06-02T01:46:57.000Z",
    "i18nKey": "graphing-calculator-label-example-graph-pride-flag",
    "example": true,
    "easterEgg": "pride"
  },
  {
    "hash": "ieellz6qbr",
    "parent_hash": "velayq9vsr",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/ieellz6qbr.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/ieellz6qbr",
    "title": "PRIDE flag",
    "access": "link",
    "created": "2021-06-02T01:51:23.000Z",
    "i18nKey": "graphing-calculator-label-example-graph-pride-flag",
    "example": true,
    "easterEgg": "pride"
  },
  {
    "hash": "dhzndt8brx",
    "parent_hash": "brei8peg52",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/dhzndt8brx.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/dhzndt8brx",
    "title": "3D World",
    "access": "link",
    "created": "2016-06-03T01:50:06.425Z",
    "i18nKey": "graphing-calculator-label-example-graph-3d-world",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "zzhx3zzlns",
    "parent_hash": "ccmfndxptv",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/zzhx3zzlns.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/zzhx3zzlns",
    "title": "Checkerboard Inversion",
    "access": "link",
    "created": "2016-06-02T22:06:08.277Z",
    "i18nKey": "graphing-calculator-label-example-graph-checkerboard-inversion",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "c1u72uowae",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/c1u72uowae.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/c1u72uowae",
    "title": "kiavash graph of awesomeness",
    "access": "link",
    "created": "2013-08-18T06:25:20.605Z",
    "i18nKey": "graphing-calculator-label-example-graph-regular-sine-wave",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "2mwse3jtff",
    "parent_hash": "msmdonti4c",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/2mwse3jtff.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/2mwse3jtff",
    "title": "Fastest path to point",
    "access": "link",
    "created": "2016-06-02T22:02:44.839Z",
    "i18nKey": "graphing-calculator-label-example-graph-fastest-path-to-a-point",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "8ytrg3nyln",
    "parent_hash": "d7qrsg2hxg",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/8ytrg3nyln.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/8ytrg3nyln",
    "title": "Fireworks!",
    "access": "link",
    "created": "2016-06-03T01:50:52.464Z",
    "i18nKey": "graphing-calculator-label-example-graph-fireworks",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "9ed6k6wexp",
    "parent_hash": "9ed6k6wexp",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/9qixqdozzh.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/9ed6k6wexp",
    "title": "Sierpinski Valentine",
    "access": "link",
    "created": "2015-02-14T18:42:18.283Z",
    "i18nKey": "graphing-calculator-label-example-graph-fractal-valentine",
    "example": true,
    "easterEgg": "betchacant"
  },
  {
    "hash": "am6ab20tmw",
    "parent_hash": "hvycjwscfq",
    "thumbUrl": "https://www.desmos.com/calc_thumbs/production/am6ab20tmw.png",
    "stateUrl": "https://www.desmos.com/calc-states/production/am6ab20tmw",
    "title": "Outstretched Arm",
    "access": "link",
    "created": "2016-06-03T01:45:50.594Z",
    "i18nKey": "graphing-calculator-label-example-graph-outstretched-arm",
    "example": true,
    "easterEgg": "betchacant"
  }
]
`;tu();Xa();var Sxe=1;function co(r){fL&&Exe(r)}var fL=!1;function g5(){fL=!0}function Exe(r){var t,o;if(!fL)return;let e=["trackEvent",r.category,r.action,r.name,r.value];ji("testing")?(t=window.paqTest)==null||t.push(e):(o=window._paq)==null||o.push(e)}var nte;function KE(){if(!fL)return;let r=document.location.href,e=document.referrer,t=window._paq=window._paq||[];nte!==r&&(nte=r,ji("testing")||(t==null||t.push(["setReferrerUrl",e]),t==null||t.push(["setDocumentTitle",window.document.title]),t==null||t.push(["setCustomDimension",Sxe,window.location!==window.parent.location]),t==null||t.push(["trackPageView"])))}function m5(r=window.location.pathname){let e=r.split("/");return e.length>1?`/${e[1]}`:"/"}var vl={},Xd=Lz(),Dxe={sciKeypad:1,"4fnKeypad":1,singleExpression:1,restrictedEditing:1,degreeMode:1,decimalToFraction:1};typeof kiavash!="undefined"&&kiavash.config&&Object.keys(Dxe).forEach(r=>{kiavash.config[r]&&Xd.set(r,"true"),vl[r]=kiavash.config[r]});var x1=function(r){return ji(r,Xd)},Rr=function(r){vl[r]=x1(r)},ri=function(r){vl[r]=!x1(`no${r}`)};Rr("testing");Rr("maintenance");Rr("disableScrollFix");Rr("nativeOnscreenKeypad");Rr("hidden");Rr("disableMouseInteractions");Rr("advancedStyling");Rr("outofdom");Rr("beta3d");Xd.has("cacheRenderedSvgs")&&(vl.cacheRenderedSvgs=!0);var kxe=["lang","fontSize","translucentOpacity","peelUpsample","debugScale","debugPeelLayers","debug3dRender","debugPixelRatio","recursionDepthLimit"];kxe.forEach(r=>{Xd.has(r)&&(vl[r]=Xd.get(r))});Xd.has("backgroundColor")&&(vl.backgroundColor="#"+Xd.get("backgroundColor"));Xd.has("textColor")&&(vl.textColor="#"+Xd.get("textColor"));Rr("lockViewport");Rr("authorFeatures");Rr("degreeMode");Rr("clearIntoDegreeMode");Rr("plaidMode");Rr("wireframe");Rr("editOnWeb");Rr("crossOriginSaveTest");Rr("showResetButtonOnGraphpaper");Rr("debugProgressUpdates");Rr("transparentBackground");Rr("forceLogModeRegressions");Rr("defaultLogModeRegressions");Rr("reflectionArc");Rr("logInternalErrors");ri("links");ri("trace");ri("zoomFit");Rr("expressionsCollapsed");Rr("invertedColors");Rr("projectorMode");ri("images");ri("folders");ri("settingsMenu");ri("expressionsTopbar");ri("zoomButtons");ri("keypad");ri("graphpaper");ri("expressions");ri("branding");ri("pointsOfInterest");ri("plotSingleVariableImplicitEquations");ri("plotImplicits");ri("plotInequalities");ri("notes");ri("sliders");Rr("pauseWhenOffscreen");ri("brailleControls");Rr("audioTraceKeypad");Rr("audioTraceSimult");ri("audio");ri("qwertyKeyboard");Rr("restrictedFunctions");Rr("forceEnableGeometryFunctions");ri("functionDefinition");Rr("singleExpression");Rr("restrictedEditing");Rr("replaceCommaWith10Exp");Rr("replaceRoundWithReciprocal");x1("typingAsteriskWritesTimesSymbol")&&(vl.typingAsteriskWritesTimesSymbol=!0);ri("substitutions");ri("intervalComprehensions");ri("recursion");ri("logScales");ri("tableRegressions");ri("distributions");vl["4fnKeypad"]?Rr("decimalToFraction"):ri("decimalToFraction");Rr("translucentSurfaces");Rr("3d");Rr("disableWorkerOnZoom");Rr("disableLighting");Rr("showPerformanceMeter");Rr("peelFloatTexture");ri("adaptivePeeling");Rr("complex");ri("allowComplex");ri("customRegressions");var ate;Xd.has("additionalFunctions")&&(vl.additionalFunctions=(ate=Xd.get("additionalFunctions"))==null?void 0:ate.split(","));Xd.has("disableParentheses")&&(vl.disableParentheses=!0);x1("actions")?vl.actions=!0:x1("noactions")?vl.actions=!1:x1("clickableObjects")&&(vl.actions=!0);function wg(r){return vl[r]}function ste(){return __dcg_shared_module_exports__['i'](vl)}var f5={};__dcg_shared_module_exports__['d'](f5,{expressionCount:()=>Axe,expressionErrors:()=>Rxe,folderCount:()=>Vxe,hasAction:()=>Gxe,hasCustomColors:()=>Mxe,hasMovablePoints:()=>Ixe,hasRegression:()=>Txe,hasSlider:()=>_xe,imageCount:()=>Lxe,tableCount:()=>Pxe,textCount:()=>Oxe});function _xe(r){return r.getAllModelsWithSliders().length>0}function Txe(r){for(let e of r.getAllItemModels())if(e.type==="expression"&&bw(e))return!0;return!1}function Gxe(r){if(r.getListModel().ticker.open)return!0;for(let e of r.getAllItemModels())if(e&&"formula"in e&&e.formula){if(e.type!=="expression"&&e.type!=="image")continue;let{formula:t}=e;if(t.hasOwnProperty("action_value")||t.hasOwnProperty("click_handler"))return!0}return!1}function Ixe(r){return r.getAllItemModels().some(e=>e.type==="expression"&&Ci(e)!=="NONE")}function Mxe(r){for(let e of r.getAllItemModels()){if(e.type!=="expression"||!Ns(e))continue;let o=r.getEvaluationValueForItem(e.id);if(typeof o=="string"||Array.isArray(o)&&typeof o[0]=="string")return!0}return!1}function Axe(r){return r.getAllItemModels().filter(e=>e.type==="expression").length}function Vxe(r){return r.getAllItemModels().filter(e=>e.type==="folder").length}function Lxe(r){return r.getAllItemModels().filter(e=>e.type==="image").length}function Pxe(r){return r.getAllItemModels().filter(e=>e.type==="table").length}function Oxe(r){return r.getAllItemModels().filter(e=>e.type==="text").length}function Rxe(r){let e=new Set;for(let t of r.getAllItemModels())t.type==="expression"&&t.error&&e.add(t.error.key);return Array.from(e)}var Fxe=50,bL=class{constructor(e,t){this.throttledFlushBatchedLogs=__dcg_shared_module_exports__['E'](async()=>{if(this.requestInFlight||this.batchedLogs.length==0)return;let e=this.batchedLogs.splice(0,Fxe);this.requestInFlight=!0;try{await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})})}catch(t){}this.requestInFlight=!1,this.throttledFlushBatchedLogs()},1e3,{leading:!1});this.batchedLogs=[],this.requestInFlight=!1,this.getSessionData=t,this.apiUrl=e}log(e){this.batchedLogs.push({...this.getSessionData(),...e}),this.throttledFlushBatchedLogs()}};var Nxe={event_type:"eventType",page_load_id:window.pageLoadId||Ld(),source:"browser",app:"knox",user_agent:navigator.userAgent},Bxe=new bL("/usage-stats",()=>Nxe);function lte(r,e){Bxe.log({event_type:r,url:document.location.href,payload:JSON.stringify(e)})}var Uxe="usage-ping",cte=15*1e3,qxe=60*1e3,zxe=60*1e3,Hxe={scientific:.03,matrix:.6,graphing:.02,"geometry-calculator":.5,fourfunction:.6,"graphing-3d":.4,"assessment-scientific":.3,"assessment-graphing":.1,"assessment-fourfunction":.5,practice:.7},$E=class{constructor(e,t={}){this.samplingInterval={current:cte,lessFrequent:qxe,moreFrequent:cte,moreFrequentPeriod:3*60*1e3};this.sampleStartTime=0;this.minutesOfMathData={lastCheckedMinutesOfMath:Date.now(),lastChangeEventTime:void 0,minutesOfMath:0};this.minutesOfMathCheckInterval=zxe;this.samplingProbability=Hxe[e],this.shouldSample=Math.random()<this.samplingProbability,this.lastConsideredTime=0,this.pageLoadTime=Date.now(),this.graphLoadTime=Date.now(),this.calcController=t.calcController,this.graphsController=t.graphsController,this.featureQueryMap={"graph-feature":[]},this.focused=document.hasFocus(),this.focused&&(this.focusIntervalStart=Date.now()),this.totalTimeFocused=0,window.addEventListener("focus",()=>{this.focused=!0,this.focusIntervalStart=Date.now()}),window.addEventListener("blur",()=>{this.focused=!1,this.addTimeFocused(),this.focusIntervalStart=void 0}),document.visibilityState==="visible"&&(this.visibleIntervalStart=Date.now()),this.totalTimeVisible=0,document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(this.addTimeVisible(),this.visibleIntervalStart=void 0):this.visibleIntervalStart=Date.now()}),this.graphsController&&this.graphsController.observeEvent("onLoadGraph",()=>{this.graphLoadTime=Date.now()}),wg("testing")&&(window.usageMonitor=this)}handleUserChangeEvent(){this.minutesOfMathData.lastChangeEventTime=Date.now(),this.getTotalMinutesOfMath()}getUsageData(){return{...this.getSharedUsageData(),...this.getGraphFeatureUsageData(),version:2}}getSharedUsageData(){let e={timeSincePageload:this.getTimeSincePageload(),totalTimeFocused:this.getTotalTimeFocused(),totalTimeVisible:this.getTotalTimeVisible(),...this.getTotalMinutesOfMath(),samplingInterval:this.samplingInterval.current,samplingProbability:this.samplingProbability};return this.graphsController&&(e.timeSinceGraphLoaded=Date.now()-this.graphLoadTime),e}getDataFromController(e,t,o){let i={};for(let n of this.featureQueryMap[e]){let a=t[n];if(!a)throw new Error(`'${n}' is not a valid feature name.`);let s=a(o);(Array.isArray(s)&&s.length>0||typeof s=="boolean"&&s||typeof s=="number")&&(i[n]=s)}return i}getGraphFeatureUsageData(){return this.getDataFromController("graph-feature",f5,this.calcController)}addTimeFocused(){if(this.focusIntervalStart===void 0)return;let e=Date.now(),t=e-this.focusIntervalStart;this.totalTimeFocused+=t,this.focusIntervalStart=e}addTimeVisible(){if(this.visibleIntervalStart===void 0)return;let e=Date.now(),t=e-this.visibleIntervalStart;this.totalTimeVisible+=t,this.visibleIntervalStart=e}getTotalTimeFocused(){return this.focused?(this.addTimeFocused(),this.totalTimeFocused):this.totalTimeFocused}getTotalTimeVisible(){return document.visibilityState==="hidden"?this.totalTimeVisible:(this.addTimeVisible(),this.totalTimeVisible)}start(){this.shouldSample&&(this.sampleStartTime=Date.now(),setInterval(()=>{if(!this.shouldSample)return;let e=Date.now();e-this.lastConsideredTime>this.samplingInterval.current&&(this.lastConsideredTime=e,this.callLogger()),this.samplingInterval.current===this.samplingInterval.moreFrequent&&e-this.sampleStartTime>this.samplingInterval.moreFrequentPeriod&&(this.samplingInterval.current=this.samplingInterval.lessFrequent)}))}callLogger(){lte(Uxe,this.getUsageData())}trackFeatureUsage(e,t){if(!this.calcController)throw new Error("Monitoring graph feature usage requires a calculator controller.");this.featureQueryMap[e].push(t)}getTimeSincePageload(){return Date.now()-this.pageLoadTime}setMinutesOfMathCheckInterval(e){this.minutesOfMathCheckInterval=e}overrideSamplingInterval(e){this.samplingInterval={...this.samplingInterval,...e}}setShouldSample(e){this.shouldSample=e,this.start()}getTotalMinutesOfMath(){var t;let e=Date.now();return(!this.minutesOfMathData.lastCheckedMinutesOfMath||e-this.minutesOfMathData.lastCheckedMinutesOfMath>=this.minutesOfMathCheckInterval)&&(((t=this.minutesOfMathData.lastChangeEventTime)!=null?t:0)>e-this.minutesOfMathCheckInterval&&(this.minutesOfMathData.minutesOfMath+=this.minutesOfMathCheckInterval*1/(60*1e3)),this.minutesOfMathData.lastCheckedMinutesOfMath=e),{minutesOfMath:this.minutesOfMathData.minutesOfMath}}};var G1=__dcg_shared_module_exports__['e'](Z());var Qd=__dcg_shared_module_exports__['e'](Z());var Dr=__dcg_shared_module_exports__['e'](Z());var Jd=__dcg_shared_module_exports__['e'](Z()),yL=class extends Jd.Class{init(){this.controller=this.props.controller()}template(){return Jd.createElement("li",{class:()=>({"dcg-list-item":!0,"dcg-text-selectable":!0,"dcg-active":this.props.validationStatus()==="validating"})},Jd.createElement("div",{class:Jd.const("dcg-quest__step-status-container")},Jd.createElement("div",{class:()=>({"dcg-quest__step-status":!0,"dcg-unvalidated":this.props.validationStatus()==="unvalidated","dcg-validating":this.props.validationStatus()==="validating","dcg-satisfied":this.props.validationStatus()==="satisfied","dcg-unsatisfied":this.props.validationStatus()==="unsatisfied"})},Jd.createElement("div",{class:Jd.const("dcg-validation-checkmark")}))),Jd.createElement("div",{class:Jd.const("dcg-quest__step-text")},this.props.title))}};var b5={};(function r(e,t,o,i){var n=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),a=typeof Path2D=="function"&&typeof DOMMatrix=="function",s=function(){if(!e.OffscreenCanvas)return!1;var q=new OffscreenCanvas(1,1),F=q.getContext("2d");F.fillRect(0,0,1,1);var ge=q.transferToImageBitmap();try{F.createPattern(ge,"no-repeat")}catch(ne){return!1}return!0}();function l(){}function c(q){var F=t.exports.Promise,ge=F!==void 0?F:e.Promise;return typeof ge=="function"?new ge(q):(q(l,l),null)}var d=function(q,F){return{transform:function(ge){if(q)return ge;if(F.has(ge))return F.get(ge);var ne=new OffscreenCanvas(ge.width,ge.height),ae=ne.getContext("2d");return ae.drawImage(ge,0,0),F.set(ge,ne),ne},clear:function(){F.clear()}}}(s,new Map),p=function(){var q=Math.floor(16.666666666666668),F,ge,ne={},ae=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(F=function(j){var oe=Math.random();return ne[oe]=requestAnimationFrame(function Y(fe){ae===fe||ae+q-1<fe?(ae=fe,delete ne[oe],j()):ne[oe]=requestAnimationFrame(Y)}),oe},ge=function(j){ne[j]&&cancelAnimationFrame(ne[j])}):(F=function(j){return setTimeout(j,q)},ge=function(j){return clearTimeout(j)}),{frame:F,cancel:ge}}(),u=function(){var q,F,ge={};function ne(ae){function j(oe,Y){ae.postMessage({options:oe||{},callback:Y})}ae.init=function(Y){var fe=Y.transferControlToOffscreen();ae.postMessage({canvas:fe},[fe])},ae.fire=function(Y,fe,ye){if(F)return j(Y,null),F;var Ce=Math.random().toString(36).slice(2);return F=c(function(De){function Ge(Ye){Ye.data.callback===Ce&&(delete ge[Ce],ae.removeEventListener("message",Ge),F=null,d.clear(),ye(),De())}ae.addEventListener("message",Ge),j(Y,Ce),ge[Ce]=Ge.bind(null,{data:{callback:Ce}})}),F},ae.reset=function(){ae.postMessage({reset:!0});for(var Y in ge)ge[Y](),delete ge[Y]}}return function(){if(q)return q;if(!o&&n){var ae=["var CONFETTI, SIZE = {}, module = {};","("+r.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{q=new Worker(URL.createObjectURL(new Blob([ae])))}catch(j){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("\u{1F38A} Could not load worker",j),null}ne(q)}return q}}(),h={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function m(q,F){return F?F(q):q}function y(q){return q!=null}function w(q,F,ge){return m(q&&y(q[F])?q[F]:h[F],ge)}function S(q){return q<0?0:Math.floor(q)}function C(q,F){return Math.floor(Math.random()*(F-q))+q}function v(q){return parseInt(q,16)}function E(q){return q.map(_)}function _(q){var F=String(q).replace(/[^0-9a-f]/gi,"");return F.length<6&&(F=F[0]+F[0]+F[1]+F[1]+F[2]+F[2]),{r:v(F.substring(0,2)),g:v(F.substring(2,4)),b:v(F.substring(4,6))}}function T(q){var F=w(q,"origin",Object);return F.x=w(F,"x",Number),F.y=w(F,"y",Number),F}function I(q){q.width=document.documentElement.clientWidth,q.height=document.documentElement.clientHeight}function P(q){var F=q.getBoundingClientRect();q.width=F.width,q.height=F.height}function O(q){var F=document.createElement("canvas");return F.style.position="fixed",F.style.top="0px",F.style.left="0px",F.style.pointerEvents="none",F.style.zIndex=q,F}function W(q,F,ge,ne,ae,j,oe,Y,fe){q.save(),q.translate(F,ge),q.rotate(j),q.scale(ne,ae),q.arc(0,0,1,oe,Y,fe),q.restore()}function X(q){var F=q.angle*(Math.PI/180),ge=q.spread*(Math.PI/180);return{x:q.x,y:q.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:q.startVelocity*.5+Math.random()*q.startVelocity,angle2D:-F+(.5*ge-Math.random()*ge),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:q.color,shape:q.shape,tick:0,totalTicks:q.ticks,decay:q.decay,drift:q.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:q.gravity*3,ovalScalar:.6,scalar:q.scalar,flat:q.flat}}function x(q,F){F.x+=Math.cos(F.angle2D)*F.velocity+F.drift,F.y+=Math.sin(F.angle2D)*F.velocity+F.gravity,F.velocity*=F.decay,F.flat?(F.wobble=0,F.wobbleX=F.x+10*F.scalar,F.wobbleY=F.y+10*F.scalar,F.tiltSin=0,F.tiltCos=0,F.random=1):(F.wobble+=F.wobbleSpeed,F.wobbleX=F.x+10*F.scalar*Math.cos(F.wobble),F.wobbleY=F.y+10*F.scalar*Math.sin(F.wobble),F.tiltAngle+=.1,F.tiltSin=Math.sin(F.tiltAngle),F.tiltCos=Math.cos(F.tiltAngle),F.random=Math.random()+2);var ge=F.tick++/F.totalTicks,ne=F.x+F.random*F.tiltCos,ae=F.y+F.random*F.tiltSin,j=F.wobbleX+F.random*F.tiltCos,oe=F.wobbleY+F.random*F.tiltSin;if(q.fillStyle="rgba("+F.color.r+", "+F.color.g+", "+F.color.b+", "+(1-ge)+")",q.beginPath(),a&&F.shape.type==="path"&&typeof F.shape.path=="string"&&Array.isArray(F.shape.matrix))q.fill(A(F.shape.path,F.shape.matrix,F.x,F.y,Math.abs(j-ne)*.1,Math.abs(oe-ae)*.1,Math.PI/10*F.wobble));else if(F.shape.type==="bitmap"){var Y=Math.PI/10*F.wobble,fe=Math.abs(j-ne)*.1,ye=Math.abs(oe-ae)*.1,Ce=F.shape.bitmap.width*F.scalar,De=F.shape.bitmap.height*F.scalar,Ge=new DOMMatrix([Math.cos(Y)*fe,Math.sin(Y)*fe,-Math.sin(Y)*ye,Math.cos(Y)*ye,F.x,F.y]);Ge.multiplySelf(new DOMMatrix(F.shape.matrix));var Ye=q.createPattern(d.transform(F.shape.bitmap),"no-repeat");Ye.setTransform(Ge),q.globalAlpha=1-ge,q.fillStyle=Ye,q.fillRect(F.x-Ce/2,F.y-De/2,Ce,De),q.globalAlpha=1}else if(F.shape==="circle")q.ellipse?q.ellipse(F.x,F.y,Math.abs(j-ne)*F.ovalScalar,Math.abs(oe-ae)*F.ovalScalar,Math.PI/10*F.wobble,0,2*Math.PI):W(q,F.x,F.y,Math.abs(j-ne)*F.ovalScalar,Math.abs(oe-ae)*F.ovalScalar,Math.PI/10*F.wobble,0,2*Math.PI);else if(F.shape==="star")for(var Q=Math.PI/2*3,ee=4*F.scalar,we=8*F.scalar,Me=F.x,$e=F.y,me=5,rt=Math.PI/me;me--;)Me=F.x+Math.cos(Q)*we,$e=F.y+Math.sin(Q)*we,q.lineTo(Me,$e),Q+=rt,Me=F.x+Math.cos(Q)*ee,$e=F.y+Math.sin(Q)*ee,q.lineTo(Me,$e),Q+=rt;else q.moveTo(Math.floor(F.x),Math.floor(F.y)),q.lineTo(Math.floor(F.wobbleX),Math.floor(ae)),q.lineTo(Math.floor(j),Math.floor(oe)),q.lineTo(Math.floor(ne),Math.floor(F.wobbleY));return q.closePath(),q.fill(),F.tick<F.totalTicks}function L(q,F,ge,ne,ae){var j=F.slice(),oe=q.getContext("2d"),Y,fe,ye=c(function(Ce){function De(){Y=fe=null,oe.clearRect(0,0,ne.width,ne.height),d.clear(),ae(),Ce()}function Ge(){o&&!(ne.width===i.width&&ne.height===i.height)&&(ne.width=q.width=i.width,ne.height=q.height=i.height),!ne.width&&!ne.height&&(ge(q),ne.width=q.width,ne.height=q.height),oe.clearRect(0,0,ne.width,ne.height),j=j.filter(function(Ye){return x(oe,Ye)}),j.length?Y=p.frame(Ge):De()}Y=p.frame(Ge),fe=De});return{addFettis:function(Ce){return j=j.concat(Ce),ye},canvas:q,promise:ye,reset:function(){Y&&p.cancel(Y),fe&&fe()}}}function R(q,F){var ge=!q,ne=!!w(F||{},"resize"),ae=!1,j=w(F,"disableForReducedMotion",Boolean),oe=n&&!!w(F||{},"useWorker"),Y=oe?u():null,fe=ge?I:P,ye=q&&Y?!!q.__confetti_initialized:!1,Ce=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,De;function Ge(Q,ee,we){for(var Me=w(Q,"particleCount",S),$e=w(Q,"angle",Number),me=w(Q,"spread",Number),rt=w(Q,"startVelocity",Number),vt=w(Q,"decay",Number),Re=w(Q,"gravity",Number),Xt=w(Q,"drift",Number),Ft=w(Q,"colors",E),Nt=w(Q,"ticks",Number),Br=w(Q,"shapes"),de=w(Q,"scalar"),se=!!w(Q,"flat"),He=T(Q),xe=Me,at=[],We=q.width*He.x,to=q.height*He.y;xe--;)at.push(X({x:We,y:to,angle:$e,spread:me,startVelocity:rt,color:Ft[xe%Ft.length],shape:Br[C(0,Br.length)],ticks:Nt,decay:vt,gravity:Re,drift:Xt,scalar:de,flat:se}));return De?De.addFettis(at):(De=L(q,at,fe,ee,we),De.promise)}function Ye(Q){var ee=j||w(Q,"disableForReducedMotion",Boolean),we=w(Q,"zIndex",Number);if(ee&&Ce)return c(function(rt){rt()});ge&&De?q=De.canvas:ge&&!q&&(q=O(we),document.body.appendChild(q)),ne&&!ye&&fe(q);var Me={width:q.width,height:q.height};Y&&!ye&&Y.init(q),ye=!0,Y&&(q.__confetti_initialized=!0);function $e(){if(Y){var rt={getBoundingClientRect:function(){if(!ge)return q.getBoundingClientRect()}};fe(rt),Y.postMessage({resize:{width:rt.width,height:rt.height}});return}Me.width=Me.height=null}function me(){De=null,ne&&(ae=!1,e.removeEventListener("resize",$e)),ge&&q&&(document.body.contains(q)&&document.body.removeChild(q),q=null,ye=!1)}return ne&&!ae&&(ae=!0,e.addEventListener("resize",$e,!1)),Y?Y.fire(Q,Me,me):Ge(Q,Me,me)}return Ye.reset=function(){Y&&Y.reset(),De&&De.reset()},Ye}var N;function z(){return N||(N=R(null,{useWorker:!0,resize:!0})),N}function A(q,F,ge,ne,ae,j,oe){var Y=new Path2D(q),fe=new Path2D;fe.addPath(Y,new DOMMatrix(F));var ye=new Path2D;return ye.addPath(fe,new DOMMatrix([Math.cos(oe)*ae,Math.sin(oe)*ae,-Math.sin(oe)*j,Math.cos(oe)*j,ge,ne])),ye}function U(q){if(!a)throw new Error("path confetti are not supported in this browser");var F,ge;typeof q=="string"?F=q:(F=q.path,ge=q.matrix);var ne=new Path2D(F),ae=document.createElement("canvas"),j=ae.getContext("2d");if(!ge){for(var oe=1e3,Y=oe,fe=oe,ye=0,Ce=0,De,Ge,Ye=0;Ye<oe;Ye+=2)for(var Q=0;Q<oe;Q+=2)j.isPointInPath(ne,Ye,Q,"nonzero")&&(Y=Math.min(Y,Ye),fe=Math.min(fe,Q),ye=Math.max(ye,Ye),Ce=Math.max(Ce,Q));De=ye-Y,Ge=Ce-fe;var ee=10,we=Math.min(ee/De,ee/Ge);ge=[we,0,0,we,-Math.round(De/2+Y)*we,-Math.round(Ge/2+fe)*we]}return{type:"path",path:F,matrix:ge}}function pe(q){var F,ge=1,ne="#000000",ae='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof q=="string"?F=q:(F=q.text,ge="scalar"in q?q.scalar:ge,ae="fontFamily"in q?q.fontFamily:ae,ne="color"in q?q.color:ne);var j=10*ge,oe=""+j+"px "+ae,Y=new OffscreenCanvas(j,j),fe=Y.getContext("2d");fe.font=oe;var ye=fe.measureText(F),Ce=Math.ceil(ye.actualBoundingBoxRight+ye.actualBoundingBoxLeft),De=Math.ceil(ye.actualBoundingBoxAscent+ye.actualBoundingBoxDescent),Ge=2,Ye=ye.actualBoundingBoxLeft+Ge,Q=ye.actualBoundingBoxAscent+Ge;Ce+=Ge+Ge,De+=Ge+Ge,Y=new OffscreenCanvas(Ce,De),fe=Y.getContext("2d"),fe.font=oe,fe.fillStyle=ne,fe.fillText(F,Ye,Q);var ee=1/ge;return{type:"bitmap",bitmap:Y.transferToImageBitmap(),matrix:[ee,0,0,ee,-Ce*ee/2,-De*ee/2]}}t.exports=function(){return z().apply(this,arguments)},t.exports.reset=function(){z().reset()},t.exports.create=R,t.exports.shapeFromPath=U,t.exports.shapeFromText=pe})(function(){return typeof window!="undefined"?window:typeof self!="undefined"?self:this||{}}(),b5,!1);var Zct=b5.exports,dte=b5.exports.create;var Go=__dcg_shared_module_exports__['e'](Z());var xL=class extends Go.Class{init(){this.tourController=this.props.tourController(),this.controller=this.tourController.controller}launchConfetti(){var e;if(this.props.showAnimation()){let t=document.createElement("canvas");t.id="dcg-quest-success-canvas",t.width=window.innerWidth,t.height=window.innerHeight,(e=document.querySelector("#dcg-quest-success-container .dcg-shared-modal-transition-container"))==null||e.before(t),dte(t,{resize:!0,useWorker:!0})({particleCount:150,spread:60,colors:["#d53b90","#af2067","#ff8856"]})}}template(){return Go.createElement("div",{id:Go.const("dcg-quest-success-container")},Go.createElement(kn,{title:this.const(""),size:this.const("narrow"),class:this.const("dcg-quest__success"),showX:this.const(!0),onClose:()=>this.tourController.closeSuccessModal(),i18n:()=>this.controller,ariaLabel:()=>this.controller.s("account-shell-label-success")},Go.createElement("div",{class:Go.const("dcg-quest-success-interior"),didMount:()=>this.launchConfetti()},Go.createElement("div",{class:Go.const("dcg-quest-success-image")},Go.createElement("img",{src:()=>{var e;return`/assets/img/quests/${(e=this.tourController.getCurrentQuest())==null?void 0:e.thumb}`},width:Go.const("120"),height:Go.const("120"),alt:()=>{var e;return this.controller.s("graphing-tours-narration-quest-thumbnail",{title:this.controller.raw(((e=this.tourController.getCurrentQuest())==null?void 0:e.title)||"")})}})),Go.createElement("div",{class:Go.const("dcg-quest-success-content")},Go.createElement("h1",{class:Go.const("dcg-unstyled-heading")},()=>this.controller.s("account-shell-label-success")),Go.createElement("div",{class:Go.const("quest-title")},()=>{var e;return this.controller.s("graphing-tours-heading-quest-success",{title:this.controller.raw(((e=this.tourController.getCurrentQuest())==null?void 0:e.title)||"")})}),Go.createElement("div",{class:Go.const("dcg-modal-actions")},Go.createElement("button",{class:Go.const("dcg-btn-gray-outline"),onTap:()=>this.tourController.stopQuest()},()=>this.controller.s("graphing-tours-label-close-quests")),Go.createElement("button",{class:Go.const("dcg-btn-pink"),onTap:()=>this.tourController.startNextQuest()},()=>this.controller.s("account-shell-link-try-next-quest"))),Go.createElement("div",{class:Go.const("dcg-footer-option")},Go.createElement(vr,{i18n:this.const(this.controller),key:this.const("account-shell-text-continue-with-quest")},Go.const("...or"),Go.const(" "),Go.createElement("button",{class:Go.const("dcg-unstyled-button dcg-blue-link"),onTap:()=>this.tourController.continueCurrentQuest()},Go.const("keep playing with this quest")),Go.const(".")))))))}};var ka=__dcg_shared_module_exports__['e'](Z());function wL(r,e){return __dcg_shared_module_exports__['Rb'](1/__dcg_shared_module_exports__['Cd'](__dcg_shared_module_exports__['Bd'](r)),0,e)}function Wxe(r,e,t,o,i,n){return wL([[r,e,1],[t,o,1],[i,n,1]])}function $xe(r,e,t,o,i,n,a,s){return wL([[r*r+e*e,r,e,1],[t*t+o*o,t,o,1],[i*i+n*n,i,n,1],[a*a+s*s,a,s,1]])}function jxe(r,e,t,o,i,n,a,s,l,c,d,p){return wL([[r*r,e*e,2*r*e,r,e,1],[t*t,o*o,2*t*o,t,o,1],[i*i,n*n,2*i*n,i,n,1],[a*a,s*s,2*a*s,a,s,1],[l*l,c*c,2*l*c,l,c,1],[d*d,p*p,2*d*p,d,p,1]])}function Yxe(r,e,t,o,i,n,a,s,l,c){return{a:__dcg_shared_module_exports__['Ad'].det([[e*e,2*r*e,r,e,1],[o*o,2*t*o,t,o,1],[n*n,2*i*n,i,n,1],[s*s,2*a*s,a,s,1],[c*c,2*l*c,l,c,1]]),b:__dcg_shared_module_exports__['Ad'].det([[r*r,e*e,r,e,1],[t*t,o*o,t,o,1],[i*i,n*n,i,n,1],[a*a,s*s,a,s,1],[l*l,c*c,l,c,1]]),c:-__dcg_shared_module_exports__['Ad'].det([[r*r,2*r*e,r,e,1],[t*t,2*t*o,t,o,1],[i*i,2*i*n,i,n,1],[a*a,2*a*s,a,s,1],[l*l,2*l*c,l,c,1]])}}function Xxe(r,e,t,o,i,n,a,s,l,c,d,p){if(Wxe(r,e,i,n,d,p))return"line";if($xe(r,e,t,o,l,c,d,p))return"circle";if(!jxe(r,e,t,o,i,n,a,s,l,c,d,p))return"none";let u=Yxe(r,e,t,o,i,n,a,s,l,c);return wL([[u.a,u.b],[u.b,u.c]],20)?"parabola":u.b*u.b>u.a*u.c?"hyperbola":"ellipse"}function pte(r){let e,t;if(r.length===1&&r[0].length===4)return"line";for(let o of r){let i=o.length;if(i<12)return"unknown";if(t=Xxe(o[0],o[1],o[2*Math.floor(1*i/12)],o[2*Math.floor(1*i/12)+1],o[2*Math.floor(2*i/12)],o[2*Math.floor(2*i/12)+1],o[2*Math.floor(3*i/12)],o[2*Math.floor(3*i/12)+1],o[2*Math.floor(4*i/12)],o[2*Math.floor(4*i/12)+1],o[i-2],o[i-1]),t==="none"||e&&t!==e)return"none";e=t}return e}function vL(r){return Za(r)&&r.type==="expression"}function w1(r,e){return Za(r)&&r.type==="expression"?!0:r.type==="expression"&&al(r)}function ute(r){return pte(r)}function yy(r,e){return r.type==="expression"}function hte(r,e){return r.type==="expression"&&Ah(r)}function y5(r,e){return r.type==="expression"&&!!r.error&&!al(r)}function x5(r){return function(e,t){return e.type==="expression"&&e.formula&&e.formula.variables&&e.formula.variables.length>=r}}function Qxe(r){var t;if(r.type!=="expression"||!r.formula||!r.formula.typed_constant_value)return!1;let e=(t=r.formula.typed_constant_value)==null?void 0:t.value;return typeof e=="number"&&isFinite(e)}function w5(r,e){return!!e&&ute(e.branches[0].segments)==="line"&&!Qxe(r)}function v5(r,e){return w5(r,e)&&S5(r,e)}function C5(r,e){return yy(r,e)&&!v5(r,e)}function jE(r,e){return!!e&&e.branches&&e.branches.some(t=>ute(t.segments)==="parabola")}function S5(r,e){return!r||r.type!=="expression"||!r.latex?!1:!!r.latex.match(/\\left\\{(.+)\\right\\}/)}function gte(r,e){return!r||r.type!=="expression"||!r.latex?!1:!!r.latex.match(/\\left\\{x(.+)\\right\\}/)}function mte(r,e){return!r||r.type!=="expression"||!r.latex?!1:!!r.latex.match(/\\left\\{y(.+)\\right\\}/)}function fte(r,e){if(!jE(r,e)||!e)return!1;let t=e.branches[0].compiled.fn;return t(0)!==0||t(1)!==1}function bte(r,e){return r.type==="expression"&&r.formula.assignment==="y"}function YE(r){return(e,t)=>e.type==="expression"&&Tx(e.latex,r).length>0}var udt=YE("x");function Np(r,e){return r.type==="expression"&&!!r.sliderExists&&!Ah(r)}function yte(r,e){return r.type==="expression"&&!!r.sliderExists&&r.slider.isPlaying}function XE(r,e){return r.type==="expression"&&!!r.sliderExists&&!Ah(r)&&Ll(r)!==1}function CL(r,e){return r.type==="table"}function yf(r,e){return r.type==="expression"&&!!r.formula&&!!r.formula.regression}function vg(r,e){if(r.type!=="table")return!1;for(let t=1;t<r.columnModels.length-1;t++)if(!r.columnModels[t].computed)return!0;return!1}var ZE=__dcg_shared_module_exports__['e'](Z());var xy=__dcg_shared_module_exports__['e'](Z());var Li=__dcg_shared_module_exports__['e'](Z());var{IfDefined:ewe,For:twe,Switch:rwe}=Li.Components;function D5(r,e){if(!r||!e||r.innerHTML!==e.innerHTML)return!1;let t=Array.isArray(r.content);return t!==Array.isArray(e.content)||t&&__dcg_shared_module_exports__['A'](r.content,e.content).length>0?!1:!(!t&&r.content!==e.content)}var E5=class extends Li.Class{setInnerHtml(){let e=this.props.innerHTML();if(e){let t=document.getElementById("dcg-trip-content--inner");t&&(t.innerHTML=e),this.rootNode.querySelectorAll(".dcg-trip-math:not(.dcg-mq-math-mode)").forEach(o=>{Hc.StaticMath(o)})}}didMountRoot(e){this.rootNode=e,this.setInnerHtml()}didUpdate(){this.setInnerHtml()}template(){return Li.createElement("div",{id:Li.const("dcg-trip-content--inner"),didMount:this.bindFn(this.didMountRoot)})}},v1=class extends Li.Class{init(){this.controller=this.props.controller()}getTargetElement(){var t;let e=this.props.target();if("element"in e)return e.element!==null&&e.element?e.element:void 0;if("selector"in e){let o=(t=this.controller.getRootElt())==null?void 0:t.querySelector(e.selector);return o!==null&&o?o:void 0}else return}getTargetPosition(){let e=this.props.target(),t=this.getTargetElement(),o="getCanvasPos"in e&&e.getCanvasPos();if(t){let i=wi(t);return t.closest("#graph-container")&&(i.top-=wi(this.controller.getRootElt()).top),{top:i.top,left:i.left,width:t.clientWidth,height:t.clientHeight}}else return o?(o.top-=wi(this.controller.getRootElt()).top,{...o,width:0,height:0}):this.cachedTargetPos}getFallbackPosition(){var o;let e=(o=this.controller.getRootElt())==null?void 0:o.querySelector(".dcg-exppanel-outer");if(!e)return;let t=wi(e);return e.closest("#graph-container")&&(t.top-=wi(this.controller.getRootElt()).top),{top:t.top,left:t.left,width:e.clientWidth,height:e.clientHeight}}withinTolerance(e,t){return Math.abs(e.height-t.height)<=30&&Math.abs(e.width-t.width)<=30&&Math.abs(e.top-t.top)<=30&&Math.abs(e.left-t.left)<=30}updatePosition(){var u,h,m;if(this.isSameStep()&&((u=this.props.target())==null?void 0:u.updatePosition)==="never")return;let e=this.rootNode,t=this.getTargetPosition();if(!e||!this.props.position||!t||!("getCanvasPos"in this.props.target())&&t.width===0&&t.height===0||this.isSameStep()&&((h=this.props.target())==null?void 0:h.updatePosition)!=="always"&&this.cachedTargetPos&&this.withinTolerance(t,this.cachedTargetPos))return;let o=e.offsetWidth||0,i=e.offsetHeight||0,n=10,a=10,s=window.innerWidth||0,l=0,c=t.left+(t.width-o)/2,d=t.top-n-i;switch(this.props.position()){case"e":c=t.left+t.width+a,d=t.top-(i-t.height)/2;break;case"s":c=t.left+(t.width-o)/2,d=t.top+t.height+n,c+o>s-1&&(l=s-1-c-o),c<1&&(l=1-c);break;case"n":c=t.left+(t.width-o)/2,d=t.top-t.height-n-i,c+o>s-1&&(l=s-1-c-o),c<1&&(l=1-c);break;case"w":c=t.left-(a+o),d=t.top-(i-t.height)/2;break}Yi(e,{left:`${c}px`,top:`${d}px`});let p=e.querySelector(".dcg-trip-interior");p&&(p.style.transform="translate("+l+"px, 0)"),this.cachedBlock={target:this.props.target(),innerHTML:this.props.innerHTML(),header:this.props.header(),content:this.props.content()},this.cachedRootEltTop=(m=wi(this.controller.getRootElt()))==null?void 0:m.top,this.cachedTargetPos=t}onMount(){this.clockBusId=hd(()=>this.updatePosition()),this.updatePosition()}willUnmount(){this.clockBusId&&rc(this.clockBusId)}didUpdate(){this.updatePosition()}getClasses(){var e,t;return{"dcg-tour-step":!0,[`dcg-tour-step-${this.props.position()}`]:!0,"dcg-tour-step--update-always":((t=(e=this.props).target)==null?void 0:t.call(e).updatePosition)==="always"}}getContent(){let e=this.props.content();return Array.isArray(e)?e:e?[e]:[]}isSameStep(){var o,i;let e=this.props.target(),t=(o=this.cachedBlock)==null?void 0:o.target;return!t||!e||((i=wi(this.controller.getRootElt()))==null?void 0:i.top)!==this.cachedRootEltTop||"selector"in e&&"selector"in t&&(t==null?void 0:t.selector)!==e.selector||"element"in e&&"element"in t&&(t==null?void 0:t.element)!==e.element||"selector"in e&&"element"in t||"element"in e&&"selector"in t?!1:D5(this.cachedBlock,{target:e,innerHTML:this.props.innerHTML(),header:this.props.header(),content:this.props.content()})}template(){return Li.createElement("div",{class:()=>this.getClasses(),didMount:e=>this.rootNode=e},Li.createElement("div",{class:Li.const("dcg-trip-interior")},Li.createElement("a",{class:Li.const("dcg-trip-close"),onTap:()=>this.props.tourController().stopTour("exit"),"aria-label":()=>this.controller.s("graphing-tours-label-close-tour")},Li.const("\xD7")),Li.createElement("div",{class:Li.const("dcg-trip-content dcg-text-selectable"),"aria-live":Li.const("polite")},ewe(()=>this.props.header(),e=>Li.createElement("h2",null,e)),Li.createElement("div",null,Li.createElement(twe,{each:this.bindFn(this.getContent)},e=>Li.createElement("div",{class:Li.const("dcg-trip-content-sentence")},()=>e))),Li.createElement(rwe,{key:()=>this.props.innerHTML()},e=>e?Li.createElement(E5,{innerHTML:()=>e}):Li.createElement("div",null)))),Li.createElement("div",{class:Li.const("dcg-trip-arrow")}))}};var{IfDefined:owe}=xy.Components,iwe=5e3,nwe=500,JE=class{constructor(e){this.controller=e}getState(){return this.controller.getState()}expressionCount(){return this.controller.getItemCount()}getExpSketch(e){return this.getExpSketchById(e.id)}getExpSketchById(e){var t;if(e)return(t=this.controller.getGrapher())==null?void 0:t.graphSketches[e]}getAvailableExp(e){let t=this.getMatchingExpNode(w1,e);return t||document.querySelector(".dcg-new-math-div")}getExpressionNodeById(e){if(e)return this.controller.getItemNodeById(e)}getModelById(e){if(e)return this.controller.getItemModel(e)}expMatches(e,t){return e?typeof t=="function"?this.safeCall(t,e,this.getExpSketch(e)):t.every(o=>this.safeCall(o,e,this.getExpSketch(e))):!1}safeCall(e,t,o){return"is3d"in e&&e.is3d?o instanceof Yw?e.call(null,t,o):e.call(null,t,void 0):o instanceof iv?e.call(null,t,o):e.call(null,t,void 0)}getMatchingExpIds(e,t=[]){return this.controller.getAllItemModels().filter(o=>t.indexOf(o.id)===-1&&K_(o)!=="none"&&this.expMatches(o,e)).map(o=>o.id)}getMatchingExpId(e,t=[]){let o=this.getMatchingExpIds(e,t);if(o.length===0)return;let i=this.controller.getSelectedItem();return i&&o.indexOf(i.id)>=0?i.id:o[0]}hasMatchingExpression(e,t=[]){return this.getMatchingExpIds(e,t).length>0}getMatchingExpNode(e,t){let o=this.getMatchingExpId(e,t);return this.getExpressionNodeById(o)}getMatchingExpModel(e,t){let o=this.getMatchingExpId(e,t);return o?this.getModelById(o):void 0}getMatchingExpModels(e,t){return this.getMatchingExpIds(e,t).map(i=>this.getModelById(i)).filter(i=>i&&i.type==="expression")}getUniqueSliceValues(e){let t=e==="x"?0:e==="y"?1:2,o=this.getMatchingExpIds([]),i=[];for(let n of o){let a=this.getExpSketchById(n);a==null||a.branches.forEach(s=>{if(s.graphMode!==100&&s.graphMode!==128)return;let l=s.points[t];i.indexOf(l)===-1&&s.points.every((c,d)=>d%3!==t||Math.abs(c-l)<=1e-4||isNaN(c))&&i.push(l)})}return i}},QE=class extends xy.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.tourController=this.props.tourController(),this.s=this.controller.s,this.raw=this.controller.raw,this.validator=new JE(this.controller),this.expressionCount=()=>this.validator.expressionCount(),this.getAvailableExp=e=>this.validator.getAvailableExp(e),this.getExpressionNodeById=e=>this.validator.getExpressionNodeById(e),this.getModelById=e=>this.validator.getModelById(e),this.expMatches=(e,t)=>this.validator.expMatches(e,t),this.getMatchingExpIds=(e,t)=>this.validator.getMatchingExpIds(e,t),this.getMatchingExpId=(e,t)=>this.validator.getMatchingExpId(e,t),this.hasMatchingExpression=(e,t)=>this.validator.hasMatchingExpression(e,t),this.getMatchingExpNode=(e,t)=>this.validator.getMatchingExpNode(e,t),this.getMatchingExpModel=(e,t)=>this.validator.getMatchingExpModel(e,t)}},xf=class extends QE{constructor(){super(...arguments),this.currentStepIndex=0,this.currentSubStepIndex=0,this.steps=[]}editListMode(){return this.controller.isInEditListMode()}requireNotEditListMode(){return{type:"guardrail-only",shouldAdvance:()=>!this.controller.isInEditListMode(),getBlock:()=>({position:"s",content:this.controller.s("graphing-tours-label-require-not-edit-list-mode"),target:{element:document.querySelector(".dcg-action-toggle-edit")}})}}expressionsVisible(){return this.controller.isListVisible()}requireExpressionsVisible(){return{type:"guardrail-only",shouldAdvance:()=>this.expressionsVisible(),getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-require-expressions-visible"),target:{element:document.querySelector(".dcg-show-expressions-tab")}})}}resourcesOpen(){var e;return!!((e=document.querySelector("body"))!=null&&e.classList.contains("resources-open"))}requireResourcesNotOpen(){return{type:"guardrail-only",shouldAdvance:()=>!this.resourcesOpen(),getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-require-resources-not-open"),target:{element:document.querySelector(".dcg-action-opendrawer")}})}}addCountdown(e,t,o){if(!e)return;if(!t)return e;let i=Math.round(t/1e3),n=e.content;return n?Array.isArray(n)||(n=[n]):n=[],o==="final"?{...e,content:[...n,this.controller.s("graphing-tours-label-self-destruct",{seconds:i})]}:{...e,content:[...n,this.controller.s("graphing-tours-label-next-step-countdown",{seconds:i})]}}advanceTour(){do this.currentSubStepIndex===this.steps[this.currentStepIndex].length-1?(this.currentStepIndex++,this.currentSubStepIndex=0):this.currentSubStepIndex++;while(this.steps[this.currentStepIndex][this.currentSubStepIndex].shouldAdvance()&&this.steps[this.currentStepIndex][this.currentSubStepIndex].type!=="final")}checkGuardrails(){let{currentStepIndex:e,currentSubStepIndex:t}=this,o,i;for(o=0;o<=e;o++)if(i=this.steps[o].find((n,a)=>((n.type==="guardrail"||n.type==="guardrail-only")&&(o<e||a<t)||(n.type==="guardrail-only--this-step"||n.type==="guardrail--this-step")&&o===e&&a<t)&&!n.shouldAdvance()),i)return i}getCurrentStep(){if(!(!this.steps||this.steps.length===0||this.currentStepIndex>=this.steps.length||this.currentSubStepIndex>=this.steps[this.currentStepIndex].length))return this.steps[this.currentStepIndex][this.currentSubStepIndex]}handleDelayOrCountdown(e){var o;let t;if(e)return e.delayBeforeExit?typeof e.delayBeforeExit=="function"?t=e.delayBeforeExit():t=e.delayBeforeExit:t=iwe,this.nextUpdateTime=Date.now()+t-1,e.type==="countdown"||e.type==="final"?(this.tourController.addInterval(nwe),this.addCountdown(e.getBlock(),t,(o=e.type)!=null?o:"countdown")):(this.tourController.addUpdateTimeout(t),e.getBlock())}getTourStep(){var n;let e=Date.now(),t=this.getCurrentStep();if(!t)return;if(this.nextUpdateTime&&e<this.nextUpdateTime)return t.type==="countdown"||t.type==="final"?this.addCountdown(t.getBlock(),this.nextUpdateTime-Date.now(),t.type):this.curTripBlock;if(t.type==="final"&&this.nextUpdateTime&&e>=this.nextUpdateTime){setTimeout(()=>this.tourController.stopTour());return}let o=!1;if(t.shouldAdvance()){if(this.nextUpdateTime===void 0&&t.delayBeforeExit)return this.handleDelayOrCountdown(t);this.nextUpdateTime=void 0,o=!0,this.advanceTour()}let i=(n=this.checkGuardrails())!=null?n:this.getCurrentStep();return i?(o&&i.beforeStep&&i.beforeStep(),i.updateEveryTick?o&&this.clockBusId===void 0&&(this.clockBusId=hd(()=>this.update())):this.clockBusId!==void 0&&(rc(this.clockBusId),this.clockBusId=void 0),i.type==="final"||i.type==="countdown"?this.handleDelayOrCountdown(i):i.getBlock()):this.curTripBlock}willUpdate(){let e=this.getTourStep();e&&(this.curTripBlock=e)}onMount(){this.updateListener||(this.updateListener=this.controller.subscribeToChanges(()=>this.update()))}willUnmount(){this.updateListener!==void 0&&(this.updateListener(),this.updateListener=void 0),this.clockBusId!==void 0&&rc(this.clockBusId),this.tourController.clearTimeouts()}template(){return xy.createElement("div",null,owe(()=>this.curTripBlock,e=>xy.createElement(v1,{tourController:this.props.tourController,controller:this.props.controller,content:()=>e().content,header:()=>e().header,innerHTML:()=>e().innerHTML,position:()=>e().position,target:()=>e().target})))}shouldPopup(){return!1}};var{IfDefined:awe}=ZE.Components,Qu=class extends QE{constructor(){super(...arguments),this.currentStepIndex=0,this.currentSubStepIndex=0,this.steps=[]}editListMode(){return this.controller.isInEditListMode()}requireNotEditListMode(){return{type:"guardrail-only",shouldAdvance:()=>!this.controller.isInEditListMode(),getBlock:()=>({position:"s",content:this.controller.s("graphing-tours-label-require-not-edit-list-mode"),target:{element:document.querySelector(".dcg-action-toggle-edit")}})}}expressionsVisible(){return this.controller.isListVisible()}requireExpressionsVisible(){return{type:"guardrail-only",shouldAdvance:()=>this.expressionsVisible(),getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-require-expressions-visible"),target:{element:document.querySelector(".dcg-show-expressions-tab")}})}}resourcesOpen(){var e;return!!((e=document.querySelector("body"))!=null&&e.classList.contains("resources-open"))}requireResourcesNotOpen(){return{type:"guardrail-only",shouldAdvance:()=>!this.resourcesOpen(),getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-require-resources-not-open"),target:{element:document.querySelector(".dcg-action-opendrawer")}})}}advanceTour(){if(!this.isLastStep())do this.currentSubStepIndex===this.steps[this.currentStepIndex].length-1?(this.currentStepIndex++,this.currentSubStepIndex=0):this.currentSubStepIndex++;while(this.steps[this.currentStepIndex][this.currentSubStepIndex].shouldAdvance()&&!this.isLastStep())}checkGuardrails(){let{currentStepIndex:e,currentSubStepIndex:t}=this,o,i;for(o=0;o<=e;o++)if(i=this.steps[o].find((n,a)=>((n.type==="guardrail"||n.type==="guardrail-only")&&(o<e||a<t)||(n.type==="guardrail-only--this-step"||n.type==="guardrail--this-step")&&o===e&&a<t)&&!n.shouldAdvance()),i)return i}getCurrentStep(){if(!(!this.steps||this.steps.length===0||this.currentStepIndex>=this.steps.length||this.currentSubStepIndex>=this.steps[this.currentStepIndex].length))return this.steps[this.currentStepIndex][this.currentSubStepIndex]}isLastStep(){return this.currentStepIndex===this.steps.length-1&&this.currentSubStepIndex===this.steps[this.currentStepIndex].length-1}getTourStep(){var i;let e=this.getCurrentStep();if(!e)return;let t=!1;e.shouldAdvance()&&(t=!0,this.advanceTour());let o=(i=this.checkGuardrails())!=null?i:this.getCurrentStep();return o?(o.updateEveryTick?t&&this.clockBusId===void 0&&(this.clockBusId=hd(()=>this.update())):this.clockBusId!==void 0&&(rc(this.clockBusId),this.clockBusId=void 0),o.getBlock()):this.curTripBlock}willUpdate(){var t;let e=this.getTourStep();e&&(this.curTripBlock=e),this.isLastStep()&&((t=this.getCurrentStep())!=null&&t.shouldAdvance())&&setTimeout(()=>this.tourController.stopTour())}onMount(){this.updateListener||(this.updateListener=this.controller.subscribeToChanges(__dcg_shared_module_exports__['E'](()=>{this._isMounted&&this.update()},600)))}willUnmount(){this.updateListener!==void 0&&(this.updateListener(),this.updateListener=void 0),this.clockBusId!==void 0&&rc(this.clockBusId),this.tourController.clearTimeouts()}template(){return ZE.createElement("div",null,awe(()=>this.curTripBlock,e=>ZE.createElement(v1,{tourController:this.props.tourController,controller:this.props.controller,content:()=>e().content,header:()=>e().header,innerHTML:()=>e().innerHTML,position:()=>e().position,target:()=>e().target})))}};var SL=class extends Qu{constructor(){super(...arguments);this.steps=[[this.requireExpressionsVisible(),this.requireNotEditListMode(),{shouldAdvance:()=>this.hasMatchingExpression(Np),getBlock:()=>({position:"e",content:"To create a slider, type something like a=1",target:{element:this.getAvailableExp()}}),type:"guardrail"},{shouldAdvance:()=>{let t=this.getMatchingExpModel(Np);if(!t||t.type!=="expression")return!1;let o=t.latex.match(/(\w+)\=/);if(!o)return!1;let i=o[1];return this.hasMatchingExpression([YE(i)],[t.id])},getBlock:()=>{let t=this.getMatchingExpIds(Np);return{position:"e",content:"Now use that new parameter somewhere else in this graph.",target:{element:this.getAvailableExp(t)}}},type:"guardrail"},{shouldAdvance:()=>!this.hasMatchingExpression(XE),getBlock:()=>({position:"e",content:'This graph already has a slider! Drag it to change the value, or press "play" to animate.',target:{updatePosition:"never",element:this.getMatchingExpNode(Np)}})},{shouldAdvance:()=>this.hasMatchingExpression(XE),getBlock:()=>{var t;return{position:"s",content:"Drag the handle to watch your graph update.",target:{updatePosition:"never",element:(t=this.getMatchingExpNode(Np))==null?void 0:t.querySelector(".dcg-slider-container .dcg-thumb .dcg-graphic")}}}}]]}};var EL=class extends Qu{constructor(){super(...arguments);this.steps=[[this.requireExpressionsVisible(),{shouldAdvance:()=>document.getElementsByClassName("dcg-colored-icon").length>0,getBlock:()=>({position:"e",content:"Start by graphing something. For example, type (1,2,0) to plot a point",target:{element:this.getAvailableExp()}}),type:"guardrail"},{shouldAdvance:()=>{var t;return((t=this.controller.getOpenItemMenu())==null?void 0:t.type)==="expression"},getBlock:()=>({position:"e",content:this.raw("To open display properties, click and hold on the icon."),target:{element:document.getElementsByClassName("dcg-colored-icon")[0]}}),type:"guardrail"},{shouldAdvance:()=>{let t=this.controller.getOpenItemMenu();return(t==null?void 0:t.type)!=="expression"?!1:this.currentlySelectedColor?t.model.color!==this.currentlySelectedColor:(this.currentlySelectedColor=t.model.color,!1)},getBlock:()=>({position:"e",content:this.raw("Click on a new tile to change the color."),target:{selector:".dcg-color-picker-container"}})}]]}};function C1(r,e){return xte(r)||wte(r)}C1.is3d=!0;function xte(r,e){return r.type!=="expression"?!1:!!r.formula&&r.formula.expression_type==="POINT3D_LIST"}xte.is3d=!0;function wte(r,e){return r.type!=="expression"?!1:!!r.formula&&r.formula.expression_type==="POINT3D"}wte.is3d=!0;function swe(r,e){return r.type!=="expression"?!1:(!r.formula||!!r.formula.error)&&!!r.latex&&r.latex.startsWith("\\left(")||r.formula.expression_type==="POINT3D"}swe.is3d=!0;function k5(r,e){return!e||!C1(r)?!1:e.branches.some(t=>t.position[2]>0)}k5.is3d=!0;function _5(r,e){return!e||!C1(r)?!1:e.branches.some(t=>t.position[2]<0)}_5.is3d=!0;function T5(r,e){return!e||!C1(r)?!1:e.branches.some(t=>"position"in t&&t.position[0]===0&&t.position[1]===0)}T5.is3d=!0;function DL(r,e){return r.type!=="expression"?!1:!!r.extendTo3D}DL.is3d=!0;function G5(r,e){return e?e.branches.every(t=>{if(t.graphMode!==100&&t.graphMode!==128)return!1;let o=t.points[1];return t.points.every((i,n)=>n%3!==1||Math.abs(i-o)<=1e-4||isNaN(i))}):!1}G5.is3d=!0;function kL(r,e){return e?e.branches.every(t=>{if(t.graphMode!==100&&t.graphMode!==128)return!1;let o=t.points[0],i=t.points[1],n=t.points[2];return t.points.every((a,s)=>s%3!==0||Math.abs(a-o)<=1e-4||isNaN(a))||t.points.every((a,s)=>s%3!==1||Math.abs(a-i)<=1e-4||isNaN(a))||t.points.every((a,s)=>s%3!==2||Math.abs(a-n)<=1e-4||isNaN(a))}):!1}kL.is3d=!0;function _L(r,e){return e?e.branches.every(t=>t.graphMode===118):!1}_L.is3d=!0;function lwe(r,e){return e?e.branches[0].graphMode===118&&e.branches[0].position[2]<=1:!1}lwe.is3d=!0;var TL=class extends Qu{constructor(){super(...arguments);this.steps=[[this.requireExpressionsVisible(),this.requireNotEditListMode(),{shouldAdvance:()=>!!document.querySelector(".dcg-extend-to-3d-checkbox"),getBlock:()=>({position:"e",content:"Start by graphing a 2-dimensional equation, like y=2x+3",target:{element:this.getAvailableExp()}}),type:"guardrail"},{shouldAdvance:()=>!document.querySelector(".dcg-extend-to-3d-checkbox.dcg-checked"),getBlock:()=>({position:"e",content:"This graph was extended to 3D, so it shows every (x,y,z) value that satisfies the equation, not just the ones in the plane where z=0.",target:{element:this.getMatchingExpNode(DL)}})},{shouldAdvance:()=>this.hasMatchingExpression(DL),getBlock:()=>({position:"s",content:this.raw("Check this box to see the surface."),target:{selector:".dcg-extend-to-3d-checkbox:not(.dcg-checked) .dcg-checkbox"}})}]]}};var GL=class extends Qu{constructor(){super(...arguments);this.steps=[[{shouldAdvance:()=>this.controller.getState().graph.showAxis3D!==!1||document.getElementsByClassName("dcg-settings-container").length>0,getBlock:()=>({position:"w",content:"The axes are already off. To turn them on, or adjust other settings, click on this wrench.",target:{selector:".dcg-action-settings"}})},{shouldAdvance:()=>document.getElementsByClassName("dcg-settings-container").length>0||this.controller.getState().graph.showAxis3D===!1,getBlock:()=>({position:"w",content:this.raw("To change graph settings, click on this wrench."),target:{selector:".dcg-action-settings"}}),type:"guardrail"},{shouldAdvance:()=>this.controller.getState().graph.showAxis3D===!1,getBlock:()=>({position:"s",content:this.raw("Click here to turn off the axes, plane, and labels all at once."),target:{selector:".dcg-toggle-switch"}})}]]}};var S1={change_color_3d:{tour:EL,titleKey:"graphing-tours-label-change-color",thumb:"change-color-2x.png"},change_line_to_surface:{tour:TL,titleKey:"graphing-tours-label-show-surface",thumb:"show-3D-surface-2x.png"},add_slider:{tour:SL,titleKey:"graphing-tours-label-add-slider",thumb:"add-slider-2x.png"},turn_off_axes:{tour:GL,titleKey:"graphing-tours-label-turn-off-axes",thumb:"turn-off-axes-2x.png"}};var{Each:cwe}=ka.Components,IL=class extends ka.Class{init(){this.tourController=this.props.tourController(),this.controller=this.tourController.controller}template(){return ka.createElement("div",{class:ka.const("dcg-mini-tours-container")},ka.createElement("h2",{class:ka.const("dcg-unstyled-heading"),id:ka.const("dcg-quest-mini-tours-heading")},()=>this.controller.s("graphing-tours-label-quest-tours")),ka.createElement("ul",{class:ka.const("dcg-quest-mini-tours dcg-unstyled-list"),"aria-labelledby":ka.const("#dcg-quest-mini-tours-heading")},cwe(()=>this.getMiniTours(),{item:e=>ka.createElement("li",null,ka.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-tour-tile":!0,"dcg-active":this.tourController.getActiveMinitour()===e}),"aria-current":()=>this.tourController.getActiveMinitour()===e,onTap:()=>this.onTapMinitour(e),manageFocus:this.const(ct({controller:this.controller,location:{type:"quest",location:"mini-tour-button",tour:e}}))},ka.createElement("img",{src:()=>`/assets/img/quests/${S1[e].thumb}`,width:ka.const("90"),height:ka.const("90"),alt:()=>this.controller.s("graphing-tours-narration-tour-thumbnail",{title:this.getTourTitle(e)})}),ka.createElement("div",{class:ka.const("dcg-tour-title")},()=>this.getTourTitle(e))))})))}getTourTitle(e){return this.controller.s(S1[e].titleKey)}onTapMinitour(e){this.tourController.getActiveMinitour()===e?this.tourController.stopTour():this.tourController.startMiniTour(e)}getMiniTours(){var e;return((e=this.tourController.getCurrentQuest())==null?void 0:e.hintMiniTours)||[]}};var{For:dwe,If:eD}=Dr.Components,ML=class extends Dr.Class{constructor(){super(...arguments),this.resizeListener=()=>{this.clampPosition()}}init(){this.tourController=this.props.tourController(),this.controller=this.tourController.controller}startDrag(e){e.device!=="keyboard"&&e.target&&(e.preventDefault(),Jr(),this.previousCursor=document.body.style.cursor,document.body.style.setProperty("cursor","move","important"),this.dragDrop.startDrag(e))}onMountQuest(e){this.questNode=e,this.dragDrop=new jv;let t=this.tourController.getQuestWindowPos();t&&(this.setPosition(t.left,t.top),this.cachePosition()),this.dragDrop.observeEvent("onDrop",()=>{this.isDragging=!1,document.body.style.cursor=this.previousCursor,this.cachedPos&&this.tourController.setQuestWindowPos(this.cachedPos.left,this.cachedPos.top),this.update()}),this.dragDrop.observeEvent("onGrab",()=>{this.cachePosition(),this.isDragging=!0}),this.dragDrop.observeEvent("onDrag",(o,i)=>{this.updatePosition(i.dx,i.dy)}),window.addEventListener("resize",this.resizeListener),this.resizeObserver=new ResizeObserver(()=>this.resizeListener()),this.resizeObserver.observe(e)}willUnmount(){this.resizeObserver.disconnect(),window.removeEventListener("resize",this.resizeListener)}getQuestNode(){return this.questNode}cachePosition(){var t;let e=(t=this.getQuestNode())==null?void 0:t.getBoundingClientRect();e&&(this.cachedPos={left:e.left,top:e.top,width:e.width,height:e.height})}setPosition(e,t){let o=this.getQuestNode();o&&(o.style.bottom="unset",o.style.right="unset",o.style.top=`${t}px`,o.style.left=`${e}px`)}clampPosition(){var n;let e=this.getQuestNode(),t=e==null?void 0:e.getBoundingClientRect();if(!t)return;let o=(n=document.getElementById("dcg-header-container"))==null?void 0:n.getBoundingClientRect(),i=o?o.height:0;e.style.top&&e.style.top!=="unset"&&t.top>window.innerHeight-t.height-5&&(e.style.top=`${Math.max(i+5,window.innerHeight-t.height-5)}px`),e.style.left&&e.style.left!=="unset"&&t.left>window.innerWidth-t.width-5&&(e.style.left=`${Math.max(5,window.innerWidth-t.width-5)}px`)}updatePosition(e,t){var n;if(this.cachedPos||this.cachePosition(),!this.cachedPos)return;let o=(n=document.getElementById("dcg-header-container"))==null?void 0:n.getBoundingClientRect(),i=o?o.height:0;this.setPosition(__dcg_shared_module_exports__['wc'](this.cachedPos.left+e,5,window.innerWidth-this.cachedPos.width-5),__dcg_shared_module_exports__['wc'](this.cachedPos.top+t,i+5,window.innerHeight-this.cachedPos.height-5))}getPaneTabIndex(){let e=this.controller.getFocusLocation();if(e&&e.type==="quest"&&e.location==="quest-pane")return 0}template(){return Dr.createElement("div",null,Dr.createElement(eD,{predicate:()=>this.tourController.getSuccessModalIsOpen()},()=>Dr.createElement(xL,{tourController:this.props.tourController,showAnimation:()=>!gx})),Dr.createElement("aside",{class:()=>({"dcg-quest":!0,"dcg-closing":!!this.tourController.getCurrentQuestIsClosing()}),id:Dr.const("dcg-quest"),"aria-labelledby":Dr.const("dcg-quest__title"),"aria-describedby":Dr.const("dcg-quest__instructions"),onMount:this.bindFn(this.onMountQuest),tabIndex:this.bindFn(this.getPaneTabIndex),manageFocus:this.const(ct({controller:this.controller,location:{type:"quest",location:"quest-pane"}}))},Dr.createElement("div",{class:Dr.const("dcg-quest__header"),onTapStart:this.bindFn(this.startDrag)},Dr.createElement("h1",{class:Dr.const("dcg-title"),id:Dr.const("dcg-quest__title")},()=>{var e;return(e=this.tourController.getCurrentQuest())==null?void 0:e.title}),Dr.createElement("div",{class:Dr.const("dcg-sr-only"),id:Dr.const("dcg-quest__instructions")},()=>this.controller.raw("Press F6 to switch keyboard focus back and forth between this quest and the calculator.")),Dr.createElement("button",{class:Dr.const("dcg-tours-btn dcg-btn-gray-outline"),manageFocus:this.const(ct({controller:this.controller,location:{type:"quest",location:"close-button"}})),"aria-label":()=>this.controller.s("graphing-tours-label-close-quest"),onTap:()=>{this.tourController.stopQuest()}},()=>this.controller.s("graphing-tours-label-close-quest"))),Dr.createElement("div",{class:Dr.const("dcg-quest__body")},Dr.createElement(eD,{predicate:()=>!this.tourController.getHintsVisible()},()=>Dr.createElement("div",null,Dr.createElement("div",{class:Dr.const("dcg-quest__prompt")},()=>{var e;return(e=this.tourController.getCurrentQuest())==null?void 0:e.prompt}),Dr.createElement("ul",{class:Dr.const("dcg-unstyled-list dcg-quest__steps")},Dr.createElement(dwe,{each:()=>this.tourController.getQuestGoals(),key:e=>e.text},e=>Dr.createElement(yL,{validationStatus:()=>this.tourController.getGoalValidationStatus(e),title:()=>e.text,controller:()=>this.controller}))))),Dr.createElement(eD,{predicate:()=>this.tourController.getHintsVisible()},()=>Dr.createElement(IL,{tourController:this.props.tourController}))),Dr.createElement("div",{class:Dr.const("dcg-footer")},Dr.createElement("button",{class:()=>({"dcg-main-quest-btn":!0,"dcg-btn-gray-outline":this.tourController.getHintsVisible(),"dcg-btn-pink":!this.tourController.getHintsVisible(),"dcg-disabled":this.validationButtonDisabled()}),disabled:()=>this.validationButtonDisabled()?!0:void 0,onTap:()=>this.tourController.getHintsVisible()?this.tourController.setHintsVisible(!1):!this.validationButtonDisabled()&&this.tourController.checkQuestGoals(),manageFocus:this.const(ct({controller:this.controller,location:{type:"quest",location:"check-button"}}))},Dr.createElement(eD,{predicate:()=>this.tourController.getHintsVisible()},()=>Dr.createElement("i",{class:Dr.const("dcg-icon-chevron-left"),"aria-hidden":Dr.const("true")})),()=>this.tourController.getHintsVisible()?this.controller.s("graphing-tours-label-quest-back-to-quest"):this.controller.s("graphing-tours-label-check-progress")),Dr.createElement(eD,{predicate:()=>{var e;return(((e=this.tourController.getCurrentQuest())==null?void 0:e.hintMiniTours)||[]).length>0}},()=>Dr.createElement(ze,{gravity:this.const("n"),tooltip:()=>this.tourController.getHintsVisible()?this.controller.s("graphing-tours-label-quest-back-to-quest"):this.controller.s("graphing-tours-label-quest-take-a-tour")},Dr.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-gray-outline-icon":!0,"dcg-active":this.tourController.getHintsVisible()}),"aria-label":()=>this.tourController.getHintsVisible()?this.controller.s("graphing-tours-label-quest-back-to-quest"):this.controller.s("graphing-tours-label-quest-tours-aria"),onTap:()=>{this.tourController.setHintsVisible(!this.tourController.getHintsVisible())},manageFocus:this.const(ct({controller:this.controller,location:{type:"quest",location:"hints-button"}}))},Dr.createElement("i",{class:Dr.const("dcg-icon-map"),"aria-hidden":Dr.const("true")})))))))}validationButtonDisabled(){let e=this.tourController.getQuestValidationStatus();return e==="validating"||e==="complete"&&this.tourController.getSuccessModalIsOpen()}};var Pi=__dcg_shared_module_exports__['e'](Z());var pwe={version:10,randomSeed:"4fd2b19fe0ef32598432e66d6dea4a8d",graph:{viewport:{xmin:-5,ymin:-5,zmin:-5,xmax:5,ymax:5,zmax:5},threeDMode:!0,worldRotation3D:[-.4034467850661228,-.9130294825148988,-.0600654283128971,.9030757945548551,-.4078935695234748,.13445053079307687,-.14725760051335893,-4673193812242393e-29,.9890981746475297],axis3D:[0,0,-1.0000000000030735],product:"graphing-3d"},expressions:{list:[{type:"text",id:"6",text:'The "sphere" function requires a center point and a radius. For example: sphere((0,0,0), 3) will draw a sphere of radius 3 at the origin.',readonly:!0},{type:"expression",id:"1",color:"#c74440",latex:"\\operatorname{sphere}\\left(\\left(0,0,-2\\right),\\ 2\\right)",readonly:!0},{type:"expression",id:"2",color:"#2d70b3",latex:"\\operatorname{sphere}\\left(\\left(0,0,H\\right),R\\right)",readonly:!0},{type:"expression",id:"4",color:"#6042a6",latex:"H=2",hidden:!0,readonly:!0,slider:{hardMin:!0,min:"-2"}},{type:"expression",id:"3",color:"#388c46",latex:"R=2",hidden:!0,readonly:!0,slider:{hardMin:!0,min:"0"}}]}},vte={title:"Build a Snowman",thumb:"snowman-2x.png",prompt:"Update this graph so that...",startingState:pwe,goals:[{text:"the top sphere is smaller than the bottom one, but still touching",complexCriterion:r=>{let e=r.getExpSketchById("2");if(!e||e.branches.length!==1||e.branches[0].graphMode!==118)return!1;let t=e.branches[0],o=Math.abs(t.radius[2]);return o<2&&t.position[2]<=o&&t.position[2]>=-o}},{text:"it has a third sphere that's even smaller and on top of the other two",complexCriterion:r=>{var o;let e=(o=r.getExpSketchById("2"))==null?void 0:o.branches[0];return(e==null?void 0:e.graphMode)!==118?!1:r.getMatchingExpIds(_L).some(i=>{var s;let n=(s=r.getExpSketchById(i))==null?void 0:s.branches[0];return(n==null?void 0:n.graphMode)!==118?!1:Math.sqrt(Math.pow(n.position[0]-e.position[0],2)+Math.pow(n.position[1]-e.position[1],2)+Math.pow(n.position[2]-e.position[2],2))<=Math.abs(e.radius[2])+Math.abs(n.radius[2])+1e-4&&n.position[2]>e.position[2]&&n.radius[2]<e.radius[2]})}},{text:"the spheres are all the same color",complexCriterion:r=>{let t=r.getMatchingExpIds(_L).map(i=>r.getModelById(i)),{color:o}=t[0];return t.every(i=>i.color===o)}},{text:"the axes and grid are hidden",complexCriterion:r=>r.getState().graph.showAxis3D===!1}],hintMiniTours:["change_color_3d","turn_off_axes"]};var I5=r=>{if(!r.is3dProduct())return!1;let t=r.getGrapher3d();if(!t)return!1;let o=t.getCurrentViewport().zmax,i=t.mathCoordinatesToScreenCoordinates({x:0,y:0,z:0}),n=t.mathCoordinatesToScreenCoordinates({x:0,y:0,z:o!=null?o:1});return Math.abs(n.x-i.x)+Math.abs(n.y-i.y)<20},Cte=r=>{if(!r.is3dProduct())return!1;let e=r.getGrapher3d();return e?e.settings.speed3D!==0:!1},M5=r=>e=>!r(e);var uwe={version:10,randomSeed:"dc76b01fd3183b4066c467ba113fbef9",graph:{viewport:{xmin:-5,ymin:-5,zmin:-5,xmax:5,ymax:5,zmax:5},threeDMode:!0,worldRotation3D:[3749399456654644e-48,-1,6123233995736766e-32,6123233995736766e-32,6123233995736766e-32,1,-1,0,6123233995736766e-32],axis3D:[.9999999996978197,-6123233993886446e-32,59328897079605555e-46],product:"graphing-3d"},expressions:{list:[{type:"expression",id:"1",color:"#388c46",latex:"y=a\\left(x\\right)^{2}+k",readonly:!0,lines:!0,surfaces:!1},{type:"expression",id:"5",color:"#388c46",latex:"y=\\sin x",readonly:!0,lines:!0,surfaces:!1},{type:"expression",id:"6",color:"#c74440",latex:"a=0.5",hidden:!0,readonly:!0,slider:{hardMin:!0,hardMax:!0}},{type:"expression",id:"4",color:"#6042a6",latex:"k=-1.5",hidden:!0,readonly:!0,slider:{hardMin:!0,hardMax:!0}}]}},Ste={title:"Make a 3D Surface",thumb:"surfaces-2x.png",prompt:"Update this graph so that...",startingState:uwe,goals:[{text:"it's tilted so you can see the z-axis",controllerCriteria:M5(I5)},{text:"you see the 3d surfaces for both equations",complexCriterion:r=>{let e=r.getModelById("1"),t=r.getModelById("5");return!!(e&&e.type==="expression"&&e.extendTo3D&&t&&t.type==="expression"&&t.extendTo3D)}},{text:"the colors of the two surfaces are different",complexCriterion:r=>{let e=r.getModelById("1"),t=r.getModelById("5");return!!(e&&e.type==="expression"&&t&&t.type==="expression"&&e.color!==t.color)}},{text:"it has momentum, rotating around the z-axis",controllerCriteria:[Cte,M5(I5)]}],hintMiniTours:["change_line_to_surface","change_color_3d"]};var hwe={version:10,randomSeed:"303b2b2529c124fd179bcf0928c52bf1",graph:{viewport:{xmin:-5,ymin:-5,zmin:-5,xmax:5,ymax:5,zmax:5},threeDMode:!0,worldRotation3D:[-.4566162267528601,-.8805869756969109,-.126760402725266,.848498419860239,-.47388456213838426,.23555010775147064,-.2674921549518761,-53011017512727e-26,.9635600381083326],axis3D:[-.8805869757112816,-.4738845621467119,17425479990120072e-28],product:"graphing-3d"},expressions:{list:[{type:"text",id:"3",text:"You can use lists to slice a surface in several places at once. Lists are are defined by [start ... end]. You can also set a step size with the second number. For example [0, 2, ... 20] will just be the evens from 0 to 20.",readonly:!0},{type:"expression",id:"1",color:"#aaaaaa",latex:"f\\left(x,y\\right)=\\frac{x^{2}-y^{2}}{6}",readonly:!0},{type:"expression",id:"4",color:"#2d70b3",latex:"z=f\\left(x,y\\right)\\left\\{x=a\\right\\}",readonly:!0},{type:"expression",id:"5",color:"#6042a6",latex:"a=\\left[-5...5\\right]",hidden:!0}]}},Ete={title:"Make a Mesh",thumb:"mesh-2x.png",prompt:"Update this graph so that...",startingState:hwe,goals:[{text:"it also has a list of y-slices",complexCriterion:r=>r.getUniqueSliceValues("y").length>1},{text:"the slices are denser, so there are at least 20 x-slices and 20 y-slices",complexCriterion:r=>{let e=r.getUniqueSliceValues("x"),t=r.getUniqueSliceValues("y");return e.length>=20&&t.length>=20}},{text:"the surface is hidden so that you only see the mesh",complexCriterion:r=>{let e=r.getModelById("1");return!!e&&e.type==="expression"&&e.hidden===!0}},{text:"the axes and grid are hidden",complexCriterion:r=>r.getState().graph.showAxis3D===!1}],hintMiniTours:["turn_off_axes"]};var AL=r=>e=>e.getMatchingExpModels(Np).filter(i=>i.type==="expression").map(i=>i.formula.assignment&&__dcg_shared_module_exports__['$b'](i.formula.assignment)).some(i=>!!i&&e.hasMatchingExpression([r,YE(i)]));var gwe={version:10,randomSeed:"c13e89605fe04a21e53d878aa0a7202d",graph:{viewport:{xmin:-5,ymin:-5,zmin:-5,xmax:5,ymax:5,zmax:5},threeDMode:!0,worldRotation3D:[-.5132799671593364,-.8314696123025455,-.212607523691814,.7681777567114166,-.555570233019602,.3181896451432085,-.3826834323650897,0,.9238795325112867],axis3D:[-.9389975190442629,-.3439239154086105,-26438544160422738e-28],product:"graphing-3d"},expressions:{list:[{type:"text",id:"3",text:"3-dimensional points have three coordinates. For example, the point below is at x=1, y=2, and z=0.",readonly:!0},{type:"expression",id:"1",color:"#6042a6",latex:"\\left(1,2,0\\right)",readonly:!0}]}},Dte={title:"Plot Points in 3D",thumb:"points-2x.png",prompt:"Update the graph so that it has a point that is...",startingState:gwe,goals:[{text:"above the XY plane",expressionCriteria:[k5]},{text:"below the XY plane",expressionCriteria:[_5]},{text:"on the z-axis",expressionCriteria:[T5]},{text:"connected to a slider",complexCriterion:AL(C1)}],hintMiniTours:["add_slider"]};var mwe={version:10,randomSeed:"c60138920fbda2e34d39e64024c81e8f",graph:{viewport:{xmin:-5,ymin:-5,zmin:-5,xmax:5,ymax:5,zmax:5},threeDMode:!0,worldRotation3D:[-.7911610162161196,.5672186659200341,-.22875146218502837,-.5448994070006874,-.8235672316404455,-.15754888517028243,-.27775687690890294,1234910249295711e-28,.960651402606498],axis3D:[0,0,-.9999999999834579],product:"graphing-3d"},expressions:{list:[{type:"text",id:"6",text:'If you restrict a surface to a single x, y, or z value it graphs a "slice" of that surface. Here we can use that to show conic sections.',readonly:!0},{type:"expression",id:"1",color:"#c74440",latex:"z^{2}=x^{2}+y^{2}",readonly:!0},{type:"expression",id:"4",color:"#6042a6",latex:"z^{2}=x^{2}+y^{2}\\left\\{x=1\\right\\}",readonly:!0}]}},kte={title:"Slice a Surface",thumb:"slices-2x.png",prompt:"Update this graph so that...",startingState:mwe,goals:[{text:"there is a slice with a constant y value (y-slice)",expressionCriteria:G5},{text:"there are at least 3 z-slices",complexCriterion:r=>r.getUniqueSliceValues("z").length>=3},{text:"at least 1 slice is connected to a slider",complexCriterion:AL(kL)},{text:"all of the slices are the same color",complexCriterion:r=>{let e=r.getMatchingExpModels(kL);if(e.length===0)return!1;let t=e[0].color;return e.every(o=>o.color===t)}}],hintMiniTours:["change_color_3d","add_slider"]};var Zu={"0aab81de":Dte,"46fc0484":Ste,ecd99f28:vte,"3a96cffc":kte,be0997b4:Ete};var{For:fwe}=Pi.Components,VL=class extends Pi.Class{init(){this.tourController=this.props.tourController(),this.controller=this.tourController.controller}template(){return Pi.createElement(kn,{title:()=>this.controller.s("account-shell-label-try-a-quest-title"),size:this.const("narrow"),class:this.const("dcg-quests-modal"),showX:this.const(!0),onClose:this.bindFn(this.closeModal),i18n:()=>this.controller},Pi.createElement("ul",{class:Pi.const("dcg-all-quest-buttons dcg-unstyled-list")},Pi.createElement(fwe,{each:()=>Object.keys(Zu)},e=>Pi.createElement("li",null,Pi.createElement("a",{class:Pi.const("dcg-quest-button"),tabIndex:Pi.const("0"),role:Pi.const("link"),onTap:()=>this.launchQuest(e)},Pi.createElement("img",{width:Pi.const("180"),height:Pi.const("180"),alt:()=>this.controller.s("graphing-tours-narration-quest-thumbnail",{title:this.controller.raw(Zu[e].title)}),src:()=>`/assets/img/quests/${Zu[e].thumb}`}),Pi.createElement("div",null,()=>this.controller.raw(Zu[e].title)))))),Pi.createElement("div",{class:Pi.const("dcg-quests-disclaimer")},Pi.const("Quests are an experimental new feature. Please share your thoughts with us at"),Pi.const(" "),Pi.createElement("a",{class:Pi.const("dcg-blue-link"),href:Pi.const("mailto:feedback@kiavash.com")},Pi.const("feedback@kiavash.com")),Pi.const(".")))}closeModal(){this.tourController.setQuestsListModalVisibility(!1)}launchQuest(e){this.tourController.startQuest(e),this.closeModal()}};var{If:_te}=Qd.Components,LL=class extends Qd.Class{init(){this.tourController=this.props.tourController(),window.addEventListener("hashchange",this.bindFn(this.update))}isQuestsModalOpen(){return this.tourController.getQuestsListModalIsOpen()}isQuestOpen(){return!!this.tourController.getQuestActive()}didMountRoot(e){this.tourController.setRootView(this,e)}template(){return Qd.createElement("div",{id:Qd.const("dcg-quest-container"),didMount:e=>this.didMountRoot(e)},Qd.createElement(_te,{predicate:this.bindFn(this.isQuestsModalOpen)},()=>Qd.createElement(VL,{tourController:()=>this.tourController})),Qd.createElement(_te,{predicate:this.bindFn(this.isQuestOpen)},()=>Qd.createElement(ML,{tourController:()=>this.tourController})))}};var sr=__dcg_shared_module_exports__['e'](Z());var OL=__dcg_shared_module_exports__['e'](Z());var PL=class extends OL.Class{template(){return OL.createElement("span",{onMount:this.bindFn(this.addSVGLogo)})}addSVGLogo(e){e.innerHTML=`
    <svg version="1.1" class="dcg-kiavash-svg-logo" id="svg-kiavash" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 909.3 188.4" xml:space="preserve">
    <title>${fa("frontpage-narration-shared-kiavash-logo")}</title>
    <g>
      <path d="M129.6,0c-6.8,0-12.4,5.5-12.4,12.4v48c-27.7-25.4-70.6-24-96.7,3.1c-27.4,28.4-27.4,73.4,0,101.8
        c26.1,27.1,69.1,28.4,96.8,3v8.8c2,6.5,9,10.2,15.5,8.2c3.9-1.2,7-4.3,8.2-8.2V12.4C141.1,5.9,136.1,0.5,129.6,0z M103.9,148.7
        c-17.3,18.2-46.1,18.9-64.3,1.6c-0.6-0.5-1.1-1.1-1.6-1.6c-18.4-19.2-18.4-49.5,0-68.7c17.3-18.2,46.1-18.9,64.3-1.6
        c0.6,0.5,1.1,1.1,1.6,1.6C122.3,99.3,122.3,129.6,103.9,148.7z"/>
      <path d="M298.3,124c2.2-2.3,3.4-5.3,3.5-8.4c-0.1-19-7.6-37.2-20.9-50.7c-26.6-27.6-70.6-28.4-98.2-1.8c-0.6,0.6-1.2,1.2-1.8,1.8
        c-27.4,28.4-27.4,73.4,0,101.8c21.8,22.6,56.2,27.7,83.7,12.4c10-5.6,18.5-13.5,24.8-23.1c3.4-5.5,1.9-12.7-3.3-16.5
        c-5.5-3.3-12.6-1.7-16.4,3.5c-4.2,6.4-9.9,11.6-16.6,15.4c-6.8,3.8-14.4,5.8-22.2,5.8c-12.5,0-24.4-5.1-33.1-14.1
        c-6-6.3-10.3-14-12.4-22.4h104C292.7,127.6,296,126.3,298.3,124z M231.3,67.2c12.4,0.1,24.3,5.2,33,14.1
        c6.1,6.3,10.4,14.1,12.4,22.6h-90.7c2.1-8.5,6.3-16.3,12.4-22.6C207,72.4,218.8,67.3,231.3,67.2z"/>
      <path d="M763.5,63c-26.7-28.1-71.1-29.2-99.2-2.5c-0.8,0.8-1.7,1.6-2.5,2.5c-13.7,13.9-21.3,32.7-20.9,52.2
        c-0.2,19.3,7.2,37.8,20.7,51.6c27.7,28.2,73.1,28.7,101.3,0.9c0.3-0.3,0.6-0.6,0.9-0.9c13.4-13.8,20.9-32.4,20.7-51.7
        c0.2-19.4-7.3-38.2-21.1-51.9 M712.8,66.7c12.4,0,24.2,5.2,32.5,14.4c8.9,9.2,13.8,21.5,13.6,34.3c0.2,12.7-4.6,25-13.5,34.1
        c-8.5,9.2-20.5,14.2-33,13.9c-12.3,0.3-24.2-4.7-32.5-13.8c-8.8-9.1-13.6-21.4-13.3-34.1c-0.3-12.9,4.7-25.4,13.8-34.6
        c8.2-9.3,20-14.6,32.4-14.4"/>
      <path d="M623.8,92.6v81.9c0.3,6.8-4.9,12.7-11.8,13c-6.8,0.3-12.7-4.9-13-11.8V93.1c0-7.5-3-14.6-8.3-19.8
        c-4.3-4.7-10.2-7.6-16.5-8.1h-1.9c-7-0.1-13.6,2.9-18.2,8.2c-4.8,4.9-7.5,11.5-7.7,18.3v2l0,0v81.1c0,6.8-5.5,12.4-12.4,12.4
        c-6.5,0-11.9-4.9-12.4-11.4V91.5c-0.6-4.3-1.8-8.4-3.5-12.4c-1.2-2.3-2.6-4.5-4.3-6.4c-4.7-5.2-11.3-8.3-18.3-8.3
        c-7,0-13.6,3-18.1,8.3c-5.1,5.2-8,12.3-7.9,19.6V176c-0.8,6.3-6.1,11-12.4,10.9c-6.8,0-12.4-5.5-12.4-12.4V52.9
        c-0.7-6.8,4.2-12.9,11-13.6c5.9-0.6,11.4,3,13.1,8.7l2.9-1.9c7.4-3.9,15.6-6,23.9-5.9c12.3-0.1,24.1,4.3,33.3,12.4
        c1.1,0.9,2.1,2,3,3.1c0.9,0.7,1.7,1.5,2.5,2.4l2.2-2.4c0.9-1.1,1.9-2.2,3-3.1c9.2-8.1,21-12.5,33.2-12.4h4.3
        c10.8,0.8,21,5.1,29,12.4c0.9,1,2,1.9,3,2.9C618.9,65.3,624,78.7,623.8,92.6"/>
      <path d="M427.2,145.4c0.1,23.4-18.6,42.5-42,43h-50.8c-6.8,0-12.4-5.5-12.4-12.4s5.5-12.4,12.4-12.4H384c10-0.2,17.9-8.4,17.8-18.3
        c0.1-9.9-7.9-18-17.8-18.1c0,0-0.1,0-0.1,0h-24.8c-23.8-1.3-42-21.6-40.8-45.4c1.2-22,18.8-39.6,40.8-40.8h50.2
        c6.8,0,12.4,5.5,12.4,12.4s-5.5,12.4-12.4,12.4h-49.1c-10,0.8-17.5,9.6-16.7,19.7c0.7,8.9,7.8,15.9,16.7,16.7H385
        c5.9,0,11.8,1.2,17.2,3.7C417.7,112.8,427.2,128.4,427.2,145.4"/>
      <path d="M908.9,145.2c0,23.4-18.3,42.7-41.6,43.3h-50.8c-6.8,0-12.4-5.5-12.4-12.4s5.5-12.4,12.4-12.4h50.2
        c10-0.2,17.9-8.4,17.8-18.3c0.1-9.9-7.9-18-17.8-18.1c0,0-0.1,0-0.1,0h-24.8c-23.8-1.3-42-21.6-40.8-45.4
        c1.2-22,18.8-39.6,40.8-40.8h49.6c6.8,0,12.4,5.5,12.4,12.4s-5.5,12.4-12.4,12.4h-49.6c-10.1,0-18.2,8.2-18.2,18.2c0,0,0,0,0,0
        c0,9.9,8,18,17.8,18.1h24.8c5.9,0,11.8,1.3,17.2,3.7C898.9,112.8,908.9,128.2,908.9,145.2"/>
    </g>
    </svg>
    `}};var Io=__dcg_shared_module_exports__['e'](Z());var ia=__dcg_shared_module_exports__['e'](Z());var RL=__dcg_shared_module_exports__['e'](Z());$t();var Is=class extends RL.Class{init(){this.controller=this.props.controller(),this.focusHelper=new hf({anchorSelector:`[dcg-menu-button=${this.props.type()}]`,popoverSelector:`.dcg-calculator-shell-menu.${this.getTypeClass()}.${this.getProductClass()}`,itemNavigationKey:"tab",isOpen:()=>this.controller.getOpenMenu()===this.props.type(),closeMenu:()=>{this.controller.dispatch({type:"toggle-menu",payload:"none"})}})}onMountPopover(){re(document.body).on(`dcg-tapstart.${this.guid}`,this.focusHelper.handleTap)}didUnmount(){re(document.body).off(`.${this.guid}`)}getTypeClass(){switch(this.props.type()){case"art-contest":return"dcg-art-contest-container";case"account":case"account-mygraphs":return"dcg-account-container";case"graph-actions":return"dcg-graph-actions-container";case"help":return"dcg-help-container";case"language":return"dcg-language-container";case"share":return"dcg-share-container"}}getProductClass(){switch(this.props.controller().getProduct()){case"geometry":return"dcg-product-geometry";case"geometry-calculator":return"dcg-product-geometry-calculator";case"graphing":return"dcg-product-graphing";case"graphing-3d":return"dcg-product-graphing-3d"}}getClassNames(){return`dcg-calculator-shell-menu ${this.getTypeClass()} ${this.getProductClass()}`}template(){return RL.createElement(oE,{position:this.const("bottom-left"),className:()=>this.getClassNames(),didMount:this.bindFn(this.onMountPopover),title:this.props.title,constrainHeight:this.const(!0),focusHelper:()=>this.focusHelper,style:()=>this.props.left?{left:`${this.props.left()}px`,right:"auto"}:void 0,arrowStyle:()=>this.props.arrowLeft?{left:`${this.props.arrowLeft()}px`,right:"auto"}:void 0},this.props.children)}didMount(){let e=this.props.type();this.guid=`menu-${e}`}};var{If:bwe}=ia.Components,E1=class extends ia.Class{init(){this.controller=this.props.controller(),this.userController=this.controller.userController}template(){return ia.createElement(bwe,{predicate:()=>this.userController.isLoggedIn()},()=>ia.createElement(Is,{type:this.props.type,label:()=>this.controller.s("account-shell-label-account-information"),left:this.props.left,arrowLeft:this.props.arrowLeft,controller:this.props.controller},ia.createElement("div",{class:ia.const("user-info")},ia.createElement("span",{class:ia.const("account-name")},()=>this.userController.getFullName()),ia.createElement("span",{class:ia.const("account-email")},()=>this.userController.getEmail()),ia.createElement("a",{class:ia.const("dcg-action-accountsettings"),role:ia.const("link"),tabIndex:ia.const(0),onTap:()=>this.controller.dispatch({type:"show-modal",modal:"account-settings"})},()=>this.controller.s("account-shell-link-account-settings"))),ia.createElement("a",{class:ia.const("dcg-action-logout"),role:ia.const("link"),tabIndex:ia.const(0),onTap:()=>this.logout()},()=>this.controller.s("account-shell-link-sign-out"))))}logout(){this.controller.dispatch({type:"toggle-menu",payload:"none"}),this.userController.logout()}};var{If:tD}=Io.Components,FL=class extends Io.Class{getAccountMenuArrowOffset(){var e,t;return this.props.controller().graphsController.isLegacyGeometryTool()?220:(t=(e=this.props).withArtContest)!=null&&t.call(e)?60:100}template(){let e=this.props.controller().userController;return Io.createElement("span",null,Io.createElement(tD,{predicate:()=>e.isLoggedIn()},()=>Io.createElement("span",null,Io.createElement(tD,{predicate:()=>e.isLoggingOut()},()=>Io.createElement("span",{class:Io.const("logout-progress-notice")},Io.createElement("span",{class:Io.const("dcg-spinner-dark")}))),Io.createElement(tD,{predicate:()=>!e.isLoggingOut()},()=>Io.createElement("button",{class:Io.const("dcg-unstyled-button dcg-account-link"),"dcg-menu-button":Io.const("account"),"aria-haspopup":Io.const("true"),"aria-expanded":()=>this.props.controller().getOpenMenu()==="account","aria-label":()=>this.props.controller().s("account-shell-label-account-information"),onTap:()=>{this.props.controller().dispatch({type:"toggle-menu",payload:"account"})}},Io.createElement("span",{class:Io.const("email")},Io.createElement("div",{class:Io.const("header-account-name dcg-variable-name")},()=>e.getFirstName()),Io.createElement("i",{class:Io.const("dcg-icon-caret-down"),"aria-hidden":Io.const("true")})))),Io.createElement(tD,{predicate:()=>this.props.controller().getOpenMenu()=="account"},()=>Io.createElement(E1,{type:this.const("account"),controller:this.props.controller,arrowLeft:this.bindFn(this.getAccountMenuArrowOffset)})))),Io.createElement(tD,{predicate:()=>!e.isLoggedIn()},()=>Io.createElement("span",{class:Io.const("dcg-login")},Io.createElement("button",{class:Io.const("dcg-sign-in dcg-action-login dcg-btn-white-outline"),onTap:()=>{this.props.controller().dispatch({type:"show-modal",modal:"authentication",fromButton:"log-in"})}},()=>this.props.controller().s("account-shell-button-log-in")),Io.createElement("button",{class:Io.const("dcg-create-account dcg-btn dcg-btn-blue dcg-action-createaccount"),onTap:()=>{this.props.controller().dispatch({type:"show-modal",modal:"authentication",fromButton:"sign-up"})}},()=>this.props.controller().s("account-shell-button-sign-up")))))}};var Ka=__dcg_shared_module_exports__['e'](Z());var{IfElse:ywe}=Ka.Components,NL=class extends Ka.Class{template(){return ywe(()=>this.showSavedGraphsRedesign(),{true:()=>Ka.createElement(ze,{tooltip:()=>this.openGraphText(),gravity:this.const("s")},Ka.createElement("button",{"aria-label":()=>this.openGraphText(),class:Ka.const("dcg-header-btn dcg-unstyled-button dcg-action-open-graphs-modal dcg-tooltip"),onTap:()=>{this.props.controller().dispatch({type:"show-modal",modal:"my-graphs"})}},Ka.createElement("i",{class:Ka.const("dcg-action-open-graphs-modal-folder-icon dcg-icon-folder-open"),"aria-hidden":Ka.const("true")}))),false:()=>Ka.createElement("span",{role:Ka.const("button"),tabIndex:Ka.const(0),"aria-label":()=>this.openGraphText(),class:Ka.const("dcg-header-btn dcg-action-opendrawer dcg-tooltip"),tooltip:()=>this.openGraphText(),onTap:()=>this.props.controller().dispatch({type:"open-mygraphs"})},Ka.createElement(ze,{tooltip:()=>this.openGraphText(),gravity:this.const("s"),offset:()=>({top:12})},Ka.createElement("i",{class:Ka.const("dcg-icon-hamburger"),"aria-hidden":Ka.const("true")})))})}showSavedGraphsRedesign(){return this.props.controller().userController.hasFeatureFlag("savedGraphsRedesign")&&!!Xn("savedGraphsRedesign")}openGraphText(){let e=this.props.controller().getOpenText();return qo?this.props.controller().s("account-shell-label-open-graph-mac",{open_graph:e}):this.props.controller().s("account-shell-label-open-graph-pc",{open_graph:e})}};var hi=__dcg_shared_module_exports__['e'](Z());var na=__dcg_shared_module_exports__['e'](Z());function Tte(r,e){if(!e.hasOwnProperty("myGraphs"))throw new Error("Argument Error: saveGraph options must specify myGraphs");if(!e.hasOwnProperty("isUpdate"))throw new Error("Argument Error: saveGraph options must specify isUpdate");let t={parent_hash:r.parentHash,thumb_data:r.thumbURL,hash:r.hash,my_graphs:!!e.myGraphs,is_update:!!e.isUpdate,title:r.title,state:r.graphData};return ts("/api/v1/calculator_3d/save",t).then(o=>(Da.updateFromSync(r,o),r))}var Gte=vw("/api/v1/calculator_3d/email_feedback"),Ite=pC("/api/v1/calculator_3d/my_graphs");function Mte(r){return ts("/api/v1/calculator_3d/my_graphs/remove",r)}function A5(r,e){if(!e.hasOwnProperty("myGraphs"))throw new Error("Argument Error: saveGraph options must specify myGraphs");if(!e.hasOwnProperty("isUpdate"))throw new Error("Argument Error: saveGraph options must specify isUpdate");let t={parent_hash:r.parentHash,recovery_parent_hash:r.recoveryParentHash,thumb_data:r.thumbURL,graph_hash:r.hash,my_graphs:e.myGraphs,is_update:e.isUpdate,recovery:e.recovery,title:r.title||void 0,calc_state:r.graphData,lang:e.lang,product:e.product};return ts("/api/v1/calculator/save",t).then(o=>(Da.updateFromSync(r,o),r))}var Vte=vw("/api/v1/calculator/email_feedback"),V5=pC("/api/v1/calculator/my_graphs"),Lte=pC("/api/v1/calculator/recovery_graphs"),Pte=vw("/api/v1/calculator/my_graphs/remove"),Ote=vw("/api/v1/calculator/recovery_graphs/clear");var or=__dcg_shared_module_exports__['e'](Z());$t();function xwe(r){var t;let e=(t=r==null?void 0:r.responseJSON)==null?void 0:t.errors;return Array.isArray(e)?e:void 0}function Cg(r,e,t){let o=xwe(r);return o===void 0?[t!=null?t:e("account-shell-error-unexpected-server",{email:"support@kiavash.com"})]:o.map(({key:i,message:n})=>i==="connection_failed"?e("account-shell-error-connection-failed"):n)}var eh="[^@\\s]+@[^@\\s]+\\.[^@\\s]+";var{If:rD,For:wwe,Input:vwe,Textarea:Cwe}=or.Components,BL=class extends or.Class{init(){this.controller=this.props.controller(),this.formErrors=[],this.feedbackInProgress=!1,this.didSendFeedbackEmail=!1}template(){return or.createElement("div",{class:or.const("dcg-suggestions")},or.createElement("div",{class:or.const("template-errors")},or.createElement(rD,{predicate:()=>!!this.formErrors.length},()=>or.createElement("span",null,or.createElement(wwe,{each:()=>this.formErrors},e=>or.createElement("div",{class:or.const("errors")},or.createElement("span",null,()=>e)))))),or.createElement("form",{didMount:this.bindFn(this.didMountContactForm),class:or.const("dcg-action-submit"),id:or.const("support-contact-us-form")},or.createElement("div",{class:or.const("dcg-feedback-message-label")},()=>this.controller.s("account-shell-label-feedback-message")),or.createElement(Cwe,{placeholder:()=>this.controller.s("account-shell-label-feedback-placeholder"),didMount:this.bindFn(this.didMountTextArea),disabled:()=>!this.shouldAllowSubmission(),class:or.const("dcg-shared-input-blue-outline dcg-contact-textarea"),name:or.const("message"),value:()=>this.controller.getFeedbackMessage(),onInput:e=>{this.controller.dispatch({type:"update-feedback-message",message:e})}}),or.createElement("div",{class:or.const("dcg-suggestions-expansion")},or.createElement("div",{class:or.const("dcg-feedback-email-label")},()=>this.controller.s("account-shell-label-feedback-email")),or.createElement(vwe,{name:or.const("provided-email"),class:or.const("dcg-provided-email dcg-shared-input-blue-outline"),placeholder:()=>this.controller.s("account-shell-label-email-placeholder"),disabled:()=>!this.shouldAllowSubmission(),type:or.const("email"),pattern:this.const(eh),value:()=>this.controller.getFeedbackEmail(),onInput:e=>{this.controller.dispatch({type:"update-feedback-email",email:e})}}),or.createElement("div",{class:or.const("dcg-feedback-action-container")},or.createElement(rD,{predicate:()=>this.feedbackInProgress},()=>or.createElement("div",{class:or.const("dcg-template-processing")},or.createElement("span",{class:or.const("dcg-spinner")}),()=>this.controller.s("account-shell-label-feedback-sending"))),or.createElement(rD,{predicate:()=>this.didSendFeedbackEmail},()=>or.createElement("div",{class:or.const("dcg-template-sent")},or.createElement("i",{class:or.const("dcg-icon-check"),"aria-hidden":or.const("true")}),()=>this.controller.s("account-shell-text-feedback-sent"))),or.createElement(rD,{predicate:this.bindFn(this.shouldAllowSubmission)},()=>or.createElement("span",{class:or.const("dcg-feedback-btns")},or.createElement(rD,{predicate:()=>!this.controller.contactFormStartsOpen()},()=>or.createElement("button",{class:or.const("dcg-unstyled-button dcg-action-closesuggestion"),onTap:this.bindFn(this.onCancel)},()=>this.controller.s("account-shell-button-cancel"))),or.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.submitDisabled()}),name:or.const("submit"),type:or.const("submit")},()=>this.controller.s("account-shell-button-contact-us"))))))))}willUnmount(){this.controller.getFeedbackMessage().trim()||this.controller.clearForm()}submitDisabled(){return!this.controller.getFeedbackMessage()}didMountContactForm(e){return re(e).on("submit",t=>(t.preventDefault(),this.submitForm()))}didMountTextArea(e){e.focus(),e.select()}shouldAllowSubmission(){return!this.feedbackInProgress&&!this.didSendFeedbackEmail}onCancel(){this.controller.setFeedbackMessage(""),this.controller.dispatch({type:"show-contact-form",showForm:!1})}async submitForm(){if(this.submitDisabled())return;this.didSendFeedbackEmail=!1,this.feedbackInProgress=!0,this.formErrors=[];let e=this.controller.getFeedbackMessage(),t=this.controller.product;if(t!=="graphing"&&t!=="graphing-3d"&&t!=="geometry-calculator")throw new Error(`Unexpected product: ${t}`);let o=this.controller.getFeedbackEmail(),i={message:e,state:JSON.stringify(this.controller.api.getState()),userAgent:navigator.userAgent,"provided-email":o||"",lang:this.controller.getLanguage(),todoExtraData:!0};this.controller.dispatch({type:"render"});try{t==="graphing-3d"?await Gte(i):await Vte({...i,product:t}),this.didSendFeedbackEmail=!0,setTimeout(()=>{this.controller.clearForm(),this.didSendFeedbackEmail=!1,this.controller.dispatch({type:"render"})},2e3)}catch(n){this.formErrors=Cg(n,this.controller.s).map(a=>this.controller.raw(a))}finally{this.feedbackInProgress=!1,this.controller.dispatch({type:"render"})}}};var{IfElse:Fte}=na.Components,wf=class extends na.Class{handleClick(){this.props.controller().dispatch({type:"show-contact-form",showForm:!0})}template(){return na.createElement("div",{class:na.const("dcg-hide-on-mobile"),"aria-label":()=>this.props.controller().s("account-shell-label-feedback")},Fte(()=>this.props.controller().requestedContactForm()||this.props.controller().contactFormStartsOpen(),{true:()=>na.createElement("div",{class:na.const("dcg-resources-content dcg-feedback-content")},na.createElement(BL,{controller:this.props.controller})),false:()=>na.createElement("div",{class:na.const("dcg-contact-us")},na.createElement("button",{class:na.const("dcg-unstyled-button dcg-contact-link"),"aria-expanded":na.const("false"),"aria-controls":na.const("support-contact-us-form"),onTap:this.bindFn(this.handleClick)},na.createElement("i",{class:na.const("dcg-icon-mail"),"aria-hidden":na.const("true")}),Fte(()=>this.props.controller().product==="graphing-3d",{true:()=>na.createElement("span",null,()=>this.props.controller().s("account-shell-link-send-feedback")),false:()=>na.createElement("span",null,()=>this.props.controller().s("account-shell-link-email-support"))})))}))}};var Oo=__dcg_shared_module_exports__['e'](Z());var oc=class extends Oo.Class{template(){return Oo.createElement("a",{href:()=>this.props.href(),target:Oo.const("_blank"),class:Oo.const("dcg-resource-link")},Oo.createElement("i",{class:()=>this.props.icon(),"aria-hidden":Oo.const("true")}),Oo.createElement("span",null,()=>this.props.title(),Oo.const(" ")))}},UL=class extends Oo.Class{init(){this.controller=this.props.controller()}template(){return Oo.createElement("div",{class:Oo.const("dcg-resources-content"),role:Oo.const("region"),"aria-label":()=>this.controller.s("account-shell-heading-resources")},Oo.createElement(oc,{href:Oo.const("https://help.kiavash.com/hc/en-us/articles/4406040715149-Getting-Started-kiavash-Graphing-Calculator"),icon:Oo.const("dcg-icon-rocket"),title:()=>this.controller.s("account-shell-link-getting-started")}),Oo.createElement(oc,{href:Oo.const("https://www.youtube.com/playlist?list=PLfM6zMGnbgOGLZc-_Yj3QVK3Vz_L4Cw59"),icon:Oo.const("dcg-icon-film"),title:()=>this.controller.s("account-shell-link-video-tutorials")}),Oo.createElement(oc,{href:()=>{var t;let e=(t=this.controller.languageController)==null?void 0:t.getLanguage();return e&&Xc[e]?Xc[e].userGuideURL:Xc.en.userGuideURL},icon:Oo.const("dcg-icon-book"),title:()=>this.controller.s("account-shell-link-user-guide")}),Oo.createElement(oc,{href:Oo.const("https://help.kiavash.com/"),icon:Oo.const("dcg-icon-comments"),title:()=>this.controller.s("account-shell-link-help-center")}),Oo.createElement(oc,{href:()=>"https://help.kiavash.com/hc/en-us/articles/212235786-Supported-Functions",icon:Oo.const("dcg-icon-check"),title:()=>this.controller.s("shared-heading-keyboard-shortcuts-supported-functions")}),Oo.createElement("button",{class:Oo.const("dcg-unstyled-button dcg-resource-link dcg-action-show-hotkeys"),onTap:()=>this.controller.dispatch({type:"show-modal",modal:"hotkeys"})},Oo.createElement("i",{class:Oo.const("dcg-icon-keyboard"),"aria-hidden":Oo.const("true")}),Oo.createElement("span",null,()=>this.controller.s("account-shell-link-keyboard-shortcuts"))))}};var qL=class extends hi.Class{init(){this.controller=this.props.controller()}template(){return hi.createElement(Is,{title:()=>this.controller.s("account-shell-heading-resources"),type:()=>"help",label:()=>this.controller.s("account-shell-label-help-menu"),controller:this.props.controller},hi.createElement("div",{class:hi.const("dcg-resources-content"),role:hi.const("region")},hi.createElement("button",{class:hi.const("dcg-unstyled-button dcg-resource-link dcg-action-show-quests"),onTap:this.bindFn(this.showQuestsModal)},hi.createElement("i",{class:hi.const("dcg-icon-scroll"),"aria-hidden":hi.const("true")}),hi.createElement("span",null,()=>this.controller.s("account-shell-label-try-a-quest-title"))),hi.createElement(oc,{href:()=>"https://docs.google.com/document/d/1jDJC0Zw7cB82SNEc04m5HGQHaXYaJK62iZM88ojNYwI/preview",icon:hi.const("dcg-icon-book"),title:()=>this.controller.s("account-shell-link-3d-user-guide")}),hi.createElement(oc,{href:hi.const("https://help.kiavash.com/"),icon:hi.const("dcg-icon-comments"),title:()=>this.controller.s("account-shell-link-help-center")}),hi.createElement(oc,{href:()=>"https://help.kiavash.com/hc/en-us/articles/212235786-Supported-Functions",icon:hi.const("dcg-icon-check"),title:()=>this.controller.s("shared-heading-keyboard-shortcuts-supported-functions")}),hi.createElement("button",{class:hi.const("dcg-unstyled-button dcg-resource-link dcg-action-show-hotkeys"),onTap:()=>this.controller.dispatch({type:"show-modal",modal:"hotkeys"})},hi.createElement("i",{class:hi.const("dcg-icon-keyboard"),"aria-hidden":hi.const("true")}),hi.createElement("span",null,()=>this.controller.s("account-shell-link-keyboard-shortcuts")))),hi.createElement("h2",{class:hi.const("dcg-unstyled-heading dcg-help-menu-title dcg-hide-on-mobile")},()=>this.controller.s("account-shell-heading-contact-us")),hi.createElement(wf,{controller:this.props.controller}))}showQuestsModal(){var e;co({category:"quest",action:"show-all-from-help-menu"}),(e=this.controller.tourController)==null||e.setQuestsListModalVisibility(!0),this.controller.dispatch({type:"toggle-menu",payload:"none"})}};var L5={US:"United States",AF:"Afghanistan",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",CV:"Cabo Verde",KH:"Cambodia",CM:"Cameroon",CA:"Canada",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CD:"Congo (the Democratic Republic of the)",CG:"Congo",CK:"Cook Islands",CR:"Costa Rica",HR:"Croatia",CU:"Cuba",CW:"Cura\xE7ao",CY:"Cyprus",CZ:"Czechia",CI:"C\xF4te d'Ivoire",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",SZ:"Eswatini",ET:"Ethiopia",FK:"Falkland Islands [Malvinas]",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"North Korea",KR:"South Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MK:"North Macedonia",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",RE:"R\xE9union",BL:"Saint Barth\xE9lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",TR:"T\xFCrkiye",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Viet Nam",VG:"Virgin Islands (British)",VI:"Virgin Islands (U.S.)",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe",AX:"\xC5land Islands"},Swe=Object.values(L5),Nte=r=>!!r&&Swe.indexOf(r)!==-1,Bte={Algeria:13,Angola:13,"Antigua and Barbuda":16,Argentina:18,Armenia:18,Australia:15,Austria:14,Azerbaijan:20,Bahamas:16,Barbados:18,Bangladesh:18,Belgium:13,Belize:16,Benin:13,Bolivia:14,Botswana:13,Brazil:13,Bulgaria:14,"Burkina Faso":13,Burundi:13,Cameroon:13,Canada:16,"Cabo Verde":13,"Central African Republic":13,Chad:13,Chile:18,China:14,Colombia:18,Comoros:13,Congo:13,"Costa Rica":15,"C\xF4te d'Ivoire":13,Croatia:16,Cyprus:14,Czechia:15,Denmark:13,Djibouti:13,"Dominican Republic":16,Ecuador:14,Egypt:18,"El Salvador":18,"Equatorial Guinea":13,Eritrea:13,Estonia:13,Ethiopia:13,Finland:13,France:15,Gabon:13,Gambia:13,Germany:16,Ghana:13,Gibraltar:16,Greece:15,Grenada:16,Guatemala:16,Guinea:13,Guyana:16,Haiti:16,"Hong Kong":20,Hungary:16,Iceland:18,India:18,Indonesia:21,Ireland:16,Israel:14,Italy:14,Jamaica:16,Japan:20,Jordan:16,Kazakhstan:18,Kenya:13,Kuwait:17,Kyrgyzstan:18,Latvia:13,Lebanon:18,Lesotho:13,Liberia:13,Libya:13,Lithuania:14,Luxembourg:16,"North Macedonia":14,Madagascar:13,Malawi:13,Malaysia:18,Mali:13,Malta:13,Mauritania:13,Mauritius:13,Mexico:18,Moldova:18,Morocco:18,Mozambique:13,Namibia:13,Nepal:16,Netherlands:16,"New Zealand":16,Niger:13,Nigeria:13,Norway:15,Pakistan:18,Panama:18,Paraguay:20,Peru:15,Philippines:18,Poland:16,Portugal:13,"Puerto Rico":18,R\u00E9union:13,Romania:16,"Russian Federation":18,Rwanda:13,"Saint Lucia":16,"Saint Vincent and the Grenadines":15,"Sao Tome and Principe":13,"Saudi Arabia":20,Senegal:13,Serbia:18,Seychelles:13,"Sierra Leone":13,Singapore:13,Slovakia:16,Slovenia:16,Somalia:13,"South Africa":18,"South Korea":14,"South Sudan":13,Spain:14,"Sri Lanka":18,Sudan:13,Suriname:16,Eswatini:13,Sweden:13,Switzerland:18,Taiwan:18,Tajikistan:18,Tanzania:13,Thailand:20,Togo:13,"Trinidad and Tobago":16,Tunisia:13,T\u00FCrkiye:16,Uganda:13,Ukraine:14,"United Arab Emirates":18,"United Kingdom":13,"United States":13,Uruguay:18,Uzbekistan:18,Venezuela:18,"Western Sahara":13,"Viet Nam":18,Yemen:9,Zambia:13,Zimbabwe:13};var pt=__dcg_shared_module_exports__['e'](Z());tu();function P5(){return ts("/account/logout_xhr")}async function Ute(r){return await P5(),await ts("/account/login_xhr",r),D1({lang:r.lang})}function qte(r){if("loggedIn"in r&&!r.loggedIn)throw r;return r}async function D1(r){return qte(await Gd("/account/user_info",r))}async function zL(){return qte(await Gd("/account/user_info?no401"))}var zte=r=>jf(()=>ts("/account/check_account_status",r)),Hte=async r=>(await ts("/account/register_xhr",r),D1({lang:r.lang})),Ewe={google:"/drive_api/calculator/login",apple:"/apple_api/calculator/login"},Kte=r=>`${mb()}${Ewe[r]}`;function Wte(r,{classifications:e}){jf(()=>v7(`/account/${r}/metadata`,{metadata:{selfClassifications:e}}))}async function $te(r){return await ts("/account/change_name",r),D1({lang:r.lang})}async function jte(r){return await ts("/account/change_name_detail",{lang:r.lang,userProvidedName:{given:r.given,family:r.family}}),D1({lang:r.lang})}function Yte(r){return ts("/account/recover_xhr",r)}function Xte(r){return Gd("/account/initiate_delete_account",r)}function Jte(r){return Gd("/account/initiate_email_change",r)}async function Qte(r){return await ts("/account/set_email",r),D1({lang:r.lang})}async function Zte(r){return await C7("/account/update_feature_flags",r),D1({lang:r.lang})}var O5=2023;function ere(r){return ts(`/account/art_contest_submissions${r.submission_id?`/${r.submission_id}`:""}`,r)}async function k1(r=void 0,e=O5){var i;let t=Xn("userId"),o;try{o=(i=await Gd("/account/art_contest_submissions",{year:String(e),product:r,userId:t}))!=null?i:[]}catch(n){if((n==null?void 0:n.status)!==401)throw n;return[]}return Array.isArray(o)?o:[o]}var tre=r=>jf(()=>Gd(`/account/${r}/registration`));var{For:rre,If:R5,IfElse:F5,SwitchUnion:kwe}=pt.Components,ore=["graphing","geometry-calculator","graphing-3d"],HL=class extends pt.Class{init(){this.entry=this.props.entry(),this.controller=this.props.controller()}getThumbAlt(){var e,t;return(e=this.entry)!=null&&e.title&&this.entry.title!==""?this.controller.s("frontpage-narration-art-contest-image-of-graph",{graphTitle:this.entry.title}):(t=this.entry)!=null&&t.name?this.controller.s("frontpage-narration-art-contest-image-of-graph-by",{name:this.entry.name}):""}template(){return pt.createElement("div",null,F5(()=>!!this.entry&&!!this.entry.url,{true:()=>pt.createElement("img",{class:pt.const("dcg-submission-image"),src:()=>{var e;return(e=this.entry)==null?void 0:e.thumb},alt:this.bindFn(this.getThumbAlt)}),false:()=>pt.createElement("i",{class:()=>this.getIconName(this.props.product()),"aria-hidden":pt.const("true")})}))}getIconName(e){switch(e){case"geometry-calculator":return"dcg-icon-geometry";case"graphing":return"dcg-icon-graphing";case"graphing-3d":return"dcg-icon-3d"}}},KL=class extends pt.Class{init(){this.controller=this.props.controller(),this.checkForExistingSubmission()}getScreen(){let e=Xn("artStatus");if(e==="fetching")return"fetching";if(e==="failed")return"fetch-failed";if(this.controller.userController.isLoggedIn()){if(this.isFetchingSubmissions)return"fetching";if(this.fetchSubmissionsFailed)return"fetch-failed"}else return"needs-authentication";return"showing-submissions"}getTitle(e){switch(e){case"geometry-calculator":return this.controller.s("frontpage-link-shared-geometry-short");case"graphing":return this.controller.s("frontpage-link-shared-graphing-calculator-short");case"graphing-3d":return this.controller.s("frontpage-link-shared-3d-calculator-short")}}isSubmissionEligible(){return this.controller.isGraphComplexEnoughForContest()&&!this.controller.graphsController.willSaveCopy()}template(){return pt.createElement(Is,{type:()=>"art-contest",label:()=>this.controller.s("account-shell-heading-math-art-contest"),controller:this.props.controller},pt.createElement("h2",{class:pt.const("dcg-art-contest-header")},()=>this.controller.s("account-shell-heading-math-art-contest")),pt.createElement("div",{class:pt.const("dcg-art-contest-announcement")},pt.createElement("div",{class:pt.const("dcg-contest-top-paragraph")},pt.createElement(R5,{predicate:()=>this.controller.getArtExpoState()==="open"},()=>pt.createElement(vr,{key:this.const("account-shell-text-art-contest-has-arrived"),i18n:this.props.controller},pt.const("Have a graph that you're proud of? We'd love to see it! Learn more at"),pt.const(" "),pt.createElement("a",{href:pt.const("/art"),target:pt.const("_blank"),class:pt.const("dcg-blue-link")},pt.const("kiavash.com/art"),pt.createElement("span",{class:pt.const("dcg-sr-only")},pt.const(" (opens in new tab)"))),pt.const("."))),pt.createElement(R5,{predicate:()=>this.controller.getArtExpoState()==="closed"},()=>pt.createElement(vr,{key:this.const("account-shell-text-art-contest-has-closed"),i18n:this.props.controller},pt.const("This year's contest is now closed. We're hard at work looking through all of the incredible creations, and will post results soon at"),pt.const(" "),pt.createElement("a",{href:pt.const("/art"),target:pt.const("_blank"),class:pt.const("dcg-blue-link")},pt.const("kiavash.com/art"),pt.createElement("span",{class:pt.const("dcg-sr-only")},pt.const(" (opens in new tab)"))),pt.const("."))))),pt.createElement(R5,{predicate:()=>this.controller.getArtExpoState()==="open"},()=>kwe(()=>this.getScreen(),{"needs-authentication":()=>pt.createElement("div",{class:pt.const("dcg-contest-status-section")},pt.createElement("button",{class:pt.const("dcg-btn-blue-outline"),onTap:()=>{this.props.controller().dispatch({type:"show-modal",modal:"authentication"})}},()=>this.controller.s("account-shell-error-art-contest-logged-out")),pt.createElement("div",{class:pt.const("dcg-contest-deadline-notice")},()=>this.controller.s("account-shell-text-art-contest-deadline-notice"))),fetching:()=>pt.createElement("div",{class:pt.const("dcg-contest-status-section")},pt.createElement("ul",{class:pt.const("dcg-submissions")},pt.createElement(rre,{each:()=>ore},e=>pt.createElement("li",{class:pt.const("dcg-submission dcg-submission-loading")}))),pt.createElement("div",{class:pt.const("dcg-contest-deadline-notice")},()=>this.controller.s("account-shell-text-art-contest-loading-submissions"))),"fetch-failed":()=>pt.createElement("div",{class:pt.const("dcg-contest-status-section")},pt.createElement("div",{class:pt.const("dcg-error-message")},()=>this.controller.s("frontpage-error-something-went-wrong-try-again-later")),pt.createElement("button",{class:pt.const("dcg-btn-blue-outline"),onTap:this.bindFn(this.checkForExistingSubmission)},()=>this.controller.s("account-shell-button-mygraphs-try-again"))),"showing-submissions":()=>pt.createElement("div",{class:pt.const("dcg-contest-status-section")},pt.createElement("ul",{class:pt.const("dcg-submissions")},pt.createElement(rre,{each:()=>ore},e=>{var o;let t=(o=this.submissions)==null?void 0:o.find(i=>(i==null?void 0:i.product)===e);return pt.createElement("li",null,F5(()=>this.isCurrentProduct(e),{false:()=>pt.createElement("a",{class:()=>({"dcg-submission":!0,"dcg-not-yet-submitted":!t}),href:()=>this.getEntryURL(e,t),target:pt.const("_blank"),"aria-label":()=>this.getTileAriaLabel(e,t)},pt.createElement(HL,{entry:()=>t,product:()=>e,controller:()=>this.controller})),true:()=>pt.createElement("button",{class:()=>({"dcg-disabled":this.disableTileLink(e,t),"dcg-submission":!0,"dcg-not-yet-submitted":!t}),disabled:()=>this.disableTileLink(e,t)?!0:void 0,"aria-label":()=>this.getTileAriaLabel(e,t),onTap:()=>{this.disableTileLink(e,t)||this.controller.dispatch({type:"show-modal",modal:"contest-submission",currentSubmission:this.currentToolSubmission})}},pt.createElement(HL,{entry:()=>t,product:()=>e,controller:()=>this.controller}))}),pt.createElement("h3",{class:pt.const("dcg-submission-title")},this.const(this.getTitle(e))))})),pt.createElement("div",null,pt.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.disableButtonLink()}),onTap:()=>{this.controller.logEvent({category:"art-contest",action:"open-modal"}),this.controller.dispatch({type:"show-modal",modal:"contest-submission",currentSubmission:this.getCurrentSubmission()})},disabled:()=>this.disableButtonLink()?!0:void 0},F5(()=>!!this.getCurrentSubmissionId(),{true:()=>pt.createElement("span",null,()=>this.controller.isGraphComplexEnoughForContest()?this.controller.s("account-shell-text-art-contest-view-or-update-submission"):this.controller.s("account-shell-text-art-contest-view-submission")),false:()=>pt.createElement("span",null,()=>this.controller.getProduct()==="geometry-calculator"?this.controller.s("account-shell-text-art-contest-submit-construction"):this.controller.s("account-shell-text-art-contest-submit-graph"))}))),pt.createElement("div",{class:pt.const("dcg-contest-deadline-notice")},()=>this.isSubmissionEligible()?this.controller.s("account-shell-text-art-contest-deadline-notice"):this.controller.s("account-shell-text-art-contest-create-graph-notice")))})))}disableButtonLink(){return!this.isSubmissionEligible()&&!this.currentToolSubmission}disableTileLink(e,t){return this.isCurrentProduct(e)&&!t&&!this.isSubmissionEligible()}getEntryURL(e,t){if(t&&t.url)return t.url;switch(e){case"geometry-calculator":return"/geometry";case"graphing":return"/calculator";case"graphing-3d":return"/3d"}}getTileAriaLabel(e,t){if(this.disableTileLink(e,t))return;let o="";if(t)switch(e){case"geometry-calculator":o=this.controller.s("account-shell-text-art-contest-your-geometry-submission");break;case"graphing":o=this.controller.s("account-shell-text-art-contest-your-2d-submission");break;case"graphing-3d":o=this.controller.s("account-shell-text-art-contest-your-3d-submission");break}else switch(e){case"geometry-calculator":o=this.controller.s("frontpage-link-shared-geometry-short");break;case"graphing":o=this.controller.s("frontpage-link-shared-graphing-calculator-short");break;case"graphing-3d":o=this.controller.s("frontpage-link-shared-3d-calculator-short");break}return this.isCurrentProduct(e)?o:this.controller.s("shared-label-opens-in-new-tab-suffix",{title:o})}isCurrentProduct(e){return this.controller.getProduct()===e}getCurrentSubmissionId(){let e=this.getCurrentSubmission();if("submission_id"in e&&e.submission_id)return e.submission_id}getCurrentSubmission(){var o,i,n,a;if(this.currentToolSubmission)return this.currentToolSubmission;let e=this.controller.getProduct();if(e==="geometry")throw new Error("Art contest does not work on legacy geometry tool.");let t=(i=(o=this.submissions)==null?void 0:o[0])==null?void 0:i.country;return Nte(t)||(t=void 0),{product:e,graph_hash:this.controller.graphsController.getCurrentGraphHash(),title:this.controller.graphsController.getCurrentGraphTitle(),submitting_for_someone_else:!1,birth_year:(a=(n=this.submissions)==null?void 0:n[0])==null?void 0:a.birth_year,country:t}}async checkForExistingSubmission(){if(this.controller.userController.isLoggedIn()){this.isFetchingSubmissions=!0,this.fetchSubmissionsFailed=!1;try{let e=await k1();if(!this._isMounted)return;let t=e.filter(o=>(o==null?void 0:o.user_id)===this.controller.userController.getUserId()&&!(o!=null&&o.submitting_for_someone_else));this.currentToolSubmission=t.find(o=>o.product===this.controller.getProduct()),this.submissions=t}catch(e){if(!this._isMounted)return;this.fetchSubmissionsFailed=!0}finally{this._isMounted&&(this.isFetchingSubmissions=!1,this.update())}}}};var _n=__dcg_shared_module_exports__['e'](Z());var WL=class extends _n.Class{init(){this.controller=this.props.controller()}template(){return _n.createElement(Is,{title:()=>this.controller.s("account-shell-heading-resources"),type:()=>"help",label:()=>this.controller.s("account-shell-label-help-menu"),controller:this.props.controller},_n.createElement("div",{class:_n.const("dcg-resources-content"),role:_n.const("region"),"aria-label":()=>this.controller.s("account-shell-heading-resources")},_n.createElement(oc,{href:()=>"https://docs.google.com/document/d/1u4fhQsXWzdCWRGfTdJSuAg9xtyiDk-wmkIAsUkb2L20/preview",icon:_n.const("dcg-icon-book"),title:()=>this.controller.s("account-shell-link-geometry-user-guide")}),_n.createElement(oc,{href:_n.const("https://help.kiavash.com/"),icon:_n.const("dcg-icon-comments"),title:()=>this.controller.s("account-shell-link-help-center")}),_n.createElement(oc,{href:()=>"https://help.kiavash.com/hc/en-us/articles/212235786-Supported-Functions",icon:_n.const("dcg-icon-check"),title:()=>this.controller.s("shared-heading-keyboard-shortcuts-supported-functions")}),_n.createElement("button",{class:_n.const("dcg-unstyled-button dcg-resource-link dcg-action-show-hotkeys"),onTap:()=>this.controller.dispatch({type:"show-modal",modal:"hotkeys"})},_n.createElement("i",{class:_n.const("dcg-icon-keyboard"),"aria-hidden":_n.const("true")}),_n.createElement("span",null,()=>this.controller.s("account-shell-link-keyboard-shortcuts")))),_n.createElement("h2",{class:_n.const("dcg-unstyled-heading dcg-help-menu-title dcg-hide-on-mobile")},()=>this.controller.s("account-shell-heading-contact-us")),_n.createElement(wf,{controller:this.props.controller}))}};var aa=__dcg_shared_module_exports__['e'](Z());var oD=__dcg_shared_module_exports__['e'](Z());var _we=28,Twe=10,N5=4,$L=class extends oD.Class{template(){return oD.createElement(Is,{type:this.const("graph-actions"),label:()=>this.props.controller().s("account-shell-label-graph-actions"),controller:this.props.controller,left:()=>this.left,arrowLeft:()=>this.arrowLeft},oD.createElement(l1,{class:this.const("dcg-graph-actions-list"),options:this.bindFn(this.getOptions),onTap:this.bindFn(this.tapOption)}))}didMount(){var n,a,s,l;let e=document.querySelector(".dcg-graph-actions-dropdown-anchor"),t=((a=(n=wi(e))==null?void 0:n.left)!=null?a:0)+((s=e.getBoundingClientRect().width)!=null?s:0)/2,i=((l=document.querySelector(".dcg-graph-actions-container").getBoundingClientRect().width)!=null?l:0)-_we/2-Twe;t<=i+N5?(this.left=N5,this.arrowLeft=t-N5):(this.left=t-i,this.arrowLeft=i),this.update()}getOptions(){let e=[];return e.push({title:()=>this.props.controller().s("account-shell-button-rename"),icon:"dcg-icon-pencil",class:"dcg-blue-link",action:()=>{this.props.controller().dispatch({type:"show-modal",modal:"rename"})}}),this.props.controller().graphsController.wasCurrentGraphEverSaved()&&e.push({title:()=>this.props.controller().s("account-shell-button-duplicate"),icon:"dcg-icon-duplicate",action:()=>this.props.controller().dispatch({type:"show-modal",modal:"duplicate"})}),e}tapOption(e){e.action!==void 0&&e.action(),!e.preventClose&&("href"in e?e.isDeepLink&&setTimeout(()=>this.closeMenu()):this.closeMenu())}closeMenu(){this.props.controller().dispatch({type:"toggle-menu",payload:"graph-actions"})}};var _a=__dcg_shared_module_exports__['e'](Z());var{SwitchUnion:Gwe}=_a.Components,jL=class extends _a.Class{init(){this.controller=this.props.controller(),this.graphsController=this.controller.graphsController}getSaveStatus(){return this.graphsController.isSaving()?"saving":this.graphsController.didSaveSucceed()?"save-success":"default"}getSaveMessage(){return this.graphsController.willSaveCopy()?this.controller.s("account-shell-button-save-copy"):this.controller.s("account-shell-button-save")}template(){return _a.createElement("span",null,Gwe(()=>this.getSaveStatus(),{saving:()=>_a.createElement("span",{class:_a.const("dcg-if-user save-btn-container")},_a.createElement("span",{class:_a.const("saving-notice")},_a.createElement("span",{class:_a.const("dcg-spinner-dark")}))),"save-success":()=>_a.createElement("span",{class:_a.const("dcg-save-success")},_a.createElement("i",{class:_a.const("dcg-icon-check")}),()=>this.controller.s("shared-calculator-label-saved")),default:()=>_a.createElement("span",{class:()=>({"dcg-if-user save-btn-container":!0})},_a.createElement(ze,{tooltip:()=>this.controller.isSaveEnabled()?this.saveChangesText():this.controller.s("account-shell-label-no-unsaved-changes"),offset:()=>({top:7})},_a.createElement("span",{role:_a.const("button"),class:()=>({"dcg-action-save":!0,"tooltip-offset":!0,"dcg-btn-blue":this.controller.isSaveEnabled(),"dcg-disabled":!this.controller.isSaveEnabled()}),onTap:()=>{this.controller.isSaveEnabled()&&this.controller.simpleSave()}},()=>this.getSaveMessage())))}))}saveChangesText(){return qo?this.controller.s("account-shell-label-save-changes-mac"):this.controller.s("account-shell-label-save-changes-pc")}};var{If:ire}=aa.Components,YL=class extends aa.Class{init(){this.controller=this.props.controller(),this.graphsController=this.controller.graphsController}getTitle(){return this.graphsController.getCurrentGraphTitle()||this.graphsController.getUntitledString()}template(){return aa.createElement("span",{class:aa.const("title-div")},aa.createElement("span",{role:aa.const("button"),class:aa.const("dcg-variable-title-container"),"dcg-menu-button":()=>this.shouldShowDropdown()?"graph-actions":void 0,tabIndex:aa.const(0),onTap:e=>{this.shouldShowDropdown()?this.openGraphActionsDropdown(e):this.shouldOpenSaveDialog()&&this.controller.dispatch({type:"edit-title"})},"aria-haspopup":()=>this.shouldShowDropdown(),"aria-expanded":()=>this.props.controller().getOpenMenu()=="graph-actions","aria-label":()=>this.shouldShowDropdown()?this.controller.s("account-shell-label-graph-actions"):void 0},aa.createElement("h1",{class:()=>({"dcg-variable-title dcg-tooltip":!0,"dcg-action-savedialog":this.shouldOpenSaveDialog()})},()=>this.getTitle()),aa.createElement(ire,{predicate:this.bindFn(this.shouldShowDropdown)},()=>aa.createElement("span",{class:aa.const("dcg-graph-actions-dropdown-anchor")},aa.createElement("i",{class:aa.const("dcg-icon-caret-down"),"aria-hidden":aa.const("true")}))),aa.createElement(ire,{predicate:()=>this.controller.getOpenMenu()==="graph-actions"},()=>aa.createElement($L,{controller:this.props.controller}))),aa.createElement(jL,{controller:this.props.controller}))}shouldOpenSaveDialog(){return this.controller.product==="geometry"}shouldShowDropdown(){return this.controller.product!=="geometry"&&this.graphsController.wasCurrentGraphEverSaved()}openGraphActionsDropdown(e){this.props.controller().dispatch({type:"toggle-menu",payload:"graph-actions"}),e&&e.device==="keyboard"&&this.controller.getOpenMenu()!=="share"&&document.querySelectorAll(".dcg-graph-actions-container .dcg-dropdown-choice:not(.dcg-disabled)")[0].focus()}};var Sg=__dcg_shared_module_exports__['e'](Z());var wy=class extends Sg.Class{init(){this.controller=this.props.controller()}template(){return this.controller=this.props.controller(),Sg.createElement(ze,{tooltip:this.props.tooltip,gravity:this.bindFn(this.getGravity)},Sg.createElement("button",{"aria-haspopup":Sg.const("true"),"aria-label":()=>this.props.label(),"aria-expanded":()=>this.isMenuOpen(),class:()=>({"dcg-unstyled-button":!0,"dcg-header-btn":!0,[this.getBtnClass()]:!0,"dcg-tooltip":!0,"dcg-active":this.isMenuOpen()}),"dcg-menu-button":this.props.name,onTap:this.props.onTap},Sg.createElement("i",{class:this.props.icon,"aria-hidden":Sg.const("true")})))}getBtnClass(){switch(this.props.name()){case"help":return"dcg-action-help";case"language":return"dcg-action-language";case"share":return"dcg-action-share";case"art-contest":return"dcg-action-contest"}}getGravity(){return this.props.gravity?this.props.gravity():"s"}isMenuOpen(){return this.controller.getOpenMenu()===this.props.name()}};var Zd=__dcg_shared_module_exports__['e'](Z());var th=class extends xf{checkGuardrails(){}advanceTour(){}getCurrentStep(){let e=this.getCurrentStepBase();if(e){let t=e.getBlock();return this.cachedLastBlock&&(D5(t,this.cachedLastBlock)||(this.nextUpdateTime=void 0)),this.cachedLastBlock=t,e.type==="final"&&(this.nextUpdateTime||(this.nextUpdateTime=Date.now()+5e3-1,this.tourController.addInterval(500))),e}}};var XL=class extends th{shouldPopup(){return!!this.getMatchingExpNode(S5)}restrictedLineTour(){if(this.resourcesOpen())return this.requireResourcesNotOpen();if(!this.expressionsVisible())return this.requireExpressionsVisible();let e=this.getMatchingExpNode([v5,gte]),t=this.getMatchingExpNode(C5);if(e)return t?(this.completedPhase1=!0,this.getCurrentStepBase()):{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-brilliant"),content:this.controller.s("graphing-tours-label-restrictions-new-expression"),target:{selector:".dcg-new-math-div"}})};let o=this.getMatchingExpId(w1),i=this.getExpressionNodeById(o),n=this.getModelById(o);if(i&&n){let a=this.expMatches(n,w5);return this.expMatches(n,y5)?void 0:a?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-awesome"),content:[],innerHTML:[this.controller.s("graphing-tours-label-restrictions-domain",{sample_expression:'<span class="dcg-trip-math">\\left\\{x<0\\right\\}</span>'}),"<br><i>"+this.controller.s("graphing-tours-label-restrictions-abc",{buttons:"{ }"})+"</i>"].join(""),target:{element:i}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-restrictions-start"),content:[],innerHTML:this.controller.s("graphing-tours-label-restrictions-straight-line",{sample_expression:'<span class="dcg-trip-math">y=2x</span>'}),target:{element:i}}),delayBeforeExit:500}}return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-restrictions-blank-expression"),target:{selector:".dcg-new-math-div"}})}}restrictedParabolaTour(){if(this.resourcesOpen())return this.requireResourcesNotOpen();if(!this.expressionsVisible())return this.requireExpressionsVisible();if(this.getMatchingExpNode([mte,jE]))return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-restrictions-star"),content:[],target:{selector:".dcg-exppanel-container"}}),type:"final"};let t=this.getMatchingExpId([C5,vL]),o=this.getExpressionNodeById(t),i=this.getModelById(t);if(o&&i){let n=this.expMatches(i,[jE,bte]),a=this.expMatches(i,fte),s=this.expMatches(i,jE);return this.expMatches(i,y5)?void 0:s?n?a?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-nice"),content:[],innerHTML:this.controller.s("graphing-tours-label-restrictions-range",{sample_expression:'<span class="dcg-trip-math">\\left\\{y<4\\right\\}</span>'}),target:{element:o}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-restrictions-move-parabola"),content:[],innerHTML:this.controller.s("graphing-tours-label-restrictions-change-equation",{sample_expression:'<span class="dcg-trip-math">y=x^2-2</span>'}),target:{element:o,updatePosition:"always"}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-restrictions-dont-forget"),content:[],innerHTML:this.controller.s("graphing-tours-label-restrictions-type-all",{sample_expression:'<span class="dcg-trip-math">y=x^2</span>'}),target:{element:o}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:[],innerHTML:[this.controller.s("graphing-tours-label-restrictions-graph-parabola",{sample_expression:'<span class="dcg-trip-math">y=x^2</span>'})+"<br><i>"+this.controller.s("graphing-tours-label-restrictions-typing-hint",{suggestion1:"y=x^2",suggestion2:'<span class="dcg-trip-math">a^2</span>'})+"</i>"].join(""),target:{element:o,updatePosition:"always"}})}}return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-restrictions-blank-expression"),target:{selector:".dcg-new-math-div"}})}}getCurrentStepBase(){return this.completedPhase1?this.restrictedParabolaTour():this.restrictedLineTour()}};var JL=class extends th{shouldPopup(){return!!this.getMatchingExpNode(Np)}getCurrentStepBase(){var a;if(this.resourcesOpen())return this.requireResourcesNotOpen();if(!this.expressionsVisible())return this.requireExpressionsVisible();if(this.editListMode())return this.requireNotEditListMode();let e=this.getMatchingExpModel(hte),t=this.getMatchingExpNode(Np),o=this.getMatchingExpNode(yte),i=this.getMatchingExpNode(XE);if(e&&o)return{type:"final",shouldAdvance:()=>!0,getBlock:()=>({position:"s",header:this.controller.s("graphing-tours-label-sliders-pro"),content:[],target:{element:o==null?void 0:o.querySelector(".dcg-circular-icon-container")}})};if(e&&i&&!((a=i.querySelector(".dcg-thumb"))!=null&&a.classList.contains("dcg-depressed")))return{shouldAdvance:()=>!0,getBlock:()=>({position:"s",header:this.controller.s("graphing-tours-label-sliders-hands-free"),content:this.controller.s("graphing-tours-label-sliders-press-play"),target:{element:i==null?void 0:i.querySelector(".dcg-circular-icon-container")}})};if(e&&t){let s=t==null?void 0:t.querySelector(".dcg-thumb .dcg-graphic");return{shouldAdvance:()=>!0,getBlock:()=>s?{position:"s",content:this.controller.s("graphing-tours-label-sliders-drag-handle"),target:{element:s,updatePosition:"never"}}:{position:"e",content:this.controller.s("graphing-tours-label-sliders-change-value"),target:{element:t}},updateEveryTick:!0}}let n;return this.expressionCount()>1?n=this.getMatchingExpNode(x5(1)):n=this.getMatchingExpNode(x5(2)),n&&(n!=null&&n.querySelector(".dcg-slider-btn-container:last-child .dcg-btn-blue"))?{shouldAdvance:()=>!0,getBlock:()=>({position:"s",header:this.controller.s("graphing-tours-label-awesome"),content:this.controller.s("graphing-tours-label-sliders-add"),target:{element:n==null?void 0:n.querySelector(".dcg-slider-btn-container:last-child .dcg-btn-blue")}})}:(n=this.getMatchingExpNode(w1),n?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-sliders-make-sliders"),content:[],innerHTML:this.controller.s("graphing-tours-label-sliders-try-typing",{sample_expression:'<span class="dcg-trip-math">y=mx+b</span>'}),target:{element:n}}),delayBeforeExit:600}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-sliders-blank-expression"),target:{selector:".dcg-action-newmath"}})})}};var QL=class extends th{constructor(){super(...arguments);this.hasCreatedLinearRegression=!1;this.hasInitiallyRenderedSampleDataLink=!1}shouldPopup(){return this.hasMatchingExpression(CL)}getRegressionExpId(){return this.getMatchingExpId(yf)||this.getMatchingExpId(yy)}getRegressionExp(){return this.getMatchingExpModel(yf)||this.getMatchingExpModel(yy)}hasRegression(){var i,n;let t=this.getRegressionExp(),o=(n=(i=t==null?void 0:t.formula)==null?void 0:i.regression)==null?void 0:n.statistics;return!!o&&o.r}hasFilledTable(){let t=this.getMatchingExpNode(vg);return!!t&&t.querySelectorAll(".dcg-row .dcg-cell:nth-of-type(2):not(.dcg-table-header):not(.dcg-empty)").length>=5}getCurrentStepBase(){if(this.resourcesOpen())return this.requireResourcesNotOpen();if(!this.expressionsVisible())return this.requireExpressionsVisible();if(this.editListMode())return this.requireNotEditListMode();let t=this.getMatchingExpId(yf)||this.getMatchingExpId(yy),o=this.getExpressionNodeById(t),i=this.getModelById(t),n=this.getMatchingExpId(vg),a=this.getExpressionNodeById(n),s=this.getModelById(n);if(!s||s.type!=="table"||!s.columnModels[1]){let S=document.querySelector(".dcg-action-newtable");return!S&&(!Rs&&!gc)?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-data"),content:[],innerHTML:this.controller.s("graphing-tours-label-regressions-docs",{sample_data_link:'<a class="dcg-trip-link" target="_blank" href="https://docs.google.com/spreadsheets/d/1h4kYwWka_1PvI5G-hPYz_QBe1FrYLo9Gb1XvxJz-QYE/edit#gid=0">'+this.controller.s("graphing-tours-label-regressions-sample-data")+"</a>"})+' <div class="dcg-trip-hint"><br>'+this.controller.s("graphing-tours-label-regressions-own-data",{plus_icon:'<i class="dcg-icon-plus" aria-hidden="true"></i>'}),target:{element:o||document.querySelector(".dcg-exppanel")}})}:S?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-regressions-new-table"),target:{element:S}}),delayBeforeExit:250}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-data-2"),content:this.controller.s("graphing-tours-label-new-item"),target:{selector:".dcg-add-expression-btn"}}),delayBeforeExit:150}}let l=s.columnModels[0].values.length;if(a&&l<5)return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-fill-sample-data"),content:[],innerHTML:"<table class='dcg-regression-tour-table'><tr><td><span class='dcg-trip-math'>x_1</span></td><td><span class='dcg-trip-math'>y_1</span></td></tr><tr><td>1</td><td>0.8</td></tr><tr><td>2</td><td>2.7</td></tr><tr><td>3</td><td>3.9</td></tr><tr><td>4</td><td>4.6</td></tr><tr><td>5</td><td>5</td></tr></table>",target:{element:a.querySelector(".dcg-row:nth-of-type(2) .dcg-cell:nth-of-type(2)")}})};let c=this.getMatchingExpModel(yf)||this.getMatchingExpModel(vL)||this.controller.getItemModelByIndex(0);if(!c||c.type!=="expression"){let S=document.querySelector(".dcg-action-newexpression");return S?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-regressions-expression-option"),target:{element:S}}),delayBeforeExit:150}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-awesome"),content:this.controller.s("graphing-tours-label-new-item"),target:{selector:".dcg-add-expression-btn"}}),delayBeforeExit:150}}let d=i&&i.type==="expression"&&i.formula,p=d?d.regression:void 0,u=p?p.statistics:void 0,h=p?p.parameters:void 0;if(u&&u.r&&(this.hasCreatedLinearRegression=!0),!this.hasCreatedLinearRegression&&o)return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:[],innerHTML:this.controller.s("graphing-tours-label-regressions-equation",{equation:"<span class='dcg-trip-math'>y_1\\sim mx_1+b</span>"})+"<div class='trip-hint'>"+this.controller.s("graphing-tours-label-regressions-hint-1",{y_1:"<span class='dcg-trip-math'>y_1</span>",y1:"<span class='dcg-trip-math'>y1</span>"})+"</div><div class='dcg-trip-hint'>"+this.controller.s("graphing-tours-label-regressions-hint-2",{twiddle:"<span class='dcg-trip-math'>~</span>"})+"</div>",target:{element:o,updatePosition:"never"}}),delayBeforeExit:250};if(document.querySelector(".dcg-residual-suggestion"))return{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-check-model"),content:this.controller.s("graphing-tours-label-regressions-residuals"),target:{selector:".dcg-residual-suggestion"}}),delayBeforeExit:250};if(u&&(u.Rsquared!==void 0&&u.Rsquared>=.99||u.r!==void 0&&u.r>=.99||h&&h.a&&h.k&&h.h))return{shouldAdvance:()=>!0,type:"final",getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-keep-exploring"),content:[],target:{selector:".dcg-exppanel"}})};if(!o)return;let y,w=this.getMatchingExpIds(yf);return w.length>1?y=this.getExpressionNodeById(w.pop()):y=this.getExpressionNodeById(w[0]),{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-new-model"),content:[],innerHTML:this.controller.s("graphing-tours-label-regressions-better-fit",{equation:"<span class='dcg-trip-math'>y_1~a(x_1-h)^2+b</span>"}),target:{element:y,updatePosition:"never"}}),delayBeforeExit:300}}};var ZL=class extends th{shouldPopup(){return!1}getCurrentStepBase(){if(this.resourcesOpen())return this.requireResourcesNotOpen();if(!this.expressionsVisible())return this.requireExpressionsVisible();if(this.editListMode())return this.requireNotEditListMode();let e=this.getMatchingExpId(yf)||this.getMatchingExpId(yy),t=this.getExpressionNodeById(e),o=this.getMatchingExpId(vg),i=this.getExpressionNodeById(o),n=this.getModelById(o);if(!n||n.type!=="table"||!n.columnModels[1]){let c=document.querySelector(".dcg-action-newtable");return!c&&(!Rs&&!gc)?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-data"),content:[],innerHTML:this.controller.s("graphing-tours-label-regressions-docs",{sample_data_link:'<a class="dcg-trip-link" target="_blank" href="https://docs.google.com/spreadsheets/d/1h4kYwWka_1PvI5G-hPYz_QBe1FrYLo9Gb1XvxJz-QYE/edit#gid=0">'+this.controller.s("graphing-tours-label-regressions-sample-data")+"</a>"})+' <div class="dcg-trip-hint"><br>'+this.controller.s("graphing-tours-label-regressions-own-data",{plus_icon:'<i class="dcg-icon-plus" aria-hidden="true"></i>'}),target:{element:t||document.querySelector(".dcg-exppanel")}})}:c?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-regressions-new-table"),target:{element:c}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-data-2"),content:this.controller.s("graphing-tours-label-new-item"),target:{selector:".dcg-add-expression-btn"}})}}let a=n.columnModels[0].values.length,s=n.columnModels[0].values.length;return i&&(a<3||s<3)?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-fill-sample-data"),content:[],innerHTML:"<table class='dcg-regression-tour-table'><tr><td><span class='dcg-trip-math'>x_1</span></td><td><span class='dcg-trip-math'>y_1</span></td></tr><tr><td>1</td><td>0.8</td></tr><tr><td>2</td><td>2.7</td></tr><tr><td>3</td><td>3.9</td></tr><tr><td>4</td><td>4.6</td></tr><tr><td>5</td><td>5</td></tr></table>",target:{element:i.querySelector(".dcg-row:nth-of-type(2) .dcg-cell:nth-of-type(2)")}})}:n.regression?document.querySelector(".dcg-residual-suggestion")?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-check-model"),content:this.controller.s("graphing-tours-label-regressions-residuals"),target:{selector:".dcg-residual-suggestion"}})}:n.regression.type==="linear"?{shouldAdvance:()=>!0,getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-restrictions-change-model"),target:{selector:".dcg-dropdown-input"}})}:{shouldAdvance:()=>!0,type:"final",getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-regressions-keep-exploring"),content:[],target:{selector:".dcg-exppanel"}})}:{shouldAdvance:()=>!0,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-awesome"),content:this.controller.s("graphing-tours-label-add-regression"),target:{selector:".dcg-add-regression-view"}})}}};var eP=class extends xf{constructor(){super(...arguments);this.steps=[[this.requireExpressionsVisible(),this.requireResourcesNotOpen(),this.requireNotEditListMode(),{shouldAdvance:()=>!!this.hasMatchingExpression(vg),getBlock:()=>{let t=document.querySelector(".dcg-action-newtable");return t?{position:"e",content:this.controller.s("graphing-tours-label-tables-select-table"),target:{element:t}}:{position:"e",header:this.controller.s("graphing-tours-label-tables-start"),content:this.controller.s("graphing-tours-label-new-item"),target:{selector:".dcg-add-expression-btn"}}},type:"guardrail"}],[{shouldAdvance:()=>{let t=this.getTableEl(),o=0;return t==null||t.querySelectorAll(".dcg-row").forEach(i=>{i.querySelectorAll(".dcg-cell:not(.dcg-empty):not(.dcg-error):not(.dcg-table-header)").length>=2&&o++}),o>=3},getBlock:()=>{var c,d;let t=this.getTableEl();if(!t)return;let o=t.querySelector(".dcg-row .dcg-cell.dcg-error");if(o)return{position:"e",content:this.controller.s("graphing-tours-label-tables-valid-number"),target:{element:o}};let i=ys(this.getTable());if(!i)return t.getBoundingClientRect().y<0?{position:"e",content:this.controller.s("graphing-tours-label-tables-scroll"),target:{selector:".dcg-expressionlist"}}:{position:"e",content:this.controller.s("graphing-tours-label-tables-back"),target:{element:(d=(c=t==null?void 0:t.querySelector(".dcg-row .dcg-cell.dcg-empty:first-of-type"))==null?void 0:c.parentElement)==null?void 0:d.querySelector(".dcg-cell:nth-of-type(2)")}};let n=-1,a=0;if(t==null||t.querySelectorAll(".dcg-row").forEach(p=>{n++,p.querySelectorAll(".dcg-cell:not(.dcg-empty):not(.dcg-error):not(.dcg-table-header)").length>=2&&a++}),n===2&&a===1&&i&&i.row===1)return{position:"e",content:this.controller.s("graphing-tours-label-tables-next-row"),target:{element:t.querySelector(`.dcg-row:nth-of-type(${i.row+1}) .dcg-cell:nth-of-type(2)`)}};if(a===0&&(t==null?void 0:t.querySelectorAll(".dcg-row:nth-of-type(2) .dcg-cell:not(.dcg-empty):not(.dcg-error)").length)===1)return{position:"e",header:this.controller.s("graphing-tours-label-tables-fill-cell"),content:this.controller.s("graphing-tours-label-tables-type-number"),target:{element:t==null?void 0:t.querySelector(".dcg-row:nth-of-type(2) .dcg-cell:nth-of-type(2)")}};let s=this.controller.s("graphing-tours-label-tables-fill-row"),l;return a===2&&i.row===2?(l=this.controller.s("graphing-tours-label-awesome"),s=this.controller.s("graphing-tours-label-tables-enter")):a===2&&(s=this.controller.s("graphing-tours-label-tables-fill-another")),{position:"e",content:s,header:l,target:{element:t==null?void 0:t.querySelector(`.dcg-row:nth-of-type(${i.row+1}) .dcg-cell:nth-of-type(2)`)}}}}],[{shouldAdvance:()=>!!document.querySelector(".dcg-table-column-menu"),getBlock:()=>{var t;return{header:this.controller.s("graphing-tours-label-tables-last-trick"),content:this.controller.s("graphing-tours-label-tables-open-options"),position:"e",target:{element:(t=this.getTableEl())==null?void 0:t.querySelector(".dcg-row:nth-of-type(1) .dcg-cell:nth-of-type(2) .dcg-circular-icon")}}},type:"guardrail--this-step"},{shouldAdvance:()=>{let t=this.getTable();return!!t&&t.columnModels[1].points&&t.columnModels[1].lines},getBlock:()=>({content:this.controller.s("graphing-tours-label-tables-dots"),position:"e",target:{selector:".dcg-table-column-menu .dcg-options-menu-section:nth-of-type(3)"}})}],[{shouldAdvance:()=>!document.querySelector(".dcg-table-column-menu"),getBlock:()=>({position:"e",content:this.controller.s("graphing-tours-label-tables-close-options"),target:{element:this.getTableEl()}})},{shouldAdvance:()=>!1,getBlock:()=>({position:"e",header:this.controller.s("graphing-tours-label-tables-whiz"),content:[],target:{element:this.getTableEl()}}),type:"final"}]]}shouldPopup(){return!!this.getMatchingExpNode(CL)}getTableEl(){let t=this.getMatchingExpId(vg);if(t)return this.getExpressionNodeById(t)}getTable(){let t=this.getMatchingExpId(vg);if(!t)return;let o=this.getModelById(t);if((o==null?void 0:o.type)==="table")return o}};var Iwe=wg("tableRegressions")===!1,iD={sliders:{tour:JL,titleKey:"graphing-tours-heading-sliders",thumb:""},tables:{tour:eP,titleKey:"graphing-tours-heading-tables",thumb:""},restrictions:{tour:XL,titleKey:"graphing-tours-heading-restrictions",thumb:""},regressions:{tour:Iwe?QL:ZL,titleKey:"graphing-tours-heading-regressions",thumb:""}};var Xs=__dcg_shared_module_exports__['e'](Z()),{For:Mwe,If:Awe}=Xs.Components,B5=class extends Xs.Class{init(){this.controller=this.props.controller(),this.tourController=this.controller.tourController}getBaseUrl(){switch(this.controller.getProduct()){case"graphing-3d":return"3d";case"geometry-calculator":return"geometry";default:return"calculator"}}template(){return Xs.createElement("a",{class:Xs.const("dcg-feature"),href:()=>`/${this.getBaseUrl()}?tour=${this.props.name()}`,target:Xs.const("_blank"),onTap:e=>{var o;let t=e.altKey||e.shiftKey||e.metaKey;if(!this.tourController.shouldPopupTour(this.props.name())&&!t)return(o=e.originalEvent)==null||o.preventDefault(),this.controller.dispatch({type:"toggle-menu",payload:"none"}),this.tourController.startTour(this.props.name())}},Xs.createElement("span",{class:()=>({"dcg-thumb":!0,[this.getTourClassName()]:!0})}),()=>this.controller.s(this.props.titleKey()))}getTourClassName(){switch(this.props.name()){case"regressions":return"dcg-regressions-thumb";case"restrictions":return"dcg-restrictions-thumb";case"sliders":return"dcg-sliders-thumb";case"tables":return"dcg-tables-thumb";default:return"dcg-unknown-thumb"}}},tP=class extends Xs.Class{init(){this.controller=this.props.controller()}template(){return Xs.createElement("div",{class:Xs.const("dcg-tours-content"),role:Xs.const("region"),"aria-label":()=>this.controller.s("account-shell-heading-tours")},Xs.createElement(Mwe,{each:()=>Object.keys(this.props.tours())},e=>Xs.createElement(Awe,{predicate:()=>!this.props.tours()[e].hideInHelp},()=>Xs.createElement(B5,{name:()=>e,titleKey:()=>this.props.tours()[e]?this.props.tours()[e].titleKey:"",controller:this.props.controller}))))}};var rP=class extends Zd.Class{init(){this.controller=this.props.controller()}template(){return Zd.createElement(Is,{title:()=>this.controller.s("account-shell-heading-tours"),type:()=>"help",label:()=>this.controller.s("account-shell-label-help-menu"),controller:this.props.controller},Zd.createElement(tP,{controller:this.props.controller,tours:this.const(iD)}),Zd.createElement("h2",{class:Zd.const("dcg-unstyled-heading dcg-help-menu-title")},()=>this.controller.s("account-shell-heading-resources")),Zd.createElement(UL,{controller:this.props.controller}),Zd.createElement("h2",{class:Zd.const("dcg-unstyled-heading dcg-help-menu-title dcg-hide-on-mobile")},()=>this.controller.s("account-shell-heading-contact-us")),Zd.createElement(wf,{controller:this.props.controller}))}};var nD=__dcg_shared_module_exports__['e'](Z());var Rc=__dcg_shared_module_exports__['e'](Z()),{For:Vwe}=Rc.Components,oP=class extends Rc.Class{init(){this.i18n=this.props.i18n()}template(){return Rc.createElement("div",{class:()=>({"dcg-language-picker":!0,"dcg-two-columns":this.getLanguages().length>7})},Rc.createElement("ul",{class:Rc.const("dcg-unstyled-list dcg-languages-list"),role:Rc.const("menu")},Rc.createElement(Vwe,{each:()=>this.getLanguages()},e=>Rc.createElement("li",{class:()=>({"dcg-listitem":!0,"dcg-language-option":!0,"dcg-selected":this.isLanguageSelected(e)}),lang:this.const(this.getLangCode(e)),role:Rc.const("menuitem"),tabIndex:Rc.const("0"),"aria-current":()=>this.isLanguageSelected(e),onTap:()=>this.updateLang(e)},()=>this.i18n.raw(this.getLanguageDisplayName(e))))))}getCurrentLang(){return this.props.currentLang()}getLanguages(){return Object.keys(this.props.getAllLangs())}getLanguageDisplayName(e){return this.props.getAllLangs()[e].display_name}updateLang(e){let t=this.props.getAllLangs()[e].code;return this.props.onLangChosen(t)}getLangCode(e){return this.props.getAllLangs()[e].code}isLanguageSelected(e){return this.getLangCode(e)===this.getCurrentLang()}};var Lwe=S7(),iP=class extends nD.Class{init(){this.controller=this.props.controller(),this.languageController=this.controller.languageController}template(){return nD.createElement(Is,{type:()=>"language",label:()=>this.controller.s("account-shell-narration-language-menu"),controller:this.props.controller,title:()=>this.props.controller().s("shared-title-language-menu")},nD.createElement(oP,{getAllLangs:()=>Lwe,currentLang:()=>this.languageController.getLanguage(),onLangChosen:e=>{this.controller.dispatch({type:"set-language",code:e}),this.controller.dispatch({type:"toggle-menu",payload:"none"})},i18n:this.props.controller}))}};var Ht=__dcg_shared_module_exports__['e'](Z());var Tn=__dcg_shared_module_exports__['e'](Z()),{Input:Pwe,Switch:Owe}=Tn.Components,nP=r=>({inputLabel:r.s("graphing-calculator-narration-share-graph-link"),inputName:r.s("graphing-calculator-text-share-graph-link"),successLabel:r.s("graphing-calculator-narration-share-graph-link-copied"),errorLabel:r.s("graphing-calculator-narration-share-graph-link-unable-to-copy"),copyText:r.s("graphing-calculator-button-share-graph-link-copy")}),_1=class extends Tn.Class{template(){return Tn.createElement("div",{class:Tn.const("dcg-selectable-input-container")},Tn.createElement(Pwe,{class:this.const("dcg-permalink select-all dcg-variable-permalink"),"aria-label":()=>this.props.strings().inputLabel,name:()=>this.props.strings().inputName,value:this.props.link,didMount:e=>{this.inputEl=e,this.inputEl.focus(),this.inputEl.select()},onTap:()=>this.inputEl.select(),onCopy:()=>{var e,t;return(t=(e=this.props).triggerLogEvent)==null?void 0:t.call(e)},onInput:()=>{}}),Tn.createElement("div",{role:Tn.const("button"),tabIndex:Tn.const(0),class:Tn.const("dcg-copy-button"),onTap:this.bindFn(this.copyLink)},Tn.createElement(Owe,{key:()=>this.copyStatus},e=>e=="success"?Tn.createElement("span",{"aria-label":()=>this.props.strings().successLabel},Tn.createElement("i",{class:Tn.const("dcg-icon-check"),"aria-hidden":Tn.const("true")})):e=="error"?Tn.createElement("span",{"aria-label":()=>this.props.strings().errorLabel},Tn.createElement("i",{class:Tn.const("dcg-icon-error"),"aria-hidden":Tn.const("true")})):Tn.createElement("span",{class:Tn.const("dcg-copy-text")},()=>this.props.strings().copyText))))}copyLink(){var e,t;if(this.inputEl){this.inputEl.select(),this.copyStatus="success";try{document.execCommand("copy")}catch(o){this.copyStatus="error"}this._isMounted&&((t=(e=this.props).triggerLogEvent)==null||t.call(e),this.update(),clearTimeout(this.copyStatusTimeout),this.copyStatusTimeout=setTimeout(this.bindIfMounted(()=>{this.copyStatus=null,this.update()}),2500))}}};var{If:vf,Textarea:Rwe}=Ht.Components,aP=class extends Ht.Class{init(){this.controller=this.props.controller(),this.graphsController=this.controller.graphsController,this.shareInProgress=!0,this.formErrors=[],co({category:"share",action:"open-menu"})}template(){return Ht.createElement(Is,{title:this.bindFn(this.getTitle),type:Ht.const("share"),label:()=>this.controller.s("account-shell-narration-share-options"),controller:this.props.controller},Ht.createElement("div",null,Ht.createElement(vf,{predicate:()=>this.shareInProgress},()=>Ht.createElement("div",{class:Ht.const("dcg-loading")},Ht.createElement("span",{class:Ht.const("dcg-spinner")}),()=>this.controller.s("account-shell-label-loading"))),Ht.createElement(vf,{predicate:()=>this.didSharingFail()},()=>Ht.createElement("div",{class:Ht.const("dcg-failed")},Ht.createElement("span",{"aria-live":Ht.const("assertive"),"aria-atomic":Ht.const(!0)},()=>this.formErrors[0]+" "),Ht.createElement("button",{class:Ht.const("dcg-unstyled-button dcg-action-retry"),onTap:()=>(this.controller.dispatch({type:"toggle-menu",payload:"none"}),this.controller.dispatch({type:"toggle-menu",payload:"share"}))},()=>this.controller.s("account-shell-button-retry-now")),()=>` ${this.controller.s("account-shell-text-or")} `,Ht.createElement("button",{class:Ht.const("dcg-unstyled-button dcg-action-close"),onTap:()=>this.controller.dispatch({type:"toggle-menu",payload:"share"})},()=>this.controller.s("account-shell-button-cancel")),Ht.const("."))),Ht.createElement(vf,{predicate:()=>!this.shareInProgress&&!this.didSharingFail()},()=>Ht.createElement("div",{class:Ht.const("dcg-loaded"),didMount:this.bindFn(this.didMountLoaded)},()=>this.controller.s("account-shell-label-share-link"),Ht.createElement(_1,{link:()=>this.getGraphPath(),triggerLogEvent:()=>co({category:"share",action:"copy-link"}),strings:()=>nP(this.controller)}),Ht.createElement(vf,{predicate:()=>!this.controller.shouldDisablePrintAndExport()},()=>Ht.createElement("div",{class:Ht.const("dcg-share-actions")},Ht.createElement(vf,{predicate:()=>this.controller.product!=="geometry-calculator"},()=>Ht.createElement("span",{class:Ht.const("dcg-print-link"),onTap:this.bindFn(this.print),tabIndex:Ht.const("0"),role:Ht.const("link")},Ht.createElement("i",{class:Ht.const("dcg-icon-print"),"aria-hidden":Ht.const("true")}),Ht.createElement("span",null,()=>this.controller.s("account-shell-button-print")))),Ht.createElement(vf,{predicate:()=>this.controller.product!=="graphing-3d"},()=>Ht.createElement("span",{class:Ht.const("dcg-export-image-link"),onTap:this.bindFn(this.exportImage),tabIndex:Ht.const("0"),role:Ht.const("link")},Ht.createElement("i",{class:Ht.const("dcg-icon-export"),"aria-hidden":Ht.const("true")}),Ht.createElement("span",null,()=>this.controller.s("account-shell-button-export-image")))),Ht.createElement(vf,{predicate:()=>this.controller.product!=="geometry-calculator"},()=>Ht.createElement("button",{class:()=>({"dcg-unstyled-button":!0,"dcg-embed-link":!0,"dcg-selected":this.embedVisible}),onTap:this.bindFn(this.toggleEmbedVisible),"aria-pressed":()=>this.embedVisible},Ht.createElement("i",{class:Ht.const("dcg-icon-embed"),"aria-hidden":Ht.const("true")}),Ht.createElement("span",null,()=>this.controller.s("account-shell-button-embed")))))),Ht.createElement(vf,{predicate:()=>this.embedVisible},()=>Ht.createElement("div",{class:Ht.const("dcg-embed-div share-div"),didMount:this.bindFn(this.didMountTextarea)},Ht.createElement(Rwe,{rows:Ht.const("6"),class:Ht.const("select-all first-input dcg-variable-htmlembedcode"),value:()=>this.getGraphEmbedCode(),onInput:()=>{}})))))))}didSharingFail(){return this.formErrors.length>0}didMountTextarea(e){let t=e.querySelector("textarea");t.select(),t.focus()}toggleEmbedVisible(){this.embedVisible=!this.embedVisible,co({category:"share",action:"embed-graph"}),this._isMounted&&this.update()}didMountLoaded(){this.embedVisible=!1}print(){co({category:"share",action:"print-graph"}),window.print()}exportImage(){co({category:"share",action:"export-image"}),this.controller.dispatch({type:"show-modal",modal:"export-image"})}getGraphPath(){var e;return((e=this.graph)==null?void 0:e.getURL())||""}getGraphEmbedCode(){return this.graph?`<iframe src="${`${this.getGraphPath()}?embed`}" width="500" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>`:""}getTitle(){return this.graphsController.isNewGeometryTool()?this.controller.s("account-shell-heading-share-construction"):this.controller.s("account-shell-heading-share-graph")}async didMount(){try{this.formErrors=[];let e=await this.graphsController.shareGraph();if(!this._isMounted)return;this.graph=e}catch(e){if(!this._isMounted)return;this.formErrors=this.controller.parseJSONErrors(e,this.controller.s("account-shell-error-sharing-link"))}finally{this._isMounted&&(this.shareInProgress=!1,this.update())}}};var{SwitchUnion:Fwe,If:T1}=sr.Components,sP=class extends sr.Class{init(){this.controller=this.props.controller(),this.userController=this.controller.userController,this.graphsController=this.controller.graphsController}getShareTooltipText(){return this.graphsController.isNewGeometryTool()?this.controller.s("account-shell-label-share-construction"):this.controller.s("account-shell-label-share-graph")}template(){return sr.createElement("div",{class:sr.const("dcg-header")},sr.createElement("div",{class:sr.const("dcg-header-desktop")},sr.createElement("div",{class:sr.const("align-left-container")},sr.createElement(NL,{controller:this.props.controller}),sr.createElement(YL,{controller:this.props.controller})),sr.createElement("div",{class:sr.const("align-center-container")},sr.createElement("a",{href:sr.const("/"),target:sr.const("_blank"),class:sr.const("dcg-home-link")},sr.createElement(PL,null))),sr.createElement(T1,{predicate:()=>this.userController.didLogoutFail()},()=>sr.createElement("div",{class:sr.const("dcg-toast-container")},sr.createElement("div",{class:sr.const("dcg-toast")},()=>this.controller.s("account-shell-error-logging-out")))),sr.createElement("div",{class:sr.const("align-right-container")},sr.createElement(FL,{controller:this.props.controller,withArtContest:()=>this.controller.getArtExpoState()!=="inactive"}),sr.createElement(T1,{predicate:()=>this.controller.getArtExpoState()!=="inactive"},()=>sr.createElement("span",null,sr.createElement(wy,{controller:this.props.controller,label:()=>fa("account-shell-label-math-art-contest"),tooltip:()=>this.controller.s("account-shell-label-math-art-contest"),icon:sr.const("dcg-icon-art-contest"),name:()=>"art-contest",onTap:()=>{this.controller.dispatch({type:"toggle-menu",payload:"art-contest"})}}),sr.createElement(T1,{predicate:()=>this.controller.getOpenMenu()==="art-contest"},()=>sr.createElement(KL,{controller:this.props.controller})))),sr.createElement(wy,{controller:this.props.controller,label:()=>fa("account-shell-label-share"),tooltip:this.bindFn(this.getShareTooltipText),icon:sr.const("dcg-icon-share"),name:()=>"share",onTap:()=>{this.controller.dispatch({type:"toggle-menu",payload:"share"})}}),sr.createElement(T1,{predicate:()=>this.controller.getOpenMenu()==="share"},()=>sr.createElement(aP,{controller:this.props.controller})),sr.createElement(wy,{controller:this.props.controller,label:()=>fa("account-shell-label-help"),tooltip:()=>this.controller.s("account-shell-label-help"),icon:sr.const("dcg-icon-question-sign"),name:sr.const("help"),onTap:()=>{this.controller.dispatch({type:"toggle-menu",payload:"help"})}}),sr.createElement(T1,{predicate:()=>this.controller.getOpenMenu()==="help"},()=>Fwe(()=>this.props.controller().product,{"geometry-calculator":()=>sr.createElement(WL,{controller:this.props.controller}),"graphing-3d":()=>sr.createElement(qL,{controller:this.props.controller}),graphing:()=>sr.createElement(rP,{controller:this.props.controller}),geometry:()=>sr.createElement("span",null)})),sr.createElement(wy,{controller:this.props.controller,gravity:this.const("s"),label:()=>fa("account-shell-label-language"),tooltip:()=>this.controller.s("account-shell-label-language"),icon:sr.const("dcg-icon-world"),name:sr.const("language"),onTap:()=>{this.controller.dispatch({type:"toggle-menu",payload:"language"})}}),sr.createElement(T1,{predicate:()=>this.controller.getOpenMenu()==="language"},()=>sr.createElement(iP,{controller:this.props.controller})))))}focusElement(e){var t;(t=document.querySelector(e))==null||t.focus()}};var lP=class extends G1.Class{init(){this.controller=this.props.controller()}template(){return G1.createElement("div",null,G1.createElement(sP,{controller:this.props.controller}),G1.createElement(LL,{tourController:()=>this.controller.tourController}))}};var ove=__dcg_shared_module_exports__['e'](Z());var Cf=class extends Yd{constructor(t,o,i){super(t,{...o,product:"graphing-3d"},i);this.mathToPixels=void 0;this.pixelsToMath=void 0}asyncScreenshot(){throw new Error("asyncScreenshot() is currently unimplemented in 3D. Use screenshot() instead.")}};tu();Xa();var aD=class{constructor({evaluationMode:e,additionalFunctions:t,disableParentheses:o,functionDefinition:i,replaceRoundWithReciprocal:n,workerPool:a}){this._evaluations={};this._nextObjectId=0;this.store=new Fp({expressions:{1:{id:"1",latex:"",braille:"",type:"latex",displayAsFraction:!1}},order:["1"],settings:{degreeMode:!1,complex:!1},ui:{focus:void 0}});this.evaluationMode=e,this.additionalFunctions=t,this.disableParentheses=o,this.functionDefinition=i,this.replaceRoundWithReciprocal=n,this.workerPool=a,this._setupEvaluator(),this.clear(),this._sharedClockBusToken=hd(()=>{this._evaluator.tick()})}isSingleExpression(){return this.evaluationMode==="singleExpressionScientific"||this.evaluationMode==="singleExpressionFourFunction"}destroy(){rc(this._sharedClockBusToken)}generateObjectId(){return(this._nextObjectId++).toString()}updateNextObjectId(){let e=this.store.getState().order;this._nextObjectId=0;let t=/^[0-9]+$/;for(let o of e)if(t.test(o)){let i=parseInt(o,10);i>=this._nextObjectId&&(this._nextObjectId=i+1)}}clearShouldDebounceUndoRedo(){this._shouldDebounceUndoRedo=!1}markShouldDebounceUndoRedo(){this._shouldDebounceUndoRedo=!0}getShouldDebounceUndoRedo(){return this._shouldDebounceUndoRedo}clearCachedBrailleValues(){for(let e of this.getExpressionOrder())this.store.set(["expressions",e,"braille"],"")}getState(){return this.store.getState()}getPersistedState(){let{expressions:e,order:t,settings:o}=this.getState();return{expressions:{list:t.map(i=>{let n=e[i];return{id:n.id,latex:n.latex,displayAsFraction:n.displayAsFraction}})},settings:o}}setState(e){this.store.set(e),this._updateIndexes(),this.updateNextObjectId()}setStateFromAPI(e){let t=[],o={},{settings:i}=e;i.complex&&i.degreeMode&&(i={...i,degreeMode:!1}),e.expressions.list.forEach(({id:n,latex:a,displayAsFraction:s})=>{t.push(n),o[n]={id:n,latex:a,displayAsFraction:s,braille:"",type:"latex"}}),this.setState({expressions:o,order:t,settings:i,ui:{focus:void 0}})}canClear(){if(this.getNumberOfExpressions()>1)return!0;let e=this.getExpressionOrder()[0];return this.getExpressionLatex(e)!==""}clear(){this.setState({expressions:{1:{id:"1",type:"latex",latex:"",braille:"",displayAsFraction:!1}},ui:{focus:void 0},order:["1"],settings:this.getState().settings})}getExpressionOrder(){return this.store.getState().order}getNumberOfExpressions(){return this.getExpressionOrder().length}getExpressionById(e){return this.getState().expressions[e]}getExpressionIndex(e){return this._indexes[e]}_getExpressionByIndex(e){let t=this.getExpressionOrder()[e];return this.getExpressionById(t)}_updateIndexes(){this._indexes={};let e=0;for(let t of this.getExpressionOrder())this._indexes[t]=e,e+=1;this._evaluate()}_usesAnsById(e){return this.getExpressionById(e).latex.indexOf("\\operatorname{ans}")!==-1}_getPreviousExpById(e){let t=this.getExpressionIndex(e);return this._getExpressionByIndex(t-1)}createBlankAfterId(e){if(this.isSingleExpression()||!this.getExpressionById(e).latex)return;let t=this.getExpressionIndex(e),o=this.generateObjectId();this.store.shallowMutate("order",i=>{i.splice(t+1,0,o)}),this.store.shallowMutate("expressions",i=>{i[o]={id:o,latex:"",braille:"",type:"latex",displayAsFraction:!1}}),this._updateIndexes(),this.setFocusedById(o,!0)}conditionallyCopyPrevious(e){let t=this._getPreviousExpById(e),o=this.getExpressionById(e);t!=null&&o.latex===""&&this._usesAnsById(t.id)&&this.setLatexById(e,t.latex)}backspaceAtFrontOfId(e){if(this.getExpressionById(e).latex!==""||this.getNumberOfExpressions()===1)return;let o=this.getExpressionIndex(e);this.store.shallowMutate("order",i=>{i.splice(o,1)}),this.store.shallowMutate("expressions",i=>{delete i[e]}),this._updateIndexes(),this._setFocusedByIndex(Math.max(o-1,0),!0)}setLatexById(e,t){this.store.set(["expressions",e,"latex"],t),this.store.set(["expressions",e,"braille"],""),t===""&&this.setFractionEvaluation(e,!1),this._evaluate()}setLatexAndBrailleById(e,t,o){this.store.set(["expressions",e,"latex"],t),this.store.set(["expressions",e,"braille"],o),t===""&&this.setFractionEvaluation(e,!1),this._evaluate()}setFractionEvaluation(e,t){this.store.set(["expressions",e,"displayAsFraction"],t)}setLatexOfFocusedExpression(e){let t=this.getFocusedExpressionId();t&&this.setLatexById(t,e)}isExpressionFocused(e){return this.getFocusedExpressionId()===e}getExpressionLatex(e){return this.getExpressionById(e).latex}getExpressionError(e){var t;return(t=this._evaluations[e])==null?void 0:t.error}getExpressionValue(e){var t,o;return(o=(t=this._evaluations[e])==null?void 0:t.typedConstantValue)==null?void 0:o.value}getExpressionTypedConstantValue(e){var t;return(t=this._evaluations[e])==null?void 0:t.typedConstantValue}getExpressionAns(e){var o,i;let t=(o=this._evaluations[e])==null?void 0:o.ansId;return t!==void 0?(i=this._evaluations[t])==null?void 0:i.typedConstantValue:t}getExpressionAnsId(e){var t;return(t=this._evaluations[e])==null?void 0:t.ansId}shouldShowEvaluationForExpression(e){let t=this._evaluations[e];return t?t.showEvaluation:!1}isRationalizableConstant(e){let t=this._evaluations[e];return t?t.isRationalizableConstant:!1}canDisplayEvaluationAsFraction(e){let t=this.getExpressionValue(e);return!t||typeof t!="number"?!1:__dcg_shared_module_exports__['Xb'](t)}isEvaluationList(e){var t;return __dcg_shared_module_exports__['bb']((t=this.getExpressionTypedConstantValue(e))==null?void 0:t.valueType)}_setFocusedByIndex(e,t){let o=this._getExpressionByIndex(e),i=this.store.getState().ui.focus,n=t?{type:"latex-expression",id:o.id}:void 0;if(!__dcg_shared_module_exports__['J'](i,n)){if(i){let a=i.id;this.store.deepMutate("expressions",s=>{let l=s[a];l&&(l.braille="")})}!t&&this.getFocusedExpressionId()!==o.id||this.store.shallowMutate("ui",a=>{a.focus=n})}}setFocusedById(e,t){let o=this.getExpressionIndex(e);this._setFocusedByIndex(o,t)}focusPrevById(e){let t=this.getExpressionIndex(e)-1;t>=0&&this._setFocusedByIndex(t,!0)}focusNextById(e){let t=this.getExpressionIndex(e)+1;t<this.getNumberOfExpressions()?this._setFocusedByIndex(t,!0):this.createAtEnd()}getFocusedExpression(){let e=this.getFocusedExpressionId();if(e)return this.getExpressionById(e)}getFocusedExpressionId(){let e=this.getState().ui.focus;return e&&e.id}clearFocusedExpression(){let e=this.getFocusedExpression();e&&this.setLatexById(e.id,"")}shouldShowClear(){if(this.getNumberOfExpressions()===1)return!1;let e=this.getFocusedExpression();return!!e&&!!e.latex}getLastExpression(){return this._getExpressionByIndex(this.getNumberOfExpressions()-1)}isLastExpressionEmpty(){return!!this.getLastExpression().latex}createAtEnd(){this.createBlankAfterId(this.getLastExpression().id)}focusLastExpression(){this._setFocusedByIndex(this.getNumberOfExpressions()-1,!0)}focusFirstExpression(){this._setFocusedByIndex(0,!0)}getDegreeMode(){return this.getState().settings.degreeMode}setDegreeMode(e){this.getComplexMode()||(this.store.set(["settings","degreeMode"],e),this._evaluate())}getComplexMode(){return!!this.getState().settings.complex}setComplexMode(e){this.store.set(["settings","complex"],e),e&&this.store.set(["settings","degreeMode"],!1),this._evaluate()}_cleanupLatex(e){return e=__dcg_shared_module_exports__['bc'](e),e.substr(e.length-1)==="="&&(e=e.substr(0,e.length-1)),e}_evaluate(){this._evaluator.clearStatementsAndStartCompleteState(),this.getExpressionOrder().forEach(e=>this._evaluator.addStatement({id:e,index:this.getExpressionIndex(e),latex:this._cleanupLatex(this.getExpressionLatex(e)),shouldGraph:!1,type:"statement"}))}getAdditionalFunctions(){return this.getComplexMode()?[...this.additionalFunctions,...__dcg_shared_module_exports__['Q']]:this.additionalFunctions}_setupEvaluator(){this._evaluator=new bf(this.workerPool),this._evaluator.readEvaluatorConfig=()=>({degreeMode:this.getDegreeMode(),evaluationMode:this.evaluationMode,additionalFunctions:this.getAdditionalFunctions(),disableParentheses:this.disableParentheses,functionDefinition:this.functionDefinition,replaceRoundWithReciprocal:this.replaceRoundWithReciprocal,complex:this.getComplexMode(),actions:!1}),this._evaluator.onEvaluatorResults=e=>{var i;let t=e.evaluationStates;this._evaluations={};for(let n in t){let a=t[n];if(!this.getExpressionById(n))continue;let{value:l,valueType:c}=(i=a.typed_constant_value)!=null?i:{},d=!a.is_evaluable&&c===__dcg_shared_module_exports__['ba']&&__dcg_shared_module_exports__['Xb'](l);this._evaluations[n]={error:a.error,ansId:void 0,typedConstantValue:a.typed_constant_value,showEvaluation:a.is_evaluable||d||c===__dcg_shared_module_exports__['ga'],isRationalizableConstant:d}}let o;for(let n of this.getExpressionOrder()){let a=this._evaluations[n];o&&a&&(a.ansId=o),o=n}typeof this.onEvaluationUpdate=="function"&&this.onEvaluationUpdate()}}reloadState(){this.setState(this.getState())}getFunctionDefinition(){return!!this.functionDefinition}enableFunctionDefinition(){this.functionDefinition=!0,this.reloadState()}disableFunctionDefinition(){this.functionDefinition=!1,this.reloadState()}getReplaceRoundWithReciprocal(){return!!this.replaceRoundWithReciprocal}enableReplaceRoundWithReciprocal(){this.replaceRoundWithReciprocal=!0,this.reloadState()}disableReplaceRoundWithReciprocal(){this.replaceRoundWithReciprocal=!1,this.reloadState()}};var sD=class{constructor(e,t){this.keyboardMode="main";this.fontSize=16;this.invertedColors=!1;this.backgroundColor="";this.textColor="";this.projectorMode=!1;this.capExpressionSize=!1;this.decimalToFraction=!0;this.settingsMenu=!0;this.settingsMenuOpen=!1;this.language="en";this.brailleMode="none";this.sixKeyInput=!1;this.brailleControls=!0;this.brailleExpressionDownload=!0;this.replaceCommaWith10Exp=!1;this.typingAsteriskWritesTimesSymbol=!1;this.stateStack=new yg;this.dispatcher=new Yu;this.s=Id(()=>this.language);this.raw=Bs;this.dispatch=e=>{Hg("dispatch",{type:e.type}),this.dispatcher.dispatch(e);let t;for(;t=this._queuedCallbacks.shift();)t()};this._queuedCallbacks=[];this.logEvent=e=>{};this.stateStack=new yg,this.dispatcher=new Yu,this.options=e,this.model=new aD({evaluationMode:this.options.evaluationMode,additionalFunctions:this.options.additionalFunctions,disableParentheses:this.options.disableParentheses,functionDefinition:this.options.functionDefinition,replaceRoundWithReciprocal:this.options.replaceRoundWithReciprocal,workerPool:t.workerPool}),this.model.setComplexMode(e.complex),this.model.setDegreeMode(e.degreeMode),this.setLanguage(e.language),this.setBrailleMode(e.brailleMode),this.setSixKeyInput(e.sixKeyInput),this.setBrailleControls(e.brailleControls),this.setBrailleExpressionDownload(e.brailleExpressionDownload),this.setReplaceCommaWith10Exp(e.replaceCommaWith10Exp),this.setReplaceRoundWithReciprocal(e.replaceRoundWithReciprocal),this.setTypingAsteriskWritesTimesSymbol(e.typingAsteriskWritesTimesSymbol),this.setProjectorMode(e.projectorMode),this.setCapExpressionSize(e.capExpressionSize),this.setDecimalToFraction(e.decimalToFraction),this.invertedColors=e.invertedColors,this.backgroundColor=e.backgroundColor,this.textColor=e.textColor,this.settingsMenu=e.settingsMenu,this.model.onEvaluationUpdate=()=>this.dispatch({type:"render"}),this.settingsProxy=t.settingsProxy,this.syncPublicSettings(),this.hookUpDispatcher(),this.containerSize={width:0,height:0}}runAfterDispatch(e){this._queuedCallbacks.push(e)}enqueueEvent(e){this.runAfterDispatch(()=>{this.onEventEmitted&&this.onEventEmitted(e)})}getSettingsMenu(){return this.settingsMenu}getBrailleMode(){return this.brailleMode}renderAsBraille(){return this.brailleMode!=="none"}setBrailleMode(e){this.brailleMode=e}getSixKeyInput(){return this.sixKeyInput}setSixKeyInput(e){this.sixKeyInput=e}getBrailleControls(){return this.brailleControls}setBrailleControls(e){this.brailleControls=e}getBrailleExpressionDownload(){return this.brailleExpressionDownload}setBrailleExpressionDownload(e){this.brailleExpressionDownload=e}getRestrictedEditing(){return this.options.restrictedEditing}getKeyboardMode(){return this.keyboardMode}getFontSize(){return this.fontSize}getInvertedColors(){return this.invertedColors}hasBackgroundColor(){return this.getBackgroundColor()!=="#ffffff"}getBackgroundColor(){return __dcg_shared_module_exports__['Qd'](this.backgroundColor||"#fff")}hasTextColor(){return this.getTextColor()!=="#000000"}getTextColor(){return __dcg_shared_module_exports__['Qd'](this.textColor||"#000")}getAdditionalFunctions(){return this.options.additionalFunctions}getDisableParentheses(){return this.options.disableParentheses}getTypingSlashWritesDivisionSymbol(){return this.options.typingSlashWritesDivisionSymbol}setTypingAsteriskWritesTimesSymbol(e){this.typingAsteriskWritesTimesSymbol=e}getTypingAsteriskWritesTimesSymbol(){return this.typingAsteriskWritesTimesSymbol}setProjectorMode(e){this.projectorMode=e}isProjectorMode(){return this.projectorMode}getReplaceCommaWith10Exp(){return this.replaceCommaWith10Exp}setReplaceCommaWith10Exp(e){this.replaceCommaWith10Exp=e}getReplaceRoundWithReciprocal(){return this.model.getReplaceRoundWithReciprocal()}setReplaceRoundWithReciprocal(e){e?this.model.enableReplaceRoundWithReciprocal():this.model.disableReplaceRoundWithReciprocal()}setCapExpressionSize(e){this.capExpressionSize=e}getCapExpressionSize(){return this.capExpressionSize}setDecimalToFraction(e){this.decimalToFraction=e}setLanguage(e){e!=="en"&&!nG(e)?__dcg_shared_module_exports__['g'].warn(`Translation for '${e}' isn't currently available. Using '${this.language}' instead.`):this.language=e}getLanguage(){return this.language}getDecimalToFraction(){return this.decimalToFraction}isScientificCalc(){let e=this.options.evaluationMode;return e==="scientific"||e==="singleExpressionScientific"}isFourFunctionCalc(){return this.options.evaluationMode==="fourFunction"||this.options.evaluationMode==="singleExpressionFourFunction"}getAllowLinks(){return this.options.links}canUndo(){return this.stateStack.canUndo()}canRedo(){return this.stateStack.canRedo()}undo(e){if(!this.canUndo())return;this.stateStack.undo();let t=this.stateStack.getState();e.restoreFocus||(t={...t,ui:{focus:void 0}}),this.model.setState(t),this.enqueueEvent("change")}redo(e){if(!this.canRedo())return;this.stateStack.redo();let t=this.stateStack.getState();e.restoreFocus||(t={...t,ui:{focus:void 0}}),this.model.setState(t),this.enqueueEvent("change")}clearHistory(){this.stateStack.clear()}canBackspace(){let e=this.model.getFocusedExpression();return e&&(e.latex.length>0||this.model.getNumberOfExpressions()>1)}focusLastExpression(){this.model.focusLastExpression()}shouldRender(){return this.containerSize.width>0&&this.containerSize.height>0}canClear(){return this.model.canClear()}shouldShowClear(){return this.model.shouldShowClear()}enableSettingsMenu(){this.settingsMenu=!0}disableSettingsMenu(){this.closeSettingsMenu(),this.settingsMenu=!1}closeSettingsMenu(){this.settingsMenuOpen=!1}toggleSettingsMenu(){this.settingsMenuOpen=!this.settingsMenuOpen}isSettingsMenuOpen(){return this.settingsMenuOpen}isLastExpressionEmpty(){return this.model.isLastExpressionEmpty()}createAtEnd(){this.model.createAtEnd()}clearFocusedExpression(){this.model.clearFocusedExpression()}setLatexById(e,t){this.model.setLatexById(e,t)}setLatexAndBrailleById(e,t,o){this.model.setLatexAndBrailleById(e,t,o)}setLatexOfFocusedExpression(e){this.model.setLatexOfFocusedExpression(e)}toggleFractionEvaluationById(e){this.model.setFractionEvaluation(e,!this.model.getExpressionById(e).displayAsFraction)}conditionallyCopyPrevious(e){this.model.conditionallyCopyPrevious(e)}createBlankAfterId(e){this.model.createBlankAfterId(e)}backspaceAtFrontOfId(e){this.model.backspaceAtFrontOfId(e)}areStatesDifferentEnoughForUndoRedo(e,t){let o={focus:void 0};return __dcg_shared_module_exports__['J']({...e,ui:o},{...t,ui:o})}commitUndoRedoDebounced(){let e=this.model.getState(),t=this.stateStack.getState();if(this.areStatesDifferentEnoughForUndoRedo(e,t))return;let o=new Date().getTime();o-this._lastDebouncedTime<1e3?this.stateStack.replaceState(e):this.stateStack.addState(e),this._lastDebouncedTime=o,this.enqueueEvent("change")}commitUndoRedoSynchronously(){let e=this.model.getState(),t=this.stateStack.getState();this.areStatesDifferentEnoughForUndoRedo(e,t)||(this._lastDebouncedTime=0,this.stateStack.addState(e),this.enqueueEvent("change"))}updateKeyboardMode(e){this.keyboardMode=e}getFocusedMathquill(){if(this.model.getFocusedExpressionId())return Ze.getFocusedMathquill()}ensureMathquillIsFocusedAndReturnFocusedMathquill(){let e=this.getFocusedMathquill();if(e)return e;if(this.isLastExpressionEmpty()&&!this.model.isSingleExpression()?this.createAtEnd():this.focusLastExpression(),this.onEventEmitted&&this.onEventEmitted("render"),e=this.getFocusedMathquill(),!e)throw new Error("No focused mathquill found");return e}typeIntoFocusedMathquill(e){e=e.replace(/\r|\n/g,"");let t=this.ensureMathquillIsFocusedAndReturnFocusedMathquill();t&&Ze.canAcceptText(t,this.getCapExpressionSize(),e)&&(t.typedText(e),this.setLatexOfFocusedExpression(t.latex()),this.model.markShouldDebounceUndoRedo())}pressKeyInFocusedMathquill(e){if(this.getBrailleMode()!=="none")return;let t=this.ensureMathquillIsFocusedAndReturnFocusedMathquill();if(!t)return;let{key:o,source:i,evt:n}=e;if(o==="Up"||o==="Down"||o==="Left"||o==="Right"){let a=i==="keypad"?Ze.temporarilyOverrideLeftRightIntoCommandGoes(t,void 0):void 0,s=Ze.applyArrowKeyAndReturnIfWasAtBounds(t,o,n);a==null||a(),s&&this.moveFocusInDirection(o)}else o==="Enter"?(n&&(n.preventDefault(),n.stopPropagation()),this.handleEnter()):o==="Backspace"?this.attemptToMoveFocusWithBackspace()||(t.keystroke(o,n),this.setLatexOfFocusedExpression(t.latex())):o==="Delete"?(t.keystroke(o,n),this.setLatexOfFocusedExpression(t.latex())):(t.keystroke(o,n),this.setLatexOfFocusedExpression(t.latex()))}moveFocusInDirection(e){let t=this.model.getFocusedExpressionId();t&&(e==="Up"?this.model.focusPrevById(t):e==="Down"&&this.model.focusNextById(t))}handleEnter(){if(this.model.isSingleExpression())return;let e=this.model.getFocusedExpressionId();e&&(this.conditionallyCopyPrevious(e),this.createBlankAfterId(e))}attemptToMoveFocusWithBackspace(){let e=this.model.getFocusedExpression();if(!e)return!1;let{latex:t,id:o}=e;return t===""?(this.backspaceAtFrontOfId(o),!0):!1}executeCommandInFocusedMathquill(e){let t=this.ensureMathquillIsFocusedAndReturnFocusedMathquill();t&&(JV(t,e,{capExpressionSize:this.getCapExpressionSize()}),this.setLatexOfFocusedExpression(t.latex()))}syncPublicSettings(){this.settingsProxy.setProperty("language",this.language),this.settingsProxy.setProperty("fontSize",this.fontSize),this.settingsProxy.setProperty("degreeMode",this.model.getDegreeMode()),this.settingsProxy.setProperty("invertedColors",this.invertedColors),this.settingsProxy.setProperty("backgroundColor",this.backgroundColor),this.settingsProxy.setProperty("textColor",this.textColor),this.settingsProxy.setProperty("brailleMode",this.brailleMode),this.settingsProxy.setProperty("sixKeyInput",this.sixKeyInput),this.settingsProxy.setProperty("brailleControls",this.brailleControls),this.settingsProxy.setProperty("brailleExpressionDownload",this.brailleExpressionDownload),this.settingsProxy.setProperty("projectorMode",this.projectorMode),this.settingsProxy.setProperty("capExpressionSize",this.capExpressionSize),this.settingsProxy.setProperty("decimalToFraction",this.decimalToFraction),this.settingsProxy.setProperty("qwertyKeyboard",this.options.qwertyKeyboard),this.settingsProxy.setProperty("links",this.options.links),this.settingsProxy.setProperty("settingsMenu",this.settingsMenu),this.settingsProxy.setProperty("functionDefinition",this.model.getFunctionDefinition()),this.settingsProxy.setProperty("replaceCommaWith10Exp",this.replaceCommaWith10Exp),this.settingsProxy.setProperty("replaceRoundWithReciprocal",this.model.getReplaceRoundWithReciprocal()),this.settingsProxy.setProperty("typingAsteriskWritesTimesSymbol",this.typingAsteriskWritesTimesSymbol)}getDegreeMode(){return this.model.getDegreeMode()}hookUpDispatcher(){this.dispatcher.register(e=>{this.enqueueEvent("render");let t=!1,o=this.getRestrictedEditing();switch(e.type){case"update-options":{this.options={...this.options,...e.options};break}case"keypad/shift":{let s;switch(this.keyboardMode){case"qwerty":s="capitalQwerty";break;case"capitalQwerty":s="qwerty";break;case"letters":s="capitalLetters";break;case"capitalLetters":s="letters";break;default:s="qwerty"}this.updateKeyboardMode(s)}break;case"undo":o||(this.undo({restoreFocus:e.source==="keyboard-shortcut"}),t=!0);break;case"redo":o||(this.redo({restoreFocus:e.source==="keyboard-shortcut"}),t=!0);break;case"clear-history":this.clearHistory();break;case"set-state-from-api":e.opts.allowUndo||this.clearHistory(),this.model.setStateFromAPI(e.state);break;case"main":this.updateKeyboardMode("main");break;case"ABC":this.options.qwertyKeyboard?this.updateKeyboardMode("qwerty"):this.updateKeyboardMode("letters");break;case"functions":this.updateKeyboardMode("functions");break;case"degrees":this.model.setDegreeMode(!this.model.getDegreeMode());break;case"update-degree-mode":this.model.setDegreeMode(!!e.mode);break;case"update-font-size":let i=e.size;if(typeof i!="number"&&(i=parseInt(i,10)),isNaN(i))return;this.fontSize=i;break;case"update-inverted-colors":this.invertedColors=!!e.mode;break;case"update-background-color":this.backgroundColor=e.color;break;case"update-text-color":this.textColor=e.color;break;case"update-projector-mode":this.setProjectorMode(!!e.mode);break;case"update-cap-expression-size":this.setCapExpressionSize(!!e.mode);break;case"update-decimal-to-fraction":this.setDecimalToFraction(!!e.mode);break;case"update-language":this.setLanguage(e.language);break;case"set-blank":e.opts.allowUndo||this.clearHistory(),this.model.clear(),this.focusLastExpression();break;case"clear":this.model.clearFocusedExpression();break;case"set-braille-mode":let n=e.mode;n!=="nemeth"&&n!=="ueb"&&n!=="none"?__dcg_shared_module_exports__['g'].warn(`Valid Braille modes are 'nemeth', 'none', and 'ueb'. You passed '${n}'.`):(this.model.clearCachedBrailleValues(),this.setBrailleMode(e.mode));break;case"set-six-key-input":this.setSixKeyInput(!!e.useSixKeyInput);break;case"set-braille-controls":this.setBrailleControls(!!e.value);break;case"set-braille-expression-download":this.setBrailleExpressionDownload(!!e.mode);break;case"set-replace-comma-with-10-exp":this.setReplaceCommaWith10Exp(!!e.replace);break;case"set-replace-round-with-reciprocal":this.setReplaceRoundWithReciprocal(!!e.replace);break;case"set-typing-asterisk-writes-times-symbol":this.setTypingAsteriskWritesTimesSymbol(!!e.mode);break;case"update-latex":this.model.markShouldDebounceUndoRedo(),this.setLatexById(e.id,e.latex);break;case"update-latex-from-braille":this.model.markShouldDebounceUndoRedo(),this.setLatexAndBrailleById(e.id,e.latex,e.braille);break;case"focusin":this.model.setFocusedById(e.id,!0);break;case"focusout":this.model.setFocusedById(e.id,!1);break;case"focus-first-expression":this.model.focusFirstExpression();break;case"focus-prev-expression":this.moveFocusInDirection("Up");break;case"focus-next-expression":this.moveFocusInDirection("Down");break;case"focus-last-expression":this.model.focusLastExpression();break;case"insert-blank-expression":this.handleEnter();break;case"backspace-from-braille":this.attemptToMoveFocusWithBackspace();break;case"keypad/type-text":this.typeIntoFocusedMathquill(e.text);break;case"keypad/press-key":this.pressKeyInFocusedMathquill(e);break;case"keypad/custom-command":this.executeCommandInFocusedMathquill(e.command);break;case"keypad/123":case"keypad/abc":case"keypad/audio-trace":break;case"enable-settings-menu":this.enableSettingsMenu();break;case"disable-settings-menu":this.disableSettingsMenu();break;case"toggle-settings-menu":this.toggleSettingsMenu();break;case"close-settings-menu":this.closeSettingsMenu();break;case"render":break;case"ui/container-resized":this.containerSize=e.size;break;case"toggle-fraction-evaluation":this.toggleFractionEvaluationById(e.id);break;case"toggle-complex-mode":this.isComplexModeAllowed()&&this.model.setComplexMode(e.enabled);break;case"toggle-complex-allowed":this.options.allowComplex=e.enabled;break;default:return e}this.runAfterDispatch(()=>this.syncPublicSettings()),t||(this.model.getShouldDebounceUndoRedo()?(this.commitUndoRedoDebounced(),this.model.clearShouldDebounceUndoRedo()):this.commitUndoRedoSynchronously())})}getMathquillConfig(){let e=this.getAdditionalFunctions(),t=this.isFourFunctionCalc()&&(!e||e.indexOf("fraction")===-1);return{typingAsteriskWritesTimesSymbol:this.getTypingAsteriskWritesTimesSymbol(),typingSlashWritesDivisionSymbol:this.getTypingSlashWritesDivisionSymbol(),disableCopyPaste:this.getRestrictedEditing(),autoCommands:Qg({disallowFrac:t}),...Sx()}}isComplexModeEnabled(){return this.model.getComplexMode()&&this.isComplexModeAllowed()}isComplexModeAllowed(){return this.options.evaluationMode==="scientific"&&this.options.allowComplex}canDisplayEvaluationAsFraction(e){return this.getDecimalToFraction()&&this.model.canDisplayEvaluationAsFraction(e)}shouldDisplayEvaluationAsFraction(e){return this.canDisplayEvaluationAsFraction(e)&&this.model.getExpressionById(e).displayAsFraction}getEvaluationDigits(){return this.isScientificCalc()?10:7}getLabelOptionsForExpression(e){let t=this.model.getExpressionTypedConstantValue(e);return(t==null?void 0:t.valueType)===__dcg_shared_module_exports__['Ka']?{...__dcg_shared_module_exports__['Wb'],digits:Math.min(this.getEvaluationDigits(),__dcg_shared_module_exports__['Wb'].digits)}:{digits:this.getEvaluationDigits(),bigCutoff:1e9,displayAsFraction:this.shouldDisplayEvaluationAsFraction(e)}}getEvaluationMode(){return this.options.evaluationMode}};tu();var Zr=__dcg_shared_module_exports__['e'](Z());var Js=__dcg_shared_module_exports__['e'](Z());$t();var nre=__dcg_shared_module_exports__['e'](Z()),Fr=class extends nre.Class{init(){this.controller=this.props.controller(),this.model=this.controller.model,this.dispatch=this.controller.dispatch,this.s=this.controller.s}};var kr=__dcg_shared_module_exports__['e'](Z());var{If:Eg,Input:Nwe,Textarea:Bwe}=kr.Components,lD=class extends Fr{constructor(){super(...arguments),this.lastBrailleModeDuringFocusChange="none"}getAriaLabel(){let e=this.getIndex()+1+"";return this.s("shared-calculator-narration-expression-index",{index:e})}didUpdate(){this.renderAnsValue()}didMountMQ(e){this.mq=e}getExp(){return this.model.getExpressionById(this.props.id())}getLatex(){return this.getExp().latex}getValue(){return this.model.getExpressionValue(this.props.id())}getBraille(){let e=this.getExp().braille;if(e!=="")return e;{let t=Uv(this.getLatex(),this.controller.getBrailleMode());return t.isError?"":Ks.toExpandedBrailleAscii(t.value)}}getIndex(){return this.model.getExpressionIndex(this.props.id())}getShowEvaluation(){return this.model.shouldShowEvaluationForExpression(this.props.id())}isFractionEvaluation(){return this.getExp().displayAsFraction}toggleFractionEvaluation(){this.dispatch({type:"toggle-fraction-evaluation",id:this.props.id()})}getFractionDisplayAriaLabel(){return this.controller.shouldDisplayEvaluationAsFraction(this.props.id())?this.controller.s("basic-calculator-narration-convert-to-decimal"):this.controller.s("basic-calculator-narration-convert-to-fraction")}getError(){let e=this.model.getExpressionError(this.props.id());return e&&this.getLatex().length>0?Ec(e,this.controller.getLanguage()):""}showError(){return!!this.getError()}getFractionMessage(){return this.controller.shouldDisplayEvaluationAsFraction(this.props.id())?this.s("basic-calculator-label-convert-to-decimal"):this.s("basic-calculator-label-convert-to-fraction")}getIsFocused(){return!this.controller.isSettingsMenuOpen()&&this.model.isExpressionFocused(this.props.id())}onFocusedChanged(e){let t=this.controller.getBrailleMode(),o=t!==this.lastBrailleModeDuringFocusChange;this.lastBrailleModeDuringFocusChange=t,!(!this.getExp()||o)&&(e?this.dispatch({type:"focusin",id:this.props.id()}):this.dispatch({type:"focusout",id:this.props.id()}))}onMQReflow(){this.cachedRenderedAnsString=void 0,this.renderAnsValue()}renderAnsValue(){if(!this.mq)return;let e=this.model.getExpressionAnsId(this.props.id()),t;if(e!==void 0){let o=this.controller.getLabelOptionsForExpression(e),i=this.model.getExpressionTypedConstantValue(e);switch(i==null?void 0:i.valueType){case __dcg_shared_module_exports__['Ka']:t=__dcg_shared_module_exports__['cc'](i.value,{...o,digits:5,scientificNotationDigits:3},"html");break;case __dcg_shared_module_exports__['ba']:t=__dcg_shared_module_exports__['Zb'](i.value,o);break;default:__dcg_shared_module_exports__['bb'](i==null?void 0:i.valueType)&&(t="[...]");break}}t!==this.cachedRenderedAnsString&&(this.mq.querySelectorAll(".dcg-mq-ans").forEach(o=>{t?(o.classList.remove("dcg-invalid"),o.innerHTML=t):(o.classList.add("dcg-invalid"),o.innerHTML='<i class="dcg-icon-error" aria-hidden="true"></i>')}),this.cachedRenderedAnsString=t)}getEvaluationLatex(){let e=this.props.id();if(this.model.isRationalizableConstant(e)&&!this.controller.shouldDisplayEvaluationAsFraction(e))return"";let t=this.controller.getLabelOptionsForExpression(e),o=this.model.getExpressionTypedConstantValue(e),i;switch(o==null?void 0:o.valueType){case __dcg_shared_module_exports__['Ka']:i=__dcg_shared_module_exports__['cc'](o.value,t,"latex");break;case __dcg_shared_module_exports__['ba']:i=__dcg_shared_module_exports__['_b'](o.value,t);break;default:if(__dcg_shared_module_exports__['bb'](o==null?void 0:o.valueType))return`\\mathrm{${o.value.length}\\ element\\ list}`;break}return(i==="undefined"||i===void 0)&&(i="\\mathrm{undefined}"),`=${i}`}getEvaluationBraille(){let e=this.getEvaluationLatex(),t=Uv(e,this.controller.getBrailleMode());return t.isError?"":Ks.toExpandedBrailleAscii(t.value)}didMountBrailleInput(e){this.brailleInputNode=e}didUnmountBrailleInput(){this.brailleInputNode=void 0}handleBrailleFocus(e){let t=e.target;t&&setTimeout(this.bindIfMounted(()=>{t.setSelectionRange(0,0)}))}handleBrailleKeydown(e){!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&(Be(e)===Ia?(this.forceModelFocus(),this.dispatch({type:"focus-prev-expression"}),e.preventDefault()):Be(e)===On?(this.forceModelFocus(),this.dispatch({type:"focus-next-expression"}),e.preventDefault()):Be(e)===Dh?(this.forceModelFocus(),this.dispatch({type:"insert-blank-expression"}),e.preventDefault()):Be(e)===Wg&&document.activeElement===this.brailleInputNode&&this.getBraille()===""&&(this.dispatch({type:"backspace-from-braille"}),e.preventDefault()))}forceModelFocus(){document.activeElement!==this.brailleInputNode&&this.onFocusedChanged(!0)}getPostLabel(){let e=this.props.id(),t=this.controller.getLabelOptionsForExpression(e);if(this.showError())return this.getError();if(this.getShowEvaluation()){let o=this.model.getExpressionTypedConstantValue(e),i="";switch(o==null?void 0:o.valueType){case __dcg_shared_module_exports__['Ka']:i=__dcg_shared_module_exports__['cc'](o.value,t);break;case __dcg_shared_module_exports__['ba']:i=__dcg_shared_module_exports__['_b'](o.value,t);break;default:if(__dcg_shared_module_exports__['bb'](o==null?void 0:o.valueType))return`${o.value.length} element list`;break}return"equals "+Gi(i!=null?i:"undefined")}return""}onBrailleInput(e){this.controller.isSettingsMenuOpen()&&this.controller.dispatch({type:"close-settings-menu"});let t=$A(Ks.coerceToSixDotCells(e),this.controller.getBrailleMode()),o=t.isError?"":t.value;(!this.controller.getCapExpressionSize()||Ex(o)<=zw)&&this.controller.dispatch({type:"update-latex-from-braille",latex:o,braille:e,id:this.props.id()})}getIndexSubscript(){return`_{${this.getIndex()+1}}`}onMountContainer(e){this.containerNode=e}onTapContainer(e){e.target===this.containerNode&&!this.getShowEvaluation()&&!this.showError()&&this.forceModelFocus()}template(){return kr.createElement("div",{class:()=>({"dcg-basic-expression":!0,"dcg-focused":this.getIsFocused(),"dcg-braille-io":this.controller.renderAsBraille()}),onTap:this.bindFn(this.onTapContainer),onMount:this.bindFn(this.onMountContainer)},kr.createElement(Eg,{predicate:()=>this.controller.renderAsBraille()},()=>kr.createElement("div",{class:kr.const("dcg-braille-input")},kr.createElement(iy,{ariaLabel:()=>{let e=Uv(`eq${this.getIndexSubscript()}`,this.controller.getBrailleMode());return e.isError?"":Ks.toExpandedBrailleAscii(e.value)},didMount:this.bindFn(this.didMountBrailleInput),didUnmount:this.bindFn(this.didUnmountBrailleInput),onFocusedChanged:this.bindFn(this.onFocusedChanged),shouldFocus:this.bindFn(this.getIsFocused),onKeyDown:this.bindFn(this.handleBrailleKeydown),onInput:this.bindFn(this.onBrailleInput),sixKeyInput:()=>this.controller.getSixKeyInput(),value:()=>this.getBraille(),isStatic:this.const(!1)}))),kr.createElement(Eg,{predicate:()=>this.controller.renderAsBraille()},()=>kr.createElement("div",{class:kr.const("dcg-braille-evaluation-container")},kr.createElement(Eg,{predicate:()=>this.getShowEvaluation()},()=>kr.createElement("div",{class:kr.const("dcg-braille-evaluation")},kr.createElement(Nwe,{readOnly:this.const(!0),class:this.const("dcg-braille-evaluation-inner"),value:()=>this.getEvaluationBraille(),onFocus:this.bindFn(this.handleBrailleFocus),onKeyDown:this.bindFn(this.handleBrailleKeydown),onInput:()=>{}}))),kr.createElement(Eg,{predicate:()=>this.showError()},()=>kr.createElement("div",{class:kr.const("dcg-braille-error")},kr.createElement("div",{class:kr.const("dcg-basic-expression-error")},kr.createElement("i",{class:kr.const("dcg-icon-error"),"aria-hidden":kr.const("true")})),kr.createElement(Bwe,{readOnly:this.const(!0),class:this.const("dcg-braille-error-inner"),value:()=>this.getError(),onFocus:this.bindFn(this.handleBrailleFocus),onKeyDown:this.bindFn(this.handleBrailleKeydown),onInput:()=>{}}))))),kr.createElement(Eg,{predicate:()=>this.controller.renderAsBraille()},()=>kr.createElement("div",{class:kr.const("dcg-exp-mathquill-container"),didMount:this.bindFn(this.didMountMQ),onTap:this.bindFn(this.forceModelFocus)},kr.createElement(Et,{latex:()=>this.getLatex(),config:this.const({}),onReflow:this.bindFn(this.onMQReflow)}))),kr.createElement(Eg,{predicate:()=>!this.controller.renderAsBraille()},()=>kr.createElement("div",{class:kr.const("dcg-exp-mathquill-container"),didMount:this.bindFn(this.didMountMQ)},kr.createElement(Ze,{latex:()=>this.getLatex(),onReflow:this.bindFn(this.onMQReflow),isFocused:this.bindFn(this.getIsFocused),capExpressionSize:()=>this.controller.getCapExpressionSize(),config:this.bindFn(this.getMQConfig),getAriaLabel:()=>this.getAriaLabel(),getAriaPostLabel:()=>this.getPostLabel(),hasError:()=>!1,onUserPressedKey:(e,t)=>{this.controller.isSettingsMenuOpen()&&this.controller.dispatch({type:"close-settings-menu"}),this.dispatch({type:"keypad/press-key",key:e,evt:t,source:"keyboard"})},onUserTypedText:e=>this.dispatch({type:"keypad/type-text",text:e}),onUserChangedLatex:e=>{this.dispatch({type:"update-latex",id:this.props.id(),latex:e})},onFocusedChanged:this.bindFn(this.onFocusedChanged),disableSpace:()=>this.controller.getRestrictedEditing()}))),kr.createElement("div",{class:kr.const("dcg-exp-output-container")},kr.createElement(Eg,{predicate:()=>this.showError()&&!this.controller.renderAsBraille()},()=>kr.createElement(zn,{error:this.bindFn(this.getError),gravity:this.const("w")})),kr.createElement(Eg,{predicate:()=>this.getShowEvaluation()},()=>kr.createElement("div",{class:()=>({"dcg-basic-expression-value":!0,"dcg-basic-evaluation-gray":this.model.isEvaluationList(this.props.id())})},kr.createElement(Et,{config:this.const({}),latex:()=>this.getEvaluationLatex()}),kr.createElement(Eg,{predicate:()=>this.controller.canDisplayEvaluationAsFraction(this.props.id())},()=>kr.createElement(ze,{tooltip:this.bindFn(this.getFractionMessage),gravity:this.const("s")},kr.createElement("span",{role:kr.const("button"),tabIndex:kr.const("0"),"aria-label":this.bindFn(this.getFractionDisplayAriaLabel),class:()=>({"dcg-basic-fraction-toggle":!0,"dcg-selected":this.isFractionEvaluation()}),onTap:this.bindFn(this.toggleFractionEvaluation)},kr.createElement("i",{class:kr.const("dcg-icon-fraction"),"aria-hidden":kr.const("true")}))))))))}getMQConfig(){return this.controller.getMathquillConfig()}};var{For:Uwe,If:qwe}=Js.Components,cD=class extends Fr{constructor(){super(...arguments),this.didShowAnswerHint=!1,this.didHideAnswerHint=!1}template(){return Js.createElement("div",{class:Js.const("dcg-basic-list-container"),role:Js.const("region"),"aria-label":()=>this.controller.s("shared-calculator-narration-expression-list"),didMount:this.bindFn(this.didMountContainer)},Js.createElement("div",{class:Js.const("dcg-basic-list-placeholder"),didMount:this.bindFn(this.didMountPlaceholder)},Js.createElement(qwe,{predicate:this.bindFn(this.showAnswerHint)},()=>Js.createElement("div",{class:Js.const("dcg-answer-hint")},()=>this.controller.s("basic-calculator-label-answer-hint"),Js.createElement("i",{class:Js.const("dcg-icon-curved-arrow")})))),Js.createElement("div",{class:()=>({"dcg-basic-list":!0,"dcg-projector-mode":this.controller.isProjectorMode()})},Js.createElement(Uwe,{each:()=>this.model.getExpressionOrder()},e=>Js.createElement(lD,{controller:this.props.controller,id:this.const(e)}))))}didMountPlaceholder(e){re(e).on("dcg-tap",Jr)}showAnswerHint(){if(this.didHideAnswerHint)return!1;let e=this.model.getExpressionOrder()[0];return this.model.shouldShowEvaluationForExpression(e)||this.didShowAnswerHint?(this.didShowAnswerHint=!0,this.model.getNumberOfExpressions()>1||this.model.getExpressionLatex(e)===""?(this.didHideAnswerHint=!0,!1):!0):!1}didUpdate(){if(!this.container)return;let e=this.container.querySelector(".dcg-focused");e&&Vc(e,this.container,50)}didMountContainer(e){this.container=e}};var gi=__dcg_shared_module_exports__['e'](Z());var ic=__dcg_shared_module_exports__['e'](Z());var{For:zwe}=ic.Components,I1=class extends ic.Class{template(){return ic.createElement("tr",null,ic.createElement("td",null,ic.createElement(zwe,{each:()=>this.getBrailleAscii(this.props.latex()),key:e=>e.key},e=>ic.createElement("span",{class:ic.const("dcg-key-press")},()=>e.char))),ic.createElement("td",{class:ic.const("dcg-braille-font")},()=>this.getBrailleUnicode(this.props.latex())),ic.createElement("td",null,ic.createElement(Et,{config:this.const({}),latex:()=>this.props.latex()})))}getBrailleAscii(e){let t=Ks.toExpandedBrailleAscii(this.getBrailleUnicode(e)),o=[];for(let i=0;i<t.length;i++)o.push({char:t[i],key:i+")"+t[i]});return o}getBrailleUnicode(e){let t;return this.props.brailleMode()==="nemeth"?t=Hh(e):this.props.brailleMode()==="ueb"&&(t=Kh(e)),t&&t.value?t.value:""}};var vy=class extends Fr{template(){return gi.createElement("div",{class:()=>({"dcg-braille-io-keypad-container":!0,"dcg-has-background-color":this.controller.hasBackgroundColor()})},gi.createElement("div",{class:gi.const("dcg-braille-io-keypad")},gi.createElement("div",{class:gi.const("dcg-braille-description")},gi.createElement("div",{class:gi.const("dcg-braille-title")},()=>this.controller.s("basic-calculator-text-braille-mode-is-on",{mode:this.brailleType()})),gi.createElement("div",{class:gi.const("dcg-braille-info-text")},()=>this.controller.s("basic-calculator-text-how-to-type-braille")),gi.createElement("div",{class:gi.const("dcg-btn-blue"),role:gi.const("button"),tabIndex:gi.const(0),onTap:()=>this.controller.dispatch({type:"set-braille-mode",mode:"none"})},()=>this.controller.s("basic-calculator-button-turn-braille-mode-off",{mode:this.brailleType()}))),gi.createElement("div",{class:gi.const("dcg-braille-examples-table-container")},gi.createElement("table",{class:gi.const("dcg-braille-examples-table")},gi.createElement("tr",null,gi.createElement("th",null,()=>this.controller.s("basic-calculator-heading-braille-table-type-this")),gi.createElement("th",null,()=>this.brailleType()),gi.createElement("th",null,()=>this.controller.s("basic-calculator-heading-braille-table-typeset"))),gi.createElement(I1,{brailleMode:()=>this.controller.getBrailleMode(),latex:this.const("2+2")}),gi.createElement(I1,{brailleMode:()=>this.controller.getBrailleMode(),latex:this.const("\\frac{1}{2}")}),gi.createElement(I1,{brailleMode:()=>this.controller.getBrailleMode(),latex:this.const("\\sqrt{4}")})),gi.createElement("div",{class:gi.const("dcg-more-examples-link")},gi.createElement("a",{href:()=>"https://www.desmos.com/braille-examples?"+this.controller.getBrailleMode(),target:gi.const("_blank")},()=>this.controller.s("basic-calculator-link-view-braille-examples"))))))}brailleType(){return this.controller.getBrailleMode()==="nemeth"?"Nemeth":this.controller.getBrailleMode()==="ueb"?"UEB":""}};var Ki=__dcg_shared_module_exports__['e'](Z());var Cy=__dcg_shared_module_exports__['e'](Z());var Bp=class extends oy{template(){return Cy.createElement("div",{class:Cy.const("dcg-keypad-control-bar dcg-do-not-blur"),role:Cy.const("group"),"aria-label":()=>this.controller.s("shared-calculator-narration-keypad-controlbar")},Cy.createElement("div",{class:Cy.const("dcg-keypad-control-bar-contents")},this.props.children))}};var M1=__dcg_shared_module_exports__['e'](Z()),ki=class extends M1.Class{template(){return M1.createElement("div",{class:()=>({"dcg-keypad-control-btn":!0,"dcg-disabled":this.isDisabled(),"dcg-selected":!this.isDisabled()&&this.isSelected(),"dcg-selectable-btn":!this.isDisabled()&&this.isSelectable(),"dcg-narrow-control-btn":this.props.narrowButton&&this.props.narrowButton()}),didMount:this.bindFn(this.didMount),role:M1.const("button"),"aria-disabled":()=>this.isDisabled()||void 0,"aria-label":()=>this.getAriaLabel(),"dcg-command":this.props.command,onTap:this.bindFn(this.handleTap),"aria-pressed":()=>!this.hasPopup()&&!this.isDisabled()&&this.isSelectable()?this.isSelected():void 0,"aria-expanded":()=>this.hasPopup()&&!this.isDisabled()?this.isSelected():void 0,tabIndex:this.bindFn(this.getTabIndex)},this.props.children)}getTabIndex(){if(!this.isDisabled())return this.props.ignoreInTabOrder&&this.props.ignoreInTabOrder()?-1:0}handleTap(e){this.isDisabled()||this.props.onTap(e)}getAriaLabel(){return this.props.ariaLabel?this.props.ariaLabel():this.props.command()}hasPopup(){var e,t;return!!((t=(e=this.props).ariaPopup)!=null&&t.call(e))}isDisabled(){var e,t;return!!((t=(e=this.props).disabled)!=null&&t.call(e))}isSelected(){var e,t;return!!((t=(e=this.props).selected)!=null&&t.call(e))}isSelectable(){var e,t;return!!((t=(e=this.props).selectable)!=null&&t.call(e))}didMount(e){this.props.didMount&&this.props.didMount(e)}};var oi=__dcg_shared_module_exports__['e'](Z());var rh=__dcg_shared_module_exports__['e'](Z());function Hwe(){if(!p_)return!1;let r=navigator.userAgent.match(/Version\/(\d+)/);return!r||!r[1]?!1:parseFloat(r[1])<11}function are(){return!Rz&&!Hwe()&&typeof document.createElement("a").download!="undefined"}function cP(){return are()||navigator.msSaveBlob!==void 0}var Sf=class extends rh.Class{init(){this.supportsDirectDownload=are()}template(){return rh.createElement("a",{role:rh.const("button"),tabIndex:()=>this.props.enabled()?0:-1,"aria-disabled":()=>this.props.enabled()?void 0:!0,class:()=>{var e,t,o,i,n,a;return{"dcg-download-button":!0,"dcg-btn-blue":((t=(e=this.props).buttonType)==null?void 0:t.call(e))==="primary","dcg-btn-blue-outline":((i=(o=this.props).buttonType)==null?void 0:i.call(o))==="secondary","dcg-primary-link":((a=(n=this.props).buttonType)==null?void 0:a.call(n))==="link","dcg-disabled":!this.props.enabled()}},didMount:this.bindFn(this.didMountDownload),didUnmount:this.bindFn(this.didUnmountDownload),didUpdate:this.bindFn(this.didUpdate),download:()=>this.supportsDirectDownload?this.props.filename():void 0,onTap:e=>{var o,i;if((i=(o=this.props).triggerLogEvent)==null||i.call(o),this.supportsDirectDownload||!navigator.msSaveOrOpenBlob)return;let t=this.props.data();t&&(navigator.msSaveOrOpenBlob(t,this.props.filename()),e.preventDefault())}},rh.createElement("i",{class:rh.const("dcg-icon-download"),"aria-hidden":rh.const("true")}),rh.createElement("span",null,()=>this.props.text()))}didMountDownload(e){this.downloadLink=e,this.didUpdate()}didUnmountDownload(){this.revokeBlobURL()}didUpdate(){this.updateDownloadURL(),this.cachedObjectURL&&(this.downloadLink.href=this.cachedObjectURL)}updateDownloadURL(){if(this.revokeBlobURL(),!this.supportsDirectDownload)return;let e=this.props.data();e&&(this.cachedObjectURL=URL.createObjectURL(e))}revokeBlobURL(){this.cachedObjectURL&&URL.revokeObjectURL(this.cachedObjectURL)}};$t();function cn(r,e,t=!1){if(t&&(r=r.replace(/ /g,"\\ ")),e==="none")return r;let o=e==="nemeth"?Hh(r):Kh(r);return o.isError?"":Ks.toBrailleAscii(o.value)}function sre(r,e){var n;if(e==="none")return"";let t=[];t.push(cn("Expression List",e,!0)),t.push(""),t.push("");let o="",i=r.getItemCount();for(let a=0;a<i;a++){let s=r.getItemModelByIndex(a);if(s&&!s.secret){o!==""&&s.type!=="folder"&&o!==s.folderId&&(t.push(dD(cn("End Folder",e,!0))),o="");let l="";switch(s.type){case"expression":if(!s.hidden){let d=cre(s.displayIndex,e);l=s.latex;let p=[],u=s.formula;if(u&&!al(s)){if(r.shouldShowEvaluationForItem(s.id)){let h=(n=u.typed_constant_value)==null?void 0:n.value;Array.isArray(h)?l+=`\\ ${h.length}\\ element\\ list`:l+=`=${h}`}else if(mp(s))p.push(cn(`Min=${aC(s)}`,e,!1)),p.push(cn(`Max=${sC(s)}`,e,!1)),cC(s)&&lC(s)&&p.push(cn(`CDF=${jT(s)}`,e,!1));else if(ww(s)){let h=dw(s);h&&(p.push(cn(`<${__dcg_shared_module_exports__['le'](h.lessThan,5)}`,e,!1)),p.push(cn(`>${__dcg_shared_module_exports__['le'](h.greaterThan,5)}`,e,!1)),p.push(cn(`\\ne${__dcg_shared_module_exports__['le'](h.notEqual,5)}`,e,!1)))}else if(u.is_regression&&u.regression){let h=u.regression,m=h.statistics,y=h.parameters;m.Rsquared!==void 0&&p.push(cn(`R^2=${sy(m.Rsquared)}`,e,!1)),m.rsquared!==void 0&&p.push(cn(`r^2=${sy(m.rsquared)}`,e,!1)),m.r!==void 0&&p.push(cn(`r=${sy(m.r)}`,e,!1)),m.RMSE!==void 0&&p.push(cn(`\\operatorname{RMSE}=${sy(m.RMSE)}`,e,!1));for(let w in y)p.push(cn(`${w}=${XA(h,w)}`,e,!1))}}t.push(`${d}  ${cn(l,e,!1)}`),t.push.apply(t,p)}break;case"text":t.push(cn(s.text,e,!0));break;case"folder":s.collapsed?l=`Collapsed Folder ${s.title}`:(l=`Start Folder ${s.title}`,o=s.id),t.push(dD(cn(l,e,!0)));break;case"image":t.push(cn("Image",e,!1));break;case"table":t.push(dD(cn("Start Table",e,!0)));for(let d=0;d<Kc(s);d++){let p=[],u;for(let m=0;m<Ax(s);m++)d===0?u=s.columnModels[m].latex||"":u=G0(s,d-1,m),p.push(cn(u,e));let h=p.join("	");/^\t/.test(h)||t.push(h)}t.push(dD(cn("End Table",e,!0)));break;default:return s}}}return o!==""&&t.push(dD(cn("End Folder",e,!0))),t.join(`
`)}function lre(r,e){if(e==="none")return"";let t=[];t.push(cn("Expression List",e,!0)),t.push(""),t.push("");for(let o of r.getExpressionOrder()){let i=cre(""+(r.getExpressionIndex(o)+1),e),n=r.getExpressionLatex(o),a=r.getExpressionValue(o);a!==void 0&&(n+=`=${a}`),t.push(`${i}  ${cn(n,e,!1)}`)}return t.join(`
`)}function dD(r){let e="--------------------";return`${e}
${r}
${e}`}function cre(r,e){return e==="nemeth"?`${cn(r,e,!1)}_4`:e==="ueb"?cn(`${r}.`,e,!1):""}var{If:pD}=oi.Components,dP=class extends Fr{template(){return oi.createElement("div",{class:()=>({"dcg-settings-dropdown":!0,"dcg-popover":!0,"dcg-point-left":this.controller.containerSize.height<=420}),role:oi.const("region"),"aria-label":oi.const("Settings Menu"),didMount:this.bindFn(this.didMountSettingsDropdown),didUnmount:this.bindFn(this.didUnmountSettingsDropdown)},oi.createElement("div",{class:oi.const("dcg-popover-interior")},oi.createElement("div",{class:()=>({"dcg-settings-menu-option":!0,"dcg-displaysize-container":!0})},oi.createElement(Po,{ariaGroupLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size"),staticConfig:this.bindFn(this.getProjectorModeOptions)})),oi.createElement(Gt,{onChange:this.bindFn(this.onToggleInvertedColors),checked:()=>this.controller.getInvertedColors(),class:this.const("dcg-settings-menu-option dcg-do-not-blur dcg-reverse-contrast")},oi.createElement("span",{class:oi.const("dcg-checkbox-label")},()=>this.controller.s("basic-calculator-label-reverse-contrast"))),oi.createElement(pD,{predicate:()=>this.controller.getBrailleControls()},()=>oi.createElement("div",null,oi.createElement(Gt,{onChange:this.bindFn(this.onToggleBrailleMode),checked:()=>this.controller.renderAsBraille(),class:this.const("dcg-settings-menu-option dcg-do-not-blur dcg-braille-mode")},oi.createElement("span",{class:oi.const("dcg-checkbox-label")},()=>this.controller.s("shared-calculator-narration-braille-mode"))),oi.createElement(pD,{predicate:()=>this.controller.renderAsBraille()},()=>oi.createElement("div",{class:()=>({"dcg-settings-menu-option":!0,"dcg-braille-container":!0})},oi.createElement(af,{showBrailleNote:this.const(!1),controller:this.props.controller}),oi.createElement("div",{class:oi.const("dcg-braille-options-container")},oi.createElement(pD,{predicate:()=>!gc&&cP()&&this.controller.getBrailleExpressionDownload()},()=>oi.createElement(Sf,{data:()=>{let e=lre(this.model,this.controller.getBrailleMode());return new Blob([e],{type:"text/plain"})},enabled:this.const(!0),filename:this.const("kiavash-equations.brl"),text:()=>this.controller.s("basic-calculator-link-download-braille-equations"),buttonType:this.const("link")}))))))),oi.createElement(pD,{predicate:()=>this.controller.isComplexModeAllowed()},()=>oi.createElement(sf,{controller:this.props.controller,isComplexModeEnabled:()=>this.controller.isComplexModeEnabled(),toggleComplexMode:this.bindFn(this.onToggleComplexMode),product:this.const("scientific")})),oi.createElement(pD,{predicate:()=>!!this.getVersionNumber()},()=>oi.createElement("div",{class:oi.const("dcg-version-number")},oi.const("Version: "),()=>this.getVersionNumber()))))}getProjectorModeOptions(){return[{key:"default",label:()=>"A",ariaLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size-default"),class:()=>"dcg-displaysize-default",selected:()=>!this.getProjectorMode(),onSelect:()=>this.onSelectProjectorModeOption(!1)},{key:"large",label:()=>"A",ariaLabel:()=>this.controller.s("shared-calculator-narration-settings-display-size-large"),class:()=>"dcg-displaysize-large",selected:()=>this.getProjectorMode(),onSelect:()=>this.onSelectProjectorModeOption(!0)}]}onSelectProjectorModeOption(e){this.controller.dispatch({type:"update-projector-mode",mode:e})}getVersionNumber(){let e=window;if(e&&e.AppBridge)return e.AppBridge.versionNumber}didUnmountSettingsDropdown(){re(document).off(".dcg-settings-view")}didMountSettingsDropdown(e){this.settingsGroupNode=e,re(document).on("dcg-tapstart.dcg-settings-view",t=>{t.target.closest(".dcg-basic-settings-container")||this.controller.dispatch({type:"close-settings-menu"})}),re(document).on("keydown.dcg-settings-view",t=>{if(Be(t)==="Esc"&&(this.controller.dispatch({type:"close-settings-menu"}),this.controller.dispatch({type:"focus-last-expression"})),Be(t)==="Tab"&&!t.altKey&&!t.metaKey&&!t.ctrlKey){let o=document.activeElement,i=this.props.settingsButtonNode(),n=[...this.settingsGroupNode.querySelectorAll(".dcg-settings-menu-option")].slice(-1)[0];!t.shiftKey&&o===n?(i.focus(),t.preventDefault(),t.stopPropagation()):t.shiftKey&&o===i&&(n.focus(),t.preventDefault(),t.stopPropagation())}})}onToggleBrailleMode(){this.controller.dispatch({type:"set-braille-mode",mode:this.controller.renderAsBraille()?"none":"nemeth"})}onToggleInvertedColors(){let e=!this.controller.getInvertedColors();this.controller.dispatch({type:"update-inverted-colors",mode:e})}onToggleComplexMode(){this.controller.dispatch({type:"toggle-complex-mode",enabled:!this.controller.isComplexModeEnabled()})}getProjectorMode(){return this.controller.isProjectorMode()}};var ep=__dcg_shared_module_exports__['e'](Z());var{If:Kwe}=ep.Components,A1=class extends Fr{template(){let r=this.props.controller();return ep.createElement("div",{class:ep.const("dcg-basic-settings-container")},ep.createElement(ki,{didMount:e=>this.settingsButtonNode=e,command:this.const("settings"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-settings"),onTap:this.bindFn(this.onToggleSettingsMenu),selected:()=>this.controller.isSettingsMenuOpen(),ariaPopup:this.const(!0)},ep.createElement("i",{class:ep.const("dcg-icon-wrench"),"aria-hidden":ep.const("true")})),ep.createElement(Kwe,{predicate:()=>this.controller.isSettingsMenuOpen()},()=>ep.createElement(dP,{controller:this.props.controller,settingsButtonNode:()=>this.settingsButtonNode})))}onToggleSettingsMenu(){this.controller.dispatch({type:"toggle-settings-menu"})}};var{If:uD,IfElse:Wwe}=Ki.Components,pP=class extends Fr{template(){let r=this.props.controller();return Ki.createElement(Bp,{controller:this.props.controller},Ki.createElement(uD,{predicate:()=>this.showUndoRedo()},()=>Ki.createElement(ki,{command:this.const("undo"),disabled:()=>!r.canUndo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-undo"),onTap:e=>r.dispatch({type:"undo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Ki.createElement("i",{class:Ki.const("dcg-icon-undo"),"aria-hidden":Ki.const("true")}))),Ki.createElement(uD,{predicate:()=>this.showUndoRedo()},()=>Ki.createElement(ki,{command:this.const("redo"),disabled:()=>!r.canRedo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-redo"),onTap:e=>r.dispatch({type:"redo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Ki.createElement("i",{class:Ki.const("dcg-icon-redo"),"aria-hidden":Ki.const("true")}))),Wwe(()=>r.shouldShowClear(),{true:()=>Ki.createElement(ki,{command:this.const("clear"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear"),onTap:()=>r.dispatch({type:"clear"})},()=>r.s("basic-calculator-button-controlbar-clear")),false:()=>Ki.createElement(ki,{command:this.const("clearall"),disabled:()=>!r.canClear(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear-all"),onTap:()=>r.dispatch({type:"set-blank",opts:{allowUndo:!0}})},()=>r.s("basic-calculator-button-controlbar-clear-all"))}),Ki.createElement(uD,{predicate:()=>!this.showUndoRedo()},()=>Ki.createElement("div",{class:Ki.const("dcg-spacer-2")})),Ki.createElement(uD,{predicate:()=>r.getBrailleMode()==="none"},()=>Ki.createElement(ki,{command:this.const("backspace"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-backspace"),disabled:()=>!r.canBackspace(),onTap:()=>r.dispatch({type:"keypad/press-key",key:"Backspace",source:"keypad"})},Ki.createElement("i",{class:Ki.const("dcg-icon-delete"),"aria-hidden":Ki.const("true")}))),Ki.createElement(uD,{predicate:()=>this.props.controller().getSettingsMenu()},()=>Ki.createElement(A1,{controller:this.props.controller})))}showUndoRedo(){return!(this.controller.getRestrictedEditing()||this.controller.getDisableParentheses())}onToggleSettingsMenu(){this.controller.dispatch({type:"toggle-settings-menu"})}};var Fc=__dcg_shared_module_exports__['e'](Z());var{Switch:pre}=Fc.Components,hD=class extends Fr{template(){return Fc.createElement("div",{role:Fc.const("region"),"aria-label":()=>this.s("shared-calculator-narration-keypad")},Fc.createElement(xo,{controller:this.props.controller},Fc.createElement(dt,null,Fc.createElement(pre,{key:this.bindFn(this.getTopLeftButtons)},e=>{switch(e){case"parens":return G(this,"(",{colspan:this.parenColspan()});case"undoredo":return G(this,"undo",{colspan:this.parenColspan(),disabled:()=>!this.controller.canUndo()});case"none":return Ko(this.parenColspan())}}),Fc.createElement(pre,{key:this.bindFn(this.getTopLeftButtons)},e=>{switch(e){case"parens":return G(this,")",{colspan:this.parenColspan()});case"undoredo":return G(this,"redo",{colspan:this.parenColspan(),disabled:()=>!this.controller.canRedo()});case"none":return Ko(this.parenColspan())}}),this.makeAdditionalFunctionKey(0),this.makeAdditionalFunctionKey(1),G(this,"division")),Fc.createElement(dt,null,G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"multiplication")),Fc.createElement(dt,null,G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"-")),Fc.createElement(dt,null,G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"+")),Fc.createElement(dt,null,G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight"}),G(this,"ans"),G(this,"enter",{style:"blue"}))))}getTopLeftButtons(){return this.showParens()?"parens":this.controller.getRestrictedEditing()?"none":"undoredo"}showParens(){return!this.controller.getDisableParentheses()}parenColspan(){return this.controller.getAdditionalFunctions().length>1?.5:1}makeAdditionalFunctionKey(e){let t=this.controller.getAdditionalFunctions()[e];return t==="exponent"?G(this,"a^b"):t==="percent"?G(this,"%"):t==="sqrt"?G(this,"sqrt"):t==="fraction"?G(this,"a/b"):void 0}};var Wn=__dcg_shared_module_exports__['e'](Z());var{If:U5,IfElse:$we}=Wn.Components,uP=class extends Fr{template(){let r=this.props.controller();return Wn.createElement(Bp,{controller:this.props.controller},Wn.createElement(ki,{command:this.const("main"),selected:()=>r.getKeyboardMode()==="main",disabled:()=>this.controller.renderAsBraille(),selectable:this.const(!0),onTap:()=>r.dispatch({type:"main"}),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-main")},()=>r.s("basic-calculator-button-controlbar-main")),Wn.createElement(ki,{command:this.const("ABC"),selected:()=>["qwerty","capitalQwerty","letters"].indexOf(r.getKeyboardMode())!==-1,disabled:()=>this.controller.renderAsBraille(),selectable:this.const(!0),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-abc"),onTap:()=>r.dispatch({type:"ABC"})},()=>r.s("basic-calculator-button-controlbar-abc")),Wn.createElement(ki,{command:this.const("functions"),selected:()=>["functions","restrictedFunctions"].indexOf(r.getKeyboardMode())!==-1,ariaLabel:()=>r.s("basic-calculator-narration-controlbar-functions"),disabled:()=>this.controller.renderAsBraille(),selectable:this.const(!0),onTap:()=>r.dispatch({type:"functions"})},()=>r.s("basic-calculator-button-controlbar-func")),Wn.createElement(Kd,{setup:this.const({type:"basic",controller:this.controller})}),Wn.createElement(U5,{predicate:()=>!this.controller.getRestrictedEditing()},()=>Wn.createElement(ki,{command:this.const("undo"),disabled:()=>!r.canUndo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-undo"),onTap:e=>r.dispatch({type:"undo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Wn.createElement("i",{class:Wn.const("dcg-icon-undo"),"aria-hidden":Wn.const("true")}))),Wn.createElement(U5,{predicate:()=>!this.controller.getRestrictedEditing()},()=>Wn.createElement(ki,{command:this.const("redo"),disabled:()=>!r.canRedo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-redo"),onTap:e=>r.dispatch({type:"redo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Wn.createElement("i",{class:Wn.const("dcg-icon-redo"),"aria-hidden":Wn.const("true")}))),$we(()=>r.shouldShowClear(),{true:()=>Wn.createElement(ki,{command:this.const("clear"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear"),onTap:()=>r.dispatch({type:"clear"})},()=>r.s("basic-calculator-button-controlbar-clear")),false:()=>Wn.createElement(ki,{command:this.const("clearall"),disabled:()=>!r.canClear(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear-all"),onTap:()=>r.dispatch({type:"set-blank",opts:{allowUndo:!0}})},()=>r.s("basic-calculator-button-controlbar-clear-all"))}),Wn.createElement(U5,{predicate:()=>this.props.controller().getSettingsMenu()},()=>Wn.createElement(A1,{controller:this.props.controller})))}};var gd=__dcg_shared_module_exports__['e'](Z());var V1=__dcg_shared_module_exports__['e'](Z());var gD=class extends Fr{template(){return V1.createElement(xo,{controller:this.props.controller},V1.createElement(dt,null,G(this,"A"),G(this,"B"),G(this,"C"),G(this,"D"),G(this,"E"),G(this,"F"),G(this,"G"),G(this,"H"),G(this,"I"),G(this,"J")),V1.createElement(dt,null,G(this,"K"),G(this,"L"),G(this,"M"),G(this,"N"),G(this,"O"),G(this,"P"),G(this,"Q"),G(this,"R"),G(this,"S"),G(this,"T")),V1.createElement(dt,null,G(this,"=",{style:"highlight"}),G(this,","),G(this,"U"),G(this,"V"),G(this,"W"),G(this,"X"),G(this,"Y"),G(this,"Z"),G(this,"pi"),G(this,"backspace",{style:"highlight"})),V1.createElement(dt,null,G(this,"shift",{style:"highlight",colspan:2}),G(this,"("),G(this,")"),G(this,"["),G(this,"]"),G(this,"!"),G(this,"'"),G(this,"enter",{style:"blue",colspan:2})))}};var Up=__dcg_shared_module_exports__['e'](Z());var mD=class extends Fr{template(){return Up.createElement(xo,{controller:this.props.controller},Up.createElement(dt,null,G(this,"Q"),G(this,"W"),G(this,"E"),G(this,"R"),G(this,"T"),G(this,"Y"),G(this,"U"),G(this,"I"),G(this,"O"),G(this,"P")),Up.createElement(dt,null,Up.createElement("div",{class:Up.const("dcg-half-width-placeholder")}),G(this,"A"),G(this,"S"),G(this,"D"),G(this,"F"),G(this,"G"),G(this,"H"),G(this,"J"),G(this,"K"),G(this,"L"),Up.createElement("div",{class:Up.const("dcg-half-width-placeholder")})),Up.createElement(dt,null,G(this,"=",{style:"highlight"}),G(this,"Z"),G(this,"X"),G(this,"C"),G(this,"V"),G(this,"B"),G(this,"N"),G(this,"M"),G(this,","),G(this,"backspace",{style:"highlight"})),Up.createElement(dt,null,G(this,"shift",{style:"highlight",colspan:1.5}),G(this,"("),G(this,")"),G(this,"["),G(this,"]"),G(this,"!"),G(this,"'"),G(this,"pi"),G(this,"enter",{style:"blue",colspan:1.5})))}};var us=__dcg_shared_module_exports__['e'](Z());var{IfElse:jwe}=us.Components,fD=class extends Fr{template(){return us.createElement("div",{class:us.const("dcg-sci-func-keypad")},us.createElement(xo,{controller:this.props.controller},us.createElement(dt,null,G(this,"sin"),G(this,"cos"),G(this,"tan"),us.createElement("div",{class:us.const("dcg-partition-placeholder")}),G(this,"a^b"),G(this,"sqrt"),G(this,"nthroot")),us.createElement(dt,null,G(this,"arcsin"),G(this,"arccos"),G(this,"arctan"),us.createElement("div",{class:us.const("dcg-partition-placeholder")}),G(this,"e^x"),G(this,"abs"),jwe(()=>this.controller.getReplaceRoundWithReciprocal(),{true:()=>G(this,"a^{-1}"),false:()=>G(this,"round")})),us.createElement(dt,null,G(this,"mean"),G(this,"stdev"),G(this,"stdevp"),us.createElement("div",{class:us.const("dcg-partition-placeholder")}),G(this,"ln"),G(this,"log"),G(this,"backspace",{style:"highlight"})),us.createElement(dt,null,G(this,"nPr"),G(this,"nCr"),G(this,"!"),us.createElement("div",{class:us.const("dcg-partition-placeholder")}),G(this,"e"),G(this,"pi"),G(this,"enter",{style:"blue"}))))}};var hs=__dcg_shared_module_exports__['e'](Z());var{IfElse:Ywe}=hs.Components,bD=class extends Fr{template(){return hs.createElement("div",{class:hs.const("dcg-sci-func-keypad dcg-sci-func-keypad--complex")},hs.createElement(xo,{controller:this.props.controller},hs.createElement(dt,null,G(this,"sin"),G(this,"cos"),G(this,"tan"),hs.createElement("div",{class:hs.const("dcg-partition-placeholder")}),G(this,"%"),G(this,"pi"),G(this,"e"),G(this,"e^x")),hs.createElement(dt,null,G(this,"arcsin"),G(this,"arccos"),G(this,"arctan"),hs.createElement("div",{class:hs.const("dcg-partition-placeholder")}),G(this,"real"),G(this,"imag"),G(this,"conj"),G(this,"arg")),hs.createElement(dt,null,G(this,"mean"),G(this,"stdev"),G(this,"stdevp"),hs.createElement("div",{class:hs.const("dcg-partition-placeholder")}),G(this,"ln"),G(this,"log"),G(this,"sqrt"),G(this,"backspace",{style:"highlight"})),hs.createElement(dt,null,G(this,"nPr"),G(this,"nCr"),G(this,"!"),hs.createElement("div",{class:hs.const("dcg-partition-placeholder")}),G(this,"abs"),Ywe(()=>this.controller.getReplaceRoundWithReciprocal(),{true:()=>G(this,"a^{-1}"),false:()=>G(this,"round")}),G(this,"nthroot"),G(this,"enter",{style:"blue"}))))}};var dn=__dcg_shared_module_exports__['e'](Z());var{IfElse:ure}=dn.Components,yD=class extends Fr{template(){return dn.createElement(xo,{controller:this.props.controller},dn.createElement(dt,null,G(this,"a^2"),G(this,"a^b"),G(this,"|a|"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"division"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),ure(()=>{var e,t;return(t=(e=this.controller).isComplexModeEnabled)==null?void 0:t.call(e)},{true:()=>G(this,"i"),false:()=>G(this,"%")}),G(this,"a/b")),dn.createElement(dt,null,G(this,"sqrt"),G(this,"nthroot"),G(this,"pi"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"multiplication"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"left",{style:"highlight"}),G(this,"right",{style:"highlight"})),dn.createElement(dt,null,G(this,"sin"),G(this,"cos"),G(this,"tan"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"-"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),Ko(.5),G(this,"backspace",{style:"highlight",colspan:1.5})),dn.createElement(dt,null,G(this,"("),G(this,")"),ure(()=>this.controller.getReplaceCommaWith10Exp(),{true:()=>G(this,"10^n"),false:()=>G(this,",")}),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight"}),G(this,"ans"),G(this,"+"),dn.createElement("div",{class:dn.const("dcg-partition-placeholder")}),G(this,"enter",{style:"blue",colspan:2})))}};var L1=__dcg_shared_module_exports__['e'](Z());var xD=class extends Fr{template(){return L1.createElement(xo,{controller:this.props.controller},L1.createElement(dt,null,G(this,"a"),G(this,"b"),G(this,"c"),G(this,"d"),G(this,"e"),G(this,"f"),G(this,"g"),G(this,"h"),G(this,"i"),G(this,"j")),L1.createElement(dt,null,G(this,"k"),G(this,"l"),G(this,"m"),G(this,"n"),G(this,"o"),G(this,"p"),G(this,"q"),G(this,"r"),G(this,"s"),G(this,"t")),L1.createElement(dt,null,G(this,"=",{style:"highlight"}),G(this,","),G(this,"u"),G(this,"v"),G(this,"w"),G(this,"x"),G(this,"y"),G(this,"z"),G(this,"pi"),G(this,"backspace",{style:"highlight"})),L1.createElement(dt,null,G(this,"shift",{style:"highlight",colspan:2}),G(this,"("),G(this,")"),G(this,"["),G(this,"]"),G(this,"!"),G(this,"'"),G(this,"enter",{style:"blue",colspan:2})))}};var qp=__dcg_shared_module_exports__['e'](Z());var wD=class extends Fr{template(){return qp.createElement(xo,{controller:this.props.controller},qp.createElement(dt,null,G(this,"q"),G(this,"w"),G(this,"e"),G(this,"r"),G(this,"t"),G(this,"y"),G(this,"u"),G(this,"i"),G(this,"o"),G(this,"p")),qp.createElement(dt,null,qp.createElement("div",{class:qp.const("dcg-half-width-placeholder")}),G(this,"a"),G(this,"s"),G(this,"d"),G(this,"f"),G(this,"g"),G(this,"h"),G(this,"j"),G(this,"k"),G(this,"l"),qp.createElement("div",{class:qp.const("dcg-half-width-placeholder")})),qp.createElement(dt,null,G(this,"=",{style:"highlight"}),G(this,"z"),G(this,"x"),G(this,"c"),G(this,"v"),G(this,"b"),G(this,"n"),G(this,"m"),G(this,","),G(this,"backspace",{style:"highlight"})),qp.createElement(dt,null,G(this,"shift",{style:"highlight",colspan:1.5}),G(this,"("),G(this,")"),G(this,"["),G(this,"]"),G(this,"!"),G(this,"'"),G(this,"pi"),G(this,"enter",{style:"blue",colspan:1.5})))}};var{SwitchUnion:Xwe,IfElse:Jwe}=gd.Components,vD=class extends Fr{template(){return gd.createElement("div",{role:gd.const("region"),"aria-label":()=>this.s("shared-calculator-narration-keypad")},Xwe(()=>this.controller.getKeyboardMode(),{qwerty:()=>gd.createElement(wD,{controller:this.props.controller}),letters:()=>gd.createElement(xD,{controller:this.props.controller}),capitalQwerty:()=>gd.createElement(mD,{controller:this.props.controller}),capitalLetters:()=>gd.createElement(gD,{controller:this.props.controller}),functions:()=>Jwe(()=>this.controller.isComplexModeEnabled(),{true:()=>gd.createElement(bD,{controller:this.props.controller}),false:()=>gd.createElement(fD,{controller:this.props.controller})}),main:()=>gd.createElement(yD,{controller:this.props.controller})}))}};var Gn=__dcg_shared_module_exports__['e'](Z());var{If:hP}=Gn.Components,gP=class extends Fr{template(){let r=this.props.controller();return Gn.createElement(Bp,{controller:this.props.controller},Gn.createElement(hP,{predicate:()=>!this.controller.getRestrictedEditing()},()=>Gn.createElement(ki,{command:this.const("undo"),disabled:()=>!r.canUndo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-undo"),onTap:e=>r.dispatch({type:"undo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Gn.createElement("i",{class:Gn.const("dcg-icon-undo"),"aria-hidden":Gn.const("true")}))),Gn.createElement(hP,{predicate:()=>!this.controller.getRestrictedEditing()},()=>Gn.createElement(ki,{command:this.const("redo"),disabled:()=>!r.canRedo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-redo"),onTap:e=>r.dispatch({type:"redo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},Gn.createElement("i",{class:Gn.const("dcg-icon-redo"),"aria-hidden":Gn.const("true")}))),Gn.createElement(ki,{command:this.const("clear"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear"),onTap:()=>r.dispatch({type:"clear"})},()=>r.s("basic-calculator-button-controlbar-clear")),Gn.createElement(hP,{predicate:()=>this.controller.getRestrictedEditing()},()=>Gn.createElement("div",{class:Gn.const("dcg-spacer-2")})),Gn.createElement(hP,{predicate:()=>r.getBrailleMode()==="none"},()=>Gn.createElement(ki,{command:this.const("backspace"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-backspace"),disabled:()=>!r.canBackspace(),onTap:()=>r.dispatch({type:"keypad/press-key",key:"Backspace",source:"keypad"})},Gn.createElement("i",{class:Gn.const("dcg-icon-delete"),"aria-hidden":Gn.const("true")}))))}};var oh=__dcg_shared_module_exports__['e'](Z());var CD=class extends Fr{template(){return oh.createElement("div",{role:oh.const("region"),"aria-label":()=>this.s("shared-calculator-narration-keypad")},oh.createElement(xo,{controller:this.props.controller},oh.createElement(dt,null,G(this,"(",{colspan:this.parenColspan()}),G(this,")",{colspan:this.parenColspan()}),this.makeAdditionalFunctionKey(1)),oh.createElement(dt,null,G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"division")),oh.createElement(dt,null,G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"multiplication")),oh.createElement(dt,null,G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"-")),oh.createElement(dt,null,G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight",colspan:this.dotColspan()}),this.makeAdditionalFunctionKey(0),G(this,"+"))))}parenColspan(){return this.controller.getAdditionalFunctions().length===2?1.5:2}dotColspan(){return this.controller.getAdditionalFunctions().length?1:2}makeAdditionalFunctionKey(e){let t=this.controller.getAdditionalFunctions()[e];return t==="exponent"?G(this,"a^b"):t==="percent"?G(this,"%"):t==="sqrt"?G(this,"sqrt"):void 0}};var pn=__dcg_shared_module_exports__['e'](Z());var{If:hre}=pn.Components,mP=class extends Fr{template(){let r=this.props.controller();return pn.createElement(Bp,{controller:this.props.controller},pn.createElement(Kd,{setup:this.const({type:"basic",controller:this.controller})}),pn.createElement("div",{class:pn.const("dcg-spacer")}),pn.createElement(hre,{predicate:()=>!this.controller.getRestrictedEditing()},()=>pn.createElement(ki,{command:this.const("undo"),disabled:()=>!r.canUndo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-undo"),onTap:e=>r.dispatch({type:"undo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},pn.createElement("i",{class:pn.const("dcg-icon-undo"),"aria-hidden":pn.const("true")}))),pn.createElement(hre,{predicate:()=>!this.controller.getRestrictedEditing()},()=>pn.createElement(ki,{command:this.const("redo"),disabled:()=>!r.canRedo(),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-redo"),onTap:e=>r.dispatch({type:"redo",source:e.device==="keyboard"?"button-keyboard":"button-tap"})},pn.createElement("i",{class:pn.const("dcg-icon-redo"),"aria-hidden":pn.const("true")}))),pn.createElement("div",{class:pn.const("dcg-spacer")}),pn.createElement(ki,{narrowButton:this.const(!0),command:this.const("clear"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-clear"),onTap:()=>r.dispatch({type:"clear"})},()=>r.s("basic-calculator-button-controlbar-clear")),pn.createElement(ki,{narrowButton:this.const(!0),command:this.const("backspace"),ariaLabel:()=>r.s("basic-calculator-narration-controlbar-backspace"),onTap:()=>r.dispatch({type:"keypad/press-key",key:"Backspace",source:"keypad"})},pn.createElement("i",{class:pn.const("dcg-icon-delete"),"aria-hidden":pn.const("true")})))}};var Ms=__dcg_shared_module_exports__['e'](Z());var SD=class extends Fr{template(){return Ms.createElement(xo,{controller:this.props.controller},Ms.createElement(dt,null,G(this,"("),G(this,")"),G(this,"x^2"),G(this,"sqrt"),Ms.createElement("div",{class:Ms.const("dcg-partition-placeholder")}),G(this,"x^3"),G(this,"x^y"),G(this,"ythroot")),Ms.createElement(dt,null,G(this,"7",{style:"highlight"}),G(this,"8",{style:"highlight"}),G(this,"9",{style:"highlight"}),G(this,"division"),Ms.createElement("div",{class:Ms.const("dcg-partition-placeholder")}),G(this,"pi"),G(this,"e^x"),G(this,"!")),Ms.createElement(dt,null,G(this,"4",{style:"highlight"}),G(this,"5",{style:"highlight"}),G(this,"6",{style:"highlight"}),G(this,"multiplication"),Ms.createElement("div",{class:Ms.const("dcg-partition-placeholder")}),G(this,"log"),G(this,"ln"),G(this,"|x|")),Ms.createElement(dt,null,G(this,"1",{style:"highlight"}),G(this,"2",{style:"highlight"}),G(this,"3",{style:"highlight"}),G(this,"-"),Ms.createElement("div",{class:Ms.const("dcg-partition-placeholder")}),G(this,"sin"),G(this,"cos"),G(this,"tan")),Ms.createElement(dt,null,G(this,"0",{style:"highlight"}),G(this,".",{style:"highlight"}),G(this,"x/y"),G(this,"+"),Ms.createElement("div",{class:Ms.const("dcg-partition-placeholder")}),G(this,"arcsin"),G(this,"arccos"),G(this,"arctan")))}};var{If:ED,IfElse:fP}=Zr.Components,DD=class extends Fr{template(){return Zr.createElement(ED,{predicate:()=>this.controller.shouldRender()},()=>Zr.createElement("div",{class:this.const(rx),style:Zr.const("width: 100%; height: 100%; position: relative;")},Zr.createElement("div",{class:()=>({"dcg-calc-basic-main-wrapper":!0,"dcg-narrow":this.controller.containerSize.width<570,"dcg-narrower":this.controller.containerSize.width<380,"dcg-short":this.controller.containerSize.height<=540,"dcg-scientific-calculator":this.controller.isScientificCalc(),"dcg-four-function-calculator":this.controller.isFourFunctionCalc(),"dcg-container":!0}),onKeyDown:this.bindFn(this.handleRootKeydown),didMount:this.bindFn(this.didMountRoot),"x-ms-format-detection":Zr.const("none"),style:()=>({"--dcg-custom-background-color":this.controller.hasBackgroundColor()?this.controller.getBackgroundColor():void 0,"--dcg-custom-text-color":this.controller.hasTextColor()?this.controller.getTextColor():void 0})},Zr.createElement("div",{role:Zr.const("application"),"aria-label":()=>this.controller.isScientificCalc()?this.controller.s("basic-calculator-narration-calc-description-scientific"):this.controller.isFourFunctionCalc()?this.controller.s("basic-calculator-narration-calc-description-fourfunction"):"",class:()=>({"dcg-calc-basic-main":!0,"dcg-inverted-colors":this.controller.getInvertedColors(),"dcg-projector-mode":this.controller.isProjectorMode(),"dcg-ipad":Rs,"dcg-has-background-color":this.controller.hasBackgroundColor(),"dcg-no-hyperlinks":!this.controller.getAllowLinks()}),style:()=>({"font-size":`${this.controller.getFontSize()}px`,filter:this.controller.getInvertedColors()?"invert(100%)":"none"})},Zr.createElement(cD,{controller:this.props.controller}),Zr.createElement(ED,{predicate:()=>this.controller.isScientificCalc()&&this.model.isSingleExpression()},()=>Zr.createElement("div",null,Zr.createElement(mP,{controller:this.props.controller}),Zr.createElement("div",{class:Zr.const("dcg-basic-keypad-container")},fP(()=>this.controller.renderAsBraille(),{true:()=>Zr.createElement(vy,{controller:this.props.controller}),false:()=>Zr.createElement(SD,{controller:this.props.controller})})))),Zr.createElement(ED,{predicate:()=>this.controller.isScientificCalc()&&!this.model.isSingleExpression()},()=>Zr.createElement("div",null,Zr.createElement(uP,{controller:this.props.controller}),Zr.createElement("div",{class:Zr.const("dcg-basic-keypad-container")},fP(()=>this.controller.renderAsBraille(),{true:()=>Zr.createElement(vy,{controller:this.props.controller}),false:()=>Zr.createElement(vD,{controller:this.props.controller})})))),Zr.createElement(ED,{predicate:()=>this.controller.isFourFunctionCalc()&&this.model.isSingleExpression()},()=>Zr.createElement("div",null,Zr.createElement(gP,{controller:this.props.controller}),Zr.createElement("div",{class:Zr.const("dcg-basic-keypad-container")},fP(()=>this.controller.renderAsBraille(),{true:()=>Zr.createElement(vy,{controller:this.props.controller}),false:()=>Zr.createElement(CD,{controller:this.props.controller})})))),Zr.createElement(ED,{predicate:()=>this.controller.isFourFunctionCalc()&&!this.model.isSingleExpression()},()=>Zr.createElement("div",null,Zr.createElement(pP,{controller:this.props.controller}),Zr.createElement("div",{class:Zr.const("dcg-basic-keypad-container")},fP(()=>this.controller.renderAsBraille(),{true:()=>Zr.createElement(vy,{controller:this.props.controller}),false:()=>Zr.createElement(hD,{controller:this.props.controller})}))))))))}didMountRoot(e){Zf(e)}handleRootKeydown(e){let t=Ho(e),o=this.controller.model;if(Jf(e))return this.dispatch({type:"undo",source:"keyboard-shortcut"}),!1;if(Qf(e))return this.dispatch({type:"redo",source:"keyboard-shortcut"}),!1;if(e.altKey!==qo&&e.metaKey===qo&&!e.ctrlKey&&e.shiftKey&&t==="A"&&this.controller.getDecimalToFraction()){let i=o.getFocusedExpression();i&&o.canDisplayEvaluationAsFraction(i.id)&&(e.preventDefault(),e.stopPropagation(),this.controller.dispatch({type:"toggle-fraction-evaluation",id:i.id}),this.controller.runAfterDispatch(()=>{o.getFocusedExpression().displayAsFraction?Te(this.controller.s("shared-calculator-narration-show-as-fraction")):Te(this.controller.s("shared-calculator-narration-show-as-decimal"))}))}else if(!e.metaKey&&!e.shiftKey){if(!e.ctrlKey&&!e.altKey&&Be(e)===Wg){if(!document.activeElement||Gh(document.activeElement))return!1}else if(e.ctrlKey===qo&&e.altKey===!qo){if(t==="N")return this.controller.getBrailleControls()?(this.dispatch({type:"set-braille-mode",mode:"nemeth"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-nemeth")),!1):void 0;if(t==="U")return this.controller.getBrailleControls()?(this.dispatch({type:"set-braille-mode",mode:"ueb"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-ueb")),!1):void 0;if(t==="Q"||t==="X")return this.controller.getBrailleControls()?(this.dispatch({type:"set-braille-mode",mode:"none"}),Te(this.controller.s("shared-calculator-narration-hotkey-braille-mode-off")),!1):void 0;if(t==="6"){if(!this.controller.getBrailleControls())return;let i=!this.controller.getSixKeyInput();return this.dispatch({type:"set-six-key-input",useSixKeyInput:i}),Te(i?this.controller.s("basic-calculator-narration-hotkey-six-key-input-on"):this.controller.s("basic-calculator-narration-hotkey-six-key-input-off")),!1}else if(t==="D")return this.controller.isScientificCalc()?(e.preventDefault(),this.controller.dispatch({type:"degrees"}),Te(o.getDegreeMode()?this.controller.s("basic-calculator-narration-controlbar-degrees"):this.controller.s("basic-calculator-narration-controlbar-radians")),!1):void 0}}return!0}};var O1=__dcg_shared_module_exports__['e'](Z());var kD=class{constructor(e){this.eventModel=new Jn;if(this.rootElt=e,!e)throw new Error("must pass an HTMLElement to the API")}setupDomChangeDetector(e){this.autoSize=e,WA(this.rootElt),this.domChangeDetector=new Sb(this.rootElt,t=>{switch(t.type){case"added":this.view=this.onCreateView(),this.onResizeView(t.size);break;case"removed":this.onDestroyView(),this.view=void 0;break;case"resized":this.onResizeView(t.size);break}}),this.autoSize!==!1?this.domChangeDetector.startWatching():this.domChangeDetector.checkForChanges()}detach(){__dcg_shared_module_exports__['g'].warn(".detach() is deprecated. It should no longer be necessary")}destroy(){this.view&&this.onDestroyView(),this.domChangeDetector.destroy();function e(i){__dcg_shared_module_exports__['g'].warn("You've destroyed this API instance. You can no longer call ."+i+"()")}let t={},o=this;for(;o;)Object.getOwnPropertyNames(o).forEach(n=>t[n]=!0),o=Object.getPrototypeOf(o);for(let i in t)typeof this[i]=="function"?this[i]=e.bind(this,i):this.hasOwnProperty(i)&&delete this[i];this.destroy=function(){}}resize(){this.domChangeDetector.checkForChanges()}updateView(){this.view&&document.body&&document.body.contains(this.rootElt)&&this.view.update()}triggerEvent(e,t){this.eventModel.triggerEvent(e,t)}observeEvent(e,t){this.eventModel.observeEvent(e,t)}unobserveEvent(e){this.eventModel.unobserveEvent(e)}};var Qwe={allowComplex:!0,autosize:!0,backgroundColor:"#fff",brailleControls:!0,brailleExpressionDownload:!0,brailleMode:"none",capExpressionSize:!1,complex:!1,decimalToFraction:!0,degreeMode:!1,functionDefinition:!0,invertedColors:!1,language:"en",links:!0,projectorMode:!1,qwertyKeyboard:!0,replaceCommaWith10Exp:!1,replaceRoundWithReciprocal:!1,settingsMenu:!0,sixKeyInput:!1,textColor:"#000"},Zwe={additionalFunctions:["sqrt"],disableParentheses:!1,evaluationMode:"scientific",restrictedEditing:!1,typingAsteriskWritesTimesSymbol:!1,typingSlashWritesDivisionSymbol:!1},eve=["allowComplex","backgroundColor","brailleControls","brailleExpressionDownload","brailleMode","capExpressionSize","complex","decimalToFraction","degreeMode","functionDefinition","invertedColors","language","links","projectorMode","qwertyKeyboard","replaceCommaWith10Exp","replaceRoundWithReciprocal","settingsMenu","sixKeyInput","textColor","restrictedEditing","typingAsteriskWritesTimesSymbol","fontSize"];R4();var P1=class extends kD{constructor(e){super(e)}init(e){e=__dcg_shared_module_exports__['i'](e),e.backgroundColor&&!__dcg_shared_module_exports__['Rd'](e.backgroundColor)&&(__dcg_shared_module_exports__['g'].warn("Invalid backgroundColor. Background color must be a 3- or 6-character hex color (e.g. #cde or #ffaaaa)"),delete e.backgroundColor),e.textColor&&!__dcg_shared_module_exports__['Rd'](e.textColor)&&(__dcg_shared_module_exports__['g'].warn("Invalid textColor. Text color must be a 3- or 6-character hex color (e.g. #000 or #001111)"),delete e.textColor),e.allowComplex||(e.complex&&__dcg_shared_module_exports__['g'].warn("complex: true is not compatible with allowComplex: false. Forcing complex: false"),delete e.complex),e.complex&&e.degreeMode&&(__dcg_shared_module_exports__['g'].warn("degreeMode: true is not compatible with complex: true. Forcing degreeMode: false"),delete e.degreeMode);let t={...Zwe,...Qwe,...e};this.settings=new Hs;let o={workerPool:y1,settingsProxy:this.settings};this.controller=new sD(t,o),this.controller.onEventEmitted=i=>{i==="render"&&this.updateView(),this.triggerEvent(i,void 0)},this.setupDomChangeDetector(t.autosize)}onCreateView(){return O1.mountToNode(DD,this.rootElt,{controller:O1.const(this.controller)})}setState(e,t){t||(t={}),!this.controller.isComplexModeAllowed()&&e.settings.complex&&(e={...e,settings:{...e.settings,complex:!1}}),this.controller.dispatch({type:"set-state-from-api",state:e,opts:{allowUndo:!!t.allowUndo}})}getState(){return __dcg_shared_module_exports__['i'](this.controller.model.getPersistedState())}undo(){this.controller.dispatch({type:"undo",source:"api"})}redo(){this.controller.dispatch({type:"redo",source:"api"})}clearHistory(){this.controller.dispatch({type:"clear-history"})}setBlank(e){e||(e={}),this.controller.dispatch({type:"set-blank",opts:{allowUndo:!!e.allowUndo}})}updateSettings(e){e=__dcg_shared_module_exports__['i'](e),(!e.allowComplex&&!this.controller.isComplexModeAllowed()||this.controller.getEvaluationMode()!=="scientific")&&(delete e.complex,delete e.allowComplex);for(let t of eve)if(t in e)switch(t){case"fontSize":let o=e[t];if(o===void 0)continue;this.controller.dispatch({type:"update-font-size",size:o});break;case"invertedColors":let i=e[t];if(i===void 0)continue;this.controller.dispatch({type:"update-inverted-colors",mode:i});break;case"backgroundColor":let n=e[t];if(n===void 0||!__dcg_shared_module_exports__['Rd'](n)){__dcg_shared_module_exports__['g'].warn("Invalid backgroundColor. Background color must be a 3- or 6-character hex color (e.g. #cde or #ffaaaa)");continue}this.controller.dispatch({type:"update-background-color",color:n});break;case"textColor":let a=e[t];if(a===void 0||!__dcg_shared_module_exports__['Rd'](a)){__dcg_shared_module_exports__['g'].warn("Invalid textColor. Text color must be a 3- or 6-character hex color (e.g. #000 or #001111)");continue}this.controller.dispatch({type:"update-text-color",color:a});break;case"degreeMode":let s=e[t];if(s===void 0)continue;this.controller.dispatch({type:"update-degree-mode",mode:s});break;case"brailleMode":let l=e[t];this.controller.dispatch({type:"set-braille-mode",mode:l});break;case"sixKeyInput":let c=e[t];if(c===void 0)continue;this.controller.dispatch({type:"set-six-key-input",useSixKeyInput:c});break;case"brailleControls":{let v=e[t];if(v===void 0)continue;this.controller.dispatch({type:"set-braille-controls",value:v});break}case"brailleExpressionDownload":let d=e[t];if(d===void 0)continue;this.controller.dispatch({type:"set-braille-expression-download",mode:d});break;case"projectorMode":let p=e[t];if(p===void 0)continue;this.controller.dispatch({type:"update-projector-mode",mode:p});break;case"capExpressionSize":let u=e[t];if(u===void 0)continue;this.controller.dispatch({type:"update-cap-expression-size",mode:u});break;case"language":let h=e[t];if(h===void 0)continue;this.controller.dispatch({type:"update-language",language:Tu(h)});break;case"settingsMenu":e.settingsMenu?this.controller.dispatch({type:"enable-settings-menu"}):this.controller.dispatch({type:"disable-settings-menu"});break;case"qwertyKeyboard":{this.controller.dispatch({type:"update-options",options:{qwertyKeyboard:!!e.qwertyKeyboard}});let v=this.controller.getKeyboardMode();(v==="qwerty"||v==="letters")&&this.controller.dispatch({type:"ABC"})}break;case"functionDefinition":e.functionDefinition?this.controller.model.enableFunctionDefinition():this.controller.model.disableFunctionDefinition();break;case"links":this.controller.dispatch({type:"update-options",options:{links:!!e.links}});break;case"decimalToFraction":let m=e[t];if(m===void 0)continue;this.controller.dispatch({type:"update-decimal-to-fraction",mode:m});break;case"replaceCommaWith10Exp":let y=e[t];if(y===void 0)continue;this.controller.dispatch({type:"set-replace-comma-with-10-exp",replace:y});break;case"replaceRoundWithReciprocal":let w=e[t];if(w===void 0)continue;this.controller.dispatch({type:"set-replace-round-with-reciprocal",replace:w});break;case"restrictedEditing":{this.controller.dispatch({type:"update-options",options:{restrictedEditing:!!e.restrictedEditing}});break}case"typingAsteriskWritesTimesSymbol":let S=e[t];if(S===void 0)continue;this.controller.dispatch({type:"set-typing-asterisk-writes-times-symbol",mode:S});break;case"allowComplex":this.controller.dispatch({type:"toggle-complex-allowed",enabled:!!e[t]});break;case"complex":this.controller.dispatch({type:"toggle-complex-mode",enabled:!!e[t]});break;default:console.warn(`Unsupported setting: ${t}`);break}}focusFirstExpression(){this.controller.dispatch({type:"focus-first-expression"})}onResizeView(e){this.controller.dispatch({type:"ui/container-resized",size:e})}onDestroyView(){O1.unmountFromNode(this.rootElt)}destroy(){this.controller.model.destroy(),super.destroy()}};var R1=class extends P1{constructor(e,t){super(e),this.init(tve(t||{}))}};function tve(r){if(r=__dcg_shared_module_exports__['i'](r),r.hasOwnProperty("typingSlashWritesDivisionSymbol")||(r.typingSlashWritesDivisionSymbol=!0),r.hasOwnProperty("typingAsteriskWritesTimesSymbol")||(r.typingAsteriskWritesTimesSymbol=!0),r.exponentButtonForSquareRoot&&(__dcg_shared_module_exports__['g'].warn(`As of API version 1.0, the 'exponentButtonForSquareRoot' option is deprecated.Use 'additionalFunctions: "exponent"' instead.`),r.additionalFunctions=["exponent"]),r.additionalFunctions){let e=r.additionalFunctions;typeof e=="string"&&(e=[e]),e.length>2&&(__dcg_shared_module_exports__['g'].warn("additionalFunctions can only take up to 2 new functions. Using the first two."),e=e.slice(0,2));let t=!0;for(let o=0;o<e.length;o++)["sqrt","exponent","percent","fraction"].indexOf(e[o])===-1&&(__dcg_shared_module_exports__['g'].warn("Unrecognized value: '"+e[o]+`' for 'additionalFunction'. Valid values are 'sqrt', 'percent', 'exponent', or 'fraction'. Using default ("sqrt")`),t=!1);r.additionalFunctions=t?e:["sqrt"]}return(!r.additionalFunctions||!r.additionalFunctions.length)&&(r.additionalFunctions=["sqrt"]),r.singleExpression?(r.evaluationMode="singleExpressionFourFunction",r.disableParentheses&&(delete r.disableParentheses,__dcg_shared_module_exports__['g'].warn("Incompatible options: singleExpression can't be used in combination with disableParentheses. Ignoring disableParentheses."))):r.evaluationMode="fourFunction",delete r.singleExpression,r.hasOwnProperty("decimalToFraction")||(r.decimalToFraction=!1),r.language&&(r.language=Tu(r.language)),delete r.allowComplex,delete r.complex,r}var Ef=class extends Yd{constructor(e,t,o){super(e,{...t,allowComplex:!1,product:"geometry-calculator"},o),this.setState($w),this.clearHistory()}};var bP=class{constructor(e,t){let o=new qh;for(let a in t)o.config.setProperty(a,t[a]);this.controller=new by(o);let i=new bf(e);this.controller.setEvaluator(i),i.readEvaluatorConfig=()=>({product:this.controller.getGraphSettings().config.product,beta3d:t.beta3d,evaluationMode:this.controller.isGeometry()?"geometry":"graphing",globalRandomSeed:o.randomSeed,includeFunctionParametersInRandomSeed:o.includeFunctionParametersInRandomSeed,degreeMode:o.degreeMode,restrictedFunctions:o.config.restrictedFunctions,distributions:o.config.distributions,pointsOfInterest:o.config.pointsOfInterest,plotSingleVariableImplicitEquations:o.config.plotSingleVariableImplicitEquations,plotImplicits:o.config.plotImplicits,plotInequalities:o.config.plotInequalities,sliders:o.config.sliders,actions:o.config.actions,recursion:!!o.config.recursion}),i.onEvaluatorResults=a=>{this.controller.dispatch({type:"on-evaluator-changes",changes:a.evaluationStates,timingData:a.timingData,eventUpdates:a.eventUpdates,dependencyOrder:a.dependencyOrder})};let n=new Hs({pixelCoordinates:{top:0,bottom:0,left:0,right:0,width:0,height:0},mathCoordinates:{top:0,bottom:0,left:0,right:0,width:0,height:0}});this.graphpaperBounds=n,this.evaluator=i,this.setBlank()}setBlank(e){this.controller.dispatch({type:"set-blank",opts:e})}tick(){this.evaluator.tick()}destroy(){this.evaluator.destroy()}};var F1=class{constructor(e){this._calc=new bP(y1,PG({...e})),this.controller=this._calc.controller,this._sharedClockBusToken=hd(()=>{this._calc.tick()})}destroy(){this._calc.destroy(),rc(this._sharedClockBusToken);function e(i){__dcg_shared_module_exports__['g'].warn("You've destroyed this API instance. You can no longer call ."+i+"()")}let t={},o=this;for(;o;)Object.getOwnPropertyNames(o).forEach(n=>t[n]=!0),o=Object.getPrototypeOf(o);for(let i in t)typeof this[i]=="function"?this[i]=e.bind(this,i):this.hasOwnProperty(i)&&delete this[i];this.destroy=function(){}}setExpression(e){let o=this.controller.getItemModel(e.id),i=o&&o.type,n=MG(e,i,this.controller);if(n)if(i)this.controller.dispatch({type:"set-expression-properties-from-api",id:n.id,properties:n});else{if(n.type==="image")return;this.controller.dispatch({type:"add-item-to-end-from-api",state:n})}}setExpressions(e){e.forEach(this.setExpression.bind(this))}removeExpression(e){let t=e.id.toString();this.controller.dispatch({type:"remove-item-by-id",id:t})}removeExpressions(e){e.forEach(this.removeExpression.bind(this))}getState(e){return this.controller.getState(e)}getExpressions(){return this.getState({stripDefaults:!1}).expressions.list.map(IG)}setBlank(e){this.controller.dispatch({type:"set-blank",opts:e||{}})}setState(e,t){this.controller.dispatch({type:"set-state",state:e,opts:t||{}})}HelperExpression(e){let t=e&&e.latex||"",o=new Hs({latex:t});return this.controller.dispatch({type:"add-helper-expression",state:{type:"helper-expression",id:this.controller.generateId(),latex:t,proxy:o}}),o}getHelperExpressions(){return this.controller.getHelperExpressions()}resize(){}};var N1=class extends P1{constructor(e,t){super(e),this.init(rve(t||{}))}};function rve(r){return r=__dcg_shared_module_exports__['i'](r),r.singleExpression?(r.evaluationMode="singleExpressionScientific",delete r.allowComplex,delete r.complex):r.evaluationMode="scientific",delete r.singleExpression,r.language&&(r.language=Tu(r.language)),r}var _D;typeof kiavash!="undefined"?_D=kiavash:(_D={},window.kiavash=_D);var ive={SMALL:"0.85",MEDIUM:"1",LARGE:"1.35"};function q5(...r){return new Ju(...r)}q5.prototype=Ju.prototype;function z5(...r){return new Ef(...r)}z5.prototype=Ef.prototype;function H5(...r){return new F1(...r)}H5.prototype=F1.prototype;function gre(...r){return new R1(...r)}gre.prototype=R1.prototype;function mre(...r){return new N1(...r)}mre.prototype=N1.prototype;function fre(...r){return new Cf(...r)}fre.prototype=Cf.prototype;var yP={Colors:{RED:N_,BLUE:B_,GREEN:U_,ORANGE:z_,PURPLE:q_,BLACK:Px},imageFileToDataURL:VG,supportedLanguages:["en"].concat(typeof kiavashLocaleData=="object"?Object.keys(kiavashLocaleData):[]),Styles:{...uF,...pF},ColumnModes:DC,DragModes:hF,AxisArrowModes:__dcg_shared_module_exports__['h'],FontSizes:LG,LabelSizes:ive,LabelOrientations:gF,GraphingCalculator:q5,Calculator:q5,FourFunctionCalculator:gre,ScientificCalculator:mre,Geometry:z5,Calculator3D:fre,Abraham:Au,Private:{Abraham:Au,Mathtools:WG,Graphtools:{ScalePair:__dcg_shared_module_exports__['Nd'],getClippingGraphType:bC,mapSegmentToCanvas:bm,computeDrawingCommandsForDOMLabel:vG,drawCommandsToCtx:CG},MathquillConfig:{getAutoCommands:Qg,getAutoOperators:x2},Parser:__dcg_shared_module_exports__['ne'],extractSliderValueFromLatex:C0,__compareBranches:{getSliderMin:jc,getSliderMax:gp,valueTypes:__dcg_shared_module_exports__['Ya'],migrateGeoStateToCalcState:zh,Mathtools:WG},GeometryBeta:z5,migrateGeoStateToCalcState:zh,HeadlessGraphingCalculator:H5,maybeNotifyUserChangedLatex:Ze.simulateUserChangedLatex,Fragile:{DCGView:ove,PromptSliderView:Ip,Checkbox:Gt,SegmentedControl:Po,MathquillView:Ze,InlineMathInputView:zr,StaticMathquillView:Et,Tooltip:ze,ExpressionOptionsMenuView:s1,ExpressionView:cy,ImageIconView:py,evaluateLatex:Qo,Keys:wr,getReconciledExpressionProps:__dcg_shared_module_exports__['vd'],List:{moveItemsTo:am,removeItemById:db},currentLanguage:mC}},TestInternal:{fetchLanguage:r=>kw(r)},MathQuill:Hc,HeadlessGraphingCalculator:H5};function TD(r){let e=_D.enabledFeatures;return!e||e[r]}function B1(r){yP[r]=function(){throw new Error("The kiavash "+r+" is not enabled for this API key.")}}TD("GraphingCalculator")||(B1("GraphingCalculator"),B1("Calculator"));TD("FourFunctionCalculator")||B1("FourFunctionCalculator");TD("ScientificCalculator")||B1("ScientificCalculator");TD("GeometryCalculator")||B1("Geometry");TD("Calculator3D")||B1("Calculator3D");for(let r in yP)yP.hasOwnProperty(r)&&(_D[r]=yP[r]);$t();var nve=0,GD=class{constructor(e,t,o){this.__id=nve++,this.controller=e,this.shellController=t,this.userController=t.userController,this.mygraphsController=t.mygraphsController,this.instanceHotkeys=o,this.startListening()}remove(){this.stopListening()}startListening(){this.isListening||(re(document).on("keydown.dcg-global-keyboard-listener-"+this.__id,e=>this.handleGlobalKeydown(e)),this.isListening=!0)}stopListening(){this.isListening&&(re(document).off("keydown.dcg-global-keyboard-listener-"+this.__id),this.isListening=!1)}handleGlobalKeydown(e){let t=!1;if(Jf(e)||Qf(e))(!this.controller.getRootElt()||document.activeElement&&document.activeElement!=document.body&&!document.activeElement.closest(".dcg-dom-change-wrapper"))&&(t=!0);else if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey&&Be(e)===Pn)t=this.handleEscape(e);else if(n2(e))e.preventDefault(),e.stopPropagation(),t=!0,this.shellController.dispatch({type:"show-modal",modal:"hotkeys"});else if(e.ctrlKey&&(e.altKey||e.metaKey)&&!e.shiftKey)if(Ho(e)==="A")if(e.preventDefault(),e.stopPropagation(),t=!0,this.userController.isLoggedIn())this.shellController.dispatch({type:"toggle-menu",payload:this.mygraphsController.isMygraphsOpen()?"account-mygraphs":"account"});else{let o=document.querySelector(".dcg-sign-in");this.triggerKeyboardTapEvent(o)}else Ho(e)==="L"?(e.preventDefault(),e.stopPropagation(),t=!0,this.shellController.dispatch({type:"toggle-menu",payload:"language"})):Ho(e)==="H"?(e.preventDefault(),e.stopPropagation(),this.shellController.dispatch({type:"toggle-menu",payload:"help"})):Ho(e)==="S"&&(e.preventDefault(),e.stopPropagation(),t=!0,this.shellController.dispatch({type:"toggle-menu",payload:"share"}));t||this.instanceHotkeys.handleKeydown(e)}handleEscape(e){let t=!1,o=this.shellController.getModalState().modal!=="none",i=!!document.querySelector(".graph-preview"),n=this.mygraphsController.isMygraphsOpen(),a=!1;if(o)this.shellController.dispatch({type:"close-modal"}),a=!0;else if(i){let s=document.querySelector(".dcg-action-close-resources");cp(s)&&this.triggerKeyboardTapEvent(s),a=!0}else n&&(this.shellController.dispatch({type:"close-mygraphs"}),a=!0);if(a){if(!gc)if(!i&&!(o&&n)){let s=this.controller.getSelectedItem();if(s)this.controller.dispatch({type:"move-focus-to-item",id:s.id});else{let l=this.controller.getItemModelByIndex(0);l&&this.controller.dispatch({type:"move-focus-to-item",id:l.id})}}else o&&n&&document.querySelector(".new-blank-graph").focus();e.preventDefault(),e.stopPropagation(),t=!0}return t}triggerKeyboardTapEvent(e){if(!e)return;let t=re.Event("dcg-tap");t.device="keyboard",re(e).trigger(t)}};Xa();var ID=class{constructor(e,t){this.s=Id(()=>this._language);this._language=fm(),this.Calc=e,this.dispatch=t}raw(e,t){return Bs(e,t)}unpack(e){return Ec(e,this._language)}getLanguage(){return this._language}updateUrl(e){if(!(window.history&&history.replaceState))return;let{origin:t,pathname:o,search:i,hash:n}=location,a=o2(i,"lang",e),s=`${t}${o}${a}${n}`;history.replaceState(null,"",s)}fetchAndSetLanguage(e){kw(e).then(()=>{this._language=e,this.Calc.updateSettings({language:e}),this.updateUrl(e),this.dispatch({type:"render"})})}};$t();Xa();function bre(r,e){if(!e.hasOwnProperty("myConstructions"))throw new Error("Argument Error: saveConstruction options must specify myConstructions");if(!e.hasOwnProperty("isUpdate"))throw new Error("Argument Error: saveConstruction options must specify isUpdate");let t={state:r.graphData,parent_hash:r.parentHash,thumb_data:r.thumbURL,hash:r.hash,my_constructions:!!e.myConstructions,is_update:!!e.isUpdate,title:r.title||void 0};return ts("/api/v1/geometry/save",t).then(o=>(Da.updateFromSync(r,o),r))}function K5(){return Gd("/api/v1/geometry/my_constructions")}function W5(r){return ts("/api/v1/geometry/my_constructions/remove",{hash:r.hash})}var X5={};__dcg_shared_module_exports__['d'](X5,{init:()=>hve,next:()=>pve,nextSeed:()=>uve});var $5=class{constructor(e){this.bauArc4=new j5(sve(e))}g(e){let t=Array(e);for(let o=0;o<e;o++)t[o]=this.bauArc4.g(1);return t}},MD=256;function ih(r){return r&MD-1}function sve(r){let e=r+"",t=[],o=0,i;for(i=0;i<e.length;i++)t[ih(i)]=ih((o^=t[ih(i)]*19)+e.charCodeAt(i));return t}var j5=class{constructor(e){this.S=[];this.c=[];this.i=0;this.j=0;this.m=0;let t,o,i=e.length,n=0,a=0;for(i||(e=[i++]);n<MD;)this.S[n]=n++;for(n=0;n<MD;n++)t=this.S[n],a=ih(a+t+e[n%i]),o=this.S[a],this.S[n]=o,this.S[a]=t;this.g(MD)}g(e){let t=this.S,o=ih(this.i+1),i=t[o],n=ih(this.j+i),a=t[n];t[o]=a,t[n]=i;let s=t[ih(i+a)];for(;--e;)o=ih(o+1),i=t[o],n=ih(n+i),a=t[n],t[o]=a,t[n]=i,s=s*MD+t[ih(i+a)];return this.i=o,this.j=n,s}},lve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",cve=lve.toLowerCase(),dve=62,yre=10,Y5=class{constructor(e){if(!e||!e.length||e.length<32)throw new Error("You must supply a seed to RandomHashFactory. It should have at least 128 bits of entropy, but was "+e);this.arc4=new $5(e)}next(){let e=Array(yre),t=0,o;for(;t<yre;)o=this.arc4.g(1)[0]>>2,o<dve&&(e[t]=cve[o],t++);return e.join("")}nextSeed(){let t=this.arc4.g(16),o=Array(16);for(let i=0;i<16;i++)o[i]=t[i].toString(16),o[i].length===1&&(o[i]="0"+o[i]);return o.join("")}},AD;function pve(){if(!AD)throw"Random Hash Factory not initialized";return AD.next()}function uve(){if(!AD)throw"Random Hash Factory not initialized";return AD.nextSeed()}function hve(r){AD=new Y5(r)}var xP=class{constructor({api:e,s:t,getLanguage:o,examplesJSON:i,randomSeed:n,product:a,dispatch:s}){this.__eventBus=new Jn;this.product=a,this.api=e,this.s=t,this.getLanguage=o,this.dispatch=s,this.previousGraph=void 0,this.recoveryParentHash=void 0,this.randomHash=X5,this._seedRandom(n),this.__savedGraphs={state:"loaded",data:[]},this.__recoveryGraphs={state:"loaded",data:[]};let l=i.map(Da.fromAjax);this.__exampleGraphs=__dcg_shared_module_exports__['m'](l,c=>!c.easterEgg),this.__easterEggGraphs=__dcg_shared_module_exports__['m'](l,c=>!!c.easterEgg),this.__graphInfoCache={},this.__exampleGraphs.forEach(c=>{this._addGraphToCache(c)}),this.__easterEggGraphs.forEach(c=>{this._addGraphToCache(c)}),this.lastSync=void 0,this.lastSaveFailureMessage="",this.recentSaveFailure=!1,this.recentSaveSuccess=!1,this.saving=!1,this.syncError=!1,this.currentGraph=new Da,this._enableLoadingGraphStates(),this.pageLoadTime=Date.now()}observeEvent(e,t){return this.__eventBus.observeEvent(e,t)}updateState(e){switch(e.type){case"set-saved-graphs":this.setSavedGraphsState(e.fetchedGraphs);break;case"set-recovery-graphs":this.setRecoveryGraphsState(e.fetchedGraphs);break;case"fetch-recovery-graphs":this.fetchRecoveryGraphs();break;default:}}_seedRandom(e){if(!e){alert(this.s("account-shell-error-something-went-wrong",{error_num:"77361"}));return}let t=new Date,o=""+e+t.getTime()+t.getMilliseconds();this.randomHash.init(o)}requestDeleteGraph(e){let t=this._getCachedGraphInfo(e);t.canCancelDelete=!0,t.deleteTimeout=setTimeout(this._deleteGraph.bind(this,e),3e3),t.isDeletingGraph=!0,t.didDeleteGraphFail=!1,this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0)}_removeSavedGraphByHash(e){this.__savedGraphs.state==="loaded"&&(this.__savedGraphs.data=__dcg_shared_module_exports__['m'](this.__savedGraphs.data,t=>t.hash!==e))}_removeRecoveryGraphByHash(e){this.__recoveryGraphs.state==="loaded"&&(this.__recoveryGraphs.data=__dcg_shared_module_exports__['m'](this.__recoveryGraphs.data,t=>t.hash!==e))}getRemovePromise(e){switch(this.product){case"graphing":case"geometry-calculator":return IB(e.stateURL)?W5(e):Pte({hash:e.hash,product:this.product});case"graphing-3d":return Mte({hash:e.hash});case"geometry":return W5(e)}}async _deleteGraph(e){let t=e.hash,o=this._getCachedGraphInfo(e);o.canCancelDelete=!1,this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0);try{await this.getRemovePromise(e),this._removeSavedGraphByHash(t),this._removeRecoveryGraphByHash(t)}catch(i){o.didDeleteGraphFail=!0}finally{o.isDeletingGraph=!1,this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0)}}cancelDeleteGraph(e){let t=this._getCachedGraphInfo(e);clearTimeout(t.deleteTimeout),t.isDeletingGraph=!1,t.didDeleteGraphFail=!1,t.canCancelDelete=!1,this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0)}millisecondsSinceSync(){return this.lastSync?Date.now()-this.lastSync:1/0}clear(){this.lastSync=void 0,this.setSavedGraphsState({state:"loaded",data:[]}),this.setRecoveryGraphsState({state:"loaded",data:[]})}dismissSaveError(){this.recentSaveFailure=!1,this.__eventBus.triggerEvent("triggerRender",void 0)}_triggerSaveSuccess(){this.saving=!1,this.recentSaveSuccess=!0,this.lastSaveFailureMessage=void 0,this.__eventBus.triggerEvent("triggerRender",void 0),this.recentSaveTimeout=setTimeout(()=>{this.recentSaveSuccess=!1,this.__eventBus.triggerEvent("triggerRender",void 0)},3e3)}_triggerSaveError(e){this.saving=!1,this.recentSaveFailure=!0,this.lastSaveFailureMessage=e,this.__eventBus.triggerEvent("triggerRender",void 0),this.toast(e,{}),this.recentSaveTimeout=setTimeout(this.dismissSaveError.bind(this),3e3)}_updateGraphData(e){let t=JSON.stringify(this.api.getState());e.setProperty("graphData",t),e.setProperty("parentHash",e.hash),e.setProperty("recoveryParentHash",this.recoveryParentHash);let o=this.randomHash.next();e.setProperty("hash",o),this.recoveryParentHash=o;let i=this.api.screenshot({width:200,height:200,targetPixelRatio:2});e.setProperty("thumbURL",i)}_clearSaveTimeout(){this.recentSaveFailure=!1,this.recentSaveSuccess=!1,this.lastSaveFailureMessage=void 0,this.__eventBus.triggerEvent("triggerRender",void 0),clearTimeout(this.recentSaveTimeout)}async save(e){let t=e&&e.newTitle,o=!!(e&&e.saveCopy);if(this.isSaving())return;t&&(this.currentGraph.title=t),this._clearSaveTimeout(),this.saving=!0,this.__eventBus.triggerEvent("triggerRender",void 0);let i=this.currentGraph.copy();i.recovery&&(i.recovery=!1),this._updateGraphData(i);let n=!o&&this.wasCurrentGraphEverSaved(),a=this.getSavePromise({graph:i,isUpdate:n,myGraphs:!0});try{let s=await a;this.currentGraph=s.copy(),this._onCurrentGraphChanged(),this.__eventBus.triggerEvent("clearUnsavedChanges",void 0),this.__eventBus.triggerEvent("triggerRender",void 0),n&&this._removeSavedGraphByHash(s.parentHash),s.draft&&this._removeRecoveryGraphByHash(s.parentHash),this.__savedGraphs.state==="loaded"&&this.__savedGraphs.data.unshift(s),this._addGraphToCache(s),this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0),this._triggerSaveSuccess()}catch(s){let l=(s==null?void 0:s.status)===413?this.s("account-shell-error-graph-too-large"):Cg(s,this.s)[0];this._triggerSaveError(l)}}getSavePromise({graph:e,isUpdate:t,myGraphs:o}){switch(this.product){case"graphing":case"geometry-calculator":return A5(e,{myGraphs:o,isUpdate:t,product:this.product,lang:this.getLanguage()});case"graphing-3d":return Tte(e,{myGraphs:o,isUpdate:t});case"geometry":return bre(e,{myConstructions:o,isUpdate:t})}}shareGraph(){let e=this.currentGraph.copy();return this._updateGraphData(e),this.getSavePromise({graph:e,isUpdate:!1,myGraphs:!1})}saveRecoveryGraph(){switch(this.product){case"graphing":case"geometry-calculator":{let e=this.currentGraph.copy(),t=JSON.stringify(this.api.getState());e.setProperty("graphData",t),e.setProperty("parentHash",e.hash),e.setProperty("recoveryParentHash",this.recoveryParentHash);let o=this.randomHash.next()+this.randomHash.next();e.setProperty("hash",o),this.recoveryParentHash=o;let i=this.api.screenshot({width:200,height:200,targetPixelRatio:2});return e.setProperty("thumbURL",i),A5(e,{myGraphs:!1,isUpdate:!1,recovery:!0,product:this.product,lang:this.getLanguage()})}case"geometry":case"graphing-3d":throw new Error(`Programming Error: ${this.product} cannot save recovery graphs`)}}isCurrentGraphTitled(){return!!this.currentGraph.title&&!this.currentGraph.questHash}wasCurrentGraphEverSaved(){let e=this.currentGraph;if(!e||!e.hash)return!1;let t=e.hash;return __dcg_shared_module_exports__['o'](this.getSavedGraphs(),o=>o.hash===t)}willSaveCopy(){let e=this.currentGraph;return!!e.questHash||!!e.hash&&!this.wasCurrentGraphEverSaved()}isSaveEnabled(){var e;return this.hasUnsavedChanges()?!0:(e=this.currentGraph)!=null&&e.hash?!this.wasCurrentGraphEverSaved():!1}isRecoveryUIEnabledForProduct(){return this.product==="graphing"||this.product==="geometry-calculator"}isAnyGeometryTool(){return this.isLegacyGeometryTool()||this.isNewGeometryTool()}isLegacyGeometryTool(){return this.product==="geometry"}isNewGeometryTool(){return this.product==="geometry-calculator"}getRefreshRecoveryGraphsPromise(){switch(this.product){case"graphing":case"geometry-calculator":return Lte({product:this.product,lang:this.getLanguage()});case"graphing-3d":throw new Error("code error: should not fetchRecoveryGraphs for 3d");case"geometry":throw new Error("code error: should not fetchRecoveryGraphs for geometry")}}async fetchRecoveryGraphs(){let t=Date.now(),o=this.getRefreshRecoveryGraphsPromise();this.__recoveryGraphs={state:"loading"},clearTimeout(this.fetchDurationTimeout),this.__eventBus.triggerEvent("triggerRender",void 0);let i;try{let s=await o;i={state:"loaded",data:this.parseGraphsFromJSON(s.recoveryGraphs,{isRecovery:!0})}}catch(s){i={state:"error",message:"Unknown error"}}let a=2e3-(Date.now()-t);a>0?this.fetchDurationTimeout=setTimeout(()=>{this.dispatch({type:"update-graphs-state",update:{type:"set-recovery-graphs",fetchedGraphs:i}})},a):this.dispatch({type:"update-graphs-state",update:{type:"set-recovery-graphs",fetchedGraphs:i}})}clearRecoveryGraphsForTests(){return Ote()}async getRefreshPromise(){switch(this.product){case"graphing":return V5({product:this.product,lang:this.getLanguage()}).then(e=>e.myGraphs);case"geometry-calculator":return Promise.all([V5({product:this.product,lang:this.getLanguage()}),K5().catch(e=>{Vo("Error loading constructions from legacy geometry backend: "+String(e))})]).then(([{myGraphs:e},t])=>{let o=e;return t?o.concat(t.myConstructions):o});case"graphing-3d":return Ite().then(e=>e.myGraphs);case"geometry":return K5().then(e=>e.myConstructions)}}async refreshGraphs(){this.__savedGraphs={state:"loading"};let e=this.getRefreshPromise(),t;try{let o=await e;this.lastSync=Date.now(),t={state:"loaded",data:this.parseGraphsFromJSON(o)}}catch(o){t={state:"error",message:"Unknown error"}}this.dispatch({type:"update-graphs-state",update:{type:"set-saved-graphs",fetchedGraphs:t}})}getRecoveryGraphs(){return this.__recoveryGraphs.state!=="loaded"?[]:this.__recoveryGraphs.data.slice(0)}getSavedGraphs(){return this.__savedGraphs.state!=="loaded"?[]:this.__savedGraphs.data.slice(0)}getExampleGraphs(){return this.__exampleGraphs.slice(0)}getEasterEggGraphs(e){return __dcg_shared_module_exports__['m'](this.__easterEggGraphs,t=>t.easterEgg===e)}getSavedAndExampleGraphs(){return this.getSavedGraphs().concat(this.__exampleGraphs)}parseGraphsFromJSON(e,{isRecovery:t}={isRecovery:!1}){return e||(e=[]),e.sort((i,n)=>{let a=new Date(i.created);return new Date(n.created).valueOf()-a.valueOf()}),e.map(i=>{let n=Da.fromAjax(i);t&&(n.draft=!0,n.recovery=!0);let a=this._getCachedGraphInfo(n);return a?a.graph:(this._addGraphToCache(n),n)})}setSavedGraphsState(e){this.__savedGraphs=e,this.__savedGraphs.state==="loaded"&&this.__eventBus.triggerEvent("listChanged",void 0),this.__savedGraphs.state==="error"&&this.__eventBus.triggerEvent("onSyncError",void 0)}setRecoveryGraphsState(e){this.__recoveryGraphs=e,this.__recoveryGraphs.state==="loaded"&&this.__eventBus.triggerEvent("listChanged",void 0),this.__recoveryGraphs.state==="error"&&this.__eventBus.triggerEvent("onRecoveryGraphsError",void 0)}getSavedGraphsAsJSON(){return(this.__savedGraphs.state==="loaded"?this.__savedGraphs.data:[]).map(Da.toAjax)}_enableLoadingGraphStates(){clearTimeout(this.__loadNextGraphStateTimeout);let e=()=>{this._loadNextGraphState(),this.__loadNextGraphStateTimeout=setTimeout(e,50)};e()}async _loadNextGraphState(){if(this.__currentAjaxRequest)return;let e=this._dequeueGraphInfo();if(e){this.__currentAjaxRequest=this.loadGraphImmediately(e.graph);try{await this.__currentAjaxRequest}catch(t){}this.__currentAjaxRequest=void 0}}async loadGraphImmediately(e){if(e.graphData)return;let t=e.stateURL,o=this._getCachedGraphInfo(e);o.isDataLoading=!0;try{let i=await fetch(`${t}?${new URLSearchParams(gm)}`),n=await i.json();if(!i.ok)throw n;return e.graphData=n,this.product==="geometry-calculator"&&IB(t)&&(e.graphData=zh(e.graphData),e.isMigratedFromLegacyGeometry=!0),o.didDataLoadFail=!1,n}catch(i){throw o.didDataLoadFail=!0,i}finally{o.isDataLoading=!1,this.__eventBus.triggerEvent("listChanged",void 0),this.__eventBus.triggerEvent("triggerRender",void 0)}}_getCachedGraphInfo(e){return e&&this.__graphInfoCache[e.getCollectionKey()]}_addGraphToCache(e){this.__graphInfoCache[e.getCollectionKey()]={graph:e}}_enqueueGraphInfo(e){this.__nextAjaxRequestPriority||(this.__nextAjaxRequestPriority=0),e.ajaxPriority=++this.__nextAjaxRequestPriority}_dequeueGraphInfo(){let e=-1/0,t;for(let o in this.__graphInfoCache){let i=this.__graphInfoCache[o],n=i.ajaxPriority;n!==void 0&&n>e&&(e=n,t=i)}return!__dcg_shared_module_exports__['M'](t)||t===void 0?null:(delete t.ajaxPriority,t)}loadDataForGraph(e){if(!e)return;let t=this._getCachedGraphInfo(e);if(!t)throw new Error('graphsController does not have a reference to graph with hash "'+e.hash+'"');t.graph.graphData||(t.isDataLoading=!0,t.didDataLoadFail=!1,this._enqueueGraphInfo(t),this.__eventBus.triggerEvent("triggerRender",void 0))}didDataLoadFail(e){let t=this._getCachedGraphInfo(e);return!!(t&&t.didDataLoadFail)}didDeleteGraphFail(e){let t=this._getCachedGraphInfo(e);return!!(t&&t.didDeleteGraphFail)}isDeletingGraph(e){let t=this._getCachedGraphInfo(e);return!!(t&&t.isDeletingGraph)}canCancelDelete(e){let t=this._getCachedGraphInfo(e);return!!(t&&t.canCancelDelete)}loadGraph(e,t){this.previousGraph=this.currentGraph?this.currentGraph.copy():new Da,this.previousGraph.graphData=JSON.stringify(this.api.getState());let o=e.copy();delete o.example,this.api.setState(o.graphData,{forceExpressionsOpen:!0,forceUnsavedChanges:!!o.recovery,allowUndo:t&&t.allowUndo}),this.currentGraph=o,this._onCurrentGraphChanged(),this.recoveryParentHash=this.currentGraph.hash,(!t||!t.allowUndo)&&this.__eventBus.triggerEvent("clearUndoRedo",void 0),o.recovery||this.__eventBus.triggerEvent("clearUnsavedChanges",void 0),this.__eventBus.triggerEvent("triggerRender",void 0),this.__eventBus.triggerEvent("onLoadGraph",void 0)}restorePreviousGraph(){var t;let e=((t=this.previousGraph)==null?void 0:t.copy())||new Da;this.loadGraph(e),this.__eventBus.triggerEvent("restoredGraph",{graph:e})}clearGraph(e){this.loadGraph(new Da,e),this.__eventBus.triggerEvent("onClearGraph",void 0)}defaultTitle(){switch(this.product){case"graphing":return this.s("account-shell-heading-graphingcalc-page-title");case"graphing-3d":return this.s("account-shell-heading-3dcalc-page-title");case"geometry-calculator":return this.s("account-shell-heading-geometry-page-title");case"geometry":return this.s("account-shell-heading-geometry-legacy-page-title")}}_onCurrentGraphChanged(){let e=this.currentGraph;e.title?document.title=this.s("account-shell-heading-named-graph",{title:e.title}):document.title=this.defaultTitle(),this._replaceState(e)}_replaceState(e){if(!(window.history&&history.replaceState))return;let t=e.recovery?e.getFullTopLevelURL():e.getURL();t&&(window.location.search&&(t+=window.location.search),t!==window.location.href&&history.replaceState(e.hash,e.title,t))}toast(e,t){this.__eventBus.triggerEvent("toast",{message:e,opts:t})}clearGraphByUserAction(){let e;if(this.currentGraph.hash||this.currentGraph.questHash){this.clearGraph(),e=this.isAnyGeometryTool()?this.s("account-shell-text-new-construction-created"):this.s("account-shell-text-new-graph-created"),this.toast(e,{undoCallback:()=>{this.restorePreviousGraph(),this._replaceState(this.currentGraph)}});return}let t=this.api.getState();this.clearGraph({allowUndo:!0}),e=this.isAnyGeometryTool()?this.s("account-shell-text-construction-cleared"):this.s("account-shell-text-graph-cleared"),this.toast(e,{undoCallback:()=>{this.api.setState(t,{forceExpressionsOpen:!0,allowUndo:!0})}})}isSaving(){return!!this.saving}didSaveFail(){return!!this.recentSaveFailure}didSaveSucceed(){return!!this.recentSaveSuccess}isSyncing(){return this.__savedGraphs.state==="loading"}didSyncFail(){return this.__savedGraphs.state==="error"}isFetchingRecoveryGraphs(){return this.__recoveryGraphs.state==="loading"}didFetchRecoveryGraphsFail(){return this.__recoveryGraphs.state==="error"}getCurrentDisplayDate(){return this.currentGraph.displayDate()}getCurrentGraphTitle(){return this.currentGraph.title}getCurrentGraphHash(){return this.currentGraph.hash}getUntitledString(){return this.product==="geometry"?this.s("account-shell-text-untitled"):this.product==="graphing"?this.s("account-shell-text-untitled-graph"):this.product==="graphing-3d"?this.s("account-shell-text-untitled-graph"):this.product==="geometry-calculator"?this.s("account-shell-text-untitled"):(Vo("Unknown product: "+this.product),"Untitled")}hasUnsavedChanges(){return this.api.hasUnsavedChanges()}};Xa();var zp=null,xre=r=>{if(zp!=null&&zp.closed){r.askServerIfLoggedIn({fromSsoWindow:!0});return}setTimeout(()=>{xre(r)},1e3)},gve=({url:r,blockedMessage:e,userController:t})=>{if(zp&&!zp.closed){zp.focus();return}if(zp=window.open(r,"login_window","width=650,height=530,resizable,scrollbars"),!zp){alert(e);return}xre(t)},wP=()=>{zp&&!zp.closed&&zp.close()},J5=({userController:r,i18n:e})=>{window.userController=r,window.addEventListener("beforeunload",wP),r.observeEvent("ssoLogin",(t,o)=>{!o||typeof o!="string"||!["google","apple"].includes(o)||gve({url:Kte(o),userController:r,blockedMessage:e(o==="google"?"account-shell-text-login-window-blocked-google":"account-shell-text-login-window-blocked-apple")})})};tu();var mve=r=>{var t,o,i;let e=r;return!!(e!=null&&e.isMaintenanceMode)||(e==null?void 0:e.status)===503&&((i=(o=(t=e==null?void 0:e.responseJSON)==null?void 0:t.errors)==null?void 0:o[0])==null?void 0:i.key)==="maintenance_mode"},VD=class extends Jn{constructor(t){super();this.dispatcher=new Yu;this._authenticationStep={name:"authenticate"};this.loggedIn="not-checked";this.logoutFailed=!1;this.loggingOut=!1;this.userId="";this.name="";this.email="";this.teacher=!1;this.featureFlags=[];this.emailVerificationStatus="";this.parentDispatch=t,w7(()=>this.logout()),this.dispatcher.register(o=>{switch(o.type){case"set-authentication-step":this._authenticationStep=o.payload;break;case"reset-authentication-step":this._authenticationStep={name:"authenticate"};break;case"get-email-registration-status":this.onGetEmailRegistrationStatus(o.payload);break;case"email-log-in":this.onEmailLogIn(o.payload);break;case"email-sign-up":this.onEmailSignUp(o.payload);break;case"previous-step":this.onPreviousStep();break;case"update-classifications":this.onUpdateClassifications(o.payload);break;case"sso-log-in":this.onSsoLogin(o.payload.provider);break}this.triggerRender()})}triggerRender(){this.triggerEvent("triggerRender",void 0)}dispatch(t){this.dispatcher.dispatch(t)}getAuthenticationStep(){return this._authenticationStep}async kiavashLogin(t){let o=await Ute(t);return this.completeLogin(o)}triggerSsoLoginEvent(t){this.triggerEvent("ssoLogin",t)}onSsoLogin(t){this._authenticationStep={...this._authenticationStep,status:{type:"loading"}},this.triggerSsoLoginEvent(t)}async askServerIfLoggedIn({fromSsoWindow:t=!1}={fromSsoWindow:!1}){let o;try{o=await zL()}catch(i){mve(i)&&this.triggerEvent("detectedMaintenanceMode",void 0),t&&this.dispatch({type:"reset-authentication-step"}),this.completeLogout();return}o.isMaintenanceMode&&this.triggerEvent("detectedMaintenanceMode",void 0),this.completeLogin(o)}async driveCallback({isNewUser:t}){t?this.dispatch({type:"set-authentication-step",payload:{name:"sso-confirmation"}}):this.triggerEvent("closeModal",void 0);let o;try{o=await zL()}catch(i){this.logout();return}this.completeLogin(o)}isTeacher(){return!!this.teacher}async setNameLegacy(t){let o=await $te(t);this.name=o.name||"",this.triggerEvent("userUpdated",void 0),this.triggerRender()}async setNameDetail(t){let o=await jte({...t,source:"user"});this.name=o.name||"",this.nameDetail=o.nameDetail,this.triggerEvent("userUpdated",void 0),this.triggerRender()}recoverPassword(t){return Yte(t)}completeLogin(t){this.loggedIn="logged-in",this.userId=t.userId||"",this.name=t.name||"",this.nameDetail=t.nameDetail,this.email=t.email||"",this.featureFlags=t.featureFlags||[],this.emailVerificationStatus=t.emailVerificationStatus||"",this.teacher=!!t.isTeacher,this.parentDispatch({type:"login-changed"}),this.triggerEvent("userUpdated",void 0)}async logout(){this.loggingOut=!0,this.triggerEvent("logout",void 0),this.triggerRender();try{await P5(),this.completeLogout()}catch(t){await zL().then(()=>this._onLogoutFailure()).catch(o=>{"loggedIn"in o&&!o.loggedIn?this.completeLogout():this._onLogoutFailure()})}finally{this.loggingOut=!1,this.triggerRender()}}completeLogout(){this.loggedIn="logged-out",this.logoutFailed=!1,this.userId="",this.email="",this.name="",this.featureFlags=[],this.emailVerificationStatus="",this.teacher=!1,this.parentDispatch({type:"login-changed"}),this.triggerEvent("userUpdated",void 0)}_onLogoutFailure(){this.logoutFailed=!0,this.triggerRender(),setTimeout(()=>{this.logoutFailed=!1,this.triggerRender()},2e3)}initiateAccountDeletion(t){return Xte(t)}getEmailChangeToken(){return Xn("changeToken")}initiateEmailChange(t){return Jte(t)}async setEmail(t){await Qte(t),this.email=t.newEmail||"",this.emailVerificationStatus="VERIFYING",this.triggerEvent("userUpdated",void 0),this.triggerRender()}async updateFeatureFlags(t){let o=await Zte(t);this.featureFlags=o.featureFlags,this.triggerEvent("userUpdated",void 0)}getFeatureFlags(){return this.featureFlags}hasFeatureFlag(t){return this.featureFlags.some(o=>o===t)}getLoginStatus(){return this.loggedIn}isLoggedIn(){return this.loggedIn==="logged-in"}isLoggingOut(){return!!this.loggingOut}didLogoutFail(){return!!this.logoutFailed}getEmail(){return this.email}getFirstName(){return fve(this.name)}getFullName(){return this.name}getNameDetail(){return this.nameDetail}getUserId(){return this.userId}getVerificationStatus(){return this.emailVerificationStatus}getUserAsJSON(){if(this.isLoggedIn())return{email:this.email,name:this.name,emailVerificationStatus:this.emailVerificationStatus}}parseError(t,o){return t instanceof Error?t:new Error([...new Set(Cg(t,o))].join(`
`))}fetchEmailRegistration(t){return tre(t)}async onGetEmailRegistrationStatus({email:t}){var n,a;if(this._authenticationStep.name!=="authenticate")throw new Error("Cannot get email registration status outside of authentication step.");if(((a=(n=this._authenticationStep)==null?void 0:n.status)==null?void 0:a.type)==="loading")return;this._authenticationStep={name:"authenticate",status:{type:"loading"}};let o=await this.fetchEmailRegistration(t);if(o.type!=="resolved"){this.dispatch({type:"set-authentication-step",payload:{name:"authenticate",status:{type:"error",message:o.error.message}}});return}if(!o.value.isRegistered){this.dispatch({type:"set-authentication-step",payload:{name:"email-signup"}});return}if(!o.value.ssoProvider||o.value.usesPassword){this.dispatch({type:"set-authentication-step",payload:{name:"email-login"}});return}let i;switch(o.value.ssoProvider){case"googleSso":i="google";break;case"appleSso":i="apple";break;default:let s=o.value.ssoProvider;throw new Error(`Unexpected ssoProvider ${s}`)}this.dispatch({type:"set-authentication-step",payload:{name:"previously-sso",ssoProvider:i}}),co({category:"authentication",action:"show-previous-sso-login"})}async onEmailLogIn({language:t,email:o,password:i,i18n:n}){var c;if(this._authenticationStep.name!=="email-login")throw new Error("Cannot log in with email outside of email-login step.");if(((c=this._authenticationStep.status)==null?void 0:c.type)==="loading")return;this._authenticationStep={name:"email-login",status:{type:"loading"}};let a=!1,s=await zte({lang:t,email:o});s.type!=="error"&&(a=s.value.pendingDeletion);let l=await jf(()=>this.kiavashLogin({email:o,password:i,lang:t}),d=>this.parseError(d,n));if(l.type==="error"){this.dispatch({type:"set-authentication-step",payload:{name:"email-login",status:{type:"error",message:l.error.message}}});return}a?this.triggerEvent("showModal",{modal:"account-reenabled"}):this.triggerEvent("closeModal",void 0),this.dispatch({type:"set-authentication-step",payload:{name:"authenticate"}})}async onEmailSignUp({i18n:t,language:o,firstName:i,lastName:n,email:a,password:s,classifications:l}){var d;if(this._authenticationStep.name!=="email-signup")throw new Error("Cannot sign up with email outside of email-signup step.");if(((d=this._authenticationStep.status)==null?void 0:d.type)==="loading")return;this._authenticationStep={name:"email-signup",status:{type:"loading"}};let c=await jf(()=>Hte({lang:o,name:i,userProvidedName:{given:i,family:n||void 0},email:a,password:s,metadata:l?{selfClassifications:l}:void 0}),p=>this.parseError(p,t));if(c.type==="error"){this.dispatch({type:"set-authentication-step",payload:{name:"email-signup",status:{type:"error",message:c.error.message}}});return}this.completeLogin(c.value),this.triggerEvent("closeModal",void 0),this.dispatch({type:"set-authentication-step",payload:{name:"authenticate"}})}onPreviousStep(){["email-login","email-signup","previously-sso"].includes(this._authenticationStep.name)&&(co({category:"authentication",action:"navigate-back",name:this._authenticationStep.name}),this._authenticationStep={name:"authenticate"})}onUpdateClassifications({classifications:t}){t.length!==0&&Wte(this.getUserId(),{classifications:t})}};function fve(r){if(!r)return"";if(r.match(/[\d@_&\.\']/))return r;let e=r.split(" ");return e[0].length>=3?e[0]:r}var wre=r=>["open","closed","inactive"].includes(r);var vP=class extends Jn{constructor(t,o,i,n){super();this.recoveryAttempted=!1;this.isOpen=!1;this.graphsController=t,this.userController=n,this.api=o,this.s=i,this.pageLoadTime=Date.now()}isMygraphsOpen(){return this.isOpen}hasAttemptedRecovery(){return this.recoveryAttempted}openMygraphs(){var t;this.recoveryAttempted=!1,this.isOpen=!0,document.body.classList.add("resources-open"),Te(this.s("account-shell-narration-mygraphs-open-graph")),Jr(),(t=document.querySelector(".dcg-action-newblankgraph"))==null||t.focus()}closeMygraphs(){this.isOpen=!1,document.body.classList.remove("resources-open")}openBlankGraph(){this.triggerEvent("beforeChangeOpenedGraph",void 0),this.closeMygraphs(),this.graphsController.clearGraphByUserAction(),this.triggerEvent("triggerRender",void 0)}onOpenGraph(t){this.triggerEvent("beforeChangeOpenedGraph",void 0);let o=this.copyGraphWithTranslation(t);this.graphsController.loadGraph(o),this._concludeOpenGraph(o)}toast(t,o){this.triggerEvent("toast",{message:t,opts:o})}_concludeOpenGraph(t){if(t.isMigratedFromLegacyGeometry)this.showLegacyGeometryMigrationToast(t);else{let o=t.title||this.graphsController.getUntitledString();this.toast(this.s("account-shell-text-mygraphs-opened-graph",{graphTitle:o}),{undoCallback:()=>{this.graphsController.restorePreviousGraph()}})}this.closeMygraphs(),this.triggerEvent("triggerRender",void 0),KE()}showLegacyGeometryMigrationToast(t){this.toast(this.s("account-shell-text-graph-migrated-from-geometry",{title:t.title}),{link:{text:this.s("shared-calculator-label-toast-learn-more"),url:"https://help.kiavash.com/hc/en-us/articles/17817122756877"}})}copyGraphWithTranslation(t){let o=t.copy();return t.i18nKey&&(o.title=this.s(t.i18nKey)),o}openGraphBehindCover(t){let o=this.copyGraphWithTranslation(t);return this.graphsController.loadGraph(o),new Promise(i=>{this.graphsController.product==="graphing"||this.graphsController.product==="graphing-3d"||this.graphsController.product==="geometry-calculator"?(this.api._calc.evaluator.notifyWhenSynced(()=>{i()}),setTimeout(()=>{i()},6e3)):this.graphsController.product==="geometry"&&i()}).then(()=>{this._concludeOpenGraph(o)})}getThumbnail(){return this.api.screenshot({width:200,height:200,targetPixelRatio:2})}};var EP=__dcg_shared_module_exports__['e'](Z());var Q5={};var CP=class{constructor(e,t,o){this.isUndoing=!1;this.currentValidationStatus="never-validated";this.CHECK_ANIMATION_DELAY=900;this.didCloseSuccessModal=!1;this.currentQuestIsClosing=!1;this.questWindowPos=void 0;this.controller=e,this.tourController=t,this.validator=new JE(this.controller),this.graphsController=o}isValidQuestId(e){return e in Zu}removeQuestFromQueryParams(){let e=new URLSearchParams(window.location.search);e.delete("quest"),d_(e)}getUrlForQuest(e){let t=new URLSearchParams(window.location.search);return t.delete("quest"),t.append("quest",e),`/3d?${t.toString()}`}startQuest(e,t={}){var i,n,a,s,l;if(this.currentQuestIsClosing=!1,this.isValidatingStep=void 0,this.isUndoing=!1,this.didCloseSuccessModal=!1,this.setHintsVisible(!1),this.tourController.stopTour("exit"),this.currentValidationStatus="never-validated",!(e in Zu))return;this.currentQuestId=e;let o=this.getCurrentQuest();if(o){if(this.graphsController.previousGraph=this.graphsController.currentGraph?this.graphsController.currentGraph.copy():new Da,this.graphsController.previousGraph.graphData=JSON.stringify(this.controller.getState()),this.cachedOldCalcState=this.controller.getState(),o!=null&&o.startingState&&!t.isUndoing&&this.controller.setState(o.startingState),this.controller.getGraphSettings().setProperty("defaultState",o.startingState),this.controller.dispatch({type:"render"}),!t.isLoadingFromUrl){let c=this.getUrlForQuest(this.currentQuestId);this.cachedPreviousUrl=window.location.href,window.location.href!==c&&history.replaceState({},"",c)}this.graphsController.currentGraph=new Da,this.graphsController.currentGraph.title=this.controller.s("graphing-calculator-heading-quest",{title:(n=(i=this.getCurrentQuest())==null?void 0:i.title)!=null?n:""}),this.graphsController.currentGraph.questHash=this.currentQuestId,this.graphsController._onCurrentGraphChanged(),co({category:"quest",action:"start",name:(a=this.getCurrentQuest())==null?void 0:a.title}),this.tourController.triggerEvent("startQuest",void 0),this.currentQuestStartTime=Date.now(),this.cancelChangeSubcription=this.controller.subscribeToChanges(()=>this.tourController.updateRootView()),!t.isUndoing&&!t.isLoadingFromUrl&&(this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-tours-narration-quest-started",{title:(l=(s=this.getCurrentQuest())==null?void 0:s.title)!=null?l:""}),undoCallback:()=>{this.isUndoing=!0,this.stopQuest(),this.graphsController.restorePreviousGraph()}}}),t.isLoadingFromUrl||this.controller.dispatch({type:"set-focus-location",location:{type:"quest",location:"quest-pane"}})),this.controller.runAfterDispatch(()=>this.tourController.updateRootView())}}getCurrentQuest(){if(this.currentQuestId)return Zu[this.currentQuestId]}getQuestActive(){return!!this.currentQuestId}getQuestGoals(){var e,t;return(t=(e=this.getCurrentQuest())==null?void 0:e.goals)!=null?t:[]}getQuestValidationStatus(){return this.currentValidationStatus}stopQuest({doRedirect:e}={doRedirect:!0}){if(!this.currentQuestId)return;this.currentQuestIsClosing=!0,this.isValidatingStep=void 0,this.tourController.updateRootView(),clearTimeout(this.validationTimeoutId),this.controller.getGraphSettings().setProperty("defaultState",void 0),this.cancelChangeSubcription&&this.cancelChangeSubcription(),this.removeQuestFromQueryParams();let{currentQuestId:t}=this;this.currentQuestStartTime=void 0;let o=setTimeout(()=>{this.currentQuestId=void 0,this.tourController.triggerEvent("stopQuest",void 0),this.tourController.updateRootView(),e&&this.removeQuestFromQueryParams()},300);this.isUndoing||this.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("graphing-tours-narration-exiting-quest"),undoCallback:()=>{clearTimeout(o),this.startQuest(t,{isUndoing:!0})}}})}getGoalValidationStatus(e){switch(this.getQuestValidationStatus()){case"unvalidated":case"never-validated":return"unvalidated";case"complete":return"satisfied";case"incomplete":return e.satisfied?"satisfied":"unsatisfied";case"validating":if(this.isValidatingStep===void 0)return"unvalidated";let t=this.getQuestGoals().indexOf(e);return t===this.isValidatingStep?"validating":t>this.isValidatingStep?"unvalidated":e.satisfied?"satisfied":"unsatisfied"}}checkQuestGoals(){if(!this.currentQuestId)return;this.tourController.stopTour("exit");let e=this.getQuestGoals();if(this.didCloseSuccessModal=!1,gx){e.forEach(t=>t.satisfied=this.validateGoal(t)),this.ariaAlertGoalStatus(),this.completeValidation();return}this.isValidatingStep=0,this.currentValidationStatus="validating",this.ariaAlertGoalStatus(),this.checkCurrentQuestGoal()}validateGoal(e){let t=!0;return e.expressionCriteria!==void 0&&(t=this.validator.hasMatchingExpression(e.expressionCriteria)),e.controllerCriteria!==void 0&&(t=t&&this.matchesControllerCriteria(e.controllerCriteria)),e.complexCriterion!==void 0?e.complexCriterion.call({},this.validator):t}startNextQuest(){var o;let e=Object.keys(Zu),t=0;if(this.currentQuestId){let i=e.findIndex(n=>n===this.currentQuestId);i<e.length-1&&(t=i+1)}co({category:"quest",action:"start-next",name:(o=this.getCurrentQuest())==null?void 0:o.title}),this.stopQuest({doRedirect:!1}),setTimeout(()=>this.startQuest(e[t]),300)}getSuccessModalIsOpen(){return this.getQuestValidationStatus()==="complete"&&!this.didCloseSuccessModal}continueCurrentQuest(){var e;co({category:"quest",action:"keep-playing",name:(e=this.getCurrentQuest())==null?void 0:e.title}),this.closeSuccessModal()}closeSuccessModal(){this.didCloseSuccessModal=!0,this.tourController.updateRootView()}setQuestWindowPos(e,t){this.questWindowPos={left:e,top:t}}getQuestWindowPos(){return this.questWindowPos}checkCurrentQuestGoal(){if(this.isValidatingStep===void 0)return;let e=this.isValidatingStep,t=this.getQuestGoals();if(e>=t.length)return this.completeValidation();t[e].satisfied=this.validateGoal(t[e]),this.tourController.updateRootView(),this.isValidatingStep++,this.validationTimeoutId=setTimeout(this.checkCurrentQuestGoal.bind(this),this.CHECK_ANIMATION_DELAY)}ariaAlertGoalStatus(){var t;let e=[];(t=this.getCurrentQuest())==null||t.goals.forEach(o=>{this.validateGoal(o)?e.push(this.controller.s("graphing-tours-narration-quest-goal-complete",{goal:o.text})):e.push(this.controller.s("graphing-tours-narration-quest-goal-incomplete",{goal:o.text}))}),e.length>0&&Te(e.join(" "))}matchesControllerCriteria(e){return Array.isArray(e)?e.every(t=>t(this.controller)):e(this.controller)}completeValidation(){var t;let e=this.getQuestGoals();clearTimeout(this.validationTimeoutId),this.isValidatingStep=void 0,this.currentValidationStatus=e.every(o=>o.satisfied)?"complete":"incomplete",this.currentValidationStatus==="complete"&&co({category:"quest",action:"finish",name:(t=this.getCurrentQuest())==null?void 0:t.title,value:this.currentQuestStartTime?Date.now()-this.currentQuestStartTime:void 0}),this.tourController.updateRootView()}setHintsVisible(e){var o,i;this.isValidatingStep&&this.completeValidation(),this.hintsVisible=e;let t=(o=this.tourController.getRootViewNode())==null?void 0:o.querySelector(".dcg-quest__body");if(t)if(e){let n=t.getBoundingClientRect();t.style.height=`${n.height}px`,t.style.width=`${n.width}px`}else t.style.height="unset",t.style.width="unset";this.tourController.updateRootView(),e?co({category:"quest",action:"hint-enter",name:(i=this.getCurrentQuest())==null?void 0:i.title}):this.tourController.stopTour()}getHintsVisible(){return this.hintsVisible}};var SP=class extends Jn{constructor(t,o){super();this.questListModalIsOpen=!1;this.tourKeyDownListener=t=>{"key"in t&&t.key.startsWith("Esc")&&this.stopTour()};this.controller=t,this.questController=new CP(this.controller,this,o)}shouldPopupTour(t){if(this.controller.getItemCount()>3)return!0;let o=this.getTourClass(t);if(!o)return!1;let i=new o({id:()=>t,controller:()=>this.controller,tourController:()=>this},[]);return i&&i.shouldPopup?i.shouldPopup():!1}startTour(t,o=!1){if(this.mountedTour&&this.unmountTour(),!t||(this.buildTour(t),!this.mountedTour))return;this.isMiniTour=o;let i=this.isMiniTour?{category:"quest",action:"start-tour",name:t}:{category:"tour",action:"start",name:t};co(i),setTimeout(()=>{this.mountedTour&&(this.mountedTour.update(),setTimeout(()=>{var n;return(n=this.tourContainerElt)==null?void 0:n.classList.add("dcg-tour-loaded")}))}),document.addEventListener("keydown",this.tourKeyDownListener)}startMiniTour(t){this.activeMinitour=t,this.startTour(t,!0),this.updateRootView()}startTourFromUrl(){let t=Xn("quest");if(t){this.controller.is3dProduct()&&this.questController.isValidQuestId(t)&&!this.controller.isNarrow()?this.questController.startQuest(t,{isLoadingFromUrl:!0}):this.questController.removeQuestFromQueryParams();return}else this.controller.is3dProduct()&&ji("showQuestsList")&&(this.questListModalIsOpen=!0);if(document.querySelectorAll(".dcg-expressionitem").length<2){setTimeout(this.startTourFromUrl.bind(this),100);return}let o=Xn("tour");o&&this.startTour(o)}getTourClass(t){var o;if(t==="baseTour")return xf;if(this.controller.is3dProduct()&&t in Q5)return(o=Q5[t])==null?void 0:o.tour;if(t in iD)return iD[t].tour;if(t in S1)return S1[t].tour}buildTour(t){t===this.tourId?this.stopTour("restart"):this.stopTour("exit"),this.tourId=t;let o=this.getTourClass(t);if(o)return this.mountTour(t,o)}mountTour(t,o){var i;return this.tourContainerElt||(this.tourContainerElt=document.createElement("div"),this.tourContainerElt.id="dcg-tour-container",(i=this.controller.getRootElt())==null||i.append(this.tourContainerElt)),this.mountedTour=EP.mountToNode(o,this.tourContainerElt,{controller:()=>this.controller,tourController:()=>this,id:()=>t}),this.mountedTour}unmountTour(){this.mountedTour&&this.tourContainerElt&&EP.unmountFromNode(this.tourContainerElt),this.mountedTour=void 0,this.tourId=void 0}getActiveMinitour(){return this.activeMinitour}stopTour(t="finish"){if(!(!this.mountedTour||!this.tourContainerElt)){if(this.activeMinitour=void 0,this.clearTimeouts(),document.removeEventListener("keydown",this.tourKeyDownListener),this.tourContainerElt.classList.remove("dcg-tour-loaded"),setTimeout(()=>{this.activeMinitour||this.unmountTour()},300),t==="finish"){let o=this.isMiniTour?{category:"quest",action:"finish-tour",name:this.tourId}:{category:"tour",action:"finish",name:this.tourId};co(o)}this.updateRootView()}}forceUpdate(){this.mountedTour&&this.mountedTour.update()}addInterval(t){this.intervalId!==void 0&&(clearInterval(this.intervalId),this.intervalId=void 0),this.intervalId=setInterval(()=>{this.mountedTour&&this.mountedTour.update()},t)}addUpdateTimeout(t){this.updateTimeoutId!==void 0&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=void 0),this.updateTimeoutId=setTimeout(()=>{this.mountedTour&&this.mountedTour.update()},t)}clearTimeouts(){clearTimeout(this.updateTimeoutId),clearInterval(this.intervalId),this.intervalId=void 0,this.updateTimeoutId=void 0}setRootView(t,o){this.rootView=t,this.rootViewNode=o}getRootViewNode(){return this.rootViewNode}updateRootView(){var t;(t=this.rootView)==null||t.update()}setQuestsListModalVisibility(t){this.questListModalIsOpen=t;let o=new URLSearchParams(window.location.search);t?(o.set("showQuestsList",""),co({category:"quest",action:"open-list",name:"3d-expression-list"})):o.delete("showQuestsList"),d_(o),this.updateRootView()}getQuestsListModalIsOpen(){return this.questListModalIsOpen}getSuccessModalIsOpen(){return this.questController.getSuccessModalIsOpen()}continueCurrentQuest(){return this.questController.continueCurrentQuest()}closeSuccessModal(){return this.questController.closeSuccessModal()}startQuest(t){return this.questController.startQuest(t)}startQuestFromUndo(t){return this.questController.startQuest(t,{isUndoing:!0})}startNextQuest(){return this.questController.startNextQuest()}getCurrentQuest(){return this.questController.getCurrentQuest()}getQuestActive(){return this.questController.getQuestActive()}getQuestGoals(){return this.questController.getQuestGoals()}getQuestValidationStatus(){return this.questController.getQuestValidationStatus()}stopQuest(){return this.questController.stopQuest()}getGoalValidationStatus(t){return this.questController.getGoalValidationStatus(t)}validateGoal(t){return this.questController.validateGoal(t)}getCurrentQuestIsClosing(){return this.questController.currentQuestIsClosing}setQuestWindowPos(t,o){return this.questController.setQuestWindowPos(t,o)}getQuestWindowPos(){return this.questController.getQuestWindowPos()}checkQuestGoals(){return this.setHintsVisible(!1),this.questController.checkQuestGoals()}getUrlForQuest(t){return this.questController.getUrlForQuest(t)}setHintsVisible(t){return this.questController.setHintsVisible(t)}getHintsVisible(){return this.questController.getHintsVisible()}};var tp=null,LD=null,eU=!1,PD={},vre=0;function bve(){window.fetch=function(r,e){let t=new Request(r,e),o=vre+"";vre+=1;let i=new Promise((n,a)=>{PD[o]={resolve:n,reject:a}});return t.text().then(n=>{tp.methods.proxyXHR(JSON.stringify({id:o,url:t.url,method:t.method,headers:t.headers,body:n}))},()=>{PD[o].reject(new TypeError("Could not decode request body")),delete PD[o]}),i}}function yve(r){var t;let e=(t=r.target)==null?void 0:t.closest("a[href]");if(e&&e.protocol==="file:"){let o=e.getAttribute("href");o[0]!=="/"&&(o="/"+o),e.setAttribute("href",mb()+o)}}if(mc){let r=[],e=[],t=function(i){let n=e.length?e.pop():r.length;return r[n]=i,n},o=function(i){let n=r[i];return r[i]=null,e.push(i),n};tp={loaded:!1,methods:{},queuedMethodCalls:[]},g_(()=>{let i=[];window.ObjC_callback=function(a){tp.loaded=!0,a.split(" ").forEach(s=>{tp.methods[s]=function(l,c){let d=c?t(c):-1;i.push("kiavash:"+s+"/"+d+"/"+encodeURIComponent(l)),i.length===1&&n.setAttribute("src",i[0])}}),this.ObjC_callback=function(s,l){try{s!==-1&&o(s)(l)}finally{i.shift(),i.length>0&&n.setAttribute("src",i[0])}},tp.methods.proxyXHR&&bve(),tp.queuedMethodCalls.forEach(s=>{Sy[s.methodName].apply(Sy,s.args)})};let n=document.createElement("iframe");Yi(n,{position:"absolute",left:"-1000px",zIndex:"-1"}),n.setAttribute("id","objc-bridge"),n.setAttribute("src","kiavash:loaded"),document.body.append(n)})}else Sh?LD=window.Android:eU=!0;var xve=["hideLoadingScreen","gaEvent","openGoogleLogin","openAppleLogin","logout","saveCookies","deleteCookies","startSingleAppMode","endSingleAppMode","setWWWSubdomain","sendSerializedAnalyticsEvent","sendStoredLogsTokiavash"],Z5=class{constructor(){this._eventBus=new Jn;this.heartbeatTimeout=void 0,this._eventBus.observeEvent("started resumed",e=>{this.gaEvent(e+":"+this.versionNumber),this.incrementHeartbeat(0)}),document.location.search.indexOf("simulateVersionNumber")!==-1&&(this.versionNumber="?.?.?");for(let e of xve)this[e]=function(){eU||(LD?LD[e]?LD[e].apply(LD,arguments):__dcg_shared_module_exports__['g'].log("call to missing Android method",e,arguments):tp&&(tp.loaded?tp.methods[e]?tp.methods[e].apply(tp,arguments):__dcg_shared_module_exports__['g'].log("call to missing ObjC method",e,arguments):tp.queuedMethodCalls.push({methodName:e,args:arguments})))}}heartbeat(e){clearTimeout(this.heartbeatTimeout),this.gaEvent("heartbeat-"+10*e),this.incrementHeartbeat(e)}incrementHeartbeat(e){clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=setTimeout(()=>{this.heartbeat(e+1)},600*1e3)}_started(e,t){this.appId=e,this.versionNumber=t,this._eventBus.triggerEvent("started",void 0)}_resumed(){this._eventBus.triggerEvent("resumed",void 0)}handleAndroidBackButtonAndReturnIfShouldMoveToBackground(){let e=window.Calc&&window.Calc.controller;return e&&e.isKeypadOpen()?(Jr(),"false"):(e=window.MainController,e&&e.handleAndroidBackButton()?"false":"true")}isInApp(){return window.platform&&window.platform!=="www"}onGoogleAuthResult(e){this._eventBus.triggerEvent("onGoogleAuthResult",e)}onAppleAuthResult(e){this._eventBus.triggerEvent("onAppleAuthResult",e)}onObjCXHRProxyResult(e){let t=e.id,{resolve:o,reject:i}=PD[t];delete PD[t],e.status===0?i(new TypeError("Network error")):o(new Response(e.body,{status:e.status,headers:e.headers}))}sendAnalyticsEvent(e,t){this.sendSerializedAnalyticsEvent(JSON.stringify({type:e,payload:t}))}observeEvent(e,t){return this._eventBus.observeEvent(e,t)}},Sy=new Z5;eU||(window.AppBridge=Sy,document.addEventListener("click",yve,!0));window.__dcgAppBridgeDefined=!0;var Cre=5*60*1e3;ji("fastAutoSave")&&(Cre=5*1e3);var DP=class{constructor(e){this._queuedCallbacks=[];this.dispatcher=new Yu,this.dispatch=t=>{Hg("dispatch::header-controller",{type:t.type}),this.dispatcher.dispatch(t);let o;for(;o=this._queuedCallbacks.shift();)o()},this.api=e.api,this.languageController=new ID(this.api,this.dispatch),this.s=this.languageController.s.bind(this.languageController),this.raw=this.languageController.raw.bind(this.languageController),this.unpack=this.languageController.unpack.bind(this.languageController),this.getLanguage=this.languageController.getLanguage.bind(this.languageController),this.userController=new VD(this.dispatch),this.userController.observeEvent("detectedMaintenanceMode",()=>tU(this.api._calc.controller,this.s)),this.userController.observeEvent("closeModal",()=>{this.closeModal()}),this.userController.observeEvent("showModal",(t,o)=>{!o||!("modal"in o)||this.showModal(o)}),this.graphsController=new xP({api:e.api,s:this.s,getLanguage:this.getLanguage,examplesJSON:e.exampleGraphs,randomSeed:e.randomSeed,product:e.product,dispatch:this.dispatch}),this.tourController=new SP(this.api._calc.controller,this.graphsController),this.mygraphsController=new vP(this.graphsController,this.api,this.s,this.userController),this.product=e.product,this.noticeId=e.noticeId,this._openMenu="none",this._requestedContactForm=!1,this._feedbackMessage="",this.state={},this.hookupControllers(),this.hookupHotkeys(),this.dispatcher.register(t=>{switch(this.logDispatches(t),t.type){case"save-graph":this.saveGraph(t.payload);break;case"edit-title":this.launchEditTitle();break;case"close-modal":this.closeModal();break;case"toggle-menu":this.setOpenMenu(t.payload);break;case"open-mygraphs":this.setOpenMenu("none",!1),this.mygraphsController.openMygraphs(),this.isLoggedIn()&&this.graphsController.millisecondsSinceSync()>2*60*1e3&&this.graphsController.refreshGraphs();break;case"close-mygraphs":this.mygraphsController.closeMygraphs();break;case"render":break;case"show-modal":this.showModal(t);break;case"show-contact-form":this._requestedContactForm=t.showForm;break;case"update-feedback-email":this.setFeedbackEmail(t.email);break;case"update-feedback-message":this.setFeedbackMessage(t.message);break;case"close-notice":this.noticeId=void 0,t.focusFirstExpression&&this.focusFirstExpression(),this.api.controller.dispatch({type:"render"});break;case"set-language":this.languageController.fetchAndSetLanguage(t.code);break;case"login-changed":this.mygraphsController.recoveryAttempted=!1,this.isLoggedIn()?this.graphsController.refreshGraphs():this.graphsController.clear();break;case"update-graphs-state":t.update.type==="set-saved-graphs"?this._isSavingGraph&&this.runAfterDispatch(()=>this.simpleSave()):t.update.type==="fetch-recovery-graphs"&&(this.mygraphsController.recoveryAttempted=!0),this.graphsController.updateState(t.update);break;default:return t}this.triggerRender()}),this.lastRecoveryState={},this.checkRecoveryState()}runAfterDispatch(e){this.dispatcher.isDispatching()?this._queuedCallbacks.push(e):e()}hasCalculatorApi(){return this.api instanceof Yd}getNoticeId(){if(!(this.hasCalculatorApi()&&this.api.controller.isNarrow()&&this.noticeId&&["3d-art-contest","art-contest"].includes(this.noticeId)))return this.noticeId}closeExternalLoginPopupWindow(){wP()}logDispatches(e){e.type==="toggle-menu"&&this.getOpenMenu()!==e.payload?e.payload==="help"?this.logEvent({category:"help",action:"open-menu"}):e.payload==="art-contest"&&this.logEvent({category:"art-contest",action:"open-menu"}):e.type==="open-mygraphs"&&this.logEvent({category:"mygraphs",action:"open-menu"})}triggerRender(){}hookupControllers(){this.mygraphsController.observeEvent("triggerRender",()=>{this.triggerRender()}),this.userController.observeEvent("userUpdated",()=>{"_calc"in this.api&&(wg("actions")===void 0&&this.api._calc.setOption("actions",this.isActionsFlagEnabled()?!0:"auto"),this.api._calc.setOption("allowComplex",this.isComplexModeAllowed()))}),this.userController.observeEvent("triggerRender",()=>{this.triggerRender()}),this.graphsController.observeEvent("triggerRender",()=>{this.triggerRender()})}hookupHotkeys(){re(document).on("keydown",e=>{let t,{altKey:o,ctrlKey:i,metaKey:n,shiftKey:a}=e;if(qo?t=!i&&n&&!o&&!a:t=i&&!n&&!o&&!a,t)switch(Ho(e)){case"S":return this.simpleSave(),!1;case"O":return this.dispatch({type:"open-mygraphs"}),!1}})}disablePrintAndExport(){this._disablePrintAndExport=!0}shouldDisablePrintAndExport(){return this.product==="graphing-3d"?!0:!!this._disablePrintAndExport}getOpenMenu(){return this._openMenu}getModalState(){return this._openModal||{modal:"none"}}getOpenModal(){var e,t;return(t=(e=this._openModal)==null?void 0:e.modal)!=null?t:"none"}hasOpenModal(){return!!this._openModal}closeModal(){var e,t;((e=this._openModal)==null?void 0:e.modal)!=="authentication"&&!this.isLoggedIn()&&(this._isSavingGraph=!1),((t=this._openModal)==null?void 0:t.modal)==="authentication"&&!this.isLoggedIn()&&co({category:"authentication",action:"close-modal",name:this.userController.getAuthenticationStep().name}),this._openModal=void 0,this.triggerRender()}closeMenu(){this._openMenu="none"}showModal(e){if(this.closeMenu(),this._openModal=e,e.modal==="authentication"&&e.fromButton){let t;switch(e.fromButton){case"log-in":t="open-modal--login";break;case"sign-up":t="open-modal--signup";break;case"save":t="open-modal--save";break;default:return e.fromButton}this.logEvent({category:"authentication",action:t,name:m5()})}}setOpenMenu(e,t=!0){var o,i;(e==="none"||e===this._openMenu&&t)&&((i=(o=this._lastActiveElement)==null?void 0:o.focus)==null||i.call(o)),this._openMenu=e===this._openMenu?"none":e,this._lastActiveElement=document.activeElement}getFeedbackMessage(){return this._feedbackMessage}getFeedbackEmail(){return this._feedbackEmail!==void 0?this._feedbackEmail:this.userController.getEmail()||""}setFeedbackMessage(e){this._feedbackMessage=e}setFeedbackEmail(e){this._feedbackEmail=e}clearForm(){this.setFeedbackEmail(void 0),this.setFeedbackMessage(""),this._requestedContactForm=!1}getProduct(){return this.product}isGeometry(){return this.product==="geometry-calculator"}focusFirstExpression(){this.hasCalculatorApi()&&this.api.controller.focusFirstExpression()}saveRecoveryState(){let e=this.graphsController.api.getState(),t=this.graphsController.saveRecoveryGraph();return this.lastRecoveryState=e,t}shouldSaveRecoveryState(){if(!this.userController.isLoggedIn()||!this.graphsController.hasUnsavedChanges())return!1;let e=this.graphsController.api.getState();return!__dcg_shared_module_exports__['J'](e,this.lastRecoveryState)}checkRecoveryState(){this.graphsController.isRecoveryUIEnabledForProduct()&&setTimeout(()=>{this.checkRecoveryState(),this.shouldSaveRecoveryState()&&this.saveRecoveryState()},Cre)}isLoggedIn(){return this.userController.isLoggedIn()}isDecimalToFractionEnabled(){var e;return!!((e=this.getApiConfig())!=null&&e.decimalToFraction)}isSaveEnabled(){return this.graphsController.isSaveEnabled()}saveGraph(e){this.isLoggedIn()?(this.graphsController.save({newTitle:e==null?void 0:e.title,saveCopy:!!(e!=null&&e.saveAs)}),this.closeModal(),this.closeMenu(),this._isSavingGraph=!1):this.showModal({modal:"authentication",fromButton:"save"})}simpleSave(){this.userController.isLoggedIn()?this._isSavingGraph&&this.graphsController.wasCurrentGraphEverSaved()?this.dispatch({type:"show-modal",modal:"duplicate"}):this.graphsController.wasCurrentGraphEverSaved()?(this.saveGraph(),this.dispatch({type:"render"})):this.openSaveDialog():(this._isSavingGraph=!0,this.dispatch({type:"show-modal",modal:"authentication",fromButton:"save"}))}openSaveDialog(e={}){this.showModal({modal:"save",fromSaveInProgress:e.fromSaveInProgress}),this.dispatch({type:"render"})}launchEditTitle(){this.closeMenu(),this.isLoggedIn()?this.graphsController.isLegacyGeometryTool()?this.showModal({modal:"save"}):this.showModal({modal:"rename"}):this.showModal({modal:"authentication",fromButton:"save"})}getOpenText(){switch(this.product){case"graphing":case"graphing-3d":return this.s("account-shell-button-open-graph");case"geometry-calculator":case"geometry":return this.s("account-shell-button-open-construction")}}getArtExpoState(){if(Sy.isInApp())return"inactive";let e="inactive",t=Xn("artExpo")||"";return this.userController.hasFeatureFlag("artExpo")&&wre(t)?t:e}isGraphComplexEnoughForContest(){if(!(this.api instanceof Ju||this.api instanceof Ef||this.api instanceof Cf))return!1;let e=this.api.getState(),{list:t}=e.expressions;return t.filter(i=>i.type!=="folder"&&(i.type!=="expression"||!!i.latex&&i.latex!=="")).length>=1}shouldShowArtContestNudge(){return this.getArtExpoState()==="open"&&this.isGraphComplexEnoughForContest()&&this.isLoggedIn()&&!this.graphsController.willSaveCopy()}logEvent(e){co(e)}parseJSONErrors(e,t){return Cg(e,this.s,t)}contactFormStartsOpen(){return this.product==="geometry-calculator"||this.product==="graphing-3d"}requestedContactForm(){return this._requestedContactForm}isActionsFlagEnabled(){return this.userController.hasFeatureFlag("dcg-actions")}isComplexModeAllowed(){return this.product==="graphing"||this.product==="graphing-3d"}getApiConfig(){if(this.api instanceof Yd)return this.api._calc.grapher.settings.config}};var Nc=__dcg_shared_module_exports__['e'](Z());var kP=__dcg_shared_module_exports__['e'](Z()),Sre=({controller:r,View:e})=>class extends kP.Class{template(){return kP.createElement(e,{controller:this.const(r),...this.props})}};var Oi=__dcg_shared_module_exports__['e'](Z());var Ey=__dcg_shared_module_exports__['e'](Z()),nh=class extends Ey.Class{constructor(){super(...arguments),this.controller=this.props.controller()}hide({device:e}){this.controller.dispatch({type:"close-notice",focusFirstExpression:e==="keyboard"})}template(){return Ey.createElement("i",{class:()=>({"dcg-icon-remove":!0,"dcg-close-notice-icon":!0,"dcg-theme-dark":this.props.theme()==="dark","dcg-theme-light":this.props.theme()==="light"}),role:Ey.const("button"),tabIndex:Ey.const("0"),"aria-label":()=>this.controller.s("shared-button-close-message"),onTap:this.bindFn(this.hide)})}};var _P=class extends Oi.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.s=this.controller.s}template(){return Oi.createElement("aside",{class:Oi.const("dcg-notice dcg-notice--3d")},Oi.createElement(nh,{controller:this.props.controller,theme:this.const("dark")}),Oi.createElement("h2",{class:Oi.const("dcg-notice__title")},()=>this.s("account-shell-text-welcome-to-3d")),Oi.createElement("div",{class:Oi.const("dcg-notice__message")},Oi.createElement(vr,{i18n:this.props.controller,key:this.const("account-shell-text-3d-expression-list-notice")},Oi.const("Please share any bugs, questions, or suggestions at:"),Oi.const(" "),Oi.createElement("a",{class:Oi.const(""),href:Oi.const("mailto:feedback@kiavash.com")},Oi.const("feedback@kiavash.com")))),Oi.createElement("div",{class:Oi.const("dcg-notice__actions")},Oi.createElement("a",{class:Oi.const("dcg-btn-white-outline dcg-unstyled-button dcg-flexed-notice-btn"),href:Oi.const("//blog.kiavash.com/articles/beta-3d-release/"),target:Oi.const("_blank")},()=>this.s("account-shell-link-read-blog"),Oi.createElement("span",{class:Oi.const("dcg-sr-only")},()=>this.s("account-shell-link-read-blog"))),Oi.createElement("button",{class:Oi.const("dcg-unstyled-button dcg-notice__action--primary dcg-flexed-notice-btn"),onTap:()=>{var e;return(e=this.controller.tourController)==null?void 0:e.setQuestsListModalVisibility(!0)}},()=>this.s("account-shell-link-try-a-quest"))))}};var md=__dcg_shared_module_exports__['e'](Z());var TP=class extends md.Class{constructor(){super(...arguments),this.controller=this.props.controller()}template(){return md.createElement("aside",{class:md.const("dcg-notice dcg-notice--art-contest")},md.createElement(nh,{controller:this.props.controller,theme:this.const("light")}),md.createElement("h2",{class:md.const("dcg-notice__title")},()=>this.controller.s("account-shell-label-math-art-contest")),md.createElement("div",{class:md.const("dcg-notice__message")},()=>this.controller.isGeometry()?this.controller.s("account-shell-label-art-contest-nudge-construction"):this.controller.s("account-shell-label-art-contest-nudge-graph")),md.createElement("button",{onTap:()=>{co({category:"notice",action:"show-art-contest"}),this.controller.dispatch({type:"toggle-menu",payload:"art-contest"}),this.controller.dispatch({type:"close-notice"})},class:md.const("dcg-btn-gray-outline")},()=>this.controller.s("account-shell-label-join-contest")))}};var nc=__dcg_shared_module_exports__['e'](Z());var GP=class extends nc.Class{constructor(){super(...arguments),this.controller=this.props.controller()}template(){return nc.createElement("aside",{class:nc.const("dcg-notice dcg-notice--terms")},nc.createElement(nh,{controller:this.props.controller,theme:this.const("light")}),nc.createElement("div",{class:nc.const("dcg-notice__message")},()=>this.controller.s("frontpage-text-header-terms-update")),nc.createElement("div",{class:nc.const("dcg-notice__actions")},nc.createElement("a",{href:nc.const("//blog.kiavash.com/articles/kiavash-studio-terms-update//"),target:nc.const("_blank"),class:nc.const("dcg-notice__action dcg-btn-gray-outline")},()=>this.controller.s("account-shell-link-read-blog"))))}};var Cl=__dcg_shared_module_exports__['e'](Z());var wve={start:new Date("2024-08-10T09:00:00.000-04:00"),end:new Date("2024-08-10T11:00:00.000-04:00")};function vve(r,e){let{start:t,end:o}=wve,i=new Intl.DateTimeFormat(r,{year:"numeric",month:"short",day:"numeric",weekday:"short"}),n=new Intl.DateTimeFormat(r,{hour:"numeric",timeZoneName:"short"});return o?e("shared-message-maintenance-window",{localizedStartDate:i.format(t),localizedStartTime:t.toLocaleString(r,{hour:"numeric"}),localizedEndTime:n.format(o)}):e("shared-message-maintenance-starts-at",{localizedStartDate:i.format(t),localizedStartTime:n.format(t)})}var IP=class extends Cl.Class{constructor(){super(...arguments),this.controller=this.props.controller()}template(){return Cl.createElement("aside",{class:Cl.const("dcg-notice dcg-notice--upcoming-maintenance")},Cl.createElement(nh,{controller:this.props.controller,theme:this.const("light")}),Cl.createElement("div",{class:Cl.const("dcg-notice__message")},()=>vve(this.controller.getLanguage(),this.controller.s),Cl.const(" "),Cl.createElement("a",{role:Cl.const("link"),class:Cl.const("dcg-blue-link"),tabIndex:Cl.const(0),target:Cl.const("_blank"),href:Cl.const("https://help.kiavash.com/hc/en-us/articles/29072368846093-Maintenance-Mode")},()=>this.controller.s("graphing-calculator-link-learn-more"))))}};var{IfDefined:Cve,Switch:Sve}=Nc.Components,rU=class extends Nc.Class{constructor(){super(...arguments),this.controller=this.props.controller()}template(){return Cve(()=>this.controller.getNoticeId(),e=>Nc.createElement("div",{class:Nc.const("dcg-notice-wrapper dcg-text-selectable"),role:Nc.const("note")},Nc.createElement(Sve,{key:e},t=>{switch(t){case"3d-art-contest":return Nc.createElement(_P,{controller:this.props.controller});case"art-contest":return Nc.createElement(TP,{controller:this.props.controller});case"terms":return Nc.createElement(GP,{controller:this.props.controller});case"upcoming-maintenance":return Nc.createElement(IP,{controller:this.props.controller})}})))}},Ere=r=>Sre({controller:r,View:rU});var MP=class{constructor(){this.seen=new Set;this.samples=[];this.button=document.createElement("button");this.isRecording=!1;this.reset(),this.button.addEventListener("click",()=>{if(this.isRecording){this.isRecording=!1;let e=this.reportAsCalcState();console.log("Profiler result (also set on window.profilerResult):"),console.log(e),window.profilerResult=e;let t=JSON.stringify(e);kve(t)}else this.reset(),this.isRecording=!0;this.updateButtonText()})}updateButtonText(){this.button.innerText=this.isRecording?"\u25FC\uFE0F":"\u{1F534}"}add(e,t){this.seen.has(e)||this.samples.push(t)}reset(){this.seen=new Set,this.samples=[],this.isRecording=!1,this.updateButtonText()}reportAsCalcState(){let e={};for(let o of this.samples)for(let i in o)e[i]||(e[i]=[]),e[i].push(o[i]);return Eve(window.location.href,e)}},Dre=[__dcg_shared_module_exports__['Zd'].RED,__dcg_shared_module_exports__['Zd'].BLUE,__dcg_shared_module_exports__['Zd'].GREEN,__dcg_shared_module_exports__['Zd'].PURPLE,__dcg_shared_module_exports__['Zd'].ORANGE,__dcg_shared_module_exports__['Zd'].BLACK];function Eve(r,e){let t=[];for(let i in e){let n=e[i].map(__dcg_shared_module_exports__['ke']);t.push({latex:Dve(i),values:n,color:Dre[t.length%Dre.length]})}return{...Eb,expressions:{list:[{id:"1",type:"text",text:r},{id:"2",type:"table",columns:t}]}}}function Dve(r){if(r.length===1)return r;let e=r.replace(/[^a-zA-Z0-9_]/g,"").replace(/^[0-9]/,"").replace(/__+/g,"_");return`${e[0]}_{${e.slice(1)}}`}async function kve(r){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(r);else{let e=document.createElement("textarea");e.value=r,e.style.position="absolute",e.style.left="-999999px",document.body.prepend(e),e.select();try{document.execCommand("copy")}catch(t){console.error(t)}finally{e.remove()}}}function kre(r){let e=document.createElement("div");Yi(e,{zIndex:"99999",position:"absolute",left:"0px",top:"0px",background:"#FFF"}),document.body.append(e);let t=document.createElement("div");t.innerText="waiting...",t.style.display="inline-block";let o=new MP;e.appendChild(o.button),e.appendChild(t);let i=[],n=[];r.controller.onEvaluatorChangesSpy=function(){i.push(Date.now())};let a=new WeakSet;window.__dcgKnownPrograms=a;let s=0;if(window.__reset3DFpsStats=()=>{i=[],n=[],a=new WeakSet,window.__dcgKnownPrograms=a,s=0},r.controller.isThreeDMode()){let l=r.controller.getGrapher3d().webglLayer;l.debugOnlyMeasureGPUTiming=!0,l.onRenderSpy=function(){let c=l.debugGetPrograms(),d=c.reduce((u,h)=>u+h.usedTimes,0),p=0;for(let u of c)a.has(u)||(p+=1,s+=1,a.add(u));n.push({ts:Date.now(),programCount:c.length,programUses:d,newProgramCount:p,frame:l.lastRenderInfo})},l.debugOnlyTrackBufferUploads()}setInterval(()=>{let l=Date.now();for(;l-i[0]>1e3;)i.shift();for(;n.length&&l-n[0].ts>1e3;)n.shift();let c=n.length,d=n.slice(-100);if(o.isRecording)for(let P of d){let{startTimeCPU:O,durationCPU:W,endTimeGPU:X}=P.frame;X&&o.add(O,{t0:O,tcpu:W,tgpu0:X[0]-O,tgpu1:X[1]-O})}let p=ah(d.map(P=>P.frame.durationCPU),2),u=[],h=[];for(let{frame:P}of d)P.endTimeGPU&&(u.push((P.endTimeGPU[0]+P.endTimeGPU[1])/2-P.startTimeCPU),h.push((P.endTimeGPU[0]-P.startTimeCPU)/2));let m=ah(u,2),y=ah(h,0),w=ah(d.map(P=>P.programUses)),S=ah(d.map(P=>P.programCount)),C=ah(d.map(P=>P.newProgramCount)),v=ah(d.map(P=>P.frame.triangles/1e3)),E=ah(d.map(P=>P.frame.bufferUploads,0)),_=ah(d.map(P=>P.frame.bufferUploadItems/1e3,1)),T=ah(d.map(P=>P.frame.peelLayers)),I=r.controller.isThreeDMode()?[`compute: <span dcg-fps-metric="computeFPS">${i.length}</span> fps`,`3d render: <span dcg-fps-metric="fps">${c}</span> fps`,`Redraw (CPU): <span dcg-fps-metric="redraw">${p}</span> ms`,`Redraw (CPU+GPU): <span dcg-fps-metric="cpu-gpu-redraw">${m}</span> \xB1<span dcg-fps-metric="cpu-gpu-redraw-error">${y}</span>ms`,`peels: <span dcg-fps-metric="peelLayers">${T}</span>`,`triangles: <span dcg-fps-metric="triangles">${v}</span>K/fr`,`buffers: <span dcg-fps-metric="uploadsPerFrame">${E}</span> uploads/fr, <span dcg-fps-metric="itemsPerFrame">${_}</span>K items/fr`,`programs: <span dcg-fps-metric="programsPerFrame">${w} uses/fr, <span dcg-fps-metric="programsCurrentPerFrame">${S} current/fr, <span dcg-fps-metric="programsNewPerFrame">${C}</span> new/fr, <span dcg-fps-metric="programsTotal">${s}</span> total`].join(" | "):`${i.length} fps`;t.innerHTML=I},100)}function ah(r,e=1){let t=0;for(let i of r)t+=i;return(t/r.length).toFixed(e)}function _re(r){let e=document.createElement("div");Yi(e,{zIndex:"99999",position:"absolute",left:"0px",top:"0px",background:"#FFF"}),e.innerText="waiting...",document.body.append(e);let t=[],o=0;r.controller.onEvaluatorChangesSpy=function(s,l){let{timeInWorker:c}=l;t[o%100]=c,o+=1};function i(){let s=0;for(let c of t)s+=c;let l=s/t.length;e.innerText=l.toFixed(1)+" ms"}let n;function a(){cancelAnimationFrame(n),n=requestAnimationFrame(a),i()}a()}function _ve(r,{shellController:e,graphsController:t,mygraphsController:o,tourController:i}){t.observeEvent("onClearGraph",()=>{r.focusFirstExpression()}),o.observeEvent("toast",(n,a)=>{if(!a)return;let{message:s,opts:l}=a;r._calc.controller.dispatch({type:"toast/show",toast:{message:s,...l}})}),t.observeEvent("toast",(n,a)=>{if(!a||"graph"in a)return;let{message:s,opts:l}=a;r._calc.controller.dispatch({type:"toast/show",toast:{message:s,...l}})}),t.observeEvent("clearUnsavedChanges",()=>{r._calc.controller.dispatch({type:"clear-unsaved-changes"})}),o.observeEvent("beforeChangeOpenedGraph",()=>{i.stopQuest()}),t.observeEvent("restoredGraph",(n,a)=>{a&&"graph"in a&&a.graph.questHash&&i.startQuestFromUndo(a.graph.questHash)}),i.observeEvent("startQuest",()=>{e.triggerRender()}),i.observeEvent("stopQuest",()=>{e.triggerRender()}),t.observeEvent("clearUndoRedo",()=>{r._calc.controller.dispatch({type:"clear-undoredo-history"})})}var tU=(r,e)=>{r.dispatch({type:"toast/show",toast:{message:e("account-shell-text-maintenance-mode"),hideAfter:-1,link:{text:e("account-shell-link-learn-more"),url:"https://help.kiavash.com/hc/en-us/articles/29072368846093-Maintenance-Mode"}}})};function Tre({api:r,noticeId:e,exampleGraphsRaw:t,seed:o,product:i}){let n=JSON.parse(t);g5();let a=r;a.hasUnsavedChanges=()=>a._calc.controller.hasUnsavedChanges();let s=!1;a._calc.controller.subscribeToChanges(()=>{let m=a._calc.controller.hasUnsavedChanges();m!==s&&l.triggerRender(),s=m});let l=new DP({api:a,product:i,noticeId:e,randomSeed:o,exampleGraphs:n}),c=l.userController,d=l.graphsController,p=l.tourController,u=l.mygraphsController;_ve(a,{shellController:l,graphsController:d,tourController:p,mygraphsController:u});let h;return a._calc.controller.triggerEasterEgg=m=>{let y=d.getEasterEggGraphs(m);if(y.length===0)return;let w=m==="betchacant"?a._calc.controller.s("account-shell-label-betchacant-loading"):a._calc.controller.s("account-shell-label-loading");h=Math.floor(Math.random()*y.length),a._calc.controller.dispatch({type:"toast/show",toast:{message:w,hideAfter:0,toastStyle:"cover"}}),d.loadGraphImmediately(y[h]).then(()=>{u.openGraphBehindCover(y[h])})},wg("expressions")!==!1&&(a._calc.controller.triggerClearGraph=()=>{d.clearGraphByUserAction()},a.observeEvent("openDrawer",()=>{l.dispatch({type:"open-mygraphs"})})),a._calc.controller.setShellView("notice",Ere(l)),a._calc.controller.getQuestIsActive=()=>p.getQuestActive(),a._calc.globalHotkeys=new GD(a._calc.controller,l,a._calc.instanceHotkeys),a._calc.controller.setCanShowKeyboardShortcuts(!0),a.observeEvent("showHotkeysModal",()=>{l.dispatch({type:"show-modal",modal:"hotkeys"})}),a._calc.controller.logEvent=co,a._calc.controller.logEventsFromDispatch=m=>{switch(m.type){case"create-table-regression":co({category:"regressions",action:"add-table-regression",name:"linear"});break;case"update-table-regression":"type"in m.update&&co({category:"regressions",action:"update-table-regression",name:m.update.type});break;case"remove-table-regression":co({category:"regressions",action:"remove-table-regression"});break;case"export-table-regression":co({category:"regressions",action:m.mode==="regression"?"export-model-to-expression-list":"copy-snapshot-to-expression-list",name:m.regressionType});break}},wg("maintenance")&&e!=="upcoming-maintenance"&&tU(a._calc.controller,l.s),ji("simulationFPS")&&setTimeout(()=>kre(a),1),ji("timeInWorker")&&_re(a),window.userController=c,window.shellController=l,window.tourController=p,{userController:c,graphsController:d,tourController:p,shellController:l}}var lr=__dcg_shared_module_exports__['e'](Z());var rp=__dcg_shared_module_exports__['e'](Z());var AP=class extends rp.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller}template(){return rp.createElement(kn,{title:()=>this.i18n.s("shared-title-account-reactivated"),size:this.const("narrow"),showX:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller},rp.createElement("div",{class:rp.const("dcg-shared-recover-password-dialog dcg-shared-account-dialog dcg-shared-account-dialog--account-reenabled")},rp.createElement("div",{class:rp.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-message-account-reactivated")),rp.createElement("div",{class:rp.const("dcg-shared-modal-actions-container")},rp.createElement("button",{class:()=>({"dcg-btn-blue":!0}),onTap:()=>this.controller.dispatch({type:"close-modal"})},()=>this.i18n.s("shared-button-continue-to-kiavash")))))}};var In=__dcg_shared_module_exports__['e'](Z());$t();var Ri=__dcg_shared_module_exports__['e'](Z());var fd=__dcg_shared_module_exports__['e'](Z()),{If:Tve,For:Gve}=fd.Components,Qs=class extends fd.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller}template(){return fd.createElement(Tve,{predicate:()=>!!this.props.errors().length},()=>fd.createElement("span",null,fd.createElement(Gve,{each:this.props.errors},e=>fd.createElement("div",{class:fd.const("dcg-shared-account-modal-errors"),role:fd.const("alert")},fd.createElement("span",null,()=>this.i18n.raw(e))))))}};var{If:Gre}=Ri.Components,Ive=0,oU=1,Ire=2,VP=class extends Ri.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.mode=oU,this.formErrors=[]}template(){return Ri.createElement("div",{class:Ri.const("dcg-shared-change-password dcg-shared-account-settings-section")},Ri.createElement(Gre,{predicate:()=>this.mode===oU},()=>Ri.createElement("div",{class:Ri.const("dcg-shared-reset-by-email")},Ri.createElement("div",{class:Ri.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-message-change-password-email-sent",{emailAddress:this.i18n.raw(this.controller.userController.getEmail())})),Ri.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),Ri.createElement("div",{class:Ri.const("dcg-shared-modal-actions-container")},Ri.createElement("div",{role:Ri.const("button"),"aria-disabled":()=>this.emailDisabled,tabIndex:()=>this.emailDisabled?"-1":"0",class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.emailDisabled}),onTap:()=>this.sendResetPasswordEmail()},()=>this.i18n.s("shared-button-send-email"))))),Ri.createElement(Gre,{predicate:()=>this.mode===Ire},()=>Ri.createElement("div",{"aria-live":Ri.const("assertive"),"aria-atomic":Ri.const("true"),class:Ri.const("dcg-shared-confirmation-message-container")},Ri.createElement("div",{class:Ri.const("dcg-shared-confirmation-message")},Ri.createElement("i",{class:()=>({"dcg-icon-check":!0,"dcg-success-marker":!0}),"aria-hidden":Ri.const("true")}),()=>this.i18n.s("shared-message-email-sent")),Ri.createElement("div",null,()=>this.i18n.s("shared-message-check-email-for-password-link",{emailAddress:this.i18n.raw(this.controller.userController.getEmail())})))))}onEmailSent(){this.mode=Ire,this.update(),setTimeout(this.bindIfMounted(()=>{this.mode=Ive,this.update()}),5e3),setTimeout(this.bindIfMounted(()=>{this.mode=oU,this.update()}),5200)}onEmailSendingFailed(e){this.formErrors=this.controller.parseJSONErrors(e),this.update()}sendResetPasswordEmail(){this.controller.userController.recoverPassword({email:this.controller.userController.getEmail(),lang:this.controller.getLanguage()}).then(this.bindIfMounted(this.onEmailSent),this.bindIfMounted(this.onEmailSendingFailed))}};var et=__dcg_shared_module_exports__['e'](Z());var jo=__dcg_shared_module_exports__['e'](Z());var LP=class extends jo.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.formErrors=[]}template(){return jo.createElement("div",{class:jo.const("dcg-shared-delete-account dcg-shared-account-settings-section")},jo.createElement("h1",{class:jo.const("dcg-shared-account-title dcg-shared-left-align-title")},()=>this.i18n.s("shared-title-delete-account")),jo.createElement("div",{class:jo.const("dcg-shared-account-paragraph")},jo.createElement(vr,{key:this.const("shared-message-delete-account-notice"),i18n:this.props.controller},jo.const("When you delete your account,"),jo.const(" "),jo.createElement("b",null,jo.const("we will retain your data for 30 days.")),jo.const(" You can reactivate your account at any time during those 30 days by logging back in. If there's something about kiavash we can improve, please"),jo.const(" "),jo.createElement("a",{href:jo.const("mailto:support@kiavash.com"),class:jo.const("dcg-blue-link")},jo.const("let us know.")))),jo.createElement("div",{class:jo.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-message-delete-account-will-send-email",{email:this.i18n.raw(this.controller.userController.getEmail())})),jo.createElement("form",{onSubmit:this.bindFn(this.onSubmit)},jo.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),jo.createElement("div",{class:jo.const("dcg-shared-modal-actions-container")},jo.createElement("div",{role:jo.const("link"),tabIndex:jo.const(0),class:jo.const("dcg-gray-link"),onTap:()=>this.props.hideForm()},()=>this.i18n.s("shared-button-cancel")),jo.createElement("button",{class:()=>({"dcg-btn-red":!0,"dcg-disabled":this.disabled}),"aria-disabled":()=>this.disabled,tabIndex:()=>this.disabled?"-1":"0",type:jo.const("submit")},()=>this.i18n.s("shared-button-send-delete-account-email")))))}onAccountDeleted(){this.props.submitForm()}onAccountDeletionFailed(e){this.formErrors=this.controller.parseJSONErrors(e),this.update()}doDeleteAccount(){this.disabled||(this.controller.logEvent({category:"accounts",action:"send-delete-email"}),this.controller.userController.initiateAccountDeletion({lang:this.controller.getLanguage()}).then(this.bindFn(this.onAccountDeleted),this.bindIfMounted(this.onAccountDeletionFailed)))}onSubmit(e){e.preventDefault(),this.doDeleteAccount()}};var br=__dcg_shared_module_exports__['e'](Z());var{If:iU}=br.Components,U1=0,Mre=1,Mve=2,Are=3,PP=class extends br.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.formStatus=U1,this.emailDisabled=null}template(){return br.createElement("div",{class:br.const("dcg-shared-email-field-container")},br.createElement(iU,{predicate:()=>this.formStatus===U1},()=>br.createElement("div",{class:br.const("dcg-shared-email-field")},br.createElement("div",{class:br.const("dcg-shared-profile-info-container")},br.createElement("span",{class:br.const("dcg-shared-profile-info-title"),role:br.const("heading"),"aria-level":br.const("1")},()=>this.i18n.s("shared-title-email-settings")),br.createElement("div",{class:br.const("dcg-shared-profile-info-content")},()=>this.i18n.raw(this.controller.userController.getEmail()),br.createElement("div",{class:br.const("dcg-shared-message-container")},br.createElement("div",{role:br.const("link"),tabIndex:br.const(0),class:br.const("dcg-blue-link"),onTap:()=>this.setFormStatus(Mre)},()=>this.i18n.s("shared-button-change-email-address"))))))),br.createElement(iU,{predicate:()=>this.formStatus===Mre},()=>br.createElement("div",{class:br.const("dcg-shared-change-email-container")},br.createElement("div",{class:br.const("dcg-shared-change-email-description")},()=>this.i18n.s("shared-message-email-settings-will-send-email",{emailAddress:this.i18n.raw(this.controller.userController.getEmail())})),br.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),br.createElement("div",{class:br.const("dcg-shared-modal-actions-container")},br.createElement("span",{role:br.const("link"),tabIndex:br.const(0),class:br.const("dcg-gray-link"),onTap:()=>this.setFormStatus(U1)},()=>this.i18n.s("shared-button-cancel")),br.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":!!this.emailDisabled}),"aria-disabled":()=>this.disabled,tabIndex:()=>this.disabled?"-1":"0",type:br.const("submit"),onTap:()=>this.emailDisabled||this.sendChangeEmail()},()=>this.i18n.s("shared-button-send-email"))))),br.createElement(iU,{predicate:()=>this.formStatus===Are},()=>br.createElement("div",{"aria-live":br.const("assertive"),"aria-atomic":br.const("true"),class:br.const("dcg-shared-confirmation-message-container")},br.createElement("div",{class:br.const("dcg-shared-confirmation-message")},br.createElement("i",{class:()=>({"dcg-icon-check":!0,"dcg-success-marker":!0}),"aria-hidden":br.const("true")}),()=>this.i18n.s("shared-message-email-sent")),br.createElement("div",null,()=>this.i18n.s("shared-message-check-email-for-link",{emailAddress:this.i18n.raw(this.controller.userController.getEmail())})))))}setToast(e){this._isMounted&&(this.toastMessage||(this.toastMessage=e,this.update(),setTimeout(this.bindIfMounted(()=>{this.toastMessage=null,this.update()}),5e3),this.formStatus===Mve&&setTimeout(this.bindIfMounted(()=>{this.setFormStatus(U1),this.update()}),5200)))}setFormStatus(e){this.formStatus=e,this.toastMessage=null,this.formErrors=[],this.update()}onEmailSent(){this.formStatus=Are,this.emailDisabled=null,this.update(),setTimeout(this.bindIfMounted(()=>{this.formStatus=U1,this.update()}),5e3),setTimeout(this.bindIfMounted(()=>{this.formStatus=U1,this.update()}),5200)}onEmailSendingFailed(e){this.formErrors=this.controller.parseJSONErrors(e),this.emailDisabled=null,this.update()}sendChangeEmail(){this.emailDisabled=!0,this.update(),this.controller.userController.initiateEmailChange({lang:this.controller.getLanguage()}).then(this.bindIfMounted(this.onEmailSent),this.bindIfMounted(this.onEmailSendingFailed))}};var{If:OP,Input:sU,Switch:Ave,SwitchUnion:Vve}=et.Components,nU=0,Vre=1,aU=2,RP=class extends et.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.deleteAccount=nU}template(){return et.createElement("div",{class:et.const("dcg-shared-profile-info dcg-shared-account-settings-section")},et.createElement(Ave,{key:()=>this.deleteAccount},e=>{switch(e){case nU:return et.createElement("div",null,et.createElement("div",{class:et.const("dcg-shared-email-form-container")},et.createElement(lU,{controller:this.props.controller})),et.createElement(PP,{controller:this.props.controller}),et.createElement("button",{class:et.const("dcg-gray-link dcg-shared-delete-link"),onTap:()=>this.confirmDeletion()},()=>this.i18n.s("shared-button-delete-account-question")));case Vre:return et.createElement(LP,{hideForm:()=>this.setDeleteAccount(nU),submitForm:()=>this.setDeleteAccount(aU),controller:this.props.controller});case aU:return et.createElement("div",{"aria-live":et.const("assertive"),"aria-atomic":et.const("true"),class:et.const("dcg-shared-confirmation-message-container")},et.createElement("div",{class:et.const("dcg-shared-confirmation-message")},et.createElement("i",{class:()=>({"dcg-icon-check":!0,"dcg-success-marker":!0}),"aria-hidden":et.const("true")}),()=>this.i18n.s("shared-message-email-sent")),et.createElement("div",null,()=>this.i18n.s("shared-message-check-email-for-delete-link",{emailAddress:this.i18n.raw(this.controller.userController.getEmail())})))}}))}setDeleteAccount(e){this.deleteAccount=e,e===aU&&setTimeout(()=>{this.controller.userController.logout().then(()=>{this.controller.dispatch({type:"close-modal"})})},5e3),this._isMounted&&this.update()}confirmDeletion(){this.setDeleteAccount(Vre)}},lU=class extends et.Class{init(){this.controller=this.props.controller(),this.formErrors=[];let e=this.controller.userController.getNameDetail();e.source=="legacy"?this.state={state:"legacy",name:e.given,previousName:e.given}:e.source=="parsed"?this.state={state:"name-detail",confirm:!0,given:e.given,family:e.family||"",previousGiven:"",previousFamily:""}:this.state={state:"name-detail",confirm:!1,given:e.given,family:e.family||"",previousGiven:e.given,previousFamily:e.family||""}}template(){return Vve("state",()=>this.state)({legacy:e=>et.createElement(cU,{state:e,controller:this.props.controller,onSaveName:this.bindFn(this.onSaveName),formErrors:()=>this.formErrors,showSavedNotice:()=>this.showSavedNotice,updateState:t=>{this.state.state=="legacy"&&(this.state={...this.state,...t},this._isMounted&&this.update())}}),"name-detail":e=>et.createElement(dU,{state:e,controller:this.props.controller,showSavedNotice:()=>this.showSavedNotice,onSaveName:this.bindFn(this.onSaveName),formErrors:()=>this.formErrors,updateState:t=>{this.state.state=="name-detail"&&(this.state={...this.state,...t},this._isMounted&&this.update())}})})}onSaveName(){switch(this.state.state){case"legacy":this.controller.userController.setNameLegacy({name:this.state.name,lang:this.controller.getLanguage()}).then(this.bindIfMounted(this.onSaved)).catch(this.bindIfMounted(e=>{this.formErrors=this.controller.parseJSONErrors(e),this.update()}));break;case"name-detail":this.controller.userController.setNameDetail({given:this.state.given,family:this.state.family,lang:this.controller.getLanguage()}).then(this.bindIfMounted(this.onSaved)).catch(this.bindIfMounted(e=>{this.formErrors=this.controller.parseJSONErrors(e),this.update()}));break}}onSaved(){switch(this.state.state){case"legacy":this.state.previousName=this.state.name;break;case"name-detail":this.state.previousGiven=this.state.given,this.state.previousFamily=this.state.family,this.state.confirm=!1;break}this.showSavedNotice=!0,this.update(),setTimeout(this.bindIfMounted(()=>{this.showSavedNotice=!1,this.update()}),3e3)}},cU=class extends et.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller}template(){return et.createElement("form",{class:et.const("dcg-shared-name-field"),onSubmit:this.bindFn(this.onSaveName)},et.createElement("div",{class:et.const("dcg-shared-profile-info-container")},et.createElement("label",{class:et.const("dcg-shared-profile-info-title"),for:et.const("name")},()=>this.i18n.s("shared-label-name")),et.createElement(sU,{type:et.const("text"),name:et.const("name"),class:et.const("dcg-shared-input-blue-outline dcg-shared-profile-info-content"),didMount:this.bindFn(this.didMountName),onInput:this.bindFn(this.onNameInput),"aria-label":()=>this.i18n.s("shared-label-name"),value:()=>this.props.state().name,autocomplete:et.const("off")})),et.createElement("div",{class:et.const("dcg-shared-modal-actions-container")},et.createElement(FP,{showSavedNotice:this.props.showSavedNotice,i18n:this.props.controller}),et.createElement("button",{type:et.const("submit"),disabled:()=>this.nameFieldDisabled()?!0:void 0,class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.nameFieldDisabled()})},()=>this.i18n.s("shared-button-save"))),et.createElement(OP,{predicate:()=>this.props.formErrors().length>0},()=>et.createElement(Qs,{controller:this.props.controller,errors:()=>this.props.formErrors()})))}onNameInput(e){this.props.updateState({name:e})}didMountName(e){sp||e.focus()}onSaveName(e){e.preventDefault(),!this.nameFieldDisabled()&&this.props.onSaveName()}nameFieldDisabled(){let e=this.props.state();return!e.name||e.name===e.previousName}},dU=class extends et.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller}template(){return et.createElement("form",{class:et.const("dcg-shared-name-field"),onSubmit:this.bindFn(this.onSaveName)},et.createElement("div",{class:()=>({"dcg-shared-confirm-name":this.props.state().confirm})},et.createElement(OP,{predicate:()=>this.props.state().confirm},()=>et.createElement("span",null,()=>this.i18n.s("shared-message-please-review-name"))),et.createElement("div",{class:et.const("dcg-shared-profile-info-container")},et.createElement("div",{class:et.const("dcg-shared-name-input")},et.createElement("label",{class:et.const("dcg-shared-profile-info-title"),for:et.const("given-name")},()=>this.i18n.s("shared-label-given-name-or-nickname")),et.createElement(sU,{type:et.const("text"),name:et.const("given-name"),id:et.const("given-name"),class:et.const("dcg-shared-input-blue-outline dcg-shared-profile-info-content"),didMount:this.bindFn(this.didMountName),onInput:e=>this.props.updateState({given:e}),"aria-label":()=>this.i18n.s("shared-label-given-name-or-nickname"),value:()=>this.props.state().given,autocomplete:et.const("off")})),et.createElement("div",{class:et.const("dcg-shared-name-input")},et.createElement("label",{class:et.const("dcg-shared-profile-info-title"),for:et.const("family-name")},()=>this.i18n.s("shared-label-family-name")),et.createElement(sU,{type:et.const("text"),name:et.const("family-name"),id:et.const("family-name"),class:et.const("dcg-shared-input-blue-outline dcg-shared-profile-info-content"),onInput:e=>this.props.updateState({family:e}),"aria-label":()=>this.i18n.s("shared-label-family-name"),value:()=>this.props.state().family,autocomplete:et.const("off")}))),et.createElement("div",{class:et.const("dcg-shared-modal-actions-container")},et.createElement(FP,{i18n:this.props.controller,showSavedNotice:this.props.showSavedNotice}),et.createElement("button",{type:et.const("submit"),disabled:()=>this.canSubmit()?void 0:!0,class:()=>({"dcg-btn-blue":!0,"dcg-disabled":!this.canSubmit()})},()=>this.props.state().confirm?this.i18n.s("shared-button-confirm-name"):this.i18n.s("shared-button-save"))),et.createElement(OP,{predicate:()=>this.props.formErrors().length>0},()=>et.createElement(Qs,{controller:this.props.controller,errors:()=>this.props.formErrors()}))))}didMountName(e){sp||e.focus()}onSaveName(e){e.preventDefault(),this.canSubmit()&&this.props.onSaveName()}canSubmit(){let e=this.props.state();return e.given?e.confirm?!0:!(e.given===e.previousGiven&&e.family===e.previousFamily):!1}},FP=class extends et.Class{template(){return et.createElement(OP,{predicate:()=>this.props.showSavedNotice()},()=>et.createElement("span",{"aria-live":et.const("assertive"),"aria-atomic":et.const("true"),class:et.const("dcg-shared-confirmation-message")},et.createElement("i",{class:()=>({"dcg-icon-check":!0,"dcg-success-marker":!0}),"aria-hidden":et.const("true")}),()=>this.props.i18n().s("shared-message-information-saved")))}};var{For:Lve,Switch:Pve}=In.Components,NP="profile-info",pU="change-password",BP=class extends In.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.settingsView=this.props.initialTab&&this.props.initialTab()||NP,this.breakPoint=660,this.measureWindow()}template(){return In.createElement(kn,{title:()=>this.i18n.s("shared-title-account-settings"),size:this.const("wide"),showX:this.const(!0),leftAlignTitle:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller},In.createElement("div",{class:In.const("dcg-shared-account-settings-dialog dcg-shared-account-dialog")},In.createElement("div",{class:In.const("dcg-shared-navigation-tabs"),role:In.const("tablist")},In.createElement(Lve,{each:()=>this.getTabs(),key:e=>""+e.key},e=>In.createElement("div",{role:In.const("tab"),tabIndex:In.const("0"),"aria-selected":()=>this.settingsView===e.key,class:()=>({"dcg-shared-tab-gray-underline":!0,[e.class]:!0,"dcg-selected":this.settingsView===e.key}),onTap:()=>this.updateSettingsView(e.key)},e.label))),In.createElement("div",{class:In.const("dcg-shared-content-container")},In.createElement(Pve,{key:()=>this.settingsView},e=>e===NP?In.createElement(RP,{controller:this.props.controller}):e===pU?In.createElement(VP,{controller:this.props.controller}):this.props.extraTabs?In.createElement("div",{class:In.const("dcg-shared-profile-info dcg-shared-account-settings-section")},this.props.extraTabs().createView(e)):In.createElement("span",null)))))}getTabs(){let e=[{key:NP,label:this.bindFn(this.profileTitle),class:"profile-view-button"},{key:pU,label:this.bindFn(this.passwordTitle),class:"change-password-view-button"}];return this.props.extraTabs?[...e,...this.props.extraTabs().tabs.map(({key:t,narrowLabel:o,wideLabel:i,class:n})=>({key:t,label:()=>this.windowWidth>this.breakPoint?o():i(),class:`${n}-button`}))]:e}updateSettingsView(e){this.settingsView=e,this._isMounted&&this.update()}profileTitle(){return this.windowWidth>this.breakPoint?this.i18n.s("shared-title-profile-information-wide"):this.i18n.s("shared-title-profile-information-narrow")}passwordTitle(){return this.windowWidth>this.breakPoint?this.i18n.s("shared-title-change-password-wide"):this.i18n.s("shared-title-change-password-narrow")}measureWindow(){return this.windowWidth=re(window).width()}didMount(){re(window).on("resize.account-dialog",__dcg_shared_module_exports__['E'](()=>{this.measureWindow(),this._isMounted&&this.update()},200))}didUnmount(){re(window).off("resize.account-dialog")}isProfileSelected(){return this.settingsView===NP}isChangePasswordSelected(){return this.settingsView===pU}};var Ro=__dcg_shared_module_exports__['e'](Z());var{Input:Lre}=Ro.Components,UP=class extends Ro.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.formErrors=[]}template(){return Ro.createElement(kn,{title:()=>this.i18n.s("shared-title-change-email-address"),size:this.const("narrow"),showX:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller},Ro.createElement("div",{class:Ro.const("dcg-shared-change-email dcg-shared-account-dialog")},Ro.createElement("div",{class:Ro.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-message-set-new-email-address")),Ro.createElement("form",{onSubmit:this.bindFn(this.onSubmit),method:Ro.const("post"),class:Ro.const("dcg-shared-email-form-container")},Ro.createElement("label",null,Ro.createElement("span",{class:Ro.const("dcg-shared-input-title")},()=>this.i18n.s("shared-label-new-email-address")),Ro.createElement(Lre,{type:Ro.const("email"),pattern:this.const(eh),name:Ro.const("newEmail"),class:Ro.const("dcg-shared-input-blue-outline"),"aria-label":()=>this.i18n.s("shared-label-new-email-address"),required:Ro.const("true"),didMount:e=>{sp||e.focus()},value:()=>this.newEmail,onInput:e=>{this.newEmail=e,this._isMounted&&this.update()}})),Ro.createElement("label",{for:Ro.const("password")},Ro.createElement("span",null,()=>this.i18n.s("shared-label-password")),Ro.createElement(Lre,{type:Ro.const("password"),class:Ro.const("dcg-shared-input-blue-outline"),"aria-label":()=>this.i18n.s("shared-label-password"),required:Ro.const("true"),value:()=>this.password,name:this.const("password"),onInput:e=>{if(this.password=e,this._isMounted)return this.update()}})),Ro.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),Ro.createElement("div",{class:Ro.const("dcg-shared-sign-in-options")},Ro.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":!this.submitEnabled()}),"aria-disabled":()=>!this.submitEnabled(),tabIndex:()=>this.submitEnabled()?"0":"-1",type:Ro.const("submit")},()=>this.i18n.s("shared-button-change-email-and-password"))))))}submitEnabled(){return!!(this.password&&this.newEmail)}async onSubmit(e){if(e.preventDefault(),this.submitEnabled())try{await this.controller.userController.setEmail({changeToken:this.getChangeToken(),password:this.password,newEmail:this.newEmail,lang:this.controller.getLanguage()}),this.controller.dispatch({type:"close-modal"}),history.replaceState(null,null,document.location.pathname)}catch(t){if(!this._isMounted)return;t.status===409?this.formErrors=["Sorry, someone has already registered with this email address."]:this.formErrors=this.controller.parseJSONErrors(t),this.update()}}getChangeToken(){return this.controller.userController.getEmailChangeToken()||""}};var eo=__dcg_shared_module_exports__['e'](Z());var{If:qP,Input:Ove}=eo.Components,zP=class extends eo.Class{init(){this.controller=this.props.controller(),this.i18n=this.controller,this.email=this.controller.emailForResetPassword||"",this.formErrors=[],this.isSubmittingForm=!1,this.didSendRecoveryEmail=!1}template(){return eo.createElement(kn,{title:()=>this.i18n.s("shared-title-recover-password"),size:this.const("tiny"),showX:this.const(!0),class:this.const("dcg-authentication-modal"),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller,withBackButton:this.const(!0),withStickyTitle:this.const(!0),onBack:this.bindFn(this.onBack)},eo.createElement("div",{class:eo.const("dcg-shared-recover-password-dialog dcg-shared-account-dialog")},eo.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),eo.createElement(qP,{predicate:()=>this.didSendRecoveryEmail},()=>eo.createElement("div",{role:eo.const("alert"),class:eo.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-message-check-email-for-password-recovery-link"),eo.const(" "),eo.createElement("a",{href:eo.const("#"),class:eo.const("dcg-blue-link"),onTap:()=>(this.didSendRecoveryEmail=!1,this.controller.dispatch({type:"show-modal",modal:"recover-password"}))},()=>this.i18n.s("shared-button-try-again")))),eo.createElement(qP,{predicate:()=>!this.didSendRecoveryEmail},()=>eo.createElement("form",{class:eo.const("dcg-shared-email-form-container"),onSubmit:this.bindFn(this.onSubmit)},eo.createElement("div",{class:eo.const("dcg-shared-account-paragraph")},()=>this.i18n.s("shared-prompt-enter-email-for-password-recovery-link")),eo.createElement("div",{class:eo.const("dcg-authentication-modal__control")},eo.createElement("label",null,()=>this.i18n.s("shared-label-email"),eo.createElement(Ove,{type:eo.const("email"),pattern:this.const(eh),name:eo.const("email"),class:()=>({"dcg-shared-input-blue-outline":!0,"dcg-authentication-modal__input":!0,"dcg-authentication-modal__input--email":!0}),"aria-label":()=>this.i18n.s("shared-label-email"),required:eo.const("true"),didMount:e=>{sp||(e.focus(),e.select())},value:()=>this.email,onInput:e=>{this.email=e,this._isMounted&&this.update()}}))),eo.createElement("div",{class:eo.const("dcg-shared-sign-in-options")},eo.createElement(qP,{predicate:()=>this.isSubmittingForm},()=>eo.createElement("div",{class:eo.const("dcg-shared-progress-indicator dcg-shared-create-account-progress")},eo.createElement("div",{class:eo.const("dcg-shared-spinner")}))),eo.createElement(qP,{predicate:()=>!this.isSubmittingForm},()=>eo.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button-no-top-padding":!0,"dcg-disabled":this.isSubmitButtonDisabled()}),disabled:()=>this.isSubmitButtonDisabled()||void 0,type:eo.const("submit")},()=>this.i18n.s("shared-button-recover-password"))))))))}onBack(){this.controller.dispatch({type:"show-modal",modal:"authentication"})}isSubmitButtonDisabled(){return!this.email}onSubmit(e){e.preventDefault(),this.submitForm()}async submitForm(){this.formErrors=[],this.isSubmittingForm=!0;try{if(await this.controller.userController.recoverPassword({email:this.email,lang:this.controller.getLanguage()}),!this._isMounted)return;this.didSendRecoveryEmail=!0}catch(e){if(!this._isMounted)return;this.formErrors=this.controller.parseJSONErrors(e)}finally{this._isMounted&&(this.isSubmittingForm=!1,this.update())}}};var Le=__dcg_shared_module_exports__['e'](Z());var{For:Rve,If:HP,Input:OD,SwitchUnion:Fve,IfDefined:Pre}=Le.Components;function Ore(){return window.googleAuthConnectionFailed}var KP=class extends Le.Class{template(){return Le.createElement("input",{class:Le.const("dcg-authentication-modal__input dcg-authentication-modal__input--email dcg-authentication-modal__input--hidden"),type:Le.const("email"),value:this.bindFn(this.props.email),disabled:Le.const(!0),tabIndex:Le.const(-1)})}},WP=class extends Le.Class{constructor(){super(...arguments),this.passwordElementType="password"}onInputMount(e){var t,o;sp||!((o=(t=this.props).withAutoFocus)!=null&&o.call(t))||(e.focus(),e.select())}onPasswordToggle(){this.passwordElementType=this.passwordElementType==="password"?"text":"password",this.update()}template(){return Le.createElement("div",{class:Le.const("dcg-authentication-modal__control dcg-authentication-modal__control--password")},Le.createElement("label",{class:()=>{var e,t;return{"dcg-authentication-modal__label":!0,"dcg-authentication-modal__label--password":!0,"dcg-authentication-modal__label--standalone":!!((t=(e=this.props).isSignUp)!=null&&t.call(e))}}},()=>{var e,t;return(t=(e=this.props).isSignUp)!=null&&t.call(e)?this.props.i18n("shared-label-create-password"):this.props.i18n("shared-label-enter-password")},Le.createElement(OD,{class:()=>{var e,t;return{"dcg-shared-input-blue-outline":!0,"dcg-authentication-modal__input":!0,"dcg-authentication-modal__input--password":!0,"dcg-disabled":!!((t=(e=this.props).isDisabled)!=null&&t.call(e))}},type:()=>this.passwordElementType,onInput:this.bindFn(this.props.onInput),value:this.bindFn(this.props.value),onMount:this.bindFn(this.onInputMount),onUnmount:this.bindFn(this.props.onUnmount),onEnterPressed:this.bindFn(this.props.onEnterPressed),disabled:()=>{var e,t;return!!((t=(e=this.props).isDisabled)!=null&&t.call(e))||void 0},autocomplete:()=>{var e,t;return(t=(e=this.props).isSignUp)!=null&&t.call(e)?"new-password":"current-password"}})),Le.createElement(OD,{class:this.const("dcg-authentication-modal__button dcg-authentication-modal__button--password"),type:this.const("image"),src:()=>this.passwordElementType==="password"?"/assets/img/eye-open.svg":"/assets/img/eye-closed.svg",alt:()=>this.passwordElementType==="password"?this.props.i18n("shared-button-show-password"):this.props.i18n("shared-button-hide-password"),onTap:this.bindFn(this.onPasswordToggle),onEnterPressed:this.bindFn(this.onPasswordToggle),onInput:()=>{},value:this.const("")}))}},$P=class extends Le.Class{template(){return Le.createElement("label",{class:Le.const("dcg-authentication-modal__label dcg-authentication-modal__label--standalone")},()=>this.props.i18n("shared-label-choose-all-that-describe"),Le.const(" "),Le.createElement("span",{class:Le.const("dcg-authentication-modal__sublabel")},()=>this.props.i18n("shared-label-optional")),Le.createElement("ul",{class:Le.const("dcg-unstyled-list dcg-authentication-modal__tag-control"),role:Le.const("listbox"),"aria-multiselectable":Le.const("true"),onKeyDown:this.bindFn(this.onKeyDown)},Le.createElement(Rve,{each:this.bindFn(this.props.tags),key:e=>e.id},e=>Le.createElement("li",{class:()=>({"dcg-authentication-modal__tag":!0,"dcg-authentication-modal__tag--selected":e.isSelected()}),onTap:()=>this.props.onSelect(e),"aria-selected":()=>e.isSelected(),tabIndex:()=>e.isSelected()||this.isFirstAndNoneSelected(e)?0:-1,role:Le.const("option")},Le.createElement(HP,{predicate:()=>e.isSelected()},()=>Le.createElement("i",{class:Le.const("dcg-icon-check"),"aria-hidden":Le.const("true")})),()=>e.label))))}isFirstAndNoneSelected(e){let t=this.props.tags()[0];return e.id===t.id&&!t.isSelected()}onKeyDown(e){var a,s,l,c;let t=Be(e);if(!t||!["Up","Down","Right","Left"].includes(t)||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;e.preventDefault(),e.stopPropagation();let o=["Up","Left"].includes(t)?-1:1,i=".dcg-authentication-modal__tag",n=o===1?(s=(a=document.activeElement)==null?void 0:a.closest(i))==null?void 0:s.nextSibling:(c=(l=document.activeElement)==null?void 0:l.closest(i))==null?void 0:c.previousSibling;n&&"focus"in n&&typeof n.focus=="function"&&n.focus()}},RD=class extends Le.Class{getClassName(){switch(this.props.provider()){case"apple":return"dcg-authentication-modal__button--apple";case"google":return"dcg-authentication-modal__button--google"}}getButtonText(){switch(this.props.provider()){case"apple":return this.props.controller().s("shared-prompt-continue-with-apple");case"google":return this.props.controller().s("shared-prompt-continue-with-google")}}onSsoTap(e){this.props.controller().userController.dispatch({type:"sso-log-in",payload:{provider:e}})}stepIsLoading(){var e;return((e=this.props.controller().userController.getAuthenticationStep().status)==null?void 0:e.type)==="loading"}isDisabled(){return this.props.provider()==="google"?Ore()||this.stepIsLoading():this.stepIsLoading()}template(){return Le.createElement("button",{class:()=>({"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button--sso":!0,"dcg-btn-gray-outline":!0,"dcg-disabled":this.isDisabled(),[this.getClassName()]:!0}),didMount:e=>{var t,o;(o=(t=this.props).focusOnMount)!=null&&o.call(t)&&e.focus()},"aria-disabled":()=>this.isDisabled()?!0:void 0,disabled:()=>this.isDisabled()?!0:void 0,onTap:()=>this.onSsoTap(this.props.provider())},()=>this.getButtonText())}},jP=class extends Le.Class{constructor(){super(...arguments),this.controller=this.props.controller(),this.userController=this.controller.userController,this.email="",this.password="",this.firstName="",this.lastName="",this.selectedTags=new Set,this.tagLabels={student:this.controller.s("shared-button-student-classification"),teacher:this.controller.s("shared-button-teacher-classification"),"non-education":this.controller.s("shared-button-non-education-classification"),fun:this.controller.s("shared-button-fun-classification")}}getTags(){return Object.keys(this.tagLabels).map(e=>({id:e,label:this.tagLabels[e],isSelected:()=>this.selectedTags.has(e)}))}didMount(){this.userController.dispatch({type:"reset-authentication-step"})}onClose(){this.controller.closeExternalLoginPopupWindow(),this.controller.dispatch({type:"close-modal"})}getTitle(){switch(this.userController.getAuthenticationStep().name){case"authenticate":return this.controller.s("shared-title-authenticate");case"email-login":case"previously-sso":return this.controller.s("shared-title-login");case"email-signup":return this.controller.s("shared-title-welcome");case"sso-confirmation":return this.controller.s("shared-title-welcome-with-name",{name:this.userController.getFullName()})}}withBackButton(){return["email-login","email-signup","previously-sso"].includes(this.userController.getAuthenticationStep().name)}onBack(){this.userController.dispatch({type:"previous-step"})}onEmailInputMount(e){this.emailElement=e,!sp&&(e.focus(),e.select())}onEmailInputUnmount(){this.emailElement=void 0}onEmailInput(e){this.email=e,this.update()}isAuthenticateStepLoading(){var t;let e=this.userController.getAuthenticationStep();return e.name==="authenticate"&&((t=e.status)==null?void 0:t.type)==="loading"}isEmailInputDisabled(){return this.isAuthenticateStepLoading()}getAuthenticationStepError(e="authenticate"){var o;let t=this.userController.getAuthenticationStep();if(t.name===e&&((o=t.status)==null?void 0:o.type)==="error")return this.controller.s("account-shell-error-unknown");if(Ore())return this.controller.s("shared-message-google-login-not-available")}onNext(){var e;!((e=this.emailElement)!=null&&e.reportValidity())||this.isNextButtonDisabled()||this.userController.dispatch({type:"get-email-registration-status",payload:{email:this.email}})}isNextButtonDisabled(){return!this.email||this.isAuthenticateStepLoading()}onPasswordUnmount(){this.password=""}onPasswordInput(e){this.password=e,this.update()}isPasswordInputDisabled(){var t,o;let e=this.userController.getAuthenticationStep();return e.name==="email-login"&&((t=e.status)==null?void 0:t.type)==="loading"||e.name==="email-signup"&&((o=e.status)==null?void 0:o.type)==="loading"}isLogInButtonDisabled(){var t;let e=this.userController.getAuthenticationStep();return e.name==="email-login"&&(((t=e.status)==null?void 0:t.type)==="loading"||!this.password)}onPasswordEnterPressed(){if(!(this.isLogInButtonDisabled()||this.isSignUpButtonDisabled())){if(this.userController.getAuthenticationStep().name==="email-signup"){this.userController.dispatch({type:"email-sign-up",payload:{i18n:this.controller.s,language:this.controller.getLanguage(),firstName:this.firstName,lastName:this.lastName,email:this.email,password:this.password,classifications:this.getSelectedTags().map(e=>e.id)}});return}this.userController.dispatch({type:"email-log-in",payload:{language:this.controller.getLanguage(),email:this.email,password:this.password,i18n:this.controller.s}})}}onSaveSsoConfirmationTap(){this.getSelectedTags().length>0&&this.userController.dispatch({type:"update-classifications",payload:{classifications:this.getSelectedTags().map(e=>e.id)}}),this.controller.dispatch({type:"close-modal"})}hasEmailLogInError(e=this.userController.getAuthenticationStep()){var t;return e.name==="email-login"&&((t=e.status)==null?void 0:t.type)==="error"}onFirstNameMount(e){sp||e.focus()}onFirstNameInput(e){this.firstName=e,this.update()}isFirstNameInputDisabled(){var t;let e=this.userController.getAuthenticationStep();return e.name==="email-signup"&&((t=e.status)==null?void 0:t.type)==="loading"}onLastNameInput(e){this.lastName=e,this.update()}isLastNameInputDisabled(){var t;let e=this.userController.getAuthenticationStep();return e.name==="email-signup"&&((t=e.status)==null?void 0:t.type)==="loading"}isSignUpButtonDisabled(){var t;let e=this.userController.getAuthenticationStep();return e.name==="email-signup"&&(!this.firstName||!this.password||((t=e.status)==null?void 0:t.type)==="loading")}getSelectedTags(){return this.getTags().filter(e=>e.isSelected())}onTagSelect(e){e.isSelected()?this.selectedTags.delete(e.id):this.selectedTags.add(e.id),this.update()}hasEmailSignUpError(e=this.userController.getAuthenticationStep()){var t;return e.name==="email-signup"&&((t=e.status)==null?void 0:t.type)==="error"}onForgotPassword(){this.controller.emailForResetPassword=this.email,this.controller.dispatch({type:"show-modal",modal:"recover-password"})}getPreviousSsoSubtitle(e){switch(e){case"google":return this.controller.s("shared-text-previous-google");case"apple":return this.controller.s("shared-text-previous-apple")}}showTerms(){let e=this.userController.getAuthenticationStep().name;return["email-sign-up","authenticate","sso-confirmation"].includes(e)}template(){return Le.createElement(kn,{title:this.bindFn(this.getTitle),withStickyTitle:this.const(!0),withBackButton:this.bindFn(this.withBackButton),onBack:this.bindFn(this.onBack),size:this.const("tiny"),showX:this.const(!0),onClose:this.bindFn(this.onClose),i18n:this.const(this.controller),leftAlignTitle:this.const(!0),class:this.const("dcg-authentication-modal")},Fve("name",()=>this.userController.getAuthenticationStep())({authenticate:()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__step dcg-authentication-modal__step--authenticate")},Le.createElement(RD,{provider:this.const("google"),controller:()=>this.controller}),Le.createElement(RD,{provider:this.const("apple"),controller:()=>this.controller}),Le.createElement("div",{role:Le.const("separator"),class:Le.const("dcg-authentication-modal__divider")},()=>this.controller.s("shared-text-or")),Le.createElement("div",{class:Le.const("dcg-authentication-modal__control dcg-authentication-modal__control--email")},Le.createElement("label",null,()=>this.controller.s("shared-label-continue-with-email"),Le.createElement(OD,{class:()=>({"dcg-shared-input-blue-outline":!0,"dcg-authentication-modal__input":!0,"dcg-authentication-modal__input--email":!0,"dcg-disabled":this.isEmailInputDisabled()}),disabled:()=>this.isEmailInputDisabled(),type:this.const("email"),pattern:this.const(eh),onInput:this.bindFn(this.onEmailInput),value:()=>this.email,onMount:this.bindFn(this.onEmailInputMount),onUnmount:this.bindFn(this.onEmailInputUnmount),onEnterPressed:this.bindFn(this.onNext),autocomplete:this.const("email")})),Le.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.isNextButtonDisabled(),"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button--next":!0}),disabled:()=>this.isNextButtonDisabled()||void 0,onTap:this.bindFn(this.onNext)},()=>this.controller.s("shared-button-next"))),Pre(()=>this.getAuthenticationStepError(),e=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__error"),role:Le.const("alert")},e)),Le.createElement("small",{class:Le.const("dcg-authentication-modal__detail dcg-authentication-modal__detail--cookies")},Le.createElement(vr,{key:this.const("shared-text-cookie-notice"),i18n:this.const(this.controller)},Le.const("We use cookies only for logged in users. Please stay logged out to use kiavash without cookies.")))),"email-login":()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__step dcg-authentication-modal__step--email-login")},Le.createElement(KP,{email:()=>this.email}),Le.createElement(WP,{i18n:this.controller.s,withAutoFocus:this.const(!0),isDisabled:this.bindFn(this.isPasswordInputDisabled),onUnmount:this.bindFn(this.onPasswordUnmount),onInput:this.bindFn(this.onPasswordInput),value:()=>this.password,onEnterPressed:this.bindFn(this.onPasswordEnterPressed)}),Le.createElement("div",{class:Le.const("dcg-authentication-modal__button-group")},Le.createElement("button",{class:Le.const("dcg-authentication-modal__detail dcg-authentication-modal__detail--forgot-password"),tabIndex:Le.const(0),onTap:this.bindFn(this.onForgotPassword)},()=>this.controller.s("shared-prompt-forgot-password")),Le.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.isLogInButtonDisabled(),"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button--log-in":!0}),disabled:()=>this.isLogInButtonDisabled()||void 0,onTap:this.bindFn(this.onPasswordEnterPressed)},()=>this.controller.s("shared-button-login-capitalized"))),Le.createElement(HP,{predicate:this.bindFn(this.hasEmailLogInError)},()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__error"),role:Le.const("alert")},()=>{let e=this.userController.getAuthenticationStep();if(this.hasEmailLogInError(e))return e.status.message}))),"email-signup":()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__step")},Le.createElement(KP,{email:()=>this.email}),Le.createElement("h2",{class:Le.const("dcg-authentication-modal__subtitle")},Le.createElement(vr,{i18n:this.const(this.controller),key:this.const("shared-title-using-for-sign-up")},Le.const("You're signing up with "),Le.createElement("b",null,()=>this.email),Le.const("."))),Le.createElement("div",{class:Le.const("dcg-authentication-modal__input-group")},Le.createElement("label",null,()=>this.controller.s("shared-label-first-name"),Le.createElement(OD,{class:()=>({"dcg-shared-input-blue-outline":!0,"dcg-authentication-modal__input":!0,"dcg-authentication-modal__input--first-name":!0,"dcg-disabled":this.isFirstNameInputDisabled()}),type:this.const("text"),onInput:this.bindFn(this.onFirstNameInput),value:()=>this.firstName,onMount:this.bindFn(this.onFirstNameMount),disabled:()=>this.isFirstNameInputDisabled()||void 0,autocomplete:this.const("given-name")})),Le.createElement("label",null,()=>this.controller.s("shared-label-last-name"),Le.const(" "),Le.createElement("span",{class:Le.const("dcg-authentication-modal__sublabel dcg-authentication-modal__sublabel--shrunk")},()=>this.controller.s("shared-label-optional")),Le.createElement(OD,{class:()=>({"dcg-shared-input-blue-outline":!0,"dcg-authentication-modal__input":!0,"dcg-authentication-modal__input--last-name":!0,"dcg-disabled":this.isLastNameInputDisabled()}),type:this.const("text"),onInput:this.bindFn(this.onLastNameInput),value:()=>this.lastName,disabled:()=>this.isLastNameInputDisabled()||void 0,autocomplete:this.const("family-name")}))),Le.createElement(WP,{i18n:this.controller.s,isSignUp:this.const(!0),isDisabled:this.bindFn(this.isPasswordInputDisabled),onUnmount:this.bindFn(this.onPasswordUnmount),onInput:this.bindFn(this.onPasswordInput),value:()=>this.password,onEnterPressed:this.bindFn(this.onPasswordEnterPressed)}),Le.createElement($P,{i18n:this.controller.s,onSelect:this.bindFn(this.onTagSelect),tags:this.bindFn(this.getTags)}),Le.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.isSignUpButtonDisabled(),"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button--full-width":!0,"dcg-authentication-modal__button--sign-up":!0}),"aria-disabled":()=>this.isSignUpButtonDisabled()?"":void 0,onTap:this.bindFn(this.onPasswordEnterPressed)},()=>this.controller.s("shared-button-sign-up")),Le.createElement(HP,{predicate:this.bindFn(this.hasEmailSignUpError)},()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__error"),role:Le.const("alert")},()=>{let e=this.userController.getAuthenticationStep();if(this.hasEmailSignUpError(e))return e.status.message}))),"previously-sso":e=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__step dcg-authentication-modal__step--previously-sso")},Le.createElement("h2",{class:Le.const("dcg-authentication-modal__subtitle dcg-authentication-modal__subtitle-large-font")},()=>this.getPreviousSsoSubtitle(e().ssoProvider)),Le.createElement(RD,{provider:()=>e().ssoProvider,controller:()=>this.controller,focusOnMount:this.const(!0)}),Le.createElement("button",{class:Le.const("dcg-authentication-modal__detail dcg-unstyled-button dcg-authentication-modal__detail--set-password dcg-blue-link"),tabIndex:Le.const(0),onTap:this.bindFn(this.onForgotPassword)},()=>this.controller.s("shared-prompt-set-password")),Pre(()=>this.getAuthenticationStepError(),t=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__error"),role:Le.const("alert")},t))),"sso-confirmation":()=>Le.createElement("div",{class:Le.const("dcg-authentication-modal__step dcg-authentication-modal__step--sso-confirmation")},Le.createElement("h2",{class:Le.const("dcg-authentication-modal__subtitle")},Le.createElement(vr,{i18n:this.const(this.controller),key:this.const("shared-title-account-finish-set-up")},Le.const("You signed up with"),Le.const(" "),Le.createElement("b",null,()=>this.userController.getEmail()),Le.const(". Finish setting up your account below."))),Le.createElement($P,{i18n:this.controller.s,onSelect:this.bindFn(this.onTagSelect),tags:this.bindFn(this.getTags)}),Le.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-authentication-modal__button":!0,"dcg-authentication-modal__button--full-width":!0,"dcg-authentication-modal__button--save":!0}),onTap:this.bindFn(this.onSaveSsoConfirmationTap)},()=>this.controller.s("graphing-calculator-button-done")))}),Le.createElement(HP,{predicate:()=>this.showTerms()},()=>Le.createElement("small",{class:Le.const("dcg-authentication-modal__detail dcg-authentication-modal__detail--privacy")},Le.createElement(vr,{key:this.const("shared-text-privacy-notice"),i18n:this.props.controller},Le.const("By signing up, you agree to our"),Le.const(" "),Le.createElement("a",{class:Le.const("dcg-blue-link"),href:Le.const("/privacy"),target:Le.const("_blank")},Le.const("Privacy Policy")),Le.const(" "),Le.const("&"),Le.const(" "),Le.createElement("a",{class:Le.const("dcg-blue-link"),href:Le.const("/terms"),target:Le.const("_blank")},Le.const("Terms")),Le.const(".")))))}};var Dy=__dcg_shared_module_exports__['e'](Z());var YP=class extends Dy.Class{constructor(){super(...arguments),this.controller=this.props.controller()}template(){return Dy.createElement(kn,{size:this.const("fullscreen"),showX:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.const(this.controller),class:this.const("dcg-my-graphs-modal")},Dy.createElement("div",null,Dy.const("TODO")))}};Xa();var mi=__dcg_shared_module_exports__['e'](Z());var{IfDefined:Nve,For:Bve}=mi.Components,XP={"dcg-actions":{label:"account-shell-label-feature-flag-actions",description:"account-shell-text-feature-flag-actions-description",learnMoreLink:"https://help.kiavash.com/hc/en-us/articles/4407725009165"}},JP=class extends mi.Class{init(){this.formErrors=[]}template(){return mi.createElement("div",{class:mi.const("dcg-advanced-settings")},mi.createElement("div",{class:mi.const("dcg-shared-account-paragraph")},()=>this.props.controller().s("account-shell-text-advanced-preferences-instructions")),mi.createElement("div",{class:mi.const("dcg-feature-flag-list")},mi.createElement(Bve,{each:()=>Object.keys(XP)},e=>mi.createElement("div",null,mi.createElement(Gt,{checked:()=>this.isFeatureFlagEnabled(e),disabled:()=>!!this.updateInFlight,onChange:t=>this.toggleFeatureFlag(e,t)},mi.createElement("span",{class:mi.const("dcg-feature-flag-label")},()=>this.label(e))),mi.createElement("div",{class:mi.const("dcg-feature-flag-description")},()=>this.description(e),mi.const(" "),mi.createElement("a",{href:()=>this.learnMoreLink(e),class:mi.const("dcg-blue-link"),target:mi.const("_blank")},()=>this.props.controller().s("graphing-calculator-link-learn-more")))))),mi.createElement(Qs,{controller:this.props.controller,errors:()=>this.formErrors}),Nve(this.bindFn(this.getSaveProgress),e=>mi.createElement("span",{"aria-live":mi.const("assertive"),"aria-atomic":mi.const("true"),class:mi.const("dcg-shared-confirmation-message")},mi.createElement("i",{class:()=>({"dcg-icon-check":!0,"dcg-success-marker":!0,"dcg-saving":e()==="saving"}),"aria-hidden":mi.const("true")}),()=>e()==="saving"?this.props.controller().s("shared-calculator-label-saving"):this.props.controller().s("shared-message-information-saved"))))}getSaveProgress(){if(this.updateInFlight)return"saving";if(this.showSuccessConfirmation)return"saved"}isFeatureFlagEnabled(e){return this.updateInFlight&&e in this.updateInFlight?this.updateInFlight[e]:this.props.controller().userController.getFeatureFlags().indexOf(e)!==-1}async toggleFeatureFlag(e,t){this.updateInFlight={[e]:t},this.props.controller().dispatch({type:"render"});try{if(await this.props.controller().userController.updateFeatureFlags({featureFlagsUpdate:this.updateInFlight,lang:this.props.controller().getLanguage()}),!this._isMounted)return;this.showSuccessConfirmation=!0,setTimeout(this.bindIfMounted(()=>{this.showSuccessConfirmation=!1,this.props.controller().dispatch({type:"render"})}),3e3)}catch(o){if(!this._isMounted)return;Vo(o),this.formErrors=this.props.controller().parseJSONErrors(o)}finally{this._isMounted&&(this.updateInFlight=void 0,this.props.controller().dispatch({type:"render"}))}}learnMoreLink(e){return XP[e].learnMoreLink}label(e){return this.props.controller().s(XP[e].label)}description(e){return this.props.controller().s(XP[e].description)}};var he=__dcg_shared_module_exports__['e'](Z());var fi=__dcg_shared_module_exports__['e'](Z());var{If:QP,For:Uve,Input:qve}=fi.Components,FD=class extends fi.Class{constructor(){super(...arguments),this.filter=void 0,this.focusLocation=void 0,this.lastResultCount=0}init(){this.controller=this.props.controller()}template(){return fi.createElement("div",{class:fi.const("dcg-search-container"),onKeyDown:this.bindFn(this.onKeydown)},fi.createElement(QP,{predicate:this.props.renderWithInput},()=>fi.createElement("div",{role:fi.const("search"),class:fi.const("dcg-searchable-dropdown")},fi.createElement(qve,{class:()=>({"dcg-results-hidden":!this.showResults()}),id:()=>this.props.id?this.props.id():void 0,didMount:this.bindFn(this.didMountInput),onInput:this.bindFn(this.onInputChange),value:this.bindFn(this.getFilterString),placeholder:()=>this.props.placeholder(),autofill:this.const(!1),"data-1p-ignore":this.const(!0),manageFocus:this.const({shouldBeFocused:this.bindFn(this.shouldFilterBeFocused),onFocusedChanged:this.bindFn(this.onFilterFocusChange)}),required:()=>{var e,t;return(t=(e=this.props).required)==null?void 0:t.call(e)}}),fi.createElement(QP,{predicate:()=>this.shouldShowDeleteX()},()=>fi.createElement("i",{class:fi.const("dcg-icon-remove dcg-remove-x dcg-do-not-blur"),role:fi.const("button"),tabIndex:fi.const("0"),"aria-label":()=>this.controller.s("shared-calculator-button-clear"),onTap:this.bindFn(this.onDeleteXTapped)})))),fi.createElement(QP,{predicate:()=>this.getFilteredOptions().length>0&&this.showResults()},()=>fi.createElement("div",{class:()=>{var e,t;return{"dcg-searchable-dropdown-list-container":!0,"dcg-render-as-popover":(t=(e=this.props).popoverOptionsOnFocus)==null?void 0:t.call(e)}}},fi.createElement("div",{class:()=>({"dcg-searchable-dropdown-list":!0,"dcg-do-not-blur":!0,"dcg-no-input":!this.props.renderWithInput()}),role:fi.const("listbox"),"aria-label":()=>this.controller.s("shared-calculator-label-search-results")},fi.createElement(Uve,{each:()=>this.getFilteredOptions(),key:e=>e.id+"-"+e.label},e=>fi.createElement("div",{class:fi.const("dcg-searchable-dropdown-option"),role:fi.const("option"),onTap:t=>this.selectOption(e,t.device==="keyboard"),manageFocus:this.const({shouldBeFocused:()=>this.shouldOptionBeFocused(e),onFocusedChanged:t=>this.onOptionFocusChange(e,t)}),tabIndex:fi.const(0)},this.const(e.label)))))),fi.createElement(QP,{predicate:()=>this.getFilteredOptions().length===0&&this.showResults()},()=>fi.createElement("div",{class:()=>{var e,t;return{"dcg-searchable-dropdown-list-container":!0,"dcg-render-as-popover":(t=(e=this.props).popoverOptionsOnFocus)==null?void 0:t.call(e)}}},fi.createElement("div",{class:()=>({"dcg-searchable-dropdown-list":!0,"dcg-no-search-results":!0})},()=>this.controller.s("shared-calculator-text-search-results",{count:__dcg_shared_module_exports__['kc'](0)})))))}showResults(){var e,t;return(t=(e=this.props).popoverOptionsOnFocus)!=null&&t.call(e)?!!this.focusLocation:!0}didMountInput(){var e,t;(t=(e=this.props).popoverOptionsOnFocus)!=null&&t.call(e)||this.focusFilter()}shouldShowDeleteX(){return!!this.getFilterString()}onDeleteXTapped(e){this.onInputChange(""),this.props.externalControl?(this.props.externalControl().onClear(),e.device==="keyboard"&&this.focusFilter()):(this.focusFilter(),this.update())}shouldFilterBeFocused(){return this.focusLocation&&this.focusLocation.type==="filter"}onFilterFocusChange(e){e?this.focusFilter():(this.focusLocation=void 0,this.update())}shouldOptionBeFocused(e){return this.focusLocation&&this.focusLocation.type==="option"&&this.focusLocation.id===e.id}focusFilter(){this.focusLocation={type:"filter"},this.update()}focusOption(e){this.focusLocation={type:"option",id:e.id},this.update()}getFocusedOptionIndex(){if(!this.focusLocation||this.focusLocation.type!=="option")return-1;let e=this.focusLocation.id,t=this.getFilteredOptions();for(let o=0;o<t.length;o++)if(t[o].id===e)return o;return-1}onOptionFocusChange(e,t){t?this.focusOption(e):(this.focusLocation=void 0,this.update())}onKeydown(e){switch(Be(e)){case Dh:if(this.shouldFilterBeFocused()){let t=this.getFilteredOptions();t.length===1&&this.selectOption(t[0],!0)}break;case Ia:this.moveFocusInDirection(-1)&&e.preventDefault();break;case On:this.moveFocusInDirection(1)&&e.preventDefault();break;case kh:e.preventDefault(),this.focusFirstOption();break;case lp:e.preventDefault(),this.focusLastOption();break;case Pn:this.props.onCancel();break;case _l:e.shiftKey?this.moveFocusInDirection(-1)&&e.preventDefault():this.moveFocusInDirection(1)&&e.preventDefault();break}}moveFocusInDirection(e){let t=this.getFilteredOptions(),i=this.getFocusedOptionIndex()+e;if(i==-1&&this.props.renderWithInput())return this.focusFilter(),!0;let n=t[i];return n?(this.focusOption(n),!0):!1}focusFirstOption(){let e=this.getFilteredOptions();e.length!==0&&this.focusOption(e[0])}focusLastOption(){let e=this.getFilteredOptions();e.length!==0&&this.focusOption(e[e.length-1])}onInputChange(e){this.props.externalControl?this.props.externalControl().onValueChange(e):this.filter=e,this.update()}getFilterString(){return this.props.externalControl?this.props.externalControl().getValue():this.filter||""}selectOption(e,t){var o,i;(i=(o=this.props).popoverOptionsOnFocus)!=null&&i.call(o)?this.onInputChange(e.label):this.onInputChange(""),this.focusLocation=void 0,this.update(),this.props.onChange({value:e.id,fromKeyboard:t})}getFilteredOptions(){let e=this.props.options(),t=this.getFilterString().toLowerCase().trim();return t&&(e=e.filter(o=>o.label.toLowerCase().indexOf(t)!==-1)),e}onUpdate(){let e=this.getFilteredOptions().length;this.focusLocation&&this.focusLocation.type==="filter"&&e!==this.lastResultCount&&Te(this.controller.s("shared-calculator-text-search-results",{count:__dcg_shared_module_exports__['kc'](e)})),this.lastResultCount=e}};function uU(r){return!!r&&!!r.country&&!!r.birth_year&&!!r.email&&!!r.artist_statement&&!!r.name&&!!r.graph_hash&&!!r.product&&!!r.country&&!!r.age_group}var{If:Df,IfElse:hU,Input:Rre,SwitchUnion:zve,Textarea:Hve}=he.Components,Kve=Object.values(L5).map(r=>({id:r,label:r})),Wve=Array.from({length:121},(r,e)=>{let t=2020-e;return{id:t.toString(),label:t.toString()}}),$ve={country:"account-shell-text-art-contest-someone-else-country","birth-year":"account-shell-text-art-contest-someone-else-birth-year",name:"account-shell-text-art-contest-someone-else-name",email:"account-shell-text-art-contest-someone-else-email","artist-statement":"account-shell-text-art-contest-someone-else-artist-statement","artist-statement-description":"account-shell-text-art-contest-someone-else-artist-statement-description",agreement:"account-shell-text-art-contest-someone-else-copyright-agreement","first-year":"account-shell-text-art-contest-someone-else-first-year"},jve={country:"account-shell-heading-country","birth-year":"account-shell-heading-birth-year",name:"account-shell-heading-name",email:"account-shell-heading-email","artist-statement":"account-shell-heading-artist-statement","artist-statement-description":"account-shell-label-artist-statement-description",agreement:"account-shell-text-art-contest-copyright-agreement","first-year":"account-shell-text-art-contest-my-first-year"},ND=class extends he.Class{getProductType(){var t,o,i;let e=(t=this.shellController)==null?void 0:t.getProduct();if(e==="geometry")throw new Error("Art contest does not work on legacy geometry tool.");return(i=(o=this.currentSubmission)==null?void 0:o.product)!=null?i:e}shouldSaveGraph(){var e;return(e=this.shellController)==null?void 0:e.graphsController.hasUnsavedChanges()}async saveGraph(){if(!(!this.shellController||!this.currentSubmission)){this.saveStatus="pending";try{let e;if(this.shellController.graphsController.isCurrentGraphTitled()&&this.shellController.graphsController.wasCurrentGraphEverSaved()?(await this.shellController.graphsController.save(),e=this.shellController.graphsController.currentGraph):e=await this.shellController.graphsController.shareGraph(),!this._isMounted)return;this.currentSubmission.title=e.title,this.currentSubmission.graph_hash=e.hash,this.saveStatus="success"}catch(e){if(!this._isMounted)return;this.saveStatus="fail"}finally{this._isMounted&&this.update()}}}init(){var e,t,o;"frontpageController"in this.props?(this.frontpageController=this.props.frontpageController(),this.s=this.frontpageController.s):(this.shellController=this.props.shellController(),this.s=this.shellController.s),this.saveStatus="idle",this.submitStatus="idle",this.currentSubmission={...(t=(e=this.props).currentSubmission)==null?void 0:t.call(e)},(o=this.currentSubmission)!=null&&o.submitting_for_someone_else?this.translationStrings=$ve:this.translationStrings=jve,this.getScreen()==="form"&&this.initEditMode()}getProductSafely(){var t;let e=(t=this.shellController)==null?void 0:t.getProduct();if(e==="geometry")throw new Error("Art contest is invalid on geometry tool");return e}async initEditMode(){var o,i,n,a;let e=((o=this.currentSubmission)==null?void 0:o.name)||((i=this.shellController)==null?void 0:i.userController.getFullName()),t=(n=this.currentSubmission)==null?void 0:n.name;if(this.currentSubmission={age_group:this.getSelectedAgeGroup(),product:this.getProductSafely(),...this.currentSubmission,name:this.getIsForSomeoneElse()?t:e,email:((a=this.currentSubmission)==null?void 0:a.email)||this.getController().userController.getEmail()},this.hasConsent=!1,this.shouldSaveGraph()){if(await this.saveGraph(),!this._isMounted)return}else this.shellController&&(this.currentSubmission.graph_hash=this.shellController.graphsController.getCurrentGraphHash(),this.currentSubmission.title=this.shellController.graphsController.getCurrentGraphTitle())}getIsForSomeoneElse(){var e;return!!((e=this.currentSubmission)!=null&&e.submitting_for_someone_else)}getScreen(){var e;return(e=this.currentSubmission)!=null&&e.submission_id&&this.submitStatus==="idle"&&!this.shouldUpdateSubmission?"showing-submission":this.saveStatus==="pending"?"saving":this.saveStatus==="fail"?"save-failed":this.submitStatus==="fail"?"submit-failed":this.submitStatus==="pending"?"submitting":this.submitStatus==="success"?"submitted":"form"}closeModalAndShowSubmissions(){this.getController().dispatch({type:"close-modal"}),this.shellController&&!this.isSmallScreen()&&this.shellController.dispatch({type:"toggle-menu",payload:"art-contest"})}isSmallScreen(){let e=window.platform;return document.body.getBoundingClientRect().width<650||e==="ios"||e==="android"}getController(){return"shellController"in this.props?this.props.shellController():this.props.frontpageController()}getThumbAlt(){var e,t;return(e=this.currentSubmission)!=null&&e.title&&this.currentSubmission.title!==""?this.s("frontpage-narration-art-contest-image-of-graph",{graphTitle:this.currentSubmission.title}):(t=this.currentSubmission)!=null&&t.name?this.s("frontpage-narration-art-contest-image-of-graph-by",{name:this.currentSubmission.name}):""}shouldAllowUpdate(){return this.shellController?this.shellController.isGraphComplexEnoughForContest()&&!this.shellController.graphsController.willSaveCopy():!1}template(){return he.createElement("div",{class:he.const("modal_section")},he.createElement("div",{class:he.const("dcg-contest-submission-dialog dcg-text-selectable")},zve(()=>this.getScreen(),{"showing-submission":()=>he.createElement("div",{class:he.const("dcg-art-contest-info-container")},he.createElement("div",{class:he.const("dcg-flex-container")},he.createElement("div",{class:he.const("dcg-art-contest-world-image dcg-art-contest-submission-thumbnail")},he.createElement("img",{src:()=>{var e;return(e=this.currentSubmission)==null?void 0:e.thumb},alt:this.bindFn(this.getThumbAlt)})),he.createElement("div",{class:he.const("dcg-contest-about")},he.createElement("h1",{class:he.const("dcg-contest-submission-title dcg-shared-left-align-title")},()=>this.s("account-shell-label-submission-already-received")),he.createElement("div",{class:he.const("dcg-contest-text")},he.createElement("div",{class:he.const("dcg-submission-wrapper")},he.createElement("div",{class:he.const("dcg-submission-header")},()=>this.s(this.translationStrings.name)),he.createElement("div",{class:he.const("dcg-submission-content")},()=>{var e;return(e=this.currentSubmission)==null?void 0:e.name}),he.createElement("div",{class:he.const("dcg-submission-header")},()=>this.s(this.translationStrings.email)),he.createElement("div",{class:he.const("dcg-submission-content")},()=>{var e;return(e=this.currentSubmission)==null?void 0:e.email}),he.createElement("div",{class:he.const("dcg-submission-header")},()=>this.s(this.translationStrings["artist-statement"]),he.const(" ")),he.createElement("div",{class:he.const("dcg-submission-content")},()=>{var e;return(e=this.currentSubmission)==null?void 0:e.artist_statement}))),he.createElement(Df,{predicate:()=>this.shouldAllowUpdate()},()=>he.createElement("button",{class:he.const("dcg-resubmit-link"),onTap:this.bindFn(this.triggerSubmissionUpdate)},()=>this.s("account-shell-button-update-graph")))))),saving:()=>he.createElement("div",{class:he.const("dcg-save-animation-container")},he.createElement("div",{class:he.const("dcg-saving")},he.createElement("div",{"aria-live":he.const("polite"),"aria-atomic":he.const("true")},he.createElement("span",{class:he.const("dcg-spinner")}),()=>this.s("account-shell-label-saving-graph")))),"save-failed":()=>he.createElement("div",{class:he.const("dcg-save-animation-container")},he.createElement("div",{class:he.const("dcg-saving")},he.createElement("div",{"aria-live":he.const("polite"),"aria-atomic":he.const("true")},()=>this.s("account-shell-error-save-art-contest")))),submitting:()=>he.createElement("div",{class:he.const("dcg-save-animation-container")},he.createElement("div",{class:he.const("dcg-saving")},he.createElement("div",{"aria-live":he.const("polite"),"aria-atomic":he.const("true")},he.createElement("span",{class:he.const("dcg-spinner")}),()=>this.s("account-shell-label-submitting")))),"submit-failed":()=>he.createElement("div",{class:he.const("dcg-save-animation-container")},he.createElement("div",{class:he.const("dcg-saving")},he.createElement("div",{"aria-live":he.const("polite"),"aria-atomic":he.const("true")},()=>this.s("account-shell-error-submitting")))),submitted:()=>he.createElement("div",{class:he.const("dcg-save-animation-container")},he.createElement("div",{class:he.const("dcg-art-contest-success-image")},he.createElement("img",{src:()=>{var e;return(e=this.currentSubmission)==null?void 0:e.thumb},alt:this.bindFn(this.getThumbAlt)})),he.createElement("div",{class:he.const("dcg-save-success"),"aria-live":he.const("polite"),"aria-atomic":he.const("true")},()=>this.s("account-shell-label-submission-received"),he.createElement("div",{class:he.const("dcg-save-animation-content")},he.createElement("div",null,he.createElement("div",{class:he.const("dcg-congrats-message")},hU(()=>this.getIsForSomeoneElse(),{false:()=>he.createElement(vr,{i18n:this.bindFn(this.getController),key:this.const("account-shell-text-art-contest-success-paragraph")},he.const("If you'd like to revise your submission, feel free to resubmit anytime before"),he.createElement("span",{class:he.const("bold-text")},he.const(" January 15th")),he.const(". We'll only look at the most recent submission for each tool.")),true:()=>he.createElement(vr,{i18n:this.bindFn(this.getController),key:this.const("account-shell-text-art-contest-success-paragraph-someone-else")},he.const("If you'd like to revise the submission, please delete it from the table of graphs you\u2019ve submitted and resubmit. Feel free to resubmit anytime before"),he.createElement("span",{class:he.const("bold-text")},he.const(" January 15th")),he.const(". We'll only look at the most recent submission for each tool."))})),he.createElement("div",{class:he.const("dcg-congrats-message")},()=>this.s("account-shell-text-art-contest-congratulations")),he.createElement(Df,{predicate:()=>!this.getIsForSomeoneElse()&&!this.isSmallScreen()},()=>he.createElement("button",{class:he.const("dcg-btn-blue dcg-see-submission-button"),onTap:this.bindFn(this.closeModalAndShowSubmissions)},()=>this.s("account-shell-text-art-contest-see-submissions"))))))),form:()=>he.createElement("div",null,he.createElement("h1",{class:he.const("dcg-contest-submission-title dcg-shared-left-align-title")},()=>this.s("account-shell-heading-submit-graph")),he.createElement("form",{class:he.const("dcg-submission-form"),onSubmit:this.bindFn(this.submitEntry)},he.createElement("div",{class:he.const("dcg-country-and-year")},he.createElement("div",{class:he.const("dcg-form-section")},he.createElement("label",{class:he.const("dcg-section-title"),for:he.const("art-contest-country")},()=>this.s(this.translationStrings.country)),he.createElement(Df,{predicate:()=>!!this.getSelectedCountry()},()=>he.createElement("button",{class:he.const("dcg-blue-link dcg-edit-link"),onTap:()=>{this.setSelectedCountry(void 0)},"aria-label":()=>this.s("account-shell-narration-edit-selected-country")},()=>this.s("account-shell-button-edit"))),hU(()=>!!this.getSelectedCountry(),{true:()=>he.createElement("div",{class:he.const("dcg-your-country-name")},()=>this.getSelectedCountry()),false:()=>he.createElement(FD,{controller:this.bindFn(this.getController),options:()=>this.getListOfCountries(),onChange:e=>this.setSelectedCountry(e.value),onCancel:()=>this.setSelectedCountry(void 0),renderWithInput:()=>!0,id:this.const("art-contest-country"),placeholder:()=>this.s("account-shell-label-country-placeholder"),required:this.const(!0)})})),he.createElement("div",{class:he.const("dcg-form-section")},he.createElement("label",{class:he.const("dcg-section-title"),for:he.const("art-contest-birth-year")},()=>this.s(this.translationStrings["birth-year"])),he.createElement(Df,{predicate:()=>!!this.getSelectedCountry()&&!!this.getSelectedYear()},()=>he.createElement("button",{class:he.const("dcg-blue-link dcg-edit-link"),onTap:()=>{this.setSelectedYear(void 0)},"aria-label":()=>this.s("account-shell-narration-edit-selected-year")},()=>this.s("account-shell-button-edit"))),he.createElement(Df,{predicate:()=>this.shouldShowAgeOptions()},()=>he.createElement("div",null,hU(()=>!!this.getSelectedYear(),{true:()=>he.createElement("div",{class:he.const("dcg-your-birth-year")},()=>this.getSelectedYear()),false:()=>he.createElement(FD,{controller:this.bindFn(this.getController),options:()=>this.getListOfYears(),onChange:e=>this.setSelectedYear(e.value),onCancel:()=>this.setSelectedYear(void 0),renderWithInput:()=>!0,placeholder:()=>this.s("account-shell-label-birth-year-placeholder"),id:this.const("art-contest-birth-year"),required:()=>!0})}))))),he.createElement(Df,{predicate:()=>this.isSubmissionEligible()},()=>he.createElement("div",null,he.createElement("div",{class:he.const("dcg-form-section-flex")},he.createElement("div",{class:he.const("dcg-form-section")},he.createElement("label",{class:he.const("dcg-section-title"),for:he.const("art-contest-name")},()=>this.s(this.translationStrings.name)),he.createElement("div",{class:he.const("dcg-section-subtitle"),id:he.const("art-contest-name-description")},()=>this.s("account-shell-heading-name-details")),he.createElement(Rre,{class:this.const("dcg-shared-input-blue-outline"),didMount:e=>{e.focus(),e.select()},"data-1p-ignore":this.const(!0),onInput:e=>this.setUserName(e),value:this.bindFn(this.getUserName),disabled:()=>!1,id:this.const("art-contest-name"),required:()=>!0,"aria-describedby":this.const("art-contest-name-description")})),he.createElement("div",{class:he.const("dcg-form-section")},he.createElement("label",{class:he.const("dcg-section-title"),for:he.const("art-contest-email")},()=>this.s(this.translationStrings.email)),he.createElement("div",{class:he.const("dcg-section-subtitle"),id:he.const("art-contest-email-description")},()=>this.s("account-shell-heading-email-details")),he.createElement(Rre,{class:this.const("dcg-shared-input-blue-outline"),"data-1p-ignore":this.const(!0),onInput:e=>this.setUserEmail(e),value:this.bindFn(this.getUserEmail),placeholder:()=>this.s("account-shell-label-email-address"),disabled:()=>!1,id:this.const("art-contest-email"),required:()=>!0,"aria-describedby":this.const("art-contest-email-description"),type:this.const("email"),pattern:this.const(eh)}))),he.createElement(Gt,{checked:this.bindFn(this.getFirstParticipant),onChange:this.bindFn(this.toggleFirstParticipant)},()=>this.s(this.translationStrings["first-year"])),he.createElement("div",{class:he.const("dcg-form-section")},he.createElement("label",{class:he.const("dcg-section-title"),for:he.const("art-contest-artist-statement")},()=>this.s(this.translationStrings["artist-statement"])),he.createElement("div",{class:he.const("dcg-section-subtitle"),id:he.const("art-contest-artist-statement-description")},()=>this.s(this.translationStrings["artist-statement-description"])),he.createElement(Hve,{class:this.const("dcg-shared-input-blue-outline dcg-artist-statement-input"),onInput:e=>this.setArtistStatement(e),value:this.bindFn(this.getArtistStatement),maxLength:this.const(900),placeholder:()=>this.s("account-shell-label-artist-statement-placeholder"),id:this.const("art-contest-artist-statement"),required:()=>!0,"aria-describedby":this.const("art-contest-artist-statement-description")})),he.createElement(Gt,{checked:this.bindFn(this.getConsentTicked),onChange:this.bindFn(this.toggleConsent),required:()=>!0},()=>this.s(this.translationStrings.agreement)),he.createElement("button",{class:()=>({"dcg-btn-blue":!0,"dcg-disabled":this.isSubmitButtonDisabled(),"dcg-submit-this-graph-btn":!0}),"aria-disabled":()=>this.isSubmitButtonDisabled()?!0:void 0,type:he.const("submit")},()=>this.s("account-shell-button-submit-graph")),he.createElement("div",{class:he.const("dcg-disclaimer")},()=>this.s("account-shell-text-art-contest-legal-disclaimer")))),he.createElement(Df,{predicate:()=>this.shouldShowIneligible()},()=>he.createElement("div",{class:he.const("dcg-ineligible-container"),"aria-live":he.const("polite"),"aria-atomic":he.const("true")},he.createElement("i",{class:he.const("dcg-icon-error"),"aria-hidden":he.const("true")}),he.createElement(vr,{i18n:this.bindFn(this.getController),key:this.const("account-shell-text-artcontest-ineligible")},he.createElement("div",{class:he.const("dcg-ineligible-text-container")},he.createElement("div",{class:he.const("dcg-ineligible-text")},he.const("Based on the provided age, we aren\u2019t able to accept this graph submission this year.")),he.createElement("div",{class:he.const("dcg-ineligible-text")},he.const("Keep up the awesome graphing! There will be new contests every year.")))))),he.createElement(Df,{predicate:()=>this.shouldPromptSomeoneElse()},()=>he.createElement("div",{class:he.const("dcg-ineligible-container"),"aria-live":he.const("polite"),"aria-atomic":he.const("true")},he.createElement("i",{class:he.const("dcg-icon-error"),"aria-hidden":he.const("true")}),he.createElement(vr,{i18n:this.bindFn(this.getController),key:this.const("account-shell-text-artcontest-someone-else")},he.createElement("div",{class:he.const("dcg-ineligible-text-container")},he.createElement("div",{class:he.const("dcg-ineligible-text")},he.const("Based on your age and location, you need a teacher, parent, or guardian over the age of 18 to submit your graph for you.")),he.createElement("div",{class:he.const("dcg-ineligible-text")},he.const("Here is the link to your graph:"),he.const(" ")),vr.subview("graphlink",()=>he.createElement(_1,{strings:()=>nP(this.getController()),link:()=>DZ(this.getGraphHash(),this.getProductType())})),he.createElement("div",{class:he.const("dcg-ineligible-text")},he.const("Please share it with one of them and have them submit it at"),he.const(" "),he.createElement("a",{href:he.const("/art"),class:he.const("dcg-blue-link"),target:he.const("_blank")},he.const("kiavash.com/art")),he.const("."))))))))})))}getGraphHash(){return this.currentSubmission.graph_hash}async submitEntry(e){var t,o,i;if(e.preventDefault(),!this.isSubmitButtonDisabled()){this.submitStatus="pending",this.update();try{let n=this.currentSubmission;if(!uU(n))throw new Error("Invalid submission");let a=await ere(n);if(!this._isMounted)return;let s=Array.isArray(a)?a[0]:a;if(s!=null&&s.submission_id&&(this.submitStatus="success",(o=(t=this.props).onSuccessfulSubmit)==null||o.call(t),(i=this.currentSubmission)!=null&&i.submitting_for_someone_else?co({category:"art-contest",action:"submit-for-someone-else"}):co({category:"art-contest",action:"submit"})),await this.fetchContestEntry(),!this._isMounted)return;this.shouldUpdateSubmission=!1}catch(n){if(!this._isMounted)return;Te(this.s("account-shell-error-submitting")),this.submitStatus="fail"}finally{this._isMounted&&this.update()}}}triggerSubmissionUpdate(){this.initEditMode(),this.shouldUpdateSubmission=!0,this.update()}async fetchContestEntry(){let e=this.getProductType();if(e)try{let t=await k1(e);if(!this._isMounted)return;this.currentSubmission=t[0]}catch(t){if(!this._isMounted)return;Te(this.s("account-shell-error-submitting")),this.submitStatus="fail"}finally{this._isMounted&&this.update()}}shouldShowAgeOptions(){return!!this.getSelectedCountry()}shouldShowIneligible(){let e=this.getUserAgeInYears();return!!this.getSelectedCountry()&&!!this.getSelectedYear()&&!!e&&e<13}shouldPromptSomeoneElse(){return!!this.getSelectedCountry()&&!!this.getSelectedYear()&&!this.isSubmissionEligible()&&!this.shouldShowIneligible()}setArtistStatement(e){this.currentSubmission.artist_statement=e,this.update()}setSelectedYear(e){this.currentSubmission.birth_year!==e&&(this.currentSubmission.birth_year=e?Number(e):void 0,this.currentSubmission.age_group=this.getSelectedAgeGroup(),this.update())}setSelectedCountry(e){this.currentSubmission.country=e,this.update()}getArtistStatement(){return this.currentSubmission.artist_statement||""}getSelectedCountry(){return this.currentSubmission.country}getSelectedYear(){return this.currentSubmission.birth_year}getUserAgeInYears(){return this.currentSubmission.birth_year?O5-this.currentSubmission.birth_year:void 0}getSelectedAgeGroup(e=this.getUserAgeInYears()){if(e!==void 0){if(e>=19)return"19+";if(e>=17)return"17-18";if(e>=15)return"15-16";if(e>=13)return"13-14"}}getUserName(){return this.currentSubmission.name||""}setUserName(e){this.currentSubmission.name=e,this.update()}getUserEmail(){return this.currentSubmission.email||""}setUserEmail(e){this.currentSubmission.email=e,this.update()}getConsentTicked(){return!!this.hasConsent}toggleConsent(){this.hasConsent=!this.hasConsent,this.update()}getFirstParticipant(){return!!this.currentSubmission.first_time_submission}toggleFirstParticipant(){this.currentSubmission.first_time_submission=!this.currentSubmission.first_time_submission,this.update()}isSubmitButtonDisabled(){return!this.hasConsent||this.submitStatus==="pending"||!uU(this.currentSubmission)}isSubmissionEligible(){var o,i;if(!this.currentSubmission.country||!this.currentSubmission.birth_year)return!1;let e=this.getUserAgeInYears();if((o=this.currentSubmission)!=null&&o.submitting_for_someone_else&&e&&e>=13)return!0;let t=(i=Bte[this.currentSubmission.country])!=null?i:16;return!!e&&e>=t}getListOfCountries(){return Kve}getListOfYears(){return Wve}};var Ct=__dcg_shared_module_exports__['e'](Z());function Fre(r){let e=r.split(","),t=e[0].match(/:(.*?);/),o=t!==null?t[1]:"",i=e[1]!==null?atob(e[1]):"",n=i.length,a=new Uint8Array(n);for(;n--;)a[n]=i.charCodeAt(n);return new Blob([a],{type:o})}function Nre(r){if(r.indexOf("xmlns=")===-1)throw new Error('Programming error: <svg> elements require the "xmlns" attribute to render properly');return new Blob([r],{type:"image/xml+svg;charset=utf-8"})}var{If:Dg,IfElse:Yve}=Ct.Components,kg={};kg.small_square={width:160,height:160};kg.medium_square={width:400,height:400};kg.large_square={width:1e3,height:1e3};kg.medium_rectangle={width:600,height:400};kg.large_rectangle={width:1200,height:800};kg={...kg,..._m};var BD=class extends Ct.Class{init(){this.controller=this.props.controller(),this.thickness="thin";let e=this.controller.api.controller.getBrailleMode();this.brailleMode=e!=="none"?e:"nemeth",this.showDownloadButton=cP(),this.markImagesDirty(),this.loaded=!1,this.exportType=e!=="none"?this.brailleMode:"png",this.size=e!=="none"?"vpmax8":"medium_square",this.updateGraphPreview()}template(){return Ct.createElement("div",null,Ct.createElement(kn,{title:()=>this.controller.s("account-shell-heading-export-image"),size:this.const("wide"),showX:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller},Ct.createElement("div",{id:Ct.const("export-image-dialog")},Ct.createElement("div",{class:Ct.const("dcg-columns")},Ct.createElement("div",{class:Ct.const("dcg-left-column")},Ct.createElement("div",{class:()=>({"dcg-graph-preview":!0,"dcg-preview-loading":this.imgDirty})},Ct.createElement(Dg,{predicate:()=>this.loaded},()=>Ct.createElement("img",{class:Ct.const("dcg-graph-image"),didMount:this.bindFn(this.didMountGraphPreview),src:()=>this.previewDataURL,alt:()=>this.controller.s("account-shell-narration-graph-preview")})),Ct.createElement(Dg,{predicate:()=>this.imgDirty},()=>Ct.createElement("span",{class:Ct.const("dcg-loading-message")},Ct.createElement("span",{class:Ct.const("dcg-spinner")}),()=>this.controller.s("account-shell-label-loading"))),Ct.createElement(Dg,{predicate:()=>!this.imgDirty&&!this.isExportingBraille()},()=>Ct.createElement("span",{class:Ct.const("dcg-zoom-percentage")},this.bindFn(this.getZoom))))),Ct.createElement("div",{class:Ct.const("dcg-right-column")},Ct.createElement("div",{class:Ct.const("dcg-option-container")},Ct.createElement("label",{class:Ct.const("dcg-section-title"),for:Ct.const("export-graph-type")},()=>this.controller.s("account-shell-heading-file-format")),Ct.createElement(gf,{controller:this.bindFn(this.props.controller),options:this.bindFn(this.getExportOptions),onChange:e=>this.setExportType(e),id:this.const("export-graph-type"),defaultValue:()=>this.exportType,focusOnMount:this.const(!0)})),Ct.createElement("div",{class:Ct.const("dcg-option-container")},Ct.createElement("label",{class:Ct.const("dcg-section-title"),for:Ct.const("export-graph-size")},()=>this.controller.s("account-shell-heading-export-size")),Ct.createElement(gf,{controller:this.bindFn(this.props.controller),options:this.bindFn(this.getSizeOptions),id:this.const("export-graph-size"),externalControl:()=>({getValue:()=>this.size,onValueChange:e=>this.selectSize(e)})})),Ct.createElement(Dg,{predicate:()=>!this.isExportingBraille()},()=>Ct.createElement("div",null,Ct.createElement("h2",{class:Ct.const("dcg-section-title")},()=>this.controller.s("account-shell-heading-line-thickness")),Ct.createElement(Po,{staticConfig:this.bindFn(this.getLineThicknessOptions),ariaGroupLabel:()=>this.controller.s("account-shell-heading-line-thickness")}))),Ct.createElement(Dg,{predicate:()=>this.isExportingBraille()},()=>Ct.createElement("div",{class:Ct.const("braille-container")},Ct.createElement("h2",{class:Ct.const("dcg-section-title")},()=>this.controller.s("account-shell-heading-embossing-instructions")),Ct.createElement(Dg,{predicate:()=>this.size==="vpmax8"||this.size==="vpmax11"},()=>Ct.createElement("ul",null,Ct.createElement("li",null,()=>this.controller.s("account-shell-text-embossing-vpmax-save")),Ct.createElement("li",null,()=>this.controller.s("account-shell-text-embossing-vpmax-print",{size:Bre(this.size)})))),Ct.createElement(Dg,{predicate:()=>this.size==="etc8"||this.size==="etc11"},()=>Ct.createElement("ul",null,Ct.createElement("li",null,()=>this.controller.s("account-shell-text-embossing-etc-save")),Ct.createElement("li",null,()=>this.controller.s("account-shell-text-embossing-etc-print",{size:Bre(this.size)})))),Ct.createElement("div",null,Ct.createElement(vr,{i18n:this.const(this.controller),key:this.const("graphing-calculator-text-export-braille-email-accessibility")},Ct.const("Feedback? Email"),Ct.const(" "),Ct.createElement("a",{class:Ct.const("dcg-blue-link"),href:Ct.const("mailto:accessibility@kiavash.com")},Ct.const("accessibility@kiavash.com")),Ct.const("."))))),Yve(()=>this.showDownloadButton,{true:()=>Ct.createElement("div",{class:Ct.const("dcg-export-button-actions")},Ct.createElement(Dg,{predicate:()=>this.isExportingBraille()&&!gc},()=>Ct.createElement(Sf,{buttonType:this.const("secondary"),data:()=>this.brailleBlob,enabled:()=>!this.imgDirty,filename:this.const("kiavash-equations.brl"),text:()=>this.controller.s("account-shell-button-download-braille"),triggerLogEvent:()=>co({category:"share",action:"download-equations",name:`${this.exportType} - ${this.size}`})})),Ct.createElement("div",{class:Ct.const("dcg-download-button-group")},Ct.createElement(Sf,{buttonType:this.const("primary"),data:()=>this.imageBlob,enabled:()=>!this.imgDirty,filename:()=>`kiavash-graph.${this.exportType==="svg"?"svg":"png"}`,text:()=>this.controller.s(this.exportType==="svg"?"account-shell-button-download-svg":"account-shell-button-download-png"),triggerLogEvent:()=>co({category:"share",action:"download-image",name:`${this.exportType} - ${this.size}`})}))),false:()=>Ct.createElement(Dg,{predicate:()=>!this.isExportingBraille()},()=>Ct.createElement("div",{class:Ct.const("dcg-download-not-enabled-notice")},Ct.createElement("h2",{class:Ct.const("dcg-title")},()=>this.controller.s("account-shell-heading-download-instructions")),()=>this.controller.s("account-shell-text-download-instructions")))}))))))}getSizeOptions(){return this.isExportingBraille()?[{id:"vpmax8",label:this.controller.s("graphing-calculator-label-braille-size-vpmax8")},{id:"vpmax11",label:this.controller.s("graphing-calculator-label-braille-size-vpmax11")},{id:"etc8",label:this.controller.s("graphing-calculator-label-braille-size-etc8")},{id:"etc11",label:this.controller.s("graphing-calculator-label-braille-size-etc11")}]:[{id:"small_square",label:this.controller.s("account-shell-label-export-size-small-square")},{id:"medium_square",label:this.controller.s("account-shell-label-export-size-medium-square")},{id:"large_square",label:this.controller.s("account-shell-label-export-size-large-square")},{id:"medium_rectangle",label:this.controller.s("account-shell-label-export-size-medium-rectangle")},{id:"large_rectangle",label:this.controller.s("account-shell-label-export-size-large-rectangle")}]}getExportOptions(){return[{id:"png",label:this.controller.s("graphing-calculator-label-png")},{id:"svg",label:this.controller.s("graphing-calculator-label-svg")},{id:"nemeth",label:this.controller.s("graphing-calculator-label-braille-nemeth")},{id:"ueb",label:this.controller.s("graphing-calculator-label-braille-ueb")}]}getLineThicknessOptions(){return[{key:"thin",label:()=>this.controller.s("account-shell-button-line-thin"),selected:()=>this.thickness==="thin",onSelect:()=>this.selectThickness("thin")},{key:"medium",label:()=>this.controller.s("account-shell-button-line-medium"),selected:()=>this.thickness==="medium",onSelect:()=>this.selectThickness("medium")},{key:"thick",label:()=>this.controller.s("account-shell-button-line-thick"),selected:()=>this.thickness==="thick",onSelect:()=>this.selectThickness("thick")}]}markImagesDirty(){this.imgDirty=!0}selectSize(e){this.size=e,this.markImagesDirty(),this.updateIfMounted()}setExportType(e){ZP(e)!==ZP(this.exportType)&&(this.size=ZP(e)?"vpmax8":"medium_square"),this.exportType=e,this.markImagesDirty(),this.updateIfMounted()}getZoom(){return this.controller.s("account-shell-label-zoom",{value:Math.min(100,Math.round(100*400/this.getWidth()))})}selectThickness(e){this.thickness=e,this.markImagesDirty(),this.updateIfMounted()}didMountGraphPreview(e){this.previewImg=e}getGridOpacity(){switch(this.thickness){case"thick":return 1;case"medium":return .6;case"thin":return .4;default:return this.thickness}}getAxisWeight(){switch(this.thickness){case"thick":return 2;case"medium":return 2;case"thin":return 1.5;default:return this.thickness}}getGraphThickness(){switch(this.thickness){case"thick":return 5;case"medium":return 3.5;case"thin":return 2.5;default:return this.thickness}}getLabelSize(){if(this.size==="small_square")switch(this.thickness){case"thick":return 14;case"medium":return 12;case"thin":return 10;default:return this.thickness}else switch(this.thickness){case"thick":return 20;case"medium":return 17;case"thin":return 14;default:return this.thickness}}getHeight(){return kg[this.size].height}getWidth(){return kg[this.size].width}updateIfMounted(){this._isMounted&&this.update()}getAsyncScreenshotOptions(){let e={axisLineWidth:this.getAxisWeight(),graphLineWidth:this.getGraphThickness(),majorAxisOpacity:this.getGridOpacity(),minorAxisOpacity:this.getGridOpacity()/2,pointLineWidth:this.getGraphThickness()*3,axisLineOffset:0,labelSize:this.getLabelSize()},t=this.controller.api._calc.grapher.getCurrentViewport(),i=this.controller.api._calc.grapher.settings.squareAxes?"preserveX":"stretch",n={left:t.xmin,right:t.xmax,top:t.ymax,bottom:t.ymin};switch(this.exportType){case"png":case"svg":return{width:this.getWidth(),height:this.getHeight(),mode:i,preserveAxisNumbers:!0,showLabels:!0,targetPixelRatio:2,format:this.exportType,settings:e,mathBounds:n};case"nemeth":case"ueb":return{braille:{embosserModel:this.size,brailleMode:this.exportType},mode:i,format:"png",mathBounds:n};default:let a=this.exportType;throw new Error(`Unexpected export type ${a}`)}}updateGraphPreview(){if(!this.imgDirty)return;let{exportType:e}=this;this.controller.api.asyncScreenshot(this.getAsyncScreenshotOptions(),t=>{this._isMounted&&typeof t=="string"&&this.exportType===e&&(e==="svg"?(this.imageBlob=Nre(t),this.previewDataURL=`data:image/svg+xml,${encodeURIComponent(t)}`):(this.previewDataURL=t,this.imageBlob=Fre(this.previewDataURL)),this.imgDirty=!1,this.loaded=!0,this.update(),this.resizePreviewImg())})}updateBrailleEquations(){if(this.isExportingBraille()){let e=sre(this.controller.api.controller,this.brailleMode);this.brailleBlob=new Blob([e],{type:"text/plain"})}}resizePreviewImg(){if(!this.previewImg)return;let e=1;(this.size==="etc8"||this.size==="etc11")&&(e=2),(this.size==="vpmax8"||this.size==="vpmax11")&&(e=1.5);let t=Math.min(this.getWidth(),400),i=this.getHeight()/this.getWidth()*t;this.previewImg.width=t*e,this.previewImg.height=i*e}willUpdate(){this.updateGraphPreview(),this.updateBrailleEquations()}isExportingBraille(){return ZP(this.exportType)}};function ZP(r){return r==="nemeth"||r==="ueb"}function Bre(r){switch(r){case"etc8":return"8.5 x 11.0";case"etc11":return"11.5 x 11.0";case"vpmax8":return"8.5 x 11";case"vpmax11":return"11.5 x 11";default:return r}}var ut=__dcg_shared_module_exports__['e'](Z());var Ure={i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-braille",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-nemeth-mode",standard:"<key>ALT</key> + <key>N</key>",apple:"<key>CTRL</key> + <key>N</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-ueb-mode",standard:"<key>ALT</key> + <key>U</key>",apple:"<key>CTRL</key> + <key>U</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-print-mode",standard:"<key>ALT</key> + <key>Q</key>",apple:"<key>CTRL</key> + <key>Q</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-braille-typing",standard:"<key>ALT</key> + <key>6</key>",apple:"<key>CTRL</key> + <key>6</key>"}]};var eO=function(r){let e={i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-expression-entry-and-navigation",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-expression",standard:"<key>UP ARROW</key>, <key>SHIFT</key> + <key>Tab</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-expression",standard:"<key>DOWN ARROW</key>, <key>Tab</key>"}]};return r.pageUpAndDown&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-previous-item",standard:"<key>PAGE UP</key>",apple:"<key>Fn</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-item",standard:"<key>PAGE DOWN</key>",apple:"<key>Fn</key> + <key>DOWN ARROW</key>"}),e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-remove-empty-expression",standard:"<key>Backspace</key>",apple:"<key>Delete</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-character",standard:"<key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-character",standard:"<key>RIGHT ARROW</key>"}),r.fractionNavigation&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-move-to-numerator",standard:"<key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-move-to-denominator",standard:"<key>DOWN ARROW</key>"}),e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-exit-block",standard:"<key>Tab</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-beginning-of-block",standard:"<key>Home</key>",apple:"<key>Fn</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-end-of-block",standard:"<key>End</key>",apple:"<key>Fn</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-beginning-of-expression",standard:"<key>CTRL</key> + <key>Home</key>",apple:"<key>CTRL</key> + <key>Fn</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-end-of-expression",standard:"<key>CTRL</key> + <key>End</key>",apple:"<key>CTRL</key> + <key>Fn</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-selection-left",standard:"<key>SHIFT</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-selection-right",standard:"<key>SHIFT</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-delete-selection",standard:"<key>Backspace</key>",apple:"<key>Delete</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-select-all",standard:"<key>CTRL</key> + <key>A</key>",apple:"<key>COMMAND</key> + <key>A</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-parent-block",standard:"<key>CTRL</key> + <key>ALT</key> + <key>UP ARROW</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-focused-block",standard:"<key>CTRL</key> + <key>ALT</key> + <key>DOWN ARROW</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-left-adjacent-block",standard:"<key>CTRL</key> + <key>ALT</key> + <key>LEFT ARROW</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-right-adjacent-block",standard:"<key>CTRL</key> + <key>ALT</key> + <key>RIGHT ARROW</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-selection",standard:"<key>CTRL</key> + <key>ALT</key> + <key>SHIFT</key> + <key>DOWN ARROW</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>SHIFT</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-answer",standard:"<key>CTRL</key> + <key>ALT</key> + <key>=</key>",apple:"<key>CTRL</key> + <key>Option</key> + <key>SHIFT</key> + <key>RIGHT ARROW</key>"}),r.decimalToFraction&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-show-answer-as-decimal-or-fraction",standard:"<key>ALT</key> + <key>SHIFT</key> + <key>A</key>",apple:"<key>COMMAND</key> + <key>SHIFT</key> + <key>A</key>"}),e};function gU(r){return{common:mU(r),tables:fU(r),sliders:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-sliders",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-decrease",standard:"<key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-decrease-larger",standard:"<key>PAGE DOWN</key>",apple:"<key>FN</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-increase",standard:"<key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-increase-larger",standard:"<key>PAGE UP</key>",apple:"<key>FN</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-minimum",standard:"<key>HOME</key>",apple:"<key>FN</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-maximum",standard:"<key>END</key>",apple:"<key>FN</key> + <key>RIGHT ARROW</key>"}]},audiotrace:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-audio-tracing",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-audio-trace",standard:"<key>ALT</key> + <key>T</key>",apple:"<key>OPTION</key> + <key>T</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-summarize-graph",standard:"<key>ALT</key> + <key>S</key>",apple:"<key>OPTION</key> + <key>S</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-describe-axes",standard:"<key>ALT</key> + <key>G</key>",apple:"<key>OPTION</key> + <key>G</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-point",standard:"<key>LEFT ARROW</key>, <key>UP ARROW</key>, <key>J</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-point",standard:"<key>RIGHT ARROW</key>, <key>DOWN ARROW</key>, <key>L</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-poi",standard:"<key>PAGE UP</key>, <key>SHIFT</key> + <key>TAB</key>, <key>K</key>",apple:"<key>FN</key> + <key>UP ARROW</key>, <key>SHIFT</key> + <key>TAB</key>, <key>K</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-poi",standard:"<key>PAGE DOWN</key>, <key>TAB</key>, <key>I</key>",apple:"<key>FN</key> + <key>DOWN ARROW</key>, <key>TAB</key>, <key>I</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-first-point",standard:"<key>HOME</key>, <key>U</key>",apple:"<key>FN</key> + <key>LEFT ARROW</key>, <key>U</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-last-point",standard:"<key>END</key> <key>N</key>",apple:"<key>FN</key> + <key>RIGHT ARROW</key> <key>N</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-poi-count",standard:"<key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-x",standard:"<key>X</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-y",standard:"<key>Y</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-color",standard:"<key>C</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-branch",standard:"<key>B</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-point-type",standard:"<key>T</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-move-to-origin",standard:"<key>O</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-curve",standard:"<key>ALT</key> + <key>UP ARROW</key>",apple:"<key>OPTION</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-curve",standard:"<key>ALT</key> + <key>DOWN ARROW</key>",apple:"<key>OPTION</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-hear-graph",standard:"<key>H</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-hear-specific-branch",standard:"<key>1</key> - <key>0</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-adjust-playback-speed",standard:"<key>ALT</key> + <key>1</key> - <key>5</key>",apple:"<key>OPTION</key> + <key>1</key> - <key>5</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-volume",standard:"<key>V</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-decrease-volume",standard:"<key>SHIFT</key> + <key>V</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-announce-slider-animations",standard:"<key>A</key>"}]},slidertrace:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-slider-trace",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-slider-trace",standard:"<key>S</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-decrease",standard:"<key>LEFT ARROW</key> <key>J</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-decrease-larger",standard:"<key>PAGE DOWN</key>",apple:"<key>FN</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-increase",standard:"<key>RIGHT ARROW</key> <key>L</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-increase-larger",standard:"<key>PAGE UP</key>",apple:"<key>FN</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-minimum",standard:"<key>HOME</key> <key>U</key>",apple:"<key>FN</key> + <key>LEFT ARROW</key> <key>U</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-maximum",standard:"<key>END</key> <key>N</key>",apple:"<key>FN</key> + <key>RIGHT ARROW</key> <key>N</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-next-slider",standard:"<key>DOWN ARROW</key>, <key>TAB</key>, <key>K</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-slider-trace-previous-slider",standard:"<key>UP ARROW</key>, <key>SHIFT</key> + <key>TAB</key>, <key>I</key>"}]},interactivepoints:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-interactive-points",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-focus-first-interactive-point",standard:"<key>CTRL</key> + <key>ALT</key> + <key>P</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-next-interactive-point",standard:"<key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-previous-interactive-point",standard:"<key>SHIFT</key> + <key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-x",standard:"<key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-decrease-x",standard:"<key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-y",standard:"<key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-decrease-y",standard:"<key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-x-larger",standard:"<key>SHIFT</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-decrease-x-larger",standard:"<key>SHIFT</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-increase-y-larger",standard:"<key>SHIFT</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-decrease-y-larger",standard:"<key>SHIFT</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-x",standard:"<key>X</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-y",standard:"<key>Y</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-label",standard:"<key>L</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-speak-color",standard:"<key>C</key>"}]},commonactions:UD({folders:!0,notes:!0,images:!0,authorFeatures:!1}),kiavashcomonly:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-kiavash-com-only",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-open-shortcuts-dialog",standard:"<key>CTRL</key> + <key>/</key>",apple:"<key>COMMAND</key> + <key>/</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-open-a-graph",standard:"<key>CTRL</key> + <key>O</key>",apple:"<key>COMMAND</key> + <key>O</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-save-a-graph",standard:"<key>CTRL</key> + <key>S</key>",apple:"<key>COMMAND</key> + <key>S</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-print-a-graph",standard:"<key>CTRL</key> + <key>P</key>",apple:"<key>COMMAND</key> + <key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-account-menu",standard:"<key>CTRL</key> + <key>ALT</key> + <key>A</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>A</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-help-menu",standard:"<key>CTRL</key> + <key>ALT</key> + <key>H</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>H</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-language-menu",standard:"<key>CTRL</key> + <key>ALT</key> + <key>L</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>L</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-share-menu",standard:"<key>CTRL</key> + <key>ALT</key> + <key>S</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>S</key>"}]},braille:Ure,mathquill:eO({decimalToFraction:!0,fractionNavigation:!0,pageUpAndDown:!0})}}function mU(r){let e={i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-common-symbols",shortcuts:[{latex:"a^b",standard:"<key>^</key> (<key>SHIFT</key> + <key>6</key>)"},{latex:"a_b",standard:"<key>_</key> (<key>SHIFT</key> + <key>-</key>)"},{latex:"\\le",standard:"<key><</key><key>=</key>"},{latex:"\\ge",standard:"<key>></key><key>=</key>"},{latex:"a'",standard:"<key>'</key>"},{latex:"\\frac{a}{b}",standard:"<key>f</key><key>r</key><key>a</key><key>c</key>"},{latex:"\\sqrt{a}",standard:"<key>s</key><key>q</key><key>r</key><key>t</key>"},{latex:"\\sqrt[3]{a}",standard:"<key>c</key><key>b</key><key>r</key><key>t</key>"},{latex:"\\sqrt[n]{a}",standard:"<key>n</key><key>t</key><key>h</key><key>r</key><key>o</key><key>o</key><key>t</key>"},{latex:"\\sum_{n=a}^b",standard:"<key>s</key><key>u</key><key>m</key>"}]};return e.shortcuts.push({latex:"\\int_a^b",standard:r.isGeometry?"<key>i</key><key>n</key><key>t</key><key>e</key><key>g</key><key>r</key><key>a</key><key>l</key>":"<key>i</key><key>n</key><key>t</key>"}),e.shortcuts=e.shortcuts.concat([{latex:"\\prod_{n=a}^b",standard:"<key>p</key><key>r</key><key>o</key><key>d</key>"},{latex:"\\pi",standard:"<key>p</key><key>i</key>"},{latex:"\\theta",standard:"<key>t</key><key>h</key><key>e</key><key>t</key><key>a</key>"},{latex:"\\to",standard:"<key>-</key><key>></key>"}]),e}function UD(r){let e={i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-common-actions",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-close-a-dialog",standard:"<key>ESC</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-show-or-hide-expression-list",standard:"<key>SHIFT</key> + <key>ALT</key> + <key>E</key>",apple:"<key>SHIFT</key> + <key>COMMAND</key> + <key>E</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-focus-expression-list",standard:"<key>CTRL</key> + <key>ALT</key> + <key>E</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>E</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-open-expression-options",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>O</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-show-or-hide-expression",standard:"<key>SHIFT</key> + <key>ALT</key> + <key>H</key>",apple:"<key>SHIFT</key> + <key>COMMAND</key> + <key>H</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-delete-expression",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>D</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-degrees-toggle",standard:"<key>ALT</key> + <key>D</key>",apple:"<key>CTRL</key> + <key>D</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-keypad-toggle",standard:"<key>ALT</key> + <key>K</key>",apple:"<key>CTRL</key> + <key>K</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-mute-toggle",standard:"<key>ALT</key> + <key>M</key>",apple:"<key>CTRL</key> + <key>M</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-add-expression",standard:"<key>CTRL</key> + <key>ALT</key> + <key>X</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>X</key>"}]};return r.notes&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-add-note",standard:"<key>CTRL</key> + <key>ALT</key> + <key>O</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>O</key>"}),r.folders&&(e.shortcuts=e.shortcuts.concat([{i18nKey:"shared-calculator-text-keyboard-shortcut-add-folder",standard:"<key>CTRL</key> + <key>ALT</key> + <key>F</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>F</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-collapse-folder",standard:"<key>ALT</key> + <key>UP ARROW</key>",apple:"<key>COMMAND</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-expand-folder",standard:"<key>ALT</key> + <key>DOWN ARROW</key>",apple:"<key>COMMAND</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-collapse-all-folders",standard:"<key>ALT</key> + <key>SHIFT</key> + <key>UP ARROW</key>",apple:"<key>COMMAND</key> + <key>SHIFT</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-expand-all-folders",standard:"<key>ALT</key> + <key>SHIFT</key> + <key>DOWN ARROW</key>",apple:"<key>COMMAND</key> + <key>SHIFT</key> + <key>DOWN ARROW</key>"}])),r.images&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-add-image",standard:"<key>CTRL</key> + <key>ALT</key> + <key>I</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>I</key>"}),e.shortcuts=e.shortcuts.concat([{i18nKey:"shared-calculator-text-keyboard-shortcut-add-table",standard:"<key>CTRL</key> + <key>ALT</key> + <key>T</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>T</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-undo",standard:"<key>CTRL</key> + <key>Z</key>",apple:"<key>COMMAND</key> + <key>Z</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-redo",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>Z</key>",apple:"<key>COMMAND</key> + <key>SHIFT</key> + <key>Z</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-zoom-in",standard:"<key>ALT</key> + <key>+</key>",apple:"<key>CTRL</key> + <key>+</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-zoom-out",standard:"<key>ALT</key> + <key>-</key>",apple:"<key>CTRL</key> + <key>-</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-zoom-restore-default",standard:"<key>ALT</key> + <key>0</key>",apple:"<key>CTRL</key> + <key>0</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-zoom-fit",standard:"<key>SHIFT</key> + <key>ALT</key> + <key>Z</key>",apple:"<key>SHIFT</key> + <key>OPTION</key> + <key>Z</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-pan-graph",i18nStandard:"shared-calculator-text-keyboard-shortcut-rotate-3d-cube-command"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-edit-list-mode",standard:"<key>CTRL</key> + <key>ALT</key> + <key>D</key>",apple:"<key>CTRL</key> + <key>OPTION</key> + <key>D</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-graph-settings-menu",standard:"<key>CTRL</key> + <key>ALT</key> + <key>G</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>G</key>"}]),r.authorFeatures&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-toggle-author-mode",standard:"<key>ALT</key> + <key>SHIFT</key> + <key>O</key>",apple:"<key>COMMAND</key> + <key>SHIFT</key> + <key>O</key>"}),e}function fU(r){let e={i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-tables",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-table-previous-cell",standard:"<key>SHIFT</key> + <key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-next-cell",standard:"<key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-previous-row",standard:"<key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-next-row",standard:"<key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-previous-column",standard:"<key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-next-column",standard:"<key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-first-row",standard:"<key>CTRL</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-last-row",standard:"<key>CTRL</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-first-column",standard:"<key>CTRL</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-last-column",standard:"<key>CTRL</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-table-speak-column-header",standard:"<key>CTRL</key> + <key>H</key>"}]};return r.tableRegressions&&e.shortcuts.push({i18nKey:"shared-calculator-text-keyboard-shortcut-add-table-regression",standard:"<key>CTRL</key> + <key>ALT</key> + <key>R</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>R</key>"}),e}var _g=gU({isGeometry:!1,tableRegressions:!0});var{audiotrace:A0t,slidertrace:V0t,interactivepoints:L0t,...Xve}=JSON.parse(JSON.stringify(_g));Xve.commonactions=bU({folders:!0,notes:!0,images:!0,authorFeatures:!1});function bU(r){let e=UD(r);e.shortcuts.unshift({i18nKey:"shared-calculator-text-keyboard-shortcut-focus-graph-paper",standard:"<key>CTRL</key> + <key>ALT</key> + <key>P</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-rotate-3d-cube",i18nStandard:"shared-calculator-text-keyboard-shortcut-rotate-3d-cube-command"},{i18nKey:"shared-calculator-text-keyboard-shortcut-spin-3d-cube",i18nStandard:"shared-calculator-text-keyboard-shortcut-spin-3d-cube-command"},{i18nKey:"shared-calculator-text-keyboard-shortcut-switch-pane-in-3d-quest",standard:"<key>F6</key>"});for(let t=e.shortcuts.length-1;t>=0;t--)e.shortcuts[t].i18nKey==="shared-calculator-text-keyboard-shortcut-pan-graph"&&e.shortcuts.splice(t,1);return e}var qD={toolSelection:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-geometry-tool-selection",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-focus-toolbar",standard:"<key>CTRL</key> + <key>ALT</key> + <key>M</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>M</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-between-toolbar-categories",standard:"<key>LEFT ARROW</key>, <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-between-toolbar-dropdown-items",standard:"<key>UP ARROW</key>, <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-choose-toolbar-item-and-focus-graph",standard:"<key>ENTER</key>",apple:"<key>RETURN</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-cancel-active-tool",standard:"<key>ESC</key>"}]},graphNavigation:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-geometry-graph-navigation-during-construction",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-focus-graph-paper",standard:"<key>CTRL</key> + <key>ALT</key> + <key>P</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-navigate-graph",standard:"<key>UP ARROW</key>, <key>DOWN ARROW</key>, <key>LEFT ARROW</key>, <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-to-top-of-graph",standard:"<key>CTRL</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-to-bottom-of-graph",standard:"<key>CTRL</key> + <key>DOWN ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-to-left-of-graph",standard:"<key>CTRL</key> + <key>LEFT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-to-right-of-graph",standard:"<key>CTRL</key> + <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-next-object",standard:"<key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-previous-object",standard:"<key>SHIFT</key> + <key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-describe-object",standard:"<key>D</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-repeat-active-tool-prompt",standard:"<key>?</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-tool-by-number",standard:"<key>1</key>, <key>2</key>, <key>3</key>, ..., <key>6</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-next-category",standard:"<key>=</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-previous-category",standard:"<key>-</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-next-tool-within-category",standard:"<key>]</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-previous-tool-within-category",standard:"<key>[</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-add-object-to-selection",standard:"<key>ENTER</key>",apple:"<key>RETURN</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-drag-movable-objects",standard:"<key>UP ARROW</key>, <key>DOWN ARROW</key>, <key>LEFT ARROW</key>, <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-delete-selected-objects",standard:"<key>DELETE</key>, <key>BACKSPACE</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-focus-selected-objects-toolbar",standard:"<key>CTRL</key> + <key>ALT</key> + <key>M</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>M</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-open-options",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>O</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-open-transformation-options",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>A</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-deselect-all-objects",standard:"<key>ESC</key>"}]},expressionEdit:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-geometry-expression-edit",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-focus-graph-paper",standard:"<key>CTRL</key> + <key>ALT</key> + <key>P</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>P</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-navigate-graph",standard:"<key>UP ARROW</key>, <key>DOWN ARROW</key>, <key>LEFT ARROW</key>, <key>RIGHT ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-to-top-of-graph",standard:"<key>CTRL</key> + <key>UP ARROW</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-expression-edit-next-object",standard:"<key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-expression-edit-previous-object",standard:"<key>SHIFT</key> + <key>TAB</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-expression-edit-add-object",standard:"<key>ENTER</key>",apple:"<key>RETURN</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-expression-edit-complete",standard:"<key>ENTER</key>",apple:"<key>RETURN</key>"}]},tokenNavigator:{i18nSectionKey:"shared-calculator-heading-keyboard-shortcuts-geometry-token-navigator",shortcuts:[{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-open-token-navigator",standard:"<key>CTRL</key> + <key>ALT</key> + <key>C</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>C</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-close-token-navigator",standard:"<key>ESC</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-navigate-tokens-at-current-level",standard:"<key>LEFT ARROW</key>, <key>RIGHT ARROW</key"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-navigate-object-levels",standard:"<key>UP ARROW</key>, <key>DOWN ARROW</key"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-move-token-between-expression-list-and-navigator",standard:"<key>ALT</key> + <key>SHIFT</key> + <key>T</key>",apple:"<key>OPTION</key> + <key>SHIFT</key> + <key>T</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-select-single-object-token",standard:"<key>ENTER</key>",apple:"<key>RETURN</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-add-object-token-to-selection",standard:"<key>SHIFT</key> + <key>ENTER</key>",apple:"<key>SHIFT</key> + <key>RETURN</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-delete-selected-objects",standard:"<key>DELETE</key>, <key>BACKSPACE</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-focus-selected-objects-toolbar",standard:"<key>CTRL</key> + <key>ALT</key> + <key>M</key>",apple:"<key>CTRL</key> + <key>COMMAND</key> + <key>M</key>"},{i18nKey:"shared-calculator-text-keyboard-shortcut-geometry-open-options",standard:"<key>CTRL</key> + <key>SHIFT</key> + <key>O</key>"}]},...gU({isGeometry:!0,tableRegressions:!0})};var As=__dcg_shared_module_exports__['e'](Z());var{For:yU,If:Jve}=As.Components,Vs=class extends As.Class{template(){return As.createElement("table",{class:As.const("dcg-shortcuts-table")},As.createElement("tr",null,As.createElement(yU,{each:this.bindFn(this.getCols)},e=>As.createElement("th",null,()=>this.getHeader(e)))),As.createElement("tbody",null,As.createElement(yU,{each:()=>__dcg_shared_module_exports__['G'](this.props.section().shortcuts)},e=>As.createElement("tr",null,As.createElement(yU,{each:this.bindFn(this.getCols)},t=>As.createElement("td",{didMount:o=>this.populateContent(o,e,t)},As.createElement(Jve,{predicate:()=>!!this.getLatex(e)},()=>As.createElement(Et,{latex:()=>this.getLatex(e),config:this.const({})}))))))))}getLatex(e){return this.props.section().shortcuts[e].latex||""}populateContent(e,t,o){let i=this.props.section().shortcuts[t];switch(o){case"heading":if(i.latex)return;i.i18nKey&&(e.innerHTML=this.props.controller().s(i.i18nKey));return;case"windows":i.i18nStandard?e.innerHTML=this.replaceKey(this.props.controller().s(i.i18nStandard)):e.innerHTML=this.replaceKey(i.standard||"");return;case"mac":i.i18nApple?e.innerHTML=this.replaceKey(this.props.controller().s(i.i18nApple)):i.i18nStandard?e.innerHTML=this.replaceKey(this.props.controller().s(i.i18nStandard)):e.innerHTML=this.replaceKey(i.apple||i.standard||"");return}}getHeader(e){let t=this.props.controller().s;switch(e){case"heading":return t("shared-calculator-heading-function-table-column-header");case"windows":return t("shared-calculator-heading-windows-chrome-table-column-header");case"mac":return t("shared-calculator-heading-mac-table-column-header")}}getCols(){return this.props.os?this.props.os()==="windows"?["heading","windows"]:["heading","mac"]:["heading","windows","mac"]}replaceKey(e){return e.replace(/\<key\>/g,"<span class='dcg-key-command'>").replace(/\<\/key\>/g,"</span>")}};var{If:Sl}=ut.Components,tO=class extends ut.Class{init(){this.controller=this.props.controller(),this.controller.state.hotkeysDialog==null&&(this.controller.state.hotkeysDialog={shortcutOS:qo?"mac":"windows"})}showGeoShortcuts(){return this.controller.product==="geometry-calculator"}show3dShortcuts(){return this.controller.product==="graphing-3d"}areTableRegressionsEnabled(){var e;return!!((e=this.controller.getApiConfig())!=null&&e.tableRegressions)}template(){return ut.createElement("div",{class:ut.const("modal_section dcg-hotkeys-dialog")},ut.createElement("div",{id:ut.const("dcg-hotkeys-dialog")},ut.createElement("h1",null,()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts")),ut.createElement("div",{class:ut.const("dcg-hotkeys-toggle-container")},ut.createElement(Po,{staticConfig:this.bindFn(this.getOSOptions),ariaGroupLabel:()=>this.controller.s("shared-calculator-label-os")})),ut.createElement("div",{class:ut.const("dcg-hotkey-container")},ut.createElement("div",{class:ut.const("dcg-hotkey-section")},ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-geometry-tool-selection"))),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(qD.toolSelection),os:this.bindFn(this.getShortcutOS)})),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-geometry-expression-edit"))),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(qD.expressionEdit),os:this.bindFn(this.getShortcutOS)})),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-geometry-token-navigator"))),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(qD.tokenNavigator),os:this.bindFn(this.getShortcutOS)})),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-common-actions")),ut.createElement(Sl,{predicate:this.bindFn(this.show3dShortcuts)},()=>ut.createElement(Vs,{controller:this.props.controller,section:()=>{var e;return bU({folders:!0,notes:!0,images:!0,authorFeatures:!!((e=this.controller.getApiConfig())!=null&&e.authorFeatures)})},os:this.bindFn(this.getShortcutOS)})),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement(Vs,{controller:this.props.controller,section:()=>{var e;return UD({folders:!0,notes:!0,images:!0,authorFeatures:!!((e=this.controller.getApiConfig())!=null&&e.authorFeatures)})},os:this.bindFn(this.getShortcutOS)})),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-kiavash-com-only")),ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.kiavashcomonly),os:this.bindFn(this.getShortcutOS)}),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-expression-entry-and-navigation")),ut.createElement(Vs,{controller:this.props.controller,section:()=>eO({decimalToFraction:this.controller.isDecimalToFractionEnabled(),fractionNavigation:!0,pageUpAndDown:!0}),os:this.bindFn(this.getShortcutOS)}),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-interactive-points"))),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.interactivepoints),os:this.bindFn(this.getShortcutOS)}))),ut.createElement("div",{class:ut.const("dcg-hotkey-section")},ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-text-keyboard-shortcut-geometry-navigate-graph"))),ut.createElement(Sl,{predicate:this.bindFn(this.showGeoShortcuts)},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(qD.graphNavigation),os:this.bindFn(this.getShortcutOS)})),ut.createElement(vr,{key:this.const("shared-calculator-heading-keyboard-shortcuts-symbols-and-supported-functions"),i18n:this.const(this.controller)},ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},ut.const("Common Symbols and"),ut.const(" "),ut.createElement("a",{href:ut.const("https://help.kiavash.com/hc/en-us/articles/212235786-Supported-Functions"),target:ut.const("_blank")},ut.const("Supported Functions")))),ut.createElement(Vs,{controller:this.props.controller,section:()=>mU({isGeometry:this.showGeoShortcuts(),tableRegressions:this.areTableRegressionsEnabled()}),os:this.bindFn(this.getShortcutOS)}),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-audio-tracing"))),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.audiotrace),os:this.bindFn(this.getShortcutOS)})),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-slider-trace"))),ut.createElement(Sl,{predicate:()=>!this.show3dShortcuts()},()=>ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.slidertrace),os:this.bindFn(this.getShortcutOS)})),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header tables-section")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-sliders")),ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.sliders),os:this.bindFn(this.getShortcutOS)}),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header tables-section")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-tables")),ut.createElement(Vs,{controller:this.props.controller,section:()=>fU({isGeometry:this.showGeoShortcuts(),tableRegressions:this.areTableRegressionsEnabled()}),os:this.bindFn(this.getShortcutOS)}),ut.createElement("h2",{class:ut.const("dcg-hotkey-section-header")},()=>this.controller.s("shared-calculator-heading-keyboard-shortcuts-braille")),ut.createElement(Vs,{controller:this.props.controller,section:this.const(_g.braille),os:this.bindFn(this.getShortcutOS)})))))}getOSOptions(){return[{key:"windows",label:()=>this.controller.s("shared-calculator-button-windows-chrome"),selected:()=>this.getShortcutOS()==="windows",onSelect:()=>this.setShortcutOS("windows")},{key:"mac",label:()=>this.controller.s("shared-calculator-button-mac"),selected:()=>this.getShortcutOS()==="mac",onSelect:()=>this.setShortcutOS("mac")}]}getShortcutOS(){return this.controller.state.hotkeysDialog.shortcutOS}setShortcutOS(e){this.controller.state.hotkeysDialog.shortcutOS=e,this._isMounted&&this.update()}didMount(){this.updateVisibleShortcuts()}didUpdate(){this.updateVisibleShortcuts()}updateVisibleShortcuts(){let e=this.getShortcutOS(),t=document.querySelector(".dcg-os-mac"),o=document.querySelector(".dcg-os-windows");!t||!o||(e==="mac"?(t.style.display="block",o.style.display="none"):e==="windows"&&(t.style.display="none",o.style.display="block"))}};var Yo=__dcg_shared_module_exports__['e'](Z());$t();var{Input:Qve,Checkbox:Zve,If:e1e}=Yo.Components,q1=class extends Yo.Class{init(){this.controller=this.props.controller(),this.graphsController=this.controller.graphsController,this.lastSavedTitle=this.graphsController.getCurrentGraphTitle(),this.controller.getOpenModal()==="duplicate"?this.newSaveTitle=this.controller.s("account-shell-text-copy-of-title",{originalTitle:this.lastSavedTitle}):this.newSaveTitle=this.lastSavedTitle||this.graphsController.getUntitledString(),this.controller.state.saveDialog==null&&(this.controller.state.saveDialog={copyOnSave:!0})}template(){return Yo.createElement("div",{class:Yo.const("modal_section")},Yo.createElement("div",{id:Yo.const("save-dialog")},Yo.createElement("h1",null,()=>this.getTitle()),Yo.createElement("div",{class:Yo.const("dcg-clear")}),Yo.createElement("form",{didMount:this.bindFn(this.didMountForm)},Yo.createElement("label",{class:Yo.const("input-label")},Yo.createElement("div",{class:Yo.const("graph-title-title")},()=>this.controller.s("account-shell-label-graph-title"),Yo.const("\xA0")),Yo.createElement(Qve,{class:Yo.const("title-input dcg-input-blue-outline"),name:Yo.const("title"),placeholder:()=>this.graphsController.getUntitledString(),value:()=>this.newSaveTitle,maxLength:Yo.const("140"),onInput:e=>this.newSaveTitle=e,didMount:e=>re(e).trigger("focus").trigger("select")})),Yo.createElement("div",null,Yo.createElement("button",{type:Yo.const("submit"),class:Yo.const("dcg-btn dcg-btn-blue pull-right dcg-action-save")},()=>this.controller.s("account-shell-button-save")),Yo.createElement(e1e,{predicate:()=>this.shouldShowDuplicateOption()&&this.graphsController.wasCurrentGraphEverSaved()},()=>Yo.createElement("label",{class:Yo.const("dcg-new-copy pull-right")},Yo.createElement(Zve,{checked:()=>this.controller.state.saveDialog.copyOnSave,onChange:e=>{if(this.controller.state.saveDialog.copyOnSave=e,this._isMounted)return this.update()}}),Yo.createElement("span",{class:Yo.const("duplicate-label")},()=>this.getDuplicateLabel())))))))}didMountForm(e){re(e).on("submit",t=>{t.preventDefault(),this.newSaveTitle===""&&(this.newSaveTitle="Untitled Graph");let o;this.shouldShowDuplicateOption()?o=this.controller.state.saveDialog.copyOnSave:o=this.controller.getOpenModal()!=="rename",this.controller.dispatch({type:"save-graph",payload:{title:this.newSaveTitle,saveAs:o},device:"mouse"})})}getTitle(){if(this.graphsController.isLegacyGeometryTool())return this.controller.s("account-shell-heading-save-construction");switch(this.controller.getOpenModal()){case"rename":return this.graphsController.isNewGeometryTool()?this.controller.s("account-shell-heading-rename-construction"):this.controller.s("account-shell-heading-rename-graph");case"save":return this.graphsController.isNewGeometryTool()?this.controller.s("account-shell-heading-save-construction"):this.controller.s("account-shell-heading-save-graph");case"duplicate":return this.graphsController.isNewGeometryTool()?this.controller.s("account-shell-heading-duplicate-construction"):this.controller.s("account-shell-heading-duplicate-graph");default:return""}}getDuplicateLabel(){return this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-heading-duplicate-construction"):this.controller.s("account-shell-heading-duplicate-graph")}shouldShowDuplicateOption(){if(this.graphsController.isLegacyGeometryTool())return!0;let e=this.controller.getModalState();return!!(e.modal==="save"&&e.fromSaveInProgress)}};var un=__dcg_shared_module_exports__['e'](Z()),rO=class extends un.Class{init(){this.controller=this.props.controller()}template(){return un.createElement("div",{class:un.const("modal_section")},un.createElement("div",{id:un.const("unsupported-browser")},un.createElement("div",{id:un.const("unsupported-browser-title"),style:un.const("color:black; font-size:150%;")},()=>this.controller.s("account-shell-heading-unsupported-browser")),un.createElement("div",{style:un.const("padding:20px 0px; color:#666")},()=>this.controller.s("account-shell-text-unsupported-browser-android"),un.createElement("br",null),un.createElement("br",null),un.createElement("a",{href:un.const("https://play.google.com/store/apps/details?id=com.android.chrome")},()=>this.controller.s("account-shell-link-download-chrome"),un.createElement("br",null),un.createElement("br",null)),un.createElement("div",{style:un.const("text-align: center; margin-top: 25px; margin-bottom:-16px")},un.createElement("a",{role:un.const("link"),tabIndex:un.const("0"),class:un.const("dcg-btn dcg-action-hide dcg-do-not-blur"),onTap:()=>this.controller.dispatch({type:"close-modal"})},()=>this.controller.s("account-shell-button-hide-browser-warning"))))))}};var{SwitchUnion:t1e}=lr.Components,oO=class extends lr.Class{init(){this.controller=this.props.controller()}template(){return t1e("modal",()=>this.controller.getModalState())({save:()=>lr.createElement(ky,{controller:this.props.controller},lr.createElement(q1,{controller:this.props.controller})),rename:()=>lr.createElement(ky,{controller:this.props.controller},lr.createElement(q1,{controller:this.props.controller})),duplicate:()=>lr.createElement(ky,{controller:this.props.controller},lr.createElement(q1,{controller:this.props.controller})),"export-image":()=>lr.createElement(BD,{controller:this.props.controller}),authentication:()=>lr.createElement(jP,{controller:this.props.controller}),"recover-password":()=>lr.createElement(zP,{controller:this.props.controller}),hotkeys:()=>lr.createElement(ky,{controller:this.props.controller},lr.createElement(tO,{controller:this.props.controller}),lr.const(";")),"unsupported-browser":()=>lr.createElement(ky,{controller:this.props.controller},lr.createElement(rO,{controller:this.props.controller})),"account-settings":e=>lr.createElement(BP,{controller:this.props.controller,extraTabs:this.bindFn(this.getAccountSettingsExtraTabs),initialTab:()=>e().initialTab}),"change-email":()=>lr.createElement(UP,{controller:this.props.controller}),"account-reenabled":()=>lr.createElement(AP,{controller:this.props.controller}),"contest-submission":e=>lr.createElement(kn,{title:()=>"",size:this.const("wide"),showX:this.const(!0),onClose:()=>this.controller.dispatch({type:"close-modal"}),i18n:this.props.controller},lr.createElement(ND,{shellController:this.props.controller,currentSubmission:()=>e().currentSubmission})),"my-graphs":()=>lr.createElement(YP,{controller:this.props.controller}),none:()=>lr.createElement("div",null)})}getAccountSettingsExtraTabs(){return{tabs:[{key:"advanced",wideLabel:()=>this.props.controller().s("account-shell-label-advanced-preferences"),narrowLabel:()=>this.props.controller().s("account-shell-label-advanced-preferences"),class:"advanced"}],createView:e=>e?e=="advanced"?lr.createElement(JP,{controller:this.props.controller}):e:lr.createElement("span",null)}}},ky=class extends lr.Class{init(){this.controller=this.props.controller()}template(){return lr.createElement("div",{role:lr.const("dialog"),class:()=>({"dcg-modal-container":!0,"dcg-wide-modal":this.controller.getOpenModal()==="hotkeys","dcg-fixed-width-height":this.shouldBeFixedWidthHeight(),"dcg-export-modal":this.controller.getOpenModal()==="export-image"})},lr.createElement("div",{class:lr.const("dcg-modal-background"),onTap:()=>this.controller.dispatch({type:"close-modal"})}),lr.createElement("div",{class:lr.const("modal dcg-state-modals")},lr.createElement("span",{role:lr.const("link"),tabIndex:lr.const(0),"aria-label":lr.const("Close Dialog"),class:lr.const("action-close-modal close-modal internal-close"),onTap:()=>this.controller.dispatch({type:"close-modal"}),didMount:e=>{if(this.controller.getOpenModal()==="hotkeys")return e.focus()}},lr.createElement("i",{class:lr.const("dcg-icon-remove"),"aria-hidden":lr.const("true")})),this.props.children),lr.createElement("span",{role:lr.const("link"),tabIndex:lr.const(0),onTap:()=>this.controller.dispatch({type:"close-modal"}),"aria-label":lr.const("Close Dialog"),class:lr.const("action-close-modal close-modal external-close")},lr.createElement("i",{class:lr.const("dcg-icon-remove"),"aria-hidden":lr.const("true")})))}shouldBeFixedWidthHeight(){let e=this.controller.getOpenModal();return e==="export-image"||e==="contest-submission"}};var H1=__dcg_shared_module_exports__['e'](Z());$t();var gO=__dcg_shared_module_exports__['e'](Z());var Ie=__dcg_shared_module_exports__['e'](Z());$t();var Zs=__dcg_shared_module_exports__['e'](Z()),iO=class extends Zs.Class{init(){this.controller=this.props.controller()}template(){return Zs.createElement("div",{class:Zs.const("dcg-account-reminder")},Zs.createElement("span",{class:Zs.const("dcg-login")},Zs.createElement("a",{role:Zs.const("link"),tabIndex:Zs.const(0),class:Zs.const("dcg-sign-in dcg-action-login dcg-btn-white-outline"),onTap:this.props.onSignIn},()=>this.props.controller().s("account-shell-button-log-in")),()=>this.props.controller().s("account-shell-text-or"),Zs.createElement("a",{role:Zs.const("link"),tabIndex:Zs.const(0),class:Zs.const("dcg-create-account dcg-btn dcg-btn-blue dcg-tool-color dcg-action-createaccount"),onTap:this.props.onCreateAccount},()=>this.props.controller().s("account-shell-button-sign-up"))),Zs.createElement("div",null,()=>this.getToSaveYourText()))}getToSaveYourText(){return this.controller.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-to-save-constructions"):this.controller.s("account-shell-text-mygraphs-to-save-graphs")}};var Ls=__dcg_shared_module_exports__['e'](Z());var Fo=__dcg_shared_module_exports__['e'](Z()),{If:nO,IfElse:r1e}=Fo.Components,aO=class extends Fo.Class{shouldShowSaveButton(){return!this.props.isSaving()&&!this.props.didSaveRecentlySucceed()&&!this.props.didSaveRecentlyFail()}template(){return Fo.createElement("div",{class:Fo.const("save-btn-container")},Fo.createElement(nO,{predicate:()=>this.shouldShowSaveButton()},()=>Fo.createElement("div",{role:Fo.const("button"),onTap:this.props.onTap,class:()=>({"dcg-action-save":!0,"dcg-btn-blue":this.props.enabled(),"dcg-disabled":!this.props.enabled()}),"aria-disabled":()=>!this.props.enabled(),tabIndex:()=>this.props.enabled()?0:-1},r1e(()=>!this.props.isSyncing()&&this.props.willSaveCopy(),{true:()=>Fo.createElement("span",null,()=>this.props.s("account-shell-button-save-copy")),false:()=>Fo.createElement("span",null,()=>this.props.s("account-shell-button-mygraphs-save"))}))),Fo.createElement(nO,{predicate:this.props.isSaving},()=>Fo.createElement("div",{class:Fo.const("save-saving")},Fo.createElement("span",{class:Fo.const("dcg-spinner-dark")}))),Fo.createElement(nO,{predicate:this.props.didSaveRecentlyFail},()=>Fo.createElement("div",{class:Fo.const("save-error"),"aria-live":Fo.const("assertive"),"aria-atomic":Fo.const("true")},Fo.createElement("i",{class:Fo.const("dcg-icon-remove"),"aria-hidden":Fo.const("true")}),Fo.const(" "),()=>this.props.s("account-shell-text-error"))),Fo.createElement(nO,{predicate:this.props.didSaveRecentlySucceed},()=>Fo.createElement("div",{class:Fo.const("save-success")},Fo.createElement("i",{class:Fo.const("dcg-icon-check"),"aria-hidden":Fo.const("true")}),Fo.const(" "),()=>this.props.s("account-shell-text-saved"))))}};var sO=class extends Ls.Class{template(){return Ls.createElement("div",{class:Ls.const("graph-link-container graph-in-progress")},Ls.createElement("div",{role:Ls.const("link"),"aria-label":()=>this.props.s("account-shell-button-mygraphs-save"),class:Ls.const("graph-link dcg-action-preview-graph"),onTap:this.props.openSaveDialog},Ls.createElement("span",{class:Ls.const("dcg-thumb"),style:()=>({"background-image":`url(${this.props.getThumbnail()})`})}),Ls.createElement("div",{class:Ls.const("dcg-graph-details")},Ls.createElement("div",{class:Ls.const("dcg-title")},this.props.getTitle),Ls.createElement("div",{class:Ls.const("dcg-subtitle dcg-save-status")},()=>this.props.isSaveEnabled()?this.props.wasCurrentGraphEverSaved()?this.props.s("account-shell-label-mygraphs-last-saved",{date:this.props.getDisplayDate()}):this.props.s("account-shell-label-mygraphs-unsaved-graph"):this.props.s("account-shell-label-mygraphs-no-unsaved-changes"))),Ls.createElement(aO,{enabled:this.props.isSaveEnabled,isSaving:this.props.isSaving,didSaveRecentlySucceed:this.props.didSaveRecentlySucceed,didSaveRecentlyFail:this.props.didSaveRecentlyFail,isSyncing:this.props.isSyncing,willSaveCopy:this.props.willSaveCopy,onTap:()=>{},s:this.props.s})))}shouldUpdate(){return this.props.isOpen()}};var er=__dcg_shared_module_exports__['e'](Z());$t();var{If:zD}=er.Components,z1=class extends er.Class{template(){return er.createElement("div",{role:er.const("listitem"),class:()=>({"saved-graph":!0,"graph-link-container":!0,"dcg-selected":this.props.isSelected()}),onTap:e=>{e.wasHandled()||this.props.onTap(e)}},er.createElement(zD,{predicate:()=>!this.props.isDeletingGraph()&&!this.props.didDeleteGraphFail()},()=>er.createElement("div",{role:er.const("link"),tabIndex:er.const(0),class:()=>({"graph-link":!0,"dcg-action-preview-graph":!0,"example-graph":this.props.isExample()}),didMount:this.bindFn(this.didMount)},er.createElement("span",{class:er.const("dcg-thumb"),style:this.const({"background-image":`url(${this.props.getThumbURL()})`})}),er.createElement("div",{class:er.const("dcg-graph-details")},er.createElement("div",{class:er.const("dcg-title")},this.props.getTitle),er.createElement("div",{class:er.const("dcg-subtitle dcg-graph-date")},()=>this.props.isExample()?this.props.controller().s("account-shell-label-mygraphs-example"):this.props.getDisplayDate())))),er.createElement(zD,{predicate:this.props.isDeletingGraph},()=>er.createElement("div",{"aria-live":er.const("assertive"),"aria-atomic":er.const("true"),class:er.const("deleting"),handleEvent:er.const("true"),onTap:()=>{this.props.canCancelDelete()&&this.props.cancelDeleteGraph()}},()=>this.props.controller().s("account-shell-text-mygraphs-deleting"),er.createElement(zD,{predicate:this.props.canCancelDelete},()=>er.createElement("div",{role:er.const("button"),tabIndex:er.const(0),class:er.const("cancel-delete")},()=>this.props.controller().s("account-shell-button-mygraphs-cancel"))))),er.createElement(zD,{predicate:this.props.didDeleteGraphFail},()=>er.createElement("div",{"aria-live":er.const("assertive"),"aria-atomic":er.const("true"),class:er.const("retry-delete"),handleEvent:er.const("true")},()=>this.props.controller().s("account-shell-error-mygraphs-error-deleting"),er.createElement("a",{role:er.const("button"),tabIndex:er.const(0),class:er.const("dcg-action-removegraph"),onTap:this.props.requestDeleteGraph},()=>this.props.controller().s("account-shell-button-mygraphs-try-again")),()=>this.props.controller().s("account-shell-text-mygraphs-or"),er.createElement("a",{role:er.const("button"),tabIndex:er.const(0),class:er.const("dcg-action-cancelremovegraph"),onTap:this.props.cancelDeleteGraph},()=>this.props.controller().s("account-shell-button-mygraphs-cancel")))),er.createElement(zD,{predicate:()=>!this.props.isExample()&&!this.props.isDeletingGraph()&&!this.props.didDeleteGraphFail()},()=>er.createElement("span",{class:er.const("actions"),handleEvent:er.const("true")},er.createElement("span",{role:er.const("button"),tabIndex:er.const(0),"aria-label":()=>this.props.controller().s("account-shell-button-mygraphs-delete-title",{graphTitle:this.props.getTitle()}),class:er.const("dcg-action-removegraph"),onTap:this.props.requestDeleteGraph},er.createElement(ze,{tooltip:this.bindFn(this.getDeleteTooltipText),gravity:this.const("e")},er.createElement("i",{class:er.const("dcg-icon-remove"),"aria-hidden":er.const("true")}))))))}getDeleteTooltipText(){return this.props.controller().graphsController.isAnyGeometryTool()?this.props.controller().s("account-shell-button-mygraphs-delete-construction"):this.props.controller().s("account-shell-button-mygraphs-delete-graph")}didUpdate(){this.props.isSelected()&&re(this.node).trigger("focus")}didMount(e){this.node=e,re(this.node).on("focus",()=>{this.props.isSelected()||this.props.onFocus()})}};var Xo=__dcg_shared_module_exports__['e'](Z());var po=__dcg_shared_module_exports__['e'](Z()),{If:lO}=po.Components,kf=class extends po.Class{template(){return po.createElement("div",{class:po.const("dcg-loading-container")},po.createElement(lO,{predicate:()=>!this.props.didDataLoadFail()},()=>po.createElement("div",{class:po.const("dcg-graph-loading")},po.createElement("div",{class:po.const("pulsing-message")},()=>this.props.s("account-shell-text-mygraphs-loading")),po.createElement("div",{role:po.const("link"),tabIndex:po.const("0"),class:po.const("dcg-cancel-while-loading"),onTap:this.props.onCancel},()=>this.props.s("account-shell-button-mygraphs-cancel")))),po.createElement(lO,{predicate:()=>this.props.didDataLoadFail()},()=>po.createElement("div",{class:po.const("dcg-graph-loading-error"),"aria-live":po.const("assertive"),"aria-atomic":po.const("true")},po.createElement("div",{class:po.const("dcg-graph-loading-error-title")},()=>this.props.s("account-shell-error-mygraphs-error-loading")),po.createElement("div",{class:po.const("dcg-graph-loading-error-subtitle")},()=>this.props.s("account-shell-error-mygraphs-check-connection")),po.createElement("div",{class:po.const("dcg-graph-loading-error-options")},po.createElement("span",{role:po.const("button"),tabIndex:po.const("0"),class:po.const("dcg-action-try-again dcg-btn-blue dcg-btn-medium"),onTap:this.props.requestLoadGraphData},()=>this.props.s("account-shell-button-mygraphs-try-again")),po.createElement(lO,{predicate:()=>!!this.props.onCancel},()=>po.createElement("span",null,()=>this.props.s("account-shell-text-mygraphs-or"))),po.createElement(lO,{predicate:()=>!!this.props.onCancel},()=>po.createElement("span",{role:po.const("button"),tabIndex:po.const("0"),class:po.const("dcg-action-cancel dcg-btn-light-gray dcg-btn-medium"),onTap:this.props.onCancel},()=>this.props.s("account-shell-button-mygraphs-cancel")))))))}};var{If:o1e}=Xo.Components,cO=class extends Xo.Class{didMountGraphPreview(e){return this.graphPreview=e,this.updateGraphPreviewTop()}didMountArrow(e){return this.arrow=e,this.updateArrowTop()}didMountCalc(e){return this.previewCalc=this.props.makeAPI(e),this.updatePreviewCalc()}willUnmountCalc(){this.previewCalc&&this.previewCalc.destroy&&this.previewCalc.destroy()}didUpdate(){return this.updateGraphPreviewTop(),this.updateArrowTop(),this.updatePreviewCalc()}updateGraphPreviewTop(){this.graphPreview.style.top=this.getTopOffset()+"px"}updateArrowTop(){this.arrow.style.top=this.getArrowOffset()+"px"}updatePreviewCalc(){let e=this.props.getGraphData();e!==this.cachedGraphData&&(this.cachedGraphData=e,this.previewCalc.setState(e),this.previewCalc.resize())}getMaxTop(){return window.innerHeight-this.graphPreview.offsetHeight-10}getIdealTop(){let e=this.props.alignToNode();return e==null?null:wi(e).top+.5*e.offsetHeight-60}getTopOffset(){let e=this.getIdealTop();if(e==null)return 0;let t=this.getMaxTop();return Math.min(e,t)}getArrowOffset(){let e=this.getIdealTop();if(e==null)return 60;let t=this.getTopOffset();return 60+e-t}template(){return Xo.createElement("div",{class:Xo.const("graph-preview"),didMount:this.bindFn(this.didMountGraphPreview)},Xo.createElement("div",{class:Xo.const("dcg-graph-preview-info")},Xo.createElement("h4",{class:Xo.const("dcg-title")},this.props.getTitle),Xo.createElement("span",{role:Xo.const("button"),tabIndex:Xo.const("0"),class:Xo.const("dcg-action-cancel"),onTap:this.props.onCancel},Xo.createElement("i",{class:Xo.const("dcg-icon-remove"),"aria-hidden":Xo.const("true")}))),Xo.createElement("div",{class:Xo.const("preview-graph-area")},Xo.createElement(o1e,{predicate:()=>!this.props.getGraphData()},()=>Xo.createElement(kf,{didDataLoadFail:this.props.didDataLoadFail,onCancel:this.props.onCancel,requestLoadGraphData:this.props.requestLoadGraphData,s:this.props.s.bind(this.props)})),Xo.createElement("div",{didMount:this.bindFn(this.didMountCalc),willUnmount:this.bindFn(this.willUnmountCalc),class:()=>({"dcg-preview-calculator":!0,"dcg-visible":this.props.getGraphData()})}),Xo.createElement("div",{class:()=>({"screenshot-clickjack":!0,"dcg-action-open-graph":!0,"dcg-visible":this.props.getGraphData()})},Xo.createElement("span",{role:Xo.const("button"),tabIndex:Xo.const("0"),class:Xo.const("dcg-action-open-graph dcg-open-graph-btn dcg-btn-blue"),onTap:this.props.onOpenGraph},this.props.getOpenText))),Xo.createElement("div",{class:Xo.const("active-arrow"),didMount:this.bindFn(this.didMountArrow)},Xo.createElement("div",{class:Xo.const("dcg-graphic")})))}};var sh=__dcg_shared_module_exports__['e'](Z()),_y=class extends sh.Class{template(){return sh.createElement("div",{class:sh.const("dcg-mygraphs-section-title-container")},sh.createElement("span",{role:sh.const("heading"),"aria-level":sh.const("1"),class:sh.const("dcg-mygraphs-section-title")},()=>this.props.title()))}};var Nr=__dcg_shared_module_exports__['e'](Z());$t();var{Input:i1e,If:dO}=Nr.Components,qre=4,pO=class extends Nr.Class{willUpdate(){this.props.isSearching()||this.setSearchValue("")}setSearchValue(e){this.searchValue!==e&&(this.searchValue=e,this.props.updateFilter(e))}init(){this.controller=this.props.controller(),this.searchValue=""}template(){return Nr.createElement("div",{class:Nr.const("dcg-user-bar"),didMount:e=>this.rootNode=e},Nr.createElement(dO,{predicate:()=>!this.props.isSearching()},()=>Nr.createElement("div",{class:Nr.const("dcg-account-link-container")},Nr.createElement("button",{class:Nr.const("dcg-unstyled-button dcg-account-link"),"dcg-menu-button":Nr.const("account-mygraphs"),"aria-haspopup":Nr.const("true"),"aria-expanded":()=>this.controller.getOpenMenu()==="account-mygraphs","aria-label":()=>this.props.s("account-shell-label-account-information"),onTap:e=>{var t;if(this.measureAccountDropdownArrowOffset(),this.props.controller().dispatch({type:"toggle-menu",payload:"account-mygraphs"}),e.device=="keyboard"){let i=this.props.controller().getOpenMenu()==="account-mygraphs"?".dcg-action-accountsettings":".dcg-account-link";(t=document.querySelector(i))==null||t.focus()}}},Nr.createElement("span",{class:Nr.const("dcg-variable-name")},()=>this.controller.userController.getFirstName()),Nr.createElement("i",{class:Nr.const("dcg-icon-caret-down"),"aria-hidden":Nr.const("true")})),Nr.createElement(dO,{predicate:()=>this.controller.getOpenMenu()==="account-mygraphs"},()=>Nr.createElement(E1,{type:this.const("account-mygraphs"),controller:this.const(this.controller),left:this.const(qre),arrowLeft:this.const(this.accountDropdownArrowOffset-qre)})))),Nr.createElement(dO,{predicate:()=>!this.props.isSearching()},()=>Nr.createElement("div",{role:Nr.const("link"),tabIndex:Nr.const("0"),class:Nr.const("dcg-search-btn"),onTap:e=>{var t;e.preventDefault(),this.props.openSearch(),(t=document.querySelector(".search-container input"))==null||t.focus()}},Nr.createElement("i",{class:Nr.const("dcg-icon-search search-icon"),"aria-hidden":Nr.const("true")}),Nr.createElement("span",{class:Nr.const("dcg-menu-title")},()=>this.props.s("account-shell-heading-title-mygraphs-search")))),Nr.createElement(dO,{predicate:()=>this.props.isSearching()},()=>Nr.createElement("div",{role:Nr.const("search"),class:Nr.const("search-container search-open")},Nr.createElement("i",{class:Nr.const("dcg-icon-search search-icon"),"aria-hidden":Nr.const("true")}),Nr.createElement(i1e,{placeholder:()=>this.props.s("account-shell-text-mygraphs-search-by-title"),onInput:this.bindFn(this.setSearchValue),onFocus:this.props.openSearch,value:()=>this.searchValue,didMount:this.bindFn(this.didMountSearch)}),Nr.createElement("span",{role:Nr.const("button"),tabIndex:Nr.const(0),"aria-label":()=>this.props.s("account-shell-heading-title-mygraphs-search"),class:Nr.const("dcg-icon-remove dcg-action-close-search"),onTap:e=>{e.preventDefault(),this.props.closeSearch()}}))))}didMountSearch(e){re(e).on("blur",()=>{e.value||this.props.closeSearch()})}measureAccountDropdownArrowOffset(){var a,s;let e=this.rootNode.querySelector(".dcg-account-link i"),t=e&&wi(e),o=(a=t==null?void 0:t.left)!=null?a:0,i=(s=e==null?void 0:e.getBoundingClientRect().width)!=null?s:0,n=o+i/2;this.accountDropdownArrowOffset=n}};var{If:gs,For:xU,IfElse:zre}=Ie.Components,wU="default",Tg="search",n1e=50,uO=class extends Ie.Class{constructor(){super(...arguments),this.state="default"}didUpdate(){if(this.previewGraph){let e=this.getSelectedNode();e&&Vc(e,this.scrollableNode,60)&&this.update()}}didMountScrollable(e){this.scrollableNode=e,re(this.scrollableNode).on("focusin",o=>{if(this.previewGraph&&!o.target.classList.contains("graph-link"))return this.previewItem(void 0)}),re(window).on("keydown",o=>{if(!this.props.isOpen())return!0;switch(Be(o)){case Ia:return this.selectUp(o);case On:return this.selectDown(o)}});let t=__dcg_shared_module_exports__['E'](this.hidePreviewIfTooScrolled.bind(this),200);re(this.scrollableNode).on("scroll",t),this.debouncedFetchSelectedGraph=__dcg_shared_module_exports__['F'](this.fetchSelectedGraph.bind(this),200)}fetchSelectedGraph(){return this.props.graphsController().loadDataForGraph(this.previewGraph)}hidePreviewIfTooScrolled(){if(!this.previewGraph)return;let e=this.getSelectedNode();if(!e)return;let t=this.rootNode.querySelector(".active-arrow")||void 0,o=wi(e),i=e.getBoundingClientRect().height,n=wi(t);if(o===void 0||i===void 0||n===void 0)return;let a=o.top+.5*i,s=n.top;Math.abs(a-s)>10&&this.previewItem(void 0)}openSearch(){this.state=Tg,this.previewItem(void 0)}closeSearch(){this.state=wU,this.previewItem(void 0)}updateFilter(e){this.filter=e,this.update()}getMaxGraphs(){return this.maxGraphs||n1e}getCountRemaining(){return this.getSavedGraphs().length-this.getMaxGraphs()}showMoreGraphs(e){let t=this.getMaxGraphs();if(this.getCountRemaining()<2*t?this.maxGraphs=1/0:this.maxGraphs=2*t,this.update(),(e!=null?e.device:void 0)==="keyboard"){let o=this.getSavedAndExampleGraphs(),i=o?o[t]:void 0;i&&this.previewItem(i)}}getSelectedNode(){return document.querySelector(".dcg-mygraphs .graph-link-container.dcg-selected")}selectUp(e){if(!this.previewGraph)return;e.preventDefault();let t=this.getSavedAndExampleGraphs();if(!t.length)return;let o=this.previewGraph?this.previewGraph.hash:void 0,i=t.findIndex(a=>a.hash===o),n=i>-1&&t?t[i-1]:void 0;n?n&&this.previewItem(n):this.newGraph&&re(this.newGraph).trigger("focus")}selectDown(e){if(!this.previewGraph)return;let t=this.getSavedAndExampleGraphs();if(!t.length)return;e.preventDefault();let o=this.previewGraph?this.previewGraph.hash:void 0,i=t.findIndex(a=>a.hash===o),n=i>-1&&t?t[i+1]:void 0;n&&(!n.example&&i+1>=this.getMaxGraphs()&&this.showMoreGraphs(),this.previewItem(n))}getFilter(){return this.state===Tg&&this.filter?this.filter:""}getRecoveryGraphs(){return this.props.graphsController().getRecoveryGraphs()}attemptRecovery(){this.controller.dispatch({type:"update-graphs-state",update:{type:"fetch-recovery-graphs"}})}hasAttemptedRecovery(){return this.controller.mygraphsController.hasAttemptedRecovery()&&!this.isAttemptingRecovery()}isAttemptingRecovery(){return this.controller.graphsController.isFetchingRecoveryGraphs()}shouldShowAttemptRecoveryText(){return this.graphsController.isRecoveryUIEnabledForProduct()?!this.hasAttemptedRecovery():!1}hasFetchedSavedGraphs(){return this.props.graphsController().millisecondsSinceSync()!==1/0}getSavedGraphs(){return this.props.graphsController().getSavedGraphs()}getExampleGraphs(){return this.props.graphsController().getExampleGraphs()}getSavedAndExampleGraphs(){return this.props.graphsController().getSavedAndExampleGraphs()}filterGraphs(e){let t=this.getFilter().toLowerCase();return t?e.filter(o=>this.sanitizeTitle(o).toLowerCase().indexOf(t)>=0):e}sliceGraphs(e){return e.slice(0,this.getMaxGraphs())}canShowMore(e){return e.length>this.getMaxGraphs()}onFocusGraph(e){this.isSmallScreen()||this.previewItem(e)}onTapGraph(e,t){this.isSmallScreen()||t.device==="keyboard"?this.openGraphWithCover(e):this.previewGraph!==e&&this.previewItem(e)}previewItem(e){this.previewGraph&&(this.previewGraph=void 0),e&&(this.previewGraph=e,this.debouncedFetchSelectedGraph()),this.update()}isSmallScreen(){let e=window.platform;return document.body.getBoundingClientRect().width<650||e==="ios"||e==="android"}onOpenPreviewGraph(){if(!this.previewGraph)return;let{previewGraph:e}=this;this.previewItem(void 0),this.props.onOpenGraph(e)}openGraphWithCover(e){if(this.graphWithCover=e,this.previewItem(void 0),e!==void 0)return setTimeout(async()=>{try{if(await this.props.graphsController().loadGraphImmediately(e),!this.graphWithCover)return;this.props.openGraphBehindCover(e).then(this.bindIfMounted(()=>{this.graphWithCover=void 0,this.update()}))}catch(t){}this._isMounted&&this.update()},250)}cancelLoadGraphWithCover(){this.graphWithCover=void 0,this.update()}didDataLoadFail(e){return e?this.props.graphsController().didDataLoadFail(e):!1}willUpdate(){(!this.props.isOpen()||!this.controller.userController.isLoggedIn())&&(this.state=wU)}didMountNewGraph(e){return this.newGraph=e,re(this.newGraph).on("keydown",t=>{if(Be(t)!==On)return;let o=this.getSavedAndExampleGraphs();return this.previewItem(o[0]),t.preventDefault(),t.stopPropagation()})}sanitizeTitle(e){return e.example&&e.i18nKey?this.controller.s(e.i18nKey):e.title||this.graphsController.getUntitledString()}async hideGraphsAndShowArtContest(){if(this.props.closeDrawer(),this.isSmallScreen())try{let e=this.controller.getProduct(),o=(await k1(e==="geometry"?void 0:e)).filter(i=>!(i!=null&&i.submitting_for_someone_else));this.props.controller().dispatch({type:"show-modal",modal:"contest-submission",currentSubmission:o[0]})}catch(e){this.controller.api.controller.dispatch({type:"toast/show",toast:{message:this.controller.s("frontpage-error-something-went-wrong-try-again-later")}})}else this.props.controller().dispatch({type:"toggle-menu",payload:"art-contest"})}init(){this.state=wU,this.controller=this.props.controller(),this.graphsController=this.controller.graphsController}template(){return Ie.createElement("div",{class:()=>({"dcg-mygraphs":!0,"logged-in":this.controller.userController.isLoggedIn()}),didMount:e=>this.rootNode=e},Ie.createElement("div",{class:Ie.const("dcg-resources-container")},Ie.createElement(gs,{predicate:()=>this.props.accountsEnabled()&&!this.controller.userController.isLoggedIn()},()=>Ie.createElement(iO,{onCreateAccount:this.props.onCreateAccount,onSignIn:this.props.onSignIn,controller:this.props.controller})),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()},()=>Ie.createElement("div",null,Ie.createElement(pO,{controller:this.props.controller,openSearch:this.bindFn(this.openSearch),closeSearch:this.bindFn(this.closeSearch),updateFilter:this.bindFn(this.updateFilter),isSearching:()=>this.state===Tg,s:this.controller.s}))),Ie.createElement("div",{class:Ie.const("dcg-scrollable"),didMount:this.bindFn(this.didMountScrollable)},Ie.createElement("div",{class:Ie.const("dcg-scrollable-interior")},Ie.createElement(gs,{predicate:()=>this.state!==Tg&&this.controller.shouldShowArtContestNudge()},()=>Ie.createElement("button",{onTap:this.bindFn(this.hideGraphsAndShowArtContest),class:Ie.const("dcg-sidebar-contest-submit")},Ie.createElement("span",{class:Ie.const("dcg-trophy-icon")},Ie.const("\u{1F3C6}")),Ie.const(" "),Ie.createElement(vr,{i18n:this.const(this.controller),key:this.const("account-shell-text-mygraphs-contest-submit-to-contest")},Ie.createElement("span",{class:Ie.const("dcg-contest-submit-message")},Ie.const("Submit this graph to the"),Ie.const(" "),Ie.createElement("span",{class:Ie.const("dcg-bold-text")},Ie.const("Global Math Art Contest!")))))),Ie.createElement(gs,{predicate:()=>this.state!==Tg},()=>Ie.createElement("div",{role:Ie.const("link"),tabIndex:Ie.const("0"),class:Ie.const("new-blank-graph dcg-action-newblankgraph"),onTap:()=>(this.previewItem(void 0),this.props.openBlankGraph()),didMount:this.bindFn(this.didMountNewGraph)},Ie.createElement("div",{class:Ie.const("new-blank-graph-inner")},Ie.createElement("span",{class:Ie.const("dcg-add-blank")},Ie.createElement("i",{class:Ie.const("dcg-icon-plus"),"aria-hidden":Ie.const("true")})),Ie.createElement("span",{class:Ie.const("dcg-new-graph-title")},this.bindFn(this.getNewTitleText))))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&this.state!==Tg},()=>Ie.createElement("div",null,Ie.createElement(_y,{title:this.bindFn(this.getCurrentText)}),Ie.createElement(sO,{getTitle:()=>this.getPreviewTitle(),getDisplayDate:()=>this.controller.unpack(this.props.graphsController().getCurrentDisplayDate()),isOpen:this.props.isOpen,getThumbnail:this.props.getThumbnail,isSaveEnabled:this.props.isSaveEnabled,simpleSave:()=>(this.props.simpleSave(),this.previewItem(void 0)),openSaveDialog:()=>(this.props.openSaveDialog(),this.previewItem(void 0)),wasCurrentGraphEverSaved:()=>this.props.graphsController().wasCurrentGraphEverSaved(),isSaving:()=>this.props.graphsController().isSaving(),didSaveRecentlySucceed:()=>this.props.graphsController().didSaveSucceed(),didSaveRecentlyFail:()=>this.props.graphsController().didSaveFail(),isSyncing:()=>this.props.graphsController().isSyncing(),willSaveCopy:()=>this.props.graphsController().willSaveCopy(),s:this.controller.s}),Ie.createElement(gs,{predicate:this.bindFn(this.shouldShowAttemptRecoveryText)},()=>Ie.createElement("div",{class:Ie.const("dcg-lost-work-link")},zre(()=>this.isAttemptingRecovery(),{true:()=>Ie.createElement("span",null,Ie.createElement("span",null,()=>this.controller.s("account-shell-text-mygraphs-attempting-recovery")),Ie.createElement("span",{class:Ie.const("dcg-spinner-dark")})),false:()=>Ie.createElement("span",null,Ie.createElement("span",null,()=>this.controller.s("account-shell-text-mygraphs-lost-work")+" "),Ie.createElement("span",{tabIndex:Ie.const("0"),role:Ie.const("link"),class:Ie.const("dcg-attempt-recovery"),onTap:this.bindFn(this.attemptRecovery)},()=>this.controller.s("account-shell-button-mygraphs-attempt-recovery")))}))))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&this.hasAttemptedRecovery()&&this.state!==Tg&&this.controller.graphsController.didFetchRecoveryGraphsFail()},()=>Ie.createElement("div",{class:Ie.const("no-matches"),"aria-live":Ie.const("assertive"),"aria-atomic":Ie.const("true")},()=>this.controller.s("account-shell-error-unknown"))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&this.hasAttemptedRecovery()&&this.state!==Tg&&!this.controller.graphsController.didFetchRecoveryGraphsFail()},()=>Ie.createElement("div",null,zre(()=>this.getRecoveryGraphs().length>0,{true:()=>Ie.createElement("div",{class:Ie.const("dcg-recovery-graphs-list")},Ie.createElement(_y,{title:()=>this.controller.s("account-shell-heading-mygraphs-recovered-work")}),Ie.createElement("div",{role:Ie.const("list")},Ie.createElement(xU,{each:()=>this.getRecoveryGraphs(),key:e=>e.getCollectionKey()},e=>Ie.createElement(z1,{onTap:t=>this.onTapGraph(e,t),onFocus:()=>this.onFocusGraph(e),cancelDeleteGraph:()=>this.props.graphsController().cancelDeleteGraph(e),requestDeleteGraph:()=>(this.previewItem(void 0),this.props.graphsController().requestDeleteGraph(e)),isDeletingGraph:()=>this.props.graphsController().isDeletingGraph(e),canCancelDelete:()=>this.props.graphsController().canCancelDelete(e),didDeleteGraphFail:()=>this.props.graphsController().didDeleteGraphFail(e),isSelected:()=>e===this.previewGraph,isExample:Ie.const(!1),getDisplayDate:()=>this.controller.unpack(e.displayDate()),getTitle:()=>this.sanitizeTitle(e),getThumbURL:()=>e.thumbURL,controller:()=>this.controller})))),false:()=>Ie.createElement("div",{class:Ie.const("dcg-no-recovery-graphs")},this.bindFn(this.getNoUnsavedText))}))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()},()=>Ie.createElement(_y,{title:this.bindFn(this.getSavedTitle)})),Ie.createElement("div",{class:Ie.const("dcg-saved-graphs-list"),role:Ie.const("list")},Ie.createElement(xU,{each:()=>this.sliceGraphs(this.filterGraphs(this.getSavedGraphs())),key:e=>e.getCollectionKey()},e=>Ie.createElement(z1,{onTap:t=>this.onTapGraph(e,t),onFocus:()=>this.onFocusGraph(e),cancelDeleteGraph:()=>this.props.graphsController().cancelDeleteGraph(e),requestDeleteGraph:()=>(this.previewItem(void 0),this.props.graphsController().requestDeleteGraph(e)),isDeletingGraph:()=>this.props.graphsController().isDeletingGraph(e),canCancelDelete:()=>this.props.graphsController().canCancelDelete(e),didDeleteGraphFail:()=>this.props.graphsController().didDeleteGraphFail(e),isSelected:()=>e===this.previewGraph,isExample:Ie.const(!1),getDisplayDate:()=>this.controller.unpack(e.displayDate()),getTitle:()=>this.sanitizeTitle(e),getThumbURL:()=>e.thumbURL,controller:()=>this.controller}))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&this.controller.graphsController.didSyncFail()},()=>Ie.createElement("div",{"aria-live":Ie.const("assertive"),"aria-atomic":Ie.const("true"),class:Ie.const("no-matches")},()=>this.controller.s("account-shell-error-unknown"))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&!this.controller.graphsController.didSyncFail()&&this.hasFetchedSavedGraphs()&&this.filterGraphs(this.getSavedGraphs()).length===0},()=>Ie.createElement("div",{"aria-live":Ie.const("assertive"),"aria-atomic":Ie.const("true"),class:Ie.const("no-matches")},this.bindFn(this.getNoMatchesText))),Ie.createElement(gs,{predicate:()=>this.controller.userController.isLoggedIn()&&!this.controller.graphsController.didSyncFail()&&!this.hasFetchedSavedGraphs()},()=>Ie.createElement("span",{class:Ie.const("dcg-loading-message")},Ie.createElement("span",{class:Ie.const("dcg-spinner-dark")}),()=>this.controller.s("account-shell-label-loading"))),Ie.createElement(gs,{predicate:()=>this.canShowMore(this.filterGraphs(this.getSavedGraphs()))},()=>Ie.createElement("div",{class:Ie.const("dcg-show-more-graphs"),onTap:this.bindFn(this.showMoreGraphs),role:Ie.const("button"),tabIndex:Ie.const("0")},()=>this.controller.s("account-shell-text-mygraphs-count-more",{count:this.getCountRemaining()}))),Ie.createElement(gs,{predicate:()=>this.getExampleGraphs().length>0},()=>Ie.createElement(_y,{title:()=>this.controller.s("account-shell-heading-mygraphs-examples")})),Ie.createElement("div",{role:Ie.const("list")},Ie.createElement(xU,{each:()=>this.filterGraphs(this.getExampleGraphs()),key:e=>e.getCollectionKey()},e=>Ie.createElement(z1,{onTap:t=>this.onTapGraph(e,t),onFocus:()=>this.onFocusGraph(e),cancelDeleteGraph:()=>{},requestDeleteGraph:()=>{},isDeletingGraph:Ie.const(!1),didDeleteGraphFail:Ie.const(!1),canCancelDelete:Ie.const(!1),isSelected:()=>e===this.previewGraph,isExample:Ie.const(!0),getDisplayDate:()=>this.controller.unpack(e.displayDate()),getTitle:()=>this.sanitizeTitle(e),getThumbURL:()=>e.thumbURL,controller:()=>this.controller}))),Ie.createElement(gs,{predicate:()=>this.getFilter()?this.filterGraphs(this.getExampleGraphs()).length===0:!1},()=>Ie.createElement("div",{"aria-live":Ie.const("assertive"),"aria-atomic":Ie.const("true"),class:Ie.const("no-matches")},()=>this.controller.s("account-shell-text-mygraphs-no-examples-match-search"))),Ie.createElement("div",{class:Ie.const("dcg-mygraphs-legal")},Ie.createElement("a",{href:Ie.const("/terms"),target:Ie.const("_blank")},()=>this.controller.s("account-shell-link-terms")),Ie.const("|"),Ie.createElement("a",{href:Ie.const("/privacy"),target:Ie.const("_blank")},()=>this.controller.s("account-shell-link-privacy")),Ie.createElement(gs,{predicate:()=>!!this.props.versionNumber()},()=>Ie.createElement("div",{class:Ie.const("dcg-version")},()=>this.controller.s("account-shell-text-mygraphs-version"),Ie.const(" "),this.props.versionNumber))))),Ie.createElement(gs,{predicate:()=>!!this.previewGraph},()=>Ie.createElement(cO,{alignToNode:()=>this.getSelectedNode(),getTitle:()=>this.previewGraph?this.sanitizeTitle(this.previewGraph):"",getGraphData:()=>this.previewGraph?this.previewGraph.graphData:void 0,onCancel:()=>this.previewItem(void 0),didDataLoadFail:()=>this.didDataLoadFail(this.previewGraph),requestLoadGraphData:this.bindFn(this.fetchSelectedGraph),onOpenGraph:this.bindFn(this.onOpenPreviewGraph),s:this.controller.s,makeAPI:this.props.makeAPI,getOpenText:()=>this.controller.getOpenText()}))),Ie.createElement(gs,{predicate:this.props.isOpen},()=>Ie.createElement("div",{role:Ie.const("link"),tabIndex:Ie.const("0"),class:Ie.const("dcg-resources-cover dcg-action-close-resources"),style:()=>({opacity:this.previewGraph?"0.6":"0"}),onTap:()=>this.previewGraph?this.previewItem(void 0):this.props.closeDrawer(),"aria-label":()=>this.previewGraph?this.controller.s("account-shell-button-mygraphs-close-graph-preview"):this.controller.s("account-shell-button-mygraphs-close-graph-list")})),Ie.createElement(gs,{predicate:()=>!!this.graphWithCover},()=>Ie.createElement("div",{class:Ie.const("dcg-fullscreen-loading-container")},Ie.createElement(kf,{didDataLoadFail:()=>this.didDataLoadFail(this.graphWithCover),onCancel:this.bindFn(this.cancelLoadGraphWithCover),requestLoadGraphData:()=>this.openGraphWithCover(this.graphWithCover),s:this.controller.s}))))}getNewTitleText(){return this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-new-construction"):this.controller.s("account-shell-text-mygraphs-new-blank-graph")}getCurrentText(){return this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-current-construction"):this.controller.s("account-shell-text-mygraphs-current-graph")}getNoUnsavedText(){return this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-no-unsaved-constructions"):this.controller.s("account-shell-text-mygraphs-no-unsaved-graphs")}getSavedTitle(){return this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-heading-mygraphs-saved-constructions"):this.controller.s("account-shell-heading-mygraphs-saved-graphs")}getNoMatchesText(){return this.state===Tg?this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-no-construction-search-results"):this.controller.s("account-shell-text-mygraphs-no-graph-search-results"):this.graphsController.isAnyGeometryTool()?this.controller.s("account-shell-text-mygraphs-no-saved-constructions"):this.controller.s("account-shell-text-mygraphs-no-saved-graphs")}getPreviewTitle(){return this.graphsController.getCurrentGraphTitle()||this.graphsController.getUntitledString()}};var hO=class extends gO.Class{makeAPI(e){let t=this.controller.api._calc.controller.getGraphSettings().cloneConfig();return this.props.makeAPI(e,t)}init(){this.controller=this.props.controller(),this.graphsController=this.controller.graphsController,this.mygraphsController=this.controller.mygraphsController}template(){return gO.createElement(uO,{isOpen:()=>this.mygraphsController.isMygraphsOpen(),graphsController:()=>this.graphsController,accountsEnabled:this.const(!0),controller:()=>this.controller,closeDrawer:()=>this.controller.dispatch({type:"close-mygraphs"}),openBlankGraph:()=>this.mygraphsController.openBlankGraph(),onOpenGraph:e=>this.mygraphsController.onOpenGraph(e),openGraphBehindCover:e=>this.mygraphsController.openGraphBehindCover(e),onLogout:()=>this.controller.userController.logout(),onEditAccount:()=>this.controller.dispatch({type:"show-modal",modal:"account-settings"}),onCreateAccount:()=>this.controller.dispatch({type:"show-modal",modal:"authentication",fromButton:"sign-up"}),onSignIn:()=>this.controller.dispatch({type:"show-modal",modal:"authentication",fromButton:"log-in"}),getThumbnail:()=>this.mygraphsController.getThumbnail(),simpleSave:()=>this.controller.simpleSave(),openSaveDialog:()=>this.controller.openSaveDialog({fromSaveInProgress:!0}),versionNumber:()=>Sy.versionNumber,isSaveEnabled:()=>this.controller.isSaveEnabled(),makeAPI:this.bindFn(this.makeAPI)})}};var a1e=500*1024,Hre=[];function Kre(){let r=[],e=0;for(let t=0;t<Hre.length;t++){let o=Hre[t];if(e+=o.size,e>a1e)break;r.push(o.payload)}return r}var Yre=__dcg_shared_module_exports__['e']($re());function s1e(r){return r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}var l1e=["UnhandledRejection","lnrAppboy","socratic","MyAppGet","SymBrowser_","mobincube_","_avast_submit","Cannot redefine property: googletag","jcarousel","SyntaxError: Unexpected identifier 'script'","__gCrWeb.autofill.extractForms","BrowseITEXT","Can't find variable: removeAllHighlights","aAttribruteValue.parentNode.getAttribute","vid_mate_check","GetImageTagSrcFromPoint","Can't find variable: didEnterViewPort","tinyMCE is not defined","div:has(> iframe[id='198230182308109283091823098102938908128390'])"],jre=new RegExp(l1e.map(s1e).join("|"));function c1e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}function d1e(){return window.kiavash&&window.kiavash.commit}function p1e(){let r="production";if(location&&location.hostname){let t=location.hostname.split("."),o=t.slice(0,t.length-2).join(".");t.slice(t.length-2).join(".")==="kiavash.com"&&(!o||o==="www"?r="production":r=o)}return r}var mO=class{constructor(){this.numberOfSentErrors=0;this.pageLoadId=c1e();this.bugsnagClient=Yre.default.start({apiKey:"7f7807097671acbc4557e64bbf5eb529",maxBreadcrumbs:40,appVersion:d1e(),releaseStage:p1e(),onError:e=>this.onError(e),enabledBreadcrumbTypes:["error","navigation","request","user"]})}onError(e){let t=Ch;return t&&t[0]<=10||e.errors.some(o=>jre.test(o.errorClass)||jre.test(o.errorMessage))?!1:(this.beforeSendCb&&this.beforeSendCb(e),this.attachWebGLReport&&this.attachWebGLReport(e),this.numberOfSentErrors+=1,e.addMetadata("custom",{errorNumber:this.numberOfSentErrors,pageLoadId:this.pageLoadId}),!0)}setBeforeSendCB(e){this.beforeSendCb=e}setAttachWebGLReport(e){this.attachWebGLReport=e}leaveBreadcrumb(e,t,o){if(t){t={...t};for(let i in t)try{t[i]=JSON.stringify(t[i],null,2)}catch(n){t[i]="[[could not stringify]]"}}this.bugsnagClient.leaveBreadcrumb(e,t,o)}notify(e,t){this.bugsnagClient&&this.bugsnagClient.notify(e,o=>(t&&t.metaData&&o.addMetadata("custom",t.metaData),t&&t.context&&(o.context=t.context),t&&t.severity&&(o.severity=t.severity),!0))}};var Xre=__dcg_shared_module_exports__['e'](Z());function u1e(r,e){let t=document.createElement("div");t.style.zIndex="999999",t.style.position="fixed",t.style.bottom="50px",t.style.left="0",t.style.right="0",document.body.append(t),Xre.mountToNode(kf,t,{s:e,didDataLoadFail:function(){return!0},requestLoadGraphData:function(){t.remove(),r()}})}function Jre(r,e){return new Promise(t=>{if(r&&r.state)t(r);else if(r&&typeof r.stateUrl=="string"){let o=!1,i=async()=>{if(!o){o=!0;try{let n=await fetch(`${r.stateUrl}?${new URLSearchParams(gm)}`,{headers:{Accept:"application/json"}});if(!n.ok)throw void 0;let a=await n.json();r.state=a,t(r)}catch(n){u1e(i,e)}finally{o=!1}}};i()}else t(void 0)})}ji("testing")||U4(new mO);async function Qre({calcConstructor:r,exampleGraphsRaw:e,extraOptions:t,product:o,noticeId:i,graphJSON:n}){let a=fm(),s=await kw(a).then(()=>a,()=>"en"),l=ste();l.disableScrollFix||eZ(),l={...l,border:!1,disableScrollFix:!0,showHamburger:!0,pasteGraphLink:!0,onlyTraceSelected:!0,showKeyboardShortcutsInTooltips:!0,...t};let c=document.getElementById("graph-container"),d=new r(c,l),p=Tre({api:d,seed:xg.seed,exampleGraphsRaw:e,product:o,noticeId:i}),u=d._calc.controller;u.setBugsnagContext("main-controller"),d.updateSettings({language:s});let h=p.userController,m=p.graphsController,y=p.tourController,w=p.shellController,S=u.s.bind(u);q4(P=>{let O=u.stateStack;O&&O.serializeForBugsnag&&P.addMetadata("states",O.serializeForBugsnag());let W=P.originalError;W&&W.dcgExtraErrorMetaData&&P.addMetadata("extraErrorData",W.dcgExtraErrorMetaData),P.addMetadata("codeEvents",Kre())});let C=new $E(o,{calcController:u,graphsController:m});C.trackFeatureUsage("graph-feature","hasSlider"),C.trackFeatureUsage("graph-feature","hasRegression"),C.trackFeatureUsage("graph-feature","hasAction"),C.trackFeatureUsage("graph-feature","expressionErrors"),C.trackFeatureUsage("graph-feature","expressionCount"),C.trackFeatureUsage("graph-feature","folderCount"),C.trackFeatureUsage("graph-feature","imageCount"),C.trackFeatureUsage("graph-feature","tableCount"),C.trackFeatureUsage("graph-feature","textCount"),d.observeEvent("change",(P,{isUserInitiated:O})=>{O&&C.handleUserChangeEvent()}),C.start(),J5({userController:h,i18n:S}),(L4()||ji("testing")||ji("reloadcss")||ji("noconcat"))&&!ji("showNavigationWarning")||re(window).on("beforeunload",()=>{if(d.hasUnsavedChanges())return S("account-shell-text-confirm-leave")}),xg.user&&h.completeLogin(xg.user),xg.graph||(m.clearGraph(),xg.latex&&d.setExpression({latex:xg.latex})),KE(),y.startTourFromUrl(),h.getEmailChangeToken()&&w.dispatch({type:"show-modal",modal:"change-email"}),w.triggerRender=function(){E.update(),_.update(),T.update(),h.getEmailChangeToken()&&w.getOpenModal()!=="change-email"&&history.replaceState(null,"",document.location.pathname)};let E=H1.mountToNode(lP,document.getElementById("dcg-header-container"),{controller:function(){return w}}),_=H1.mountToNode(oO,document.getElementById("dcg-modal-container"),{controller:function(){return w}}),T=H1.mountToNode(hO,document.getElementById("mygraphs-container"),{controller:H1.const(w),makeAPI:function(P,O){return new r(P,{...O,settingsMenu:!1,keypad:!1,zoomButtons:!1,branding:!1,border:!1,disableScrollFix:!0,expressions:!1,hideGeoUI:!0})}});Sh&&!Fz&&!hx&&w.dispatch({type:"show-modal",modal:"unsupported-browser"}),document.location.search.match(/(\?|\&)create_account/)?(history.replaceState(null,"",document.location.pathname),h.isLoggedIn()?u.dispatch({type:"toast/show",toast:{message:S("account-shell-text-logged-in")}}):w.dispatch({type:"show-modal",modal:"authentication"})):document.location.search.match(/(\?|\&)login/)?(history.replaceState(null,"",document.location.pathname),h.isLoggedIn()?u.dispatch({type:"toast/show",toast:{message:S("account-shell-text-logged-in")}}):w.dispatch({type:"show-modal",modal:"authentication"})):document.location.search.match(/(\?|\&)reset_password/)&&(history.replaceState(null,"",document.location.pathname),w.dispatch({type:"show-modal",modal:"recover-password"})),window.matchMedia&&window.matchMedia("print").addListener(O=>{O.matches?u.dispatch({type:"enter-printmode"}):u.dispatch({type:"exit-printmode"})}),wS(document);let I=await Jre(n,S);return{Calc:d,graphsController:m,calcController:u,shellController:w,fullGraph:I}}async function h1e(){let{Calc:r,graphsController:e,fullGraph:t}=await Qre({calcConstructor:Ju,exampleGraphsRaw:ite,extraOptions:{onlyTraceSelected:!1},product:"graphing",graphJSON:xg.graph});return t&&t.state&&(t.state.graph.product==="geometry-calculator"?window.location.replace(document.location.href.split("/calculator/").join("/geometry/")):e.loadGraph(Da.fromAjax(t))),r}var Zre=h1e();$t();typeof kiavash=="undefined"&&(kiavash={});function eoe(){kiavash.$=re,kiavash.$.noConflict(!0)}function toe(){window.TestBridge={}}Zf(document.body);eoe();Zre.then(r=>{document.querySelector(".dcg-loading-div-container").style.display="none",window.Calc=r,toe()});
/*!
 * jQuery JavaScript Library v3.6.0
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2021-03-02T17:08Z
 */
/*!!
 *  Canvas 2 Svg v1.0.19
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 *
 *  Modifications by kiavash:
 *  - wrapped in AMD pattern
 *  - added ctx.ellipse() method
 *  - fixed image opacity bug
 *  - added ability to add classNames to exported svg elements
 *  - added ability to add named groups
 *  - removed dominant-basline attribute. Editors appear to ignore it. Must solve baseline issues using transformations
 */
})()